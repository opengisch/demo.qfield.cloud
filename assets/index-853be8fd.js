var Dv=Object.defineProperty;var Gv=(n,e,t)=>e in n?Dv(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var zv=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var _=(n,e,t)=>(Gv(n,typeof e!="symbol"?e+"":e,t),t),mc=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var Z=(n,e,t)=>(mc(n,e,"read from private field"),t?t.call(n):e.get(n)),se=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},Ze=(n,e,t,i)=>(mc(n,e,"write to private field"),i?i.call(n,t):e.set(n,t),t);var yc=(n,e,t,i)=>({set _(s){Ze(n,e,s,t)},get _(){return Z(n,e,i)}}),ae=(n,e,t)=>(mc(n,e,"access private method"),t);import{t as zo,g as Bv,a as Cg,G as Uv,I as jv}from"./lazy-af36d162.js";import{R as Wm,C as $v,a as qv}from"./cesium-f12835f2.js";var uk=zv(ut=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();const Gi=class Gi{constructor(e){if(!(e in Gi.initializingSingletons)||!Gi.initializingSingletons[e])throw new Error("This is a singleton. Please use the getInstance() method.")}static getInstance(){const e=this.name;if(!(e in Gi.instances)){Gi.initializingSingletons[e]=!0;try{console.log(`Creating Singleton ${e}`);const t=new this(e);Gi.instances[e]=t}finally{Gi.initializingSingletons[e]=!1}}return Gi.instances[e]}isNullOrUndefined(e){return e==null}isNullOrUndefinedOrBlank(e){return e==null||e===""}};_(Gi,"instances",{}),_(Gi,"initializingSingletons",{});let In=Gi;class Vv{constructor(e){_(this,"general");_(this,"languages");_(this,"themes");_(this,"basemaps");_(this,"treeview");_(this,"search");_(this,"print");_(this,"selection");_(this,"redlining");_(this,"projections");_(this,"map");_(this,"map3d");if(!e.general||!e.general.locale)throw new Error("general.locale is required");if(this.general={locale:e.general.locale},!e.languages)throw new Error("languages is required");if(this.languages=e.languages,!e.themes||!e.themes.url)throw new Error("themes.url is required");if(this.themes={url:e.themes.url,defaultTheme:e.themes.defaultTheme,imagesUrlPrefix:e.themes.imagesUrlPrefix??""},!e.basemaps||!e.basemaps.defaultBasemap)throw new Error("basemaps.defaultBasemap is required");if(this.basemaps={show:e.basemaps.show??!0,defaultBasemap:e.basemaps.defaultBasemap,OSM:e.basemaps.OSM??!1,SwissTopoVectorTiles:e.basemaps.SwissTopoVectorTiles??!1},this.treeview={useCheckboxes:e.treeview.useCheckboxes??!1,useLegendIcons:e.treeview.useLegendIcons??!1,hideLegendWhenLayerIsDeactivated:e.treeview.hideLegendWhenLayerIsDeactivated??!1,defaultIconSize:{height:e.treeview.defaultIconSize.height??20,width:e.treeview.defaultIconSize.width??20}},!e.search)throw new Error("search is required");this.search=e.search;try{e.print.url.length===0&&console.warn("Your print.url is not configured, print will not work"),e.print.defaultLayout.length===0&&console.warn("Your print.defaultLayout is not configured, print will not work")}catch{console.warn("print.url and print.defaultLayout are required")}if(this.print=e.print,e.selection||(e.selection={defaultFillColor:"#ff66667f",defaultStrokeColor:"#ff3333",defaultStrokeWidth:4,defaultFocusFillColor:"#ff33337f",defaultFocusStrokeColor:"#ff0000",defaultFocusStrokeWidth:4}),this.selection=e.selection,e.redlining||(e.redlining={defaultFillColor:"#6666ff7f",defaultStrokeColor:"#0000ff",defaultStrokeWidth:2,defaultTextSize:12,defaultFont:"Arial"}),this.redlining=e.redlining,!e.projections)throw new Error("projections is required");if(this.projections=e.projections,!e.map.srid)throw new Error("map.srid is required");if(!e.map.scales)throw new Error("map.scales is required");if(e.map.startZoom||(e.map.startZoom="4"),!e.map.maxExtent)throw new Error("map.maxExtent is required");e.map.constraintScales||(e.map.constraintScales=!1),this.map=e.map,this.map3d=e.map3d}}var Gr,zr;const Qi=class Qi extends In{get Config(){return Z(Qi,Gr)}async loadConfig(){if(Z(Qi,zr))await new Promise(e=>setTimeout(e,100)),await this.loadConfig();else{Ze(Qi,zr,!0);try{if(!Z(Qi,Gr)){console.log("Loading Application Configuration...");const t=await(await fetch("config.json")).json(),i=new Vv(t);Ze(Qi,Gr,i),console.log("Application Configuration loaded.")}}catch(e){console.error("Error loading application configuration:",e)}finally{Ze(Qi,zr,!1)}}}};Gr=new WeakMap,zr=new WeakMap,se(Qi,Gr,void 0),se(Qi,zr,!1);let ns=Qi;var Fs=(n=>(n.CustomEventType="GeoGirafe.App",n.undoDraw="undoDraw",n.zoomToExtent="zoomToExtent",n))(Fs||{});class Hm{constructor(){_(this,"center",[]);_(this,"zoom",null);_(this,"resolution",100);_(this,"scale",0)}get isValid(){return!(Number.isNaN(this.resolution)||!this.center[0]||!this.center[1]||Number.isNaN(this.center[0])||Number.isNaN(this.center[1]))}}class Wv{constructor(){_(this,"themes",{});_(this,"basemaps",{});_(this,"ogcServers",{});_(this,"activeBasemap",null);_(this,"projection",null);_(this,"mouseCoordinates",[]);_(this,"interface",{helpVisible:!1,redliningPanelVisible:!1,printPanelVisible:!1,selectionGridVisible:!1,aboutVisible:!1,darkMode:!1,darkFrontendMode:!1});_(this,"language",null);_(this,"loading",!1);_(this,"position",new Hm);_(this,"selectedTheme",null);_(this,"layers",{layersList:[],swipedLayers:{left:[],right:[]}});_(this,"redlining",{activeTool:null,features:[]});_(this,"treeview",{advanced:!1});_(this,"print",{format:null,scale:null});_(this,"globe",{display:"none"});_(this,"olMap",null);_(this,"selection",{selectionParameters:[],selectedFeatures:[],focusedFeature:null});_(this,"theme",null);_(this,"extendedState",{})}}class md extends In{constructor(){super(...arguments);_(this,"translations",null)}sendMessage(t){window.dispatchEvent(new CustomEvent(Fs.CustomEventType,{bubbles:!0,cancelable:!1,composed:!0,detail:t}))}register(t){window.addEventListener(Fs.CustomEventType,i=>{t(i.detail)})}}const Eo=".",yd=Symbol("target"),Xm=Symbol("unsubscribe");function cu(n){return n instanceof Date||n instanceof Set||n instanceof Map||n instanceof WeakSet||n instanceof WeakMap||ArrayBuffer.isView(n)}function Hv(n){return(typeof n=="object"?n===null:typeof n!="function")||n instanceof RegExp}const en=Array.isArray;function _d(n){return typeof n=="symbol"}const Ti={after:(n,e)=>en(n)?n.slice(e.length):e===""?n:n.slice(e.length+1),concat:(n,e)=>en(n)?(n=[...n],e&&n.push(e),n):e&&e.toString!==void 0?(n!==""&&(n+=Eo),_d(e)?n+e.toString():n+e):n,initial:n=>{if(en(n))return n.slice(0,-1);if(n==="")return n;const e=n.lastIndexOf(Eo);return e===-1?"":n.slice(0,e)},last:n=>{if(en(n))return n[n.length-1]||"";if(n==="")return n;const e=n.lastIndexOf(Eo);return e===-1?n:n.slice(e+1)},walk:(n,e)=>{if(en(n))for(const t of n)e(t);else if(n!==""){let t=0,i=n.indexOf(Eo);if(i===-1)e(n);else for(;t<n.length;)i===-1&&(i=n.length),e(n.slice(t,i)),t=i+1,i=n.indexOf(Eo,t)}},get(n,e){return this.walk(e,t=>{n&&(n=n[t])}),n}};function Xv(n){return typeof n=="object"&&typeof n.next=="function"}function Yv(n,e,t,i,s){const r=n.next;if(e.name==="entries")n.next=function(){const o=r.call(this);return o.done===!1&&(o.value[0]=s(o.value[0],e,o.value[0],i),o.value[1]=s(o.value[1],e,o.value[0],i)),o};else if(e.name==="values"){const o=t[yd].keys();n.next=function(){const a=r.call(this);return a.done===!1&&(a.value=s(a.value,e,o.next().value,i)),a}}else n.next=function(){const o=r.call(this);return o.done===!1&&(o.value=s(o.value,e,o.value,i)),o};return n}function Mg(n,e,t){return n.isUnsubscribed||e.ignoreSymbols&&_d(t)||e.ignoreUnderscores&&t.charAt(0)==="_"||"ignoreKeys"in e&&e.ignoreKeys.includes(t)}class Zv{constructor(e){this._equals=e,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return this._descriptorCache===void 0&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(e){const t=this._getDescriptorCache();let i=t.get(e);return i===void 0&&(i={},t.set(e,i)),i}_getOwnPropertyDescriptor(e,t){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(e,t);const i=this._getProperties(e);let s=i[t];return s===void 0&&(s=Reflect.getOwnPropertyDescriptor(e,t),i[t]=s),s}getProxy(e,t,i,s){if(this.isUnsubscribed)return e;const r=e[s],o=r||e;this._pathCache.set(o,t);let a=this._proxyCache.get(o);return a===void 0&&(a=r===void 0?new Proxy(e,i):e,this._proxyCache.set(o,a)),a}getPath(e){return this.isUnsubscribed?void 0:this._pathCache.get(e)}isDetached(e,t){return!Object.is(e,Ti.get(t,this.getPath(e)))}defineProperty(e,t,i){return Reflect.defineProperty(e,t,i)?(this.isUnsubscribed||(this._getProperties(e)[t]=i),!0):!1}setProperty(e,t,i,s,r){if(!this._equals(r,i)||!(t in e)){const o=this._getOwnPropertyDescriptor(e,t);return o!==void 0&&"set"in o?Reflect.set(e,t,i,s):Reflect.set(e,t,i)}return!0}deleteProperty(e,t,i){if(Reflect.deleteProperty(e,t)){if(!this.isUnsubscribed){const s=this._getDescriptorCache().get(e);s&&(delete s[t],this._pathCache.delete(i))}return!0}return!1}isSameDescriptor(e,t,i){const s=this._getOwnPropertyDescriptor(t,i);return e!==void 0&&s!==void 0&&Object.is(e.value,s.value)&&(e.writable||!1)===(s.writable||!1)&&(e.enumerable||!1)===(s.enumerable||!1)&&(e.configurable||!1)===(s.configurable||!1)&&e.get===s.get&&e.set===s.set}isGetInvariant(e,t){const i=this._getOwnPropertyDescriptor(e,t);return i!==void 0&&i.configurable!==!0&&i.writable!==!0}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}}function uu(n){return toString.call(n)==="[object Object]"}function Wa(){return!0}function Js(n,e){return n.length!==e.length||n.some((t,i)=>e[i]!==t)}const Ym=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),Kv=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),Zm={push:Wa,pop:Wa,shift:Wa,unshift:Wa,copyWithin:Js,reverse:Js,sort:Js,splice:Js,flat:Js,fill:Js},Jv=new Set([...Ym,...Kv,...Object.keys(Zm)]);function Ha(n,e){if(n.size!==e.size)return!0;for(const t of n)if(!e.has(t))return!0;return!1}const Km=["keys","values","entries"],Jm=new Set(["has","toString"]),Qm={add:Ha,clear:Ha,delete:Ha,forEach:Ha},Qv=new Set([...Jm,...Object.keys(Qm),...Km]);function Xa(n,e){if(n.size!==e.size)return!0;let t;for(const[i,s]of n)if(t=e.get(i),t!==s||t===void 0&&!e.has(i))return!0;return!1}const ex=new Set([...Jm,"get"]),ey={set:Xa,clear:Xa,delete:Xa,forEach:Xa},tx=new Set([...ex,...Object.keys(ey),...Km]);class ss{constructor(e,t,i,s){this._path=t,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=s,this._changes=s?[]:null,this.clone=t===void 0?e:this._shallowClone(e)}static isHandledMethod(e){return Ym.has(e)}_shallowClone(e){let t=e;if(uu(e))t={...e};else if(en(e)||ArrayBuffer.isView(e))t=[...e];else if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set([...e].map(i=>this._shallowClone(i)));else if(e instanceof Map){t=new Map;for(const[i,s]of e.entries())t.set(i,this._shallowClone(s))}return this._clonedCache.add(t),t}preferredThisArg(e,t,i,s){return e?(en(s)?this._onIsChanged=Zm[t]:s instanceof Set?this._onIsChanged=Qm[t]:s instanceof Map&&(this._onIsChanged=ey[t]),s):i}update(e,t,i){const s=Ti.after(e,this._path);if(t!=="length"){let r=this.clone;Ti.walk(s,o=>{r&&r[o]&&(this._clonedCache.has(r[o])||(r[o]=this._shallowClone(r[o])),r=r[o])}),this._hasOnValidate&&this._changes.push({path:s,property:t,previous:i}),r&&r[t]&&(r[t]=i)}this._isChanged=!0}undo(e){let t;for(let i=this._changes.length-1;i!==-1;i--)t=this._changes[i],Ti.get(e,t.path)[t.property]=t.previous}isChanged(e){return this._onIsChanged===void 0?this._isChanged:this._onIsChanged(this.clone,e)}}class Sg extends ss{static isHandledMethod(e){return Jv.has(e)}}class ix extends ss{undo(e){e.setTime(this.clone.getTime())}isChanged(e,t){return!t(this.clone.valueOf(),e.valueOf())}}class Tg extends ss{static isHandledMethod(e){return Qv.has(e)}undo(e){for(const t of this.clone)e.add(t);for(const t of e)this.clone.has(t)||e.delete(t)}}class Rg extends ss{static isHandledMethod(e){return tx.has(e)}undo(e){for(const[t,i]of this.clone.entries())e.set(t,i);for(const t of e.keys())this.clone.has(t)||e.delete(t)}}class nx extends ss{constructor(e,t,i,s){super(void 0,t,i,s),this._arg1=i[0],this._weakValue=e.has(this._arg1)}isChanged(e){return this._weakValue!==e.has(this._arg1)}undo(e){this._weakValue&&!e.has(this._arg1)?e.add(this._arg1):e.delete(this._arg1)}}class sx extends ss{constructor(e,t,i,s){super(void 0,t,i,s),this._weakKey=i[0],this._weakHas=e.has(this._weakKey),this._weakValue=e.get(this._weakKey)}isChanged(e){return this._weakValue!==e.get(this._weakKey)}undo(e){const t=e.has(this._weakKey);this._weakHas&&!t?e.set(this._weakKey,this._weakValue):!this._weakHas&&t?e.delete(this._weakKey):this._weakValue!==e.get(this._weakKey)&&e.set(this._weakKey,this._weakValue)}}class bs{constructor(e){this._stack=[],this._hasOnValidate=e}static isHandledType(e){return uu(e)||en(e)||cu(e)}static isHandledMethod(e,t){return uu(e)?ss.isHandledMethod(t):en(e)?Sg.isHandledMethod(t):e instanceof Set?Tg.isHandledMethod(t):e instanceof Map?Rg.isHandledMethod(t):cu(e)}get isCloning(){return this._stack.length>0}start(e,t,i){let s=ss;en(e)?s=Sg:e instanceof Date?s=ix:e instanceof Set?s=Tg:e instanceof Map?s=Rg:e instanceof WeakSet?s=nx:e instanceof WeakMap&&(s=sx),this._stack.push(new s(e,t,i,this._hasOnValidate))}update(e,t,i){this._stack[this._stack.length-1].update(e,t,i)}preferredThisArg(e,t,i){const{name:s}=e,r=bs.isHandledMethod(i,s);return this._stack[this._stack.length-1].preferredThisArg(r,s,t,i)}isChanged(e,t,i){return this._stack[this._stack.length-1].isChanged(e,t,i)}undo(e){this._previousClone!==void 0&&this._previousClone.undo(e)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}}const rx={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},vd=(n,e,t={})=>{t={...rx,...t};const i=Symbol("ProxyTarget"),{equals:s,isShallow:r,ignoreDetached:o,details:a}=t,l=new Zv(s),h=typeof t.onValidate=="function",c=new bs(h),u=(y,x,w,b,E)=>!h||c.isCloning||t.onValidate(Ti.concat(l.getPath(y),x),w,b,E)===!0,d=(y,x,w,b)=>{!Mg(l,t,x)&&!(o&&l.isDetached(y,n))&&f(l.getPath(y),x,w,b)},f=(y,x,w,b,E)=>{c.isCloning?c.update(y,x,b):e(Ti.concat(y,x),w,b,E)},g=y=>y&&(y[i]||y),p=(y,x,w,b)=>Hv(y)||w==="constructor"||r&&!bs.isHandledMethod(x,w)||Mg(l,t,w)||l.isGetInvariant(x,w)||o&&l.isDetached(x,n)?y:(b===void 0&&(b=l.getPath(x)),l.getProxy(y,Ti.concat(b,w),m,i)),m={get(y,x,w){if(_d(x)){if(x===i||x===yd)return y;if(x===Xm&&!l.isUnsubscribed&&l.getPath(y).length===0)return l.unsubscribe(),y}const b=cu(y)?Reflect.get(y,x):Reflect.get(y,x,w);return p(b,y,x)},set(y,x,w,b){w=g(w);const E=y[i]||y,C=E[x];if(s(C,w)&&x in y)return!0;const M=u(y,x,w,C);return M&&l.setProperty(E,x,w,b,C)?(d(y,x,y[x],C),!0):!M},defineProperty(y,x,w){if(!l.isSameDescriptor(w,y,x)){const b=y[x];u(y,x,w.value,b)&&l.defineProperty(y,x,w,b)&&d(y,x,w.value,b)}return!0},deleteProperty(y,x){if(!Reflect.has(y,x))return!0;const w=Reflect.get(y,x),b=u(y,x,void 0,w);return b&&l.deleteProperty(y,x,w)?(d(y,x,void 0,w),!0):!b},apply(y,x,w){const b=x[i]||x;if(l.isUnsubscribed)return Reflect.apply(y,b,w);if((a===!1||a!==!0&&!a.includes(y.name))&&bs.isHandledType(b)){let E=Ti.initial(l.getPath(y));const C=bs.isHandledMethod(b,y.name);c.start(b,E,w);let M=Reflect.apply(y,c.preferredThisArg(y,x,b),C?w.map(G=>g(G)):w);const R=c.isChanged(b,s),N=c.stop();if(bs.isHandledType(M)&&C&&(x instanceof Map&&y.name==="get"&&(E=Ti.concat(E,w[0])),M=l.getProxy(M,E,m)),R){const G={name:y.name,args:w,result:M},S=c.isCloning?Ti.initial(E):E,B=c.isCloning?Ti.last(E):"";u(Ti.get(n,S),B,b,N,G)?f(S,B,b,N,G):c.undo(b)}return(x instanceof Map||x instanceof Set)&&Xv(M)?Yv(M,y,x,E,p):M}return Reflect.apply(y,x,w)}},v=l.getProxy(n,t.pathAsArray?[]:"",m);return e=e.bind(v),h&&(t.onValidate=t.onValidate.bind(v)),v};vd.target=n=>n&&n[yd]||n;vd.unsubscribe=n=>n[Xm]||n;var Br,ra,Mi;class an extends In{constructor(t){super(t);se(this,Br,null);se(this,ra,void 0);se(this,Mi,{});_(this,"configManager",null);this.configManager=ns.getInstance(),Ze(this,Br,new Wv),Ze(this,ra,vd(Z(this,Br),(i,s,r,o)=>{this.areEqual(r,s)||(i!=="mouseCoordinates"&&console.log(`${i} has changed.`),this.onChange(i,r,s))})),Object.preventExtensions(Z(this,Br)),this.setDefaultValues()}get state(){return Z(this,ra)}setDefaultValues(){var t;(t=this.configManager)==null||t.loadConfig().then(()=>{var i;this.state&&((i=this.configManager)!=null&&i.Config)&&(this.state.projection=this.configManager.Config.map.srid,this.state.language=this.configManager.Config.languages.defaultLanguage)})}onChange(t,i,s){const r=t.trim();for(const o in Z(this,Mi)){const a=new RegExp("^"+o+"$");if(r.match(a)){const l=r.substring(0,r.lastIndexOf(".")),h=this.getPropertyByPath(this.state,l);h.found||console.warn("Parent object could not be found in the state");const c=Z(this,Mi)[o];for(const u of c)u(i,s,h.object)}}}subscribe(t,i){t in Z(this,Mi)||(Z(this,Mi)[t]=[]),Z(this,Mi)[t].push(i),console.log(`Subscribing to ${t}. ${Z(this,Mi)[t].length} are currently subscribing ${t}.`);const s=this.getPropertyByPath(this.state,t);if(s.found&&!(s.object===null||s.object===void 0||Array.isArray(s.object)&&s.object.length===0||s.object instanceof Object&&Object.keys(s.object).length===0)){const r=t.substring(0,t.lastIndexOf(".")),o=this.getPropertyByPath(this.state,r);i(null,s.object,o)}}unsubscribe(t){for(const i in Z(this,Mi)){const s=Z(this,Mi)[i],r=s.indexOf(t);r!==-1&&(s.splice(r,1),console.log(`Unsubscribing to ${i}. ${Z(this,Mi)[i].length} subscribtions remaining.`))}}getPropertyByPath(t,i){let s=t;if(i.trim()!==""){const r=i.split(".");for(const o of r)if(o in s)s=s[o];else return{found:!1,object:null}}return{found:!0,object:s}}areEqual(t,i){if(typeof t=="number"&&typeof i=="number")return Number.isNaN(t)&&Number.isNaN(i)?!0:t===i;if(typeof t!="object"||typeof i!="object"||t===null||i===null||t===void 0||i===void 0)return t===i;const s=Object.keys(t),r=Object.keys(i);if(s.length!==r.length)return!1;for(const o of s)if(!this.areEqual(t[o],i[o]))return!1;return!0}}Br=new WeakMap,ra=new WeakMap,Mi=new WeakMap;var Sh,ty;class du extends In{constructor(t){super(t);se(this,Sh);_(this,"translations",{});_(this,"loadingLanguagePromise",null);_(this,"configManager");_(this,"stateManager");this.configManager=ns.getInstance(),this.stateManager=an.getInstance()}getTranslation(t){var r,o;const i=((o=(r=this.stateManager)==null?void 0:r.state)==null?void 0:o.language)??"en",s=this.translations[i][t];return s??t}translate(t){this.stateManager.state&&this.stateManager.state.language&&ae(this,Sh,ty).call(this,this.stateManager.state.language).then(()=>{t.querySelectorAll("[i18n]").forEach(s=>{const r=s.getAttribute("i18n");if(r){const o=this.getTranslation(r);s.hasAttribute("placeholder")?s.setAttribute("placeholder",o):s.innerHTML=o}})})}}Sh=new WeakSet,ty=async function(t){return this.loadingLanguagePromise?this.loadingLanguagePromise:t in this.translations?Promise.resolve(this.translations[t]):(this.loadingLanguagePromise=this.configManager.loadConfig().then(async()=>{if(this.configManager.Config&&this.configManager.Config.languages){const i=this.configManager.Config.languages[t],r=await(await fetch(i)).json();return this.translations[t]=r[t],this.loadingLanguagePromise=null,this.translations[t]}else throw new Error("No languages found in config.json")}),this.loadingLanguagePromise)};class ox extends Map{set(e,t){return super.set(e,t),t}}class xd extends WeakMap{set(e,t){return super.set(e,t),t}}/*! (c) Andrea Giammarchi - ISC */const ax=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,lx=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/?)>/g,hx=/([^\s\\>"'=]+)\s*=\s*(['"]?)\x01/g,cx=/[\x01\x02]/g,ux=(n,e,t)=>{let i=0;return n.join("").trim().replace(lx,(s,r,o,a)=>{let l=r+o.replace(hx,"=$2$1").trimEnd();return a.length&&(l+=t||ax.test(r)?" /":"></"+r),"<"+l+">"}).replace(cx,s=>s===""?"<!--"+e+i+++"-->":e+i++)},dx=1,iy=111,fx=({firstChild:n,lastChild:e})=>{const t=document.createRange();return t.setStartAfter(n),t.setEndAfter(e),t.deleteContents(),n},gx=(n,e)=>n.nodeType===iy?1/e<0?e?fx(n):n.lastChild:e?n.valueOf():n.firstChild:n,px=n=>{const{firstChild:e,lastChild:t}=n;if(e===t)return t||n;const{childNodes:i}=n,s=[...i];return{ELEMENT_NODE:dx,nodeType:iy,firstChild:e,lastChild:t,valueOf(){return i.length!==s.length&&n.append(...s),n}}},{isArray:mx}=Array,yx=n=>e=>{for(const t in e){const i=t==="role"?t:`aria-${t}`,s=e[t];s==null?n.removeAttribute(i):n.setAttribute(i,s)}},wd=n=>n==null?n:n.valueOf(),_x=(n,e)=>{let t,i=!0;const s=document.createAttributeNS(null,e);return r=>{const o=wd(r);t!==o&&((t=o)==null?i||(n.removeAttributeNode(s),i=!0):(s.value=o,i&&(n.setAttributeNodeNS(s),i=!1)))}},vx=(n,e,t)=>i=>{const s=!!wd(i);t!==s&&((t=s)?n.setAttribute(e,""):n.removeAttribute(e))},xx=({dataset:n})=>e=>{for(const t in e){const i=e[t];i==null?delete n[t]:n[t]=i}},Lg=(n,e)=>{let t,i,s=e.slice(2);return!(e in n)&&(i=e.toLowerCase())in n&&(s=i.slice(2)),r=>{const o=mx(r)?r:[r,!1];t!==o[0]&&(t&&n.removeEventListener(s,t,o[1]),(t=o[0])&&n.addEventListener(s,t,o[1]))}},wx=n=>{let e;return t=>{e!==t&&(e=t,typeof t=="function"?t(n):t.current=n)}},bx=(n,e)=>e==="dataset"?xx(n):t=>{n[e]=t},Ex=n=>{let e;return t=>{const i=wd(t);e!=i&&(e=i,n.textContent=i??"")}},Cx=(n,e,t,i,s)=>{const r=t.length;let o=e.length,a=r,l=0,h=0,c=null;for(;l<o||h<a;)if(o===l){const u=a<r?h?i(t[h-1],-0).nextSibling:i(t[a-h],0):s;for(;h<a;)n.insertBefore(i(t[h++],1),u)}else if(a===h)for(;l<o;)(!c||!c.has(e[l]))&&n.removeChild(i(e[l],-1)),l++;else if(e[l]===t[h])l++,h++;else if(e[o-1]===t[a-1])o--,a--;else if(e[l]===t[a-1]&&t[h]===e[o-1]){const u=i(e[--o],-1).nextSibling;n.insertBefore(i(t[h++],1),i(e[l++],-1).nextSibling),n.insertBefore(i(t[--a],1),u),e[o]=t[a]}else{if(!c){c=new Map;let u=h;for(;u<a;)c.set(t[u],u++)}if(c.has(e[l])){const u=c.get(e[l]);if(h<u&&u<a){let d=l,f=1;for(;++d<o&&d<a&&c.get(e[d])===u+f;)f++;if(f>u-h){const g=i(e[l],0);for(;h<u;)n.insertBefore(i(t[h++],1),g)}else n.replaceChild(i(t[h++],1),i(e[l++],-1))}else l++}else n.removeChild(i(e[l++],-1))}return t},{isArray:ny,prototype:Mx}=Array,{indexOf:Sx}=Mx,{createDocumentFragment:Tx,createElement:Rx,createElementNS:Lx,createTextNode:Ix,createTreeWalker:Px,importNode:Ax}=new Proxy({},{get:(n,e)=>document[e].bind(document)}),Fx=n=>{const e=Rx("template");return e.innerHTML=n,e.content};let Ya;const Ox=n=>{Ya||(Ya=Lx("http://www.w3.org/2000/svg","svg")),Ya.innerHTML=n;const e=Tx();return e.append(...Ya.childNodes),e},kx=(n,e)=>e?Ox(n):Fx(n),Nx=({childNodes:n},e)=>n[e],Co=(n,e,t)=>Cx(n.parentNode,e,t,gx,n),Dx=n=>{let e,t,i=[];const s=r=>{switch(typeof r){case"string":case"number":case"boolean":e!==r&&(e=r,t||(t=Ix("")),t.data=r,i=Co(n,i,[t]));break;case"object":case"undefined":if(r==null){e!=r&&(e=r,i=Co(n,i,[]));break}if(ny(r)){e=r,r.length===0?i=Co(n,i,[]):typeof r[0]=="object"?i=Co(n,i,r):s(String(r));break}if(e!==r)if("ELEMENT_NODE"in r)e=r,i=Co(n,i,r.nodeType===11?[...r.childNodes]:[r]);else{const o=r.valueOf();o!==r&&s(o)}break;case"function":s(r(n));break}};return s},Gx=(n,e)=>{switch(e[0]){case"?":return vx(n,e.slice(1),!1);case".":return bx(n,e.slice(1));case"@":return Lg(n,"on"+e.slice(1));case"o":if(e[1]==="n")return Lg(n,e)}switch(e){case"ref":return wx(n);case"aria":return yx(n)}return _x(n,e)};function zx(n){const{type:e,path:t}=n,i=t.reduceRight(Nx,this);return e==="node"?Dx(i):e==="attr"?Gx(i,n.name):Ex(i)}const _c=n=>{const e=[];let{parentNode:t}=n;for(;t;)e.push(Sx.call(t.childNodes,n)),n=t,{parentNode:t}=n;return e},Mo="isÂµ",Ig=new xd,Bx=/^(?:textarea|script|style|title|plaintext|xmp)$/,Bo=()=>({stack:[],entry:null,wire:null}),Ux=(n,e)=>{const{content:t,updates:i}=$x(n,e);return{type:n,template:e,content:t,updates:i,wire:null}},jx=(n,e)=>{const t=n==="svg",i=ux(e,Mo,t),s=kx(i,t),r=Px(s,129),o=[],a=e.length-1;let l=0,h=`${Mo}${l}`;for(;l<a;){const c=r.nextNode();if(!c)throw`bad template: ${i}`;if(c.nodeType===8)c.data===h&&(o.push({type:"node",path:_c(c)}),h=`${Mo}${++l}`);else{for(;c.hasAttribute(h);)o.push({type:"attr",path:_c(c),name:c.getAttribute(h)}),c.removeAttribute(h),h=`${Mo}${++l}`;Bx.test(c.localName)&&c.textContent.trim()===`<!--${h}-->`&&(c.textContent="",o.push({type:"text",path:_c(c)}),h=`${Mo}${++l}`)}}return{content:s,nodes:o}},$x=(n,e)=>{const{content:t,nodes:i}=Ig.get(e)||Ig.set(e,jx(n,e)),s=Ax(t,!0),r=i.map(zx,s);return{content:s,updates:r}},kl=(n,{type:e,template:t,values:i})=>{const s=sy(n,i);let{entry:r}=n;(!r||r.template!==t||r.type!==e)&&(n.entry=r=Ux(e,t));const{content:o,updates:a,wire:l}=r;for(let h=0;h<s;h++)a[h](i[h]);return l||(r.wire=px(o))},sy=({stack:n},e)=>{const{length:t}=e;for(let i=0;i<t;i++){const s=e[i];s instanceof Nl?e[i]=kl(n[i]||(n[i]=Bo()),s):ny(s)?sy(n[i]||(n[i]=Bo()),s):n[i]=null}return t<n.length&&n.splice(t),t};class Nl{constructor(e,t,i){this.type=e,this.template=t,this.values=i}}const ry=n=>{const e=new xd,t=i=>(s,...r)=>kl(i,{type:n,template:s,values:r});return Object.assign((i,...s)=>new Nl(n,i,s),{for(i,s){const r=e.get(i)||e.set(i,new ox);return r.get(s)||r.set(s,t(Bo()))},node:(i,...s)=>kl(Bo(),new Nl(n,i,s)).valueOf()})},Pg=new xd,qx=(n,e)=>{const t=typeof e=="function"?e():e,i=Pg.get(n)||Pg.set(n,Bo()),s=t instanceof Nl?kl(i,t):t;return s!==i.wire&&(i.wire=s,n.replaceChildren(s.valueOf())),n},xe=ry("html");ry("svg");class ot extends HTMLElement{constructor(t){super();_(this,"templateUrl",null);_(this,"styleUrl",null);_(this,"template");_(this,"component");_(this,"shadow");_(this,"activeTooltips",[]);_(this,"messageManager");_(this,"configManager");_(this,"stateManager");this.component=t,this.configManager=ns.getInstance(),this.messageManager=md.getInstance(),this.stateManager=an.getInstance(),this.shadow=this.attachShadow({mode:"open"}),this.stateManager.subscribe("language",(i,s)=>this.girafeTranslate())}get state(){return this.stateManager.state}async loadConfig(){await this.configManager.loadConfig()}girafeTranslate(){du.getInstance().translate(this.shadow)}isNullOrUndefined(t){return t==null}isNullOrUndefinedOrBlank(t){return t==null||t===""}delayed(t,i){new MutationObserver((r,o)=>{t()&&(i(),o.disconnect())}).observe(this.shadow,{childList:!0,subtree:!0})}getParentOfType(t,i){if(i===null||i.nodeName===t)return i;let s=null;return i instanceof ShadowRoot?s=i.host:s=i.parentNode,this.getParentOfType(t,s)}activateTooltips(t,i,s){for(const o of this.activeTooltips)o.destroy();this.activeTooltips=[],Array.from(this.shadow.querySelectorAll("[tip]")).forEach(o=>{if(o.getAttribute("tip")!==""){let l=o.getAttribute("tip-placement")??s;const h=zo(o,{arrow:t,delay:i,placement:l,content:o.getAttribute("tip")});this.activeTooltips.push(h)}})}render(){qx(this.shadow,this.template)}hide(){this.style.display="none"}}var Th,oy,oa,fu,Rh,ay,Lh,ly,Ih,hy,Ph,cy;class jh extends ot{constructor(t){super(t);se(this,Th);se(this,oa);se(this,Rh);se(this,Lh);se(this,Ih);se(this,Ph);_(this,"panel");_(this,"panelRect");_(this,"gutter");_(this,"hideButton");_(this,"closeButton");_(this,"dock");_(this,"prevX",0);_(this,"prevY",0);_(this,"toggleWidth");_(this,"lastWidth",0);_(this,"hideWidth",0);this.dock=this.getAttribute("dock")??"right"}get host(){return this.shadow.getRootNode().host}render(){super.render(),this.makeResizable()}makeResizable(){this.panel=this.shadow.querySelector("#panel"),this.gutter=this.shadow.querySelector("#gutter"),this.gutter.onmousedown=t=>ae(this,Th,oy).call(this,t),this.gutter.ondblclick=()=>ae(this,oa,fu).call(this),this.hideButton=this.shadow.getElementById("hide"),this.hideButton&&(this.hideButton.onclick=()=>ae(this,oa,fu).call(this)),this.closeButton=this.shadow.getElementById("close"),this.closeButton&&(this.closeButton.onclick=()=>this.closePanel())}closePanel(){throw new Error("This function must be overriden to close the associated panel")}}Th=new WeakSet,oy=function(t){t.preventDefault(),document.onmousemove=i=>ae(this,Ih,hy).call(this,i),document.onmouseup=()=>ae(this,Ph,cy).call(this),this.prevX=t.x,this.prevY=t.y,this.panelRect=this.panel.getBoundingClientRect(),this.hideButton&&(this.hideWidth=this.hideButton.getBoundingClientRect().width)},oa=new WeakSet,fu=function(){this.dock==="left"||this.dock==="right"?ae(this,Rh,ay).call(this):ae(this,Lh,ly).call(this)},Rh=new WeakSet,ay=function(){if(!this.panel||!this.gutter)throw new Error("GirafeResizableElement.makeResizable() must be called before togglePanelVertically()");this.toggleWidth=this.gutter.getBoundingClientRect().width;const t=this.panel.getBoundingClientRect().width;t<=this.toggleWidth?(this.panel.style.width=this.lastWidth+"px",this.host.style.width=this.lastWidth+"px",this.panel.style.minWidth="",this.host.style.minWidth="",this.hideButton&&(this.hideButton.classList.remove("closed"),this.dock==="left"?this.hideButton.style.left=this.panel.getBoundingClientRect().width+"px":this.dock==="right"&&(this.hideButton.style.right=this.panel.getBoundingClientRect().width+"px"))):(this.lastWidth=t,this.panel.style.width=this.toggleWidth+"px",this.host.style.width=this.toggleWidth+"px",this.panel.style.minWidth="0",this.panel.style.overflow="hidden",this.host.style.minWidth="0",this.hideButton&&this.hideButton.classList.add("closed"))},Lh=new WeakSet,ly=function(){if(!this.panel||!this.gutter)throw new Error("GirafeResizableElement.makeResizable() must be called before togglePanelHorizontally()");this.toggleWidth=this.gutter.getBoundingClientRect().height;const t=this.panel.getBoundingClientRect().height;t<=this.toggleWidth?(this.panel.style.height=this.lastWidth+"px",this.host.style.height=this.lastWidth+"px",this.panel.style.minHeight="",this.host.style.minHeight="",this.hideButton&&(this.hideButton.classList.remove("closed"),this.dock==="bottom"&&(this.hideButton.style.bottom=this.panel.getBoundingClientRect().height+"px"))):(this.lastWidth=t,this.panel.style.height=this.toggleWidth+"px",this.host.style.height=this.toggleWidth+"px",this.panel.style.minHeight="0",this.panel.style.overflow="hidden",this.host.style.minHeight="0",this.hideButton&&this.hideButton.classList.add("closed"))},Ih=new WeakSet,hy=function(t){if(!this.panel||!this.panelRect)throw new Error("GirafeResizableElement.makeResizable() must be called before this mousemove()");t.preventDefault();const i=this.prevX-t.x,s=this.prevY-t.y;if(this.dock==="left"){let r=this.panelRect.width-i;this.hideButton&&(this.hideButton.style.left=this.panel.getBoundingClientRect().width+"px"),this.closeButton&&(this.closeButton.style.left=this.panel.getBoundingClientRect().width+"px"),this.panel.style.width=r+"px",this.host.style.width=r+"px"}else if(this.dock==="right"){let r=this.panelRect.width+i;this.hideButton&&(this.hideButton.style.right=this.panel.getBoundingClientRect().width+"px"),this.closeButton&&(this.closeButton.style.right=this.panel.getBoundingClientRect().width+"px"),this.panel.style.width=r+"px",this.host.style.width=r+"px"}else if(this.dock==="bottom"){let r=this.panelRect.height+s;this.panel.style.height=r+"px",this.host.style.height=r+"px"}this.hideButton&&this.hideButton.classList.remove("closed")},Ph=new WeakSet,cy=function(){document.onmouseup=null,document.onmousemove=null};let Za;const Vx=new Uint8Array(16);function Wx(){if(!Za&&(Za=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Za))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Za(Vx)}const Et=[];for(let n=0;n<256;++n)Et.push((n+256).toString(16).slice(1));function Hx(n,e=0){return Et[n[e+0]]+Et[n[e+1]]+Et[n[e+2]]+Et[n[e+3]]+"-"+Et[n[e+4]]+Et[n[e+5]]+"-"+Et[n[e+6]]+Et[n[e+7]]+"-"+Et[n[e+8]]+Et[n[e+9]]+"-"+Et[n[e+10]]+Et[n[e+11]]+Et[n[e+12]]+Et[n[e+13]]+Et[n[e+14]]+Et[n[e+15]]}const Xx=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ag={randomUUID:Xx};function uy(n,e,t){if(Ag.randomUUID&&!e&&!n)return Ag.randomUUID();n=n||{};const i=n.random||(n.rng||Wx)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=i[s];return e}return Hx(i)}let dy=class{constructor(e,t,i,s){_(this,"id");_(this,"treeItemId");_(this,"name");_(this,"order");_(this,"isDefaultChecked");_(this,"hasError",!1);_(this,"errorMessage",null);_(this,"parent",null);this.id=e,this.treeItemId=uy(),this.name=t,this.order=i,this.isDefaultChecked=s}};class Qt extends dy{constructor(t,i){var o,a,l;const s=((o=t.metadata)==null?void 0:o.isChecked)??!1;super(t.id,t.name,i,s);_(this,"isExclusiveGroup");_(this,"isExpanded");_(this,"activeState","off");_(this,"children",[]);const r=((a=t.metadata)==null?void 0:a.isExpanded)??!1;this.isExpanded=r,this.isExclusiveGroup=((l=t.metadata)==null?void 0:l.exclusiveGroup)??!1}get active(){return this.activeState==="on"}get inactive(){return this.activeState==="off"}get semiActive(){return this.activeState==="semi"}}let En=class extends dy{constructor(t,i){var r;const s=((r=t.metadata)==null?void 0:r.isChecked)??!1;super(t.id,t.name,i,s);_(this,"activeState","off");_(this,"opacity",1);_(this,"order",0);_(this,"basemap",!1)}get isTransparent(){return this.opacity!==1}get active(){return this.activeState==="on"}get inactive(){return this.activeState==="off"}};class ht extends En{constructor(t,i,s,r,o){super(t,o);_(this,"serverName");_(this,"url");_(this,"urlWfs");_(this,"imageType");_(this,"minResolution");_(this,"maxResolution");_(this,"layers",null);_(this,"legend");_(this,"iconUrl");_(this,"legendRule");_(this,"legendImage");_(this,"isLegendExpanded");_(this,"wasLegendExpanded");_(this,"queryable",!1);_(this,"queryLayers",null);_(this,"filter",null);this.serverName=i,this.url=s,this.urlWfs=r,this.imageType=t.imageType,this.minResolution=t.minResolutionHint,this.maxResolution=t.maxResolutionHint,this.legend=t.metadata.legend,this.iconUrl=t.metadata.iconUrl,this.legendRule=t.metadata.legendRule,this.legendImage=t.metadata.legendImage,this.isLegendExpanded=t.metadata.isLegendExpanded??!1,this.wasLegendExpanded=this.isLegendExpanded,t.childLayers&&(this.layers=t.layers,t.childLayers.length===0?console.warn(`WMS Layer ${t.name} has no defined child-layer`):(this.queryable=t.childLayers[0].queryable,this.queryLayers=this.queryable?t.childLayers.map(a=>a.name).join(","):"",this.queryable&&((!this.queryLayers||this.queryLayers.length==0)&&(this.hasError=!0,this.errorMessage="This layer is defined as queryable but no layer to query has been defined.",this.queryable=!1),(!this.urlWfs||this.urlWfs.length==0)&&(this.hasError=!0,this.errorMessage="This layer is defined as queryable but no Url for Wfs has been defined.",this.queryable=!1))))}hasRestrictedResolution(){return this.minResolution&&this.minResolution!==0||this.maxResolution&&this.maxResolution!==999999999}get hasFilter(){return this.filter!==null&&this.filter!==void 0&&this.filter!==""}get serverUniqueQueryId(){return this.serverName+this.imageType}}var aa,gu,la,pu,Ah,fy,ha,mu,Fh,gy,Oh,py,ca,yu;class ya extends In{constructor(t){super(t);se(this,aa);se(this,la);se(this,Ah);se(this,ha);se(this,Fh);se(this,Oh);se(this,ca);_(this,"configManager");_(this,"stateManager");_(this,"hideLegendWhenLayerIsDeactivated",!1);this.configManager=ns.getInstance(),this.stateManager=an.getInstance(),this.configManager.loadConfig().then(()=>{this.hideLegendWhenLayerIsDeactivated=this.configManager.Config.treeview.hideLegendWhenLayerIsDeactivated??!1}),this.stateManager.subscribe("layers.layersList..*.activeState",(i,s,r)=>this.onLayerToggled(r))}get state(){return this.stateManager.state}getTreeItem(t){const i=ae(this,aa,gu).call(this,this.state.layers.layersList,t);if(i)return i;throw new Error(`BaseLayer ${t} not found !`)}activateIfDefaultChecked(t){t.isDefaultChecked&&this.toggle(t,"on")}initializeLegends(t){t.inactive&&this.hideLegendWhenLayerIsDeactivated&&(t.isLegendExpanded=!1)}toggle(t,i){t instanceof Qt?this.toggleGroup(t,i):t instanceof En&&this.toggleLayer(t,i)}onLayerToggled(t){t instanceof Qt?(ae(this,ha,mu).call(this,t),ae(this,la,pu).call(this,t),t.activeState!=="semi"&&ae(this,Ah,fy).call(this,t,t.activeState)):t instanceof En&&(t instanceof ht&&this.hideLegendWhenLayerIsDeactivated&&(t.active?t.isLegendExpanded=t.wasLegendExpanded:(t.wasLegendExpanded=t.isLegendExpanded,t.isLegendExpanded=!1)),ae(this,ha,mu).call(this,t),ae(this,la,pu).call(this,t))}toggleLayer(t,i){if(!(t instanceof En))throw new Error("This method should only be called on leafs layers, not on groups");let s;i?s=i:t.activeState==="off"?s="on":s="off",t.activeState!=s&&(console.log(`Setting Layer ${t.name} to ${s}`),t.activeState=s)}toggleGroup(t,i){let s;i?s=i:t.activeState==="off"?s="on":s="off",t.activeState!=s&&(console.log(`Setting Group ${t.name} to ${s}`),t.activeState=s)}setError(t,i){t.hasError=!0,t.errorMessage=i,console.warn(t.errorMessage)}unsetError(t){t.hasError=!1,t.errorMessage=null}}aa=new WeakSet,gu=function(t,i){for(const s of t){if(s.treeItemId===i)return s;if(s instanceof Qt){const r=ae(this,aa,gu).call(this,s.children,i);if(r)return r}}return null},la=new WeakSet,pu=function(t){t.parent&&(t.parent.isExclusiveGroup?ae(this,ca,yu).call(this,t.parent)?this.toggleGroup(t.parent,"on"):this.toggleGroup(t.parent,"off"):ae(this,Fh,gy).call(this,t.parent)?this.toggleGroup(t.parent,"on"):ae(this,Oh,py).call(this,t.parent)?this.toggleGroup(t.parent,"off"):this.toggleGroup(t.parent,"semi"))},Ah=new WeakSet,fy=function(t,i){if(t.active&&t.isExclusiveGroup&&t.children.length>=1)ae(this,ca,yu).call(this,t)||this.toggle(t.children[0],i);else for(const s of t.children)this.toggle(s,i)},ha=new WeakSet,mu=function(t){if((t.active||t instanceof Qt&&t.semiActive)&&t.parent!=null&&t.parent.isExclusiveGroup)for(const i of t.parent.children){const s=this.getTreeItem(i.treeItemId);s.treeItemId!==t.treeItemId&&(s.active||s instanceof Qt&&s.semiActive)&&this.toggle(s,"off")}},Fh=new WeakSet,gy=function(t){let i=!0;for(const s of t.children)s.active||(i=!1);return i},Oh=new WeakSet,py=function(t){let i=!0;for(const s of t.children)s.inactive||(i=!1);return i},ca=new WeakSet,yu=function(t){for(const i of t.children)if(i.active||i instanceof Qt&&i.semiActive)return!0;return!1};var ua,_u,da,vu;class Yx extends jh{constructor(){super("treeview");se(this,ua);se(this,da);_(this,"template",()=>xe`<style>
:host {
  min-width: 18rem;
}

::-webkit-scrollbar {
  width: 5px;
}

::-webkit-scrollbar-thumb {
  background: #999;
}

.hidden {
  display: none;
}

.panel {
  min-width: 18rem;
  position: absolute;
  top : 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
}

.gutter {
  border: none;
  width: 5px;
  height: 100%;
  background: var(--bkg-color);
  position: absolute;
  top: 0;
  right: 0;
  cursor: col-resize;
}

.hide {
  border: solid 1px #999;
  border-left: none;
  color: var(--text-color-grad2);
  padding: 0.7rem 0.5rem 0.7rem 0;
  border-radius: 0 10px 10px 0;
  width: 0.8rem;
  height: 2rem;
  line-height: 2rem;
  position: fixed;
  top: 5.8rem;
  left: 25rem;
  background-color: var(--bkg-color);
  cursor: pointer;
}

.hide i:before {
  content: "\uf104";
}

.hide.closed {
  left: 5px !important;
}

.hide.closed i:before {
  content: "\uf105";
}

.hide:hover {
  border-color: #000;
  color: var(--text-color);
}

.menu {
  border-top: solid 1px #bbb;
  background-color: var(--bkg-color);
  height: 2.3rem;
  position: absolute;
  bottom: 0;
  left: 0;
  right: 6px;
  z-index: 1;
  font-size: 0;
}

.treeview-list {
  position: absolute;
  top : 0;
  left: 0;
  right: 5px;
  bottom: 2.3rem;
  background: var(--bkg-color);
  padding-left : 1rem;
  padding-top : 1rem;
  padding-bottom : 1.5rem;
  padding-right : 0.7rem;
  margin: 0;
  margin-top: 0.5rem;
  overflow-y: auto;
  overflow-x: hidden;
  scrollbar-width: thin;
}

.menu i {
  margin-top: 1rem;
  color: var(--text-color-grad1);
  margin-right: 0.2rem;
  width: 3rem;
}

#menu i.selected {
  color: var(--text-color);
}

.selectable {
  cursor: pointer;
}

.selectable:hover {
  color: #000;
}

girafe-basemap {
  position: absolute;
  right: 0;
  top: 0;
}

</style>
<link rel="stylesheet" href="lib/font-gis/css/font-gis.css" />
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />
<link rel="stylesheet" href="lib/tippy.js/tippy.min.css" />

<div id="panel" class="panel">
  <div class="menu">
    <girafe-button icon-style="${this.state.treeview.advanced?"fa-sm fa-solid fa-gear selectable":"fa-sm fa-solid fa-gears selectable"}" 
                   size="small" tip="Advanced options" tip-placement="top" class="options transparent"
                   onclick="${()=>this.state.treeview.advanced=!this.state.treeview.advanced}"></girafe-button>

    <girafe-button icon-style="${this.areAllLegendExpanded?"fa-sm fa-solid fa-bars selectable fa-rotate-270":"fa-sm fa-solid fa-bars selectable"}" 
                   size="small" tip="Toggle all legends" tip-placement="top" class="togglelegends transparent"
                   onclick="${()=>this.toggleAllLegends()}"></girafe-button>
    
    <girafe-button icon-style="${this.isAllExpanded?"fa-sm fa-solid fa-caret-right selectable":"fa-sm fa-solid fa-caret-down selectable"}" 
                   size="small" tip="Expand / Collapse all" tip-placement="top" class="expandall transparent"
                   onclick="${()=>this.expandAll()}"></girafe-button>
    
    <girafe-button icon-style="fa-sm fa-solid fa-trash selectable" 
                   size="small" tip="Remove all layers" tip-placement="top" class="delete transparent"
                   onclick="${()=>this.removeAll()}"></girafe-button>

    <girafe-button icon-style="fa-sm fa-solid fa-left-right selectable" size="small" tip="Hide Swiper" tip-placement="top"
                   class="${this.isSwiperVisible?"swipe transparent":"swipe hidden"}"
                   onclick="${()=>this.hideSwipe()}"></girafe-button>

    <girafe-basemap tip="Select basemap"></girafe-basemap>
  </div>
  <div class="treeview-list">
    ${this.state.layers.layersList.map(t=>t instanceof Qt?xe.for(t)`<girafe-tree-view-group groupid="${t.treeItemId}"></girafe-tree-view-group>`:xe`<girafe-tree-view-item layerid="${t.treeItemId}"></girafe-tree-view-item>`)}
  </div>
  <div id="gutter" class="gutter"></div>
  <div id="hide" class="hide">
    <i class="fa-solid"></i>
  </div>
</div>
`);_(this,"layerManager");_(this,"isAllExpanded",!1);_(this,"areAllLegendExpanded",!0);this.layerManager=ya.getInstance()}get isSwiperVisible(){return this.state.layers.swipedLayers.left.length>0||this.state.layers.swipedLayers.right.length>0}registerEvents(){this.stateManager.subscribe("selectedTheme",()=>this.onThemeChanged()),this.stateManager.subscribe("layers.layersList",()=>super.render()),this.stateManager.subscribe("layers.swipedLayers",()=>super.render()),this.stateManager.subscribe("treeview.advanced",()=>super.render())}onThemeChanged(){this.state.selectedTheme!=null?(this.state.layers.layersList=[...this.state.selectedTheme.layersTree],this.activateDefaultLayers(this.state.layers.layersList)):this.state.layers.layersList=[]}activateDefaultLayers(t){for(const i of t)this.layerManager.activateIfDefaultChecked(i),i instanceof ht&&this.layerManager.initializeLegends(i),i instanceof Qt&&this.activateDefaultLayers(i.children)}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}render(){super.render(),this.activateTooltips(!1,[800,0],"right")}expandAll(){this.isAllExpanded=!this.isAllExpanded,ae(this,ua,_u).call(this,this.state.layers.layersList),super.render()}toggleAllLegends(){this.areAllLegendExpanded=!this.areAllLegendExpanded,ae(this,da,vu).call(this,this.state.layers.layersList),super.render()}removeAll(){for(const t of this.stateManager.state.layers.layersList)this.layerManager.toggle(t,"off");this.hideSwipe(),this.state.layers.layersList=[],this.state.selectedTheme=null}hideSwipe(){this.state.layers.swipedLayers={left:[],right:[]},super.render()}}ua=new WeakSet,_u=function(t){for(const i of t)i instanceof Qt&&(i.isExpanded=this.isAllExpanded,ae(this,ua,_u).call(this,i.children))},da=new WeakSet,vu=function(t){for(const i of t)i instanceof ht&&i.legend?i.isLegendExpanded=this.areAllLegendExpanded:i instanceof Qt&&ae(this,da,vu).call(this,i.children)};customElements.define("girafe-tree-view",Yx);class Zx extends ot{constructor(t){super("treeviewgroup");_(this,"template",()=>xe`<style>
.group {
  color: #999;
  border-top: solid 1px #ddd;
  line-height: 1.3rem;
  display: flex;
  flex-wrap: wrap;
}

.hidden {
  display: none;
}

.invisible {
  visibility: hidden;
}

.selectable {
  cursor: pointer;
}

.selectable:hover {
  color: var(--text-color);
}

.selected {
  cursor: pointer;
  color: var(--text-color);
}

i {
  width: 0.8rem;
  text-align:center;
  min-width: 0;
}

.expand, .collapse {
  order: 1;
  padding-top: 0.15rem;
}

.circle-on, .circle-off, .circle-semi {
  order: 2;
  padding-top: 0.20rem;
  margin-left: 0.2rem;
  margin-right: 0.1rem;
  cursor: pointer;
}

.error {
  order: 3;
  color: #b00;
}

.text {
  order: 4;
  display: inline-block;
  margin: 0.2rem;
  flex-grow: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space:nowrap;
  width: 0;
}

.delete {
  order: 5;
  padding-top: 0.45rem;
}

.sublayers {
  padding-left: 1rem;
  flex-basis: 100%;
  order: 10;
}

</style>
<link rel="stylesheet" href="lib/font-gis/css/font-gis.css" />
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />
<link rel="stylesheet" href="lib/tippy.js/tippy.min.css" />

<div class="group">
  
  <!-- Caret -->
  <div class="${this.group.isExpanded?"expand hidden":"expand"}" onclick="${()=>this.group.isExpanded=!0}">
    <i class="fa fa-caret-right selectable expand"></i>
  </div>
  <div class="${this.group.isExpanded?"collapse":"collapse hidden"}" onclick="${()=>this.group.isExpanded=!1}">
    <i class="fa fa-caret-down selectable expand"></i>
  </div>

  <!-- Bullet or Checkbox -->
  <div class="${this.group.activeState==="off"?"circle-off selectable":"circle-off hidden"}"
       onclick="${()=>this.toggle()}">
    <i class="${this.configManager.Config.treeview.useCheckboxes?"fa-lg fa-regular fa-square selbox":"fa-xs fa-regular fa-circle selcircle"}"></i>
  </div>
  <div class="${this.group.activeState==="on"?"circle-on selected":"circle-on hidden"}" 
       onclick="${()=>this.toggle()}">
    <i class="${this.configManager.Config.treeview.useCheckboxes?"fa-lg fa-solid fa-square-check selbox":"fa-xs fa-solid fa-circle selcircle"}"></i>
  </div>
  <div class="${this.group.activeState==="semi"?"circle-semi selected":"circle-semi hidden"}" 
       onclick="${()=>this.toggle("on")}">
    <i class="${this.configManager.Config.treeview.useCheckboxes?"fa-lg fa-regular fa-square-check selbox":"fa-xs fa-solid fa-circle-half-stroke selcircle"}"></i>
  </div>

  <!-- Error icon -->
  <i class="${this.group.hasError?"fa-solid fa-circle-exclamation tool error":"error hidden"}"
     tip="${this.group.errorMessage}"></i>

  <!-- Label -->
  <span i18n="${this.group.name}" 
        class="${this.group.activeState==="on"||this.group.activeState==="semi"?"text selected":"text selectable"}" 
        onclick="${()=>this.toggle()}">${this.group.name}</span>

  <i class="fa fa-solid fa-xmark tool delete selectable"  tip="Remove this group" onclick="${()=>this.deleteGroup()}"></i>

  <!-- Sub layers -->
  <div class="${this.group.isExpanded?"sublayers":"sublayers hidden"}">
      ${(this.group.children??[]).map(t=>t instanceof Qt?xe`<girafe-tree-view-group groupid="${t.treeItemId}"></girafe-tree-view-group>`:xe`<girafe-tree-view-item layerid="${t.treeItemId}"></girafe-tree-view-item>`)}
  </div>

</div>
`);_(this,"layerManager");_(this,"group");this.layerManager=ya.getInstance(),this.group=t}render(){const t=this.getAttribute("groupid");t&&(this.group=this.layerManager.getTreeItem(t)),super.render(),this.activateTooltips(!1,[800,0],"right")}registerEvents(){this.stateManager.subscribe("layers.layersList..*.isExpanded",(t,i,s)=>this.refreshRender(s)),this.stateManager.subscribe("layers.layersList..*.activeState",(t,i,s)=>this.refreshRender(s))}refreshRender(t){t===this.group&&super.render()}toggle(t){this.layerManager.toggleGroup(this.group,t)}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}deactivateGroup(t){if(t.activeState="off",t instanceof Qt)for(const i of t.children)this.deactivateGroup(i)}deleteGroup(){this.deactivateGroup(this.group);const t=this.state.layers.layersList.findIndex(i=>i.id===this.group.id);t>=0?this.state.layers.layersList.splice(t,1):console.log("cannot delete this group. Probably a subgroup, this is not managed yet.")}}customElements.define("girafe-tree-view-group",Zx);class Kx{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const _i=Kx,K={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"},re={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class Jx{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}const bd=Jx;function Qx(n,e,t){let i,s;t=t||rs;let r=0,o=n.length,a=!1;for(;r<o;)i=r+(o-r>>1),s=+t(n[i],e),s<0?r=i+1:(o=i,a=!s);return a?r:~r}function rs(n,e){return n>e?1:n<e?-1:0}function $h(n,e,t){if(n[0]<=e)return 0;const i=n.length;if(e<=n[i-1])return i-1;if(typeof t=="function"){for(let s=1;s<i;++s){const r=n[s];if(r===e)return s;if(r<e)return t(e,n[s-1],r)>0?s-1:s}return i-1}if(t>0){for(let s=1;s<i;++s)if(n[s]<e)return s-1;return i-1}if(t<0){for(let s=1;s<i;++s)if(n[s]<=e)return s;return i-1}for(let s=1;s<i;++s){if(n[s]==e)return s;if(n[s]<e)return n[s-1]-e<e-n[s]?s-1:s}return i-1}function e1(n,e,t){for(;e<t;){const i=n[e];n[e]=n[t],n[t]=i,++e,--t}}function kt(n,e){const t=Array.isArray(e)?e:[e],i=t.length;for(let s=0;s<i;s++)n[n.length]=t[s]}function Pn(n,e){const t=n.length;if(t!==e.length)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}function t1(n,e,t){const i=e||rs;return n.every(function(s,r){if(r===0)return!0;const o=i(n[r-1],s);return!(o>0||t&&o===0)})}function Os(){return!0}function Vs(){return!1}function Qr(){}function i1(n){let e=!1,t,i,s;return function(){const r=Array.prototype.slice.call(arguments);return(!e||this!==s||!Pn(r,i))&&(e=!0,s=this,i=r,t=n.apply(this,arguments)),t}}function n1(n){function e(){let t;try{t=n()}catch(i){return Promise.reject(i)}return t instanceof Promise?t:Promise.resolve(t)}return e()}function _a(n){for(const e in n)delete n[e]}function ks(n){let e;for(e in n)return!1;return!e}class s1 extends bd{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const i=this.listeners_||(this.listeners_={}),s=i[e]||(i[e]=[]);s.includes(t)||s.push(t)}dispatchEvent(e){const t=typeof e=="string",i=t?e:e.type,s=this.listeners_&&this.listeners_[i];if(!s)return;const r=t?new _i(e):e;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});i in o||(o[i]=0,a[i]=0),++o[i];let l;for(let h=0,c=s.length;h<c;++h)if("handleEvent"in s[h]?l=s[h].handleEvent(r):l=s[h].call(this,r),l===!1||r.propagationStopped){l=!1;break}if(--o[i]===0){let h=a[i];for(delete a[i];h--;)this.removeEventListener(i,Qr);delete o[i]}return l}disposeInternal(){this.listeners_&&_a(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,t){const i=this.listeners_&&this.listeners_[e];if(i){const s=i.indexOf(t);s!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(i[s]=Qr,++this.pendingRemovals_[e]):(i.splice(s,1),i.length===0&&delete this.listeners_[e]))}}}const va=s1,os=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",r1=os.includes("firefox"),o1=os.includes("safari")&&!os.includes("chrom");o1&&(os.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(os));const a1=os.includes("webkit")&&!os.includes("edge"),Ed=os.includes("macintosh"),Cd=typeof devicePixelRatio<"u"?devicePixelRatio:1,Md=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Sd=typeof Image<"u"&&Image.prototype.decode,l1=typeof createImageBitmap=="function",my=function(){let n=!1;try{const e=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return n}();function pe(n,e,t,i,s){if(i&&i!==n&&(t=t.bind(i)),s){const o=t;t=function(){n.removeEventListener(e,t),o.apply(this,arguments)}}const r={target:n,type:e,listener:t};return n.addEventListener(e,t),r}function Dl(n,e,t,i){return pe(n,e,t,i,!0)}function De(n){n&&n.target&&(n.target.removeEventListener(n.type,n.listener),_a(n))}class Td extends va{constructor(e,t,i,s){super(),this.extent=e,this.pixelRatio_=i,this.resolution=t,this.state=typeof s=="function"?re.IDLE:s,this.image_=null,this.loader=typeof s=="function"?s:null}changed(){this.dispatchEvent(K.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==re.IDLE&&this.loader){this.state=re.LOADING,this.changed();const e=this.getResolution(),t=Array.isArray(e)?e[0]:e;n1(()=>this.loader(this.getExtent(),t,this.getPixelRatio())).then(i=>{"image"in i&&(this.image_=i.image),"extent"in i&&(this.extent=i.extent),"resolution"in i&&(this.resolution=i.resolution),"pixelRatio"in i&&(this.pixelRatio_=i.pixelRatio),(i instanceof HTMLImageElement||i instanceof ImageBitmap||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement)&&(this.image_=i),this.state=re.LOADED}).catch(i=>{this.state=re.ERROR,console.error(i)}).finally(()=>this.changed())}}setImage(e){this.image_=e}setResolution(e){this.resolution=e}}function h1(n,e,t){const i=n;let s=!0,r=!1,o=!1;const a=[Dl(i,K.LOAD,function(){o=!0,r||e()})];return i.src&&Sd?(r=!0,i.decode().then(function(){s&&e()}).catch(function(l){s&&(o?e():t())})):a.push(Dl(i,K.ERROR,t)),function(){s=!1,a.forEach(De)}}function c1(n,e){return new Promise((t,i)=>{function s(){o(),t(n)}function r(){o(),i(new Error("Image load error"))}function o(){n.removeEventListener("load",s),n.removeEventListener("error",r)}n.addEventListener("load",s),n.addEventListener("error",r),e&&(n.src=e)})}function yy(n,e){return e&&(n.src=e),Sd?new Promise((t,i)=>n.decode().then(()=>t(n),i)):c1(n)}function qh(n,e){return e&&(n.src=e),Sd&&l1?n.decode().then(()=>createImageBitmap(n)):yy(n)}const _y=.5,vt={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function gt(n){const e=Xt();for(let t=0,i=n.length;t<i;++t)Fo(e,n[t]);return e}function u1(n,e,t){const i=Math.min.apply(null,n),s=Math.min.apply(null,e),r=Math.max.apply(null,n),o=Math.max.apply(null,e);return Pi(i,s,r,o,t)}function si(n,e,t){return t?(t[0]=n[0]-e,t[1]=n[1]-e,t[2]=n[2]+e,t[3]=n[3]+e,t):[n[0]-e,n[1]-e,n[2]+e,n[3]+e]}function vy(n,e){return e?(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e):n.slice()}function Ws(n,e,t){let i,s;return e<n[0]?i=n[0]-e:n[2]<e?i=e-n[2]:i=0,t<n[1]?s=n[1]-t:n[3]<t?s=t-n[3]:s=0,i*i+s*s}function xa(n,e){return Rd(n,e[0],e[1])}function Li(n,e){return n[0]<=e[0]&&e[2]<=n[2]&&n[1]<=e[1]&&e[3]<=n[3]}function Rd(n,e,t){return n[0]<=e&&e<=n[2]&&n[1]<=t&&t<=n[3]}function xu(n,e){const t=n[0],i=n[1],s=n[2],r=n[3],o=e[0],a=e[1];let l=vt.UNKNOWN;return o<t?l=l|vt.LEFT:o>s&&(l=l|vt.RIGHT),a<i?l=l|vt.BELOW:a>r&&(l=l|vt.ABOVE),l===vt.UNKNOWN&&(l=vt.INTERSECTING),l}function Xt(){return[1/0,1/0,-1/0,-1/0]}function Pi(n,e,t,i,s){return s?(s[0]=n,s[1]=e,s[2]=t,s[3]=i,s):[n,e,t,i]}function uo(n){return Pi(1/0,1/0,-1/0,-1/0,n)}function Rr(n,e){const t=n[0],i=n[1];return Pi(t,i,t,i,e)}function Ld(n,e,t,i,s){const r=uo(s);return wy(r,n,e,t,i)}function Ns(n,e){return n[0]==e[0]&&n[2]==e[2]&&n[1]==e[1]&&n[3]==e[3]}function xy(n,e){return e[0]<n[0]&&(n[0]=e[0]),e[2]>n[2]&&(n[2]=e[2]),e[1]<n[1]&&(n[1]=e[1]),e[3]>n[3]&&(n[3]=e[3]),n}function Fo(n,e){e[0]<n[0]&&(n[0]=e[0]),e[0]>n[2]&&(n[2]=e[0]),e[1]<n[1]&&(n[1]=e[1]),e[1]>n[3]&&(n[3]=e[1])}function wy(n,e,t,i,s){for(;t<i;t+=s)d1(n,e[t],e[t+1]);return n}function d1(n,e,t){n[0]=Math.min(n[0],e),n[1]=Math.min(n[1],t),n[2]=Math.max(n[2],e),n[3]=Math.max(n[3],t)}function Id(n,e){let t;return t=e(eo(n)),t||(t=e(wa(n)),t)||(t=e(ba(n)),t)||(t=e(fn(n)),t)?t:!1}function wu(n){let e=0;return Hs(n)||(e=Me(n)*yt(n)),e}function eo(n){return[n[0],n[1]]}function wa(n){return[n[2],n[1]]}function Nt(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]}function f1(n,e){let t;if(e==="bottom-left")t=eo(n);else if(e==="bottom-right")t=wa(n);else if(e==="top-left")t=fn(n);else if(e==="top-right")t=ba(n);else throw new Error("Invalid corner");return t}function Uo(n,e,t,i,s){const[r,o,a,l,h,c,u,d]=bu(n,e,t,i);return Pi(Math.min(r,a,h,u),Math.min(o,l,c,d),Math.max(r,a,h,u),Math.max(o,l,c,d),s)}function bu(n,e,t,i){const s=e*i[0]/2,r=e*i[1]/2,o=Math.cos(t),a=Math.sin(t),l=s*o,h=s*a,c=r*o,u=r*a,d=n[0],f=n[1];return[d-l+u,f-h-c,d-l-u,f-h+c,d+l-u,f+h+c,d+l+u,f+h-c,d-l+u,f-h-c]}function yt(n){return n[3]-n[1]}function Cn(n,e,t){const i=t||Xt();return He(n,e)?(n[0]>e[0]?i[0]=n[0]:i[0]=e[0],n[1]>e[1]?i[1]=n[1]:i[1]=e[1],n[2]<e[2]?i[2]=n[2]:i[2]=e[2],n[3]<e[3]?i[3]=n[3]:i[3]=e[3]):uo(i),i}function fn(n){return[n[0],n[3]]}function ba(n){return[n[2],n[3]]}function Me(n){return n[2]-n[0]}function He(n,e){return n[0]<=e[2]&&n[2]>=e[0]&&n[1]<=e[3]&&n[3]>=e[1]}function Hs(n){return n[2]<n[0]||n[3]<n[1]}function g1(n,e){return e?(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e):n}function p1(n,e,t){let i=!1;const s=xu(n,e),r=xu(n,t);if(s===vt.INTERSECTING||r===vt.INTERSECTING)i=!0;else{const o=n[0],a=n[1],l=n[2],h=n[3],c=e[0],u=e[1],d=t[0],f=t[1],g=(f-u)/(d-c);let p,m;r&vt.ABOVE&&!(s&vt.ABOVE)&&(p=d-(f-h)/g,i=p>=o&&p<=l),!i&&r&vt.RIGHT&&!(s&vt.RIGHT)&&(m=f-(d-l)*g,i=m>=a&&m<=h),!i&&r&vt.BELOW&&!(s&vt.BELOW)&&(p=d-(f-a)/g,i=p>=o&&p<=l),!i&&r&vt.LEFT&&!(s&vt.LEFT)&&(m=f-(d-o)*g,i=m>=a&&m<=h)}return i}function by(n,e,t,i){if(Hs(n))return uo(t);let s=[];if(i>1){const a=n[2]-n[0],l=n[3]-n[1];for(let h=0;h<i;++h)s.push(n[0]+a*h/i,n[1],n[2],n[1]+l*h/i,n[2]-a*h/i,n[3],n[0],n[3]-l*h/i)}else s=[n[0],n[1],n[2],n[1],n[2],n[3],n[0],n[3]];e(s,s,2);const r=[],o=[];for(let a=0,l=s.length;a<l;a+=2)r.push(s[a]),o.push(s[a+1]);return u1(r,o,t)}function Ey(n,e){const t=e.getExtent(),i=Nt(n);if(e.canWrapX()&&(i[0]<t[0]||i[0]>=t[2])){const s=Me(t),o=Math.floor((i[0]-t[0])/s)*s;n[0]-=o,n[2]-=o}return n}function m1(n,e){if(e.canWrapX()){const t=e.getExtent();if(!isFinite(n[0])||!isFinite(n[2]))return[[t[0],n[1],t[2],n[3]]];Ey(n,e);const i=Me(t);if(Me(n)>i)return[[t[0],n[1],t[2],n[3]]];if(n[0]<t[0])return[[n[0]+i,n[1],t[2],n[3]],[t[0],n[1],n[2],n[3]]];if(n[2]>t[2])return[[n[0],n[1],t[2],n[3]],[t[0],n[1],n[2]-i,n[3]]]}return[n]}const Ds={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};let y1=class{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==void 0?e.extent:null,this.worldExtent_=e.worldExtent!==void 0?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==void 0?e.axisOrientation:"enu",this.global_=e.global!==void 0?e.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Ds[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}};const Vh=y1,Ea=6378137,fr=Math.PI*Ea,_1=[-fr,-fr,fr,fr],v1=[-180,-85,180,85],Ka=Ea*Math.log(Math.tan(Math.PI/2));class Qs extends Vh{constructor(e){super({code:e,units:"m",extent:_1,global:!0,worldExtent:v1,getPointResolution:function(t,i){return t/Math.cosh(i[1]/Ea)}})}}const Fg=[new Qs("EPSG:3857"),new Qs("EPSG:102100"),new Qs("EPSG:102113"),new Qs("EPSG:900913"),new Qs("http://www.opengis.net/def/crs/EPSG/0/3857"),new Qs("http://www.opengis.net/gml/srs/epsg.xml#3857")];function x1(n,e,t){const i=n.length;t=t>1?t:2,e===void 0&&(t>2?e=n.slice():e=new Array(i));for(let s=0;s<i;s+=t){e[s]=fr*n[s]/180;let r=Ea*Math.log(Math.tan(Math.PI*(+n[s+1]+90)/360));r>Ka?r=Ka:r<-Ka&&(r=-Ka),e[s+1]=r}return e}function w1(n,e,t){const i=n.length;t=t>1?t:2,e===void 0&&(t>2?e=n.slice():e=new Array(i));for(let s=0;s<i;s+=t)e[s]=180*n[s]/fr,e[s+1]=360*Math.atan(Math.exp(n[s+1]/Ea))/Math.PI-90;return e}const b1=6378137,Og=[-180,-90,180,90],E1=Math.PI*b1/180;class ms extends Vh{constructor(e,t){super({code:e,units:"degrees",extent:Og,axisOrientation:t,global:!0,metersPerUnit:E1,worldExtent:Og})}}const kg=[new ms("CRS:84"),new ms("EPSG:4326","neu"),new ms("urn:ogc:def:crs:OGC:1.3:CRS84"),new ms("urn:ogc:def:crs:OGC:2:84"),new ms("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new ms("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new ms("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Eu={};function C1(n){return Eu[n]||Eu[n.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function M1(n,e){Eu[n]=e}let Lr={};function to(n,e,t){const i=n.getCode(),s=e.getCode();i in Lr||(Lr[i]={}),Lr[i][s]=t}function Cy(n,e){let t;return n in Lr&&e in Lr[n]&&(t=Lr[n][e]),t}function Je(n,e,t){return Math.min(Math.max(n,e),t)}function S1(n,e,t,i,s,r){const o=s-t,a=r-i;if(o!==0||a!==0){const l=((n-t)*o+(e-i)*a)/(o*o+a*a);l>1?(t=s,i=r):l>0&&(t+=o*l,i+=a*l)}return Mn(n,e,t,i)}function Mn(n,e,t,i){const s=t-n,r=i-e;return s*s+r*r}function T1(n){const e=n.length;for(let i=0;i<e;i++){let s=i,r=Math.abs(n[i][i]);for(let a=i+1;a<e;a++){const l=Math.abs(n[a][i]);l>r&&(r=l,s=a)}if(r===0)return null;const o=n[s];n[s]=n[i],n[i]=o;for(let a=i+1;a<e;a++){const l=-n[a][i]/n[i][i];for(let h=i;h<e+1;h++)i==h?n[a][h]=0:n[a][h]+=l*n[i][h]}}const t=new Array(e);for(let i=e-1;i>=0;i--){t[i]=n[i][e]/n[i][i];for(let s=i-1;s>=0;s--)n[s][e]-=n[s][i]*t[i]}return t}function Ng(n){return n*180/Math.PI}function Rs(n){return n*Math.PI/180}function Jn(n,e){const t=n%e;return t*e<0?t+e:t}function ci(n,e,t){return n+t*(e-n)}function Ca(n,e){const t=Math.pow(10,e);return Math.round(n*t)/t}function Dg(n,e){return Math.round(Ca(n,e))}function gr(n,e){return Math.floor(Ca(n,e))}function qn(n,e){return Math.ceil(Ca(n,e))}function Pd(n,e){const t=(""+n).split("."),i=(""+e).split(".");for(let s=0;s<Math.max(t.length,i.length);s++){const r=parseInt(t[s]||"0",10),o=parseInt(i[s]||"0",10);if(r>o)return 1;if(o>r)return-1}return 0}function My(n,e){return n[0]+=+e[0],n[1]+=+e[1],n}function R1(n,e){const t=e.getRadius(),i=e.getCenter(),s=i[0],r=i[1],o=n[0],a=n[1];let l=o-s;const h=a-r;l===0&&h===0&&(l=1);const c=Math.sqrt(l*l+h*h),u=s+t*l/c,d=r+t*h/c;return[u,d]}function Ad(n,e){const t=n[0],i=n[1],s=e[0],r=e[1],o=s[0],a=s[1],l=r[0],h=r[1],c=l-o,u=h-a,d=c===0&&u===0?0:(c*(t-o)+u*(i-a))/(c*c+u*u||0);let f,g;return d<=0?(f=o,g=a):d>=1?(f=l,g=h):(f=o+d*c,g=a+d*u),[f,g]}function zi(n,e){let t=!0;for(let i=n.length-1;i>=0;--i)if(n[i]!=e[i]){t=!1;break}return t}function Fd(n,e){const t=Math.cos(e),i=Math.sin(e),s=n[0]*t-n[1]*i,r=n[1]*t+n[0]*i;return n[0]=s,n[1]=r,n}function Sy(n,e){return n[0]*=e,n[1]*=e,n}function ln(n,e){const t=n[0]-e[0],i=n[1]-e[1];return t*t+i*i}function Gl(n,e){return Math.sqrt(ln(n,e))}function L1(n,e){return ln(n,Ad(n,e))}function Od(n,e){if(e.canWrapX()){const t=Me(e.getExtent()),i=Ty(n,e,t);i&&(n[0]-=i*t)}return n}function Ty(n,e,t){const i=e.getExtent();let s=0;return e.canWrapX()&&(n[0]<i[0]||n[0]>i[2])&&(t=t||Me(i),s=Math.floor((n[0]-i[0])/t)),s}const Ry=63710088e-1;function Gg(n,e,t){t=t||Ry;const i=Rs(n[1]),s=Rs(e[1]),r=(s-i)/2,o=Rs(e[0]-n[0])/2,a=Math.sin(r)*Math.sin(r)+Math.sin(o)*Math.sin(o)*Math.cos(i)*Math.cos(s);return 2*t*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function I1(n,e,t,i){i=i||Ry;const s=Rs(n[1]),r=Rs(n[0]),o=e/i,a=Math.asin(Math.sin(s)*Math.cos(o)+Math.cos(s)*Math.sin(o)*Math.cos(t)),l=r+Math.atan2(Math.sin(t)*Math.sin(o)*Math.cos(s),Math.cos(o)-Math.sin(s)*Math.sin(a));return[Ng(l),Ng(a)]}const Ly={info:1,warn:2,error:3,none:4};let P1=Ly.info;function Iy(...n){P1>Ly.warn||console.warn(...n)}let Cu=!0;function Py(n){Cu=!(n===void 0?!0:n)}function kd(n,e){if(e!==void 0){for(let t=0,i=n.length;t<i;++t)e[t]=n[t];e=e}else e=n.slice();return e}function Ay(n,e){if(e!==void 0&&n!==e){for(let t=0,i=n.length;t<i;++t)e[t]=n[t];n=e}return n}function Fy(n){M1(n.getCode(),n),to(n,n,kd)}function A1(n){n.forEach(Fy)}function X(n){return typeof n=="string"?C1(n):n||null}function zl(n,e,t,i){n=X(n);let s;const r=n.getPointResolutionFunc();if(r){if(s=r(e,t),i&&i!==n.getUnits()){const o=n.getMetersPerUnit();o&&(s=s*o/Ds[i])}}else{const o=n.getUnits();if(o=="degrees"&&!i||i=="degrees")s=e;else{const a=Wh(n,X("EPSG:4326"));if(a===Ay&&o!=="degrees")s=e*n.getMetersPerUnit();else{let h=[t[0]-e/2,t[1],t[0]+e/2,t[1],t[0],t[1]-e/2,t[0],t[1]+e/2];h=a(h,h,2);const c=Gg(h.slice(0,2),h.slice(2,4)),u=Gg(h.slice(4,6),h.slice(6,8));s=(c+u)/2}const l=i?Ds[i]:n.getMetersPerUnit();l!==void 0&&(s/=l)}}return s}function Mu(n){A1(n),n.forEach(function(e){n.forEach(function(t){e!==t&&to(e,t,kd)})})}function F1(n,e,t,i){n.forEach(function(s){e.forEach(function(r){to(s,r,t),to(r,s,i)})})}function Nd(n,e){return n?typeof n=="string"?X(n):n:X(e)}function zg(n){return function(e,t,i){const s=e.length;i=i!==void 0?i:2,t=t!==void 0?t:new Array(s);for(let r=0;r<s;r+=i){const o=n(e.slice(r,r+i)),a=o.length;for(let l=0,h=i;l<h;++l)t[r+l]=l>=a?e[r+l]:o[l]}return t}}function O1(n,e,t,i){const s=X(n),r=X(e);to(s,r,zg(t)),to(r,s,zg(i))}function Bg(n,e){return Py(),Qn(n,"EPSG:4326",e!==void 0?e:"EPSG:3857")}function ui(n,e){if(n===e)return!0;const t=n.getUnits()===e.getUnits();return(n.getCode()===e.getCode()||Wh(n,e)===kd)&&t}function Wh(n,e){const t=n.getCode(),i=e.getCode();let s=Cy(t,i);return s||(s=Ay),s}function as(n,e){const t=X(n),i=X(e);return Wh(t,i)}function Qn(n,e,t){return as(e,t)(n,void 0,n.length)}function Dd(n,e,t,i){const s=as(e,t);return by(n,s,void 0,i)}function Gs(n,e){return n}function je(n,e){return Cu&&!zi(n,[0,0])&&n[0]>=-180&&n[0]<=180&&n[1]>=-90&&n[1]<=90&&(Cu=!1,Iy("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),n}function Hh(n,e){return n}function sn(n,e){return n}function Ug(n,e,t){return function(i){let s,r;if(n.canWrapX()){const o=n.getExtent(),a=Me(o);i=i.slice(0),r=Ty(i,n,a),r&&(i[0]=i[0]-r*a),i[0]=Je(i[0],o[0],o[2]),i[1]=Je(i[1],o[1],o[3]),s=t(i)}else s=t(i);return r&&e.canWrapX()&&(s[0]+=r*Me(e.getExtent())),s}}function k1(){Mu(Fg),Mu(kg),F1(kg,Fg,x1,w1)}k1();const N1=10,jg=.25;class D1{constructor(e,t,i,s,r,o){this.sourceProj_=e,this.targetProj_=t;let a={};const l=as(this.targetProj_,this.sourceProj_);this.transformInv_=function(y){const x=y[0]+"/"+y[1];return a[x]||(a[x]=l(y)),a[x]},this.maxSourceExtent_=s,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!s&&!!this.sourceProj_.getExtent()&&Me(s)>=Me(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Me(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Me(this.targetProj_.getExtent()):null;const h=fn(i),c=ba(i),u=wa(i),d=eo(i),f=this.transformInv_(h),g=this.transformInv_(c),p=this.transformInv_(u),m=this.transformInv_(d),v=N1+(o?Math.max(0,Math.ceil(Math.log2(wu(i)/(o*o*256*256)))):0);if(this.addQuad_(h,c,u,d,f,g,p,m,v),this.wrapsXInSource_){let y=1/0;this.triangles_.forEach(function(x,w,b){y=Math.min(y,x.source[0][0],x.source[1][0],x.source[2][0])}),this.triangles_.forEach(x=>{if(Math.max(x.source[0][0],x.source[1][0],x.source[2][0])-y>this.sourceWorldWidth_/2){const w=[[x.source[0][0],x.source[0][1]],[x.source[1][0],x.source[1][1]],[x.source[2][0],x.source[2][1]]];w[0][0]-y>this.sourceWorldWidth_/2&&(w[0][0]-=this.sourceWorldWidth_),w[1][0]-y>this.sourceWorldWidth_/2&&(w[1][0]-=this.sourceWorldWidth_),w[2][0]-y>this.sourceWorldWidth_/2&&(w[2][0]-=this.sourceWorldWidth_);const b=Math.min(w[0][0],w[1][0],w[2][0]);Math.max(w[0][0],w[1][0],w[2][0])-b<this.sourceWorldWidth_/2&&(x.source=w)}})}a={}}addTriangle_(e,t,i,s,r,o){this.triangles_.push({source:[s,r,o],target:[e,t,i]})}addQuad_(e,t,i,s,r,o,a,l,h){const c=gt([r,o,a,l]),u=this.sourceWorldWidth_?Me(c)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,f=this.sourceProj_.canWrapX()&&u>.5&&u<1;let g=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const m=gt([e,t,i,s]);g=Me(m)/this.targetWorldWidth_>jg||g}!f&&this.sourceProj_.isGlobal()&&u&&(g=u>jg||g)}if(!g&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!He(c,this.maxSourceExtent_))return;let p=0;if(!g&&(!isFinite(r[0])||!isFinite(r[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)g=!0;else if(p=(!isFinite(r[0])||!isFinite(r[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),p!=1&&p!=2&&p!=4&&p!=8)return}if(h>0){if(!g){const m=[(e[0]+i[0])/2,(e[1]+i[1])/2],v=this.transformInv_(m);let y;f?y=(Jn(r[0],d)+Jn(a[0],d))/2-Jn(v[0],d):y=(r[0]+a[0])/2-v[0];const x=(r[1]+a[1])/2-v[1];g=y*y+x*x>this.errorThresholdSquared_}if(g){if(Math.abs(e[0]-i[0])<=Math.abs(e[1]-i[1])){const m=[(t[0]+i[0])/2,(t[1]+i[1])/2],v=this.transformInv_(m),y=[(s[0]+e[0])/2,(s[1]+e[1])/2],x=this.transformInv_(y);this.addQuad_(e,t,m,y,r,o,v,x,h-1),this.addQuad_(y,m,i,s,x,v,a,l,h-1)}else{const m=[(e[0]+t[0])/2,(e[1]+t[1])/2],v=this.transformInv_(m),y=[(i[0]+s[0])/2,(i[1]+s[1])/2],x=this.transformInv_(y);this.addQuad_(e,m,y,s,r,v,x,l,h-1),this.addQuad_(m,t,i,y,v,o,a,x,h-1)}return}}if(f){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}p&11||this.addTriangle_(e,i,s,r,a,l),p&14||this.addTriangle_(e,i,t,r,a,o),p&&(p&13||this.addTriangle_(t,s,e,o,l,r),p&7||this.addTriangle_(t,s,i,o,l,a))}calculateSourceExtent(){const e=Xt();return this.triangles_.forEach(function(t,i,s){const r=t.source;Fo(e,r[0]),Fo(e,r[1]),Fo(e,r[2])}),e}getTriangles(){return this.triangles_}}const Oy=D1;function St(n,e,t,i){let s;return t&&t.length?s=t.shift():Md?s=new OffscreenCanvas(n||300,e||300):s=document.createElement("canvas"),n&&(s.width=n),e&&(s.height=e),s.getContext("2d",i)}function Ma(n){const e=n.canvas;e.width=1,e.height=1,n.clearRect(0,0,1,1)}function G1(n){let e=n.offsetWidth;const t=getComputedStyle(n);return e+=parseInt(t.marginLeft,10)+parseInt(t.marginRight,10),e}function z1(n){let e=n.offsetHeight;const t=getComputedStyle(n);return e+=parseInt(t.marginTop,10)+parseInt(t.marginBottom,10),e}function $g(n,e){const t=e.parentNode;t&&t.replaceChild(n,e)}function Bl(n){return n&&n.parentNode?n.parentNode.removeChild(n):null}function ky(n){for(;n.lastChild;)n.removeChild(n.lastChild)}function B1(n,e){const t=n.childNodes;for(let i=0;;++i){const s=t[i],r=e[i];if(!s&&!r)break;if(s!==r){if(!s){n.appendChild(r);continue}if(!r){n.removeChild(s),--i;continue}n.insertBefore(r,s)}}}let vc;const Ir=[];function qg(n,e,t,i,s){n.beginPath(),n.moveTo(0,0),n.lineTo(e,t),n.lineTo(i,s),n.closePath(),n.save(),n.clip(),n.fillRect(0,0,Math.max(e,i)+1,Math.max(t,s)),n.restore()}function xc(n,e){return Math.abs(n[e*4]-210)>2||Math.abs(n[e*4+3]-.75*255)>2}function U1(){if(vc===void 0){const n=St(6,6,Ir);n.globalCompositeOperation="lighter",n.fillStyle="rgba(210, 0, 0, 0.75)",qg(n,4,5,4,0),qg(n,4,5,0,5);const e=n.getImageData(0,0,3,3).data;vc=xc(e,0)||xc(e,4)||xc(e,8),Ma(n),Ir.push(n.canvas)}return vc}function jo(n,e,t,i){const s=Qn(t,e,n);let r=zl(e,i,t);const o=e.getMetersPerUnit();o!==void 0&&(r*=o);const a=n.getMetersPerUnit();a!==void 0&&(r/=a);const l=n.getExtent();if(!l||xa(l,s)){const h=zl(n,r,s)/r;isFinite(h)&&h>0&&(r/=h)}return r}function j1(n,e,t,i){const s=Nt(t);let r=jo(n,e,s,i);return(!isFinite(r)||r<=0)&&Id(t,function(o){return r=jo(n,e,o,i),isFinite(r)&&r>0}),r}function Ny(n,e,t,i,s,r,o,a,l,h,c,u){const d=St(Math.round(t*n),Math.round(t*e),Ir);if(u||(d.imageSmoothingEnabled=!1),l.length===0)return d.canvas;d.scale(t,t);function f(w){return Math.round(w*t)/t}d.globalCompositeOperation="lighter";const g=Xt();l.forEach(function(w,b,E){xy(g,w.extent)});const p=Me(g),m=yt(g),v=St(Math.round(t*p/i),Math.round(t*m/i),Ir);u||(v.imageSmoothingEnabled=!1);const y=t/i;l.forEach(function(w,b,E){const C=w.extent[0]-g[0],M=-(w.extent[3]-g[3]),R=Me(w.extent),N=yt(w.extent);w.image.width>0&&w.image.height>0&&v.drawImage(w.image,h,h,w.image.width-2*h,w.image.height-2*h,C*y,M*y,R*y,N*y)});const x=fn(o);return a.getTriangles().forEach(function(w,b,E){const C=w.source,M=w.target;let R=C[0][0],N=C[0][1],G=C[1][0],S=C[1][1],B=C[2][0],O=C[2][1];const L=f((M[0][0]-x[0])/r),P=f(-(M[0][1]-x[1])/r),z=f((M[1][0]-x[0])/r),Q=f(-(M[1][1]-x[1])/r),Te=f((M[2][0]-x[0])/r),I=f(-(M[2][1]-x[1])/r),it=R,A=N;R=0,N=0,G-=it,S-=A,B-=it,O-=A;const nt=[[G,S,0,0,z-L],[B,O,0,0,Te-L],[0,0,G,S,Q-P],[0,0,B,O,I-P]],Re=T1(nt);if(Re){if(d.save(),d.beginPath(),U1()||!u){d.moveTo(z,Q);const me=4,_t=L-z,Dt=P-Q;for(let Ue=0;Ue<me;Ue++)d.lineTo(z+f((Ue+1)*_t/me),Q+f(Ue*Dt/(me-1))),Ue!=me-1&&d.lineTo(z+f((Ue+1)*_t/me),Q+f((Ue+1)*Dt/(me-1)));d.lineTo(Te,I)}else d.moveTo(z,Q),d.lineTo(L,P),d.lineTo(Te,I);d.clip(),d.transform(Re[0],Re[2],Re[1],Re[3],L,P),d.translate(g[0]-it,g[3]-A),d.scale(i/t,-i/t),d.drawImage(v.canvas,0,0),d.restore()}}),Ma(v),Ir.push(v.canvas),c&&(d.save(),d.globalCompositeOperation="source-over",d.strokeStyle="black",d.lineWidth=1,a.getTriangles().forEach(function(w,b,E){const C=w.target,M=(C[0][0]-x[0])/r,R=-(C[0][1]-x[1])/r,N=(C[1][0]-x[0])/r,G=-(C[1][1]-x[1])/r,S=(C[2][0]-x[0])/r,B=-(C[2][1]-x[1])/r;d.beginPath(),d.moveTo(N,G),d.lineTo(M,R),d.lineTo(S,B),d.closePath(),d.stroke()}),d.restore()),d.canvas}function Su(n){return Array.isArray(n)?Math.min(...n):n}class $1 extends Td{constructor(e,t,i,s,r,o,a){let l=e.getExtent();l&&e.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);let h=t.getExtent();h&&t.canWrapX()&&(h=h.slice(),h[0]=-1/0,h[2]=1/0);const c=h?Cn(i,h):i,u=Nt(c),d=jo(e,t,u,s),f=_y,g=new Oy(e,t,c,l,d*f,s),p=g.calculateSourceExtent(),m=Hs(p)?null:o(p,d,r),v=m?re.IDLE:re.EMPTY,y=m?m.getPixelRatio():1;super(i,s,y,v),this.targetProj_=t,this.maxSourceExtent_=l,this.triangulation_=g,this.targetResolution_=s,this.targetExtent_=i,this.sourceImage_=m,this.sourcePixelRatio_=y,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==re.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==re.LOADED){const t=Me(this.targetExtent_)/this.targetResolution_,i=yt(this.targetExtent_)/this.targetResolution_;this.canvas_=Ny(t,i,this.sourcePixelRatio_,Su(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_)}this.state=e,this.changed()}load(){if(this.state==re.IDLE){this.state=re.LOADING,this.changed();const e=this.sourceImage_.getState();e==re.LOADED||e==re.ERROR?this.reproject_():(this.sourceListenerKey_=pe(this.sourceImage_,K.CHANGE,function(t){const i=this.sourceImage_.getState();(i==re.LOADED||i==re.ERROR)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}}unlistenSource_(){De(this.sourceListenerKey_),this.sourceListenerKey_=null}}const q1=$1,io={PROPERTYCHANGE:"propertychange"};class Sa extends va{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(K.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const i=e.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=pe(this,e[r],t);return s}return pe(this,e,t)}onceInternal(e,t){let i;if(Array.isArray(e)){const s=e.length;i=new Array(s);for(let r=0;r<s;++r)i[r]=Dl(this,e[r],t)}else i=Dl(this,e,t);return t.ol_key=i,i}unInternal(e,t){const i=t.ol_key;if(i)Bi(i);else if(Array.isArray(e))for(let s=0,r=e.length;s<r;++s)this.removeEventListener(e[s],t);else this.removeEventListener(e,t)}}Sa.prototype.on;Sa.prototype.once;Sa.prototype.un;function Bi(n){if(Array.isArray(n))for(let e=0,t=n.length;e<t;++e)De(n[e]);else De(n)}function ie(){throw new Error("Unimplemented abstract method.")}let V1=0;function H(n){return n.ol_uid||(n.ol_uid=String(++V1))}class Vg extends _i{constructor(e,t,i){super(e),this.key=t,this.oldValue=i}}class W1 extends Sa{constructor(e){super(),this.on,this.once,this.un,H(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,t){let i;i=`change:${e}`,this.hasListener(i)&&this.dispatchEvent(new Vg(i,e,t)),i=io.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new Vg(i,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,i){const s=this.values_||(this.values_={});if(i)s[e]=t;else{const r=s[e];s[e]=t,r!==t&&this.notify(e,r)}}setProperties(e,t){for(const i in e)this.set(i,e[i],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const i=this.values_[e];delete this.values_[e],ks(this.values_)&&(this.values_=null),t||this.notify(e,i)}}}const Xi=W1;class H1 extends Xi{constructor(e){super(),this.projection=X(e.projection),this.attributions_=Wg(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible!==void 0?e.attributionsCollapsible:!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(i,s){t.viewResolver=i,t.viewRejector=s})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=Wg(e),this.changed()}setState(e){this.state_=e,this.changed()}}function Wg(n){return n?Array.isArray(n)?function(e){return n}:typeof n=="function"?n:function(e){return[n]}:null}const Gd=H1,Vn=4,wc={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class X1 extends _i{constructor(e,t){super(e),this.image=t}}class Y1 extends Gd{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate!==void 0?e.interpolate:!0}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=e.loader?e.loader.length===0:!1}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();if(t){const i=$h(t,e,0);e=t[i]}return e}getImage(e,t,i,s){const r=this.getProjection();if(!r||!s||ui(r,s))return r&&(s=r),this.getImageInternal(e,t,i,s);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&ui(this.reprojectedImage_.getProjection(),s)&&this.reprojectedImage_.getResolution()==t&&Ns(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new q1(r,s,e,t,i,(o,a,l)=>this.getImageInternal(o,a,l,r),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,i,s){if(this.loader){const r=Dy(e,t,i,1),o=this.findNearestResolution(t);if(this.image&&(this.static_||(this.wantedExtent_&&Li(this.wantedExtent_,r)||Li(this.image.getExtent(),r))&&(this.wantedResolution_&&Su(this.wantedResolution_)===o||Su(this.image.getResolution())===o)))return this.image;this.wantedExtent_=r,this.wantedResolution_=o,this.image=new Td(r,o,i,this.loader),this.image.addEventListener(K.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const t=e.target;let i;switch(t.getState()){case re.LOADING:this.loading=!0,i=wc.IMAGELOADSTART;break;case re.LOADED:this.loading=!1,i=wc.IMAGELOADEND;break;case re.ERROR:this.loading=!1,i=wc.IMAGELOADERROR;break;default:return}this.hasListener(i)&&this.dispatchEvent(new X1(i,t))}}function zd(n,e){n.getImage().src=e}function Dy(n,e,t,i){const s=e/t,r=Nt(n),o=qn(Me(n)/s,Vn),a=qn(yt(n)/s,Vn),l=qn((i-1)*o/2,Vn),h=o+2*l,c=qn((i-1)*a/2,Vn),u=a+2*c;return Uo(r,s,0,[h,u])}const Gy=Y1;function $o(n,e){const t=[];Object.keys(e).forEach(function(s){e[s]!==null&&e[s]!==void 0&&t.push(s+"="+encodeURIComponent(e[s]))});const i=t.join("&");return n=n.replace(/[?&]$/,""),n+=n.includes("?")?"&":"?",n+i}const Ul="1.3.0";function zy(n,e,t,i,s){s.WIDTH=t[0],s.HEIGHT=t[1];const r=i.getAxisOrientation();let o;const a=Pd(s.VERSION,"1.3")>=0;return s[a?"CRS":"SRS"]=i.getCode(),a&&r.substr(0,2)=="ne"?o=[e[1],e[0],e[3],e[2]]:o=e,s.BBOX=o.join(","),$o(n,s)}function By(n,e,t,i,s,r,o){r=Object.assign({REQUEST:"GetMap"},r);const a=e/t,l=[Dg(Me(n)/a,Vn),Dg(yt(n)/a,Vn)];if(t!=1)switch(o){case"geoserver":const c=90*t+.5|0;"FORMAT_OPTIONS"in r?r.FORMAT_OPTIONS+=";dpi:"+c:r.FORMAT_OPTIONS="dpi:"+c;break;case"mapserver":r.MAP_RESOLUTION=90*t;break;case"carmentaserver":case"qgis":r.DPI=90*t;break;default:throw new Error("Unknown `serverType` configured")}return zy(s,n,l,i,r)}function jl(n,e){return Object.assign({REQUEST:e,SERVICE:"WMS",VERSION:Ul,FORMAT:"image/png",STYLES:"",TRANSPARENT:!0},n)}function Z1(n){const e=n.hidpi===void 0?!0:n.hidpi,t=X(n.projection||"EPSG:3857"),i=n.ratio||1.5,s=n.load||qh;return(r,o,a)=>{r=Dy(r,o,a,i),a!=1&&(!e||n.serverType===void 0)&&(a=1);const l=By(r,o,a,t,n.url,jl(n.params,"GetMap"),n.serverType),h=new Image;return n.crossOrigin!==null&&(h.crossOrigin=n.crossOrigin),s(h,l).then(c=>({image:c,extent:r,pixelRatio:a}))}}const Hg=[101,101];class K1 extends Gy{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:zd,this.params_=e.params,this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5}getFeatureInfoUrl(e,t,i,s){if(this.url_===void 0)return;const r=X(i),o=this.getProjection();o&&o!==r&&(t=jo(o,r,e,t),e=Qn(e,r,o));const a=Uo(e,t,0,Hg),l={QUERY_LAYERS:this.params_.LAYERS};Object.assign(l,jl(this.params_,"GetFeatureInfo"),s);const h=gr((e[0]-a[0])/t,Vn),c=gr((a[3]-e[1])/t,Vn),u=Pd(l.VERSION,"1.3")>=0;return l[u?"I":"X"]=h,l[u?"J":"Y"]=c,zy(this.url_,a,Hg,o||r,l)}getLegendUrl(e,t){if(this.url_===void 0)return;const i={SERVICE:"WMS",VERSION:Ul,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(t===void 0||t.LAYER===void 0){const s=this.params_.LAYERS;if(!(!Array.isArray(s)||s.length===1))return;i.LAYER=s}if(e!==void 0){const s=this.getProjection()?this.getProjection().getMetersPerUnit():1,r=28e-5;i.SCALE=e*s/r}return Object.assign(i,t),$o(this.url_,i)}getParams(){return this.params_}getImageInternal(e,t,i,s){return this.url_===void 0?null:(this.loader||(this.loader=Z1({crossOrigin:this.crossOrigin_,params:this.params_,projection:s,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(r,o)=>(this.image.setImage(r),this.imageLoadFunction_(this.image,o),qh(r))})),super.getImageInternal(e,t,i,s))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}const Bd=K1;function fe(n,e){if(!n)throw new Error(e)}class Ud extends Xi{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(typeof e.getSimplifiedGeometry=="function"){const t=e;this.setGeometry(t)}else{const t=e;this.setProperties(t)}}clone(){const e=new Ud(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const i=this.getStyle();return i&&e.setStyle(i),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(De(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=pe(e,K.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?J1(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function J1(n){if(typeof n=="function")return n;let e;return Array.isArray(n)?e=n:(fe(typeof n.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),e=[n]),function(){return e}}const tn=Ud;class Q1{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let i=t.dataProjection?X(t.dataProjection):this.readProjection(e);t.extent&&i&&i.getUnits()==="tile-pixels"&&(i=X(i),i.setWorldExtent(t.extent)),t={dataProjection:i,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},e)}getType(){return ie()}readFeature(e,t){return ie()}readFeatures(e,t){return ie()}readGeometry(e,t){return ie()}readProjection(e){return ie()}writeFeature(e,t){return ie()}writeFeatures(e,t){return ie()}writeGeometry(e,t){return ie()}}const jd=Q1;function fo(n,e,t){const i=t?X(t.featureProjection):null,s=t?X(t.dataProjection):null;let r;if(i&&s&&!ui(i,s)?r=(e?n.clone():n).transform(e?i:s,e?s:i):r=n,e&&t&&t.decimals!==void 0){const o=Math.pow(10,t.decimals),a=function(l){for(let h=0,c=l.length;h<c;++h)l[h]=Math.round(l[h]*o)/o;return l};r===n&&(r=n.clone()),r.applyTransform(a)}return r}function $d(n,e){const t=e?X(e.featureProjection):null,i=e?X(e.dataProjection):null;return t&&i&&!ui(t,i)?Dd(n,i,t):n}class ew extends jd{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(Ja(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(Ja(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return ie()}readFeaturesFromObject(e,t){return ie()}readGeometry(e,t){return this.readGeometryFromObject(Ja(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return ie()}readProjection(e){return this.readProjectionFromObject(Ja(e))}readProjectionFromObject(e){return ie()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return ie()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return ie()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return ie()}}function Ja(n){if(typeof n=="string"){const e=JSON.parse(n);return e||null}return n!==null?n:null}const tw=ew,Uy=new Array(6);function pi(){return[1,0,0,1,0,0]}function Xg(n){return Yh(n,1,0,0,1,0,0)}function Xh(n,e){const t=n[0],i=n[1],s=n[2],r=n[3],o=n[4],a=n[5],l=e[0],h=e[1],c=e[2],u=e[3],d=e[4],f=e[5];return n[0]=t*l+s*h,n[1]=i*l+r*h,n[2]=t*c+s*u,n[3]=i*c+r*u,n[4]=t*d+s*f+o,n[5]=i*d+r*f+a,n}function Yh(n,e,t,i,s,r,o){return n[0]=e,n[1]=t,n[2]=i,n[3]=s,n[4]=r,n[5]=o,n}function iw(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n}function st(n,e){const t=e[0],i=e[1];return e[0]=n[0]*t+n[2]*i+n[4],e[1]=n[1]*t+n[3]*i+n[5],e}function Sl(n,e,t){return Xh(n,Yh(Uy,e,0,0,t,0,0))}function nw(n,e,t){return Yh(n,e,0,0,t,0,0)}function sw(n,e,t){return Xh(n,Yh(Uy,1,0,0,1,e,t))}function Vi(n,e,t,i,s,r,o,a){const l=Math.sin(r),h=Math.cos(r);return n[0]=i*h,n[1]=s*l,n[2]=-i*l,n[3]=s*h,n[4]=o*i*h-a*i*l+e,n[5]=o*s*l+a*s*h+t,n}function Zh(n,e){const t=rw(e);fe(t!==0,"Transformation matrix cannot be inverted");const i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5];return n[0]=o/t,n[1]=-s/t,n[2]=-r/t,n[3]=i/t,n[4]=(r*l-o*a)/t,n[5]=-(i*l-s*a)/t,n}function rw(n){return n[0]*n[3]-n[1]*n[2]}let Yg;function qd(n){const e="matrix("+n.join(", ")+")";if(Md)return e;const t=Yg||(Yg=document.createElement("div"));return t.style.transform=e,t.style.transform}function es(n,e,t,i,s,r){r=r||[];let o=0;for(let a=e;a<t;a+=i){const l=n[a],h=n[a+1];r[o++]=s[0]*l+s[2]*h+s[4],r[o++]=s[1]*l+s[3]*h+s[5]}return r&&r.length!=o&&(r.length=o),r}function Vd(n,e,t,i,s,r,o){o=o||[];const a=Math.cos(s),l=Math.sin(s),h=r[0],c=r[1];let u=0;for(let d=e;d<t;d+=i){const f=n[d]-h,g=n[d+1]-c;o[u++]=h+f*a-g*l,o[u++]=c+f*l+g*a;for(let p=d+2;p<d+i;++p)o[u++]=n[p]}return o&&o.length!=u&&(o.length=u),o}function ow(n,e,t,i,s,r,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let u=e;u<t;u+=i){const d=n[u]-l,f=n[u+1]-h;a[c++]=l+s*d,a[c++]=h+r*f;for(let g=u+2;g<u+i;++g)a[c++]=n[g]}return a&&a.length!=c&&(a.length=c),a}function aw(n,e,t,i,s,r,o){o=o||[];let a=0;for(let l=e;l<t;l+=i){o[a++]=n[l]+s,o[a++]=n[l+1]+r;for(let h=l+2;h<l+i;++h)o[a++]=n[h]}return o&&o.length!=a&&(o.length=a),o}const Zg=pi();class lw extends Xi{constructor(){super(),this.extent_=Xt(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=i1(function(e,t,i){if(!i)return this.getSimplifiedGeometry(t);const s=this.clone();return s.applyTransform(i),s.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return ie()}closestPointXY(e,t,i,s){return ie()}containsXY(e,t){const i=this.getClosestPoint([e,t]);return i[0]===e&&i[1]===t}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return ie()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&uo(t),this.extentRevision_=this.getRevision()}return g1(this.extent_,e)}rotate(e,t){ie()}scale(e,t,i){ie()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return ie()}getType(){return ie()}applyTransform(e){ie()}intersectsExtent(e){return ie()}translate(e,t){ie()}transform(e,t){const i=X(e),s=i.getUnits()=="tile-pixels"?function(r,o,a){const l=i.getExtent(),h=i.getWorldExtent(),c=yt(h)/yt(l);return Vi(Zg,h[0],h[3],c,-c,0,0,0),es(r,0,r.length,a,Zg,o),as(i,t)(r,o,a)}:as(i,t);return this.applyTransform(s),this}}const no=lw;class hw extends no{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates=null}computeExtent(e){return Ld(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return ie()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=$l(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){ie()}setLayout(e,t,i){let s;if(e)s=$l(e);else{for(let r=0;r<i;++r){if(t.length===0){this.layout="XY",this.stride=2;return}t=t[0]}s=t.length,e=cw(s)}this.layout=e,this.stride=s}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(e,t){const i=this.getFlatCoordinates();if(i){const s=this.getStride();Vd(i,0,i.length,s,e,t,i),this.changed()}}scale(e,t,i){t===void 0&&(t=e),i||(i=Nt(this.getExtent()));const s=this.getFlatCoordinates();if(s){const r=this.getStride();ow(s,0,s.length,r,e,t,i,s),this.changed()}}translate(e,t){const i=this.getFlatCoordinates();if(i){const s=this.getStride();aw(i,0,i.length,s,e,t,i),this.changed()}}}function cw(n){let e;return n==2?e="XY":n==3?e="XYZ":n==4&&(e="XYZM"),e}function $l(n){let e;return n=="XY"?e=2:n=="XYZ"||n=="XYM"?e=3:n=="XYZM"&&(e=4),e}function uw(n,e,t){const i=n.getFlatCoordinates();if(!i)return null;const s=n.getStride();return es(i,0,i.length,s,e,t)}const An=hw;function Kg(n,e,t,i,s,r,o){const a=n[e],l=n[e+1],h=n[t]-a,c=n[t+1]-l;let u;if(h===0&&c===0)u=e;else{const d=((s-a)*h+(r-l)*c)/(h*h+c*c);if(d>1)u=t;else if(d>0){for(let f=0;f<i;++f)o[f]=ci(n[e+f],n[t+f],d);o.length=i;return}else u=e}for(let d=0;d<i;++d)o[d]=n[u+d];o.length=i}function Wd(n,e,t,i,s){let r=n[e],o=n[e+1];for(e+=i;e<t;e+=i){const a=n[e],l=n[e+1],h=Mn(r,o,a,l);h>s&&(s=h),r=a,o=l}return s}function Hd(n,e,t,i,s){for(let r=0,o=t.length;r<o;++r){const a=t[r];s=Wd(n,e,a,i,s),e=a}return s}function dw(n,e,t,i,s){for(let r=0,o=t.length;r<o;++r){const a=t[r];s=Hd(n,e,a,i,s),e=a[a.length-1]}return s}function Xd(n,e,t,i,s,r,o,a,l,h,c){if(e==t)return h;let u,d;if(s===0){if(d=Mn(o,a,n[e],n[e+1]),d<h){for(u=0;u<i;++u)l[u]=n[e+u];return l.length=i,d}return h}c=c||[NaN,NaN];let f=e+i;for(;f<t;)if(Kg(n,f-i,f,i,o,a,c),d=Mn(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<i;++u)l[u]=c[u];l.length=i,f+=i}else f+=i*Math.max((Math.sqrt(d)-Math.sqrt(h))/s|0,1);if(r&&(Kg(n,t-i,e,i,o,a,c),d=Mn(o,a,c[0],c[1]),d<h)){for(h=d,u=0;u<i;++u)l[u]=c[u];l.length=i}return h}function Yd(n,e,t,i,s,r,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=t.length;u<d;++u){const f=t[u];h=Xd(n,e,f,i,s,r,o,a,l,h,c),e=f}return h}function fw(n,e,t,i,s,r,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=t.length;u<d;++u){const f=t[u];h=Yd(n,e,f,i,s,r,o,a,l,h,c),e=f[f.length-1]}return h}function jy(n,e,t,i){for(let s=0,r=t.length;s<r;++s)n[e++]=t[s];return e}function Kh(n,e,t,i){for(let s=0,r=t.length;s<r;++s){const o=t[s];for(let a=0;a<i;++a)n[e++]=o[a]}return e}function Zd(n,e,t,i,s){s=s||[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=Kh(n,e,t[o],i);s[r++]=l,e=l}return s.length=r,s}function gw(n,e,t,i,s){s=s||[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=Zd(n,e,t[o],i,s[r]);l.length===0&&(l[0]=e),s[r++]=l,e=l[l.length-1]}return s.length=r,s}function Kd(n,e,t,i,s,r,o){const a=(t-e)/i;if(a<3){for(;e<t;e+=i)r[o++]=n[e],r[o++]=n[e+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[e,t-i];let c=0;for(;h.length>0;){const u=h.pop(),d=h.pop();let f=0;const g=n[d],p=n[d+1],m=n[u],v=n[u+1];for(let y=d+i;y<u;y+=i){const x=n[y],w=n[y+1],b=S1(x,w,g,p,m,v);b>f&&(c=y,f=b)}f>s&&(l[(c-e)/i]=1,d+i<c&&h.push(d,c),c+i<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(r[o++]=n[e+u*i],r[o++]=n[e+u*i+1]);return o}function pw(n,e,t,i,s,r,o,a){for(let l=0,h=t.length;l<h;++l){const c=t[l];o=Kd(n,e,c,i,s,r,o),a.push(o),e=c}return o}function ws(n,e){return e*Math.round(n/e)}function mw(n,e,t,i,s,r,o){if(e==t)return o;let a=ws(n[e],s),l=ws(n[e+1],s);e+=i,r[o++]=a,r[o++]=l;let h,c;do if(h=ws(n[e],s),c=ws(n[e+1],s),e+=i,e==t)return r[o++]=h,r[o++]=c,o;while(h==a&&c==l);for(;e<t;){const u=ws(n[e],s),d=ws(n[e+1],s);if(e+=i,u==h&&d==c)continue;const f=h-a,g=c-l,p=u-a,m=d-l;if(f*m==g*p&&(f<0&&p<f||f==p||f>0&&p>f)&&(g<0&&m<g||g==m||g>0&&m>g)){h=u,c=d;continue}r[o++]=h,r[o++]=c,a=h,l=c,h=u,c=d}return r[o++]=h,r[o++]=c,o}function $y(n,e,t,i,s,r,o,a){for(let l=0,h=t.length;l<h;++l){const c=t[l];o=mw(n,e,c,i,s,r,o),a.push(o),e=c}return o}function yw(n,e,t,i,s,r,o,a){for(let l=0,h=t.length;l<h;++l){const c=t[l],u=[];o=$y(n,e,c,i,s,r,o,u),a.push(u),e=c[c.length-1]}return o}function qy(n,e,t,i,s){let r;for(e+=i;e<t;e+=i)if(r=s(n.slice(e-i,e),n.slice(e,e+i)),r)return r;return!1}function Wn(n,e,t,i,s){s=s!==void 0?s:[];let r=0;for(let o=e;o<t;o+=i)s[r++]=n.slice(o,o+i);return s.length=r,s}function qo(n,e,t,i,s){s=s!==void 0?s:[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];s[r++]=Wn(n,e,l,i,s[r]),e=l}return s.length=r,s}function Tu(n,e,t,i,s){s=s!==void 0?s:[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];s[r++]=l.length===1&&l[0]===e?[]:qo(n,e,l,i,s[r]),e=l[l.length-1]}return s.length=r,s}function ql(n,e,t,i,s,r,o){let a,l;const h=(t-e)/i;if(h===1)a=e;else if(h===2)a=e,l=s;else if(h!==0){let c=n[e],u=n[e+1],d=0;const f=[0];for(let m=e+i;m<t;m+=i){const v=n[m],y=n[m+1];d+=Math.sqrt((v-c)*(v-c)+(y-u)*(y-u)),f.push(d),c=v,u=y}const g=s*d,p=Qx(f,g);p<0?(l=(g-f[-p-2])/(f[-p-1]-f[-p-2]),a=e+(-p-2)*i):a=e+p*i}o=o>1?o:2,r=r||new Array(o);for(let c=0;c<o;++c)r[c]=a===void 0?NaN:l===void 0?n[a+c]:ci(n[a+c],n[a+i+c],l);return r}function Ru(n,e,t,i,s,r){if(t==e)return null;let o;if(s<n[e+i-1])return r?(o=n.slice(e,e+i),o[i-1]=s,o):null;if(n[t-1]<s)return r?(o=n.slice(t-i,t),o[i-1]=s,o):null;if(s==n[e+i-1])return n.slice(e,e+i);let a=e/i,l=t/i;for(;a<l;){const d=a+l>>1;s<n[(d+1)*i-1]?l=d:a=d+1}const h=n[a*i-1];if(s==h)return n.slice((a-1)*i,(a-1)*i+i);const c=n[(a+1)*i-1],u=(s-h)/(c-h);o=[];for(let d=0;d<i-1;++d)o.push(ci(n[(a-1)*i+d],n[a*i+d],u));return o.push(s),o}function _w(n,e,t,i,s,r,o){if(o)return Ru(n,e,t[t.length-1],i,s,r);let a;if(s<n[i-1])return r?(a=n.slice(0,i),a[i-1]=s,a):null;if(n[n.length-1]<s)return r?(a=n.slice(n.length-i),a[i-1]=s,a):null;for(let l=0,h=t.length;l<h;++l){const c=t[l];if(e!=c){if(s<n[e+i-1])return null;if(s<=n[c-1])return Ru(n,e,c,i,s,!1);e=c}}return null}function vw(n,e,t,i,s){return!Id(s,function(o){return!Es(n,e,t,i,o[0],o[1])})}function Es(n,e,t,i,s,r){let o=0,a=n[t-i],l=n[t-i+1];for(;e<t;e+=i){const h=n[e],c=n[e+1];l<=r?c>r&&(h-a)*(r-l)-(s-a)*(c-l)>0&&o++:c<=r&&(h-a)*(r-l)-(s-a)*(c-l)<0&&o--,a=h,l=c}return o!==0}function Jd(n,e,t,i,s,r){if(t.length===0||!Es(n,e,t[0],i,s,r))return!1;for(let o=1,a=t.length;o<a;++o)if(Es(n,t[o-1],t[o],i,s,r))return!1;return!0}function xw(n,e,t,i,s,r){if(t.length===0)return!1;for(let o=0,a=t.length;o<a;++o){const l=t[o];if(Jd(n,e,l,i,s,r))return!0;e=l[l.length-1]}return!1}function Jh(n,e,t,i,s){const r=wy(Xt(),n,e,t,i);return He(s,r)?Li(s,r)||r[0]>=s[0]&&r[2]<=s[2]||r[1]>=s[1]&&r[3]<=s[3]?!0:qy(n,e,t,i,function(o,a){return p1(s,o,a)}):!1}function ww(n,e,t,i,s){for(let r=0,o=t.length;r<o;++r){if(Jh(n,e,t[r],i,s))return!0;e=t[r]}return!1}function Vy(n,e,t,i,s){return!!(Jh(n,e,t,i,s)||Es(n,e,t,i,s[0],s[1])||Es(n,e,t,i,s[0],s[3])||Es(n,e,t,i,s[2],s[1])||Es(n,e,t,i,s[2],s[3]))}function Wy(n,e,t,i,s){if(!Vy(n,e,t[0],i,s))return!1;if(t.length===1)return!0;for(let r=1,o=t.length;r<o;++r)if(vw(n,t[r-1],t[r],i,s)&&!Jh(n,t[r-1],t[r],i,s))return!1;return!0}function bw(n,e,t,i,s){for(let r=0,o=t.length;r<o;++r){const a=t[r];if(Wy(n,e,a,i,s))return!0;e=a[a.length-1]}return!1}function Hy(n,e,t,i){let s=n[e],r=n[e+1],o=0;for(let a=e+i;a<t;a+=i){const l=n[a],h=n[a+1];o+=Math.sqrt((l-s)*(l-s)+(h-r)*(h-r)),s=l,r=h}return o}class Vl extends An{constructor(e,t){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendCoordinate(e){this.flatCoordinates?kt(this.flatCoordinates,e):this.flatCoordinates=e.slice(),this.changed()}clone(){const e=new Vl(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,s){return s<Ws(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Wd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Xd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,i,s))}forEachSegment(e){return qy(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinateAtM(e,t){return this.layout!="XYM"&&this.layout!="XYZM"?null:(t=t!==void 0?t:!1,Ru(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t))}getCoordinates(){return Wn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(e,t){return ql(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,this.stride)}getLength(){return Hy(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(e){const t=[];return t.length=Kd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new Vl(t,"XY")}getType(){return"LineString"}intersectsExtent(e){return Jh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Kh(this.flatCoordinates,0,e,this.stride),this.changed()}}const $i=Vl;function Xy(n,e,t,i){let s=0,r=n[t-i],o=n[t-i+1];for(;e<t;e+=i){const a=n[e],l=n[e+1];s+=o*a-r*l,r=a,o=l}return s/2}function Yy(n,e,t,i){let s=0;for(let r=0,o=t.length;r<o;++r){const a=t[r];s+=Xy(n,e,a,i),e=a}return s}function Ew(n,e,t,i){let s=0;for(let r=0,o=t.length;r<o;++r){const a=t[r];s+=Yy(n,e,a,i),e=a[a.length-1]}return s}class Wl extends An{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}clone(){return new Wl(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,i,s){return s<Ws(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Wd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Xd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,i,s))}getArea(){return Xy(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Wn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=Kd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new Wl(t,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Kh(this.flatCoordinates,0,e,this.stride),this.changed()}}const Lu=Wl;class Hl extends An{constructor(e,t,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,t);else if(t!==void 0&&i)this.setFlatCoordinates(t,e),this.ends_=i;else{let s=this.getLayout();const r=e,o=[],a=[];for(let l=0,h=r.length;l<h;++l){const c=r[l];l===0&&(s=c.getLayout()),kt(o,c.getFlatCoordinates()),a.push(o.length)}this.setFlatCoordinates(s,o),this.ends_=a}}appendLineString(e){this.flatCoordinates?kt(this.flatCoordinates,e.getFlatCoordinates().slice()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Hl(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,s){return s<Ws(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Hd(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Yd(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,i,s))}getCoordinateAtM(e,t,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(t=t!==void 0?t:!1,i=i!==void 0?i:!1,_w(this.flatCoordinates,0,this.ends_,this.stride,e,t,i))}getCoordinates(){return qo(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new $i(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){const e=this.flatCoordinates,t=this.ends_,i=this.layout,s=[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=t[o],h=new $i(e.slice(r,l),i);s.push(h),r=l}return s}getFlatMidpoints(){const e=[],t=this.flatCoordinates;let i=0;const s=this.ends_,r=this.stride;for(let o=0,a=s.length;o<a;++o){const l=s[o],h=ql(t,i,l,r,.5);kt(e,h),i=l}return e}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=pw(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,i),new Hl(t,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(e){return ww(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=Zd(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}const Xs=Hl;let Cw=class Zy extends An{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new Zy(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,s){const r=this.flatCoordinates,o=Mn(e,t,r[0],r[1]);if(o<s){const a=this.stride;for(let l=0;l<a;++l)i[l]=r[l];return i.length=a,o}return s}getCoordinates(){return this.flatCoordinates?this.flatCoordinates.slice():[]}computeExtent(e){return Rr(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return Rd(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=jy(this.flatCoordinates,0,e,this.stride),this.changed()}};const Ht=Cw;class Qd extends An{constructor(e,t){super(),t&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendPoint(e){this.flatCoordinates?kt(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.changed()}clone(){const e=new Qd(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,s){if(s<Ws(this.getExtent(),e,t))return s;const r=this.flatCoordinates,o=this.stride;for(let a=0,l=r.length;a<l;a+=o){const h=Mn(e,t,r[a],r[a+1]);if(h<s){s=h;for(let c=0;c<o;++c)i[c]=r[a+c];i.length=o}}return s}getCoordinates(){return Wn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){const t=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return e<0||t<=e?null:new Ht(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){const e=this.flatCoordinates,t=this.layout,i=this.stride,s=[];for(let r=0,o=e.length;r<o;r+=i){const a=new Ht(e.slice(r,r+i),t);s.push(a)}return s}getType(){return"MultiPoint"}intersectsExtent(e){const t=this.flatCoordinates,i=this.stride;for(let s=0,r=t.length;s<r;s+=i){const o=t[s],a=t[s+1];if(Rd(e,o,a))return!0}return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Kh(this.flatCoordinates,0,e,this.stride),this.changed()}}const go=Qd;function ef(n,e,t,i,s,r,o){let a,l,h,c,u,d,f;const g=s[r+1],p=[];for(let y=0,x=t.length;y<x;++y){const w=t[y];for(c=n[w-i],d=n[w-i+1],a=e;a<w;a+=i)u=n[a],f=n[a+1],(g<=d&&f<=g||d<=g&&g<=f)&&(h=(g-d)/(f-d)*(u-c)+c,p.push(h)),c=u,d=f}let m=NaN,v=-1/0;for(p.sort(rs),c=p[0],a=1,l=p.length;a<l;++a){u=p[a];const y=Math.abs(u-c);y>v&&(h=(c+u)/2,Jd(n,e,t,i,h,g)&&(m=h,v=y)),c=u}return isNaN(m)&&(m=s[r]),o?(o.push(m,g,v),o):[m,g,v]}function Ky(n,e,t,i,s){let r=[];for(let o=0,a=t.length;o<a;++o){const l=t[o];r=ef(n,e,l,i,s,2*o,r),e=l[l.length-1]}return r}function Mw(n,e,t,i){for(;e<t-i;){for(let s=0;s<i;++s){const r=n[e+s];n[e+s]=n[t-i+s],n[t-i+s]=r}e+=i,t-=i}}function tf(n,e,t,i){let s=0,r=n[t-i],o=n[t-i+1];for(;e<t;e+=i){const a=n[e],l=n[e+1];s+=(a-r)*(l+o),r=a,o=l}return s===0?void 0:s>0}function Jy(n,e,t,i,s){s=s!==void 0?s:!1;for(let r=0,o=t.length;r<o;++r){const a=t[r],l=tf(n,e,a,i);if(r===0){if(s&&l||!s&&!l)return!1}else if(s&&!l||!s&&l)return!1;e=a}return!0}function Sw(n,e,t,i,s){for(let r=0,o=t.length;r<o;++r){const a=t[r];if(!Jy(n,e,a,i,s))return!1;a.length&&(e=a[a.length-1])}return!0}function Iu(n,e,t,i,s){s=s!==void 0?s:!1;for(let r=0,o=t.length;r<o;++r){const a=t[r],l=tf(n,e,a,i);(r===0?s&&l||!s&&!l:s&&!l||!s&&l)&&Mw(n,e,a,i),e=a}return e}function Jg(n,e,t,i,s){for(let r=0,o=t.length;r<o;++r)e=Iu(n,e,t[r],i,s);return e}function Tw(n,e){const t=[];let i=0,s=0;for(let r=0,o=e.length;r<o;++r){const a=e[r];if(!tf(n,i,a,2))t.push(e.slice(s,r+1));else{if(t.length===0)continue;t[t.length-1].push(e[s])}s=r+1,i=a}return t}class zs extends An{constructor(e,t,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,t!==void 0&&i?(this.setFlatCoordinates(t,e),this.ends_=i):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?kt(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new zs(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,s){return s<Ws(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Hd(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Yd(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,i,s))}containsXY(e,t){return Jd(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return Yy(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),Iu(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,qo(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=Nt(this.getExtent());this.flatInteriorPoint_=ef(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Ht(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new Lu(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,t=this.flatCoordinates,i=this.ends_,s=[];let r=0;for(let o=0,a=i.length;o<a;++o){const l=i[o],h=new Lu(t.slice(r,l),e);s.push(h),r=l}return s}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;Jy(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=Iu(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=$y(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,i),new zs(t,"XY",i)}getType(){return"Polygon"}intersectsExtent(e){return Wy(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=Zd(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}const Wi=zs;function Rw(n,e,t,i){t=t||32;const s=[];for(let r=0;r<t;++r)kt(s,I1(n,e,2*Math.PI*r/t,i));return s.push(s[0],s[1]),new zs(s,"XY",[s.length])}function Qg(n){if(Hs(n))throw new Error("Cannot create polygon from empty extent");const e=n[0],t=n[1],i=n[2],s=n[3],r=[e,t,e,s,i,s,i,t,e,t];return new zs(r,"XY",[r.length])}function Qy(n,e,t){e=e||32;const i=n.getStride(),s=n.getLayout(),r=n.getCenter(),o=i*(e+1),a=new Array(o);for(let c=0;c<o;c+=i){a[c]=0,a[c+1]=0;for(let u=2;u<i;u++)a[c+u]=r[u]}const l=[a.length],h=new zs(a,s,l);return e0(h,r,n.getRadius(),t),h}function e0(n,e,t,i){const s=n.getFlatCoordinates(),r=n.getStride(),o=s.length/r-1,a=i||0;for(let l=0;l<=o;++l){const h=l*r,c=a+Jn(l,o)*2*Math.PI/o;s[h]=e[0]+t*Math.cos(c),s[h+1]=e[1]+t*Math.sin(c)}n.changed()}function t0(n,e,t,i){const s=[];let r=Xt();for(let o=0,a=t.length;o<a;++o){const l=t[o];r=Ld(n,e,l[0],i),s.push((r[0]+r[2])/2,(r[1]+r[3])/2),e=l[l.length-1]}return s}class Xl extends An{constructor(e,t,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(e[0])){let s=this.getLayout();const r=e,o=[],a=[];for(let l=0,h=r.length;l<h;++l){const c=r[l];l===0&&(s=c.getLayout());const u=o.length,d=c.getEnds();for(let f=0,g=d.length;f<g;++f)d[f]+=u;kt(o,c.getFlatCoordinates()),a.push(d)}t=s,e=o,i=a}t!==void 0&&i?(this.setFlatCoordinates(t,e),this.endss_=i):this.setCoordinates(e,t)}appendPolygon(e){let t;if(!this.flatCoordinates)this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;kt(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let s=0,r=t.length;s<r;++s)t[s]+=i}this.endss_.push(t),this.changed()}clone(){const e=this.endss_.length,t=new Array(e);for(let s=0;s<e;++s)t[s]=this.endss_[s].slice();const i=new Xl(this.flatCoordinates.slice(),this.layout,t);return i.applyProperties(this),i}closestPointXY(e,t,i,s){return s<Ws(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(dw(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),fw(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,i,s))}containsXY(e,t){return xw(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)}getArea(){return Ew(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),Jg(t,0,this.endss_,this.stride,e)):t=this.flatCoordinates,Tu(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=t0(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Ky(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new go(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;Sw(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=Jg(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=yw(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,i),new Xl(t,"XY",i)}getPolygon(e){if(e<0||this.endss_.length<=e)return null;let t;if(e===0)t=0;else{const r=this.endss_[e-1];t=r[r.length-1]}const i=this.endss_[e].slice(),s=i[i.length-1];if(t!==0)for(let r=0,o=i.length;r<o;++r)i[r]-=t;return new Wi(this.flatCoordinates.slice(t,s),this.layout,i)}getPolygons(){const e=this.layout,t=this.flatCoordinates,i=this.endss_,s=[];let r=0;for(let o=0,a=i.length;o<a;++o){const l=i[o].slice(),h=l[l.length-1];if(r!==0)for(let u=0,d=l.length;u<d;++u)l[u]-=r;const c=new Wi(t.slice(r,h),e,l);s.push(c),r=h}return s}getType(){return"MultiPolygon"}intersectsExtent(e){return bw(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=gw(this.flatCoordinates,0,e,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const s=i[i.length-1];this.flatCoordinates.length=s.length===0?0:s[s.length-1]}this.changed()}}const Ys=Xl;class Yl extends no{constructor(e){super(),this.geometries_=e||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(De),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let e=0,t=this.geometries_.length;e<t;++e)this.changeEventsKeys_.push(pe(this.geometries_[e],K.CHANGE,this.changed,this))}clone(){const e=new Yl(null);return e.setGeometries(this.geometries_),e.applyProperties(this),e}closestPointXY(e,t,i,s){if(s<Ws(this.getExtent(),e,t))return s;const r=this.geometries_;for(let o=0,a=r.length;o<a;++o)s=r[o].closestPointXY(e,t,i,s);return s}containsXY(e,t){const i=this.geometries_;for(let s=0,r=i.length;s<r;++s)if(i[s].containsXY(e,t))return!0;return!1}computeExtent(e){uo(e);const t=this.geometries_;for(let i=0,s=t.length;i<s;++i)xy(e,t[i].getExtent());return e}getGeometries(){return ep(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[];const t=this.geometries_;for(let i=0,s=t.length;i<s;++i)t[i].getType()===this.getType()?e=e.concat(t[i].getGeometriesArrayRecursive()):e.push(t[i]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=[],i=this.geometries_;let s=!1;for(let r=0,o=i.length;r<o;++r){const a=i[r],l=a.getSimplifiedGeometry(e);t.push(l),l!==a&&(s=!0)}if(s){const r=new Yl(null);return r.setGeometriesArray(t),r}return this.simplifiedGeometryMaxMinSquaredTolerance=e,this}getType(){return"GeometryCollection"}intersectsExtent(e){const t=this.geometries_;for(let i=0,s=t.length;i<s;++i)if(t[i].intersectsExtent(e))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(e,t){const i=this.geometries_;for(let s=0,r=i.length;s<r;++s)i[s].rotate(e,t);this.changed()}scale(e,t,i){i||(i=Nt(this.getExtent()));const s=this.geometries_;for(let r=0,o=s.length;r<o;++r)s[r].scale(e,t,i);this.changed()}setGeometries(e){this.setGeometriesArray(ep(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){const t=this.geometries_;for(let i=0,s=t.length;i<s;++i)t[i].applyTransform(e);this.changed()}translate(e,t){const i=this.geometries_;for(let s=0,r=i.length;s<r;++s)i[s].translate(e,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function ep(n){const e=[];for(let t=0,i=n.length;t<i;++t)e.push(n[t].clone());return e}const i0=Yl;class Lw extends tw{constructor(e){e=e||{},super(),this.dataProjection=X(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=X(e.featureProjection)),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let i=null;e.type==="Feature"?i=e:i={type:"Feature",geometry:e,properties:null};const s=Pu(i.geometry,t),r=new tn;return this.geometryName_?r.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in i!==void 0&&r.setGeometryName(i.geometry_name),r.setGeometry(s),"id"in i&&r.setId(i.id),i.properties&&r.setProperties(i.properties,!0),r}readFeaturesFromObject(e,t){const i=e;let s=null;if(i.type==="FeatureCollection"){const r=e;s=[];const o=r.features;for(let a=0,l=o.length;a<l;++a)s.push(this.readFeatureFromObject(o[a],t))}else s=[this.readFeatureFromObject(e,t)];return s}readGeometryFromObject(e,t){return Pu(e,t)}readProjectionFromObject(e){const t=e.crs;let i;if(t)if(t.type=="name")i=X(t.properties.name);else if(t.type==="EPSG")i=X("EPSG:"+t.properties.code);else throw new Error("Unknown SRS type");else i=this.dataProjection;return i}writeFeatureObject(e,t){t=this.adaptOptions(t);const i={type:"Feature",geometry:null,properties:null},s=e.getId();if(s!==void 0&&(i.id=s),!e.hasProperties())return i;const r=e.getProperties(),o=e.getGeometry();return o&&(i.geometry=Au(o,t),delete r[e.getGeometryName()]),ks(r)||(i.properties=r),i}writeFeaturesObject(e,t){t=this.adaptOptions(t);const i=[];for(let s=0,r=e.length;s<r;++s)i.push(this.writeFeatureObject(e[s],t));return{type:"FeatureCollection",features:i}}writeGeometryObject(e,t){return Au(e,this.adaptOptions(t))}}function Pu(n,e){if(!n)return null;let t;switch(n.type){case"Point":{t=Pw(n);break}case"LineString":{t=Aw(n);break}case"Polygon":{t=Nw(n);break}case"MultiPoint":{t=Ow(n);break}case"MultiLineString":{t=Fw(n);break}case"MultiPolygon":{t=kw(n);break}case"GeometryCollection":{t=Iw(n);break}default:throw new Error("Unsupported GeoJSON type: "+n.type)}return fo(t,!1,e)}function Iw(n,e){const t=n.geometries.map(function(i){return Pu(i,e)});return new i0(t)}function Pw(n){return new Ht(n.coordinates)}function Aw(n){return new $i(n.coordinates)}function Fw(n){return new Xs(n.coordinates)}function Ow(n){return new go(n.coordinates)}function kw(n){return new Ys(n.coordinates)}function Nw(n){return new Wi(n.coordinates)}function Au(n,e){n=fo(n,!0,e);const t=n.getType();let i;switch(t){case"Point":{i=jw(n);break}case"LineString":{i=Gw(n);break}case"Polygon":{i=$w(n,e);break}case"MultiPoint":{i=Bw(n);break}case"MultiLineString":{i=zw(n);break}case"MultiPolygon":{i=Uw(n,e);break}case"GeometryCollection":{i=Dw(n,e);break}case"Circle":{i={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+t)}return i}function Dw(n,e){return e=Object.assign({},e),delete e.featureProjection,{type:"GeometryCollection",geometries:n.getGeometriesArray().map(function(i){return Au(i,e)})}}function Gw(n,e){return{type:"LineString",coordinates:n.getCoordinates()}}function zw(n,e){return{type:"MultiLineString",coordinates:n.getCoordinates()}}function Bw(n,e){return{type:"MultiPoint",coordinates:n.getCoordinates()}}function Uw(n,e){let t;return e&&(t=e.rightHanded),{type:"MultiPolygon",coordinates:n.getCoordinates(t)}}function jw(n,e){return{type:"Point",coordinates:n.getCoordinates()}}function $w(n,e){let t;return e&&(t=e.rightHanded),{type:"Polygon",coordinates:n.getCoordinates(t)}}const tp=Lw,Fu="http://www.w3.org/2001/XMLSchema-instance";function ce(n,e){return o0().createElementNS(n,e)}function Bs(n,e){return n0(n,e,[]).join("")}function n0(n,e,t){if(n.nodeType==Node.CDATA_SECTION_NODE||n.nodeType==Node.TEXT_NODE)e?t.push(String(n.nodeValue).replace(/(\r\n|\r|\n)/g,"")):t.push(n.nodeValue);else{let i;for(i=n.firstChild;i;i=i.nextSibling)n0(i,e,t)}return t}function Cs(n){return"documentElement"in n}function qw(n,e,t){return n.getAttributeNS(e,t)||""}function Ms(n){return new DOMParser().parseFromString(n,"application/xml")}function s0(n,e){return function(t,i){const s=n.call(e!==void 0?e:this,t,i);if(s!==void 0){const r=i[i.length-1];kt(r,s)}}}function ne(n,e){return function(t,i){const s=n.call(e!==void 0?e:this,t,i);s!==void 0&&i[i.length-1].push(s)}}function J(n,e){return function(t,i){const s=n.call(e!==void 0?e:this,t,i);s!==void 0&&(i[i.length-1]=s)}}function di(n,e,t){return function(i,s){const r=n.call(t!==void 0?t:this,i,s);if(r!==void 0){const o=s[s.length-1],a=e!==void 0?e:i.localName;let l;a in o?l=o[a]:(l=[],o[a]=l),l.push(r)}}}function V(n,e,t){return function(i,s){const r=n.call(t!==void 0?t:this,i,s);if(r!==void 0){const o=s[s.length-1],a=e!==void 0?e:i.localName;o[a]=r}}}function T(n,e){return function(t,i,s){n.call(e!==void 0?e:this,t,i,s),s[s.length-1].node.appendChild(t)}}function mi(n,e){return function(t,i,s){const o=i[i.length-1].node;let a=n;a===void 0&&(a=s);const l=e!==void 0?e:o.namespaceURI;return ce(l,a)}}const r0=mi();function Ge(n,e,t){t=t!==void 0?t:{};let i,s;for(i=0,s=n.length;i<s;++i)t[n[i]]=e;return t}function Ls(n,e,t,i){let s;for(s=e.firstElementChild;s;s=s.nextElementSibling){const r=n[s.namespaceURI];if(r!==void 0){const o=r[s.localName];o!==void 0&&o.call(i,s,t)}}}function Y(n,e,t,i,s){return i.push(n),Ls(e,t,i,s),i.pop()}function Vw(n,e,t,i,s,r){const o=(s!==void 0?s:t).length;let a,l;for(let h=0;h<o;++h)a=t[h],a!==void 0&&(l=e.call(r!==void 0?r:this,a,i,s!==void 0?s[h]:void 0),l!==void 0&&n[l.namespaceURI][l.localName].call(r,l,a,i))}function et(n,e,t,i,s,r,o){return s.push(n),Vw(e,t,i,s,r,o),s.pop()}let bc;function Ww(){return bc===void 0&&typeof XMLSerializer<"u"&&(bc=new XMLSerializer),bc}let Ec;function o0(){return Ec===void 0&&typeof document<"u"&&(Ec=document.implementation.createDocument("","",null)),Ec}class Hw extends jd{constructor(){super(),this.xmlSerializer_=Ww()}getType(){return"xml"}readFeature(e,t){if(!e)return null;if(typeof e=="string"){const i=Ms(e);return this.readFeatureFromDocument(i,t)}return Cs(e)?this.readFeatureFromDocument(e,t):this.readFeatureFromNode(e,t)}readFeatureFromDocument(e,t){const i=this.readFeaturesFromDocument(e,t);return i.length>0?i[0]:null}readFeatureFromNode(e,t){return null}readFeatures(e,t){if(!e)return[];if(typeof e=="string"){const i=Ms(e);return this.readFeaturesFromDocument(i,t)}return Cs(e)?this.readFeaturesFromDocument(e,t):this.readFeaturesFromNode(e,t)}readFeaturesFromDocument(e,t){const i=[];for(let s=e.firstChild;s;s=s.nextSibling)s.nodeType==Node.ELEMENT_NODE&&kt(i,this.readFeaturesFromNode(s,t));return i}readFeaturesFromNode(e,t){return ie()}readGeometry(e,t){if(!e)return null;if(typeof e=="string"){const i=Ms(e);return this.readGeometryFromDocument(i,t)}return Cs(e)?this.readGeometryFromDocument(e,t):this.readGeometryFromNode(e,t)}readGeometryFromDocument(e,t){return null}readGeometryFromNode(e,t){return null}readProjection(e){if(!e)return null;if(typeof e=="string"){const t=Ms(e);return this.readProjectionFromDocument(t)}return Cs(e)?this.readProjectionFromDocument(e):this.readProjectionFromNode(e)}readProjectionFromDocument(e){return this.dataProjection}readProjectionFromNode(e){return this.dataProjection}writeFeature(e,t){const i=this.writeFeatureNode(e,t);return this.xmlSerializer_.serializeToString(i)}writeFeatureNode(e,t){return null}writeFeatures(e,t){const i=this.writeFeaturesNode(e,t);return this.xmlSerializer_.serializeToString(i)}writeFeaturesNode(e,t){return null}writeGeometry(e,t){const i=this.writeGeometryNode(e,t);return this.xmlSerializer_.serializeToString(i)}writeGeometryNode(e,t){return null}}const a0=Hw,Sn="http://www.opengis.net/gml",Xw=/^\s*$/;class tt extends a0{constructor(e){super(),e=e||{},this.featureType=e.featureType,this.featureNS=e.featureNS,this.srsName=e.srsName,this.schemaLocation="",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:ne(this.readFeaturesInternal),featureMembers:J(this.readFeaturesInternal)},this.supportedMediaTypes=["application/gml+xml"]}readFeaturesInternal(e,t){const i=e.localName;let s=null;if(i=="FeatureCollection")s=Y([],this.FEATURE_COLLECTION_PARSERS,e,t,this);else if(i=="featureMembers"||i=="featureMember"||i=="member"){const r=t[0];let o=r.featureType,a=r.featureNS;const l="p",h="p0";if(!o&&e.childNodes){o=[],a={};for(let d=0,f=e.childNodes.length;d<f;++d){const g=e.childNodes[d];if(g.nodeType===1){const p=g.nodeName.split(":").pop();if(!o.includes(p)){let m="",v=0;const y=g.namespaceURI;for(const x in a){if(a[x]===y){m=x;break}++v}m||(m=l+v,a[m]=y),o.push(m+":"+p)}}}i!="featureMember"&&(r.featureType=o,r.featureNS=a)}if(typeof a=="string"){const d=a;a={},a[h]=d}const c={},u=Array.isArray(o)?o:[o];for(const d in a){const f={};for(let g=0,p=u.length;g<p;++g)(u[g].includes(":")?u[g].split(":")[0]:h)===d&&(f[u[g].split(":").pop()]=i=="featureMembers"?ne(this.readFeatureElement,this):J(this.readFeatureElement,this));c[a[d]]=f}i=="featureMember"||i=="member"?s=Y(void 0,c,e,t):s=Y([],c,e,t)}return s===null&&(s=[]),s}readGeometryOrExtent(e,t){const i=t[0];return i.srsName=e.firstElementChild.getAttribute("srsName"),i.srsDimension=e.firstElementChild.getAttribute("srsDimension"),Y(null,this.GEOMETRY_PARSERS,e,t,this)}readExtentElement(e,t){const i=t[0],s=this.readGeometryOrExtent(e,t);return s?$d(s,i):void 0}readGeometryElement(e,t){const i=t[0],s=this.readGeometryOrExtent(e,t);return s?fo(s,!1,i):void 0}readFeatureElementInternal(e,t,i){let s;const r={};for(let l=e.firstElementChild;l;l=l.nextElementSibling){let h;const c=l.localName;l.childNodes.length===0||l.childNodes.length===1&&(l.firstChild.nodeType===3||l.firstChild.nodeType===4)?(h=Bs(l,!1),Xw.test(h)&&(h=void 0)):(i&&(h=c==="boundedBy"?this.readExtentElement(l,t):this.readGeometryElement(l,t)),h?c!=="boundedBy"&&(s=c):h=this.readFeatureElementInternal(l,t,!1));const u=l.attributes.length;if(u>0&&!(h instanceof no)){h={_content_:h};for(let d=0;d<u;d++){const f=l.attributes[d].name;h[f]=l.attributes[d].value}}r[c]?(r[c]instanceof Array||(r[c]=[r[c]]),r[c].push(h)):r[c]=h}if(!i)return r;const o=new tn(r);s&&o.setGeometryName(s);const a=e.getAttribute("fid")||qw(e,this.namespace,"id");return a&&o.setId(a),o}readFeatureElement(e,t){return this.readFeatureElementInternal(e,t,!0)}readPoint(e,t){const i=this.readFlatCoordinatesFromNode(e,t);if(i)return new Ht(i,"XYZ")}readMultiPoint(e,t){const i=Y([],this.MULTIPOINT_PARSERS,e,t,this);if(i)return new go(i)}readMultiLineString(e,t){const i=Y([],this.MULTILINESTRING_PARSERS,e,t,this);if(i)return new Xs(i)}readMultiPolygon(e,t){const i=Y([],this.MULTIPOLYGON_PARSERS,e,t,this);if(i)return new Ys(i)}pointMemberParser(e,t){Ls(this.POINTMEMBER_PARSERS,e,t,this)}lineStringMemberParser(e,t){Ls(this.LINESTRINGMEMBER_PARSERS,e,t,this)}polygonMemberParser(e,t){Ls(this.POLYGONMEMBER_PARSERS,e,t,this)}readLineString(e,t){const i=this.readFlatCoordinatesFromNode(e,t);if(i)return new $i(i,"XYZ")}readFlatLinearRing(e,t){const i=Y(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this);if(i)return i}readLinearRing(e,t){const i=this.readFlatCoordinatesFromNode(e,t);if(i)return new Lu(i,"XYZ")}readPolygon(e,t){const i=Y([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this);if(i&&i[0]){const s=i[0],r=[s.length];let o,a;for(o=1,a=i.length;o<a;++o)kt(s,i[o]),r.push(s.length);return new Wi(s,"XYZ",r)}}readFlatCoordinatesFromNode(e,t){return Y(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}readGeometryFromNode(e,t){const i=this.readGeometryElement(e,[this.getReadOptions(e,t||{})]);return i||null}readFeaturesFromNode(e,t){const i={featureType:this.featureType,featureNS:this.featureNS};return i&&Object.assign(i,this.getReadOptions(e,t)),this.readFeaturesInternal(e,[i])||[]}readProjectionFromNode(e){return X(this.srsName?this.srsName:e.firstElementChild.getAttribute("srsName"))}}tt.prototype.namespace=Sn;tt.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}};tt.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}};tt.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}};tt.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:ne(tt.prototype.pointMemberParser),pointMembers:ne(tt.prototype.pointMemberParser)}};tt.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:ne(tt.prototype.lineStringMemberParser),lineStringMembers:ne(tt.prototype.lineStringMemberParser)}};tt.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:ne(tt.prototype.polygonMemberParser),polygonMembers:ne(tt.prototype.polygonMemberParser)}};tt.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:ne(tt.prototype.readFlatCoordinatesFromNode)}};tt.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:ne(tt.prototype.readLineString)}};tt.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:ne(tt.prototype.readPolygon)}};tt.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:J(tt.prototype.readFlatLinearRing)}};const de=tt;function Yw(n){const e=Bs(n,!1);return Zw(e)}function Zw(n){const e=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(n);if(e)return parseFloat(e[1])}function ei(n){const e=Bs(n,!1);return pr(e)}function pr(n){const e=/^\s*(\d+)\s*$/.exec(n);if(e)return parseInt(e[1],10)}function Se(n){return Bs(n,!1).trim()}function ct(n,e){n.appendChild(o0().createTextNode(e))}const Kw=Sn+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",Jw={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class Ce extends de{constructor(e){e=e||{},super(e),this.FEATURE_COLLECTION_PARSERS[Sn].featureMember=ne(this.readFeaturesInternal),this.schemaLocation=e.schemaLocation?e.schemaLocation:Kw}readFlatCoordinates(e,t){const i=Bs(e,!1).replace(/^\s*|\s*$/g,""),r=t[0].srsName;let o="enu";if(r){const h=X(r);h&&(o=h.getAxisOrientation())}const a=i.trim().split(/\s+/),l=[];for(let h=0,c=a.length;h<c;h++){const u=a[h].split(/,+/),d=parseFloat(u[0]),f=parseFloat(u[1]),g=u.length===3?parseFloat(u[2]):0;o.substr(0,2)==="en"?l.push(d,f,g):l.push(f,d,g)}return l}readBox(e,t){const i=Y([null],this.BOX_PARSERS_,e,t,this);return Pi(i[1][0],i[1][1],i[1][3],i[1][4])}innerBoundaryIsParser(e,t){const i=Y(void 0,this.RING_PARSERS,e,t,this);i&&t[t.length-1].push(i)}outerBoundaryIsParser(e,t){const i=Y(void 0,this.RING_PARSERS,e,t,this);if(i){const s=t[t.length-1];s[0]=i}}GEOMETRY_NODE_FACTORY_(e,t,i){const s=t[t.length-1],r=s.multiSurface,o=s.surface,a=s.multiCurve;return Array.isArray(e)?i="Envelope":(i=e.getType(),i==="MultiPolygon"&&r===!0?i="MultiSurface":i==="Polygon"&&o===!0?i="Surface":i==="MultiLineString"&&a===!0&&(i="MultiCurve")),ce("http://www.opengis.net/gml",i)}writeFeatureElement(e,t,i){const s=t.getId();s&&e.setAttribute("fid",s);const r=i[i.length-1],o=r.featureNS,a=t.getGeometryName();r.serializers||(r.serializers={},r.serializers[o]={});const l=[],h=[];if(t.hasProperties()){const u=t.getProperties();for(const d in u){const f=u[d];f!==null&&(l.push(d),h.push(f),d==a||typeof f.getSimplifiedGeometry=="function"?d in r.serializers[o]||(r.serializers[o][d]=T(this.writeGeometryElement,this)):d in r.serializers[o]||(r.serializers[o][d]=T(ct)))}}const c=Object.assign({},r);c.node=e,et(c,r.serializers,mi(void 0,o),h,i,l)}writeCurveOrLineString(e,t,i){const r=i[i.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&r&&e.setAttribute("srsName",r),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o),this.writeCoordinates_(o,t,i)}else if(e.nodeName==="Curve"){const o=ce(e.namespaceURI,"segments");e.appendChild(o),this.writeCurveSegments_(o,t,i)}}writeLineStringOrCurveMember(e,t,i){const s=this.GEOMETRY_NODE_FACTORY_(t,i);s&&(e.appendChild(s),this.writeCurveOrLineString(s,t,i))}writeMultiCurveOrLineString(e,t,i){const s=i[i.length-1],r=s.hasZ,o=s.srsName,a=s.curve;o&&e.setAttribute("srsName",o);const l=t.getLineStrings();et({node:e,hasZ:r,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,i,void 0,this)}writeGeometryElement(e,t,i){const s=i[i.length-1],r=Object.assign({},s);r.node=e;let o;Array.isArray(t)?o=$d(t,s):o=fo(t,!0,s),et(r,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],i,void 0,this)}createCoordinatesNode_(e){const t=ce(e,"coordinates");return t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," "),t}writeCoordinates_(e,t,i){const s=i[i.length-1],r=s.hasZ,o=s.srsName,a=t.getCoordinates(),l=a.length,h=new Array(l);for(let c=0;c<l;++c){const u=a[c];h[c]=this.getCoords_(u,o,r)}ct(e,h.join(" "))}writeCurveSegments_(e,t,i){const s=ce(e.namespaceURI,"LineStringSegment");e.appendChild(s),this.writeCurveOrLineString(s,t,i)}writeSurfaceOrPolygon(e,t,i){const s=i[i.length-1],r=s.hasZ,o=s.srsName;if(e.nodeName!=="PolygonPatch"&&o&&e.setAttribute("srsName",o),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const a=t.getLinearRings();et({node:e,hasZ:r,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,i,void 0,this)}else if(e.nodeName==="Surface"){const a=ce(e.namespaceURI,"patches");e.appendChild(a),this.writeSurfacePatches_(a,t,i)}}RING_NODE_FACTORY_(e,t,i){const s=t[t.length-1],r=s.node,o=s.exteriorWritten;return o===void 0&&(s.exteriorWritten=!0),ce(r.namespaceURI,o!==void 0?"innerBoundaryIs":"outerBoundaryIs")}writeSurfacePatches_(e,t,i){const s=ce(e.namespaceURI,"PolygonPatch");e.appendChild(s),this.writeSurfaceOrPolygon(s,t,i)}writeRing(e,t,i){const s=ce(e.namespaceURI,"LinearRing");e.appendChild(s),this.writeLinearRing(s,t,i)}getCoords_(e,t,i){let s="enu";t&&(s=X(t).getAxisOrientation());let r=s.substr(0,2)==="en"?e[0]+","+e[1]:e[1]+","+e[0];if(i){const o=e[2]||0;r+=","+o}return r}writePoint(e,t,i){const s=i[i.length-1],r=s.hasZ,o=s.srsName;o&&e.setAttribute("srsName",o);const a=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(a);const l=t.getCoordinates(),h=this.getCoords_(l,o,r);ct(a,h)}writeMultiPoint(e,t,i){const s=i[i.length-1],r=s.hasZ,o=s.srsName;o&&e.setAttribute("srsName",o);const a=t.getPoints();et({node:e,hasZ:r,srsName:o},this.POINTMEMBER_SERIALIZERS,mi("pointMember"),a,i,void 0,this)}writePointMember(e,t,i){const s=ce(e.namespaceURI,"Point");e.appendChild(s),this.writePoint(s,t,i)}writeLinearRing(e,t,i){const r=i[i.length-1].srsName;r&&e.setAttribute("srsName",r);const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o),this.writeCoordinates_(o,t,i)}writeMultiSurfaceOrPolygon(e,t,i){const s=i[i.length-1],r=s.hasZ,o=s.srsName,a=s.surface;o&&e.setAttribute("srsName",o);const l=t.getPolygons();et({node:e,hasZ:r,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,i,void 0,this)}writeSurfaceOrPolygonMember(e,t,i){const s=this.GEOMETRY_NODE_FACTORY_(t,i);s&&(e.appendChild(s),this.writeSurfaceOrPolygon(s,t,i))}writeEnvelope(e,t,i){const r=i[i.length-1].srsName;r&&e.setAttribute("srsName",r);const o=["lowerCorner","upperCorner"],a=[t[0]+" "+t[1],t[2]+" "+t[3]];et({node:e},this.ENVELOPE_SERIALIZERS,r0,a,i,o,this)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,i){const s=t[t.length-1].node;return ce("http://www.opengis.net/gml",Jw[s.nodeName])}}Ce.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:J(Ce.prototype.readFlatCoordinates)}};Ce.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:Ce.prototype.innerBoundaryIsParser,outerBoundaryIs:Ce.prototype.outerBoundaryIsParser}};Ce.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:ne(Ce.prototype.readFlatCoordinates)}};Ce.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:J(de.prototype.readPoint),MultiPoint:J(de.prototype.readMultiPoint),LineString:J(de.prototype.readLineString),MultiLineString:J(de.prototype.readMultiLineString),LinearRing:J(de.prototype.readLinearRing),Polygon:J(de.prototype.readPolygon),MultiPolygon:J(de.prototype.readMultiPolygon),Box:J(Ce.prototype.readBox)}};Ce.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:T(Ce.prototype.writeCurveOrLineString),MultiCurve:T(Ce.prototype.writeMultiCurveOrLineString),Point:T(Ce.prototype.writePoint),MultiPoint:T(Ce.prototype.writeMultiPoint),LineString:T(Ce.prototype.writeCurveOrLineString),MultiLineString:T(Ce.prototype.writeMultiCurveOrLineString),LinearRing:T(Ce.prototype.writeLinearRing),Polygon:T(Ce.prototype.writeSurfaceOrPolygon),MultiPolygon:T(Ce.prototype.writeMultiSurfaceOrPolygon),Surface:T(Ce.prototype.writeSurfaceOrPolygon),MultiSurface:T(Ce.prototype.writeMultiSurfaceOrPolygon),Envelope:T(Ce.prototype.writeEnvelope)}};Ce.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:T(Ce.prototype.writeLineStringOrCurveMember),curveMember:T(Ce.prototype.writeLineStringOrCurveMember)}};Ce.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:T(Ce.prototype.writeRing),innerBoundaryIs:T(Ce.prototype.writeRing)}};Ce.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:T(Ce.prototype.writePointMember)}};Ce.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:T(Ce.prototype.writeSurfaceOrPolygonMember),polygonMember:T(Ce.prototype.writeSurfaceOrPolygonMember)}};Ce.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:T(ct),upperCorner:T(ct)}};const Ta=Ce,Qw=Sn+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",eb={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class W extends de{constructor(e){e=e||{},super(e),this.surface_=e.surface!==void 0?e.surface:!1,this.curve_=e.curve!==void 0?e.curve:!1,this.multiCurve_=e.multiCurve!==void 0?e.multiCurve:!0,this.multiSurface_=e.multiSurface!==void 0?e.multiSurface:!0,this.schemaLocation=e.schemaLocation?e.schemaLocation:Qw,this.hasZ=e.hasZ!==void 0?e.hasZ:!1}readMultiCurve(e,t){const i=Y([],this.MULTICURVE_PARSERS,e,t,this);if(i)return new Xs(i)}readFlatCurveRing(e,t){const i=Y([],this.MULTICURVE_PARSERS,e,t,this),s=[];for(let r=0,o=i.length;r<o;++r)kt(s,i[r].getFlatCoordinates());return s}readMultiSurface(e,t){const i=Y([],this.MULTISURFACE_PARSERS,e,t,this);if(i)return new Ys(i)}curveMemberParser(e,t){Ls(this.CURVEMEMBER_PARSERS,e,t,this)}surfaceMemberParser(e,t){Ls(this.SURFACEMEMBER_PARSERS,e,t,this)}readPatch(e,t){return Y([null],this.PATCHES_PARSERS,e,t,this)}readSegment(e,t){return Y([],this.SEGMENTS_PARSERS,e,t,this)}readPolygonPatch(e,t){return Y([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this)}readLineStringSegment(e,t){return Y([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}interiorParser(e,t){const i=Y(void 0,this.RING_PARSERS,e,t,this);i&&t[t.length-1].push(i)}exteriorParser(e,t){const i=Y(void 0,this.RING_PARSERS,e,t,this);if(i){const s=t[t.length-1];s[0]=i}}readSurface(e,t){const i=Y([null],this.SURFACE_PARSERS,e,t,this);if(i&&i[0]){const s=i[0],r=[s.length];let o,a;for(o=1,a=i.length;o<a;++o)kt(s,i[o]),r.push(s.length);return new Wi(s,"XYZ",r)}}readCurve(e,t){const i=Y([null],this.CURVE_PARSERS,e,t,this);if(i)return new $i(i,"XYZ")}readEnvelope(e,t){const i=Y([null],this.ENVELOPE_PARSERS,e,t,this);return Pi(i[1][0],i[1][1],i[2][0],i[2][1])}readFlatPos(e,t){let i=Bs(e,!1);const s=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,r=[];let o;for(;o=s.exec(i);)r.push(parseFloat(o[1])),i=i.substr(o[0].length);if(i!=="")return;const l=t[0].srsName;let h="enu";if(l&&(h=X(l).getAxisOrientation()),h==="neu"){let u,d;for(u=0,d=r.length;u<d;u+=3){const f=r[u],g=r[u+1];r[u]=g,r[u+1]=f}}const c=r.length;if(c==2&&r.push(0),c!==0)return r}readFlatPosList(e,t){const i=Bs(e,!1).replace(/^\s*|\s*$/g,""),s=t[0],r=s.srsName,o=s.srsDimension;let a="enu";r&&(a=X(r).getAxisOrientation());const l=i.split(/\s+/);let h=2;e.getAttribute("srsDimension")?h=pr(e.getAttribute("srsDimension")):e.getAttribute("dimension")?h=pr(e.getAttribute("dimension")):e.parentNode.getAttribute("srsDimension")?h=pr(e.parentNode.getAttribute("srsDimension")):o&&(h=pr(o));let c,u,d;const f=[];for(let g=0,p=l.length;g<p;g+=h)c=parseFloat(l[g]),u=parseFloat(l[g+1]),d=h===3?parseFloat(l[g+2]):0,a.substr(0,2)==="en"?f.push(c,u,d):f.push(u,c,d);return f}writePos_(e,t,i){const s=i[i.length-1],r=s.hasZ,o=r?"3":"2";e.setAttribute("srsDimension",o);const a=s.srsName;let l="enu";a&&(l=X(a).getAxisOrientation());const h=t.getCoordinates();let c;if(l.substr(0,2)==="en"?c=h[0]+" "+h[1]:c=h[1]+" "+h[0],r){const u=h[2]||0;c+=" "+u}ct(e,c)}getCoords_(e,t,i){let s="enu";t&&(s=X(t).getAxisOrientation());let r=s.substr(0,2)==="en"?e[0]+" "+e[1]:e[1]+" "+e[0];if(i){const o=e[2]||0;r+=" "+o}return r}writePosList_(e,t,i){const s=i[i.length-1],r=s.hasZ,o=r?"3":"2";e.setAttribute("srsDimension",o);const a=s.srsName,l=t.getCoordinates(),h=l.length,c=new Array(h);let u;for(let d=0;d<h;++d)u=l[d],c[d]=this.getCoords_(u,a,r);ct(e,c.join(" "))}writePoint(e,t,i){const r=i[i.length-1].srsName;r&&e.setAttribute("srsName",r);const o=ce(e.namespaceURI,"pos");e.appendChild(o),this.writePos_(o,t,i)}writeEnvelope(e,t,i){const r=i[i.length-1].srsName;r&&e.setAttribute("srsName",r);const o=["lowerCorner","upperCorner"],a=[t[0]+" "+t[1],t[2]+" "+t[3]];et({node:e},this.ENVELOPE_SERIALIZERS,r0,a,i,o,this)}writeLinearRing(e,t,i){const r=i[i.length-1].srsName;r&&e.setAttribute("srsName",r);const o=ce(e.namespaceURI,"posList");e.appendChild(o),this.writePosList_(o,t,i)}RING_NODE_FACTORY_(e,t,i){const s=t[t.length-1],r=s.node,o=s.exteriorWritten;return o===void 0&&(s.exteriorWritten=!0),ce(r.namespaceURI,o!==void 0?"interior":"exterior")}writeSurfaceOrPolygon(e,t,i){const s=i[i.length-1],r=s.hasZ,o=s.srsName;if(e.nodeName!=="PolygonPatch"&&o&&e.setAttribute("srsName",o),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const a=t.getLinearRings();et({node:e,hasZ:r,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,i,void 0,this)}else if(e.nodeName==="Surface"){const a=ce(e.namespaceURI,"patches");e.appendChild(a),this.writeSurfacePatches_(a,t,i)}}writeCurveOrLineString(e,t,i){const r=i[i.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&r&&e.setAttribute("srsName",r),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const o=ce(e.namespaceURI,"posList");e.appendChild(o),this.writePosList_(o,t,i)}else if(e.nodeName==="Curve"){const o=ce(e.namespaceURI,"segments");e.appendChild(o),this.writeCurveSegments_(o,t,i)}}writeMultiSurfaceOrPolygon(e,t,i){const s=i[i.length-1],r=s.hasZ,o=s.srsName,a=s.surface;o&&e.setAttribute("srsName",o);const l=t.getPolygons();et({node:e,hasZ:r,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,i,void 0,this)}writeMultiPoint(e,t,i){const s=i[i.length-1],r=s.srsName,o=s.hasZ;r&&e.setAttribute("srsName",r);const a=t.getPoints();et({node:e,hasZ:o,srsName:r},this.POINTMEMBER_SERIALIZERS,mi("pointMember"),a,i,void 0,this)}writeMultiCurveOrLineString(e,t,i){const s=i[i.length-1],r=s.hasZ,o=s.srsName,a=s.curve;o&&e.setAttribute("srsName",o);const l=t.getLineStrings();et({node:e,hasZ:r,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,i,void 0,this)}writeRing(e,t,i){const s=ce(e.namespaceURI,"LinearRing");e.appendChild(s),this.writeLinearRing(s,t,i)}writeSurfaceOrPolygonMember(e,t,i){const s=this.GEOMETRY_NODE_FACTORY_(t,i);s&&(e.appendChild(s),this.writeSurfaceOrPolygon(s,t,i))}writePointMember(e,t,i){const s=ce(e.namespaceURI,"Point");e.appendChild(s),this.writePoint(s,t,i)}writeLineStringOrCurveMember(e,t,i){const s=this.GEOMETRY_NODE_FACTORY_(t,i);s&&(e.appendChild(s),this.writeCurveOrLineString(s,t,i))}writeSurfacePatches_(e,t,i){const s=ce(e.namespaceURI,"PolygonPatch");e.appendChild(s),this.writeSurfaceOrPolygon(s,t,i)}writeCurveSegments_(e,t,i){const s=ce(e.namespaceURI,"LineStringSegment");e.appendChild(s),this.writeCurveOrLineString(s,t,i)}writeGeometryElement(e,t,i){const s=i[i.length-1],r=Object.assign({},s);r.node=e;let o;Array.isArray(t)?o=$d(t,s):o=fo(t,!0,s),et(r,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],i,void 0,this)}writeFeatureElement(e,t,i){const s=t.getId();s&&e.setAttribute("fid",s);const r=i[i.length-1],o=r.featureNS,a=t.getGeometryName();r.serializers||(r.serializers={},r.serializers[o]={});const l=[],h=[];if(t.hasProperties()){const u=t.getProperties();for(const d in u){const f=u[d];f!==null&&(l.push(d),h.push(f),d==a||typeof f.getSimplifiedGeometry=="function"?d in r.serializers[o]||(r.serializers[o][d]=T(this.writeGeometryElement,this)):d in r.serializers[o]||(r.serializers[o][d]=T(ct)))}}const c=Object.assign({},r);c.node=e,et(c,r.serializers,mi(void 0,o),h,i,l)}writeFeatureMembers_(e,t,i){const s=i[i.length-1],r=s.featureType,o=s.featureNS,a={};a[o]={},a[o][r]=T(this.writeFeatureElement,this);const l=Object.assign({},s);l.node=e,et(l,a,mi(r,o),t,i)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,i){const s=t[t.length-1].node;return ce(this.namespace,eb[s.nodeName])}GEOMETRY_NODE_FACTORY_(e,t,i){const s=t[t.length-1],r=s.multiSurface,o=s.surface,a=s.curve,l=s.multiCurve;return Array.isArray(e)?i="Envelope":(i=e.getType(),i==="MultiPolygon"&&r===!0?i="MultiSurface":i==="Polygon"&&o===!0?i="Surface":i==="LineString"&&a===!0?i="Curve":i==="MultiLineString"&&l===!0&&(i="MultiCurve")),ce(this.namespace,i)}writeGeometryNode(e,t){t=this.adaptOptions(t);const i=ce(this.namespace,"geom"),s={node:i,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return t&&Object.assign(s,t),this.writeGeometryElement(i,e,[s]),i}writeFeaturesNode(e,t){t=this.adaptOptions(t);const i=ce(this.namespace,"featureMembers");i.setAttributeNS(Fu,"xsi:schemaLocation",this.schemaLocation);const s={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return t&&Object.assign(s,t),this.writeFeatureMembers_(i,e,[s]),i}}W.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:J(W.prototype.readFlatPos),posList:J(W.prototype.readFlatPosList),coordinates:J(Ta.prototype.readFlatCoordinates)}};W.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:W.prototype.interiorParser,exterior:W.prototype.exteriorParser}};W.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:J(de.prototype.readPoint),MultiPoint:J(de.prototype.readMultiPoint),LineString:J(de.prototype.readLineString),MultiLineString:J(de.prototype.readMultiLineString),LinearRing:J(de.prototype.readLinearRing),Polygon:J(de.prototype.readPolygon),MultiPolygon:J(de.prototype.readMultiPolygon),Surface:J(W.prototype.readSurface),MultiSurface:J(W.prototype.readMultiSurface),Curve:J(W.prototype.readCurve),MultiCurve:J(W.prototype.readMultiCurve),Envelope:J(W.prototype.readEnvelope)}};W.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:ne(W.prototype.curveMemberParser),curveMembers:ne(W.prototype.curveMemberParser)}};W.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:ne(W.prototype.surfaceMemberParser),surfaceMembers:ne(W.prototype.surfaceMemberParser)}};W.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:ne(de.prototype.readLineString),Curve:ne(W.prototype.readCurve)}};W.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:ne(de.prototype.readPolygon),Surface:ne(W.prototype.readSurface)}};W.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:J(W.prototype.readPatch)}};W.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:J(W.prototype.readSegment)}};W.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:ne(W.prototype.readFlatPosList),upperCorner:ne(W.prototype.readFlatPosList)}};W.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:J(W.prototype.readPolygonPatch)}};W.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:s0(W.prototype.readLineStringSegment)}};de.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:J(de.prototype.readFlatLinearRing),Ring:J(W.prototype.readFlatCurveRing)}};W.prototype.writeFeatures;W.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:T(W.prototype.writeRing),interior:T(W.prototype.writeRing)}};W.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:T(ct),upperCorner:T(ct)}};W.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:T(W.prototype.writeSurfaceOrPolygonMember),polygonMember:T(W.prototype.writeSurfaceOrPolygonMember)}};W.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:T(W.prototype.writePointMember)}};W.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:T(W.prototype.writeLineStringOrCurveMember),curveMember:T(W.prototype.writeLineStringOrCurveMember)}};W.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:T(W.prototype.writeCurveOrLineString),MultiCurve:T(W.prototype.writeMultiCurveOrLineString),Point:T(W.prototype.writePoint),MultiPoint:T(W.prototype.writeMultiPoint),LineString:T(W.prototype.writeCurveOrLineString),MultiLineString:T(W.prototype.writeMultiCurveOrLineString),LinearRing:T(W.prototype.writeLinearRing),Polygon:T(W.prototype.writeSurfaceOrPolygon),MultiPolygon:T(W.prototype.writeMultiSurfaceOrPolygon),Surface:T(W.prototype.writeSurfaceOrPolygon),MultiSurface:T(W.prototype.writeMultiSurfaceOrPolygon),Envelope:T(W.prototype.writeEnvelope)}};const ue=W;class nf{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null}clone(){const e=this.getColor();return new nf({color:Array.isArray(e)?e.slice():e||void 0})}getColor(){return this.color_}setColor(e){this.color_=e}}const jt=nf;function ip(n){return n[0]>0&&n[1]>0}function tb(n,e,t){return t===void 0&&(t=[0,0]),t[0]=n[0]*e+.5|0,t[1]=n[1]*e+.5|0,t}function qt(n,e){return Array.isArray(n)?n:(e===void 0?e=[n,n]:(e[0]=n,e[1]=n),e)}class sf{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=qt(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new sf({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return ie()}getImage(e){return ie()}getHitDetectionImage(){return ie()}getPixelRatio(e){return 1}getImageState(){return ie()}getImageSize(){return ie()}getOrigin(){return ie()}getSize(){return ie()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=qt(e)}listenImageChange(e){ie()}load(){ie()}unlistenImageChange(e){ie()}}const l0=sf,ib=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,nb=/^([a-z]*)$|^hsla?\(.*\)$/i;function h0(n){return typeof n=="string"?n:c0(n)}function sb(n){const e=document.createElement("div");if(e.style.color=n,e.style.color!==""){document.body.appendChild(e);const t=getComputedStyle(e).color;return document.body.removeChild(e),t}return""}const rb=function(){const e={};let t=0;return function(i){let s;if(e.hasOwnProperty(i))s=e[i];else{if(t>=1024){let r=0;for(const o in e)r++&3||(delete e[o],--t)}s=ob(i),e[i]=s,++t}return s}}();function Zl(n){return Array.isArray(n)?n:rb(n)}function ob(n){let e,t,i,s,r;if(nb.exec(n)&&(n=sb(n)),ib.exec(n)){const o=n.length-1;let a;o<=4?a=1:a=2;const l=o===4||o===8;e=parseInt(n.substr(1+0*a,a),16),t=parseInt(n.substr(1+1*a,a),16),i=parseInt(n.substr(1+2*a,a),16),l?s=parseInt(n.substr(1+3*a,a),16):s=255,a==1&&(e=(e<<4)+e,t=(t<<4)+t,i=(i<<4)+i,l&&(s=(s<<4)+s)),r=[e,t,i,s/255]}else if(n.startsWith("rgba("))r=n.slice(5,-1).split(",").map(Number),np(r);else if(n.startsWith("rgb("))r=n.slice(4,-1).split(",").map(Number),r.push(1),np(r);else throw new Error("Invalid color");return r}function np(n){return n[0]=Je(n[0]+.5|0,0,255),n[1]=Je(n[1]+.5|0,0,255),n[2]=Je(n[2]+.5|0,0,255),n[3]=Je(n[3],0,1),n}function c0(n){let e=n[0];e!=(e|0)&&(e=e+.5|0);let t=n[1];t!=(t|0)&&(t=t+.5|0);let i=n[2];i!=(i|0)&&(i=i+.5|0);const s=n[3]===void 0?1:Math.round(n[3]*100)/100;return"rgba("+e+","+t+","+i+","+s+")"}class ab{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const i=this.cache_[t];!(e++&3)&&!i.hasListener()&&(delete this.cache_[t],--this.cacheSize_)}}}get(e,t,i){const s=sp(e,t,i);return s in this.cache_?this.cache_[s]:null}set(e,t,i,s){const r=sp(e,t,i);this.cache_[r]=s,++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function sp(n,e,t){const i=t?h0(t):"null";return e+":"+n+":"+i}const Kl=new ab;let So=null;class lb extends va{constructor(e,t,i,s,r){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=i,this.canvas_={},this.color_=r,this.imageState_=s===void 0?re.IDLE:s,this.size_=e&&e.width&&e.height?[e.width,e.height]:null,this.src_=t,this.tainted_}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===re.LOADED){So||(So=St(1,1,void 0,{willReadFrequently:!0})),So.drawImage(this.image_,0,0);try{So.getImageData(0,0,1,1),this.tainted_=!1}catch{So=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(K.CHANGE)}handleImageError_(){this.imageState_=re.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=re.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],t=this.size_[1],i=St(e,t);i.fillRect(0,0,e,t),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===re.IDLE){this.image_||this.initializeImage_(),this.imageState_=re.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&yy(this.image_,this.src_).then(e=>{this.image_=e,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||this.imageState_!==re.LOADED)return;const t=this.image_,i=document.createElement("canvas");i.width=Math.ceil(t.width*e),i.height=Math.ceil(t.height*e);const s=i.getContext("2d");s.scale(e,e),s.drawImage(t,0,0),s.globalCompositeOperation="multiply",s.fillStyle=h0(this.color_),s.fillRect(0,0,i.width/e,i.height/e),s.globalCompositeOperation="destination-in",s.drawImage(t,0,0),this.canvas_[e]=i}}function hb(n,e,t,i,s){let r=e===void 0?void 0:Kl.get(e,t,s);return r||(r=new lb(n,n instanceof HTMLImageElement?n.src||void 0:e,t,i,s),Kl.set(e,t,s,r)),r}function rp(n,e,t,i){return t!==void 0&&i!==void 0?[t/n,i/e]:t!==void 0?t/n:i!==void 0?i/e:1}class rf extends l0{constructor(e){e=e||{};const t=e.opacity!==void 0?e.opacity:1,i=e.rotation!==void 0?e.rotation:0,s=e.scale!==void 0?e.scale:1,r=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:t,rotation:i,scale:s,displacement:e.displacement!==void 0?e.displacement:[0,0],rotateWithView:r,declutterMode:e.declutterMode}),this.anchor_=e.anchor!==void 0?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=e.anchorOrigin!==void 0?e.anchorOrigin:"top-left",this.anchorXUnits_=e.anchorXUnits!==void 0?e.anchorXUnits:"fraction",this.anchorYUnits_=e.anchorYUnits!==void 0?e.anchorYUnits:"fraction",this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null;const o=e.img!==void 0?e.img:null;let a=e.src;fe(!(a!==void 0&&o),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&o&&(a=o.src||H(o)),fe(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),fe(!((e.width!==void 0||e.height!==void 0)&&e.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(e.src!==void 0?l=re.IDLE:o!==void 0&&(o instanceof HTMLImageElement?o.complete?l=o.src?re.LOADED:re.IDLE:l=re.LOADING:l=re.LOADED),this.color_=e.color!==void 0?Zl(e.color):null,this.iconImage_=hb(o,a,this.crossOrigin_,l,this.color_),this.offset_=e.offset!==void 0?e.offset:[0,0],this.offsetOrigin_=e.offsetOrigin!==void 0?e.offsetOrigin:"top-left",this.origin_=null,this.size_=e.size!==void 0?e.size:null,e.width!==void 0||e.height!==void 0){let h,c;if(e.size)[h,c]=e.size;else{const u=this.getImage(1);if(u.width&&u.height)h=u.width,c=u.height;else if(u instanceof HTMLImageElement){this.initialOptions_=e;const d=()=>{if(this.unlistenImageChange(d),!this.initialOptions_)return;const f=this.iconImage_.getSize();this.setScale(rp(f[0],f[1],e.width,e.height))};this.listenImageChange(d);return}}h!==void 0&&this.setScale(rp(h,c,e.width,e.height))}}clone(){let e,t,i;return this.initialOptions_?(t=this.initialOptions_.width,i=this.initialOptions_.height):(e=this.getScale(),e=Array.isArray(e)?e.slice():e),new rf({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:e,width:t,height:i,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const s=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!s)return null;e=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(e[0]*=s[0]),this.anchorYUnits_=="fraction"&&(e[1]*=s[1])}if(this.anchorOrigin_!="top-left"){if(!s)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(e[0]=-e[0]+s[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(e[1]=-e[1]+s[1])}this.normalizedAnchor_=e}const t=this.getDisplacement(),i=this.getScaleArray();return[e[0]-t[0]/i[0],e[1]+t[1]/i[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!="top-left"){const t=this.getSize(),i=this.iconImage_.getSize();if(!t||!i)return null;e=e.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(e[0]=i[0]-t[0]-e[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(e[1]=i[1]-t[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const e=this.getScaleArray();if(this.size_)return this.size_[0]*e[0];if(this.iconImage_.getImageState()==re.LOADED)return this.iconImage_.getSize()[0]*e[0]}getHeight(){const e=this.getScaleArray();if(this.size_)return this.size_[1]*e[1];if(this.iconImage_.getImageState()==re.LOADED)return this.iconImage_.getSize()[1]*e[1]}setScale(e){delete this.initialOptions_,super.setScale(e)}listenImageChange(e){this.iconImage_.addEventListener(K.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(K.CHANGE,e)}}const so=rf;class of{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=e.lineDash!==void 0?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}clone(){const e=this.getColor();return new of({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setWidth(e){this.width_=e}}const xt=of;function rn(n){return Array.isArray(n)?c0(n):n}const Qa="ol-hidden",cb="ol-selectable",Qh="ol-unselectable",af="ol-control",op="ol-collapsed",ub=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),ap=["style","variant","weight","size","lineHeight","family"],u0=function(n){const e=n.match(ub);if(!e)return null;const t={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let i=0,s=ap.length;i<s;++i){const r=e[i+1];r!==void 0&&(t[ap[i]]=r)}return t.families=t.family.split(/,\s?/),t},d0="10px sans-serif",ti="#000",ro="round",Tn=[],Rn=0,oo="round",Vo=10,Wo="#000",Ho="center",Jl="middle",Ss=[0,0,0,0],Xo=1,Ji=new Xi;let or=null,Ou;const ku={},f0=function(){const e="32px ",t=["monospace","serif"],i=t.length,s="wmytzilWMYTZIL@#/&?$%10ï";let r,o;function a(h,c,u){let d=!0;for(let f=0;f<i;++f){const g=t[f];if(o=Ql(h+" "+c+" "+e+g,s),u!=g){const p=Ql(h+" "+c+" "+e+u+","+g,s);d=d&&p!=o}}return!!d}function l(){let h=!0;const c=Ji.getKeys();for(let u=0,d=c.length;u<d;++u){const f=c[u];Ji.get(f)<100&&(a.apply(this,f.split(`
`))?(_a(ku),or=null,Ou=void 0,Ji.set(f,100)):(Ji.set(f,Ji.get(f)+1,!0),h=!1))}h&&(clearInterval(r),r=void 0)}return function(h){const c=u0(h);if(!c)return;const u=c.families;for(let d=0,f=u.length;d<f;++d){const g=u[d],p=c.style+`
`+c.weight+`
`+g;Ji.get(p)===void 0&&(Ji.set(p,100,!0),a(c.style,c.weight,g)||(Ji.set(p,0,!0),r===void 0&&(r=setInterval(l,32))))}}}(),db=function(){let n;return function(e){let t=ku[e];if(t==null){if(Md){const i=u0(e),s=g0(e,"Å½g");t=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(s.actualBoundingBoxAscent+s.actualBoundingBoxDescent)}else n||(n=document.createElement("div"),n.innerHTML="M",n.style.minHeight="0",n.style.maxHeight="none",n.style.height="auto",n.style.padding="0",n.style.border="none",n.style.position="absolute",n.style.display="block",n.style.left="-99999px"),n.style.font=e,document.body.appendChild(n),t=n.offsetHeight,document.body.removeChild(n);ku[e]=t}return t}}();function g0(n,e){return or||(or=St(1,1)),n!=Ou&&(or.font=n,Ou=or.font),or.measureText(e)}function Ql(n,e){return g0(n,e).width}function lp(n,e,t){if(e in t)return t[e];const i=e.split(`
`).reduce((s,r)=>Math.max(s,Ql(n,r)),0);return t[e]=i,i}function fb(n,e){const t=[],i=[],s=[];let r=0,o=0,a=0,l=0;for(let h=0,c=e.length;h<=c;h+=2){const u=e[h];if(u===`
`||h===c){r=Math.max(r,o),s.push(o),o=0,a+=l;continue}const d=e[h+1]||n.font,f=Ql(d,u);t.push(f),o+=f;const g=db(d);i.push(g),l=Math.max(l,g)}return{width:r,height:a,widths:t,heights:i,lineWidths:s}}function gb(n,e,t,i,s,r,o,a,l,h,c){n.save(),t!==1&&(n.globalAlpha*=t),e&&n.transform.apply(n,e),i.contextInstructions?(n.translate(l,h),n.scale(c[0],c[1]),pb(i,n)):c[0]<0||c[1]<0?(n.translate(l,h),n.scale(c[0],c[1]),n.drawImage(i,s,r,o,a,0,0,o,a)):n.drawImage(i,s,r,o,a,l,h,o*c[0],a*c[1]),n.restore()}function pb(n,e){const t=n.contextInstructions;for(let i=0,s=t.length;i<s;i+=2)Array.isArray(t[i+1])?e[t[i]].apply(e,t[i+1]):e[t[i]]=t[i+1]}class lf extends l0{constructor(e){const t=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:1,rotateWithView:t,rotation:e.rotation!==void 0?e.rotation:0,scale:e.scale!==void 0?e.scale:1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode}),this.canvas_=void 0,this.hitDetectionCanvas_=null,this.fill_=e.fill!==void 0?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius_=e.radius!==void 0?e.radius:e.radius1,this.radius2_=e.radius2,this.angle_=e.angle!==void 0?e.angle:0,this.stroke_=e.stroke!==void 0?e.stroke:null,this.size_=null,this.renderOptions_=null,this.render()}clone(){const e=this.getScale(),t=new lf({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}getAnchor(){const e=this.size_;if(!e)return null;const t=this.getDisplacement(),i=this.getScaleArray();return[e[0]/2-t[0]/i[0],e[1]/2+t[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_}getImage(e){let t=this.canvas_[e];if(!t){const i=this.renderOptions_,s=St(i.size*e,i.size*e);this.draw_(i,s,e),t=s.canvas,this.canvas_[e]=t}return t}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return re.LOADED}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(e){}load(){}unlistenImageChange(e){}calculateLineJoinSize_(e,t,i){if(t===0||this.points_===1/0||e!=="bevel"&&e!=="miter")return t;let s=this.radius_,r=this.radius2_===void 0?s:this.radius2_;if(s<r){const E=s;s=r,r=E}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=r*Math.sin(a),h=Math.sqrt(r*r-l*l),c=s-h,u=Math.sqrt(l*l+c*c),d=u/l;if(e==="miter"&&d<=i)return d*t;const f=t/2/d,g=t/2*(c/u),m=Math.sqrt((s+f)*(s+f)+g*g)-s;if(this.radius2_===void 0||e==="bevel")return m*2;const v=s*Math.sin(a),y=Math.sqrt(s*s-v*v),x=r-y,b=Math.sqrt(v*v+x*x)/v;if(b<=i){const E=b*t/2-r-s;return 2*Math.max(m,E)}return m*2}createRenderOptions(){let e=ro,t=oo,i=0,s=null,r=0,o,a=0;this.stroke_&&(o=this.stroke_.getColor(),o===null&&(o=Wo),o=rn(o),a=this.stroke_.getWidth(),a===void 0&&(a=Xo),s=this.stroke_.getLineDash(),r=this.stroke_.getLineDashOffset(),t=this.stroke_.getLineJoin(),t===void 0&&(t=oo),e=this.stroke_.getLineCap(),e===void 0&&(e=ro),i=this.stroke_.getMiterLimit(),i===void 0&&(i=Vo));const l=this.calculateLineJoinSize_(t,a,i),h=Math.max(this.radius_,this.radius2_||0),c=Math.ceil(2*h+l);return{strokeStyle:o,strokeWidth:a,size:c,lineCap:e,lineDash:s,lineDashOffset:r,lineJoin:t,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const e=this.renderOptions_.size;this.canvas_={},this.size_=[e,e]}draw_(e,t,i){if(t.scale(i,i),t.translate(e.size/2,e.size/2),this.createPath_(t),this.fill_){let s=this.fill_.getColor();s===null&&(s=ti),t.fillStyle=rn(s),t.fill()}this.stroke_&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}createHitDetectionCanvas_(e){if(this.fill_){let t=this.fill_.getColor(),i=0;if(typeof t=="string"&&(t=Zl(t)),t===null?i=1:Array.isArray(t)&&(i=t.length===4?t[3]:1),i===0){const s=St(e.size,e.size);this.hitDetectionCanvas_=s.canvas,this.drawHitDetectionCanvas_(e,s)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))}createPath_(e){let t=this.points_;const i=this.radius_;if(t===1/0)e.arc(0,0,i,0,2*Math.PI);else{const s=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(t*=2);const r=this.angle_-Math.PI/2,o=2*Math.PI/t;for(let a=0;a<t;a++){const l=r+a*o,h=a%2===0?i:s;e.lineTo(h*Math.cos(l),h*Math.sin(l))}e.closePath()}}drawHitDetectionCanvas_(e,t){t.translate(e.size/2,e.size/2),this.createPath_(t),t.fillStyle=ti,t.fill(),this.stroke_&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}}const p0=lf;class hf extends p0{constructor(e){e=e||{radius:5},super({points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:e.scale!==void 0?e.scale:1,rotation:e.rotation!==void 0?e.rotation:0,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){const e=this.getScale(),t=new hf({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}setRadius(e){this.radius_=e,this.render()}}const Hn=hf;class Xn{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=hp,e.geometry!==void 0&&this.setGeometry(e.geometry),this.fill_=e.fill!==void 0?e.fill:null,this.image_=e.image!==void 0?e.image:null,this.renderer_=e.renderer!==void 0?e.renderer:null,this.hitDetectionRenderer_=e.hitDetectionRenderer!==void 0?e.hitDetectionRenderer:null,this.stroke_=e.stroke!==void 0?e.stroke:null,this.text_=e.text!==void 0?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&typeof e=="object"&&(e=e.clone()),new Xn({geometry:e,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){typeof e=="function"?this.geometryFunction_=e:typeof e=="string"?this.geometryFunction_=function(t){return t.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=hp,this.geometry_=e}setZIndex(e){this.zIndex_=e}}function mb(n){let e;if(typeof n=="function")e=n;else{let t;Array.isArray(n)?t=n:(fe(typeof n.getZIndex=="function","Expected an `Style` or an array of `Style`"),t=[n]),e=function(){return t}}return e}let Cc=null;function yb(n,e){if(!Cc){const t=new jt({color:"rgba(255,255,255,0.4)"}),i=new xt({color:"#3399CC",width:1.25});Cc=[new Xn({image:new Hn({fill:t,stroke:i,radius:5}),fill:t,stroke:i})]}return Cc}function m0(){const n={},e=[255,255,255,1],t=[0,153,255,1],i=3;return n.Polygon=[new Xn({fill:new jt({color:[255,255,255,.5]})})],n.MultiPolygon=n.Polygon,n.LineString=[new Xn({stroke:new xt({color:e,width:i+2})}),new Xn({stroke:new xt({color:t,width:i})})],n.MultiLineString=n.LineString,n.Circle=n.Polygon.concat(n.LineString),n.Point=[new Xn({image:new Hn({radius:i*2,fill:new jt({color:t}),stroke:new xt({color:e,width:i/2})}),zIndex:1/0})],n.MultiPoint=n.Point,n.GeometryCollection=n.Polygon.concat(n.LineString,n.Point),n}function hp(n){return n.getGeometry()}const $t=Xn,_b="#333";class cf{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.scale_=e.scale,this.scaleArray_=qt(e.scale!==void 0?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.repeat_=e.repeat,this.textBaseline_=e.textBaseline,this.fill_=e.fill!==void 0?e.fill:new jt({color:_b}),this.maxAngle_=e.maxAngle!==void 0?e.maxAngle:Math.PI/4,this.placement_=e.placement!==void 0?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=e.stroke!==void 0?e.stroke:null,this.offsetX_=e.offsetX!==void 0?e.offsetX:0,this.offsetY_=e.offsetY!==void 0?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=e.padding===void 0?null:e.padding}clone(){const e=this.getScale();return new cf({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRepeat(e){this.repeat_=e}setRotateWithView(e){this.rotateWithView_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=qt(e!==void 0?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}}const uf=cf;var df={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */df.read=function(n,e,t,i,s){var r,o,a=s*8-i-1,l=(1<<a)-1,h=l>>1,c=-7,u=t?s-1:0,d=t?-1:1,f=n[e+u];for(u+=d,r=f&(1<<-c)-1,f>>=-c,c+=a;c>0;r=r*256+n[e+u],u+=d,c-=8);for(o=r&(1<<-c)-1,r>>=-c,c+=i;c>0;o=o*256+n[e+u],u+=d,c-=8);if(r===0)r=1-h;else{if(r===l)return o?NaN:(f?-1:1)*(1/0);o=o+Math.pow(2,i),r=r-h}return(f?-1:1)*o*Math.pow(2,r-i)};df.write=function(n,e,t,i,s,r){var o,a,l,h=r*8-s-1,c=(1<<h)-1,u=c>>1,d=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:r-1,g=i?1:-1,p=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+u>=1?e+=d/l:e+=d*Math.pow(2,1-u),e*l>=2&&(o++,l/=2),o+u>=c?(a=0,o=c):o+u>=1?(a=(e*l-1)*Math.pow(2,s),o=o+u):(a=e*Math.pow(2,u-1)*Math.pow(2,s),o=0));s>=8;n[t+f]=a&255,f+=g,a/=256,s-=8);for(o=o<<s|a,h+=s;h>0;n[t+f]=o&255,f+=g,o/=256,h-=8);n[t+f-g]|=p*128};var vb=Fe,el=df;function Fe(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}Fe.Varint=0;Fe.Fixed64=1;Fe.Bytes=2;Fe.Fixed32=5;var Nu=65536*65536,cp=1/Nu,xb=12,y0=typeof TextDecoder>"u"?null:new TextDecoder("utf8");Fe.prototype={destroy:function(){this.buf=null},readFields:function(n,e,t){for(t=t||this.length;this.pos<t;){var i=this.readVarint(),s=i>>3,r=this.pos;this.type=i&7,n(s,e,this),this.pos===r&&this.skip(i)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=tl(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=dp(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=tl(this.buf,this.pos)+tl(this.buf,this.pos+4)*Nu;return this.pos+=8,n},readSFixed64:function(){var n=tl(this.buf,this.pos)+dp(this.buf,this.pos+4)*Nu;return this.pos+=8,n},readFloat:function(){var n=el.read(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=el.read(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e=this.buf,t,i;return i=e[this.pos++],t=i&127,i<128||(i=e[this.pos++],t|=(i&127)<<7,i<128)||(i=e[this.pos++],t|=(i&127)<<14,i<128)||(i=e[this.pos++],t|=(i&127)<<21,i<128)?t:(i=e[this.pos],t|=(i&15)<<28,wb(t,n,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2===1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=xb&&y0?kb(this.buf,e,n):Ob(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==Fe.Bytes)return n.push(this.readVarint(e));var t=yn(this);for(n=n||[];this.pos<t;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==Fe.Bytes)return n.push(this.readSVarint());var e=yn(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==Fe.Bytes)return n.push(this.readBoolean());var e=yn(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==Fe.Bytes)return n.push(this.readFloat());var e=yn(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==Fe.Bytes)return n.push(this.readDouble());var e=yn(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==Fe.Bytes)return n.push(this.readFixed32());var e=yn(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==Fe.Bytes)return n.push(this.readSFixed32());var e=yn(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==Fe.Bytes)return n.push(this.readFixed64());var e=yn(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==Fe.Bytes)return n.push(this.readSFixed64());var e=yn(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=n&7;if(e===Fe.Varint)for(;this.buf[this.pos++]>127;);else if(e===Fe.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Fe.Fixed32)this.pos+=4;else if(e===Fe.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),tr(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),tr(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),tr(this.buf,n&-1,this.pos),tr(this.buf,Math.floor(n*cp),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),tr(this.buf,n&-1,this.pos),tr(this.buf,Math.floor(n*cp),this.pos+4),this.pos+=8},writeVarint:function(n){if(n=+n||0,n>268435455||n<0){bb(n,this);return}this.realloc(4),this.buf[this.pos++]=n&127|(n>127?128:0),!(n<=127)&&(this.buf[this.pos++]=(n>>>=7)&127|(n>127?128:0),!(n<=127)&&(this.buf[this.pos++]=(n>>>=7)&127|(n>127?128:0),!(n<=127)&&(this.buf[this.pos++]=n>>>7&127)))},writeSVarint:function(n){this.writeVarint(n<0?-n*2-1:n*2)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(n.length*4),this.pos++;var e=this.pos;this.pos=Nb(this.buf,n,this.pos);var t=this.pos-e;t>=128&&up(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(n){this.realloc(4),el.write(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),el.write(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var t=0;t<e;t++)this.buf[this.pos++]=n[t]},writeRawMessage:function(n,e){this.pos++;var t=this.pos;n(e,this);var i=this.pos-t;i>=128&&up(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeMessage:function(n,e,t){this.writeTag(n,Fe.Bytes),this.writeRawMessage(e,t)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,Mb,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,Sb,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,Lb,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,Tb,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,Rb,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,Ib,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,Pb,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,Ab,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,Fb,e)},writeBytesField:function(n,e){this.writeTag(n,Fe.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,Fe.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,Fe.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,Fe.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,Fe.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,Fe.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,Fe.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,Fe.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,Fe.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,Fe.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,!!e)}};function wb(n,e,t){var i=t.buf,s,r;if(r=i[t.pos++],s=(r&112)>>4,r<128||(r=i[t.pos++],s|=(r&127)<<3,r<128)||(r=i[t.pos++],s|=(r&127)<<10,r<128)||(r=i[t.pos++],s|=(r&127)<<17,r<128)||(r=i[t.pos++],s|=(r&127)<<24,r<128)||(r=i[t.pos++],s|=(r&1)<<31,r<128))return er(n,s,e);throw new Error("Expected varint not more than 10 bytes")}function yn(n){return n.type===Fe.Bytes?n.readVarint()+n.pos:n.pos+1}function er(n,e,t){return t?e*4294967296+(n>>>0):(e>>>0)*4294967296+(n>>>0)}function bb(n,e){var t,i;if(n>=0?(t=n%4294967296|0,i=n/4294967296|0):(t=~(-n%4294967296),i=~(-n/4294967296),t^4294967295?t=t+1|0:(t=0,i=i+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),Eb(t,i,e),Cb(i,e)}function Eb(n,e,t){t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos]=n&127}function Cb(n,e){var t=(n&7)<<4;e.buf[e.pos++]|=t|((n>>>=3)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127)))))}function up(n,e,t){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));t.realloc(i);for(var s=t.pos-1;s>=n;s--)t.buf[s+i]=t.buf[s]}function Mb(n,e){for(var t=0;t<n.length;t++)e.writeVarint(n[t])}function Sb(n,e){for(var t=0;t<n.length;t++)e.writeSVarint(n[t])}function Tb(n,e){for(var t=0;t<n.length;t++)e.writeFloat(n[t])}function Rb(n,e){for(var t=0;t<n.length;t++)e.writeDouble(n[t])}function Lb(n,e){for(var t=0;t<n.length;t++)e.writeBoolean(n[t])}function Ib(n,e){for(var t=0;t<n.length;t++)e.writeFixed32(n[t])}function Pb(n,e){for(var t=0;t<n.length;t++)e.writeSFixed32(n[t])}function Ab(n,e){for(var t=0;t<n.length;t++)e.writeFixed64(n[t])}function Fb(n,e){for(var t=0;t<n.length;t++)e.writeSFixed64(n[t])}function tl(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+n[e+3]*16777216}function tr(n,e,t){n[t]=e,n[t+1]=e>>>8,n[t+2]=e>>>16,n[t+3]=e>>>24}function dp(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}function Ob(n,e,t){for(var i="",s=e;s<t;){var r=n[s],o=null,a=r>239?4:r>223?3:r>191?2:1;if(s+a>t)break;var l,h,c;a===1?r<128&&(o=r):a===2?(l=n[s+1],(l&192)===128&&(o=(r&31)<<6|l&63,o<=127&&(o=null))):a===3?(l=n[s+1],h=n[s+2],(l&192)===128&&(h&192)===128&&(o=(r&15)<<12|(l&63)<<6|h&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(l=n[s+1],h=n[s+2],c=n[s+3],(l&192)===128&&(h&192)===128&&(c&192)===128&&(o=(r&15)<<18|(l&63)<<12|(h&63)<<6|c&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,i+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),i+=String.fromCharCode(o),s+=a}return i}function kb(n,e,t){return y0.decode(n.subarray(e,t))}function Nb(n,e,t){for(var i=0,s,r;i<e.length;i++){if(s=e.charCodeAt(i),s>55295&&s<57344)if(r)if(s<56320){n[t++]=239,n[t++]=191,n[t++]=189,r=s;continue}else s=r-55296<<10|s-56320|65536,r=null;else{s>56319||i+1===e.length?(n[t++]=239,n[t++]=191,n[t++]=189):r=s;continue}else r&&(n[t++]=239,n[t++]=191,n[t++]=189,r=null);s<128?n[t++]=s:(s<2048?n[t++]=s>>6|192:(s<65536?n[t++]=s>>12|224:(n[t++]=s>>18|240,n[t++]=s>>12&63|128),n[t++]=s>>6&63|128),n[t++]=s&63|128)}return t}const Db=Bv(vb);class ec extends An{constructor(e,t,i){super(),i!==void 0&&t===void 0?this.setFlatCoordinates(i,e):(t=t||0,this.setCenterAndRadius(e,t,i))}clone(){const e=new ec(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,s){const r=this.flatCoordinates,o=e-r[0],a=t-r[1],l=o*o+a*a;if(l<s){if(l===0)for(let h=0;h<this.stride;++h)i[h]=r[h];else{const h=this.getRadius()/Math.sqrt(l);i[0]=r[0]+h*o,i[1]=r[1]+h*a;for(let c=2;c<this.stride;++c)i[c]=r[c]}return i.length=this.stride,l}return s}containsXY(e,t){const i=this.flatCoordinates,s=e-i[0],r=t-i[1];return s*s+r*r<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,i=t[this.stride]-t[0];return Pi(t[0]-i,t[1]-i,t[0]+i,t[1]+i,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(He(e,t)){const i=this.getCenter();return e[0]<=i[0]&&e[2]>=i[0]||e[1]<=i[1]&&e[3]>=i[1]?!0:Id(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,i=this.flatCoordinates[t]-this.flatCoordinates[0],s=e.slice();s[t]=s[0]+i;for(let r=1;r<t;++r)s[t+r]=e[r];this.setFlatCoordinates(this.layout,s),this.changed()}setCenterAndRadius(e,t,i){this.setLayout(i,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const s=this.flatCoordinates;let r=jy(s,0,e,this.stride);s[r++]=s[0]+t;for(let o=1,a=this.stride;o<a;++o)s[r++]=s[o];s.length=r,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const i=this.getCenter(),s=this.getStride();this.setCenter(Vd(i,0,i.length,s,e,t,i)),this.changed()}}ec.prototype.transform;const _0=ec,fp=pi();class Yo{constructor(e,t,i,s,r){this.styleFunction,this.extent_,this.id_=r,this.type_=e,this.flatCoordinates_=t,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i,this.properties_=s}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?Rr(this.flatCoordinates_):Ld(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const e=Nt(this.getExtent());this.flatInteriorPoints_=ef(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const e=t0(this.flatCoordinates_,0,this.ends_,2);this.flatInteriorPoints_=Ky(this.flatCoordinates_,0,this.ends_,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=ql(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let t=0;const i=this.ends_;for(let s=0,r=i.length;s<r;++s){const o=i[s],a=ql(e,t,o,2,.5);kt(this.flatMidpoints_,a),t=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(e){return this}simplifyTransformed(e,t){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return 2}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){e=X(e);const t=e.getExtent(),i=e.getWorldExtent();if(t&&i){const s=yt(i)/yt(t);Vi(fp,i[0],i[3],s,-s,0,0,0),es(this.flatCoordinates_,0,this.flatCoordinates_.length,2,fp,this.flatCoordinates_)}}getEnds(){return this.ends_}}Yo.prototype.getEndss=Yo.prototype.getEnds;Yo.prototype.getFlatCoordinates=Yo.prototype.getOrientedFlatCoordinates;const Du=Yo;class Gb extends jd{constructor(e){super(),e=e||{},this.dataProjection=new Vh({code:"",units:"tile-pixels"}),this.featureClass_=e.featureClass?e.featureClass:Du,this.geometryName_=e.geometryName,this.layerName_=e.layerName?e.layerName:"layer",this.layers_=e.layers?e.layers:null,this.idProperty_=e.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(e,t,i,s){e.pos=t.geometry;const r=e.readVarint()+e.pos;let o=1,a=0,l=0,h=0,c=0,u=0;for(;e.pos<r;){if(!a){const d=e.readVarint();o=d&7,a=d>>3}if(a--,o===1||o===2)l+=e.readSVarint(),h+=e.readSVarint(),o===1&&c>u&&(s.push(c),u=c),i.push(l,h),c+=2;else if(o===7)c>u&&(i.push(i[u],i[u+1]),c+=2);else throw new Error("Invalid command found in the PBF")}c>u&&(s.push(c),u=c)}createFeature_(e,t,i){const s=t.type;if(s===0)return null;let r;const o=t.properties;let a;this.idProperty_?(a=o[this.idProperty_],delete o[this.idProperty_]):a=t.id,o[this.layerName_]=t.layer.name;const l=[],h=[];this.readRawGeometry_(e,t,l,h);const c=$b(s,h.length);if(this.featureClass_===Du)r=new this.featureClass_(c,l,h,o,a),r.transform(i.dataProjection);else{let u;if(c=="Polygon"){const g=Tw(l,h);u=g.length>1?new Ys(l,"XY",g):new Wi(l,"XY",h)}else u=c==="Point"?new Ht(l,"XY"):c==="LineString"?new $i(l,"XY"):c==="MultiPoint"?new go(l,"XY"):c==="MultiLineString"?new Xs(l,"XY",h):null;const d=this.featureClass_;r=new d,this.geometryName_&&r.setGeometryName(this.geometryName_);const f=fo(u,!1,i);r.setGeometry(f),a!==void 0&&r.setId(a),r.setProperties(o,!0)}return r}getType(){return"arraybuffer"}readFeatures(e,t){const i=this.layers_;t=this.adaptOptions(t);const s=X(t.dataProjection);s.setWorldExtent(t.extent),t.dataProjection=s;const r=new Db(e),o=r.readFields(zb,{}),a=[];for(const l in o){if(i&&!i.includes(l))continue;const h=o[l],c=h?[0,0,h.extent,h.extent]:null;s.setExtent(c);for(let u=0,d=h.length;u<d;++u){const f=jb(r,h,u),g=this.createFeature_(r,f,t);g!==null&&a.push(g)}}return a}readProjection(e){return this.dataProjection}setLayers(e){this.layers_=e}}function zb(n,e,t){if(n===3){const i={keys:[],values:[],features:[]},s=t.readVarint()+t.pos;t.readFields(Bb,i,s),i.length=i.features.length,i.length&&(e[i.name]=i)}}function Bb(n,e,t){if(n===15)e.version=t.readVarint();else if(n===1)e.name=t.readString();else if(n===5)e.extent=t.readVarint();else if(n===2)e.features.push(t.pos);else if(n===3)e.keys.push(t.readString());else if(n===4){let i=null;const s=t.readVarint()+t.pos;for(;t.pos<s;)n=t.readVarint()>>3,i=n===1?t.readString():n===2?t.readFloat():n===3?t.readDouble():n===4?t.readVarint64():n===5?t.readVarint():n===6?t.readSVarint():n===7?t.readBoolean():null;e.values.push(i)}}function Ub(n,e,t){if(n==1)e.id=t.readVarint();else if(n==2){const i=t.readVarint()+t.pos;for(;t.pos<i;){const s=e.layer.keys[t.readVarint()],r=e.layer.values[t.readVarint()];e.properties[s]=r}}else n==3?e.type=t.readVarint():n==4&&(e.geometry=t.pos)}function jb(n,e,t){n.pos=e.features[t];const i=n.readVarint()+n.pos,s={layer:e,type:0,properties:{}};return n.readFields(Ub,s,i),s}function $b(n,e){let t;return n===1?t=e===1?"Point":"MultiPoint":n===2?t=e===1?"LineString":"MultiLineString":n===3&&(t="Polygon"),t}const v0=Gb;class qb{read(e){if(!e)return null;if(typeof e=="string"){const t=Ms(e);return this.readFromDocument(t)}return Cs(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null}readFromNode(e){}}const x0=qb,Vb="http://www.w3.org/1999/xlink";function ff(n){return n.getAttributeNS(Vb,"href")}const ri=[null,"http://www.opengis.net/ows/1.1"],Wb=Ge(ri,{ServiceIdentification:V(yE),ServiceProvider:V(vE),OperationsMetadata:V(pE)});class Hb extends x0{constructor(){super()}readFromNode(e){const t=Y({},Wb,e,[]);return t||null}}const Xb=Ge(ri,{DeliveryPoint:V(Se),City:V(Se),AdministrativeArea:V(Se),PostalCode:V(Se),Country:V(Se),ElectronicMailAddress:V(Se)}),Yb=Ge(ri,{Value:di(xE)}),Zb=Ge(ri,{AllowedValues:V(lE)}),Kb=Ge(ri,{Phone:V(mE),Address:V(aE)}),Jb=Ge(ri,{HTTP:V(fE)}),Qb=Ge(ri,{Get:di(dE),Post:void 0}),eE=Ge(ri,{DCP:V(uE)}),tE=Ge(ri,{Operation:gE}),iE=Ge(ri,{Voice:V(Se),Facsimile:V(Se)}),nE=Ge(ri,{Constraint:di(hE)}),sE=Ge(ri,{IndividualName:V(Se),PositionName:V(Se),ContactInfo:V(cE)}),rE=Ge(ri,{Abstract:V(Se),AccessConstraints:V(Se),Fees:V(Se),Title:V(Se),ServiceTypeVersion:V(Se),ServiceType:V(Se)}),oE=Ge(ri,{ProviderName:V(Se),ProviderSite:V(ff),ServiceContact:V(_E)});function aE(n,e){return Y({},Xb,n,e)}function lE(n,e){return Y({},Yb,n,e)}function hE(n,e){const t=n.getAttribute("name");if(t)return Y({name:t},Zb,n,e)}function cE(n,e){return Y({},Kb,n,e)}function uE(n,e){return Y({},Jb,n,e)}function dE(n,e){const t=ff(n);if(t)return Y({href:t},nE,n,e)}function fE(n,e){return Y({},Qb,n,e)}function gE(n,e){const t=n.getAttribute("name"),i=Y({},eE,n,e);if(!i)return;const s=e[e.length-1];s[t]=i}function pE(n,e){return Y({},tE,n,e)}function mE(n,e){return Y({},iE,n,e)}function yE(n,e){return Y({},rE,n,e)}function _E(n,e){return Y({},sE,n,e)}function vE(n,e){return Y({},oE,n,e)}function xE(n,e){return Se(n)}const wE=Hb;class Pe extends ue{constructor(e){e=e||{},super(e),this.schemaLocation=e.schemaLocation?e.schemaLocation:this.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd"}writeGeometryElement(e,t,i){const s=i[i.length-1];i[i.length-1]=Object.assign({multiCurve:!0,multiSurface:!0},s),super.writeGeometryElement(e,t,i)}}Pe.prototype.namespace="http://www.opengis.net/gml/3.2";Pe.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:J(ue.prototype.readFlatPos),posList:J(ue.prototype.readFlatPosList),coordinates:J(Ta.prototype.readFlatCoordinates)}};Pe.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:ue.prototype.interiorParser,exterior:ue.prototype.exteriorParser}};Pe.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:J(de.prototype.readPoint),MultiPoint:J(de.prototype.readMultiPoint),LineString:J(de.prototype.readLineString),MultiLineString:J(de.prototype.readMultiLineString),LinearRing:J(de.prototype.readLinearRing),Polygon:J(de.prototype.readPolygon),MultiPolygon:J(de.prototype.readMultiPolygon),Surface:J(Pe.prototype.readSurface),MultiSurface:J(ue.prototype.readMultiSurface),Curve:J(Pe.prototype.readCurve),MultiCurve:J(ue.prototype.readMultiCurve),Envelope:J(Pe.prototype.readEnvelope)}};Pe.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml/3.2":{curveMember:ne(ue.prototype.curveMemberParser),curveMembers:ne(ue.prototype.curveMemberParser)}};Pe.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{surfaceMember:ne(ue.prototype.surfaceMemberParser),surfaceMembers:ne(ue.prototype.surfaceMemberParser)}};Pe.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:ne(de.prototype.readLineString),Curve:ne(ue.prototype.readCurve)}};Pe.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:ne(de.prototype.readPolygon),Surface:ne(ue.prototype.readSurface)}};Pe.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{patches:J(ue.prototype.readPatch)}};Pe.prototype.CURVE_PARSERS={"http://www.opengis.net/gml/3.2":{segments:J(ue.prototype.readSegment)}};Pe.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml/3.2":{lowerCorner:ne(ue.prototype.readFlatPosList),upperCorner:ne(ue.prototype.readFlatPosList)}};Pe.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml/3.2":{PolygonPatch:J(ue.prototype.readPolygonPatch)}};Pe.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml/3.2":{LineStringSegment:s0(ue.prototype.readLineStringSegment)}};Pe.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml/3.2":{pointMember:ne(de.prototype.pointMemberParser),pointMembers:ne(de.prototype.pointMemberParser)}};Pe.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml/3.2":{lineStringMember:ne(de.prototype.lineStringMemberParser),lineStringMembers:ne(de.prototype.lineStringMemberParser)}};Pe.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml/3.2":{polygonMember:ne(de.prototype.polygonMemberParser),polygonMembers:ne(de.prototype.polygonMemberParser)}};Pe.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Point:ne(de.prototype.readFlatCoordinatesFromNode)}};Pe.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:ne(de.prototype.readLineString)}};Pe.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:ne(de.prototype.readPolygon)}};Pe.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:J(de.prototype.readFlatLinearRing),Ring:J(Pe.prototype.readFlatCurveRing)}};Pe.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml/3.2":{exterior:T(ue.prototype.writeRing),interior:T(ue.prototype.writeRing)}};Pe.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lowerCorner:T(ct),upperCorner:T(ct)}};Pe.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{surfaceMember:T(ue.prototype.writeSurfaceOrPolygonMember),polygonMember:T(ue.prototype.writeSurfaceOrPolygonMember)}};Pe.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{pointMember:T(ue.prototype.writePointMember)}};Pe.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lineStringMember:T(ue.prototype.writeLineStringOrCurveMember),curveMember:T(ue.prototype.writeLineStringOrCurveMember)}};Pe.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml/3.2":{Curve:T(ue.prototype.writeCurveOrLineString),MultiCurve:T(ue.prototype.writeMultiCurveOrLineString),Point:T(Pe.prototype.writePoint),MultiPoint:T(ue.prototype.writeMultiPoint),LineString:T(ue.prototype.writeCurveOrLineString),MultiLineString:T(ue.prototype.writeMultiCurveOrLineString),LinearRing:T(ue.prototype.writeLinearRing),Polygon:T(ue.prototype.writeSurfaceOrPolygon),MultiPolygon:T(ue.prototype.writeMultiSurfaceOrPolygon),Surface:T(ue.prototype.writeSurfaceOrPolygon),MultiSurface:T(ue.prototype.writeMultiSurfaceOrPolygon),Envelope:T(ue.prototype.writeEnvelope)}};const gf=Pe;class bE{constructor(e){this.tagName_=e}getTagName(){return this.tagName_}}const w0=bE;class EE extends w0{constructor(e,t){super(e),this.conditions=t,fe(this.conditions.length>=2,"At least 2 conditions are required")}}const CE=EE;class ME extends CE{constructor(e){super("And",Array.prototype.slice.call(arguments))}}const SE=ME;class TE extends w0{constructor(e,t,i){if(super("BBOX"),this.geometryName=e,this.extent=t,t.length!==4)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");this.srsName=i}}const RE=TE;function LE(n){const e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(SE,e))}function IE(n,e,t){return new RE(n,e,t)}const gp={"http://www.opengis.net/gml":{boundedBy:V(de.prototype.readExtentElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:ne(de.prototype.readFeaturesInternal)}},PE={"http://www.opengis.net/wfs":{totalInserted:V(ei),totalUpdated:V(ei),totalDeleted:V(ei)},"http://www.opengis.net/wfs/2.0":{totalInserted:V(ei),totalUpdated:V(ei),totalDeleted:V(ei)}},AE={"http://www.opengis.net/wfs":{TransactionSummary:V(mp,"transactionSummary"),InsertResults:V(_p,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:V(mp,"transactionSummary"),InsertResults:V(_p,"insertIds")}},FE={"http://www.opengis.net/wfs":{PropertyName:T(ct)},"http://www.opengis.net/wfs/2.0":{PropertyName:T(ct)}},b0={"http://www.opengis.net/wfs":{Insert:T(vp),Update:T(wp),Delete:T(xp),Property:T(bp),Native:T(Ep)},"http://www.opengis.net/wfs/2.0":{Insert:T(vp),Update:T(wp),Delete:T(xp),Property:T(bp),Native:T(Ep)}},E0="feature",pf="http://www.w3.org/2000/xmlns/",mf={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},Gu={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},yf={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},pp={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},_f={"2.0.0":gf,"1.1.0":ue,"1.0.0":Ta},OE="1.1.0";class kE extends a0{constructor(e){super(),e=e||{},this.version_=e.version?e.version:OE,this.featureType_=e.featureType,this.featureNS_=e.featureNS,this.gmlFormat_=e.gmlFormat?e.gmlFormat:new _f[this.version_],this.schemaLocation_=e.schemaLocation?e.schemaLocation:pp[this.version_]}getFeatureType(){return this.featureType_}setFeatureType(e){this.featureType_=e}readFeaturesFromNode(e,t){const i={node:e};Object.assign(i,{featureType:this.featureType_,featureNS:this.featureNS_}),Object.assign(i,this.getReadOptions(e,t||{}));const s=[i];let r;this.version_==="2.0.0"?r=gp:r=this.gmlFormat_.FEATURE_COLLECTION_PARSERS;let o=Y([],r,e,s,this.gmlFormat_);return o||(o=[]),o}readTransactionResponse(e){if(e){if(typeof e=="string"){const t=Ms(e);return this.readTransactionResponseFromDocument(t)}return Cs(e)?this.readTransactionResponseFromDocument(e):this.readTransactionResponseFromNode(e)}}readFeatureCollectionMetadata(e){if(e){if(typeof e=="string"){const t=Ms(e);return this.readFeatureCollectionMetadataFromDocument(t)}return Cs(e)?this.readFeatureCollectionMetadataFromDocument(e):this.readFeatureCollectionMetadataFromNode(e)}}readFeatureCollectionMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(t)}readFeatureCollectionMetadataFromNode(e){const t={},i=pr(e.getAttribute("numberOfFeatures"));return t.numberOfFeatures=i,Y(t,gp,e,[],this.gmlFormat_)}readTransactionResponseFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(t)}readTransactionResponseFromNode(e){return Y({},AE,e,[])}writeGetFeature(e){const t=ce(Gu[this.version_],"GetFeature");t.setAttribute("service","WFS"),t.setAttribute("version",this.version_),e.handle&&t.setAttribute("handle",e.handle),e.outputFormat&&t.setAttribute("outputFormat",e.outputFormat),e.maxFeatures!==void 0&&t.setAttribute("maxFeatures",String(e.maxFeatures)),e.resultType&&t.setAttribute("resultType",e.resultType),e.startIndex!==void 0&&t.setAttribute("startIndex",String(e.startIndex)),e.count!==void 0&&t.setAttribute("count",String(e.count)),e.viewParams!==void 0&&t.setAttribute("viewParams",e.viewParams),t.setAttributeNS(Fu,"xsi:schemaLocation",this.schemaLocation_);const i={node:t};if(Object.assign(i,{version:this.version_,srsName:e.srsName,featureNS:e.featureNS?e.featureNS:this.featureNS_,featurePrefix:e.featurePrefix,propertyNames:e.propertyNames?e.propertyNames:[]}),fe(Array.isArray(e.featureTypes),"`options.featureTypes` must be an Array"),typeof e.featureTypes[0]=="string"){let s=e.filter;e.bbox&&(fe(e.geometryName,"`options.geometryName` must also be provided when `options.bbox` is set"),s=this.combineBboxAndFilter(e.geometryName,e.bbox,e.srsName,s)),Object.assign(i,{geometryName:e.geometryName,filter:s}),Fp(t,e.featureTypes,[i])}else e.featureTypes.forEach(s=>{const r=this.combineBboxAndFilter(s.geometryName,s.bbox,e.srsName,e.filter);Object.assign(i,{geometryName:s.geometryName,filter:r}),Fp(t,[s.name],[i])});return t}combineBboxAndFilter(e,t,i,s){const r=IE(e,t,i);return s?LE(s,r):r}writeTransaction(e,t,i,s){const r=[],o=s.version?s.version:this.version_,a=ce(Gu[o],"Transaction");a.setAttribute("service","WFS"),a.setAttribute("version",o);let l;s&&(l=s.gmlOptions?s.gmlOptions:{},s.handle&&a.setAttribute("handle",s.handle)),a.setAttributeNS(Fu,"xsi:schemaLocation",pp[o]);const h=NE(a,l,o,s);return e&&il("Insert",e,r,h),t&&il("Update",t,r,h),i&&il("Delete",i,r,h),s.nativeElements&&il("Native",s.nativeElements,r,h),a}readProjectionFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(t);return null}readProjectionFromNode(e){if(e.firstElementChild&&e.firstElementChild.firstElementChild){e=e.firstElementChild.firstElementChild;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(!(t.childNodes.length===0||t.childNodes.length===1&&t.firstChild.nodeType===3)){const i=[{}];return this.gmlFormat_.readGeometryElement(t,i),X(i.pop().srsName)}}return null}}function NE(n,e,t,i){const s=i.featurePrefix?i.featurePrefix:E0;let r;return t==="1.0.0"?r=2:t==="1.1.0"?r=3:t==="2.0.0"&&(r=3.2),Object.assign({node:n},{version:t,featureNS:i.featureNS,featureType:i.featureType,featurePrefix:s,gmlVersion:r,hasZ:i.hasZ,srsName:i.srsName},e)}function il(n,e,t,i){et(i,b0,mi(n),e,t)}function mp(n,e){return Y({},PE,n,e)}const DE={"http://www.opengis.net/ogc":{FeatureId:ne(function(n,e){return n.getAttribute("fid")})},"http://www.opengis.net/ogc/1.1":{FeatureId:ne(function(n,e){return n.getAttribute("fid")})}};function yp(n,e){Ls(DE,n,e)}const GE={"http://www.opengis.net/wfs":{Feature:yp},"http://www.opengis.net/wfs/2.0":{Feature:yp}};function _p(n,e){return Y([],GE,n,e)}function vp(n,e,t){const i=t[t.length-1],s=i.featureType,r=i.featureNS,o=i.gmlVersion,a=ce(r,s);n.appendChild(a),o===2?Ta.prototype.writeFeatureElement(a,e,t):o===3?ue.prototype.writeFeatureElement(a,e,t):gf.prototype.writeFeatureElement(a,e,t)}function C0(n,e,t){const s=t[t.length-1].version,r=mf[s],o=ce(r,"Filter"),a=ce(r,"FeatureId");o.appendChild(a),a.setAttribute("fid",e),n.appendChild(o)}function vf(n,e){n=n||E0;const t=n+":";return e.startsWith(t)?e:t+e}function xp(n,e,t){const i=t[t.length-1];fe(e.getId()!==void 0,"Features must have an id set");const s=i.featureType,r=i.featurePrefix,o=i.featureNS,a=vf(r,s);n.setAttribute("typeName",a),n.setAttributeNS(pf,"xmlns:"+r,o);const l=e.getId();l!==void 0&&C0(n,l,t)}function wp(n,e,t){const i=t[t.length-1];fe(e.getId()!==void 0,"Features must have an id set");const s=i.version,r=i.featureType,o=i.featurePrefix,a=i.featureNS,l=vf(o,r),h=e.getGeometryName();n.setAttribute("typeName",l),n.setAttributeNS(pf,"xmlns:"+o,a);const c=e.getId();if(c!==void 0){const u=e.getKeys(),d=[];for(let f=0,g=u.length;f<g;f++){const p=e.get(u[f]);if(p!==void 0){let m=u[f];p&&typeof p.getSimplifiedGeometry=="function"&&(m=h),d.push({name:m,value:p})}}et({version:s,gmlVersion:i.gmlVersion,node:n,hasZ:i.hasZ,srsName:i.srsName},b0,mi("Property"),d,t),C0(n,c,t)}}function bp(n,e,t){const i=t[t.length-1],s=i.version,r=Gu[s],o=ce(r,"Name"),a=i.gmlVersion;if(n.appendChild(o),ct(o,e.name),e.value!==void 0&&e.value!==null){const l=ce(r,"Value");n.appendChild(l),e.value&&typeof e.value.getSimplifiedGeometry=="function"?a===2?Ta.prototype.writeGeometryElement(l,e.value,t):a===3?ue.prototype.writeGeometryElement(l,e.value,t):gf.prototype.writeGeometryElement(l,e.value,t):ct(l,e.value)}}function Ep(n,e,t){e.vendorId&&n.setAttribute("vendorId",e.vendorId),e.safeToIgnore!==void 0&&n.setAttribute("safeToIgnore",String(e.safeToIgnore)),e.value!==void 0&&ct(n,e.value)}const tc={"http://www.opengis.net/wfs":{Query:T(Cp)},"http://www.opengis.net/wfs/2.0":{Query:T(Cp)},"http://www.opengis.net/ogc":{During:T(Tp),And:T(nl),Or:T(nl),Not:T(Rp),BBOX:T(Mp),Contains:T(Bn),Intersects:T(Bn),Within:T(Bn),DWithin:T(Sp),PropertyIsEqualTo:T(Ei),PropertyIsNotEqualTo:T(Ei),PropertyIsLessThan:T(Ei),PropertyIsLessThanOrEqualTo:T(Ei),PropertyIsGreaterThan:T(Ei),PropertyIsGreaterThanOrEqualTo:T(Ei),PropertyIsNull:T(Lp),PropertyIsBetween:T(Ip),PropertyIsLike:T(Pp)},"http://www.opengis.net/fes/2.0":{During:T(Tp),And:T(nl),Or:T(nl),Not:T(Rp),BBOX:T(Mp),Contains:T(Bn),Disjoint:T(Bn),Intersects:T(Bn),ResourceId:T(BE),Within:T(Bn),DWithin:T(Sp),PropertyIsEqualTo:T(Ei),PropertyIsNotEqualTo:T(Ei),PropertyIsLessThan:T(Ei),PropertyIsLessThanOrEqualTo:T(Ei),PropertyIsGreaterThan:T(Ei),PropertyIsGreaterThanOrEqualTo:T(Ei),PropertyIsNull:T(Lp),PropertyIsBetween:T(Ip),PropertyIsLike:T(Pp)}};function Cp(n,e,t){const i=t[t.length-1],s=i.version,r=i.featurePrefix,o=i.featureNS,a=i.propertyNames,l=i.srsName;let h;r?h=vf(r,e):h=e;let c;s==="2.0.0"?c="typeNames":c="typeName",n.setAttribute(c,h),l&&n.setAttribute("srsName",l),o&&n.setAttributeNS(pf,"xmlns:"+r,o);const u=Object.assign({},i);u.node=n,et(u,FE,mi("PropertyName"),a,t);const d=i.filter;if(d){const f=ce(ic(s),"Filter");n.appendChild(f),zE(f,d,t)}}function zE(n,e,t){const i=t[t.length-1],s={node:n};Object.assign(s,{context:i}),et(s,tc,mi(e.getTagName()),[e],t)}function Mp(n,e,t){const i=t[t.length-1],r=i.context.version;i.srsName=e.srsName;const o=_f[r];po(r,n,e.geometryName),o.prototype.writeGeometryElement(n,e.extent,t)}function BE(n,e,t){n.setAttribute("rid",e.rid)}function Bn(n,e,t){const i=t[t.length-1],r=i.context.version;i.srsName=e.srsName;const o=_f[r];po(r,n,e.geometryName),o.prototype.writeGeometryElement(n,e.geometry,t)}function Sp(n,e,t){const r=t[t.length-1].context.version;Bn(n,e,t);const o=ce(ic(r),"Distance");ct(o,e.distance.toString()),r==="2.0.0"?o.setAttribute("uom",e.unit):o.setAttribute("units",e.unit),n.appendChild(o)}function Tp(n,e,t){const r=t[t.length-1].context.version;eh(yf[r],"ValueReference",n,e.propertyName);const o=ce(Sn,"TimePeriod");n.appendChild(o);const a=ce(Sn,"begin");o.appendChild(a),Ap(a,e.begin);const l=ce(Sn,"end");o.appendChild(l),Ap(l,e.end)}function nl(n,e,t){const s=t[t.length-1].context,r={node:n};Object.assign(r,{context:s});const o=e.conditions;for(let a=0,l=o.length;a<l;++a){const h=o[a];et(r,tc,mi(h.getTagName()),[h],t)}}function Rp(n,e,t){const s=t[t.length-1].context,r={node:n};Object.assign(r,{context:s});const o=e.condition;et(r,tc,mi(o.getTagName()),[o],t)}function Ei(n,e,t){const r=t[t.length-1].context.version;e.matchCase!==void 0&&n.setAttribute("matchCase",e.matchCase.toString()),po(r,n,e.propertyName),th(r,n,""+e.expression)}function Lp(n,e,t){const r=t[t.length-1].context.version;po(r,n,e.propertyName)}function Ip(n,e,t){const r=t[t.length-1].context.version,o=ic(r);po(r,n,e.propertyName);const a=ce(o,"LowerBoundary");n.appendChild(a),th(r,a,""+e.lowerBoundary);const l=ce(o,"UpperBoundary");n.appendChild(l),th(r,l,""+e.upperBoundary)}function Pp(n,e,t){const r=t[t.length-1].context.version;n.setAttribute("wildCard",e.wildCard),n.setAttribute("singleChar",e.singleChar),n.setAttribute("escapeChar",e.escapeChar),e.matchCase!==void 0&&n.setAttribute("matchCase",e.matchCase.toString()),po(r,n,e.propertyName),th(r,n,""+e.pattern)}function eh(n,e,t,i){const s=ce(n,e);ct(s,i),t.appendChild(s)}function th(n,e,t){eh(ic(n),"Literal",e,t)}function po(n,e,t){n==="2.0.0"?eh(yf[n],"ValueReference",e,t):eh(mf[n],"PropertyName",e,t)}function Ap(n,e){const t=ce(Sn,"TimeInstant");n.appendChild(t);const i=ce(Sn,"timePosition");t.appendChild(i),ct(i,e)}function Fp(n,e,t){const i=t[t.length-1],s=Object.assign({},i);s.node=n,et(s,tc,mi("Query"),e,t)}function ic(n){let e;return n==="2.0.0"?e=yf[n]:e=mf[n],e}const UE=kE,gn=[null,"http://www.opengis.net/wmts/1.0"],mo=[null,"http://www.opengis.net/ows/1.1"],jE=Ge(gn,{Contents:V(eC)});class $E extends x0{constructor(){super(),this.owsParser_=new wE}readFromNode(e){let t=e.getAttribute("version");t&&(t=t.trim());let i=this.owsParser_.readFromNode(e);return i?(i.version=t,i=Y(i,jE,e,[]),i||null):null}}const qE=Ge(gn,{Layer:di(tC),TileMatrixSet:di(iC)}),VE=Ge(gn,{Style:di(nC),Format:di(Se),TileMatrixSetLink:di(sC),Dimension:di(rC),ResourceURL:di(oC)},Ge(mo,{Title:V(Se),Abstract:V(Se),WGS84BoundingBox:V(M0),Identifier:V(Se)})),WE=Ge(gn,{LegendURL:di(aC)},Ge(mo,{Title:V(Se),Identifier:V(Se)})),HE=Ge(gn,{TileMatrixSet:V(Se),TileMatrixSetLimits:V(hC)}),XE=Ge(gn,{TileMatrixLimits:ne(cC)}),YE=Ge(gn,{TileMatrix:V(Se),MinTileRow:V(ei),MaxTileRow:V(ei),MinTileCol:V(ei),MaxTileCol:V(ei)}),ZE=Ge(gn,{Default:V(Se),Value:di(Se)},Ge(mo,{Identifier:V(Se)})),KE=Ge(mo,{LowerCorner:ne(zu),UpperCorner:ne(zu)}),JE=Ge(gn,{WellKnownScaleSet:V(Se),TileMatrix:di(lC)},Ge(mo,{SupportedCRS:V(Se),Identifier:V(Se),BoundingBox:V(M0)})),QE=Ge(gn,{TopLeftCorner:V(zu),ScaleDenominator:V(Yw),TileWidth:V(ei),TileHeight:V(ei),MatrixWidth:V(ei),MatrixHeight:V(ei)},Ge(mo,{Identifier:V(Se)}));function eC(n,e){return Y({},qE,n,e)}function tC(n,e){return Y({},VE,n,e)}function iC(n,e){return Y({},JE,n,e)}function nC(n,e){const t=Y({},WE,n,e);if(!t)return;const i=n.getAttribute("isDefault")==="true";return t.isDefault=i,t}function sC(n,e){return Y({},HE,n,e)}function rC(n,e){return Y({},ZE,n,e)}function oC(n,e){const t=n.getAttribute("format"),i=n.getAttribute("template"),s=n.getAttribute("resourceType"),r={};return t&&(r.format=t),i&&(r.template=i),s&&(r.resourceType=s),r}function M0(n,e){const t=Y([],KE,n,e);if(t.length==2)return gt(t)}function aC(n,e){const t={};return t.format=n.getAttribute("format"),t.href=ff(n),t}function zu(n,e){const t=Se(n).split(/\s+/);if(!t||t.length!=2)return;const i=+t[0],s=+t[1];if(!(isNaN(i)||isNaN(s)))return[i,s]}function lC(n,e){return Y({},QE,n,e)}function hC(n,e){return Y([],XE,n,e)}function cC(n,e){return Y({},YE,n,e)}const uC=$E;class dC{constructor(e,t){_(this,"name");_(this,"url");_(this,"layers");_(this,"initialized");this.name=e,this.url=t,this.layers={},this.initialized=!1}addLayerAttribute(e,t,i){if(!["string","integer","double","long","date"].includes(i)){console.warn(`Unmanaged attribute type: ${i}.`);return}e in this.layers||(this.layers[e]=[]),this.layers[e].push({name:t,type:i})}}var fa,Bu;class S0 extends In{constructor(t){super(t);se(this,fa);_(this,"messageManager");_(this,"stateManager");_(this,"maxFeatures",1e4);_(this,"serversWfs",{});_(this,"featureTypeToGeometryColumnName",{});this.stateManager=an.getInstance(),this.messageManager=md.getInstance(),this.stateManager.subscribe("selection.selectionParameters",(i,s)=>this.onSelectFeatures(s))}get state(){return this.stateManager.state}onSelectFeatures(t){this.state.loading=!0,this.state.selection.selectedFeatures=[];const i=[];for(const s of t)for(const r of s.layers)r.queryable&&r.urlWfs&&!(r.urlWfs in this.serversWfs)&&i.push(r.urlWfs);i.length===0?this.wfsQuery(t):ae(this,fa,Bu).call(this,i).then(()=>{this.wfsQuery(t)})}async getServerWfs(t){return t in this.serversWfs||await ae(this,fa,Bu).call(this,[t]),this.serversWfs[t]}manageLayerAttribute(t,i,s){let r=!1;const o=i.getAttribute("type");if(o&&o.startsWith("gml:")){const a=i.getAttribute("name");if(a)this.featureTypeToGeometryColumnName[s]=a,r=!0;else throw new Error("Why is geometryAttributeName null here ?")}else{const a=i.getAttribute("name"),l=i.getAttribute("type");!a||!l?console.warn(`Error while loading attribute for layer ${s}. Querying or filtering this layer won't work correctly.`):t.addLayerAttribute(s,a,l)}return r}getElementToTypeName(t){const i={},s=t.querySelectorAll(":scope>element");for(const r of s)if(r.hasAttribute("name")&&r.hasAttribute("type")){const o=r.getAttribute("name");let a=r.getAttribute("type");a&&o&&(a.includes(":")&&(a=a.split(":")[1]),i[a]=o)}else console.log("What happend with this element?");return i}getDescribeFeatureTypeUrl(t){const i=new URL(t);return i.searchParams.set("service","WFS"),i.searchParams.set("request","DescribeFeatureType"),i.searchParams.set("version","1.1.0"),i.href}wfsQuery(t){const i=[];for(const s of t){const r=this.getQueryableLayers(s);if(r.length<=0)continue;if(!r[0].urlWfs)throw new Error("The queryable Layers must have a WFS Url!");const o=this.getGeometryColumnNameToFeatureTypes(r);for(const[a,l]of Object.entries(o)){const h=new UE().writeGetFeature({srsName:s.srid,featureNS:"https://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureTypes:l,maxFeatures:this.maxFeatures,outputFormat:"GML3",geometryName:a,bbox:s.selectionBox});i.push(fetch(r[0].urlWfs,{method:"POST",body:new XMLSerializer().serializeToString(h)}))}}Promise.all(i).then(async s=>{const r=[];for(let o=0;o<s.length;++o){const a=await s[o].text(),l=new ue().readFeatures(a);r.push(...l)}r.length===0?this.state.interface.selectionGridVisible=!1:(this.state.selection.selectedFeatures=r,this.state.interface.selectionGridVisible=!0),this.state.loading=!1})}getQueryableLayers(t){const i=t.layers.filter(s=>s.queryable);if(i.length>0){if(!i[0].urlWfs)throw new Error("The queryable Layers must have a WFS Url!");if(!i.every(r=>r.urlWfs===i[0].urlWfs))throw new Error("Not all layers of this list have the same WFS URL. We cannot do que WFS query.")}return i}getGeometryColumnNameToFeatureTypes(t){const i={},s=t.map(r=>r.queryLayers.split(",")).flat(1);for(const r of s){const o=this.featureTypeToGeometryColumnName[r];o in i||(i[o]=[]),i[o].push(r)}return i}}fa=new WeakSet,Bu=async function(t){for(const i of t){const s=new dC("",i),r=this.getDescribeFeatureTypeUrl(i),a=await(await fetch(r)).text(),l=new DOMParser().parseFromString(a,"text/xml"),h=this.getElementToTypeName(l),c=l.getElementsByTagName("complexType");for(const u of c){const d=u.getAttribute("name");if(!d)throw new Error("Could not find a name for the complex type");const f=h[d],g=u.getElementsByTagName("sequence")[0].getElementsByTagName("element");let p=!1;for(const m of g)this.manageLayerAttribute(s,m,f)&&(p=!0);if(!p)throw new Error("No Geometry column for the type "+f)}s.initialized=!0,this.serversWfs[i]=s}};class Pt{static isNumeric(e){return e.trim().length>0&&!isNaN(Number(e))}static getFilter(e,t,i,s){if(!i)throw new Error("The type of the property should never be null !");switch(e){case"eq":return i==="string"&&Pt.isNumeric(s)?Pt.likeFilter(t,s):Pt.eqFilter(t,s);case"neq":return i==="string"&&Pt.isNumeric(s)?Pt.nlikeFilter(t,s):Pt.neqFilter(t,s);case"gt":return Pt.gtFilter(t,s);case"gte":return Pt.gteFilter(t,s);case"lt":return Pt.ltFilter(t,s);case"lte":return Pt.lteFilter(t,s);case"like":return Pt.likeFilter(t,"*"+s+"*");case"nlike":return Pt.nlikeFilter(t,"*"+s+"*");case"nul":return Pt.eqFilter(t,"");case"nnul":return Pt.neqFilter(t,"");default:throw new Error("Unknown filter operator")}}static eqFilter(e,t){return`<Filter><PropertyIsEqualTo><PropertyName>${e}</PropertyName><Literal>${t}</Literal></PropertyIsEqualTo></Filter>`}static neqFilter(e,t){return`<Filter><Not><PropertyIsEqualTo><PropertyName>${e}</PropertyName><Literal>${t}</Literal></PropertyIsEqualTo></Not></Filter>`}static ltFilter(e,t){return`<Filter><PropertyIsLessThan><PropertyName>${e}</PropertyName><Literal>${t}</Literal></PropertyIsLessThan></Filter>`}static lteFilter(e,t){return`<Filter><PropertyIsLessThanOrEqualTo><PropertyName>${e}</PropertyName><Literal>${t}</Literal></PropertyIsLessThanOrEqualTo></Filter>`}static gtFilter(e,t){return`<Filter><PropertyIsGreaterThan><PropertyName>${e}</PropertyName><Literal>${t}</Literal></PropertyIsGreaterThan></Filter>`}static gteFilter(e,t){return`<Filter><PropertyIsGreaterThanOrEqualTo><PropertyName>${e}</PropertyName><Literal>${t}</Literal></PropertyIsGreaterThanOrEqualTo></Filter>`}static likeFilter(e,t){return`<Filter><PropertyIsLike wildcard='*' singleChar='.' escape='!'><PropertyName>${e}</PropertyName><Literal>${t}</Literal></PropertyIsLike></Filter>`}static nlikeFilter(e,t){return`<Filter><Not><PropertyIsLike wildcard='*' singleChar='.' escape='!'><PropertyName>${e}</PropertyName><Literal>${t}</Literal></PropertyIsLike></Not></Filter>`}}class T0 extends ot{constructor(t){super("querybuilder");_(this,"template",()=>xe`<style>
.content {
  display: flex;
}

.hidden {
  display: none;
}

.loading i {
  margin: 0.8rem;
}

button {
  border: none;
  border-right: solid 1px #fff;
  width: 2.3rem;
  height: 2.3rem;
  line-height: 2.3rem;
  background-color: #444;
  color: #fff;
  padding: 0;
  cursor: pointer;
  margin:0;
  display: inline-block;
}

button:hover {
  background-color: #000;
}

/* Custom style for select */
.custom-select {
  min-width: 15rem;
  position: relative;
}

input, select {
  border: solid 1px #ccc;
  border-radius: 0.25rem;
  background-color: #fff;
  padding-left: 1rem;
  color: #000;
  font-size: 0.9rem;
}

select {
  appearance: none;
  -webkit-appearance: none;
  width: 100%;
  height: 100%;
  cursor: pointer;
}

.custom-select::before,
.custom-select::after {
  content: "";
  position: absolute;
  right: 1rem;
  pointer-events: none;
}

.custom-select::after {
  border-left: 0.4rem solid transparent;
  border-right: 0.4rem solid transparent;
  border-top: 0.4rem solid black;
  top: 45%;
}

</style>
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />

<div>
  <div class="${this.loading?"loading":"loading hidden"}">
    <i class="fa-xl fa-solid fa-circle-notch fa-spin"></i>
    Loading server configuration...
  </div>
  <div class="${this.loading?"content hidden":"content"}">
    <div class="custom-select">
      <select id="attribute" name="attribute" onchange="${()=>this.attributeChanged()}">
        <option value="" disabled selected>Select attribute...</option>
        ${this.layerAttributes.map(t=>xe.for(t)`<option i18n="${t.name}" value="${t.name}">${t.name}</option>`)}
      </select>
    </div>

    <div class="custom-select">
      <select id="operator" name="operator" onchange="${()=>this.operatorChanged()}">
        <option value="" disabled selected>Select operator...</option>
        <option value="eq" class="${this.isNumber||this.isString?"":"hidden"}">equals</option>
        <option value="neq" class="${this.isNumber||this.isString?"":"hidden"}">does not equal</option>
        <option value="like" class="${this.isString?"":"hidden"}">contains</option>
        <option value="nlike" class="${this.isString?"":"hidden"}">does not contain</option>
        <option value="gt" class="${this.isNumber?"":"hidden"}">greater than</option>
        <option value="gte" class="${this.isNumber?"":"hidden"}">greater than or equal to</option>
        <option value="lt" class="${this.isNumber?"":"hidden"}">less than</option>
        <option value="lte" class="${this.isNumber?"":"hidden"}">less than or equal to</option>
        <option value="nul" class="${this.isNumber||this.isString?"":"hidden"}">is blank</option>
        <option value="nnul" class="${this.isNumber||this.isString?"":"hidden"}">is not blank</option>
      </select>
    </div>

    <input id="val" type="text" class="${this.showVal?"":"hidden"}" placeholder="Enter value..." />

    <button tip="Apply filter" onclick="${()=>this.filter()}">
      <i class="fa-sm fa-solid fa-filter"></i>
    </button>

    <button tip="Remove filter" onclick="${()=>this.removeFilter()}">
      <i class="fa-sm fa-solid fa-trash"></i>
    </button>

  </div>

</div>`);_(this,"loading",!0);_(this,"layer");_(this,"layerAttributes",[]);_(this,"currentAttributeType",null);_(this,"showVal",!1);this.layer=t}render(){if(!this.layer.urlWfs)throw new Error("No WFS URL found. Please verify the Layer type.");super.render(),S0.getInstance().getServerWfs(this.layer.urlWfs).then(t=>{this.layerAttributes=t.layers[this.layer.name],this.loading=!1,super.render(),super.girafeTranslate(),this.activateTooltips(!1,[800,0],"top-end")})}get isString(){return this.currentAttributeType==="string"||this.currentAttributeType==="date"}get isNumber(){return this.currentAttributeType==="integer"||this.currentAttributeType==="double"||this.currentAttributeType==="long"}attributeChanged(){const t=this.shadow.getElementById("attribute"),i=this.layerAttributes.find(s=>s.name=t.value);if(!i)throw new Error("Why is this object null ? This should never happen...");this.currentAttributeType=i.type,super.render()}operatorChanged(){const t=this.shadow.getElementById("operator");this.showVal=t.value!=="nul"&&t.value!=="nnul",super.render()}filter(){const t=this.shadow.getElementById("attribute"),i=this.shadow.getElementById("operator"),s=this.shadow.getElementById("val");this.layer.filter=Pt.getFilter(i.value,t.value,this.currentAttributeType,s.value),console.log(this.layer.filter)}removeFilter(){const t=this.shadow.getElementById("attribute"),i=this.shadow.getElementById("operator"),s=this.shadow.getElementById("val");this.layer.filter="",t.value="",i.value="",s.value="",this.currentAttributeType=null,this.showVal=!1,super.render()}connectedCallback(){this.loadConfig().then(()=>{this.render()})}}customElements.define("girafe-query-builder",T0);class fC extends ot{constructor(t){super("treeviewitem");_(this,"template",()=>{var t;return xe`<style>
.item {
  color: #999;
  border-top: solid 1px #ddd;
  line-height: 1.3rem;
  display: flex;
  flex-wrap: wrap;
}

.hidden {
  display: none;
}

.invisible {
  visibility: hidden;
}

.selectable {
  cursor: pointer;
}

.selectable:hover {
  color: var(--text-color);
}

.selected {
  cursor: pointer;
  color: var(--text-color);
}

i {
  width: 0.8rem;
  text-align:center;
  min-width: 0;
  padding-top: 0.45rem;
  margin-left: 0.3rem;
}

.expand-spacer {
  order: 1;
  width: 0.5rem;
}

.circle-on, .circle-off {
  order: 2;
  padding-top: 0.25rem;
  margin-left: 0.2rem;
  margin-right: 0.1rem;
  cursor: pointer;
}

.legend-icon {
  order: 2;
  max-height: 1rem;
  padding-top: 0.25rem;
  margin-left: 0.2rem;
  cursor: pointer;
  object-fit: none;
}

.error {
  order: 3;
  color: #b00;
}

.text {
  order: 4;
  display: inline-block;
  margin: 0.2rem;
  flex-grow: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  width: 0;
}

.text.filtered {
  background-color: var(--bkg-color-grad2);
  color: var(--text-color-grad2);
}

.resolution {
  order: 5;
}

.swipe-left {
  order: 5;
}

.swipe-right {
  order: 7;
}

.movedown {
  order: 8;
}

.moveup {
  order: 9;
}

.opacity {
  order: 10;
}

.filter {
  order: 11;
}

.legend {
  order: 12;
}

.item i.advanced {
  display: none;
}

.item.advanced i.advanced {
  display: block;
}
</style>
<link rel="stylesheet" href="lib/font-gis/css/font-gis.css" />
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />
<link rel="stylesheet" href="lib/tippy.js/tippy.min.css" />

<div class="${this.state.treeview.advanced?"item advanced":"item"}">

  <!-- spacer for alignment -->
  <div class="invisible expand-spacer"></div>

  <!-- Bullet or Checkbox or Icon -->
  <img
    class="${this.layer instanceof ht&&!this.configManager.Config.treeview.useCheckboxes&&this.configManager.Config.treeview.useLegendIcons&&this.iconUrl?"legend-icon":"legend-icon hidden"}"
    alt="${"Icon for "+this.layer.name}" 
    onclick="${()=>this.toggle()}" 
    src="${this.iconUrl}">
  <div
    class="${(!this.layer instanceof ht||!this.configManager.Config.treeview.useLegendIcons||!this.iconUrl||this.configManager.Config.treeview.useCheckboxes)&&this.layer.activeState==="off"?"circle-off selectable":"circle-off hidden"}"
    onclick="${()=>this.toggle()}">
    <i class="${this.configManager.Config.treeview.useCheckboxes?"fa-lg fa-regular fa-square selbox":"fa-xs fa-regular fa-circle selcircle"}"></i>
  </div>
  <div
    class="${(!this.layer instanceof ht||!this.configManager.Config.treeview.useLegendIcons||!this.iconUrl||this.configManager.Config.treeview.useCheckboxes)&&this.layer.activeState==="on"?"circle-on selected":"circle-on hidden"}"
    onclick="${()=>this.toggle()}">
    <i class="${this.configManager.Config.treeview.useCheckboxes?"fa-lg fa-solid fa-square-check selbox":"fa-xs fa-solid fa-circle selcircle"}"></i>
  </div>

  <!-- Error icon -->
  <i class="${this.layer.hasError?"fa-solid fa-circle-exclamation tool error":"error hidden"}"
     tip="${this.layer.errorMessage}"></i>

  <!-- Label -->
  <span 
    i18n="${this.layer.name}" 
    class="${this.layer.activeState==="on"?this.layer.hasFilter?"text selected filtered":"text selected":"text selectable"}"
    tip="${this.layer.hasFilter?"This layer is filtered.":""}"
    onclick="${()=>this.toggle()}">${this.layer.name}</span>

  <!-- zoom to resolution -->
  <i 
    class="${this.layer instanceof ht&&this.layer.hasRestrictedResolution()?"fa-solid fa-magnifying-glass tool selectable resolution":"resolution hidden"}"
    tip="Zoom to visible resolution" 
    onclick="${()=>this.zoomToVisibleResolution()}">
  </i>

  <!-- swipe icons -->
  <i class="fa-solid fa-arrow-left tool selectable swipe-left advanced" tip="Swipe layer on the left"
     onclick="${()=>this.swipeLayer("left")}"></i>
  <i class="fa-solid fa-arrow-right tool selectable swipe-right advanced" tip="Swipe layer on the right"
     onclick="${()=>this.swipeLayer("right")}"></i>

  <!-- move icons -->
  <i class="fa-solid fa-caret-down advanced tool movedown selectable" tip="Move this layer down"></i>
  <i class="fa-solid fa-caret-up advanced tool moveup selectable" tip="Move this layer up"></i>

  <i id="opacity" class="fa-regular fa-sun tool selectable opacity advanced" tip="Control opacity"></i>

  <!-- Filter -->
  <i id="filter" 
     class="${this.layer instanceof ht&&this.layer.queryable?"fa-solid fa-filter tool selectable filter advanced":"filter invisible"}"
     tip="Filter layer"></i>

  <!-- Toggle legend icon -->
  <div class="${this.layer instanceof ht&&this.layer.legend?"legend selectable":"legend invisible"}">
    <i tip="Toggle legend"
      class="${this.layer.isLegendExpanded?"fa-solid fa-bars fa-rotate-270 tool selectable":"fa-solid fa-bars tool selectable"}"
      onclick="${()=>this.layer.isLegendExpanded=!this.layer.isLegendExpanded}"></i>
  </div>
  
</div>

${(t=this.layer.layers)==null?void 0:t.split(",").map(i=>xe`<img
  class="${this.layer instanceof ht&&this.layer.legend&&this.layer.isLegendExpanded?"legend-image":"legend-image hidden"}"
  alt="${"Legend for "+i}" src="${this.legendUrls[i]}">`)}`});_(this,"layerManager");_(this,"layer");_(this,"iconUrl",null);_(this,"legendUrls",{});this.layerManager=ya.getInstance(),this.layer=t}render(){const t=this.getAttribute("layerid");t&&(this.layer=this.layerManager.getTreeItem(t),this.setLegend()),super.render(),this.createOpacityTooltip(),this.createFilterTooltip(),this.createTooltips()}setLegend(){if(!(this.layer instanceof ht)){this.layerManager.setError(this.layer,`${this.layer.name} is not a WMS layer, and should not have a legend configured in the backend.`);return}this.layer.iconUrl?this.iconUrl=this.layer.iconUrl:this.layer.legendRule?this.iconUrl=Object.values(this.getLegendImageUrlFromWms(!0))[0]:this.iconUrl=null,this.layer.legend&&(this.layer.legendImage?this.legendUrls[this.layer.layers]=this.layer.legendImage:this.legendUrls=this.getLegendImageUrlFromWms(!1))}getLegendImageUrlFromWms(t){if(!(this.layer instanceof ht))throw new Error(`${this.layer.name} is not a WMS layer, this method should not be called.`);const i={};for(const s of this.layer.layers.split(",")){let o=new Bd({url:this.layer.url,params:{LAYERS:s},ratio:1}).getLegendUrl(this.state.position.resolution);if(!o){console.error(`The URL for legend of layer ${s} could not be calculated.`),i[s]="";continue}o.toLowerCase().includes("sld_version")||(o+="&SLD_Version=1.1.0"),t&&(this.isNullOrUndefined(this.layer.legendRule)||(o+="&RULE="+encodeURIComponent(this.layer.legendRule)),o+="&HEIGHT="+this.configManager.Config.treeview.defaultIconSize.height,o+="&WIDTH="+this.configManager.Config.treeview.defaultIconSize.width),i[s]=o}return i}createOpacityTooltip(){const t=this.shadow.getElementById("opacity");zo(t,{trigger:"click",arrow:!0,interactive:!0,theme:"light",placement:"bottom-end",content:i=>{const s=document.createElement("input");return s.type="range",s.className="slider",s.min="0",s.max="20",s.value=(this.layer.opacity*20).toString(),s.oninput=r=>this.layer.opacity=parseInt(s.value)/20,s}})}createFilterTooltip(){const t=this.shadow.getElementById("filter");zo(t,{trigger:"click",arrow:!0,interactive:!0,theme:"light",placement:"right",appendTo:document.body,content:i=>new T0(this.layer)})}registerEvents(){this.stateManager.subscribe("layers.layersList..*.isLegendExpanded",(t,i,s)=>this.refreshRender(s)),this.stateManager.subscribe("layers.layersList..*.activeState",(t,i,s)=>this.refreshRender(s)),this.stateManager.subscribe("layers.layersList..*.hasError",(t,i,s)=>this.refreshRender(s)),this.stateManager.subscribe("layers.layersList..*.errorMessage",(t,i,s)=>this.refreshRender(s)),this.stateManager.subscribe("layers.layersList..*.filter",(t,i,s)=>this.refreshRender(s)),this.stateManager.subscribe("treeview.advanced",()=>super.render()),this.stateManager.subscribe("position.resolution",()=>this.refreshLegends())}refreshLegends(){this.setLegend(),super.render()}refreshRender(t){t===this.layer&&(super.render(),this.createTooltips())}createTooltips(){super.activateTooltips(!1,[800,0],"right")}toggle(t){this.layerManager.toggleLayer(this.layer,t)}zoomToVisibleResolution(){if(!(this.layer instanceof ht))throw new Error(`${this.layer.name} is not a WMS layer, this method should not be called here.`);if(this.layer.maxResolution!==null){const t=this.layer.maxResolution-.1*this.layer.maxResolution;this.state.position.resolution=t}}swipeLayer(t){this.layer.activeState==="off"&&this.toggle("on");const i=t==="left"?"right":"left",s={left:[],right:[]};s[i]=this.state.layers.swipedLayers[i].filter(r=>r.treeItemId!==this.layer.treeItemId),s[t]=[...this.state.layers.swipedLayers[t]],s[t].push(this.layer),this.state.layers.swipedLayers=s}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}}customElements.define("girafe-tree-view-item",fC);const wt={ADD:"add",REMOVE:"remove"},Op={LENGTH:"length"};class sl extends _i{constructor(e,t,i){super(e),this.element=t,this.index=i}}class gC extends Xi{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e||[],this.unique_)for(let i=0,s=this.array_.length;i<s;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,i=e.length;t<i;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let i=0,s=t.length;i<s;++i)e(t[i],i,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(Op.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new sl(wt.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){this.unique_&&this.assertUnique_(e);const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let i=0,s=t.length;i<s;++i)if(t[i]===e)return this.removeAt(i)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new sl(wt.REMOVE,t,e)),t}setAt(e,t){const i=this.getLength();if(e>=i){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const s=this.array_[e];this.array_[e]=t,this.dispatchEvent(new sl(wt.REMOVE,s,e)),this.dispatchEvent(new sl(wt.ADD,t,e))}updateLength_(){this.set(Op.LENGTH,this.array_.length)}assertUnique_(e,t){for(let i=0,s=this.array_.length;i<s;++i)if(this.array_[i]===e&&i!==t)throw new Error("Duplicate item added to a unique collection")}}const Vt=gC,Be={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class pC extends Xi{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[Be.OPACITY]=e.opacity!==void 0?e.opacity:1,fe(typeof t[Be.OPACITY]=="number","Layer opacity must be a number"),t[Be.VISIBLE]=e.visible!==void 0?e.visible:!0,t[Be.Z_INDEX]=e.zIndex,t[Be.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[Be.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[Be.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[Be.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0?!0:e},i=this.getZIndex();return t.opacity=Je(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=i===void 0&&!t.managed?1/0:i,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return ie()}getLayerStatesArray(e){return ie()}getExtent(){return this.get(Be.EXTENT)}getMaxResolution(){return this.get(Be.MAX_RESOLUTION)}getMinResolution(){return this.get(Be.MIN_RESOLUTION)}getMinZoom(){return this.get(Be.MIN_ZOOM)}getMaxZoom(){return this.get(Be.MAX_ZOOM)}getOpacity(){return this.get(Be.OPACITY)}getSourceState(){return ie()}getVisible(){return this.get(Be.VISIBLE)}getZIndex(){return this.get(Be.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(Be.EXTENT,e)}setMaxResolution(e){this.set(Be.MAX_RESOLUTION,e)}setMinResolution(e){this.set(Be.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(Be.MAX_ZOOM,e)}setMinZoom(e){this.set(Be.MIN_ZOOM,e)}setOpacity(e){fe(typeof e=="number","Layer opacity must be a number"),this.set(Be.OPACITY,e)}setVisible(e){this.set(Be.VISIBLE,e)}setZIndex(e){this.set(Be.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const R0=pC,hn={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},We={ANIMATING:0,INTERACTING:1},Ni={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},L0=42,xf=256;function kp(n,e,t){return function(i,s,r,o,a){if(!i)return;if(!s&&!e)return i;const l=e?0:r[0]*s,h=e?0:r[1]*s,c=a?a[0]:0,u=a?a[1]:0;let d=n[0]+l/2+c,f=n[2]-l/2+c,g=n[1]+h/2+u,p=n[3]-h/2+u;d>f&&(d=(f+d)/2,f=d),g>p&&(g=(p+g)/2,p=g);let m=Je(i[0],d,f),v=Je(i[1],g,p);if(o&&t&&s){const y=30*s;m+=-y*Math.log(1+Math.max(0,d-i[0])/y)+y*Math.log(1+Math.max(0,i[0]-f)/y),v+=-y*Math.log(1+Math.max(0,g-i[1])/y)+y*Math.log(1+Math.max(0,i[1]-p)/y)}return[m,v]}}function mC(n){return n}function wf(n,e,t,i){const s=Me(e)/t[0],r=yt(e)/t[1];return i?Math.min(n,Math.max(s,r)):Math.min(n,Math.min(s,r))}function bf(n,e,t){let i=Math.min(n,e);const s=50;return i*=Math.log(1+s*Math.max(0,n/e-1))/s+1,t&&(i=Math.max(i,t),i/=Math.log(1+s*Math.max(0,t/n-1))/s+1),Je(i,t/2,e*2)}function yC(n,e,t,i){return e=e!==void 0?e:!0,function(s,r,o,a){if(s!==void 0){const l=n[0],h=n[n.length-1],c=t?wf(l,t,o,i):l;if(a)return e?bf(s,c,h):Je(s,h,c);const u=Math.min(c,s),d=Math.floor($h(n,u,r));return n[d]>c&&d<n.length-1?n[d+1]:n[d]}}}function _C(n,e,t,i,s,r){return i=i!==void 0?i:!0,t=t!==void 0?t:0,function(o,a,l,h){if(o!==void 0){const c=s?wf(e,s,l,r):e;if(h)return i?bf(o,c,t):Je(o,t,c);const u=1e-9,d=Math.ceil(Math.log(e/c)/Math.log(n)-u),f=-a*(.5-u)+.5,g=Math.min(c,o),p=Math.floor(Math.log(e/g)/Math.log(n)+f),m=Math.max(d,p),v=e/Math.pow(n,m);return Je(v,t,c)}}}function Np(n,e,t,i,s){return t=t!==void 0?t:!0,function(r,o,a,l){if(r!==void 0){const h=i?wf(n,i,a,s):n;return!t||!l?Je(r,e,h):bf(r,h,e)}}}function Ef(n){if(n!==void 0)return 0}function Dp(n){if(n!==void 0)return n}function vC(n){const e=2*Math.PI/n;return function(t,i){if(i)return t;if(t!==void 0)return t=Math.floor(t/e+.5)*e,t}}function xC(n){return n=n||Rs(5),function(e,t){if(t)return e;if(e!==void 0)return Math.abs(e)<=n?0:e}}function I0(n){return Math.pow(n,3)}function ls(n){return 1-I0(1-n)}function wC(n){return 3*n*n-2*n*n*n}function bC(n){return n}const Mc=0;class EC extends Xi{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Nd(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&Py(),e.center&&(e.center=je(e.center,this.projection_)),e.extent&&(e.extent=sn(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const a in Ni)delete t[a];this.setProperties(t,!0);const i=MC(e);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=i.minZoom;const s=CC(e),r=i.constraint,o=SC(e);this.constraints_={center:s,resolution:r,rotation:o},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const i=this.getCenterInternal();if(i){const s=e||[0,0,0,0];t=t||[0,0,0,0];const r=this.getResolution(),o=r/2*(s[3]-t[3]+t[1]-s[1]),a=r/2*(s[0]-t[0]+t[2]-s[2]);this.setCenterInternal([i[0]+o,i[1]-a])}}getUpdatedOptions_(e){const t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let i=0;i<t.length;++i){let s=arguments[i];s.center&&(s=Object.assign({},s),s.center=je(s.center,this.getProjection())),s.anchor&&(s=Object.assign({},s),s.anchor=je(s.anchor,this.getProjection())),t[i]=s}this.animateInternal.apply(this,t)}animateInternal(e){let t=arguments.length,i;t>1&&typeof arguments[t-1]=="function"&&(i=arguments[t-1],--t);let s=0;for(;s<t&&!this.isDef();++s){const c=arguments[s];c.center&&this.setCenterInternal(c.center),c.zoom!==void 0?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),c.rotation!==void 0&&this.setRotation(c.rotation)}if(s===t){i&&rl(i,!0);return}let r=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;s<t;++s){const c=arguments[s],u={start:r,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||wC,callback:i};if(c.center&&(u.sourceCenter=o,u.targetCenter=c.center.slice(),o=u.targetCenter),c.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(c.zoom),a=u.targetResolution):c.resolution&&(u.sourceResolution=a,u.targetResolution=c.resolution,a=u.targetResolution),c.rotation!==void 0){u.sourceRotation=l;const d=Jn(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}TC(u)?u.complete=!0:r+=u.duration,h.push(u)}this.animations_.push(h),this.setHint(We.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[We.ANIMATING]>0}getInteracting(){return this.hints_[We.INTERACTING]>0}cancelAnimations(){this.setHint(We.ANIMATING,-this.hints_[We.ANIMATING]);let e;for(let t=0,i=this.animations_.length;t<i;++t){const s=this.animations_[t];if(s[0].callback&&rl(s[0].callback,!1),!e)for(let r=0,o=s.length;r<o;++r){const a=s[r];if(!a.complete){e=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let i=this.animations_.length-1;i>=0;--i){const s=this.animations_[i];let r=!0;for(let o=0,a=s.length;o<a;++o){const l=s[o];if(l.complete)continue;const h=e-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):r=!1;const u=l.easing(c);if(l.sourceCenter){const d=l.sourceCenter[0],f=l.sourceCenter[1],g=l.targetCenter[0],p=l.targetCenter[1];this.nextCenter_=l.targetCenter;const m=d+u*(g-d),v=f+u*(p-f);this.targetCenter_=[m,v]}if(l.sourceResolution&&l.targetResolution){const d=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const f=this.getViewportSize_(this.getRotation()),g=this.constraints_.resolution(d,0,f,!0);this.targetCenter_=this.calculateCenterZoom(g,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const d=u===1?Jn(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const f=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(f,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),t=!0,!l.complete)break}if(r){this.animations_[i]=null,this.setHint(We.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=s[0].callback;o&&rl(o,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let i;const s=this.getCenterInternal();return s!==void 0&&(i=[s[0]-t[0],s[1]-t[1]],Fd(i,e-this.getRotation()),My(i,t)),i}calculateCenterZoom(e,t){let i;const s=this.getCenterInternal(),r=this.getResolution();if(s!==void 0&&r!==void 0){const o=t[0]-e*(t[0]-s[0])/r,a=t[1]-e*(t[1]-s[1])/r;i=[o,a]}return i}getViewportSize_(e){const t=this.viewportSize_;if(e){const i=t[0],s=t[1];return[Math.abs(i*Math.cos(e))+Math.abs(s*Math.sin(e)),Math.abs(i*Math.sin(e))+Math.abs(s*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&Gs(e,this.getProjection())}getCenterInternal(){return this.get(Ni.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return Hh(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();fe(t,"The view center is not defined");const i=this.getResolution();fe(i!==void 0,"The view resolution is not defined");const s=this.getRotation();return fe(s!==void 0,"The view rotation is not defined"),Uo(t,i,s,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(Ni.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(sn(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const i=Me(e)/t[0],s=yt(e)/t[1];return Math.max(i,s)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,s=Math.log(t/i)/Math.log(e);return function(r){return t/Math.pow(e,r*s)}}getRotation(){return this.get(Ni.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),i=this.getConstrainedResolution(this.maxResolution_),s=this.minResolution_,r=Math.log(i/s)/t;return function(o){return Math.log(i/o)/t/r}}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const i=this.padding_;return i&&(t=[t[0]-i[1]-i[3],t[1]-i[0]-i[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),i=this.getRotation();let s=this.getCenterInternal();const r=this.padding_;if(r){const o=this.getViewportSizeMinusPadding_();s=Sc(s,this.getViewportSize_(),[o[0]/2+r[3],o[1]/2+r[0]],t,i)}return{center:s.slice(0),projection:e!==void 0?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return t!==void 0&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t=this.minZoom_||0,i,s;if(this.resolutions_){const r=$h(this.resolutions_,e,1);t=r,i=this.resolutions_[r],r==this.resolutions_.length-1?s=2:s=i/this.resolutions_[r+1]}else i=this.maxResolution_,s=this.zoomFactor_;return t+Math.log(i/e)/Math.log(s)}getResolutionForZoom(e){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const t=Je(Math.floor(e),0,this.resolutions_.length-2),i=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(i,Je(e-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let i;if(fe(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(e)){fe(!Hs(e),"Cannot fit empty extent provided as `geometry`");const s=sn(e,this.getProjection());i=Qg(s)}else if(e.getType()==="Circle"){const s=sn(e.getExtent(),this.getProjection());i=Qg(s),i.rotate(this.getRotation(),Nt(s))}else i=e;this.fitInternal(i,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),i=Math.cos(t),s=Math.sin(-t),r=e.getFlatCoordinates(),o=e.getStride();let a=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,d=r.length;u<d;u+=o){const f=r[u]*i-r[u+1]*s,g=r[u]*s+r[u+1]*i;a=Math.min(a,f),l=Math.min(l,g),h=Math.max(h,f),c=Math.max(c,g)}return[a,l,h,c]}fitInternal(e,t){t=t||{};let i=t.size;i||(i=this.getViewportSizeMinusPadding_());const s=t.padding!==void 0?t.padding:[0,0,0,0],r=t.nearest!==void 0?t.nearest:!1;let o;t.minResolution!==void 0?o=t.minResolution:t.maxZoom!==void 0?o=this.getResolutionForZoom(t.maxZoom):o=0;const a=this.rotatedExtentForGeometry(e);let l=this.getResolutionForExtentInternal(a,[i[0]-s[1]-s[3],i[1]-s[0]-s[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,r?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),d=Nt(a);d[0]+=(s[1]-s[3])/2*l,d[1]+=(s[0]-s[2])/2*l;const f=d[0]*u-d[1]*c,g=d[1]*u+d[0]*c,p=this.getConstrainedCenter([f,g],l),m=t.callback?t.callback:Qr;t.duration!==void 0?this.animateInternal({resolution:l,center:p,duration:t.duration,easing:t.easing},m):(this.targetResolution_=l,this.targetCenter_=p,this.applyTargetState_(!1,!0),rl(m,!0))}centerOn(e,t,i){this.centerOnInternal(je(e,this.getProjection()),t,i)}centerOnInternal(e,t,i){this.setCenterInternal(Sc(e,t,i,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,i,s){let r;const o=this.padding_;if(o&&e){const a=this.getViewportSizeMinusPadding_(-i),l=Sc(e,s,[a[0]/2+o[3],a[1]/2+o[0]],t,i);r=[e[0]-l[0],e[1]-l[1]]}return r}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const t=Gs(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&je(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const i=this.getAnimating()||this.getInteracting(),s=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*e,0,s,i);t&&(this.targetCenter_=this.calculateCenterZoom(r,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=je(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const i=this.getAnimating()||this.getInteracting(),s=this.constraints_.rotation(this.targetRotation_+e,i);t&&(this.targetCenter_=this.calculateCenterRotate(s,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&je(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const i=this.getAnimating()||this.getInteracting()||t,s=this.constraints_.rotation(this.targetRotation_,i),r=this.getViewportSize_(s),o=this.constraints_.resolution(this.targetResolution_,0,r,i),a=this.constraints_.center(this.targetCenter_,o,r,i,this.calculateCenterShift(this.targetCenter_,o,s,r));this.get(Ni.ROTATION)!==s&&this.set(Ni.ROTATION,s),this.get(Ni.RESOLUTION)!==o&&(this.set(Ni.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(Ni.CENTER)||!zi(this.get(Ni.CENTER),a))&&this.set(Ni.CENTER,a),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,i){e=e!==void 0?e:200;const s=t||0,r=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(r),a=this.constraints_.resolution(this.targetResolution_,s,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,r,o));if(e===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=r,this.targetCenter_=l,this.applyTargetState_();return}i=i||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==r||!this.getCenterInternal()||!zi(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:l,resolution:a,duration:e,easing:ls,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(We.INTERACTING,1)}endInteraction(e,t,i){i=i&&je(i,this.getProjection()),this.endInteractionInternal(e,t,i)}endInteractionInternal(e,t,i){this.getInteracting()&&(this.setHint(We.INTERACTING,-1),this.resolveConstraints(e,t,i))}getConstrainedCenter(e,t){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),i)}getConstrainedZoom(e,t){const i=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(i,t))}getConstrainedResolution(e,t){t=t||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,i)}}function rl(n,e){setTimeout(function(){n(e)},0)}function CC(n){if(n.extent!==void 0){const t=n.smoothExtentConstraint!==void 0?n.smoothExtentConstraint:!0;return kp(n.extent,n.constrainOnlyCenter,t)}const e=Nd(n.projection,"EPSG:3857");if(n.multiWorld!==!0&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,kp(t,!1,!1)}return mC}function MC(n){let e,t,i,o=n.minZoom!==void 0?n.minZoom:Mc,a=n.maxZoom!==void 0?n.maxZoom:28;const l=n.zoomFactor!==void 0?n.zoomFactor:2,h=n.multiWorld!==void 0?n.multiWorld:!1,c=n.smoothResolutionConstraint!==void 0?n.smoothResolutionConstraint:!0,u=n.showFullExtent!==void 0?n.showFullExtent:!1,d=Nd(n.projection,"EPSG:3857"),f=d.getExtent();let g=n.constrainOnlyCenter,p=n.extent;if(!h&&!p&&d.isGlobal()&&(g=!1,p=f),n.resolutions!==void 0){const m=n.resolutions;t=m[o],i=m[a]!==void 0?m[a]:m[m.length-1],n.constrainResolution?e=yC(m,c,!g&&p,u):e=Np(t,i,c,!g&&p,u)}else{const v=(f?Math.max(Me(f),yt(f)):360*Ds.degrees/d.getMetersPerUnit())/xf/Math.pow(2,Mc),y=v/Math.pow(2,28-Mc);t=n.maxResolution,t!==void 0?o=0:t=v/Math.pow(l,o),i=n.minResolution,i===void 0&&(n.maxZoom!==void 0?n.maxResolution!==void 0?i=t/Math.pow(l,a):i=v/Math.pow(l,a):i=y),a=o+Math.floor(Math.log(t/i)/Math.log(l)),i=t/Math.pow(l,a-o),n.constrainResolution?e=_C(l,t,i,c,!g&&p,u):e=Np(t,i,c,!g&&p,u)}return{constraint:e,maxResolution:t,minResolution:i,minZoom:o,zoomFactor:l}}function SC(n){if(n.enableRotation!==void 0?n.enableRotation:!0){const t=n.constrainRotation;return t===void 0||t===!0?xC():t===!1?Dp:typeof t=="number"?vC(t):Dp}return Ef}function TC(n){return!(n.sourceCenter&&n.targetCenter&&!zi(n.sourceCenter,n.targetCenter)||n.sourceResolution!==n.targetResolution||n.sourceRotation!==n.targetRotation)}function Sc(n,e,t,i,s){const r=Math.cos(-s);let o=Math.sin(-s),a=n[0]*r-n[1]*o,l=n[1]*r+n[0]*o;a+=(e[0]/2-t[0])*i,l+=(t[1]-e[1]/2)*i,o=-o;const h=a*r-l*o,c=l*r+a*o;return[h,c]}const Ui=EC;class RC extends R0{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(Be.SOURCE,this.handleSourcePropertyChange_);const i=e.source?e.source:null;this.setSource(i)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(Be.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(De(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=pe(e,K.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let t;const i=this.getMapInternal();!e&&i&&(e=i.getView()),e instanceof Ui?t={viewState:e.getState(),extent:e.calculateExtent()}:t=e,!t.layerStatesArray&&i&&(t.layerStatesArray=i.getLayerGroup().getLayerStatesArray());let s;t.layerStatesArray?s=t.layerStatesArray.find(o=>o.layer===this):s=this.getLayerState();const r=this.getExtent();return Cf(s,t.viewState)&&(!r||He(r,t.extent))}getAttributions(e){if(!this.isVisible(e))return[];let t;const i=this.getSource();if(i&&(t=i.getAttributions()),!t)return[];const s=e instanceof Ui?e.getViewStateAndExtent():e;let r=t(s);return Array.isArray(r)||(r=[r]),r}render(e,t){const i=this.getRenderer();return i.prepareFrame(e)?(this.rendered=!0,i.renderFrame(e,t)):null}unrender(){this.rendered=!1}setMapInternal(e){e||this.unrender(),this.set(Be.MAP,e)}getMapInternal(){return this.get(Be.MAP)}setMap(e){this.mapPrecomposeKey_&&(De(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(De(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=pe(e,hn.PRECOMPOSE,function(t){const s=t.frameState.layerStatesArray,r=this.getLayerState(!1);fe(!s.some(function(o){return o.layer===r.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),s.push(r)},this),this.mapRenderKey_=pe(this,K.CHANGE,e.render,e),this.changed())}setSource(e){this.set(Be.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function Cf(n,e){if(!n.visible)return!1;const t=e.resolution;if(t<n.minResolution||t>=n.maxResolution)return!1;const i=e.zoom;return i>n.minZoom&&i<=n.maxZoom}const Zs=RC;class LC extends bd{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){ie()}calculateMatrices2D(e){const t=e.viewState,i=e.coordinateToPixelTransform,s=e.pixelToCoordinateTransform;Vi(i,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),Zh(s,i)}forEachFeatureAtCoordinate(e,t,i,s,r,o,a,l){let h;const c=t.viewState;function u(w,b,E,C){return r.call(o,b,w?E:null,C)}const d=c.projection,f=Od(e.slice(),d),g=[[0,0]];if(d.canWrapX()&&s){const w=d.getExtent(),b=Me(w);g.push([-b,0],[b,0])}const p=t.layerStatesArray,m=p.length,v=[],y=[];for(let w=0;w<g.length;w++)for(let b=m-1;b>=0;--b){const E=p[b],C=E.layer;if(C.hasRenderer()&&Cf(E,c)&&a.call(l,C)){const M=C.getRenderer(),R=C.getSource();if(M&&R){const N=R.getWrapX()?f:e,G=u.bind(null,E.managed);y[0]=N[0]+g[w][0],y[1]=N[1]+g[w][1],h=M.forEachFeatureAtCoordinate(y,t,i,G,v)}if(h)return h}}if(v.length===0)return;const x=1/v.length;return v.forEach((w,b)=>w.distanceSq+=b*x),v.sort((w,b)=>w.distanceSq-b.distanceSq),v.some(w=>h=w.callback(w.feature,w.layer,w.geometry)),h}hasFeatureAtCoordinate(e,t,i,s,r,o){return this.forEachFeatureAtCoordinate(e,t,i,s,Os,this,r,o)!==void 0}getMap(){return this.map_}renderFrame(e){ie()}flushDeclutterItems(e){}scheduleExpireIconCache(e){Kl.canExpireCache()&&e.postRenderFunctions.push(IC)}}function IC(n,e){Kl.expire()}const PC=LC;class AC extends _i{constructor(e,t,i,s){super(e),this.inversePixelTransform=t,this.frameState=i,this.context=s}}const P0=AC;class FC extends PC{constructor(e){super(e),this.fontChangeListenerKey_=pe(Ji,io.PROPERTYCHANGE,e.redrawText.bind(e)),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=Qh+" ol-layers";const i=e.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0,this.declutterLayers_=[]}dispatchRenderEvent(e,t){const i=this.getMap();if(i.hasListener(e)){const s=new P0(e,void 0,t);i.dispatchEvent(s)}}disposeInternal(){De(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(hn.PRECOMPOSE,e);const t=e.layerStatesArray.sort(function(o,a){return o.zIndex-a.zIndex}),i=e.viewState;this.children_.length=0;const s=this.declutterLayers_;s.length=0;let r=null;for(let o=0,a=t.length;o<a;++o){const l=t[o];e.layerIndex=o;const h=l.layer,c=h.getSourceState();if(!Cf(l,i)||c!="ready"&&c!="undefined"){h.unrender();continue}const u=h.render(e,r);u&&(u!==r&&(this.children_.push(u),r=u),"getDeclutter"in h&&s.push(h))}this.flushDeclutterItems(e),B1(this.element_,this.children_),this.dispatchRenderEvent(hn.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}flushDeclutterItems(e){const t=this.declutterLayers_;for(let i=t.length-1;i>=0;--i)t[i].renderDeclutter(e);t.length=0}}const OC=FC;class Un extends _i{constructor(e,t){super(e),this.layer=t}}const Tc={LAYERS:"layers"};class Mf extends R0{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let i=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Tc.LAYERS,this.handleLayersChanged_),i?Array.isArray(i)?i=new Vt(i.slice(),{unique:!0}):fe(typeof i.getArray=="function","Expected `layers` to be an array or a `Collection`"):i=new Vt(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(De),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(pe(e,wt.ADD,this.handleLayersAdd_,this),pe(e,wt.REMOVE,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(De);_a(this.listenerKeys_);const t=e.getArray();for(let i=0,s=t.length;i<s;i++){const r=t[i];this.registerLayerListeners_(r),this.dispatchEvent(new Un("addlayer",r))}this.changed()}registerLayerListeners_(e){const t=[pe(e,io.PROPERTYCHANGE,this.handleLayerChange_,this),pe(e,K.CHANGE,this.handleLayerChange_,this)];e instanceof Mf&&t.push(pe(e,"addlayer",this.handleLayerGroupAdd_,this),pe(e,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[H(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new Un("addlayer",e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new Un("removelayer",e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new Un("addlayer",t)),this.changed()}handleLayersRemove_(e){const t=e.element,i=H(t);this.listenerKeys_[i].forEach(De),delete this.listenerKeys_[i],this.dispatchEvent(new Un("removelayer",t)),this.changed()}getLayers(){return this.get(Tc.LAYERS)}setLayers(e){const t=this.getLayers();if(t){const i=t.getArray();for(let s=0,r=i.length;s<r;++s)this.dispatchEvent(new Un("removelayer",i[s]))}this.set(Tc.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const t=e!==void 0?e:[],i=t.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(t)});const s=this.getLayerState();let r=s.zIndex;!e&&s.zIndex===void 0&&(r=0);for(let o=i,a=t.length;o<a;o++){const l=t[o];l.opacity*=s.opacity,l.visible=l.visible&&s.visible,l.maxResolution=Math.min(l.maxResolution,s.maxResolution),l.minResolution=Math.max(l.minResolution,s.minResolution),l.minZoom=Math.max(l.minZoom,s.minZoom),l.maxZoom=Math.min(l.maxZoom,s.maxZoom),s.extent!==void 0&&(l.extent!==void 0?l.extent=Cn(l.extent,s.extent):l.extent=s.extent),l.zIndex===void 0&&(l.zIndex=r)}return t}getSourceState(){return"ready"}}const Us=Mf;class kC extends _i{constructor(e,t,i){super(e),this.map=t,this.frameState=i!==void 0?i:null}}const ar=kC;class NC extends ar{constructor(e,t,i,s,r,o){super(e,t,r),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=s!==void 0?s:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const xn=NC,Ee={SINGLECLICK:"singleclick",CLICK:K.CLICK,DBLCLICK:K.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Uu={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class DC extends va{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=pe(i,Uu.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=pe(i,Uu.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(K.TOUCHMOVE,this.boundHandleTouchMove_,my?{passive:!1}:!1)}emulateClick_(e){let t=new xn(Ee.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new xn(Ee.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const i=new xn(Ee.SINGLECLICK,this.map_,e);this.dispatchEvent(i)},250)}updateActivePointers_(e){const t=e,i=t.pointerId;if(t.type==Ee.POINTERUP||t.type==Ee.POINTERCANCEL){delete this.trackedTouches_[i];for(const s in this.trackedTouches_)if(this.trackedTouches_[s].target!==t.target){delete this.trackedTouches_[s];break}}else(t.type==Ee.POINTERDOWN||t.type==Ee.POINTERMOVE)&&(this.trackedTouches_[i]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new xn(Ee.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(De),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new xn(Ee.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(pe(i,Ee.POINTERMOVE,this.handlePointerMove_,this),pe(i,Ee.POINTERUP,this.handlePointerUp_,this),pe(this.element_,Ee.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(pe(this.element_.getRootNode(),Ee.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new xn(Ee.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new xn(Ee.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(De(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(K.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(De(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(De),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const GC=DC,wn={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},At={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},ih=1/0;class zC{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,_a(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,i=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const s=this.keyFunction_(i);return delete this.queuedElements_[s],i}enqueue(e){fe(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const t=this.priorityFunction_(e);return t!=ih?(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,i=this.priorities_,s=t.length,r=t[e],o=i[e],a=e;for(;e<s>>1;){const l=this.getLeftChildIndex_(e),h=this.getRightChildIndex_(e),c=h<s&&i[h]<i[l]?h:l;t[e]=t[c],i[e]=i[c],e=c}t[e]=r,i[e]=o,this.siftDown_(a,e)}siftDown_(e,t){const i=this.elements_,s=this.priorities_,r=i[t],o=s[t];for(;t>e;){const a=this.getParentIndex_(t);if(s[a]>o)i[t]=i[a],s[t]=s[a],t=a;else break}i[t]=r,s[t]=o}reprioritize(){const e=this.priorityFunction_,t=this.elements_,i=this.priorities_;let s=0;const r=t.length;let o,a,l;for(a=0;a<r;++a)o=t[a],l=e(o),l==ih?delete this.queuedElements_[this.keyFunction_(o)]:(i[s]=l,t[s++]=o);t.length=s,i.length=s,this.heapify_()}}const BC=zC,U={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class UC extends BC{constructor(e,t){super(function(i){return e.apply(null,i)},function(i){return i[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(K.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,i=t.getState();if(i===U.LOADED||i===U.ERROR||i===U.EMPTY){i!==U.ERROR&&t.removeEventListener(K.CHANGE,this.boundHandleTileChange_);const s=t.getKey();s in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[s],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let i=0,s,r,o;for(;this.tilesLoading_<e&&i<t&&this.getCount()>0;)r=this.dequeue()[0],o=r.getKey(),s=r.getState(),s===U.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++i,r.load())}}const jC=UC;function $C(n,e,t,i,s){if(!n||!(t in n.wantedTiles)||!n.wantedTiles[t][e.getKey()])return ih;const r=n.viewState.center,o=i[0]-r[0],a=i[1]-r[1];return 65536*Math.log(s)+Math.sqrt(o*o+a*a)/s}class qC extends Xi{constructor(e){super();const t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){Bl(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&Bl(this.element);for(let t=0,i=this.listenerKeys.length;t<i;++t)De(this.listenerKeys[t]);this.listenerKeys.length=0,this.map_=e,e&&((this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==Qr&&this.listenerKeys.push(pe(e,wn.POSTRENDER,this.render,this)),e.render())}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}}const Sf=qC;class VC extends Sf{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const t=e.className!==void 0?e.className:"ol-attribution",i=e.tipLabel!==void 0?e.tipLabel:"Attributions",s=e.expandClassName!==void 0?e.expandClassName:t+"-expand",r=e.collapseLabel!==void 0?e.collapseLabel:"âº",o=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof r=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=o):this.collapseLabel_=r;const a=e.label!==void 0?e.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=s):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(K.CLICK,this.handleClick_.bind(this),!1);const h=t+" "+Qh+" "+af+(this.collapsed_&&this.collapsible_?" "+op:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=h,c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=Array.from(new Set(this.getMap().getAllLayers().flatMap(s=>s.getAttributions(e)))),i=!this.getMap().getAllLayers().some(s=>s.getSource()&&s.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(i),t}updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=this.collectSourceAttributions_(e),i=t.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!Pn(t,this.renderedAttributions_)){ky(this.ulElement_);for(let s=0,r=t.length;s<r;++s){const o=document.createElement("li");o.innerHTML=t[s],this.ulElement_.appendChild(o)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(op),this.collapsed_?$g(this.collapseLabel_,this.label_):$g(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}const WC=VC;class HC extends Sf{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=e.className!==void 0?e.className:"ol-rotate",i=e.label!==void 0?e.label:"â§",s=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=s,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(s));const r=e.tipLabel?e.tipLabel:"Reset rotation",o=document.createElement("button");o.className=t+"-reset",o.setAttribute("type","button"),o.title=r,o.appendChild(this.label_),o.addEventListener(K.CLICK,this.handleClick_.bind(this),!1);const a=t+" "+Qh+" "+af,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Qa)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const i=t.getRotation();i!==void 0&&(this.duration_>0&&i%(2*Math.PI)!==0?t.animate({rotation:0,duration:this.duration_,easing:ls}):t.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const i=t.viewState.rotation;if(i!=this.rotation_){const s="rotate("+i+"rad)";if(this.autoHide_){const r=this.element.classList.contains(Qa);!r&&i===0?this.element.classList.add(Qa):r&&i!==0&&this.element.classList.remove(Qa)}this.label_.style.transform=s}this.rotation_=i}}const XC=HC;class YC extends Sf{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=e.className!==void 0?e.className:"ol-zoom",i=e.delta!==void 0?e.delta:1,s=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",r=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",o=e.zoomInLabel!==void 0?e.zoomInLabel:"+",a=e.zoomOutLabel!==void 0?e.zoomOutLabel:"â",l=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",h=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=s,c.setAttribute("type","button"),c.title=l,c.appendChild(typeof o=="string"?document.createTextNode(o):o),c.addEventListener(K.CLICK,this.handleClick_.bind(this,i),!1);const u=document.createElement("button");u.className=r,u.setAttribute("type","button"),u.title=h,u.appendChild(typeof a=="string"?document.createTextNode(a):a),u.addEventListener(K.CLICK,this.handleClick_.bind(this,-i),!1);const d=t+" "+Qh+" "+af,f=this.element;f.className=d,f.appendChild(c),f.appendChild(u),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const i=this.getMap().getView();if(!i)return;const s=i.getZoom();if(s!==void 0){const r=i.getConstrainedZoom(s+e);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:r,duration:this.duration_,easing:ls})):i.setZoom(r)}}}const ZC=YC;function KC(n){n=n||{};const e=new Vt;return(n.zoom!==void 0?n.zoom:!0)&&e.push(new ZC(n.zoomOptions)),(n.rotate!==void 0?n.rotate:!0)&&e.push(new XC(n.rotateOptions)),(n.attribution!==void 0?n.attribution:!0)&&e.push(new WC(n.attributionOptions)),e}const ju={ACTIVE:"active"};class JC extends Xi{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(ju.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(ju.ACTIVE,e)}setMap(e){this.map_=e}}function QC(n,e,t){const i=n.getCenterInternal();if(i){const s=[i[0]+e[0],i[1]+e[1]];n.animateInternal({duration:t!==void 0?t:250,easing:bC,center:n.getConstrainedCenter(s)})}}function Tf(n,e,t,i){const s=n.getZoom();if(s===void 0)return;const r=n.getConstrainedZoom(s+e),o=n.getResolutionForZoom(r);n.getAnimating()&&n.cancelAnimations(),n.animate({resolution:o,anchor:t,duration:i!==void 0?i:250,easing:ls})}const Ra=JC;class eM extends Ra{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==Ee.DBLCLICK){const i=e.originalEvent,s=e.map,r=e.coordinate,o=i.shiftKey?-this.delta_:this.delta_,a=s.getView();Tf(a,o,r,this.duration_),i.preventDefault(),t=!0}return!t}}const tM=eM;class iM extends Ra{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==Ee.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==Ee.POINTERUP){const i=this.handleUpEvent(e);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(e.type==Ee.POINTERDOWN){const i=this.handleDownEvent(e);this.handlingDownUpSequence=i,t=this.stopDown(i)}else e.type==Ee.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function Rf(n){const e=n.length;let t=0,i=0;for(let s=0;s<e;s++)t+=n[s].clientX,i+=n[s].clientY;return{clientX:t/e,clientY:i/e}}const us=iM;function $u(n){const e=arguments;return function(t){let i=!0;for(let s=0,r=e.length;s<r&&(i=i&&e[s](t),!!i);++s);return i}}const nM=function(n){const e=n.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},sM=function(n){const e=n.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},rM=function(n){const e=n.map.getTargetElement(),t=n.map.getOwnerDocument().activeElement;return e.contains(t)},A0=function(n){return n.map.getTargetElement().hasAttribute("tabindex")?rM(n):!0},nh=Os,F0=function(n){const e=n.originalEvent;return e.button==0&&!(a1&&Ed&&e.ctrlKey)},oM=Vs,aM=function(n){return n.type==Ee.SINGLECLICK},Lf=function(n){const e=n.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},lM=function(n){const e=n.originalEvent;return!e.altKey&&(Ed?e.metaKey:e.ctrlKey)&&!e.shiftKey},hM=function(n){const e=n.originalEvent;return Ed?e.metaKey:e.ctrlKey},O0=function(n){const e=n.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},k0=function(n){const e=n.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!e.target.isContentEditable},Rc=function(n){const e=n.originalEvent;return fe(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.pointerType=="mouse"},N0=function(n){const e=n.originalEvent;return fe(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.isPrimary&&e.button===0};class cM extends us{constructor(e){super({stopDown:Vs}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:$u(Lf,N0);this.condition_=e.onFocusOnly?$u(A0,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const i=this.targetPointers,s=t.getEventPixel(Rf(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(s[0],s[1]),this.lastCentroid){const r=[this.lastCentroid[0]-s[0],s[1]-this.lastCentroid[1]],a=e.map.getView();Sy(r,a.getResolution()),Fd(r,a.getRotation()),a.adjustCenterInternal(r)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=s,this.lastPointersCount_=i.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,i=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const s=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),o=i.getCenterInternal(),a=t.getPixelFromCoordinateInternal(o),l=t.getCoordinateFromPixelInternal([a[0]-s*Math.cos(r),a[1]-s*Math.sin(r)]);i.animateInternal({center:i.getConstrainedCenter(l),duration:500,easing:ls})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const i=e.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}const uM=cM;class dM extends us{constructor(e){e=e||{},super({stopDown:Vs}),this.condition_=e.condition?e.condition:sM,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!Rc(e))return;const t=e.map,i=t.getView();if(i.getConstraints().rotation===Ef)return;const s=t.getSize(),r=e.pixel,o=Math.atan2(s[1]/2-r[1],r[0]-s[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;i.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(e){return Rc(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return Rc(e)&&F0(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}const fM=dM;class gM extends bd{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,i="px",s=this.element_.style;s.left=Math.min(e[0],t[0])+i,s.top=Math.min(e[1],t[1])+i,s.width=Math.abs(t[0]-e[0])+i,s.height=Math.abs(t[1]-e[1])+i}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const e=this.startPixel_,t=this.endPixel_,s=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);s[4]=s[0].slice(),this.geometry_?this.geometry_.setCoordinates([s]):this.geometry_=new Wi([s])}getGeometry(){return this.geometry_}}const pM=gM,ol={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class Lc extends _i{constructor(e,t,i){super(e),this.coordinate=t,this.mapBrowserEvent=i}}class mM extends us{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.box_=new pM(e.className||"ol-dragbox"),this.minArea_=e.minArea!==void 0?e.minArea:64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition?e.condition:F0,this.boxEndCondition_=e.boxEndCondition?e.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,i){const s=i[0]-t[0],r=i[1]-t[1];return s*s+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new Lc(ol.BOXDRAG,e.coordinate,e))}handleUpEvent(e){this.box_.setMap(null);const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new Lc(t?ol.BOXEND:ol.BOXCANCEL,e.coordinate,e)),!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Lc(ol.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}}const D0=mM;class yM extends D0{constructor(e){e=e||{};const t=e.condition?e.condition:O0;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const i=this.getMap().getView();let s=this.getGeometry();if(this.out_){const r=i.rotatedExtentForGeometry(s),o=i.getResolutionForExtentInternal(r),a=i.getResolution()/o;s=s.clone(),s.scale(a*a)}i.fitInternal(s,{duration:this.duration_,easing:ls})}}const _M=yM,ys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class vM extends Ra{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return Lf(t)&&k0(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==K.KEYDOWN){const i=e.originalEvent,s=i.key;if(this.condition_(e)&&(s==ys.DOWN||s==ys.LEFT||s==ys.RIGHT||s==ys.UP)){const o=e.map.getView(),a=o.getResolution()*this.pixelDelta_;let l=0,h=0;s==ys.DOWN?h=-a:s==ys.LEFT?l=-a:s==ys.RIGHT?l=a:h=a;const c=[l,h];Fd(c,o.getRotation()),QC(o,c,this.duration_),i.preventDefault(),t=!0}}return!t}}const xM=vM;class wM extends Ra{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(t){return!hM(t)&&k0(t)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==K.KEYDOWN||e.type==K.KEYPRESS){const i=e.originalEvent,s=i.key;if(this.condition_(e)&&(s==="+"||s==="-")){const r=e.map,o=s==="+"?this.delta_:-this.delta_,a=r.getView();Tf(a,o,void 0,this.duration_),i.preventDefault(),t=!0}}return!t}}const bM=wM;class EM{constructor(e,t,i){this.decay_=e,this.minVelocity_=t,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let i=t-3;for(;i>0&&this.points_[i+2]>e;)i-=3;const s=this.points_[t+2]-this.points_[i+2];if(s<1e3/60)return!1;const r=this.points_[t]-this.points_[i],o=this.points_[t+1]-this.points_[i+1];return this.angle_=Math.atan2(o,r),this.initialVelocity_=Math.sqrt(r*r+o*o)/s,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const CM=EM;class MM extends Ra{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const t=e.condition?e.condition:nh;this.condition_=e.onFocusOnly?$u(A0,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();if(!e)return;e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(e){if(!this.condition_(e)||e.type!==K.WHEEL)return!0;const i=e.map,s=e.originalEvent;s.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.coordinate);let r;if(e.type==K.WHEEL&&(r=s.deltaY,r1&&s.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(r/=Cd),s.deltaMode===WheelEvent.DOM_DELTA_LINE&&(r*=40)),r===0)return!1;this.lastDelta_=r;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?"trackpad":"wheel");const a=i.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=o,!1;this.totalDelta_+=r;const l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),l),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let i=-Je(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),Tf(t,i,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}const SM=MM;class TM extends us{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=Vs),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0;const i=this.targetPointers[0],s=this.targetPointers[1],r=Math.atan2(s.clientY-i.clientY,s.clientX-i.clientX);if(this.lastAngle_!==void 0){const l=r-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=l}this.lastAngle_=r;const o=e.map,a=o.getView();a.getConstraints().rotation!==Ef&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(Rf(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}const RM=TM;class LM extends us{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=Vs),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const i=this.targetPointers[0],s=this.targetPointers[1],r=i.clientX-s.clientX,o=i.clientY-s.clientY,a=Math.sqrt(r*r+o*o);this.lastDistance_!==void 0&&(t=this.lastDistance_/a),this.lastDistance_=a;const l=e.map,h=l.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(Rf(this.targetPointers))),l.render(),h.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const i=e.map.getView(),s=this.lastScaleDelta_>1?1:-1;return i.endInteraction(this.duration_,s),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}const IM=LM;function PM(n){n=n||{};const e=new Vt,t=new CM(-.005,.05,100);return(n.altShiftDragRotate!==void 0?n.altShiftDragRotate:!0)&&e.push(new fM),(n.doubleClickZoom!==void 0?n.doubleClickZoom:!0)&&e.push(new tM({delta:n.zoomDelta,duration:n.zoomDuration})),(n.dragPan!==void 0?n.dragPan:!0)&&e.push(new uM({onFocusOnly:n.onFocusOnly,kinetic:t})),(n.pinchRotate!==void 0?n.pinchRotate:!0)&&e.push(new RM),(n.pinchZoom!==void 0?n.pinchZoom:!0)&&e.push(new IM({duration:n.zoomDuration})),(n.keyboard!==void 0?n.keyboard:!0)&&(e.push(new xM),e.push(new bM({delta:n.zoomDelta,duration:n.zoomDuration}))),(n.mouseWheelZoom!==void 0?n.mouseWheelZoom:!0)&&e.push(new SM({onFocusOnly:n.onFocusOnly,duration:n.zoomDuration})),(n.shiftDragZoom!==void 0?n.shiftDragZoom:!0)&&e.push(new _M({duration:n.zoomDuration})),e}function G0(n){if(n instanceof Zs){n.setMapInternal(null);return}n instanceof Us&&n.getLayers().forEach(G0)}function z0(n,e){if(n instanceof Zs){n.setMapInternal(e);return}if(n instanceof Us){const t=n.getLayers().getArray();for(let i=0,s=t.length;i<s;++i)z0(t[i],e)}}let AM=class extends Xi{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=FM(e);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:Cd,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=pi(),this.pixelToCoordinateTransform_=pi(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=t.controls||KC(),this.interactions=t.interactions||PM({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new jC(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(At.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(At.VIEW,this.handleViewChanged_),this.addChangeListener(At.SIZE,this.handleSizeChanged_),this.addChangeListener(At.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const i=this;e.view&&!(e.view instanceof Ui)&&e.view.then(function(s){i.setView(new Ui(s))}),this.controls.addEventListener(wt.ADD,s=>{s.element.setMap(this)}),this.controls.addEventListener(wt.REMOVE,s=>{s.element.setMap(null)}),this.interactions.addEventListener(wt.ADD,s=>{s.element.setMap(this)}),this.interactions.addEventListener(wt.REMOVE,s=>{s.element.setMap(null)}),this.overlays_.addEventListener(wt.ADD,s=>{this.addOverlayInternal_(s.element)}),this.overlays_.addEventListener(wt.REMOVE,s=>{const r=s.element.getId();r!==void 0&&delete this.overlayIdIndex_[r.toString()],s.element.setMap(null)}),this.controls.forEach(s=>{s.setMap(this)}),this.interactions.forEach(s=>{s.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){z0(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,i){if(!this.frameState_||!this.renderer_)return;const s=this.getCoordinateFromPixelInternal(e);i=i!==void 0?i:{};const r=i.hitTolerance!==void 0?i.hitTolerance:0,o=i.layerFilter!==void 0?i.layerFilter:Os,a=i.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(s,this.frameState_,r,a,t,null,o,null)}getFeaturesAtPixel(e,t){const i=[];return this.forEachFeatureAtPixel(e,function(s){i.push(s)},t),i}getAllLayers(){const e=[];function t(i){i.forEach(function(s){s instanceof Us?t(s.getLayers()):e.push(s)})}return t(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(e);t=t!==void 0?t:{};const s=t.layerFilter!==void 0?t.layerFilter:Os,r=t.hitTolerance!==void 0?t.hitTolerance:0,o=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,r,o,s,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const i=this.viewport_.getBoundingClientRect(),s=this.getSize(),r=i.width/s[0],o=i.height/s[1],a="changedTouches"in e?e.changedTouches[0]:e;return[(a.clientX-i.left)/r,(a.clientY-i.top)/o]}getTarget(){return this.get(At.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return Gs(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?st(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(At.LAYERGROUP)}setLayers(e){const t=this.getLayerGroup();if(e instanceof Vt){t.setLayers(e);return}const i=t.getLayers();i.clear(),i.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const s=e[t];if(!s.visible)continue;const r=s.layer.getRenderer();if(r&&!r.ready)return!0;const o=s.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(e){const t=je(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?st(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(At.SIZE)}getView(){return this.get(At.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,i,s){return $C(this.frameState_,e,t,i,s)}handleBrowserEvent(e,t){t=t||e.type;const i=new xn(t,this,e);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,i=t.type;if(i===Uu.POINTERDOWN||i===K.WHEEL||i===K.KEYDOWN){const s=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():s,o=t.target;if(this.overlayContainerStopEvent_.contains(o)||!(r===s?s.documentElement:r).contains(o))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){const s=this.getInteractions().getArray().slice();for(let r=s.length-1;r>=0;r--){const o=s[r];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let s=this.maxTilesLoading_,r=s;if(e){const o=e.viewHints;if(o[We.ANIMATING]||o[We.INTERACTING]){const a=Date.now()-e.time>8;s=a?0:8,r=a?0:2}}t.getTilesLoading()<s&&(t.reprioritize(),t.loadMoreTiles(s,r))}e&&this.renderer_&&!e.animate&&(this.renderComplete_===!0?(this.hasListener(hn.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(hn.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new ar(wn.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new ar(wn.LOADSTART,this,e))));const i=this.postRenderFunctions_;for(let s=0,r=i.length;s<r;++s)i[s](this,e);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let i=0,s=this.targetChangeHandlerKeys_.length;i<s;++i)De(this.targetChangeHandlerKeys_[i]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(K.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(K.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,Bl(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const i=this.targetElement_.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.unobserve(i.host),this.setSize(void 0)}const e=this.getTarget(),t=typeof e=="string"?document.getElementById(e):e;if(this.targetElement_=t,!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new OC(this)),this.mapBrowserEventHandler_=new GC(this,this.moveTolerance_);for(const r in Ee)this.mapBrowserEventHandler_.addEventListener(Ee[r],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(K.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(K.WHEEL,this.boundHandleBrowserEvent_,my?{passive:!1}:!1);const i=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.targetChangeHandlerKeys_=[pe(i,K.KEYDOWN,this.handleBrowserEvent,this),pe(i,K.KEYPRESS,this.handleBrowserEvent,this)];const s=t.getRootNode();s instanceof ShadowRoot&&this.resizeObserver_.observe(s.host),this.resizeObserver_.observe(t)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(De(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(De(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=pe(e,io.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=pe(e,K.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(De),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new Un("addlayer",e)),this.layerGroupPropertyListenerKeys_=[pe(e,io.PROPERTYCHANGE,this.render,this),pe(e,K.CHANGE,this.render,this),pe(e,"addlayer",this.handleLayerAdd_,this),pe(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const s=e[t].layer;s.hasRenderer()&&s.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}flushDeclutterItems(){const e=this.frameState_;e&&this.renderer_.flushDeclutterItems(e)}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){G0(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),i=this.getView(),s=this.frameState_;let r=null;if(t!==void 0&&ip(t)&&i&&i.isDef()){const o=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=i.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:Uo(a.center,a.resolution,a.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:H(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;r.nextExtent=Uo(a.nextCenter,a.nextResolution,l,t)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),s&&(!this.previousExtent_||!Hs(this.previousExtent_)&&!Ns(r.extent,this.previousExtent_))&&(this.dispatchEvent(new ar(wn.MOVESTART,this,s)),this.previousExtent_=uo(this.previousExtent_)),this.previousExtent_&&!r.viewHints[We.ANIMATING]&&!r.viewHints[We.INTERACTING]&&!Ns(r.extent,this.previousExtent_)&&(this.dispatchEvent(new ar(wn.MOVEEND,this,r)),vy(r.extent,this.previousExtent_))),this.dispatchEvent(new ar(wn.POSTRENDER,this,r)),this.renderComplete_=this.hasListener(wn.LOADSTART)||this.hasListener(wn.LOADEND)||this.hasListener(hn.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new Un("removelayer",t)),this.set(At.LAYERGROUP,e)}setSize(e){this.set(At.SIZE,e)}setTarget(e){this.set(At.TARGET,e)}setView(e){if(!e||e instanceof Ui){this.set(At.VIEW,e);return}this.set(At.VIEW,new Ui);const t=this;e.then(function(i){t.setView(new Ui(i))})}updateSize(){const e=this.getTargetElement();let t;if(e){const s=getComputedStyle(e),r=e.offsetWidth-parseFloat(s.borderLeftWidth)-parseFloat(s.paddingLeft)-parseFloat(s.paddingRight)-parseFloat(s.borderRightWidth),o=e.offsetHeight-parseFloat(s.borderTopWidth)-parseFloat(s.paddingTop)-parseFloat(s.paddingBottom)-parseFloat(s.borderBottomWidth);!isNaN(r)&&!isNaN(o)&&(t=[r,o],!ip(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&Iy("No map visible because the map container's width or height are 0."))}const i=this.getSize();t&&(!i||!Pn(t,i))&&(this.setSize(t),this.updateViewportSize_())}updateViewportSize_(){const e=this.getView();if(e){let t;const i=getComputedStyle(this.viewport_);i.width&&i.height&&(t=[parseInt(i.width,10),parseInt(i.height,10)]),e.setViewportSize(t)}}};function FM(n){let e=null;n.keyboardEventTarget!==void 0&&(e=typeof n.keyboardEventTarget=="string"?document.getElementById(n.keyboardEventTarget):n.keyboardEventTarget);const t={},i=n.layers&&typeof n.layers.getLayers=="function"?n.layers:new Us({layers:n.layers});t[At.LAYERGROUP]=i,t[At.TARGET]=n.target,t[At.VIEW]=n.view instanceof Ui?n.view:new Ui;let s;n.controls!==void 0&&(Array.isArray(n.controls)?s=new Vt(n.controls.slice()):(fe(typeof n.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),s=n.controls));let r;n.interactions!==void 0&&(Array.isArray(n.interactions)?r=new Vt(n.interactions.slice()):(fe(typeof n.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),r=n.interactions));let o;return n.overlays!==void 0?Array.isArray(n.overlays)?o=new Vt(n.overlays.slice()):(fe(typeof n.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),o=n.overlays):o=new Vt,{controls:s,interactions:r,keyboardEventTarget:e,overlays:o,values:t}}const OM=AM;class kM{constructor(e){this.rbush_=new Wm(e),this.items_={}}insert(e,t){const i={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(i),this.items_[H(t)]=i}load(e,t){const i=new Array(t.length);for(let s=0,r=t.length;s<r;s++){const o=e[s],a=t[s],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};i[s]=l,this.items_[H(a)]=l}this.rbush_.load(i)}remove(e){const t=H(e),i=this.items_[t];return delete this.items_[t],this.rbush_.remove(i)!==null}update(e,t){const i=this.items_[H(t)],s=[i.minX,i.minY,i.maxX,i.maxY];Ns(s,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(s){return s.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let i;for(let s=0,r=e.length;s<r;s++)if(i=t(e[s]),i)return i;return i}isEmpty(){return ks(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return Pi(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}}const sh=kM,Bt={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function NM(n,e){return[[-1/0,-1/0,1/0,1/0]]}function DM(n,e){return[n]}let GM=!1;function B0(n,e,t,i,s,r,o){const a=new XMLHttpRequest;a.open("GET",typeof n=="function"?n(t,i,s):n,!0),e.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=GM,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const h=e.getType();let c;h=="json"||h=="text"?c=a.responseText:h=="xml"?(c=a.responseXML,c||(c=new DOMParser().parseFromString(a.responseText,"application/xml"))):h=="arraybuffer"&&(c=a.response),c?r(e.readFeatures(c,{extent:t,featureProjection:s}),e.readProjection(c)):o()}else o()},a.onerror=o,a.send()}function Gp(n,e){return function(t,i,s,r,o){const a=this;B0(n,e,t,i,s,function(l,h){a.addFeatures(l),r!==void 0&&r(l)},o||Qr)}}class kn extends _i{constructor(e,t,i){super(e),this.feature=t,this.features=i}}class zM extends Gd{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=Qr,this.format_=e.format,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&(fe(this.format_,"`format` must be set when `url` is set"),this.loader_=Gp(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:NM;const t=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=t?new sh:null,this.loadedExtentsRtree_=new sh,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,s;Array.isArray(e.features)?s=e.features:e.features&&(i=e.features,s=i.getArray()),!t&&i===void 0&&(i=new Vt(s)),s!==void 0&&this.addFeaturesInternal(s),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=H(e);if(!this.addToIndex_(t,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(t,e);const i=e.getGeometry();if(i){const s=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(s,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new kn(Bt.ADDFEATURE,e))}setupChangeEvents_(e,t){this.featureChangeKeys_[e]=[pe(t,K.CHANGE,this.handleFeatureChange_,this),pe(t,io.PROPERTYCHANGE,this.handleFeatureChange_,this)]}addToIndex_(e,t){let i=!0;const s=t.getId();return s!==void 0&&(s.toString()in this.idIndex_?i=!1:this.idIndex_[s.toString()]=t),i&&(fe(!(e in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[e]=t),i}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],i=[],s=[];for(let r=0,o=e.length;r<o;r++){const a=e[r],l=H(a);this.addToIndex_(l,a)&&i.push(a)}for(let r=0,o=i.length;r<o;r++){const a=i[r],l=H(a);this.setupChangeEvents_(l,a);const h=a.getGeometry();if(h){const c=h.getExtent();t.push(c),s.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(t,s),this.hasListener(Bt.ADDFEATURE))for(let r=0,o=i.length;r<o;r++)this.dispatchEvent(new kn(Bt.ADDFEATURE,i[r]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(Bt.ADDFEATURE,function(i){t||(t=!0,e.push(i.feature),t=!1)}),this.addEventListener(Bt.REMOVEFEATURE,function(i){t||(t=!0,e.remove(i.feature),t=!1)}),e.addEventListener(wt.ADD,i=>{t||(t=!0,this.addFeature(i.element),t=!1)}),e.addEventListener(wt.REMOVE,i=>{t||(t=!0,this.removeFeature(i.element),t=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(De);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const i=s=>{this.removeFeatureInternal(s)};this.featuresRtree_.forEach(i);for(const s in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[s])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new kn(Bt.CLEAR);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const i=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(i,function(s){if(s.getGeometry().intersectsCoordinate(e))return t(s)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(i){if(i.getGeometry().intersectsExtent(e)){const r=t(i);if(r)return r}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),ks(this.nullGeometryFeatures_)||kt(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(i){t.push(i)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const s=m1(e,t);return[].concat(...s.map(r=>this.featuresRtree_.getInExtent(r)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,t){const i=e[0],s=e[1];let r=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return t=t||Os,this.featuresRtree_.forEachInExtent(l,function(h){if(t(h)){const c=h.getGeometry(),u=a;if(a=c.closestPointXY(i,s,o,a),a<u){r=h;const d=Math.sqrt(a);l[0]=i-d,l[1]=s-d,l[2]=i+d,l[3]=s+d}}}),r}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const t=this.idIndex_[e.toString()];return t!==void 0?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,i=H(t),s=t.getGeometry();if(!s)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[i]=t);else{const o=s.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(o,t)):this.featuresRtree_&&this.featuresRtree_.update(o,t)}const r=t.getId();if(r!==void 0){const o=r.toString();this.idIndex_[o]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[o]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[i]=t;this.changed(),this.dispatchEvent(new kn(Bt.CHANGEFEATURE,t))}hasFeature(e){const t=e.getId();return t!==void 0?t in this.idIndex_:H(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&ks(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,t,i){const s=this.loadedExtentsRtree_,r=this.strategy_(e,t,i);for(let o=0,a=r.length;o<a;++o){const l=r[o];s.forEachInExtent(l,function(c){return Li(c.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new kn(Bt.FEATURESLOADSTART)),this.loader_.call(this,l,t,i,c=>{--this.loadingExtentsCount_,this.dispatchEvent(new kn(Bt.FEATURESLOADEND,void 0,c))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new kn(Bt.FEATURESLOADERROR))}),s.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_;let i;t.forEachInExtent(e,function(s){if(Ns(s.extent,e))return i=s,!0}),i&&t.remove(i)}removeFeature(e){if(!e)return;const t=H(e);t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=H(e),i=this.featureChangeKeys_[t];if(!i)return;i.forEach(De),delete this.featureChangeKeys_[t];const s=e.getId();return s!==void 0&&delete this.idIndex_[s.toString()],delete this.uidIndex_[t],this.dispatchEvent(new kn(Bt.REMOVEFEATURE,e)),e}removeFromIdIndex_(e){let t=!1;for(const i in this.idIndex_)if(this.idIndex_[i]===e){delete this.idIndex_[i],t=!0;break}return t}setLoader(e){this.loader_=e}setUrl(e){fe(this.format_,"`format` must be set when `url` is set"),this.url_=e,this.setLoader(Gp(e,this.format_))}}const Ii=zM;let yo=0;const Ft=1<<yo++,ve=1<<yo++,ao=1<<yo++,If=1<<yo++,La=1<<yo++,Di=Math.pow(2,yo)-1,U0={[Ft]:"boolean",[ve]:"number",[ao]:"string",[If]:"color",[La]:"number[]"},BM=Object.keys(U0).map(Number).sort(rs);function rh(n){const e=[];for(const t of BM)UM(n,t)&&e.push(U0[t]);return e.length===0?"untyped":e.length<3?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e[e.length-1]}function UM(n,e){return(n&e)===e}function j0(n,e){return!!(n&e)}class Yn{constructor(e,t){this.type=e,this.value=t}}class jM{constructor(e,t,...i){this.type=e,this.operator=t,this.args=i}}function $0(){return{variables:new Set,properties:new Set}}function nc(n,e){switch(typeof n){case"boolean":return new Yn(Ft,n);case"number":return new Yn(ve,n);case"string":return new Yn(ao,n)}if(!Array.isArray(n))throw new Error("Expression must be an array or a primitive value");if(n.length===0)throw new Error("Empty expression");if(typeof n[0]=="string")return HM(n,e);for(const i of n)if(typeof i!="number")throw new Error("Expected an array of numbers");let t=La;return(n.length===3||n.length===4)&&(t|=If),new Yn(t,n)}const k={Number:"number",String:"string",Get:"get",Var:"var",Any:"any",All:"all",Not:"!",Resolution:"resolution",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match"},$M={[k.Number]:Oe($e(1,1/0,Di),ve),[k.String]:Oe($e(1,1/0,Di),ao),[k.Get]:Oe(qM,Di),[k.Var]:Oe(VM,Di),[k.Resolution]:Oe(WM,ve),[k.Any]:Oe($e(2,1/0,Ft),Ft),[k.All]:Oe($e(2,1/0,Ft),Ft),[k.Not]:Oe($e(1,1,Ft),Ft),[k.Equal]:Oe($e(2,2,Di),Ft),[k.NotEqual]:Oe($e(2,2,Di),Ft),[k.GreaterThan]:Oe($e(2,2,Di),Ft),[k.GreaterThanOrEqualTo]:Oe($e(2,2,Di),Ft),[k.LessThan]:Oe($e(2,2,Di),Ft),[k.LessThanOrEqualTo]:Oe($e(2,2,Di),Ft),[k.Multiply]:Oe($e(2,1/0,ve),ve),[k.Divide]:Oe($e(2,2,ve),ve),[k.Add]:Oe($e(2,1/0,ve),ve),[k.Subtract]:Oe($e(2,2,ve),ve),[k.Clamp]:Oe($e(3,3,ve),ve),[k.Mod]:Oe($e(2,2,ve),ve),[k.Pow]:Oe($e(2,2,ve),ve),[k.Abs]:Oe($e(1,1,ve),ve),[k.Floor]:Oe($e(1,1,ve),ve),[k.Ceil]:Oe($e(1,1,ve),ve),[k.Round]:Oe($e(1,1,ve),ve),[k.Sin]:Oe($e(1,1,ve),ve),[k.Cos]:Oe($e(1,1,ve),ve),[k.Atan]:Oe($e(1,2,ve),ve),[k.Sqrt]:Oe($e(1,1,ve),ve),[k.Match]:Oe($e(4,1/0,ao|ve),Di)};function qM(n,e){if(n.length!==2)throw new Error("Expected 1 argument for get operation");const t=nc(n[1],e);if(!(t instanceof Yn))throw new Error("Expected a literal argument for get operation");if(typeof t.value!="string")throw new Error("Expected a string argument for get operation");return e.properties.add(t.value),[t]}function VM(n,e){if(n.length!==2)throw new Error("Expected 1 argument for var operation");const t=nc(n[1],e);if(!(t instanceof Yn))throw new Error("Expected a literal argument for var operation");if(typeof t.value!="string")throw new Error("Expected a string argument for get operation");return e.variables.add(t.value),[t]}function WM(n,e){const t=n[0];if(n.length!==1)throw new Error(`Expected no arguments for ${t} operation`);return[]}function $e(n,e,t){return function(i,s){const r=i[0],o=i.length-1;if(n===e){if(o!==n){const l=n===1?"":"s";throw new Error(`Expected ${n} argument${l} for operation ${r}, got ${o}`)}}else if(o<n||o>e)throw new Error(`Expected ${n} to ${e} arguments for operation ${r}, got ${o}`);const a=new Array(o);for(let l=0;l<o;++l){const h=nc(i[l+1],s);if(!j0(t,h.type)){const c=rh(t),u=rh(h.type);throw new Error(`Unexpected type for argument ${l} of ${r} operation : got ${c} but expected ${u}`)}a[l]=h}return a}}function Oe(n,e){return function(t,i){const s=t[0],r=n(t,i);return new jM(e,s,...r)}}function HM(n,e){const t=n[0],i=$M[t];if(!i)throw new Error(`Unknown operator: ${t}`);return i(n,e)}function q0(){return{variables:{},properties:{},resolution:NaN}}function ds(n,e,t){const i=nc(n,t);if(!j0(e,i.type)){const s=rh(e),r=rh(i.type);throw new Error(`Expected expression to be of type ${s}, got ${r}`)}return js(i)}function js(n,e){if(n instanceof Yn)return function(){return n.value};const t=n.operator;switch(t){case k.Number:case k.String:return XM(n);case k.Get:case k.Var:return YM(n);case k.Resolution:return i=>i.resolution;case k.Any:case k.All:case k.Not:return KM(n);case k.Equal:case k.NotEqual:case k.LessThan:case k.LessThanOrEqualTo:case k.GreaterThan:case k.GreaterThanOrEqualTo:return ZM(n);case k.Multiply:case k.Divide:case k.Add:case k.Subtract:case k.Clamp:case k.Mod:case k.Pow:case k.Abs:case k.Floor:case k.Ceil:case k.Round:case k.Sin:case k.Cos:case k.Atan:case k.Sqrt:return JM(n);case k.Match:return QM(n);default:throw new Error(`Unsupported operator ${t}`)}}function XM(n,e){const t=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=js(n.args[r]);switch(t){case k.Number:case k.String:return r=>{for(let o=0;o<i;++o){const a=s[o](r);if(typeof a===t)return a}throw new Error(`Expected one of the values to be a ${t}`)};default:throw new Error(`Unsupported assertion operator ${t}`)}}function YM(n,e){const t=n.args[0];if(!(t instanceof Yn))throw new Error("Expected literal name");const i=t.value;if(typeof i!="string")throw new Error("Expected string name");switch(n.operator){case k.Get:return s=>s.properties[i];case k.Var:return s=>s.variables[i];default:throw new Error(`Unsupported accessor operator ${n.operator}`)}}function ZM(n,e){const t=n.operator,i=js(n.args[0]),s=js(n.args[1]);switch(t){case k.Equal:return r=>i(r)===s(r);case k.NotEqual:return r=>i(r)!==s(r);case k.LessThan:return r=>i(r)<s(r);case k.LessThanOrEqualTo:return r=>i(r)<=s(r);case k.GreaterThan:return r=>i(r)>s(r);case k.GreaterThanOrEqualTo:return r=>i(r)>=s(r);default:throw new Error(`Unsupported comparison operator ${t}`)}}function KM(n,e){const t=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=js(n.args[r]);switch(t){case k.Any:return r=>{for(let o=0;o<i;++o)if(s[o](r))return!0;return!1};case k.All:return r=>{for(let o=0;o<i;++o)if(!s[o](r))return!1;return!0};case k.Not:return r=>!s[0](r);default:throw new Error(`Unsupported logical operator ${t}`)}}function JM(n,e){const t=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=js(n.args[r]);switch(t){case k.Multiply:return r=>{let o=1;for(let a=0;a<i;++a)o*=s[a](r);return o};case k.Divide:return r=>s[0](r)/s[1](r);case k.Add:return r=>{let o=0;for(let a=0;a<i;++a)o+=s[a](r);return o};case k.Subtract:return r=>s[0](r)-s[1](r);case k.Clamp:return r=>{const o=s[0](r),a=s[1](r);if(o<a)return a;const l=s[2](r);return o>l?l:o};case k.Mod:return r=>s[0](r)%s[1](r);case k.Pow:return r=>Math.pow(s[0](r),s[1](r));case k.Abs:return r=>Math.abs(s[0](r));case k.Floor:return r=>Math.floor(s[0](r));case k.Ceil:return r=>Math.ceil(s[0](r));case k.Round:return r=>Math.round(s[0](r));case k.Sin:return r=>Math.sin(s[0](r));case k.Cos:return r=>Math.cos(s[0](r));case k.Atan:return i===2?r=>Math.atan2(s[0](r),s[1](r)):r=>Math.atan(s[0](r));case k.Sqrt:return r=>Math.sqrt(s[0](r));default:throw new Error(`Unsupported numeric operator ${t}`)}}function QM(n,e){const t=n.args.length,i=new Array(t);for(let s=0;s<t;++s)i[s]=js(n.args[s]);return s=>{const r=i[0](s);for(let o=1;o<t;o+=2)if(r===i[o](s))return i[o+1](s);return i[t-1](s)}}function eS(n){return!0}function tS(n){const e=$0(),t=iS(n,e),i=q0();return function(s,r){return i.properties=s.getPropertiesInternal(),i.resolution=r,t(i)}}function zp(n){const e=$0(),t=n.length,i=new Array(t);for(let o=0;o<t;++o)i[o]=qu(n[o],e);const s=q0(),r=new Array(t);return function(o,a){s.properties=o.getPropertiesInternal(),s.resolution=a;for(let l=0;l<t;++l)r[l]=i[l](s);return r}}function iS(n,e){const t=n.length,i=new Array(t);for(let s=0;s<t;++s){const r=n[s],o="filter"in r?ds(r.filter,Ft,e):eS;let a;if(Array.isArray(r.style)){const l=r.style.length;a=new Array(l);for(let h=0;h<l;++h)a[h]=qu(r.style[h],e)}else a=[qu(r.style,e)];i[s]={filter:o,styles:a}}return function(s){const r=[];let o=!1;for(let a=0;a<t;++a){const l=i[a].filter;if(l(s)&&!(n[a].else&&o)){o=!0;for(const h of i[a].styles){const c=h(s);c&&r.push(c)}}}return r}}function qu(n,e){const t=Zo(n,"",e),i=Ko(n,"",e),s=nS(n,e),r=sS(n,e),o=ni(n,"z-index",e),a=new $t;return function(l){let h=!0;if(t){const c=t(l);c&&(h=!1),a.setFill(c)}if(i){const c=i(l);c&&(h=!1),a.setStroke(c)}if(s){const c=s(l);c&&(h=!1),a.setText(c)}if(r){const c=r(l);c&&(h=!1),a.setImage(c)}return o&&a.setZIndex(o(l)),h?null:a}}function Zo(n,e,t){const i=V0(n,e+"fill-color",t);if(!i)return null;const s=new jt;return function(r){const o=i(r);return o==="none"?null:(s.setColor(o),s)}}function Ko(n,e,t){const i=ni(n,e+"stroke-width",t),s=V0(n,e+"stroke-color",t);if(!i&&!s)return null;const r=jn(n,e+"stroke-line-cap",t),o=jn(n,e+"stroke-line-join",t),a=W0(n,e+"stroke-line-dash",t),l=ni(n,e+"stroke-line-dash-offset",t),h=ni(n,e+"stroke-miter-limit",t),c=new xt;return function(u){if(s){const d=s(u);if(d==="none")return null;c.setColor(d)}if(i&&c.setWidth(i(u)),r){const d=r(u);if(d!=="butt"&&d!=="round"&&d!=="square")throw new Error("Expected butt, round, or square line cap");c.setLineCap(d)}if(o){const d=o(u);if(d!=="bevel"&&d!=="round"&&d!=="miter")throw new Error("Expected bevel, round, or miter line join");c.setLineJoin(d)}return a&&c.setLineDash(a(u)),l&&c.setLineDashOffset(l(u)),h&&c.setMiterLimit(h(u)),c}}function nS(n,e){const t="text-",i=jn(n,t+"value",e);if(!i)return null;const s=Zo(n,t,e),r=Zo(n,t+"background-",e),o=Ko(n,t,e),a=Ko(n,t+"background-",e),l=jn(n,t+"font",e),h=ni(n,t+"max-angle",e),c=ni(n,t+"offset-x",e),u=ni(n,t+"offset-y",e),d=Jo(n,t+"overflow",e),f=jn(n,t+"placement",e),g=ni(n,t+"repeat",e),p=sc(n,t+"scale",e),m=Jo(n,t+"rotate-with-view",e),v=ni(n,t+"rotation",e),y=jn(n,t+"align",e),x=jn(n,t+"justify",e),w=jn(n,t+"baseline",e),b=W0(n,t+"padding",e),E=new uf({});return function(C){if(E.setText(i(C)),s&&E.setFill(s(C)),r&&E.setBackgroundFill(r(C)),o&&E.setStroke(o(C)),a&&E.setBackgroundStroke(a(C)),l&&E.setFont(l(C)),h&&E.setMaxAngle(h(C)),c&&E.setOffsetX(c(C)),u&&E.setOffsetY(u(C)),d&&E.setOverflow(d(C)),f){const M=f(C);if(M!=="point"&&M!=="line")throw new Error("Expected point or line for text-placement");E.setPlacement(M)}if(g&&E.setRepeat(g(C)),p&&E.setScale(p(C)),m&&E.setRotateWithView(m(C)),v&&E.setRotation(v(C)),y){const M=y(C);if(M!=="left"&&M!=="center"&&M!=="right"&&M!=="end"&&M!=="start")throw new Error("Expected left, right, center, start, or end for text-align");E.setTextAlign(M)}if(x){const M=x(C);if(M!=="left"&&M!=="right"&&M!=="center")throw new Error("Expected left, right, or center for text-justify");E.setJustify(M)}if(w){const M=w(C);if(M!=="bottom"&&M!=="top"&&M!=="middle"&&M!=="alphabetic"&&M!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");E.setTextBaseline(M)}return b&&E.setPadding(b(C)),E}}function sS(n,e){return"icon-src"in n?rS(n,e):"shape-points"in n?oS(n,e):"circle-radius"in n?aS(n,e):null}function rS(n,e){const t="icon-",i=t+"src",s=H0(n[i],i),r=oh(n,t+"anchor",e),o=sc(n,t+"scale",e),a=ni(n,t+"opacity",e),l=oh(n,t+"displacement",e),h=ni(n,t+"rotation",e),c=Jo(n,t+"rotate-with-view",e),u=Bp(n,t+"anchor-origin"),d=Up(n,t+"anchor-x-units"),f=Up(n,t+"anchor-y-units"),g=uS(n,t+"color"),p=hS(n,t+"cross-origin"),m=cS(n,t+"offset"),v=Bp(n,t+"offset-origin"),y=mr(n,t+"width"),x=mr(n,t+"height"),w=lS(n,t+"size"),b=Pf(n,t+"declutter"),E=new so({src:s,anchorOrigin:u,anchorXUnits:d,anchorYUnits:f,color:g,crossOrigin:p,offset:m,offsetOrigin:v,height:x,width:y,size:w,declutterMode:b});return function(C){return a&&E.setOpacity(a(C)),l&&E.setDisplacement(l(C)),h&&E.setRotation(h(C)),c&&E.setRotateWithView(c(C)),o&&E.setScale(o(C)),r&&E.setAnchor(r(C)),E}}function oS(n,e){const t="shape-",i=t+"points",s=X0(n[i],i),r=Zo(n,t,e),o=Ko(n,t,e),a=sc(n,t+"scale",e),l=oh(n,t+"displacement",e),h=ni(n,t+"rotation",e),c=Jo(n,t+"rotate-with-view",e),u=mr(n,t+"radius"),d=mr(n,t+"radius1"),f=mr(n,t+"radius2"),g=mr(n,t+"angle"),p=Pf(n,t+"declutter-mode"),m=new p0({points:s,radius:u,radius1:d,radius2:f,angle:g,declutterMode:p});return function(v){return r&&m.setFill(r(v)),o&&m.setStroke(o(v)),l&&m.setDisplacement(l(v)),h&&m.setRotation(h(v)),c&&m.setRotateWithView(c(v)),a&&m.setScale(a(v)),m}}function aS(n,e){const t="circle-",i=Zo(n,t,e),s=Ko(n,t,e),r=ni(n,t+"radius",e),o=sc(n,t+"scale",e),a=oh(n,t+"displacement",e),l=ni(n,t+"rotation",e),h=Jo(n,t+"rotate-with-view",e),c=Pf(n,t+"declutter-mode"),u=new Hn({radius:5,declutterMode:c});return function(d){return r&&u.setRadius(r(d)),i&&u.setFill(i(d)),s&&u.setStroke(s(d)),a&&u.setDisplacement(a(d)),l&&u.setRotation(l(d)),h&&u.setRotateWithView(h(d)),o&&u.setScale(o(d)),u}}function ni(n,e,t){if(!(e in n))return;const i=ds(n[e],ve,t);return function(s){return X0(i(s),e)}}function jn(n,e,t){if(!(e in n))return null;const i=ds(n[e],ao,t);return function(s){return H0(i(s),e)}}function Jo(n,e,t){if(!(e in n))return null;const i=ds(n[e],Ft,t);return function(s){const r=i(s);if(typeof r!="boolean")throw new Error(`Expected a boolean for ${e}`);return r}}function V0(n,e,t){if(!(e in n))return null;const i=ds(n[e],If|ao,t);return function(s){return Y0(i(s),e)}}function W0(n,e,t){if(!(e in n))return null;const i=ds(n[e],La,t);return function(s){return Ia(i(s),e)}}function oh(n,e,t){if(!(e in n))return null;const i=ds(n[e],La,t);return function(s){const r=Ia(i(s),e);if(r.length!==2)throw new Error(`Expected two numbers for ${e}`);return r}}function sc(n,e,t){if(!(e in n))return null;const i=ds(n[e],La|ve,t);return function(s){return dS(i(s),e)}}function mr(n,e){const t=n[e];if(t!==void 0){if(typeof t!="number")throw new Error(`Expected a number for ${e}`);return t}}function lS(n,e){const t=n[e];if(t!==void 0){if(typeof t=="number")return qt(t);if(!Array.isArray(t))throw new Error(`Expected a number or size array for ${e}`);if(t.length!==2||typeof t[0]!="number"||typeof t[1]!="number")throw new Error(`Expected a number or size array for ${e}`);return t}}function hS(n,e){const t=n[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);return t}}function Bp(n,e){const t=n[e];if(t!==void 0){if(t!=="bottom-left"&&t!=="bottom-right"&&t!=="top-left"&&t!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${e}`);return t}}function Up(n,e){const t=n[e];if(t!==void 0){if(t!=="pixels"&&t!=="fraction")throw new Error(`Expected pixels or fraction for ${e}`);return t}}function cS(n,e){const t=n[e];if(t!==void 0)return Ia(t,e)}function Pf(n,e){const t=n[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);if(t!=="declutter"&&t!=="obstacle"&&t!=="none")throw new Error(`Expected declutter, obstacle, or none for ${e}`);return t}}function uS(n,e){const t=n[e];if(t!==void 0)return Y0(t,e)}function Ia(n,e){if(!Array.isArray(n))throw new Error(`Expected an array for ${e}`);const t=n.length;for(let i=0;i<t;++i)if(typeof n[i]!="number")throw new Error(`Expected an array of numbers for ${e}`);return n}function H0(n,e){if(typeof n!="string")throw new Error(`Expected a string for ${e}`);return n}function X0(n,e){if(typeof n!="number")throw new Error(`Expected a number for ${e}`);return n}function Y0(n,e){if(typeof n=="string")return n;const t=Ia(n,e),i=t.length;if(i<3||i>4)throw new Error(`Expected a color with 3 or 4 values for ${e}`);return t}function dS(n,e){if(typeof n=="number")return n;const t=Ia(n,e);if(t.length!==2)throw new Error(`Expected an array of two numbers for ${e}`);return t}const jp={RENDER_ORDER:"renderOrder"};class fS extends Zs{constructor(e){e=e||{};const t=Object.assign({},e);delete t.style,delete t.renderBuffer,delete t.updateWhileAnimating,delete t.updateWhileInteracting,super(t),this.declutter_=e.declutter!==void 0?e.declutter:!1,this.renderBuffer_=e.renderBuffer!==void 0?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=e.updateWhileAnimating!==void 0?e.updateWhileAnimating:!1,this.updateWhileInteracting_=e.updateWhileInteracting!==void 0?e.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(jp.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e){e.declutterTree||(e.declutterTree=new Wm(9)),this.getRenderer().renderDeclutter(e)}setRenderOrder(e){this.set(jp.RENDER_ORDER,e)}setStyle(e){this.style_=gS(e),this.styleFunction_=e===null?void 0:mb(this.style_),this.changed()}}function gS(n){if(n===void 0)return yb;if(!n)return null;if(typeof n=="function"||n instanceof $t)return n;if(!Array.isArray(n))return zp([n]);if(n.length===0)return[];const e=n.length,t=n[0];if(t instanceof $t){const s=new Array(e);for(let r=0;r<e;++r){const o=n[r];if(!(o instanceof $t))throw new Error("Expected a list of style instances");s[r]=o}return s}if("style"in t){const s=new Array(e);for(let r=0;r<e;++r){const o=n[r];if(!("style"in o))throw new Error("Expected a list of rules with a style property");s[r]=o}return tS(s)}return zp(n)}const Af=fS,Pa={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},al=[Pa.FILL],Zn=[Pa.STROKE],Ts=[Pa.BEGIN_PATH],$p=[Pa.CLOSE_PATH],te=Pa;class pS{drawCustom(e,t,i,s){}drawGeometry(e){}setStyle(e){}drawCircle(e,t){}drawFeature(e,t){}drawGeometryCollection(e,t){}drawLineString(e,t){}drawMultiLineString(e,t){}drawMultiPoint(e,t){}drawMultiPolygon(e,t){}drawPoint(e,t){}drawPolygon(e,t){}drawText(e,t){}setFillStrokeStyle(e,t){}setImageStyle(e,t){}setTextStyle(e,t){}}const Z0=pS;class mS extends Z0{constructor(e,t,i,s){super(),this.tolerance=e,this.maxExtent=t,this.pixelRatio=s,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){const t=this.pixelRatio;return t==1?e:e.map(function(i){return i*t})}appendFlatPointCoordinates(e,t){const i=this.getBufferedMaxExtent(),s=this.tmpCoordinate_,r=this.coordinates;let o=r.length;for(let a=0,l=e.length;a<l;a+=t)s[0]=e[a],s[1]=e[a+1],xa(i,s)&&(r[o++]=s[0],r[o++]=s[1]);return o}appendFlatLineCoordinates(e,t,i,s,r,o){const a=this.coordinates;let l=a.length;const h=this.getBufferedMaxExtent();o&&(t+=s);let c=e[t],u=e[t+1];const d=this.tmpCoordinate_;let f=!0,g,p,m;for(g=t+s;g<i;g+=s)d[0]=e[g],d[1]=e[g+1],m=xu(h,d),m!==p?(f&&(a[l++]=c,a[l++]=u,f=!1),a[l++]=d[0],a[l++]=d[1]):m===vt.INTERSECTING?(a[l++]=d[0],a[l++]=d[1],f=!1):f=!0,c=d[0],u=d[1],p=m;return(r&&f||g===t+s)&&(a[l++]=c,a[l++]=u),l}drawCustomCoordinates_(e,t,i,s,r){for(let o=0,a=i.length;o<a;++o){const l=i[o],h=this.appendFlatLineCoordinates(e,t,l,s,!1,!1);r.push(h),t=l}return t}drawCustom(e,t,i,s){this.beginGeometry(e,t);const r=e.getType(),o=e.getStride(),a=this.coordinates.length;let l,h,c,u,d;switch(r){case"MultiPolygon":l=e.getOrientedFlatCoordinates(),u=[];const f=e.getEndss();d=0;for(let g=0,p=f.length;g<p;++g){const m=[];d=this.drawCustomCoordinates_(l,d,f[g],o,m),u.push(m)}this.instructions.push([te.CUSTOM,a,u,e,i,Tu]),this.hitDetectionInstructions.push([te.CUSTOM,a,u,e,s||i,Tu]);break;case"Polygon":case"MultiLineString":c=[],l=r=="Polygon"?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),d=this.drawCustomCoordinates_(l,0,e.getEnds(),o,c),this.instructions.push([te.CUSTOM,a,c,e,i,qo]),this.hitDetectionInstructions.push([te.CUSTOM,a,c,e,s||i,qo]);break;case"LineString":case"Circle":l=e.getFlatCoordinates(),h=this.appendFlatLineCoordinates(l,0,l.length,o,!1,!1),this.instructions.push([te.CUSTOM,a,h,e,i,Wn]),this.hitDetectionInstructions.push([te.CUSTOM,a,h,e,s||i,Wn]);break;case"MultiPoint":l=e.getFlatCoordinates(),h=this.appendFlatPointCoordinates(l,o),h>a&&(this.instructions.push([te.CUSTOM,a,h,e,i,Wn]),this.hitDetectionInstructions.push([te.CUSTOM,a,h,e,s||i,Wn]));break;case"Point":l=e.getFlatCoordinates(),this.coordinates.push(l[0],l[1]),h=this.coordinates.length,this.instructions.push([te.CUSTOM,a,h,e,i]),this.hitDetectionInstructions.push([te.CUSTOM,a,h,e,s||i]);break}this.endGeometry(t)}beginGeometry(e,t){this.beginGeometryInstruction1_=[te.BEGIN_GEOMETRY,t,0,e],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[te.BEGIN_GEOMETRY,t,0,e],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const e=this.hitDetectionInstructions;e.reverse();let t;const i=e.length;let s,r,o=-1;for(t=0;t<i;++t)s=e[t],r=s[0],r==te.END_GEOMETRY?o=t:r==te.BEGIN_GEOMETRY&&(s[2]=t,e1(this.hitDetectionInstructions,o,t),o=-1)}setFillStrokeStyle(e,t){const i=this.state;if(e){const s=e.getColor();i.fillStyle=rn(s||ti)}else i.fillStyle=void 0;if(t){const s=t.getColor();i.strokeStyle=rn(s||Wo);const r=t.getLineCap();i.lineCap=r!==void 0?r:ro;const o=t.getLineDash();i.lineDash=o?o.slice():Tn;const a=t.getLineDashOffset();i.lineDashOffset=a||Rn;const l=t.getLineJoin();i.lineJoin=l!==void 0?l:oo;const h=t.getWidth();i.lineWidth=h!==void 0?h:Xo;const c=t.getMiterLimit();i.miterLimit=c!==void 0?c:Vo,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(e){const t=e.fillStyle,i=[te.SET_FILL_STYLE,t];return typeof t!="string"&&i.push(!0),i}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[te.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,this.applyPixelRatio(e.lineDash),e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,t){const i=e.fillStyle;(typeof i!="string"||e.currentFillStyle!=i)&&(i!==void 0&&this.instructions.push(t.call(this,e)),e.currentFillStyle=i)}updateStrokeStyle(e,t){const i=e.strokeStyle,s=e.lineCap,r=e.lineDash,o=e.lineDashOffset,a=e.lineJoin,l=e.lineWidth,h=e.miterLimit;(e.currentStrokeStyle!=i||e.currentLineCap!=s||r!=e.currentLineDash&&!Pn(e.currentLineDash,r)||e.currentLineDashOffset!=o||e.currentLineJoin!=a||e.currentLineWidth!=l||e.currentMiterLimit!=h)&&(i!==void 0&&t.call(this,e),e.currentStrokeStyle=i,e.currentLineCap=s,e.currentLineDash=r,e.currentLineDashOffset=o,e.currentLineJoin=a,e.currentLineWidth=l,e.currentMiterLimit=h)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const t=[te.END_GEOMETRY,e];this.instructions.push(t),this.hitDetectionInstructions.push(t)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=vy(this.maxExtent),this.maxLineWidth>0)){const e=this.resolution*(this.maxLineWidth+1)/2;si(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}const Aa=mS;class yS extends Aa{constructor(e,t,i,s){super(e,t,i,s),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,t){if(!this.image_)return;this.beginGeometry(e,t);const i=e.getFlatCoordinates(),s=e.getStride(),r=this.coordinates.length,o=this.appendFlatPointCoordinates(i,s);this.instructions.push([te.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([te.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}drawMultiPoint(e,t){if(!this.image_)return;this.beginGeometry(e,t);const i=e.getFlatCoordinates(),s=e.getStride(),r=this.coordinates.length,o=this.appendFlatPointCoordinates(i,s);this.instructions.push([te.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([te.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,t){const i=e.getAnchor(),s=e.getSize(),r=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=s[1],this.opacity_=e.getOpacity(),this.originX_=r[0],this.originY_=r[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=s[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}const _S=yS;class vS extends Aa{constructor(e,t,i,s){super(e,t,i,s)}drawFlatCoordinates_(e,t,i,s){const r=this.coordinates.length,o=this.appendFlatLineCoordinates(e,t,i,s,!1,!1),a=[te.MOVE_TO_LINE_TO,r,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),i}drawLineString(e,t){const i=this.state,s=i.strokeStyle,r=i.lineWidth;if(s===void 0||r===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(e,t),this.hitDetectionInstructions.push([te.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Tn,Rn],Ts);const o=e.getFlatCoordinates(),a=e.getStride();this.drawFlatCoordinates_(o,0,o.length,a),this.hitDetectionInstructions.push(Zn),this.endGeometry(t)}drawMultiLineString(e,t){const i=this.state,s=i.strokeStyle,r=i.lineWidth;if(s===void 0||r===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(e,t),this.hitDetectionInstructions.push([te.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Tn,Rn],Ts);const o=e.getEnds(),a=e.getFlatCoordinates(),l=e.getStride();let h=0;for(let c=0,u=o.length;c<u;++c)h=this.drawFlatCoordinates_(a,h,o[c],l);this.hitDetectionInstructions.push(Zn),this.endGeometry(t)}finish(){const e=this.state;return e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&this.instructions.push(Zn),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(Zn),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(Ts)}}const xS=vS;class wS extends Aa{constructor(e,t,i,s){super(e,t,i,s)}drawFlatCoordinatess_(e,t,i,s){const r=this.state,o=r.fillStyle!==void 0,a=r.strokeStyle!==void 0,l=i.length;this.instructions.push(Ts),this.hitDetectionInstructions.push(Ts);for(let h=0;h<l;++h){const c=i[h],u=this.coordinates.length,d=this.appendFlatLineCoordinates(e,t,c,s,!0,!a),f=[te.MOVE_TO_LINE_TO,u,d];this.instructions.push(f),this.hitDetectionInstructions.push(f),a&&(this.instructions.push($p),this.hitDetectionInstructions.push($p)),t=c}return o&&(this.instructions.push(al),this.hitDetectionInstructions.push(al)),a&&(this.instructions.push(Zn),this.hitDetectionInstructions.push(Zn)),t}drawCircle(e,t){const i=this.state,s=i.fillStyle,r=i.strokeStyle;if(s===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([te.SET_FILL_STYLE,ti]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([te.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Tn,Rn]);const o=e.getFlatCoordinates(),a=e.getStride(),l=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,a,!1,!1);const h=[te.CIRCLE,l];this.instructions.push(Ts,h),this.hitDetectionInstructions.push(Ts,h),i.fillStyle!==void 0&&(this.instructions.push(al),this.hitDetectionInstructions.push(al)),i.strokeStyle!==void 0&&(this.instructions.push(Zn),this.hitDetectionInstructions.push(Zn)),this.endGeometry(t)}drawPolygon(e,t){const i=this.state,s=i.fillStyle,r=i.strokeStyle;if(s===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([te.SET_FILL_STYLE,ti]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([te.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Tn,Rn]);const o=e.getEnds(),a=e.getOrientedFlatCoordinates(),l=e.getStride();this.drawFlatCoordinatess_(a,0,o,l),this.endGeometry(t)}drawMultiPolygon(e,t){const i=this.state,s=i.fillStyle,r=i.strokeStyle;if(s===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([te.SET_FILL_STYLE,ti]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([te.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Tn,Rn]);const o=e.getEndss(),a=e.getOrientedFlatCoordinates(),l=e.getStride();let h=0;for(let c=0,u=o.length;c<u;++c)h=this.drawFlatCoordinatess_(a,h,o[c],l);this.endGeometry(t)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(e!==0){const t=this.coordinates;for(let i=0,s=t.length;i<s;++i)t[i]=ws(t[i],e)}return super.finish()}setFillStrokeStyles_(){const e=this.state;e.fillStyle!==void 0&&this.updateFillStyle(e,this.createFill),e.strokeStyle!==void 0&&this.updateStrokeStyle(e,this.applyStroke)}}const qp=wS;function bS(n,e,t,i,s){const r=[];let o=t,a=0,l=e.slice(t,2);for(;a<n&&o+s<i;){const[h,c]=l.slice(-2),u=e[o+s],d=e[o+s+1],f=Math.sqrt((u-h)*(u-h)+(d-c)*(d-c));if(a+=f,a>=n){const g=(n-a+f)/f,p=ci(h,u,g),m=ci(c,d,g);l.push(p,m),r.push(l),l=[p,m],a==n&&(o+=s),a=0}else if(a<n)l.push(e[o+s],e[o+s+1]),o+=s;else{const g=f-a,p=ci(h,u,g/f),m=ci(c,d,g/f);l.push(p,m),r.push(l),l=[p,m],a=0,o+=s}}return a>0&&r.push(l),r}function ES(n,e,t,i,s){let r=t,o=t,a=0,l=0,h=t,c,u,d,f,g,p,m,v,y,x;for(u=t;u<i;u+=s){const w=e[u],b=e[u+1];g!==void 0&&(y=w-g,x=b-p,f=Math.sqrt(y*y+x*x),m!==void 0&&(l+=d,c=Math.acos((m*y+v*x)/(d*f)),c>n&&(l>a&&(a=l,r=h,o=u),l=0,h=u-s)),d=f,m=y,v=x),g=w,p=b}return l+=f,l>a?[h,u]:[r,o]}const ah={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class CS extends Aa{constructor(e,t,i,s){super(e,t,i,s),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[ti]={fillStyle:ti},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterImageWithText_=void 0}finish(){const e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,t){const i=this.textFillState_,s=this.textStrokeState_,r=this.textState_;if(this.text_===""||!r||!i&&!s)return;const o=this.coordinates;let a=o.length;const l=e.getType();let h=null,c=e.getStride();if(r.placement==="line"&&(l=="LineString"||l=="MultiLineString"||l=="Polygon"||l=="MultiPolygon")){if(!He(this.getBufferedMaxExtent(),e.getExtent()))return;let u;if(h=e.getFlatCoordinates(),l=="LineString")u=[h.length];else if(l=="MultiLineString")u=e.getEnds();else if(l=="Polygon")u=e.getEnds().slice(0,1);else if(l=="MultiPolygon"){const p=e.getEndss();u=[];for(let m=0,v=p.length;m<v;++m)u.push(p[m][0])}this.beginGeometry(e,t);const d=r.repeat,f=d?void 0:r.textAlign;let g=0;for(let p=0,m=u.length;p<m;++p){let v;d?v=bS(d*this.resolution,h,g,u[p],c):v=[h.slice(g,u[p])];for(let y=0,x=v.length;y<x;++y){const w=v[y];let b=0,E=w.length;if(f==null){const M=ES(r.maxAngle,w,0,w.length,2);b=M[0],E=M[1]}for(let M=b;M<E;M+=c)o.push(w[M],w[M+1]);const C=o.length;g=u[p],this.drawChars_(a,C),a=C}}this.endGeometry(t)}else{let u=r.overflow?null:[];switch(l){case"Point":case"MultiPoint":h=e.getFlatCoordinates();break;case"LineString":h=e.getFlatMidpoint();break;case"Circle":h=e.getCenter();break;case"MultiLineString":h=e.getFlatMidpoints(),c=2;break;case"Polygon":h=e.getFlatInteriorPoint(),r.overflow||u.push(h[2]/this.resolution),c=3;break;case"MultiPolygon":const v=e.getFlatInteriorPoints();h=[];for(let y=0,x=v.length;y<x;y+=3)r.overflow||u.push(v[y+2]/this.resolution),h.push(v[y],v[y+1]);if(h.length===0)return;c=2;break}const d=this.appendFlatPointCoordinates(h,c);if(d===a)return;if(u&&(d-a)/2!==h.length/c){let v=a/2;u=u.filter((y,x)=>{const w=o[(v+x)*2]===h[x*c]&&o[(v+x)*2+1]===h[x*c+1];return w||--v,w})}this.saveTextStates_(),(r.backgroundFill||r.backgroundStroke)&&(this.setFillStrokeStyle(r.backgroundFill,r.backgroundStroke),r.backgroundFill&&this.updateFillStyle(this.state,this.createFill),r.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(e,t);let f=r.padding;if(f!=Ss&&(r.scale[0]<0||r.scale[1]<0)){let v=r.padding[0],y=r.padding[1],x=r.padding[2],w=r.padding[3];r.scale[0]<0&&(y=-y,w=-w),r.scale[1]<0&&(v=-v,x=-x),f=[v,y,x,w]}const g=this.pixelRatio;this.instructions.push([te.DRAW_IMAGE,a,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,f==Ss?Ss:f.map(function(v){return v*g}),!!r.backgroundFill,!!r.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,u]);const p=1/g,m=this.state.fillStyle;r.backgroundFill&&(this.state.fillStyle=ti,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([te.DRAW_IMAGE,a,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[p,p],NaN,void 0,this.declutterImageWithText_,f,!!r.backgroundFill,!!r.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?ti:this.fillKey_,this.textOffsetX_,this.textOffsetY_,u]),r.backgroundFill&&(this.state.fillStyle=m,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(t)}}saveTextStates_(){const e=this.textStrokeState_,t=this.textState_,i=this.textFillState_,s=this.strokeKey_;e&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));const r=this.textKey_;r in this.textStates||(this.textStates[r]={font:t.font,textAlign:t.textAlign||Ho,justify:t.justify,textBaseline:t.textBaseline||Jl,scale:t.scale});const o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))}drawChars_(e,t){const i=this.textStrokeState_,s=this.textState_,r=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,h=ah[s.textBaseline],c=this.textOffsetY_*l,u=this.text_,d=i?i.lineWidth*Math.abs(s.scale[0])/2:0;this.instructions.push([te.DRAW_CHARS,e,t,h,s.overflow,a,s.maxAngle,l,c,r,d*l,u,o,1]),this.hitDetectionInstructions.push([te.DRAW_CHARS,e,t,h,s.overflow,a&&ti,s.maxAngle,l,c,r,d*l,u,o,1/l])}setTextStyle(e,t){let i,s,r;if(!e)this.text_="";else{const o=e.getFill();o?(s=this.textFillState_,s||(s={},this.textFillState_=s),s.fillStyle=rn(o.getColor()||ti)):(s=null,this.textFillState_=s);const a=e.getStroke();if(!a)r=null,this.textStrokeState_=r;else{r=this.textStrokeState_,r||(r={},this.textStrokeState_=r);const g=a.getLineDash(),p=a.getLineDashOffset(),m=a.getWidth(),v=a.getMiterLimit();r.lineCap=a.getLineCap()||ro,r.lineDash=g?g.slice():Tn,r.lineDashOffset=p===void 0?Rn:p,r.lineJoin=a.getLineJoin()||oo,r.lineWidth=m===void 0?Xo:m,r.miterLimit=v===void 0?Vo:v,r.strokeStyle=rn(a.getColor()||Wo)}i=this.textState_;const l=e.getFont()||d0;f0(l);const h=e.getScaleArray();i.overflow=e.getOverflow(),i.font=l,i.maxAngle=e.getMaxAngle(),i.placement=e.getPlacement(),i.textAlign=e.getTextAlign(),i.repeat=e.getRepeat(),i.justify=e.getJustify(),i.textBaseline=e.getTextBaseline()||Jl,i.backgroundFill=e.getBackgroundFill(),i.backgroundStroke=e.getBackgroundStroke(),i.padding=e.getPadding()||Ss,i.scale=h===void 0?[1,1]:h;const c=e.getOffsetX(),u=e.getOffsetY(),d=e.getRotateWithView(),f=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=c===void 0?0:c,this.textOffsetY_=u===void 0?0:u,this.textRotateWithView_=d===void 0?!1:d,this.textRotation_=f===void 0?0:f,this.strokeKey_=r?(typeof r.strokeStyle=="string"?r.strokeStyle:H(r.strokeStyle))+r.lineCap+r.lineDashOffset+"|"+r.lineWidth+r.lineJoin+r.miterLimit+"["+r.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=s?typeof s.fillStyle=="string"?s.fillStyle:"|"+H(s.fillStyle):""}this.declutterImageWithText_=t}}const MS={Circle:qp,Default:Aa,Image:_S,LineString:xS,Polygon:qp,Text:CS};class SS{constructor(e,t,i,s){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=s,this.resolution_=i,this.buildersByZIndex_={}}finish(){const e={};for(const t in this.buildersByZIndex_){e[t]=e[t]||{};const i=this.buildersByZIndex_[t];for(const s in i){const r=i[s].finish();e[t][s]=r}}return e}getBuilder(e,t){const i=e!==void 0?e.toString():"0";let s=this.buildersByZIndex_[i];s===void 0&&(s={},this.buildersByZIndex_[i]=s);let r=s[t];if(r===void 0){const o=MS[t];r=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),s[t]=r}return r}}const lh=SS;class TS extends Sa{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.declutterExecutorGroup=null}getFeatures(e){return ie()}getData(e){return null}prepareFrame(e){return ie()}renderFrame(e,t){return ie()}loadedTileCallback(e,t,i){e[t]||(e[t]={}),e[t][i.tileCoord.toString()]=i}createLoadedTileFinder(e,t,i){return(s,r)=>{const o=this.loadedTileCallback.bind(this,i,s);return e.forEachLoadedTile(t,s,r,o)}}forEachFeatureAtCoordinate(e,t,i,s,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;(t.getState()===re.LOADED||t.getState()===re.ERROR)&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=re.LOADED&&t!=re.ERROR&&e.addEventListener(K.CHANGE,this.boundHandleImageChange_),t==re.IDLE&&(e.load(),t=e.getState()),t==re.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}}const RS=TS,Vp=[];let lr=null;function LS(){lr=St(1,1,void 0,{willReadFrequently:!0})}class IS extends RS{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=pi(),this.pixelTransform=pi(),this.inversePixelTransform=pi(),this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(e,t,i){lr||LS(),lr.clearRect(0,0,1,1);let s;try{lr.drawImage(e,t,i,1,1,0,0,1,1),s=lr.getImageData(0,0,1,1).data}catch{return lr=null,null}return s}getBackground(e){let i=this.getLayer().getBackground();return typeof i=="function"&&(i=i(e.viewState.resolution)),i||void 0}useContainer(e,t,i){const s=this.getLayer().getClassName();let r,o;if(e&&e.className===s&&(!i||e&&e.style.backgroundColor&&Pn(Zl(e.style.backgroundColor),Zl(i)))){const a=e.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===t?(this.container=e,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){r=document.createElement("div"),r.className=s;let a=r.style;a.position="absolute",a.width="100%",a.height="100%",o=St();const l=o.canvas;r.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=r,this.context=o}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(e,t,i){const s=fn(i),r=ba(i),o=wa(i),a=eo(i);st(t.coordinateToPixelTransform,s),st(t.coordinateToPixelTransform,r),st(t.coordinateToPixelTransform,o),st(t.coordinateToPixelTransform,a);const l=this.inversePixelTransform;st(l,s),st(l,r),st(l,o),st(l,a),e.save(),e.beginPath(),e.moveTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(r[0]),Math.round(r[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}dispatchRenderEvent_(e,t,i){const s=this.getLayer();if(s.hasListener(e)){const r=new P0(e,this.inversePixelTransform,i,t);s.dispatchEvent(r)}}preRender(e,t){this.frameState=t,this.dispatchRenderEvent_(hn.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(hn.POSTRENDER,e,t)}getRenderTransform(e,t,i,s,r,o,a){const l=r/2,h=o/2,c=s/t,u=-c,d=-e[0]+a,f=-e[1];return Vi(this.tempTransform,l,h,c,u,-i,d,f)}disposeInternal(){delete this.frameState,super.disposeInternal()}}const Ff=IS;function PS(n,e,t,i,s,r,o,a,l,h,c,u){let d=n[e],f=n[e+1],g=0,p=0,m=0,v=0;function y(){g=d,p=f,e+=i,d=n[e],f=n[e+1],v+=m,m=Math.sqrt((d-g)*(d-g)+(f-p)*(f-p))}do y();while(e<t-i&&v+m<r);let x=m===0?0:(r-v)/m;const w=ci(g,d,x),b=ci(p,f,x),E=e-i,C=v,M=r+a*l(h,s,c);for(;e<t-i&&v+m<M;)y();x=m===0?0:(M-v)/m;const R=ci(g,d,x),N=ci(p,f,x);let G;if(u){const P=[w,b,R,N];Vd(P,0,4,2,u,P,P),G=P[0]>P[2]}else G=w>R;const S=Math.PI,B=[],O=E+i===e;e=E,m=0,v=C,d=n[e],f=n[e+1];let L;if(O){y(),L=Math.atan2(f-p,d-g),G&&(L+=L>0?-S:S);const P=(R+w)/2,z=(N+b)/2;return B[0]=[P,z,(M-r)/2,L,s],B}s=s.replace(/\n/g," ");for(let P=0,z=s.length;P<z;){y();let Q=Math.atan2(f-p,d-g);if(G&&(Q+=Q>0?-S:S),L!==void 0){let Re=Q-L;if(Re+=Re>S?-2*S:Re<-S?2*S:0,Math.abs(Re)>o)return null}L=Q;const Te=P;let I=0;for(;P<z;++P){const Re=G?z-P-1:P,me=a*l(h,s[Re],c);if(e+i<t&&v+m<r+I+me/2)break;I+=me}if(P===Te)continue;const it=G?s.substring(z-Te,z-P):s.substring(Te,P);x=m===0?0:(r+I/2-v)/m;const A=ci(g,d,x),nt=ci(p,f,x);B.push([A,nt,I/2,Q,it]),r+=I}return B}const ir=Xt(),Nn=[],_n=[],vn=[],Dn=[];function Wp(n){return n[3].declutterBox}const Hp=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function Ic(n,e){return e==="start"?e=Hp.test(n)?"right":"left":e==="end"&&(e=Hp.test(n)?"left":"right"),ah[e]}function AS(n,e,t){return t>0&&n.push(`
`,""),n.push(e,""),n}class FS{constructor(e,t,i,s){this.overlaps=i,this.pixelRatio=t,this.resolution=e,this.alignFill_,this.instructions=s.instructions,this.coordinates=s.coordinates,this.coordinateCache_={},this.renderedTransform_=pi(),this.hitDetectionInstructions=s.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=s.fillStates||{},this.strokeStates=s.strokeStates||{},this.textStates=s.textStates||{},this.widths_={},this.labels_={}}createLabel(e,t,i,s){const r=e+t+i+s;if(this.labels_[r])return this.labels_[r];const o=s?this.strokeStates[s]:null,a=i?this.fillStates[i]:null,l=this.textStates[t],h=this.pixelRatio,c=[l.scale[0]*h,l.scale[1]*h],u=Array.isArray(e),d=l.justify?ah[l.justify]:Ic(Array.isArray(e)?e[0]:e,l.textAlign||Ho),f=s&&o.lineWidth?o.lineWidth:0,g=u?e:e.split(`
`).reduce(AS,[]),{width:p,height:m,widths:v,heights:y,lineWidths:x}=fb(l,g),w=p+f,b=[],E=(w+2)*c[0],C=(m+f)*c[1],M={width:E<0?Math.floor(E):Math.ceil(E),height:C<0?Math.floor(C):Math.ceil(C),contextInstructions:b};(c[0]!=1||c[1]!=1)&&b.push("scale",c),s&&(b.push("strokeStyle",o.strokeStyle),b.push("lineWidth",f),b.push("lineCap",o.lineCap),b.push("lineJoin",o.lineJoin),b.push("miterLimit",o.miterLimit),b.push("setLineDash",[o.lineDash]),b.push("lineDashOffset",o.lineDashOffset)),i&&b.push("fillStyle",a.fillStyle),b.push("textBaseline","middle"),b.push("textAlign","center");const R=.5-d;let N=d*w+R*f;const G=[],S=[];let B=0,O=0,L=0,P=0,z;for(let Q=0,Te=g.length;Q<Te;Q+=2){const I=g[Q];if(I===`
`){O+=B,B=0,N=d*w+R*f,++P;continue}const it=g[Q+1]||l.font;it!==z&&(s&&G.push("font",it),i&&S.push("font",it),z=it),B=Math.max(B,y[L]);const A=[I,N+R*v[L]+d*(v[L]-x[P]),.5*(f+B)+O];N+=v[L],s&&G.push("strokeText",A),i&&S.push("fillText",A),++L}return Array.prototype.push.apply(b,G),Array.prototype.push.apply(b,S),this.labels_[r]=M,M}replayTextBackground_(e,t,i,s,r,o,a){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,i),e.lineTo.apply(e,s),e.lineTo.apply(e,r),e.lineTo.apply(e,t),o&&(this.alignFill_=o[2],this.fill_(e)),a&&(this.setStrokeStyle_(e,a),e.stroke())}calculateImageOrLabelDimensions_(e,t,i,s,r,o,a,l,h,c,u,d,f,g,p,m){a*=d[0],l*=d[1];let v=i-a,y=s-l;const x=r+h>e?e-h:r,w=o+c>t?t-c:o,b=g[3]+x*d[0]+g[1],E=g[0]+w*d[1]+g[2],C=v-g[3],M=y-g[0];(p||u!==0)&&(Nn[0]=C,Dn[0]=C,Nn[1]=M,_n[1]=M,_n[0]=C+b,vn[0]=_n[0],vn[1]=M+E,Dn[1]=vn[1]);let R;return u!==0?(R=Vi(pi(),i,s,1,1,u,-i,-s),st(R,Nn),st(R,_n),st(R,vn),st(R,Dn),Pi(Math.min(Nn[0],_n[0],vn[0],Dn[0]),Math.min(Nn[1],_n[1],vn[1],Dn[1]),Math.max(Nn[0],_n[0],vn[0],Dn[0]),Math.max(Nn[1],_n[1],vn[1],Dn[1]),ir)):Pi(Math.min(C,C+b),Math.min(M,M+E),Math.max(C,C+b),Math.max(M,M+E),ir),f&&(v=Math.round(v),y=Math.round(y)),{drawImageX:v,drawImageY:y,drawImageW:x,drawImageH:w,originX:h,originY:c,declutterBox:{minX:ir[0],minY:ir[1],maxX:ir[2],maxY:ir[3],value:m},canvasTransform:R,scale:d}}replayImageOrLabel_(e,t,i,s,r,o,a){const l=!!(o||a),h=s.declutterBox,c=e.canvas,u=a?a[2]*s.scale[0]/2:0;return h.minX-u<=c.width/t&&h.maxX+u>=0&&h.minY-u<=c.height/t&&h.maxY+u>=0&&(l&&this.replayTextBackground_(e,Nn,_n,vn,Dn,o,a),gb(e,s.canvasTransform,r,i,s.originX,s.originY,s.drawImageW,s.drawImageH,s.drawImageX,s.drawImageY,s.scale)),!0}fill_(e){if(this.alignFill_){const t=st(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;e.save(),e.translate(t[0]%i,t[1]%i),e.rotate(this.viewRotation_)}e.fill(),this.alignFill_&&e.restore()}setStrokeStyle_(e,t){e.strokeStyle=t[1],e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.lineDashOffset=t[7],e.setLineDash(t[6])}drawLabelWithPointPlacement_(e,t,i,s){const r=this.textStates[t],o=this.createLabel(e,t,s,i),a=this.strokeStates[i],l=this.pixelRatio,h=Ic(Array.isArray(e)?e[0]:e,r.textAlign||Ho),c=ah[r.textBaseline||Jl],u=a&&a.lineWidth?a.lineWidth:0,d=o.width/l-2*r.scale[0],f=h*d+2*(.5-h)*u,g=c*o.height/l+2*(.5-c)*u;return{label:o,anchorX:f,anchorY:g}}execute_(e,t,i,s,r,o,a,l){let h;this.pixelCoordinates_&&Pn(i,this.renderedTransform_)?h=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=es(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),iw(this.renderedTransform_,i));let c=0;const u=s.length;let d=0,f,g,p,m,v,y,x,w,b,E,C,M,R=0,N=0,G=null,S=null;const B=this.coordinateCache_,O=this.viewRotation_,L=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,P={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:O},z=this.instructions!=s||this.overlaps?0:200;let Q,Te,I,it;for(;c<u;){const A=s[c];switch(A[0]){case te.BEGIN_GEOMETRY:Q=A[1],it=A[3],Q.getGeometry()?a!==void 0&&!He(a,it.getExtent())?c=A[2]+1:++c:c=A[2];break;case te.BEGIN_PATH:R>z&&(this.fill_(e),R=0),N>z&&(e.stroke(),N=0),!R&&!N&&(e.beginPath(),m=NaN,v=NaN),++c;break;case te.CIRCLE:d=A[1];const Re=h[d],me=h[d+1],_t=h[d+2],Dt=h[d+3],Ue=_t-Re,dt=Dt-me,$=Math.sqrt(Ue*Ue+dt*dt);e.moveTo(Re+$,me),e.arc(Re,me,$,0,2*Math.PI,!0),++c;break;case te.CLOSE_PATH:e.closePath(),++c;break;case te.CUSTOM:d=A[1],f=A[2];const Ai=A[3],Fi=A[4],ze=A.length==6?A[5]:void 0;P.geometry=Ai,P.feature=Q,c in B||(B[c]=[]);const Oi=B[c];ze?ze(h,d,f,2,Oi):(Oi[0]=h[d],Oi[1]=h[d+1],Oi.length=2),Fi(Oi,P),++c;break;case te.DRAW_IMAGE:d=A[1],f=A[2],w=A[3],g=A[4],p=A[5];let ki=A[6];const Ve=A[7],On=A[8],Qe=A[9],Yi=A[10];let vi=A[11];const xi=A[12];let at=A[13];const Tt=A[14],be=A[15];if(!w&&A.length>=20){b=A[19],E=A[20],C=A[21],M=A[22];const li=this.drawLabelWithPointPlacement_(b,E,C,M);w=li.label,A[3]=w;const Ks=A[23];g=(li.anchorX-Ks)*this.pixelRatio,A[4]=g;const wi=A[24];p=(li.anchorY-wi)*this.pixelRatio,A[5]=p,ki=w.height,A[6]=ki,at=w.width,A[13]=at}let Le;A.length>25&&(Le=A[25]);let Ie,Ae,ye;A.length>17?(Ie=A[16],Ae=A[17],ye=A[18]):(Ie=Ss,Ae=!1,ye=!1),Yi&&L?vi+=O:!Yi&&!L&&(vi-=O);let we=0;for(;d<f;d+=2){if(Le&&Le[we++]<at/this.pixelRatio)continue;const li=this.calculateImageOrLabelDimensions_(w.width,w.height,h[d],h[d+1],at,ki,g,p,On,Qe,vi,xi,r,Ie,Ae||ye,Q),Ks=[e,t,w,li,Ve,Ae?G:null,ye?S:null];if(l){if(Tt==="none")continue;if(Tt==="obstacle"){l.insert(li.declutterBox);continue}else{let wi,pn;if(be){const hi=f-d;if(!be[hi]){be[hi]=Ks;continue}if(wi=be[hi],delete be[hi],pn=Wp(wi),l.collides(pn))continue}if(l.collides(li.declutterBox))continue;wi&&(l.insert(pn),this.replayImageOrLabel_.apply(this,wi)),l.insert(li.declutterBox)}}this.replayImageOrLabel_.apply(this,Ks)}++c;break;case te.DRAW_CHARS:const lt=A[1],_e=A[2],bt=A[3],Gt=A[4];M=A[5];const Rt=A[6],Lt=A[7],qe=A[8];C=A[9];const ft=A[10];b=A[11],E=A[12];const zt=[A[13],A[13]],Ye=this.textStates[E],ai=Ye.font,gs=[Ye.scale[0]*Lt,Ye.scale[1]*Lt];let ps;ai in this.widths_?ps=this.widths_[ai]:(ps={},this.widths_[ai]=ps);const ja=Hy(h,lt,_e,2),$a=Math.abs(gs[0])*lp(ai,b,ps);if(Gt||$a<=ja){const li=this.textStates[E].textAlign,Ks=(ja-$a)*Ic(b,li),wi=PS(h,lt,_e,2,b,Ks,Rt,Math.abs(gs[0]),lp,ai,ps,L?0:this.viewRotation_);e:if(wi){const pn=[];let hi,qa,Va,Zt,bi;if(C)for(hi=0,qa=wi.length;hi<qa;++hi){bi=wi[hi],Va=bi[4],Zt=this.createLabel(Va,E,"",C),g=bi[2]+(gs[0]<0?-ft:ft),p=bt*Zt.height+(.5-bt)*2*ft*gs[1]/gs[0]-qe;const mn=this.calculateImageOrLabelDimensions_(Zt.width,Zt.height,bi[0],bi[1],Zt.width,Zt.height,g,p,0,0,bi[3],zt,!1,Ss,!1,Q);if(l&&l.collides(mn.declutterBox))break e;pn.push([e,t,Zt,mn,1,null,null])}if(M)for(hi=0,qa=wi.length;hi<qa;++hi){bi=wi[hi],Va=bi[4],Zt=this.createLabel(Va,E,M,""),g=bi[2],p=bt*Zt.height-qe;const mn=this.calculateImageOrLabelDimensions_(Zt.width,Zt.height,bi[0],bi[1],Zt.width,Zt.height,g,p,0,0,bi[3],zt,!1,Ss,!1,Q);if(l&&l.collides(mn.declutterBox))break e;pn.push([e,t,Zt,mn,1,null,null])}l&&l.load(pn.map(Wp));for(let mn=0,Nv=pn.length;mn<Nv;++mn)this.replayImageOrLabel_.apply(this,pn[mn])}}++c;break;case te.END_GEOMETRY:if(o!==void 0){Q=A[1];const li=o(Q,it);if(li)return li}++c;break;case te.FILL:z?R++:this.fill_(e),++c;break;case te.MOVE_TO_LINE_TO:for(d=A[1],f=A[2],Te=h[d],I=h[d+1],y=Te+.5|0,x=I+.5|0,(y!==m||x!==v)&&(e.moveTo(Te,I),m=y,v=x),d+=2;d<f;d+=2)Te=h[d],I=h[d+1],y=Te+.5|0,x=I+.5|0,(d==f-2||y!==m||x!==v)&&(e.lineTo(Te,I),m=y,v=x);++c;break;case te.SET_FILL_STYLE:G=A,this.alignFill_=A[2],R&&(this.fill_(e),R=0,N&&(e.stroke(),N=0)),e.fillStyle=A[1],++c;break;case te.SET_STROKE_STYLE:S=A,N&&(e.stroke(),N=0),this.setStrokeStyle_(e,A),++c;break;case te.STROKE:z?N++:e.stroke(),++c;break;default:++c;break}}R&&this.fill_(e),N&&e.stroke()}execute(e,t,i,s,r,o){this.viewRotation_=s,this.execute_(e,t,i,this.instructions,r,void 0,void 0,o)}executeHitDetection(e,t,i,s,r){return this.viewRotation_=i,this.execute_(e,1,t,this.hitDetectionInstructions,!0,s,r)}}const OS=FS,Pc=["Polygon","Circle","LineString","Image","Text","Default"];class kS{constructor(e,t,i,s,r,o){this.maxExtent_=e,this.overlaps_=s,this.pixelRatio_=i,this.resolution_=t,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=pi(),this.createExecutors_(r)}clip(e,t){const i=this.getClipCoords(t);e.beginPath(),e.moveTo(i[0],i[1]),e.lineTo(i[2],i[3]),e.lineTo(i[4],i[5]),e.lineTo(i[6],i[7]),e.clip()}createExecutors_(e){for(const t in e){let i=this.executorsByZIndex_[t];i===void 0&&(i={},this.executorsByZIndex_[t]=i);const s=e[t];for(const r in s){const o=s[r];i[r]=new OS(this.resolution_,this.pixelRatio_,this.overlaps_,o)}}}hasExecutors(e){for(const t in this.executorsByZIndex_){const i=this.executorsByZIndex_[t];for(let s=0,r=e.length;s<r;++s)if(e[s]in i)return!0}return!1}forEachFeatureAtCoordinate(e,t,i,s,r,o){s=Math.round(s);const a=s*2+1,l=Vi(this.hitDetectionTransform_,s+.5,s+.5,1/t,-1/t,-i,-e[0],-e[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=St(a,a,void 0,{willReadFrequently:!0}));const c=this.hitDetectionContext_;c.canvas.width!==a||c.canvas.height!==a?(c.canvas.width=a,c.canvas.height=a):h||c.clearRect(0,0,a,a);let u;this.renderBuffer_!==void 0&&(u=Xt(),Fo(u,e),si(u,t*(this.renderBuffer_+s),u));const d=NS(s);let f;function g(b,E){const C=c.getImageData(0,0,a,a).data;for(let M=0,R=d.length;M<R;M++)if(C[d[M]]>0){if(!o||f!=="Image"&&f!=="Text"||o.includes(b)){const N=(d[M]-3)/4,G=s-N%a,S=s-(N/a|0),B=r(b,E,G*G+S*S);if(B)return B}c.clearRect(0,0,a,a);break}}const p=Object.keys(this.executorsByZIndex_).map(Number);p.sort(rs);let m,v,y,x,w;for(m=p.length-1;m>=0;--m){const b=p[m].toString();for(y=this.executorsByZIndex_[b],v=Pc.length-1;v>=0;--v)if(f=Pc[v],x=y[f],x!==void 0&&(w=x.executeHitDetection(c,l,i,g,u),w))return w}}getClipCoords(e){const t=this.maxExtent_;if(!t)return null;const i=t[0],s=t[1],r=t[2],o=t[3],a=[i,s,i,o,r,o,r,s];return es(a,0,8,2,e,a),a}isEmpty(){return ks(this.executorsByZIndex_)}execute(e,t,i,s,r,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(rs),this.maxExtent_&&(e.save(),this.clip(e,i)),o=o||Pc;let h,c,u,d,f,g;for(a&&l.reverse(),h=0,c=l.length;h<c;++h){const p=l[h].toString();for(f=this.executorsByZIndex_[p],u=0,d=o.length;u<d;++u){const m=o[u];g=f[m],g!==void 0&&g.execute(e,t,i,s,r,a)}}this.maxExtent_&&e.restore()}}const Ac={};function NS(n){if(Ac[n]!==void 0)return Ac[n];const e=n*2+1,t=n*n,i=new Array(t+1);for(let r=0;r<=n;++r)for(let o=0;o<=n;++o){const a=r*r+o*o;if(a>t)break;let l=i[a];l||(l=[],i[a]=l),l.push(((n+r)*e+(n+o))*4+3),r>0&&l.push(((n-r)*e+(n+o))*4+3),o>0&&(l.push(((n+r)*e+(n-o))*4+3),r>0&&l.push(((n-r)*e+(n-o))*4+3))}const s=[];for(let r=0,o=i.length;r<o;++r)i[r]&&s.push(...i[r]);return Ac[n]=s,s}const hh=kS;class DS extends Z0{constructor(e,t,i,s,r,o,a){super(),this.context_=e,this.pixelRatio_=t,this.extent_=i,this.transform_=s,this.transformRotation_=s?Ca(Math.atan2(s[1],s[0]),10):0,this.viewRotation_=r,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=pi()}drawImages_(e,t,i,s){if(!this.image_)return;const r=es(e,t,i,s,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let c=0,u=r.length;c<u;c+=2){const d=r[c]-this.imageAnchorX_,f=r[c+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const g=d+this.imageAnchorX_,p=f+this.imageAnchorY_;Vi(a,g,p,1,1,h,-g,-p),o.save(),o.transform.apply(o,a),o.translate(g,p),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,f,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(e,t,i,s){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const r=es(e,t,i,s,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);t<i;t+=s){const l=r[t]+this.textOffsetX_,h=r[t+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(l-this.textOffsetX_,h-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,l,h),this.textFillState_&&o.fillText(this.text_,l,h))}}moveToLineTo_(e,t,i,s,r){const o=this.context_,a=es(e,t,i,s,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;r&&(l-=2);for(let h=2;h<l;h+=2)o.lineTo(a[h],a[h+1]);return r&&o.closePath(),i}drawRings_(e,t,i,s){for(let r=0,o=i.length;r<o;++r)t=this.moveToLineTo_(e,t,i[r],s,!0);return t}drawCircle(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!He(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=uw(e,this.transform_,this.pixelCoordinates_),i=t[2]-t[0],s=t[3]-t[1],r=Math.sqrt(i*i+s*s),o=this.context_;o.beginPath(),o.arc(t[0],t[1],r,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e);break}}drawFeature(e,t){const i=t.getGeometryFunction()(e);i&&(this.setStyle(t),this.drawGeometry(i))}drawGeometryCollection(e){const t=e.getGeometriesArray();for(let i=0,s=t.length;i<s;++i)this.drawGeometry(t[i])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!He(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(i,0,i.length,e.getStride(),!1),t.stroke()}if(this.text_!==""){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getExtent();if(He(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,s=e.getFlatCoordinates();let r=0;const o=e.getEnds(),a=e.getStride();i.beginPath();for(let l=0,h=o.length;l<h;++l)r=this.moveToLineTo_(s,r,o[l],a,!1);i.stroke()}if(this.text_!==""){const i=e.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!He(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!He(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getOrientedFlatCoordinates();let s=0;const r=e.getEndss(),o=e.getStride();t.beginPath();for(let a=0,l=r.length;a<l;++a){const h=r[a];s=this.drawRings_(i,s,h,o)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}}setContextFillState_(e){const t=this.context_,i=this.contextFillState_;i?i.fillStyle!=e.fillStyle&&(i.fillStyle=e.fillStyle,t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const t=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=e.lineCap&&(i.lineCap=e.lineCap,t.lineCap=e.lineCap),Pn(i.lineDash,e.lineDash)||t.setLineDash(i.lineDash=e.lineDash),i.lineDashOffset!=e.lineDashOffset&&(i.lineDashOffset=e.lineDashOffset,t.lineDashOffset=e.lineDashOffset),i.lineJoin!=e.lineJoin&&(i.lineJoin=e.lineJoin,t.lineJoin=e.lineJoin),i.lineWidth!=e.lineWidth&&(i.lineWidth=e.lineWidth,t.lineWidth=e.lineWidth),i.miterLimit!=e.miterLimit&&(i.miterLimit=e.miterLimit,t.miterLimit=e.miterLimit),i.strokeStyle!=e.strokeStyle&&(i.strokeStyle=e.strokeStyle,t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const t=this.context_,i=this.contextTextState_,s=e.textAlign?e.textAlign:Ho;i?(i.font!=e.font&&(i.font=e.font,t.font=e.font),i.textAlign!=s&&(i.textAlign=s,t.textAlign=s),i.textBaseline!=e.textBaseline&&(i.textBaseline=e.textBaseline,t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=s,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:s,textBaseline:e.textBaseline})}setFillStrokeStyle(e,t){if(!e)this.fillState_=null;else{const i=e.getColor();this.fillState_={fillStyle:rn(i||ti)}}if(!t)this.strokeState_=null;else{const i=t.getColor(),s=t.getLineCap(),r=t.getLineDash(),o=t.getLineDashOffset(),a=t.getLineJoin(),l=t.getWidth(),h=t.getMiterLimit(),c=r||Tn;this.strokeState_={lineCap:s!==void 0?s:ro,lineDash:this.pixelRatio_===1?c:c.map(u=>u*this.pixelRatio_),lineDashOffset:(o||Rn)*this.pixelRatio_,lineJoin:a!==void 0?a:oo,lineWidth:(l!==void 0?l:Xo)*this.pixelRatio_,miterLimit:h!==void 0?h:Vo,strokeStyle:rn(i||Wo)}}}setImageStyle(e){let t;if(!e||!(t=e.getSize())){this.image_=null;return}const i=e.getPixelRatio(this.pixelRatio_),s=e.getAnchor(),r=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*i,this.imageAnchorY_=s[1]*i,this.imageHeight_=t[1]*i,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const o=e.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/i,o[1]*this.pixelRatio_/i],this.imageWidth_=t[0]*i}setTextStyle(e){if(!e)this.text_="";else{const t=e.getFill();if(!t)this.textFillState_=null;else{const f=t.getColor();this.textFillState_={fillStyle:rn(f||ti)}}const i=e.getStroke();if(!i)this.textStrokeState_=null;else{const f=i.getColor(),g=i.getLineCap(),p=i.getLineDash(),m=i.getLineDashOffset(),v=i.getLineJoin(),y=i.getWidth(),x=i.getMiterLimit();this.textStrokeState_={lineCap:g!==void 0?g:ro,lineDash:p||Tn,lineDashOffset:m||Rn,lineJoin:v!==void 0?v:oo,lineWidth:y!==void 0?y:Xo,miterLimit:x!==void 0?x:Vo,strokeStyle:rn(f||Wo)}}const s=e.getFont(),r=e.getOffsetX(),o=e.getOffsetY(),a=e.getRotateWithView(),l=e.getRotation(),h=e.getScaleArray(),c=e.getText(),u=e.getTextAlign(),d=e.getTextBaseline();this.textState_={font:s!==void 0?s:d0,textAlign:u!==void 0?u:Ho,textBaseline:d!==void 0?d:Jl},this.text_=c!==void 0?Array.isArray(c)?c.reduce((f,g,p)=>f+=p%2?" ":g,""):c:"",this.textOffsetX_=r!==void 0?this.pixelRatio_*r:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const Of=DS,fi=.5;function K0(n,e,t,i,s,r,o){const a=n[0]*fi,l=n[1]*fi,h=St(a,l);h.imageSmoothingEnabled=!1;const c=h.canvas,u=new Of(h,fi,s,null,o),d=t.length,f=Math.floor((256*256*256-1)/d),g={};for(let m=1;m<=d;++m){const v=t[m-1],y=v.getStyleFunction()||i;if(!y)continue;let x=y(v,r);if(!x)continue;Array.isArray(x)||(x=[x]);const b=(m*f).toString(16).padStart(7,"#00000");for(let E=0,C=x.length;E<C;++E){const M=x[E],R=M.getGeometryFunction()(v);if(!R||!He(s,R.getExtent()))continue;const N=M.clone(),G=N.getFill();G&&G.setColor(b);const S=N.getStroke();S&&(S.setColor(b),S.setLineDash(null)),N.setText(void 0);const B=M.getImage();if(B){const z=B.getImageSize();if(!z)continue;const Q=St(z[0],z[1],void 0,{alpha:!1}),Te=Q.canvas;Q.fillStyle=b,Q.fillRect(0,0,Te.width,Te.height),N.setImage(new so({img:Te,anchor:B.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:B.getOrigin(),opacity:1,size:B.getSize(),scale:B.getScale(),rotation:B.getRotation(),rotateWithView:B.getRotateWithView()}))}const O=N.getZIndex()||0;let L=g[O];L||(L={},g[O]=L,L.Polygon=[],L.Circle=[],L.LineString=[],L.Point=[]);const P=R.getType();if(P==="GeometryCollection"){const z=R.getGeometriesArrayRecursive();for(let Q=0,Te=z.length;Q<Te;++Q){const I=z[Q];L[I.getType().replace("Multi","")].push(I,N)}}else L[P.replace("Multi","")].push(R,N)}}const p=Object.keys(g).map(Number).sort(rs);for(let m=0,v=p.length;m<v;++m){const y=g[p[m]];for(const x in y){const w=y[x];for(let b=0,E=w.length;b<E;b+=2){u.setStyle(w[b+1]);for(let C=0,M=e.length;C<M;++C)u.setTransform(e[C]),u.drawGeometry(w[b])}}}return h.getImageData(0,0,c.width,c.height)}function J0(n,e,t){const i=[];if(t){const s=Math.floor(Math.round(n[0])*fi),r=Math.floor(Math.round(n[1])*fi),o=(Je(s,0,t.width-1)+Je(r,0,t.height-1)*t.width)*4,a=t.data[o],l=t.data[o+1],c=t.data[o+2]+256*(l+256*a),u=Math.floor((256*256*256-1)/e.length);c&&c%u===0&&i.push(e[c/u-1])}return i}const GS=.5,Q0={Point:WS,LineString:$S,Polygon:XS,MultiPoint:HS,MultiLineString:qS,MultiPolygon:VS,GeometryCollection:jS,Circle:BS};function zS(n,e){return parseInt(H(n),10)-parseInt(H(e),10)}function kf(n,e){const t=Vu(n,e);return t*t}function Vu(n,e){return GS*n/e}function BS(n,e,t,i,s){const r=t.getFill(),o=t.getStroke();if(r||o){const l=n.getBuilder(t.getZIndex(),"Circle");l.setFillStrokeStyle(r,o),l.drawCircle(e,i)}const a=t.getText();if(a&&a.getText()){const l=(s||n).getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i)}}function ch(n,e,t,i,s,r,o){let a=!1;const l=t.getImage();if(l){const h=l.getImageState();h==re.LOADED||h==re.ERROR?l.unlistenImageChange(s):(h==re.IDLE&&l.load(),l.listenImageChange(s),a=!0)}return US(n,e,t,i,r,o),a}function US(n,e,t,i,s,r){const o=t.getGeometryFunction()(e);if(!o)return;const a=o.simplifyTransformed(i,s);if(t.getRenderer())e_(n,a,t,e);else{const h=Q0[a.getType()];h(n,a,t,e,r)}}function e_(n,e,t,i){if(e.getType()=="GeometryCollection"){const r=e.getGeometries();for(let o=0,a=r.length;o<a;++o)e_(n,r[o],t,i);return}n.getBuilder(t.getZIndex(),"Default").drawCustom(e,i,t.getRenderer(),t.getHitDetectionRenderer())}function jS(n,e,t,i,s){const r=e.getGeometriesArray();let o,a;for(o=0,a=r.length;o<a;++o){const l=Q0[r[o].getType()];l(n,r[o],t,i,s)}}function $S(n,e,t,i,s){const r=t.getStroke();if(r){const a=n.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawLineString(e,i)}const o=t.getText();if(o&&o.getText()){const a=(s||n).getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,i)}}function qS(n,e,t,i,s){const r=t.getStroke();if(r){const a=n.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawMultiLineString(e,i)}const o=t.getText();if(o&&o.getText()){const a=(s||n).getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,i)}}function VS(n,e,t,i,s){const r=t.getFill(),o=t.getStroke();if(o||r){const l=n.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawMultiPolygon(e,i)}const a=t.getText();if(a&&a.getText()){const l=(s||n).getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i)}}function WS(n,e,t,i,s){const r=t.getImage(),o=t.getText();let a;if(r){if(r.getImageState()!=re.LOADED)return;let l=n;if(s){const c=r.getDeclutterMode();if(c!=="none")if(l=s,c==="obstacle"){const u=n.getBuilder(t.getZIndex(),"Image");u.setImageStyle(r,a),u.drawPoint(e,i)}else o&&o.getText()&&(a={})}const h=l.getBuilder(t.getZIndex(),"Image");h.setImageStyle(r,a),h.drawPoint(e,i)}if(o&&o.getText()){let l=n;s&&(l=s);const h=l.getBuilder(t.getZIndex(),"Text");h.setTextStyle(o,a),h.drawText(e,i)}}function HS(n,e,t,i,s){const r=t.getImage(),o=t.getText();let a;if(r){if(r.getImageState()!=re.LOADED)return;let l=n;if(s){const c=r.getDeclutterMode();if(c!=="none")if(l=s,c==="obstacle"){const u=n.getBuilder(t.getZIndex(),"Image");u.setImageStyle(r,a),u.drawMultiPoint(e,i)}else o&&o.getText()&&(a={})}const h=l.getBuilder(t.getZIndex(),"Image");h.setImageStyle(r,a),h.drawMultiPoint(e,i)}if(o&&o.getText()){let l=n;s&&(l=s);const h=l.getBuilder(t.getZIndex(),"Text");h.setTextStyle(o,a),h.drawText(e,i)}}function XS(n,e,t,i,s){const r=t.getFill(),o=t.getStroke();if(r||o){const l=n.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawPolygon(e,i)}const a=t.getText();if(a&&a.getText()){const l=(s||n).getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i)}}class YS extends Ff{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Xt(),this.wrappedRenderedExtent_=Xt(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(e,t,i){const s=t.extent,r=t.viewState,o=r.center,a=r.resolution,l=r.projection,h=r.rotation,c=l.getExtent(),u=this.getLayer().getSource(),d=t.pixelRatio,f=t.viewHints,g=!(f[We.ANIMATING]||f[We.INTERACTING]),p=this.compositionContext_,m=Math.round(t.size[0]*d),v=Math.round(t.size[1]*d),y=u.getWrapX()&&l.canWrapX(),x=y?Me(c):null,w=y?Math.ceil((s[2]-c[2])/x)+1:1;let b=y?Math.floor((s[0]-c[0])/x):0;do{const E=this.getRenderTransform(o,a,h,d,m,v,b*x);e.execute(p,1,E,h,g,void 0,i)}while(++b<w)}setupCompositionContext_(){if(this.opacity_!==1){const e=St(this.context.canvas.width,this.context.canvas.height,Vp);this.compositionContext_=e}else this.compositionContext_=this.context}releaseCompositionContext_(){if(this.opacity_!==1){const e=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=e,Ma(this.compositionContext_),Vp.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(e){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,e,e.declutterTree),this.releaseCompositionContext_())}renderFrame(e,t){const i=e.pixelRatio,s=e.layerStatesArray[e.layerIndex];nw(this.pixelTransform,1/i,1/i),Zh(this.inversePixelTransform,this.pixelTransform);const r=qd(this.pixelTransform);this.useContainer(t,r,this.getBackground(e));const o=this.context,a=o.canvas,l=this.replayGroup_,h=this.declutterExecutorGroup;let c=l&&!l.isEmpty()||h&&!h.isEmpty();if(!c&&!(this.getLayer().hasListener(hn.PRERENDER)||this.getLayer().hasListener(hn.POSTRENDER)))return null;const u=Math.round(e.size[0]*i),d=Math.round(e.size[1]*i);a.width!=u||a.height!=d?(a.width=u,a.height=d,a.style.transform!==r&&(a.style.transform=r)):this.containerReused||o.clearRect(0,0,u,d),this.preRender(o,e);const f=e.viewState;f.projection,this.opacity_=s.opacity,this.setupCompositionContext_();let g=!1;if(c&&s.extent&&this.clipping){const p=sn(s.extent);c=He(p,e.extent),g=c&&!Li(p,e.extent),g&&this.clipUnrotated(this.compositionContext_,e,p)}return c&&this.renderWorlds(l,e),g&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(o,e),this.renderedRotation_!==f.rotation&&(this.renderedRotation_=f.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(e){return new Promise(t=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=[this.context.canvas.width,this.context.canvas.height];st(this.pixelTransform,i);const s=this.renderedCenter_,r=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),c=[],u=i[0]*fi,d=i[1]*fi;c.push(this.getRenderTransform(s,r,o,fi,u,d,0).slice());const f=h.getSource(),g=a.getExtent();if(f.getWrapX()&&a.canWrapX()&&!Li(g,l)){let p=l[0];const m=Me(g);let v=0,y;for(;p<g[0];)--v,y=m*v,c.push(this.getRenderTransform(s,r,o,fi,u,d,y).slice()),p+=m;for(v=0,p=l[2];p>g[2];)++v,y=m*v,c.push(this.getRenderTransform(s,r,o,fi,u,d,y).slice()),p-=m}this.hitDetectionImageData_=K0(i,c,this.renderedFeatures_,h.getStyleFunction(),l,r,o)}t(J0(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,i,s,r){if(!this.replayGroup_)return;const o=t.viewState.resolution,a=t.viewState.rotation,l=this.getLayer(),h={},c=function(f,g,p){const m=H(f),v=h[m];if(v){if(v!==!0&&p<v.distanceSq){if(p===0)return h[m]=!0,r.splice(r.lastIndexOf(v),1),s(f,l,g);v.geometry=g,v.distanceSq=p}}else{if(p===0)return h[m]=!0,s(f,l,g);r.push(h[m]={feature:f,layer:l,geometry:g,distanceSq:p,callback:s})}};let u;const d=[this.replayGroup_];return this.declutterExecutorGroup&&d.push(this.declutterExecutorGroup),d.some(f=>u=f.forEachFeatureAtCoordinate(e,o,a,i,c,f===this.declutterExecutorGroup&&t.declutterTree?t.declutterTree.all().map(g=>g.value):null)),u}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),i=t.getSource();if(!i)return!1;const s=e.viewHints[We.ANIMATING],r=e.viewHints[We.INTERACTING],o=t.getUpdateWhileAnimating(),a=t.getUpdateWhileInteracting();if(this.ready&&!o&&s||!a&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=e.extent,h=e.viewState,c=h.projection,u=h.resolution,d=e.pixelRatio,f=t.getRevision(),g=t.getRenderBuffer();let p=t.getRenderOrder();p===void 0&&(p=zS);const m=h.center.slice(),v=si(l,g*u),y=v.slice(),x=[v.slice()],w=c.getExtent();if(i.getWrapX()&&c.canWrapX()&&!Li(w,e.extent)){const L=Me(w),P=Math.max(Me(v)/2,L);v[0]=w[0]-P,v[2]=w[2]+P,Od(m,c);const z=Ey(x[0],c);z[0]<w[0]&&z[2]<w[2]?x.push([z[0]+L,z[1],z[2]+L,z[3]]):z[0]>w[0]&&z[2]>w[2]&&x.push([z[0]-L,z[1],z[2]-L,z[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==f&&this.renderedRenderOrder_==p&&Li(this.wrappedRenderedExtent_,v))return Pn(this.renderedExtent_,y)||(this.hitDetectionImageData_=null,this.renderedExtent_=y),this.renderedCenter_=m,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const b=new lh(Vu(u,d),v,u,d);let E;this.getLayer().getDeclutter()&&(E=new lh(Vu(u,d),v,u,d));let C;for(let L=0,P=x.length;L<P;++L)i.loadFeatures(x[L],u,c);const M=kf(u,d);let R=!0;const N=L=>{let P;const z=L.getStyleFunction()||t.getStyleFunction();if(z&&(P=z(L,u)),P){const Q=this.renderFeature(L,M,P,b,C,E);R=R&&!Q}},G=Hh(v),S=i.getFeaturesInExtent(G);p&&S.sort(p);for(let L=0,P=S.length;L<P;++L)N(S[L]);this.renderedFeatures_=S,this.ready=R;const B=b.finish(),O=new hh(v,u,d,i.getOverlaps(),B,t.getRenderBuffer());return E&&(this.declutterExecutorGroup=new hh(v,u,d,i.getOverlaps(),E.finish(),t.getRenderBuffer())),this.renderedResolution_=u,this.renderedRevision_=f,this.renderedRenderOrder_=p,this.renderedExtent_=y,this.wrappedRenderedExtent_=v,this.renderedCenter_=m,this.renderedProjection_=c,this.replayGroup_=O,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,i,s,r,o){if(!i)return!1;let a=!1;if(Array.isArray(i))for(let l=0,h=i.length;l<h;++l)a=ch(s,e,i[l],t,this.boundHandleStyleImageChange_,r,o)||a;else a=ch(s,e,i,t,this.boundHandleStyleImageChange_,r,o);return a}}const ZS=YS;class KS extends Af{constructor(e){super(e)}createRenderer(){return new ZS(this)}}const Is=KS,ll={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class hl extends _i{constructor(e,t){super(e),this.feature=t}}function JS(n,e){const t=[];for(let i=0;i<e.length;++i){const r=e[i].getGeometry();t_(n,r,t)}return t}function cl(n,e){return Mn(n[0],n[1],e[0],e[1])}function yr(n,e){const t=n.length;return e<0?n[e+t]:e>=t?n[e-t]:n[e]}function ul(n,e,t){let i,s;e<t?(i=e,s=t):(i=t,s=e);const r=Math.ceil(i),o=Math.floor(s);if(r>o){const l=_r(n,i),h=_r(n,s);return cl(l,h)}let a=0;if(i<r){const l=_r(n,i),h=yr(n,r);a+=cl(l,h)}if(o<s){const l=yr(n,o),h=_r(n,s);a+=cl(l,h)}for(let l=r;l<o-1;++l){const h=yr(n,l),c=yr(n,l+1);a+=cl(h,c)}return a}function t_(n,e,t){if(e instanceof $i){dl(n,e.getCoordinates(),!1,t);return}if(e instanceof Xs){const i=e.getCoordinates();for(let s=0,r=i.length;s<r;++s)dl(n,i[s],!1,t);return}if(e instanceof Wi){const i=e.getCoordinates();for(let s=0,r=i.length;s<r;++s)dl(n,i[s],!0,t);return}if(e instanceof Ys){const i=e.getCoordinates();for(let s=0,r=i.length;s<r;++s){const o=i[s];for(let a=0,l=o.length;a<l;++a)dl(n,o[a],!0,t)}return}if(e instanceof i0){const i=e.getGeometries();for(let s=0;s<i.length;++s)t_(n,i[s],t);return}}const Fc={index:-1,endIndex:NaN};function QS(n,e,t,i){const s=n[0],r=n[1];let o=1/0,a=-1,l=NaN;for(let u=0;u<e.targets.length;++u){const d=e.targets[u],f=d.coordinates;let g=1/0,p;for(let m=0;m<f.length-1;++m){const v=f[m],y=f[m+1],x=i_(s,r,v,y);x.squaredDistance<g&&(g=x.squaredDistance,p=m+x.along)}g<o&&(o=g,d.ring&&e.targetIndex===u&&(d.endIndex>d.startIndex?p<d.startIndex&&(p+=f.length):d.endIndex<d.startIndex&&p>d.startIndex&&(p-=f.length)),l=p,a=u)}const h=e.targets[a];let c=h.ring;if(e.targetIndex===a&&c){const u=_r(h.coordinates,l),d=t.getPixelFromCoordinate(u);Gl(d,e.startPx)>i&&(c=!1)}if(c){const u=h.coordinates,d=u.length,f=h.startIndex,g=l;if(f<g){const p=ul(u,f,g);ul(u,f,g-d)<p&&(l-=d)}else{const p=ul(u,f,g);ul(u,f,g+d)<p&&(l+=d)}}return Fc.index=a,Fc.endIndex=l,Fc}function dl(n,e,t,i){const s=n[0],r=n[1];for(let o=0,a=e.length-1;o<a;++o){const l=e[o],h=e[o+1],c=i_(s,r,l,h);if(c.squaredDistance===0){const u=o+c.along;i.push({coordinates:e,ring:t,startIndex:u,endIndex:u});return}}}const Oc={along:0,squaredDistance:0};function i_(n,e,t,i){const s=t[0],r=t[1],o=i[0],a=i[1],l=o-s,h=a-r;let c=0,u=s,d=r;return(l!==0||h!==0)&&(c=Je(((n-s)*l+(e-r)*h)/(l*l+h*h),0,1),u+=l*c,d+=h*c),Oc.along=c,Oc.squaredDistance=Ca(Mn(n,e,u,d),10),Oc}function _r(n,e){const t=n.length;let i=Math.floor(e);const s=e-i;i>=t?i-=t:i<0&&(i+=t);let r=i+1;r>=t&&(r-=t);const o=n[i],a=o[0],l=o[1],h=n[r],c=h[0]-a,u=h[1]-l;return[a+c*s,l+u*s]}class eT extends us{constructor(e){const t=e;t.stopDown||(t.stopDown=Vs),super(t),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=sT(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:Os,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let i=e.geometryFunction;if(!i){const s=this.mode_;if(s==="Circle")i=function(r,o,a){const l=o||new _0([NaN,NaN]),h=je(r[0]),c=ln(h,je(r[r.length-1]));return l.setCenterAndRadius(h,Math.sqrt(c),this.geometryLayout_),l};else{let r;s==="Point"?r=Ht:s==="LineString"?r=$i:s==="Polygon"&&(r=Wi),i=function(o,a,l){return a?s==="Polygon"?o[0].length?a.setCoordinates([o[0].concat([o[0][0]])],this.geometryLayout_):a.setCoordinates([],this.geometryLayout_):a.setCoordinates(o,this.geometryLayout_):a=new r(o,this.geometryLayout_),a}}}this.geometryFunction_=i,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new Is({source:new Ii({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:tT(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:Lf,this.freehandCondition_,e.freehand?this.freehandCondition_=nh:this.freehandCondition_=e.freehandCondition?e.freehandCondition:O0,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(ju.ACTIVE,this.updateState_)}setTrace(e){let t;e?e===!0?t=nh:t=e:t=oM,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(e){e.originalEvent.type===K.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===Ee.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&e.type===Ee.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===Ee.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),i=!1):this.freehand_&&e.type===Ee.POINTERDOWN?i=!1:t&&this.getPointerCount()<2?(i=e.type===Ee.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===Ee.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===Ee.DBLCLICK&&(i=!1),super.handleEvent(e)&&i}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new xn(Ee.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const t=this.getMap(),i=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),s=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),r=gt([i,s]),o=this.traceSource_.getFeaturesInExtent(r);if(o.length===0)return;const a=JS(e.coordinate,o);a.length&&(this.traceState_={active:!0,startPx:e.pixel.slice(),targets:a,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const i=e.startIndex<=e.endIndex,s=e.startIndex<=t;i===s?i&&t>e.endIndex||!i&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(i&&t<e.endIndex||!i&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let i=0;if(e<t){const s=Math.ceil(e);let r=Math.floor(t);r===t&&(r-=1),i=r-s+1}else{const s=Math.floor(e);let r=Math.ceil(t);r===t&&(r+=1),i=s-r+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(e,t,i){if(t===i)return;const s=[];if(t<i){const r=Math.ceil(t);let o=Math.floor(i);o===i&&(o-=1);for(let a=r;a<=o;++a)s.push(yr(e.coordinates,a))}else{const r=Math.floor(t);let o=Math.ceil(i);o===i&&(o+=1);for(let a=r;a>=o;--a)s.push(yr(e.coordinates,a))}s.length&&this.appendCoordinates(s)}updateTrace_(e){const t=this.traceState_;if(!t.active||t.targetIndex===-1&&Gl(t.startPx,e.pixel)<this.snapTolerance_)return;const i=QS(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==i.index){if(t.targetIndex!==-1){const l=t.targets[t.targetIndex];this.removeTracedCoordinates_(l.startIndex,l.endIndex)}const a=t.targets[i.index];this.addTracedCoordinates_(a,a.startIndex,i.endIndex)}else{const a=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(a,i.endIndex)}t.targetIndex=i.index;const s=t.targets[t.targetIndex];s.endIndex=i.endIndex;const r=_r(s.coordinates,s.endIndex),o=this.getMap().getPixelFromCoordinate(r);e.coordinate=r,e.pixel=[Math.round(o[0]),Math.round(o[1])]}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const i=this.traceState_.active;if(this.toggleTraceState_(e),this.shouldHandle_){const s=!this.finishCoordinate_;s&&this.startDrawing_(e.coordinate),!s&&this.freehand_?this.finishDrawing():!this.freehand_&&(!s||this.mode_==="Point")&&(this.atFinish_(e.pixel,i)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,i=e.pixel,s=t[0]-i[0],r=t[1]-i[1],o=s*s+r*r;if(this.shouldHandle_=this.freehand_?o>this.squaredClickTolerance_:o<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,t){let i=!1;if(this.sketchFeature_){let s=!1,r=[this.finishCoordinate_];const o=this.mode_;if(o==="Point")i=!0;else if(o==="Circle")i=this.sketchCoords_.length===2;else if(o==="LineString")s=!t&&this.sketchCoords_.length>this.minPoints_;else if(o==="Polygon"){const a=this.sketchCoords_;s=a[0].length>this.minPoints_,r=[a[0][0],a[0][a[0].length-2]],t?r=[a[0][0]]:r=[a[0][0],a[0][a[0].length-2]]}if(s){const a=this.getMap();for(let l=0,h=r.length;l<h;l++){const c=r[l],u=a.getPixelFromCoordinate(c),d=e[0]-u[0],f=e[1]-u[1],g=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(d*d+f*f)<=g,i){this.finishCoordinate_=c;break}}}}return i}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new tn(new Ht(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new tn);const t=e.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),i.changed()):(i=new $i(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(e){const t=this.getMap().getView().getProjection(),i=$l(this.geometryLayout_);for(;e.length<i;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new tn(new $i(this.sketchLineCoords_)));const s=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new tn,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(s),this.updateSketchFeatures_(),this.dispatchEvent(new hl(ll.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),i=this.sketchFeature_.getGeometry(),s=t.getView().getProjection(),r=$l(this.geometryLayout_);let o,a;for(;e.length<r;)e.push(0);this.mode_==="Point"?a=this.sketchCoords_:this.mode_==="Polygon"?(o=this.sketchCoords_[0],a=o[o.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(o=this.sketchCoords_,a=o[o.length-1]),a[0]=e[0],a[1]=e[1],this.geometryFunction_(this.sketchCoords_,i,s),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),i.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let s,r;const o=this.mode_;o==="LineString"||o==="Circle"?(this.finishCoordinate_=e.slice(),r=this.sketchCoords_,r.length>=this.maxPoints_&&(this.freehand_?r.pop():s=!0),r.push(e.slice()),this.geometryFunction_(r,t,i)):o==="Polygon"&&(r=this.sketchCoords_[0],r.length>=this.maxPoints_&&(this.freehand_?r.pop():s=!0),r.push(e.slice()),s&&(this.finishCoordinate_=r[0]),this.geometryFunction_(this.sketchCoords_,t,i)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),s&&this.finishDrawing()}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),s=this.mode_;for(let r=0;r<e;++r){let o;if(s==="LineString"||s==="Circle"){if(o=this.sketchCoords_,o.splice(-2,1),o.length>=2){this.finishCoordinate_=o[o.length-2].slice();const a=this.finishCoordinate_.slice();o[o.length-1]=a,this.createOrUpdateSketchPoint_(a)}this.geometryFunction_(o,t,i),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(s==="Polygon"){o=this.sketchCoords_[0],o.splice(-2,1);const a=this.sketchLine_.getGeometry();if(o.length>=2){const l=o[o.length-2].slice();o[o.length-1]=l,this.createOrUpdateSketchPoint_(l)}a.setCoordinates(o),this.geometryFunction_(this.sketchCoords_,t,i)}if(o.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return;let t=this.sketchCoords_;const i=e.getGeometry(),s=this.getMap().getView().getProjection();this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,i,s)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,i,s),t=i.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new go([t])):this.type_==="MultiLineString"?e.setGeometry(new Xs([t])):this.type_==="MultiPolygon"&&e.setGeometry(new Ys([t])),this.dispatchEvent(new hl(ll.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e)}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new hl(ll.DRAWABORT,e))}appendCoordinates(e){const t=this.mode_,i=!this.sketchFeature_;i&&this.startDrawing_(e[0]);let s;if(t==="LineString"||t==="Circle")s=this.sketchCoords_;else if(t==="Polygon")s=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;i&&s.shift(),s.pop();for(let o=0;o<e.length;o++)this.addToDrawing_(e[o]);const r=e[e.length-1];this.addToDrawing_(r),this.modifyDrawing_(r)}extend(e){const i=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=i.getCoordinates();const s=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=s.slice(),this.sketchCoords_.push(s.slice()),this.sketchPoint_=new tn(new Ht(s)),this.updateSketchFeatures_(),this.dispatchEvent(new hl(ll.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function tT(){const n=m0();return function(e,t){return n[e.getGeometry().getType()]}}function iT(n,e){return function(t,i,s){const r=je(t[0]),o=je(t[t.length-1]),a=Math.sqrt(ln(r,o));i=i||Qy(new _0(r),n);let l=e;if(!e&&e!==0){const h=o[0]-r[0],c=o[1]-r[1];l=Math.atan2(c,h)}return e0(i,r,a,l),i}}function nT(){return function(n,e,t){const i=gt([n[0],n[n.length-1]].map(function(r){return je(r)})),s=[[eo(i),wa(i),ba(i),fn(i),eo(i)]];return e?e.setCoordinates(s):e=new Wi(s),e}}function sT(n){switch(n){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+n)}}const rT=eT,Xp=0,Oo=1,Yp=[0,0,0,0],Pr=[],kc={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class Nc extends _i{constructor(e,t,i){super(e),this.features=t,this.mapBrowserEvent=i}}class oT extends us{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:N0,this.defaultDeleteCondition_=function(i){return nM(i)&&aM(i)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:nh,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new sh,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Is({source:new Ii({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:lT(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new Vt(this.source_.getFeatures()),this.source_.addEventListener(Bt.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(Bt.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(wt.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(wt.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const s=this.SEGMENT_WRITERS_[t.getType()];s&&s(e,t)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,i),e.addEventListener(K.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new Vt;const i=this.featuresBeingModified_.getArray();for(let s=0,r=t.length;s<r;++s){const o=t[s];for(let a=0,l=o.length;a<l;++a){const h=o[a].feature;h&&!i.includes(h)&&this.featuresBeingModified_.push(h)}}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new Nc(kc.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(K.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,i=[];t.forEach(function(s){e===s.feature&&i.push(s)});for(let s=i.length-1;s>=0;--s){const r=i[s];for(let o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===r&&this.dragSegments_.splice(o,1);t.remove(r)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const i=t.getCoordinates(),s={feature:e,geometry:t,segment:[i,i]};this.rBush_.insert(t.getExtent(),s)}writeMultiPointGeometry_(e,t){const i=t.getCoordinates();for(let s=0,r=i.length;s<r;++s){const o=i[s],a={feature:e,geometry:t,depth:[s],index:s,segment:[o,o]};this.rBush_.insert(t.getExtent(),a)}}writeLineStringGeometry_(e,t){const i=t.getCoordinates();for(let s=0,r=i.length-1;s<r;++s){const o=i.slice(s,s+2),a={feature:e,geometry:t,index:s,segment:o};this.rBush_.insert(gt(o),a)}}writeMultiLineStringGeometry_(e,t){const i=t.getCoordinates();for(let s=0,r=i.length;s<r;++s){const o=i[s];for(let a=0,l=o.length-1;a<l;++a){const h=o.slice(a,a+2),c={feature:e,geometry:t,depth:[s],index:a,segment:h};this.rBush_.insert(gt(h),c)}}}writePolygonGeometry_(e,t){const i=t.getCoordinates();for(let s=0,r=i.length;s<r;++s){const o=i[s];for(let a=0,l=o.length-1;a<l;++a){const h=o.slice(a,a+2),c={feature:e,geometry:t,depth:[s],index:a,segment:h};this.rBush_.insert(gt(h),c)}}}writeMultiPolygonGeometry_(e,t){const i=t.getCoordinates();for(let s=0,r=i.length;s<r;++s){const o=i[s];for(let a=0,l=o.length;a<l;++a){const h=o[a];for(let c=0,u=h.length-1;c<u;++c){const d=h.slice(c,c+2),f={feature:e,geometry:t,depth:[a,s],index:c,segment:d};this.rBush_.insert(gt(d),f)}}}}writeCircleGeometry_(e,t){const i=t.getCenter(),s={feature:e,geometry:t,index:Xp,segment:[i,i]},r={feature:e,geometry:t,index:Oo,segment:[i,i]},o=[s,r];s.featureSegments=o,r.featureSegments=o,this.rBush_.insert(Rr(i),s);let a=t;this.rBush_.insert(a.getExtent(),r)}writeGeometryCollectionGeometry_(e,t){const i=t.getGeometriesArray();for(let s=0;s<i.length;++s){const r=i[s],o=this.SEGMENT_WRITERS_[r.getType()];o(e,r)}}createOrUpdateVertexFeature_(e,t,i){let s=this.vertexFeature_;return s?s.getGeometry().setCoordinates(e):(s=new tn(new Ht(e)),this.vertexFeature_=s,this.overlay_.getSource().addFeature(s)),s.set("features",t),s.set("geometries",i),s}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==Ee.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=Ee.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==Ee.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_);const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],i=[],s=[];for(let r=0,o=this.dragSegments_.length;r<o;++r){const a=this.dragSegments_[r],l=a[0],h=l.feature;i.includes(h)||i.push(h);const c=l.geometry;s.includes(c)||s.push(c);const u=l.depth;let d;const f=l.segment,g=a[1];for(;t.length<c.getStride();)t.push(f[g][t.length]);switch(c.getType()){case"Point":d=t,f[0]=t,f[1]=t;break;case"MultiPoint":d=c.getCoordinates(),d[l.index]=t,f[0]=t,f[1]=t;break;case"LineString":d=c.getCoordinates(),d[l.index+g]=t,f[g]=t;break;case"MultiLineString":d=c.getCoordinates(),d[u[0]][l.index+g]=t,f[g]=t;break;case"Polygon":d=c.getCoordinates(),d[u[0]][l.index+g]=t,f[g]=t;break;case"MultiPolygon":d=c.getCoordinates(),d[u[1]][u[0]][l.index+g]=t,f[g]=t;break;case"Circle":if(f[0]=t,f[1]=t,l.index===Xp)this.changingFeature_=!0,c.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let p=Gl(je(c.getCenter()),je(t));c.setRadius(p),this.changingFeature_=!1}break}d&&this.setGeometryCoordinates_(c,d)}this.createOrUpdateVertexFeature_(t,i,s)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate;this.handlePointerAtPixel_(e.pixel,e.map,t),this.dragSegments_.length=0,this.featuresBeingModified_=null;const i=this.vertexFeature_;if(i){e.map.getView().getProjection();const s=[],r=i.getGeometry().getCoordinates(),o=gt([r]),a=this.rBush_.getInExtent(o),l={};a.sort(aT);for(let h=0,c=a.length;h<c;++h){const u=a[h],d=u.segment;let f=H(u.geometry);const g=u.depth;if(g&&(f+="-"+g.join("-")),l[f]||(l[f]=new Array(2)),u.geometry.getType()==="Circle"&&u.index===Oo){const p=Kp(t,u);zi(p,r)&&!l[f][0]&&(this.dragSegments_.push([u,0]),l[f][0]=u);continue}if(zi(d[0],r)&&!l[f][0]){this.dragSegments_.push([u,0]),l[f][0]=u;continue}if(zi(d[1],r)&&!l[f][1]){if(l[f][0]&&l[f][0].index===0){let p=u.geometry.getCoordinates();switch(u.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":p=p[g[1]];case"Polygon":if(u.index!==p[g[0]].length-2)continue;break}}this.dragSegments_.push([u,1]),l[f][1]=u;continue}H(d)in this.vertexSegments_&&!l[f][0]&&!l[f][1]&&this.insertVertexCondition_(e)&&s.push(u)}s.length&&this.willModifyFeatures_(e,[s]);for(let h=s.length-1;h>=0;--h)this.insertVertex_(s[h],r)}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const i=this.dragSegments_[t][0],s=i.geometry;if(s.getType()==="Circle"){const r=s.getCenter(),o=i.featureSegments[0],a=i.featureSegments[1];o.segment[0]=r,o.segment[1]=r,a.segment[0]=r,a.segment[1]=r,this.rBush_.update(Rr(r),o);let l=s;this.rBush_.update(l.getExtent(),a)}else this.rBush_.update(gt(i.segment),i)}return this.featuresBeingModified_&&(this.dispatchEvent(new Nc(kc.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map,e.coordinate)}handlePointerAtPixel_(e,t,i){const s=i||t.getCoordinateFromPixel(e);t.getView().getProjection();const r=function(l,h){return Zp(s,l)-Zp(s,h)};let o,a;if(this.hitDetection_){const l=typeof this.hitDetection_=="object"?h=>h===this.hitDetection_:void 0;t.forEachFeatureAtPixel(e,(h,c,u)=>{u&&(u=new Ht(Gs(u.getCoordinates())));const d=u||h.getGeometry();if(d.getType()==="Point"&&h instanceof tn&&this.features_.getArray().includes(h)){a=d;const f=h.getGeometry().getFlatCoordinates().slice(0,2);o=[{feature:h,geometry:a,segment:[f,f]}]}return!0},{layerFilter:l})}if(!o){const l=sn(Rr(s,Yp)),h=t.getView().getResolution()*this.pixelTolerance_,c=Hh(si(l,h,Yp));o=this.rBush_.getInExtent(c)}if(o&&o.length>0){const l=o.sort(r)[0],h=l.segment;let c=Kp(s,l);const u=t.getPixelFromCoordinate(c);let d=Gl(e,u);if(a||d<=this.pixelTolerance_){const f={};if(f[H(h)]=!0,this.snapToPointer_||(this.delta_[0]=c[0]-s[0],this.delta_[1]=c[1]-s[1]),l.geometry.getType()==="Circle"&&l.index===Oo)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(c,[l.feature],[l.geometry]);else{const g=t.getPixelFromCoordinate(h[0]),p=t.getPixelFromCoordinate(h[1]),m=ln(u,g),v=ln(u,p);d=Math.sqrt(Math.min(m,v)),this.snappedToVertex_=d<=this.pixelTolerance_,this.snappedToVertex_&&(c=m>v?h[1]:h[0]),this.createOrUpdateVertexFeature_(c,[l.feature],[l.geometry]);const y={};y[H(l.geometry)]=!0;for(let x=1,w=o.length;x<w;++x){const b=o[x].segment;if(zi(h[0],b[0])&&zi(h[1],b[1])||zi(h[0],b[1])&&zi(h[1],b[0])){const E=H(o[x].geometry);E in y||(y[E]=!0,f[H(b)]=!0)}else break}}this.vertexSegments_=f;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const i=e.segment,s=e.feature,r=e.geometry,o=e.depth,a=e.index;let l;for(;t.length<r.getStride();)t.push(0);switch(r.getType()){case"MultiLineString":l=r.getCoordinates(),l[o[0]].splice(a+1,0,t);break;case"Polygon":l=r.getCoordinates(),l[o[0]].splice(a+1,0,t);break;case"MultiPolygon":l=r.getCoordinates(),l[o[1]][o[0]].splice(a+1,0,t);break;case"LineString":l=r.getCoordinates(),l.splice(a+1,0,t);break;default:return}this.setGeometryCoordinates_(r,l);const h=this.rBush_;h.remove(e),this.updateSegmentIndices_(r,a,o,1);const c={segment:[i[0],t],feature:s,geometry:r,depth:o,index:a};h.insert(gt(c.segment),c),this.dragSegments_.push([c,1]);const u={segment:[t,i[1]],feature:s,geometry:r,depth:o,index:a+1};h.insert(gt(u.segment),u),this.dragSegments_.push([u,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=Ee.POINTERDRAG){const e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_);const t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Nc(kc.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){const e=this.dragSegments_,t={};let i=!1,s,r,o,a,l,h,c,u,d,f,g;for(l=e.length-1;l>=0;--l)o=e[l],f=o[0],g=H(f.feature),f.depth&&(g+="-"+f.depth.join("-")),g in t||(t[g]={}),o[1]===0?(t[g].right=f,t[g].index=f.index):o[1]==1&&(t[g].left=f,t[g].index=f.index+1);for(g in t){switch(d=t[g].right,c=t[g].left,h=t[g].index,u=h-1,c!==void 0?f=c:f=d,u<0&&(u=0),a=f.geometry,r=a.getCoordinates(),s=r,i=!1,a.getType()){case"MultiLineString":r[f.depth[0]].length>2&&(r[f.depth[0]].splice(h,1),i=!0);break;case"LineString":r.length>2&&(r.splice(h,1),i=!0);break;case"MultiPolygon":s=s[f.depth[1]];case"Polygon":s=s[f.depth[0]],s.length>4&&(h==s.length-1&&(h=0),s.splice(h,1),i=!0,h===0&&(s.pop(),s.push(s[0]),u=s.length-1));break}if(i){this.setGeometryCoordinates_(a,r);const p=[];if(c!==void 0&&(this.rBush_.remove(c),p.push(c.segment[0])),d!==void 0&&(this.rBush_.remove(d),p.push(d.segment[1])),c!==void 0&&d!==void 0){const m={depth:f.depth,feature:f.feature,geometry:f.geometry,index:u,segment:p};this.rBush_.insert(gt(m.segment),m)}this.updateSegmentIndices_(a,h,f.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return i}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,i,s){this.rBush_.forEachInExtent(e.getExtent(),function(r){r.geometry===e&&(i===void 0||r.depth===void 0||Pn(r.depth,i))&&r.index>t&&(r.index+=s)})}}function aT(n,e){return n.index-e.index}function Zp(n,e,t){const i=e.geometry;if(i.getType()==="Circle"){let r=i;if(e.index===Oo){const o=ln(r.getCenter(),je(n)),a=Math.sqrt(o)-r.getRadius();return a*a}}const s=je(n);return Pr[0]=je(e.segment[0]),Pr[1]=je(e.segment[1]),L1(s,Pr)}function Kp(n,e,t){const i=e.geometry;if(i.getType()==="Circle"&&e.index===Oo)return Gs(i.getClosestPoint(je(n)));const s=je(n);return Pr[0]=je(e.segment[0]),Pr[1]=je(e.segment[1]),Gs(Ad(s,Pr))}function lT(){const n=m0();return function(e,t){return n.Point}}const hT=oT,cT={SNAP:"snap"};class uT extends _i{constructor(e,t){super(e),this.vertex=t.vertex,this.vertexPixel=t.vertexPixel,this.feature=t.feature}}function Jp(n){return n.feature?n.feature:n.element?n.element:null}const Dc=[];class dT extends us{constructor(e){e=e||{};const t=e;t.handleDownEvent||(t.handleDownEvent=Os),t.stopDown||(t.stopDown=Vs),super(t),this.on,this.once,this.un,this.source_=e.source?e.source:null,this.vertex_=e.vertex!==void 0?e.vertex:!0,this.edge_=e.edge!==void 0?e.edge:!0,this.features_=e.features?e.features:null,this.featuresListenerKeys_=[],this.featureChangeListenerKeys_={},this.indexedFeaturesExtents_={},this.pendingFeatures_={},this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.rBush_=new sh,this.GEOMETRY_SEGMENTERS_={Point:this.segmentPointGeometry_.bind(this),LineString:this.segmentLineStringGeometry_.bind(this),LinearRing:this.segmentLineStringGeometry_.bind(this),Polygon:this.segmentPolygonGeometry_.bind(this),MultiPoint:this.segmentMultiPointGeometry_.bind(this),MultiLineString:this.segmentMultiLineStringGeometry_.bind(this),MultiPolygon:this.segmentMultiPolygonGeometry_.bind(this),GeometryCollection:this.segmentGeometryCollectionGeometry_.bind(this),Circle:this.segmentCircleGeometry_.bind(this)}}addFeature(e,t){t=t!==void 0?t:!0;const i=H(e),s=e.getGeometry();if(s){const r=this.GEOMETRY_SEGMENTERS_[s.getType()];if(r){this.indexedFeaturesExtents_[i]=s.getExtent(Xt());const o=[];if(r(o,s),o.length===1)this.rBush_.insert(gt(o[0]),{feature:e,segment:o[0]});else if(o.length>1){const a=o.map(h=>gt(h)),l=o.map(h=>({feature:e,segment:h}));this.rBush_.load(a,l)}}}t&&(this.featureChangeListenerKeys_[i]=pe(e,K.CHANGE,this.handleFeatureChange_,this))}getFeatures_(){let e;return this.features_?e=this.features_:this.source_&&(e=this.source_.getFeatures()),e}handleEvent(e){const t=this.snapTo(e.pixel,e.coordinate,e.map);return t&&(e.coordinate=t.vertex.slice(0,2),e.pixel=t.vertexPixel,this.dispatchEvent(new uT(cT.SNAP,{vertex:e.coordinate,vertexPixel:e.pixel,feature:t.feature}))),super.handleEvent(e)}handleFeatureAdd_(e){const t=Jp(e);t&&this.addFeature(t)}handleFeatureRemove_(e){const t=Jp(e);t&&this.removeFeature(t)}handleFeatureChange_(e){const t=e.target;if(this.handlingDownUpSequence){const i=H(t);i in this.pendingFeatures_||(this.pendingFeatures_[i]=t)}else this.updateFeature_(t)}handleUpEvent(e){const t=Object.values(this.pendingFeatures_);return t.length&&(t.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1}removeFeature(e,t){const i=t!==void 0?t:!0,s=H(e),r=this.indexedFeaturesExtents_[s];if(r){const o=this.rBush_,a=[];o.forEachInExtent(r,function(l){e===l.feature&&a.push(l)});for(let l=a.length-1;l>=0;--l)o.remove(a[l])}i&&(De(this.featureChangeListenerKeys_[s]),delete this.featureChangeListenerKeys_[s])}setMap(e){const t=this.getMap(),i=this.featuresListenerKeys_,s=this.getFeatures_();t&&(i.forEach(De),i.length=0,this.rBush_.clear(),Object.values(this.featureChangeListenerKeys_).forEach(De),this.featureChangeListenerKeys_={}),super.setMap(e),e&&(this.features_?i.push(pe(this.features_,wt.ADD,this.handleFeatureAdd_,this),pe(this.features_,wt.REMOVE,this.handleFeatureRemove_,this)):this.source_&&i.push(pe(this.source_,Bt.ADDFEATURE,this.handleFeatureAdd_,this),pe(this.source_,Bt.REMOVEFEATURE,this.handleFeatureRemove_,this)),s.forEach(r=>this.addFeature(r)))}snapTo(e,t,i){i.getView().getProjection();const s=je(t),r=Hh(si(gt([s]),i.getView().getResolution()*this.pixelTolerance_)),o=this.rBush_.getInExtent(r),a=o.length;if(a===0)return null;let l,h=1/0,c;const u=this.pixelTolerance_*this.pixelTolerance_,d=()=>{if(l){const f=i.getPixelFromCoordinate(l);if(ln(e,f)<=u)return{vertex:l,vertexPixel:[Math.round(f[0]),Math.round(f[1])],feature:c}}return null};if(this.vertex_){for(let g=0;g<a;++g){const p=o[g];p.feature.getGeometry().getType()!=="Circle"&&p.segment.forEach(m=>{const v=je(m),y=ln(s,v);y<h&&(l=m,h=y,c=p.feature)})}const f=d();if(f)return f}if(this.edge_){for(let g=0;g<a;++g){let p=null;const m=o[g];if(m.feature.getGeometry().getType()==="Circle"){let v=m.feature.getGeometry();p=R1(s,v)}else{const[v,y]=m.segment;y&&(Dc[0]=je(v),Dc[1]=je(y),p=Ad(s,Dc))}if(p){const v=ln(s,p);v<h&&(l=Gs(p),h=v)}}const f=d();if(f)return f}return null}updateFeature_(e){this.removeFeature(e,!1),this.addFeature(e,!1)}segmentCircleGeometry_(e,t){this.getMap().getView().getProjection();const r=Qy(t).getCoordinates()[0];for(let o=0,a=r.length-1;o<a;++o)e.push(r.slice(o,o+2))}segmentGeometryCollectionGeometry_(e,t){const i=t.getGeometriesArray();for(let s=0;s<i.length;++s){const r=this.GEOMETRY_SEGMENTERS_[i[s].getType()];r&&r(e,i[s])}}segmentLineStringGeometry_(e,t){const i=t.getCoordinates();for(let s=0,r=i.length-1;s<r;++s)e.push(i.slice(s,s+2))}segmentMultiLineStringGeometry_(e,t){const i=t.getCoordinates();for(let s=0,r=i.length;s<r;++s){const o=i[s];for(let a=0,l=o.length-1;a<l;++a)e.push(o.slice(a,a+2))}}segmentMultiPointGeometry_(e,t){t.getCoordinates().forEach(i=>{e.push([i])})}segmentMultiPolygonGeometry_(e,t){const i=t.getCoordinates();for(let s=0,r=i.length;s<r;++s){const o=i[s];for(let a=0,l=o.length;a<l;++a){const h=o[a];for(let c=0,u=h.length-1;c<u;++c)e.push(h.slice(c,c+2))}}}segmentPointGeometry_(e,t){e.push([t.getCoordinates()])}segmentPolygonGeometry_(e,t){const i=t.getCoordinates();for(let s=0,r=i.length;s<r;++s){const o=i[s];for(let a=0,l=o.length-1;a<l;++a)e.push(o.slice(a,a+2))}}}const fT=dT;function gT(n,e){const t=n.canvas;e=e||{};const i=e.pixelRatio||Cd,s=e.size;s&&(t.width=s[0]*i,t.height=s[1]*i,t.style.width=s[0]+"px",t.style.height=s[1]+"px");const r=[0,0,t.width,t.height],o=Sl(pi(),i,i);return new Of(n,i,r,o,0)}function pT(n){if(!(n.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const e=n.inversePixelTransform[0],t=n.inversePixelTransform[1],i=Math.sqrt(e*e+t*t),s=n.frameState,r=Xh(n.inversePixelTransform.slice(),s.coordinateToPixelTransform),o=kf(s.viewState.resolution,i);let a;return new Of(n.context,i,s.extent,r,s.viewState.rotation,o,a)}function Gn(n,e){return st(n.inversePixelTransform,e.slice(0))}let fl,n_;function Wu(){if(fl===void 0){const n=document.createElement("canvas");n.setAttribute("style","image-rendering: -moz-crisp-edges; image-rendering: pixelated;");const e=n.style.imageRendering;fl=!!e,fl&&(n_=e)}return fl}function mT(){return Wu(),n_||""}function Tl(n){return n.get("olcs.projection")||n.getProjection()}function vr(n,e,t){return n.on(e,t)}let yT=0;function pt(n){return n.olcs_uid||(n.olcs_uid=++yT)}function _T(n,e){const t=n.length,i=Array(n.length);for(let s=0;s<t;s++)i[s]={index:s,value:n[s]};i.sort((s,r)=>e(s.value,r.value)||s.index-r.index);for(let s=0;s<n.length;s++)n[s]=i[s].value}function vT(n){return n&&n.parentNode?n.parentNode.removeChild(n):null}function xT(n){for(;n.lastChild;)n.removeChild(n.lastChild)}function Gc(n){const e=Cesium.GroundPolylinePrimitive;return e&&e.isSupported(n)}function zc(n){const e=n.readyPromise;return e||(n.ready!==void 0?n.ready?Promise.resolve(n):new Promise((t,i)=>{const s=setInterval(()=>{n.ready&&(clearInterval(s),t(n))},20)}):Promise.reject("Not a readyable object"))}const Kn={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class wT extends Zs{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getPreload(){return this.get(Kn.PRELOAD)}setPreload(e){this.set(Kn.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(Kn.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(Kn.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}const bT=wT;class ET extends va{constructor(e,t,i){super(),i=i||{},this.tileCoord=e,this.state=t,this.interimTile=null,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(K.CHANGE)}release(){this.state===U.ERROR&&this.setState(U.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let e=this.interimTile;do{if(e.getState()==U.LOADED)return this.transition_=0,e;e=e.interimTile}while(e);return this}refreshInterimChain(){if(!this.interimTile)return;let e=this.interimTile,t=this;do{if(e.getState()==U.LOADED){e.interimTile=null;break}else e.getState()==U.LOADING?t=e:e.getState()==U.IDLE?t.interimTile=e.interimTile:t=e;e=t.interimTile}while(e)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==U.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}load(){ie()}getAlpha(e,t){if(!this.transition_)return 1;let i=this.transitionStarts_[e];if(!i)i=t,this.transitionStarts_[e]=i;else if(i===-1)return 1;const s=t-i+1e3/60;return s>=this.transition_?1:I0(s/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}}const rc=ET;class CT extends rc{constructor(e,t,i,s,r,o){super(e,t,o),this.crossOrigin_=s,this.src_=i,this.key=i,this.image_=new Image,s!==null&&(this.image_.crossOrigin=s),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(e){this.image_=e,this.state=U.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=U.ERROR,this.unlistenImage_(),this.image_=MT(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=U.LOADED:this.state=U.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==U.ERROR&&(this.state=U.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==U.IDLE&&(this.state=U.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=h1(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function MT(){const n=St(1,1);return n.fillStyle="rgba(0,0,0,0)",n.fillRect(0,0,1,1),n.canvas}const s_=CT;class ST extends rc{constructor(e,t,i,s,r,o,a,l,h,c,u,d){super(r,U.IDLE,{interpolate:!!d}),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=s,this.wrappedTileCoord_=o||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const f=s.getTileCoordExtent(this.wrappedTileCoord_),g=this.targetTileGrid_.getExtent();let p=this.sourceTileGrid_.getExtent();const m=g?Cn(f,g):f;if(wu(m)===0){this.state=U.EMPTY;return}const v=e.getExtent();v&&(p?p=Cn(p,v):p=v);const y=s.getResolution(this.wrappedTileCoord_[0]),x=j1(e,i,m,y);if(!isFinite(x)||x<=0){this.state=U.EMPTY;return}const w=c!==void 0?c:_y;if(this.triangulation_=new Oy(e,i,m,p,x*w,y),this.triangulation_.getTriangles().length===0){this.state=U.EMPTY;return}this.sourceZ_=t.getZForResolution(x);let b=this.triangulation_.calculateSourceExtent();if(p&&(e.canWrapX()?(b[1]=Je(b[1],p[1],p[3]),b[3]=Je(b[3],p[1],p[3])):b=Cn(b,p)),!wu(b))this.state=U.EMPTY;else{const E=t.getTileRangeForExtentAndZ(b,this.sourceZ_);for(let C=E.minX;C<=E.maxX;C++)for(let M=E.minY;M<=E.maxY;M++){const R=h(this.sourceZ_,C,M,a);R&&this.sourceTiles_.push(R)}this.sourceTiles_.length===0&&(this.state=U.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{t&&t.getState()==U.LOADED&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}),this.sourceTiles_.length=0,e.length===0)this.state=U.ERROR;else{const t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),s=typeof i=="number"?i:i[0],r=typeof i=="number"?i:i[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Ny(s,r,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=U.LOADED}this.changed()}load(){if(this.state==U.IDLE){this.state=U.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const i=t.getState();if(i==U.IDLE||i==U.LOADING){e++;const s=pe(t,K.CHANGE,function(r){const o=t.getState();(o==U.LOADED||o==U.ERROR||o==U.EMPTY)&&(De(s),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(s)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t,i,s){t.getState()==U.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(De),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Ma(this.canvas_.getContext("2d")),Ir.push(this.canvas_),this.canvas_=null),super.release()}}const Hu=ST;class r_{constructor(e,t,i,s){this.minX=e,this.maxX=t,this.minY=i,this.maxY=s}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function nr(n,e,t,i,s){return s!==void 0?(s.minX=n,s.maxX=e,s.minY=t,s.maxY=i,s):new r_(n,e,t,i)}const o_=r_;class TT extends Ff{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=Xt(),this.tmpTileRange_=new o_(0,0,0,0)}isDrawableTile(e){const t=this.getLayer(),i=e.getState(),s=t.getUseInterimTilesOnError();return i==U.LOADED||i==U.EMPTY||i==U.ERROR&&!s}getTile(e,t,i,s){const r=s.pixelRatio,o=s.viewState.projection,a=this.getLayer();let h=a.getSource().getTile(e,t,i,r,o);return h.getState()==U.ERROR&&a.getUseInterimTilesOnError()&&a.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(h)||(h=h.getInterimTile()),h}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),s=st(t.pixelToCoordinateTransform,e.slice()),r=i.getExtent();if(r&&!xa(r,s))return null;const o=t.pixelRatio,a=t.viewState.projection,l=t.viewState,h=i.getRenderSource(),c=h.getTileGridForProjection(l.projection),u=h.getTilePixelRatio(t.pixelRatio);for(let d=c.getZForResolution(l.resolution);d>=c.getMinZoom();--d){const f=c.getTileCoordForCoordAndZ(s,d),g=h.getTile(d,f[1],f[2],o,a);if(!(g instanceof s_||g instanceof Hu)||g instanceof Hu&&g.getState()===U.EMPTY)return null;if(g.getState()!==U.LOADED)continue;const p=c.getOrigin(d),m=qt(c.getTileSize(d)),v=c.getResolution(d),y=Math.floor(u*((s[0]-p[0])/v-f[1]*m[0])),x=Math.floor(u*((p[1]-s[1])/v-f[2]*m[1])),w=Math.round(u*h.getGutterForProjection(l.projection));return this.getImageData(g.getImage(),y+w,x+w)}return null}loadedTileCallback(e,t,i){return this.isDrawableTile(i)?super.loadedTileCallback(e,t,i):!1}prepareFrame(e){return!!this.getLayer().getSource()}renderFrame(e,t){const i=e.layerStatesArray[e.layerIndex],s=e.viewState,r=s.projection,o=s.resolution,a=s.center,l=s.rotation,h=e.pixelRatio,c=this.getLayer(),u=c.getSource(),d=u.getRevision(),f=u.getTileGridForProjection(r),g=f.getZForResolution(o,u.zDirection),p=f.getResolution(g);let m=e.extent;const v=e.viewState.resolution,y=u.getTilePixelRatio(h),x=Math.round(Me(m)/v*h),w=Math.round(yt(m)/v*h),b=i.extent&&sn(i.extent);b&&(m=Cn(m,sn(i.extent)));const E=p*x/2/y,C=p*w/2/y,M=[a[0]-E,a[1]-C,a[0]+E,a[1]+C],R=f.getTileRangeForExtentAndZ(m,g),N={};N[g]={};const G=this.createLoadedTileFinder(u,r,N),S=this.tmpExtent,B=this.tmpTileRange_;this.newTiles_=!1;const O=l?bu(s.center,v,l,e.size):void 0;for(let nt=R.minX;nt<=R.maxX;++nt)for(let Re=R.minY;Re<=R.maxY;++Re){if(l&&!f.tileCoordIntersectsViewport([g,nt,Re],O))continue;const me=this.getTile(g,nt,Re,e);if(this.isDrawableTile(me)){const Ue=H(this);if(me.getState()==U.LOADED){N[g][me.tileCoord.toString()]=me;let dt=me.inTransition(Ue);dt&&i.opacity!==1&&(me.endTransition(Ue),dt=!1),!this.newTiles_&&(dt||!this.renderedTiles.includes(me))&&(this.newTiles_=!0)}if(me.getAlpha(Ue,e.time)===1)continue}const _t=f.getTileCoordChildTileRange(me.tileCoord,B,S);let Dt=!1;_t&&(Dt=G(g+1,_t)),Dt||f.forEachTileCoordParentTileRange(me.tileCoord,G,B,S)}const L=p/o*h/y;Vi(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/h,1/h,l,-x/2,-w/2);const P=qd(this.pixelTransform);this.useContainer(t,P,this.getBackground(e));const z=this.context,Q=z.canvas;Zh(this.inversePixelTransform,this.pixelTransform),Vi(this.tempTransform,x/2,w/2,L,L,0,-x/2,-w/2),Q.width!=x||Q.height!=w?(Q.width=x,Q.height=w):this.containerReused||z.clearRect(0,0,x,w),b&&this.clipUnrotated(z,e,b),u.getInterpolate()||(z.imageSmoothingEnabled=!1),this.preRender(z,e),this.renderedTiles.length=0;let Te=Object.keys(N).map(Number);Te.sort(rs);let I,it,A;i.opacity===1&&(!this.containerReused||u.getOpaque(e.viewState.projection))?Te=Te.reverse():(I=[],it=[]);for(let nt=Te.length-1;nt>=0;--nt){const Re=Te[nt],me=u.getTilePixelSize(Re,h,r),Dt=f.getResolution(Re)/p,Ue=me[0]*Dt*L,dt=me[1]*Dt*L,$=f.getTileCoordForCoordAndZ(fn(M),Re),Ai=f.getTileCoordExtent($),Fi=st(this.tempTransform,[y*(Ai[0]-M[0])/p,y*(M[3]-Ai[3])/p]),ze=y*u.getGutterForProjection(r),Oi=N[Re];for(const ki in Oi){const Ve=Oi[ki],On=Ve.tileCoord,Qe=$[1]-On[1],Yi=Math.round(Fi[0]-(Qe-1)*Ue),vi=$[2]-On[2],xi=Math.round(Fi[1]-(vi-1)*dt),at=Math.round(Fi[0]-Qe*Ue),Tt=Math.round(Fi[1]-vi*dt),be=Yi-at,Le=xi-Tt,Ie=g===Re,Ae=Ie&&Ve.getAlpha(H(this),e.time)!==1;let ye=!1;if(!Ae)if(I){A=[at,Tt,at+be,Tt,at+be,Tt+Le,at,Tt+Le];for(let we=0,lt=I.length;we<lt;++we)if(g!==Re&&Re<it[we]){const _e=I[we];He([at,Tt,at+be,Tt+Le],[_e[0],_e[3],_e[4],_e[7]])&&(ye||(z.save(),ye=!0),z.beginPath(),z.moveTo(A[0],A[1]),z.lineTo(A[2],A[3]),z.lineTo(A[4],A[5]),z.lineTo(A[6],A[7]),z.moveTo(_e[6],_e[7]),z.lineTo(_e[4],_e[5]),z.lineTo(_e[2],_e[3]),z.lineTo(_e[0],_e[1]),z.clip())}I.push(A),it.push(Re)}else z.clearRect(at,Tt,be,Le);this.drawTileImage(Ve,e,at,Tt,be,Le,ze,Ie),I&&!Ae?(ye&&z.restore(),this.renderedTiles.unshift(Ve)):this.renderedTiles.push(Ve),this.updateUsedTiles(e.usedTiles,u,Ve)}}return this.renderedRevision=d,this.renderedResolution=p,this.extentChanged=!this.renderedExtent_||!Ns(this.renderedExtent_,M),this.renderedExtent_=M,this.renderedPixelRatio=h,this.renderedProjection=r,this.manageTilePyramid(e,u,f,h,r,m,g,c.getPreload()),this.scheduleExpireCache(e,u),this.postRender(z,e),i.extent&&z.restore(),z.imageSmoothingEnabled=!0,P!==Q.style.transform&&(Q.style.transform=P),this.container}drawTileImage(e,t,i,s,r,o,a,l){const h=this.getTileImage(e);if(!h)return;const c=H(this),u=t.layerStatesArray[t.layerIndex],d=u.opacity*(l?e.getAlpha(c,t.time):1),f=d!==this.context.globalAlpha;f&&(this.context.save(),this.context.globalAlpha=d),this.context.drawImage(h,a,a,h.width-2*a,h.height-2*a,i,s,r,o),f&&this.context.restore(),d!==u.opacity?t.animate=!0:l&&e.endTransition(c)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,t){if(t.canExpireCache()){const i=(function(s,r,o){const a=H(s);a in o.usedTiles&&s.expireCache(o.viewState.projection,o.usedTiles[a])}).bind(null,t);e.postRenderFunctions.push(i)}}updateUsedTiles(e,t,i){const s=H(t);s in e||(e[s]={}),e[s][i.getKey()]=!0}manageTilePyramid(e,t,i,s,r,o,a,l,h){const c=H(t);c in e.wantedTiles||(e.wantedTiles[c]={});const u=e.wantedTiles[c],d=e.tileQueue,f=i.getMinZoom(),g=e.viewState.rotation,p=g?bu(e.viewState.center,e.viewState.resolution,g,e.size):void 0;let m=0,v,y,x,w,b,E;for(E=f;E<=a;++E)for(y=i.getTileRangeForExtentAndZ(o,E,y),x=i.getResolution(E),w=y.minX;w<=y.maxX;++w)for(b=y.minY;b<=y.maxY;++b)g&&!i.tileCoordIntersectsViewport([E,w,b],p)||(a-E<=l?(++m,v=t.getTile(E,w,b,s,r),v.getState()==U.IDLE&&(u[v.getKey()]=!0,d.isKeyQueued(v.getKey())||d.enqueue([v,c,i.getTileCoordCenter(v.tileCoord),x])),h!==void 0&&h(v)):t.useTile(E,w,b,r));t.updateCacheSize(m,r)}}const a_=TT;class RT extends bT{constructor(e){super(e)}createRenderer(){return new a_(this)}}const Nf=RT;class LT extends Zs{constructor(e){e=e||{},super(e)}}const IT=LT;class PT extends Ff{constructor(e){super(e),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],i=e.pixelRatio,s=e.viewState,r=s.resolution,o=this.getLayer().getSource(),a=e.viewHints;let l=e.extent;if(t.extent!==void 0&&(l=Cn(l,sn(t.extent,s.projection))),!a[We.ANIMATING]&&!a[We.INTERACTING]&&!Hs(l))if(o){const h=s.projection,c=o.getImage(l,r,i,h);c&&(this.loadImage(c)?this.image_=c:c.getState()===re.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),s=st(t.pixelToCoordinateTransform,e.slice()),r=i.getExtent();if(r&&!xa(r,s))return null;const o=this.image_.getExtent(),a=this.image_.getImage(),l=Me(o),h=Math.floor(a.width*((s[0]-o[0])/l));if(h<0||h>=a.width)return null;const c=yt(o),u=Math.floor(a.height*((o[3]-s[1])/c));return u<0||u>=a.height?null:this.getImageData(a,h,u)}renderFrame(e,t){const i=this.image_,s=i.getExtent(),r=i.getResolution(),[o,a]=Array.isArray(r)?r:[r,r],l=i.getPixelRatio(),h=e.layerStatesArray[e.layerIndex],c=e.pixelRatio,u=e.viewState,d=u.center,f=u.resolution,g=c*o/(f*l),p=c*a/(f*l),m=e.extent,v=u.resolution,y=u.rotation,x=Math.round(Me(m)/v*c),w=Math.round(yt(m)/v*c);Vi(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/c,1/c,y,-x/2,-w/2),Zh(this.inversePixelTransform,this.pixelTransform);const b=qd(this.pixelTransform);this.useContainer(t,b,this.getBackground(e));const E=this.context,C=E.canvas;C.width!=x||C.height!=w?(C.width=x,C.height=w):this.containerReused||E.clearRect(0,0,x,w);let M=!1,R=!0;if(h.extent){const O=sn(h.extent,u.projection);R=He(O,e.extent),M=R&&!Li(O,e.extent),M&&this.clipUnrotated(E,e,O)}const N=i.getImage(),G=Vi(this.tempTransform,x/2,w/2,g,p,0,l*(s[0]-d[0])/o,l*(d[1]-s[3])/a);this.renderedResolution=a*c/l;const S=N.width*G[0],B=N.height*G[3];if(this.getLayer().getSource().getInterpolate()||(E.imageSmoothingEnabled=!1),this.preRender(E,e),R&&S>=.5&&B>=.5){const O=G[4],L=G[5],P=h.opacity;let z;P!==1&&(z=E.globalAlpha,E.globalAlpha=P),E.drawImage(N,0,0,+N.width,+N.height,O,L,S,B),P!==1&&(E.globalAlpha=z)}return this.postRender(E,e),M&&E.restore(),E.imageSmoothingEnabled=!0,b!==C.style.transform&&(C.style.transform=b),this.container}}const AT=PT;class FT extends IT{constructor(e){super(e)}createRenderer(){return new AT(this)}getData(e){return super.getData(e)}}const Rl=FT;function OT(n){const e=n.load||qh,t=n.imageExtent,i=new Image;return n.crossOrigin!==null&&(i.crossOrigin=n.crossOrigin),()=>e(i,n.url).then(s=>{const r=Me(t)/s.width,o=yt(t)/s.height;return{image:s,extent:t,resolution:r!==o?[r,o]:o,pixelRatio:1}})}class kT extends Gy{constructor(e){const t=e.crossOrigin!==void 0?e.crossOrigin:null,i=e.imageLoadFunction!==void 0?e.imageLoadFunction:zd;super({attributions:e.attributions,interpolate:e.interpolate,projection:X(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image=null,this.image=new Td(this.imageExtent_,void 0,1,OT({url:e.url,imageExtent:e.imageExtent,crossOrigin:t,load:(s,r)=>(this.image.setImage(s),i(this.image,r),qh(s))})),this.image.addEventListener(K.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e,t,i,s){return He(e,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}const NT=kT;class DT{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const i=this.entries_[e];return fe(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){const t=this.entries_[e];return fe(t!==void 0,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.key_;return e}getValues(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){if(this.containsKey(e))return this.entries_[e].value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){fe(!(e in this.entries_),"Tried to set a value for a key that is used already");const i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}}const Xu=DT;function Qp(n,e,t,i){return i!==void 0?(i[0]=n,i[1]=e,i[2]=t,i):[n,e,t]}function _o(n,e,t){return n+"/"+e+"/"+t}function l_(n){return _o(n[0],n[1],n[2])}function GT(n){const[e,t,i]=n.substring(n.lastIndexOf("/")+1,n.length).split(",").map(Number);return _o(e,t,i)}function h_(n){return n.split("/").map(Number)}function c_(n){return(n[1]<<n[0])+n[2]}function zT(n,e){const t=n[0],i=n[1],s=n[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const r=e.getFullTileRange(t);return r?r.containsXY(i,s):!0}class BT extends Xu{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(e){for(;this.canExpireCache()&&!(this.peekLast().getKey()in e);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const e=this.peekFirstKey(),i=h_(e)[0];this.forEach(s=>{s.tileCoord[0]!==i&&(this.remove(l_(s.tileCoord)),s.release())})}}const Df=BT,Bc={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},sr=[0,0,0],zn=5;class UT{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,fe(t1(this.resolutions_,function(s,r){return r-s},!0),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let s=0,r=this.resolutions_.length-1;s<r;++s)if(!t)t=this.resolutions_[s]/this.resolutions_[s+1];else if(this.resolutions_[s]/this.resolutions_[s+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,fe(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=e.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=fn(i)),fe(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,fe(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:xf,fe(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map(function(s,r){const o=new o_(Math.min(0,s[0]),Math.max(s[0]-1,-1),Math.min(0,s[1]),Math.max(s[1]-1,-1));if(i){const a=this.getTileRangeForExtentAndZ(i,r);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o},this):i&&this.calculateTileRanges_(i)}forEachTileCoord(e,t,i){const s=this.getTileRangeForExtentAndZ(e,t);for(let r=s.minX,o=s.maxX;r<=o;++r)for(let a=s.minY,l=s.maxY;a<=l;++a)i([t,r,a])}forEachTileCoordParentTileRange(e,t,i,s){let r,o,a,l=null,h=e[0]-1;for(this.zoomFactor_===2?(o=e[1],a=e[2]):l=this.getTileCoordExtent(e,s);h>=this.minZoom;){if(this.zoomFactor_===2?(o=Math.floor(o/2),a=Math.floor(a/2),r=nr(o,o,a,a,i)):r=this.getTileRangeForExtentAndZ(l,h,i),t(h,r))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,i){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const r=e[1]*2,o=e[2]*2;return nr(r,r+1,o,o+1,t)}const s=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;const s=e[0],r=e[1],o=e[2];if(t===s)return nr(r,o,r,o,i);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,t-s),h=Math.floor(r*l),c=Math.floor(o*l);if(t<s)return nr(h,h,c,c,i);const u=Math.floor(l*(r+1))-1,d=Math.floor(l*(o+1))-1;return nr(h,u,c,d,i)}const a=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,t,i)}getTileRangeForExtentAndZ(e,t,i){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,sr);const s=sr[1],r=sr[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,sr);const o=sr[1],a=sr[2];return nr(s,o,r,a,i)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),i=this.getResolution(e[0]),s=qt(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*s[0]*i,t[1]-(e[2]+.5)*s[1]*i]}getTileCoordExtent(e,t){const i=this.getOrigin(e[0]),s=this.getResolution(e[0]),r=qt(this.getTileSize(e[0]),this.tmpSize_),o=i[0]+e[1]*r[0]*s,a=i[1]-(e[2]+1)*r[1]*s,l=o+r[0]*s,h=a+r[1]*s;return Pi(o,a,l,h,t)}getTileCoordForCoordAndResolution(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)}getTileCoordForXYAndResolution_(e,t,i,s,r){const o=this.getZForResolution(i),a=i/this.getResolution(o),l=this.getOrigin(o),h=qt(this.getTileSize(o),this.tmpSize_);let c=a*(e-l[0])/i/h[0],u=a*(l[1]-t)/i/h[1];return s?(c=qn(c,zn)-1,u=qn(u,zn)-1):(c=gr(c,zn),u=gr(u,zn)),Qp(o,c,u,r)}getTileCoordForXYAndZ_(e,t,i,s,r){const o=this.getOrigin(i),a=this.getResolution(i),l=qt(this.getTileSize(i),this.tmpSize_);let h=(e-o[0])/a/l[0],c=(o[1]-t)/a/l[1];return s?(h=qn(h,zn)-1,c=qn(c,zn)-1):(h=gr(h,zn),c=gr(c,zn)),Qp(i,h,c,r)}getTileCoordForCoordAndZ(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const i=$h(this.resolutions_,e,t||0);return Je(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return Vy(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,i=new Array(t);for(let s=this.minZoom;s<t;++s)i[s]=this.getTileRangeForExtentAndZ(e,s);this.fullTileRanges_=i}}const Fa=UT;function Gf(n){let e=n.getDefaultTileGrid();return e||(e=qT(n),n.setDefaultTileGrid(e)),e}function jT(n,e,t){const i=e[0],s=n.getTileCoordCenter(e),r=Oa(t);if(!xa(r,s)){const o=Me(r),a=Math.ceil((r[0]-s[0])/o);return s[0]+=o*a,n.getTileCoordForCoordAndZ(s,i)}return e}function $T(n,e,t,i){i=i!==void 0?i:"top-left";const s=u_(n,e,t);return new Fa({extent:n,origin:f1(n,i),resolutions:s,tileSize:t})}function oc(n){const e=n||{},t=e.extent||X("EPSG:3857").getExtent(),i={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:u_(t,e.maxZoom,e.tileSize,e.maxResolution)};return new Fa(i)}function u_(n,e,t,i){e=e!==void 0?e:L0,t=qt(t!==void 0?t:xf);const s=yt(n),r=Me(n);i=i>0?i:Math.max(r/t[0],s/t[1]);const o=e+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=i/Math.pow(2,l);return a}function qT(n,e,t,i){const s=Oa(n);return $T(s,e,t,i)}function Oa(n){n=X(n);let e=n.getExtent();if(!e){const t=180*Ds.degrees/n.getMetersPerUnit();e=Pi(-t,-t,t,t)}return e}class VT extends Gd{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.opaque_=e.opaque!==void 0?e.opaque:!1,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&qt(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tileCache=new Df(e.cacheSize||0),this.tmpSize=[0,0],this.key_=e.key||"",this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(e,t){const i=this.getTileCacheForProjection(e);i&&i.expireCache(t)}forEachLoadedTile(e,t,i,s){const r=this.getTileCacheForProjection(e);if(!r)return!1;let o=!0,a,l,h;for(let c=i.minX;c<=i.maxX;++c)for(let u=i.minY;u<=i.maxY;++u)l=_o(t,c,u),h=!1,r.containsKey(l)&&(a=r.get(l),h=a.getState()===U.LOADED,h&&(h=s(a)!==!1)),h||(o=!1);return o}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getOpaque(e){return this.opaque_}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,i,s,r){return ie()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:Gf(e)}getTileCacheForProjection(e){const t=this.getProjection();return fe(t===null||ui(t,e),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){const s=this.getTileGridForProjection(i),r=this.getTilePixelRatio(t),o=qt(s.getTileSize(e),this.tmpSize);return r==1?o:tb(o,r,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){t=t!==void 0?t:this.getProjection();const i=this.getTileGridForProjection(t);return this.getWrapX()&&t.isGlobal()&&(e=jT(i,e,t)),zT(e,i)?e:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(e,t){const i=this.getTileCacheForProjection(t);e>i.highWaterMark&&(i.highWaterMark=e)}useTile(e,t,i,s){}}class WT extends _i{constructor(e,t){super(e),this.tile=t}}const d_=VT;function HT(n,e){const t=/\{z\}/g,i=/\{x\}/g,s=/\{y\}/g,r=/\{-y\}/g;return function(o,a,l){if(o)return n.replace(t,o[0].toString()).replace(i,o[1].toString()).replace(s,o[2].toString()).replace(r,function(){const h=o[0],c=e.getFullTileRange(h);return fe(c,"The {-y} placeholder requires a tile grid with extent"),(c.getHeight()-o[2]-1).toString()})}}function zf(n,e){const t=n.length,i=new Array(t);for(let s=0;s<t;++s)i[s]=HT(n[s],e);return Yu(i)}function Yu(n){return n.length===1?n[0]:function(e,t,i){if(!e)return;const s=c_(e),r=Jn(s,n.length);return n[r](e,t,i)}}function Bf(n){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(n);if(t){const i=t[1].charCodeAt(0),s=t[2].charCodeAt(0);let r;for(r=i;r<=s;++r)e.push(n.replace(t[0],String.fromCharCode(r)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(n),t){const i=parseInt(t[2],10);for(let s=parseInt(t[1],10);s<=i;s++)e.push(n.replace(t[0],s.toString()));return e}return e.push(n),e}class Uf extends d_{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Uf.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,i=H(t),s=t.getState();let r;s==U.LOADING?(this.tileLoadingKeys_[i]=!0,r=Bc.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],r=s==U.ERROR?Bc.TILELOADERROR:s==U.LOADED?Bc.TILELOADEND:void 0),r!=null&&this.dispatchEvent(new WT(r,t))}setTileLoadFunction(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=Bf(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(zf(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,i){}useTile(e,t,i){const s=_o(e,t,i);this.tileCache.containsKey(s)&&this.tileCache.get(s)}}const f_=Uf;class XT extends f_{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:YT,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:s_,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1}expireCache(e,t){const i=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==i?t:{});for(const s in this.tileCacheForProjection){const r=this.tileCacheForProjection[s];r.expireCache(r==i?t:{})}}getGutterForProjection(e){return this.getProjection()&&e&&!ui(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getOpaque(e){return this.getProjection()&&e&&!ui(this.getProjection(),e)?!1:super.getOpaque(e)}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||ui(t,e)))return this.tileGrid;const i=H(e);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=Gf(e)),this.tileGridForProjection[i]}getTileCacheForProjection(e){const t=this.getProjection();if(!t||ui(t,e))return this.tileCache;const i=H(e);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new Df(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}createTile_(e,t,i,s,r,o){const a=[e,t,i],l=this.getTileCoordForTileUrlFunction(a,r),h=l?this.tileUrlFunction(l,s,r):void 0,c=new this.tileClass(a,h!==void 0?U.IDLE:U.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(K.CHANGE,this.handleTileChange.bind(this)),c}getTile(e,t,i,s,r){const o=this.getProjection();if(!o||!r||ui(o,r))return this.getTileInternal(e,t,i,s,o||r);const a=this.getTileCacheForProjection(r),l=[e,t,i];let h;const c=l_(l);a.containsKey(c)&&(h=a.get(c));const u=this.getKey();if(h&&h.key==u)return h;const d=this.getTileGridForProjection(o),f=this.getTileGridForProjection(r),g=this.getTileCoordForTileUrlFunction(l,r),p=new Hu(o,d,r,f,l,g,this.getTilePixelRatio(s),this.getGutter(),(m,v,y,x)=>this.getTileInternal(m,v,y,x,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return p.key=u,h?(p.interimTile=h,p.refreshInterimChain(),a.replace(c,p)):a.set(c,p),p}getTileInternal(e,t,i,s,r){let o=null;const a=_o(e,t,i),l=this.getKey();if(!this.tileCache.containsKey(a))o=this.createTile_(e,t,i,s,r,l),this.tileCache.set(a,o);else if(o=this.tileCache.get(a),o.key!=l){const h=o;o=this.createTile_(e,t,i,s,r,l),h.getState()==U.IDLE?o.interimTile=h.interimTile:o.interimTile=h,o.refreshInterimChain(),this.tileCache.replace(a,o)}return o}setRenderReprojectionEdges(e){if(this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(e,t){const i=X(e);if(i){const s=H(i);s in this.tileGridForProjection||(this.tileGridForProjection[s]=t)}}clear(){super.clear();for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear()}}function YT(n,e){n.getImage().src=e}const ka=XT;class ZT extends ka{constructor(e){e=e||{};const t=Object.assign({},e.params),i="TRANSPARENT"in t?t.TRANSPARENT:!0;super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:!i,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.params_=t,this.v13_=!0,this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=Xt(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(e,t,i,s){const r=X(i),o=this.getProjection()||r;let a=this.getTileGrid();a||(a=this.getTileGridForProjection(o));const l=Qn(e,r,o),h=jo(o,r,e,t),c=a.getZForResolution(h,this.zDirection),u=a.getResolution(c),d=a.getTileCoordForCoordAndZ(l,c);if(a.getResolutions().length<=d[0])return;let f=a.getTileCoordExtent(d,this.tmpExtent_);const g=this.gutter_;g!==0&&(f=si(f,u*g,f));const p={QUERY_LAYERS:this.params_.LAYERS};Object.assign(p,jl(this.params_,"GetFeatureInfo"),s);const m=Math.floor((l[0]-f[0])/u),v=Math.floor((f[3]-l[1])/u);return p[this.v13_?"I":"X"]=m,p[this.v13_?"J":"Y"]=v,this.getRequestUrl_(d,f,1,o||r,p)}getLegendUrl(e,t){if(this.urls[0]===void 0)return;const i={SERVICE:"WMS",VERSION:Ul,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(t===void 0||t.LAYER===void 0){const s=this.params_.LAYERS;if(!(!Array.isArray(s)||s.length===1))return;i.LAYER=s}if(e!==void 0){const s=this.getProjection()?this.getProjection().getMetersPerUnit():1,r=28e-5;i.SCALE=e*s/r}return Object.assign(i,t),$o(this.urls[0],i)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(e,t,i,s,r){const o=this.urls;if(!o)return;let a;if(o.length==1)a=o[0];else{const l=Jn(c_(e),o.length);a=o[l]}return By(t,(this.tileGrid||this.getTileGridForProjection(s)).getResolution(e[0]),i,s,a,r,this.serverType_)}getTilePixelRatio(e){return!this.hidpi_||this.serverType_===void 0?1:e}getKeyForParams_(){let e=0;const t=[];for(const i in this.params_)t[e++]=i+"-"+this.params_[i];return t.join("/")}updateParams(e){Object.assign(this.params_,e),this.updateV13_(),this.setKey(this.getKeyForParams_())}updateV13_(){const e=this.params_.VERSION||Ul;this.v13_=Pd(e,"1.3")>=0}tileUrlFunction(e,t,i){let s=this.getTileGrid();if(s||(s=this.getTileGridForProjection(i)),s.getResolutions().length<=e[0])return;t!=1&&(!this.hidpi_||this.serverType_===void 0)&&(t=1);const r=s.getResolution(e[0]);let o=s.getTileCoordExtent(e,this.tmpExtent_);const a=this.gutter_;a!==0&&(o=si(o,r*a,o));const l=Object.assign({},jl(this.params_,"GetMap"));return this.getRequestUrl_(e,o,t,i,l)}}const KT=ZT;let JT=class extends rc{constructor(e,t,i,s,r,o){super(e,t,o),this.extent=null,this.format_=s,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=r,this.url_=i,this.key=i}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==U.IDLE&&(this.setState(U.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(e,t){this.setFeatures(e)}onError(){this.setState(U.ERROR)}setFeatures(e){this.features_=e,this.setState(U.LOADED)}setLoader(e){this.loader_=e}};const g_=JT,em=[];class QT extends rc{constructor(e,t,i,s){super(e,t,{transition:0}),this.context_={},this.executorGroups={},this.declutterExecutorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=s.bind(void 0,this),this.wrappedTileCoord=i}getContext(e){const t=H(e);return t in this.context_||(this.context_[t]=St(1,1,em)),this.context_[t]}hasContext(e){return H(e)in this.context_}getImage(e){return this.hasContext(e)?this.getContext(e).canvas:null}getReplayState(e){const t=H(e);return t in this.replayState_||(this.replayState_[t]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[t]}load(){this.getSourceTiles()}release(){for(const e in this.context_){const t=this.context_[e];Ma(t),em.push(t.canvas),delete this.context_[e]}super.release()}}const eR=QT;class tR extends f_{constructor(e){const t=e.projection||"EPSG:3857",i=e.extent||Oa(t),s=e.tileGrid||oc({extent:i,maxResolution:e.maxResolution,maxZoom:e.maxZoom!==void 0?e.maxZoom:22,minZoom:e.minZoom,tileSize:e.tileSize||512});super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,interpolate:!0,opaque:!1,projection:t,state:e.state,tileGrid:s,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:m_,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX===void 0?!0:e.wrapX,transition:e.transition,zDirection:e.zDirection===void 0?1:e.zDirection}),this.format_=e.format?e.format:null,this.sourceTileCache=new Df(this.tileCache.highWaterMark),this.overlaps_=e.overlaps==null?!0:e.overlaps,this.tileClass=e.tileClass?e.tileClass:g_,this.tileGrids_={}}getFeaturesInExtent(e){const t=[],i=this.tileCache;if(i.getCount()===0)return t;const s=h_(i.peekFirstKey())[0],r=this.tileGrid;return i.forEach(function(o){if(o.tileCoord[0]!==s||o.getState()!==U.LOADED)return;const a=o.getSourceTiles();for(let l=0,h=a.length;l<h;++l){const c=a[l],u=c.tileCoord;if(He(e,r.getTileCoordExtent(u))){const d=c.getFeatures();if(d)for(let f=0,g=d.length;f<g;++f){const p=d[f],m=p.getGeometry();He(e,m.getExtent())&&t.push(p)}}}}),t}getOverlaps(){return this.overlaps_}clear(){this.tileCache.clear(),this.sourceTileCache.clear()}expireCache(e,t){const i=this.getTileCacheForProjection(e),s=Object.keys(t).reduce((r,o)=>{const a=GT(o),l=i.peek(a);if(l){const h=l.sourceTiles;for(let c=0,u=h.length;c<u;++c)r[h[c].getKey()]=!0}return r},{});super.expireCache(e,t),this.sourceTileCache.expireCache(s)}getSourceTiles(e,t,i){if(i.getState()===U.IDLE){i.setState(U.LOADING);const s=i.wrappedTileCoord,r=this.getTileGridForProjection(t),o=r.getTileCoordExtent(s),a=s[0],l=r.getResolution(a);si(o,-l,o);const h=this.tileGrid,c=h.getExtent();c&&Cn(o,c,o);const u=h.getZForResolution(l,this.zDirection);h.forEachTileCoord(o,u,d=>{const f=this.tileUrlFunction(d,e,t),g=this.sourceTileCache.containsKey(f)?this.sourceTileCache.get(f):new this.tileClass(d,f?U.IDLE:U.EMPTY,f,this.format_,this.tileLoadFunction);i.sourceTiles.push(g);const p=g.getState();if(p<U.LOADED){const m=v=>{this.handleTileChange(v);const y=g.getState();if(y===U.LOADED||y===U.ERROR){const x=g.getKey();x in i.errorTileKeys?g.getState()===U.LOADED&&delete i.errorTileKeys[x]:i.loadingSourceTiles--,y===U.ERROR?i.errorTileKeys[x]=!0:g.removeEventListener(K.CHANGE,m),i.loadingSourceTiles===0&&i.setState(ks(i.errorTileKeys)?U.LOADED:U.ERROR)}};g.addEventListener(K.CHANGE,m),i.loadingSourceTiles++}p===U.IDLE&&(g.extent=h.getTileCoordExtent(d),g.projection=t,g.resolution=h.getResolution(d[0]),this.sourceTileCache.set(f,g),g.load())}),i.loadingSourceTiles||i.setState(i.sourceTiles.some(d=>d.getState()===U.ERROR)?U.ERROR:U.LOADED)}return i.sourceTiles}getTile(e,t,i,s,r){const o=_o(e,t,i),a=this.getKey();let l;if(this.tileCache.containsKey(o)&&(l=this.tileCache.get(o),l.key===a))return l;const h=[e,t,i];let c=this.getTileCoordForTileUrlFunction(h,r);const u=this.getTileGrid().getExtent(),d=this.getTileGridForProjection(r);if(c&&u){const p=d.getTileCoordExtent(c);si(p,-d.getResolution(e),p),He(u,p)||(c=null)}let f=!0;if(c!==null){const p=this.tileGrid,m=d.getResolution(e),v=p.getZForResolution(m,1),y=d.getTileCoordExtent(c);si(y,-m,y),p.forEachTileCoord(y,v,x=>{f=f&&!this.tileUrlFunction(x,s,r)})}const g=new eR(h,f?U.EMPTY:U.IDLE,c,this.getSourceTiles.bind(this,s,r));return g.key=a,l?(g.interimTile=l,g.refreshInterimChain(),this.tileCache.replace(o,g)):this.tileCache.set(o,g),g}getTileGridForProjection(e){const t=e.getCode();let i=this.tileGrids_[t];if(!i){const s=this.tileGrid,r=s.getResolutions().slice(),o=r.map(function(h,c){return s.getOrigin(c)}),a=r.map(function(h,c){return s.getTileSize(c)}),l=L0+1;for(let h=r.length;h<l;++h)r.push(r[h-1]/2),o.push(o[h-1]),a.push(a[h-1]);i=new Fa({extent:s.getExtent(),origins:o,resolutions:r,tileSizes:a}),this.tileGrids_[t]=i}return i}getTilePixelRatio(e){return e}getTilePixelSize(e,t,i){const s=this.getTileGridForProjection(i),r=qt(s.getTileSize(e),this.tmpSize);return[Math.round(r[0]*t),Math.round(r[1]*t)]}updateCacheSize(e,t){super.updateCacheSize(e*2,t),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(t).highWaterMark}}const p_=tR;function m_(n,e){n.setLoader(function(t,i,s){B0(e,n.getFormat(),t,i,s,n.onLoad.bind(n),n.onError.bind(n))})}class iR extends ka{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",i=e.tileGrid!==void 0?e.tileGrid:oc({extent:Oa(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:e.opaque,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}const nR=iR;class sR extends Ii{constructor(e){super({attributions:e.attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=e.distance!==void 0?e.distance:20,this.minDistance=e.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=e.geometryFunction||function(t){const i=t.getGeometry();return fe(!i||i.getType()==="Point","The default `geometryFunction` can only handle `Point` or null geometries"),i},this.createCustomCluster_=e.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(e.source||null)}clear(e){this.features.length=0,super.clear(e)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(e,t,i){this.source.loadFeatures(e,t,i),t!==this.resolution&&(this.resolution=t,this.refresh())}setDistance(e){this.updateDistance(e,this.minDistance)}setMinDistance(e){this.updateDistance(this.distance,e)}getMinDistance(){return this.minDistance}setSource(e){this.source&&this.source.removeEventListener(K.CHANGE,this.boundRefresh_),this.source=e,e&&e.addEventListener(K.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(e,t){const i=e===0?0:Math.min(t,e)/e,s=e!==this.distance||this.interpolationRatio!==i;this.distance=e,this.minDistance=t,this.interpolationRatio=i,s&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const e=Xt(),t=this.distance*this.resolution,i=this.source.getFeatures(),s={};for(let r=0,o=i.length;r<o;r++){const a=i[r];if(!(H(a)in s)){const l=this.geometryFunction(a);if(l){const h=l.getCoordinates();Rr(h,e),si(e,t,e);const c=this.source.getFeaturesInExtent(e).filter(function(u){const d=H(u);return d in s?!1:(s[d]=!0,!0)});this.features.push(this.createCluster(c,e))}}}}createCluster(e,t){const i=[0,0];for(let a=e.length-1;a>=0;--a){const l=this.geometryFunction(e[a]);l?My(i,l.getCoordinates()):e.splice(a,1)}Sy(i,1/e.length);const s=Nt(t),r=this.interpolationRatio,o=new Ht([i[0]*(1-r)+s[0]*r,i[1]*(1-r)+s[1]*r]);return this.createCustomCluster_?this.createCustomCluster_(o,e):new tn({geometry:o,features:e})}}const y_=sR;function rR(n,e,t,i){const s=document.createElement("script"),r="olc_"+H(e);function o(){delete window[r],s.parentNode.removeChild(s)}s.async=!0,s.src=n+(n.includes("?")?"&":"?")+(i||"callback")+"="+r;const a=setTimeout(function(){o(),t&&t()},1e4);window[r]=function(l){clearTimeout(a),o(),e(l)},document.head.appendChild(s)}const oR='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class aR extends nR{constructor(e){e=e||{};let t;e.attributions!==void 0?t=e.attributions:t=[oR];const i=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",s=e.url!==void 0?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:i,interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:19,opaque:e.opaque!==void 0?e.opaque:!0,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:s,wrapX:e.wrapX,zDirection:e.zDirection})}}const lR=aR;class hR extends ka{constructor(e){if(super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:X("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.tileJSON_=null,this.tileSize_=e.tileSize,e.url)if(e.jsonp)rR(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let i;try{i=JSON.parse(t.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(i)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(e){const t=X("EPSG:4326"),i=this.getProjection();let s;if(e.bounds!==void 0){const h=Wh(t,i);s=by(e.bounds,h)}const r=Oa(i),o=e.minzoom||0,a=e.maxzoom||22,l=oc({extent:r,maxZoom:a,minZoom:o,tileSize:this.tileSize_});if(this.tileGrid=l,this.tileUrlFunction=zf(e.tiles,l),e.attribution&&!this.getAttributions()){const h=s!==void 0?s:r;this.setAttributions(function(c){return He(h,c.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState("ready")}handleTileJSONError(){this.setState("error")}}const cR=hR;class uR extends Fa{constructor(e){super({extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes}),this.matrixIds_=e.matrixIds}getMatrixId(e){return this.matrixIds_[e]}getMatrixIds(){return this.matrixIds_}}function dR(n,e,t){const i=[],s=[],r=[],o=[],a=[];t=t!==void 0?t:[];const l="SupportedCRS",h="TileMatrix",c="Identifier",u="ScaleDenominator",d="TopLeftCorner",f="TileWidth",g="TileHeight",p=n[l],m=X(p),v=m.getMetersPerUnit(),y=m.getAxisOrientation().substr(0,2)=="ne";return n[h].sort(function(x,w){return w[u]-x[u]}),n[h].forEach(function(x){let w;if(t.length>0?w=t.find(function(b){return x[c]==b[h]?!0:x[c].includes(":")?!1:n[c]+":"+x[c]===b[h]}):w=!0,w){s.push(x[c]);const b=x[u]*28e-5/v,E=x[f],C=x[g];y?r.push([x[d][1],x[d][0]]):r.push(x[d]),i.push(b),o.push(E==C?E:[E,C]),a.push([x.MatrixWidth,x.MatrixHeight])}}),new uR({extent:e,origins:r,resolutions:i,matrixIds:s,tileSizes:o,sizes:a})}class fR extends ka{constructor(e){const t=e.requestEncoding!==void 0?e.requestEncoding:"KVP",i=e.tileGrid;let s=e.urls;s===void 0&&e.url!==void 0&&(s=Bf(e.url)),super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:s,wrapX:e.wrapX!==void 0?e.wrapX:!1,transition:e.transition,zDirection:e.zDirection}),this.version_=e.version!==void 0?e.version:"1.0.0",this.format_=e.format!==void 0?e.format:"image/jpeg",this.dimensions_=e.dimensions!==void 0?e.dimensions:{},this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style,this.requestEncoding_=t,this.setKey(this.getKeyForDimensions_()),s&&s.length>0&&(this.tileUrlFunction=Yu(s.map(this.createFromWMTSTemplate.bind(this))))}setUrls(e){this.urls=e;const t=e.join(`
`);this.setTileUrlFunction(Yu(e.map(this.createFromWMTSTemplate.bind(this))),t)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const e=this.urls?this.urls.slice(0):[];for(const t in this.dimensions_)e.push(t+"-"+this.dimensions_[t]);return e.join("/")}updateDimensions(e){Object.assign(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(e){const t=this.requestEncoding_,i={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};t=="KVP"&&Object.assign(i,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e=t=="KVP"?$o(e,i):e.replace(/\{(\w+?)\}/g,function(o,a){return a.toLowerCase()in i?i[a.toLowerCase()]:o});const s=this.tileGrid,r=this.dimensions_;return function(o,a,l){if(!o)return;const h={TileMatrix:s.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(h,r);let c=e;return t=="KVP"?c=$o(c,h):c=c.replace(/\{(\w+?)\}/g,function(u,d){return h[d]}),c}}}const gR=fR;function pR(n,e){const i=n.Contents.Layer.find(function(S){return S.Identifier==e.layer});if(!i)return null;const s=n.Contents.TileMatrixSet;let r;i.TileMatrixSetLink.length>1?"projection"in e?r=i.TileMatrixSetLink.findIndex(function(S){const O=s.find(function(z){return z.Identifier==S.TileMatrixSet}).SupportedCRS,L=X(O),P=X(e.projection);return L&&P?ui(L,P):O==e.projection}):r=i.TileMatrixSetLink.findIndex(function(S){return S.TileMatrixSet==e.matrixSet}):r=0,r<0&&(r=0);const o=i.TileMatrixSetLink[r].TileMatrixSet,a=i.TileMatrixSetLink[r].TileMatrixSetLimits;let l=i.Format[0];"format"in e&&(l=e.format),r=i.Style.findIndex(function(S){return"style"in e?S.Title==e.style:S.isDefault}),r<0&&(r=0);const h=i.Style[r].Identifier,c={};"Dimension"in i&&i.Dimension.forEach(function(S,B,O){const L=S.Identifier;let P=S.Default;P===void 0&&(P=S.Value[0]),c[L]=P});const d=n.Contents.TileMatrixSet.find(function(S){return S.Identifier==o});let f;const g=d.SupportedCRS;if(g&&(f=X(g)),"projection"in e){const S=X(e.projection);S&&(!f||ui(S,f))&&(f=S)}let p=!1;const m=f.getAxisOrientation().substr(0,2)=="ne";let v=d.TileMatrix[0],y={MinTileCol:0,MinTileRow:0,MaxTileCol:v.MatrixWidth-1,MaxTileRow:v.MatrixHeight-1};if(a){y=a[a.length-1];const S=d.TileMatrix.find(B=>B.Identifier===y.TileMatrix||d.Identifier+":"+B.Identifier===y.TileMatrix);S&&(v=S)}const x=v.ScaleDenominator*28e-5/f.getMetersPerUnit(),w=m?[v.TopLeftCorner[1],v.TopLeftCorner[0]]:v.TopLeftCorner,b=v.TileWidth*x,E=v.TileHeight*x;let C=d.BoundingBox;C&&m&&(C=[C[1],C[0],C[3],C[2]]);let M=[w[0]+b*y.MinTileCol,w[1]-E*(1+y.MaxTileRow),w[0]+b*(1+y.MaxTileCol),w[1]-E*y.MinTileRow];if(C!==void 0&&!Li(C,M)){const S=i.WGS84BoundingBox,B=X("EPSG:4326").getExtent();if(M=C,S)p=S[0]===B[0]&&S[2]===B[2];else{const O=Dd(C,d.SupportedCRS,"EPSG:4326");p=O[0]-1e-10<=B[0]&&O[2]+1e-10>=B[2]}}const R=dR(d,M,a),N=[];let G=e.requestEncoding;if(G=G!==void 0?G:"","OperationsMetadata"in n&&"GetTile"in n.OperationsMetadata){const S=n.OperationsMetadata.GetTile.DCP.HTTP.Get;for(let B=0,O=S.length;B<O;++B)if(S[B].Constraint){const P=S[B].Constraint.find(function(z){return z.name=="GetEncoding"}).AllowedValues.Value;if(G===""&&(G=P[0]),G==="KVP")P.includes("KVP")&&N.push(S[B].href);else break}else S[B].href&&(G="KVP",N.push(S[B].href))}return N.length===0&&(G="REST",i.ResourceURL.forEach(function(S){S.resourceType==="tile"&&(l=S.format,N.push(S.template))})),{urls:N,layer:e.layer,matrixSet:o,format:l,projection:f,requestEncoding:G,tileGrid:R,style:h,dimensions:c,wrapX:p,crossOrigin:e.crossOrigin}}const mR=function(){const e=new d_({projection:"EPSG:3857",wrapX:!0}).getTileCoordForTileUrlFunction([6,-31,22]);return e&&e[1]===33&&e[2]===22}();class __{constructor(e,t,i){this.source_=t,this.projection_=null,this.fallbackProj_=i||null,this.ready_=!1,this.tilingScheme_=new Cesium.WebMercatorTilingScheme,this.rectangle_=null,this.map_=e,this.shouldRequestNextLevel=!1;const s=this.source_.get("olcs.proxy");s&&(typeof s=="function"?this.proxy_={getURL:s}:typeof s=="string"&&(this.proxy_=new Cesium.DefaultProxy(s))),this.errorEvent_=new Cesium.Event,this.emptyCanvas_=document.createElement("canvas"),this.emptyCanvas_.width=1,this.emptyCanvas_.height=1,this.source_.on("change",r=>{this.handleSourceChanged_()}),this.handleSourceChanged_()}handleSourceChanged_(e){if(!this.ready_&&this.source_.getState()=="ready"){this.projection_=Tl(this.source_)||this.fallbackProj_;const t={numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1};if(this.source_.tileGrid!==null&&this.source_.tileGrid.forEachTileCoord(this.projection_.getExtent(),0,([i,s,r])=>{t.numberOfLevelZeroTilesX=s+1,t.numberOfLevelZeroTilesY=r+1}),this.projection_.getCode()==="EPSG:4326")this.shouldRequestNextLevel=t.numberOfLevelZeroTilesX===1&&t.numberOfLevelZeroTilesY===1,this.tilingScheme_=new Cesium.GeographicTilingScheme(t);else if(this.projection_.getCode()==="EPSG:3857")this.shouldRequestNextLevel=!1,this.tilingScheme_=new Cesium.WebMercatorTilingScheme(t);else return;this.rectangle_=this.tilingScheme_.rectangle,this.ready_=!0}}getTileCredits(e,t,i){const s=this.source_.getAttributions();if(!s)return[];const r=this.map_.getView().calculateExtent(this.map_.getSize()),o=this.map_.getView().getCenter(),a=this.shouldRequestNextLevel?i+1:i;return x_(s,a,o,r)}requestImage(e,t,i){const s=this.source_.getTileUrlFunction();if(s&&this.projection_){const r=this.shouldRequestNextLevel?i+1:i;let o=t;mR||(o=-t-1);let a=s.call(this.source_,[r,e,o],1,this.projection_);return this.proxy_&&(a=this.proxy_.getURL(a)),a?Cesium.ImageryProvider.loadImage(this,a):this.emptyCanvas_}else return this.emptyCanvas_}}Object.defineProperties(__.prototype,{ready:{get:function(){return this.ready_}},_ready:{get:function(){return this.ready_}},rectangle:{get:function(){return this.rectangle_}},tileWidth:{get:function(){const n=this.source_.getTileGrid();return n?Array.isArray(n.getTileSize(0))?n.getTileSize(0)[0]:n.getTileSize(0):256}},tileHeight:{get:function(){const n=this.source_.getTileGrid();return n?Array.isArray(n.getTileSize(0))?n.getTileSize(0)[1]:n.getTileSize(0):256}},maximumLevel:{get:function(){const n=this.source_.getTileGrid();return n?n.getMaxZoom():18}},minimumLevel:{get:function(){return 0}},tilingScheme:{get:function(){return this.tilingScheme_}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this.errorEvent_}},proxy:{get:function(){return this.proxy_}},hasAlphaChannel:{get:function(){return!0}},pickFeatures:{get:function(){}}});const yR=new v0,_R=[new $t({stroke:new xt({color:"blue",width:2})})];class vR{constructor(e){this.urls=e.urls,this.ready=!0,this.readyPromise=Promise.resolve(!0),this.tileWidth=256,this.tileHeight=256,this.maximumLevel=e.maximumLevel||20,this.minimumLevel=e.minimumLevel||0,this.tilingScheme=new Cesium.WebMercatorTilingScheme,this.rectangle=e.rectangle||this.tilingScheme.rectangle,this.errorEvent=new Cesium.Event,this.credit=e.credit,this.hasAlphaChannel=!0,this.styleFunction_=e.styleFunction||(()=>_R),this.projection_=X("EPSG:3857"),this.emptyCanvas_=document.createElement("canvas"),this.emptyCanvas_.width=1,this.emptyCanvas_.height=1,this.tileRectangle_=new Cesium.Rectangle;const t=e.cacheSize!==void 0?e.cacheSize:50;this.tileCache=new Xu(t),this.featureCache=e.featureCache||new Xu(t);const i=Gf(this.projection_);this.tileFunction_=zf(this.urls,i)}getTileCredits(){return[]}pickFeatures(){}getTileFeatures(e,t,i){const s=this.getCacheKey_(e,t,i);let r;if(this.featureCache.containsKey(s)&&(r=this.featureCache.get(s)),!r){const o=this.getUrl_(e,t,i);if(r=fetch(o).then(a=>a.ok?a:Promise.reject(a)).then(a=>a.arrayBuffer()).then(a=>this.readFeaturesFromBuffer(a)),this.featureCache.set(s,r),this.featureCache.getCount()>2*this.featureCache.highWaterMark)for(;this.featureCache.canExpireCache();)this.featureCache.pop()}return r}readFeaturesFromBuffer(e){let t;const i=yR.readFeatures(e,t),s=this.tileWidth/4096;return i.forEach(r=>{const o=r.getFlatCoordinates();for(let a=0;a<o.length;++a)o[a]*=s}),i}getUrl_(e,t,i){return this.tileFunction_([e,t,i])}getCacheKey_(e,t,i){return`${e}_${t}_${i}`}requestImage(e,t,i,s){if(i<this.minimumLevel)return this.emptyCanvas_;try{const r=this.getCacheKey_(i,e,t);let o;if(this.tileCache.containsKey(r)&&(o=this.tileCache.get(r)),!o&&(o=this.getTileFeatures(i,e,t).then(a=>{this.tilingScheme.tileXYToNativeRectangle(e,t,i,this.tileRectangle_);const l=(this.tileRectangle_.east-this.tileRectangle_.west)/this.tileWidth;return this.rasterizeFeatures(a,this.styleFunction_,l)}),this.tileCache.set(r,o),this.tileCache.getCount()>2*this.tileCache.highWaterMark))for(;this.tileCache.canExpireCache();)this.tileCache.pop();return o}catch(r){console.trace(r),this.raiseEvent("could not render pbf to tile",r)}}rasterizeFeatures(e,t,i){const s=document.createElement("canvas"),r=gT(s.getContext("2d"),{size:[this.tileWidth,this.tileHeight]});return e.forEach(o=>{const a=t(o,i);a&&a.forEach(l=>{r.setStyle(l),r.drawGeometry(o)})}),s}}const xR={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},wR={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class bR extends a_{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.tmpTransform_=pi()}prepareTile(e,t,i){let s;const r=e.getState();return(r===U.LOADED||r===U.ERROR)&&(this.updateExecutorGroup_(e,t,i),this.tileImageNeedsRender_(e)&&(s=!0)),s}getTile(e,t,i,s){const r=s.pixelRatio,o=s.viewState,a=o.resolution,l=o.projection,h=this.getLayer(),c=h.getSource().getTile(e,t,i,r,l),u=s.viewHints,d=!(u[We.ANIMATING]||u[We.INTERACTING]);return(d||!c.wantedResolution)&&(c.wantedResolution=a),this.prepareTile(c,r,l)&&(d||Date.now()-s.time<8)&&h.getRenderMode()!=="vector"&&this.renderTileImage_(c,s),super.getTile(e,t,i,s)}isDrawableTile(e){const t=this.getLayer();return super.isDrawableTile(e)&&(t.getRenderMode()==="vector"?H(t)in e.executorGroups:e.hasContext(t))}getTileImage(e){return e.getImage(this.getLayer())}prepareFrame(e){const t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,i){const s=this.getLayer(),r=s.getRevision(),o=s.getRenderOrder()||null,a=e.wantedResolution,l=e.getReplayState(s);if(!l.dirty&&l.renderedResolution===a&&l.renderedRevision==r&&l.renderedRenderOrder==o)return;const h=s.getSource(),c=s.getDeclutter(),u=h.getTileGrid(),f=h.getTileGridForProjection(i).getTileCoordExtent(e.wrappedTileCoord),g=h.getSourceTiles(t,i,e),p=H(s);delete e.hitDetectionImageData[p],e.executorGroups[p]=[],c&&(e.declutterExecutorGroups[p]=[]),l.dirty=!1;for(let m=0,v=g.length;m<v;++m){const y=g[m];if(y.getState()!=U.LOADED)continue;const x=y.tileCoord,w=u.getTileCoordExtent(x),b=Cn(f,w),E=si(b,s.getRenderBuffer()*a,this.tmpExtent),C=Ns(w,b)?null:E,M=new lh(0,E,a,t),R=c?new lh(0,b,a,t):void 0,N=kf(a,t),G=function(P){let z;const Q=P.getStyleFunction()||s.getStyleFunction();if(Q&&(z=Q(P,a)),z){const Te=this.renderFeature(P,N,z,M,R);l.dirty=l.dirty||Te}},S=y.getFeatures();o&&o!==l.renderedRenderOrder&&S.sort(o);for(let P=0,z=S.length;P<z;++P){const Q=S[P];(!C||He(C,Q.getGeometry().getExtent()))&&G.call(this,Q)}const B=M.finish(),O=s.getRenderMode()!=="vector"&&c&&g.length===1?null:b,L=new hh(O,a,t,h.getOverlaps(),B,s.getRenderBuffer());if(e.executorGroups[p].push(L),R){const P=new hh(null,a,t,h.getOverlaps(),R.finish(),s.getRenderBuffer());e.declutterExecutorGroups[p].push(P)}}l.renderedRevision=r,l.renderedRenderOrder=o,l.renderedResolution=a}forEachFeatureAtCoordinate(e,t,i,s,r){const o=t.viewState.resolution,a=t.viewState.rotation;i=i??0;const l=this.getLayer(),c=l.getSource().getTileGridForProjection(t.viewState.projection),u=gt([e]);si(u,o*i,u);const d={},f=function(m,v,y){let x=m.getId();x===void 0&&(x=H(m));const w=d[x];if(w){if(w!==!0&&y<w.distanceSq){if(y===0)return d[x]=!0,r.splice(r.lastIndexOf(w),1),s(m,l,v);w.geometry=v,w.distanceSq=y}}else{if(y===0)return d[x]=!0,s(m,l,v);r.push(d[x]={feature:m,layer:l,geometry:v,distanceSq:y,callback:s})}},g=this.renderedTiles;let p;for(let m=0,v=g.length;!p&&m<v;++m){const y=g[m],x=c.getTileCoordExtent(y.wrappedTileCoord);if(!He(x,u))continue;const w=H(l),b=[y.executorGroups[w]],E=y.declutterExecutorGroups[w];E&&b.push(E),b.some(C=>{const M=C===E?t.declutterTree.all().map(R=>R.value):null;for(let R=0,N=C.length;R<N;++R)if(p=C[R].forEachFeatureAtCoordinate(e,o,a,i,f,M),p)return!0})}return p}getFeatures(e){return new Promise((t,i)=>{const s=this.getLayer(),r=H(s),o=s.getSource(),a=this.renderedProjection,l=a.getExtent(),h=this.renderedResolution,c=o.getTileGridForProjection(a),u=st(this.renderedPixelToCoordinateTransform_,e.slice()),d=c.getTileCoordForCoordAndResolution(u,h);let f;for(let x=0,w=this.renderedTiles.length;x<w;++x)if(d.toString()===this.renderedTiles[x].tileCoord.toString()){if(f=this.renderedTiles[x],f.getState()===U.LOADED){const b=c.getTileCoordExtent(f.tileCoord);o.getWrapX()&&a.canWrapX()&&!Li(l,b)&&Od(u,a);break}f=void 0}if(!f||f.loadingSourceTiles>0){t([]);return}const g=c.getTileCoordExtent(f.wrappedTileCoord),p=fn(g),m=[(u[0]-p[0])/h,(p[1]-u[1])/h],v=f.getSourceTiles().reduce(function(x,w){return x.concat(w.getFeatures())},[]);let y=f.hitDetectionImageData[r];if(!y){const x=qt(c.getTileSize(c.getZForResolution(h,o.zDirection))),w=this.renderedRotation_,b=[this.getRenderTransform(c.getTileCoordCenter(f.wrappedTileCoord),h,0,fi,x[0]*fi,x[1]*fi,0)];y=K0(x,b,v,s.getStyleFunction(),c.getTileCoordExtent(f.wrappedTileCoord),f.getReplayState(s).renderedResolution,w),f.hitDetectionImageData[r]=y}t(J0(m,v,y))})}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.renderedLayerRevision_!==void 0&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e){const t=this.context,i=t.globalAlpha;t.globalAlpha=this.getLayer().getOpacity();const s=e.viewHints,r=!(s[We.ANIMATING]||s[We.INTERACTING]),o=this.renderedTiles;for(let a=0,l=o.length;a<l;++a){const h=o[a],c=h.declutterExecutorGroups[H(this.getLayer())];if(c)for(let u=c.length-1;u>=0;--u)c[u].execute(this.context,1,this.getTileRenderTransform(h,e),e.viewState.rotation,r,void 0,e.declutterTree)}t.globalAlpha=i}getTileRenderTransform(e,t){const i=t.pixelRatio,s=t.viewState,r=s.center,o=s.resolution,a=s.rotation,l=t.size,h=Math.round(l[0]*i),c=Math.round(l[1]*i),d=this.getLayer().getSource().getTileGridForProjection(t.viewState.projection),f=e.tileCoord,g=d.getTileCoordExtent(e.wrappedTileCoord),p=d.getTileCoordExtent(f,this.tmpExtent)[0]-g[0];return Xh(Sl(this.inversePixelTransform.slice(),1/i,1/i),this.getRenderTransform(r,o,a,i,h,c,p))}postRender(e,t){const i=t.viewHints,s=!(i[We.ANIMATING]||i[We.INTERACTING]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation;const r=this.getLayer(),o=r.getRenderMode(),a=e.globalAlpha;e.globalAlpha=r.getOpacity();const l=wR[o],h=t.viewState,c=h.rotation,u=r.getSource(),f=u.getTileGridForProjection(h.projection).getZForResolution(h.resolution,u.zDirection),g=this.renderedTiles,p=[],m=[];let v=!0;for(let y=g.length-1;y>=0;--y){const x=g[y];v=v&&!x.getReplayState(r).dirty;const w=x.executorGroups[H(r)].filter(R=>R.hasExecutors(l));if(w.length===0)continue;const b=this.getTileRenderTransform(x,t),E=x.tileCoord[0];let C=!1;const M=w[0].getClipCoords(b);if(M){for(let R=0,N=p.length;R<N;++R)if(f!==E&&E<m[R]){const G=p[R];He([M[0],M[3],M[4],M[7]],[G[0],G[3],G[4],G[7]])&&(C||(e.save(),C=!0),e.beginPath(),e.moveTo(M[0],M[1]),e.lineTo(M[2],M[3]),e.lineTo(M[4],M[5]),e.lineTo(M[6],M[7]),e.moveTo(G[6],G[7]),e.lineTo(G[4],G[5]),e.lineTo(G[2],G[3]),e.lineTo(G[0],G[1]),e.clip())}p.push(M),m.push(E)}for(let R=0,N=w.length;R<N;++R)w[R].execute(e,1,b,c,s,l);C&&e.restore()}e.globalAlpha=a,this.ready=v,super.postRender(e,t)}renderFeature(e,t,i,s,r){if(!i)return!1;let o=!1;if(Array.isArray(i))for(let a=0,l=i.length;a<l;++a)o=ch(s,e,i[a],t,this.boundHandleStyleImageChange_,void 0,r)||o;else o=ch(s,e,i,t,this.boundHandleStyleImageChange_,void 0,r);return o}tileImageNeedsRender_(e){const t=this.getLayer();if(t.getRenderMode()==="vector")return!1;const i=e.getReplayState(t),s=t.getRevision(),r=e.wantedResolution;return i.renderedTileResolution!==r||i.renderedTileRevision!==s}renderTileImage_(e,t){const i=this.getLayer(),s=e.getReplayState(i),r=i.getRevision(),o=e.executorGroups[H(i)];s.renderedTileRevision=r;const a=e.wrappedTileCoord,l=a[0],h=i.getSource();let c=t.pixelRatio;const d=t.viewState.projection,f=h.getTileGridForProjection(d),g=f.getResolution(e.tileCoord[0]),p=t.pixelRatio/e.wantedResolution*g,m=f.getResolution(l),v=e.getContext(i);c=Math.round(Math.max(c,p/c));const y=h.getTilePixelSize(l,c,d);v.canvas.width=y[0],v.canvas.height=y[1];const x=c/p;if(x!==1){const C=Xg(this.tmpTransform_);Sl(C,x,x),v.setTransform.apply(v,C)}const w=f.getTileCoordExtent(a,this.tmpExtent),b=p/m,E=Xg(this.tmpTransform_);Sl(E,b,-b),sw(E,-w[0],-w[3]);for(let C=0,M=o.length;C<M;++C)o[C].execute(v,x,E,0,!0,xR[i.getRenderMode()]);s.renderedTileResolution=e.wantedResolution}}const ER=bR;class CR extends Af{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un;const i=e.renderMode||"hybrid";fe(i=="hybrid"||i=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=i,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new ER(this)}getFeatures(e){return super.getFeatures(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(Kn.PRELOAD)}getUseInterimTilesOnError(){return this.get(Kn.USE_INTERIM_TILES_ON_ERROR)}setPreload(e){this.set(Kn.PRELOAD,e)}setUseInterimTilesOnError(e){this.set(Kn.USE_INTERIM_TILES_ON_ERROR,e)}}const Ps=CR;function MR(n,e){const t=n.camera.getPickRay(e);return n.globe.pick(t,n)||n.camera.pickEllipsoid(e)}function SR(n){const e=n.canvas,t=new Cesium.Cartesian2(e.clientWidth/2,e.clientHeight/2);return MR(n,t)}function v_(n,e){if(n&&e){const t=Dd(n,e,"EPSG:4326");return Cesium.Rectangle.fromDegrees(t[0],t[1],t[2],t[3])}else return null}function TR(n,e,t,i){const s=e.get("olcs_skip");if(s)return null;let r=null;if(e instanceof Bd&&e.getUrl()&&e.getImageLoadFunction()===zd){const o={"olcs.proxy":e.get("olcs.proxy"),"olcs.extent":e.get("olcs.extent"),"olcs.projection":e.get("olcs.projection"),"olcs.imagesource":e};e=new KT({url:e.getUrl(),attributions:e.getAttributions(),projection:e.getProjection(),params:e.getParams()}),e.setProperties(o)}if(e instanceof ka){let o=Tl(e);if(o||(o=t),nm(o))r=new __(n,e,t);else return null}else if(e instanceof NT){let o=Tl(e);if(o||(o=t),nm(o)){const a=Cesium.Rectangle.fromDegrees(e.getImageExtent()[0],e.getImageExtent()[1],e.getImageExtent()[2],e.getImageExtent()[3],new Cesium.Rectangle);r=new Cesium.SingleTileImageryProvider({url:e.getUrl(),rectangle:a})}else return null}else if(e instanceof p_&&i instanceof Ps){let o=Tl(e);if(o||(o=t),s===!1){const a=o.getCode().split(":")[1],l=e.urls.map(p=>p.replace(a,"3857")),h=i.getExtent(),c=v_(h,o),u=e.get("olcs_minimumLevel"),d=e.getAttributions(),f=i.getStyleFunction();let g;if(h&&d){const p=Nt(h);g=x_(d,0,p,h)[0]}return r=new vR({credit:g,rectangle:c,minimumLevel:u,styleFunction:f,urls:l}),r}return null}else return null;return r}function RR(n,e,t){if(!(e instanceof Nf)&&!(e instanceof Rl)&&!(e instanceof Ps))return null;const i=e.getSource();if(!i)return null;let s=i.get("olcs_provider");if(s||(s=TR(n,i,t,e)),!s)return null;const r={},a=e.get("olcs.extent")||e.getExtent();return a&&(r.rectangle=v_(a,t)),new Cesium.ImageryLayer(s,r)}function tm(n,e){let t=1,i=!0;[n.layer].concat(n.parents).forEach(s=>{const r=s.getOpacity();r!==void 0&&(t*=r);const o=s.getVisible();o!==void 0&&(i=i&&o)}),e.alpha=t,e.show=i}function xr(n){const e=n;return e.length>2?Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]):Cesium.Cartesian3.fromDegrees(e[0],e[1])}function Uc(n){console.assert(n!==null);const e=xr,t=[];for(let i=0;i<n.length;++i)t.push(e(n[i]));return t}function gl(n,e){console.assert(e);const t=X("EPSG:4326"),i=X(e);if(i.getCode()!==t.getCode()){const s=n.getProperties();n=n.clone(),n.transform(i,t),n.setProperties(s)}return n}function im(n){if(n=n||"black",Array.isArray(n))return new Cesium.Color(Cesium.Color.byteToFloat(n[0]),Cesium.Color.byteToFloat(n[1]),Cesium.Color.byteToFloat(n[2]),n[3]);if(typeof n=="string")return Cesium.Color.fromCssColorString(n);if(n instanceof CanvasPattern||n instanceof CanvasGradient){const e=document.createElement("canvas"),t=e.getContext("2d");return e.width=e.height=256,t.fillStyle=n,t.fillRect(0,0,e.width,e.height),new Cesium.ImageMaterialProperty({image:e})}console.assert(!1,"impossible")}function nm(n){const e=n.getCode()==="EPSG:3857",t=n.getCode()==="EPSG:4326";return e||t}function x_(n,e,t,i){if(!n)return[];let s=n({viewState:{zoom:e,center:t,projection:void 0,resolution:void 0,rotation:void 0},extent:i});return Array.isArray(s)||(s=[s]),s.map(r=>new Cesium.Credit(r,!0))}function LR(n,e,t,i){const s=t.canvas,o=t.camera.frustum.fovy;console.assert(!isNaN(o));const a=i.getMetersPerUnit(),l=n*s.clientHeight,h=Math.cos(Math.abs(e));return l*a*h/2/Math.tan(o/2)}function IR(n,e,t,i){const s=t.canvas,o=t.camera.frustum.fovy;console.assert(!isNaN(o));const a=i.getMetersPerUnit(),l=2*n*Math.tan(o/2),h=Math.cos(Math.abs(e));return l/a/h/s.clientHeight}class PR{constructor(e){this.ol3d=e,this.scene_=e.getCesiumScene(),this.canvas_=this.scene_.canvas,this._boundNotifyRepaintRequired=this.notifyRepaintRequired.bind(this),this.repaintEventNames_=["mousemove","mousedown","mouseup","touchstart","touchend","touchmove","pointerdown","pointerup","pointermove","wheel"],this.enable()}enable(){this.scene_.requestRenderMode=!0,this.scene_.maximumRenderTimeChange=1e3;for(const e of this.repaintEventNames_)this.canvas_.addEventListener(e,this._boundNotifyRepaintRequired,!1);window.addEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().on("change",this._boundNotifyRepaintRequired)}disable(){for(const e of this.repaintEventNames_)this.canvas_.removeEventListener(e,this._boundNotifyRepaintRequired,!1);window.removeEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().un("change",this._boundNotifyRepaintRequired),this.scene_.requestRenderMode=!1}restartRenderLoop(){this.notifyRepaintRequired()}notifyRepaintRequired(){this.scene_.requestRender()}}function pl(n){return n*180/Math.PI}function To(n){return n*Math.PI/180}class wr{constructor(e,t){this.scene_=e,this.cam_=e.camera,this.map_=t,this.view_=null,this.viewListenKey_=null,this.toLonLat_=wr.identityProjection,this.fromLonLat_=wr.identityProjection,this.tilt_=0,this.distance_=0,this.lastCameraViewMatrix_=null,this.viewUpdateInProgress_=!1,this.map_.on("change:view",i=>{this.setView_(this.map_.getView())}),this.setView_(this.map_.getView())}destroy(){Bi(this.viewListenKey_),this.viewListenKey_=null}static identityProjection(e,t,i){const s=i||e.length;if(t)for(let r=0;r<s;++r)t[r]=e[r];return e}setView_(e){if(this.view_&&(Bi(this.viewListenKey_),this.viewListenKey_=null),this.view_=e,e){const t=as(e.getProjection(),"EPSG:4326"),i=as("EPSG:4326",e.getProjection());console.assert(t&&i),this.toLonLat_=t,this.fromLonLat_=i,this.viewListenKey_=e.on("propertychange",s=>this.handleViewEvent_(s)),this.readFromView()}else this.toLonLat_=wr.identityProjection,this.fromLonLat_=wr.identityProjection}handleViewEvent_(e){this.viewUpdateInProgress_||this.readFromView()}setHeading(e){this.view_&&this.view_.setRotation(e)}getHeading(){return this.view_?this.view_.getRotation()||0:void 0}setTilt(e){this.tilt_=e,this.updateCamera_()}getTilt(){return this.tilt_}setDistance(e){this.distance_=e,this.updateCamera_(),this.updateView()}getDistance(){return this.distance_}setCenter(e){this.view_&&this.view_.setCenter(e)}getCenter(){if(this.view_)return this.view_.getCenter()}setPosition(e){if(!this.toLonLat_)return;const t=this.toLonLat_(e);console.assert(t);const i=new Cesium.Cartographic(To(t[0]),To(t[1]),this.getAltitude());this.cam_.setView({destination:Cesium.Ellipsoid.WGS84.cartographicToCartesian(i)}),this.updateView()}getPosition(){if(!this.fromLonLat_)return;const e=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position),t=this.fromLonLat_([pl(e.longitude),pl(e.latitude)]);return console.assert(t),t}setAltitude(e){const t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);t.height=e,this.cam_.position=Cesium.Ellipsoid.WGS84.cartographicToCartesian(t),this.updateView()}getAltitude(){return Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position).height}updateCamera_(){if(!this.view_||!this.toLonLat_)return;const e=this.view_.getCenter();if(!e)return;const t=this.toLonLat_(e);console.assert(t);const i=new Cesium.Cartographic(To(t[0]),To(t[1]));if(this.scene_.globe){const o=this.scene_.globe.getHeight(i);i.height=o||0}const s=Cesium.Ellipsoid.WGS84.cartographicToCartesian(i),r={pitch:this.tilt_-Cesium.Math.PI_OVER_TWO,heading:-this.view_.getRotation(),roll:void 0};this.cam_.setView({destination:s,orientation:r}),this.cam_.moveBackward(this.distance_),this.checkCameraChange(!0)}readFromView(){if(!this.view_||!this.toLonLat_)return;const e=this.view_.getCenter();if(e==null)return;const t=this.toLonLat_(e);console.assert(t);const i=this.view_.getResolution();this.distance_=this.calcDistanceForResolution(i||0,To(t[1])),this.updateCamera_()}updateView(){if(!this.view_||!this.fromLonLat_)return;this.viewUpdateInProgress_=!0;const e=Cesium.Ellipsoid.WGS84,t=this.scene_,i=SR(t);let s=i;if(!s){const o=t.globe,a=this.cam_.positionCartographic.clone(),l=o.getHeight(a);a.height=l||0,s=Cesium.Ellipsoid.WGS84.cartographicToCartesian(a)}this.distance_=Cesium.Cartesian3.distance(s,this.cam_.position);const r=e.cartesianToCartographic(s);if(this.view_.setCenter(this.fromLonLat_([pl(r.longitude),pl(r.latitude)])),this.view_.setResolution(this.calcResolutionForDistance(this.distance_,r?r.latitude:0)),i){const o=this.cam_.position,a=new Cesium.Cartesian3;e.geocentricSurfaceNormal(i,a);const l=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(o,i,l),Cesium.Cartesian3.normalize(l,l);const h=this.cam_.up,c=this.cam_.right,u=new Cesium.Cartesian3(-i.y,i.x,0),d=Cesium.Cartesian3.angleBetween(c,u),g=Cesium.Cartesian3.cross(i,h,new Cesium.Cartesian3).z;this.view_.setRotation(g<0?d:-d);const p=Math.acos(Cesium.Cartesian3.dot(a,l));this.tilt_=isNaN(p)?0:p}else this.view_.setRotation(this.cam_.heading),this.tilt_=-this.cam_.pitch+Math.PI/2;this.viewUpdateInProgress_=!1}checkCameraChange(e){const t=this.lastCameraViewMatrix_,i=this.cam_.viewMatrix;(!t||!Cesium.Matrix4.equalsEpsilon(t,i,1e-5))&&(this.lastCameraViewMatrix_=i.clone(),e!==!0&&this.updateView())}calcDistanceForResolution(e,t){return LR(e,t,this.scene_,this.view_.getProjection())}calcResolutionForDistance(e,t){return IR(e,t,this.scene_,this.view_.getProjection())}}class AR{constructor(e,t){_(this,"olListenKeys",[]);_(this,"context");_(this,"rootCollection_");const i=new Cesium.BillboardCollection({scene:t}),s=new Cesium.PrimitiveCollection;this.rootCollection_=new Cesium.PrimitiveCollection,this.context={projection:e,billboards:i,featureToCesiumMap:{},primitives:s},this.rootCollection_.add(i),this.rootCollection_.add(s)}destroy(){this.olListenKeys.forEach(Bi),this.olListenKeys.length=0}getRootPrimitive(){return this.rootCollection_}}class w_{constructor(e,t){_(this,"map");_(this,"view");_(this,"scene");_(this,"olLayers");_(this,"mapLayerGroup");_(this,"layerMap",{});_(this,"olLayerListenKeys",{});_(this,"olGroupListenKeys_",{});this.map=e,this.view=e.getView(),this.scene=t,this.olLayers=e.getLayerGroup().getLayers(),this.mapLayerGroup=e.getLayerGroup()}synchronize(){this.destroyAll(),this.addLayers_(this.mapLayerGroup)}orderLayers(){}addLayers_(e){const t=[{layer:e,parents:[]}];for(;t.length>0;){const i=t.splice(0,1)[0],s=i.layer,r=pt(s).toString();this.olLayerListenKeys[r]=[],console.assert(!this.layerMap[r]);let o=null;if(s instanceof Us)this.listenForGroupChanges_(s),s!==this.mapLayerGroup&&(o=this.createSingleLayerCounterparts(i)),o||s.getLayers().forEach(a=>{if(a){const l={layer:a,parents:s===this.mapLayerGroup?[]:[i.layer].concat(i.parents)};t.push(l)}});else if(o=this.createSingleLayerCounterparts(i),!o){const a=r,l=i,h=()=>{const c=this.createSingleLayerCounterparts(l);c&&(l.layer.un("change",h),this.addCesiumObjects_(c,a,l.layer),this.orderLayers())};this.olLayerListenKeys[r].push(vr(l.layer,"change",h))}o&&this.addCesiumObjects_(o,r,s)}this.orderLayers()}addCesiumObjects_(e,t,i){this.layerMap[t]=e,this.olLayerListenKeys[t].push(vr(i,"change:zIndex",()=>this.orderLayers())),e.forEach(s=>{this.addCesiumObject(s)})}removeAndDestroySingleLayer_(e){const t=pt(e).toString(),i=this.layerMap[t];return i&&(i.forEach(s=>{this.removeSingleCesiumObject(s,!1),this.destroyCesiumObject(s)}),this.olLayerListenKeys[t].forEach(Bi),delete this.olLayerListenKeys[t]),delete this.layerMap[t],!!i}unlistenSingleGroup_(e){if(e===this.mapLayerGroup)return;const t=pt(e).toString();this.olGroupListenKeys_[t].forEach(s=>{Bi(s)}),delete this.olGroupListenKeys_[t],delete this.layerMap[t]}removeLayer_(e){if(e){const t=[e];for(;t.length>0;){const i=t.splice(0,1)[0],s=this.removeAndDestroySingleLayer_(i);i instanceof Us&&(this.unlistenSingleGroup_(i),s||i.getLayers().forEach(r=>{t.push(r)}))}}}listenForGroupChanges_(e){const t=pt(e).toString();console.assert(this.olGroupListenKeys_[t]===void 0);const i=[];this.olGroupListenKeys_[t]=i;let s=[];const r=(function(){const o=e.getLayers();o&&(s=[o.on("add",a=>{this.addLayers_(a.element)}),o.on("remove",a=>{this.removeLayer_(a.element)})],i.push(...s))}).bind(this);r(),i.push(e.on("change:layers",o=>{s.forEach(a=>{const l=i.indexOf(a);l>=0&&i.splice(l,1),Bi(a)}),r()}))}destroyAll(){this.removeAllCesiumObjects(!0);let e;for(e in this.olGroupListenKeys_)this.olGroupListenKeys_[e].forEach(Bi);for(e in this.olLayerListenKeys)this.olLayerListenKeys[e].forEach(Bi);this.olGroupListenKeys_={},this.olLayerListenKeys={},this.layerMap={}}}class FR extends w_{constructor(t,i){super(t,i);_(this,"cesiumLayers_");_(this,"ourLayers_");this.cesiumLayers_=i.imageryLayers,this.ourLayers_=new Cesium.ImageryLayerCollection}addCesiumObject(t){this.cesiumLayers_.add(t),this.ourLayers_.add(t)}destroyCesiumObject(t){t.destroy()}removeSingleCesiumObject(t,i){this.cesiumLayers_.remove(t,i),this.ourLayers_.remove(t,!1)}removeAllCesiumObjects(t){for(let i=0;i<this.ourLayers_.length;++i)this.cesiumLayers_.remove(this.ourLayers_.get(i),t);this.ourLayers_.removeAll(!1)}convertLayerToCesiumImageries(t,i){const s=RR(this.map,t,i);return s?[s]:null}createSingleLayerCounterparts(t){const i=t.layer,s=pt(i).toString(),r=this.view.getProjection();console.assert(r);const o=this.convertLayerToCesiumImageries(i,r);if(o){const a=[];if([t.layer].concat(t.parents).forEach(l=>{a.push(l.on(["change:opacity","change:visible"],()=>{console.assert(o);for(let h=0;h<o.length;++h)tm(t,o[h])}))}),i instanceof Af){let l=i.getStyleFunction();a.push(i.on("change",()=>{var c;const h=i.getStyleFunction();if(l!==h){l=h;for(let u=0;u<o.length;++u){const d=o[u];d._imageryCache&&(d._imageryCache={});const f=d.imageryProvider;f&&((c=f.tileCache)==null||c.clear(),f.styleFunction_=h)}this.scene.requestRender()}}))}for(let l=0;l<o.length;++l)tm(t,o[l]);a.push(i.on("change:extent",l=>{for(let h=0;h<o.length;++h)this.cesiumLayers_.remove(o[h],!0),this.ourLayers_.remove(o[h],!1);delete this.layerMap[pt(i)],this.synchronize()})),a.push(i.on("change",l=>{for(let h=0;h<o.length;++h){const c=this.cesiumLayers_.indexOf(o[h]);c>=0&&(this.cesiumLayers_.remove(o[h],!1),this.cesiumLayers_.add(o[h],c))}})),this.olLayerListenKeys[s].push(...a)}return Array.isArray(o)?o:null}orderLayers(){const t=[],i={},s=[this.mapLayerGroup];for(;s.length>0;){const r=s.splice(0,1)[0];if(t.push(r),i[pt(r)]=r.getZIndex()||0,r instanceof Us){const o=r.getLayers();o&&s.unshift(...o.getArray())}}_T(t,(r,o)=>i[pt(r)]-i[pt(o)]),t.forEach(r=>{const o=pt(r).toString(),a=this.layerMap[o];a&&a.forEach(l=>{this.raiseToTop(l)})})}raiseToTop(t){this.cesiumLayers_.raiseToTop(t)}}class OR{constructor(e){this.scene=e,this.boundOnRemoveOrClearFeatureListener_=this.onRemoveOrClearFeature_.bind(this),this.defaultBillboardEyeOffset_=new Cesium.Cartesian3(0,0,10)}onRemoveOrClearFeature_(e){const t=e.target;console.assert(t instanceof Ii);const i=t.olcs_cancellers;if(i){const s=e.feature;if(s){const r=pt(s),o=i[r];o&&(o(),delete i[r])}else{for(const r in i)i.hasOwnProperty(r)&&i[r]();t.olcs_cancellers={}}}}setReferenceForPicking(e,t,i){i.olLayer=e,i.olFeature=t}createColoredPrimitive(e,t,i,s,r,o){const a=function(d,f){const g=new Cesium.GeometryInstance({geometry:d});return f&&!(f instanceof Cesium.ImageMaterialProperty)&&(g.attributes={color:Cesium.ColorGeometryInstanceAttribute.fromColor(f)}),g},l={flat:!0,renderState:{depthTest:{enabled:!0}}};o!==void 0&&(l.renderState||(l.renderState={}),l.renderState.lineWidth=o);const h=a(s,r),c=this.getHeightReference(e,t,i);let u;if(c===Cesium.HeightReference.CLAMP_TO_GROUND){const d=h.geometry.constructor;if(d&&!d.createShadowVolume)return null;u=new Cesium.GroundPrimitive({geometryInstances:h})}else u=new Cesium.Primitive({geometryInstances:h});if(r instanceof Cesium.ImageMaterialProperty){const d=r.image.getValue().toDataURL();u.appearance=new Cesium.MaterialAppearance({flat:!0,renderState:{depthTest:{enabled:!0}},material:new Cesium.Material({fabric:{type:"Image",uniforms:{image:d}}})})}else u.appearance=new Cesium.MaterialAppearance({...l,material:new Cesium.Material({translucent:r.alpha!==1,fabric:{type:"Color",uniforms:{color:r}}})}),(t.get("olcs_shadows")||e.get("olcs_shadows"))&&(u.shadows=1);return this.setReferenceForPicking(e,t,u),u}extractColorFromOlStyle(e,t){const i=e.getFill()?e.getFill().getColor():null,s=e.getStroke()?e.getStroke().getColor():null;let r="black";return s&&t?r=s:i&&(r=i),im(r)}extractLineWidthFromOlStyle(e){const t=e.getStroke()?e.getStroke().getWidth():void 0;return t!==void 0?t:1}wrapFillAndOutlineGeometries(e,t,i,s,r,o){const a=this.extractColorFromOlStyle(o,!1),l=this.extractColorFromOlStyle(o,!0),h=new Cesium.PrimitiveCollection;if(o.getFill()){const c=this.createColoredPrimitive(e,t,i,s,a);console.assert(!!c),h.add(c)}if(o.getStroke()&&r){const c=this.extractLineWidthFromOlStyle(o),u=this.createColoredPrimitive(e,t,i,r,l,c);u&&h.add(u)}return h}addTextStyle(e,t,i,s,r){let o;if(r instanceof Cesium.PrimitiveCollection?o=r:(o=new Cesium.PrimitiveCollection,o.add(r)),!s.getText())return o;const a=s.getText(),l=this.olGeometry4326TextPartToCesium(e,t,i,a);return l&&o.add(l),o}csAddBillboard(e,t,i,s,r,o){t.eyeOffset||(t.eyeOffset=this.defaultBillboardEyeOffset_);const a=e.add(t);return this.setReferenceForPicking(i,s,a),a}olCircleGeometryToCesium(e,t,i,s,r){i=gl(i,s),console.assert(i.getType()=="Circle");let o=i.getCenter();const a=o.length==3?o[2]:0;let l=o.slice();l[0]+=i.getRadius(),o=xr(o),l=xr(l);const h=Cesium.Cartesian3.distance(o,l),c=new Cesium.CircleGeometry({center:o,radius:h,height:a});let u,d;if(this.getHeightReference(e,t,i)===Cesium.HeightReference.CLAMP_TO_GROUND){const g=this.extractLineWidthFromOlStyle(r);if(g){const p=Rw(i.getCenter(),h),m=Uc(p.getLinearRing(0).getCoordinates());if(Gc(this.scene))u=new Cesium.GroundPolylinePrimitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.GroundPolylineGeometry({positions:m,width:g})}),appearance:new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(t,r,!0)}),classificationType:Cesium.ClassificationType.TERRAIN}),zc(u).then(()=>{this.setReferenceForPicking(e,t,u._primitive)});else{const v=this.extractColorFromOlStyle(r,!0);u=this.createStackedGroundCorridors(e,t,g,v,m)}}}else d=new Cesium.CircleOutlineGeometry({center:o,radius:h,extrudedHeight:a,height:a});const f=this.wrapFillAndOutlineGeometries(e,t,i,c,d,r);return u&&f.add(u),this.addTextStyle(e,t,i,r,f)}createStackedGroundCorridors(e,t,i,s,r){Array.isArray(r[0])||(r=[r]),i=Math.max(3,i);const o=[];let a=0;for(const l of[1e3,4e3,16e3,64e3,254e3,1e6,1e7]){i*=2.14;const h={width:i,vertexFormat:Cesium.VertexFormat.POSITION_ONLY};for(const c of r)h.positions=c,o.push(new Cesium.GeometryInstance({geometry:new Cesium.CorridorGeometry(h),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(s),distanceDisplayCondition:new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(a,l-1)}}));a=l}return new Cesium.GroundPrimitive({geometryInstances:o})}olLineStringGeometryToCesium(e,t,i,s,r){i=gl(i,s),console.assert(i.getType()=="LineString");const o=Uc(i.getCoordinates()),a=this.extractLineWidthFromOlStyle(r);let l;const h=this.getHeightReference(e,t,i);if(h===Cesium.HeightReference.CLAMP_TO_GROUND&&!Gc(this.scene)){const c=this.extractColorFromOlStyle(r,!0);l=this.createStackedGroundCorridors(e,t,a,c,o)}else{const c=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(t,r,!0)}),u={positions:o,width:a},d={appearance:c};if(h===Cesium.HeightReference.CLAMP_TO_GROUND){const f=new Cesium.GroundPolylineGeometry(u);d.geometryInstances=new Cesium.GeometryInstance({geometry:f}),l=new Cesium.GroundPolylinePrimitive(d),zc(l).then(()=>{this.setReferenceForPicking(e,t,l._primitive)})}else{u.vertexFormat=c.vertexFormat;const f=new Cesium.PolylineGeometry(u);d.geometryInstances=new Cesium.GeometryInstance({geometry:f}),l=new Cesium.Primitive(d)}}return this.setReferenceForPicking(e,t,l),this.addTextStyle(e,t,i,r,l)}olPolygonGeometryToCesium(e,t,i,s,r){i=gl(i,s),console.assert(i.getType()=="Polygon");const o=this.getHeightReference(e,t,i);let a,l,h;if(i.getCoordinates()[0].length==5&&t.get("olcs.polygon_kind")==="rectangle"){const u=i.getCoordinates()[0],d=gt(u),f=Cesium.Rectangle.fromDegrees(d[0],d[1],d[2],d[3]);let g=0;if(u[0].length==3)for(let m=0;m<u.length;m++)g=Math.max(g,u[m][2]);const p=t.getProperty("olcs_extruded_height");a=new Cesium.RectangleGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:f,height:g,extrudedHeight:p}),l=new Cesium.RectangleOutlineGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:f,height:g,extrudedHeight:p})}else{const u=i.getLinearRings(),d={},f=d;console.assert(u.length>0);for(let p=0;p<u.length;++p){const m=u[p].getCoordinates(),v=Uc(m);console.assert(v&&v.length>0),p==0?d.positions=v:(d.holes||(d.holes=[]),d.holes.push({positions:v}))}const g=t.get("olcs_extruded_height");if(a=new Cesium.PolygonGeometry({polygonHierarchy:f,perPositionHeight:!0,extrudedHeight:g}),o===Cesium.HeightReference.CLAMP_TO_GROUND){const p=this.extractLineWidthFromOlStyle(r);if(p>0){const m=[d.positions];if(d.holes)for(let v=0;v<d.holes.length;++v)m.push(d.holes[v].positions);if(Gc(this.scene)){const v=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(t,r,!0)}),y=[];for(const w of m){const b=new Cesium.GroundPolylineGeometry({positions:w,width:p});y.push(new Cesium.GeometryInstance({geometry:b}))}const x={appearance:v,geometryInstances:y};h=new Cesium.GroundPolylinePrimitive(x),zc(h).then(()=>{this.setReferenceForPicking(e,t,h._primitive)})}else{const v=this.extractColorFromOlStyle(r,!0);h=this.createStackedGroundCorridors(e,t,p,v,m)}}}else l=new Cesium.PolygonOutlineGeometry({polygonHierarchy:d,perPositionHeight:!0,extrudedHeight:g})}const c=this.wrapFillAndOutlineGeometries(e,t,i,a,l,r);return h&&c.add(h),this.addTextStyle(e,t,i,r,c)}getHeightReference(e,t,i){let s=i.get("altitudeMode");s===void 0&&(s=t.get("altitudeMode")),s===void 0&&(s=e.get("altitudeMode"));let r=Cesium.HeightReference.NONE;return s==="clampToGround"?r=Cesium.HeightReference.CLAMP_TO_GROUND:s==="relativeToGround"&&(r=Cesium.HeightReference.RELATIVE_TO_GROUND),r}createBillboardFromImage(e,t,i,s,r,o,a,l){o instanceof so&&o.load();const h=o.getImage(1),c=function(d){return d.src!=""&&d.naturalHeight!=0&&d.naturalWidth!=0&&d.complete},u=(function(){if(!h||!(h instanceof HTMLCanvasElement||h instanceof Image||h instanceof HTMLImageElement))return;const d=i.getCoordinates(),f=xr(d);let g;const p=o.getOpacity();p!==void 0&&(g=new Cesium.Color(1,1,1,p));const m=o.getScale(),v=this.getHeightReference(e,t,i),y={image:h,color:g,scale:m,heightReference:v,position:f};if(Object.assign(y,t.get("cesiumOptions")),o instanceof so){const w=o.getAnchor();w&&(y.pixelOffset=new Cesium.Cartesian2((h.width/2-w[0])*m,(h.height/2-w[1])*m))}const x=this.csAddBillboard(a,y,e,t,i,r);l&&l(x)}).bind(this);if(h instanceof Image&&!c(h)){let d=!1;const f=e.getSource(),g=function(){d=!0};f.on(["removefeature","clear"],this.boundOnRemoveOrClearFeatureListener_);let p=f.olcs_cancellers;p||(p=f.olcs_cancellers={});const m=pt(t);p[m]&&p[m](),p[m]=g;const v=function(){h.removeEventListener("load",v),!a.isDestroyed()&&!d&&u()};h.addEventListener("load",v)}else u()}olPointGeometryToCesium(e,t,i,s,r,o,a){console.assert(i.getType()=="Point"),i=gl(i,s);let l=null;const h=r.getImage();if(h){const c=i.get("olcs_model")||t.get("olcs_model");if(c){l=new Cesium.PrimitiveCollection;const u=c(),d=Object.assign({},{scene:this.scene},u.cesiumOptions);if(Cesium.Model.fromGltf){const f=Cesium.Model.fromGltf(d);l.add(f)}else Cesium.Model.fromGltfAsync(d).then(f=>{l.add(f)});u.debugModelMatrix&&l.add(new Cesium.DebugModelMatrixPrimitive({modelMatrix:u.debugModelMatrix}))}else this.createBillboardFromImage(e,t,i,s,r,h,o,a)}return r.getText()?this.addTextStyle(e,t,i,r,l||new Cesium.Primitive):l}olMultiGeometryToCesium(e,t,i,s,r,o,a){const l=function(c,u){const d=new Cesium.PrimitiveCollection;return c.forEach(f=>{d.add(u(e,t,f,s,r))}),d};let h;switch(i.getType()){case"MultiPoint":if(i=i,h=i.getPoints(),r.getText()){const c=new Cesium.PrimitiveCollection;return h.forEach(u=>{console.assert(u);const d=this.olPointGeometryToCesium(e,t,u,s,r,o,a);d&&c.add(d)}),c}else return h.forEach(c=>{console.assert(c),this.olPointGeometryToCesium(e,t,c,s,r,o,a)}),null;case"MultiLineString":return i=i,h=i.getLineStrings(),l(h,this.olLineStringGeometryToCesium.bind(this));case"MultiPolygon":return i=i,h=i.getPolygons(),l(h,this.olPolygonGeometryToCesium.bind(this));default:console.assert(!1,`Unhandled multi geometry type${i.getType()}`)}}olGeometry4326TextPartToCesium(e,t,i,s){const r=s.getText();if(!r)return null;const o=new Cesium.LabelCollection({scene:this.scene}),a=Nt(i.getExtent());if(i instanceof An){const g=i.getFirstCoordinate();a[2]=g.length==3?g[2]:0}const l={};l.position=xr(a),l.text=r,l.heightReference=this.getHeightReference(e,t,i);const h=s.getOffsetX(),c=s.getOffsetY();if(h!=0&&c!=0){const g=new Cesium.Cartesian2(h,c);l.pixelOffset=g}l.font=s.getFont()||"10px sans-serif";let u;s.getFill()&&(l.fillColor=this.extractColorFromOlStyle(s,!1),u=Cesium.LabelStyle.FILL),s.getStroke()&&(l.outlineWidth=this.extractLineWidthFromOlStyle(s),l.outlineColor=this.extractColorFromOlStyle(s,!0),u=Cesium.LabelStyle.OUTLINE),s.getFill()&&s.getStroke()&&(u=Cesium.LabelStyle.FILL_AND_OUTLINE),l.style=u;let d;switch(s.getTextAlign()){case"left":d=Cesium.HorizontalOrigin.LEFT;break;case"right":d=Cesium.HorizontalOrigin.RIGHT;break;case"center":default:d=Cesium.HorizontalOrigin.CENTER}if(l.horizontalOrigin=d,s.getTextBaseline()){let g;switch(s.getTextBaseline()){case"top":g=Cesium.VerticalOrigin.TOP;break;case"middle":g=Cesium.VerticalOrigin.CENTER;break;case"bottom":g=Cesium.VerticalOrigin.BOTTOM;break;case"alphabetic":g=Cesium.VerticalOrigin.TOP;break;case"hanging":g=Cesium.VerticalOrigin.BOTTOM;break;default:console.assert(!1,`unhandled baseline ${s.getTextBaseline()}`)}l.verticalOrigin=g}const f=o.add(l);return this.setReferenceForPicking(e,t,f),o}olStyleToCesium(e,t,i){const s=t.getFill(),r=t.getStroke();if(i&&!r||!i&&!s)return null;let o=i?r.getColor():s.getColor();return o=im(o),i&&r.getLineDash()?Cesium.Material.fromType("Stripe",{horizontal:!1,repeat:500,evenColor:o,oddColor:new Cesium.Color(0,0,0,0)}):Cesium.Material.fromType("Color",{color:o})}computePlainStyle(e,t,i,s){const r=t.getStyleFunction();let o=null;return r&&(o=r(t,s)),!o&&i&&(o=i(t,s)),o?Array.isArray(o)?o:[o]:null}getGeometryFromFeature(e,t,i){if(i)return i;const s=e.get("olcs.3d_geometry");if(s&&s instanceof no)return s;if(t){const r=t.getGeometryFunction()(e);if(r instanceof no)return r}return e.getGeometry()}olFeatureToCesium(e,t,i,s,r){let o=this.getGeometryFromFeature(t,i,r);if(!o)return null;const a=s.projection,l=function(h){const c=s.featureToCesiumMap[pt(t)];c instanceof Array?c.push(h):s.featureToCesiumMap[pt(t)]=[h]};switch(o.getType()){case"GeometryCollection":const h=new Cesium.PrimitiveCollection;return o.getGeometries().forEach(g=>{if(g){const p=this.olFeatureToCesium(e,t,i,s,g);p&&h.add(p)}}),h;case"Point":o=o;const u=s.billboards,d=this.olPointGeometryToCesium(e,t,o,a,i,u,l);return d||null;case"Circle":return o=o,this.olCircleGeometryToCesium(e,t,o,a,i);case"LineString":return o=o,this.olLineStringGeometryToCesium(e,t,o,a,i);case"Polygon":return o=o,this.olPolygonGeometryToCesium(e,t,o,a,i);case"MultiPoint":case"MultiLineString":case"MultiPolygon":const f=this.olMultiGeometryToCesium(e,t,o,a,i,s.billboards,l);return f||null;case"LinearRing":throw new Error("LinearRing should only be part of polygon.");default:throw new Error(`Ol geom type not handled : ${o.getType()}`)}}olVectorLayerToCesium(e,t,i){const s=t.getProjection(),r=t.getResolution();if(r===void 0||!s)throw console.assert(!1,"View not ready"),new Error("View not ready");let o=e.getSource();o instanceof y_&&(o=o.getSource()),console.assert(o instanceof Ii);const a=o.getFeatures(),l=new AR(s,this.scene),h=l.context;for(let c=0;c<a.length;++c){const u=a[c];if(!u)continue;const d=e.getStyleFunction(),f=this.computePlainStyle(e,u,d,r);if(!f||!f.length)continue;let g=null;for(let p=0;p<f.length;p++){const m=this.olFeatureToCesium(e,u,f[p],h);if(m){if(!g)g=m;else if(m){let v=0,y;for(;y=m.get(v);)g.add(y),v++}}}g&&(i[pt(u)]=g,l.getRootPrimitive().add(g))}return l}convert(e,t,i,s){const r=t.getProjection(),o=t.getResolution();if(o==null||!r)return null;const a=e.getStyleFunction(),l=this.computePlainStyle(e,i,a,o);if(!l||!l.length)return null;s.projection=r;let h=null;for(let c=0;c<l.length;c++){const u=this.olFeatureToCesium(e,i,l[c],s);if(!h)h=u;else if(u){let d=0,f;for(;f=u.get(d);)h.add(f),d++}}return h}}class kR extends w_{constructor(t,i,s){super(t,i);_(this,"converter");_(this,"csAllPrimitives_");this.converter=s||new OR(i),this.csAllPrimitives_=new Cesium.PrimitiveCollection,i.primitives.add(this.csAllPrimitives_),this.csAllPrimitives_.destroyPrimitives=!1}addCesiumObject(t){console.assert(t);const i=t.getRootPrimitive();i.counterpart=t,this.csAllPrimitives_.add(t.getRootPrimitive())}destroyCesiumObject(t){t.getRootPrimitive().destroy()}removeSingleCesiumObject(t,i){t.destroy(),this.csAllPrimitives_.destroyPrimitives=i,this.csAllPrimitives_.remove(t.getRootPrimitive()),this.csAllPrimitives_.destroyPrimitives=!1}removeAllCesiumObjects(t){if(this.csAllPrimitives_.destroyPrimitives=t,t)for(let i=0;i<this.csAllPrimitives_.length;++i)this.csAllPrimitives_.get(i).counterpart.destroy();this.csAllPrimitives_.removeAll(),this.csAllPrimitives_.destroyPrimitives=!1}updateLayerVisibility(t,i){let s=!0;[t.layer].concat(t.parents).forEach(r=>{const o=r.getVisible();o!==void 0?s=s&&o:s=!1}),i.show=s}createSingleLayerCounterparts(t){const i=t.layer;if(!(i instanceof Is)||i instanceof Ps)return null;console.assert(i instanceof Zs);let s=i.getSource();if(s instanceof y_&&(s=s.getSource()),!s)return null;console.assert(s instanceof Ii),console.assert(this.view);const r=this.view,o={},a=this.converter.olVectorLayerToCesium(i,r,o),l=a.getRootPrimitive(),h=a.olListenKeys;[t.layer].concat(t.parents).forEach(d=>{h.push(vr(d,"change:visible",()=>{this.updateLayerVisibility(t,l)}))}),this.updateLayerVisibility(t,l);const c=(function(d){const f=a.context,g=this.converter.convert(i,r,d,f);g&&(o[pt(d)]=g,l.add(g))}).bind(this),u=(function(d){const f=pt(d),g=a.context,p=g.featureToCesiumMap[f];p&&(delete g.featureToCesiumMap[f],p.forEach(v=>{v instanceof Cesium.Billboard&&g.billboards.remove(v)}));const m=o[f];delete o[f],m&&l.remove(m)}).bind(this);return h.push(vr(s,"addfeature",d=>{console.assert(d.feature),c(d.feature)})),h.push(vr(s,"removefeature",d=>{console.assert(d.feature),u(d.feature)})),h.push(vr(s,"changefeature",d=>{const f=d.feature;console.assert(f),u(f),c(f)})),a?[a]:null}}const It={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class NR extends Xi{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+cb,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(It.ELEMENT,this.handleElementChanged),this.addChangeListener(It.MAP,this.handleMapChanged),this.addChangeListener(It.OFFSET,this.handleOffsetChanged),this.addChangeListener(It.POSITION,this.handlePositionChanged),this.addChangeListener(It.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(It.ELEMENT)}getId(){return this.id}getMap(){return this.get(It.MAP)||null}getOffset(){return this.get(It.OFFSET)}getPosition(){return this.get(It.POSITION)}getPositioning(){return this.get(It.POSITIONING)}handleElementChanged(){ky(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(Bl(this.element),De(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=pe(e,wn.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(It.ELEMENT,e)}setMap(e){this.set(It.MAP,e)}setOffset(e){this.set(It.OFFSET,e)}setPosition(e){this.set(It.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(It.POSITION))return;const i=this.getRect(t.getTargetElement(),t.getSize()),s=this.getElement(),r=this.getRect(s,[G1(s),z1(s)]);e=e||{};const o=e.margin===void 0?20:e.margin;if(!Li(i,r)){const a=r[0]-i[0],l=i[2]-r[2],h=r[1]-i[1],c=i[3]-r[3],u=[0,0];if(a<0?u[0]=a-o:l<0&&(u[0]=Math.abs(l)+o),h<0?u[1]=h-o:c<0&&(u[1]=Math.abs(c)+o),u[0]!==0||u[1]!==0){const d=t.getView().getCenterInternal(),f=t.getPixelFromCoordinateInternal(d);if(!f)return;const g=[f[0]+u[0],f[1]+u[1]],p=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(g),duration:p.duration,easing:p.easing})}}}getRect(e,t){const i=e.getBoundingClientRect(),s=i.left+window.pageXOffset,r=i.top+window.pageYOffset;return[s,r,s+t[0],r+t[1]]}setPositioning(e){this.set(It.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const i=e.getPixelFromCoordinate(t),s=e.getSize();this.updateRenderedPosition(i,s)}updateRenderedPosition(e,t){const i=this.element.style,s=this.getOffset(),r=this.getPositioning();this.setVisible(!0);const o=Math.round(e[0]+s[0])+"px",a=Math.round(e[1]+s[1])+"px";let l="0%",h="0%";r=="bottom-right"||r=="center-right"||r=="top-right"?l="-100%":(r=="bottom-center"||r=="center-center"||r=="top-center")&&(l="-50%"),r=="bottom-left"||r=="bottom-center"||r=="bottom-right"?h="-100%":(r=="center-left"||r=="center-center"||r=="center-right")&&(h="-50%");const c=`translate(${l}, ${h}) translate(${o}, ${a})`;this.rendered.transform_!=c&&(this.rendered.transform_=c,i.transform=c)}getOptions(){return this.options}}const DR=NR;class GR extends DR{constructor(e){const t=e.parent;super(t.getOptions()),this.scenePostRenderListenerRemover_=null,this.scene_=e.scene,this.synchronizer_=e.synchronizer,this.parent_=t,this.positionWGS84_=void 0,this.observer_=new MutationObserver(this.handleElementChanged.bind(this)),this.attributeObserver_=[],this.listenerKeys_=[];const i=s=>this.setPropertyFromEvent_(s);this.listenerKeys_.push(this.parent_.on("change:position",i)),this.listenerKeys_.push(this.parent_.on("change:element",i)),this.listenerKeys_.push(this.parent_.on("change:offset",i)),this.listenerKeys_.push(this.parent_.on("change:position",i)),this.listenerKeys_.push(this.parent_.on("change:positioning",i)),this.setProperties(this.parent_.getProperties()),this.handleMapChanged(),this.handleElementChanged()}observeTarget_(e){if(this.observer_){this.observer_.disconnect(),this.observer_.observe(e,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),this.attributeObserver_.forEach(t=>{t.disconnect()}),this.attributeObserver_.length=0;for(let t=0;t<e.childNodes.length;t++){const i=e.childNodes[t];if(i.nodeType===1){const s=new MutationObserver(this.handleElementChanged.bind(this));s.observe(i,{attributes:!0,subtree:!0}),this.attributeObserver_.push(s)}}}}setPropertyFromEvent_(e){e.target&&e.key&&this.set(e.key,e.target.get(e.key))}getScene(){return this.scene_}handleMapChanged(){this.scenePostRenderListenerRemover_&&(this.scenePostRenderListenerRemover_(),vT(this.element)),this.scenePostRenderListenerRemover_=null;const e=this.getScene();if(e){this.scenePostRenderListenerRemover_=e.postRender.addEventListener(this.updatePixelPosition.bind(this)),this.updatePixelPosition();const t=this.stopEvent?this.synchronizer_.getOverlayContainerStopEvent():this.synchronizer_.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element)}}handlePositionChanged(){const e=this.getPosition();if(e){const t=this.parent_.getMap().getView().getProjection();this.positionWGS84_=Qn(e,t,"EPSG:4326")}else this.positionWGS84_=void 0;this.updatePixelPosition()}handleElementChanged(){function e(i,s){const r=i.cloneNode();i.nodeName==="CANVAS"&&r.getContext("2d").drawImage(i,0,0),s&&s.appendChild(r),i.nodeType!=Node.TEXT_NODE&&r.addEventListener("click",a=>{i.dispatchEvent(new MouseEvent("click",a)),a.stopPropagation()});const o=i.childNodes;for(let a=0;a<o.length;a++)o[a]&&e(o[a],r);return r}xT(this.element);const t=this.getElement();if(t&&t.parentNode&&t.parentNode.childNodes)for(const i of t.parentNode.childNodes){const s=e(i,null);this.element.appendChild(s)}t.parentNode&&this.observeTarget_(t.parentNode)}updatePixelPosition(){const e=this.positionWGS84_;if(!this.scene_||!e){this.setVisible(!1);return}let t=0;if(e.length===2){const u=this.scene_.globe.getHeight(Cesium.Cartographic.fromDegrees(e[0],e[1]));u&&this.scene_.globe.tilesLoaded&&(e[2]=u),u&&(t=u)}else t=e[2];const i=Cesium.Cartesian3.fromDegrees(e[0],e[1],t),s=this.scene_.camera,r=new Cesium.BoundingSphere(new Cesium.Cartesian3,6356752);if(!new Cesium.Occluder(r,s.position).isPointVisible(i)){this.setVisible(!1);return}if(s.frustum.computeCullingVolume(s.position,s.direction,s.up).computeVisibility(new Cesium.BoundingSphere(i))!==1){this.setVisible(!1);return}this.setVisible(!0);const l=this.scene_.cartesianToCanvasCoordinates(i),h=[l.x,l.y],c=[this.scene_.canvas.width,this.scene_.canvas.height];this.updateRenderedPosition(h,c)}destroy(){this.scenePostRenderListenerRemover_&&this.scenePostRenderListenerRemover_(),this.observer_&&this.observer_.disconnect(),Bi(this.listenerKeys_),this.listenerKeys_.splice(0),this.element.removeNode?this.element.removeNode(!0):this.element.remove(),this.element=null}}class zR{constructor(e,t){this.map=e,this.overlays_=this.map.getOverlays(),this.scene=t,this.overlayContainerStopEvent_=document.createElement("DIV"),this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",["click","dblclick","mousedown","touchstart","pointerdown","mousewheel","wheel"].forEach(s=>{this.overlayContainerStopEvent_.addEventListener(s,r=>r.stopPropagation())}),this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_),this.overlayContainer_=document.createElement("DIV"),this.overlayContainer_.className="ol-overlaycontainer",this.scene.canvas.parentElement.appendChild(this.overlayContainer_),this.overlayMap_={}}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOverlayContainer(){return this.overlayContainer_}synchronize(){this.destroyAll(),this.addOverlays(),this.overlays_.on("add",this.addOverlayFromEvent_.bind(this)),this.overlays_.on("remove",this.removeOverlayFromEvent_.bind(this))}addOverlayFromEvent_(e){const t=e.element;this.addOverlay(t)}addOverlays(){this.overlays_.forEach(e=>{this.addOverlay(e)})}addOverlay(e){if(!e)return;const t=new GR({scene:this.scene,synchronizer:this,parent:e}),i=pt(e).toString();this.overlayMap_[i]=t}removeOverlayFromEvent_(e){const t=e.element;this.removeOverlay(t)}removeOverlay(e){const t=pt(e).toString(),i=this.overlayMap_[t];i&&(i.destroy(),delete this.overlayMap_[t])}destroyAll(){Object.keys(this.overlayMap_).forEach(e=>{this.overlayMap_[e].destroy(),delete this.overlayMap_[e]})}}const jc={DONE:0,PENDING:1,FAILED:2};class jf{constructor(e){_(this,"autoRenderLoop_",null);_(this,"map_");_(this,"time_");_(this,"to4326Transform_");_(this,"resolutionScale_",1);_(this,"canvasClientWidth_",0);_(this,"canvasClientHeight_",0);_(this,"resolutionScaleChanged_",!0);_(this,"container_");_(this,"isOverMap_");_(this,"canvas_");_(this,"enabled_",!1);_(this,"pausedInteractions_",[]);_(this,"hiddenRootGroup_",null);_(this,"scene_");_(this,"camera_");_(this,"globe_");_(this,"dataSourceCollection_");_(this,"dataSourceDisplay_");_(this,"lastFrameTime_",0);_(this,"renderId_");_(this,"targetFrameRate_",Number.POSITIVE_INFINITY);_(this,"blockCesiumRendering_",!1);_(this,"warmingUp_",!1);_(this,"trackedFeature_",null);_(this,"trackedEntity_",null);_(this,"entityView_",null);_(this,"needTrackedEntityUpdate_",!1);_(this,"boundingSphereScratch_",new Cesium.BoundingSphere);_(this,"synchronizers_");this.map_=e.map,this.time_=e.time||function(){return Cesium.JulianDate.now()},this.to4326Transform_=as(this.map_.getView().getProjection(),"EPSG:4326");const t="position:absolute;top:0;left:0;width:100%;height:100%;touch-action:none";this.container_=document.createElement("DIV");const i=document.createAttribute("style");i.value=`${t}visibility:hidden;`,this.container_.setAttributeNode(i);let s=e.target||this.map_.getViewport();if(typeof s=="string"&&(s=document.getElementById(s)),s.appendChild(this.container_),this.isOverMap_=!e.target,this.isOverMap_&&e.stopOpenLayersEventsPropagation){const c=["click","dblclick","mousedown","touchstart","pointerdown","mousewheel","wheel"];for(let u=0,d=c.length;u<d;++u)this.container_.addEventListener(c[u],f=>f.stopPropagation())}this.canvas_=document.createElement("canvas");const r=document.createAttribute("style");r.value=t,this.canvas_.setAttributeNode(r),Wu()&&(this.canvas_.style.imageRendering=mT()),this.canvas_.oncontextmenu=function(){return!1},this.canvas_.onselectstart=function(){return!1},this.container_.appendChild(this.canvas_);const o=e.sceneOptions!==void 0?{...e.sceneOptions,canvas:this.canvas_,scene3DOnly:!0}:{canvas:this.canvas_,scene3DOnly:!0};this.scene_=new Cesium.Scene(o);const a=this.scene_.screenSpaceCameraController;Array.isArray(a.tiltEventTypes)?(a.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.SHIFT}),a.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.ALT})):console.log("sscc is not an array"),a.enableLook=!1,this.scene_.camera.constrainedAxis=Cesium.Cartesian3.UNIT_Z,this.camera_=new wr(this.scene_,this.map_),this.globe_=new Cesium.Globe(Cesium.Ellipsoid.WGS84),this.globe_.baseColor=Cesium.Color.WHITE,this.scene_.globe=this.globe_,this.scene_.skyAtmosphere=new Cesium.SkyAtmosphere;const l=new Cesium.SingleTileImageryProvider({tileHeight:1,tileWidth:1,url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",rectangle:Cesium.Rectangle.fromDegrees(0,0,1,1)});this.globe_.imageryLayers.addImageryProvider(l,0),this.dataSourceCollection_=new Cesium.DataSourceCollection,this.dataSourceDisplay_=new Cesium.DataSourceDisplay({scene:this.scene_,dataSourceCollection:this.dataSourceCollection_}),this.synchronizers_=e.createSynchronizers?e.createSynchronizers(this.map_,this.scene_,this.dataSourceCollection_):[new FR(this.map_,this.scene_),new kR(this.map_,this.scene_),new zR(this.map_,this.scene_)],this.handleResize_();for(let c=this.synchronizers_.length-1;c>=0;--c)this.synchronizers_[c].synchronize();new Cesium.EventHelper().add(this.scene_.postRender,jf.prototype.updateTrackedEntity_,this)}destroy(){cancelAnimationFrame(this.renderId_),this.renderId_=void 0,this.synchronizers_.forEach(e=>e.destroyAll()),this.camera_.destroy(),this.scene_.destroy(),this.scene_._postRender=null,this.container_.remove()}render_(){this.renderId_!==void 0&&(cancelAnimationFrame(this.renderId_),this.renderId_=void 0),(this.enabled_||this.warmingUp_)&&!this.blockCesiumRendering_&&(this.renderId_=requestAnimationFrame(this.onAnimationFrame_.bind(this)))}onAnimationFrame_(e){this.renderId_=void 0;const t=1e3/this.targetFrameRate_;if(e-this.lastFrameTime_<t){this.render_();return}this.lastFrameTime_=e;const s=this.time_();if(this.scene_.initializeFrame(),this.handleResize_(),this.dataSourceDisplay_.update(s),this.entityView_){const r=this.trackedEntity_;this.dataSourceDisplay_.getBoundingSphere(r,!1,this.boundingSphereScratch_)===jc.DONE&&(this.boundingSphereScratch_.radius=1,this.entityView_.update(s,this.boundingSphereScratch_))}this.scene_.render(s),this.camera_.checkCameraChange(),this.render_()}updateTrackedEntity_(){if(!this.needTrackedEntityUpdate_)return;const e=this.trackedEntity_,t=this.scene_,i=this.dataSourceDisplay_.getBoundingSphere(e,!1,this.boundingSphereScratch_);if(i===jc.PENDING)return;t.screenSpaceCameraController.enableTilt=!1;const s=i!==jc.FAILED?this.boundingSphereScratch_:void 0;s&&(s.radius=1),this.entityView_=new Cesium.EntityView(e,t,t.mapProjection.ellipsoid),this.entityView_.update(this.time_(),s),this.needTrackedEntityUpdate_=!1}handleResize_(){let e=this.canvas_.clientWidth,t=this.canvas_.clientHeight;if(e===0||t===0||e===this.canvasClientWidth_&&t===this.canvasClientHeight_&&!this.resolutionScaleChanged_)return;let i=this.resolutionScale_;Wu()||(i*=window.devicePixelRatio||1),this.resolutionScaleChanged_=!1,this.canvasClientWidth_=e,this.canvasClientHeight_=t,e*=i,t*=i,this.canvas_.width=e,this.canvas_.height=t,this.scene_.camera.frustum.aspectRatio=e/t}getCamera(){return this.camera_}getOlMap(){return this.map_}getOlView(){const e=this.map_.getView();return console.assert(e),e}getCesiumScene(){return this.scene_}getDataSources(){return this.dataSourceCollection_}getDataSourceDisplay(){return this.dataSourceDisplay_}getEnabled(){return this.enabled_}setEnabled(e){if(this.enabled_===e)return;this.enabled_=e,this.container_.style.visibility=this.enabled_?"visible":"hidden";let t;if(this.enabled_){if(this.throwOnUnitializedMap_(),this.isOverMap_){t=this.map_.getInteractions(),t.forEach((s,r,o)=>{this.pausedInteractions_.push(s)}),t.clear(),this.map_.addInteraction=s=>this.pausedInteractions_.push(s),this.map_.removeInteraction=s=>{let r=!1;return this.pausedInteractions_=this.pausedInteractions_.filter(o=>{const a=o!==s;return r||(r=a),a}),r?s:void 0};const i=this.map_.getLayerGroup();i.getVisible()&&(this.hiddenRootGroup_=i,this.hiddenRootGroup_.setVisible(!1)),this.map_.getOverlayContainer().classList.add("olcs-hideoverlay")}this.camera_.readFromView(),this.render_()}else this.isOverMap_&&(t=this.map_.getInteractions(),this.pausedInteractions_.forEach(i=>{t.push(i)}),this.pausedInteractions_.length=0,this.map_.addInteraction=i=>this.map_.getInteractions().push(i),this.map_.removeInteraction=i=>this.map_.getInteractions().remove(i),this.map_.getOverlayContainer().classList.remove("olcs-hideoverlay"),this.hiddenRootGroup_&&(this.hiddenRootGroup_.setVisible(!0),this.hiddenRootGroup_=null)),this.camera_.updateView()}warmUp(e,t){if(this.enabled_)return;this.throwOnUnitializedMap_(),this.camera_.readFromView();const i=this.globe_.ellipsoid,s=this.scene_.camera,r=i.cartesianToCartographic(s.position);r.height<e&&(r.height=e,s.position=i.cartographicToCartesian(r)),this.warmingUp_=!0,this.render_(),setTimeout(()=>{this.warmingUp_=!1},t)}setBlockCesiumRendering(e){this.blockCesiumRendering_!==e&&(this.blockCesiumRendering_=e,this.render_())}enableAutoRenderLoop(){this.autoRenderLoop_||(this.autoRenderLoop_=new PR(this))}getAutoRenderLoop(){return this.autoRenderLoop_}setResolutionScale(e){e=Math.max(0,e),e!==this.resolutionScale_&&(this.resolutionScale_=Math.max(0,e),this.resolutionScaleChanged_=!0,this.autoRenderLoop_&&this.autoRenderLoop_.restartRenderLoop())}setTargetFrameRate(e){this.targetFrameRate_!==e&&(this.targetFrameRate_=e,this.render_())}throwOnUnitializedMap_(){const t=this.map_.getView(),i=t.getCenter();if(!t.isDef()||isNaN(i[0])||isNaN(i[1]))throw new Error(`The OpenLayers map is not properly initialized: ${i} / ${t.getResolution()}`)}get trackedFeature(){return this.trackedFeature_}set trackedFeature(e){if(this.trackedFeature_!==e){const t=this.scene_;if(!e||!e.getGeometry()){this.needTrackedEntityUpdate_=!1,t.screenSpaceCameraController.enableTilt=!0,this.trackedEntity_&&this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_),this.trackedEntity_=null,this.trackedFeature_=null,this.entityView_=null,t.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);return}this.trackedFeature_=e,this.needTrackedEntityUpdate_=!0;const i=this.to4326Transform_,s=function(){const o=e.getGeometry();console.assert(o instanceof Ht);const a=o instanceof Ht?o.getCoordinates():[],l=i(a,void 0,a.length);return xr(l)},r={position:new Cesium.CallbackProperty((o,a)=>s(),!1),point:{pixelSize:1,color:Cesium.Color.TRANSPARENT}};this.trackedEntity_=this.dataSourceDisplay_.defaultDataSource.entities.add(r)}}}class ii{}_(ii,"INCHES_PER_METER",39.37),_(ii,"PRINT_DOTS_PER_INCH",72),_(ii,"SCREEN_DOTS_PER_INCH",96),_(ii,"METERS_PER_UNIT",Ds);class BR extends Zs{constructor(t={}){super(t);_(this,"size",null);_(this,"scale",null);_(this,"context");this.context=St(),this.context.canvas.style.opacity="0.5",this.context.canvas.style.position="absolute"}updateSize(t){this.size=t}updateScale(t){this.scale=t}getRotation(){return 0}render(t){if(this.size===null)throw Error("Cannot render Mask : size has not been set.");if(this.scale===null)throw Error("Cannot render Mask : scale has not been set.");const i=t.size[0];this.context.canvas.width=i;const s=t.size[1];this.context.canvas.height=s;const r=[i/2,s/2];this.context.beginPath(),this.context.moveTo(0,0),this.context.lineTo(i,0),this.context.lineTo(i,s),this.context.lineTo(0,s),this.context.lineTo(0,0),this.context.closePath();const o=this.size[1],a=this.size[0],l=t.viewState.resolution,h=a/ii.PRINT_DOTS_PER_INCH/ii.INCHES_PER_METER*this.scale/l/2,c=o/ii.PRINT_DOTS_PER_INCH/ii.INCHES_PER_METER*this.scale/l/2,u=this.getRotation!==void 0?Rs(this.getRotation()):0,d=Math.sqrt(Math.pow(h,2)+Math.pow(c,2)),f=Math.atan(c/h)-u,g=Math.atan(h/c)-u,p=r[0]-Math.cos(f)*d,m=r[1]+Math.sin(f)*d,v=r[0]+Math.sin(g)*d,y=r[1]+Math.cos(g)*d,x=r[0]+Math.cos(f)*d,w=r[1]-Math.sin(f)*d,b=r[0]-Math.sin(g)*d,E=r[1]-Math.cos(g)*d;return this.context.moveTo(p,m),this.context.lineTo(v,y),this.context.lineTo(x,w),this.context.lineTo(b,E),this.context.lineTo(p,m),this.context.closePath(),this.context.fillStyle="#000",this.context.fill(),this.context.canvas}}var kh,b_,Nh,E_,ga,Zu,Dh,C_,Gh,M_;class UR{constructor(e,t,i,s){se(this,kh);se(this,Nh);se(this,ga);se(this,Dh);se(this,Gh);_(this,"map");_(this,"swiper");_(this,"swiperEventListeners",{});_(this,"swiperMaxVal");_(this,"wmtsManager");_(this,"wmsManager");this.map=e,this.swiper=t;const r=t.getAttribute("max");if(!r)throw new Error("The Attribute <max> on the swiper is not defined !");this.swiperMaxVal=parseInt(r),this.wmtsManager=i,this.wmsManager=s}activateSwipeForWmts(e,t){if(this.wmtsManager.layerExists(e)){const i=this.wmtsManager.getLayer(e);ae(this,ga,Zu).call(this,e.layers,i,t)}else throw new Error("Cannot swipe this layer: it does not exist.")}activateSwipeForWms(e,t){if(this.wmsManager.layerExists(e)){this.wmsManager.makeLayerIndependent(e);const i=this.wmsManager.getOLayer(e);ae(this,ga,Zu).call(this,e.name,i,t)}else throw new Error("Layer does not exists. Cannot activate swiper.")}deactivateSwipe(){for(const[e,t]of Object.entries(this.swiperEventListeners))t.olayer.removeEventListener("prerender",t.prerender),t.olayer.removeEventListener("postrender",t.postrender);ae(this,Nh,E_).call(this),this.map.render()}}kh=new WeakSet,b_=function(){this.swiper.style.display="block"},Nh=new WeakSet,E_=function(){this.swiper.style.display="none"},ga=new WeakSet,Zu=function(e,t,i){if(e in this.swiperEventListeners){const o=this.swiperEventListeners[e];t.removeEventListener("prerender",o.prerender),t.removeEventListener("postrender",o.postrender),delete this.swiperEventListeners[e]}const s=o=>ae(this,Dh,C_).call(this,o,i),r=o=>ae(this,Gh,M_).call(this,o);this.swiperEventListeners[e]={olayer:t,prerender:s,postrender:r},t.addEventListener("prerender",s),t.addEventListener("postrender",r),ae(this,kh,b_).call(this),this.map.render()},Dh=new WeakSet,C_=function(e,t){const i=e.context,s=this.map.getSize();if(!s)throw new Error("The size of the map is null !");const r=s,o=r[0]*(parseInt(this.swiper.value)/this.swiperMaxVal);let a=null,l=null,h=null,c=null;if(t==="right")a=Gn(e,[o,0]),l=Gn(e,[r[0],0]),h=Gn(e,[o,r[1]]),c=Gn(e,r);else if(t==="left")a=Gn(e,[0,0]),l=Gn(e,[o,0]),h=Gn(e,[0,r[1]]),c=Gn(e,[o,r[1]]);else throw new Error("Invalid value for parameter side");i.save(),i.beginPath(),i.moveTo(a[0],a[1]),i.lineTo(h[0],h[1]),i.lineTo(c[0],c[1]),i.lineTo(l[0],l[1]),i.closePath(),i.clip()},Gh=new WeakSet,M_=function(e){e.context.restore()};var $n,hr,Ur,Ll;class jR{constructor(e,t){se(this,$n);se(this,Ur);_(this,"map");_(this,"srid");_(this,"messageManager");_(this,"layerManager");_(this,"layersByUniqueServerId",{});_(this,"independentLayers",{});_(this,"basemapLayers",[]);this.map=e,this.srid=t,this.messageManager=md.getInstance(),this.layerManager=ya.getInstance()}removeAllBasemapLayers(){this.basemapLayers.forEach(e=>{this.map.removeLayer(e)}),this.basemapLayers=[]}addLayer(e){if(e.serverUniqueQueryId in this.layersByUniqueServerId){const t=this.layersByUniqueServerId[e.serverUniqueQueryId];t.layersWms.push(e);const i=ae(this,$n,hr).call(this,t.layersWms);t.olayer.setSource(i)}else{const t=new Rl,i=ae(this,$n,hr).call(this,[e]);t.setSource(i),this.map.addLayer(t);const s={olayer:t,layersWms:[e]};this.layersByUniqueServerId[e.serverUniqueQueryId]=s}ae(this,Ur,Ll).call(this,e)}addBasemapLayer(e){const t=ae(this,$n,hr).call(this,[e]),i=new Rl({source:t,opacity:e.opacity});this.basemapLayers.push(i),this.map.getLayers().insertAt(0,i)}removeLayer(e){if(this.layerExists(e))if(e.treeItemId in this.independentLayers){const t=this.independentLayers[e.treeItemId].olayer;delete this.independentLayers[e.treeItemId],this.map.removeLayer(t)}else if(e.serverUniqueQueryId in this.layersByUniqueServerId){const t=this.layersByUniqueServerId[e.serverUniqueQueryId];if(t.layersWms=t.layersWms.filter(i=>i.treeItemId!==e.treeItemId),t.layersWms.length>0){const i=ae(this,$n,hr).call(this,t.layersWms);t.olayer.setSource(i)}else delete this.layersByUniqueServerId[e.serverUniqueQueryId],this.map.removeLayer(t.olayer)}else console.warn("Nothing to remove !");else console.error(`Cannot remove WMS-Layer ${e.name} from the map: it does not exist!`)}layerExists(e){return e.treeItemId in this.independentLayers?!0:e.serverUniqueQueryId in this.layersByUniqueServerId?this.layersByUniqueServerId[e.serverUniqueQueryId].layersWms.find(s=>s.treeItemId===e.treeItemId)!==void 0:!1}getOLayer(e){return e.treeItemId in this.independentLayers?this.independentLayers[e.treeItemId].olayer:e.serverUniqueQueryId in this.layersByUniqueServerId?this.layersByUniqueServerId[e.serverUniqueQueryId].olayer:null}changeOpacity(e){ae(this,Ur,Ll).call(this,e)}changeFilter(e){ae(this,Ur,Ll).call(this,e)}makeLayerIndependent(e){if(!(e.name in this.independentLayers))if(e.serverUniqueQueryId in this.layersByUniqueServerId){this.removeLayer(e);const t=ae(this,$n,hr).call(this,[e]),i=new Rl({source:t,opacity:e.opacity});e.hasFilter&&t.updateParams({FILTER:e.filter}),this.independentLayers[e.treeItemId]={layerWms:e,olayer:i},this.map.addLayer(i)}else throw new Error("A layer can be made independent only if it has already been added to the map.")}selectFeatures(e){const t=[];for(const i in this.layersByUniqueServerId){const s=this.layersByUniqueServerId[i];t.push({layers:s.layersWms,selectionBox:e,srid:this.srid})}for(const i in this.independentLayers){const s=this.independentLayers[i];t.push({layers:[s.layerWms],selectionBox:e,srid:this.srid})}an.getInstance().state.selection.selectionParameters=t}}$n=new WeakSet,hr=function(e){const t=e[0].url;if(!e.every(h=>h.url===t))throw new Error("Not all layers of this list have the same server URL. We should not be in this function.");const s=e[0].imageType;if(!e.every(h=>h.url===t))throw new Error("Not all layers of this list have the same image type. We should not be in this function.");const a=e.slice().sort((h,c)=>c.order-h.order).map(h=>h.layers),l=new Bd({url:t,params:{LAYERS:a,FORMAT:s}});return l.on("imageloaderror",()=>{for(const h of e)this.layerManager.setError(h,"Image cannot be loaded from WMS Server")}),l.on("imageloadend",()=>{for(const h of e)this.layerManager.unsetError(h)}),l},Ur=new WeakSet,Ll=function(e){if(!this.layerExists(e))throw new Error("Cannot change filter for this layer: it does not exist");if(!e.hasFilter&&!e.isTransparent){if(e.treeItemId in this.independentLayers){const t=this.independentLayers[e.treeItemId].olayer;delete this.independentLayers[e.treeItemId],this.map.removeLayer(t),this.addLayer(e)}}else if(e.treeItemId in this.independentLayers){const t=this.independentLayers[e.treeItemId].olayer;e.isTransparent&&t.setOpacity(e.opacity),e.hasFilter&&t.getSource().updateParams({FILTER:e.filter})}else e.serverUniqueQueryId in this.layersByUniqueServerId&&this.makeLayerIndependent(e)};class $R{constructor(e,t){_(this,"map");_(this,"srid");_(this,"basemapLayers",[]);this.map=e,this.srid=t}removeAllBasemapLayers(){this.basemapLayers.forEach(e=>{this.map.removeLayer(e)}),this.basemapLayers=[]}addBasemapLayer(){const e=new Nf({source:new lR});this.basemapLayers.push(e),this.map.getLayers().insertAt(0,e)}}function S_(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var qR={},T_,sm={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ko(n){return n=Math.round(n),n<0?0:n>255?255:n}function rm(n){return n<0?0:n>1?1:n}function $c(n){return n[n.length-1]==="%"?ko(parseFloat(n)/100*255):ko(parseInt(n))}function ml(n){return n[n.length-1]==="%"?rm(parseFloat(n)/100):rm(parseFloat(n))}function qc(n,e,t){return t<0?t+=1:t>1&&(t-=1),t*6<1?n+(e-n)*t*6:t*2<1?e:t*3<2?n+(e-n)*(2/3-t)*6:n}function VR(n){var e=n.replace(/ /g,"").toLowerCase();if(e in sm)return sm[e].slice();if(e[0]==="#"){if(e.length===4){var t=parseInt(e.substr(1),16);return t>=0&&t<=4095?[(t&3840)>>4|(t&3840)>>8,t&240|(t&240)>>4,t&15|(t&15)<<4,1]:null}else if(e.length===7){var t=parseInt(e.substr(1),16);return t>=0&&t<=16777215?[(t&16711680)>>16,(t&65280)>>8,t&255,1]:null}return null}var i=e.indexOf("("),s=e.indexOf(")");if(i!==-1&&s+1===e.length){var r=e.substr(0,i),o=e.substr(i+1,s-(i+1)).split(","),a=1;switch(r){case"rgba":if(o.length!==4)return null;a=ml(o.pop());case"rgb":return o.length!==3?null:[$c(o[0]),$c(o[1]),$c(o[2]),a];case"hsla":if(o.length!==4)return null;a=ml(o.pop());case"hsl":if(o.length!==3)return null;var l=(parseFloat(o[0])%360+360)%360/360,h=ml(o[1]),c=ml(o[2]),u=c<=.5?c*(h+1):c+h-c*h,d=c*2-u;return[ko(qc(d,u,l+1/3)*255),ko(qc(d,u,l)*255),ko(qc(d,u,l-1/3)*255),a];default:return null}}return null}try{T_=qR.parseCSSColor=VR}catch{}let Hi=class Ku{constructor(e,t,i,s=1){this.r=e,this.g=t,this.b=i,this.a=s}static parse(e){if(!e)return;if(e instanceof Ku)return e;if(typeof e!="string")return;const t=T_(e);if(t)return new Ku(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3])}toString(){const[e,t,i,s]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(i)},${s})`}toArray(){const{r:e,g:t,b:i,a:s}=this;return s===0?[0,0,0,0]:[e*255/s,t*255/s,i*255/s,s]}toArray01(){const{r:e,g:t,b:i,a:s}=this;return s===0?[0,0,0,0]:[e/s,t/s,i/s,s]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:i,a:s}=this;return[e,t,i,s]}};Hi.black=new Hi(0,0,0,1);Hi.white=new Hi(1,1,1,1);Hi.transparent=new Hi(0,0,0,0);Hi.red=new Hi(1,0,0,1);Hi.blue=new Hi(0,0,1,1);var yi=Hi;function Qo(n){return typeof n=="object"?["literal",n]:n}function WR(n,e){let t=n.stops;if(!t)return HR(n,e);const i=t&&typeof t[0][0]=="object",s=i||n.property!==void 0,r=i||!s;return t=t.map(o=>!s&&e.tokens&&typeof o[1]=="string"?[o[0],KR(o[1])]:[o[0],Qo(o[1])]),i?XR(n,e,t):r?ZR(n,e,t):Ju(n,e,t)}function HR(n,e){const t=["get",n.property];if(n.default===void 0)return e.type==="string"?["string",t]:t;if(e.type==="enum")return["match",t,Object.keys(e.values),t,n.default];{const i=[e.type==="color"?"to-color":e.type,t,Qo(n.default)];return e.type==="array"&&i.splice(1,0,e.value,e.length||null),i}}function $f(n){switch(n.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function XR(n,e,t){const i={},s={},r=[];for(let a=0;a<t.length;a++){const l=t[a],h=l[0].zoom;i[h]===void 0&&(i[h]={zoom:h,type:n.type,property:n.property,default:n.default},s[h]=[],r.push(h)),s[h].push([l[0].value,l[1]])}if(Vf({},e)==="exponential"){const a=[$f(n),["linear"],["zoom"]];for(const l of r){const h=Ju(i[l],e,s[l]);Ar(a,l,h,!1)}return a}else{const a=["step",["zoom"]];for(const l of r){const h=Ju(i[l],e,s[l]);Ar(a,l,h,!0)}return qf(a),a}}function YR(n,e){if(n!==void 0)return n;if(e!==void 0)return e}function om(n,e){const t=Qo(YR(n.default,e.default));return t===void 0&&e.type==="resolvedImage"?"":t}function Ju(n,e,t){const i=Vf(n,e),s=["get",n.property];if(i==="categorical"&&typeof t[0][0]=="boolean"){const r=["case"];for(const o of t)r.push(["==",s,o[0]],o[1]);return r.push(om(n,e)),r}else if(i==="categorical"){const r=["match",s];for(const o of t)Ar(r,o[0],o[1],!1);return r.push(om(n,e)),r}else if(i==="interval"){const r=["step",["number",s]];for(const o of t)Ar(r,o[0],o[1],!0);return qf(r),n.default===void 0?r:["case",["==",["typeof",s],"number"],r,Qo(n.default)]}else if(i==="exponential"){const r=n.base!==void 0?n.base:1,o=[$f(n),r===1?["linear"]:["exponential",r],["number",s]];for(const a of t)Ar(o,a[0],a[1],!1);return n.default===void 0?o:["case",["==",["typeof",s],"number"],o,Qo(n.default)]}else throw new Error(`Unknown property function type ${i}`)}function ZR(n,e,t,i=["zoom"]){const s=Vf(n,e);let r,o=!1;if(s==="interval")r=["step",i],o=!0;else if(s==="exponential"){const a=n.base!==void 0?n.base:1;r=[$f(n),a===1?["linear"]:["exponential",a],i]}else throw new Error(`Unknown zoom function type "${s}"`);for(const a of t)Ar(r,a[0],a[1],o);return qf(r),r}function qf(n){n[0]==="step"&&n.length===3&&(n.push(0),n.push(n[3]))}function Ar(n,e,t,i){n.length>3&&e===n[n.length-2]||(i&&n.length===2||n.push(e),n.push(t))}function Vf(n,e){return n.type?n.type:e.expression.interpolated?"exponential":"interval"}function KR(n){const e=["concat"],t=/{([^{}]+)}/g;let i=0;for(let s=t.exec(n);s!==null;s=t.exec(n)){const r=n.slice(i,t.lastIndex-s[0].length);i=t.lastIndex,r.length>0&&e.push(r),e.push(["get",s[1]])}if(e.length===1)return n;if(i<n.length)e.push(n.slice(i));else if(e.length===2)return["to-string",e[1]];return e}class JR extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var nn=JR;class Wf{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[i,s]of t)this.bindings[i]=s}concat(e){return new Wf(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return this.bindings[e]?!0:this.parent?this.parent.has(e):!1}}var QR=Wf;const ac={kind:"null"},D={kind:"number"},ge={kind:"string"},le={kind:"boolean"},Ln={kind:"color"},Fr={kind:"object"},he={kind:"value"},eL={kind:"error"},lc={kind:"collator"},hc={kind:"formatted"},Na={kind:"resolvedImage"};function Ri(n,e){return{kind:"array",itemType:n,N:e}}function Xe(n){if(n.kind==="array"){const e=Xe(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}else return n.kind}const tL=[ac,D,ge,le,Ln,hc,Fr,Ri(he),Na];function ea(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ea(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const t of tL)if(!ea(t,e))return null}}return`Expected ${Xe(n)} but found ${Xe(e)} instead.`}function Hf(n,e){return e.some(t=>t.kind===n.kind)}function ta(n,e){return e.some(t=>t==="null"?n===null:t==="array"?Array.isArray(n):t==="object"?n&&!Array.isArray(n)&&typeof n=="object":t===typeof n)}class Xf{constructor(e,t,i){e?this.sensitivity=t?"variant":"case":this.sensitivity=t?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Qu{constructor(e,t,i,s,r){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=i,this.fontStack=s,this.textColor=r}}class cn{constructor(e){this.sections=e}static fromString(e){return new cn([new Qu(e,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof cn?e:cn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const i={};t.fontStack&&(i["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(i["font-scale"]=t.scale),t.textColor&&(i["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(i)}return e}}class fs{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new fs({name:e,available:!1}):null}serialize(){return["image",this.name]}}function R_(n,e,t,i){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255?typeof i>"u"||typeof i=="number"&&i>=0&&i<=1?null:`Invalid rgba value [${[n,e,t,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof i=="number"?[n,e,t,i]:[n,e,t]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function uh(n){if(n===null)return!0;if(typeof n=="string")return!0;if(typeof n=="boolean")return!0;if(typeof n=="number")return!0;if(n instanceof yi)return!0;if(n instanceof Xf)return!0;if(n instanceof cn)return!0;if(n instanceof fs)return!0;if(Array.isArray(n)){for(const e of n)if(!uh(e))return!1;return!0}else if(typeof n=="object"){for(const e in n)if(!uh(n[e]))return!1;return!0}else return!1}function mt(n){if(n===null)return ac;if(typeof n=="string")return ge;if(typeof n=="boolean")return le;if(typeof n=="number")return D;if(n instanceof yi)return Ln;if(n instanceof Xf)return lc;if(n instanceof cn)return hc;if(n instanceof fs)return Na;if(Array.isArray(n)){const e=n.length;let t;for(const i of n){const s=mt(i);if(!t)t=s;else{if(t===s)continue;t=he;break}}return Ri(t||he,e)}else return Fr}function No(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof yi||n instanceof cn||n instanceof fs?n.toString():JSON.stringify(n)}class Yf{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(e.length!==2)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!uh(e[1]))return t.error("invalid value");const i=e[1];let s=mt(i);const r=t.expectedType;return s.kind==="array"&&s.N===0&&r&&r.kind==="array"&&(typeof r.N!="number"||r.N===0)&&(s=r),new Yf(s,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof yi?["rgba"].concat(this.value.toArray()):this.value instanceof cn?this.value.serialize():this.value}}var dh=Yf;class iL{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}var Mt=iL;const Vc={string:ge,number:D,boolean:le,object:Fr};class Zf{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let i=1,s;const r=e[0];if(r==="array"){let a;if(e.length>2){const h=e[1];if(typeof h!="string"||!(h in Vc)||h==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);a=Vc[h],i++}else a=he;let l;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);l=e[2],i++}s=Ri(a,l)}else s=Vc[r];const o=[];for(;i<e.length;i++){const a=t.parse(e[i],i,he);if(!a)return null;o.push(a)}return new Zf(s,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const i=this.args[t].evaluate(e);if(ea(this.type,mt(i))){if(t===this.args.length-1)throw new Mt(`Expected value to be of type ${Xe(this.type)}, but found ${Xe(mt(i))} instead.`)}else return i}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,t=[e.kind];if(e.kind==="array"){const i=e.itemType;if(i.kind==="string"||i.kind==="number"||i.kind==="boolean"){t.push(i.kind);const s=e.N;(typeof s=="number"||this.args.length>1)&&t.push(s)}}return t.concat(this.args.map(i=>i.serialize()))}}var bn=Zf;class cc{constructor(e){this.type=hc,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&typeof i=="object")return t.error("First argument must be an image or text section.");const s=[];let r=!1;for(let o=1;o<=e.length-1;++o){const a=e[o];if(r&&typeof a=="object"&&!Array.isArray(a)){r=!1;let l=null;if(a["font-scale"]&&(l=t.parse(a["font-scale"],1,D),!l))return null;let h=null;if(a["text-font"]&&(h=t.parse(a["text-font"],1,Ri(ge)),!h))return null;let c=null;if(a["text-color"]&&(c=t.parse(a["text-color"],1,Ln),!c))return null;const u=s[s.length-1];u.scale=l,u.font=h,u.textColor=c}else{const l=t.parse(e[o],1,he);if(!l)return null;const h=l.type.kind;if(h!=="string"&&h!=="value"&&h!=="null"&&h!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,s.push({content:l,scale:null,font:null,textColor:null})}}return new cc(s)}evaluate(e){const t=i=>{const s=i.content.evaluate(e);return mt(s)===Na?new Qu("",s,null,null,null):new Qu(No(s),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)};return new cn(this.sections.map(t))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const i={};t.scale&&(i["font-scale"]=t.scale.serialize()),t.font&&(i["text-font"]=t.font.serialize()),t.textColor&&(i["text-color"]=t.textColor.serialize()),e.push(i)}return e}}class uc{constructor(e){this.type=Na,this.input=e}static parse(e,t){if(e.length!==2)return t.error("Expected two arguments.");const i=t.parse(e[1],1,ge);return i?new uc(i):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),i=fs.fromString(t);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(t)>-1),i}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const nL={"to-boolean":le,"to-color":Ln,"to-number":D,"to-string":ge};class Kf{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[0];if((i==="to-boolean"||i==="to-string")&&e.length!==2)return t.error("Expected one argument.");const s=nL[i],r=[];for(let o=1;o<e.length;o++){const a=t.parse(e[o],o,he);if(!a)return null;r.push(a)}return new Kf(s,r)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let t,i;for(const s of this.args){if(t=s.evaluate(e),i=null,t instanceof yi)return t;if(typeof t=="string"){const r=e.parseColor(t);if(r)return r}else if(Array.isArray(t)&&(t.length<3||t.length>4?i=`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:i=R_(t[0],t[1],t[2],t[3]),!i))return new yi(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Mt(i||`Could not parse color from value '${typeof t=="string"?t:String(JSON.stringify(t))}'`)}else if(this.type.kind==="number"){let t=null;for(const i of this.args){if(t=i.evaluate(e),t===null)return 0;const s=Number(t);if(!isNaN(s))return s}throw new Mt(`Could not convert ${JSON.stringify(t)} to number.`)}else return this.type.kind==="formatted"?cn.fromString(No(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?fs.fromString(No(this.args[0].evaluate(e))):No(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new cc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new uc(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(t=>{e.push(t.serialize())}),e}}var br=Kf;const sL=["Unknown","Point","LineString","Polygon"];class rL{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?sL[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:s}=this.featureTileCoord,r=i*t-e[0],o=s*t-e[1],a=this.featureDistanceData.bearing[0],l=this.featureDistanceData.bearing[1];return a*r+l*o}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=yi.parse(e)),t}}var L_=rL;class Er{constructor(e,t,i,s){this.name=e,this.type=t,this._evaluate=i,this.args=s}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,t){const i=e[0],s=Er.definitions[i];if(!s)return t.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const r=Array.isArray(s)?s[0]:s.type,o=Array.isArray(s)?[[s[1],s[2]]]:s.overloads,a=o.filter(([h])=>!Array.isArray(h)||h.length===e.length-1);let l=null;for(const[h,c]of a){l=new O_(t.registry,t.path,null,t.scope);const u=[];let d=!1;for(let f=1;f<e.length;f++){const g=e[f],p=Array.isArray(h)?h[f-1]:h.type,m=l.parse(g,1+u.length,p);if(!m){d=!0;break}u.push(m)}if(!d){if(Array.isArray(h)&&h.length!==u.length){l.error(`Expected ${h.length} arguments, but found ${u.length} instead.`);continue}for(let f=0;f<u.length;f++){const g=Array.isArray(h)?h[f]:h.type,p=u[f];l.concat(f+1).checkSubtype(g,p.type)}if(l.errors.length===0)return new Er(i,r,c,u)}}if(a.length===1)t.errors.push(...l.errors);else{const c=(a.length?a:o).map(([d])=>oL(d)).join(" | "),u=[];for(let d=1;d<e.length;d++){const f=t.parse(e[d],1+u.length);if(!f)return null;u.push(Xe(f.type))}t.error(`Expected arguments of type ${c}, but found (${u.join(", ")}) instead.`)}return null}static register(e,t){Er.definitions=t;for(const i in t)e[i]=Er}}function oL(n){return Array.isArray(n)?`(${n.map(Xe).join(", ")})`:`(${Xe(n.type)}...)`}var vo=Er;class dc{constructor(e,t,i){this.type=lc,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(e.length!==2)return t.error("Expected one argument.");const i=e[1];if(typeof i!="object"||Array.isArray(i))return t.error("Collator options argument must be an object.");const s=t.parse(i["case-sensitive"]===void 0?!1:i["case-sensitive"],1,le);if(!s)return null;const r=t.parse(i["diacritic-sensitive"]===void 0?!1:i["diacritic-sensitive"],1,le);if(!r)return null;let o=null;return i.locale&&(o=t.parse(i.locale,1,ge),!o)?null:new dc(s,r,o)}evaluate(e){return new Xf(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const ts=8192;function Jf(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function aL(n){return(180+n)/360}function lL(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function fh(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function hL(n,e){const t=aL(n[0]),i=lL(n[1]),s=Math.pow(2,e.z);return[Math.round(t*s*ts),Math.round(i*s*ts)]}function cL(n,e,t){const i=n[0]-e[0],s=n[1]-e[1],r=n[0]-t[0],o=n[1]-t[1];return i*o-r*s===0&&i*r<=0&&s*o<=0}function uL(n,e,t){return e[1]>n[1]!=t[1]>n[1]&&n[0]<(t[0]-e[0])*(n[1]-e[1])/(t[1]-e[1])+e[0]}function Qf(n,e){let t=!1;for(let i=0,s=e.length;i<s;i++){const r=e[i];for(let o=0,a=r.length;o<a-1;o++){if(cL(n,r[o],r[o+1]))return!1;uL(n,r[o],r[o+1])&&(t=!t)}}return t}function dL(n,e){for(let t=0;t<e.length;t++)if(Qf(n,e[t]))return!0;return!1}function fL(n,e){return n[0]*e[1]-n[1]*e[0]}function am(n,e,t,i){const s=n[0]-t[0],r=n[1]-t[1],o=e[0]-t[0],a=e[1]-t[1],l=i[0]-t[0],h=i[1]-t[1],c=s*h-l*r,u=o*h-l*a;return c>0&&u<0||c<0&&u>0}function gL(n,e,t,i){const s=[e[0]-n[0],e[1]-n[1]],r=[i[0]-t[0],i[1]-t[1]];return fL(r,s)===0?!1:!!(am(n,e,t,i)&&am(t,i,n,e))}function pL(n,e,t){for(const i of t)for(let s=0;s<i.length-1;++s)if(gL(n,e,i[s],i[s+1]))return!0;return!1}function I_(n,e){for(let t=0;t<n.length;++t)if(!Qf(n[t],e))return!1;for(let t=0;t<n.length-1;++t)if(pL(n[t],n[t+1],e))return!1;return!0}function mL(n,e){for(let t=0;t<e.length;t++)if(I_(n,e[t]))return!0;return!1}function eg(n,e,t){const i=[];for(let s=0;s<n.length;s++){const r=[];for(let o=0;o<n[s].length;o++){const a=hL(n[s][o],t);Jf(e,a),r.push(a)}i.push(r)}return i}function P_(n,e,t){const i=[];for(let s=0;s<n.length;s++){const r=eg(n[s],e,t);i.push(r)}return i}function A_(n,e,t,i){if(n[0]<t[0]||n[0]>t[2]){const s=i*.5;let r=n[0]-t[0]>s?-i:t[0]-n[0]>s?i:0;r===0&&(r=n[0]-t[2]>s?-i:t[2]-n[0]>s?i:0),n[0]+=r}Jf(e,n)}function yL(n){n[0]=n[1]=1/0,n[2]=n[3]=-1/0}function lm(n,e,t,i){const s=Math.pow(2,i.z)*ts,r=[i.x*ts,i.y*ts],o=[];if(!n)return o;for(const a of n)for(const l of a){const h=[l.x+r[0],l.y+r[1]];A_(h,e,t,s),o.push(h)}return o}function hm(n,e,t,i){const s=Math.pow(2,i.z)*ts,r=[i.x*ts,i.y*ts],o=[];if(!n)return o;for(const a of n){const l=[];for(const h of a){const c=[h.x+r[0],h.y+r[1]];Jf(e,c),l.push(c)}o.push(l)}if(e[2]-e[0]<=s/2){yL(e);for(const a of o)for(const l of a)A_(l,e,t,s)}return o}function _L(n,e){const t=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],s=n.canonicalID();if(!s)return!1;if(e.type==="Polygon"){const r=eg(e.coordinates,i,s),o=lm(n.geometry(),t,i,s);if(!fh(t,i))return!1;for(const a of o)if(!Qf(a,r))return!1}if(e.type==="MultiPolygon"){const r=P_(e.coordinates,i,s),o=lm(n.geometry(),t,i,s);if(!fh(t,i))return!1;for(const a of o)if(!dL(a,r))return!1}return!0}function vL(n,e){const t=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],s=n.canonicalID();if(!s)return!1;if(e.type==="Polygon"){const r=eg(e.coordinates,i,s),o=hm(n.geometry(),t,i,s);if(!fh(t,i))return!1;for(const a of o)if(!I_(a,r))return!1}if(e.type==="MultiPolygon"){const r=P_(e.coordinates,i,s),o=hm(n.geometry(),t,i,s);if(!fh(t,i))return!1;for(const a of o)if(!mL(a,r))return!1}return!0}class Do{constructor(e,t){this.type=le,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(uh(e[1])){const i=e[1];if(i.type==="FeatureCollection")for(let s=0;s<i.features.length;++s){const r=i.features[s].geometry.type;if(r==="Polygon"||r==="MultiPolygon")return new Do(i,i.features[s].geometry)}else if(i.type==="Feature"){const s=i.geometry.type;if(s==="Polygon"||s==="MultiPolygon")return new Do(i,i.geometry)}else if(i.type==="Polygon"||i.type==="MultiPolygon")return new Do(i,i)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return _L(e,this.geometries);if(e.geometryType()==="LineString")return vL(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var tg=Do;function fc(n){if(n instanceof vo){if(n.name==="get"&&n.args.length===1)return!1;if(n.name==="feature-state")return!1;if(n.name==="has"&&n.args.length===1)return!1;if(n.name==="properties"||n.name==="geometry-type"||n.name==="id")return!1;if(/^filter-/.test(n.name))return!1}if(n instanceof tg)return!1;let e=!0;return n.eachChild(t=>{e&&!fc(t)&&(e=!1)}),e}function ig(n){if(n instanceof vo&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(t=>{e&&!ig(t)&&(e=!1)}),e}function ng(n,e){if(n instanceof vo&&e.indexOf(n.name)>=0)return!1;let t=!0;return n.eachChild(i=>{t&&!ng(i,e)&&(t=!1)}),t}class sg{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");const i=e[1];return t.scope.has(i)?new sg(i,t.scope.get(i)):t.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var F_=sg;class rg{constructor(e,t=[],i,s=new QR,r=[]){this.registry=e,this.path=t,this.key=t.map(o=>`[${o}]`).join(""),this.scope=s,this.errors=r,this.expectedType=i}parse(e,t,i,s,r={}){return t?this.concat(t,i,s)._parse(e,r):this._parse(e,r)}_parse(e,t){(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number")&&(e=["literal",e]);function i(s,r,o){return o==="assert"?new bn(r,[s]):o==="coerce"?new br(r,[s]):s}if(Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const s=e[0];if(typeof s!="string")return this.error(`Expression name must be a string, but found ${typeof s} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const r=this.registry[s];if(r){let o=r.parse(e,this);if(!o)return null;if(this.expectedType){const a=this.expectedType,l=o.type;if((a.kind==="string"||a.kind==="number"||a.kind==="boolean"||a.kind==="object"||a.kind==="array")&&l.kind==="value")o=i(o,a,t.typeAnnotation||"assert");else if((a.kind==="color"||a.kind==="formatted"||a.kind==="resolvedImage")&&(l.kind==="value"||l.kind==="string"))o=i(o,a,t.typeAnnotation||"coerce");else if(this.checkSubtype(a,l))return null}if(!(o instanceof dh)&&o.type.kind!=="resolvedImage"&&ed(o)){const a=new L_;try{o=new dh(o.type,o.evaluate(a))}catch(l){return this.error(l.message),null}}return o}return this.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof e>"u"?this.error("'undefined' value invalid. Use null instead."):typeof e=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof e} instead.`)}concat(e,t,i){const s=typeof e=="number"?this.path.concat(e):this.path,r=i?this.scope.concat(i):this.scope;return new rg(this.registry,s,t||null,r,this.errors)}error(e,...t){const i=`${this.key}${t.map(s=>`[${s}]`).join("")}`;this.errors.push(new nn(i,e))}checkSubtype(e,t){const i=ea(e,t);return i&&this.error(i),i}}var O_=rg;function ed(n){if(n instanceof F_)return ed(n.boundExpression);if(n instanceof vo&&n.name==="error")return!1;if(n instanceof dc)return!1;if(n instanceof tg)return!1;const e=n instanceof br||n instanceof bn;let t=!0;return n.eachChild(i=>{e?t=t&&ed(i):t=t&&i instanceof dh}),t?fc(n)&&ng(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"]):!1}function k_(n,e){const t=n.length-1;let i=0,s=t,r=0,o,a;for(;i<=s;)if(r=Math.floor((i+s)/2),o=n[r],a=n[r+1],o<=e){if(r===t||e<a)return r;i=r+1}else if(o>e)s=r-1;else throw new Mt("Input is not a number.");return 0}class og{constructor(e,t,i){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[s,r]of i)this.labels.push(s),this.outputs.push(r)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return t.error("Expected an even number of arguments.");const i=t.parse(e[1],1,D);if(!i)return null;const s=[];let r=null;t.expectedType&&t.expectedType.kind!=="value"&&(r=t.expectedType);for(let o=1;o<e.length;o+=2){const a=o===1?-1/0:e[o],l=e[o+1],h=o,c=o+1;if(typeof a!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',h);if(s.length&&s[s.length-1][0]>=a)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',h);const u=t.parse(l,c,r);if(!u)return null;r=r||u.type,s.push([a,u])}return new og(r,i,s)}evaluate(e){const t=this.labels,i=this.outputs;if(t.length===1)return i[0].evaluate(e);const s=this.input.evaluate(e);if(s<=t[0])return i[0].evaluate(e);const r=t.length;if(s>=t[r-1])return i[r-1].evaluate(e);const o=k_(t,s);return i[o].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var N_=og,xL=xo;function xo(n,e,t,i){this.cx=3*n,this.bx=3*(t-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=i,this.p2x=t,this.p2y=i}xo.prototype.sampleCurveX=function(n){return((this.ax*n+this.bx)*n+this.cx)*n};xo.prototype.sampleCurveY=function(n){return((this.ay*n+this.by)*n+this.cy)*n};xo.prototype.sampleCurveDerivativeX=function(n){return(3*this.ax*n+2*this.bx)*n+this.cx};xo.prototype.solveCurveX=function(n,e){typeof e>"u"&&(e=1e-6);var t,i,s,r,o;for(s=n,o=0;o<8;o++){if(r=this.sampleCurveX(s)-n,Math.abs(r)<e)return s;var a=this.sampleCurveDerivativeX(s);if(Math.abs(a)<1e-6)break;s=s-r/a}if(t=0,i=1,s=n,s<t)return t;if(s>i)return i;for(;t<i;){if(r=this.sampleCurveX(s),Math.abs(r-n)<e)return s;n>r?t=s:i=s,s=(i-t)*.5+t}return s};xo.prototype.solve=function(n,e){return this.sampleCurveY(this.solveCurveX(n,e))};var wL=S_(xL);function gi(n,e,t){return n*(1-t)+e*t}function bL(n,e,t){return new yi(gi(n.r,e.r,t),gi(n.g,e.g,t),gi(n.b,e.b,t),gi(n.a,e.a,t))}function EL(n,e,t){return n.map((i,s)=>gi(i,e[s],t))}var CL=Object.freeze({__proto__:null,number:gi,color:bL,array:EL});const D_=.95047,G_=1,z_=1.08883,B_=4/29,Or=6/29,U_=3*Or*Or,ML=Or*Or*Or,SL=Math.PI/180,TL=180/Math.PI;function Wc(n){return n>ML?Math.pow(n,1/3):n/U_+B_}function Hc(n){return n>Or?n*n*n:U_*(n-B_)}function Xc(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function Yc(n){return n/=255,n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function j_(n){const e=Yc(n.r),t=Yc(n.g),i=Yc(n.b),s=Wc((.4124564*e+.3575761*t+.1804375*i)/D_),r=Wc((.2126729*e+.7151522*t+.072175*i)/G_),o=Wc((.0193339*e+.119192*t+.9503041*i)/z_);return{l:116*r-16,a:500*(s-r),b:200*(r-o),alpha:n.a}}function $_(n){let e=(n.l+16)/116,t=isNaN(n.a)?e:e+n.a/500,i=isNaN(n.b)?e:e-n.b/200;return e=G_*Hc(e),t=D_*Hc(t),i=z_*Hc(i),new yi(Xc(3.2404542*t-1.5371385*e-.4985314*i),Xc(-.969266*t+1.8760108*e+.041556*i),Xc(.0556434*t-.2040259*e+1.0572252*i),n.alpha)}function RL(n,e,t){return{l:gi(n.l,e.l,t),a:gi(n.a,e.a,t),b:gi(n.b,e.b,t),alpha:gi(n.alpha,e.alpha,t)}}function LL(n){const{l:e,a:t,b:i}=j_(n),s=Math.atan2(i,t)*TL;return{h:s<0?s+360:s,c:Math.sqrt(t*t+i*i),l:e,alpha:n.a}}function IL(n){const e=n.h*SL,t=n.c,i=n.l;return $_({l:i,a:Math.cos(e)*t,b:Math.sin(e)*t,alpha:n.alpha})}function PL(n,e,t){const i=e-n;return n+t*(i>180||i<-180?i-360*Math.round(i/360):i)}function AL(n,e,t){return{h:PL(n.h,e.h,t),c:gi(n.c,e.c,t),l:gi(n.l,e.l,t),alpha:gi(n.alpha,e.alpha,t)}}const yl={forward:j_,reverse:$_,interpolate:RL},_l={forward:LL,reverse:IL,interpolate:AL};class gh{constructor(e,t,i,s,r){this.type=e,this.operator=t,this.interpolation=i,this.input=s,this.labels=[],this.outputs=[];for(const[o,a]of r)this.labels.push(o),this.outputs.push(a)}static interpolationFactor(e,t,i,s){let r=0;if(e.name==="exponential")r=Zc(t,e.base,i,s);else if(e.name==="linear")r=Zc(t,1,i,s);else if(e.name==="cubic-bezier"){const o=e.controlPoints;r=new wL(o[0],o[1],o[2],o[3]).solve(Zc(t,1,i,s))}return r}static parse(e,t){let[i,s,r,...o]=e;if(!Array.isArray(s)||s.length===0)return t.error("Expected an interpolation type expression.",1);if(s[0]==="linear")s={name:"linear"};else if(s[0]==="exponential"){const h=s[1];if(typeof h!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);s={name:"exponential",base:h}}else if(s[0]==="cubic-bezier"){const h=s.slice(1);if(h.length!==4||h.some(c=>typeof c!="number"||c<0||c>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);s={name:"cubic-bezier",controlPoints:h}}else return t.error(`Unknown interpolation type ${String(s[0])}`,1,0);if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return t.error("Expected an even number of arguments.");if(r=t.parse(r,2,D),!r)return null;const a=[];let l=null;i==="interpolate-hcl"||i==="interpolate-lab"?l=Ln:t.expectedType&&t.expectedType.kind!=="value"&&(l=t.expectedType);for(let h=0;h<o.length;h+=2){const c=o[h],u=o[h+1],d=h+3,f=h+4;if(typeof c!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',d);if(a.length&&a[a.length-1][0]>=c)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',d);const g=t.parse(u,f,l);if(!g)return null;l=l||g.type,a.push([c,g])}return l.kind!=="number"&&l.kind!=="color"&&!(l.kind==="array"&&l.itemType.kind==="number"&&typeof l.N=="number")?t.error(`Type ${Xe(l)} is not interpolatable.`):new gh(l,i,s,r,a)}evaluate(e){const t=this.labels,i=this.outputs;if(t.length===1)return i[0].evaluate(e);const s=this.input.evaluate(e);if(s<=t[0])return i[0].evaluate(e);const r=t.length;if(s>=t[r-1])return i[r-1].evaluate(e);const o=k_(t,s),a=t[o],l=t[o+1],h=gh.interpolationFactor(this.interpolation,s,a,l),c=i[o].evaluate(e),u=i[o+1].evaluate(e);return this.operator==="interpolate"?CL[this.type.kind.toLowerCase()](c,u,h):this.operator==="interpolate-hcl"?_l.reverse(_l.interpolate(_l.forward(c),_l.forward(u),h)):yl.reverse(yl.interpolate(yl.forward(c),yl.forward(u),h))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;this.interpolation.name==="linear"?e=["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?e=["linear"]:e=["exponential",this.interpolation.base]:e=["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let i=0;i<this.labels.length;i++)t.push(this.labels[i],this.outputs[i].serialize());return t}}function Zc(n,e,t,i){const s=i-t,r=n-t;return s===0?0:e===1?r/s:(Math.pow(e,r)-1)/(Math.pow(e,s)-1)}var As=gh;class ph{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let i=null;const s=t.expectedType;s&&s.kind!=="value"&&(i=s);const r=[];for(const a of e.slice(1)){const l=t.parse(a,1+r.length,i,void 0,{typeAnnotation:"omit"});if(!l)return null;i=i||l.type,r.push(l)}return s&&r.some(a=>ea(s,a.type))?new ph(he,r):new ph(i,r)}evaluate(e){let t=null,i=0,s;for(const r of this.args){if(i++,t=r.evaluate(e),t&&t instanceof fs&&!t.available&&(s||(s=t),t=null,i===this.args.length))return s;if(t!==null)break}return t}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var q_=ph;class ag{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let r=1;r<e.length-1;r+=2){const o=e[r];if(typeof o!="string")return t.error(`Expected string, but found ${typeof o} instead.`,r);if(/[^a-zA-Z0-9_]/.test(o))return t.error("Variable names must contain only alphanumeric characters or '_'.",r);const a=t.parse(e[r+1],r+1);if(!a)return null;i.push([o,a])}const s=t.parse(e[e.length-1],e.length-1,t.expectedType,i);return s?new ag(i,s):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,i]of this.bindings)e.push(t,i.serialize());return e.push(this.result.serialize()),e}}var V_=ag;class lg{constructor(e,t,i){this.type=e,this.index=t,this.input=i}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,D),s=t.parse(e[2],2,Ri(t.expectedType||he));if(!i||!s)return null;const r=s.type;return new lg(r.itemType,i,s)}evaluate(e){const t=this.index.evaluate(e),i=this.input.evaluate(e);if(t<0)throw new Mt(`Array index out of bounds: ${t} < 0.`);if(t>=i.length)throw new Mt(`Array index out of bounds: ${t} > ${i.length-1}.`);if(t!==Math.floor(t))throw new Mt(`Array index must be an integer, but found ${t} instead.`);return i[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var FL=lg;class hg{constructor(e,t){this.type=le,this.needle=e,this.haystack=t}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,he),s=t.parse(e[2],2,he);return!i||!s?null:Hf(i.type,[le,ge,D,ac,he])?new hg(i,s):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xe(i.type)} instead`)}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(i==null)return!1;if(!ta(t,["boolean","string","number","null"]))throw new Mt(`Expected first argument to be of type boolean, string, number or null, but found ${Xe(mt(t))} instead.`);if(!ta(i,["string","array"]))throw new Mt(`Expected second argument to be of type array or string, but found ${Xe(mt(i))} instead.`);return i.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var OL=hg;class mh{constructor(e,t,i){this.type=D,this.needle=e,this.haystack=t,this.fromIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,he),s=t.parse(e[2],2,he);if(!i||!s)return null;if(!Hf(i.type,[le,ge,D,ac,he]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xe(i.type)} instead`);if(e.length===4){const r=t.parse(e[3],3,D);return r?new mh(i,s,r):null}else return new mh(i,s)}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!ta(t,["boolean","string","number","null"]))throw new Mt(`Expected first argument to be of type boolean, string, number or null, but found ${Xe(mt(t))} instead.`);if(!ta(i,["string","array"]))throw new Mt(`Expected second argument to be of type array or string, but found ${Xe(mt(i))} instead.`);if(this.fromIndex){const s=this.fromIndex.evaluate(e);return i.indexOf(t,s)}return i.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var kL=mh;class cg{constructor(e,t,i,s,r,o){this.inputType=e,this.type=t,this.input=i,this.cases=s,this.outputs=r,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!==1)return t.error("Expected an even number of arguments.");let i,s;t.expectedType&&t.expectedType.kind!=="value"&&(s=t.expectedType);const r={},o=[];for(let h=2;h<e.length-1;h+=2){let c=e[h];const u=e[h+1];Array.isArray(c)||(c=[c]);const d=t.concat(h);if(c.length===0)return d.error("Expected at least one branch label.");for(const g of c){if(typeof g!="number"&&typeof g!="string")return d.error("Branch labels must be numbers or strings.");if(typeof g=="number"&&Math.abs(g)>Number.MAX_SAFE_INTEGER)return d.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof g=="number"&&Math.floor(g)!==g)return d.error("Numeric branch labels must be integer values.");if(!i)i=mt(g);else if(d.checkSubtype(i,mt(g)))return null;if(typeof r[String(g)]<"u")return d.error("Branch labels must be unique.");r[String(g)]=o.length}const f=t.parse(u,h,s);if(!f)return null;s=s||f.type,o.push(f)}const a=t.parse(e[1],1,he);if(!a)return null;const l=t.parse(e[e.length-1],e.length-1,s);return!l||a.type.kind!=="value"&&t.concat(1).checkSubtype(i,a.type)?null:new cg(i,s,a,r,o,l)}evaluate(e){const t=this.input.evaluate(e);return(mt(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),i=[],s={};for(const o of t){const a=s[this.cases[o]];a===void 0?(s[this.cases[o]]=i.length,i.push([this.cases[o],[o]])):i[a][1].push(o)}const r=o=>this.inputType.kind==="number"?Number(o):o;for(const[o,a]of i)a.length===1?e.push(r(a[0])):e.push(a.map(r)),e.push(this.outputs[o].serialize());return e.push(this.otherwise.serialize()),e}}var NL=cg;class ug{constructor(e,t,i){this.type=e,this.branches=t,this.otherwise=i}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!==0)return t.error("Expected an odd number of arguments.");let i;t.expectedType&&t.expectedType.kind!=="value"&&(i=t.expectedType);const s=[];for(let o=1;o<e.length-1;o+=2){const a=t.parse(e[o],o,le);if(!a)return null;const l=t.parse(e[o+1],o+1,i);if(!l)return null;s.push([a,l]),i=i||l.type}const r=t.parse(e[e.length-1],e.length-1,i);return r?new ug(i,s,r):null}evaluate(e){for(const[t,i]of this.branches)if(t.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,i]of this.branches)e(t),e(i);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var DL=ug;class yh{constructor(e,t,i,s){this.type=e,this.input=t,this.beginIndex=i,this.endIndex=s}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,he),s=t.parse(e[2],2,D);if(!i||!s)return null;if(!Hf(i.type,[Ri(he),ge,he]))return t.error(`Expected first argument to be of type array or string, but found ${Xe(i.type)} instead`);if(e.length===4){const r=t.parse(e[3],3,D);return r?new yh(i.type,i,s,r):null}else return new yh(i.type,i,s)}evaluate(e){const t=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!ta(t,["string","array"]))throw new Mt(`Expected first argument to be of type array or string, but found ${Xe(mt(t))} instead.`);if(this.endIndex){const s=this.endIndex.evaluate(e);return t.slice(i,s)}return t.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var GL=yh;function cm(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function zL(n,e,t){return e===t}function BL(n,e,t){return e!==t}function UL(n,e,t){return e<t}function jL(n,e,t){return e>t}function $L(n,e,t){return e<=t}function qL(n,e,t){return e>=t}function W_(n,e,t,i){return i.compare(e,t)===0}function VL(n,e,t,i){return!W_(n,e,t,i)}function WL(n,e,t,i){return i.compare(e,t)<0}function HL(n,e,t,i){return i.compare(e,t)>0}function XL(n,e,t,i){return i.compare(e,t)<=0}function YL(n,e,t,i){return i.compare(e,t)>=0}function wo(n,e,t){const i=n!=="=="&&n!=="!=";return class H_{constructor(r,o,a){this.type=le,this.lhs=r,this.rhs=o,this.collator=a,this.hasUntypedArgument=r.type.kind==="value"||o.type.kind==="value"}static parse(r,o){if(r.length!==3&&r.length!==4)return o.error("Expected two or three arguments.");const a=r[0];let l=o.parse(r[1],1,he);if(!l)return null;if(!cm(a,l.type))return o.concat(1).error(`"${a}" comparisons are not supported for type '${Xe(l.type)}'.`);let h=o.parse(r[2],2,he);if(!h)return null;if(!cm(a,h.type))return o.concat(2).error(`"${a}" comparisons are not supported for type '${Xe(h.type)}'.`);if(l.type.kind!==h.type.kind&&l.type.kind!=="value"&&h.type.kind!=="value")return o.error(`Cannot compare types '${Xe(l.type)}' and '${Xe(h.type)}'.`);i&&(l.type.kind==="value"&&h.type.kind!=="value"?l=new bn(h.type,[l]):l.type.kind!=="value"&&h.type.kind==="value"&&(h=new bn(l.type,[h])));let c=null;if(r.length===4){if(l.type.kind!=="string"&&h.type.kind!=="string"&&l.type.kind!=="value"&&h.type.kind!=="value")return o.error("Cannot use collator to compare non-string types.");if(c=o.parse(r[3],3,lc),!c)return null}return new H_(l,h,c)}evaluate(r){const o=this.lhs.evaluate(r),a=this.rhs.evaluate(r);if(i&&this.hasUntypedArgument){const l=mt(o),h=mt(a);if(l.kind!==h.kind||!(l.kind==="string"||l.kind==="number"))throw new Mt(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${l.kind}, ${h.kind}) instead.`)}if(this.collator&&!i&&this.hasUntypedArgument){const l=mt(o),h=mt(a);if(l.kind!=="string"||h.kind!=="string")return e(r,o,a)}return this.collator?t(r,o,a,this.collator.evaluate(r)):e(r,o,a)}eachChild(r){r(this.lhs),r(this.rhs),this.collator&&r(this.collator)}outputDefined(){return!0}serialize(){const r=[n];return this.eachChild(o=>{r.push(o.serialize())}),r}}}const ZL=wo("==",zL,W_),KL=wo("!=",BL,VL),JL=wo("<",UL,WL),QL=wo(">",jL,HL),eI=wo("<=",$L,XL),tI=wo(">=",qL,YL);class dg{constructor(e,t,i,s,r,o){this.type=ge,this.number=e,this.locale=t,this.currency=i,this.unit=s,this.minFractionDigits=r,this.maxFractionDigits=o}static parse(e,t){if(e.length!==3)return t.error("Expected two arguments.");const i=t.parse(e[1],1,D);if(!i)return null;const s=e[2];if(typeof s!="object"||Array.isArray(s))return t.error("NumberFormat options argument must be an object.");let r=null;if(s.locale&&(r=t.parse(s.locale,1,ge),!r))return null;let o=null;if(s.currency&&(o=t.parse(s.currency,1,ge),!o))return null;let a=null;if(s.unit&&(a=t.parse(s.unit,1,ge),!a))return null;let l=null;if(s["min-fraction-digits"]&&(l=t.parse(s["min-fraction-digits"],1,D),!l))return null;let h=null;return s["max-fraction-digits"]&&(h=t.parse(s["max-fraction-digits"],1,D),!h)?null:new dg(i,r,o,a,l,h)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency&&"currency"||this.unit&&"unit"||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class fg{constructor(e){this.type=D,this.input=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=t.parse(e[1],1);return i?i.type.kind!=="array"&&i.type.kind!=="string"&&i.type.kind!=="value"?t.error(`Expected argument of type string or array, but found ${Xe(i.type)} instead.`):new fg(i):null}evaluate(e){const t=this.input.evaluate(e);if(typeof t=="string")return t.length;if(Array.isArray(t))return t.length;throw new Mt(`Expected value to be of type string or array, but found ${Xe(mt(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var iI=fg;const X_={"==":ZL,"!=":KL,">":QL,"<":JL,">=":tI,"<=":eI,array:bn,at:FL,boolean:bn,case:DL,coalesce:q_,collator:dc,format:cc,image:uc,in:OL,"index-of":kL,interpolate:As,"interpolate-hcl":As,"interpolate-lab":As,length:iI,let:V_,literal:dh,match:NL,number:bn,"number-format":dg,object:bn,slice:GL,step:N_,string:bn,"to-boolean":br,"to-color":br,"to-number":br,"to-string":br,var:F_,within:tg};function um(n,[e,t,i,s]){e=e.evaluate(n),t=t.evaluate(n),i=i.evaluate(n);const r=s?s.evaluate(n):1,o=R_(e,t,i,r);if(o)throw new Mt(o);return new yi(e/255*r,t/255*r,i/255*r,r)}function dm(n,e){return n in e}function Kc(n,e){const t=e[n];return typeof t>"u"?null:t}function nI(n,e,t,i){for(;t<=i;){const s=t+i>>1;if(e[s]===n)return!0;e[s]>n?i=s-1:t=s+1}return!1}function _s(n){return{type:n}}vo.register(X_,{error:[eL,[ge],(n,[e])=>{throw new Mt(e.evaluate(n))}],typeof:[ge,[he],(n,[e])=>Xe(mt(e.evaluate(n)))],"to-rgba":[Ri(D,4),[Ln],(n,[e])=>e.evaluate(n).toArray()],rgb:[Ln,[D,D,D],um],rgba:[Ln,[D,D,D,D],um],has:{type:le,overloads:[[[ge],(n,[e])=>dm(e.evaluate(n),n.properties())],[[ge,Fr],(n,[e,t])=>dm(e.evaluate(n),t.evaluate(n))]]},get:{type:he,overloads:[[[ge],(n,[e])=>Kc(e.evaluate(n),n.properties())],[[ge,Fr],(n,[e,t])=>Kc(e.evaluate(n),t.evaluate(n))]]},"feature-state":[he,[ge],(n,[e])=>Kc(e.evaluate(n),n.featureState||{})],properties:[Fr,[],n=>n.properties()],"geometry-type":[ge,[],n=>n.geometryType()],id:[he,[],n=>n.id()],zoom:[D,[],n=>n.globals.zoom],pitch:[D,[],n=>n.globals.pitch||0],"distance-from-center":[D,[],n=>n.distanceFromCenter()],"heatmap-density":[D,[],n=>n.globals.heatmapDensity||0],"line-progress":[D,[],n=>n.globals.lineProgress||0],"sky-radial-progress":[D,[],n=>n.globals.skyRadialProgress||0],accumulated:[he,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[D,_s(D),(n,e)=>{let t=0;for(const i of e)t+=i.evaluate(n);return t}],"*":[D,_s(D),(n,e)=>{let t=1;for(const i of e)t*=i.evaluate(n);return t}],"-":{type:D,overloads:[[[D,D],(n,[e,t])=>e.evaluate(n)-t.evaluate(n)],[[D],(n,[e])=>-e.evaluate(n)]]},"/":[D,[D,D],(n,[e,t])=>e.evaluate(n)/t.evaluate(n)],"%":[D,[D,D],(n,[e,t])=>e.evaluate(n)%t.evaluate(n)],ln2:[D,[],()=>Math.LN2],pi:[D,[],()=>Math.PI],e:[D,[],()=>Math.E],"^":[D,[D,D],(n,[e,t])=>Math.pow(e.evaluate(n),t.evaluate(n))],sqrt:[D,[D],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[D,[D],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[D,[D],(n,[e])=>Math.log(e.evaluate(n))],log2:[D,[D],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[D,[D],(n,[e])=>Math.sin(e.evaluate(n))],cos:[D,[D],(n,[e])=>Math.cos(e.evaluate(n))],tan:[D,[D],(n,[e])=>Math.tan(e.evaluate(n))],asin:[D,[D],(n,[e])=>Math.asin(e.evaluate(n))],acos:[D,[D],(n,[e])=>Math.acos(e.evaluate(n))],atan:[D,[D],(n,[e])=>Math.atan(e.evaluate(n))],min:[D,_s(D),(n,e)=>Math.min(...e.map(t=>t.evaluate(n)))],max:[D,_s(D),(n,e)=>Math.max(...e.map(t=>t.evaluate(n)))],abs:[D,[D],(n,[e])=>Math.abs(e.evaluate(n))],round:[D,[D],(n,[e])=>{const t=e.evaluate(n);return t<0?-Math.round(-t):Math.round(t)}],floor:[D,[D],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[D,[D],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[le,[ge,he],(n,[e,t])=>n.properties()[e.value]===t.value],"filter-id-==":[le,[he],(n,[e])=>n.id()===e.value],"filter-type-==":[le,[ge],(n,[e])=>n.geometryType()===e.value],"filter-<":[le,[ge,he],(n,[e,t])=>{const i=n.properties()[e.value],s=t.value;return typeof i==typeof s&&i<s}],"filter-id-<":[le,[he],(n,[e])=>{const t=n.id(),i=e.value;return typeof t==typeof i&&t<i}],"filter->":[le,[ge,he],(n,[e,t])=>{const i=n.properties()[e.value],s=t.value;return typeof i==typeof s&&i>s}],"filter-id->":[le,[he],(n,[e])=>{const t=n.id(),i=e.value;return typeof t==typeof i&&t>i}],"filter-<=":[le,[ge,he],(n,[e,t])=>{const i=n.properties()[e.value],s=t.value;return typeof i==typeof s&&i<=s}],"filter-id-<=":[le,[he],(n,[e])=>{const t=n.id(),i=e.value;return typeof t==typeof i&&t<=i}],"filter->=":[le,[ge,he],(n,[e,t])=>{const i=n.properties()[e.value],s=t.value;return typeof i==typeof s&&i>=s}],"filter-id->=":[le,[he],(n,[e])=>{const t=n.id(),i=e.value;return typeof t==typeof i&&t>=i}],"filter-has":[le,[he],(n,[e])=>e.value in n.properties()],"filter-has-id":[le,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[le,[Ri(ge)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[le,[Ri(he)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[le,[ge,Ri(he)],(n,[e,t])=>t.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[le,[ge,Ri(he)],(n,[e,t])=>nI(n.properties()[e.value],t.value,0,t.value.length-1)],all:{type:le,overloads:[[[le,le],(n,[e,t])=>e.evaluate(n)&&t.evaluate(n)],[_s(le),(n,e)=>{for(const t of e)if(!t.evaluate(n))return!1;return!0}]]},any:{type:le,overloads:[[[le,le],(n,[e,t])=>e.evaluate(n)||t.evaluate(n)],[_s(le),(n,e)=>{for(const t of e)if(t.evaluate(n))return!0;return!1}]]},"!":[le,[le],(n,[e])=>!e.evaluate(n)],"is-supported-script":[le,[ge],(n,[e])=>{const t=n.globals&&n.globals.isSupportedScript;return t?t(e.evaluate(n)):!0}],upcase:[ge,[ge],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[ge,[ge],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[ge,_s(he),(n,e)=>e.map(t=>No(t.evaluate(n))).join("")],"resolved-locale":[ge,[lc],(n,[e])=>e.evaluate(n).resolvedLocale()]});var Y_=X_;function td(n){return{result:"success",value:n}}function cr(n){return{result:"error",value:n}}function sI(n){return n["property-type"]==="data-driven"}function rI(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function oI(n){return!!n.expression&&n.expression.interpolated}function Z_(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}class aI{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new L_,this._defaultValue=t?uI(t):null,this._enumValues=t&&t.type==="enum"?t.values:null}evaluateWithoutErrorHandling(e,t,i,s,r,o,a,l){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=i,this._evaluator.canonical=s||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=l||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,i,s,r,o,a,l){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=i||null,this._evaluator.canonical=s||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=l||null;try{const h=this.expression.evaluate(this._evaluator);if(h==null||typeof h=="number"&&h!==h)return this._defaultValue;if(this._enumValues&&!(h in this._enumValues))throw new Mt(`Expected value to be one of ${Object.keys(this._enumValues).map(c=>JSON.stringify(c)).join(", ")}, but found ${JSON.stringify(h)} instead.`);return h}catch(h){return this._warningHistory[h.message]||(this._warningHistory[h.message]=!0,typeof console<"u"&&console.warn(h.message)),this._defaultValue}}}function lI(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Y_}function id(n,e){const t=new O_(Y_,[],e?cI(e):void 0),i=t.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return i?td(new aI(i,e)):cr(t.errors)}class fm{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!ig(t.expression)}evaluateWithoutErrorHandling(e,t,i,s,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,s,r,o)}evaluate(e,t,i,s,r,o){return this._styleExpression.evaluate(e,t,i,s,r,o)}}class gm{constructor(e,t,i,s){this.kind=e,this.zoomStops=i,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!ig(t.expression),this.interpolationType=s}evaluateWithoutErrorHandling(e,t,i,s,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,s,r,o)}evaluate(e,t,i,s,r,o){return this._styleExpression.evaluate(e,t,i,s,r,o)}interpolationFactor(e,t,i){return this.interpolationType?As.interpolationFactor(this.interpolationType,e,t,i):0}}function hI(n,e){if(n=id(n,e),n.result==="error")return n;const t=n.value.expression,i=fc(t);if(!i&&!sI(e))return cr([new nn("","data expressions not supported")]);const s=ng(t,["zoom","pitch","distance-from-center"]);if(!s&&!rI(e))return cr([new nn("","zoom expressions not supported")]);const r=Il(t);if(!r&&!s)return cr([new nn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(r instanceof nn)return cr([r]);if(r instanceof As&&!oI(e))return cr([new nn("",'"interpolate" expressions cannot be used with this property')]);if(!r)return td(i?new fm("constant",n.value):new fm("source",n.value));const o=r instanceof As?r.interpolation:void 0;return td(i?new gm("camera",n.value,r.labels,o):new gm("composite",n.value,r.labels,o))}function Il(n){let e=null;if(n instanceof V_)e=Il(n.result);else if(n instanceof q_){for(const t of n.args)if(e=Il(t),e)break}else(n instanceof N_||n instanceof As)&&n.input instanceof vo&&n.input.name==="zoom"&&(e=n);return e instanceof nn||n.eachChild(t=>{const i=Il(t);i instanceof nn?e=i:!e&&i?e=new nn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&i&&e!==i&&(e=new nn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function cI(n){const e={color:Ln,string:ge,number:D,enum:ge,boolean:le,formatted:hc,resolvedImage:Na};return n.type==="array"?Ri(e[n.value]||he,n.length):e[n.type]}function uI(n){return n.type==="color"&&(Z_(n.default)||Array.isArray(n.default))?new yi(0,0,0,0):n.type==="color"?yi.parse(n.default)||null:n.default===void 0?null:n.default}function dI(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function nd(n){if(Array.isArray(n))return n.map(nd);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const t in n)e[t]=nd(n[t]);return e}return dI(n)}var K_={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},fog:{type:"fog"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},projection:{type:"projection"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"},"fill-extrusion-edge-radius":{type:"number",private:!0,default:0,minimum:0,maximum:1,"property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_symbol:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature","pitch","distance-from-center"]}},filter_fill:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_line:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_circle:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},"filter_fill-extrusion":{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_heatmap:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},expression_name:{type:"enum",values:{let:{group:"Variable binding"},var:{group:"Variable binding"},literal:{group:"Types"},array:{group:"Types"},at:{group:"Lookup"},in:{group:"Lookup"},"index-of":{group:"Lookup"},slice:{group:"Lookup"},case:{group:"Decision"},match:{group:"Decision"},coalesce:{group:"Decision"},step:{group:"Ramps, scales, curves"},interpolate:{group:"Ramps, scales, curves"},"interpolate-hcl":{group:"Ramps, scales, curves"},"interpolate-lab":{group:"Ramps, scales, curves"},ln2:{group:"Math"},pi:{group:"Math"},e:{group:"Math"},typeof:{group:"Types"},string:{group:"Types"},number:{group:"Types"},boolean:{group:"Types"},object:{group:"Types"},collator:{group:"Types"},format:{group:"Types"},image:{group:"Types"},"number-format":{group:"Types"},"to-string":{group:"Types"},"to-number":{group:"Types"},"to-boolean":{group:"Types"},"to-rgba":{group:"Color"},"to-color":{group:"Types"},rgb:{group:"Color"},rgba:{group:"Color"},get:{group:"Lookup"},has:{group:"Lookup"},length:{group:"Lookup"},properties:{group:"Feature data"},"feature-state":{group:"Feature data"},"geometry-type":{group:"Feature data"},id:{group:"Feature data"},zoom:{group:"Camera"},pitch:{group:"Camera"},"distance-from-center":{group:"Camera"},"heatmap-density":{group:"Heatmap"},"line-progress":{group:"Feature data"},"sky-radial-progress":{group:"sky"},accumulated:{group:"Feature data"},"+":{group:"Math"},"*":{group:"Math"},"-":{group:"Math"},"/":{group:"Math"},"%":{group:"Math"},"^":{group:"Math"},sqrt:{group:"Math"},log10:{group:"Math"},ln:{group:"Math"},log2:{group:"Math"},sin:{group:"Math"},cos:{group:"Math"},tan:{group:"Math"},asin:{group:"Math"},acos:{group:"Math"},atan:{group:"Math"},min:{group:"Math"},max:{group:"Math"},round:{group:"Math"},abs:{group:"Math"},ceil:{group:"Math"},floor:{group:"Math"},distance:{group:"Math"},"==":{group:"Decision"},"!=":{group:"Decision"},">":{group:"Decision"},"<":{group:"Decision"},">=":{group:"Decision"},"<=":{group:"Decision"},all:{group:"Decision"},any:{group:"Decision"},"!":{group:"Decision"},within:{group:"Decision"},"is-supported-script":{group:"String"},upcase:{group:"String"},downcase:{group:"String"},concat:{group:"String"},"resolved-locale":{group:"String"}}},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"high-color":{type:"color","property-type":"data-constant",default:"#245cdf",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"space-color":{type:"color","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],4,.2,7,.1],minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"star-intensity":{type:"number","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],5,.35,6,0],minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},projection:{name:{type:"enum",values:{albers:{},equalEarth:{},equirectangular:{},lambertConformalConic:{},mercator:{},naturalEarth:{},winkelTripel:{},globe:{}},default:"mercator",required:!0},center:{type:"array",length:2,value:"number","property-type":"data-constant",minimum:[-180,-90],maximum:[180,90],transition:!1,requires:[{name:["albers","lambertConformalConic"]}]},parallels:{type:"array",length:2,value:"number","property-type":"data-constant",minimum:[-90,-90],maximum:[90,90],transition:!1,requires:[{name:["albers","lambertConformalConic"]}]}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,requires:["source"]}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant",type:"number",private:!0,default:0,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant",type:"number",private:!0,default:3,minimum:0,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,requires:["fill-extrusion-edge-radius"]}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!1,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{type:"array",value:"number",length:2,default:[0,0],minimum:[0,0],maximum:[1,1],transition:!1,requires:[{source:"geojson",has:{lineMetrics:!0}}],"property-type":"constant"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};function J_(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!J_(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function fI(n,e="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};J_(n)||(n=_h(n));const t=n;let i=!0;try{i=gI(t)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(t,null,2)}
        `)}const s=K_[`filter_${e}`],r=id(i,s);let o=null;if(r.result==="error")throw new Error(r.value.map(c=>`${c.key}: ${c.message}`).join(", "));o=(c,u,d)=>r.value.evaluate(c,u,{},d);let a=null,l=null;if(i!==t){const c=id(t,s);if(c.result==="error")throw new Error(c.value.map(u=>`${u.key}: ${u.message}`).join(", "));a=(u,d,f,g,p)=>c.value.evaluate(u,d,{},f,void 0,void 0,g,p),l=!fc(c.value.expression)}o=o;const h=tv(i);return{filter:o,dynamicFilter:a||void 0,needGeometry:h,needFeature:!!l}}function gI(n){if(!kr(n))return n;let e=nd(n);return ev(e),e=Q_(e),e}function Q_(n){if(!Array.isArray(n))return n;const e=yI(n);return e===!0?e:e.map(t=>Q_(t))}function ev(n){let e=!1;const t=[];if(n[0]==="case"){for(let i=1;i<n.length-1;i+=2)e=e||kr(n[i]),t.push(n[i+1]);t.push(n[n.length-1])}else if(n[0]==="match"){e=e||kr(n[1]);for(let i=2;i<n.length-1;i+=2)t.push(n[i+1]);t.push(n[n.length-1])}else if(n[0]==="step"){e=e||kr(n[1]);for(let i=1;i<n.length-1;i+=2)t.push(n[i+1])}e&&(n.length=0,n.push("any",...t));for(let i=1;i<n.length;i++)ev(n[i])}function kr(n){if(!Array.isArray(n))return!1;if(pI(n[0]))return!0;for(let e=1;e<n.length;e++){const t=n[e];if(kr(t))return!0}return!1}function pI(n){return n==="pitch"||n==="distance-from-center"}const mI=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function yI(n){if(mI.has(n[0]))for(let e=1;e<n.length;e++){const t=n[e];if(kr(t))return!0}return n}function _I(n,e){return n<e?-1:n>e?1:0}function tv(n){if(!Array.isArray(n))return!1;if(n[0]==="within")return!0;for(let e=1;e<n.length;e++)if(tv(n[e]))return!0;return!1}function _h(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?Jc(n[1],n[2],"=="):e==="!="?vl(Jc(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Jc(n[1],n[2],e):e==="any"?vI(n.slice(1)):e==="all"?["all"].concat(n.slice(1).map(_h)):e==="none"?["all"].concat(n.slice(1).map(_h).map(vl)):e==="in"?pm(n[1],n.slice(2)):e==="!in"?vl(pm(n[1],n.slice(2))):e==="has"?mm(n[1]):e==="!has"?vl(mm(n[1])):e==="within"?n:!0}function Jc(n,e,t){switch(n){case"$type":return[`filter-type-${t}`,e];case"$id":return[`filter-id-${t}`,e];default:return[`filter-${t}`,n,e]}}function vI(n){return["any"].concat(n.map(_h))}function pm(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",n,["literal",e.sort(_I)]]:["filter-in-small",n,["literal",e]]}}function mm(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function vl(n){return["!",n]}var xI=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function wI(n,e){const t={};for(const i in n)i!=="ref"&&(t[i]=n[i]);return xI.forEach(i=>{i in e&&(t[i]=e[i])}),t}function bI(n){n=n.slice();const e=Object.create(null);for(let t=0;t<n.length;t++)e[n[t].id]=n[t];for(let t=0;t<n.length;t++)"ref"in n[t]&&(n[t]=wI(n[t],e[n[t].ref]));return n}var ym={thin:100,hairline:100,"ultra-light":100,"extra-light":100,light:200,book:300,regular:400,normal:400,plain:400,roman:400,standard:400,medium:500,"semi-bold":600,"demi-bold":600,bold:700,heavy:800,black:800,"extra-bold":800,"ultra-black":900,"extra-black":900,"ultra-bold":900,"heavy-black":900,fat:900,poster:900},Ro=" ",_m=/(italic|oblique)$/i,vm={},EI=function(n,e,t){var i=vm[n];if(!i){Array.isArray(n)||(n=[n]);for(var s=400,r="normal",o=[],a,l,h=0,c=n.length;h<c;++h){var u=n[h],d=u.split(" "),f=d[d.length-1].toLowerCase();f=="normal"||f=="italic"||f=="oblique"?(r=l?r:f,d.pop(),f=d[d.length-1].toLowerCase()):_m.test(f)&&(f=f.replace(_m,""),r=l?r:d[d.length-1].replace(f,""));for(var g in ym){var p=d.length>1?d[d.length-2].toLowerCase():"";if(f==g||f==g.replace("-","")||p+"-"+f==g){s=a?s:ym[g],d.pop(),p&&g.startsWith(p)&&d.pop();break}}!a&&typeof f=="number"&&(s=f);var m=d.join(Ro).replace("Klokantech Noto Sans","Noto Sans");m.indexOf(Ro)!==-1&&(m='"'+m+'"'),o.push(m)}i=vm[n]=[r,s,o]}return i[0]+Ro+i[1]+Ro+e+"px"+(t?"/"+t:"")+Ro+i[2]},sd=S_(EI);const iv="https://api.mapbox.com";function gg(n){const e="mapbox://";return n.indexOf(e)!==0?"":n.slice(e.length)}function CI(n,e,t){const i=gg(n);if(!i)return decodeURI(new URL(n,t).href);const s="sprites/";if(i.indexOf(s)!==0)throw new Error(`unexpected sprites url: ${n}`);const r=i.slice(s.length);return`${iv}/styles/v1/${r}/sprite?access_token=${e}`}function nv(n,e){const t=gg(n);if(!t)return decodeURI(new URL(n,location.href).href);const i="styles/";if(t.indexOf(i)!==0)throw new Error(`unexpected style url: ${n}`);const s=t.slice(i.length);return`${iv}/styles/v1/${s}?&access_token=${e}`}function Pl(n,e,t,i){const s=new URL(n,i),r=gg(n);if(!r)return e&&s.searchParams.set(t,e),decodeURI(s.href);if(r==="mapbox.satellite"){const o=window.devicePixelRatio>=1.5?"@2x":"";return`https://api.mapbox.com/v4/${r}/{z}/{x}/{y}${o}.webp?access_token=${e}`}return`https://{a-d}.tiles.mapbox.com/v4/${r}/{z}/{x}/{y}.vector.pbf?access_token=${e}`}const xm={},wm={};let MI=0;function pg(n){return n.id||(n.id=MI++),n.id}function SI(n,e){return pg(n)+"."+H(e)}function TI(n){let e=xm[n.id];return e||(e={},xm[pg(n)]=e),e}function RI(n){let e=wm[n.id];return e||(e={},wm[pg(n)]=e),e}function Qc(n){return n*Math.PI/180}const mg=function(){const n=[];for(let e=78271.51696402048;n.length<=24;e/=2)n.push(e);return n}();function sv(n,e){if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof OffscreenCanvas<"u")return new OffscreenCanvas(n,e);const t=document.createElement("canvas");return t.width=n,t.height=e,t}function LI(n,e){let t=0;const i=e.length;for(;t<i;++t)if(e[t]<n&&t+1<i){const r=e[t]/e[t+1];return t+Math.log(e[t]/n)/Math.log(r)}return i-1}const rr={};function lo(n,e,t={},i){if(e in rr)return i&&(i.request=rr[e][0]),rr[e][1];let s=t.transformRequest&&t.transformRequest(e,n)||e;s instanceof Request||(s=new Request(s)),s.headers.get("Accept")||s.headers.set("Accept","application/json"),i&&(i.request=s);const r=fetch(s).then(function(o){return delete rr[e],o.ok?o.json():Promise.reject(new Error("Error fetching source "+e))}).catch(function(o){return delete rr[e],Promise.reject(new Error("Error fetching source "+e))});return rr[e]=[s,r],r}function II(n,e){if(typeof n=="string")if(n.trim().startsWith("{"))try{const t=JSON.parse(n);return Promise.resolve(t)}catch(t){return Promise.reject(t)}else return n=nv(n,e.accessToken),lo("Style",n,e);else return Promise.resolve(n)}const bm={};function PI(n,e,t={}){const i=[e,JSON.stringify(n)].toString();let s=bm[i];if(!s||t.transformRequest){let r;t.transformRequest&&(r=(a,l)=>{const h=t.transformRequest&&t.transformRequest(l,"Tiles")||l;if(a instanceof g_)a.setLoader((c,u,d)=>{fetch(h).then(f=>f.arrayBuffer()).then(f=>{const p=a.getFormat().readFeatures(f,{extent:c,featureProjection:d});a.setFeatures(p)}).catch(f=>a.setState(U.ERROR))});else{const c=a.getImage();h instanceof Request?fetch(h).then(u=>u.blob()).then(u=>{const d=URL.createObjectURL(u);c.addEventListener("load",()=>URL.revokeObjectURL(d)),c.addEventListener("error",()=>URL.revokeObjectURL(d)),c.src=d}).catch(u=>a.setState(U.ERROR)):c.src=h}});const o=n.url;if(o&&!n.tiles){const a=Pl(o,t.accessToken,t.accessTokenParam||"access_token",e||location.href);if(o.startsWith("mapbox://"))s=Promise.resolve({tileJson:Object.assign({},n,{url:void 0,tiles:Bf(a)}),tileLoadFunction:r});else{const l={};s=lo("Source",a,t,l).then(function(h){return h.tiles=h.tiles.map(function(c){return h.scheme==="tms"&&(c=c.replace("{y}","{-y}")),Pl(c,t.accessToken,t.accessTokenParam||"access_token",l.request.url)}),Promise.resolve({tileJson:h,tileLoadFunction:r})})}}else n=Object.assign({},n,{tiles:n.tiles.map(function(a){return n.scheme==="tms"&&(a=a.replace("{y}","{-y}")),Pl(a,t.accessToken,t.accessTokenParam||"access_token",e||location.href)})}),s=Promise.resolve({tileJson:Object.assign({},n),tileLoadFunction:r});bm[i]=s}return s}function Em(n,e,t,i){const s=document.createElement("canvas"),r=[2*t*e.pixelRatio+e.width,2*t*e.pixelRatio+e.height];s.width=r[0],s.height=r[1];const o=s.getContext("2d");o.drawImage(n,e.x,e.y,e.width,e.height,t*e.pixelRatio,t*e.pixelRatio,e.width,e.height);const a=o.getImageData(0,0,r[0],r[1]);o.globalCompositeOperation="destination-over",o.fillStyle=`rgba(${i.r*255},${i.g*255},${i.b*255},${i.a})`;const l=a.data;for(let h=0,c=a.width;h<c;++h)for(let u=0,d=a.height;u<d;++u){const f=(u*c+h)*4;l[f+3]>0&&o.arc(h,u,t*e.pixelRatio,0,2*Math.PI)}return o.fill(),s}function AI(n,e,t){const i=Math.max(0,Math.min(1,(t-n)/(e-n)));return i*i*(3-2*i)}function Cm(n,e,t){const i=document.createElement("canvas");i.width=e.width,i.height=e.height;const s=i.getContext("2d");s.drawImage(n,e.x,e.y,e.width,e.height,0,0,e.width,e.height);const r=s.getImageData(0,0,e.width,e.height),o=r.data;for(let a=0,l=r.width;a<l;++a)for(let h=0,c=r.height;h<c;++h){const u=(h*l+a)*4,d=o[u+3]/255,f=.75,g=.1,p=AI(f-g,f+g,d);p>0?(o[u+0]=Math.round(255*t.r*p),o[u+1]=Math.round(255*t.g*p),o[u+2]=Math.round(255*t.b*p),o[u+3]=Math.round(255*p)):o[u+3]=0}return s.putImageData(r,0,0),i}const FI=Array(256).join("â");function rd(n,e){if(e>=.05){let t="";const i=n.split(`
`),s=FI.slice(0,Math.round(e/.1));for(let r=0,o=i.length;r<o;++r)r>0&&(t+=`
`),t+=i[r].split("").join(s);return t}return n}let eu;function rv(){return eu||(eu=sv(1,1).getContext("2d")),eu}function vs(n,e){return rv().measureText(n).width+(n.length-1)*e}const Mm={};function od(n,e,t,i){if(n.indexOf(`
`)!==-1){const o=n.split(`
`),a=[];for(let l=0,h=o.length;l<h;++l)a.push(od(o[l],e,t,i));return a.join(`
`)}const s=t+","+e+","+n+","+i;let r=Mm[s];if(!r){const o=n.split(" ");if(o.length>1){const a=rv();a.font=e;const h=a.measureText("M").width*t;let c="";const u=[];for(let d=0,f=o.length;d<f;++d){const g=o[d],p=c+(c?" ":"")+g;vs(p,i)<=h?c=p:(c&&u.push(c),c=g)}c&&u.push(c);for(let d=0,f=u.length;d<f&&f>1;++d){const g=u[d];if(vs(g,i)<h*.35){const p=d>0?vs(u[d-1],i):1/0,m=d<f-1?vs(u[d+1],i):1/0;u.splice(d,1),f-=1,p<m?(u[d-1]+=" "+g,d-=1):u[d]=g+" "+u[d]}}for(let d=0,f=u.length-1;d<f;++d){const g=u[d],p=u[d+1];if(vs(g,i)>h*.7&&vs(p,i)<h*.6){const m=g.split(" "),v=m.pop();vs(v,i)<h*.2&&(u[d]=m.join(" "),u[d+1]=v+" "+p),f-=1}}r=u.join(`
`)}else r=n;r=rd(r,i),Mm[s]=r}return r}const OI=/font-family: ?([^;]*);/,kI=/("|')/g;let xl;function NI(n){if(!xl){xl={};const e=document.styleSheets;for(let t=0,i=e.length;t<i;++t){const s=e[t];try{const r=s.rules||s.cssRules;if(r)for(let o=0,a=r.length;o<a;++o){const l=r[o];if(l.type==5){const h=l.cssText.match(OI);xl[h[1].replace(kI,"")]=!0}}}catch{}}}return n in xl}const tu={};function DI(n,e="https://cdn.jsdelivr.net/npm/@fontsource/{font-family}/{fontweight}{-fontstyle}.css"){const t=n.toString();if(t in tu)return tu[t];const i=[];for(let s=0,r=n.length;s<r;++s){n[s]=n[s].replace("Arial Unicode MS","Arial");const o=n[s],a=sd(o,1);f0(a);const l=a.split(" ");i.push([l.slice(3).join(" ").replace(/"/g,""),l[1],l[0]])}for(let s=0,r=i.length;s<r;++s){const o=i[s],a=o[0];if(!NI(a)&&Ji.get(`${o[2]}
${o[1]} 
${a}`)!==100){const l=e.replace("{font-family}",a.replace(/ /g,"-").toLowerCase()).replace("{Font+Family}",a.replace(/ /g,"+")).replace("{fontweight}",o[1]).replace("{-fontstyle}",o[2].replace("normal","").replace(/(.+)/,"-$1")).replace("{fontstyle}",o[2]);if(!document.querySelector('link[href="'+l+'"]')){const h=document.createElement("link");h.href=l,h.rel="stylesheet",document.head.appendChild(h)}}}return tu[t]=n,n}const GI={Point:1,MultiPoint:1,LineString:2,MultiLineString:2,Polygon:3,MultiPolygon:3},zI={center:[.5,.5],left:[0,.5],right:[1,.5],top:[.5,0],bottom:[.5,1],"top-left":[0,0],"top-right":[1,0],"bottom-left":[0,1],"bottom-right":[1,1]},BI=function(n,e){const t=hI(n,e);if(t.result==="error")throw new Error(t.value.map(i=>`${i.key}: ${i.message}`).join(", "));return t.value},ad={},vh={zoom:0};let wl,iu;function ee(n,e,t,i,s,r,o){const a=n.id;r||(r={},console.warn("No functionCache provided to getValue()")),r[a]||(r[a]={});const l=r[a];if(!l[t]){let h=(n[e]||ad)[t];const c=K_[`${e}_${n.type}`][t];h===void 0&&(h=c.default);let u=lI(h);if(!u&&Z_(h)&&(h=WR(h,c),u=!0),u){const d=BI(h,c);l[t]=d.evaluate.bind(d)}else c.type=="color"&&(h=yi.parse(h)),l[t]=function(){return h}}return vh.zoom=i,l[t](vh,s,o)}function UI(n,e,t,i){return ee(n,"layout","icon-allow-overlap",e,t,i)?ee(n,"layout","icon-ignore-placement",e,t,i)?"none":"obstacle":"declutter"}function jI(n,e,t,i,s){return s||console.warn("No filterCache provided to evaluateFilter()"),n in s||(s[n]=fI(e).filter),vh.zoom=i,s[n](vh,t)}function xs(n,e){if(n){if(n.a===0||e===0)return;const t=n.a;return e=e===void 0?1:e,t===0?"transparent":"rgba("+Math.round(n.r*255/t)+","+Math.round(n.g*255/t)+","+Math.round(n.b*255/t)+","+t*e+")"}return n}const $I=/\{[^{}}]*\}/g;function nu(n,e){return n.replace($I,function(t){return e[t.slice(1,-1)]||""})}const qI={};function VI(n,e,t,i=mg,s=void 0,r=void 0,o=void 0,a=void 0){if(typeof e=="string"&&(e=JSON.parse(e)),e.version!=8)throw new Error("glStyle version 8 required.");qI[SI(e,n)]=Array.from(arguments);let l,h,c;if(r){if(typeof Image<"u"){const C=new Image;let M;r instanceof Request?fetch(r).then(R=>R.blob()).then(R=>{M=URL.createObjectURL(R),C.src=M}).catch(()=>{}):(C.crossOrigin="anonymous",C.src=r,M&&URL.revokeObjectURL(M)),C.onload=function(){l=C,h=[C.width,C.height],n.changed(),C.onload=null}}else if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope){const C=self;C.postMessage({action:"loadImage",src:r}),C.addEventListener("message",function(R){R.data.action==="imageLoaded"&&R.data.src===r&&(l=R.data.image,h=[l.width,l.height])})}}const u=bI(e.layers),d={},f=[],g={},p={},m=TI(e),v=RI(e);let y;for(let C=0,M=u.length;C<M;++C){const R=u[C],N=R.id;if(typeof t=="string"&&R.source==t||t.indexOf(N)!==-1){const G=R["source-layer"];if(y){if(R.source!==y)throw new Error(`Layer "${N}" does not use source "${y}`)}else{y=R.source;const B=e.sources[y];if(!B)throw new Error(`Source "${y}" is not defined`);const O=B.type;if(O!=="vector"&&O!=="geojson")throw new Error(`Source "${y}" is not of type "vector" or "geojson", but "${O}"`)}let S=d[G];S||(S=[],d[G]=S),S.push({layer:R,index:C}),f.push(N)}}const x=new xt,w=new jt,b=[],E=function(C,M,R){const N=C.getProperties(),G=d[N.layer];if(!G)return;let S=i.indexOf(M);S==-1&&(S=LI(M,i));const B=GI[C.getGeometry().getType()],O={id:C.getId(),properties:N,type:B},L=n.get("mapbox-featurestate")[C.getId()];let P=-1;for(let z=0,Q=G.length;z<Q;++z){const Te=G[z],I=Te.layer,it=I.id;if(R!==void 0&&R!==it)continue;const A=I.layout||ad,nt=I.paint||ad;if(A.visibility==="none"||"minzoom"in I&&S<I.minzoom||"maxzoom"in I&&S>=I.maxzoom)continue;const Re=I.filter;if(!Re||jI(it,Re,O,S,v)){let me,_t,Dt,Ue,dt,$;const Ai=Te.index;if(B==3&&(I.type=="fill"||I.type=="fill-extrusion"))if(_t=ee(I,"paint",I.type+"-opacity",S,O,m,L),I.type+"-pattern"in nt){const be=ee(I,"paint",I.type+"-pattern",S,O,m,L);if(be){const Le=typeof be=="string"?nu(be,N):be.toString();if(l&&s&&s[Le]){++P,$=b[P],(!$||!$.getFill()||$.getStroke()||$.getText())&&($=new $t({fill:new jt}),b[P]=$),Dt=$.getFill(),$.setZIndex(Ai);const Ie=Le+"."+_t;let Ae=p[Ie];if(!Ae){const ye=s[Le],we=sv(ye.width,ye.height),lt=we.getContext("2d");lt.globalAlpha=_t,lt.drawImage(l,ye.x,ye.y,ye.width,ye.height,0,0,ye.width,ye.height),Ae=lt.createPattern(we,"repeat"),p[Ie]=Ae}Dt.setColor(Ae)}}}else me=xs(ee(I,"paint",I.type+"-color",S,O,m,L),_t),I.type+"-outline-color"in nt&&(dt=xs(ee(I,"paint",I.type+"-outline-color",S,O,m,L),_t)),dt||(dt=me),(me||dt)&&(++P,$=b[P],(!$||me&&!$.getFill()||!me&&$.getFill()||dt&&!$.getStroke()||!dt&&$.getStroke()||$.getText())&&($=new $t({fill:me?new jt:void 0,stroke:dt?new xt:void 0}),b[P]=$),me&&(Dt=$.getFill(),Dt.setColor(me)),dt&&(Ue=$.getStroke(),Ue.setColor(dt),Ue.setWidth(.5)),$.setZIndex(Ai));if(B!=1&&I.type=="line"){me=!("line-pattern"in nt)&&"line-color"in nt?xs(ee(I,"paint","line-color",S,O,m,L),ee(I,"paint","line-opacity",S,O,m,L)):void 0;const be=ee(I,"paint","line-width",S,O,m,L);me&&be>0&&(++P,$=b[P],(!$||!$.getStroke()||$.getFill()||$.getText())&&($=new $t({stroke:new xt}),b[P]=$),Ue=$.getStroke(),Ue.setLineCap(ee(I,"layout","line-cap",S,O,m,L)),Ue.setLineJoin(ee(I,"layout","line-join",S,O,m,L)),Ue.setMiterLimit(ee(I,"layout","line-miter-limit",S,O,m,L)),Ue.setColor(me),Ue.setWidth(be),Ue.setLineDash(nt["line-dasharray"]?ee(I,"paint","line-dasharray",S,O,m,L).map(function(Le){return Le*be}):null),$.setZIndex(Ai))}let Fi=!1,ze=null,Oi=0,ki,Ve,On;if((B==1||B==2)&&"icon-image"in A){const be=ee(I,"layout","icon-image",S,O,m,L);if(be){ki=typeof be=="string"?nu(be,N):be.toString();let Le;const Ie=a?a(n,ki):void 0;if(l&&s&&s[ki]||Ie){const Ae=ee(I,"layout","icon-rotation-alignment",S,O,m,L);if(B==2){const ye=C.getGeometry();if(ye.getFlatMidpoint||ye.getFlatMidpoints){const we=ye.getExtent();if(Math.sqrt(Math.max(Math.pow((we[2]-we[0])/M,2),Math.pow((we[3]-we[1])/M,2)))>150){const _e=ye.getType()==="MultiLineString"?ye.getFlatMidpoints():ye.getFlatMidpoint();if(iu||(wl=[NaN,NaN],iu=new Du("Point",wl,[],{},null)),Le=iu,wl[0]=_e[0],wl[1]=_e[1],ee(I,"layout","symbol-placement",S,O,m,L)==="line"&&Ae==="map"){const Gt=ye.getStride(),Rt=ye.getFlatCoordinates();for(let Lt=0,qe=Rt.length-Gt;Lt<qe;Lt+=Gt){const ft=Rt[Lt],zt=Rt[Lt+1],Ye=Rt[Lt+Gt],ai=Rt[Lt+Gt+1],gs=Math.min(ft,Ye),ps=Math.min(zt,ai),ja=Math.max(ft,Ye),$a=Math.max(zt,ai);if(_e[0]>=gs&&_e[0]<=ja&&_e[1]>=ps&&_e[1]<=$a){Oi=Math.atan2(zt-ai,Ye-ft);break}}}}}}if(B!==2||Le){const ye=ee(I,"layout","icon-size",S,O,m,L),we=nt["icon-color"]!==void 0?ee(I,"paint","icon-color",S,O,m,L):null;if(!we||we.a!==0){const lt=ee(I,"paint","icon-halo-color",S,O,m,L),_e=ee(I,"paint","icon-halo-width",S,O,m,L);let bt=`${ki}.${ye}.${_e}.${lt}`;if(we!==null&&(bt+=`.${we}`),Ve=g[bt],!Ve){const Gt=UI(I,S,O,m);let Rt;"icon-offset"in A&&(Rt=ee(I,"layout","icon-offset",S,O,m,L).slice(0),Rt[1]*=-1);let Lt=we?[we.r*255,we.g*255,we.b*255,we.a]:void 0;if(Ie){const qe={color:Lt,rotateWithView:Ae==="map",displacement:Rt,declutterMode:Gt};typeof Ie=="string"?qe.src=Ie:(qe.img=Ie,qe.imgSize=[Ie.width,Ie.height]),Ve=new so(qe)}else{const qe=s[ki];let ft,zt,Ye;_e?qe.sdf?(ft=Em(Cm(l,qe,we),{x:0,y:0,width:qe.width,height:qe.height,pixelRatio:qe.pixelRatio},_e,lt),Lt=void 0):ft=Em(l,qe,_e,lt):(qe.sdf?(c||(c=Cm(l,{x:0,y:0,width:h[0],height:h[1]},{r:1,g:1,b:1,a:1})),ft=c):ft=l,zt=[qe.width,qe.height],Ye=[qe.x,qe.y]),Ve=new so({color:Lt,img:ft,imgSize:h,size:zt,offset:Ye,rotateWithView:Ae==="map",scale:ye/qe.pixelRatio,displacement:Rt,declutterMode:Gt})}g[bt]=Ve}}Ve&&(++P,$=b[P],(!$||!$.getImage()||$.getFill()||$.getStroke())&&($=new $t,b[P]=$),$.setGeometry(Le),Ve.setRotation(Oi+Qc(ee(I,"layout","icon-rotate",S,O,m,L))),Ve.setOpacity(ee(I,"paint","icon-opacity",S,O,m,L)),Ve.setAnchor(zI[ee(I,"layout","icon-anchor",S,O,m,L)]),$.setImage(Ve),ze=$.getText(),$.setText(void 0),$.setZIndex(Ai),Fi=!0,On=!1)}else On=!0}}}if(B==1&&I.type==="circle"){++P,$=b[P],(!$||!$.getImage()||$.getFill()||$.getStroke())&&($=new $t,b[P]=$);const be="circle-radius"in nt?ee(I,"paint","circle-radius",S,O,m,L):5,Le=xs(ee(I,"paint","circle-stroke-color",S,O,m,L),ee(I,"paint","circle-stroke-opacity",S,O,m,L)),Ie=xs(ee(I,"paint","circle-color",S,O,m,L),ee(I,"paint","circle-opacity",S,O,m,L)),Ae=ee(I,"paint","circle-stroke-width",S,O,m,L),ye=be+"."+Le+"."+Ie+"."+Ae;Ve=g[ye],Ve||(Ve=new Hn({radius:be,stroke:Le&&Ae>0?new xt({width:Ae,color:Le}):void 0,fill:Ie?new jt({color:Ie}):void 0,declutterMode:"none"}),g[ye]=Ve),$.setImage(Ve),ze=$.getText(),$.setText(void 0),$.setGeometry(void 0),$.setZIndex(Ai),Fi=!0}let Qe,Yi,vi,xi,at,Tt;if("text-field"in A){xi=Math.round(ee(I,"layout","text-size",S,O,m,L));const be=ee(I,"layout","text-font",S,O,m,L);vi=ee(I,"layout","text-line-height",S,O,m,L),Yi=sd(o?o(be,e.metadata?e.metadata["ol:webfonts"]:void 0):be,xi,vi),Yi.includes("sans-serif")||(Yi+=",sans-serif"),at=ee(I,"layout","text-letter-spacing",S,O,m,L),Tt=ee(I,"layout","text-max-width",S,O,m,L);const Le=ee(I,"layout","text-field",S,O,m,L);typeof Le=="object"&&Le.sections?Le.sections.length===1?Qe=Le.toString():Qe=Le.sections.reduce((Ie,Ae,ye)=>{const we=Ae.fontStack?Ae.fontStack.split(","):be,lt=sd(o?o(we):we,xi*(Ae.scale||1),vi);let _e=Ae.text;if(_e===`
`)return Ie.push(`
`,""),Ie;if(B==2){Ie.push(rd(_e,at),lt);return}_e=od(_e,lt,Tt,at).split(`
`);for(let bt=0,Gt=_e.length;bt<Gt;++bt)bt>0&&Ie.push(`
`,""),Ie.push(_e[bt],lt);return Ie},[]):Qe=nu(Le,N).trim(),_t=ee(I,"paint","text-opacity",S,O,m,L)}if(Qe&&_t&&!On){Fi||(++P,$=b[P],(!$||!$.getText()||$.getFill()||$.getStroke())&&($=new $t,b[P]=$),$.setImage(void 0),$.setGeometry(void 0)),$.getText()||$.setText(ze||new uf({padding:[2,2,2,2]})),ze=$.getText();const be=A["text-transform"];be=="uppercase"?Qe=Array.isArray(Qe)?Qe.map((Ye,ai)=>ai%2?Ye:Ye.toUpperCase()):Qe.toUpperCase():be=="lowercase"&&(Qe=Array.isArray(Qe)?Qe.map((Ye,ai)=>ai%2?Ye:Ye.toLowerCase()):Qe.toLowerCase());const Le=Array.isArray(Qe)?Qe:B==2?rd(Qe,at):od(Qe,Yi,Tt,at);ze.setText(Le),ze.setFont(Yi),ze.setRotation(Qc(ee(I,"layout","text-rotate",S,O,m,L)));const Ie=ee(I,"layout","text-anchor",S,O,m,L),Ae=Fi||B==1?"point":ee(I,"layout","symbol-placement",S,O,m,L);let ye;if(Ae==="line-center"?(ze.setPlacement("line"),ye="center"):ze.setPlacement(Ae),Ae==="line"&&typeof ze.setRepeat=="function"){const Ye=ee(I,"layout","symbol-spacing",S,O,m,L);ze.setRepeat(Ye*2)}ze.setOverflow(Ae==="point");let we=ee(I,"paint","text-halo-width",S,O,m,L);const lt=ee(I,"layout","text-offset",S,O,m,L),_e=ee(I,"paint","text-translate",S,O,m,L);let bt=0,Gt=0;if(Ae=="point"){ye="center",Ie.indexOf("left")!==-1?(ye="left",Gt=we):Ie.indexOf("right")!==-1&&(ye="right",Gt=-we);const Ye=ee(I,"layout","text-rotation-alignment",S,O,m,L);ze.setRotateWithView(Ye=="map")}else ze.setMaxAngle(Qc(ee(I,"layout","text-max-angle",S,O,m,L))*Qe.length/Le.length),ze.setRotateWithView(!1);ze.setTextAlign(ye);let Rt="middle";Ie.indexOf("bottom")==0?(Rt="bottom",bt=-we-.5*(vi-1)*xi):Ie.indexOf("top")==0&&(Rt="top",bt=we+.5*(vi-1)*xi),ze.setTextBaseline(Rt);const Lt=ee(I,"layout","text-justify",S,O,m,L);ze.setJustify(Lt==="auto"?void 0:Lt),ze.setOffsetX(lt[0]*xi+Gt+_e[0]),ze.setOffsetY(lt[1]*xi+bt+_e[1]),w.setColor(xs(ee(I,"paint","text-color",S,O,m,L),_t)),ze.setFill(w);const qe=xs(ee(I,"paint","text-halo-color",S,O,m,L),_t);if(qe){x.setColor(qe),we*=2;const Ye=.5*xi;x.setWidth(we<=Ye?we:Ye),ze.setStroke(x)}else ze.setStroke(void 0);const ft=ee(I,"layout","text-padding",S,O,m,L),zt=ze.getPadding();ft!==zt[0]&&(zt[0]=ft,zt[1]=ft,zt[2]=ft,zt[3]=ft),$.setZIndex(Ai)}}}if(P>-1)return b.length=P+1,b};return n.setStyle(E),n.set("mapbox-source",y),n.set("mapbox-layers",f),n.set("mapbox-featurestate",n.get("mapbox-featurestate")||{}),E}function WI(n,e=512){return n.getExtent()?oc({extent:n.getExtent(),tileSize:e,maxZoom:22}).getResolutions():mg}function HI(n,e){return e.accessToken||(e=Object.assign({},e),new URL(n).searchParams.forEach((i,s)=>{e.accessToken=i,e.accessTokenParam=s})),e}function XI(n,e,t="",i={},s=void 0){let r,o,a,l,h=!0;return typeof t!="string"&&!Array.isArray(t)?(a=t,l=a.source||a.layers,i=a):l=t,typeof i=="string"?(r=i,a={}):(r=i.styleUrl,a=i),a.updateSource===!1&&(h=!1),s||(s=a.resolutions),!r&&typeof e=="string"&&!e.trim().startsWith("{")&&(r=e),r&&(r=r.startsWith("data:")?location.href:nv(r,a.accessToken),a=HI(r,a)),new Promise(function(c,u){II(e,a).then(function(d){if(d.version!=8)return u(new Error("glStyle version 8 required."));if(!(n instanceof Is||n instanceof Ps))return u(new Error("Can only apply to VectorLayer or VectorTileLayer"));const f=n instanceof Ps?"vector":"geojson";if(l?Array.isArray(l)?o=d.layers.find(function(w){return w.id===l[0]}).source:o=l:(o=Object.keys(d.sources).find(function(w){return d.sources[w].type===f}),l=o),!o)return u(new Error(`No ${f} source found in the glStyle.`));function g(){if(!h)return Promise.resolve();if(n instanceof Ps)return KI(d.sources[o],r,a).then(function(C){const M=n.getSource();if(M?C!==M&&(M.setTileUrlFunction(C.getTileUrlFunction()),typeof M.setUrls=="function"&&typeof C.getUrls=="function"&&M.setUrls(C.getUrls()),M.format_||(M.format_=C.format_),M.getAttributions()||M.setAttributions(C.getAttributions()),M.getTileLoadFunction()===m_&&M.setTileLoadFunction(C.getTileLoadFunction()),ui(M.getProjection(),C.getProjection())&&(M.tileGrid=C.getTileGrid())):n.setSource(C),!isFinite(n.getMaxResolution())&&!isFinite(n.getMinZoom())){const R=n.getSource().getTileGrid();n.setMaxResolution(R.getResolution(R.getMinZoom()))}});const w=d.sources[o];let b=n.getSource();(!b||b.get("mapbox-source")!==w)&&(b=QI(w,r,a));const E=n.getSource();return E?b!==E&&(E.getAttributions()||E.setAttributions(b.getAttributions()),E.format_||(E.format_=b.getFormat()),E.url_=b.getUrl()):n.setSource(b),Promise.resolve()}let p,m,v,y;function x(){if(!y&&(!d.sprite||m)){if(a.projection&&!s){const b=X(a.projection).getUnits();b!=="m"&&(s=mg.map(E=>E/Ds[b]))}y=VI(n,d,l,s,m,v,DI,a.getImage),n.getStyle()?g().then(c).catch(u):u(new Error(`Nothing to show for source [${o}]`))}else y?(n.setStyle(y),g().then(c).catch(u)):u(new Error("Something went wrong trying to apply style."))}if(d.sprite){const w=new URL(CI(d.sprite,a.accessToken,r||location.href));p=window.devicePixelRatio>=1.5?.5:1;const b=p==.5?"@2x":"";let E=w.origin+w.pathname+b+".json"+w.search;new Promise(function(C,M){lo("Sprite",E,a).then(C).catch(function(R){E=w.origin+w.pathname+".json"+w.search,lo("Sprite",E,a).then(C).catch(M)})}).then(function(C){if(C===void 0&&u(new Error("No sprites found.")),m=C,v=w.origin+w.pathname+b+".png"+w.search,a.transformRequest){const M=a.transformRequest(v,"SpriteImage")||v;M instanceof Request&&(v=M)}x()}).catch(function(C){u(new Error(`Sprites cannot be loaded: ${E}: ${C.message}`))})}else x()}).catch(u)})}function YI(n,e){const t=n.bounds;if(t){const i=Bg([t[0],t[1]],e),s=Bg([t[2],t[3]],e);return[i[0],i[1],s[0],s[1]]}return X(e).getExtent()}function ZI(n,e,t){const i=new cR({tileJSON:e,tileSize:n.tileSize||e.tileSize||512}),s=i.getTileJSON(),r=i.getTileGrid(),o=X(t.projection||"EPSG:3857"),a=YI(s,o),l=o.getExtent(),h=s.minzoom||0,c=s.maxzoom||22,u={attributions:i.getAttributions(),projection:o,tileGrid:new Fa({origin:l?fn(l):r.getOrigin(0),extent:a||r.getExtent(),minZoom:h,resolutions:WI(o,e.tileSize).slice(0,c+1),tileSize:r.getTileSize(0)})};return Array.isArray(s.tiles)?u.urls=s.tiles:u.url=s.tiles,u}function KI(n,e,t){return new Promise(function(i,s){PI(n,e,t).then(function({tileJson:r,tileLoadFunction:o}){const a=ZI(n,r,t);a.tileLoadFunction=o,a.format=new v0,i(new p_(a))}).catch(s)})}function JI(n){return`{bbox-${(n?n.getCode():"EPSG:3857").toLowerCase().replace(/[^a-z0-9]/g,"-")}}`}function QI(n,e,t){const i=t.projection?new tp({dataProjection:t.projection}):new tp,s=n.data,r={};if(typeof s=="string"){const a=Pl(s,t.accessToken,t.accessTokenParam||"access_token",e||location.href);if(/\{bbox-[0-9a-z-]+\}/.test(a)){const h=(u,d,f)=>{const g=JI(f);return a.replace(g,`${u.join(",")}`)},c=new Ii({attributions:n.attribution,format:i,loader:(u,d,f,g,p)=>{const m=typeof h=="function"?h(u,d,f):h;lo("GeoJSON",m,t).then(v=>{const y=c.getFormat().readFeatures(v,{featureProjection:f});c.addFeatures(y),g(y)}).catch(v=>{c.removeLoadedExtent(u),p()})},strategy:DM});return c.set("mapbox-source",n),c}const l=new Ii({attributions:n.attribution,format:i,url:a,loader:(h,c,u,d,f)=>{lo("GeoJSON",a,t).then(g=>{const p=l.getFormat().readFeatures(g,{featureProjection:u});l.addFeatures(p),d(p)}).catch(g=>{l.removeLoadedExtent(h),f()})}});return l}r.features=i.readFeatures(s,{featureProjection:"EPSG:3857"});const o=new Ii(Object.assign({attributions:n.attribution,format:i},r));return o.set("mapbox-source",n),o}class e2{constructor(e,t){_(this,"map");_(this,"srid");_(this,"basemapLayers",[]);this.map=e,this.srid=t}removeAllBasemapLayers(){this.basemapLayers.forEach(e=>{this.map.removeLayer(e)}),this.basemapLayers=[]}addBasemapLayer(e){const t=new Ps({declutter:!0});XI(t,e.style,e.source),this.basemapLayers.push(t),this.map.getLayers().insertAt(0,t)}}var pa,ld,zh,ov;class t2{constructor(e,t){se(this,pa);se(this,zh);_(this,"map");_(this,"srid");_(this,"wmtsCapabilitiesByServer",{});_(this,"wmtsLayers",{});_(this,"basemapLayers",[]);this.map=e,this.srid=t}removeAllBasemapLayers(){this.basemapLayers.forEach(e=>{this.map.removeLayer(e)}),this.basemapLayers=[]}addLayer(e){ae(this,pa,ld).call(this,e,!1)}addBasemapLayer(e){ae(this,pa,ld).call(this,e,!0)}removeLayer(e){if(this.layerExists(e)){const t=this.wmtsLayers[e.layerUniqueId];delete this.wmtsLayers[e.layerUniqueId],this.map.removeLayer(t)}else throw new Error("Cannot remove this layer: it does not exist")}layerExists(e){return e.layerUniqueId in this.wmtsLayers}getLayer(e){return this.layerExists(e)?this.wmtsLayers[e.layerUniqueId]:null}changeOpacity(e,t){if(this.layerExists(e))this.wmtsLayers[e.layerUniqueId].setOpacity(t);else throw new Error("Cannot change opacity for this layer: it does not exist")}}pa=new WeakSet,ld=function(e,t){ae(this,zh,ov).call(this,e.url,i=>{const s=pR(i,{layer:e.layers,projection:this.srid});if(s===null){console.log("Cannot create WMTS layer for layer "+e.layers);return}for(let o in e.dimensions)o in s.dimensions?s.dimensions[o]=e.dimensions[o]:console.warn("A dimension "+o+" was defined for the WMTS layer "+e.layers+" but the server does not seem to accept it.");const r=new Nf({opacity:e.opacity,source:new gR(s)});t?(this.basemapLayers.push(r),this.map.getLayers().insertAt(0,r)):(this.wmtsLayers[e.layerUniqueId]=r,this.map.addLayer(r))})},zh=new WeakSet,ov=function(e,t){if(e in this.wmtsCapabilitiesByServer){const i=this.wmtsCapabilitiesByServer[e];t(i)}else fetch(e).then(i=>i.text()).then(i=>{const r=new uC().read(i);this.wmtsCapabilitiesByServer[e]=r,t(r)})};class i2{constructor(e,t){_(this,"map");_(this,"srid");_(this,"configManager");_(this,"zoom",null);_(this,"resolution",null);_(this,"scale",null);_(this,"center");_(this,"extent");_(this,"scales");_(this,"allowedResolutions");_(this,"constraintScales");this.map=e,this.srid=t,this.configManager=ns.getInstance(),this.center=this.configManager.Config.map.startPosition.split(",").map(Number),this.zoom=Number(this.configManager.Config.map.startZoom),this.constraintScales=this.configManager.Config.map.constraintScales,this.extent=this.configManager.Config.map.maxExtent.split(",").map(Number),this.scales=this.configManager.Config.map.scales,this.allowedResolutions=this.scalesToResolutions(this.scales)}get projection(){return X(this.srid)}scalesToResolutions(e){const t=new Array;return e.forEach(i=>{const s=this.scaleToResolution(i);t.push(s)}),t}scaleToResolution(e){const t=this.projection.getUnits();return e/ii.METERS_PER_UNIT[t]/ii.INCHES_PER_METER/ii.SCREEN_DOTS_PER_INCH}getScale(){const e=this.projection.getUnits();return this.map.getView().getResolution()*ii.METERS_PER_UNIT[e]*ii.INCHES_PER_METER*ii.SCREEN_DOTS_PER_INCH}getView(){return new Ui({center:this.center,zoom:this.zoom??void 0,projection:this.srid,extent:this.extent,resolutions:this.allowedResolutions,constrainResolution:this.constraintScales})}getViewFromSrid(e){this.srid=e;const t=this.map.getView(),i=t.getProjection(),s=t.getResolution(),r=t.getCenter(),o=t.getRotation(),a=t.get("extent"),l=Qn(r,i,this.projection),h=i.getMetersPerUnit(),c=this.projection.getMetersPerUnit(),u=zl(i,1/h,r,"m")*h,d=zl(this.projection,1/c,l,"m")*c,f=s*u/d,g=Qn([a[0],a[1]],i,this.projection),p=Qn([a[2],a[3]],i,this.projection),m=[g[0],g[1],p[0],p[1]];return this.allowedResolutions=this.scalesToResolutions(this.scales),new Ui({center:l,resolution:f,rotation:o,projection:this.projection,resolutions:this.allowedResolutions,constrainResolution:this.constraintScales,extent:m})}setCenter(e){this.center=e,this.map.getView().setCenter(e)}setZoom(e){this.zoom=e,this.map.getView().setZoom(this.zoom),this.resolution=this.map.getView().getResolution()??null,this.scale=this.getScale()}setResolution(e){this.resolution=e,this.map.getView().setResolution(this.resolution),this.zoom=this.map.getView().getZoom()??null,this.scale=this.getScale()}setScale(e){this.scale=e,this.resolution=this.scaleToResolution(e),this.map.getView().setResolution(this.resolution),this.zoom=this.map.getView().getZoom()??null}}class n2{constructor(e){_(this,"olFeature");this.olFeature=e}get name(){return this.olFeature.get("name")}set name(e){this.olFeature.set("name",e)}get strokeColor(){return this.olFeature.get("strokeColor")}set strokeColor(e){this.olFeature.set("strokeColor",e)}get strokeWidth(){return this.olFeature.get("strokeWidth")}set strokeWidth(e){this.olFeature.set("strokeWidth",e)}get fillColor(){return this.olFeature.get("fillColor")}set fillColor(e){this.olFeature.set("fillColor",e)}get textSize(){return this.olFeature.get("textSize")}set textSize(e){this.olFeature.set("textSize",e)}get id(){return H(this.olFeature)}get geometry(){return console.warn("not implemented yet"),null}}class hd extends En{constructor(e,t){super(e,t)}}class xh extends En{constructor(t,i){super(t,i);_(this,"style");_(this,"source");_(this,"projection");this.style=t.style,this.projection=t.projection,this.source=t.source}}class ur extends En{constructor(t,i){if(!t.url)throw new Error("No URL defined for WMTS layer "+t.name);super(t,i);_(this,"url");_(this,"layers");_(this,"dimensions");this.url=t.url,this.layers=t.layer,this.dimensions=t.dimensions}get layerUniqueId(){return this.dimensions!==null?this.layers+JSON.stringify(this.dimensions):this.name}}class s2 extends ot{constructor(){super("map");_(this,"template",()=>xe`<style>
#container, #ol-map {
  background-color: var(--bkg-color);
  position: absolute;
  height: 100%;
  width: 100%;
  overflow:hidden;
}

#cs-map {
  background-color: var(--bkg-color);
  position: absolute;
  height: 100%;
  overflow: hidden;
  left: 60%;
  width: 40%;
  display: none;
  border-left: solid 3px #444;
}

.ol-zoom {
  right: 1rem;
  top: 1rem;
  left: unset !important;
}

.ol-rotate {
  right: 1rem;
  top: 4rem;
}

#swiper {
  display: none;
  width: 99%;
  position: absolute;
  left: 0.5%;
  top: 50%;
  height: 0;
}

input[type=range] {
  -webkit-appearance: none;
  width: 100%;
}

/* Webkit/Chrome specific */
input[type=range]::-webkit-slider-runnable-track {
  height: 0;
}

input[type=range]::-webkit-slider-thumb {
  -webkit-appearance: none;
  border: 2px solid #444;
  height: 0;
  margin-top: -1000px;
  padding-top: 1000px;
  padding-bottom: 1000px;
  width: 6px;
  background: var(--bkg-color);;
  cursor: ew-resize;
}

/* Firefox specific */
input[type=range]::-moz-range-thumb {
  border: 2px solid #444;
  height: 0;
  padding-top: 1000px;
  padding-bottom: 1000px;
  width: 3px;
  background: var(--bkg-color);;
  cursor: ew-resize;
}

/* TODO REG: Verify styling on Edge and Safari */
/*
input[type=range]::-ms-thumb {
  margin-top: 1px;
  box-shadow: 0px 0px 0px 50555C;
  border: 2px solid #50555C;
  height: 14px;
  width: 40px;
  border-radius: 5px;
  background: #FFFFFF;
  cursor: pointer;
}
*/
</style>
<link rel="stylesheet" href="lib/openlayers/ol.css">

<div id="container">
    <div id="ol-map"></div>
    <div id="cs-map"></div>
    <input id="swiper" type="range" min="0" max="1000" step="1" />
</div>
`);_(this,"map");_(this,"mapTarget");_(this,"map3d");_(this,"map3dTarget");_(this,"swiper");_(this,"swipeManager");_(this,"wmtsManager");_(this,"wmsManager");_(this,"osmManager");_(this,"viewManager");_(this,"vectorTilesManager");_(this,"srid");_(this,"redliningFeaturesCollection",new Vt);_(this,"redliningSource");_(this,"redliningLayer",null);_(this,"draw",null);_(this,"snap");_(this,"selectedFeaturesCollection",new Vt);_(this,"focusedFeaturesCollection",new Vt);_(this,"selectionLayer");_(this,"focusLayer");_(this,"focusAnimation",null);_(this,"pixelTolerance",10);_(this,"dragbox");_(this,"maskLayer",new BR({name:"PrintMask"}))}get projection(){return X(this.srid)}registerEvents(){this.messageManager.register(this.onCustomGirafeEvent.bind(this)),this.swiper.addEventListener("input",()=>this.map.render()),this.stateManager.subscribe("activeBasemap",(t,i)=>this.onChangeBasemap(i)),this.stateManager.subscribe("projection",(t,i)=>this.onChangeProjection(i)),this.stateManager.subscribe("interface.darkMode",(t,i)=>this.onChangeDarkMode()),this.stateManager.subscribe("position",(t,i)=>this.onPositionChanged(i)),this.stateManager.subscribe("position.scale",(t,i)=>this.onChangeScale(i)),this.stateManager.subscribe("position.resolution",(t,i)=>this.zoomToResolution(i)),this.stateManager.subscribe("position.zoom",(t,i)=>this.zoomToZoom(i)),this.stateManager.subscribe("position.center",(t,i)=>this.panToCoordinate(i)),this.stateManager.subscribe("selection.selectedFeatures",(t,i)=>this.onFeaturesSelected(i)),this.stateManager.subscribe("selection.focusedFeature",(t,i)=>this.onFeatureFocused(i)),this.stateManager.subscribe("layers.swipedLayers",(t,i)=>this.onSwipedLayersChanged(i)),this.stateManager.subscribe("redlining.activeTool",(t,i)=>this.onRedliningToolChanged(i)),this.stateManager.subscribe("redlining.features",(t,i)=>this.onFeaturesChanged(t,i)),this.stateManager.subscribe("interface.printPanelVisible",(t,i)=>this.onPrintPanelToggled(i)),this.stateManager.subscribe("print.*",()=>this.onPrintStateChanged()),this.stateManager.subscribe("globe.display",()=>this.onGlobeToggled()),this.stateManager.subscribe("layers.layersList..*.activeState",(t,i,s)=>this.onLayerToggled(s)),this.stateManager.subscribe("layers.layersList..*.opacity",(t,i,s)=>this.onChangeOpacity(s)),this.stateManager.subscribe("layers.layersList..*.filter",(t,i,s)=>this.onChangeFilter(s)),this.stateManager.subscribe("layers.layersList..*.order",()=>this.onChangeOrder([]))}render(){super.render(),this.srid=this.configManager.Config.map.srid,this.mapTarget=this.shadow.getElementById("ol-map"),this.map3dTarget=this.shadow.getElementById("cs-map"),this.map=new OM({target:this.mapTarget,layers:[]}),this.state.olMap=this.map,this.wmsManager=new jR(this.map,this.srid),this.osmManager=new $R(this.map,this.srid),this.viewManager=new i2(this.map,this.srid),this.vectorTilesManager=new e2(this.map,this.srid),this.wmtsManager=new t2(this.map,this.srid),this.swiper=this.shadow.getElementById("swiper"),this.swipeManager=new UR(this.map,this.swiper,this.wmtsManager,this.wmsManager);const t=this.viewManager.getView();this.map.setView(t),this.redliningSource=new Ii({features:this.redliningFeaturesCollection}),this.redliningLayer=new Is({source:this.redliningSource}),this.map.addLayer(this.redliningLayer),this.redliningLayer.setZIndex(1001);const i=new Ii({features:this.selectedFeaturesCollection});this.configManager.loadConfig().then(()=>{this.selectionLayer=new Is({source:i,style:new $t({stroke:new xt({color:this.configManager.Config.selection.defaultStrokeColor,width:this.configManager.Config.selection.defaultStrokeWidth}),fill:new jt({color:this.configManager.Config.selection.defaultFillColor}),image:new Hn({radius:7,fill:new jt({color:this.configManager.Config.selection.defaultFillColor}),stroke:new xt({color:this.configManager.Config.selection.defaultStrokeColor,width:this.configManager.Config.selection.defaultStrokeWidth})})})}),this.map.addLayer(this.selectionLayer),this.selectionLayer.setZIndex(1002),new Ii({features:this.focusedFeaturesCollection}).on("addfeature",r=>{this.flash(r.feature)}),this.focusLayer=new Is({source:i,style:new $t({stroke:new xt({color:this.configManager.Config.selection.defaultFocusStrokeColor,width:this.configManager.Config.selection.defaultFocusStrokeWidth}),fill:new jt({color:this.configManager.Config.selection.defaultFocusFillColor}),image:new Hn({radius:7,fill:new jt({color:this.configManager.Config.selection.defaultFocusFillColor}),stroke:new xt({color:this.configManager.Config.selection.defaultFocusStrokeColor,width:this.configManager.Config.selection.defaultFocusStrokeWidth})})})}),this.map.addLayer(this.focusLayer),this.focusLayer.setZIndex(1003)}),this.dragbox=new D0({condition:lM}),this.map.addInteraction(this.dragbox),this.dragbox.on("boxend",s=>this.onDragSelection(s)),setTimeout(()=>{this.map.updateSize()},1e3)}getDefaultStyle(t){const i=t.get("strokeColor")?t.get("strokeColor"):this.configManager.Config.redlining.defaultStrokeColor,s=t.get("strokeWidth")?t.get("strokeWidth"):this.configManager.Config.redlining.defaultStrokeWidth,r=t.get("fillColor")?t.get("fillColor"):this.configManager.Config.redlining.defaultFillColor,o=t.get("textSize")?t.get("textSize"):this.configManager.Config.redlining.defaultTextSize;return t.set("strokeColor",i),t.set("strokeWidth",s),t.set("fillColor",r),t.set("textSize",o),new $t({stroke:new xt({color:i,width:s}),fill:new jt({color:r}),image:new Hn({radius:7,fill:new jt({color:r}),stroke:new xt({color:i,width:s})}),text:new uf({text:t.get("name"),font:"Bold "+o+"px/1 "+this.configManager.Config.redlining.defaultFont})})}listenOpenLayersEvents(){this.map.on("singleclick",t=>this.onClick(t)),this.map.on("loadstart",t=>this.onLoadStart(t)),this.map.on("loadend",t=>this.onLoadEnd(t)),this.map.on("moveend",t=>this.onMoveEnd(t)),this.map.on("pointermove",t=>this.onPointerMove(t)),this.redliningFeaturesCollection.on("add",t=>this.onFeatureAdded(t))}onLoadStart(t){this.state.loading=!0}onLoadEnd(t){this.state.loading=!1}onPointerMove(t){this.state.mouseCoordinates=t.coordinate}onMoveEnd(t){const i=this.map.getView(),s=new Hm;s.center=i.getCenter(),s.zoom=i.getZoom(),s.resolution=i.getResolution(),s.scale=this.viewManager.getScale(),s.isValid&&(this.state.position=s)}onClick(t){const i=[t.pixel[0]-this.pixelTolerance,t.pixel[1]-this.pixelTolerance],s=this.map.getCoordinateFromPixel(i),r=[t.pixel[0]+this.pixelTolerance,t.pixel[1]+this.pixelTolerance],o=this.map.getCoordinateFromPixel(r),a=[s[0],s[1],o[0],o[1]];this.wmsManager.selectFeatures(a)}onDragSelection(t){const i=this.dragbox.getGeometry().getExtent();this.wmsManager.selectFeatures(i)}flash(t){let s=Date.now(),r=s;const o=t.getGeometry().clone();this.focusAnimation!==null&&Bi(this.focusAnimation),this.focusAnimation=this.selectionLayer.on("postrender",l=>a(this,l));function a(l,h){const c=h.frameState,u=c.time-r;u>=2e3&&(r=Date.now());const d=pT(h),f=u/2e3,g=ls(f)*25+5,p=ls(1-f),m=c.time-s,v=Math.floor(m/100)%48,y=new $t({image:new Hn({radius:g,stroke:new xt({color:"rgba(255, 0, 0, "+p+")",width:.25+p})}),stroke:new xt({color:[255,0,0,1],width:12,lineDash:[16,32],lineDashOffset:v})});d.setStyle(y),d.drawGeometry(o),l.map.render()}}onFeatureAdded(t){const i=t.element;i.setId(uy());const s=Cg[this.getRandomInt(0,Cg.length)]+" "+t.element.getGeometry().getType();i.set("name",s),i.setStyle(o=>this.getDefaultStyle(o));const r=new n2(i);this.state.redlining.features.push(r)}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.listenOpenLayersEvents(),this.registerEvents()})}onPrintStateChanged(){this.state.print.format&&this.maskLayer.updateSize(this.state.print.format),this.state.print.scale&&this.maskLayer.updateScale(this.state.print.scale),this.map.updateSize()}onPrintPanelToggled(t){t?this.maskLayer.setMap(this.map):this.maskLayer.setMap(null)}onCustomGirafeEvent(t){t.action===Fs.zoomToExtent?this.zoomToExtent(t.extent):t.action===Fs.undoDraw&&this.draw.removeLastPoint()}onSwipedLayersChanged(t){t.left.length===0&&t.right.length===0?this.swipeManager.deactivateSwipe():(this.swipeLayersOnSide(t.left,"left"),this.swipeLayersOnSide(t.right,"right"))}swipeLayersOnSide(t,i){for(const s of t)s instanceof ht?this.swipeManager.activateSwipeForWms(s,i):s instanceof ur&&this.swipeManager.activateSwipeForWmts(s,i)}async create3dMap(){if(!this.map3d){await new Promise((r,o)=>{const a=document.createElement("script");a.type="text/javascript",a.src="lib/cesium/Cesium.js",a.onload=r,a.onerror=o,document.body.appendChild(a)}).catch(r=>{console.error("Error while loading Cesium",r)}),this.map3d=new jf({map:this.map,target:this.map3dTarget});const t=this.map3d.getCesiumScene(),i=await $v.fromUrl(this.configManager.Config.map3d.terrainUrl);t.terrainProvider=i;const s=await qv.fromUrl(this.configManager.Config.map3d.tilesetUrl);t.primitives.add(s)}}async onGlobeToggled(){this.state.globe.display==="full"?(await this.create3dMap(),this.mapTarget.style.display="none",this.map3dTarget.style.display="block",this.map3dTarget.style.left="0",this.map3dTarget.style.width="100%",this.map3d.setEnabled(!0)):this.state.globe.display==="side"?(await this.create3dMap(),this.mapTarget.style.display="block",this.mapTarget.style.width="60%",this.map3dTarget.style.display="block",this.map3dTarget.style.left="55%",this.map3dTarget.style.width="45%",this.map3d.setEnabled(!0)):(this.map3d&&this.map3d.setEnabled(!1),this.mapTarget.style.display="block",this.mapTarget.style.width="100%",this.map3dTarget.style.display="none")}onFeaturesSelected(t){if(this.selectedFeaturesCollection.clear(),t)for(const i of t)this.selectedFeaturesCollection.push(i)}onFeatureFocused(t){this.focusedFeaturesCollection.clear(),this.focusedFeaturesCollection.push(t)}onPositionChanged(t){this.zoomToResolution(t.resolution),t.isValid&&this.panToCoordinate(t.center)}onChangeScale(t){this.viewManager.setScale(t)}zoomToResolution(t){this.viewManager.setResolution(t)}zoomToZoom(t){this.viewManager.setZoom(t)}zoomToExtent(t){this.map.getView().fit(t)}panToCoordinate(t){this.viewManager.setCenter(t)}onChangeProjection(t){if(this.srid===t)return;this.srid=t;const i=this.viewManager.getViewFromSrid(t);this.map.setView(i)}onChangeDarkMode(){const t=this.shadow.querySelector("canvas");t&&(t.style.filter=this.state.interface.darkMode?"invert(100%) hue-rotate(180deg)":"")}onLayerToggled(t){t instanceof En&&(t.active?this.onAddLayers([t]):this.onRemoveLayers([t]))}onAddLayers(t){t.forEach(i=>{i instanceof ht?this.wmsManager.addLayer(i):i instanceof ur&&this.wmtsManager.addLayer(i)})}onRemoveLayers(t){t.forEach(i=>{i instanceof ht?this.wmsManager.removeLayer(i):i instanceof ur&&this.wmtsManager.layerExists(i)&&this.wmtsManager.removeLayer(i)})}onChangeOrder(t){alert("Not Implemented yet")}onChangeOpacity(t){t instanceof ht?this.wmsManager.changeOpacity(t):t instanceof ur&&this.wmtsManager.layerExists(t)&&this.wmtsManager.changeOpacity(t,t.opacity)}onChangeFilter(t){t instanceof ht&&this.wmsManager.changeFilter(t)}onChangeBasemap(t){this.wmtsManager.removeAllBasemapLayers(),this.wmsManager.removeAllBasemapLayers(),this.osmManager.removeAllBasemapLayers(),this.vectorTilesManager.removeAllBasemapLayers(),t.layersList.forEach(i=>{if(i instanceof hd)this.osmManager.addBasemapLayer();else if(i instanceof xh)this.vectorTilesManager.addBasemapLayer(i);else if(i instanceof ur)this.wmtsManager.addBasemapLayer(i);else if(i instanceof ht)this.wmsManager.addBasemapLayer(i);else throw new Error("Unknown basemap type")})}onFeaturesChanged(t,i){let s=[],r=[];Array.isArray(i)&&Array.isArray(t)?(s=t.filter(o=>!i.find(a=>a.olFeature.getId()===o.olFeature.getId())),r=i.filter(o=>!t.find(a=>a.olFeature.getId()===o.olFeature.getId()))):(this.isNullOrUndefined(t)||s.push(...t),this.isNullOrUndefined(i)||r.push(...i)),s.forEach(o=>{this.deleteFeature(o.olFeature)}),r.forEach(o=>{this.addFeature(o.olFeature)})}deleteFeature(t){const i=this.redliningFeaturesCollection.getArray().find(s=>s.getId()===t.getId());this.isNullOrUndefined(i)||this.redliningFeaturesCollection.remove(i)}addFeature(t){}onRedliningToolChanged(t){t===null?this.deactivateRedliningTool():this.activateRedliningTool(t)}activateRedliningTool(t){this.deactivateRedliningTool();let i,s=!1;t==="Square"?(t="Circle",i=iT(4)):t==="Rectangle"?(t="Circle",i=nT()):t==="Freeline"?(t="LineString",s=!0):t==="Freepolygon"&&(t="Polygon",s=!0),this.draw=new rT({source:this.redliningSource,type:t,freehand:s,geometryFunction:i});const r=new hT({source:this.redliningSource});this.map.addInteraction(r),this.map.addInteraction(this.draw),this.snap=new fT({source:this.redliningSource}),this.map.addInteraction(this.snap)}deactivateRedliningTool(){this.draw&&this.map.removeInteraction(this.draw),this.snap&&this.map.removeInteraction(this.snap)}getRandomInt(t,i){return t=Math.ceil(t),i=Math.floor(i),Math.floor(Math.random()*(i-t)+t)}}customElements.define("girafe-map",s2);var jr,$r;class r2 extends ot{constructor(){super("search");_(this,"template",()=>xe`<style>
#searchbox {
  background-color: var(--bkg-color);
  border-right: none;
  height: 2.5rem;
  border-radius: 6px;
  border: none;
  width: 100%;
  display: flex;
  flex-direction: row;
  box-shadow: var(--bx-shdw)
}

#search {
    font-size: 1rem;
    outline: none;
    margin: 0 0 0 0.5rem;
    padding-left: 0.8rem;
    border: 0;
    height: 2.2rem;
    width: auto;
    flex: 1 1 auto;
    -ms-flex: 1 1 auto;
    -webkit-flex: 1 1 auto;
    -webkit-appearance: none;
    background : transparent;
    color: var(--text-color);
}

#searchIcon {
    display: inline-block;
    width: 20px;
    height: 25px;
    color: var(--text-color);
    background-position: -121px 1px;
    padding: 9px 10px;
    background-repeat: no-repeat;
    background-clip: content-box;
    background-origin: content-box;
    -moz-background-clip: content-box;
    -moz-background-origin: content-box;
    -webkit-background-clip: content-box;
    -webkit-background-origin: content-box;
}

#results {
  z-index: 1000;
  margin-top : 0.1rem;
  margin-bottom: 0.5rem;
  position: absolute;
  top: 3.5rem;
  width: 36rem;
  max-height: 31rem;
  background-color: var(--bkg-color);
  overflow-x: hidden;
  scrollbar-width: thin;
}

.result, .title {
  display: inline-block;
  padding: 0.3rem 1rem;
  width: Calc(36rem - 2rem);
  border-top: solid 1px #ccc;
  line-height: 1.3rem;
}

.title {
  background-color: #555;
  color: var(--text-color);
  font-weight: 600;
  line-height: 2.5rem;
  font-size: 1.2rem;
}

.result {
  cursor: pointer;
}

.title i {
  margin-right: 1rem;
}

.result:hover {
  background-color: #aaa;
  color: var(--text-color);
}

</style>
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />

<div id="searchbox">
  <input id="search" length="20" maxlength="1000" autocomplete="off" autocorrect="off" i18n="Search" placeholder="Search..." />
  <a id="searchIcon" href="#" title="Geogirafe search"><i class="fa-solid fa-magnifying-glass"></i></a>
  <div id="results"></div>
</div>


`);se(this,jr,void 0);se(this,$r,void 0);_(this,"ignoreBlur",!1);_(this,"resultList",[]);_(this,"searchTermPlaceholder","###SEARCHTERM###");_(this,"initialSearchBoxHeight",this.convertRemToPixels(2.5))}get searchBox(){if(!Z(this,jr))throw new Error("You called searchBox before render");return Z(this,jr)}get resultsBox(){if(!Z(this,$r))throw new Error("You called resultsBox before render");return Z(this,$r)}render(){super.render(),Ze(this,jr,this.shadow.querySelector("#searchbox")),Ze(this,$r,this.shadow.querySelector("#results"))}registerEvents(){this.searchBox.addEventListener("input",t=>this.doSearch(t)),this.searchBox.addEventListener("focusin",t=>this.onFocusIn()),this.searchBox.addEventListener("focusout",t=>this.onFocusOut())}onFocusIn(){this.ignoreBlur=!1,this.resultsBox.style.display="block",this.setSearchBoxHeight(this.initialSearchBoxHeight+this.resultsBox.offsetHeight+20)}onFocusOut(){this.ignoreBlur||(this.resultsBox.style.display="none",this.setSearchBoxHeight(this.initialSearchBoxHeight))}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}clearSearch(){this.resultList=[],this.resultsBox.innerHTML="",this.setSearchBoxHeight(this.initialSearchBoxHeight)}doSearch(t){const i=t.target;if(i){const s=i.value;if(s.length<=0){this.clearSearch();return}const r=this.configManager.Config.search.url.replace(this.searchTermPlaceholder,s);fetch(r).then(o=>o.json()).then(o=>this.displayResults(o))}}displayResults(t){const i={};t.features.forEach(s=>{const r=s.properties.layer_name;r in i?this.resultList=i[r]:(this.resultList=[],i[r]=this.resultList),this.resultList.push(s)}),this.clearSearch();for(const s in i){const r=document.createElement("div");r.className="title";const o=document.createElement("i");o.className=this.getIconClassName(s),r.appendChild(o);const a=document.createElement("span");a.innerHTML=s,r.appendChild(a),this.resultsBox.appendChild(r),i[s].forEach(l=>{const h=document.createElement("div");h.className="result",this.resultList.push(l.bbox),h.dataset.resultId=String(this.resultList.length-1),h.onmousedown=()=>{this.ignoreBlur=!0},h.onclick=u=>{this.ignoreBlur=!1,this.onSelect(u)};const c=document.createElement("span");c.innerHTML=l.properties.label,h.appendChild(c),this.resultsBox.appendChild(h)})}this.setSearchBoxHeight(this.initialSearchBoxHeight+this.resultsBox.offsetHeight+20)}getIconClassName(t){switch(t){case"Adresse":return"fa-solid fa-location-dot";case"Basel Info (BI)":return"fa-solid fa-map-location-dot";case"Baumnummer Ã¶ffentlicher Baumkataster":return"fa-solid fa-tree";case"Entsorgungsstellen":return"fa-solid fa-recycle";case"Haltestelle Ã¶ffentlicher Verkehr":return"fa-solid fa-train-subway";case"Group":return"fa-solid fa-layer-group";case"Layer":return"fa-solid fa-map";default:return"fa-solid fa-globe"}}setSearchBoxHeight(t){this.searchBox.style.height=t+"px"}onSelect(t){const i=t.target;if(i){const s=super.getParentOfType("DIV",i),r=this.resultList[parseInt(s.dataset.resultId)];this.zoomTo(r),this.onFocusOut()}}zoomTo(t){const i=Math.max(Me(t)*50/100,yt(t)*50/100),s=si(t,i);this.messageManager.sendMessage({action:Fs.zoomToExtent,extent:s})}attributeChangedCallback(t,i,s,r){console.log("attributeChangedCallback")}convertRemToPixels(t){return t*parseFloat(getComputedStyle(document.documentElement).fontSize)}}jr=new WeakMap,$r=new WeakMap;customElements.define("girafe-search",r2);var qr;class o2 extends ot{constructor(){super("projection");_(this,"template",()=>xe`<style>

</style>
<girafe-menu-button id="menu-button" icon-style="fa-xl fa-solid fa-earth-europe" open="left">
  <div slot="menu-content">
    ${Object.entries(this.projections).map(([t,i])=>xe`
      <girafe-button text="${i}" icon-style="fa-xl fa-solid fa-earth-europe" onclick="${()=>this.changeProjection(t)}"></girafe-button>`)}
  </div>
</girafe-menu-button>
`);_(this,"projections",{});se(this,qr,void 0)}get menuButton(){if(!Z(this,qr))throw new Error("You called menuButton before render");return Z(this,qr)}render(){this.projections=this.configManager.Config.projections;for(const t in this.projections)t.startsWith("//")&&delete this.projections[t];super.render(),Ze(this,qr,this.shadow.querySelector("#menu-button")),Object.keys(this.projections).length==1&&this.menuButton.hide()}changeProjection(t){console.log("change projection",t),this.state.projection=t}registerEvents(){this.stateManager.subscribe("projection",(t,i)=>this.onChangeProjection(i))}onChangeProjection(t){console.log("projection changed");const i=this.projections[t];this.menuButton.setText(i),this.menuButton.closeMenu()}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}}qr=new WeakMap;customElements.define("girafe-proj-select",o2);var Vr;class a2 extends ot{constructor(){super("globe");_(this,"template",()=>xe`<style>

</style>
<girafe-menu-button id="menu-button" icon-style="fa-xl fa-solid fa-globe" text="2D / 3D" open="left">
  <div slot="menu-content">
    <girafe-button icon-style="fa-xl fa-solid fa-map" text="2D" 
                   onclick="this.state.globe.display='none'">
    </girafe-button>
    <girafe-button icon-style="fa-xl fa-solid fa-right-left" text="Both" 
                   onclick="this.state.globe.display='side'">
    </girafe-button>
    <girafe-button icon-style="fa-xl fa-solid fa-earth-europe" text="3D" 
                   onclick="this.state.globe.display='full'">
    </girafe-button>
  </div>
</girafe-menu-button>
`);se(this,Vr,void 0)}get menuButton(){if(!Z(this,Vr))throw new Error("You called menuButton before render");return Z(this,Vr)}render(){super.render(),Ze(this,Vr,this.shadow.querySelector("#menu-button"))}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate()})}}Vr=new WeakMap;customElements.define("girafe-globe-select",a2);class l2 extends ot{constructor(){super("basemap");_(this,"template",()=>xe`<style>
#container {
  display: inline-flex;
  flex-direction: column;
  width: max-content;
}
</style>
<girafe-menu-button icon-style="fa-sm fa-solid fa-layer-group" size="small" open="up" class="transparent">
  <div slot="menu-content">
    <div id="container">
      ${Object.values(this.state.basemaps).map(t=>xe.for(t)`
        <girafe-button text="${t.name}" size="large" class="border-top" onclick="${()=>this.changeBasemap(t)}"></girafe-button>`)}
    </div>
  </div>
</girafe-menu-button>`);_(this,"servers",{});_(this,"basemapJson",{});this.configManager.loadConfig().then(()=>{this.configManager.Config.basemaps.show||this.hide()})}render(){super.render()}onBasemapsLoaded(t){super.render();for(const i of Object.values(t))if(i.name===this.configManager.Config.basemaps.defaultBasemap){this.state.activeBasemap=i;break}}changeBasemap(t){console.log("change basemap",t),t.projection&&(this.state.projection=t.projection),this.state.activeBasemap=t}registerEvents(){this.stateManager.subscribe("basemaps",(t,i)=>this.onBasemapsLoaded(i)),this.stateManager.subscribe("olMap",(t,i)=>this.testBasemap(i))}testBasemap(t){console.log("test basemap",t)}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}}customElements.define("girafe-basemap",l2);var Wr,Hr;class h2 extends ot{constructor(){super("themes");_(this,"template",()=>xe`<style>
#themes {
  display: none;
  width: 50rem;
  margin-top: 0;
  overflow-y: auto;
  max-height: 70vh;
  scrollbar-width: thin;
  background: var(--bkg-color);
}

button {
  border: none;
  width: 4rem;
  height: 4.6rem;
  background-color: #444;
  color: #fff;
  padding: 0.5rem;
  cursor: pointer;
}

div.hidden {
  display: none;
}

button:hover {
  background-color: #000;
}

ul {
  border: solid 1px #444;
  border-radius: 3px;
  padding: 1rem;
  background-color: var(--bkg-color);
}

ul div {
  display: inline-block;
  width: 9rem;
  cursor: pointer;
  margin: 0.5rem;
}

ul div img {
  width: 9rem;
}

ul div span {
  display: inline-block;
  width: 9rem;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
</style>
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />

<button title="Theme Selection" 
        onclick="${()=>this.toggleThemesList()}" 
        onblur="${()=>this.onBlur()}">
  <div class="${this.state.loading?"hidden":""}">
    <i class="fa-2x fa-solid fa-layer-group"></i>
  </div>
  <div class="${this.state.loading?"":"hidden"}">
    <i class="fa-2x fa-solid fa-circle-notch fa-spin"></i>
  </div>
</button>
<ul id="themes">
  ${Object.values(this.state.themes??{}).map(t=>xe.for(t)`
  <div onmousedown="${()=>this.ignoreBlur()}" 
       onclick="${()=>this.onThemeChanged(t)}">
    <img alt="${"Icon for "+t.name}" src="${t.icon}" />
    <span i18n="${t.name}">${t.name}</span>
  </div>
  `)}
</ul>
`);se(this,Wr,void 0);se(this,Hr,!1)}get themesList(){if(!Z(this,Wr))throw new Error("You called themesList before render");return Z(this,Wr)}render(){super.render(),Ze(this,Wr,this.shadow.querySelector("#themes")),this.toggleThemesList(!1)}registerEvents(){this.stateManager.subscribe("loading",()=>super.render()),this.stateManager.subscribe("themes",()=>{super.render(),super.girafeTranslate()})}onBlur(){Z(this,Hr)||this.toggleThemesList(!1)}toggleThemesList(t=null){t===!0?this.themesList.style.display="block":t===!1?this.themesList.style.display="none":this.themesList.style.display==="none"?this.themesList.style.display="block":this.themesList.style.display="none"}ignoreBlur(){Ze(this,Hr,!0)}onThemeChanged(t){var i,s,r;this.state.selectedTheme=t,this.toggleThemesList(!1),Ze(this,Hr,!1),(t.location!=null||t.zoom!=null)&&((r=this.state.olMap)==null||r.getView().animate({center:t.location??((i=this.state.olMap)==null?void 0:i.getView().getCenter()),zoom:t.zoom??((s=this.state.olMap)==null?void 0:s.getView().getZoom()),duration:1e3}))}connectedCallback(){this.loadConfig().then(()=>{this.render(),this.registerEvents()})}}Wr=new WeakMap,Hr=new WeakMap;customElements.define("girafe-theme-select",h2);var Xr;class c2 extends ot{constructor(){super("language");_(this,"template",()=>xe`<style>

</style>
<girafe-menu-button id="menu-button" icon-style="fa-xl fa-solid fa-language" open="left">
  <div slot="menu-content">
    ${this.languages.map((t,i)=>xe`
      <girafe-button text="${t.toUpperCase()}" icon-style="fa-xl fa-solid fa-language" onclick="${()=>this.changeLanguage(t)}"></girafe-button>`)}
  </div>
</girafe-menu-button>
`);_(this,"languages",[]);se(this,Xr,void 0)}get menuButton(){if(!Z(this,Xr))throw new Error("You called menuButton before render");return Z(this,Xr)}render(){for(const t in this.configManager.Config.languages)!t.startsWith("//")&&t!=="defaultLanguage"&&this.languages.push(t);super.render(),Ze(this,Xr,this.shadow.querySelector("#menu-button")),this.languages.length==1&&this.menuButton.hide()}changeLanguage(t){console.log("change language",t),this.state.language=t}registerEvents(){this.stateManager.subscribe("language",(t,i)=>this.onTranslate(i))}onTranslate(t){this.menuButton.setText(t.toUpperCase()),this.menuButton.closeMenu()}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}}Xr=new WeakMap;customElements.define("girafe-language-select",c2);class av extends ot{constructor(){super("button");_(this,"template",()=>xe`<style>
:host {
  display: inline-block;
}

#button {
  border: none;
  border-right: solid 1px #fff;
  width: 4rem;
  height: 4.6rem;
  background-color: var(--bkg-color-grad1);
  color: var(--text-color-grad1);;
  padding: 0;
  cursor: pointer;
  margin:0;
  display: inline-block;
  line-height: 4rem;
}

#container.transparent #button {
  background-color: transparent;
  color: var(--text-color-grad2);
}

#container.transparent #button:hover {
  background-color: transparent;
  color: var(--text-color);
}

#container.transparent.selected #button {
  background-color: var(--text-color-grad1);
  color: var(--text-color-grad1);
}

#container.transparent.selected #button:hover {
  background-color: var(--text-color-grad2);
}

#button.small {
  width: 2.3rem;
  height: 2.3rem;
  line-height: 2.3rem;
}
#button.extra-small {
  width: 1rem;
  height: 1rem;
  line-height: 1rem;
}

span {
  font-size: 1.3rem;
}

#button.large {
  width: 100%;
  height: 2.3rem;
  line-height: 2.3rem;
  padding-left: 1rem;
  padding-right: 1rem;
  text-align: left;
}

#button.large span {
  font-size: 0.8rem;
  display: inline-block;
}

#button.hybrid {
  display: flex;
  flex-direction: column;
}

#button.hybrid i {
  display: inline-block;
  height: 55%;
  width: 100%;
  line-height: 3.5rem;
}

#button.hybrid span {
  font-size: 0.8rem;
  height: 45%;
  width: 100%;
  line-height: 1.5rem;
}

#button:hover {
  background-color: var(--bkg-color);
}
</style>
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />

<div id="container">
    <button id="button" title="TODO: Generate this label from the button configuration">
    </button>
</div>
`);_(this,"button");_(this,"container");_(this,"icon",null);_(this,"textSpan",null);_(this,"text",null);_(this,"option",null);_(this,"href",null);_(this,"actionState",null);_(this,"actionValue",null)}render(){if(super.render(),this.container=this.shadow.querySelector("#container"),this.button=this.shadow.querySelector("#button"),this.hasAttribute("icon-style")&&(this.icon=document.createElement("i"),this.icon.className=this.getAttribute("icon-style"),this.button.appendChild(this.icon)),this.hasAttribute("text")&&(this.text=this.getAttribute("text"),this.textSpan=document.createElement("span"),this.textSpan.innerHTML=this.text,this.textSpan.setAttribute("i18n",this.text),this.button.appendChild(this.textSpan)),this.hasAttribute("size")){const t=this.getAttribute("size");this.button.classList.add(t)}this.container.classList.add(...this.classList),this.setButtonStyle()}setButtonStyle(){this.icon!==null&&this.textSpan!==null&&(this.button.className="hybrid")}setText(t){this.textSpan!==null&&this.isNullOrUndefinedOrBlank(t)?(this.text=null,this.textSpan.remove(),this.textSpan=null):this.textSpan===null&&!this.isNullOrUndefinedOrBlank(t)?(this.text=t,this.textSpan=document.createElement("span"),this.textSpan.innerHTML=this.text,this.isNullOrUndefined(this.button)?super.delayed(()=>this.button!==null,()=>this.button.appendChild(this.textSpan)):this.button.appendChild(this.textSpan)):(this.text=t,this.textSpan.innerHTML=this.text),this.setButtonStyle()}registerEvents(){if(this.hasAttribute("href"))this.href=this.getAttribute("href");else if(this.hasAttribute("message")){this.option={},this.option.message=this.getAttribute("message");for(const i in this.dataset)this.option[i]=this.dataset[i]}else this.hasAttribute("state-action")&&(this.actionState=this.getAttribute("state-action"),this.actionValue=this.getActionValue());new MutationObserver(this.parentAttributeChanged.bind(this)).observe(this,{attributes:!0}),this.button.addEventListener("click",()=>this.onClick())}getActionValue(){if(Object.keys(this.dataset).length>1)throw new Error("Maximum 1 parameter is allowed here.");if(Object.keys(this.dataset).length===0)return null;const t=Object.values(this.dataset)[0];return t==="true"?!0:t==="false"?!1:t.startsWith("[")&&t.endsWith("]")?t.substring(1,t.length-1).split(",").map(r=>parseFloat(r)?parseFloat(r):r):t}parentAttributeChanged(t){t.forEach(i=>{i.attributeName==="class"&&this.container.classList.add(...this.classList),i.attributeName==="icon-style"&&this.icon&&(this.icon.className=this.getAttribute("icon-style"))})}onClick(){if(!this.isNullOrUndefined(this.href))window.open(this.href,"_blank");else if(!this.isNullOrUndefined(this.option))this.messageManager.sendMessage(this.option);else if(!this.isNullOrUndefined(this.actionState)){const i=this.actionState.split(".");let s=this.state;for(let r=0;r<i.length-1;++r)s=s[i[r]];if(this.actionValue===null){if(typeof s[i[i.length-1]]!="boolean")throw new Error("Cannot invert boolean value: it isn't a boolean");s[i[i.length-1]]=!s[i[i.length-1]]}else s[i[i.length-1]]=this.actionValue}const t=super.getParentOfType("GIRAFE-MENU-BUTTON",this.shadow.host.parentNode);t!==null&&t.closeMenu()}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}}customElements.define("girafe-button",av);class u2 extends ot{constructor(){super("scale");_(this,"template",()=>xe`<style>
#content {
	background: var(--t-bkg);
	color: var(--text-color);
	width: fit-content;
	white-space: nowrap;
	padding: 0 0.5rem;
	font-size: 1rem;
}

label:after {
	content: ":";
	height: 2.3rem;
	line-height: 2.3rem;
}

span {
	font-weight: bold;
	height: 2.3rem;
	line-height: 2.3rem;
}

girafe-menu-button {
	display: inline-block;
}

#container {
	display: inline-flex;
	flex-direction: column;
	width: max-content;
}
</style>
<div id="content">
  <label for="scale" i18n="scale">Scale</label>
  <span id="scale"></span>
  <girafe-menu-button icon-style="fa-sm fa-solid fa-caret-up" size="small" open="up" class="transparent">
    <div slot="menu-content">
      <div id="container"></div>
    </div>
  </girafe-menu-button>
</div>`);_(this,"scaleSpan",null);_(this,"locale",null);_(this,"container",null);_(this,"scales",null)}render(){super.render(),this.container=this.shadow.querySelector("#container"),this.scaleSpan=this.shadow.querySelector("#scale"),this.locale=this.configManager.Config.general.locale,this.scales=this.configManager.Config.map.scales,this.scales.forEach(t=>{const i=new av;i.setAttribute("text",this.formatScale(t)),i.setAttribute("size","large"),i.setAttribute("state-action","position.scale"),i.dataset.value=t,this.container.appendChild(i)})}registerEvents(){this.stateManager.subscribe("position",()=>this.onScaleChanged())}onScaleChanged(){this.state.position.scale!==null?this.scaleSpan.innerHTML=this.formatScale(this.state.position.scale):this.scaleSpan.innerHTML=""}formatScale(t){return"1:"+Math.floor(t).toLocaleString(this.locale)}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}}customElements.define("girafe-scale",u2);function cd(n,e){const t=(Math.round(n[0]*100)/100).toLocaleString(e,{minimumFractionDigits:2}),i=(Math.round(n[1]*100)/100).toLocaleString(e,{minimumFractionDigits:2});return[t,i]}var Yr;class d2 extends ot{constructor(){super("coordinate");_(this,"template",()=>xe`<style>
#content {
	background: var(--t-bkg);
	color: var(--text-color);
  width: -moz-fit-content;
  width: fit-content;
  white-space: nowrap;
  padding: 0 0.5rem;
  font-size: 1rem;
  height: 2.3rem;
  line-height: 2.3rem;
}

span {
  font-weight: bold;
}

</style>
<div id="content">
  <span id="coords">E ${this.east} / N ${this.north}</span>
</div>`);se(this,Yr,void 0);_(this,"east",null);_(this,"north",null)}get locale(){if(!Z(this,Yr))throw new Error("You called locale before render");return Z(this,Yr)}render(){super.render(),Ze(this,Yr,this.configManager.Config.general.locale)}registerEvents(){this.stateManager.subscribe("mouseCoordinates",(t,i)=>this.onChangeCoordinates(i))}onChangeCoordinates(t){[this.east,this.north]=cd(t,this.locale),this.render()}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}}Yr=new WeakMap;customElements.define("girafe-coordinate",d2);class f2 extends ot{constructor(){super("menubutton");_(this,"template",()=>xe`<style>
#container {
  position: relative;
}

#menu-content {
  display: none;
  position: absolute;
  font-size: 0;
}

#menu-content.open-bottom {
  top: 100%;
  left: 0;
  border-top: solid 1px #fff;
  height: max-content;
  width: fit-content;
}

#menu-content.open-bottom-left {
  top: 100%;
  right: 0;
  border-top: solid 1px #fff;
  height: max-content;
  width: fit-content;
}

#menu-content.open-up {
  bottom: 100%;
  right: 0;
  border-bottom: solid 1px #fff;
  height: max-content;
  width: fit-content;
}

#menu-content.open-left {
  right: 100%;
  bottom: 0;
  width: max-content;
  height: fit-content;
}

#button {
  border: none;
  border-right: solid 1px #fff;
  width: 4rem;
  height: 4.6rem;
  background-color: var(--bkg-color-grad1);
  color: var(--text-color);
  padding: 0;
  cursor: pointer;
  margin: 0;
  display: inline-block;
  line-height: 4rem;
}

#container.transparent #button {
  background-color: transparent;
  color: var(--text-color);
}

#container.transparent #button:hover {
  background-color: transparent;
  color: var(--text-color-grad1);
}

#button.small {
  width: 2.3rem;
  height: 2.3rem;
  line-height: 2.3rem;
}

span {
  font-size: 1.3rem;
}

#button.hybrid {
  display: flex;
  flex-direction: column;
}

#button.hybrid i {
  display: inline-block;
  height: 55%;
  width: 100%;
  line-height: 3.5rem;
}

#button.hybrid span {
  font-size: 0.8rem;
  height: 45%;
  width: 100%;
  line-height: 1.5rem;
}

#button:hover {
  background-color: var(--bkg-color);
}
</style>
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />

<div id="container">
  <slot name="menu-button">
    <button id="button" title="TODO: Generate this label from the button configuration"></button>
  </slot>

  <div id="menu-content" tabindex="-1">
    <slot name="menu-content"></slot>
  </div>
</div>`);_(this,"button",null);_(this,"icon",null);_(this,"text",null);_(this,"textSpan",null);_(this,"menuContent",null);_(this,"container",null)}render(){super.render(),this.container=this.shadow.querySelector("#container"),this.button=this.shadow.querySelector("#button"),this.menuContent=this.shadow.querySelector("#menu-content");let t=this.hasAttribute("open")?this.getAttribute("open"):"bottom";if(this.setOpenDirection(t),this.hasAttribute("icon-style")&&(this.icon=document.createElement("i"),this.icon.className=this.getAttribute("icon-style"),this.button.appendChild(this.icon)),this.hasAttribute("text")&&(this.text=this.getAttribute("text"),this.textSpan=document.createElement("span"),this.textSpan.innerHTML=this.text,this.textSpan.setAttribute("i18n",this.text),this.button.appendChild(this.textSpan)),this.hasAttribute("size")){const i=this.getAttribute("size");this.button.classList.add(i)}this.container.classList=this.classList,this.setButtonStyle()}setOpenDirection(t){switch(t){case"left":this.menuContent.classList.add("open-left");break;case"up":this.menuContent.classList.add("open-up");break;case"bottom-left":this.menuContent.classList.add("open-bottom-left");break;case"bottom":default:this.menuContent.classList.add("open-bottom");break}}registerEvents(){this.button.addEventListener("click",t=>this.openMenu()),this.menuContent.addEventListener("blur",t=>this.onBlur(t))}setButtonStyle(){this.icon!==null&&this.textSpan!==null&&(this.button.className="hybrid")}setText(t){this.textSpan!==null&&this.isNullOrUndefinedOrBlank(t)?(this.text=null,this.textSpan.remove(),this.textSpan=null):this.textSpan===null&&!this.isNullOrUndefinedOrBlank(t)?(this.text=t,this.textSpan=document.createElement("span"),this.textSpan.innerHTML=this.text,this.button!==null?this.button.appendChild(this.textSpan):super.delayed(()=>this.button!==null,()=>this.button.appendChild(this.textSpan))):(this.text=t,this.textSpan.innerHTML=this.text),this.setButtonStyle()}openMenu(){this.menuContent.style.display==="block"?this.closeMenu():(this.menuContent.style.display="block",this.focusContent())}focusContent(){this.menuContent!=null&&this.menuContent.focus()}closeMenu(){this.menuContent!=null&&(this.menuContent.style.display="none");const t=super.getParentOfType(this.nodeName,this.shadow.host.parentNode);t!==null&&t.focusContent()}onBlur(t){t.relatedTarget!==this.button&&(this.contains(t.currentTarget,t.relatedTarget)||this.closeMenu())}contains(t,i){if(t.contains(i))return!0;const r=t.querySelector('slot[name="menu-content"]').assignedElements({flatten:!0});for(const o of r)if(o.contains(i))return!0;return!1}connectedCallback(){super.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}}customElements.define("girafe-menu-button",f2);/*!
 * vanilla-picker v2.12.2
 * https://vanilla-picker.js.org
 *
 * Copyright 2017-2023 Andreas Borgen (https://github.com/Sphinxxxx), Adam Brooks (https://github.com/dissimulate)
 * Released under the ISC license.
 */var yg=function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")},_g=function(){function n(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),bl=function(){function n(e,t){var i=[],s=!0,r=!1,o=void 0;try{for(var a=e[Symbol.iterator](),l;!(s=(l=a.next()).done)&&(i.push(l.value),!(t&&i.length===t));s=!0);}catch(h){r=!0,o=h}finally{try{!s&&a.return&&a.return()}finally{if(r)throw o}}return i}return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return n(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();String.prototype.startsWith=String.prototype.startsWith||function(n){return this.indexOf(n)===0};String.prototype.padStart=String.prototype.padStart||function(n,e){for(var t=this;t.length<n;)t=e+t;return t};var g2={cb:"0f8ff",tqw:"aebd7",q:"-ffff",qmrn:"7fffd4",zr:"0ffff",bg:"5f5dc",bsq:"e4c4",bck:"---",nch:"ebcd",b:"--ff",bvt:"8a2be2",brwn:"a52a2a",brw:"deb887",ctb:"5f9ea0",hrt:"7fff-",chcT:"d2691e",cr:"7f50",rnw:"6495ed",crns:"8dc",crms:"dc143c",cn:"-ffff",Db:"--8b",Dcn:"-8b8b",Dgnr:"b8860b",Dgr:"a9a9a9",Dgrn:"-64-",Dkhk:"bdb76b",Dmgn:"8b-8b",Dvgr:"556b2f",Drng:"8c-",Drch:"9932cc",Dr:"8b--",Dsmn:"e9967a",Dsgr:"8fbc8f",DsTb:"483d8b",DsTg:"2f4f4f",Dtrq:"-ced1",Dvt:"94-d3",ppnk:"1493",pskb:"-bfff",mgr:"696969",grb:"1e90ff",rbrc:"b22222",rwht:"af0",stg:"228b22",chs:"-ff",gnsb:"dcdcdc",st:"8f8ff",g:"d7-",gnr:"daa520",gr:"808080",grn:"-8-0",grnw:"adff2f",hnw:"0fff0",htpn:"69b4",nnr:"cd5c5c",ng:"4b-82",vr:"0",khk:"0e68c",vnr:"e6e6fa",nrb:"0f5",wngr:"7cfc-",mnch:"acd",Lb:"add8e6",Lcr:"08080",Lcn:"e0ffff",Lgnr:"afad2",Lgr:"d3d3d3",Lgrn:"90ee90",Lpnk:"b6c1",Lsmn:"a07a",Lsgr:"20b2aa",Lskb:"87cefa",LsTg:"778899",Lstb:"b0c4de",Lw:"e0",m:"-ff-",mgrn:"32cd32",nn:"af0e6",mgnt:"-ff",mrn:"8--0",mqm:"66cdaa",mmb:"--cd",mmrc:"ba55d3",mmpr:"9370db",msg:"3cb371",mmsT:"7b68ee","":"-fa9a",mtr:"48d1cc",mmvt:"c71585",mnLb:"191970",ntc:"5fffa",mstr:"e4e1",mccs:"e4b5",vjw:"dead",nv:"--80",c:"df5e6",v:"808-0",vrb:"6b8e23",rng:"a5-",rngr:"45-",rch:"da70d6",pgnr:"eee8aa",pgrn:"98fb98",ptrq:"afeeee",pvtr:"db7093",ppwh:"efd5",pchp:"dab9",pr:"cd853f",pnk:"c0cb",pm:"dda0dd",pwrb:"b0e0e6",prp:"8-080",cc:"663399",r:"--",sbr:"bc8f8f",rb:"4169e1",sbrw:"8b4513",smn:"a8072",nbr:"4a460",sgrn:"2e8b57",ssh:"5ee",snn:"a0522d",svr:"c0c0c0",skb:"87ceeb",sTb:"6a5acd",sTgr:"708090",snw:"afa",n:"-ff7f",stb:"4682b4",tn:"d2b48c",t:"-8080",thst:"d8bfd8",tmT:"6347",trqs:"40e0d0",vt:"ee82ee",whT:"5deb3",wht:"",hts:"5f5f5",w:"-",wgrn:"9acd32"};function Sm(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=e>0?n.toFixed(e).replace(/0+$/,"").replace(/\.$/,""):n.toString();return t||"0"}var p2=function(){function n(e,t,i,s){yg(this,n);var r=this;function o(l){if(l.startsWith("hsl")){var h=l.match(/([\-\d\.e]+)/g).map(Number),c=bl(h,4),u=c[0],d=c[1],f=c[2],g=c[3];g===void 0&&(g=1),u/=360,d/=100,f/=100,r.hsla=[u,d,f,g]}else if(l.startsWith("rgb")){var p=l.match(/([\-\d\.e]+)/g).map(Number),m=bl(p,4),v=m[0],y=m[1],x=m[2],w=m[3];w===void 0&&(w=1),r.rgba=[v,y,x,w]}else l.startsWith("#")?r.rgba=n.hexToRgb(l):r.rgba=n.nameToRgb(l)||n.hexToRgb(l)}if(e!==void 0)if(Array.isArray(e))this.rgba=e;else if(i===void 0){var a=e&&""+e;a&&o(a.toLowerCase())}else this.rgba=[e,t,i,s===void 0?1:s]}return _g(n,[{key:"printRGB",value:function(t){var i=t?this.rgba:this.rgba.slice(0,3),s=i.map(function(r,o){return Sm(r,o===3?3:0)});return t?"rgba("+s+")":"rgb("+s+")"}},{key:"printHSL",value:function(t){var i=[360,100,100,1],s=["","%","%",""],r=t?this.hsla:this.hsla.slice(0,3),o=r.map(function(a,l){return Sm(a*i[l],l===3?3:1)+s[l]});return t?"hsla("+o+")":"hsl("+o+")"}},{key:"printHex",value:function(t){var i=this.hex;return t?i:i.substring(0,7)}},{key:"rgba",get:function(){if(this._rgba)return this._rgba;if(!this._hsla)throw new Error("No color is set");return this._rgba=n.hslToRgb(this._hsla)},set:function(t){t.length===3&&(t[3]=1),this._rgba=t,this._hsla=null}},{key:"rgbString",get:function(){return this.printRGB()}},{key:"rgbaString",get:function(){return this.printRGB(!0)}},{key:"hsla",get:function(){if(this._hsla)return this._hsla;if(!this._rgba)throw new Error("No color is set");return this._hsla=n.rgbToHsl(this._rgba)},set:function(t){t.length===3&&(t[3]=1),this._hsla=t,this._rgba=null}},{key:"hslString",get:function(){return this.printHSL()}},{key:"hslaString",get:function(){return this.printHSL(!0)}},{key:"hex",get:function(){var t=this.rgba,i=t.map(function(s,r){return r<3?s.toString(16):Math.round(s*255).toString(16)});return"#"+i.map(function(s){return s.padStart(2,"0")}).join("")},set:function(t){this.rgba=n.hexToRgb(t)}}],[{key:"hexToRgb",value:function(t){var i=(t.startsWith("#")?t.slice(1):t).replace(/^(\w{3})$/,"$1F").replace(/^(\w)(\w)(\w)(\w)$/,"$1$1$2$2$3$3$4$4").replace(/^(\w{6})$/,"$1FF");if(!i.match(/^([0-9a-fA-F]{8})$/))throw new Error("Unknown hex color; "+t);var s=i.match(/^(\w\w)(\w\w)(\w\w)(\w\w)$/).slice(1).map(function(r){return parseInt(r,16)});return s[3]=s[3]/255,s}},{key:"nameToRgb",value:function(t){var i=t.toLowerCase().replace("at","T").replace(/[aeiouyldf]/g,"").replace("ght","L").replace("rk","D").slice(-5,4),s=g2[i];return s===void 0?s:n.hexToRgb(s.replace(/\-/g,"00").padStart(6,"f"))}},{key:"rgbToHsl",value:function(t){var i=bl(t,4),s=i[0],r=i[1],o=i[2],a=i[3];s/=255,r/=255,o/=255;var l=Math.max(s,r,o),h=Math.min(s,r,o),c=void 0,u=void 0,d=(l+h)/2;if(l===h)c=u=0;else{var f=l-h;switch(u=d>.5?f/(2-l-h):f/(l+h),l){case s:c=(r-o)/f+(r<o?6:0);break;case r:c=(o-s)/f+2;break;case o:c=(s-r)/f+4;break}c/=6}return[c,u,d,a]}},{key:"hslToRgb",value:function(t){var i=bl(t,4),s=i[0],r=i[1],o=i[2],a=i[3],l=void 0,h=void 0,c=void 0;if(r===0)l=h=c=o;else{var u=function(m,v,y){return y<0&&(y+=1),y>1&&(y-=1),y<.16666666666666666?m+(v-m)*6*y:y<.5?v:y<.6666666666666666?m+(v-m)*(.6666666666666666-y)*6:m},d=o<.5?o*(1+r):o+r-o*r,f=2*o-d;l=u(f,d,s+1/3),h=u(f,d,s),c=u(f,d,s-1/3)}var g=[l*255,h*255,c*255].map(Math.round);return g[3]=a,g}}]),n}(),m2=function(){function n(){yg(this,n),this._events=[]}return _g(n,[{key:"add",value:function(t,i,s){t.addEventListener(i,s,!1),this._events.push({target:t,type:i,handler:s})}},{key:"remove",value:function(t,i,s){this._events=this._events.filter(function(r){var o=!0;return t&&t!==r.target&&(o=!1),i&&i!==r.type&&(o=!1),s&&s!==r.handler&&(o=!1),o&&n._doRemove(r.target,r.type,r.handler),!o})}},{key:"destroy",value:function(){this._events.forEach(function(t){return n._doRemove(t.target,t.type,t.handler)}),this._events=[]}}],[{key:"_doRemove",value:function(t,i,s){t.removeEventListener(i,s,!1)}}]),n}();function y2(n){var e=document.createElement("div");return e.innerHTML=n,e.firstElementChild}function su(n,e,t){var i=!1;function s(l,h,c){return Math.max(h,Math.min(l,c))}function r(l,h,c){if(c&&(i=!0),!!i){l.preventDefault();var u=e.getBoundingClientRect(),d=u.width,f=u.height,g=h.clientX,p=h.clientY,m=s(g-u.left,0,d),v=s(p-u.top,0,f);t(m/d,v/f)}}function o(l,h){var c=l.buttons===void 0?l.which:l.buttons;c===1?r(l,l,h):i=!1}function a(l,h){l.touches.length===1?r(l,l.touches[0],h):i=!1}n.add(e,"mousedown",function(l){o(l,!0)}),n.add(e,"touchstart",function(l){a(l,!0)}),n.add(window,"mousemove",o),n.add(e,"touchmove",a),n.add(window,"mouseup",function(l){i=!1}),n.add(e,"touchend",function(l){i=!1}),n.add(e,"touchcancel",function(l){i=!1})}var _2=`linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%) 0 0 / 2em 2em,
                   linear-gradient(45deg, lightgrey 25%,       white 25%,       white 75%, lightgrey 75%) 1em 1em / 2em 2em`,v2=360,lv="keydown",El="mousedown",ru="focusin";function Zi(n,e){return(e||document).querySelector(n)}function hv(n){n.preventDefault(),n.stopPropagation()}function ou(n,e,t,i,s){n.add(e,lv,function(r){t.indexOf(r.key)>=0&&(s&&hv(r),i(r))})}var Tm=function(){function n(e){yg(this,n),this.settings={popup:"right",layout:"default",alpha:!0,editor:!0,editorFormat:"hex",cancelButton:!1,defaultColor:"#0cf"},this._events=new m2,this.onChange=null,this.onDone=null,this.onOpen=null,this.onClose=null,this.setOptions(e)}return _g(n,[{key:"setOptions",value:function(t){var i=this;if(!t)return;var s=this.settings;function r(h,c,u){for(var d in h)u&&u.indexOf(d)>=0||(c[d]=h[d])}if(t instanceof HTMLElement)s.parent=t;else{s.parent&&t.parent&&s.parent!==t.parent&&(this._events.remove(s.parent),this._popupInited=!1),r(t,s),t.onChange&&(this.onChange=t.onChange),t.onDone&&(this.onDone=t.onDone),t.onOpen&&(this.onOpen=t.onOpen),t.onClose&&(this.onClose=t.onClose);var o=t.color||t.colour;o&&this._setColor(o)}var a=s.parent;if(a&&s.popup&&!this._popupInited){var l=function(c){return i.openHandler(c)};this._events.add(a,"click",l),ou(this._events,a,[" ","Spacebar","Enter"],l),this._popupInited=!0}else t.parent&&!s.popup&&this.show()}},{key:"openHandler",value:function(t){if(this.show()){t&&t.preventDefault(),this.settings.parent.style.pointerEvents="none";var i=t&&t.type===lv?this._domEdit:this.domElement;setTimeout(function(){return i.focus()},100),this.onOpen&&this.onOpen(this.colour)}}},{key:"closeHandler",value:function(t){var i=t&&t.type,s=!1;if(!t)s=!0;else if(i===El||i===ru){var r=(this.__containedEvent||0)+100;t.timeStamp>r&&(s=!0)}else hv(t),s=!0;s&&this.hide()&&(this.settings.parent.style.pointerEvents="",i!==El&&this.settings.parent.focus(),this.onClose&&this.onClose(this.colour))}},{key:"movePopup",value:function(t,i){this.closeHandler(),this.setOptions(t),i&&this.openHandler()}},{key:"setColor",value:function(t,i){this._setColor(t,{silent:i})}},{key:"_setColor",value:function(t,i){if(typeof t=="string"&&(t=t.trim()),!!t){i=i||{};var s=void 0;try{s=new p2(t)}catch(o){if(i.failSilently)return;throw o}if(!this.settings.alpha){var r=s.hsla;r[3]=1,s.hsla=r}this.colour=this.color=s,this._setHSLA(null,null,null,null,i)}}},{key:"setColour",value:function(t,i){this.setColor(t,i)}},{key:"show",value:function(){var t=this.settings.parent;if(!t)return!1;if(this.domElement){var i=this._toggleDOM(!0);return this._setPosition(),i}var s=this.settings.template||'<div class="picker_wrapper" tabindex="-1"><div class="picker_arrow"></div><div class="picker_hue picker_slider"><div class="picker_selector"></div></div><div class="picker_sl"><div class="picker_selector"></div></div><div class="picker_alpha picker_slider"><div class="picker_selector"></div></div><div class="picker_editor"><input aria-label="Type a color name or hex value"/></div><div class="picker_sample"></div><div class="picker_done"><button>Ok</button></div><div class="picker_cancel"><button>Cancel</button></div></div>',r=y2(s);return this.domElement=r,this._domH=Zi(".picker_hue",r),this._domSL=Zi(".picker_sl",r),this._domA=Zi(".picker_alpha",r),this._domEdit=Zi(".picker_editor input",r),this._domSample=Zi(".picker_sample",r),this._domOkay=Zi(".picker_done button",r),this._domCancel=Zi(".picker_cancel button",r),r.classList.add("layout_"+this.settings.layout),this.settings.alpha||r.classList.add("no_alpha"),this.settings.editor||r.classList.add("no_editor"),this.settings.cancelButton||r.classList.add("no_cancel"),this._ifPopup(function(){return r.classList.add("popup")}),this._setPosition(),this.colour?this._updateUI():this._setColor(this.settings.defaultColor),this._bindEvents(),!0}},{key:"hide",value:function(){return this._toggleDOM(!1)}},{key:"destroy",value:function(){this._events.destroy(),this.domElement&&this.settings.parent.removeChild(this.domElement)}},{key:"_bindEvents",value:function(){var t=this,i=this,s=this.domElement,r=this._events;function o(h,c,u){r.add(h,c,u)}o(s,"click",function(h){return h.preventDefault()}),su(r,this._domH,function(h,c){return i._setHSLA(h)}),su(r,this._domSL,function(h,c){return i._setHSLA(null,h,1-c)}),this.settings.alpha&&su(r,this._domA,function(h,c){return i._setHSLA(null,null,null,1-c)});var a=this._domEdit;o(a,"input",function(h){i._setColor(this.value,{fromEditor:!0,failSilently:!0})}),o(a,"focus",function(h){var c=this;c.selectionStart===c.selectionEnd&&c.select()}),this._ifPopup(function(){var h=function(d){return t.closeHandler(d)};o(window,El,h),o(window,ru,h),ou(r,s,["Esc","Escape"],h);var c=function(d){t.__containedEvent=d.timeStamp};o(s,El,c),o(s,ru,c),o(t._domCancel,"click",h)});var l=function(c){t._ifPopup(function(){return t.closeHandler(c)}),t.onDone&&t.onDone(t.colour)};o(this._domOkay,"click",l),ou(r,s,["Enter"],l)}},{key:"_setPosition",value:function(){var t=this.settings.parent,i=this.domElement;t!==i.parentNode&&t.appendChild(i),this._ifPopup(function(s){getComputedStyle(t).position==="static"&&(t.style.position="relative");var r=s===!0?"popup_right":"popup_"+s;["popup_top","popup_bottom","popup_left","popup_right"].forEach(function(o){o===r?i.classList.add(o):i.classList.remove(o)}),i.classList.add(r)})}},{key:"_setHSLA",value:function(t,i,s,r,o){o=o||{};var a=this.colour,l=a.hsla;[t,i,s,r].forEach(function(h,c){(h||h===0)&&(l[c]=h)}),a.hsla=l,this._updateUI(o),this.onChange&&!o.silent&&this.onChange(a)}},{key:"_updateUI",value:function(t){if(!this.domElement)return;t=t||{};var i=this.colour,s=i.hsla,r="hsl("+s[0]*v2+", 100%, 50%)",o=i.hslString,a=i.hslaString,l=this._domH,h=this._domSL,c=this._domA,u=Zi(".picker_selector",l),d=Zi(".picker_selector",h),f=Zi(".picker_selector",c);function g(E,C,M){C.style.left=M*100+"%"}function p(E,C,M){C.style.top=M*100+"%"}g(l,u,s[0]),this._domSL.style.backgroundColor=this._domH.style.color=r,g(h,d,s[1]),p(h,d,1-s[2]),h.style.color=o,p(c,f,1-s[3]);var m=o,v=m.replace("hsl","hsla").replace(")",", 0)"),y="linear-gradient("+[m,v]+")";if(this._domA.style.background=y+", "+_2,!t.fromEditor){var x=this.settings.editorFormat,w=this.settings.alpha,b=void 0;switch(x){case"rgb":b=i.printRGB(w);break;case"hsl":b=i.printHSL(w);break;default:b=i.printHex(w)}this._domEdit.value=b}this._domSample.style.color=a}},{key:"_ifPopup",value:function(t,i){this.settings.parent&&this.settings.popup?t&&t(this.settings.popup):i&&i()}},{key:"_toggleDOM",value:function(t){var i=this.domElement;if(!i)return!1;var s=t?"":"none",r=i.style.display!==s;return r&&(i.style.display=s),r}}]),n}();class x2 extends jh{constructor(){super("redlining");_(this,"template",()=>xe`<style>
:host, #panel {
  min-width: 18rem;
}

#panel {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: visible;
}

#gutter {
  border: none;
  width: 6px;
  height: 100%;
  background: var(--bkg-color);
  position: absolute;
  top: 0;
  left: 0;
  cursor: col-resize;
}

#close {
  border: solid 1px var(--text-color-grad1);
  border-right: none;
  color: var(--text-color-grad1);
  padding: 0.7rem 0 0.7rem 0.5rem;
  border-radius: 10px 0  0 10px;
  width: 0.8rem;
  height: 2rem;
  line-height: 2rem;
  position: fixed;
  top: 5.8rem;
  right: 20rem;
  background-color: var(--bkg-color);
  cursor: pointer;
}

#close i:before {
  content: "\uf00d";
}

#close:hover {
  border-color: var(--text-color);
  color: var(--text-color);
}

#content {
  position: absolute;
  top : 0;
  left: 6px;
  right: 0;
  bottom: 0;
  background : var(--bkg-color);
  padding : 1.5rem;
  margin: 0;
  overflow: visible;
}

#content button {
  border: solid 1px var(--bkg-color);
  color: var(--text-color-grad2);
  height: 2.4rem;
  width: 2.4rem;
  text-align: left;
  padding: 0;
  padding-left: 0.5rem;
  background-color: var(--bkg-color);
  cursor: pointer;
}

#content button:hover {
    border: solid 1px var(--text-color-grad2);
}

#content button.selected {
  border: solid 1px var(--text-color-grad2);
  background-color: var(--text-color-grad2);
  color: var(--bkg-color);
}

#drawingList {
  min-height: 5rem;
  background-color: var(--bkg-color);
  padding-top: 2rem;
  margin-right: 1rem;
}

#drawingList div.girafe {
  display: inline-block;
  position: relative;
  padding: 0.5rem;
  margin-top: 0.1rem;
  margin-right: 0.1rem;
  border: solid 1px var(--text-color);
  text-align: left;
  width: 100%;
  max-width: 16rem;
  min-width: 13rem;
  color: var(--text-color-grad2);
}

#drawingList div.girafe:hover {
  color: var(--text-color);
}

#drawingList input.name {
  display:block;
  border:none;
}

#drawingList i {
  position: relative;
  cursor: pointer;
  margin-right: 1rem;
  display: inline;
}

#drawingList .text-opts {
  position: absolute;
  right: 0;
  top: 0.5rem;
}

input.slider {
  position: relative;
  width: 6rem;
  display: inline-block;
  vertical-align: middle;
  margin-right: 1rem;
}
</style>
<link rel="stylesheet" href="lib/font-gis/css/font-gis.css" />
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />
<link rel="stylesheet" href="lib/vanilla-picker/vanilla-picker.csp.css" />

<div id="panel">
  <div id="gutter"></div>
  <div id="close">
    <i class="fa-solid"></i>
  </div>
  <div id="content">
    <button id="disable" tip="Disable drawing" class="selected">
      <i class="fg-arrow-o fg-lg"></i>
    </button>
    <button id="point" tip="Point">
      <i class="fg-point fg-lg"></i>
    </button>
    <button id="line" tip="Line">
      <i class="fg-polyline-pt fg-lg"></i>
    </button>
    <button id="polygon" tip="Polygon">
      <i class="fg-polygon-pt fg-lg"></i>
    </button>
    <button id="square" tip="Square">
      <i class="fg-square-pt fg-lg"></i>
    </button>
    <button id="rectangle" tip="Rectangle">
      <i class="fg-rectangle-pt fg-lg"></i>
    </button>
    <button id="circle" tip="Circle">
      <i  class="fg-circle-o fg-lg"></i>
    </button>
    <button id="freeline" tip="Freehand line">
      <i class="fg-polyline fg-lg"></i>
    </button>
    <button id="freepolygon" tip="Freehand polygon">
      <i class="fg-polygon-o fg-lg"></i>
    </button>
    <button id="undo" tip="Undo">
      <i class="fg-help-larrow fg-lg"></i>
    </button>
    <div id="drawingList"></div>
  </div>
</div>`);_(this,"panel",null);_(this,"disableButton",null);_(this,"pointButton",null);_(this,"lineButton",null);_(this,"squareButton",null);_(this,"rectangleButton",null);_(this,"polygonButton",null);_(this,"circleButton",null);_(this,"freelineButton",null);_(this,"freepolygonButton",null);_(this,"undoButton",null);_(this,"toolSelected",null);_(this,"drawingList",null)}render(){super.render(),this.panel=this.shadow.querySelector("#panel"),this.panel.style.display="none",this.disableButton=this.shadow.querySelector("#disable"),this.pointButton=this.shadow.querySelector("#point"),this.lineButton=this.shadow.querySelector("#line"),this.squareButton=this.shadow.querySelector("#square"),this.rectangleButton=this.shadow.querySelector("#rectangle"),this.polygonButton=this.shadow.querySelector("#polygon"),this.circleButton=this.shadow.querySelector("#circle"),this.freelineButton=this.shadow.querySelector("#freeline"),this.freepolygonButton=this.shadow.querySelector("#freepolygon"),this.undoButton=this.shadow.querySelector("#undo"),this.drawingList=this.shadow.querySelector("#drawingList"),this.toolSelected=this.disableButton,this.activateTooltips(!1,[800,0],"top-end")}registerEvents(){this.stateManager.subscribe("interface.redliningPanelVisible",(t,i)=>this.togglePanel(i)),this.stateManager.subscribe("redlining.features",(t,i)=>this.onFeaturesChanged(t,i)),this.disableButton.addEventListener("click",t=>this.deactivateDraw(t)),this.pointButton.addEventListener("click",t=>this.activateDraw(t,"Point")),this.lineButton.addEventListener("click",t=>this.activateDraw(t,"LineString")),this.squareButton.addEventListener("click",t=>this.activateDraw(t,"Square")),this.rectangleButton.addEventListener("click",t=>this.activateDraw(t,"Rectangle")),this.polygonButton.addEventListener("click",t=>this.activateDraw(t,"Polygon")),this.circleButton.addEventListener("click",t=>this.activateDraw(t,"Circle")),this.freelineButton.addEventListener("click",t=>this.activateDraw(t,"Freeline")),this.freepolygonButton.addEventListener("click",t=>this.activateDraw(t,"Freepolygon")),this.undoButton.addEventListener("click",()=>this.messageManager.sendMessage({action:Fs.undoDraw}))}activateDraw(t,i){this.toolSelected!==null&&(this.toolSelected.className=""),this.toolSelected=t.target.parentElement,this.toolSelected.className="selected",this.state.redlining.activeTool=i}deactivateDraw(t){this.toolSelected!==null&&(this.toolSelected.className=""),this.toolSelected=t.target.parentElement,this.toolSelected.className="selected",this.state.redlining.activeTool=null}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}closePanel(){this.state.interface.redliningPanelVisible=!1}togglePanel(t){t?(this.panel.style.display="block",this.panel.getRootNode().host.style.display="block"):(this.panel.style.display="none",this.panel.getRootNode().host.style.display="none")}onFeaturesChanged(t,i){const s=t.filter(o=>!i.find(a=>a.id===o.id)),r=i.filter(o=>!t.find(a=>a.id===o.id));s.forEach(o=>{this.removeFeatureFromList(o)}),r.forEach(o=>{this.addFeatureToList(o)})}addFeatureToList(t){const i="f-"+t.id,s=document.createElement("div");s.className="girafe",s.id=i;const r=document.createElement("input");r.type="text",r.value=t.name,r.className="name",r.oninput=v=>{const y=this.state.redlining.features.find(x=>x.id===t.id);y.name=v.target.value},s.appendChild(r);const o=document.createElement("div");o.className="text-opts";const a=document.createElement("i");a.className="fa-solid fa-minus",a.onclick=()=>{const v=this.state.redlining.features.find(y=>y.id===t.id);v.textSize=v.textSize-1},o.appendChild(a);const l=document.createElement("i");l.className="fa-solid fa-plus",l.onclick=()=>{const v=this.state.redlining.features.find(y=>y.id===t.id);v.textSize=v.textSize+1},o.appendChild(l),s.appendChild(o);const h=document.createElement("i");h.className="fa-solid fa-paint-roller",s.appendChild(h);const c=this.isNullOrUndefined(t.fillColor)?this.configManager.Config.redlining.defaultFillColor:t.fillColor,u=new Tm({parent:h,color:c,popup:"left"});u.onChange=v=>{const y=this.state.redlining.features.find(x=>x.id===t.id);y.fillColor=v.hex},u.onDone=v=>{const y=this.state.redlining.features.find(x=>x.id===t.id);y.fillColor=v.hex};const d=document.createElement("i");d.className="fa-solid fa-paintbrush",s.appendChild(d);const f=this.isNullOrUndefined(t.strokeColor)?this.configManager.Config.redlining.defaultStrokeColor:t.fillColor,g=new Tm({parent:d,color:f,popup:"left"});g.onChange=v=>{const y=this.state.redlining.features.find(x=>x.id===t.id);y.strokeColor=v.hex},g.onDone=v=>{const y=this.state.redlining.features.find(x=>x.id===t.id);y.strokeColor=v.hex};const p=document.createElement("input");p.type="range",p.className="slider",p.min=0,p.max=10,p.value=this.isNullOrUndefined(t.strokeWidth)?this.configManager.Config.redlining.defaultStrokeWidth:t.strokeWidth,p.oninput=v=>{const y=this.state.redlining.features.find(x=>x.id===t.id);y.strokeWidth=v.target.value},s.appendChild(p);const m=document.createElement("i");m.className="fa-solid fa-trash",m.onclick=v=>this.deleteFeature(t),s.appendChild(m),this.drawingList.appendChild(s)}removeFeatureFromList(t){const i="f-"+t.id;this.shadow.getElementById(i).remove()}deleteFeature(t){confirm("Do you want to delete this feature?")&&(this.state.redlining.features=this.state.redlining.features.filter(i=>i.id!=t.id))}}customElements.define("girafe-redlining",x2);var Bh,cv;class w2 extends jh{constructor(){super("print");se(this,Bh);_(this,"template",()=>xe`<style>
:host, #panel {
  min-width: 22rem;
}

#panel {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: visible;
}

#gutter {
  border: none;
  width: 6px;
  height: 100%;
  background: var(--bkg-color);
  position: absolute;
  top: 0;
  left: 0;
  cursor: col-resize;
}

#close {
  border: solid 1px #999;
  border-right: none;
  color: #999;
  padding: 0.7rem 0 0.7rem 0.5rem;
  border-radius: 10px 0  0 10px;
  width: 0.8rem;
  height: 2rem;
  line-height: 2rem;
  position: fixed;
  top: 5.8rem;
  right: 22rem;
  background-color: var(--bkg-color);
  cursor: pointer;
}

#close i:before {
  content: "\uf00d";
}

#close:hover {
  border-color: #000;
  color: #000;
}

#content {
  position: absolute;
  top : 0;
  left: 6px;
  right: 0;
  bottom: 0;
  background: var(--bkg-color);
  padding : 1.5rem;
  margin: 0;
  overflow: visible;
}

#content div.option {
  margin-top: 0.5rem;
  display: flex;
}

#content button {
  float: right;
  margin-top: 1rem;
  height: 3rem;
  width: 8rem;
  background-color: var(--bkg-color);;
  color: var(--text-color);
  border-radius: 3px;
  outline: 0;
  border: solid 1px #444;
  cursor: pointer;
}

#content button:hover {
  background-color: #000;
}

#content #printList {
  margin-top : 8rem;
}

#printList div.girafe {
  display: inline-block;
  position: relative;
  padding: 0.5rem;
  margin-top: 0.1rem;
  margin-right: 0.1rem;
  border: solid 1px #999;
  text-align: left;
  width: 100%;
  max-width: 16rem;
  min-width: 13rem;
  color: #666;
}

div.girafe i {
  margin-right: 1rem;
  float: left;
}

div.girafe span {
  display: block;
  line-height: 1.3rem;
}

div.girafe span.time {
  position: absolute;
  bottom: 0;
  right: 0;
  margin-right: 0.5rem;
}

label {
  color: var(--text-color);
  display: inline-block;
  width: 5rem;
  text-align: right;
  line-height: 2.5rem;
  margin-right: 0.5rem;
  flex-grow: 0;
}

label[for=comment] {
  line-height: 1.5rem;
}

label:after {
  content: ' :';
}

select, #title, #comment {
  appearance: none;
  outline: 0;
  box-shadow: none;
  flex: 1;
  padding: 0 1rem;
  color: var(--text-color);
  background-color: var(--bkg-color);
  border: solid 1px #444;
  background-image: none;
  cursor: pointer;
  min-width: 4rem;
}

#comment {
  height: 6rem;
  padding: 0.5rem 1rem;
}

/* Custom Select wrapper */
.select {
  position: relative;
  display: flex;
  width: 13rem;
  height: 2.5rem;
  border-radius: 3px;
  overflow: hidden;
  flex-grow: 1;
}

.select::after {
  content: "\u25bc";
  position: absolute;
  top: 0;
  right: 0;
  padding: 0.7rem;
  background-color: #444;
  color: var(--text-color);
  pointer-events: none;
}

.select:hover::after {
  background-color: #000;
}

</style>
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />

<div id="panel">
  <div id="gutter"></div>
  <div id="close">
    <i class="fa-solid"></i>
  </div>
  <div id="content">

    <div class="option">
      <label for="layout">Layout</label>
      <div class="select">
        <select id="layout"></select>
      </div>
    </div>

    <div class="option">
      <label for="scale">Scale</label>
      <div class="select">
        <select id="scale"></select>
      </div>
    </div>

    <div class="option">
      <label for="format">Format</label>
      <div class="select">
        <select id="format"></select>
      </div>
    </div>

    <div class="option">
      <label for="title">Title</label>
      <input id="title" />
    </div>

    <div class="option">
      <label for="comment">Comment</label>
      <textarea id="comment"></textarea>
    </div>

    <button id="export-pdf">Print</button>

    <div id="printList"></div>

  </div>

</div>`);_(this,"panel",null);_(this,"exportButton",null);_(this,"scaleSelect",null);_(this,"layoutSelect",null);_(this,"formatSelect",null);_(this,"titleInput",null);_(this,"commentInput",null);_(this,"downloadButton",null);_(this,"printList",null);_(this,"printUrl",null);_(this,"defaultLayout",null);_(this,"printApp",null);_(this,"printLayouts",null);_(this,"layoutsByName",{});_(this,"printFormats",null);_(this,"downloadUrl",null);_(this,"statusUrl",null);_(this,"projection",null);_(this,"centerCoords",null)}get capabilitiesUrl(){return this.printUrl+"capabilities.json"}getReportUrl(t){return this.printUrl+"report."+t}getDownloadUrl(t){return this.printUrl+t.downloadURL.substring(t.downloadURL.indexOf("/report")+1)}getStatusUrl(t){return this.printUrl+t.statusURL.substring(t.statusURL.indexOf("/status")+1)}async initializePrint(){this.printUrl=this.configManager.Config.print.url,this.defaultLayout=this.configManager.Config.print.defaultLayout,this.printUrl.endsWith("/")||(this.printUrl+="/");const i=await(await fetch(this.capabilitiesUrl,{referrer:""})).json();this.printApp=i.app,this.printLayouts=i.layouts,this.printFormats=i.formats}render(){super.render(),this.panel=this.shadow.querySelector("#panel"),this.panel.style.display="none",this.exportButton=this.shadow.querySelector("#export-pdf"),this.scaleSelect=this.shadow.querySelector("#scale"),this.layoutSelect=this.shadow.querySelector("#layout"),this.formatSelect=this.shadow.querySelector("#format"),this.titleInput=this.shadow.querySelector("#title"),this.commentInput=this.shadow.querySelector("#comment"),this.downloadButton=this.shadow.querySelector("#download"),this.printList=this.shadow.querySelector("#printList"),this.printLayouts.forEach(s=>{this.layoutsByName[s.name]=s,this.addLayoutOption(this.layoutSelect,s)}),this.defaultLayout!==null&&(this.layoutSelect.value=this.defaultLayout);const i=this.layoutsByName[this.layoutSelect.value].attributes.filter(s=>s.type==="MapAttributeValues")[0].clientInfo;this.updateScales(i),this.printFormats.forEach(s=>{this.addFormatOption(this.formatSelect,s)}),this.activateTooltips(!1,[800,0],"top-end"),super.girafeTranslate()}closePanel(){this.state.interface.printPanelVisible=!1}addFormatOption(t,i){const s=document.createElement("option");s.innerHTML=i,s.value=i,t.appendChild(s)}addLayoutOption(t,i){const s=document.createElement("option");s.setAttribute("i18n",i.name),s.innerHTML=i.name,s.value=i.name,t.appendChild(s)}addScaleOption(t,i){const s=document.createElement("option");s.innerHTML="1:"+i,s.value=i,t.appendChild(s)}registerEvents(){this.stateManager.subscribe("interface.printPanelVisible",(t,i)=>ae(this,Bh,cv).call(this,i)),this.layoutSelect.addEventListener("change",t=>this.onLayoutChanged(t)),this.scaleSelect.addEventListener("change",t=>this.onScaleChanged(t)),this.exportButton.addEventListener("click",()=>this.print())}onLayoutChanged(t){const s=this.layoutsByName[t.target.value].attributes.filter(r=>r.type==="MapAttributeValues")[0].clientInfo;this.updateScales(s),this.state.print.format=[s.width,s.height]}onScaleChanged(t){this.state.print.scale=t.target.value}updateScales(t){const i=this.scaleSelect.value;this.scaleSelect.innerHTML="",t.scales.forEach(s=>{this.addScaleOption(this.scaleSelect,s)}),this.isNullOrUndefinedOrBlank(i)?this.scaleSelect.value=t.scales[0]:(this.scaleSelect.value=i,this.scaleSelect.value=i)}connectedCallback(){this.loadConfig().then(()=>this.initializePrint().then(()=>{this.render(),this.registerEvents()}))}print(){const t=this.layoutSelect.value,i=this.formatSelect.value,s=this.scaleSelect.value,r={attributes:{map:{dpi:254,rotation:0,center:[this.state.position.center[0],this.state.position.center[1]],projection:this.state.projection,scale:s,useNearestScale:!1,layers:[{baseURL:"https://map.geo.bs.ch/mapserv_proxy",imageFormat:"image/png",layers:["Stadt- und Parzellenplan farbig"],customParams:{TRANSPARENT:"true",ogcserver:"WMS BS (1)"},serverType:"mapserver",type:"wms",opacity:1,useNativeAngle:!0,styles:[""]}]},title:this.titleInput.value,comment:this.commentInput.value,maxTitleLength:"130",maxCommentLength:"190"},format:i,lang:"en",layout:t};fetch(this.getReportUrl(i),{method:"POST",headers:new Headers({"Content-Type":"application/json;charset=UTF-8"}),body:JSON.stringify(r)}).then(o=>o.json()).then(o=>this.managePrintStatus(o))}managePrintStatus(t){const i=this.getDownloadUrl(t),s=this.getStatusUrl(t),r="p-"+t.ref.substring(0,t.ref.indexOf("-"));this.addPrintToList(r),setTimeout((function(o,a,l){this.checkStatus(o,a,l)}).bind(this,r,s,i),2e3)}addPrintToList(t){const i=document.createElement("div");i.className="girafe",i.id=t;const s=document.createElement("i");s.className="fa-solid fa-circle-notch fa-spin fa-3x",i.appendChild(s);const r=document.createElement("span");r.innerHTML=this.layoutSelect.value+" ("+this.formatSelect.value+")",i.appendChild(r);const o=document.createElement("span");o.innerHTML=this.titleInput.value,i.appendChild(o);const a=new Date(Date.now()),l=document.createElement("span");l.innerHTML=a.getHours()+":"+a.getMinutes(),l.className="time",i.appendChild(l),this.printList.prepend(i)}checkStatus(t,i,s){fetch(i).then(r=>r.json()).then(r=>{if(!r.done)r.elapsedTime>3e4?alert("timeout"):setTimeout((function(o,a,l){this.checkStatus(o,a,l)}).bind(this,t,i,s),2e3);else switch(r.status){case"error":this.printError(t,r.error);break;case"finished":this.printFinished(t,s)}})}printFinished(t,i){const r=this.shadow.querySelector("#"+t).querySelectorAll("i")[0];r.className="fa-solid fa-file-arrow-down fa-3x",r.onclick=()=>window.open(i,"_blank")}printError(t,i){const r=this.shadow.querySelector("#"+t).querySelectorAll("i")[0];r.className="fa-solid fa-triangle-exclamation fa-3x",r.title=i}}Bh=new WeakSet,cv=function(t){if(t){this.panel.style.display="block",this.panel.getRootNode().host.style.display="block";const s=this.layoutsByName[this.layoutSelect.value].attributes.filter(r=>r.type==="MapAttributeValues")[0].clientInfo;this.state.print.scale=this.scaleSelect.value,this.state.print.format=[s.width,s.height]}else this.panel.style.display="none",this.panel.getRootNode().host.style.display="none"};customElements.define("girafe-print",w2);class uv extends ot{constructor(t){super(t);_(this,"button");_(this,"div");_(this,"header");_(this,"closeButton");_(this,"pos1",0);_(this,"pos2",0);_(this,"pos3",0);_(this,"pos4",0)}get host(){return this.shadow.getRootNode().host}makeDraggable(){this.div=this.shadow.querySelector("#draggable"),this.header=this.shadow.querySelector("#header"),this.header.onmousedown=t=>this.dragMouseDown(this,t),this.closeButton=this.shadow.getElementById("close"),this.isNullOrUndefined(this.closeButton)||(this.closeButton.onclick=()=>this.closeWindow())}closeWindow(){throw new Error("This function must be overriden to close the associated window")}dragMouseDown(t,i){i.preventDefault(),t.pos3=i.clientX,t.pos4=i.clientY,document.onmouseup=()=>t.closeDragElement(),document.onmousemove=s=>t.elementDrag(t,s)}elementDrag(t,i){i.preventDefault();const s=t.host.getBoundingClientRect(),r=t.pos3-i.clientX,o=t.host.offsetLeft-r,a=o+s.width;o<0?t.host.style.left="0px":a>this.getBodyWidth()?t.host.style.left=this.getBodyWidth()-s.width+"px":(t.pos1=r,t.pos3=i.clientX,t.host.style.left=o+"px");const l=t.pos4-i.clientY,h=t.host.offsetTop-l,c=h+s.height;h<0?t.host.style.top="0px":c>this.getBodyHeight()?t.host.style.top=this.getBodyHeight()-s.height+"px":(t.pos2=l,t.pos4=i.clientY,t.host.style.top=h+"px")}getBodyWidth(){return Math.max(document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth,document.documentElement.clientWidth)}getBodyHeight(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight)}closeDragElement(){document.onmouseup=null,document.onmousemove=null}}class b2 extends uv{constructor(){super("selectionwindow");_(this,"template",()=>xe`<style>
#draggable {
    border: solid 1px #666;
    border-radius: 3px;
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    background: var(--bkg-color);
}

#header {
    padding: 0.5rem;
    cursor: move;
    z-index: 10;
    background-color: #666;
    color: var(--text-color);
    text-align: center;
}

#content {
    padding: 1rem 2rem;
    width: 26rem;
    height: 12rem;
    overflow-y : auto;
    scrollbar-width: thin;
}

table {
    border-collapse: collapse;
    width: 100%;
}

td.label {
    text-align: right;
    padding-right: 1rem;
    color: #666;
    width: 8rem;
    vertical-align: top
}

td.label:after {
    content: ' :';
}

#footer {
    color: #aaa;
    height: 2rem;
    border-top: solid 1px #999;
}

#previous {
    padding: 0.5rem;
    cursor: pointer;
    position: absolute;
    left: 0;
    bottom: 0;
}

#next  {
    padding: 0.5rem;
    cursor: pointer;
    position: absolute;
    right: 0;
    bottom: 0;
}

#counter {
    line-height: 2rem;
    text-align: center;
    margin-top : 0;
}

</style>
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />

<div id="draggable">
  <div id="header">HEADER</div>
  <div id="content"></div>
  <div id="footer">
    <a id="previous"><i class="fa-solid fa-xl fa-circle-arrow-left"></i></a>
    <a id="next"><i class="fa-solid fa-xl fa-circle-arrow-right"></i></a>
    <p id="counter">1/5</p>
  </div>
</div>
`);_(this,"maxFeatures",200);_(this,"focusedIndex",null);_(this,"content",null);_(this,"previousButton",null);_(this,"nextButton",null);_(this,"counter",null)}render(){super.render(),this.content=this.shadow.querySelector("#content"),this.previousButton=this.shadow.querySelector("#previous"),this.nextButton=this.shadow.querySelector("#next"),this.counterText=this.shadow.querySelector("#counter")}registerEvents(){this.previousButton.addEventListener("click",()=>this.onFocusFeature(this.focusedIndex-1)),this.nextButton.addEventListener("click",()=>this.onFocusFeature(this.focusedIndex+1))}onFocusFeature(t){this.focusedIndex=t,this.state.selection.focusedFeature=this.state.selection.selectedFeatures[t];const i=this.state.selection.focusedFeature.getId(),s=i===void 0?"UNKNOWN":i.split(".")[0];this.header.setAttribute("i18n",s);const r=this.state.selection.focusedFeature.getProperties(),o=document.createElement("table");for(const a in r)if(a!=="boundedBy"&&a!=="the_geom"){const l=document.createElement("tr"),h=document.createElement("td");h.className="label",h.setAttribute("i18n",a),l.appendChild(h);const c=document.createElement("td");c.className="value",c.innerHTML=r[a],l.appendChild(c),o.appendChild(l)}this.content.innerHTML="",this.content.appendChild(o),this.enableNavigationButtons(),super.girafeTranslate()}enableNavigationButtons(){let t="block",i="block";this.focusedIndex===0&&(t="none"),this.focusedIndex===this.state.selection.selectedFeatures.length-1&&(i="none"),this.previousButton.style.display=t,this.nextButton.style.display=i,this.state.selection.selectedFeatures.length===1?this.counterText.innerHTML="":this.counterText.innerHTML=this.focusedIndex+1+"/"+this.state.selection.selectedFeatures.length}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.makeDraggable(),this.registerEvents()})}}customElements.define("girafe-selection-window",b2);class E2 extends jh{constructor(){super("selectiongrid");_(this,"template",()=>xe`<style>
:host, #panel {
  min-height: 10rem;
  height: 16rem;
  background: var(--bkg-color);;
}

#panel {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
}

#gutter {
  border: none;
  height: 6px;
  width: 100%;
  background: var(--bkg-color);;
  position: absolute;
  top: 0;
  left: 0;
  cursor: row-resize;
}

#close {
  border: none;
  color: #777;
  padding: 0;
  margin:0.5rem;
  width: 1rem;
  height: 1rem;
  line-height: 1rem;
  position: absolute;
  top: 0;
  right: 0;
  background-color: var(--bkg-color);;
  cursor: pointer;
}

#close i:before {
  content: "\uf00d";
}

#close:hover {
  border-color: #000;
  color: #000;
}

#content {
  position: absolute;
  top : 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--bkg-color);;
  padding : 0;
  margin: 0.5rem;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

#header {
  flex: 0;
}

.tab {
  border: solid 1px #ccc;
  display: inline-block;
  height: 2rem;
  line-height: 2rem;
  padding: 0 1rem;
  margin-right: 0.2rem;
  margin-bottom: 0.2rem;
  cursor: pointer;
  background-color: var(--bkg-color-grad2);
}

.tab.active {
  color: var(--text-color);
  background-color: var(--bkg-color);
}

#grid {
  overflow: hidden;
  flex: 1;
}

.gridjs-wrapper {
  overflow-x: hidden !important;
  height: 100% !important;
  width: 100% !important;
}

.gridjs-container {
  height: 100%;
  width: 100%;
}

.geo-type {
  margin-right: 0.5rem;
}

girafe-button {
  float: right;
  margin-left: 0.5rem;
  margin-top: 0.2rem;
}

::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-thumb {
  background: #999;
}

.gridjs-table {
  background-color: var(--bkg-color) !important;
  color: var(--text-color);
}

td.gridjs-td {
  background-color: var(--bkg-color) !important;
}

th.gridjs-th {
  color: var(--text-color-grad2);
  background-color: var(--bkg-color-grad2) !important;
}

.gridjs-th-content {
  color: var(--text-color) !important;
}
</style>
<link rel="stylesheet" href="lib/gridjs/mermaid.min.css" />
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />
<link rel="stylesheet" href="lib/font-gis/css/font-gis.css" />

<div id="panel">
  <div id="content">
    <div id="header"></div>
    <div id="grid"></div>
  </div>
  <div id="gutter"></div>
  <div id="close">
    <i class="fa-solid"></i>
  </div>
</div>`);_(this,"locale",null);_(this,"panel",null);_(this,"content",null);_(this,"header",null);_(this,"grid",null);_(this,"activeTab",null);_(this,"typeToFeatures",{})}render(){super.render(),this.panel=this.shadow.querySelector("#panel"),this.content=this.shadow.querySelector("#content"),this.header=this.shadow.querySelector("#header"),this.grid=this.shadow.querySelector("#grid"),this.panel.style.display="none",this.locale=this.configManager.Config.general.locale,this.activateTooltips(!1,[800,0],"top-end")}registerEvents(){this.stateManager.subscribe("selection.selectedFeatures",(t,i)=>this.onFeaturesSelected(i)),this.stateManager.subscribe("interface.selectionGridVisible",(t,i)=>this.togglePanel(i))}onFeaturesSelected(t){if(this.header.innerHTML="",!(this.isNullOrUndefined(t)||t.length<=0)){this.typeToFeatures={};for(const i of t){const s=i.getId(),r=s===void 0?"UNKNOWN":s.split(".")[0];if(!(r in this.typeToFeatures)){const l=[];for(const h in i.getProperties())if(h!=="boundedBy"){const c={id:h,name:du.getInstance().getTranslation(h),formatter:this.formatCell.bind(this)};l.push(c)}this.typeToFeatures[r]={columns:l,data:[],features:[]}}this.typeToFeatures[r].features.push(i);const o=[],a=i.getProperties();for(const l of this.typeToFeatures[r].columns){const h=a[l.id];if(h instanceof no){const c=this.getGeometryIcons(h);o.push(c)}else o.push(h)}this.typeToFeatures[r].data.push(o)}for(const[i,s]of Object.entries(this.typeToFeatures)){const r=document.createElement("a");r.text=du.getInstance().getTranslation(i),r.className="tab",r.id=i,r.onclick=()=>{this.displayGrid(i)},this.header.append(r)}this.displayGrid(Object.keys(this.typeToFeatures)[0])}}getGeometryIcons(t){let i,s;if(t instanceof Ht){i='<i class="geo-type fg-point fg-lg"></i>',s=t.getFlatCoordinates();const r=cd(s);i+=`<span>E ${r[0]} / N ${r[1]}</span>`}else if(t instanceof go)if(i='<i class="geo-type fg-multipoint fg-lg"></i>',t.getPoints.length===1){s=t.getPoint(0).getFlatCoordinates();const r=cd(s);i+=`<span>E ${r[0]} / N ${r[1]}</span>`}else s=Nt(t.getExtent()),i+="<span>Multipoint</span>";else if(t instanceof $i||t instanceof Xs){i='<i class="geo-type fg-polyline-pt fg-lg"></i>';const r=(Math.round(t.getLength()*100)/100).toLocaleString(this.locale,{minimumFractionDigits:2});i+=`<span>${r}&nbsp;m</span>`,s=Nt(t.getExtent())}else if(t instanceof Wi||t instanceof Ys){i='<i class="geo-type fg-polygon-pt fg-lg"></i>';const r=(Math.round(t.getArea()*100)/100).toLocaleString(this.locale,{minimumFractionDigits:2});i+=`<span>${r}&nbsp;m<sup>2</sup></span>`,s=Nt(t.getExtent())}else{console.error("Unknown geometry type",t.getType());return}return i+=`<girafe-button icon-style="fa-sm fa-solid fa-magnifying-glass" 
                             size="extra-small" tip="Pan to geometry" tip-placement="right" 
                             class="transparent" 
                             state-action="position.center" 
                             data-value="[${s[0]},${s[1]}]"></girafe-button>`,i}formatCell(t,i,s){if(!this.isNullOrUndefinedOrBlank(t)){const r=t.toLowerCase();if(r.includes("<a")&&r.includes("href")||r.includes("<img")&&r.includes("src")||r.includes("<girafe-button")||r.includes("<i")&&r.includes("class"))return Uv(t)}return t}searchGrid(t,i,s){console.log("SEARCH")}displayGrid(t){this.grid.innerHTML="";const i=this.typeToFeatures[t];new jv({columns:i.columns,sort:!0,fixedHeader:!0,data:i.data,resizable:!0,style:{th:{padding:"6px 10px"},td:{padding:"6px 10px"}}}).render(this.grid).forceRender(),this.activateTooltips(!1,[800,0],"top-end");const s=this.shadow.getElementById(t);s.classList.add("active"),this.activeTab!==null&&this.activeTab.classList.remove("active"),this.activeTab=s}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}closePanel(){this.state.interface.selectionGridVisible=!1,this.state.selection.selectedFeatures=null}togglePanel(t){t?(this.panel.style.display="block",this.panel.getRootNode().host.style.display="block"):(this.panel.style.display="none",this.panel.getRootNode().host.style.display="none")}}customElements.define("girafe-selection-grid",E2);class C2 extends ot{constructor(){super("help");_(this,"template",()=>xe`<style>
#content {
    z-index: 10000;
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    background-color: rgba(0,0,0,.65);
    display: none;
}

#themes {
    position: absolute;
    top: 4.5rem;
    left: 0;
    width: 150px;
    height: 120px;
    background-image: url(components/help/images/arrow_white.webp);
    background-repeat: no-repeat;
    transform: rotateY(0deg) rotateX(0deg) rotateZ(90deg);
    background-position: bottom -50px left -60px;
}

#search {
    position: absolute;
    top: 8rem;
    left: 45%;
    width: 180px;
    height: 70px;
    background-image: url(components/help/images/arrow_white.webp);
    background-repeat: no-repeat;
    transform: rotateY(0deg) rotateX(0deg) rotateZ(90deg);
    background-position: -60px -30px;
}

#menu {
    position: absolute;
    top: 4.5rem;
    right: 0;
    width: 150px;
    height: 120px;
    background-image: url(components/help/images/arrow_white.webp);
    background-repeat: no-repeat;
    transform: rotateY(180deg) rotateX(0deg) rotateZ(90deg);
    background-position: bottom -50px left -60px;
}

#basemap {
    position: absolute;
    bottom: 3rem;
    left: 21rem;
    width: 150px;
    height: 120px;
    background-image: url(components/help/images/arrow_white.webp);
    background-repeat: no-repeat;
    transform: rotateY(0deg) rotateX(180deg) rotateZ(90deg);
    background-position: bottom -50px left -60px;
}

#themes-descr {
    position: absolute;
    top: 10rem;
    left: 10rem;
    color: #fff;
    font-size: 1.2rem;
    width: 12rem;
}

#search-descr {
    position: absolute;
    top: 16rem;
    left: 45%;
    color: #fff;
    font-size: 1.2rem;
    width: 12rem;
}

#menu-descr {
    position: absolute;
    top: 10rem;
    right: 10rem;
    color: #fff;
    font-size: 1.2rem;
    width: 12rem;
    text-align: right;
}

#basemap-descr {
    position: absolute;
    bottom: 9rem;
    left: 31rem;
    color: #fff;
    font-size: 1.2rem;
    width: 12rem;
}

</style>
<div id="content">
  <div id="themes"></div>
  <div id="themes-descr">
    Clicking the Topics button opens the topic overview.
    After selecting the desired topic, all assigned maps are loaded.
  </div>

  <div id="search"></div>
  <div id="search-descr">
    Search for a place, an address, a map or a geographical data.
  </div>

  <div id="menu"></div>
  <div id="menu-descr">
    This menu contains advanced functions such as printing, drawing, language, 3D view, etc...
  </div>

  <div id="basemap"></div>
  <div id="basemap-descr">
    Here, you can choose which background layers you want to use.
  </div>
</div>`);_(this,"content")}render(){super.render(),this.content=this.shadow.querySelector("#content"),this.configManager.Config.basemaps.show||(this.shadow.querySelector("#basemap").style.display="none",this.shadow.querySelector("#basemap-descr").style.display="none")}registerEvents(){this.stateManager.subscribe("interface.helpVisible",(t,i)=>this.toggleHelp(i)),this.content.addEventListener("click",()=>{this.state.interface.helpVisible=!1})}toggleHelp(t){t?this.content.style.display="block":this.content.style.display="none"}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}}customElements.define("girafe-help",C2);class M2 extends uv{constructor(){super("about");_(this,"template",()=>xe`<style>
#draggable {
  border-radius: 1px;
  box-shadow: var(--bx-shdw);
}

#header {
  padding: 0.5rem;
  cursor: grabbing;
  z-index: 10;
  background: var(--bkg-color-grad2);
  color: var(--text-color);
  text-align: center;
}

#content {
  padding: 0rem 2rem;
  width: 23rem;
  height: 18rem;

}

#close {
  cursor: pointer;
  float: right;
}

img {
  margin-top: 1rem;
  margin-bottom: 1rem;
}

h3 {
  font-size: 1rem;
  font-weight: normal;
  margin: 0.2rem;
  color: var(--text-color);
}

a:link {
    color: var(--lnk);
}

a:visited {
    color: var(--lnk-visited);
}

a:hover {
    color: var(--lnk-hover);
}

a:active {
    color: var(--lnk-active);
    text-decoration: none;
    font-weight: normal;
}
</style>
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />

<div id="draggable">
  <div id="header">About
    <div id="close">
      <i class="fa-solid fa-xmark"></i>
    </div>
  </div>
  <div id="content">
    <img alt="GeoGirafe logo" src="components/about/images/Girafe_Opengis.png" width="250px"/>
    <h3>powered by: <a href="https://www.opengis.ch" rel="noopener" target="_blank">https://www.opengis.ch</a></h3>
    <hr />    <h3>Version: ${this.version}</h3>
    <h3>Build: ${this.build}</span></h3>
    <h3>Date: ${this.date}</span></h3>
    <h3>Source: <a href="https://gitlab.com/geogirafe/gg-viewer" rel="noopener" target="_blank">https://gitlab.com/geogirafe/gg-viewer</a></h3>
  </div>
</div>
`);_(this,"loaded",!1);_(this,"version");_(this,"build");_(this,"date")}async loadVersionInfos(){if(!this.loaded){const i=await(await fetch("about.json")).json();this.version=i.version,this.build=i.build,this.date=i.date,this.loaded=!0,console.log(this.version),console.log(this.build),console.log(this.date)}this.render()}registerEvents(){this.stateManager.subscribe("interface.aboutVisible",(t,i)=>this.toggleAbout(i))}toggleAbout(t){t?this.loadVersionInfos().then(()=>{this.shadow.getRootNode().host.style.display="block"}):this.shadow.getRootNode().host.style.display="none"}closeWindow(){this.state.interface.aboutVisible=!1}connectedCallback(){this.loadConfig().then(()=>{this.render(),this.girafeTranslate(),this.makeDraggable(),this.registerEvents()})}}customElements.define("girafe-about",M2);class S2 extends ot{constructor(){super("colorswitcher");_(this,"template",()=>xe`<style>
.lbl {
  position: inherit;
  top: -0.75rem;
}

/* The switch - the box around the slider */
.switch {
  position: relative;
  display: inline-block;
  vertical-align: middle;
  border-right: solid 1px #fff;
  width: 4rem;
  height: 4.6rem;
  text-align: center;
  background-color: var(--bkg-color-grad1);
}

/* Hide default HTML checkbox */
.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

/* The slider */
.slider {
  position: absolute;
  cursor: pointer;
  top: 2.2rem;
  left: 0.5rem;
  right: 0.5rem;
  bottom: 1.4rem;
  width: 3rem;
  height: 1.5rem;
  vertical-align: middle;
  background-color: var(--bkg-color);
  -webkit-transition: .4s;
  transition: .4s;
}

.slider:before {
  position: absolute;
  content: "";
  height: 1.3rem;
  width: 1.3rem;
  left: 4px;
  bottom: 0.1rem;
  background-color: var(--text-color-grad1);
  -webkit-transition: .4s;
  transition: .4s;
}

input:checked+.slider {
  background-color: #222;
}

input:focus+.slider {
  box-shadow: 0 0 1px #222;
}

input:checked+.slider:before {
  -webkit-transform: translateX(18px);
  -ms-transform: translateX(18px);
  transform: translateX(18px);
}

/* Rounded sliders */
.slider.round {
  border-radius: 1rem;
}

.slider.round:before {
  border-radius: 50%;
}
</style>
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />

<div id="container">

  <label class="switch">
    <h6 class="lbl">Color mode</h6>
    <input id="colorswitchSwitcher" type="checkbox">
    <span id="colorswitcher" class="slider round"></span>
  </label>
</div>`);_(this,"colorswitcherContainer");_(this,"colorswitchSwitcher");_(this,"header");_(this,"currentTheme",localStorage.getItem("theme"))}render(){super.render(),this.colorswitcherContainer=this.shadow.querySelector("#colorswitcherContainer"),this.colorswitchSwitcher=this.shadow.querySelector("#colorswitchSwitcher")}getHeader(){this.header=this.shadow.querySelector("body")}registerEvents(){this.colorswitchSwitcher.addEventListener("click",()=>this.toggleDarkFrontendMode())}toggleClassList(t){t?this.activateThemeMode("dark","replace"):this.activateThemeMode("light","replace")}toggleDarkFrontendMode(){let t=an.getInstance().state.interface.darkFrontendMode;t=!t,an.getInstance().state.interface.darkFrontendMode=t;let i="light";t&&(i="dark"),this.toggleClassList(t),localStorage.setItem("theme",i)}initValue(){if(this.currentTheme!=null&&this.currentTheme==="dark"){this.activateThemeMode("dark","toggle");return}else if(this.currentTheme!=null&&this.currentTheme==="light"){this.activateThemeMode("light","toggle");return}window.matchMedia("(prefers-color-scheme: dark)").matches?this.activateThemeMode("dark","toggle"):this.activateThemeMode("light","toggle")}activateThemeMode(t,i){if(i==="toggle")document.body.classList.toggle(`${t}-theme`);else{const s=t==="dark"?"light":"dark";document.body.classList.replace(`${s}-theme`,`${t}-theme`)}an.getInstance().state.interface.darkFrontendMode=t==="dark",t==="dark"?document.body.querySelector("#logo").src="images/logo_black_small.webp":document.body.querySelector("#logo").src="images/logo_small.webp"}connectedCallback(){this.loadConfig().then(()=>{this.render(),this.girafeTranslate(),this.registerEvents(),this.getHeader(),this.initValue()})}}customElements.define("girafe-colorswitcher",S2);const Uh=class Uh{constructor(e,t){_(this,"name");_(this,"position");if(!Uh.BOOKMARKNAMEPATTERN.test(e))throw new Error("Bookmark name is not valid: it can only contain alphanumeric characters and the dash (-) underscore (_) and space characters.");this.name=e,this.position=t}};_(Uh,"BOOKMARKNAMEPATTERN",/^[A-Za-z0-9_ -]+$/);let ud=Uh;class dv extends ot{constructor(t){super("navbookmarks");_(this,"template",()=>xe`<style>
.content {
  display: flex;
}

input {
  border: solid 1px #ccc;
  border-radius: 0.25rem;
  background-color: #fff;
  padding-left: 1rem;
  color: #000;
  font-size: 0.9rem;
}

button {
  border: none;
  border-right: solid 1px #fff;
  width: 2.3rem;
  height: 2.3rem;
  line-height: 2.3rem;
  background-color: #444;
  color: #fff;
  padding: 0;
  cursor: pointer;
  margin: 0;
  display: inline-block;
}

button:hover {
  background-color: #000;
}
</style>
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />

<div class="content">
  <input id="name" type="text" placeholder="Enter name..."
    onkeypress="${t=>{t.keyCode===13?this.saveBookmark():console.log(t.keyCode)}}" />

  <button tip="Add bookmark" onclick="${()=>this.saveBookmark()}">
    <i class="fa-sm fa-solid fa-check"></i>
  </button>
</div>`);_(this,"navHelper");_(this,"nameInput",null);this.navHelper=t}render(){super.render(),this.nameInput=this.shadow.getElementById("name"),this.nameInput.focus()}saveBookmark(){if(this.nameInput)try{const t=new ud(this.nameInput.value,this.state.position);this.navHelper.addBookmark(t),this.nameInput.value=""}catch(t){alert(t)}}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate()})}}customElements.define("girafe-nav-bookmarks",dv);var ma,Si,Jt,Zr;class T2 extends ot{constructor(){super("navhelper");_(this,"template",()=>xe`<style>
.content-horizontal {
  display: flex;
  flex-direction: row;
}

.content-vertical {
  display: flex;
  flex-direction: column;
}

.menu-content {
  display: inline-flex;
  flex-direction: column;
  width: max-content;
  background-color: #fff;
}

.border-top {
  border-top: solid 1px #fff;
}

.hidden {
  display: none;
}

.grow {
  flex-grow: 1;
}
</style>
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />

<div class="content">
  <div class="content-horizontal">
    <div class="content-vertical">
      <girafe-button id="add-bookmark" size="small" icon-style="fa-sm fa-solid fa-plus"></girafe-button>
      <girafe-button size="small" icon-style="fa-sm fa-solid fa-arrow-left" class="border-top"
        onclick="${()=>this.navigateBack()}"></girafe-button>
    </div>
    <div class="content-vertical">
      <girafe-menu-button icon-style="fa-sm fa-solid fa-bookmark" size="small" open="bottom-left">
        <div slot="menu-content">
          <div class="${this.hasBookmark?"menu-content":"hidden"}">
            ${Object.values(this.bookmarks).map(t=>xe.for(t)`
            <div class="content-horizontal">
              <girafe-button text="${t.name}" size="large" class="grow transparent border-top"
                onclick="${()=>this.navigateToPosition(t.position)}"></girafe-button>
              <girafe-button size="small" icon-style="fa-sm fa-solid fa-trash" class="border-top transparent"
                onclick="${()=>this.removeBookmark(t)}"></girafe-button>
            </div>`)}
          </div>
          <div class="${this.hasBookmark?"hidden":"menu-content"}">
            <girafe-button text="No bookmark yet..." size="large" class="transparent"></girafe-button>
          </div>
        </div>
      </girafe-menu-button>
      <girafe-button size="small" icon-style="fa-sm fa-solid fa-arrow-right" class="border-top"
        onclick="${()=>this.navigateForward()}"></girafe-button>
    </div>
  </div>
</div>`);se(this,ma,void 0);se(this,Si,[]);se(this,Jt,-1);_(this,"bookmarks",[]);se(this,Zr,!1)}get hasBookmark(){return this.bookmarks.length>0}render(){super.render(),this.createBookmarkTooltip()}createBookmarkTooltip(){const t=this.shadow.getElementById("add-bookmark");Ze(this,ma,zo(t,{trigger:"click",arrow:!0,interactive:!0,theme:"light",placement:"bottom",appendTo:document.body,content:i=>new dv(this)}))}addBookmark(t){this.bookmarks.push(t),super.render(),super.girafeTranslate(),Z(this,ma).hide()}removeBookmark(t){const i=this.bookmarks.indexOf(t);i>=0&&this.bookmarks.splice(i,1),super.render(),super.girafeTranslate()}registerEvents(){this.stateManager.subscribe("position",(t,i)=>this.onPositionChanged(i))}onPositionChanged(t){if(!Z(this,Zr)){if(!t.isValid)return;console.log(t),Z(this,Jt)!==Z(this,Si).length-1&&Z(this,Si).splice(Z(this,Jt)+1),Z(this,Si).push(t),Ze(this,Jt,Z(this,Si).length-1)}}navigateBack(){let t=Z(this,Si)[Z(this,Jt)];Z(this,Jt)>0&&(yc(this,Jt)._--,t=Z(this,Si)[Z(this,Jt)],console.log("Navigating back to:",t)),this.navigateToPosition(t)}navigateForward(){let t=Z(this,Si)[Z(this,Jt)];Z(this,Jt)<Z(this,Si).length-1&&(yc(this,Jt)._++,t=Z(this,Si)[Z(this,Jt)],console.log("Navigating forward to:",t)),this.navigateToPosition(t)}navigateToPosition(t){Ze(this,Zr,!0);try{this.state.position=t}finally{Ze(this,Zr,!1)}}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}}ma=new WeakMap,Si=new WeakMap,Jt=new WeakMap,Zr=new WeakMap;customElements.define("girafe-nav-history",T2);var Kr,Jr;class R2 extends ot{constructor(){super("themelocationiconswitcher");_(this,"template",()=>xe`<style>
div.hidden {
  display: none;
}

.iconBtn {
  display: flex;
  align-items: center;
  justify-content: center;
  height:4.6rem;
  width:3.2rem;
  margin-left: 0.4rem;
  margin-right: 0.4rem;
}

ul {
  list-style-type: none;
  height: 4.6rem;
  margin-top: 0;
  background-color: var(--bkg-color-grad1);
  color: #fff;
  cursor: pointer;
  border-style: none;
  border-right: solid 1px #ffffff;
  border-left: solid 1px #ffffff;
  padding-inline-start: 0px;
}


ul div {
  float: left;
  width: 3.2rem;
  height: 4.6rem;
  cursor: pointer;
  border: none;
}

ul div:hover {
  background-color: var(--bkg-color-grad1);
}

ul div.hidden {
  display: none;
}

.ticon {
  display: flex;
  align-items: center;
  justify-content: center;
  max-height: 3.8rem;
  padding: 0.4rem;
}

ul div img {
  align-items: center !important;
  width: 1.8rem;
  max-height: 2rem;
}


li {
  float: left;
}

</style>
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />



<div class="${this.state.loading?"":"hidden"}">
  <i class="fa-2x fa-solid fa-circle-notch fa-spin"></i>
</div>


<ul id="themes">

  ${Object.values(this.favthemes??[]).map(t=>xe.for(t)`
  <div class="iconBtn" onmousedown="${()=>this.ignoreBlur()}"
    onclick="${()=>this.onThemeChanged(t)}">
    <div class="ticon">
      <img alt="${"Icon for "+t.name+t.id}"
        src="${t.icon}" />
    </div>

  </div>
  `)}
</ul>
`);se(this,Kr,void 0);se(this,Jr,!1);_(this,"favthemes",{})}get themesList(){if(!Z(this,Kr))throw new Error("You called themesList before render");return Z(this,Kr)}render(t=!1){super.render(),Ze(this,Kr,this.shadow.querySelector("#themes")),this.toggleThemesList(!1),t&&this.toggleThemesList(!0)}registerEvents(){this.state.themes,this.stateManager.subscribe("loading",t=>this.render(t)),this.stateManager.subscribe("themes",()=>{this.filterThemes(),this.render(),super.girafeTranslate()})}onBlur(){Z(this,Jr)||this.toggleThemesList(!1)}filterThemes(){for(let t of Object.values(this.state.themes))t.favorite==!0&&(this.favthemes[t.id]=t)}toggleThemesList(t=null){t===!0?this.themesList.style.display="block":t===!1?this.themesList.style.display="none":this.themesList.style.display==="none"?this.themesList.style.display="block":this.themesList.style.display="none"}ignoreBlur(){Ze(this,Jr,!0)}onThemeChanged(t){var i,s,r;this.state.selectedTheme=t,(t.location!=null||t.zoom!=null)&&((r=this.state.olMap)==null||r.getView().animate({center:t.location??((i=this.state.olMap)==null?void 0:i.getView().getCenter()),zoom:t.zoom??((s=this.state.olMap)==null?void 0:s.getView().getZoom()),duration:1e3})),this.toggleThemesList(!0),Ze(this,Jr,!1)}connectedCallback(){this.loadConfig().then(()=>{this.render(),this.registerEvents()})}}Kr=new WeakMap,Jr=new WeakMap;customElements.define("girafe-theme-favorites",R2);function L2(n){n("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),n("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),n("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),n.WGS84=n["EPSG:4326"],n["EPSG:3785"]=n["EPSG:3857"],n.GOOGLE=n["EPSG:3857"],n["EPSG:900913"]=n["EPSG:3857"],n["EPSG:102113"]=n["EPSG:3857"]}var $s=1,qs=2,Nr=3,I2=4,dd=5,Rm=6378137,P2=6356752314e-3,Lm=.0066943799901413165,Go=484813681109536e-20,F=Math.PI/2,A2=.16666666666666666,F2=.04722222222222222,O2=.022156084656084655,j=1e-10,Ct=.017453292519943295,on=57.29577951308232,ke=Math.PI/4,ia=Math.PI*2,rt=3.14159265359,oi={};oi.greenwich=0;oi.lisbon=-9.131906111111;oi.paris=2.337229166667;oi.bogota=-74.080916666667;oi.madrid=-3.687938888889;oi.rome=12.452333333333;oi.bern=7.439583333333;oi.jakarta=106.807719444444;oi.ferro=-17.666666666667;oi.brussels=4.367975;oi.stockholm=18.058277777778;oi.athens=23.7163375;oi.oslo=10.722916666667;const k2={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var Im=/[\s_\-\/\(\)]/g;function hs(n,e){if(n[e])return n[e];for(var t=Object.keys(n),i=e.toLowerCase().replace(Im,""),s=-1,r,o;++s<t.length;)if(r=t[s],o=r.toLowerCase().replace(Im,""),o===i)return n[r]}function fd(n){var e={},t=n.split("+").map(function(a){return a.trim()}).filter(function(a){return a}).reduce(function(a,l){var h=l.split("=");return h.push(!0),a[h[0].toLowerCase()]=h[1],a},{}),i,s,r,o={proj:"projName",datum:"datumCode",rf:function(a){e.rf=parseFloat(a)},lat_0:function(a){e.lat0=a*Ct},lat_1:function(a){e.lat1=a*Ct},lat_2:function(a){e.lat2=a*Ct},lat_ts:function(a){e.lat_ts=a*Ct},lon_0:function(a){e.long0=a*Ct},lon_1:function(a){e.long1=a*Ct},lon_2:function(a){e.long2=a*Ct},alpha:function(a){e.alpha=parseFloat(a)*Ct},gamma:function(a){e.rectified_grid_angle=parseFloat(a)},lonc:function(a){e.longc=a*Ct},x_0:function(a){e.x0=parseFloat(a)},y_0:function(a){e.y0=parseFloat(a)},k_0:function(a){e.k0=parseFloat(a)},k:function(a){e.k0=parseFloat(a)},a:function(a){e.a=parseFloat(a)},b:function(a){e.b=parseFloat(a)},r_a:function(){e.R_A=!0},zone:function(a){e.zone=parseInt(a,10)},south:function(){e.utmSouth=!0},towgs84:function(a){e.datum_params=a.split(",").map(function(l){return parseFloat(l)})},to_meter:function(a){e.to_meter=parseFloat(a)},units:function(a){e.units=a;var l=hs(k2,a);l&&(e.to_meter=l.to_meter)},from_greenwich:function(a){e.from_greenwich=a*Ct},pm:function(a){var l=hs(oi,a);e.from_greenwich=(l||parseFloat(a))*Ct},nadgrids:function(a){a==="@null"?e.datumCode="none":e.nadgrids=a},axis:function(a){var l="ewnsud";a.length===3&&l.indexOf(a.substr(0,1))!==-1&&l.indexOf(a.substr(1,1))!==-1&&l.indexOf(a.substr(2,1))!==-1&&(e.axis=a)},approx:function(){e.approx=!0}};for(i in t)s=t[i],i in o?(r=o[i],typeof r=="function"?r(s):e[r]=s):e[i]=s;return typeof e.datumCode=="string"&&e.datumCode!=="WGS84"&&(e.datumCode=e.datumCode.toLowerCase()),e}var na=1,fv=2,gv=3,wh=4,pv=5,vg=-1,N2=/\s/,D2=/[A-Za-z]/,G2=/[A-Za-z84_]/,gc=/[,\]]/,mv=/[\d\.E\-\+]/;function Fn(n){if(typeof n!="string")throw new Error("not a string");this.text=n.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=na}Fn.prototype.readCharicter=function(){var n=this.text[this.place++];if(this.state!==wh)for(;N2.test(n);){if(this.place>=this.text.length)return;n=this.text[this.place++]}switch(this.state){case na:return this.neutral(n);case fv:return this.keyword(n);case wh:return this.quoted(n);case pv:return this.afterquote(n);case gv:return this.number(n);case vg:return}};Fn.prototype.afterquote=function(n){if(n==='"'){this.word+='"',this.state=wh;return}if(gc.test(n)){this.word=this.word.trim(),this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in afterquote yet, index '+this.place)};Fn.prototype.afterItem=function(n){if(n===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=na;return}if(n==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=na,this.currentObject=this.stack.pop(),this.currentObject||(this.state=vg);return}};Fn.prototype.number=function(n){if(mv.test(n)){this.word+=n;return}if(gc.test(n)){this.word=parseFloat(this.word),this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in number yet, index '+this.place)};Fn.prototype.quoted=function(n){if(n==='"'){this.state=pv;return}this.word+=n};Fn.prototype.keyword=function(n){if(G2.test(n)){this.word+=n;return}if(n==="["){var e=[];e.push(this.word),this.level++,this.root===null?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,this.state=na;return}if(gc.test(n)){this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in keyword yet, index '+this.place)};Fn.prototype.neutral=function(n){if(D2.test(n)){this.word=n,this.state=fv;return}if(n==='"'){this.word="",this.state=wh;return}if(mv.test(n)){this.word=n,this.state=gv;return}if(gc.test(n)){this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in neutral yet, index '+this.place)};Fn.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===vg)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function z2(n){var e=new Fn(n);return e.output()}function Pm(n,e,t){Array.isArray(e)&&(t.unshift(e),e=null);var i=e?{}:n,s=t.reduce(function(r,o){return Cr(o,r),r},i);e&&(n[e]=s)}function Cr(n,e){if(!Array.isArray(n)){e[n]=!0;return}var t=n.shift();if(t==="PARAMETER"&&(t=n.shift()),n.length===1){if(Array.isArray(n[0])){e[t]={},Cr(n[0],e[t]);return}e[t]=n[0];return}if(!n.length){e[t]=!0;return}if(t==="TOWGS84"){e[t]=n;return}if(t==="AXIS"){t in e||(e[t]=[]),e[t].push(n);return}Array.isArray(t)||(e[t]={});var i;switch(t){case"UNIT":case"PRIMEM":case"VERT_DATUM":e[t]={name:n[0].toLowerCase(),convert:n[1]},n.length===3&&Cr(n[2],e[t]);return;case"SPHEROID":case"ELLIPSOID":e[t]={name:n[0],a:n[1],rf:n[2]},n.length===4&&Cr(n[3],e[t]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":n[0]=["name",n[0]],Pm(e,t,n);return;default:for(i=-1;++i<n.length;)if(!Array.isArray(n[i]))return Cr(n,e[t]);return Pm(e,t,n)}}var B2=.017453292519943295;function U2(n,e){var t=e[0],i=e[1];!(t in n)&&i in n&&(n[t]=n[i],e.length===3&&(n[t]=e[2](n[t])))}function Ki(n){return n*B2}function j2(n){if(n.type==="GEOGCS"?n.projName="longlat":n.type==="LOCAL_CS"?(n.projName="identity",n.local=!0):typeof n.PROJECTION=="object"?n.projName=Object.keys(n.PROJECTION)[0]:n.projName=n.PROJECTION,n.AXIS){for(var e="",t=0,i=n.AXIS.length;t<i;++t){var s=[n.AXIS[t][0].toLowerCase(),n.AXIS[t][1].toLowerCase()];s[0].indexOf("north")!==-1||(s[0]==="y"||s[0]==="lat")&&s[1]==="north"?e+="n":s[0].indexOf("south")!==-1||(s[0]==="y"||s[0]==="lat")&&s[1]==="south"?e+="s":s[0].indexOf("east")!==-1||(s[0]==="x"||s[0]==="lon")&&s[1]==="east"?e+="e":(s[0].indexOf("west")!==-1||(s[0]==="x"||s[0]==="lon")&&s[1]==="west")&&(e+="w")}e.length===2&&(e+="u"),e.length===3&&(n.axis=e)}n.UNIT&&(n.units=n.UNIT.name.toLowerCase(),n.units==="metre"&&(n.units="meter"),n.UNIT.convert&&(n.type==="GEOGCS"?n.DATUM&&n.DATUM.SPHEROID&&(n.to_meter=n.UNIT.convert*n.DATUM.SPHEROID.a):n.to_meter=n.UNIT.convert));var r=n.GEOGCS;n.type==="GEOGCS"&&(r=n),r&&(r.DATUM?n.datumCode=r.DATUM.name.toLowerCase():n.datumCode=r.name.toLowerCase(),n.datumCode.slice(0,2)==="d_"&&(n.datumCode=n.datumCode.slice(2)),(n.datumCode==="new_zealand_geodetic_datum_1949"||n.datumCode==="new_zealand_1949")&&(n.datumCode="nzgd49"),(n.datumCode==="wgs_1984"||n.datumCode==="world_geodetic_system_1984")&&(n.PROJECTION==="Mercator_Auxiliary_Sphere"&&(n.sphere=!0),n.datumCode="wgs84"),n.datumCode.slice(-6)==="_ferro"&&(n.datumCode=n.datumCode.slice(0,-6)),n.datumCode.slice(-8)==="_jakarta"&&(n.datumCode=n.datumCode.slice(0,-8)),~n.datumCode.indexOf("belge")&&(n.datumCode="rnb72"),r.DATUM&&r.DATUM.SPHEROID&&(n.ellps=r.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),n.ellps.toLowerCase().slice(0,13)==="international"&&(n.ellps="intl"),n.a=r.DATUM.SPHEROID.a,n.rf=parseFloat(r.DATUM.SPHEROID.rf,10)),r.DATUM&&r.DATUM.TOWGS84&&(n.datum_params=r.DATUM.TOWGS84),~n.datumCode.indexOf("osgb_1936")&&(n.datumCode="osgb36"),~n.datumCode.indexOf("osni_1952")&&(n.datumCode="osni52"),(~n.datumCode.indexOf("tm65")||~n.datumCode.indexOf("geodetic_datum_of_1965"))&&(n.datumCode="ire65"),n.datumCode==="ch1903+"&&(n.datumCode="ch1903"),~n.datumCode.indexOf("israel")&&(n.datumCode="isr93")),n.b&&!isFinite(n.b)&&(n.b=n.a);function o(h){var c=n.to_meter||1;return h*c}var a=function(h){return U2(n,h)},l=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Ki],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Ki],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",Ki],["lat0","latitude_of_origin",Ki],["lat0","standard_parallel_1",Ki],["lat1","standard_parallel_1",Ki],["lat2","standard_parallel_2",Ki],["azimuth","Azimuth"],["alpha","azimuth",Ki],["srsCode","name"]];l.forEach(a),!n.long0&&n.longc&&(n.projName==="Albers_Conic_Equal_Area"||n.projName==="Lambert_Azimuthal_Equal_Area")&&(n.long0=n.longc),!n.lat_ts&&n.lat1&&(n.projName==="Stereographic_South_Pole"||n.projName==="Polar Stereographic (variant B)")?(n.lat0=Ki(n.lat1>0?90:-90),n.lat_ts=n.lat1):!n.lat_ts&&n.lat0&&n.projName==="Polar_Stereographic"&&(n.lat_ts=n.lat0,n.lat0=Ki(n.lat0>0?90:-90))}function yv(n){var e=z2(n),t=e.shift(),i=e.shift();e.unshift(["name",i]),e.unshift(["type",t]);var s={};return Cr(e,s),j2(s),s}function Ut(n){var e=this;if(arguments.length===2){var t=arguments[1];typeof t=="string"?t.charAt(0)==="+"?Ut[n]=fd(arguments[1]):Ut[n]=yv(arguments[1]):Ut[n]=t}else if(arguments.length===1){if(Array.isArray(n))return n.map(function(i){Array.isArray(i)?Ut.apply(e,i):Ut(i)});if(typeof n=="string"){if(n in Ut)return Ut[n]}else"EPSG"in n?Ut["EPSG:"+n.EPSG]=n:"ESRI"in n?Ut["ESRI:"+n.ESRI]=n:"IAU2000"in n?Ut["IAU2000:"+n.IAU2000]=n:console.log(n);return}}L2(Ut);function $2(n){return typeof n=="string"}function q2(n){return n in Ut}var V2=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function W2(n){return V2.some(function(e){return n.indexOf(e)>-1})}var H2=["3857","900913","3785","102113"];function X2(n){var e=hs(n,"authority");if(e){var t=hs(e,"epsg");return t&&H2.indexOf(t)>-1}}function Y2(n){var e=hs(n,"extension");if(e)return hs(e,"proj4")}function Z2(n){return n[0]==="+"}function K2(n){if($2(n)){if(q2(n))return Ut[n];if(W2(n)){var e=yv(n);if(X2(e))return Ut["EPSG:3857"];var t=Y2(e);return t?fd(t):e}if(Z2(n))return fd(n)}else return n}function Am(n,e){n=n||{};var t,i;if(!e)return n;for(i in e)t=e[i],t!==void 0&&(n[i]=t);return n}function dn(n,e,t){var i=n*e;return t/Math.sqrt(1-i*i)}function Da(n){return n<0?-1:1}function q(n){return Math.abs(n)<=rt?n:n-Da(n)*ia}function qi(n,e,t){var i=n*t,s=.5*n;return i=Math.pow((1-i)/(1+i),s),Math.tan(.5*(F-e))/i}function sa(n,e){for(var t=.5*n,i,s,r=F-2*Math.atan(e),o=0;o<=15;o++)if(i=n*Math.sin(r),s=F-2*Math.atan(e*Math.pow((1-i)/(1+i),t))-r,r+=s,Math.abs(s)<=1e-10)return r;return-9999}function J2(){var n=this.b/this.a;this.es=1-n*n,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=dn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function Q2(n){var e=n.x,t=n.y;if(t*on>90&&t*on<-90&&e*on>180&&e*on<-180)return null;var i,s;if(Math.abs(Math.abs(t)-F)<=j)return null;if(this.sphere)i=this.x0+this.a*this.k0*q(e-this.long0),s=this.y0+this.a*this.k0*Math.log(Math.tan(ke+.5*t));else{var r=Math.sin(t),o=qi(this.e,t,r);i=this.x0+this.a*this.k0*q(e-this.long0),s=this.y0-this.a*this.k0*Math.log(o)}return n.x=i,n.y=s,n}function eP(n){var e=n.x-this.x0,t=n.y-this.y0,i,s;if(this.sphere)s=F-2*Math.atan(Math.exp(-t/(this.a*this.k0)));else{var r=Math.exp(-t/(this.a*this.k0));if(s=sa(this.e,r),s===-9999)return null}return i=q(this.long0+e/(this.a*this.k0)),n.x=i,n.y=s,n}var tP=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const iP={init:J2,forward:Q2,inverse:eP,names:tP};function nP(){}function Fm(n){return n}var sP=["longlat","identity"];const rP={init:nP,forward:Fm,inverse:Fm,names:sP};var oP=[iP,rP],Al={},bh=[];function _v(n,e){var t=bh.length;return n.names?(bh[t]=n,n.names.forEach(function(i){Al[i.toLowerCase()]=t}),this):(console.log(e),!0)}function aP(n){if(!n)return!1;var e=n.toLowerCase();if(typeof Al[e]<"u"&&bh[Al[e]])return bh[Al[e]]}function lP(){oP.forEach(_v)}const hP={start:lP,add:_v,get:aP};var oe={};oe.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};oe.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};oe.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};oe.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};oe.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};oe.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};oe.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};oe.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};oe.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};oe.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};oe.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};oe.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};oe.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};oe.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};oe.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};oe.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};oe.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};oe.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};oe.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};oe.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};oe.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};oe.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};oe.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};oe.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};oe.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};oe.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};oe.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};oe.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};oe.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};oe.hough={a:6378270,rf:297,ellipseName:"Hough"};oe.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};oe.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};oe.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};oe.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};oe.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};oe.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};oe.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};oe.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};oe.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};oe.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};oe.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};oe.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var cP=oe.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};oe.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function uP(n,e,t,i){var s=n*n,r=e*e,o=(s-r)/s,a=0;i?(n*=1-o*(A2+o*(F2+o*O2)),s=n*n,o=0):a=Math.sqrt(o);var l=(s-r)/r;return{es:o,e:a,ep2:l}}function dP(n,e,t,i,s){if(!n){var r=hs(oe,i);r||(r=cP),n=r.a,e=r.b,t=r.rf}return t&&!e&&(e=(1-1/t)*n),(t===0||Math.abs(n-e)<j)&&(s=!0,e=n),{a:n,b:e,rf:t,sphere:s}}var ut={};ut.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};ut.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};ut.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};ut.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};ut.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};ut.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};ut.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};ut.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};ut.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};ut.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};ut.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};ut.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};ut.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};ut.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};ut.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};ut.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};ut.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function fP(n,e,t,i,s,r,o){var a={};return n===void 0||n==="none"?a.datum_type=dd:a.datum_type=I2,e&&(a.datum_params=e.map(parseFloat),(a.datum_params[0]!==0||a.datum_params[1]!==0||a.datum_params[2]!==0)&&(a.datum_type=$s),a.datum_params.length>3&&(a.datum_params[3]!==0||a.datum_params[4]!==0||a.datum_params[5]!==0||a.datum_params[6]!==0)&&(a.datum_type=qs,a.datum_params[3]*=Go,a.datum_params[4]*=Go,a.datum_params[5]*=Go,a.datum_params[6]=a.datum_params[6]/1e6+1)),o&&(a.datum_type=Nr,a.grids=o),a.a=t,a.b=i,a.es=s,a.ep2=r,a}var vv={};function gP(n,e){var t=new DataView(e),i=yP(t),s=_P(t,i);s.nSubgrids>1&&console.log("Only single NTv2 subgrids are currently supported, subsequent sub grids are ignored");var r=vP(t,s,i),o={header:s,subgrids:r};return vv[n]=o,o}function pP(n){if(n===void 0)return null;var e=n.split(",");return e.map(mP)}function mP(n){if(n.length===0)return null;var e=n[0]==="@";return e&&(n=n.slice(1)),n==="null"?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:n,mandatory:!e,grid:vv[n]||null,isNull:!1}}function Mr(n){return n/3600*Math.PI/180}function yP(n){var e=n.getInt32(8,!1);return e===11?!1:(e=n.getInt32(8,!0),e!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function _P(n,e){return{nFields:n.getInt32(8,e),nSubgridFields:n.getInt32(24,e),nSubgrids:n.getInt32(40,e),shiftType:gd(n,56,56+8).trim(),fromSemiMajorAxis:n.getFloat64(120,e),fromSemiMinorAxis:n.getFloat64(136,e),toSemiMajorAxis:n.getFloat64(152,e),toSemiMinorAxis:n.getFloat64(168,e)}}function gd(n,e,t){return String.fromCharCode.apply(null,new Uint8Array(n.buffer.slice(e,t)))}function vP(n,e,t){for(var i=176,s=[],r=0;r<e.nSubgrids;r++){var o=wP(n,i,t),a=bP(n,i,o,t),l=Math.round(1+(o.upperLongitude-o.lowerLongitude)/o.longitudeInterval),h=Math.round(1+(o.upperLatitude-o.lowerLatitude)/o.latitudeInterval);s.push({ll:[Mr(o.lowerLongitude),Mr(o.lowerLatitude)],del:[Mr(o.longitudeInterval),Mr(o.latitudeInterval)],lim:[l,h],count:o.gridNodeCount,cvs:xP(a)})}return s}function xP(n){return n.map(function(e){return[Mr(e.longitudeShift),Mr(e.latitudeShift)]})}function wP(n,e,t){return{name:gd(n,e+8,e+16).trim(),parent:gd(n,e+24,e+24+8).trim(),lowerLatitude:n.getFloat64(e+72,t),upperLatitude:n.getFloat64(e+88,t),lowerLongitude:n.getFloat64(e+104,t),upperLongitude:n.getFloat64(e+120,t),latitudeInterval:n.getFloat64(e+136,t),longitudeInterval:n.getFloat64(e+152,t),gridNodeCount:n.getInt32(e+168,t)}}function bP(n,e,t,i){for(var s=e+176,r=16,o=[],a=0;a<t.gridNodeCount;a++){var l={latitudeShift:n.getFloat32(s+a*r,i),longitudeShift:n.getFloat32(s+a*r+4,i),latitudeAccuracy:n.getFloat32(s+a*r+8,i),longitudeAccuracy:n.getFloat32(s+a*r+12,i)};o.push(l)}return o}function un(n,e){if(!(this instanceof un))return new un(n);e=e||function(h){if(h)throw h};var t=K2(n);if(typeof t!="object"){e(n);return}var i=un.projections.get(t.projName);if(!i){e(n);return}if(t.datumCode&&t.datumCode!=="none"){var s=hs(ut,t.datumCode);s&&(t.datum_params=t.datum_params||(s.towgs84?s.towgs84.split(","):null),t.ellps=s.ellipse,t.datumName=s.datumName?s.datumName:t.datumCode)}t.k0=t.k0||1,t.axis=t.axis||"enu",t.ellps=t.ellps||"wgs84",t.lat1=t.lat1||t.lat0;var r=dP(t.a,t.b,t.rf,t.ellps,t.sphere),o=uP(r.a,r.b,r.rf,t.R_A),a=pP(t.nadgrids),l=t.datum||fP(t.datumCode,t.datum_params,r.a,r.b,o.es,o.ep2,a);Am(this,t),Am(this,i),this.a=r.a,this.b=r.b,this.rf=r.rf,this.sphere=r.sphere,this.es=o.es,this.e=o.e,this.ep2=o.ep2,this.datum=l,this.init(),e(null,this)}un.projections=hP;un.projections.start();function EP(n,e){return n.datum_type!==e.datum_type||n.a!==e.a||Math.abs(n.es-e.es)>5e-11?!1:n.datum_type===$s?n.datum_params[0]===e.datum_params[0]&&n.datum_params[1]===e.datum_params[1]&&n.datum_params[2]===e.datum_params[2]:n.datum_type===qs?n.datum_params[0]===e.datum_params[0]&&n.datum_params[1]===e.datum_params[1]&&n.datum_params[2]===e.datum_params[2]&&n.datum_params[3]===e.datum_params[3]&&n.datum_params[4]===e.datum_params[4]&&n.datum_params[5]===e.datum_params[5]&&n.datum_params[6]===e.datum_params[6]:!0}function xv(n,e,t){var i=n.x,s=n.y,r=n.z?n.z:0,o,a,l,h;if(s<-F&&s>-1.001*F)s=-F;else if(s>F&&s<1.001*F)s=F;else{if(s<-F)return{x:-1/0,y:-1/0,z:n.z};if(s>F)return{x:1/0,y:1/0,z:n.z}}return i>Math.PI&&(i-=2*Math.PI),a=Math.sin(s),h=Math.cos(s),l=a*a,o=t/Math.sqrt(1-e*l),{x:(o+r)*h*Math.cos(i),y:(o+r)*h*Math.sin(i),z:(o*(1-e)+r)*a}}function wv(n,e,t,i){var s=1e-12,r=s*s,o=30,a,l,h,c,u,d,f,g,p,m,v,y,x,w=n.x,b=n.y,E=n.z?n.z:0,C,M,R;if(a=Math.sqrt(w*w+b*b),l=Math.sqrt(w*w+b*b+E*E),a/t<s){if(C=0,l/t<s)return M=F,R=-i,{x:n.x,y:n.y,z:n.z}}else C=Math.atan2(b,w);h=E/l,c=a/l,u=1/Math.sqrt(1-e*(2-e)*c*c),g=c*(1-e)*u,p=h*u,x=0;do x++,f=t/Math.sqrt(1-e*p*p),R=a*g+E*p-f*(1-e*p*p),d=e*f/(f+R),u=1/Math.sqrt(1-d*(2-d)*c*c),m=c*(1-d)*u,v=h*u,y=v*g-m*p,g=m,p=v;while(y*y>r&&x<o);return M=Math.atan(v/Math.abs(m)),{x:C,y:M,z:R}}function CP(n,e,t){if(e===$s)return{x:n.x+t[0],y:n.y+t[1],z:n.z+t[2]};if(e===qs){var i=t[0],s=t[1],r=t[2],o=t[3],a=t[4],l=t[5],h=t[6];return{x:h*(n.x-l*n.y+a*n.z)+i,y:h*(l*n.x+n.y-o*n.z)+s,z:h*(-a*n.x+o*n.y+n.z)+r}}}function MP(n,e,t){if(e===$s)return{x:n.x-t[0],y:n.y-t[1],z:n.z-t[2]};if(e===qs){var i=t[0],s=t[1],r=t[2],o=t[3],a=t[4],l=t[5],h=t[6],c=(n.x-i)/h,u=(n.y-s)/h,d=(n.z-r)/h;return{x:c+l*u-a*d,y:-l*c+u+o*d,z:a*c-o*u+d}}}function Cl(n){return n===$s||n===qs}function SP(n,e,t){if(EP(n,e)||n.datum_type===dd||e.datum_type===dd)return t;var i=n.a,s=n.es;if(n.datum_type===Nr){var r=Om(n,!1,t);if(r!==0)return;i=Rm,s=Lm}var o=e.a,a=e.b,l=e.es;if(e.datum_type===Nr&&(o=Rm,a=P2,l=Lm),s===l&&i===o&&!Cl(n.datum_type)&&!Cl(e.datum_type))return t;if(t=xv(t,s,i),Cl(n.datum_type)&&(t=CP(t,n.datum_type,n.datum_params)),Cl(e.datum_type)&&(t=MP(t,e.datum_type,e.datum_params)),t=wv(t,l,o,a),e.datum_type===Nr){var h=Om(e,!0,t);if(h!==0)return}return t}function Om(n,e,t){if(n.grids===null||n.grids.length===0)return console.log("Grid shift grids not found"),-1;for(var i={x:-t.x,y:t.y},s={x:Number.NaN,y:Number.NaN},r=[],o=0;o<n.grids.length;o++){var a=n.grids[o];if(r.push(a.name),a.isNull){s=i;break}if(a.mandatory,a.grid===null){if(a.mandatory)return console.log("Unable to find mandatory grid '"+a.name+"'"),-1;continue}var l=a.grid.subgrids[0],h=(Math.abs(l.del[1])+Math.abs(l.del[0]))/1e4,c=l.ll[0]-h,u=l.ll[1]-h,d=l.ll[0]+(l.lim[0]-1)*l.del[0]+h,f=l.ll[1]+(l.lim[1]-1)*l.del[1]+h;if(!(u>i.y||c>i.x||f<i.y||d<i.x)&&(s=TP(i,e,l),!isNaN(s.x)))break}return isNaN(s.x)?(console.log("Failed to find a grid shift table for location '"+-i.x*on+" "+i.y*on+" tried: '"+r+"'"),-1):(t.x=-s.x,t.y=s.y,0)}function TP(n,e,t){var i={x:Number.NaN,y:Number.NaN};if(isNaN(n.x))return i;var s={x:n.x,y:n.y};s.x-=t.ll[0],s.y-=t.ll[1],s.x=q(s.x-Math.PI)+Math.PI;var r=km(s,t);if(e){if(isNaN(r.x))return i;r.x=s.x-r.x,r.y=s.y-r.y;var o=9,a=1e-12,l,h;do{if(h=km(r,t),isNaN(h.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}l={x:s.x-(h.x+r.x),y:s.y-(h.y+r.y)},r.x+=l.x,r.y+=l.y}while(o--&&Math.abs(l.x)>a&&Math.abs(l.y)>a);if(o<0)return console.log("Inverse grid shift iterator failed to converge."),i;i.x=q(r.x+t.ll[0]),i.y=r.y+t.ll[1]}else isNaN(r.x)||(i.x=n.x+r.x,i.y=n.y+r.y);return i}function km(n,e){var t={x:n.x/e.del[0],y:n.y/e.del[1]},i={x:Math.floor(t.x),y:Math.floor(t.y)},s={x:t.x-1*i.x,y:t.y-1*i.y},r={x:Number.NaN,y:Number.NaN},o;if(i.x<0||i.x>=e.lim[0]||i.y<0||i.y>=e.lim[1])return r;o=i.y*e.lim[0]+i.x;var a={x:e.cvs[o][0],y:e.cvs[o][1]};o++;var l={x:e.cvs[o][0],y:e.cvs[o][1]};o+=e.lim[0];var h={x:e.cvs[o][0],y:e.cvs[o][1]};o--;var c={x:e.cvs[o][0],y:e.cvs[o][1]},u=s.x*s.y,d=s.x*(1-s.y),f=(1-s.x)*(1-s.y),g=(1-s.x)*s.y;return r.x=f*a.x+d*l.x+g*c.x+u*h.x,r.y=f*a.y+d*l.y+g*c.y+u*h.y,r}function Nm(n,e,t){var i=t.x,s=t.y,r=t.z||0,o,a,l,h={};for(l=0;l<3;l++)if(!(e&&l===2&&t.z===void 0))switch(l===0?(o=i,"ew".indexOf(n.axis[l])!==-1?a="x":a="y"):l===1?(o=s,"ns".indexOf(n.axis[l])!==-1?a="y":a="x"):(o=r,a="z"),n.axis[l]){case"e":h[a]=o;break;case"w":h[a]=-o;break;case"n":h[a]=o;break;case"s":h[a]=-o;break;case"u":t[a]!==void 0&&(h.z=o);break;case"d":t[a]!==void 0&&(h.z=-o);break;default:return null}return h}function bv(n){var e={x:n[0],y:n[1]};return n.length>2&&(e.z=n[2]),n.length>3&&(e.m=n[3]),e}function RP(n){Dm(n.x),Dm(n.y)}function Dm(n){if(typeof Number.isFinite=="function"){if(Number.isFinite(n))return;throw new TypeError("coordinates must be finite numbers")}if(typeof n!="number"||n!==n||!isFinite(n))throw new TypeError("coordinates must be finite numbers")}function LP(n,e){return(n.datum.datum_type===$s||n.datum.datum_type===qs||n.datum.datum_type===Nr)&&e.datumCode!=="WGS84"||(e.datum.datum_type===$s||e.datum.datum_type===qs||e.datum.datum_type===Nr)&&n.datumCode!=="WGS84"}function Eh(n,e,t,i){var s;Array.isArray(t)?t=bv(t):t={x:t.x,y:t.y,z:t.z,m:t.m};var r=t.z!==void 0;if(RP(t),n.datum&&e.datum&&LP(n,e)&&(s=new un("WGS84"),t=Eh(n,s,t,i),n=s),i&&n.axis!=="enu"&&(t=Nm(n,!1,t)),n.projName==="longlat")t={x:t.x*Ct,y:t.y*Ct,z:t.z||0};else if(n.to_meter&&(t={x:t.x*n.to_meter,y:t.y*n.to_meter,z:t.z||0}),t=n.inverse(t),!t)return;if(n.from_greenwich&&(t.x+=n.from_greenwich),t=SP(n.datum,e.datum,t),!!t)return e.from_greenwich&&(t={x:t.x-e.from_greenwich,y:t.y,z:t.z||0}),e.projName==="longlat"?t={x:t.x*on,y:t.y*on,z:t.z||0}:(t=e.forward(t),e.to_meter&&(t={x:t.x/e.to_meter,y:t.y/e.to_meter,z:t.z||0})),i&&e.axis!=="enu"?Nm(e,!0,t):(t&&!r&&delete t.z,t)}var Gm=un("WGS84");function au(n,e,t,i){var s,r,o;return Array.isArray(t)?(s=Eh(n,e,t,i)||{x:NaN,y:NaN},t.length>2?typeof n.name<"u"&&n.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"?typeof s.z=="number"?[s.x,s.y,s.z].concat(t.splice(3)):[s.x,s.y,t[2]].concat(t.splice(3)):[s.x,s.y].concat(t.splice(2)):[s.x,s.y]):(r=Eh(n,e,t,i),o=Object.keys(t),o.length===2||o.forEach(function(a){if(typeof n.name<"u"&&n.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"){if(a==="x"||a==="y"||a==="z")return}else if(a==="x"||a==="y")return;r[a]=t[a]}),r)}function zm(n){return n instanceof un?n:n.oProj?n.oProj:un(n)}function Yt(n,e,t){n=zm(n);var i=!1,s;return typeof e>"u"?(e=n,n=Gm,i=!0):(typeof e.x<"u"||Array.isArray(e))&&(t=e,e=n,n=Gm,i=!0),e=zm(e),t?au(n,e,t):(s={forward:function(r,o){return au(n,e,r,o)},inverse:function(r,o){return au(e,n,r,o)}},i&&(s.oProj=e),s)}var Bm=6,Ev="AJSAJS",Cv="AFAFAF",Sr=65,Kt=73,Ci=79,Io=86,Po=90;const IP={forward:Mv,inverse:PP,toPoint:Sv};function Mv(n,e){return e=e||5,OP(AP({lat:n[1],lon:n[0]}),e)}function PP(n){var e=xg(Rv(n.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]}function Sv(n){var e=xg(Rv(n.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function lu(n){return n*(Math.PI/180)}function Um(n){return 180*(n/Math.PI)}function AP(n){var e=n.lat,t=n.lon,i=6378137,s=.00669438,r=.9996,o,a,l,h,c,u,d,f=lu(e),g=lu(t),p,m;m=Math.floor((t+180)/6)+1,t===180&&(m=60),e>=56&&e<64&&t>=3&&t<12&&(m=32),e>=72&&e<84&&(t>=0&&t<9?m=31:t>=9&&t<21?m=33:t>=21&&t<33?m=35:t>=33&&t<42&&(m=37)),o=(m-1)*6-180+3,p=lu(o),a=s/(1-s),l=i/Math.sqrt(1-s*Math.sin(f)*Math.sin(f)),h=Math.tan(f)*Math.tan(f),c=a*Math.cos(f)*Math.cos(f),u=Math.cos(f)*(g-p),d=i*((1-s/4-3*s*s/64-5*s*s*s/256)*f-(3*s/8+3*s*s/32+45*s*s*s/1024)*Math.sin(2*f)+(15*s*s/256+45*s*s*s/1024)*Math.sin(4*f)-35*s*s*s/3072*Math.sin(6*f));var v=r*l*(u+(1-h+c)*u*u*u/6+(5-18*h+h*h+72*c-58*a)*u*u*u*u*u/120)+5e5,y=r*(d+l*Math.tan(f)*(u*u/2+(5-h+9*c+4*c*c)*u*u*u*u/24+(61-58*h+h*h+600*c-330*a)*u*u*u*u*u*u/720));return e<0&&(y+=1e7),{northing:Math.round(y),easting:Math.round(v),zoneNumber:m,zoneLetter:FP(e)}}function xg(n){var e=n.northing,t=n.easting,i=n.zoneLetter,s=n.zoneNumber;if(s<0||s>60)return null;var r=.9996,o=6378137,a=.00669438,l,h=(1-Math.sqrt(1-a))/(1+Math.sqrt(1-a)),c,u,d,f,g,p,m,v,y,x=t-5e5,w=e;i<"N"&&(w-=1e7),m=(s-1)*6-180+3,l=a/(1-a),p=w/r,v=p/(o*(1-a/4-3*a*a/64-5*a*a*a/256)),y=v+(3*h/2-27*h*h*h/32)*Math.sin(2*v)+(21*h*h/16-55*h*h*h*h/32)*Math.sin(4*v)+151*h*h*h/96*Math.sin(6*v),c=o/Math.sqrt(1-a*Math.sin(y)*Math.sin(y)),u=Math.tan(y)*Math.tan(y),d=l*Math.cos(y)*Math.cos(y),f=o*(1-a)/Math.pow(1-a*Math.sin(y)*Math.sin(y),1.5),g=x/(c*r);var b=y-c*Math.tan(y)/f*(g*g/2-(5+3*u+10*d-4*d*d-9*l)*g*g*g*g/24+(61+90*u+298*d+45*u*u-252*l-3*d*d)*g*g*g*g*g*g/720);b=Um(b);var E=(g-(1+2*u+d)*g*g*g/6+(5-2*d+28*u-3*d*d+8*l+24*u*u)*g*g*g*g*g/120)/Math.cos(y);E=m+Um(E);var C;if(n.accuracy){var M=xg({northing:n.northing+n.accuracy,easting:n.easting+n.accuracy,zoneLetter:n.zoneLetter,zoneNumber:n.zoneNumber});C={top:M.lat,right:M.lon,bottom:b,left:E}}else C={lat:b,lon:E};return C}function FP(n){var e="Z";return 84>=n&&n>=72?e="X":72>n&&n>=64?e="W":64>n&&n>=56?e="V":56>n&&n>=48?e="U":48>n&&n>=40?e="T":40>n&&n>=32?e="S":32>n&&n>=24?e="R":24>n&&n>=16?e="Q":16>n&&n>=8?e="P":8>n&&n>=0?e="N":0>n&&n>=-8?e="M":-8>n&&n>=-16?e="L":-16>n&&n>=-24?e="K":-24>n&&n>=-32?e="J":-32>n&&n>=-40?e="H":-40>n&&n>=-48?e="G":-48>n&&n>=-56?e="F":-56>n&&n>=-64?e="E":-64>n&&n>=-72?e="D":-72>n&&n>=-80&&(e="C"),e}function OP(n,e){var t="00000"+n.easting,i="00000"+n.northing;return n.zoneNumber+n.zoneLetter+kP(n.easting,n.northing,n.zoneNumber)+t.substr(t.length-5,e)+i.substr(i.length-5,e)}function kP(n,e,t){var i=Tv(t),s=Math.floor(n/1e5),r=Math.floor(e/1e5)%20;return NP(s,r,i)}function Tv(n){var e=n%Bm;return e===0&&(e=Bm),e}function NP(n,e,t){var i=t-1,s=Ev.charCodeAt(i),r=Cv.charCodeAt(i),o=s+n-1,a=r+e,l=!1;o>Po&&(o=o-Po+Sr-1,l=!0),(o===Kt||s<Kt&&o>Kt||(o>Kt||s<Kt)&&l)&&o++,(o===Ci||s<Ci&&o>Ci||(o>Ci||s<Ci)&&l)&&(o++,o===Kt&&o++),o>Po&&(o=o-Po+Sr-1),a>Io?(a=a-Io+Sr-1,l=!0):l=!1,(a===Kt||r<Kt&&a>Kt||(a>Kt||r<Kt)&&l)&&a++,(a===Ci||r<Ci&&a>Ci||(a>Ci||r<Ci)&&l)&&(a++,a===Kt&&a++),a>Io&&(a=a-Io+Sr-1);var h=String.fromCharCode(o)+String.fromCharCode(a);return h}function Rv(n){if(n&&n.length===0)throw"MGRSPoint coverting from nothing";for(var e=n.length,t=null,i="",s,r=0;!/[A-Z]/.test(s=n.charAt(r));){if(r>=2)throw"MGRSPoint bad conversion from: "+n;i+=s,r++}var o=parseInt(i,10);if(r===0||r+3>e)throw"MGRSPoint bad conversion from: "+n;var a=n.charAt(r++);if(a<="A"||a==="B"||a==="Y"||a>="Z"||a==="I"||a==="O")throw"MGRSPoint zone letter "+a+" not handled: "+n;t=n.substring(r,r+=2);for(var l=Tv(o),h=DP(t.charAt(0),l),c=GP(t.charAt(1),l);c<zP(a);)c+=2e6;var u=e-r;if(u%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+n;var d=u/2,f=0,g=0,p,m,v,y,x;return d>0&&(p=1e5/Math.pow(10,d),m=n.substring(r,r+d),f=parseFloat(m)*p,v=n.substring(r+d),g=parseFloat(v)*p),y=f+h,x=g+c,{easting:y,northing:x,zoneLetter:a,zoneNumber:o,accuracy:p}}function DP(n,e){for(var t=Ev.charCodeAt(e-1),i=1e5,s=!1;t!==n.charCodeAt(0);){if(t++,t===Kt&&t++,t===Ci&&t++,t>Po){if(s)throw"Bad character: "+n;t=Sr,s=!0}i+=1e5}return i}function GP(n,e){if(n>"V")throw"MGRSPoint given invalid Northing "+n;for(var t=Cv.charCodeAt(e-1),i=0,s=!1;t!==n.charCodeAt(0);){if(t++,t===Kt&&t++,t===Ci&&t++,t>Io){if(s)throw"Bad character: "+n;t=Sr,s=!0}i+=1e5}return i}function zP(n){var e;switch(n){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+n}function ho(n,e,t){if(!(this instanceof ho))return new ho(n,e,t);if(Array.isArray(n))this.x=n[0],this.y=n[1],this.z=n[2]||0;else if(typeof n=="object")this.x=n.x,this.y=n.y,this.z=n.z||0;else if(typeof n=="string"&&typeof e>"u"){var i=n.split(",");this.x=parseFloat(i[0],10),this.y=parseFloat(i[1],10),this.z=parseFloat(i[2],10)||0}else this.x=n,this.y=e,this.z=t||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}ho.fromMGRS=function(n){return new ho(Sv(n))};ho.prototype.toMGRS=function(n){return Mv([this.x,this.y],n)};var BP=1,UP=.25,jm=.046875,$m=.01953125,qm=.01068115234375,jP=.75,$P=.46875,qP=.013020833333333334,VP=.007120768229166667,WP=.3645833333333333,HP=.005696614583333333,XP=.3076171875;function Lv(n){var e=[];e[0]=BP-n*(UP+n*(jm+n*($m+n*qm))),e[1]=n*(jP-n*(jm+n*($m+n*qm)));var t=n*n;return e[2]=t*($P-n*(qP+n*VP)),t*=n,e[3]=t*(WP-n*HP),e[4]=t*n*XP,e}function pc(n,e,t,i){return t*=e,e*=e,i[0]*n-t*(i[1]+e*(i[2]+e*(i[3]+e*i[4])))}var YP=20;function Iv(n,e,t){for(var i=1/(1-e),s=n,r=YP;r;--r){var o=Math.sin(s),a=1-e*o*o;if(a=(pc(s,o,Math.cos(s),t)-n)*(a*Math.sqrt(a))*i,s-=a,Math.abs(a)<j)return s}return s}function ZP(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=Lv(this.es),this.ml0=pc(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function KP(n){var e=n.x,t=n.y,i=q(e-this.long0),s,r,o,a=Math.sin(t),l=Math.cos(t);if(this.es){var c=l*i,u=Math.pow(c,2),d=this.ep2*Math.pow(l,2),f=Math.pow(d,2),g=Math.abs(l)>j?Math.tan(t):0,p=Math.pow(g,2),m=Math.pow(p,2);s=1-this.es*Math.pow(a,2),c=c/Math.sqrt(s);var v=pc(t,a,l,this.en);r=this.a*(this.k0*c*(1+u/6*(1-p+d+u/20*(5-18*p+m+14*d-58*p*d+u/42*(61+179*m-m*p-479*p)))))+this.x0,o=this.a*(this.k0*(v-this.ml0+a*i*c/2*(1+u/12*(5-p+9*d+4*f+u/30*(61+m-58*p+270*d-330*p*d+u/56*(1385+543*m-m*p-3111*p))))))+this.y0}else{var h=l*Math.sin(i);if(Math.abs(Math.abs(h)-1)<j)return 93;if(r=.5*this.a*this.k0*Math.log((1+h)/(1-h))+this.x0,o=l*Math.cos(i)/Math.sqrt(1-Math.pow(h,2)),h=Math.abs(o),h>=1){if(h-1>j)return 93;o=0}else o=Math.acos(o);t<0&&(o=-o),o=this.a*this.k0*(o-this.lat0)+this.y0}return n.x=r,n.y=o,n}function JP(n){var e,t,i,s,r=(n.x-this.x0)*(1/this.a),o=(n.y-this.y0)*(1/this.a);if(this.es)if(e=this.ml0+o/this.k0,t=Iv(e,this.es,this.en),Math.abs(t)<F){var u=Math.sin(t),d=Math.cos(t),f=Math.abs(d)>j?Math.tan(t):0,g=this.ep2*Math.pow(d,2),p=Math.pow(g,2),m=Math.pow(f,2),v=Math.pow(m,2);e=1-this.es*Math.pow(u,2);var y=r*Math.sqrt(e)/this.k0,x=Math.pow(y,2);e=e*f,i=t-e*x/(1-this.es)*.5*(1-x/12*(5+3*m-9*g*m+g-4*p-x/30*(61+90*m-252*g*m+45*v+46*g-x/56*(1385+3633*m+4095*v+1574*v*m)))),s=q(this.long0+y*(1-x/6*(1+2*m+g-x/20*(5+28*m+24*v+8*g*m+6*g-x/42*(61+662*m+1320*v+720*v*m))))/d)}else i=F*Da(o),s=0;else{var a=Math.exp(r/this.k0),l=.5*(a-1/a),h=this.lat0+o/this.k0,c=Math.cos(h);e=Math.sqrt((1-Math.pow(c,2))/(1+Math.pow(l,2))),i=Math.asin(e),o<0&&(i=-i),l===0&&c===0?s=0:s=q(Math.atan2(l,c)+this.long0)}return n.x=s,n.y=i,n}var QP=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const Fl={init:ZP,forward:KP,inverse:JP,names:QP};function Pv(n){var e=Math.exp(n);return e=(e-1/e)/2,e}function ji(n,e){n=Math.abs(n),e=Math.abs(e);var t=Math.max(n,e),i=Math.min(n,e)/(t||1);return t*Math.sqrt(1+Math.pow(i,2))}function eA(n){var e=1+n,t=e-1;return t===0?n:n*Math.log(e)/t}function tA(n){var e=Math.abs(n);return e=eA(e*(1+e/(ji(1,e)+1))),n<0?-e:e}function wg(n,e){for(var t=2*Math.cos(2*e),i=n.length-1,s=n[i],r=0,o;--i>=0;)o=-r+t*s+n[i],r=s,s=o;return e+o*Math.sin(2*e)}function iA(n,e){for(var t=2*Math.cos(e),i=n.length-1,s=n[i],r=0,o;--i>=0;)o=-r+t*s+n[i],r=s,s=o;return Math.sin(e)*o}function nA(n){var e=Math.exp(n);return e=(e+1/e)/2,e}function Av(n,e,t){for(var i=Math.sin(e),s=Math.cos(e),r=Pv(t),o=nA(t),a=2*s*o,l=-2*i*r,h=n.length-1,c=n[h],u=0,d=0,f=0,g,p;--h>=0;)g=d,p=u,d=c,u=f,c=-g+a*d-l*u+n[h],f=-p+l*d+a*u;return a=i*o,l=s*r,[a*c-l*f,a*f+l*c]}function sA(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Fl.init.apply(this),this.forward=Fl.forward,this.inverse=Fl.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var n=this.es/(1+Math.sqrt(1-this.es)),e=n/(2-n),t=e;this.cgb[0]=e*(2+e*(-2/3+e*(-2+e*(116/45+e*(26/45+e*(-2854/675)))))),this.cbg[0]=e*(-2+e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))),t=t*e,this.cgb[1]=t*(7/3+e*(-8/5+e*(-227/45+e*(2704/315+e*(2323/945))))),this.cbg[1]=t*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),t=t*e,this.cgb[2]=t*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=t*(-26/15+e*(34/21+e*(8/5+e*(-12686/2835)))),t=t*e,this.cgb[3]=t*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=t*(1237/630+e*(-12/5+e*(-24832/14175))),t=t*e,this.cgb[4]=t*(4174/315+e*(-144838/6237)),this.cbg[4]=t*(-734/315+e*(109598/31185)),t=t*e,this.cgb[5]=t*(601676/22275),this.cbg[5]=t*(444337/155925),t=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+t*(1/4+t*(1/64+t/256))),this.utg[0]=e*(-.5+e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=t*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=t*(13/48+e*(-3/5+e*(557/1440+e*(281/630+e*(-1983433/1935360))))),t=t*e,this.utg[2]=t*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=t*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),t=t*e,this.utg[3]=t*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=t*(49561/161280+e*(-179/168+e*(6601661/7257600))),t=t*e,this.utg[4]=t*(-4583/161280+e*(108847/3991680)),this.gtu[4]=t*(34729/80640+e*(-3418889/1995840)),t=t*e,this.utg[5]=t*(-20648693/638668800),this.gtu[5]=t*(212378941/319334400);var i=wg(this.cbg,this.lat0);this.Zb=-this.Qn*(i+iA(this.gtu,2*i))}function rA(n){var e=q(n.x-this.long0),t=n.y;t=wg(this.cbg,t);var i=Math.sin(t),s=Math.cos(t),r=Math.sin(e),o=Math.cos(e);t=Math.atan2(i,o*s),e=Math.atan2(r*s,ji(i,s*o)),e=tA(Math.tan(e));var a=Av(this.gtu,2*t,2*e);t=t+a[0],e=e+a[1];var l,h;return Math.abs(e)<=2.623395162778?(l=this.a*(this.Qn*e)+this.x0,h=this.a*(this.Qn*t+this.Zb)+this.y0):(l=1/0,h=1/0),n.x=l,n.y=h,n}function oA(n){var e=(n.x-this.x0)*(1/this.a),t=(n.y-this.y0)*(1/this.a);t=(t-this.Zb)/this.Qn,e=e/this.Qn;var i,s;if(Math.abs(e)<=2.623395162778){var r=Av(this.utg,2*t,2*e);t=t+r[0],e=e+r[1],e=Math.atan(Pv(e));var o=Math.sin(t),a=Math.cos(t),l=Math.sin(e),h=Math.cos(e);t=Math.atan2(o*h,ji(l,h*a)),e=Math.atan2(l,h*a),i=q(e+this.long0),s=wg(this.cgb,t)}else i=1/0,s=1/0;return n.x=i,n.y=s,n}var aA=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"];const Ol={init:sA,forward:rA,inverse:oA,names:aA};function lA(n,e){if(n===void 0){if(n=Math.floor((q(e)+Math.PI)*30/Math.PI)+1,n<0)return 0;if(n>60)return 60}return n}var hA="etmerc";function cA(){var n=lA(this.zone,this.long0);if(n===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(n)-183)*Ct,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Ol.init.apply(this),this.forward=Ol.forward,this.inverse=Ol.inverse}var uA=["Universal Transverse Mercator System","utm"];const dA={init:cA,names:uA,dependsOn:hA};function bg(n,e){return Math.pow((1-n)/(1+n),e)}var fA=20;function gA(){var n=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*n*n),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(n/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+ke)/(Math.pow(Math.tan(.5*this.lat0+ke),this.C)*bg(this.e*n,this.ratexp))}function pA(n){var e=n.x,t=n.y;return n.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*t+ke),this.C)*bg(this.e*Math.sin(t),this.ratexp))-F,n.x=this.C*e,n}function mA(n){for(var e=1e-14,t=n.x/this.C,i=n.y,s=Math.pow(Math.tan(.5*i+ke)/this.K,1/this.C),r=fA;r>0&&(i=2*Math.atan(s*bg(this.e*Math.sin(n.y),-.5*this.e))-F,!(Math.abs(i-n.y)<e));--r)n.y=i;return r?(n.x=t,n.y=i,n):null}var yA=["gauss"];const Eg={init:gA,forward:pA,inverse:mA,names:yA};function _A(){Eg.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function vA(n){var e,t,i,s;return n.x=q(n.x-this.long0),Eg.forward.apply(this,[n]),e=Math.sin(n.y),t=Math.cos(n.y),i=Math.cos(n.x),s=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*t*i),n.x=s*t*Math.sin(n.x),n.y=s*(this.cosc0*e-this.sinc0*t*i),n.x=this.a*n.x+this.x0,n.y=this.a*n.y+this.y0,n}function xA(n){var e,t,i,s,r;if(n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,n.x/=this.k0,n.y/=this.k0,r=Math.sqrt(n.x*n.x+n.y*n.y)){var o=2*Math.atan2(r,this.R2);e=Math.sin(o),t=Math.cos(o),s=Math.asin(t*this.sinc0+n.y*e*this.cosc0/r),i=Math.atan2(n.x*e,r*this.cosc0*t-n.y*this.sinc0*e)}else s=this.phic0,i=0;return n.x=i,n.y=s,Eg.inverse.apply(this,[n]),n.x=q(n.x+this.long0),n}var wA=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const bA={init:_A,forward:vA,inverse:xA,names:wA};function EA(n,e,t){return e*=t,Math.tan(.5*(F+n))*Math.pow((1-e)/(1+e),.5*t)}function CA(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=j&&(this.k0=.5*(1+Da(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=j&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=j&&Math.abs(Math.cos(this.lat_ts))>j&&(this.k0=.5*this.cons*dn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/qi(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=dn(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-F,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function MA(n){var e=n.x,t=n.y,i=Math.sin(t),s=Math.cos(t),r,o,a,l,h,c,u=q(e-this.long0);return Math.abs(Math.abs(e-this.long0)-Math.PI)<=j&&Math.abs(t+this.lat0)<=j?(n.x=NaN,n.y=NaN,n):this.sphere?(r=2*this.k0/(1+this.sinlat0*i+this.coslat0*s*Math.cos(u)),n.x=this.a*r*s*Math.sin(u)+this.x0,n.y=this.a*r*(this.coslat0*i-this.sinlat0*s*Math.cos(u))+this.y0,n):(o=2*Math.atan(this.ssfn_(t,i,this.e))-F,l=Math.cos(o),a=Math.sin(o),Math.abs(this.coslat0)<=j?(h=qi(this.e,t*this.con,this.con*i),c=2*this.a*this.k0*h/this.cons,n.x=this.x0+c*Math.sin(e-this.long0),n.y=this.y0-this.con*c*Math.cos(e-this.long0),n):(Math.abs(this.sinlat0)<j?(r=2*this.a*this.k0/(1+l*Math.cos(u)),n.y=r*a):(r=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*a+this.cosX0*l*Math.cos(u))),n.y=r*(this.cosX0*a-this.sinX0*l*Math.cos(u))+this.y0),n.x=r*l*Math.sin(u)+this.x0,n))}function SA(n){n.x-=this.x0,n.y-=this.y0;var e,t,i,s,r,o=Math.sqrt(n.x*n.x+n.y*n.y);if(this.sphere){var a=2*Math.atan(o/(2*this.a*this.k0));return e=this.long0,t=this.lat0,o<=j?(n.x=e,n.y=t,n):(t=Math.asin(Math.cos(a)*this.sinlat0+n.y*Math.sin(a)*this.coslat0/o),Math.abs(this.coslat0)<j?this.lat0>0?e=q(this.long0+Math.atan2(n.x,-1*n.y)):e=q(this.long0+Math.atan2(n.x,n.y)):e=q(this.long0+Math.atan2(n.x*Math.sin(a),o*this.coslat0*Math.cos(a)-n.y*this.sinlat0*Math.sin(a))),n.x=e,n.y=t,n)}else if(Math.abs(this.coslat0)<=j){if(o<=j)return t=this.lat0,e=this.long0,n.x=e,n.y=t,n;n.x*=this.con,n.y*=this.con,i=o*this.cons/(2*this.a*this.k0),t=this.con*sa(this.e,i),e=this.con*q(this.con*this.long0+Math.atan2(n.x,-1*n.y))}else s=2*Math.atan(o*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,o<=j?r=this.X0:(r=Math.asin(Math.cos(s)*this.sinX0+n.y*Math.sin(s)*this.cosX0/o),e=q(this.long0+Math.atan2(n.x*Math.sin(s),o*this.cosX0*Math.cos(s)-n.y*this.sinX0*Math.sin(s)))),t=-1*sa(this.e,Math.tan(.5*(F+r)));return n.x=e,n.y=t,n}var TA=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const RA={init:CA,forward:MA,inverse:SA,names:TA,ssfn_:EA};function LA(){var n=this.lat0;this.lambda0=this.long0;var e=Math.sin(n),t=this.a,i=this.rf,s=1/i,r=2*s-Math.pow(s,2),o=this.e=Math.sqrt(r);this.R=this.k0*t*Math.sqrt(1-r)/(1-r*Math.pow(e,2)),this.alpha=Math.sqrt(1+r/(1-r)*Math.pow(Math.cos(n),4)),this.b0=Math.asin(e/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),l=Math.log(Math.tan(Math.PI/4+n/2)),h=Math.log((1+o*e)/(1-o*e));this.K=a-this.alpha*l+this.alpha*o/2*h}function IA(n){var e=Math.log(Math.tan(Math.PI/4-n.y/2)),t=this.e/2*Math.log((1+this.e*Math.sin(n.y))/(1-this.e*Math.sin(n.y))),i=-this.alpha*(e+t)+this.K,s=2*(Math.atan(Math.exp(i))-Math.PI/4),r=this.alpha*(n.x-this.lambda0),o=Math.atan(Math.sin(r)/(Math.sin(this.b0)*Math.tan(s)+Math.cos(this.b0)*Math.cos(r))),a=Math.asin(Math.cos(this.b0)*Math.sin(s)-Math.sin(this.b0)*Math.cos(s)*Math.cos(r));return n.y=this.R/2*Math.log((1+Math.sin(a))/(1-Math.sin(a)))+this.y0,n.x=this.R*o+this.x0,n}function PA(n){for(var e=n.x-this.x0,t=n.y-this.y0,i=e/this.R,s=2*(Math.atan(Math.exp(t/this.R))-Math.PI/4),r=Math.asin(Math.cos(this.b0)*Math.sin(s)+Math.sin(this.b0)*Math.cos(s)*Math.cos(i)),o=Math.atan(Math.sin(i)/(Math.cos(this.b0)*Math.cos(i)-Math.sin(this.b0)*Math.tan(s))),a=this.lambda0+o/this.alpha,l=0,h=r,c=-1e3,u=0;Math.abs(h-c)>1e-7;){if(++u>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+r/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(h))/2)),c=h,h=2*Math.atan(Math.exp(l))-Math.PI/2}return n.x=a,n.y=h,n}var AA=["somerc"];const FA={init:LA,forward:IA,inverse:PA,names:AA};var dr=1e-7;function OA(n){var e=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],t=typeof n.PROJECTION=="object"?Object.keys(n.PROJECTION)[0]:n.PROJECTION;return"no_uoff"in n||"no_off"in n||e.indexOf(t)!==-1}function kA(){var n,e,t,i,s,r,o,a,l,h,c=0,u,d=0,f=0,g=0,p=0,m=0,v=0;this.no_off=OA(this),this.no_rot="no_rot"in this;var y=!1;"alpha"in this&&(y=!0);var x=!1;if("rectified_grid_angle"in this&&(x=!0),y&&(v=this.alpha),x&&(c=this.rectified_grid_angle*Ct),y||x)d=this.longc;else if(f=this.long1,p=this.lat1,g=this.long2,m=this.lat2,Math.abs(p-m)<=dr||(n=Math.abs(p))<=dr||Math.abs(n-F)<=dr||Math.abs(Math.abs(this.lat0)-F)<=dr||Math.abs(Math.abs(m)-F)<=dr)throw new Error;var w=1-this.es;e=Math.sqrt(w),Math.abs(this.lat0)>j?(a=Math.sin(this.lat0),t=Math.cos(this.lat0),n=1-this.es*a*a,this.B=t*t,this.B=Math.sqrt(1+this.es*this.B*this.B/w),this.A=this.B*this.k0*e/n,i=this.B*e/(t*Math.sqrt(n)),s=i*i-1,s<=0?s=0:(s=Math.sqrt(s),this.lat0<0&&(s=-s)),this.E=s+=i,this.E*=Math.pow(qi(this.e,this.lat0,a),this.B)):(this.B=1/e,this.A=this.k0,this.E=i=s=1),y||x?(y?(u=Math.asin(Math.sin(v)/i),x||(c=v)):(u=c,v=Math.asin(i*Math.sin(u))),this.lam0=d-Math.asin(.5*(s-1/s)*Math.tan(u))/this.B):(r=Math.pow(qi(this.e,p,Math.sin(p)),this.B),o=Math.pow(qi(this.e,m,Math.sin(m)),this.B),s=this.E/r,l=(o-r)/(o+r),h=this.E*this.E,h=(h-o*r)/(h+o*r),n=f-g,n<-Math.pi?g-=ia:n>Math.pi&&(g+=ia),this.lam0=q(.5*(f+g)-Math.atan(h*Math.tan(.5*this.B*(f-g))/l)/this.B),u=Math.atan(2*Math.sin(this.B*q(f-this.lam0))/(s-1/s)),c=v=Math.asin(i*Math.sin(u))),this.singam=Math.sin(u),this.cosgam=Math.cos(u),this.sinrot=Math.sin(c),this.cosrot=Math.cos(c),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(i*i-1)/Math.cos(v))),this.lat0<0&&(this.u_0=-this.u_0)),s=.5*u,this.v_pole_n=this.ArB*Math.log(Math.tan(ke-s)),this.v_pole_s=this.ArB*Math.log(Math.tan(ke+s))}function NA(n){var e={},t,i,s,r,o,a,l,h;if(n.x=n.x-this.lam0,Math.abs(Math.abs(n.y)-F)>j){if(o=this.E/Math.pow(qi(this.e,n.y,Math.sin(n.y)),this.B),a=1/o,t=.5*(o-a),i=.5*(o+a),r=Math.sin(this.B*n.x),s=(t*this.singam-r*this.cosgam)/i,Math.abs(Math.abs(s)-1)<j)throw new Error;h=.5*this.ArB*Math.log((1-s)/(1+s)),a=Math.cos(this.B*n.x),Math.abs(a)<dr?l=this.A*n.x:l=this.ArB*Math.atan2(t*this.cosgam+r*this.singam,a)}else h=n.y>0?this.v_pole_n:this.v_pole_s,l=this.ArB*n.y;return this.no_rot?(e.x=l,e.y=h):(l-=this.u_0,e.x=h*this.cosrot+l*this.sinrot,e.y=l*this.cosrot-h*this.sinrot),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function DA(n){var e,t,i,s,r,o,a,l={};if(n.x=(n.x-this.x0)*(1/this.a),n.y=(n.y-this.y0)*(1/this.a),this.no_rot?(t=n.y,e=n.x):(t=n.x*this.cosrot-n.y*this.sinrot,e=n.y*this.cosrot+n.x*this.sinrot+this.u_0),i=Math.exp(-this.BrA*t),s=.5*(i-1/i),r=.5*(i+1/i),o=Math.sin(this.BrA*e),a=(o*this.cosgam+s*this.singam)/r,Math.abs(Math.abs(a)-1)<j)l.x=0,l.y=a<0?-F:F;else{if(l.y=this.E/Math.sqrt((1+a)/(1-a)),l.y=sa(this.e,Math.pow(l.y,1/this.B)),l.y===1/0)throw new Error;l.x=-this.rB*Math.atan2(s*this.cosgam-o*this.singam,Math.cos(this.BrA*e))}return l.x+=this.lam0,l}var GA=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const zA={init:kA,forward:NA,inverse:DA,names:GA};function BA(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<j)){var n=this.b/this.a;this.e=Math.sqrt(1-n*n);var e=Math.sin(this.lat1),t=Math.cos(this.lat1),i=dn(this.e,e,t),s=qi(this.e,this.lat1,e),r=Math.sin(this.lat2),o=Math.cos(this.lat2),a=dn(this.e,r,o),l=qi(this.e,this.lat2,r),h=qi(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>j?this.ns=Math.log(i/a)/Math.log(s/l):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=i/(this.ns*Math.pow(s,this.ns)),this.rh=this.a*this.f0*Math.pow(h,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function UA(n){var e=n.x,t=n.y;Math.abs(2*Math.abs(t)-Math.PI)<=j&&(t=Da(t)*(F-2*j));var i=Math.abs(Math.abs(t)-F),s,r;if(i>j)s=qi(this.e,t,Math.sin(t)),r=this.a*this.f0*Math.pow(s,this.ns);else{if(i=t*this.ns,i<=0)return null;r=0}var o=this.ns*q(e-this.long0);return n.x=this.k0*(r*Math.sin(o))+this.x0,n.y=this.k0*(this.rh-r*Math.cos(o))+this.y0,n}function jA(n){var e,t,i,s,r,o=(n.x-this.x0)/this.k0,a=this.rh-(n.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(o*o+a*a),t=1):(e=-Math.sqrt(o*o+a*a),t=-1);var l=0;if(e!==0&&(l=Math.atan2(t*o,t*a)),e!==0||this.ns>0){if(t=1/this.ns,i=Math.pow(e/(this.a*this.f0),t),s=sa(this.e,i),s===-9999)return null}else s=-F;return r=q(l/this.ns+this.long0),n.x=r,n.y=s,n}var $A=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const qA={init:BA,forward:UA,inverse:jA,names:$A};function VA(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function WA(n){var e,t,i,s,r,o,a,l=n.x,h=n.y,c=q(l-this.long0);return e=Math.pow((1+this.e*Math.sin(h))/(1-this.e*Math.sin(h)),this.alfa*this.e/2),t=2*(Math.atan(this.k*Math.pow(Math.tan(h/2+this.s45),this.alfa)/e)-this.s45),i=-c*this.alfa,s=Math.asin(Math.cos(this.ad)*Math.sin(t)+Math.sin(this.ad)*Math.cos(t)*Math.cos(i)),r=Math.asin(Math.cos(t)*Math.sin(i)/Math.cos(s)),o=this.n*r,a=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(s/2+this.s45),this.n),n.y=a*Math.cos(o)/1,n.x=a*Math.sin(o)/1,this.czech||(n.y*=-1,n.x*=-1),n}function HA(n){var e,t,i,s,r,o,a,l,h=n.x;n.x=n.y,n.y=h,this.czech||(n.y*=-1,n.x*=-1),o=Math.sqrt(n.x*n.x+n.y*n.y),r=Math.atan2(n.y,n.x),s=r/Math.sin(this.s0),i=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(i)-Math.sin(this.ad)*Math.cos(i)*Math.cos(s)),t=Math.asin(Math.cos(i)*Math.sin(s)/Math.cos(e)),n.x=this.long0-t/this.alfa,a=e,l=0;var c=0;do n.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-n.y)<1e-10&&(l=1),a=n.y,c+=1;while(l===0&&c<15);return c>=15?null:n}var XA=["Krovak","krovak"];const YA={init:VA,forward:WA,inverse:HA,names:XA};function Wt(n,e,t,i,s){return n*s-e*Math.sin(2*s)+t*Math.sin(4*s)-i*Math.sin(6*s)}function Ga(n){return 1-.25*n*(1+n/16*(3+1.25*n))}function za(n){return .375*n*(1+.25*n*(1+.46875*n))}function Ba(n){return .05859375*n*n*(1+.75*n)}function Ua(n){return n*n*n*(35/3072)}function co(n,e,t){var i=e*t;return n/Math.sqrt(1-i*i)}function bo(n){return Math.abs(n)<F?n:n-Da(n)*Math.PI}function Ch(n,e,t,i,s){var r,o;r=n/e;for(var a=0;a<15;a++)if(o=(n-(e*r-t*Math.sin(2*r)+i*Math.sin(4*r)-s*Math.sin(6*r)))/(e-2*t*Math.cos(2*r)+4*i*Math.cos(4*r)-6*s*Math.cos(6*r)),r+=o,Math.abs(o)<=1e-10)return r;return NaN}function ZA(){this.sphere||(this.e0=Ga(this.es),this.e1=za(this.es),this.e2=Ba(this.es),this.e3=Ua(this.es),this.ml0=this.a*Wt(this.e0,this.e1,this.e2,this.e3,this.lat0))}function KA(n){var e,t,i=n.x,s=n.y;if(i=q(i-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(s)*Math.sin(i)),t=this.a*(Math.atan2(Math.tan(s),Math.cos(i))-this.lat0);else{var r=Math.sin(s),o=Math.cos(s),a=co(this.a,this.e,r),l=Math.tan(s)*Math.tan(s),h=i*Math.cos(s),c=h*h,u=this.es*o*o/(1-this.es),d=this.a*Wt(this.e0,this.e1,this.e2,this.e3,s);e=a*h*(1-c*l*(1/6-(8-l+8*u)*c/120)),t=d-this.ml0+a*r/o*c*(.5+(5-l+6*u)*c/24)}return n.x=e+this.x0,n.y=t+this.y0,n}function JA(n){n.x-=this.x0,n.y-=this.y0;var e=n.x/this.a,t=n.y/this.a,i,s;if(this.sphere){var r=t+this.lat0;i=Math.asin(Math.sin(r)*Math.cos(e)),s=Math.atan2(Math.tan(e),Math.cos(r))}else{var o=this.ml0/this.a+t,a=Ch(o,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(a)-F)<=j)return n.x=this.long0,n.y=F,t<0&&(n.y*=-1),n;var l=co(this.a,this.e,Math.sin(a)),h=l*l*l/this.a/this.a*(1-this.es),c=Math.pow(Math.tan(a),2),u=e*this.a/l,d=u*u;i=a-l*Math.tan(a)/h*u*u*(.5-(1+3*c)*u*u/24),s=u*(1-d*(c/3+(1+3*c)*c*d/15))/Math.cos(a)}return n.x=q(s+this.long0),n.y=bo(i),n}var QA=["Cassini","Cassini_Soldner","cass"];const eF={init:ZA,forward:KA,inverse:JA,names:QA};function is(n,e){var t;return n>1e-7?(t=n*e,(1-n*n)*(e/(1-t*t)-.5/n*Math.log((1-t)/(1+t)))):2*e}var tF=1,iF=2,nF=3,sF=4;function rF(){var n=Math.abs(this.lat0);if(Math.abs(n-F)<j?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(n)<j?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var e;switch(this.qp=is(this.e,1),this.mmf=.5/(1-this.es),this.apa=gF(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=is(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function oF(n){var e,t,i,s,r,o,a,l,h,c,u=n.x,d=n.y;if(u=q(u-this.long0),this.sphere){if(r=Math.sin(d),c=Math.cos(d),i=Math.cos(u),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t=this.mode===this.EQUIT?1+c*i:1+this.sinph0*r+this.cosph0*c*i,t<=j)return null;t=Math.sqrt(2/t),e=t*c*Math.sin(u),t*=this.mode===this.EQUIT?r:this.cosph0*r-this.sinph0*c*i}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(i=-i),Math.abs(d+this.lat0)<j)return null;t=ke-d*.5,t=2*(this.mode===this.S_POLE?Math.cos(t):Math.sin(t)),e=t*Math.sin(u),t*=i}}else{switch(a=0,l=0,h=0,i=Math.cos(u),s=Math.sin(u),r=Math.sin(d),o=is(this.e,r),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(a=o/this.qp,l=Math.sqrt(1-a*a)),this.mode){case this.OBLIQ:h=1+this.sinb1*a+this.cosb1*l*i;break;case this.EQUIT:h=1+l*i;break;case this.N_POLE:h=F+d,o=this.qp-o;break;case this.S_POLE:h=d-F,o=this.qp+o;break}if(Math.abs(h)<j)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:h=Math.sqrt(2/h),this.mode===this.OBLIQ?t=this.ymf*h*(this.cosb1*a-this.sinb1*l*i):t=(h=Math.sqrt(2/(1+l*i)))*a*this.ymf,e=this.xmf*h*l*s;break;case this.N_POLE:case this.S_POLE:o>=0?(e=(h=Math.sqrt(o))*s,t=i*(this.mode===this.S_POLE?h:-h)):e=t=0;break}}return n.x=this.a*e+this.x0,n.y=this.a*t+this.y0,n}function aF(n){n.x-=this.x0,n.y-=this.y0;var e=n.x/this.a,t=n.y/this.a,i,s,r,o,a,l,h;if(this.sphere){var c=0,u,d=0;if(u=Math.sqrt(e*e+t*t),s=u*.5,s>1)return null;switch(s=2*Math.asin(s),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(d=Math.sin(s),c=Math.cos(s)),this.mode){case this.EQUIT:s=Math.abs(u)<=j?0:Math.asin(t*d/u),e*=d,t=c*u;break;case this.OBLIQ:s=Math.abs(u)<=j?this.lat0:Math.asin(c*this.sinph0+t*d*this.cosph0/u),e*=d*this.cosph0,t=(c-Math.sin(s)*this.sinph0)*u;break;case this.N_POLE:t=-t,s=F-s;break;case this.S_POLE:s-=F;break}i=t===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(e,t)}else{if(h=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e/=this.dd,t*=this.dd,l=Math.sqrt(e*e+t*t),l<j)return n.x=this.long0,n.y=this.lat0,n;o=2*Math.asin(.5*l/this.rq),r=Math.cos(o),e*=o=Math.sin(o),this.mode===this.OBLIQ?(h=r*this.sinb1+t*o*this.cosb1/l,a=this.qp*h,t=l*this.cosb1*r-t*this.sinb1*o):(h=t*o/l,a=this.qp*h,t=l*r)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(t=-t),a=e*e+t*t,!a)return n.x=this.long0,n.y=this.lat0,n;h=1-a/this.qp,this.mode===this.S_POLE&&(h=-h)}i=Math.atan2(e,t),s=pF(Math.asin(h),this.apa)}return n.x=q(this.long0+i),n.y=s,n}var lF=.3333333333333333,hF=.17222222222222222,cF=.10257936507936508,uF=.06388888888888888,dF=.0664021164021164,fF=.016415012942191543;function gF(n){var e,t=[];return t[0]=n*lF,e=n*n,t[0]+=e*hF,t[1]=e*uF,e*=n,t[0]+=e*cF,t[1]+=e*dF,t[2]=e*fF,t}function pF(n,e){var t=n+n;return n+e[0]*Math.sin(t)+e[1]*Math.sin(t+t)+e[2]*Math.sin(t+t+t)}var mF=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const yF={init:rF,forward:oF,inverse:aF,names:mF,S_POLE:tF,N_POLE:iF,EQUIT:nF,OBLIQ:sF};function cs(n){return Math.abs(n)>1&&(n=n>1?1:-1),Math.asin(n)}function _F(){Math.abs(this.lat1+this.lat2)<j||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=dn(this.e3,this.sin_po,this.cos_po),this.qs1=is(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=dn(this.e3,this.sin_po,this.cos_po),this.qs2=is(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=is(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>j?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function vF(n){var e=n.x,t=n.y;this.sin_phi=Math.sin(t),this.cos_phi=Math.cos(t);var i=is(this.e3,this.sin_phi),s=this.a*Math.sqrt(this.c-this.ns0*i)/this.ns0,r=this.ns0*q(e-this.long0),o=s*Math.sin(r)+this.x0,a=this.rh-s*Math.cos(r)+this.y0;return n.x=o,n.y=a,n}function xF(n){var e,t,i,s,r,o;return n.x-=this.x0,n.y=this.rh-n.y+this.y0,this.ns0>=0?(e=Math.sqrt(n.x*n.x+n.y*n.y),i=1):(e=-Math.sqrt(n.x*n.x+n.y*n.y),i=-1),s=0,e!==0&&(s=Math.atan2(i*n.x,i*n.y)),i=e*this.ns0/this.a,this.sphere?o=Math.asin((this.c-i*i)/(2*this.ns0)):(t=(this.c-i*i)/this.ns0,o=this.phi1z(this.e3,t)),r=q(s/this.ns0+this.long0),n.x=r,n.y=o,n}function wF(n,e){var t,i,s,r,o,a=cs(.5*e);if(n<j)return a;for(var l=n*n,h=1;h<=25;h++)if(t=Math.sin(a),i=Math.cos(a),s=n*t,r=1-s*s,o=.5*r*r/i*(e/(1-l)-t/r+.5/n*Math.log((1-s)/(1+s))),a=a+o,Math.abs(o)<=1e-7)return a;return null}var bF=["Albers_Conic_Equal_Area","Albers","aea"];const EF={init:_F,forward:vF,inverse:xF,names:bF,phi1z:wF};function CF(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function MF(n){var e,t,i,s,r,o,a,l,h=n.x,c=n.y;return i=q(h-this.long0),e=Math.sin(c),t=Math.cos(c),s=Math.cos(i),o=this.sin_p14*e+this.cos_p14*t*s,r=1,o>0||Math.abs(o)<=j?(a=this.x0+this.a*r*t*Math.sin(i)/o,l=this.y0+this.a*r*(this.cos_p14*e-this.sin_p14*t*s)/o):(a=this.x0+this.infinity_dist*t*Math.sin(i),l=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*t*s)),n.x=a,n.y=l,n}function SF(n){var e,t,i,s,r,o;return n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,n.x/=this.k0,n.y/=this.k0,(e=Math.sqrt(n.x*n.x+n.y*n.y))?(s=Math.atan2(e,this.rc),t=Math.sin(s),i=Math.cos(s),o=cs(i*this.sin_p14+n.y*t*this.cos_p14/e),r=Math.atan2(n.x*t,e*this.cos_p14*i-n.y*this.sin_p14*t),r=q(this.long0+r)):(o=this.phic0,r=0),n.x=r,n.y=o,n}var TF=["gnom"];const RF={init:CF,forward:MF,inverse:SF,names:TF};function LF(n,e){var t=1-(1-n*n)/(2*n)*Math.log((1-n)/(1+n));if(Math.abs(Math.abs(e)-t)<1e-6)return e<0?-1*F:F;for(var i=Math.asin(.5*e),s,r,o,a,l=0;l<30;l++)if(r=Math.sin(i),o=Math.cos(i),a=n*r,s=Math.pow(1-a*a,2)/(2*o)*(e/(1-n*n)-r/(1-a*a)+.5/n*Math.log((1-a)/(1+a))),i+=s,Math.abs(s)<=1e-10)return i;return NaN}function IF(){this.sphere||(this.k0=dn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function PF(n){var e=n.x,t=n.y,i,s,r=q(e-this.long0);if(this.sphere)i=this.x0+this.a*r*Math.cos(this.lat_ts),s=this.y0+this.a*Math.sin(t)/Math.cos(this.lat_ts);else{var o=is(this.e,Math.sin(t));i=this.x0+this.a*this.k0*r,s=this.y0+this.a*o*.5/this.k0}return n.x=i,n.y=s,n}function AF(n){n.x-=this.x0,n.y-=this.y0;var e,t;return this.sphere?(e=q(this.long0+n.x/this.a/Math.cos(this.lat_ts)),t=Math.asin(n.y/this.a*Math.cos(this.lat_ts))):(t=LF(this.e,2*n.y*this.k0/this.a),e=q(this.long0+n.x/(this.a*this.k0))),n.x=e,n.y=t,n}var FF=["cea"];const OF={init:IF,forward:PF,inverse:AF,names:FF};function kF(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function NF(n){var e=n.x,t=n.y,i=q(e-this.long0),s=bo(t-this.lat0);return n.x=this.x0+this.a*i*this.rc,n.y=this.y0+this.a*s,n}function DF(n){var e=n.x,t=n.y;return n.x=q(this.long0+(e-this.x0)/(this.a*this.rc)),n.y=bo(this.lat0+(t-this.y0)/this.a),n}var GF=["Equirectangular","Equidistant_Cylindrical","eqc"];const zF={init:kF,forward:NF,inverse:DF,names:GF};var Vm=20;function BF(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Ga(this.es),this.e1=za(this.es),this.e2=Ba(this.es),this.e3=Ua(this.es),this.ml0=this.a*Wt(this.e0,this.e1,this.e2,this.e3,this.lat0)}function UF(n){var e=n.x,t=n.y,i,s,r,o=q(e-this.long0);if(r=o*Math.sin(t),this.sphere)Math.abs(t)<=j?(i=this.a*o,s=-1*this.a*this.lat0):(i=this.a*Math.sin(r)/Math.tan(t),s=this.a*(bo(t-this.lat0)+(1-Math.cos(r))/Math.tan(t)));else if(Math.abs(t)<=j)i=this.a*o,s=-1*this.ml0;else{var a=co(this.a,this.e,Math.sin(t))/Math.tan(t);i=a*Math.sin(r),s=this.a*Wt(this.e0,this.e1,this.e2,this.e3,t)-this.ml0+a*(1-Math.cos(r))}return n.x=i+this.x0,n.y=s+this.y0,n}function jF(n){var e,t,i,s,r,o,a,l,h;if(i=n.x-this.x0,s=n.y-this.y0,this.sphere)if(Math.abs(s+this.a*this.lat0)<=j)e=q(i/this.a+this.long0),t=0;else{o=this.lat0+s/this.a,a=i*i/this.a/this.a+o*o,l=o;var c;for(r=Vm;r;--r)if(c=Math.tan(l),h=-1*(o*(l*c+1)-l-.5*(l*l+a)*c)/((l-o)/c-1),l+=h,Math.abs(h)<=j){t=l;break}e=q(this.long0+Math.asin(i*Math.tan(l)/this.a)/Math.sin(t))}else if(Math.abs(s+this.ml0)<=j)t=0,e=q(this.long0+i/this.a);else{o=(this.ml0+s)/this.a,a=i*i/this.a/this.a+o*o,l=o;var u,d,f,g,p;for(r=Vm;r;--r)if(p=this.e*Math.sin(l),u=Math.sqrt(1-p*p)*Math.tan(l),d=this.a*Wt(this.e0,this.e1,this.e2,this.e3,l),f=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),g=d/this.a,h=(o*(u*g+1)-g-.5*u*(g*g+a))/(this.es*Math.sin(2*l)*(g*g+a-2*o*g)/(4*u)+(o-g)*(u*f-2/Math.sin(2*l))-f),l-=h,Math.abs(h)<=j){t=l;break}u=Math.sqrt(1-this.es*Math.pow(Math.sin(t),2))*Math.tan(t),e=q(this.long0+Math.asin(i*u/this.a)/Math.sin(t))}return n.x=e,n.y=t,n}var $F=["Polyconic","poly"];const qF={init:BF,forward:UF,inverse:jF,names:$F};function VF(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function WF(n){var e,t=n.x,i=n.y,s=i-this.lat0,r=t-this.long0,o=s/Go*1e-5,a=r,l=1,h=0;for(e=1;e<=10;e++)l=l*o,h=h+this.A[e]*l;var c=h,u=a,d=1,f=0,g,p,m=0,v=0;for(e=1;e<=6;e++)g=d*c-f*u,p=f*c+d*u,d=g,f=p,m=m+this.B_re[e]*d-this.B_im[e]*f,v=v+this.B_im[e]*d+this.B_re[e]*f;return n.x=v*this.a+this.x0,n.y=m*this.a+this.y0,n}function HF(n){var e,t=n.x,i=n.y,s=t-this.x0,r=i-this.y0,o=r/this.a,a=s/this.a,l=1,h=0,c,u,d=0,f=0;for(e=1;e<=6;e++)c=l*o-h*a,u=h*o+l*a,l=c,h=u,d=d+this.C_re[e]*l-this.C_im[e]*h,f=f+this.C_im[e]*l+this.C_re[e]*h;for(var g=0;g<this.iterations;g++){var p=d,m=f,v,y,x=o,w=a;for(e=2;e<=6;e++)v=p*d-m*f,y=m*d+p*f,p=v,m=y,x=x+(e-1)*(this.B_re[e]*p-this.B_im[e]*m),w=w+(e-1)*(this.B_im[e]*p+this.B_re[e]*m);p=1,m=0;var b=this.B_re[1],E=this.B_im[1];for(e=2;e<=6;e++)v=p*d-m*f,y=m*d+p*f,p=v,m=y,b=b+e*(this.B_re[e]*p-this.B_im[e]*m),E=E+e*(this.B_im[e]*p+this.B_re[e]*m);var C=b*b+E*E;d=(x*b+w*E)/C,f=(w*b-x*E)/C}var M=d,R=f,N=1,G=0;for(e=1;e<=9;e++)N=N*M,G=G+this.D[e]*N;var S=this.lat0+G*Go*1e5,B=this.long0+R;return n.x=B,n.y=S,n}var XF=["New_Zealand_Map_Grid","nzmg"];const YF={init:VF,forward:WF,inverse:HF,names:XF};function ZF(){}function KF(n){var e=n.x,t=n.y,i=q(e-this.long0),s=this.x0+this.a*i,r=this.y0+this.a*Math.log(Math.tan(Math.PI/4+t/2.5))*1.25;return n.x=s,n.y=r,n}function JF(n){n.x-=this.x0,n.y-=this.y0;var e=q(this.long0+n.x/this.a),t=2.5*(Math.atan(Math.exp(.8*n.y/this.a))-Math.PI/4);return n.x=e,n.y=t,n}var QF=["Miller_Cylindrical","mill"];const eO={init:ZF,forward:KF,inverse:JF,names:QF};var tO=20;function iO(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Lv(this.es)}function nO(n){var e,t,i=n.x,s=n.y;if(i=q(i-this.long0),this.sphere){if(!this.m)s=this.n!==1?Math.asin(this.n*Math.sin(s)):s;else for(var r=this.n*Math.sin(s),o=tO;o;--o){var a=(this.m*s+Math.sin(s)-r)/(this.m+Math.cos(s));if(s-=a,Math.abs(a)<j)break}e=this.a*this.C_x*i*(this.m+Math.cos(s)),t=this.a*this.C_y*s}else{var l=Math.sin(s),h=Math.cos(s);t=this.a*pc(s,l,h,this.en),e=this.a*i*h/Math.sqrt(1-this.es*l*l)}return n.x=e,n.y=t,n}function sO(n){var e,t,i,s;return n.x-=this.x0,i=n.x/this.a,n.y-=this.y0,e=n.y/this.a,this.sphere?(e/=this.C_y,i=i/(this.C_x*(this.m+Math.cos(e))),this.m?e=cs((this.m*e+Math.sin(e))/this.n):this.n!==1&&(e=cs(Math.sin(e)/this.n)),i=q(i+this.long0),e=bo(e)):(e=Iv(n.y/this.a,this.es,this.en),s=Math.abs(e),s<F?(s=Math.sin(e),t=this.long0+n.x*Math.sqrt(1-this.es*s*s)/(this.a*Math.cos(e)),i=q(t)):s-j<F&&(i=this.long0)),n.x=i,n.y=e,n}var rO=["Sinusoidal","sinu"];const oO={init:iO,forward:nO,inverse:sO,names:rO};function aO(){}function lO(n){for(var e=n.x,t=n.y,i=q(e-this.long0),s=t,r=Math.PI*Math.sin(t);;){var o=-(s+Math.sin(s)-r)/(1+Math.cos(s));if(s+=o,Math.abs(o)<j)break}s/=2,Math.PI/2-Math.abs(t)<j&&(i=0);var a=.900316316158*this.a*i*Math.cos(s)+this.x0,l=1.4142135623731*this.a*Math.sin(s)+this.y0;return n.x=a,n.y=l,n}function hO(n){var e,t;n.x-=this.x0,n.y-=this.y0,t=n.y/(1.4142135623731*this.a),Math.abs(t)>.999999999999&&(t=.999999999999),e=Math.asin(t);var i=q(this.long0+n.x/(.900316316158*this.a*Math.cos(e)));i<-Math.PI&&(i=-Math.PI),i>Math.PI&&(i=Math.PI),t=(2*e+Math.sin(2*e))/Math.PI,Math.abs(t)>1&&(t=1);var s=Math.asin(t);return n.x=i,n.y=s,n}var cO=["Mollweide","moll"];const uO={init:aO,forward:lO,inverse:hO,names:cO};function dO(){Math.abs(this.lat1+this.lat2)<j||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Ga(this.es),this.e1=za(this.es),this.e2=Ba(this.es),this.e3=Ua(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=dn(this.e,this.sinphi,this.cosphi),this.ml1=Wt(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<j?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=dn(this.e,this.sinphi,this.cosphi),this.ml2=Wt(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Wt(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function fO(n){var e=n.x,t=n.y,i;if(this.sphere)i=this.a*(this.g-t);else{var s=Wt(this.e0,this.e1,this.e2,this.e3,t);i=this.a*(this.g-s)}var r=this.ns*q(e-this.long0),o=this.x0+i*Math.sin(r),a=this.y0+this.rh-i*Math.cos(r);return n.x=o,n.y=a,n}function gO(n){n.x-=this.x0,n.y=this.rh-n.y+this.y0;var e,t,i,s;this.ns>=0?(t=Math.sqrt(n.x*n.x+n.y*n.y),e=1):(t=-Math.sqrt(n.x*n.x+n.y*n.y),e=-1);var r=0;if(t!==0&&(r=Math.atan2(e*n.x,e*n.y)),this.sphere)return s=q(this.long0+r/this.ns),i=bo(this.g-t/this.a),n.x=s,n.y=i,n;var o=this.g-t/this.a;return i=Ch(o,this.e0,this.e1,this.e2,this.e3),s=q(this.long0+r/this.ns),n.x=s,n.y=i,n}var pO=["Equidistant_Conic","eqdc"];const mO={init:dO,forward:fO,inverse:gO,names:pO};function yO(){this.R=this.a}function _O(n){var e=n.x,t=n.y,i=q(e-this.long0),s,r;Math.abs(t)<=j&&(s=this.x0+this.R*i,r=this.y0);var o=cs(2*Math.abs(t/Math.PI));(Math.abs(i)<=j||Math.abs(Math.abs(t)-F)<=j)&&(s=this.x0,t>=0?r=this.y0+Math.PI*this.R*Math.tan(.5*o):r=this.y0+Math.PI*this.R*-Math.tan(.5*o));var a=.5*Math.abs(Math.PI/i-i/Math.PI),l=a*a,h=Math.sin(o),c=Math.cos(o),u=c/(h+c-1),d=u*u,f=u*(2/h-1),g=f*f,p=Math.PI*this.R*(a*(u-g)+Math.sqrt(l*(u-g)*(u-g)-(g+l)*(d-g)))/(g+l);i<0&&(p=-p),s=this.x0+p;var m=l+u;return p=Math.PI*this.R*(f*m-a*Math.sqrt((g+l)*(l+1)-m*m))/(g+l),t>=0?r=this.y0+p:r=this.y0-p,n.x=s,n.y=r,n}function vO(n){var e,t,i,s,r,o,a,l,h,c,u,d,f;return n.x-=this.x0,n.y-=this.y0,u=Math.PI*this.R,i=n.x/u,s=n.y/u,r=i*i+s*s,o=-Math.abs(s)*(1+r),a=o-2*s*s+i*i,l=-2*o+1+2*s*s+r*r,f=s*s/l+(2*a*a*a/l/l/l-9*o*a/l/l)/27,h=(o-a*a/3/l)/l,c=2*Math.sqrt(-h/3),u=3*f/h/c,Math.abs(u)>1&&(u>=0?u=1:u=-1),d=Math.acos(u)/3,n.y>=0?t=(-c*Math.cos(d+Math.PI/3)-a/3/l)*Math.PI:t=-(-c*Math.cos(d+Math.PI/3)-a/3/l)*Math.PI,Math.abs(i)<j?e=this.long0:e=q(this.long0+Math.PI*(r-1+Math.sqrt(1+2*(i*i-s*s)+r*r))/2/i),n.x=e,n.y=t,n}var xO=["Van_der_Grinten_I","VanDerGrinten","vandg"];const wO={init:yO,forward:_O,inverse:vO,names:xO};function bO(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function EO(n){var e=n.x,t=n.y,i=Math.sin(n.y),s=Math.cos(n.y),r=q(e-this.long0),o,a,l,h,c,u,d,f,g,p,m,v,y,x,w,b,E,C,M,R,N,G,S;return this.sphere?Math.abs(this.sin_p12-1)<=j?(n.x=this.x0+this.a*(F-t)*Math.sin(r),n.y=this.y0-this.a*(F-t)*Math.cos(r),n):Math.abs(this.sin_p12+1)<=j?(n.x=this.x0+this.a*(F+t)*Math.sin(r),n.y=this.y0+this.a*(F+t)*Math.cos(r),n):(C=this.sin_p12*i+this.cos_p12*s*Math.cos(r),b=Math.acos(C),E=b?b/Math.sin(b):1,n.x=this.x0+this.a*E*s*Math.sin(r),n.y=this.y0+this.a*E*(this.cos_p12*i-this.sin_p12*s*Math.cos(r)),n):(o=Ga(this.es),a=za(this.es),l=Ba(this.es),h=Ua(this.es),Math.abs(this.sin_p12-1)<=j?(c=this.a*Wt(o,a,l,h,F),u=this.a*Wt(o,a,l,h,t),n.x=this.x0+(c-u)*Math.sin(r),n.y=this.y0-(c-u)*Math.cos(r),n):Math.abs(this.sin_p12+1)<=j?(c=this.a*Wt(o,a,l,h,F),u=this.a*Wt(o,a,l,h,t),n.x=this.x0+(c+u)*Math.sin(r),n.y=this.y0+(c+u)*Math.cos(r),n):(d=i/s,f=co(this.a,this.e,this.sin_p12),g=co(this.a,this.e,i),p=Math.atan((1-this.es)*d+this.es*f*this.sin_p12/(g*s)),m=Math.atan2(Math.sin(r),this.cos_p12*Math.tan(p)-this.sin_p12*Math.cos(r)),m===0?M=Math.asin(this.cos_p12*Math.sin(p)-this.sin_p12*Math.cos(p)):Math.abs(Math.abs(m)-Math.PI)<=j?M=-Math.asin(this.cos_p12*Math.sin(p)-this.sin_p12*Math.cos(p)):M=Math.asin(Math.sin(r)*Math.cos(p)/Math.sin(m)),v=this.e*this.sin_p12/Math.sqrt(1-this.es),y=this.e*this.cos_p12*Math.cos(m)/Math.sqrt(1-this.es),x=v*y,w=y*y,R=M*M,N=R*M,G=N*M,S=G*M,b=f*M*(1-R*w*(1-w)/6+N/8*x*(1-2*w)+G/120*(w*(4-7*w)-3*v*v*(1-7*w))-S/48*x),n.x=this.x0+b*Math.sin(m),n.y=this.y0+b*Math.cos(m),n))}function CO(n){n.x-=this.x0,n.y-=this.y0;var e,t,i,s,r,o,a,l,h,c,u,d,f,g,p,m,v,y,x,w,b,E,C,M;return this.sphere?(e=Math.sqrt(n.x*n.x+n.y*n.y),e>2*F*this.a?void 0:(t=e/this.a,i=Math.sin(t),s=Math.cos(t),r=this.long0,Math.abs(e)<=j?o=this.lat0:(o=cs(s*this.sin_p12+n.y*i*this.cos_p12/e),a=Math.abs(this.lat0)-F,Math.abs(a)<=j?this.lat0>=0?r=q(this.long0+Math.atan2(n.x,-n.y)):r=q(this.long0-Math.atan2(-n.x,n.y)):r=q(this.long0+Math.atan2(n.x*i,e*this.cos_p12*s-n.y*this.sin_p12*i))),n.x=r,n.y=o,n)):(l=Ga(this.es),h=za(this.es),c=Ba(this.es),u=Ua(this.es),Math.abs(this.sin_p12-1)<=j?(d=this.a*Wt(l,h,c,u,F),e=Math.sqrt(n.x*n.x+n.y*n.y),f=d-e,o=Ch(f/this.a,l,h,c,u),r=q(this.long0+Math.atan2(n.x,-1*n.y)),n.x=r,n.y=o,n):Math.abs(this.sin_p12+1)<=j?(d=this.a*Wt(l,h,c,u,F),e=Math.sqrt(n.x*n.x+n.y*n.y),f=e-d,o=Ch(f/this.a,l,h,c,u),r=q(this.long0+Math.atan2(n.x,n.y)),n.x=r,n.y=o,n):(e=Math.sqrt(n.x*n.x+n.y*n.y),m=Math.atan2(n.x,n.y),g=co(this.a,this.e,this.sin_p12),v=Math.cos(m),y=this.e*this.cos_p12*v,x=-y*y/(1-this.es),w=3*this.es*(1-x)*this.sin_p12*this.cos_p12*v/(1-this.es),b=e/g,E=b-x*(1+x)*Math.pow(b,3)/6-w*(1+3*x)*Math.pow(b,4)/24,C=1-x*E*E/2-b*E*E*E/6,p=Math.asin(this.sin_p12*Math.cos(E)+this.cos_p12*Math.sin(E)*v),r=q(this.long0+Math.asin(Math.sin(m)*Math.sin(E)/Math.cos(p))),M=Math.sin(p),o=Math.atan2((M-this.es*C*this.sin_p12)*Math.tan(p),M*(1-this.es)),n.x=r,n.y=o,n))}var MO=["Azimuthal_Equidistant","aeqd"];const SO={init:bO,forward:EO,inverse:CO,names:MO};function TO(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function RO(n){var e,t,i,s,r,o,a,l,h=n.x,c=n.y;return i=q(h-this.long0),e=Math.sin(c),t=Math.cos(c),s=Math.cos(i),o=this.sin_p14*e+this.cos_p14*t*s,r=1,(o>0||Math.abs(o)<=j)&&(a=this.a*r*t*Math.sin(i),l=this.y0+this.a*r*(this.cos_p14*e-this.sin_p14*t*s)),n.x=a,n.y=l,n}function LO(n){var e,t,i,s,r,o,a;return n.x-=this.x0,n.y-=this.y0,e=Math.sqrt(n.x*n.x+n.y*n.y),t=cs(e/this.a),i=Math.sin(t),s=Math.cos(t),o=this.long0,Math.abs(e)<=j?(a=this.lat0,n.x=o,n.y=a,n):(a=cs(s*this.sin_p14+n.y*i*this.cos_p14/e),r=Math.abs(this.lat0)-F,Math.abs(r)<=j?(this.lat0>=0?o=q(this.long0+Math.atan2(n.x,-n.y)):o=q(this.long0-Math.atan2(-n.x,n.y)),n.x=o,n.y=a,n):(o=q(this.long0+Math.atan2(n.x*i,e*this.cos_p14*s-n.y*this.sin_p14*i)),n.x=o,n.y=a,n))}var IO=["ortho"];const PO={init:TO,forward:RO,inverse:LO,names:IO};var Ke={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},Ne={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function AO(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=F-ke/2?this.face=Ke.TOP:this.lat0<=-(F-ke/2)?this.face=Ke.BOTTOM:Math.abs(this.long0)<=ke?this.face=Ke.FRONT:Math.abs(this.long0)<=F+ke?this.face=this.long0>0?Ke.RIGHT:Ke.LEFT:this.face=Ke.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function FO(n){var e={x:0,y:0},t,i,s,r,o,a,l={value:0};if(n.x-=this.long0,this.es!==0?t=Math.atan(this.one_minus_f_squared*Math.tan(n.y)):t=n.y,i=n.x,this.face===Ke.TOP)r=F-t,i>=ke&&i<=F+ke?(l.value=Ne.AREA_0,s=i-F):i>F+ke||i<=-(F+ke)?(l.value=Ne.AREA_1,s=i>0?i-rt:i+rt):i>-(F+ke)&&i<=-ke?(l.value=Ne.AREA_2,s=i+F):(l.value=Ne.AREA_3,s=i);else if(this.face===Ke.BOTTOM)r=F+t,i>=ke&&i<=F+ke?(l.value=Ne.AREA_0,s=-i+F):i<ke&&i>=-ke?(l.value=Ne.AREA_1,s=-i):i<-ke&&i>=-(F+ke)?(l.value=Ne.AREA_2,s=-i-F):(l.value=Ne.AREA_3,s=i>0?-i+rt:-i-rt);else{var h,c,u,d,f,g,p;this.face===Ke.RIGHT?i=Dr(i,+F):this.face===Ke.BACK?i=Dr(i,+rt):this.face===Ke.LEFT&&(i=Dr(i,-F)),d=Math.sin(t),f=Math.cos(t),g=Math.sin(i),p=Math.cos(i),h=f*p,c=f*g,u=d,this.face===Ke.FRONT?(r=Math.acos(h),s=Ml(r,u,c,l)):this.face===Ke.RIGHT?(r=Math.acos(c),s=Ml(r,u,-h,l)):this.face===Ke.BACK?(r=Math.acos(-h),s=Ml(r,u,-c,l)):this.face===Ke.LEFT?(r=Math.acos(-c),s=Ml(r,u,h,l)):(r=s=0,l.value=Ne.AREA_0)}return a=Math.atan(12/rt*(s+Math.acos(Math.sin(s)*Math.cos(ke))-F)),o=Math.sqrt((1-Math.cos(r))/(Math.cos(a)*Math.cos(a))/(1-Math.cos(Math.atan(1/Math.cos(s))))),l.value===Ne.AREA_1?a+=F:l.value===Ne.AREA_2?a+=rt:l.value===Ne.AREA_3&&(a+=1.5*rt),e.x=o*Math.cos(a),e.y=o*Math.sin(a),e.x=e.x*this.a+this.x0,e.y=e.y*this.a+this.y0,n.x=e.x,n.y=e.y,n}function OO(n){var e={lam:0,phi:0},t,i,s,r,o,a,l,h,c,u={value:0};if(n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,i=Math.atan(Math.sqrt(n.x*n.x+n.y*n.y)),t=Math.atan2(n.y,n.x),n.x>=0&&n.x>=Math.abs(n.y)?u.value=Ne.AREA_0:n.y>=0&&n.y>=Math.abs(n.x)?(u.value=Ne.AREA_1,t-=F):n.x<0&&-n.x>=Math.abs(n.y)?(u.value=Ne.AREA_2,t=t<0?t+rt:t-rt):(u.value=Ne.AREA_3,t+=F),c=rt/12*Math.tan(t),o=Math.sin(c)/(Math.cos(c)-1/Math.sqrt(2)),a=Math.atan(o),s=Math.cos(t),r=Math.tan(i),l=1-s*s*r*r*(1-Math.cos(Math.atan(1/Math.cos(a)))),l<-1?l=-1:l>1&&(l=1),this.face===Ke.TOP)h=Math.acos(l),e.phi=F-h,u.value===Ne.AREA_0?e.lam=a+F:u.value===Ne.AREA_1?e.lam=a<0?a+rt:a-rt:u.value===Ne.AREA_2?e.lam=a-F:e.lam=a;else if(this.face===Ke.BOTTOM)h=Math.acos(l),e.phi=h-F,u.value===Ne.AREA_0?e.lam=-a+F:u.value===Ne.AREA_1?e.lam=-a:u.value===Ne.AREA_2?e.lam=-a-F:e.lam=a<0?-a-rt:-a+rt;else{var d,f,g;d=l,c=d*d,c>=1?g=0:g=Math.sqrt(1-c)*Math.sin(a),c+=g*g,c>=1?f=0:f=Math.sqrt(1-c),u.value===Ne.AREA_1?(c=f,f=-g,g=c):u.value===Ne.AREA_2?(f=-f,g=-g):u.value===Ne.AREA_3&&(c=f,f=g,g=-c),this.face===Ke.RIGHT?(c=d,d=-f,f=c):this.face===Ke.BACK?(d=-d,f=-f):this.face===Ke.LEFT&&(c=d,d=f,f=-c),e.phi=Math.acos(-g)-F,e.lam=Math.atan2(f,d),this.face===Ke.RIGHT?e.lam=Dr(e.lam,-F):this.face===Ke.BACK?e.lam=Dr(e.lam,-rt):this.face===Ke.LEFT&&(e.lam=Dr(e.lam,+F))}if(this.es!==0){var p,m,v;p=e.phi<0?1:0,m=Math.tan(e.phi),v=this.b/Math.sqrt(m*m+this.one_minus_f_squared),e.phi=Math.atan(Math.sqrt(this.a*this.a-v*v)/(this.one_minus_f*v)),p&&(e.phi=-e.phi)}return e.lam+=this.long0,n.x=e.lam,n.y=e.phi,n}function Ml(n,e,t,i){var s;return n<j?(i.value=Ne.AREA_0,s=0):(s=Math.atan2(e,t),Math.abs(s)<=ke?i.value=Ne.AREA_0:s>ke&&s<=F+ke?(i.value=Ne.AREA_1,s-=F):s>F+ke||s<=-(F+ke)?(i.value=Ne.AREA_2,s=s>=0?s-rt:s+rt):(i.value=Ne.AREA_3,s+=F)),s}function Dr(n,e){var t=n+e;return t<-rt?t+=ia:t>+rt&&(t-=ia),t}var kO=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const NO={init:AO,forward:FO,inverse:OO,names:kO};var pd=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Ao=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Fv=.8487,Ov=1.3523,kv=on/5,DO=1/kv,Tr=18,Mh=function(n,e){return n[0]+e*(n[1]+e*(n[2]+e*n[3]))},GO=function(n,e){return n[1]+e*(2*n[2]+e*3*n[3])};function zO(n,e,t,i){for(var s=e;i;--i){var r=n(s);if(s-=r,Math.abs(r)<t)break}return s}function BO(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function UO(n){var e=q(n.x-this.long0),t=Math.abs(n.y),i=Math.floor(t*kv);i<0?i=0:i>=Tr&&(i=Tr-1),t=on*(t-DO*i);var s={x:Mh(pd[i],t)*e,y:Mh(Ao[i],t)};return n.y<0&&(s.y=-s.y),s.x=s.x*this.a*Fv+this.x0,s.y=s.y*this.a*Ov+this.y0,s}function jO(n){var e={x:(n.x-this.x0)/(this.a*Fv),y:Math.abs(n.y-this.y0)/(this.a*Ov)};if(e.y>=1)e.x/=pd[Tr][0],e.y=n.y<0?-F:F;else{var t=Math.floor(e.y*Tr);for(t<0?t=0:t>=Tr&&(t=Tr-1);;)if(Ao[t][0]>e.y)--t;else if(Ao[t+1][0]<=e.y)++t;else break;var i=Ao[t],s=5*(e.y-i[0])/(Ao[t+1][0]-i[0]);s=zO(function(r){return(Mh(i,r)-e.y)/GO(i,r)},s,j,100),e.x/=Mh(pd[t],s),e.y=(5*t+s)*Ct,n.y<0&&(e.y=-e.y)}return e.x=q(e.x+this.long0),e}var $O=["Robinson","robin"];const qO={init:BO,forward:UO,inverse:jO,names:$O};function VO(){this.name="geocent"}function WO(n){var e=xv(n,this.es,this.a);return e}function HO(n){var e=wv(n,this.es,this.a,this.b);return e}var XO=["Geocentric","geocentric","geocent","Geocent"];const YO={init:VO,forward:WO,inverse:HO,names:XO};var Ot={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},Lo={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function ZO(){if(Object.keys(Lo).forEach((function(t){if(typeof this[t]>"u")this[t]=Lo[t].def;else{if(Lo[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);Lo[t].num&&(this[t]=parseFloat(this[t]))}Lo[t].degrees&&(this[t]=this[t]*Ct)}).bind(this)),Math.abs(Math.abs(this.lat0)-F)<j?this.mode=this.lat0<0?Ot.S_POLE:Ot.N_POLE:Math.abs(this.lat0)<j?this.mode=Ot.EQUIT:(this.mode=Ot.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var n=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(n),this.sw=Math.sin(n)}function KO(n){n.x-=this.long0;var e=Math.sin(n.y),t=Math.cos(n.y),i=Math.cos(n.x),s,r;switch(this.mode){case Ot.OBLIQ:r=this.sinph0*e+this.cosph0*t*i;break;case Ot.EQUIT:r=t*i;break;case Ot.S_POLE:r=-e;break;case Ot.N_POLE:r=e;break}switch(r=this.pn1/(this.p-r),s=r*t*Math.sin(n.x),this.mode){case Ot.OBLIQ:r*=this.cosph0*e-this.sinph0*t*i;break;case Ot.EQUIT:r*=e;break;case Ot.N_POLE:r*=-(t*i);break;case Ot.S_POLE:r*=t*i;break}var o,a;return o=r*this.cg+s*this.sg,a=1/(o*this.sw*this.h1+this.cw),s=(s*this.cg-r*this.sg)*this.cw*a,r=o*a,n.x=s*this.a,n.y=r*this.a,n}function JO(n){n.x/=this.a,n.y/=this.a;var e={x:n.x,y:n.y},t,i,s;s=1/(this.pn1-n.y*this.sw),t=this.pn1*n.x*s,i=this.pn1*n.y*this.cw*s,n.x=t*this.cg+i*this.sg,n.y=i*this.cg-t*this.sg;var r=ji(n.x,n.y);if(Math.abs(r)<j)e.x=0,e.y=n.y;else{var o,a;switch(a=1-r*r*this.pfact,a=(this.p-Math.sqrt(a))/(this.pn1/r+r/this.pn1),o=Math.sqrt(1-a*a),this.mode){case Ot.OBLIQ:e.y=Math.asin(o*this.sinph0+n.y*a*this.cosph0/r),n.y=(o-this.sinph0*Math.sin(e.y))*r,n.x*=a*this.cosph0;break;case Ot.EQUIT:e.y=Math.asin(n.y*a/r),n.y=o*r,n.x*=a;break;case Ot.N_POLE:e.y=Math.asin(o),n.y=-n.y;break;case Ot.S_POLE:e.y=-Math.asin(o);break}e.x=Math.atan2(n.x,n.y)}return n.x=e.x+this.long0,n.y=e.y,n}var QO=["Tilted_Perspective","tpers"];const ek={init:ZO,forward:KO,inverse:JO,names:QO};function tk(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var n=1-this.es,e=1/n;this.radius_p=Math.sqrt(n),this.radius_p2=n,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function ik(n){var e=n.x,t=n.y,i,s,r,o;if(e=e-this.long0,this.shape==="ellipse"){t=Math.atan(this.radius_p2*Math.tan(t));var a=this.radius_p/ji(this.radius_p*Math.cos(t),Math.sin(t));if(s=a*Math.cos(e)*Math.cos(t),r=a*Math.sin(e)*Math.cos(t),o=a*Math.sin(t),(this.radius_g-s)*s-r*r-o*o*this.radius_p_inv2<0)return n.x=Number.NaN,n.y=Number.NaN,n;i=this.radius_g-s,this.flip_axis?(n.x=this.radius_g_1*Math.atan(r/ji(o,i)),n.y=this.radius_g_1*Math.atan(o/i)):(n.x=this.radius_g_1*Math.atan(r/i),n.y=this.radius_g_1*Math.atan(o/ji(r,i)))}else this.shape==="sphere"&&(i=Math.cos(t),s=Math.cos(e)*i,r=Math.sin(e)*i,o=Math.sin(t),i=this.radius_g-s,this.flip_axis?(n.x=this.radius_g_1*Math.atan(r/ji(o,i)),n.y=this.radius_g_1*Math.atan(o/i)):(n.x=this.radius_g_1*Math.atan(r/i),n.y=this.radius_g_1*Math.atan(o/ji(r,i))));return n.x=n.x*this.a,n.y=n.y*this.a,n}function nk(n){var e=-1,t=0,i=0,s,r,o,a;if(n.x=n.x/this.a,n.y=n.y/this.a,this.shape==="ellipse"){this.flip_axis?(i=Math.tan(n.y/this.radius_g_1),t=Math.tan(n.x/this.radius_g_1)*ji(1,i)):(t=Math.tan(n.x/this.radius_g_1),i=Math.tan(n.y/this.radius_g_1)*ji(1,t));var l=i/this.radius_p;if(s=t*t+l*l+e*e,r=2*this.radius_g*e,o=r*r-4*s*this.C,o<0)return n.x=Number.NaN,n.y=Number.NaN,n;a=(-r-Math.sqrt(o))/(2*s),e=this.radius_g+a*e,t*=a,i*=a,n.x=Math.atan2(t,e),n.y=Math.atan(i*Math.cos(n.x)/e),n.y=Math.atan(this.radius_p_inv2*Math.tan(n.y))}else if(this.shape==="sphere"){if(this.flip_axis?(i=Math.tan(n.y/this.radius_g_1),t=Math.tan(n.x/this.radius_g_1)*Math.sqrt(1+i*i)):(t=Math.tan(n.x/this.radius_g_1),i=Math.tan(n.y/this.radius_g_1)*Math.sqrt(1+t*t)),s=t*t+i*i+e*e,r=2*this.radius_g*e,o=r*r-4*s*this.C,o<0)return n.x=Number.NaN,n.y=Number.NaN,n;a=(-r-Math.sqrt(o))/(2*s),e=this.radius_g+a*e,t*=a,i*=a,n.x=Math.atan2(t,e),n.y=Math.atan(i*Math.cos(n.x)/e)}return n.x=n.x+this.long0,n}var sk=["Geostationary Satellite View","Geostationary_Satellite","geos"];const rk={init:tk,forward:ik,inverse:nk,names:sk};function ok(n){n.Proj.projections.add(Fl),n.Proj.projections.add(Ol),n.Proj.projections.add(dA),n.Proj.projections.add(bA),n.Proj.projections.add(RA),n.Proj.projections.add(FA),n.Proj.projections.add(zA),n.Proj.projections.add(qA),n.Proj.projections.add(YA),n.Proj.projections.add(eF),n.Proj.projections.add(yF),n.Proj.projections.add(EF),n.Proj.projections.add(RF),n.Proj.projections.add(OF),n.Proj.projections.add(zF),n.Proj.projections.add(qF),n.Proj.projections.add(YF),n.Proj.projections.add(eO),n.Proj.projections.add(oO),n.Proj.projections.add(uO),n.Proj.projections.add(mO),n.Proj.projections.add(wO),n.Proj.projections.add(SO),n.Proj.projections.add(PO),n.Proj.projections.add(NO),n.Proj.projections.add(qO),n.Proj.projections.add(YO),n.Proj.projections.add(ek),n.Proj.projections.add(rk)}Yt.defaultDatum="WGS84";Yt.Proj=un;Yt.WGS84=new Yt.Proj("WGS84");Yt.Point=ho;Yt.toPoint=bv;Yt.defs=Ut;Yt.nadgrid=gP;Yt.transform=Eh;Yt.mgrs=IP;Yt.version="__VERSION__";ok(Yt);let ak=null;function lk(n){ak=n;const e=Object.keys(n.defs),t=e.length;let i,s;for(i=0;i<t;++i){const r=e[i];if(!X(r)){const o=n.defs(r);let a=o.units;!a&&o.projName==="longlat"&&(a="degrees"),Fy(new Vh({code:r,axisOrientation:o.axis,metersPerUnit:o.to_meter,units:a}))}}for(i=0;i<t;++i){const r=e[i],o=X(r);for(s=0;s<t;++s){const a=e[s],l=X(a);if(!Cy(r,a))if(n.defs[r]===n.defs[a])Mu([o,l]);else{const h=n(r,a);O1(o,l,Ug(o,l,h.forward),Ug(l,o,h.inverse))}}}}class hu{constructor(e){_(this,"id");_(this,"name");_(this,"layersList",[]);this.id=e.id,this.name=e.name}get projection(){return this.layersList[0]instanceof xh?this.layersList[0].projection:null}}class hk{constructor(e){_(this,"id");_(this,"icon");_(this,"name");_(this,"location");_(this,"zoom");_(this,"favorite");_(this,"layersTree",[]);this.id=e.id,this.name=e.name,this.icon=e.icon,this.location=e.location,this.zoom=e.zoom,this.favorite=e.favorite}}class ck extends In{constructor(t){super(t);_(this,"configManager");_(this,"stateManager");_(this,"layerManager");this.configManager=ns.getInstance(),this.stateManager=an.getInstance(),this.layerManager=ya.getInstance(),this.configManager.loadConfig().then(()=>{this.loadThemes()}).then(()=>{console.log("Themes were loaded")}),this.stateManager.subscribe("selectedTheme",(i,s)=>this.onChangeTheme(s))}get state(){return this.stateManager.state}async loadThemes(){const i=await(await fetch(this.configManager.Config.themes.url)).json();this.state.ogcServers=i.ogcServers,this.configManager.Config.basemaps.show&&(this.state.basemaps=this.prepareBasemaps(i.background_layers)),this.state.themes=this.prepareThemes(i.themes),this.setDefaultTheme()}setDefaultTheme(){if(!this.isNullOrUndefinedOrBlank(this.configManager.Config.themes.defaultTheme)){const i=Object.values(this.state.themes).find(s=>s.name===this.configManager.Config.themes.defaultTheme);i?this.state.selectedTheme=i:console.warn(`The default theme ${this.configManager.Config.themes.defaultTheme} could not be found.`)}}prepareBasemaps(t){const i={};if(this.configManager.Config.basemaps.OSM){const s=new hu({id:-1,name:"OpenStreetMap"});i[s.id]=s;const r={id:"-1",name:"OpenStreetMap",type:"OSM"};s.layersList.push(new hd(r,0))}if(this.configManager.Config.basemaps.SwissTopoVectorTiles){const s=new hu({id:-2,name:"Vector-Tiles"});i[s.id]=s;const r={id:"-2",name:"Vector-Tiles",type:"VectorTiles",style:"https://vectortiles.geo.admin.ch/styles/ch.swisstopo.leichte-basiskarte.vt/style.json",source:"leichtebasiskarte_v3.0.1",projection:"EPSG:3857"};s.layersList.push(new xh(r,0))}return t.forEach(s=>{const r=new hu(s);i[r.id]=r;const o={value:0};s.children?s.children.forEach(a=>{r.layersList.push(this.prepareThemeLayer(a,null,o))}):r.layersList.push(this.prepareThemeLayer(s,null,o))}),i}prepareThemes(t){const i={},s={value:0};return t.forEach((r,o)=>{!r.icon.startsWith("http")&&this.configManager.Config.themes.imagesUrlPrefix&&(r.icon=this.configManager.Config.themes.imagesUrlPrefix+r.icon);const a=new hk(r);r.children.forEach(l=>{const h=this.prepareThemeLayer(l,null,s);a.layersTree.push(h)}),i[o]=a}),i}prepareThemeLayer(t,i,s){const r=t.ogcServer?t.ogcServer:i;let o;switch(t.type){case"OSM":o=new hd(t,s.value);break;case"VectorTiles":o=new xh(t,s.value);break;case"WMTS":o=new ur(t,s.value);break;case"WMS":if(r){const l=this.state.ogcServers[r],h=l.wfsSupport?l.urlWfs:null;o=new ht(t,r,l.url,h,s.value)}else o=new En(t,s.value),this.layerManager.setError(o,`No OGC-Server was found for layer ${t.name}, please verify the backend configuration.`);break;default:const a=new Qt(t,s.value);t.children&&t.children.forEach(l=>{const h=this.prepareThemeLayer(l,r,s);h.parent=a,a.children.push(h)}),o=a}return s.value=s.value+1,o}onChangeTheme(t){for(let s=0;s<this.state.layers.layersList.length;++s)this.state.layers.layersList[s].activeState="off";const i=[];t.layersTree.forEach(s=>{this.addLayerToLoadedList(i,s)}),this.state.layers.layersList=i}addLayerToLoadedList(t,i){t.push(i),i instanceof Qt&&i.children.forEach(s=>{this.addLayerToLoadedList(t,s)})}}window.CESIUM_BASE_URL="/lib/cesium/";Yt.defs("EPSG:21781","+proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +k_0=1 +x_0=600000 +y_0=200000 +ellps=bessel +towgs84=660.077,13.551,369.344,2.484,1.783,2.939,5.66 +units=m +no_defs");Yt.defs("EPSG:2056","+proj=somerc +lat_0=46.9524055555556 +lon_0=7.43958333333333 +k_0=1 +x_0=2600000 +y_0=1200000 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +units=m +no_defs +type=crs");lk(Yt);zo.setDefaultProps({maxWidth:""});ck.getInstance();S0.getInstance();document.state=an.getInstance().state});export default uk();
//# sourceMappingURL=index-853be8fd.js.map
