var Gv=Object.defineProperty;var Hv=(r,e,t)=>e in r?Gv(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var K=(r,e,t)=>Hv(r,typeof e!="symbol"?e+"":e,t);const Vv={9001:"m",9002:"ft",9003:"us-ft",9101:"radians",9102:"degrees"};function Ik(r){return Vv[r]}const So={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class Wv{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==void 0?e.extent:null,this.worldExtent_=e.worldExtent!==void 0?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==void 0?e.axisOrientation:"enu",this.global_=e.global!==void 0?e.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||So[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const Pc=Wv,Xo=6378137,as=Math.PI*Xo,Uv=[-as,-as,as,as],Yv=[-180,-85,180,85],ga=Xo*Math.log(Math.tan(Math.PI/2));class $r extends Pc{constructor(e){super({code:e,units:"m",extent:Uv,global:!0,worldExtent:Yv,getPointResolution:function(t,i){return t/Math.cosh(i[1]/Xo)}})}}const Rf=[new $r("EPSG:3857"),new $r("EPSG:102100"),new $r("EPSG:102113"),new $r("EPSG:900913"),new $r("http://www.opengis.net/def/crs/EPSG/0/3857"),new $r("http://www.opengis.net/gml/srs/epsg.xml#3857")];function jv(r,e,t){const i=r.length;t=t>1?t:2,e===void 0&&(t>2?e=r.slice():e=new Array(i));for(let n=0;n<i;n+=t){e[n]=as*r[n]/180;let s=Xo*Math.log(Math.tan(Math.PI*(+r[n+1]+90)/360));s>ga?s=ga:s<-ga&&(s=-ga),e[n+1]=s}return e}function Xv(r,e,t){const i=r.length;t=t>1?t:2,e===void 0&&(t>2?e=r.slice():e=new Array(i));for(let n=0;n<i;n+=t)e[n]=180*r[n]/as,e[n+1]=360*Math.atan(Math.exp(r[n+1]/Xo))/Math.PI-90;return e}const $v=6378137,Sf=[-180,-90,180,90],Zv=Math.PI*$v/180;class gr extends Pc{constructor(e,t){super({code:e,units:"degrees",extent:Sf,axisOrientation:t,global:!0,metersPerUnit:Zv,worldExtent:Sf})}}const Tf=[new gr("CRS:84"),new gr("EPSG:4326","neu"),new gr("urn:ogc:def:crs:OGC:1.3:CRS84"),new gr("urn:ogc:def:crs:OGC:2:84"),new gr("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new gr("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new gr("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let gu={};function Kv(r){return gu[r]||gu[r.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function qv(r,e){gu[r]=e}function $o(r){for(const e in r)delete r[e]}function Dr(r){let e;for(e in r)return!1;return!e}let ms={};function Es(r,e,t){const i=r.getCode(),n=e.getCode();i in ms||(ms[i]={}),ms[i][n]=t}function Jv(r,e){let t;return r in ms&&e in ms[r]&&(t=ms[r][e]),t}const ft={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function To(r){const e=oi();for(let t=0,i=r.length;t<i;++t)fo(e,r[t]);return e}function Qv(r,e,t){const i=Math.min.apply(null,r),n=Math.min.apply(null,e),s=Math.max.apply(null,r),o=Math.max.apply(null,e);return _i(i,n,s,o,t)}function kr(r,e,t){return t?(t[0]=r[0]-e,t[1]=r[1]-e,t[2]=r[2]+e,t[3]=r[3]+e,t):[r[0]-e,r[1]-e,r[2]+e,r[3]+e]}function Zp(r,e){return e?(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e):r.slice()}function Wr(r,e,t){let i,n;return e<r[0]?i=r[0]-e:r[2]<e?i=e-r[2]:i=0,t<r[1]?n=r[1]-t:r[3]<t?n=t-r[3]:n=0,i*i+n*n}function Nr(r,e){return Fc(r,e[0],e[1])}function mi(r,e){return r[0]<=e[0]&&e[2]<=r[2]&&r[1]<=e[1]&&e[3]<=r[3]}function Fc(r,e,t){return r[0]<=e&&e<=r[2]&&r[1]<=t&&t<=r[3]}function pu(r,e){const t=r[0],i=r[1],n=r[2],s=r[3],o=e[0],a=e[1];let l=ft.UNKNOWN;return o<t?l=l|ft.LEFT:o>n&&(l=l|ft.RIGHT),a<i?l=l|ft.BELOW:a>s&&(l=l|ft.ABOVE),l===ft.UNKNOWN&&(l=ft.INTERSECTING),l}function oi(){return[1/0,1/0,-1/0,-1/0]}function _i(r,e,t,i,n){return n?(n[0]=r,n[1]=e,n[2]=t,n[3]=i,n):[r,e,t,i]}function zs(r){return _i(1/0,1/0,-1/0,-1/0,r)}function Kp(r,e){const t=r[0],i=r[1];return _i(t,i,t,i,e)}function Oc(r,e,t,i,n){const s=zs(n);return Jp(s,r,e,t,i)}function zr(r,e){return r[0]==e[0]&&r[2]==e[2]&&r[1]==e[1]&&r[3]==e[3]}function qp(r,e){return e[0]<r[0]&&(r[0]=e[0]),e[2]>r[2]&&(r[2]=e[2]),e[1]<r[1]&&(r[1]=e[1]),e[3]>r[3]&&(r[3]=e[3]),r}function fo(r,e){e[0]<r[0]&&(r[0]=e[0]),e[0]>r[2]&&(r[2]=e[0]),e[1]<r[1]&&(r[1]=e[1]),e[1]>r[3]&&(r[3]=e[1])}function Jp(r,e,t,i,n){for(;t<i;t+=n)ew(r,e[t],e[t+1]);return r}function ew(r,e,t){r[0]=Math.min(r[0],e),r[1]=Math.min(r[1],t),r[2]=Math.max(r[2],e),r[3]=Math.max(r[3],t)}function Dc(r,e){let t;return t=e(Fl(r)),t||(t=e(Ol(r)),t)||(t=e(Dl(r)),t)||(t=e(lr(r)),t)?t:!1}function mu(r){let e=0;return Ur(r)||(e=Pe(r)*st(r)),e}function Fl(r){return[r[0],r[1]]}function Ol(r){return[r[2],r[1]]}function en(r){return[(r[0]+r[2])/2,(r[1]+r[3])/2]}function tw(r,e){let t;if(e==="bottom-left")t=Fl(r);else if(e==="bottom-right")t=Ol(r);else if(e==="top-left")t=lr(r);else if(e==="top-right")t=Dl(r);else throw new Error("Invalid corner");return t}function Mo(r,e,t,i,n){const[s,o,a,l,h,u,c,d]=bu(r,e,t,i);return _i(Math.min(s,a,h,c),Math.min(o,l,u,d),Math.max(s,a,h,c),Math.max(o,l,u,d),n)}function bu(r,e,t,i){const n=e*i[0]/2,s=e*i[1]/2,o=Math.cos(t),a=Math.sin(t),l=n*o,h=n*a,u=s*o,c=s*a,d=r[0],f=r[1];return[d-l+c,f-h-u,d-l-c,f-h+u,d+l-c,f+h+u,d+l+c,f+h-u,d-l+c,f-h-u]}function st(r){return r[3]-r[1]}function ir(r,e,t){const i=t||oi();return ht(r,e)?(r[0]>e[0]?i[0]=r[0]:i[0]=e[0],r[1]>e[1]?i[1]=r[1]:i[1]=e[1],r[2]<e[2]?i[2]=r[2]:i[2]=e[2],r[3]<e[3]?i[3]=r[3]:i[3]=e[3]):zs(i),i}function lr(r){return[r[0],r[3]]}function Dl(r){return[r[2],r[3]]}function Pe(r){return r[2]-r[0]}function ht(r,e){return r[0]<=e[2]&&r[2]>=e[0]&&r[1]<=e[3]&&r[3]>=e[1]}function Ur(r){return r[2]<r[0]||r[3]<r[1]}function iw(r,e){return e?(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e):r}function nw(r,e,t){let i=!1;const n=pu(r,e),s=pu(r,t);if(n===ft.INTERSECTING||s===ft.INTERSECTING)i=!0;else{const o=r[0],a=r[1],l=r[2],h=r[3],u=e[0],c=e[1],d=t[0],f=t[1],g=(f-c)/(d-u);let m,w;s&ft.ABOVE&&!(n&ft.ABOVE)&&(m=d-(f-h)/g,i=m>=o&&m<=l),!i&&s&ft.RIGHT&&!(n&ft.RIGHT)&&(w=f-(d-l)*g,i=w>=a&&w<=h),!i&&s&ft.BELOW&&!(n&ft.BELOW)&&(m=d-(f-a)/g,i=m>=o&&m<=l),!i&&s&ft.LEFT&&!(n&ft.LEFT)&&(w=f-(d-o)*g,i=w>=a&&w<=h)}return i}function rw(r,e,t,i){if(Ur(r))return zs(t);let n=[];if(i>1){const a=r[2]-r[0],l=r[3]-r[1];for(let h=0;h<i;++h)n.push(r[0]+a*h/i,r[1],r[2],r[1]+l*h/i,r[2]-a*h/i,r[3],r[0],r[3]-l*h/i)}else n=[r[0],r[1],r[2],r[1],r[2],r[3],r[0],r[3]];e(n,n,2);const s=[],o=[];for(let a=0,l=n.length;a<l;a+=2)s.push(n[a]),o.push(n[a+1]);return Qv(s,o,t)}function Qp(r,e){const t=e.getExtent(),i=en(r);if(e.canWrapX()&&(i[0]<t[0]||i[0]>=t[2])){const n=Pe(t),o=Math.floor((i[0]-t[0])/n)*n;r[0]-=o,r[2]-=o}return r}function sw(r,e){if(e.canWrapX()){const t=e.getExtent();if(!isFinite(r[0])||!isFinite(r[2]))return[[t[0],r[1],t[2],r[3]]];Qp(r,e);const i=Pe(t);if(Pe(r)>i)return[[t[0],r[1],t[2],r[3]]];if(r[0]<t[0])return[[r[0]+i,r[1],t[2],r[3]],[t[0],r[1],r[2],r[3]]];if(r[2]>t[2])return[[r[0],r[1],t[2],r[3]],[t[0],r[1],r[2]-i,r[3]]]}return[r]}function it(r,e,t){return Math.min(Math.max(r,e),t)}function ow(r,e,t,i,n,s){const o=n-t,a=s-i;if(o!==0||a!==0){const l=((r-t)*o+(e-i)*a)/(o*o+a*a);l>1?(t=n,i=s):l>0&&(t+=o*l,i+=a*l)}return Lr(r,e,t,i)}function Lr(r,e,t,i){const n=t-r,s=i-e;return n*n+s*s}function aw(r){const e=r.length;for(let i=0;i<e;i++){let n=i,s=Math.abs(r[i][i]);for(let a=i+1;a<e;a++){const l=Math.abs(r[a][i]);l>s&&(s=l,n=a)}if(s===0)return null;const o=r[n];r[n]=r[i],r[i]=o;for(let a=i+1;a<e;a++){const l=-r[a][i]/r[i][i];for(let h=i;h<e+1;h++)i==h?r[a][h]=0:r[a][h]+=l*r[i][h]}}const t=new Array(e);for(let i=e-1;i>=0;i--){t[i]=r[i][e]/r[i][i];for(let n=i-1;n>=0;n--)r[n][e]-=r[n][i]*t[i]}return t}function yu(r){return r*180/Math.PI}function Ar(r){return r*Math.PI/180}function nr(r,e){const t=r%e;return t*e<0?t+e:t}function ii(r,e,t){return r+t*(e-r)}function kl(r,e){const t=Math.pow(10,e);return Math.round(r*t)/t}function Mf(r,e){return Math.round(kl(r,e))}function ls(r,e){return Math.floor(kl(r,e))}function Kn(r,e){return Math.ceil(kl(r,e))}function Ks(r,e,t){const i=t!==void 0?r.toFixed(t):""+r;let n=i.indexOf(".");return n=n===-1?i.length:n,n>e?i:new Array(1+e-n).join("0")+i}function kc(r,e){const t=(""+r).split("."),i=(""+e).split(".");for(let n=0;n<Math.max(t.length,i.length);n++){const s=parseInt(t[n]||"0",10),o=parseInt(i[n]||"0",10);if(s>o)return 1;if(o>s)return-1}return 0}function lw(r,e){return r[0]+=+e[0],r[1]+=+e[1],r}function Pk(r,e){const t=e.getRadius(),i=e.getCenter(),n=i[0],s=i[1],o=r[0],a=r[1];let l=o-n;const h=a-s;l===0&&h===0&&(l=1);const u=Math.sqrt(l*l+h*h),c=n+t*l/u,d=s+t*h/u;return[c,d]}function hw(r,e){const t=r[0],i=r[1],n=e[0],s=e[1],o=n[0],a=n[1],l=s[0],h=s[1],u=l-o,c=h-a,d=u===0&&c===0?0:(u*(t-o)+c*(i-a))/(u*u+c*c||0);let f,g;return d<=0?(f=o,g=a):d>=1?(f=l,g=h):(f=o+d*u,g=a+d*c),[f,g]}function Za(r,e){let t=!0;for(let i=r.length-1;i>=0;--i)if(r[i]!=e[i]){t=!1;break}return t}function Nc(r,e){const t=Math.cos(e),i=Math.sin(e),n=r[0]*t-r[1]*i,s=r[1]*t+r[0]*i;return r[0]=n,r[1]=s,r}function uw(r,e){return r[0]*=e,r[1]*=e,r}function em(r,e){const t=r[0]-e[0],i=r[1]-e[1];return t*t+i*i}function Fk(r,e){return Math.sqrt(em(r,e))}function Ok(r,e){return em(r,hw(r,e))}function zc(r,e){if(e.canWrapX()){const t=Pe(e.getExtent()),i=tm(r,e,t);i&&(r[0]-=i*t)}return r}function tm(r,e,t){const i=e.getExtent();let n=0;return e.canWrapX()&&(r[0]<i[0]||r[0]>i[2])&&(t=t||Pe(i),n=Math.floor((r[0]-i[0])/t)),n}const im=63710088e-1;function Lf(r,e,t){t=t||im;const i=Ar(r[1]),n=Ar(e[1]),s=(n-i)/2,o=Ar(e[0]-r[0])/2,a=Math.sin(s)*Math.sin(s)+Math.sin(o)*Math.sin(o)*Math.cos(i)*Math.cos(n);return 2*t*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function cw(r,e,t,i){i=i||im;const n=Ar(r[1]),s=Ar(r[0]),o=e/i,a=Math.asin(Math.sin(n)*Math.cos(o)+Math.cos(n)*Math.sin(o)*Math.cos(t)),l=s+Math.atan2(Math.sin(t)*Math.sin(o)*Math.cos(n),Math.cos(o)-Math.sin(n)*Math.sin(a));return[yu(l),yu(a)]}function nm(...r){console.warn(...r)}function Dk(...r){console.error(...r)}let vu=!0;function rm(r){vu=!(r===void 0?!0:r)}function Bc(r,e){if(e!==void 0){for(let t=0,i=r.length;t<i;++t)e[t]=r[t];e=e}else e=r.slice();return e}function sm(r,e){if(e!==void 0&&r!==e){for(let t=0,i=r.length;t<i;++t)e[t]=r[t];r=e}return r}function dw(r){qv(r.getCode(),r),Es(r,r,Bc)}function fw(r){r.forEach(dw)}function we(r){return typeof r=="string"?Kv(r):r||null}function Af(r,e,t,i){r=we(r);let n;const s=r.getPointResolutionFunc();if(s){if(n=s(e,t),i&&i!==r.getUnits()){const o=r.getMetersPerUnit();o&&(n=n*o/So[i])}}else{const o=r.getUnits();if(o=="degrees"&&!i||i=="degrees")n=e;else{const a=Nl(r,we("EPSG:4326"));if(a===sm&&o!=="degrees")n=e*r.getMetersPerUnit();else{let h=[t[0]-e/2,t[1],t[0]+e/2,t[1],t[0],t[1]-e/2,t[0],t[1]+e/2];h=a(h,h,2);const u=Lf(h.slice(0,2),h.slice(2,4)),c=Lf(h.slice(4,6),h.slice(6,8));n=(u+c)/2}const l=i?So[i]:r.getMetersPerUnit();l!==void 0&&(n/=l)}}return n}function If(r){fw(r),r.forEach(function(e){r.forEach(function(t){e!==t&&Es(e,t,Bc)})})}function gw(r,e,t,i){r.forEach(function(n){e.forEach(function(s){Es(n,s,t),Es(s,n,i)})})}function Gc(r,e){return r?typeof r=="string"?we(r):r:we(e)}function Pf(r){return function(e,t,i){const n=e.length;i=i!==void 0?i:2,t=t!==void 0?t:new Array(n);for(let s=0;s<n;s+=i){const o=r(e.slice(s,s+i)),a=o.length;for(let l=0,h=i;l<h;++l)t[s+l]=l>=a?e[s+l]:o[l]}return t}}function kk(r,e,t,i){const n=we(r),s=we(e);Es(n,s,Pf(t)),Es(s,n,Pf(i))}function Nk(r,e){return rm(),zl(r,"EPSG:4326",e!==void 0?e:"EPSG:3857")}function pi(r,e){if(r===e)return!0;const t=r.getUnits()===e.getUnits();return(r.getCode()===e.getCode()||Nl(r,e)===Bc)&&t}function Nl(r,e){const t=r.getCode(),i=e.getCode();let n=Jv(t,i);return n||(n=sm),n}function _s(r,e){const t=we(r),i=we(e);return Nl(t,i)}function zl(r,e,t){return _s(e,t)(r,void 0,r.length)}function om(r,e,t,i){const n=_s(e,t);return rw(r,n,void 0,i)}let pw=null;function mw(){return pw}function wu(r,e){return r}function pn(r,e){return vu&&!Za(r,[0,0])&&r[0]>=-180&&r[0]<=180&&r[1]>=-90&&r[1]<=90&&(vu=!1,nm("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),r}function Hc(r,e){return r}function Cn(r,e){return r}function zk(r,e,t){return function(i){let n,s;if(r.canWrapX()){const o=r.getExtent(),a=Pe(o);i=i.slice(0),s=tm(i,r,a),s&&(i[0]=i[0]-s*a),i[0]=it(i[0],o[0],o[2]),i[1]=it(i[1],o[1],o[3]),n=t(i)}else n=t(i);return s&&e.canWrapX()&&(n[0]+=s*Pe(e.getExtent())),n}}function bw(){If(Rf),If(Tf),gw(Tf,Rf,jv,Xv)}bw();var Xt="top",Ci="bottom",xi="right",$t="left",Vc="auto",Zo=[Xt,Ci,xi,$t],Cs="start",Lo="end",yw="clippingParents",am="viewport",qs="popper",vw="reference",Ff=Zo.reduce(function(r,e){return r.concat([e+"-"+Cs,e+"-"+Lo])},[]),lm=[].concat(Zo,[Vc]).reduce(function(r,e){return r.concat([e,e+"-"+Cs,e+"-"+Lo])},[]),ww="beforeRead",Ew="read",_w="afterRead",Cw="beforeMain",xw="main",Rw="afterMain",Sw="beforeWrite",Tw="write",Mw="afterWrite",Lw=[ww,Ew,_w,Cw,xw,Rw,Sw,Tw,Mw];function tn(r){return r?(r.nodeName||"").toLowerCase():null}function ai(r){if(r==null)return window;if(r.toString()!=="[object Window]"){var e=r.ownerDocument;return e&&e.defaultView||window}return r}function Br(r){var e=ai(r).Element;return r instanceof e||r instanceof Element}function wi(r){var e=ai(r).HTMLElement;return r instanceof e||r instanceof HTMLElement}function Wc(r){if(typeof ShadowRoot>"u")return!1;var e=ai(r).ShadowRoot;return r instanceof e||r instanceof ShadowRoot}function Aw(r){var e=r.state;Object.keys(e.elements).forEach(function(t){var i=e.styles[t]||{},n=e.attributes[t]||{},s=e.elements[t];!wi(s)||!tn(s)||(Object.assign(s.style,i),Object.keys(n).forEach(function(o){var a=n[o];a===!1?s.removeAttribute(o):s.setAttribute(o,a===!0?"":a)}))})}function Iw(r){var e=r.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(i){var n=e.elements[i],s=e.attributes[i]||{},o=Object.keys(e.styles.hasOwnProperty(i)?e.styles[i]:t[i]),a=o.reduce(function(l,h){return l[h]="",l},{});!wi(n)||!tn(n)||(Object.assign(n.style,a),Object.keys(s).forEach(function(l){n.removeAttribute(l)}))})}}const hm={name:"applyStyles",enabled:!0,phase:"write",fn:Aw,effect:Iw,requires:["computeStyles"]};function Ki(r){return r.split("-")[0]}var Ir=Math.max,Ka=Math.min,xs=Math.round;function Eu(){var r=navigator.userAgentData;return r!=null&&r.brands&&Array.isArray(r.brands)?r.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function um(){return!/^((?!chrome|android).)*safari/i.test(Eu())}function Rs(r,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var i=r.getBoundingClientRect(),n=1,s=1;e&&wi(r)&&(n=r.offsetWidth>0&&xs(i.width)/r.offsetWidth||1,s=r.offsetHeight>0&&xs(i.height)/r.offsetHeight||1);var o=Br(r)?ai(r):window,a=o.visualViewport,l=!um()&&t,h=(i.left+(l&&a?a.offsetLeft:0))/n,u=(i.top+(l&&a?a.offsetTop:0))/s,c=i.width/n,d=i.height/s;return{width:c,height:d,top:u,right:h+c,bottom:u+d,left:h,x:h,y:u}}function Uc(r){var e=Rs(r),t=r.offsetWidth,i=r.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-i)<=1&&(i=e.height),{x:r.offsetLeft,y:r.offsetTop,width:t,height:i}}function cm(r,e){var t=e.getRootNode&&e.getRootNode();if(r.contains(e))return!0;if(t&&Wc(t)){var i=e;do{if(i&&r.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function Ln(r){return ai(r).getComputedStyle(r)}function Pw(r){return["table","td","th"].indexOf(tn(r))>=0}function hr(r){return((Br(r)?r.ownerDocument:r.document)||window.document).documentElement}function Bl(r){return tn(r)==="html"?r:r.assignedSlot||r.parentNode||(Wc(r)?r.host:null)||hr(r)}function Of(r){return!wi(r)||Ln(r).position==="fixed"?null:r.offsetParent}function Fw(r){var e=/firefox/i.test(Eu()),t=/Trident/i.test(Eu());if(t&&wi(r)){var i=Ln(r);if(i.position==="fixed")return null}var n=Bl(r);for(Wc(n)&&(n=n.host);wi(n)&&["html","body"].indexOf(tn(n))<0;){var s=Ln(n);if(s.transform!=="none"||s.perspective!=="none"||s.contain==="paint"||["transform","perspective"].indexOf(s.willChange)!==-1||e&&s.willChange==="filter"||e&&s.filter&&s.filter!=="none")return n;n=n.parentNode}return null}function Ko(r){for(var e=ai(r),t=Of(r);t&&Pw(t)&&Ln(t).position==="static";)t=Of(t);return t&&(tn(t)==="html"||tn(t)==="body"&&Ln(t).position==="static")?e:t||Fw(r)||e}function Yc(r){return["top","bottom"].indexOf(r)>=0?"x":"y"}function go(r,e,t){return Ir(r,Ka(e,t))}function Ow(r,e,t){var i=go(r,e,t);return i>t?t:i}function dm(){return{top:0,right:0,bottom:0,left:0}}function fm(r){return Object.assign({},dm(),r)}function gm(r,e){return e.reduce(function(t,i){return t[i]=r,t},{})}var Dw=function(e,t){return e=typeof e=="function"?e(Object.assign({},t.rects,{placement:t.placement})):e,fm(typeof e!="number"?e:gm(e,Zo))};function kw(r){var e,t=r.state,i=r.name,n=r.options,s=t.elements.arrow,o=t.modifiersData.popperOffsets,a=Ki(t.placement),l=Yc(a),h=[$t,xi].indexOf(a)>=0,u=h?"height":"width";if(!(!s||!o)){var c=Dw(n.padding,t),d=Uc(s),f=l==="y"?Xt:$t,g=l==="y"?Ci:xi,m=t.rects.reference[u]+t.rects.reference[l]-o[l]-t.rects.popper[u],w=o[l]-t.rects.reference[l],y=Ko(s),E=y?l==="y"?y.clientHeight||0:y.clientWidth||0:0,x=m/2-w/2,v=c[f],S=E-d[u]-c[g],R=E/2-d[u]/2+x,L=go(v,R,S),C=l;t.modifiersData[i]=(e={},e[C]=L,e.centerOffset=L-R,e)}}function Nw(r){var e=r.state,t=r.options,i=t.element,n=i===void 0?"[data-popper-arrow]":i;n!=null&&(typeof n=="string"&&(n=e.elements.popper.querySelector(n),!n)||cm(e.elements.popper,n)&&(e.elements.arrow=n))}const zw={name:"arrow",enabled:!0,phase:"main",fn:kw,effect:Nw,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Ss(r){return r.split("-")[1]}var Bw={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Gw(r,e){var t=r.x,i=r.y,n=e.devicePixelRatio||1;return{x:xs(t*n)/n||0,y:xs(i*n)/n||0}}function Df(r){var e,t=r.popper,i=r.popperRect,n=r.placement,s=r.variation,o=r.offsets,a=r.position,l=r.gpuAcceleration,h=r.adaptive,u=r.roundOffsets,c=r.isFixed,d=o.x,f=d===void 0?0:d,g=o.y,m=g===void 0?0:g,w=typeof u=="function"?u({x:f,y:m}):{x:f,y:m};f=w.x,m=w.y;var y=o.hasOwnProperty("x"),E=o.hasOwnProperty("y"),x=$t,v=Xt,S=window;if(h){var R=Ko(t),L="clientHeight",C="clientWidth";if(R===ai(t)&&(R=hr(t),Ln(R).position!=="static"&&a==="absolute"&&(L="scrollHeight",C="scrollWidth")),R=R,n===Xt||(n===$t||n===xi)&&s===Lo){v=Ci;var M=c&&R===S&&S.visualViewport?S.visualViewport.height:R[L];m-=M-i.height,m*=l?1:-1}if(n===$t||(n===Xt||n===Ci)&&s===Lo){x=xi;var D=c&&R===S&&S.visualViewport?S.visualViewport.width:R[C];f-=D-i.width,f*=l?1:-1}}var A=Object.assign({position:a},h&&Bw),k=u===!0?Gw({x:f,y:m},ai(t)):{x:f,y:m};if(f=k.x,m=k.y,l){var V;return Object.assign({},A,(V={},V[v]=E?"0":"",V[x]=y?"0":"",V.transform=(S.devicePixelRatio||1)<=1?"translate("+f+"px, "+m+"px)":"translate3d("+f+"px, "+m+"px, 0)",V))}return Object.assign({},A,(e={},e[v]=E?m+"px":"",e[x]=y?f+"px":"",e.transform="",e))}function Hw(r){var e=r.state,t=r.options,i=t.gpuAcceleration,n=i===void 0?!0:i,s=t.adaptive,o=s===void 0?!0:s,a=t.roundOffsets,l=a===void 0?!0:a,h={placement:Ki(e.placement),variation:Ss(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:n,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,Df(Object.assign({},h,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:o,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,Df(Object.assign({},h,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const Vw={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Hw,data:{}};var pa={passive:!0};function Ww(r){var e=r.state,t=r.instance,i=r.options,n=i.scroll,s=n===void 0?!0:n,o=i.resize,a=o===void 0?!0:o,l=ai(e.elements.popper),h=[].concat(e.scrollParents.reference,e.scrollParents.popper);return s&&h.forEach(function(u){u.addEventListener("scroll",t.update,pa)}),a&&l.addEventListener("resize",t.update,pa),function(){s&&h.forEach(function(u){u.removeEventListener("scroll",t.update,pa)}),a&&l.removeEventListener("resize",t.update,pa)}}const Uw={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Ww,data:{}};var Yw={left:"right",right:"left",bottom:"top",top:"bottom"};function za(r){return r.replace(/left|right|bottom|top/g,function(e){return Yw[e]})}var jw={start:"end",end:"start"};function kf(r){return r.replace(/start|end/g,function(e){return jw[e]})}function jc(r){var e=ai(r),t=e.pageXOffset,i=e.pageYOffset;return{scrollLeft:t,scrollTop:i}}function Xc(r){return Rs(hr(r)).left+jc(r).scrollLeft}function Xw(r,e){var t=ai(r),i=hr(r),n=t.visualViewport,s=i.clientWidth,o=i.clientHeight,a=0,l=0;if(n){s=n.width,o=n.height;var h=um();(h||!h&&e==="fixed")&&(a=n.offsetLeft,l=n.offsetTop)}return{width:s,height:o,x:a+Xc(r),y:l}}function $w(r){var e,t=hr(r),i=jc(r),n=(e=r.ownerDocument)==null?void 0:e.body,s=Ir(t.scrollWidth,t.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),o=Ir(t.scrollHeight,t.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),a=-i.scrollLeft+Xc(r),l=-i.scrollTop;return Ln(n||t).direction==="rtl"&&(a+=Ir(t.clientWidth,n?n.clientWidth:0)-s),{width:s,height:o,x:a,y:l}}function $c(r){var e=Ln(r),t=e.overflow,i=e.overflowX,n=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+n+i)}function pm(r){return["html","body","#document"].indexOf(tn(r))>=0?r.ownerDocument.body:wi(r)&&$c(r)?r:pm(Bl(r))}function po(r,e){var t;e===void 0&&(e=[]);var i=pm(r),n=i===((t=r.ownerDocument)==null?void 0:t.body),s=ai(i),o=n?[s].concat(s.visualViewport||[],$c(i)?i:[]):i,a=e.concat(o);return n?a:a.concat(po(Bl(o)))}function _u(r){return Object.assign({},r,{left:r.x,top:r.y,right:r.x+r.width,bottom:r.y+r.height})}function Zw(r,e){var t=Rs(r,!1,e==="fixed");return t.top=t.top+r.clientTop,t.left=t.left+r.clientLeft,t.bottom=t.top+r.clientHeight,t.right=t.left+r.clientWidth,t.width=r.clientWidth,t.height=r.clientHeight,t.x=t.left,t.y=t.top,t}function Nf(r,e,t){return e===am?_u(Xw(r,t)):Br(e)?Zw(e,t):_u($w(hr(r)))}function Kw(r){var e=po(Bl(r)),t=["absolute","fixed"].indexOf(Ln(r).position)>=0,i=t&&wi(r)?Ko(r):r;return Br(i)?e.filter(function(n){return Br(n)&&cm(n,i)&&tn(n)!=="body"}):[]}function qw(r,e,t,i){var n=e==="clippingParents"?Kw(r):[].concat(e),s=[].concat(n,[t]),o=s[0],a=s.reduce(function(l,h){var u=Nf(r,h,i);return l.top=Ir(u.top,l.top),l.right=Ka(u.right,l.right),l.bottom=Ka(u.bottom,l.bottom),l.left=Ir(u.left,l.left),l},Nf(r,o,i));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function mm(r){var e=r.reference,t=r.element,i=r.placement,n=i?Ki(i):null,s=i?Ss(i):null,o=e.x+e.width/2-t.width/2,a=e.y+e.height/2-t.height/2,l;switch(n){case Xt:l={x:o,y:e.y-t.height};break;case Ci:l={x:o,y:e.y+e.height};break;case xi:l={x:e.x+e.width,y:a};break;case $t:l={x:e.x-t.width,y:a};break;default:l={x:e.x,y:e.y}}var h=n?Yc(n):null;if(h!=null){var u=h==="y"?"height":"width";switch(s){case Cs:l[h]=l[h]-(e[u]/2-t[u]/2);break;case Lo:l[h]=l[h]+(e[u]/2-t[u]/2);break}}return l}function Ao(r,e){e===void 0&&(e={});var t=e,i=t.placement,n=i===void 0?r.placement:i,s=t.strategy,o=s===void 0?r.strategy:s,a=t.boundary,l=a===void 0?yw:a,h=t.rootBoundary,u=h===void 0?am:h,c=t.elementContext,d=c===void 0?qs:c,f=t.altBoundary,g=f===void 0?!1:f,m=t.padding,w=m===void 0?0:m,y=fm(typeof w!="number"?w:gm(w,Zo)),E=d===qs?vw:qs,x=r.rects.popper,v=r.elements[g?E:d],S=qw(Br(v)?v:v.contextElement||hr(r.elements.popper),l,u,o),R=Rs(r.elements.reference),L=mm({reference:R,element:x,strategy:"absolute",placement:n}),C=_u(Object.assign({},x,L)),M=d===qs?C:R,D={top:S.top-M.top+y.top,bottom:M.bottom-S.bottom+y.bottom,left:S.left-M.left+y.left,right:M.right-S.right+y.right},A=r.modifiersData.offset;if(d===qs&&A){var k=A[n];Object.keys(D).forEach(function(V){var I=[xi,Ci].indexOf(V)>=0?1:-1,B=[Xt,Ci].indexOf(V)>=0?"y":"x";D[V]+=k[B]*I})}return D}function Jw(r,e){e===void 0&&(e={});var t=e,i=t.placement,n=t.boundary,s=t.rootBoundary,o=t.padding,a=t.flipVariations,l=t.allowedAutoPlacements,h=l===void 0?lm:l,u=Ss(i),c=u?a?Ff:Ff.filter(function(g){return Ss(g)===u}):Zo,d=c.filter(function(g){return h.indexOf(g)>=0});d.length===0&&(d=c);var f=d.reduce(function(g,m){return g[m]=Ao(r,{placement:m,boundary:n,rootBoundary:s,padding:o})[Ki(m)],g},{});return Object.keys(f).sort(function(g,m){return f[g]-f[m]})}function Qw(r){if(Ki(r)===Vc)return[];var e=za(r);return[kf(r),e,kf(e)]}function e0(r){var e=r.state,t=r.options,i=r.name;if(!e.modifiersData[i]._skip){for(var n=t.mainAxis,s=n===void 0?!0:n,o=t.altAxis,a=o===void 0?!0:o,l=t.fallbackPlacements,h=t.padding,u=t.boundary,c=t.rootBoundary,d=t.altBoundary,f=t.flipVariations,g=f===void 0?!0:f,m=t.allowedAutoPlacements,w=e.options.placement,y=Ki(w),E=y===w,x=l||(E||!g?[za(w)]:Qw(w)),v=[w].concat(x).reduce(function(W,me){return W.concat(Ki(me)===Vc?Jw(e,{placement:me,boundary:u,rootBoundary:c,padding:h,flipVariations:g,allowedAutoPlacements:m}):me)},[]),S=e.rects.reference,R=e.rects.popper,L=new Map,C=!0,M=v[0],D=0;D<v.length;D++){var A=v[D],k=Ki(A),V=Ss(A)===Cs,I=[Xt,Ci].indexOf(k)>=0,B=I?"width":"height",O=Ao(e,{placement:A,boundary:u,rootBoundary:c,altBoundary:d,padding:h}),H=I?V?xi:$t:V?Ci:Xt;S[B]>R[B]&&(H=za(H));var j=za(H),q=[];if(s&&q.push(O[k]<=0),a&&q.push(O[H]<=0,O[j]<=0),q.every(function(W){return W})){M=A,C=!1;break}L.set(A,q)}if(C)for(var J=g?3:1,ee=function(me){var Ie=v.find(function(Re){var Se=L.get(Re);if(Se)return Se.slice(0,me).every(function(Ue){return Ue})});if(Ie)return M=Ie,"break"},te=J;te>0;te--){var Ce=ee(te);if(Ce==="break")break}e.placement!==M&&(e.modifiersData[i]._skip=!0,e.placement=M,e.reset=!0)}}const t0={name:"flip",enabled:!0,phase:"main",fn:e0,requiresIfExists:["offset"],data:{_skip:!1}};function zf(r,e,t){return t===void 0&&(t={x:0,y:0}),{top:r.top-e.height-t.y,right:r.right-e.width+t.x,bottom:r.bottom-e.height+t.y,left:r.left-e.width-t.x}}function Bf(r){return[Xt,xi,Ci,$t].some(function(e){return r[e]>=0})}function i0(r){var e=r.state,t=r.name,i=e.rects.reference,n=e.rects.popper,s=e.modifiersData.preventOverflow,o=Ao(e,{elementContext:"reference"}),a=Ao(e,{altBoundary:!0}),l=zf(o,i),h=zf(a,n,s),u=Bf(l),c=Bf(h);e.modifiersData[t]={referenceClippingOffsets:l,popperEscapeOffsets:h,isReferenceHidden:u,hasPopperEscaped:c},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":c})}const n0={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:i0};function r0(r,e,t){var i=Ki(r),n=[$t,Xt].indexOf(i)>=0?-1:1,s=typeof t=="function"?t(Object.assign({},e,{placement:r})):t,o=s[0],a=s[1];return o=o||0,a=(a||0)*n,[$t,xi].indexOf(i)>=0?{x:a,y:o}:{x:o,y:a}}function s0(r){var e=r.state,t=r.options,i=r.name,n=t.offset,s=n===void 0?[0,0]:n,o=lm.reduce(function(u,c){return u[c]=r0(c,e.rects,s),u},{}),a=o[e.placement],l=a.x,h=a.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=h),e.modifiersData[i]=o}const o0={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:s0};function a0(r){var e=r.state,t=r.name;e.modifiersData[t]=mm({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const l0={name:"popperOffsets",enabled:!0,phase:"read",fn:a0,data:{}};function h0(r){return r==="x"?"y":"x"}function u0(r){var e=r.state,t=r.options,i=r.name,n=t.mainAxis,s=n===void 0?!0:n,o=t.altAxis,a=o===void 0?!1:o,l=t.boundary,h=t.rootBoundary,u=t.altBoundary,c=t.padding,d=t.tether,f=d===void 0?!0:d,g=t.tetherOffset,m=g===void 0?0:g,w=Ao(e,{boundary:l,rootBoundary:h,padding:c,altBoundary:u}),y=Ki(e.placement),E=Ss(e.placement),x=!E,v=Yc(y),S=h0(v),R=e.modifiersData.popperOffsets,L=e.rects.reference,C=e.rects.popper,M=typeof m=="function"?m(Object.assign({},e.rects,{placement:e.placement})):m,D=typeof M=="number"?{mainAxis:M,altAxis:M}:Object.assign({mainAxis:0,altAxis:0},M),A=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,k={x:0,y:0};if(R){if(s){var V,I=v==="y"?Xt:$t,B=v==="y"?Ci:xi,O=v==="y"?"height":"width",H=R[v],j=H+w[I],q=H-w[B],J=f?-C[O]/2:0,ee=E===Cs?L[O]:C[O],te=E===Cs?-C[O]:-L[O],Ce=e.elements.arrow,W=f&&Ce?Uc(Ce):{width:0,height:0},me=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:dm(),Ie=me[I],Re=me[B],Se=go(0,L[O],W[O]),Ue=x?L[O]/2-J-Se-Ie-D.mainAxis:ee-Se-Ie-D.mainAxis,Ye=x?-L[O]/2+J+Se+Re+D.mainAxis:te+Se+Re+D.mainAxis,Bt=e.elements.arrow&&Ko(e.elements.arrow),Pt=Bt?v==="y"?Bt.clientTop||0:Bt.clientLeft||0:0,_t=(V=A==null?void 0:A[v])!=null?V:0,Ft=H+Ue-_t-Pt,Mi=H+Ye-_t,ot=go(f?Ka(j,Ft):j,H,f?Ir(q,Mi):q);R[v]=ot,k[v]=ot-H}if(a){var Ct,Li=v==="x"?Xt:$t,Wi=v==="x"?Ci:xi,bt=R[S],ut=S==="y"?"height":"width",Be=bt+w[Li],qe=bt-w[Wi],ct=[Xt,$t].indexOf(y)!==-1,je=(Ct=A==null?void 0:A[S])!=null?Ct:0,Qt=ct?Be:bt-L[ut]-C[ut]-je+D.altAxis,_=ct?bt+L[ut]+C[ut]-je-D.altAxis:qe,p=f&&ct?Ow(Qt,bt,_):go(f?Qt:Be,bt,f?_:qe);R[S]=p,k[S]=p-bt}e.modifiersData[i]=k}}const c0={name:"preventOverflow",enabled:!0,phase:"main",fn:u0,requiresIfExists:["offset"]};function d0(r){return{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}}function f0(r){return r===ai(r)||!wi(r)?jc(r):d0(r)}function g0(r){var e=r.getBoundingClientRect(),t=xs(e.width)/r.offsetWidth||1,i=xs(e.height)/r.offsetHeight||1;return t!==1||i!==1}function p0(r,e,t){t===void 0&&(t=!1);var i=wi(e),n=wi(e)&&g0(e),s=hr(e),o=Rs(r,n,t),a={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(i||!i&&!t)&&((tn(e)!=="body"||$c(s))&&(a=f0(e)),wi(e)?(l=Rs(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):s&&(l.x=Xc(s))),{x:o.left+a.scrollLeft-l.x,y:o.top+a.scrollTop-l.y,width:o.width,height:o.height}}function m0(r){var e=new Map,t=new Set,i=[];r.forEach(function(s){e.set(s.name,s)});function n(s){t.add(s.name);var o=[].concat(s.requires||[],s.requiresIfExists||[]);o.forEach(function(a){if(!t.has(a)){var l=e.get(a);l&&n(l)}}),i.push(s)}return r.forEach(function(s){t.has(s.name)||n(s)}),i}function b0(r){var e=m0(r);return Lw.reduce(function(t,i){return t.concat(e.filter(function(n){return n.phase===i}))},[])}function y0(r){var e;return function(){return e||(e=new Promise(function(t){Promise.resolve().then(function(){e=void 0,t(r())})})),e}}function v0(r){var e=r.reduce(function(t,i){var n=t[i.name];return t[i.name]=n?Object.assign({},n,i,{options:Object.assign({},n.options,i.options),data:Object.assign({},n.data,i.data)}):i,t},{});return Object.keys(e).map(function(t){return e[t]})}var Gf={placement:"bottom",modifiers:[],strategy:"absolute"};function Hf(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return!e.some(function(i){return!(i&&typeof i.getBoundingClientRect=="function")})}function w0(r){r===void 0&&(r={});var e=r,t=e.defaultModifiers,i=t===void 0?[]:t,n=e.defaultOptions,s=n===void 0?Gf:n;return function(a,l,h){h===void 0&&(h=s);var u={placement:"bottom",orderedModifiers:[],options:Object.assign({},Gf,s),modifiersData:{},elements:{reference:a,popper:l},attributes:{},styles:{}},c=[],d=!1,f={state:u,setOptions:function(y){var E=typeof y=="function"?y(u.options):y;m(),u.options=Object.assign({},s,u.options,E),u.scrollParents={reference:Br(a)?po(a):a.contextElement?po(a.contextElement):[],popper:po(l)};var x=b0(v0([].concat(i,u.options.modifiers)));return u.orderedModifiers=x.filter(function(v){return v.enabled}),g(),f.update()},forceUpdate:function(){if(!d){var y=u.elements,E=y.reference,x=y.popper;if(Hf(E,x)){u.rects={reference:p0(E,Ko(x),u.options.strategy==="fixed"),popper:Uc(x)},u.reset=!1,u.placement=u.options.placement,u.orderedModifiers.forEach(function(D){return u.modifiersData[D.name]=Object.assign({},D.data)});for(var v=0;v<u.orderedModifiers.length;v++){if(u.reset===!0){u.reset=!1,v=-1;continue}var S=u.orderedModifiers[v],R=S.fn,L=S.options,C=L===void 0?{}:L,M=S.name;typeof R=="function"&&(u=R({state:u,options:C,name:M,instance:f})||u)}}}},update:y0(function(){return new Promise(function(w){f.forceUpdate(),w(u)})}),destroy:function(){m(),d=!0}};if(!Hf(a,l))return f;f.setOptions(h).then(function(w){!d&&h.onFirstUpdate&&h.onFirstUpdate(w)});function g(){u.orderedModifiers.forEach(function(w){var y=w.name,E=w.options,x=E===void 0?{}:E,v=w.effect;if(typeof v=="function"){var S=v({state:u,name:y,instance:f,options:x}),R=function(){};c.push(S||R)}})}function m(){c.forEach(function(w){return w()}),c=[]}return f}}var E0=[Uw,l0,Vw,hm,o0,t0,c0,zw,n0],_0=w0({defaultModifiers:E0}),C0="tippy-box",bm="tippy-content",x0="tippy-backdrop",ym="tippy-arrow",vm="tippy-svg-arrow",br={passive:!0,capture:!0},wm=function(){return document.body};function xh(r,e,t){if(Array.isArray(r)){var i=r[e];return i??(Array.isArray(t)?t[e]:t)}return r}function Zc(r,e){var t={}.toString.call(r);return t.indexOf("[object")===0&&t.indexOf(e+"]")>-1}function Em(r,e){return typeof r=="function"?r.apply(void 0,e):r}function Vf(r,e){if(e===0)return r;var t;return function(i){clearTimeout(t),t=setTimeout(function(){r(i)},e)}}function R0(r){return r.split(/\s+/).filter(Boolean)}function is(r){return[].concat(r)}function Wf(r,e){r.indexOf(e)===-1&&r.push(e)}function S0(r){return r.filter(function(e,t){return r.indexOf(e)===t})}function T0(r){return r.split("-")[0]}function qa(r){return[].slice.call(r)}function Uf(r){return Object.keys(r).reduce(function(e,t){return r[t]!==void 0&&(e[t]=r[t]),e},{})}function mo(){return document.createElement("div")}function Gl(r){return["Element","Fragment"].some(function(e){return Zc(r,e)})}function M0(r){return Zc(r,"NodeList")}function L0(r){return Zc(r,"MouseEvent")}function A0(r){return!!(r&&r._tippy&&r._tippy.reference===r)}function I0(r){return Gl(r)?[r]:M0(r)?qa(r):Array.isArray(r)?r:qa(document.querySelectorAll(r))}function Rh(r,e){r.forEach(function(t){t&&(t.style.transitionDuration=e+"ms")})}function Yf(r,e){r.forEach(function(t){t&&t.setAttribute("data-state",e)})}function P0(r){var e,t=is(r),i=t[0];return i!=null&&(e=i.ownerDocument)!=null&&e.body?i.ownerDocument:document}function F0(r,e){var t=e.clientX,i=e.clientY;return r.every(function(n){var s=n.popperRect,o=n.popperState,a=n.props,l=a.interactiveBorder,h=T0(o.placement),u=o.modifiersData.offset;if(!u)return!0;var c=h==="bottom"?u.top.y:0,d=h==="top"?u.bottom.y:0,f=h==="right"?u.left.x:0,g=h==="left"?u.right.x:0,m=s.top-i+c>l,w=i-s.bottom-d>l,y=s.left-t+f>l,E=t-s.right-g>l;return m||w||y||E})}function Sh(r,e,t){var i=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(n){r[i](n,t)})}function jf(r,e){for(var t=e;t;){var i;if(r.contains(t))return!0;t=t.getRootNode==null||(i=t.getRootNode())==null?void 0:i.host}return!1}var Yi={isTouch:!1},Xf=0;function O0(){Yi.isTouch||(Yi.isTouch=!0,window.performance&&document.addEventListener("mousemove",_m))}function _m(){var r=performance.now();r-Xf<20&&(Yi.isTouch=!1,document.removeEventListener("mousemove",_m)),Xf=r}function D0(){var r=document.activeElement;if(A0(r)){var e=r._tippy;r.blur&&!e.state.isVisible&&r.blur()}}function k0(){document.addEventListener("touchstart",O0,br),window.addEventListener("blur",D0)}var N0=typeof window<"u"&&typeof document<"u",z0=N0?!!window.msCrypto:!1,B0={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},G0={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},Di=Object.assign({appendTo:wm,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},B0,G0),H0=Object.keys(Di),V0=function(e){var t=Object.keys(e);t.forEach(function(i){Di[i]=e[i]})};function Cm(r){var e=r.plugins||[],t=e.reduce(function(i,n){var s=n.name,o=n.defaultValue;if(s){var a;i[s]=r[s]!==void 0?r[s]:(a=Di[s])!=null?a:o}return i},{});return Object.assign({},r,t)}function W0(r,e){var t=e?Object.keys(Cm(Object.assign({},Di,{plugins:e}))):H0,i=t.reduce(function(n,s){var o=(r.getAttribute("data-tippy-"+s)||"").trim();if(!o)return n;if(s==="content")n[s]=o;else try{n[s]=JSON.parse(o)}catch{n[s]=o}return n},{});return i}function $f(r,e){var t=Object.assign({},e,{content:Em(e.content,[r])},e.ignoreAttributes?{}:W0(r,e.plugins));return t.aria=Object.assign({},Di.aria,t.aria),t.aria={expanded:t.aria.expanded==="auto"?e.interactive:t.aria.expanded,content:t.aria.content==="auto"?e.interactive?null:"describedby":t.aria.content},t}var U0=function(){return"innerHTML"};function Cu(r,e){r[U0()]=e}function Zf(r){var e=mo();return r===!0?e.className=ym:(e.className=vm,Gl(r)?e.appendChild(r):Cu(e,r)),e}function Kf(r,e){Gl(e.content)?(Cu(r,""),r.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?Cu(r,e.content):r.textContent=e.content)}function xu(r){var e=r.firstElementChild,t=qa(e.children);return{box:e,content:t.find(function(i){return i.classList.contains(bm)}),arrow:t.find(function(i){return i.classList.contains(ym)||i.classList.contains(vm)}),backdrop:t.find(function(i){return i.classList.contains(x0)})}}function xm(r){var e=mo(),t=mo();t.className=C0,t.setAttribute("data-state","hidden"),t.setAttribute("tabindex","-1");var i=mo();i.className=bm,i.setAttribute("data-state","hidden"),Kf(i,r.props),e.appendChild(t),t.appendChild(i),n(r.props,r.props);function n(s,o){var a=xu(e),l=a.box,h=a.content,u=a.arrow;o.theme?l.setAttribute("data-theme",o.theme):l.removeAttribute("data-theme"),typeof o.animation=="string"?l.setAttribute("data-animation",o.animation):l.removeAttribute("data-animation"),o.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof o.maxWidth=="number"?o.maxWidth+"px":o.maxWidth,o.role?l.setAttribute("role",o.role):l.removeAttribute("role"),(s.content!==o.content||s.allowHTML!==o.allowHTML)&&Kf(h,r.props),o.arrow?u?s.arrow!==o.arrow&&(l.removeChild(u),l.appendChild(Zf(o.arrow))):l.appendChild(Zf(o.arrow)):u&&l.removeChild(u)}return{popper:e,onUpdate:n}}xm.$$tippy=!0;var Y0=1,ma=[],Th=[];function j0(r,e){var t=$f(r,Object.assign({},Di,Cm(Uf(e)))),i,n,s,o=!1,a=!1,l=!1,h=!1,u,c,d,f=[],g=Vf(Ft,t.interactiveDebounce),m,w=Y0++,y=null,E=S0(t.plugins),x={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},v={id:w,reference:r,popper:mo(),popperInstance:y,props:t,state:x,plugins:E,clearDelayTimeouts:Qt,setProps:_,setContent:p,show:b,hide:T,hideWithInteractivity:F,enable:ct,disable:je,unmount:G,destroy:U};if(!t.render)return v;var S=t.render(v),R=S.popper,L=S.onUpdate;R.setAttribute("data-tippy-root",""),R.id="tippy-"+v.id,v.popper=R,r._tippy=v,R._tippy=v;var C=E.map(function(z){return z.fn(v)}),M=r.hasAttribute("aria-expanded");return Bt(),J(),H(),j("onCreate",[v]),t.showOnCreate&&Be(),R.addEventListener("mouseenter",function(){v.props.interactive&&v.state.isVisible&&v.clearDelayTimeouts()}),R.addEventListener("mouseleave",function(){v.props.interactive&&v.props.trigger.indexOf("mouseenter")>=0&&I().addEventListener("mousemove",g)}),v;function D(){var z=v.props.touch;return Array.isArray(z)?z:[z,0]}function A(){return D()[0]==="hold"}function k(){var z;return!!((z=v.props.render)!=null&&z.$$tippy)}function V(){return m||r}function I(){var z=V().parentNode;return z?P0(z):document}function B(){return xu(R)}function O(z){return v.state.isMounted&&!v.state.isVisible||Yi.isTouch||u&&u.type==="focus"?0:xh(v.props.delay,z?0:1,Di.delay)}function H(z){z===void 0&&(z=!1),R.style.pointerEvents=v.props.interactive&&!z?"":"none",R.style.zIndex=""+v.props.zIndex}function j(z,Q,ie){if(ie===void 0&&(ie=!0),C.forEach(function(re){re[z]&&re[z].apply(re,Q)}),ie){var de;(de=v.props)[z].apply(de,Q)}}function q(){var z=v.props.aria;if(z.content){var Q="aria-"+z.content,ie=R.id,de=is(v.props.triggerTarget||r);de.forEach(function(re){var dt=re.getAttribute(Q);if(v.state.isVisible)re.setAttribute(Q,dt?dt+" "+ie:ie);else{var xt=dt&&dt.replace(ie,"").trim();xt?re.setAttribute(Q,xt):re.removeAttribute(Q)}})}}function J(){if(!(M||!v.props.aria.expanded)){var z=is(v.props.triggerTarget||r);z.forEach(function(Q){v.props.interactive?Q.setAttribute("aria-expanded",v.state.isVisible&&Q===V()?"true":"false"):Q.removeAttribute("aria-expanded")})}}function ee(){I().removeEventListener("mousemove",g),ma=ma.filter(function(z){return z!==g})}function te(z){if(!(Yi.isTouch&&(l||z.type==="mousedown"))){var Q=z.composedPath&&z.composedPath()[0]||z.target;if(!(v.props.interactive&&jf(R,Q))){if(is(v.props.triggerTarget||r).some(function(ie){return jf(ie,Q)})){if(Yi.isTouch||v.state.isVisible&&v.props.trigger.indexOf("click")>=0)return}else j("onClickOutside",[v,z]);v.props.hideOnClick===!0&&(v.clearDelayTimeouts(),v.hide(),a=!0,setTimeout(function(){a=!1}),v.state.isMounted||Ie())}}}function Ce(){l=!0}function W(){l=!1}function me(){var z=I();z.addEventListener("mousedown",te,!0),z.addEventListener("touchend",te,br),z.addEventListener("touchstart",W,br),z.addEventListener("touchmove",Ce,br)}function Ie(){var z=I();z.removeEventListener("mousedown",te,!0),z.removeEventListener("touchend",te,br),z.removeEventListener("touchstart",W,br),z.removeEventListener("touchmove",Ce,br)}function Re(z,Q){Ue(z,function(){!v.state.isVisible&&R.parentNode&&R.parentNode.contains(R)&&Q()})}function Se(z,Q){Ue(z,Q)}function Ue(z,Q){var ie=B().box;function de(re){re.target===ie&&(Sh(ie,"remove",de),Q())}if(z===0)return Q();Sh(ie,"remove",c),Sh(ie,"add",de),c=de}function Ye(z,Q,ie){ie===void 0&&(ie=!1);var de=is(v.props.triggerTarget||r);de.forEach(function(re){re.addEventListener(z,Q,ie),f.push({node:re,eventType:z,handler:Q,options:ie})})}function Bt(){A()&&(Ye("touchstart",_t,{passive:!0}),Ye("touchend",Mi,{passive:!0})),R0(v.props.trigger).forEach(function(z){if(z!=="manual")switch(Ye(z,_t),z){case"mouseenter":Ye("mouseleave",Mi);break;case"focus":Ye(z0?"focusout":"blur",ot);break;case"focusin":Ye("focusout",ot);break}})}function Pt(){f.forEach(function(z){var Q=z.node,ie=z.eventType,de=z.handler,re=z.options;Q.removeEventListener(ie,de,re)}),f=[]}function _t(z){var Q,ie=!1;if(!(!v.state.isEnabled||Ct(z)||a)){var de=((Q=u)==null?void 0:Q.type)==="focus";u=z,m=z.currentTarget,J(),!v.state.isVisible&&L0(z)&&ma.forEach(function(re){return re(z)}),z.type==="click"&&(v.props.trigger.indexOf("mouseenter")<0||o)&&v.props.hideOnClick!==!1&&v.state.isVisible?ie=!0:Be(z),z.type==="click"&&(o=!ie),ie&&!de&&qe(z)}}function Ft(z){var Q=z.target,ie=V().contains(Q)||R.contains(Q);if(!(z.type==="mousemove"&&ie)){var de=ut().concat(R).map(function(re){var dt,xt=re._tippy,hi=(dt=xt.popperInstance)==null?void 0:dt.state;return hi?{popperRect:re.getBoundingClientRect(),popperState:hi,props:t}:null}).filter(Boolean);F0(de,z)&&(ee(),qe(z))}}function Mi(z){var Q=Ct(z)||v.props.trigger.indexOf("click")>=0&&o;if(!Q){if(v.props.interactive){v.hideWithInteractivity(z);return}qe(z)}}function ot(z){v.props.trigger.indexOf("focusin")<0&&z.target!==V()||v.props.interactive&&z.relatedTarget&&R.contains(z.relatedTarget)||qe(z)}function Ct(z){return Yi.isTouch?A()!==z.type.indexOf("touch")>=0:!1}function Li(){Wi();var z=v.props,Q=z.popperOptions,ie=z.placement,de=z.offset,re=z.getReferenceClientRect,dt=z.moveTransition,xt=k()?xu(R).arrow:null,hi=re?{getBoundingClientRect:re,contextElement:re.contextElement||V()}:r,kn={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(fr){var at=fr.state;if(k()){var an=B(),Rt=an.box;["placement","reference-hidden","escaped"].forEach(function(Ot){Ot==="placement"?Rt.setAttribute("data-placement",at.placement):at.attributes.popper["data-popper-"+Ot]?Rt.setAttribute("data-"+Ot,""):Rt.removeAttribute("data-"+Ot)}),at.attributes.popper={}}}},ei=[{name:"offset",options:{offset:de}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!dt}},kn];k()&&xt&&ei.push({name:"arrow",options:{element:xt,padding:3}}),ei.push.apply(ei,(Q==null?void 0:Q.modifiers)||[]),v.popperInstance=_0(hi,R,Object.assign({},Q,{placement:ie,onFirstUpdate:d,modifiers:ei}))}function Wi(){v.popperInstance&&(v.popperInstance.destroy(),v.popperInstance=null)}function bt(){var z=v.props.appendTo,Q,ie=V();v.props.interactive&&z===wm||z==="parent"?Q=ie.parentNode:Q=Em(z,[ie]),Q.contains(R)||Q.appendChild(R),v.state.isMounted=!0,Li()}function ut(){return qa(R.querySelectorAll("[data-tippy-root]"))}function Be(z){v.clearDelayTimeouts(),z&&j("onTrigger",[v,z]),me();var Q=O(!0),ie=D(),de=ie[0],re=ie[1];Yi.isTouch&&de==="hold"&&re&&(Q=re),Q?i=setTimeout(function(){v.show()},Q):v.show()}function qe(z){if(v.clearDelayTimeouts(),j("onUntrigger",[v,z]),!v.state.isVisible){Ie();return}if(!(v.props.trigger.indexOf("mouseenter")>=0&&v.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(z.type)>=0&&o)){var Q=O(!1);Q?n=setTimeout(function(){v.state.isVisible&&v.hide()},Q):s=requestAnimationFrame(function(){v.hide()})}}function ct(){v.state.isEnabled=!0}function je(){v.hide(),v.state.isEnabled=!1}function Qt(){clearTimeout(i),clearTimeout(n),cancelAnimationFrame(s)}function _(z){if(!v.state.isDestroyed){j("onBeforeUpdate",[v,z]),Pt();var Q=v.props,ie=$f(r,Object.assign({},Q,Uf(z),{ignoreAttributes:!0}));v.props=ie,Bt(),Q.interactiveDebounce!==ie.interactiveDebounce&&(ee(),g=Vf(Ft,ie.interactiveDebounce)),Q.triggerTarget&&!ie.triggerTarget?is(Q.triggerTarget).forEach(function(de){de.removeAttribute("aria-expanded")}):ie.triggerTarget&&r.removeAttribute("aria-expanded"),J(),H(),L&&L(Q,ie),v.popperInstance&&(Li(),ut().forEach(function(de){requestAnimationFrame(de._tippy.popperInstance.forceUpdate)})),j("onAfterUpdate",[v,z])}}function p(z){v.setProps({content:z})}function b(){var z=v.state.isVisible,Q=v.state.isDestroyed,ie=!v.state.isEnabled,de=Yi.isTouch&&!v.props.touch,re=xh(v.props.duration,0,Di.duration);if(!(z||Q||ie||de)&&!V().hasAttribute("disabled")&&(j("onShow",[v],!1),v.props.onShow(v)!==!1)){if(v.state.isVisible=!0,k()&&(R.style.visibility="visible"),H(),me(),v.state.isMounted||(R.style.transition="none"),k()){var dt=B(),xt=dt.box,hi=dt.content;Rh([xt,hi],0)}d=function(){var ei;if(!(!v.state.isVisible||h)){if(h=!0,R.offsetHeight,R.style.transition=v.props.moveTransition,k()&&v.props.animation){var Xr=B(),fr=Xr.box,at=Xr.content;Rh([fr,at],re),Yf([fr,at],"visible")}q(),J(),Wf(Th,v),(ei=v.popperInstance)==null||ei.forceUpdate(),j("onMount",[v]),v.props.animation&&k()&&Se(re,function(){v.state.isShown=!0,j("onShown",[v])})}},bt()}}function T(){var z=!v.state.isVisible,Q=v.state.isDestroyed,ie=!v.state.isEnabled,de=xh(v.props.duration,1,Di.duration);if(!(z||Q||ie)&&(j("onHide",[v],!1),v.props.onHide(v)!==!1)){if(v.state.isVisible=!1,v.state.isShown=!1,h=!1,o=!1,k()&&(R.style.visibility="hidden"),ee(),Ie(),H(!0),k()){var re=B(),dt=re.box,xt=re.content;v.props.animation&&(Rh([dt,xt],de),Yf([dt,xt],"hidden"))}q(),J(),v.props.animation?k()&&Re(de,v.unmount):v.unmount()}}function F(z){I().addEventListener("mousemove",g),Wf(ma,g),g(z)}function G(){v.state.isVisible&&v.hide(),v.state.isMounted&&(Wi(),ut().forEach(function(z){z._tippy.unmount()}),R.parentNode&&R.parentNode.removeChild(R),Th=Th.filter(function(z){return z!==v}),v.state.isMounted=!1,j("onHidden",[v]))}function U(){v.state.isDestroyed||(v.clearDelayTimeouts(),v.unmount(),Pt(),delete r._tippy,v.state.isDestroyed=!0,j("onDestroy",[v]))}}function Hl(r,e){e===void 0&&(e={});var t=Di.plugins.concat(e.plugins||[]);k0();var i=Object.assign({},e,{plugins:t}),n=I0(r),s=n.reduce(function(o,a){var l=a&&j0(a,i);return l&&o.push(l),o},[]);return Gl(r)?s[0]:s}Hl.defaultProps=Di;Hl.setDefaultProps=V0;Hl.currentInput=Yi;Object.assign({},hm,{effect:function(e){var t=e.state,i={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,i.popper),t.styles=i,t.elements.arrow&&Object.assign(t.elements.arrow.style,i.arrow)}});Hl.setDefaultProps({render:xm});var vr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Vl(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Rm={exports:{}},Mh={exports:{}},qf;function X0(){return qf||(qf=1,function(r,e){(function(t,i){r.exports=i()})(vr,function(){function t(m){return!isNaN(parseFloat(m))&&isFinite(m)}function i(m){return m.charAt(0).toUpperCase()+m.substring(1)}function n(m){return function(){return this[m]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],l=["args"],h=["evalOrigin"],u=s.concat(o,a,l,h);function c(m){if(m)for(var w=0;w<u.length;w++)m[u[w]]!==void 0&&this["set"+i(u[w])](m[u[w]])}c.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof c)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new c(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",w=this.getLineNumber()||"",y=this.getColumnNumber()||"",E=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+w+":"+y+")":"[eval]:"+w+":"+y:E?E+" ("+m+":"+w+":"+y+")":m+":"+w+":"+y}},c.fromString=function(w){var y=w.indexOf("("),E=w.lastIndexOf(")"),x=w.substring(0,y),v=w.substring(y+1,E).split(","),S=w.substring(E+1);if(S.indexOf("@")===0)var R=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(S,""),L=R[1],C=R[2],M=R[3];return new c({functionName:x,args:v||void 0,fileName:L,lineNumber:C||void 0,columnNumber:M||void 0})};for(var d=0;d<s.length;d++)c.prototype["get"+i(s[d])]=n(s[d]),c.prototype["set"+i(s[d])]=function(m){return function(w){this[m]=!!w}}(s[d]);for(var f=0;f<o.length;f++)c.prototype["get"+i(o[f])]=n(o[f]),c.prototype["set"+i(o[f])]=function(m){return function(w){if(!t(w))throw new TypeError(m+" must be a Number");this[m]=Number(w)}}(o[f]);for(var g=0;g<a.length;g++)c.prototype["get"+i(a[g])]=n(a[g]),c.prototype["set"+i(a[g])]=function(m){return function(w){this[m]=String(w)}}(a[g]);return c})}(Mh)),Mh.exports}(function(r,e){(function(t,i){r.exports=i(X0())})(vr,function(i){var n=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(l){if(typeof l.stacktrace<"u"||typeof l["opera#sourceloc"]<"u")return this.parseOpera(l);if(l.stack&&l.stack.match(s))return this.parseV8OrIE(l);if(l.stack)return this.parseFFOrSafari(l);throw new Error("Cannot parse given Error object")},extractLocation:function(l){if(l.indexOf(":")===-1)return[l];var h=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=h.exec(l.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(l){var h=l.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return h.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var c=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=c.match(/ (\(.+\)$)/);c=d?c.replace(d[0],""):c;var f=this.extractLocation(d?d[1]:c),g=d&&c||void 0,m=["eval","<anonymous>"].indexOf(f[0])>-1?void 0:f[0];return new i({functionName:g,fileName:m,lineNumber:f[1],columnNumber:f[2],source:u})},this)},parseFFOrSafari:function(l){var h=l.stack.split(`
`).filter(function(u){return!u.match(o)},this);return h.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new i({functionName:u});var c=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(c),f=d&&d[1]?d[1]:void 0,g=this.extractLocation(u.replace(c,""));return new i({functionName:f,fileName:g[0],lineNumber:g[1],columnNumber:g[2],source:u})},this)},parseOpera:function(l){return!l.stacktrace||l.message.indexOf(`
`)>-1&&l.message.split(`
`).length>l.stacktrace.split(`
`).length?this.parseOpera9(l):l.stack?this.parseOpera11(l):this.parseOpera10(l)},parseOpera9:function(l){for(var h=/Line (\d+).*script (?:in )?(\S+)/i,u=l.message.split(`
`),c=[],d=2,f=u.length;d<f;d+=2){var g=h.exec(u[d]);g&&c.push(new i({fileName:g[2],lineNumber:g[1],source:u[d]}))}return c},parseOpera10:function(l){for(var h=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=l.stacktrace.split(`
`),c=[],d=0,f=u.length;d<f;d+=2){var g=h.exec(u[d]);g&&c.push(new i({functionName:g[3]||void 0,fileName:g[2],lineNumber:g[1],source:u[d]}))}return c},parseOpera11:function(l){var h=l.stack.split(`
`).filter(function(u){return!!u.match(n)&&!u.match(/^Error created at/)},this);return h.map(function(u){var c=u.split("@"),d=this.extractLocation(c.pop()),f=c.shift()||"",g=f.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;f.match(/\(([^)]*)\)/)&&(m=f.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var w=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new i({functionName:g,args:w,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(Rm);var $0=Rm.exports;const Bk=Vl($0);var Sm={},Wl={},Kc={},Jf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");Kc.encode=function(r){if(0<=r&&r<Jf.length)return Jf[r];throw new TypeError("Must be between 0 and 63: "+r)};Kc.decode=function(r){var e=65,t=90,i=97,n=122,s=48,o=57,a=43,l=47,h=26,u=52;return e<=r&&r<=t?r-e:i<=r&&r<=n?r-i+h:s<=r&&r<=o?r-s+u:r==a?62:r==l?63:-1};var Tm=Kc,qc=5,Mm=1<<qc,Lm=Mm-1,Am=Mm;function Z0(r){return r<0?(-r<<1)+1:(r<<1)+0}function K0(r){var e=(r&1)===1,t=r>>1;return e?-t:t}Wl.encode=function(e){var t="",i,n=Z0(e);do i=n&Lm,n>>>=qc,n>0&&(i|=Am),t+=Tm.encode(i);while(n>0);return t};Wl.decode=function(e,t,i){var n=e.length,s=0,o=0,a,l;do{if(t>=n)throw new Error("Expected more digits in base 64 VLQ value.");if(l=Tm.decode(e.charCodeAt(t++)),l===-1)throw new Error("Invalid base64 digit: "+e.charAt(t-1));a=!!(l&Am),l&=Lm,s=s+(l<<o),o+=qc}while(a);i.value=K0(s),i.rest=t};var Bs={};(function(r){function e(C,M,D){if(M in C)return C[M];if(arguments.length===3)return D;throw new Error('"'+M+'" is a required argument.')}r.getArg=e;var t=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,i=/^data:.+\,.+$/;function n(C){var M=C.match(t);return M?{scheme:M[1],auth:M[2],host:M[3],port:M[4],path:M[5]}:null}r.urlParse=n;function s(C){var M="";return C.scheme&&(M+=C.scheme+":"),M+="//",C.auth&&(M+=C.auth+"@"),C.host&&(M+=C.host),C.port&&(M+=":"+C.port),C.path&&(M+=C.path),M}r.urlGenerate=s;var o=32;function a(C){var M=[];return function(D){for(var A=0;A<M.length;A++)if(M[A].input===D){var k=M[0];return M[0]=M[A],M[A]=k,M[0].result}var V=C(D);return M.unshift({input:D,result:V}),M.length>o&&M.pop(),V}}var l=a(function(M){var D=M,A=n(M);if(A){if(!A.path)return M;D=A.path}for(var k=r.isAbsolute(D),V=[],I=0,B=0;;)if(I=B,B=D.indexOf("/",I),B===-1){V.push(D.slice(I));break}else for(V.push(D.slice(I,B));B<D.length&&D[B]==="/";)B++;for(var O,H=0,B=V.length-1;B>=0;B--)O=V[B],O==="."?V.splice(B,1):O===".."?H++:H>0&&(O===""?(V.splice(B+1,H),H=0):(V.splice(B,2),H--));return D=V.join("/"),D===""&&(D=k?"/":"."),A?(A.path=D,s(A)):D});r.normalize=l;function h(C,M){C===""&&(C="."),M===""&&(M=".");var D=n(M),A=n(C);if(A&&(C=A.path||"/"),D&&!D.scheme)return A&&(D.scheme=A.scheme),s(D);if(D||M.match(i))return M;if(A&&!A.host&&!A.path)return A.host=M,s(A);var k=M.charAt(0)==="/"?M:l(C.replace(/\/+$/,"")+"/"+M);return A?(A.path=k,s(A)):k}r.join=h,r.isAbsolute=function(C){return C.charAt(0)==="/"||t.test(C)};function u(C,M){C===""&&(C="."),C=C.replace(/\/$/,"");for(var D=0;M.indexOf(C+"/")!==0;){var A=C.lastIndexOf("/");if(A<0||(C=C.slice(0,A),C.match(/^([^\/]+:\/)?\/*$/)))return M;++D}return Array(D+1).join("../")+M.substr(C.length+1)}r.relative=u;var c=function(){var C=Object.create(null);return!("__proto__"in C)}();function d(C){return C}function f(C){return m(C)?"$"+C:C}r.toSetString=c?d:f;function g(C){return m(C)?C.slice(1):C}r.fromSetString=c?d:g;function m(C){if(!C)return!1;var M=C.length;if(M<9||C.charCodeAt(M-1)!==95||C.charCodeAt(M-2)!==95||C.charCodeAt(M-3)!==111||C.charCodeAt(M-4)!==116||C.charCodeAt(M-5)!==111||C.charCodeAt(M-6)!==114||C.charCodeAt(M-7)!==112||C.charCodeAt(M-8)!==95||C.charCodeAt(M-9)!==95)return!1;for(var D=M-10;D>=0;D--)if(C.charCodeAt(D)!==36)return!1;return!0}function w(C,M,D){var A=v(C.source,M.source);return A!==0||(A=C.originalLine-M.originalLine,A!==0)||(A=C.originalColumn-M.originalColumn,A!==0||D)||(A=C.generatedColumn-M.generatedColumn,A!==0)||(A=C.generatedLine-M.generatedLine,A!==0)?A:v(C.name,M.name)}r.compareByOriginalPositions=w;function y(C,M,D){var A;return A=C.originalLine-M.originalLine,A!==0||(A=C.originalColumn-M.originalColumn,A!==0||D)||(A=C.generatedColumn-M.generatedColumn,A!==0)||(A=C.generatedLine-M.generatedLine,A!==0)?A:v(C.name,M.name)}r.compareByOriginalPositionsNoSource=y;function E(C,M,D){var A=C.generatedLine-M.generatedLine;return A!==0||(A=C.generatedColumn-M.generatedColumn,A!==0||D)||(A=v(C.source,M.source),A!==0)||(A=C.originalLine-M.originalLine,A!==0)||(A=C.originalColumn-M.originalColumn,A!==0)?A:v(C.name,M.name)}r.compareByGeneratedPositionsDeflated=E;function x(C,M,D){var A=C.generatedColumn-M.generatedColumn;return A!==0||D||(A=v(C.source,M.source),A!==0)||(A=C.originalLine-M.originalLine,A!==0)||(A=C.originalColumn-M.originalColumn,A!==0)?A:v(C.name,M.name)}r.compareByGeneratedPositionsDeflatedNoLine=x;function v(C,M){return C===M?0:C===null?1:M===null?-1:C>M?1:-1}function S(C,M){var D=C.generatedLine-M.generatedLine;return D!==0||(D=C.generatedColumn-M.generatedColumn,D!==0)||(D=v(C.source,M.source),D!==0)||(D=C.originalLine-M.originalLine,D!==0)||(D=C.originalColumn-M.originalColumn,D!==0)?D:v(C.name,M.name)}r.compareByGeneratedPositionsInflated=S;function R(C){return JSON.parse(C.replace(/^\)]}'[^\n]*\n/,""))}r.parseSourceMapInput=R;function L(C,M,D){if(M=M||"",C&&(C[C.length-1]!=="/"&&M[0]!=="/"&&(C+="/"),M=C+M),D){var A=n(D);if(!A)throw new Error("sourceMapURL could not be parsed");if(A.path){var k=A.path.lastIndexOf("/");k>=0&&(A.path=A.path.substring(0,k+1))}M=h(s(A),M)}return l(M)}r.computeSourceURL=L})(Bs);var Jc={},Qc=Bs,ed=Object.prototype.hasOwnProperty,Pr=typeof Map<"u";function An(){this._array=[],this._set=Pr?new Map:Object.create(null)}An.fromArray=function(e,t){for(var i=new An,n=0,s=e.length;n<s;n++)i.add(e[n],t);return i};An.prototype.size=function(){return Pr?this._set.size:Object.getOwnPropertyNames(this._set).length};An.prototype.add=function(e,t){var i=Pr?e:Qc.toSetString(e),n=Pr?this.has(e):ed.call(this._set,i),s=this._array.length;(!n||t)&&this._array.push(e),n||(Pr?this._set.set(e,s):this._set[i]=s)};An.prototype.has=function(e){if(Pr)return this._set.has(e);var t=Qc.toSetString(e);return ed.call(this._set,t)};An.prototype.indexOf=function(e){if(Pr){var t=this._set.get(e);if(t>=0)return t}else{var i=Qc.toSetString(e);if(ed.call(this._set,i))return this._set[i]}throw new Error('"'+e+'" is not in the set.')};An.prototype.at=function(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)};An.prototype.toArray=function(){return this._array.slice()};Jc.ArraySet=An;var Im={},Pm=Bs;function q0(r,e){var t=r.generatedLine,i=e.generatedLine,n=r.generatedColumn,s=e.generatedColumn;return i>t||i==t&&s>=n||Pm.compareByGeneratedPositionsInflated(r,e)<=0}function Ul(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}Ul.prototype.unsortedForEach=function(e,t){this._array.forEach(e,t)};Ul.prototype.add=function(e){q0(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))};Ul.prototype.toArray=function(){return this._sorted||(this._array.sort(Pm.compareByGeneratedPositionsInflated),this._sorted=!0),this._array};Im.MappingList=Ul;var Js=Wl,rt=Bs,Ja=Jc.ArraySet,J0=Im.MappingList;function Ri(r){r||(r={}),this._file=rt.getArg(r,"file",null),this._sourceRoot=rt.getArg(r,"sourceRoot",null),this._skipValidation=rt.getArg(r,"skipValidation",!1),this._ignoreInvalidMapping=rt.getArg(r,"ignoreInvalidMapping",!1),this._sources=new Ja,this._names=new Ja,this._mappings=new J0,this._sourcesContents=null}Ri.prototype._version=3;Ri.fromSourceMap=function(e,t){var i=e.sourceRoot,n=new Ri(Object.assign(t||{},{file:e.file,sourceRoot:i}));return e.eachMapping(function(s){var o={generated:{line:s.generatedLine,column:s.generatedColumn}};s.source!=null&&(o.source=s.source,i!=null&&(o.source=rt.relative(i,o.source)),o.original={line:s.originalLine,column:s.originalColumn},s.name!=null&&(o.name=s.name)),n.addMapping(o)}),e.sources.forEach(function(s){var o=s;i!==null&&(o=rt.relative(i,s)),n._sources.has(o)||n._sources.add(o);var a=e.sourceContentFor(s);a!=null&&n.setSourceContent(s,a)}),n};Ri.prototype.addMapping=function(e){var t=rt.getArg(e,"generated"),i=rt.getArg(e,"original",null),n=rt.getArg(e,"source",null),s=rt.getArg(e,"name",null);!this._skipValidation&&this._validateMapping(t,i,n,s)===!1||(n!=null&&(n=String(n),this._sources.has(n)||this._sources.add(n)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:t.line,generatedColumn:t.column,originalLine:i!=null&&i.line,originalColumn:i!=null&&i.column,source:n,name:s}))};Ri.prototype.setSourceContent=function(e,t){var i=e;this._sourceRoot!=null&&(i=rt.relative(this._sourceRoot,i)),t!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[rt.toSetString(i)]=t):this._sourcesContents&&(delete this._sourcesContents[rt.toSetString(i)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))};Ri.prototype.applySourceMap=function(e,t,i){var n=t;if(t==null){if(e.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);n=e.file}var s=this._sourceRoot;s!=null&&(n=rt.relative(s,n));var o=new Ja,a=new Ja;this._mappings.unsortedForEach(function(l){if(l.source===n&&l.originalLine!=null){var h=e.originalPositionFor({line:l.originalLine,column:l.originalColumn});h.source!=null&&(l.source=h.source,i!=null&&(l.source=rt.join(i,l.source)),s!=null&&(l.source=rt.relative(s,l.source)),l.originalLine=h.line,l.originalColumn=h.column,h.name!=null&&(l.name=h.name))}var u=l.source;u!=null&&!o.has(u)&&o.add(u);var c=l.name;c!=null&&!a.has(c)&&a.add(c)},this),this._sources=o,this._names=a,e.sources.forEach(function(l){var h=e.sourceContentFor(l);h!=null&&(i!=null&&(l=rt.join(i,l)),s!=null&&(l=rt.relative(s,l)),this.setSourceContent(l,h))},this)};Ri.prototype._validateMapping=function(e,t,i,n){if(t&&typeof t.line!="number"&&typeof t.column!="number"){var s="original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.";if(this._ignoreInvalidMapping)return typeof console<"u"&&console.warn&&console.warn(s),!1;throw new Error(s)}if(!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!t&&!i&&!n)){if(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&i)return;var s="Invalid mapping: "+JSON.stringify({generated:e,source:i,original:t,name:n});if(this._ignoreInvalidMapping)return typeof console<"u"&&console.warn&&console.warn(s),!1;throw new Error(s)}};Ri.prototype._serializeMappings=function(){for(var e=0,t=1,i=0,n=0,s=0,o=0,a="",l,h,u,c,d=this._mappings.toArray(),f=0,g=d.length;f<g;f++){if(h=d[f],l="",h.generatedLine!==t)for(e=0;h.generatedLine!==t;)l+=";",t++;else if(f>0){if(!rt.compareByGeneratedPositionsInflated(h,d[f-1]))continue;l+=","}l+=Js.encode(h.generatedColumn-e),e=h.generatedColumn,h.source!=null&&(c=this._sources.indexOf(h.source),l+=Js.encode(c-o),o=c,l+=Js.encode(h.originalLine-1-n),n=h.originalLine-1,l+=Js.encode(h.originalColumn-i),i=h.originalColumn,h.name!=null&&(u=this._names.indexOf(h.name),l+=Js.encode(u-s),s=u)),a+=l}return a};Ri.prototype._generateSourcesContent=function(e,t){return e.map(function(i){if(!this._sourcesContents)return null;t!=null&&(i=rt.relative(t,i));var n=rt.toSetString(i);return Object.prototype.hasOwnProperty.call(this._sourcesContents,n)?this._sourcesContents[n]:null},this)};Ri.prototype.toJSON=function(){var e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(e.file=this._file),this._sourceRoot!=null&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e};Ri.prototype.toString=function(){return JSON.stringify(this.toJSON())};Sm.SourceMapGenerator=Ri;var Yl={},Fm={};(function(r){r.GREATEST_LOWER_BOUND=1,r.LEAST_UPPER_BOUND=2;function e(t,i,n,s,o,a){var l=Math.floor((i-t)/2)+t,h=o(n,s[l],!0);return h===0?l:h>0?i-l>1?e(l,i,n,s,o,a):a==r.LEAST_UPPER_BOUND?i<s.length?i:-1:l:l-t>1?e(t,l,n,s,o,a):a==r.LEAST_UPPER_BOUND?l:t<0?-1:t}r.search=function(i,n,s,o){if(n.length===0)return-1;var a=e(-1,n.length,i,n,s,o||r.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(n[a],n[a-1],!0)===0;)--a;return a}})(Fm);var Om={};function Q0(r){function e(n,s,o){var a=n[s];n[s]=n[o],n[o]=a}function t(n,s){return Math.round(n+Math.random()*(s-n))}function i(n,s,o,a){if(o<a){var l=t(o,a),h=o-1;e(n,l,a);for(var u=n[a],c=o;c<a;c++)s(n[c],u,!1)<=0&&(h+=1,e(n,h,c));e(n,h+1,c);var d=h+1;i(n,s,o,d-1),i(n,s,d+1,a)}}return i}function eE(r){let e=Q0.toString();return new Function(`return ${e}`)()(r)}let Qf=new WeakMap;Om.quickSort=function(r,e,t=0){let i=Qf.get(e);i===void 0&&(i=eE(e),Qf.set(e,i)),i(r,e,t,r.length-1)};var se=Bs,td=Fm,Ts=Jc.ArraySet,tE=Wl,Io=Om.quickSort;function Xe(r,e){var t=r;return typeof r=="string"&&(t=se.parseSourceMapInput(r)),t.sections!=null?new Gi(t,e):new wt(t,e)}Xe.fromSourceMap=function(r,e){return wt.fromSourceMap(r,e)};Xe.prototype._version=3;Xe.prototype.__generatedMappings=null;Object.defineProperty(Xe.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}});Xe.prototype.__originalMappings=null;Object.defineProperty(Xe.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}});Xe.prototype._charIsMappingSeparator=function(e,t){var i=e.charAt(t);return i===";"||i===","};Xe.prototype._parseMappings=function(e,t){throw new Error("Subclasses must implement _parseMappings")};Xe.GENERATED_ORDER=1;Xe.ORIGINAL_ORDER=2;Xe.GREATEST_LOWER_BOUND=1;Xe.LEAST_UPPER_BOUND=2;Xe.prototype.eachMapping=function(e,t,i){var n=t||null,s=i||Xe.GENERATED_ORDER,o;switch(s){case Xe.GENERATED_ORDER:o=this._generatedMappings;break;case Xe.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}for(var a=this.sourceRoot,l=e.bind(n),h=this._names,u=this._sources,c=this._sourceMapURL,d=0,f=o.length;d<f;d++){var g=o[d],m=g.source===null?null:u.at(g.source);m!==null&&(m=se.computeSourceURL(a,m,c)),l({source:m,generatedLine:g.generatedLine,generatedColumn:g.generatedColumn,originalLine:g.originalLine,originalColumn:g.originalColumn,name:g.name===null?null:h.at(g.name)})}};Xe.prototype.allGeneratedPositionsFor=function(e){var t=se.getArg(e,"line"),i={source:se.getArg(e,"source"),originalLine:t,originalColumn:se.getArg(e,"column",0)};if(i.source=this._findSourceIndex(i.source),i.source<0)return[];var n=[],s=this._findMapping(i,this._originalMappings,"originalLine","originalColumn",se.compareByOriginalPositions,td.LEAST_UPPER_BOUND);if(s>=0){var o=this._originalMappings[s];if(e.column===void 0)for(var a=o.originalLine;o&&o.originalLine===a;)n.push({line:se.getArg(o,"generatedLine",null),column:se.getArg(o,"generatedColumn",null),lastColumn:se.getArg(o,"lastGeneratedColumn",null)}),o=this._originalMappings[++s];else for(var l=o.originalColumn;o&&o.originalLine===t&&o.originalColumn==l;)n.push({line:se.getArg(o,"generatedLine",null),column:se.getArg(o,"generatedColumn",null),lastColumn:se.getArg(o,"lastGeneratedColumn",null)}),o=this._originalMappings[++s]}return n};Yl.SourceMapConsumer=Xe;function wt(r,e){var t=r;typeof r=="string"&&(t=se.parseSourceMapInput(r));var i=se.getArg(t,"version"),n=se.getArg(t,"sources"),s=se.getArg(t,"names",[]),o=se.getArg(t,"sourceRoot",null),a=se.getArg(t,"sourcesContent",null),l=se.getArg(t,"mappings"),h=se.getArg(t,"file",null);if(i!=this._version)throw new Error("Unsupported version: "+i);o&&(o=se.normalize(o)),n=n.map(String).map(se.normalize).map(function(u){return o&&se.isAbsolute(o)&&se.isAbsolute(u)?se.relative(o,u):u}),this._names=Ts.fromArray(s.map(String),!0),this._sources=Ts.fromArray(n,!0),this._absoluteSources=this._sources.toArray().map(function(u){return se.computeSourceURL(o,u,e)}),this.sourceRoot=o,this.sourcesContent=a,this._mappings=l,this._sourceMapURL=e,this.file=h}wt.prototype=Object.create(Xe.prototype);wt.prototype.consumer=Xe;wt.prototype._findSourceIndex=function(r){var e=r;if(this.sourceRoot!=null&&(e=se.relative(this.sourceRoot,e)),this._sources.has(e))return this._sources.indexOf(e);var t;for(t=0;t<this._absoluteSources.length;++t)if(this._absoluteSources[t]==r)return t;return-1};wt.fromSourceMap=function(e,t){var i=Object.create(wt.prototype),n=i._names=Ts.fromArray(e._names.toArray(),!0),s=i._sources=Ts.fromArray(e._sources.toArray(),!0);i.sourceRoot=e._sourceRoot,i.sourcesContent=e._generateSourcesContent(i._sources.toArray(),i.sourceRoot),i.file=e._file,i._sourceMapURL=t,i._absoluteSources=i._sources.toArray().map(function(f){return se.computeSourceURL(i.sourceRoot,f,t)});for(var o=e._mappings.toArray().slice(),a=i.__generatedMappings=[],l=i.__originalMappings=[],h=0,u=o.length;h<u;h++){var c=o[h],d=new Dm;d.generatedLine=c.generatedLine,d.generatedColumn=c.generatedColumn,c.source&&(d.source=s.indexOf(c.source),d.originalLine=c.originalLine,d.originalColumn=c.originalColumn,c.name&&(d.name=n.indexOf(c.name)),l.push(d)),a.push(d)}return Io(i.__originalMappings,se.compareByOriginalPositions),i};wt.prototype._version=3;Object.defineProperty(wt.prototype,"sources",{get:function(){return this._absoluteSources.slice()}});function Dm(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}const Lh=se.compareByGeneratedPositionsDeflatedNoLine;function eg(r,e){let t=r.length,i=r.length-e;if(!(i<=1))if(i==2){let n=r[e],s=r[e+1];Lh(n,s)>0&&(r[e]=s,r[e+1]=n)}else if(i<20)for(let n=e;n<t;n++)for(let s=n;s>e;s--){let o=r[s-1],a=r[s];if(Lh(o,a)<=0)break;r[s-1]=a,r[s]=o}else Io(r,Lh,e)}wt.prototype._parseMappings=function(e,t){var i=1,n=0,s=0,o=0,a=0,l=0,h=e.length,u=0,c={},d=[],f=[],g,m,w,y;let E=0;for(;u<h;)if(e.charAt(u)===";")i++,u++,n=0,eg(f,E),E=f.length;else if(e.charAt(u)===",")u++;else{for(g=new Dm,g.generatedLine=i,w=u;w<h&&!this._charIsMappingSeparator(e,w);w++);for(e.slice(u,w),m=[];u<w;)tE.decode(e,u,c),y=c.value,u=c.rest,m.push(y);if(m.length===2)throw new Error("Found a source, but no line and column");if(m.length===3)throw new Error("Found a source and line, but no column");if(g.generatedColumn=n+m[0],n=g.generatedColumn,m.length>1&&(g.source=a+m[1],a+=m[1],g.originalLine=s+m[2],s=g.originalLine,g.originalLine+=1,g.originalColumn=o+m[3],o=g.originalColumn,m.length>4&&(g.name=l+m[4],l+=m[4])),f.push(g),typeof g.originalLine=="number"){let v=g.source;for(;d.length<=v;)d.push(null);d[v]===null&&(d[v]=[]),d[v].push(g)}}eg(f,E),this.__generatedMappings=f;for(var x=0;x<d.length;x++)d[x]!=null&&Io(d[x],se.compareByOriginalPositionsNoSource);this.__originalMappings=[].concat(...d)};wt.prototype._findMapping=function(e,t,i,n,s,o){if(e[i]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[i]);if(e[n]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[n]);return td.search(e,t,s,o)};wt.prototype.computeColumnSpans=function(){for(var e=0;e<this._generatedMappings.length;++e){var t=this._generatedMappings[e];if(e+1<this._generatedMappings.length){var i=this._generatedMappings[e+1];if(t.generatedLine===i.generatedLine){t.lastGeneratedColumn=i.generatedColumn-1;continue}}t.lastGeneratedColumn=1/0}};wt.prototype.originalPositionFor=function(e){var t={generatedLine:se.getArg(e,"line"),generatedColumn:se.getArg(e,"column")},i=this._findMapping(t,this._generatedMappings,"generatedLine","generatedColumn",se.compareByGeneratedPositionsDeflated,se.getArg(e,"bias",Xe.GREATEST_LOWER_BOUND));if(i>=0){var n=this._generatedMappings[i];if(n.generatedLine===t.generatedLine){var s=se.getArg(n,"source",null);s!==null&&(s=this._sources.at(s),s=se.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));var o=se.getArg(n,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:se.getArg(n,"originalLine",null),column:se.getArg(n,"originalColumn",null),name:o}}}return{source:null,line:null,column:null,name:null}};wt.prototype.hasContentsOfAllSources=function(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return e==null}):!1};wt.prototype.sourceContentFor=function(e,t){if(!this.sourcesContent)return null;var i=this._findSourceIndex(e);if(i>=0)return this.sourcesContent[i];var n=e;this.sourceRoot!=null&&(n=se.relative(this.sourceRoot,n));var s;if(this.sourceRoot!=null&&(s=se.urlParse(this.sourceRoot))){var o=n.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+n))return this.sourcesContent[this._sources.indexOf("/"+n)]}if(t)return null;throw new Error('"'+n+'" is not in the SourceMap.')};wt.prototype.generatedPositionFor=function(e){var t=se.getArg(e,"source");if(t=this._findSourceIndex(t),t<0)return{line:null,column:null,lastColumn:null};var i={source:t,originalLine:se.getArg(e,"line"),originalColumn:se.getArg(e,"column")},n=this._findMapping(i,this._originalMappings,"originalLine","originalColumn",se.compareByOriginalPositions,se.getArg(e,"bias",Xe.GREATEST_LOWER_BOUND));if(n>=0){var s=this._originalMappings[n];if(s.source===i.source)return{line:se.getArg(s,"generatedLine",null),column:se.getArg(s,"generatedColumn",null),lastColumn:se.getArg(s,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}};Yl.BasicSourceMapConsumer=wt;function Gi(r,e){var t=r;typeof r=="string"&&(t=se.parseSourceMapInput(r));var i=se.getArg(t,"version"),n=se.getArg(t,"sections");if(i!=this._version)throw new Error("Unsupported version: "+i);this._sources=new Ts,this._names=new Ts;var s={line:-1,column:0};this._sections=n.map(function(o){if(o.url)throw new Error("Support for url field in sections not implemented.");var a=se.getArg(o,"offset"),l=se.getArg(a,"line"),h=se.getArg(a,"column");if(l<s.line||l===s.line&&h<s.column)throw new Error("Section offsets must be ordered and non-overlapping.");return s=a,{generatedOffset:{generatedLine:l+1,generatedColumn:h+1},consumer:new Xe(se.getArg(o,"map"),e)}})}Gi.prototype=Object.create(Xe.prototype);Gi.prototype.constructor=Xe;Gi.prototype._version=3;Object.defineProperty(Gi.prototype,"sources",{get:function(){for(var r=[],e=0;e<this._sections.length;e++)for(var t=0;t<this._sections[e].consumer.sources.length;t++)r.push(this._sections[e].consumer.sources[t]);return r}});Gi.prototype.originalPositionFor=function(e){var t={generatedLine:se.getArg(e,"line"),generatedColumn:se.getArg(e,"column")},i=td.search(t,this._sections,function(s,o){var a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),n=this._sections[i];return n?n.consumer.originalPositionFor({line:t.generatedLine-(n.generatedOffset.generatedLine-1),column:t.generatedColumn-(n.generatedOffset.generatedLine===t.generatedLine?n.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}};Gi.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})};Gi.prototype.sourceContentFor=function(e,t){for(var i=0;i<this._sections.length;i++){var n=this._sections[i],s=n.consumer.sourceContentFor(e,!0);if(s||s==="")return s}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')};Gi.prototype.generatedPositionFor=function(e){for(var t=0;t<this._sections.length;t++){var i=this._sections[t];if(i.consumer._findSourceIndex(se.getArg(e,"source"))!==-1){var n=i.consumer.generatedPositionFor(e);if(n){var s={line:n.line+(i.generatedOffset.generatedLine-1),column:n.column+(i.generatedOffset.generatedLine===n.line?i.generatedOffset.generatedColumn-1:0)};return s}}}return{line:null,column:null}};Gi.prototype._parseMappings=function(e,t){this.__generatedMappings=[],this.__originalMappings=[];for(var i=0;i<this._sections.length;i++)for(var n=this._sections[i],s=n.consumer._generatedMappings,o=0;o<s.length;o++){var a=s[o],l=n.consumer._sources.at(a.source);l!==null&&(l=se.computeSourceURL(n.consumer.sourceRoot,l,this._sourceMapURL)),this._sources.add(l),l=this._sources.indexOf(l);var h=null;a.name&&(h=n.consumer._names.at(a.name),this._names.add(h),h=this._names.indexOf(h));var u={source:l,generatedLine:a.generatedLine+(n.generatedOffset.generatedLine-1),generatedColumn:a.generatedColumn+(n.generatedOffset.generatedLine===a.generatedLine?n.generatedOffset.generatedColumn-1:0),originalLine:a.originalLine,originalColumn:a.originalColumn,name:h};this.__generatedMappings.push(u),typeof u.originalLine=="number"&&this.__originalMappings.push(u)}Io(this.__generatedMappings,se.compareByGeneratedPositionsDeflated),Io(this.__originalMappings,se.compareByOriginalPositions)};Yl.IndexedSourceMapConsumer=Gi;var iE=Sm.SourceMapGenerator,Qa=Bs,nE=/(\r?\n)/,rE=10,Gs="$$$isSourceNode$$$";function Ei(r,e,t,i,n){this.children=[],this.sourceContents={},this.line=r??null,this.column=e??null,this.source=t??null,this.name=n??null,this[Gs]=!0,i!=null&&this.add(i)}Ei.fromStringWithSourceMap=function(e,t,i){var n=new Ei,s=e.split(nE),o=0,a=function(){var d=g(),f=g()||"";return d+f;function g(){return o<s.length?s[o++]:void 0}},l=1,h=0,u=null;return t.eachMapping(function(d){if(u!==null)if(l<d.generatedLine)c(u,a()),l++,h=0;else{var f=s[o]||"",g=f.substr(0,d.generatedColumn-h);s[o]=f.substr(d.generatedColumn-h),h=d.generatedColumn,c(u,g),u=d;return}for(;l<d.generatedLine;)n.add(a()),l++;if(h<d.generatedColumn){var f=s[o]||"";n.add(f.substr(0,d.generatedColumn)),s[o]=f.substr(d.generatedColumn),h=d.generatedColumn}u=d},this),o<s.length&&(u&&c(u,a()),n.add(s.splice(o).join(""))),t.sources.forEach(function(d){var f=t.sourceContentFor(d);f!=null&&(i!=null&&(d=Qa.join(i,d)),n.setSourceContent(d,f))}),n;function c(d,f){if(d===null||d.source===void 0)n.add(f);else{var g=i?Qa.join(i,d.source):d.source;n.add(new Ei(d.originalLine,d.originalColumn,g,f,d.name))}}};Ei.prototype.add=function(e){if(Array.isArray(e))e.forEach(function(t){this.add(t)},this);else if(e[Gs]||typeof e=="string")e&&this.children.push(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this};Ei.prototype.prepend=function(e){if(Array.isArray(e))for(var t=e.length-1;t>=0;t--)this.prepend(e[t]);else if(e[Gs]||typeof e=="string")this.children.unshift(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this};Ei.prototype.walk=function(e){for(var t,i=0,n=this.children.length;i<n;i++)t=this.children[i],t[Gs]?t.walk(e):t!==""&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})};Ei.prototype.join=function(e){var t,i,n=this.children.length;if(n>0){for(t=[],i=0;i<n-1;i++)t.push(this.children[i]),t.push(e);t.push(this.children[i]),this.children=t}return this};Ei.prototype.replaceRight=function(e,t){var i=this.children[this.children.length-1];return i[Gs]?i.replaceRight(e,t):typeof i=="string"?this.children[this.children.length-1]=i.replace(e,t):this.children.push("".replace(e,t)),this};Ei.prototype.setSourceContent=function(e,t){this.sourceContents[Qa.toSetString(e)]=t};Ei.prototype.walkSourceContents=function(e){for(var t=0,i=this.children.length;t<i;t++)this.children[t][Gs]&&this.children[t].walkSourceContents(e);for(var n=Object.keys(this.sourceContents),t=0,i=n.length;t<i;t++)e(Qa.fromSetString(n[t]),this.sourceContents[n[t]])};Ei.prototype.toString=function(){var e="";return this.walk(function(t){e+=t}),e};Ei.prototype.toStringWithSourceMap=function(e){var t={code:"",line:1,column:0},i=new iE(e),n=!1,s=null,o=null,a=null,l=null;return this.walk(function(h,u){t.code+=h,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||l!==u.name)&&i.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:t.line,column:t.column},name:u.name}),s=u.source,o=u.line,a=u.column,l=u.name,n=!0):n&&(i.addMapping({generated:{line:t.line,column:t.column}}),s=null,n=!1);for(var c=0,d=h.length;c<d;c++)h.charCodeAt(c)===rE?(t.line++,t.column=0,c+1===d?(s=null,n=!1):n&&i.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:t.line,column:t.column},name:u.name})):t.column++}),this.walkSourceContents(function(h,u){i.setSourceContent(h,u)}),{code:t.code,map:i}};var Gk=Yl.SourceMapConsumer,id={exports:{}};id.exports;(function(r){var e=function(){var t=String.fromCharCode,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={};function o(l,h){if(!s[l]){s[l]={};for(var u=0;u<l.length;u++)s[l][l.charAt(u)]=u}return s[l][h]}var a={compressToBase64:function(l){if(l==null)return"";var h=a._compress(l,6,function(u){return i.charAt(u)});switch(h.length%4){default:case 0:return h;case 1:return h+"===";case 2:return h+"==";case 3:return h+"="}},decompressFromBase64:function(l){return l==null?"":l==""?null:a._decompress(l.length,32,function(h){return o(i,l.charAt(h))})},compressToUTF16:function(l){return l==null?"":a._compress(l,15,function(h){return t(h+32)})+" "},decompressFromUTF16:function(l){return l==null?"":l==""?null:a._decompress(l.length,16384,function(h){return l.charCodeAt(h)-32})},compressToUint8Array:function(l){for(var h=a.compress(l),u=new Uint8Array(h.length*2),c=0,d=h.length;c<d;c++){var f=h.charCodeAt(c);u[c*2]=f>>>8,u[c*2+1]=f%256}return u},decompressFromUint8Array:function(l){if(l==null)return a.decompress(l);for(var h=new Array(l.length/2),u=0,c=h.length;u<c;u++)h[u]=l[u*2]*256+l[u*2+1];var d=[];return h.forEach(function(f){d.push(t(f))}),a.decompress(d.join(""))},compressToEncodedURIComponent:function(l){return l==null?"":a._compress(l,6,function(h){return n.charAt(h)})},decompressFromEncodedURIComponent:function(l){return l==null?"":l==""?null:(l=l.replace(/ /g,"+"),a._decompress(l.length,32,function(h){return o(n,l.charAt(h))}))},compress:function(l){return a._compress(l,16,function(h){return t(h)})},_compress:function(l,h,u){if(l==null)return"";var c,d,f={},g={},m="",w="",y="",E=2,x=3,v=2,S=[],R=0,L=0,C;for(C=0;C<l.length;C+=1)if(m=l.charAt(C),Object.prototype.hasOwnProperty.call(f,m)||(f[m]=x++,g[m]=!0),w=y+m,Object.prototype.hasOwnProperty.call(f,w))y=w;else{if(Object.prototype.hasOwnProperty.call(g,y)){if(y.charCodeAt(0)<256){for(c=0;c<v;c++)R=R<<1,L==h-1?(L=0,S.push(u(R)),R=0):L++;for(d=y.charCodeAt(0),c=0;c<8;c++)R=R<<1|d&1,L==h-1?(L=0,S.push(u(R)),R=0):L++,d=d>>1}else{for(d=1,c=0;c<v;c++)R=R<<1|d,L==h-1?(L=0,S.push(u(R)),R=0):L++,d=0;for(d=y.charCodeAt(0),c=0;c<16;c++)R=R<<1|d&1,L==h-1?(L=0,S.push(u(R)),R=0):L++,d=d>>1}E--,E==0&&(E=Math.pow(2,v),v++),delete g[y]}else for(d=f[y],c=0;c<v;c++)R=R<<1|d&1,L==h-1?(L=0,S.push(u(R)),R=0):L++,d=d>>1;E--,E==0&&(E=Math.pow(2,v),v++),f[w]=x++,y=String(m)}if(y!==""){if(Object.prototype.hasOwnProperty.call(g,y)){if(y.charCodeAt(0)<256){for(c=0;c<v;c++)R=R<<1,L==h-1?(L=0,S.push(u(R)),R=0):L++;for(d=y.charCodeAt(0),c=0;c<8;c++)R=R<<1|d&1,L==h-1?(L=0,S.push(u(R)),R=0):L++,d=d>>1}else{for(d=1,c=0;c<v;c++)R=R<<1|d,L==h-1?(L=0,S.push(u(R)),R=0):L++,d=0;for(d=y.charCodeAt(0),c=0;c<16;c++)R=R<<1|d&1,L==h-1?(L=0,S.push(u(R)),R=0):L++,d=d>>1}E--,E==0&&(E=Math.pow(2,v),v++),delete g[y]}else for(d=f[y],c=0;c<v;c++)R=R<<1|d&1,L==h-1?(L=0,S.push(u(R)),R=0):L++,d=d>>1;E--,E==0&&(E=Math.pow(2,v),v++)}for(d=2,c=0;c<v;c++)R=R<<1|d&1,L==h-1?(L=0,S.push(u(R)),R=0):L++,d=d>>1;for(;;)if(R=R<<1,L==h-1){S.push(u(R));break}else L++;return S.join("")},decompress:function(l){return l==null?"":l==""?null:a._decompress(l.length,32768,function(h){return l.charCodeAt(h)})},_decompress:function(l,h,u){var c=[],d=4,f=4,g=3,m="",w=[],y,E,x,v,S,R,L,C={val:u(0),position:h,index:1};for(y=0;y<3;y+=1)c[y]=y;for(x=0,S=Math.pow(2,2),R=1;R!=S;)v=C.val&C.position,C.position>>=1,C.position==0&&(C.position=h,C.val=u(C.index++)),x|=(v>0?1:0)*R,R<<=1;switch(x){case 0:for(x=0,S=Math.pow(2,8),R=1;R!=S;)v=C.val&C.position,C.position>>=1,C.position==0&&(C.position=h,C.val=u(C.index++)),x|=(v>0?1:0)*R,R<<=1;L=t(x);break;case 1:for(x=0,S=Math.pow(2,16),R=1;R!=S;)v=C.val&C.position,C.position>>=1,C.position==0&&(C.position=h,C.val=u(C.index++)),x|=(v>0?1:0)*R,R<<=1;L=t(x);break;case 2:return""}for(c[3]=L,E=L,w.push(L);;){if(C.index>l)return"";for(x=0,S=Math.pow(2,g),R=1;R!=S;)v=C.val&C.position,C.position>>=1,C.position==0&&(C.position=h,C.val=u(C.index++)),x|=(v>0?1:0)*R,R<<=1;switch(L=x){case 0:for(x=0,S=Math.pow(2,8),R=1;R!=S;)v=C.val&C.position,C.position>>=1,C.position==0&&(C.position=h,C.val=u(C.index++)),x|=(v>0?1:0)*R,R<<=1;c[f++]=t(x),L=f-1,d--;break;case 1:for(x=0,S=Math.pow(2,16),R=1;R!=S;)v=C.val&C.position,C.position>>=1,C.position==0&&(C.position=h,C.val=u(C.index++)),x|=(v>0?1:0)*R,R<<=1;c[f++]=t(x),L=f-1,d--;break;case 2:return w.join("")}if(d==0&&(d=Math.pow(2,g),g++),c[L])m=c[L];else if(L===f)m=E+E.charAt(0);else return null;w.push(m),c[f++]=E+m.charAt(0),d--,E=m,d==0&&(d=Math.pow(2,g),g++)}}};return a}();r!=null?r.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})})(id);var sE=id.exports;const Hk=Vl(sE);var km={exports:{}};(function(r,e){(function(t,i){i()})(vr,function(){function t(h,u){return typeof u>"u"?u={autoBom:!1}:typeof u!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),u={autoBom:!u}),u.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(h.type)?new Blob(["\uFEFF",h],{type:h.type}):h}function i(h,u,c){var d=new XMLHttpRequest;d.open("GET",h),d.responseType="blob",d.onload=function(){l(d.response,u,c)},d.onerror=function(){console.error("could not download file")},d.send()}function n(h){var u=new XMLHttpRequest;u.open("HEAD",h,!1);try{u.send()}catch{}return 200<=u.status&&299>=u.status}function s(h){try{h.dispatchEvent(new MouseEvent("click"))}catch{var u=document.createEvent("MouseEvents");u.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),h.dispatchEvent(u)}}var o=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof vr=="object"&&vr.global===vr?vr:void 0,a=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=o.saveAs||(typeof window!="object"||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(h,u,c){var d=o.URL||o.webkitURL,f=document.createElement("a");u=u||h.name||"download",f.download=u,f.rel="noopener",typeof h=="string"?(f.href=h,f.origin===location.origin?s(f):n(f.href)?i(h,u,c):s(f,f.target="_blank")):(f.href=d.createObjectURL(h),setTimeout(function(){d.revokeObjectURL(f.href)},4e4),setTimeout(function(){s(f)},0))}:"msSaveOrOpenBlob"in navigator?function(h,u,c){if(u=u||h.name||"download",typeof h!="string")navigator.msSaveOrOpenBlob(t(h,c),u);else if(n(h))i(h,u,c);else{var d=document.createElement("a");d.href=h,d.target="_blank",setTimeout(function(){s(d)})}}:function(h,u,c,d){if(d=d||open("","_blank"),d&&(d.document.title=d.document.body.innerText="downloading..."),typeof h=="string")return i(h,u,c);var f=h.type==="application/octet-stream",g=/constructor/i.test(o.HTMLElement)||o.safari,m=/CriOS\/[\d]+/.test(navigator.userAgent);if((m||f&&g||a)&&typeof FileReader<"u"){var w=new FileReader;w.onloadend=function(){var x=w.result;x=m?x:x.replace(/^data:[^;]*;/,"data:attachment/file;"),d?d.location.href=x:location=x,d=null},w.readAsDataURL(h)}else{var y=o.URL||o.webkitURL,E=y.createObjectURL(h);d?d.location=E:location.href=E,d=null,setTimeout(function(){y.revokeObjectURL(E)},4e4)}});o.saveAs=l.saveAs=l,r.exports=l})})(km);var Vk=km.exports;class rn{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const Ms={PROPERTYCHANGE:"propertychange"};class nd{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function oE(r,e,t){let i,n;t=t||qi;let s=0,o=r.length,a=!1;for(;s<o;)i=s+(o-s>>1),n=+t(r[i],e),n<0?s=i+1:(o=i,a=!n);return a?s:~s}function qi(r,e){return r>e?1:r<e?-1:0}function Wk(r,e){return r<e?1:r>e?-1:0}function jl(r,e,t){if(r[0]<=e)return 0;const i=r.length;if(e<=r[i-1])return i-1;if(typeof t=="function"){for(let n=1;n<i;++n){const s=r[n];if(s===e)return n;if(s<e)return t(e,r[n-1],s)>0?n-1:n}return i-1}if(t>0){for(let n=1;n<i;++n)if(r[n]<e)return n-1;return i-1}if(t<0){for(let n=1;n<i;++n)if(r[n]<=e)return n;return i-1}for(let n=1;n<i;++n){if(r[n]==e)return n;if(r[n]<e)return r[n-1]-e<e-r[n]?n-1:n}return i-1}function aE(r,e,t){for(;e<t;){const i=r[e];r[e]=r[t],r[t]=i,++e,--t}}function Fe(r,e){const t=Array.isArray(e)?e:[e],i=t.length;for(let n=0;n<i;n++)r[r.length]=t[n]}function ur(r,e){const t=r.length;if(t!==e.length)return!1;for(let i=0;i<t;i++)if(r[i]!==e[i])return!1;return!0}function lE(r,e,t){const i=e||qi;return r.every(function(n,s){if(s===0)return!0;const o=i(r[s-1],n);return!(o>0||t&&o===0)})}function Po(){return!0}function qo(){return!1}function Ls(){}function Nm(r){let e=!1,t,i,n;return function(){const s=Array.prototype.slice.call(arguments);return(!e||this!==n||!ur(s,i))&&(e=!0,n=this,i=s,t=r.apply(this,arguments)),t}}function zm(r){function e(){let t;try{t=r()}catch(i){return Promise.reject(i)}return t instanceof Promise?t:Promise.resolve(t)}return e()}class Jo extends nd{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const i=this.listeners_||(this.listeners_={}),n=i[e]||(i[e]=[]);n.includes(t)||n.push(t)}dispatchEvent(e){const t=typeof e=="string",i=t?e:e.type,n=this.listeners_&&this.listeners_[i];if(!n)return;const s=t?new rn(e):e;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});i in o||(o[i]=0,a[i]=0),++o[i];let l;for(let h=0,u=n.length;h<u;++h)if("handleEvent"in n[h]?l=n[h].handleEvent(s):l=n[h].call(this,s),l===!1||s.propagationStopped){l=!1;break}if(--o[i]===0){let h=a[i];for(delete a[i];h--;)this.removeEventListener(i,Ls);delete o[i]}return l}disposeInternal(){this.listeners_&&$o(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,t){if(!this.listeners_)return;const i=this.listeners_[e];if(!i)return;const n=i.indexOf(t);n!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(i[n]=Ls,++this.pendingRemovals_[e]):(i.splice(n,1),i.length===0&&delete this.listeners_[e]))}}const Ee={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function Oe(r,e,t,i,n){if(i&&i!==r&&(t=t.bind(i)),n){const o=t;t=function(){r.removeEventListener(e,t),o.apply(this,arguments)}}const s={target:r,type:e,listener:t};return r.addEventListener(e,t),s}function el(r,e,t,i){return Oe(r,e,t,i,!0)}function We(r){r&&r.target&&(r.target.removeEventListener(r.type,r.listener),$o(r))}class Xl extends Jo{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(Ee.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const i=e.length,n=new Array(i);for(let s=0;s<i;++s)n[s]=Oe(this,e[s],t);return n}return Oe(this,e,t)}onceInternal(e,t){let i;if(Array.isArray(e)){const n=e.length;i=new Array(n);for(let s=0;s<n;++s)i[s]=el(this,e[s],t)}else i=el(this,e,t);return t.ol_key=i,i}unInternal(e,t){const i=t.ol_key;if(i)hE(i);else if(Array.isArray(e))for(let n=0,s=e.length;n<s;++n)this.removeEventListener(e[n],t);else this.removeEventListener(e,t)}}Xl.prototype.on;Xl.prototype.once;Xl.prototype.un;function hE(r){if(Array.isArray(r))for(let e=0,t=r.length;e<t;++e)We(r[e]);else We(r)}const Bm=Xl;function ge(){throw new Error("Unimplemented abstract method.")}let uE=0;function xe(r){return r.ol_uid||(r.ol_uid=String(++uE))}class tg extends rn{constructor(e,t,i){super(e),this.key=t,this.oldValue=i}}class Hi extends Bm{constructor(e){super(),this.on,this.once,this.un,xe(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,t){let i;i=`change:${e}`,this.hasListener(i)&&this.dispatchEvent(new tg(i,e,t)),i=Ms.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new tg(i,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,i){const n=this.values_||(this.values_={});if(i)n[e]=t;else{const s=n[e];n[e]=t,s!==t&&this.notify(e,s)}}setProperties(e,t){for(const i in e)this.set(i,e[i],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const i=this.values_[e];delete this.values_[e],Dr(this.values_)&&(this.values_=null),t||this.notify(e,i)}}}const Vt={ADD:"add",REMOVE:"remove"},ig={LENGTH:"length"};class ba extends rn{constructor(e,t,i){super(e),this.element=t,this.index=i}}class Xi extends Hi{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e||[],this.unique_)for(let i=0,n=this.array_.length;i<n;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,i=e.length;t<i;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let i=0,n=t.length;i<n;++i)e(t[i],i,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(ig.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new ba(Vt.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){this.unique_&&this.assertUnique_(e);const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let i=0,n=t.length;i<n;++i)if(t[i]===e)return this.removeAt(i)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new ba(Vt.REMOVE,t,e)),t}setAt(e,t){const i=this.getLength();if(e>=i){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const n=this.array_[e];this.array_[e]=t,this.dispatchEvent(new ba(Vt.REMOVE,n,e)),this.dispatchEvent(new ba(Vt.ADD,t,e))}updateLength_(){this.set(ig.LENGTH,this.array_.length)}assertUnique_(e,t){for(let i=0,n=this.array_.length;i<n;++i)if(this.array_[i]===e&&i!==t)throw new Error("Duplicate item added to a unique collection")}}const He={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};function Ae(r,e){if(!r)throw new Error(e)}class Gm extends Hi{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[He.OPACITY]=e.opacity!==void 0?e.opacity:1,Ae(typeof t[He.OPACITY]=="number","Layer opacity must be a number"),t[He.VISIBLE]=e.visible!==void 0?e.visible:!0,t[He.Z_INDEX]=e.zIndex,t[He.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[He.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[He.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[He.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0?!0:e},i=this.getZIndex();return t.opacity=it(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=i===void 0&&!t.managed?1/0:i,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return ge()}getLayerStatesArray(e){return ge()}getExtent(){return this.get(He.EXTENT)}getMaxResolution(){return this.get(He.MAX_RESOLUTION)}getMinResolution(){return this.get(He.MIN_RESOLUTION)}getMinZoom(){return this.get(He.MIN_ZOOM)}getMaxZoom(){return this.get(He.MAX_ZOOM)}getOpacity(){return this.get(He.OPACITY)}getSourceState(){return ge()}getVisible(){return this.get(He.VISIBLE)}getZIndex(){return this.get(He.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(He.EXTENT,e)}setMaxResolution(e){this.set(He.MAX_RESOLUTION,e)}setMinResolution(e){this.set(He.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(He.MAX_ZOOM,e)}setMinZoom(e){this.set(He.MIN_ZOOM,e)}setOpacity(e){Ae(typeof e=="number","Layer opacity must be a number"),this.set(He.OPACITY,e)}setVisible(e){this.set(He.VISIBLE,e)}setZIndex(e){this.set(He.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const bi={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},Ke={ANIMATING:0,INTERACTING:1},Ai={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},cE=42,rd=256;function ng(r,e,t){return function(i,n,s,o,a){if(!i)return;if(!n&&!e)return i;const l=e?0:s[0]*n,h=e?0:s[1]*n,u=a?a[0]:0,c=a?a[1]:0;let d=r[0]+l/2+u,f=r[2]-l/2+u,g=r[1]+h/2+c,m=r[3]-h/2+c;d>f&&(d=(f+d)/2,f=d),g>m&&(g=(m+g)/2,m=g);let w=it(i[0],d,f),y=it(i[1],g,m);if(o&&t&&n){const E=30*n;w+=-E*Math.log(1+Math.max(0,d-i[0])/E)+E*Math.log(1+Math.max(0,i[0]-f)/E),y+=-E*Math.log(1+Math.max(0,g-i[1])/E)+E*Math.log(1+Math.max(0,i[1]-m)/E)}return[w,y]}}function dE(r){return r}function sd(r,e,t,i){const n=Pe(e)/t[0],s=st(e)/t[1];return i?Math.min(r,Math.max(n,s)):Math.min(r,Math.min(n,s))}function od(r,e,t){let i=Math.min(r,e);const n=50;return i*=Math.log(1+n*Math.max(0,r/e-1))/n+1,t&&(i=Math.max(i,t),i/=Math.log(1+n*Math.max(0,t/r-1))/n+1),it(i,t/2,e*2)}function fE(r,e,t,i){return e=e!==void 0?e:!0,function(n,s,o,a){if(n!==void 0){const l=r[0],h=r[r.length-1],u=t?sd(l,t,o,i):l;if(a)return e?od(n,u,h):it(n,h,u);const c=Math.min(u,n),d=Math.floor(jl(r,c,s));return r[d]>u&&d<r.length-1?r[d+1]:r[d]}}}function gE(r,e,t,i,n,s){return i=i!==void 0?i:!0,t=t!==void 0?t:0,function(o,a,l,h){if(o!==void 0){const u=n?sd(e,n,l,s):e;if(h)return i?od(o,u,t):it(o,t,u);const c=1e-9,d=Math.ceil(Math.log(e/u)/Math.log(r)-c),f=-a*(.5-c)+.5,g=Math.min(u,o),m=Math.floor(Math.log(e/g)/Math.log(r)+f),w=Math.max(d,m),y=e/Math.pow(r,w);return it(y,t,u)}}}function rg(r,e,t,i,n){return t=t!==void 0?t:!0,function(s,o,a,l){if(s!==void 0){const h=i?sd(r,i,a,n):r;return!t||!l?it(s,e,h):od(s,h,e)}}}function ad(r){if(r!==void 0)return 0}function sg(r){if(r!==void 0)return r}function pE(r){const e=2*Math.PI/r;return function(t,i){if(i)return t;if(t!==void 0)return t=Math.floor(t/e+.5)*e,t}}function mE(r){const e=r===void 0?Ar(5):r;return function(t,i){return i||t===void 0?t:Math.abs(t)<=e?0:t}}function Hm(r){return Math.pow(r,3)}function Hs(r){return 1-Hm(1-r)}function bE(r){return 3*r*r-2*r*r*r}function yE(r){return r}const ld=new Array(6);function si(){return[1,0,0,1,0,0]}function og(r){return $l(r,1,0,0,1,0,0)}function Qo(r,e){const t=r[0],i=r[1],n=r[2],s=r[3],o=r[4],a=r[5],l=e[0],h=e[1],u=e[2],c=e[3],d=e[4],f=e[5];return r[0]=t*l+n*h,r[1]=i*l+s*h,r[2]=t*u+n*c,r[3]=i*u+s*c,r[4]=t*d+n*f+o,r[5]=i*d+s*f+a,r}function $l(r,e,t,i,n,s,o){return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r[4]=s,r[5]=o,r}function vE(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r}function nt(r,e){const t=e[0],i=e[1];return e[0]=r[0]*t+r[2]*i+r[4],e[1]=r[1]*t+r[3]*i+r[5],e}function Uk(r,e){const t=Math.cos(e),i=Math.sin(e);return Qo(r,$l(ld,t,i,-i,t,0,0))}function Ba(r,e,t){return Qo(r,$l(ld,e,0,0,t,0,0))}function wE(r,e,t){return Qo(r,$l(ld,1,0,0,1,e,t))}function Si(r,e,t,i,n,s,o,a){const l=Math.sin(s),h=Math.cos(s);return r[0]=i*h,r[1]=n*l,r[2]=-i*l,r[3]=n*h,r[4]=o*i*h-a*i*l+e,r[5]=o*n*l+a*n*h+t,r}function Zl(r,e){const t=EE(e);Ae(t!==0,"Transformation matrix cannot be inverted");const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5];return r[0]=o/t,r[1]=-n/t,r[2]=-s/t,r[3]=i/t,r[4]=(s*l-o*a)/t,r[5]=-(i*l-n*a)/t,r}function EE(r){return r[0]*r[3]-r[1]*r[2]}const ag=[1e6,1e6,1e6,1e6,2,2];function hd(r){return"matrix("+r.map((t,i)=>Math.round(t*ag[i])/ag[i]).join(", ")+")"}function rr(r,e,t,i,n,s){s=s||[];let o=0;for(let a=e;a<t;a+=i){const l=r[a],h=r[a+1];s[o++]=n[0]*l+n[2]*h+n[4],s[o++]=n[1]*l+n[3]*h+n[5]}return s&&s.length!=o&&(s.length=o),s}function ud(r,e,t,i,n,s,o){o=o||[];const a=Math.cos(n),l=Math.sin(n),h=s[0],u=s[1];let c=0;for(let d=e;d<t;d+=i){const f=r[d]-h,g=r[d+1]-u;o[c++]=h+f*a-g*l,o[c++]=u+f*l+g*a;for(let m=d+2;m<d+i;++m)o[c++]=r[m]}return o&&o.length!=c&&(o.length=c),o}function _E(r,e,t,i,n,s,o,a){a=a||[];const l=o[0],h=o[1];let u=0;for(let c=e;c<t;c+=i){const d=r[c]-l,f=r[c+1]-h;a[u++]=l+n*d,a[u++]=h+s*f;for(let g=c+2;g<c+i;++g)a[u++]=r[g]}return a&&a.length!=u&&(a.length=u),a}function CE(r,e,t,i,n,s,o){o=o||[];let a=0;for(let l=e;l<t;l+=i){o[a++]=r[l]+n,o[a++]=r[l+1]+s;for(let h=l+2;h<l+i;++h)o[a++]=r[h]}return o&&o.length!=a&&(o.length=a),o}const lg=si();class cd extends Hi{constructor(){super(),this.extent_=oi(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=Nm((e,t,i)=>{if(!i)return this.getSimplifiedGeometry(t);const n=this.clone();return n.applyTransform(i),n.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return ge()}closestPointXY(e,t,i,n){return ge()}containsXY(e,t){const i=this.getClosestPoint([e,t]);return i[0]===e&&i[1]===t}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return ge()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&zs(t),this.extentRevision_=this.getRevision()}return iw(this.extent_,e)}rotate(e,t){ge()}scale(e,t,i){ge()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return ge()}getType(){return ge()}applyTransform(e){ge()}intersectsExtent(e){return ge()}translate(e,t){ge()}transform(e,t){const i=we(e),n=i.getUnits()=="tile-pixels"?function(s,o,a){const l=i.getExtent(),h=i.getWorldExtent(),u=st(h)/st(l);return Si(lg,h[0],h[3],u,-u,0,0,0),rr(s,0,s.length,a,lg,o),_s(i,t)(s,o,a)}:_s(i,t);return this.applyTransform(n),this}}class cr extends cd{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(e){return Oc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return ge()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=hg(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){ge()}setLayout(e,t,i){let n;if(e)n=hg(e);else{for(let s=0;s<i;++s){if(t.length===0){this.layout="XY",this.stride=2;return}t=t[0]}n=t.length,e=Yr(n)}this.layout=e,this.stride=n}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(e,t){const i=this.getFlatCoordinates();if(i){const n=this.getStride();ud(i,0,i.length,n,e,t,i),this.changed()}}scale(e,t,i){t===void 0&&(t=e),i||(i=en(this.getExtent()));const n=this.getFlatCoordinates();if(n){const s=this.getStride();_E(n,0,n.length,s,e,t,i,n),this.changed()}}translate(e,t){const i=this.getFlatCoordinates();if(i){const n=this.getStride();CE(i,0,i.length,n,e,t,i),this.changed()}}}function Yr(r){let e;return r==2?e="XY":r==3?e="XYZ":r==4&&(e="XYZM"),e}function hg(r){let e;return r=="XY"?e=2:r=="XYZ"||r=="XYM"?e=3:r=="XYZM"&&(e=4),e}function xE(r,e,t){const i=r.getFlatCoordinates();if(!i)return null;const n=r.getStride();return rr(i,0,i.length,n,e,t)}function ug(r,e,t,i,n,s,o){const a=r[e],l=r[e+1],h=r[t]-a,u=r[t+1]-l;let c;if(h===0&&u===0)c=e;else{const d=((n-a)*h+(s-l)*u)/(h*h+u*u);if(d>1)c=t;else if(d>0){for(let f=0;f<i;++f)o[f]=ii(r[e+f],r[t+f],d);o.length=i;return}else c=e}for(let d=0;d<i;++d)o[d]=r[c+d];o.length=i}function dd(r,e,t,i,n){let s=r[e],o=r[e+1];for(e+=i;e<t;e+=i){const a=r[e],l=r[e+1],h=Lr(s,o,a,l);h>n&&(n=h),s=a,o=l}return n}function fd(r,e,t,i,n){for(let s=0,o=t.length;s<o;++s){const a=t[s];n=dd(r,e,a,i,n),e=a}return n}function RE(r,e,t,i,n){for(let s=0,o=t.length;s<o;++s){const a=t[s];n=fd(r,e,a,i,n),e=a[a.length-1]}return n}function gd(r,e,t,i,n,s,o,a,l,h,u){if(e==t)return h;let c,d;if(n===0){if(d=Lr(o,a,r[e],r[e+1]),d<h){for(c=0;c<i;++c)l[c]=r[e+c];return l.length=i,d}return h}u=u||[NaN,NaN];let f=e+i;for(;f<t;)if(ug(r,f-i,f,i,o,a,u),d=Lr(o,a,u[0],u[1]),d<h){for(h=d,c=0;c<i;++c)l[c]=u[c];l.length=i,f+=i}else f+=i*Math.max((Math.sqrt(d)-Math.sqrt(h))/n|0,1);if(s&&(ug(r,t-i,e,i,o,a,u),d=Lr(o,a,u[0],u[1]),d<h)){for(h=d,c=0;c<i;++c)l[c]=u[c];l.length=i}return h}function pd(r,e,t,i,n,s,o,a,l,h,u){u=u||[NaN,NaN];for(let c=0,d=t.length;c<d;++c){const f=t[c];h=gd(r,e,f,i,n,s,o,a,l,h,u),e=f}return h}function SE(r,e,t,i,n,s,o,a,l,h,u){u=u||[NaN,NaN];for(let c=0,d=t.length;c<d;++c){const f=t[c];h=pd(r,e,f,i,n,s,o,a,l,h,u),e=f[f.length-1]}return h}function Vm(r,e,t,i){for(let n=0,s=t.length;n<s;++n)r[e++]=t[n];return e}function Kl(r,e,t,i){for(let n=0,s=t.length;n<s;++n){const o=t[n];for(let a=0;a<i;++a)r[e++]=o[a]}return e}function ea(r,e,t,i,n){n=n||[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=Kl(r,e,t[o],i);n[s++]=l,e=l}return n.length=s,n}function Wm(r,e,t,i,n){n=n||[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=ea(r,e,t[o],i,n[s]);l.length===0&&(l[0]=e),n[s++]=l,e=l[l.length-1]}return n.length=s,n}function ql(r,e,t,i,n,s,o){const a=(t-e)/i;if(a<3){for(;e<t;e+=i)s[o++]=r[e],s[o++]=r[e+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[e,t-i];let u=0;for(;h.length>0;){const c=h.pop(),d=h.pop();let f=0;const g=r[d],m=r[d+1],w=r[c],y=r[c+1];for(let E=d+i;E<c;E+=i){const x=r[E],v=r[E+1],S=ow(x,v,g,m,w,y);S>f&&(u=E,f=S)}f>n&&(l[(u-e)/i]=1,d+i<u&&h.push(d,u),u+i<c&&h.push(u,c))}for(let c=0;c<a;++c)l[c]&&(s[o++]=r[e+c*i],s[o++]=r[e+c*i+1]);return o}function Um(r,e,t,i,n,s,o,a){for(let l=0,h=t.length;l<h;++l){const u=t[l];o=ql(r,e,u,i,n,s,o),a.push(o),e=u}return o}function yr(r,e){return e*Math.round(r/e)}function TE(r,e,t,i,n,s,o){if(e==t)return o;let a=yr(r[e],n),l=yr(r[e+1],n);e+=i,s[o++]=a,s[o++]=l;let h,u;do if(h=yr(r[e],n),u=yr(r[e+1],n),e+=i,e==t)return s[o++]=h,s[o++]=u,o;while(h==a&&u==l);for(;e<t;){const c=yr(r[e],n),d=yr(r[e+1],n);if(e+=i,c==h&&d==u)continue;const f=h-a,g=u-l,m=c-a,w=d-l;if(f*w==g*m&&(f<0&&m<f||f==m||f>0&&m>f)&&(g<0&&w<g||g==w||g>0&&w>g)){h=c,u=d;continue}s[o++]=h,s[o++]=u,a=h,l=u,h=c,u=d}return s[o++]=h,s[o++]=u,o}function md(r,e,t,i,n,s,o,a){for(let l=0,h=t.length;l<h;++l){const u=t[l];o=TE(r,e,u,i,n,s,o),a.push(o),e=u}return o}function ME(r,e,t,i,n,s,o,a){for(let l=0,h=t.length;l<h;++l){const u=t[l],c=[];o=md(r,e,u,i,n,s,o,c),a.push(c),e=u[u.length-1]}return o}function qn(r,e,t,i,n){n=n!==void 0?n:[];let s=0;for(let o=e;o<t;o+=i)n[s++]=r.slice(o,o+i);return n.length=s,n}function Fo(r,e,t,i,n){n=n!==void 0?n:[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];n[s++]=qn(r,e,l,i,n[s]),e=l}return n.length=s,n}function Ru(r,e,t,i,n){n=n!==void 0?n:[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];n[s++]=l.length===1&&l[0]===e?[]:Fo(r,e,l,i,n[s]),e=l[l.length-1]}return n.length=s,n}function Ym(r,e,t,i){let n=0,s=r[t-i],o=r[t-i+1];for(;e<t;e+=i){const a=r[e],l=r[e+1];n+=o*a-s*l,s=a,o=l}return n/2}function jm(r,e,t,i){let n=0;for(let s=0,o=t.length;s<o;++s){const a=t[s];n+=Ym(r,e,a,i),e=a}return n}function LE(r,e,t,i){let n=0;for(let s=0,o=t.length;s<o;++s){const a=t[s];n+=jm(r,e,a,i),e=a[a.length-1]}return n}class As extends cr{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}clone(){return new As(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,i,n){return n<Wr(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(dd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),gd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,i,n))}getArea(){return Ym(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return qn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=ql(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new As(t,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Kl(this.flatCoordinates,0,e,this.stride),this.changed()}}class Ni extends cr{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new Ni(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,n){const s=this.flatCoordinates,o=Lr(e,t,s[0],s[1]);if(o<n){const a=this.stride;for(let l=0;l<a;++l)i[l]=s[l];return i.length=a,o}return n}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(e){return Kp(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return Fc(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Vm(this.flatCoordinates,0,e,this.stride),this.changed()}}function AE(r,e,t,i,n){return!Dc(n,function(o){return!xr(r,e,t,i,o[0],o[1])})}function xr(r,e,t,i,n,s){let o=0,a=r[t-i],l=r[t-i+1];for(;e<t;e+=i){const h=r[e],u=r[e+1];l<=s?u>s&&(h-a)*(s-l)-(n-a)*(u-l)>0&&o++:u<=s&&(h-a)*(s-l)-(n-a)*(u-l)<0&&o--,a=h,l=u}return o!==0}function bd(r,e,t,i,n,s){if(t.length===0||!xr(r,e,t[0],i,n,s))return!1;for(let o=1,a=t.length;o<a;++o)if(xr(r,t[o-1],t[o],i,n,s))return!1;return!0}function IE(r,e,t,i,n,s){if(t.length===0)return!1;for(let o=0,a=t.length;o<a;++o){const l=t[o];if(bd(r,e,l,i,n,s))return!0;e=l[l.length-1]}return!1}function yd(r,e,t,i,n,s,o){let a,l,h,u,c,d,f;const g=n[s+1],m=[];for(let E=0,x=t.length;E<x;++E){const v=t[E];for(u=r[v-i],d=r[v-i+1],a=e;a<v;a+=i)c=r[a],f=r[a+1],(g<=d&&f<=g||d<=g&&g<=f)&&(h=(g-d)/(f-d)*(c-u)+u,m.push(h)),u=c,d=f}let w=NaN,y=-1/0;for(m.sort(qi),u=m[0],a=1,l=m.length;a<l;++a){c=m[a];const E=Math.abs(c-u);E>y&&(h=(u+c)/2,bd(r,e,t,i,h,g)&&(w=h,y=E)),u=c}return isNaN(w)&&(w=n[s]),o?(o.push(w,g,y),o):[w,g,y]}function Xm(r,e,t,i,n){let s=[];for(let o=0,a=t.length;o<a;++o){const l=t[o];s=yd(r,e,l,i,n,2*o,s),e=l[l.length-1]}return s}function $m(r,e,t,i,n){let s;for(e+=i;e<t;e+=i)if(s=n(r.slice(e-i,e),r.slice(e,e+i)),s)return s;return!1}function Jl(r,e,t,i,n){const s=Jp(oi(),r,e,t,i);return ht(n,s)?mi(n,s)||s[0]>=n[0]&&s[2]<=n[2]||s[1]>=n[1]&&s[3]<=n[3]?!0:$m(r,e,t,i,function(o,a){return nw(n,o,a)}):!1}function PE(r,e,t,i,n){for(let s=0,o=t.length;s<o;++s){if(Jl(r,e,t[s],i,n))return!0;e=t[s]}return!1}function Zm(r,e,t,i,n){return!!(Jl(r,e,t,i,n)||xr(r,e,t,i,n[0],n[1])||xr(r,e,t,i,n[0],n[3])||xr(r,e,t,i,n[2],n[1])||xr(r,e,t,i,n[2],n[3]))}function Km(r,e,t,i,n){if(!Zm(r,e,t[0],i,n))return!1;if(t.length===1)return!0;for(let s=1,o=t.length;s<o;++s)if(AE(r,t[s-1],t[s],i,n)&&!Jl(r,t[s-1],t[s],i,n))return!1;return!0}function FE(r,e,t,i,n){for(let s=0,o=t.length;s<o;++s){const a=t[s];if(Km(r,e,a,i,n))return!0;e=a[a.length-1]}return!1}function OE(r,e,t,i){for(;e<t-i;){for(let n=0;n<i;++n){const s=r[e+n];r[e+n]=r[t-i+n],r[t-i+n]=s}e+=i,t-=i}}function vd(r,e,t,i){let n=0,s=r[t-i],o=r[t-i+1];for(;e<t;e+=i){const a=r[e],l=r[e+1];n+=(a-s)*(l+o),s=a,o=l}return n===0?void 0:n>0}function wd(r,e,t,i,n){n=n!==void 0?n:!1;for(let s=0,o=t.length;s<o;++s){const a=t[s],l=vd(r,e,a,i);if(s===0){if(n&&l||!n&&!l)return!1}else if(n&&!l||!n&&l)return!1;e=a}return!0}function qm(r,e,t,i,n){for(let s=0,o=t.length;s<o;++s){const a=t[s];if(!wd(r,e,a,i,n))return!1;a.length&&(e=a[a.length-1])}return!0}function tl(r,e,t,i,n){n=n!==void 0?n:!1;for(let s=0,o=t.length;s<o;++s){const a=t[s],l=vd(r,e,a,i);(s===0?n&&l||!n&&!l:n&&!l||!n&&l)&&OE(r,e,a,i),e=a}return e}function Su(r,e,t,i,n){for(let s=0,o=t.length;s<o;++s)e=tl(r,e,t[s],i,n);return e}function Jm(r,e){const t=[];let i=0,n=0,s;for(let o=0,a=e.length;o<a;++o){const l=e[o],h=vd(r,i,l,2);if(s===void 0&&(s=h),h===s)t.push(e.slice(n,o+1));else{if(t.length===0)continue;t[t.length-1].push(e[n])}n=o+1,i=l}return t}class At extends cr{constructor(e,t,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,t!==void 0&&i?(this.setFlatCoordinates(t,e),this.ends_=i):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?Fe(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new At(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,n){return n<Wr(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(fd(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),pd(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,i,n))}containsXY(e,t){return bd(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return jm(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),tl(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,Fo(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=en(this.getExtent());this.flatInteriorPoint_=yd(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Ni(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new As(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,t=this.flatCoordinates,i=this.ends_,n=[];let s=0;for(let o=0,a=i.length;o<a;++o){const l=i[o],h=new As(t.slice(s,l),e);n.push(h),s=l}return n}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;wd(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=tl(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=md(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,i),new At(t,"XY",i)}getType(){return"Polygon"}intersectsExtent(e){return Km(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=ea(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}function Yk(r,e,t,i){t=t||32;const n=[];for(let s=0;s<t;++s)Fe(n,cw(r,e,2*Math.PI*s/t,i));return n.push(n[0],n[1]),new At(n,"XY",[n.length])}function cg(r){if(Ur(r))throw new Error("Cannot create polygon from empty extent");const e=r[0],t=r[1],i=r[2],n=r[3],s=[e,t,e,n,i,n,i,t,e,t];return new At(s,"XY",[s.length])}function DE(r,e,t){e=e||32;const i=r.getStride(),n=r.getLayout(),s=r.getCenter(),o=i*(e+1),a=new Array(o);for(let u=0;u<o;u+=i){a[u]=0,a[u+1]=0;for(let c=2;c<i;c++)a[u+c]=s[c]}const l=[a.length],h=new At(a,n,l);return kE(h,s,r.getRadius(),t),h}function kE(r,e,t,i){const n=r.getFlatCoordinates(),s=r.getStride(),o=n.length/s-1,a=i||0;for(let l=0;l<=o;++l){const h=l*s,u=a+nr(l,o)*2*Math.PI/o;n[h]=e[0]+t*Math.cos(u),n[h+1]=e[1]+t*Math.sin(u)}r.changed()}const Ah=0;class _n extends Hi{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Gc(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&rm(),e.center&&(e.center=pn(e.center,this.projection_)),e.extent&&(e.extent=Cn(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const a in Ai)delete t[a];this.setProperties(t,!0);const i=zE(e);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=i.minZoom;const n=NE(e),s=i.constraint,o=BE(e);this.constraints_={center:n,resolution:s,rotation:o},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const i=this.getCenterInternal();if(i){const n=e||[0,0,0,0];t=t||[0,0,0,0];const s=this.getResolution(),o=s/2*(n[3]-t[3]+t[1]-n[1]),a=s/2*(n[0]-t[0]+t[2]-n[2]);this.setCenterInternal([i[0]+o,i[1]-a])}}getUpdatedOptions_(e){const t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let i=0;i<t.length;++i){let n=arguments[i];n.center&&(n=Object.assign({},n),n.center=pn(n.center,this.getProjection())),n.anchor&&(n=Object.assign({},n),n.anchor=pn(n.anchor,this.getProjection())),t[i]=n}this.animateInternal.apply(this,t)}animateInternal(e){let t=arguments.length,i;t>1&&typeof arguments[t-1]=="function"&&(i=arguments[t-1],--t);let n=0;for(;n<t&&!this.isDef();++n){const u=arguments[n];u.center&&this.setCenterInternal(u.center),u.zoom!==void 0?this.setZoom(u.zoom):u.resolution&&this.setResolution(u.resolution),u.rotation!==void 0&&this.setRotation(u.rotation)}if(n===t){i&&ya(i,!0);return}let s=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;n<t;++n){const u=arguments[n],c={start:s,complete:!1,anchor:u.anchor,duration:u.duration!==void 0?u.duration:1e3,easing:u.easing||bE,callback:i};if(u.center&&(c.sourceCenter=o,c.targetCenter=u.center.slice(),o=c.targetCenter),u.zoom!==void 0?(c.sourceResolution=a,c.targetResolution=this.getResolutionForZoom(u.zoom),a=c.targetResolution):u.resolution&&(c.sourceResolution=a,c.targetResolution=u.resolution,a=c.targetResolution),u.rotation!==void 0){c.sourceRotation=l;const d=nr(u.rotation-l+Math.PI,2*Math.PI)-Math.PI;c.targetRotation=l+d,l=c.targetRotation}GE(c)?c.complete=!0:s+=c.duration,h.push(c)}this.animations_.push(h),this.setHint(Ke.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[Ke.ANIMATING]>0}getInteracting(){return this.hints_[Ke.INTERACTING]>0}cancelAnimations(){this.setHint(Ke.ANIMATING,-this.hints_[Ke.ANIMATING]);let e;for(let t=0,i=this.animations_.length;t<i;++t){const n=this.animations_[t];if(n[0].callback&&ya(n[0].callback,!1),!e)for(let s=0,o=n.length;s<o;++s){const a=n[s];if(!a.complete){e=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let i=this.animations_.length-1;i>=0;--i){const n=this.animations_[i];let s=!0;for(let o=0,a=n.length;o<a;++o){const l=n[o];if(l.complete)continue;const h=e-l.start;let u=l.duration>0?h/l.duration:1;u>=1?(l.complete=!0,u=1):s=!1;const c=l.easing(u);if(l.sourceCenter){const d=l.sourceCenter[0],f=l.sourceCenter[1],g=l.targetCenter[0],m=l.targetCenter[1];this.nextCenter_=l.targetCenter;const w=d+c*(g-d),y=f+c*(m-f);this.targetCenter_=[w,y]}if(l.sourceResolution&&l.targetResolution){const d=c===1?l.targetResolution:l.sourceResolution+c*(l.targetResolution-l.sourceResolution);if(l.anchor){const f=this.getViewportSize_(this.getRotation()),g=this.constraints_.resolution(d,0,f,!0);this.targetCenter_=this.calculateCenterZoom(g,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const d=c===1?nr(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+c*(l.targetRotation-l.sourceRotation);if(l.anchor){const f=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(f,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),t=!0,!l.complete)break}if(s){this.animations_[i]=null,this.setHint(Ke.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=n[0].callback;o&&ya(o,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let i;const n=this.getCenterInternal();return n!==void 0&&(i=[n[0]-t[0],n[1]-t[1]],Nc(i,e-this.getRotation()),lw(i,t)),i}calculateCenterZoom(e,t){let i;const n=this.getCenterInternal(),s=this.getResolution();if(n!==void 0&&s!==void 0){const o=t[0]-e*(t[0]-n[0])/s,a=t[1]-e*(t[1]-n[1])/s;i=[o,a]}return i}getViewportSize_(e){const t=this.viewportSize_;if(e){const i=t[0],n=t[1];return[Math.abs(i*Math.cos(e))+Math.abs(n*Math.sin(e)),Math.abs(i*Math.sin(e))+Math.abs(n*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&wu(e,this.getProjection())}getCenterInternal(){return this.get(Ai.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return Hc(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();Ae(t,"The view center is not defined");const i=this.getResolution();Ae(i!==void 0,"The view resolution is not defined");const n=this.getRotation();return Ae(n!==void 0,"The view rotation is not defined"),Mo(t,i,n,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(Ai.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(Cn(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const i=Pe(e)/t[0],n=st(e)/t[1];return Math.max(i,n)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,n=Math.log(t/i)/Math.log(e);return function(s){return t/Math.pow(e,s*n)}}getRotation(){return this.get(Ai.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),i=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,s=Math.log(i/n)/t;return function(o){return Math.log(i/o)/t/s}}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const i=this.padding_;return i&&(t=[t[0]-i[1]-i[3],t[1]-i[0]-i[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),i=this.getRotation();let n=this.getCenterInternal();const s=this.padding_;if(s){const o=this.getViewportSizeMinusPadding_();n=Ih(n,this.getViewportSize_(),[o[0]/2+s[3],o[1]/2+s[0]],t,i)}return{center:n.slice(0),projection:e!==void 0?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return t!==void 0&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t=this.minZoom_||0,i,n;if(this.resolutions_){const s=jl(this.resolutions_,e,1);t=s,i=this.resolutions_[s],s==this.resolutions_.length-1?n=2:n=i/this.resolutions_[s+1]}else i=this.maxResolution_,n=this.zoomFactor_;return t+Math.log(i/e)/Math.log(n)}getResolutionForZoom(e){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const t=it(Math.floor(e),0,this.resolutions_.length-2),i=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(i,it(e-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let i;if(Ae(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(e)){Ae(!Ur(e),"Cannot fit empty extent provided as `geometry`");const n=Cn(e,this.getProjection());i=cg(n)}else if(e.getType()==="Circle"){const n=Cn(e.getExtent(),this.getProjection());i=cg(n),i.rotate(this.getRotation(),en(n))}else i=e;this.fitInternal(i,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),i=Math.cos(t),n=Math.sin(-t),s=e.getFlatCoordinates(),o=e.getStride();let a=1/0,l=1/0,h=-1/0,u=-1/0;for(let c=0,d=s.length;c<d;c+=o){const f=s[c]*i-s[c+1]*n,g=s[c]*n+s[c+1]*i;a=Math.min(a,f),l=Math.min(l,g),h=Math.max(h,f),u=Math.max(u,g)}return[a,l,h,u]}fitInternal(e,t){t=t||{};let i=t.size;i||(i=this.getViewportSizeMinusPadding_());const n=t.padding!==void 0?t.padding:[0,0,0,0],s=t.nearest!==void 0?t.nearest:!1;let o;t.minResolution!==void 0?o=t.minResolution:t.maxZoom!==void 0?o=this.getResolutionForZoom(t.maxZoom):o=0;const a=this.rotatedExtentForGeometry(e);let l=this.getResolutionForExtentInternal(a,[i[0]-n[1]-n[3],i[1]-n[0]-n[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,s?0:1);const h=this.getRotation(),u=Math.sin(h),c=Math.cos(h),d=en(a);d[0]+=(n[1]-n[3])/2*l,d[1]+=(n[0]-n[2])/2*l;const f=d[0]*c-d[1]*u,g=d[1]*c+d[0]*u,m=this.getConstrainedCenter([f,g],l),w=t.callback?t.callback:Ls;t.duration!==void 0?this.animateInternal({resolution:l,center:m,duration:t.duration,easing:t.easing},w):(this.targetResolution_=l,this.targetCenter_=m,this.applyTargetState_(!1,!0),ya(w,!0))}centerOn(e,t,i){this.centerOnInternal(pn(e,this.getProjection()),t,i)}centerOnInternal(e,t,i){this.setCenterInternal(Ih(e,t,i,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,i,n){let s;const o=this.padding_;if(o&&e){const a=this.getViewportSizeMinusPadding_(-i),l=Ih(e,n,[a[0]/2+o[3],a[1]/2+o[0]],t,i);s=[e[0]-l[0],e[1]-l[1]]}return s}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const t=wu(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&pn(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const i=this.getAnimating()||this.getInteracting(),n=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*e,0,n,i);t&&(this.targetCenter_=this.calculateCenterZoom(s,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=pn(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const i=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+e,i);t&&(this.targetCenter_=this.calculateCenterRotate(n,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&pn(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const i=this.getAnimating()||this.getInteracting()||t,n=this.constraints_.rotation(this.targetRotation_,i),s=this.getViewportSize_(n),o=this.constraints_.resolution(this.targetResolution_,0,s,i),a=this.constraints_.center(this.targetCenter_,o,s,i,this.calculateCenterShift(this.targetCenter_,o,n,s));this.get(Ai.ROTATION)!==n&&this.set(Ai.ROTATION,n),this.get(Ai.RESOLUTION)!==o&&(this.set(Ai.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(Ai.CENTER)||!Za(this.get(Ai.CENTER),a))&&this.set(Ai.CENTER,a),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,i){e=e!==void 0?e:200;const n=t||0,s=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,n,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,s,o));if(e===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=s,this.targetCenter_=l,this.applyTargetState_();return}i=i||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==s||!this.getCenterInternal()||!Za(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:l,resolution:a,duration:e,easing:Hs,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(Ke.INTERACTING,1)}endInteraction(e,t,i){i=i&&pn(i,this.getProjection()),this.endInteractionInternal(e,t,i)}endInteractionInternal(e,t,i){this.getInteracting()&&(this.setHint(Ke.INTERACTING,-1),this.resolveConstraints(e,t,i))}getConstrainedCenter(e,t){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),i)}getConstrainedZoom(e,t){const i=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(i,t))}getConstrainedResolution(e,t){t=t||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,i)}}function ya(r,e){setTimeout(function(){r(e)},0)}function NE(r){if(r.extent!==void 0){const t=r.smoothExtentConstraint!==void 0?r.smoothExtentConstraint:!0;return ng(r.extent,r.constrainOnlyCenter,t)}const e=Gc(r.projection,"EPSG:3857");if(r.multiWorld!==!0&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,ng(t,!1,!1)}return dE}function zE(r){let e,t,i,o=r.minZoom!==void 0?r.minZoom:Ah,a=r.maxZoom!==void 0?r.maxZoom:28;const l=r.zoomFactor!==void 0?r.zoomFactor:2,h=r.multiWorld!==void 0?r.multiWorld:!1,u=r.smoothResolutionConstraint!==void 0?r.smoothResolutionConstraint:!0,c=r.showFullExtent!==void 0?r.showFullExtent:!1,d=Gc(r.projection,"EPSG:3857"),f=d.getExtent();let g=r.constrainOnlyCenter,m=r.extent;if(!h&&!m&&d.isGlobal()&&(g=!1,m=f),r.resolutions!==void 0){const w=r.resolutions;t=w[o],i=w[a]!==void 0?w[a]:w[w.length-1],r.constrainResolution?e=fE(w,u,!g&&m,c):e=rg(t,i,u,!g&&m,c)}else{const y=(f?Math.max(Pe(f),st(f)):360*So.degrees/d.getMetersPerUnit())/rd/Math.pow(2,Ah),E=y/Math.pow(2,28-Ah);t=r.maxResolution,t!==void 0?o=0:t=y/Math.pow(l,o),i=r.minResolution,i===void 0&&(r.maxZoom!==void 0?r.maxResolution!==void 0?i=t/Math.pow(l,a):i=y/Math.pow(l,a):i=E),a=o+Math.floor(Math.log(t/i)/Math.log(l)),i=t/Math.pow(l,a-o),r.constrainResolution?e=gE(l,t,i,u,!g&&m,c):e=rg(t,i,u,!g&&m,c)}return{constraint:e,maxResolution:t,minResolution:i,minZoom:o,zoomFactor:l}}function BE(r){if(r.enableRotation!==void 0?r.enableRotation:!0){const t=r.constrainRotation;return t===void 0||t===!0?mE():t===!1?sg:typeof t=="number"?pE(t):sg}return ad}function GE(r){return!(r.sourceCenter&&r.targetCenter&&!Za(r.sourceCenter,r.targetCenter)||r.sourceResolution!==r.targetResolution||r.sourceRotation!==r.targetRotation)}function Ih(r,e,t,i,n){const s=Math.cos(-n);let o=Math.sin(-n),a=r[0]*s-r[1]*o,l=r[1]*s+r[0]*o;a+=(e[0]/2-t[0])*i,l+=(t[1]-e[1]/2)*i,o=-o;const h=a*s-l*o,u=l*s+a*o;return[h,u]}class ta extends Gm{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(He.SOURCE,this.handleSourcePropertyChange_);const i=e.source?e.source:null;this.setSource(i)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(He.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(We(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=Oe(e,Ee.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let t;const i=this.getMapInternal();!e&&i&&(e=i.getView()),e instanceof _n?t={viewState:e.getState(),extent:e.calculateExtent()}:t=e,!t.layerStatesArray&&i&&(t.layerStatesArray=i.getLayerGroup().getLayerStatesArray());let n;t.layerStatesArray?n=t.layerStatesArray.find(o=>o.layer===this):n=this.getLayerState();const s=this.getExtent();return Ed(n,t.viewState)&&(!s||ht(s,t.extent))}getAttributions(e){if(!this.isVisible(e))return[];let t;const i=this.getSource();if(i&&(t=i.getAttributions()),!t)return[];const n=e instanceof _n?e.getViewStateAndExtent():e;let s=t(n);return Array.isArray(s)||(s=[s]),s}render(e,t){const i=this.getRenderer();return i.prepareFrame(e)?(this.rendered=!0,i.renderFrame(e,t)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(e,t){}renderDeferred(e){const t=this.getRenderer();t&&t.renderDeferred(e)}setMapInternal(e){e||this.unrender(),this.set(He.MAP,e)}getMapInternal(){return this.get(He.MAP)}setMap(e){this.mapPrecomposeKey_&&(We(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(We(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=Oe(e,bi.PRECOMPOSE,function(t){const n=t.frameState.layerStatesArray,s=this.getLayerState(!1);Ae(!n.some(function(o){return o.layer===s.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),n.push(s)},this),this.mapRenderKey_=Oe(this,Ee.CHANGE,e.render,e),this.changed())}setSource(e){this.set(He.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function Ed(r,e){if(!r.visible)return!1;const t=e.resolution;if(t<r.minResolution||t>=r.maxResolution)return!1;const i=e.zoom;return i>r.minZoom&&i<=r.maxZoom}function HE(r,e,t,i,n){Qm(r,e,t||0,i||r.length-1,n||VE)}function Qm(r,e,t,i,n){for(;i>t;){if(i-t>600){var s=i-t+1,o=e-t+1,a=Math.log(s),l=.5*Math.exp(2*a/3),h=.5*Math.sqrt(a*l*(s-l)/s)*(o-s/2<0?-1:1),u=Math.max(t,Math.floor(e-o*l/s+h)),c=Math.min(i,Math.floor(e+(s-o)*l/s+h));Qm(r,e,u,c,n)}var d=r[e],f=t,g=i;for(Qs(r,t,e),n(r[i],d)>0&&Qs(r,t,i);f<g;){for(Qs(r,f,g),f++,g--;n(r[f],d)<0;)f++;for(;n(r[g],d)>0;)g--}n(r[t],d)===0?Qs(r,t,g):(g++,Qs(r,g,i)),g<=e&&(t=g+1),e<=g&&(i=g-1)}}function Qs(r,e,t){var i=r[e];r[e]=r[t],r[t]=i}function VE(r,e){return r<e?-1:r>e?1:0}let eb=class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const i=[];if(!wa(e,t))return i;const n=this.toBBox,s=[];for(;t;){for(let o=0;o<t.children.length;o++){const a=t.children[o],l=t.leaf?n(a):a;wa(e,l)&&(t.leaf?i.push(a):Fh(e,l)?this._all(a,i):s.push(a))}t=s.pop()}return i}collides(e){let t=this.data;if(!wa(e,t))return!1;const i=[];for(;t;){for(let n=0;n<t.children.length;n++){const s=t.children[n],o=t.leaf?this.toBBox(s):s;if(wa(e,o)){if(t.leaf||Fh(e,o))return!0;i.push(s)}}t=i.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let i=0;i<e.length;i++)this.insert(e[i]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const i=this.data;this.data=t,t=i}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=ns([]),this}remove(e,t){if(!e)return this;let i=this.data;const n=this.toBBox(e),s=[],o=[];let a,l,h;for(;i||s.length;){if(i||(i=s.pop(),l=s[s.length-1],a=o.pop(),h=!0),i.leaf){const u=WE(e,i.children,t);if(u!==-1)return i.children.splice(u,1),s.push(i),this._condense(s),this}!h&&!i.leaf&&Fh(i,n)?(s.push(i),o.push(a),a=0,l=i,i=i.children[0]):l?(a++,i=l.children[a],h=!1):i=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const i=[];for(;e;)e.leaf?t.push(...e.children):i.push(...e.children),e=i.pop();return t}_build(e,t,i,n){const s=i-t+1;let o=this._maxEntries,a;if(s<=o)return a=ns(e.slice(t,i+1)),Zr(a,this.toBBox),a;n||(n=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,n-1))),a=ns([]),a.leaf=!1,a.height=n;const l=Math.ceil(s/o),h=l*Math.ceil(Math.sqrt(o));dg(e,t,i,h,this.compareMinX);for(let u=t;u<=i;u+=h){const c=Math.min(u+h-1,i);dg(e,u,c,l,this.compareMinY);for(let d=u;d<=c;d+=l){const f=Math.min(d+l-1,c);a.children.push(this._build(e,d,f,n-1))}}return Zr(a,this.toBBox),a}_chooseSubtree(e,t,i,n){for(;n.push(t),!(t.leaf||n.length-1===i);){let s=1/0,o=1/0,a;for(let l=0;l<t.children.length;l++){const h=t.children[l],u=Ph(h),c=jE(e,h)-u;c<o?(o=c,s=u<s?u:s,a=h):c===o&&u<s&&(s=u,a=h)}t=a||t.children[0]}return t}_insert(e,t,i){const n=i?e:this.toBBox(e),s=[],o=this._chooseSubtree(n,this.data,t,s);for(o.children.push(e),ao(o,n);t>=0&&s[t].children.length>this._maxEntries;)this._split(s,t),t--;this._adjustParentBBoxes(n,s,t)}_split(e,t){const i=e[t],n=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,n);const o=this._chooseSplitIndex(i,s,n),a=ns(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,Zr(i,this.toBBox),Zr(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(i,a)}_splitRoot(e,t){this.data=ns([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Zr(this.data,this.toBBox)}_chooseSplitIndex(e,t,i){let n,s=1/0,o=1/0;for(let a=t;a<=i-t;a++){const l=oo(e,0,a,this.toBBox),h=oo(e,a,i,this.toBBox),u=XE(l,h),c=Ph(l)+Ph(h);u<s?(s=u,n=a,o=c<o?c:o):u===s&&c<o&&(o=c,n=a)}return n||i-t}_chooseSplitAxis(e,t,i){const n=e.leaf?this.compareMinX:UE,s=e.leaf?this.compareMinY:YE,o=this._allDistMargin(e,t,i,n),a=this._allDistMargin(e,t,i,s);o<a&&e.children.sort(n)}_allDistMargin(e,t,i,n){e.children.sort(n);const s=this.toBBox,o=oo(e,0,t,s),a=oo(e,i-t,i,s);let l=va(o)+va(a);for(let h=t;h<i-t;h++){const u=e.children[h];ao(o,e.leaf?s(u):u),l+=va(o)}for(let h=i-t-1;h>=t;h--){const u=e.children[h];ao(a,e.leaf?s(u):u),l+=va(a)}return l}_adjustParentBBoxes(e,t,i){for(let n=i;n>=0;n--)ao(t[n],e)}_condense(e){for(let t=e.length-1,i;t>=0;t--)e[t].children.length===0?t>0?(i=e[t-1].children,i.splice(i.indexOf(e[t]),1)):this.clear():Zr(e[t],this.toBBox)}};function WE(r,e,t){if(!t)return e.indexOf(r);for(let i=0;i<e.length;i++)if(t(r,e[i]))return i;return-1}function Zr(r,e){oo(r,0,r.children.length,e,r)}function oo(r,e,t,i,n){n||(n=ns(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let s=e;s<t;s++){const o=r.children[s];ao(n,r.leaf?i(o):o)}return n}function ao(r,e){return r.minX=Math.min(r.minX,e.minX),r.minY=Math.min(r.minY,e.minY),r.maxX=Math.max(r.maxX,e.maxX),r.maxY=Math.max(r.maxY,e.maxY),r}function UE(r,e){return r.minX-e.minX}function YE(r,e){return r.minY-e.minY}function Ph(r){return(r.maxX-r.minX)*(r.maxY-r.minY)}function va(r){return r.maxX-r.minX+(r.maxY-r.minY)}function jE(r,e){return(Math.max(e.maxX,r.maxX)-Math.min(e.minX,r.minX))*(Math.max(e.maxY,r.maxY)-Math.min(e.minY,r.minY))}function XE(r,e){const t=Math.max(r.minX,e.minX),i=Math.max(r.minY,e.minY),n=Math.min(r.maxX,e.maxX),s=Math.min(r.maxY,e.maxY);return Math.max(0,n-t)*Math.max(0,s-i)}function Fh(r,e){return r.minX<=e.minX&&r.minY<=e.minY&&e.maxX<=r.maxX&&e.maxY<=r.maxY}function wa(r,e){return e.minX<=r.maxX&&e.minY<=r.maxY&&e.maxX>=r.minX&&e.maxY>=r.minY}function ns(r){return{children:r,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function dg(r,e,t,i,n){const s=[e,t];for(;s.length;){if(t=s.pop(),e=s.pop(),t-e<=i)continue;const o=e+Math.ceil((t-e)/i/2)*i;HE(r,o,e,t,n),s.push(e,o,o,t)}}const oe={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function fg(r){return r[0]>0&&r[1]>0}function $E(r,e,t){return t===void 0&&(t=[0,0]),t[0]=r[0]*e+.5|0,t[1]=r[1]*e+.5|0,t}function Nt(r,e){return Array.isArray(r)?r:(e===void 0?e=[r,r]:(e[0]=r,e[1]=r),e)}class Ql{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=Nt(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new Ql({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return ge()}getImage(e){return ge()}getHitDetectionImage(){return ge()}getPixelRatio(e){return 1}getImageState(){return ge()}getImageSize(){return ge()}getOrigin(){return ge()}getSize(){return ge()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=Nt(e)}listenImageChange(e){ge()}load(){ge()}unlistenImageChange(e){ge()}ready(){return Promise.resolve()}}const Oo={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var yt={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};yt.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}};yt.max=yt.whitepoint[2].D65;yt.rgb=function(r,e){e=e||yt.whitepoint[2].E;var t=r[0]/e[0],i=r[1]/e[1],n=r[2]/e[2],s,o,a;return s=t*3.240969941904521+i*-1.537383177570093+n*-.498610760293,o=t*-.96924363628087+i*1.87596750150772+n*.041555057407175,a=t*.055630079696993+i*-.20397695888897+n*1.056971514242878,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:s=s*12.92,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o=o*12.92,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=a*12.92,s=Math.min(Math.max(0,s),1),o=Math.min(Math.max(0,o),1),a=Math.min(Math.max(0,a),1),[s*255,o*255,a*255]};Oo.xyz=function(r,e){var t=r[0]/255,i=r[1]/255,n=r[2]/255;t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92;var s=t*.41239079926595+i*.35758433938387+n*.18048078840183,o=t*.21263900587151+i*.71516867876775+n*.072192315360733,a=t*.019330818715591+i*.11919477979462+n*.95053215224966;return e=e||yt.whitepoint[2].E,[s*e[0],o*e[1],a*e[2]]};const _d={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(r,e,t){var i,n,s,o,a,l,h,u,c,d,f,g,m;if(s=r[0],o=r[1],a=r[2],s===0)return[0,0,0];var w=.0011070564598794539;return e=e||"D65",t=t||2,c=yt.whitepoint[t][e][0],d=yt.whitepoint[t][e][1],f=yt.whitepoint[t][e][2],g=4*c/(c+15*d+3*f),m=9*d/(c+15*d+3*f),i=o/(13*s)+g||0,n=a/(13*s)+m||0,h=s>8?d*Math.pow((s+16)/116,3):d*s*w,l=h*9*i/(4*n)||0,u=h*(12-3*i-20*n)/(4*n)||0,[l,h,u]}};yt.luv=function(r,e,t){var i,n,s,o,a,l,h,u,c,d,f,g,m,w=.008856451679035631,y=903.2962962962961;e=e||"D65",t=t||2,c=yt.whitepoint[t][e][0],d=yt.whitepoint[t][e][1],f=yt.whitepoint[t][e][2],g=4*c/(c+15*d+3*f),m=9*d/(c+15*d+3*f),l=r[0],h=r[1],u=r[2],i=4*l/(l+15*h+3*u)||0,n=9*h/(l+15*h+3*u)||0;var E=h/d;return s=E<=w?y*E:116*Math.pow(E,1/3)-16,o=13*s*(i-g),a=13*s*(n-m),[s,o,a]};var tb={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(r){var e=r[0],t=r[1],i=r[2],n,s,o;return o=i/360*2*Math.PI,n=t*Math.cos(o),s=t*Math.sin(o),[e,n,s]},xyz:function(r){return _d.xyz(tb.luv(r))}};_d.lchuv=function(r){var e=r[0],t=r[1],i=r[2],n=Math.sqrt(t*t+i*i),s=Math.atan2(i,t),o=s*360/2/Math.PI;return o<0&&(o+=360),[e,n,o]};yt.lchuv=function(r){return _d.lchuv(yt.luv(r))};var ZE={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};const gg=Vl(ZE);var pg={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function KE(r){var u,c;var e,t=[],i=1,n;if(typeof r=="number")return{space:"rgb",values:[r>>>16,(r&65280)>>>8,r&255],alpha:1};if(typeof r=="number")return{space:"rgb",values:[r>>>16,(r&65280)>>>8,r&255],alpha:1};if(r=String(r).toLowerCase(),gg[r])t=gg[r].slice(),n="rgb";else if(r==="transparent")i=0,n="rgb",t=[0,0,0];else if(r[0]==="#"){var s=r.slice(1),o=s.length,a=o<=4;i=1,a?(t=[parseInt(s[0]+s[0],16),parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16)],o===4&&(i=parseInt(s[3]+s[3],16)/255)):(t=[parseInt(s[0]+s[1],16),parseInt(s[2]+s[3],16),parseInt(s[4]+s[5],16)],o===8&&(i=parseInt(s[6]+s[7],16)/255)),t[0]||(t[0]=0),t[1]||(t[1]=0),t[2]||(t[2]=0),n="rgb"}else if(e=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(r)){var l=e[1];n=l.replace(/a$/,"");var h=n==="cmyk"?4:n==="gray"?1:3;t=e[2].trim().split(/\s*[,\/]\s*|\s+/),n==="color"&&(n=t.shift()),t=t.map(function(d,f){if(d[d.length-1]==="%")return d=parseFloat(d)/100,f===3?d:n==="rgb"?d*255:n[0]==="h"||n[0]==="l"&&!f?d*100:n==="lab"?d*125:n==="lch"?f<2?d*150:d*360:n[0]==="o"&&!f?d:n==="oklab"?d*.4:n==="oklch"?f<2?d*.4:d*360:d;if(n[f]==="h"||f===2&&n[n.length-1]==="h"){if(pg[d]!==void 0)return pg[d];if(d.endsWith("deg"))return parseFloat(d);if(d.endsWith("turn"))return parseFloat(d)*360;if(d.endsWith("grad"))return parseFloat(d)*360/400;if(d.endsWith("rad"))return parseFloat(d)*180/Math.PI}return d==="none"?0:parseFloat(d)}),i=t.length>h?t.pop():1}else/[0-9](?:\s|\/|,)/.test(r)&&(t=r.match(/([0-9]+)/g).map(function(d){return parseFloat(d)}),n=((c=(u=r.match(/([a-z])/ig))==null?void 0:u.join(""))==null?void 0:c.toLowerCase())||"rgb");return{space:n,values:t,alpha:i}}const Oh={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(r){var e=r[0]/360,t=r[1]/100,i=r[2]/100,n,s,o,a,l,h=0;if(t===0)return l=i*255,[l,l,l];for(s=i<.5?i*(1+t):i+t-i*t,n=2*i-s,a=[0,0,0];h<3;)o=e+1/3*-(h-1),o<0?o++:o>1&&o--,l=6*o<1?n+(s-n)*6*o:2*o<1?s:3*o<2?n+(s-n)*(2/3-o)*6:n,a[h++]=l*255;return a}};Oo.hsl=function(r){var e=r[0]/255,t=r[1]/255,i=r[2]/255,n=Math.min(e,t,i),s=Math.max(e,t,i),o=s-n,a,l,h;return s===n?a=0:e===s?a=(t-i)/o:t===s?a=2+(i-e)/o:i===s&&(a=4+(e-t)/o),a=Math.min(a*60,360),a<0&&(a+=360),h=(n+s)/2,s===n?l=0:h<=.5?l=o/(s+n):l=o/(2-s-n),[a,l*100,h*100]};function qE(r){Array.isArray(r)&&r.raw&&(r=String.raw(...arguments)),r instanceof Number&&(r=+r);var e,t=KE(r);if(!t.space)return[];const i=t.space[0]==="h"?Oh.min:Oo.min,n=t.space[0]==="h"?Oh.max:Oo.max;return e=Array(3),e[0]=Math.min(Math.max(t.values[0],i[0]),n[0]),e[1]=Math.min(Math.max(t.values[1],i[1]),n[1]),e[2]=Math.min(Math.max(t.values[2],i[2]),n[2]),t.space[0]==="h"&&(e=Oh.rgb(e)),e.push(Math.min(Math.max(t.alpha,0),1)),e}function JE(r){return typeof r=="string"?r:xd(r)}const QE=1024,eo={};let Dh=0;function e_(r){if(r.length===4)return r;const e=r.slice();return e[3]=1,e}function mg(r){const e=yt.lchuv(Oo.xyz(r));return e[3]=r[3],e}function t_(r){const e=yt.rgb(tb.xyz(r));return e[3]=r[3],e}function Cd(r){if(eo.hasOwnProperty(r))return eo[r];if(Dh>=QE){let t=0;for(const i in eo)t++&3||(delete eo[i],--Dh)}const e=qE(r);if(e.length!==4)throw new Error('Failed to parse "'+r+'" as color');for(const t of e)if(isNaN(t))throw new Error('Failed to parse "'+r+'" as color');return ib(e),eo[r]=e,++Dh,e}function Rn(r){return Array.isArray(r)?r:Cd(r)}function ib(r){return r[0]=it(r[0]+.5|0,0,255),r[1]=it(r[1]+.5|0,0,255),r[2]=it(r[2]+.5|0,0,255),r[3]=it(r[3],0,1),r}function xd(r){let e=r[0];e!=(e|0)&&(e=e+.5|0);let t=r[1];t!=(t|0)&&(t=t+.5|0);let i=r[2];i!=(i|0)&&(i=i+.5|0);const n=r[3]===void 0?1:Math.round(r[3]*1e3)/1e3;return"rgba("+e+","+t+","+i+","+n+")"}function i_(r){try{return Cd(r),!0}catch{return!1}}const or=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",n_=or.includes("firefox"),r_=or.includes("safari")&&!or.includes("chrom"),Xk=r_&&(or.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(or)),s_=or.includes("webkit")&&!or.includes("edge"),Rd=or.includes("macintosh"),Sd=typeof devicePixelRatio<"u"?devicePixelRatio:1,nb=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Td=typeof Image<"u"&&Image.prototype.decode,o_=typeof createImageBitmap=="function",rb=function(){let r=!1;try{const e=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return r}();function mt(r,e,t,i){let n;return t&&t.length?n=t.shift():nb?n=new OffscreenCanvas(r||300,e||300):n=document.createElement("canvas"),r&&(n.width=r),e&&(n.height=e),n.getContext("2d",i)}let kh;function Tu(){return kh||(kh=mt(1,1)),kh}function ia(r){const e=r.canvas;e.width=1,e.height=1,r.clearRect(0,0,1,1)}function a_(r){let e=r.offsetWidth;const t=getComputedStyle(r);return e+=parseInt(t.marginLeft,10)+parseInt(t.marginRight,10),e}function l_(r){let e=r.offsetHeight;const t=getComputedStyle(r);return e+=parseInt(t.marginTop,10)+parseInt(t.marginBottom,10),e}function bg(r,e){const t=e.parentNode;t&&t.replaceChild(r,e)}function il(r){return r&&r.parentNode?r.parentNode.removeChild(r):null}function sb(r){for(;r.lastChild;)r.removeChild(r.lastChild)}function h_(r,e){const t=r.childNodes;for(let i=0;;++i){const n=t[i],s=e[i];if(!n&&!s)break;if(n!==s){if(!n){r.appendChild(s);continue}if(!s){r.removeChild(n),--i;continue}r.insertBefore(s,n)}}}class u_ extends Jo{constructor(e,t,i,n){super(),this.extent=e,this.pixelRatio_=i,this.resolution=t,this.state=typeof n=="function"?oe.IDLE:n,this.image_=null,this.loader=typeof n=="function"?n:null}changed(){this.dispatchEvent(Ee.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==oe.IDLE&&this.loader){this.state=oe.LOADING,this.changed();const e=this.getResolution(),t=Array.isArray(e)?e[0]:e;zm(()=>this.loader(this.getExtent(),t,this.getPixelRatio())).then(i=>{"image"in i&&(this.image_=i.image),"extent"in i&&(this.extent=i.extent),"resolution"in i&&(this.resolution=i.resolution),"pixelRatio"in i&&(this.pixelRatio_=i.pixelRatio),(i instanceof HTMLImageElement||i instanceof ImageBitmap||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement)&&(this.image_=i),this.state=oe.LOADED}).catch(i=>{this.state=oe.ERROR,console.error(i)}).finally(()=>this.changed())}}setImage(e){this.image_=e}setResolution(e){this.resolution=e}}function c_(r,e,t){const i=r;let n=!0,s=!1,o=!1;const a=[el(i,Ee.LOAD,function(){o=!0,s||e()})];return i.src&&Td?(s=!0,i.decode().then(function(){n&&e()}).catch(function(l){n&&(o?e():t())})):a.push(el(i,Ee.ERROR,t)),function(){n=!1,a.forEach(We)}}function d_(r,e){return new Promise((t,i)=>{function n(){o(),t(r)}function s(){o(),i(new Error("Image load error"))}function o(){r.removeEventListener("load",n),r.removeEventListener("error",s)}r.addEventListener("load",n),r.addEventListener("error",s),e&&(r.src=e)})}function ob(r,e){return e&&(r.src=e),r.src&&Td?new Promise((t,i)=>r.decode().then(()=>t(r)).catch(n=>r.complete&&r.width?t(r):i(n))):d_(r)}function ab(r,e){return e&&(r.src=e),r.src&&Td&&o_?r.decode().then(()=>createImageBitmap(r)).catch(t=>{if(r.complete&&r.width)return r;throw t}):ob(r)}const lb=u_;class f_{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const i=this.cache_[t];!(e++&3)&&!i.hasListener()&&(delete this.cache_[t],delete this.patternCache_[t],--this.cacheSize_)}}}get(e,t,i){const n=Nh(e,t,i);return n in this.cache_?this.cache_[n]:null}getPattern(e,t,i){const n=Nh(e,t,i);return n in this.patternCache_?this.patternCache_[n]:null}set(e,t,i,n,s){const o=Nh(e,t,i),a=o in this.cache_;this.cache_[o]=n,s&&(n.getImageState()===oe.IDLE&&n.load(),n.getImageState()===oe.LOADING?n.ready().then(()=>{this.patternCache_[o]=Tu().createPattern(n.getImage(1),"repeat")}):this.patternCache_[o]=Tu().createPattern(n.getImage(1),"repeat")),a||++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function Nh(r,e,t){const i=t?Rn(t):"null";return e+":"+r+":"+i}const $i=new f_;let to=null;class g_ extends Jo{constructor(e,t,i,n,s){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=i,this.canvas_={},this.color_=s,this.imageState_=n===void 0?oe.IDLE:n,this.size_=e&&e.width&&e.height?[e.width,e.height]:null,this.src_=t,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===oe.LOADED){to||(to=mt(1,1,void 0,{willReadFrequently:!0})),to.drawImage(this.image_,0,0);try{to.getImageData(0,0,1,1),this.tainted_=!1}catch{to=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(Ee.CHANGE)}handleImageError_(){this.imageState_=oe.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=oe.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],t=this.size_[1],i=mt(e,t);i.fillRect(0,0,e,t),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===oe.IDLE){this.image_||this.initializeImage_(),this.imageState_=oe.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&ob(this.image_,this.src_).then(e=>{this.image_=e,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||this.imageState_!==oe.LOADED)return;const t=this.image_,i=document.createElement("canvas");i.width=Math.ceil(t.width*e),i.height=Math.ceil(t.height*e);const n=i.getContext("2d");n.scale(e,e),n.drawImage(t,0,0),n.globalCompositeOperation="multiply",n.fillStyle=JE(this.color_),n.fillRect(0,0,i.width/e,i.height/e),n.globalCompositeOperation="destination-in",n.drawImage(t,0,0),this.canvas_[e]=i}ready(){return this.ready_||(this.ready_=new Promise(e=>{this.imageState_===oe.LOADED||this.imageState_===oe.ERROR?e():this.addEventListener(Ee.CHANGE,function t(){(this.imageState_===oe.LOADED||this.imageState_===oe.ERROR)&&(this.removeEventListener(Ee.CHANGE,t),e())})})),this.ready_}}function Md(r,e,t,i,n,s){let o=e===void 0?void 0:$i.get(e,t,n);return o||(o=new g_(r,r instanceof HTMLImageElement?r.src||void 0:e,t,i,n),$i.set(e,t,n,o,s)),s&&o&&!$i.getPattern(e,t,n)&&$i.set(e,t,n,o,s),o}function Zi(r){return r?Array.isArray(r)?xd(r):typeof r=="object"&&"src"in r?p_(r):r:null}function p_(r){if(!r.offset||!r.size)return $i.getPattern(r.src,"anonymous",r.color);const e=r.src+":"+r.offset,t=$i.getPattern(e,void 0,r.color);if(t)return t;const i=$i.get(r.src,"anonymous",null);if(i.getImageState()!==oe.LOADED)return null;const n=mt(r.size[0],r.size[1]);return n.drawImage(i.getImage(1),r.offset[0],r.offset[1],r.size[0],r.size[1],0,0,r.size[0],r.size[1]),Md(n.canvas,e,void 0,oe.LOADED,r.color,!0),$i.getPattern(e,void 0,r.color)}const Ea="ol-hidden",m_="ol-selectable",eh="ol-unselectable",Ld="ol-control",yg="ol-collapsed",b_=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),vg=["style","variant","weight","size","lineHeight","family"],Ad=function(r){const e=r.match(b_);if(!e)return null;const t={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let i=0,n=vg.length;i<n;++i){const s=e[i+1];s!==void 0&&(t[vg[i]]=s)}return t.families=t.family.split(/,\s?/),t},hb="10px sans-serif",Wt="#000",Is="round",Sn=[],Tn=0,Ps="round",Do=10,ko="#000",No="center",nl="middle",Rr=[0,0,0,0],zo=1,mn=new Hi;let rs=null,Mu;const Lu={},y_=function(){const e="32px ",t=["monospace","serif"],i=t.length,n="wmytzilWMYTZIL@#/&?$%10";let s,o;function a(h,u,c){let d=!0;for(let f=0;f<i;++f){const g=t[f];if(o=rl(h+" "+u+" "+e+g,n),c!=g){const m=rl(h+" "+u+" "+e+c+","+g,n);d=d&&m!=o}}return!!d}function l(){let h=!0;const u=mn.getKeys();for(let c=0,d=u.length;c<d;++c){const f=u[c];mn.get(f)<100&&(a.apply(this,f.split(`
`))?($o(Lu),rs=null,Mu=void 0,mn.set(f,100)):(mn.set(f,mn.get(f)+1,!0),h=!1))}h&&(clearInterval(s),s=void 0)}return function(h){const u=Ad(h);if(!u)return;const c=u.families;for(let d=0,f=c.length;d<f;++d){const g=c[d],m=u.style+`
`+u.weight+`
`+g;mn.get(m)===void 0&&(mn.set(m,100,!0),a(u.style,u.weight,g)||(mn.set(m,0,!0),s===void 0&&(s=setInterval(l,32))))}}}(),v_=function(){let r;return function(e){let t=Lu[e];if(t==null){if(nb){const i=Ad(e),n=ub(e,"Žg");t=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else r||(r=document.createElement("div"),r.innerHTML="M",r.style.minHeight="0",r.style.maxHeight="none",r.style.height="auto",r.style.padding="0",r.style.border="none",r.style.position="absolute",r.style.display="block",r.style.left="-99999px"),r.style.font=e,document.body.appendChild(r),t=r.offsetHeight,document.body.removeChild(r);Lu[e]=t}return t}}();function ub(r,e){return rs||(rs=mt(1,1)),r!=Mu&&(rs.font=r,Mu=rs.font),rs.measureText(e)}function rl(r,e){return ub(r,e).width}function wg(r,e,t){if(e in t)return t[e];const i=e.split(`
`).reduce((n,s)=>Math.max(n,rl(r,s)),0);return t[e]=i,i}function w_(r,e){const t=[],i=[],n=[];let s=0,o=0,a=0,l=0;for(let h=0,u=e.length;h<=u;h+=2){const c=e[h];if(c===`
`||h===u){s=Math.max(s,o),n.push(o),o=0,a+=l;continue}const d=e[h+1]||r.font,f=rl(d,c);t.push(f),o+=f;const g=v_(d);i.push(g),l=Math.max(l,g)}return{width:s,height:a,widths:t,heights:i,lineWidths:n}}function E_(r,e,t,i,n,s,o,a,l,h,u){r.save(),t!==1&&(r.globalAlpha===void 0?r.globalAlpha=c=>c.globalAlpha*=t:r.globalAlpha*=t),e&&r.transform.apply(r,e),i.contextInstructions?(r.translate(l,h),r.scale(u[0],u[1]),__(i,r)):u[0]<0||u[1]<0?(r.translate(l,h),r.scale(u[0],u[1]),r.drawImage(i,n,s,o,a,0,0,o,a)):r.drawImage(i,n,s,o,a,l,h,o*u[0],a*u[1]),r.restore()}function __(r,e){const t=r.contextInstructions;for(let i=0,n=t.length;i<n;i+=2)Array.isArray(t[i+1])?e[t[i]].apply(e,t[i+1]):e[t[i]]=t[i+1]}class th extends Ql{constructor(e){super({opacity:1,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,rotation:e.rotation!==void 0?e.rotation:0,scale:e.scale!==void 0?e.scale:1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode}),this.canvases_,this.hitDetectionCanvas_=null,this.fill_=e.fill!==void 0?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius_=e.radius,this.radius2_=e.radius2,this.angle_=e.angle!==void 0?e.angle:0,this.stroke_=e.stroke!==void 0?e.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?oe.LOADING:oe.LOADED,this.imageState_===oe.LOADING&&this.ready().then(()=>this.imageState_=oe.LOADED),this.render()}clone(){const e=this.getScale(),t=new th({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}getAnchor(){const e=this.size_,t=this.getDisplacement(),i=this.getScaleArray();return[e[0]/2-t[0]/i[0],e[1]/2+t[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(e){let t=this.canvases_[e];if(!t){const i=this.renderOptions_,n=mt(i.size*e,i.size*e);this.draw_(i,n,e),t=n.canvas,this.canvases_[e]=t}return t}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(e){}load(){}unlistenImageChange(e){}calculateLineJoinSize_(e,t,i){if(t===0||this.points_===1/0||e!=="bevel"&&e!=="miter")return t;let n=this.radius_,s=this.radius2_===void 0?n:this.radius2_;if(n<s){const R=n;n=s,s=R}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=s*Math.sin(a),h=Math.sqrt(s*s-l*l),u=n-h,c=Math.sqrt(l*l+u*u),d=c/l;if(e==="miter"&&d<=i)return d*t;const f=t/2/d,g=t/2*(u/c),w=Math.sqrt((n+f)*(n+f)+g*g)-n;if(this.radius2_===void 0||e==="bevel")return w*2;const y=n*Math.sin(a),E=Math.sqrt(n*n-y*y),x=s-E,S=Math.sqrt(y*y+x*x)/y;if(S<=i){const R=S*t/2-s-n;return 2*Math.max(w,R)}return w*2}createRenderOptions(){let e=Is,t=Ps,i=0,n=null,s=0,o,a=0;this.stroke_&&(o=Zi(this.stroke_.getColor()??ko),a=this.stroke_.getWidth()??zo,n=this.stroke_.getLineDash(),s=this.stroke_.getLineDashOffset()??0,t=this.stroke_.getLineJoin()??Ps,e=this.stroke_.getLineCap()??Is,i=this.stroke_.getMiterLimit()??Do);const l=this.calculateLineJoinSize_(t,a,i),h=Math.max(this.radius_,this.radius2_||0),u=Math.ceil(2*h+l);return{strokeStyle:o,strokeWidth:a,size:u,lineCap:e,lineDash:n,lineDashOffset:s,lineJoin:t,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const e=this.renderOptions_.size;this.canvases_={},this.hitDetectionCanvas_=null,this.size_=[e,e]}draw_(e,t,i){if(t.scale(i,i),t.translate(e.size/2,e.size/2),this.createPath_(t),this.fill_){let n=this.fill_.getColor();n===null&&(n=Wt),t.fillStyle=Zi(n),t.fill()}e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}createHitDetectionCanvas_(e){let t;if(this.fill_){let i=this.fill_.getColor(),n=0;typeof i=="string"&&(i=Rn(i)),i===null?n=1:Array.isArray(i)&&(n=i.length===4?i[3]:1),n===0&&(t=mt(e.size,e.size),this.drawHitDetectionCanvas_(e,t))}return t?t.canvas:this.getImage(1)}createPath_(e){let t=this.points_;const i=this.radius_;if(t===1/0)e.arc(0,0,i,0,2*Math.PI);else{const n=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(t*=2);const s=this.angle_-Math.PI/2,o=2*Math.PI/t;for(let a=0;a<t;a++){const l=s+a*o,h=a%2===0?i:n;e.lineTo(h*Math.cos(l),h*Math.sin(l))}e.closePath()}}drawHitDetectionCanvas_(e,t){t.translate(e.size/2,e.size/2),this.createPath_(t),t.fillStyle=Wt,t.fill(),e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class Vs extends th{constructor(e){e=e||{radius:5},super({points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:e.scale!==void 0?e.scale:1,rotation:e.rotation!==void 0?e.rotation:0,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){const e=this.getScale(),t=new Vs({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}setRadius(e){this.radius_=e,this.render()}}class nn{constructor(e){e=e||{},this.patternImage_=null,this.color_=null,e.color!==void 0&&this.setColor(e.color)}clone(){const e=this.getColor();return new nn({color:Array.isArray(e)?e.slice():e||void 0})}getColor(){return this.color_}setColor(e){if(e!==null&&typeof e=="object"&&"src"in e){const t=Md(null,e.src,"anonymous",void 0,e.offset?null:e.color?e.color:null,!(e.offset&&e.size));t.ready().then(()=>{this.patternImage_=null}),t.getImageState()===oe.IDLE&&t.load(),t.getImageState()===oe.LOADING&&(this.patternImage_=t)}this.color_=e}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}class ki{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=e.lineDash!==void 0?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}clone(){const e=this.getColor();return new ki({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setWidth(e){this.width_=e}}class vt{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=Eg,e.geometry!==void 0&&this.setGeometry(e.geometry),this.fill_=e.fill!==void 0?e.fill:null,this.image_=e.image!==void 0?e.image:null,this.renderer_=e.renderer!==void 0?e.renderer:null,this.hitDetectionRenderer_=e.hitDetectionRenderer!==void 0?e.hitDetectionRenderer:null,this.stroke_=e.stroke!==void 0?e.stroke:null,this.text_=e.text!==void 0?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&typeof e=="object"&&(e=e.clone()),new vt({geometry:e??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){typeof e=="function"?this.geometryFunction_=e:typeof e=="string"?this.geometryFunction_=function(t){return t.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=Eg,this.geometry_=e}setZIndex(e){this.zIndex_=e}}function C_(r){let e;if(typeof r=="function")e=r;else{let t;Array.isArray(r)?t=r:(Ae(typeof r.getZIndex=="function","Expected an `Style` or an array of `Style`"),t=[r]),e=function(){return t}}return e}let zh=null;function x_(r,e){if(!zh){const t=new nn({color:"rgba(255,255,255,0.4)"}),i=new ki({color:"#3399CC",width:1.25});zh=[new vt({image:new Vs({fill:t,stroke:i,radius:5}),fill:t,stroke:i})]}return zh}function $k(){const r={},e=[255,255,255,1],t=[0,153,255,1],i=3;return r.Polygon=[new vt({fill:new nn({color:[255,255,255,.5]})})],r.MultiPolygon=r.Polygon,r.LineString=[new vt({stroke:new ki({color:e,width:i+2})}),new vt({stroke:new ki({color:t,width:i})})],r.MultiLineString=r.LineString,r.Circle=r.Polygon.concat(r.LineString),r.Point=[new vt({image:new Vs({radius:i*2,fill:new nn({color:t}),stroke:new ki({color:e,width:i/2})}),zIndex:1/0})],r.MultiPoint=r.Point,r.GeometryCollection=r.Polygon.concat(r.LineString,r.Point),r}function Eg(r){return r.getGeometry()}function _g(r,e,t,i){return t!==void 0&&i!==void 0?[t/r,i/e]:t!==void 0?t/r:i!==void 0?i/e:1}class jr extends Ql{constructor(e){e=e||{};const t=e.opacity!==void 0?e.opacity:1,i=e.rotation!==void 0?e.rotation:0,n=e.scale!==void 0?e.scale:1,s=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:t,rotation:i,scale:n,displacement:e.displacement!==void 0?e.displacement:[0,0],rotateWithView:s,declutterMode:e.declutterMode}),this.anchor_=e.anchor!==void 0?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=e.anchorOrigin!==void 0?e.anchorOrigin:"top-left",this.anchorXUnits_=e.anchorXUnits!==void 0?e.anchorXUnits:"fraction",this.anchorYUnits_=e.anchorYUnits!==void 0?e.anchorYUnits:"fraction",this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null;const o=e.img!==void 0?e.img:null;let a=e.src;Ae(!(a!==void 0&&o),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&o&&(a=o.src||xe(o)),Ae(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),Ae(!((e.width!==void 0||e.height!==void 0)&&e.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(e.src!==void 0?l=oe.IDLE:o!==void 0&&(o instanceof HTMLImageElement?o.complete?l=o.src?oe.LOADED:oe.IDLE:l=oe.LOADING:l=oe.LOADED),this.color_=e.color!==void 0?Rn(e.color):null,this.iconImage_=Md(o,a,this.crossOrigin_,l,this.color_),this.offset_=e.offset!==void 0?e.offset:[0,0],this.offsetOrigin_=e.offsetOrigin!==void 0?e.offsetOrigin:"top-left",this.origin_=null,this.size_=e.size!==void 0?e.size:null,e.width!==void 0||e.height!==void 0){let h,u;if(e.size)[h,u]=e.size;else{const c=this.getImage(1);if(c.width&&c.height)h=c.width,u=c.height;else if(c instanceof HTMLImageElement){this.initialOptions_=e;const d=()=>{if(this.unlistenImageChange(d),!this.initialOptions_)return;const f=this.iconImage_.getSize();this.setScale(_g(f[0],f[1],e.width,e.height))};this.listenImageChange(d);return}}h!==void 0&&this.setScale(_g(h,u,e.width,e.height))}}clone(){let e,t,i;return this.initialOptions_?(t=this.initialOptions_.width,i=this.initialOptions_.height):(e=this.getScale(),e=Array.isArray(e)?e.slice():e),new jr({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:e,width:t,height:i,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const n=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!n)return null;e=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(e[0]*=n[0]),this.anchorYUnits_=="fraction"&&(e[1]*=n[1])}if(this.anchorOrigin_!="top-left"){if(!n)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(e[0]=-e[0]+n[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(e[1]=-e[1]+n[1])}this.normalizedAnchor_=e}const t=this.getDisplacement(),i=this.getScaleArray();return[e[0]-t[0]/i[0],e[1]+t[1]/i[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!="top-left"){const t=this.getSize(),i=this.iconImage_.getSize();if(!t||!i)return null;e=e.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(e[0]=i[0]-t[0]-e[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(e[1]=i[1]-t[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const e=this.getScaleArray();if(this.size_)return this.size_[0]*e[0];if(this.iconImage_.getImageState()==oe.LOADED)return this.iconImage_.getSize()[0]*e[0]}getHeight(){const e=this.getScaleArray();if(this.size_)return this.size_[1]*e[1];if(this.iconImage_.getImageState()==oe.LOADED)return this.iconImage_.getSize()[1]*e[1]}setScale(e){delete this.initialOptions_,super.setScale(e)}listenImageChange(e){this.iconImage_.addEventListener(Ee.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(Ee.CHANGE,e)}ready(){return this.iconImage_.ready()}}const R_="#333";class na{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.scale_=e.scale,this.scaleArray_=Nt(e.scale!==void 0?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.repeat_=e.repeat,this.textBaseline_=e.textBaseline,this.fill_=e.fill!==void 0?e.fill:new nn({color:R_}),this.maxAngle_=e.maxAngle!==void 0?e.maxAngle:Math.PI/4,this.placement_=e.placement!==void 0?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=e.stroke!==void 0?e.stroke:null,this.offsetX_=e.offsetX!==void 0?e.offsetX:0,this.offsetY_=e.offsetY!==void 0?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=e.padding===void 0?null:e.padding,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new na({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRepeat(e){this.repeat_=e}setRotateWithView(e){this.rotateWithView_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=Nt(e!==void 0?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}}let Ws=0;const Us=0,tt=1<<Ws++,ce=1<<Ws++,ni=1<<Ws++,gt=1<<Ws++,In=1<<Ws++,Tt=Math.pow(2,Ws)-1,cb={[tt]:"boolean",[ce]:"number",[ni]:"string",[gt]:"color",[In]:"number[]"},S_=Object.keys(cb).map(Number).sort(qi);function Lt(r){const e=[];for(const t of S_)T_(r,t)&&e.push(cb[t]);return e.length===0?"untyped":e.length<3?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e[e.length-1]}function T_(r,e){return(r&e)===e}function Ji(r,e){return!!(r&e)}function ih(r,e){return r===e}class Jn{constructor(e,t){this.type=e,this.value=t}}class M_{constructor(e,t,...i){this.type=e,this.operator=t,this.args=i}}function db(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,style:{}}}function L_(r){switch(r){case"string":return ni;case"color":return gt;case"number":return ce;case"boolean":return tt;case"number[]":return In;default:throw new Error(`Unrecognized type hint: ${r}`)}}function Ge(r,e,t){switch(typeof r){case"boolean":return new Jn(tt,r);case"number":return new Jn(ce,r);case"string":{let n=ni;return i_(r)&&(n|=gt),ih(n&t,Us)||(n&=t),new Jn(n,r)}}if(!Array.isArray(r))throw new Error("Expression must be an array or a primitive value");if(r.length===0)throw new Error("Empty expression");if(typeof r[0]=="string")return H_(r,e,t);for(const n of r)if(typeof n!="number")throw new Error("Expected an array of numbers");let i=In;return(r.length===3||r.length===4)&&(i|=gt),t&&(i&=t),new Jn(i,r)}const Y={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string"},A_={[Y.Get]:_e(([r,e])=>e!==void 0?L_(e.value):Tt,Te(1,2),I_),[Y.Var]:_e(([r])=>r.type,Te(1,1),P_),[Y.Id]:_e(ce|ni,io,F_),[Y.Concat]:_e(ni,Te(2,1/0),De(Tt)),[Y.GeometryType]:_e(ni,io,O_),[Y.Resolution]:_e(ce,io),[Y.Zoom]:_e(ce,io),[Y.Time]:_e(ce,io),[Y.Any]:_e(tt,Te(2,1/0),De(tt)),[Y.All]:_e(tt,Te(2,1/0),De(tt)),[Y.Not]:_e(tt,Te(1,1),De(tt)),[Y.Equal]:_e(tt,Te(2,2),De(Tt),Nn),[Y.NotEqual]:_e(tt,Te(2,2),De(Tt),Nn),[Y.GreaterThan]:_e(tt,Te(2,2),De(Tt),Nn),[Y.GreaterThanOrEqualTo]:_e(tt,Te(2,2),De(Tt),Nn),[Y.LessThan]:_e(tt,Te(2,2),De(Tt),Nn),[Y.LessThanOrEqualTo]:_e(tt,Te(2,2),De(Tt),Nn),[Y.Multiply]:_e(r=>{let e=ce|gt;for(let t=0;t<r.length;t++)e&=r[t].type;return e},Te(2,1/0),De(ce|gt),Nn),[Y.Coalesce]:_e(r=>{let e=Tt;for(let t=1;t<r.length;t+=2)e&=r[t].type;return e&=r[r.length-1].type,e},Te(2,1/0),De(Tt),Nn),[Y.Divide]:_e(ce,Te(2,2),De(ce)),[Y.Add]:_e(ce,Te(2,1/0),De(ce)),[Y.Subtract]:_e(ce,Te(2,2),De(ce)),[Y.Clamp]:_e(ce,Te(3,3),De(ce)),[Y.Mod]:_e(ce,Te(2,2),De(ce)),[Y.Pow]:_e(ce,Te(2,2),De(ce)),[Y.Abs]:_e(ce,Te(1,1),De(ce)),[Y.Floor]:_e(ce,Te(1,1),De(ce)),[Y.Ceil]:_e(ce,Te(1,1),De(ce)),[Y.Round]:_e(ce,Te(1,1),De(ce)),[Y.Sin]:_e(ce,Te(1,1),De(ce)),[Y.Cos]:_e(ce,Te(1,1),De(ce)),[Y.Atan]:_e(ce,Te(1,2),De(ce)),[Y.Sqrt]:_e(ce,Te(1,1),De(ce)),[Y.Match]:_e(r=>{let e=Tt;for(let t=2;t<r.length;t+=2)e&=r[t].type;return e&=r[r.length-1].type,e},Te(4,1/0),Cg,k_),[Y.Between]:_e(tt,Te(3,3),De(ce)),[Y.Interpolate]:_e(r=>{let e=gt|ce;for(let t=3;t<r.length;t+=2)e&=r[t].type;return e},Te(6,1/0),Cg,N_),[Y.Case]:_e(r=>{let e=Tt;for(let t=1;t<r.length;t+=2)e&=r[t].type;return e&=r[r.length-1].type,e},Te(3,1/0),D_,z_),[Y.In]:_e(tt,Te(2,2),B_),[Y.Number]:_e(ce,Te(1,1/0),De(Tt)),[Y.String]:_e(ni,Te(1,1/0),De(Tt)),[Y.Array]:_e(r=>r.length===3||r.length===4?In|gt:In,Te(1,1/0),De(ce)),[Y.Color]:_e(gt,Te(1,4),De(ce)),[Y.Band]:_e(ce,Te(1,3),De(ce)),[Y.Palette]:_e(gt,Te(2,2),G_),[Y.ToString]:_e(ni,Te(1,1),De(tt|ce|ni|gt))};function I_(r,e){const t=Ge(r[1],e);if(!(t instanceof Jn))throw new Error("Expected a literal argument for get operation");if(typeof t.value!="string")throw new Error("Expected a string argument for get operation");if(e.properties.add(t.value),r.length===3){const i=Ge(r[2],e);return[t,i]}return[t]}function P_(r,e,t,i){const n=r[1];if(typeof n!="string")throw new Error("Expected a string argument for var operation");if(e.variables.add(n),!("variables"in e.style)||e.style.variables[n]===void 0)return[new Jn(Tt,n)];const s=e.style.variables[n],o=Ge(s,e);if(o.value=n,i&&!Ji(i,o.type))throw new Error(`The variable ${n} has type ${Lt(o.type)} but the following type was expected: ${Lt(i)}`);return[o]}function F_(r,e){e.featureId=!0}function O_(r,e){e.geometryType=!0}function io(r,e){const t=r[0];if(r.length!==1)throw new Error(`Expected no arguments for ${t} operation`);return[]}function Te(r,e){return function(t,i){const n=t[0],s=t.length-1;if(r===e){if(s!==r){const o=r===1?"":"s";throw new Error(`Expected ${r} argument${o} for ${n}, got ${s}`)}}else if(s<r||s>e){const o=e===1/0?`${r} or more`:`${r} to ${e}`;throw new Error(`Expected ${o} arguments for ${n}, got ${s}`)}}}function De(r){return function(e,t){const i=e[0],n=e.length-1,s=new Array(n);for(let o=0;o<n;++o){const a=Ge(e[o+1],t);if(!Ji(r,a.type)){const l=Lt(r),h=Lt(a.type);throw new Error(`Unexpected type for argument ${o} of ${i} operation, got ${l} but expected ${h}`)}a.type&=r,s[o]=a}return s}}function Nn(r,e,t){const i=r[0],n=r.length-1;let s=Tt;for(let a=0;a<t.length;++a)s&=t[a].type;if(s===Us)throw new Error(`No common type could be found for arguments of ${i} operation`);const o=new Array(n);for(let a=0;a<n;++a)o[a]=Ge(r[a+1],e,s);return o}function D_(r,e){const t=r[0],i=r.length-1;if(i%2===0)throw new Error(`An odd amount of arguments was expected for operation ${t}, got ${JSON.stringify(i)} instead`)}function Cg(r,e){const t=r[0],i=r.length-1;if(i%2===1)throw new Error(`An even amount of arguments was expected for operation ${t}, got ${JSON.stringify(i)} instead`)}function k_(r,e,t,i){const n=r.length-1;let o=Ge(r[1],e).type;const a=Ge(r[r.length-1],e);let l=i!==void 0?i&a.type:a.type;const h=new Array(n-2);for(let c=0;c<n-2;c+=2){const d=Ge(r[c+2],e),f=Ge(r[c+3],e);o&=d.type,l&=f.type,h[c]=d,h[c+1]=f}const u=ni|ce|tt;if(!Ji(u,o))throw new Error(`Expected an input of type ${Lt(u)} for the interpolate operation, got ${Lt(o)} instead`);if(ih(l,Us))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(r));for(let c=0;c<n-2;c+=2){const d=Ge(r[c+2],e,o),f=Ge(r[c+3],e,l);h[c]=d,h[c+1]=f}return[Ge(r[1],e,o),...h,Ge(r[r.length-1],e,l)]}function N_(r,e,t,i){const n=r[1];let s;switch(n[0]){case"linear":s=1;break;case"exponential":if(s=n[1],typeof s!="number")throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(s)} instead`);break;default:s=null}if(!s)throw new Error(`Invalid interpolation type: ${JSON.stringify(n)}`);s=Ge(s,e);let o=Ge(r[2],e);if(!Ji(ce,o.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${Lt(o.type)} instead`);o=Ge(r[2],e,ce);const a=new Array(r.length-3);for(let l=0;l<a.length;l+=2){let h=Ge(r[l+3],e);if(!Ji(ce,h.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${Lt(h.type)} at position ${l+2} instead`);let u=Ge(r[l+4],e);if(!Ji(ce|gt,u.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${Lt(u.type)} at position ${l+3} instead`);h=Ge(r[l+3],e,ce),u=Ge(r[l+4],e,ce|gt),a[l]=h,a[l+1]=u}return[s,o,...a]}function z_(r,e,t,i){const n=Ge(r[r.length-1],e);let s=i!==void 0?i&n.type:n.type;const o=new Array(r.length-1);for(let a=0;a<o.length-1;a+=2){const l=Ge(r[a+1],e),h=Ge(r[a+2],e);if(!Ji(tt,l.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${Lt(l.type)} at position ${a} instead`);s&=h.type,o[a]=l,o[a+1]=h}if(ih(s,Us))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(r));for(let a=0;a<o.length-1;a+=2)o[a+1]=Ge(r[a+2],e,s);return o[o.length-1]=Ge(r[r.length-1],e,s),o}function B_(r,e){let t=r[2];if(!Array.isArray(t))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if(typeof t[0]=="string"){if(t[0]!=="literal")throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(t[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');t=t[1]}let i=ni|ce;const n=new Array(t.length);for(let o=0;o<n.length;o++){const a=Ge(t[o],e);i&=a.type,n[o]=a}if(ih(i,Us))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(r));return[Ge(r[1],e,i),...n]}function G_(r,e){const t=Ge(r[1],e,ce);if(t.type!==ce)throw new Error(`The first argument of palette must be an number, got ${Lt(t.type)} instead`);const i=r[2];if(!Array.isArray(i))throw new Error("The second argument of palette must be an array");const n=new Array(i.length);for(let s=0;s<n.length;s++){const o=Ge(i[s],e,gt);if(!(o instanceof Jn))throw new Error(`The palette color at index ${s} must be a literal value`);if(!Ji(o.type,gt))throw new Error(`The palette color at index ${s} should be of type color, got ${Lt(o.type)} instead`);n[s]=o}return[t,...n]}function _e(r,...e){return function(t,i,n){const s=t[0];let o=[];for(let l=0;l<e.length;l++)o=e[l](t,i,o,n)||o;let a=typeof r=="function"?r(o):r;if(n!==void 0){if(!Ji(a,n))throw new Error(`The following expression was expected to return ${Lt(n)}, but returns ${Lt(a)} instead: ${JSON.stringify(t)}`);a&=n}if(a===Us)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(t)}`);return new M_(a,s,...o)}}function H_(r,e,t){const i=r[0],n=A_[i];if(!n)throw new Error(`Unknown operator: ${i}`);return n(r,e,t)}function fb(r){if(!r)return"";const e=r.getType();switch(e){case"Point":case"LineString":case"Polygon":return e;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return e.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return fb(r.getGeometries()[0]);default:return""}}function gb(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function On(r,e,t){const i=Ge(r,t);if(!Ji(e,i.type)){const n=Lt(e),s=Lt(i.type);throw new Error(`Expected expression to be of type ${n}, got ${s}`)}return zi(i)}function zi(r,e){if(r instanceof Jn){if(r.type===gt&&typeof r.value=="string"){const i=Cd(r.value);return function(){return i}}return function(){return r.value}}const t=r.operator;switch(t){case Y.Number:case Y.String:case Y.Coalesce:return V_(r);case Y.Get:case Y.Var:return W_(r);case Y.Id:return i=>i.featureId;case Y.GeometryType:return i=>i.geometryType;case Y.Concat:{const i=r.args.map(n=>zi(n));return n=>"".concat(...i.map(s=>s(n).toString()))}case Y.Resolution:return i=>i.resolution;case Y.Any:case Y.All:case Y.Between:case Y.In:case Y.Not:return Y_(r);case Y.Equal:case Y.NotEqual:case Y.LessThan:case Y.LessThanOrEqualTo:case Y.GreaterThan:case Y.GreaterThanOrEqualTo:return U_(r);case Y.Multiply:case Y.Divide:case Y.Add:case Y.Subtract:case Y.Clamp:case Y.Mod:case Y.Pow:case Y.Abs:case Y.Floor:case Y.Ceil:case Y.Round:case Y.Sin:case Y.Cos:case Y.Atan:case Y.Sqrt:return j_(r);case Y.Case:return X_(r);case Y.Match:return $_(r);case Y.Interpolate:return Z_(r);case Y.ToString:return K_(r);default:throw new Error(`Unsupported operator ${t}`)}}function V_(r,e){const t=r.operator,i=r.args.length,n=new Array(i);for(let s=0;s<i;++s)n[s]=zi(r.args[s]);switch(t){case Y.Coalesce:return s=>{for(let o=0;o<i;++o){const a=n[o](s);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case Y.Number:case Y.String:return s=>{for(let o=0;o<i;++o){const a=n[o](s);if(typeof a===t)return a}throw new Error(`Expected one of the values to be a ${t}`)};default:throw new Error(`Unsupported assertion operator ${t}`)}}function W_(r,e){const i=r.args[0].value;switch(r.operator){case Y.Get:return n=>n.properties[i];case Y.Var:return n=>n.variables[i];default:throw new Error(`Unsupported accessor operator ${r.operator}`)}}function U_(r,e){const t=r.operator,i=zi(r.args[0]),n=zi(r.args[1]);switch(t){case Y.Equal:return s=>i(s)===n(s);case Y.NotEqual:return s=>i(s)!==n(s);case Y.LessThan:return s=>i(s)<n(s);case Y.LessThanOrEqualTo:return s=>i(s)<=n(s);case Y.GreaterThan:return s=>i(s)>n(s);case Y.GreaterThanOrEqualTo:return s=>i(s)>=n(s);default:throw new Error(`Unsupported comparison operator ${t}`)}}function Y_(r,e){const t=r.operator,i=r.args.length,n=new Array(i);for(let s=0;s<i;++s)n[s]=zi(r.args[s]);switch(t){case Y.Any:return s=>{for(let o=0;o<i;++o)if(n[o](s))return!0;return!1};case Y.All:return s=>{for(let o=0;o<i;++o)if(!n[o](s))return!1;return!0};case Y.Between:return s=>{const o=n[0](s),a=n[1](s),l=n[2](s);return o>=a&&o<=l};case Y.In:return s=>{const o=n[0](s);for(let a=1;a<i;++a)if(o===n[a](s))return!0;return!1};case Y.Not:return s=>!n[0](s);default:throw new Error(`Unsupported logical operator ${t}`)}}function j_(r,e){const t=r.operator,i=r.args.length,n=new Array(i);for(let s=0;s<i;++s)n[s]=zi(r.args[s]);switch(t){case Y.Multiply:return s=>{let o=1;for(let a=0;a<i;++a)o*=n[a](s);return o};case Y.Divide:return s=>n[0](s)/n[1](s);case Y.Add:return s=>{let o=0;for(let a=0;a<i;++a)o+=n[a](s);return o};case Y.Subtract:return s=>n[0](s)-n[1](s);case Y.Clamp:return s=>{const o=n[0](s),a=n[1](s);if(o<a)return a;const l=n[2](s);return o>l?l:o};case Y.Mod:return s=>n[0](s)%n[1](s);case Y.Pow:return s=>Math.pow(n[0](s),n[1](s));case Y.Abs:return s=>Math.abs(n[0](s));case Y.Floor:return s=>Math.floor(n[0](s));case Y.Ceil:return s=>Math.ceil(n[0](s));case Y.Round:return s=>Math.round(n[0](s));case Y.Sin:return s=>Math.sin(n[0](s));case Y.Cos:return s=>Math.cos(n[0](s));case Y.Atan:return i===2?s=>Math.atan2(n[0](s),n[1](s)):s=>Math.atan(n[0](s));case Y.Sqrt:return s=>Math.sqrt(n[0](s));default:throw new Error(`Unsupported numeric operator ${t}`)}}function X_(r,e){const t=r.args.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=zi(r.args[n]);return n=>{for(let s=0;s<t-1;s+=2)if(i[s](n))return i[s+1](n);return i[t-1](n)}}function $_(r,e){const t=r.args.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=zi(r.args[n]);return n=>{const s=i[0](n);for(let o=1;o<t;o+=2)if(s===i[o](n))return i[o+1](n);return i[t-1](n)}}function Z_(r,e){const t=r.args.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=zi(r.args[n]);return n=>{const s=i[0](n),o=i[1](n);let a,l;for(let h=2;h<t;h+=2){const u=i[h](n);let c=i[h+1](n);const d=Array.isArray(c);if(d&&(c=e_(c)),u>=o)return h===2?c:d?q_(s,o,a,l,u,c):lo(s,o,a,l,u,c);a=u,l=c}return l}}function K_(r,e){const t=r.operator,i=r.args.length,n=new Array(i);for(let s=0;s<i;++s)n[s]=zi(r.args[s]);switch(t){case Y.ToString:return s=>{const o=n[0](s);return r.args[0].type===gt?xd(o):o.toString()};default:throw new Error(`Unsupported convert operator ${t}`)}}function lo(r,e,t,i,n,s){const o=n-t;if(o===0)return i;const a=e-t,l=r===1?a/o:(Math.pow(r,a)-1)/(Math.pow(r,o)-1);return i+l*(s-i)}function q_(r,e,t,i,n,s){if(n-t===0)return i;const a=mg(i),l=mg(s);let h=l[2]-a[2];h>180?h-=360:h<-180&&(h+=360);const u=[lo(r,e,t,a[0],n,l[0]),lo(r,e,t,a[1],n,l[1]),a[2]+lo(r,e,t,0,n,h),lo(r,e,t,i[3],n,s[3])];return ib(t_(u))}function J_(r){return!0}function Q_(r){const e=db(),t=eC(r,e),i=gb();return function(n,s){if(i.properties=n.getPropertiesInternal(),i.resolution=s,e.featureId){const o=n.getId();o!==void 0?i.featureId=o:i.featureId=null}return e.geometryType&&(i.geometryType=fb(n.getGeometry())),t(i)}}function xg(r){const e=db(),t=r.length,i=new Array(t);for(let o=0;o<t;++o)i[o]=Au(r[o],e);const n=gb(),s=new Array(t);return function(o,a){if(n.properties=o.getPropertiesInternal(),n.resolution=a,e.featureId){const h=o.getId();h!==void 0?n.featureId=h:n.featureId=null}let l=0;for(let h=0;h<t;++h){const u=i[h](n);u&&(s[l]=u,l+=1)}return s.length=l,s}}function eC(r,e){const t=r.length,i=new Array(t);for(let n=0;n<t;++n){const s=r[n],o="filter"in s?On(s.filter,tt,e):J_;let a;if(Array.isArray(s.style)){const l=s.style.length;a=new Array(l);for(let h=0;h<l;++h)a[h]=Au(s.style[h],e)}else a=[Au(s.style,e)];i[n]={filter:o,styles:a}}return function(n){const s=[];let o=!1;for(let a=0;a<t;++a){const l=i[a].filter;if(l(n)&&!(r[a].else&&o)){o=!0;for(const h of i[a].styles){const u=h(n);u&&s.push(u)}}}return s}}function Au(r,e){const t=Bo(r,"",e),i=Go(r,"",e),n=tC(r,e),s=iC(r,e),o=Yt(r,"z-index",e);if(!t&&!i&&!n&&!s&&!Dr(r))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(r));const a=new vt;return function(l){let h=!0;if(t){const u=t(l);u&&(h=!1),a.setFill(u)}if(i){const u=i(l);u&&(h=!1),a.setStroke(u)}if(n){const u=n(l);u&&(h=!1),a.setText(u)}if(s){const u=s(l);u&&(h=!1),a.setImage(u)}return o&&a.setZIndex(o(l)),h?null:a}}function Bo(r,e,t){let i;if(e+"fill-pattern-src"in r?i=oC(r,e+"fill-",t):i=Id(r,e+"fill-color",t),!i)return null;const n=new nn;return function(s){const o=i(s);return o==="none"?null:(n.setColor(o),n)}}function Go(r,e,t){const i=Yt(r,e+"stroke-width",t),n=Id(r,e+"stroke-color",t);if(!i&&!n)return null;const s=wn(r,e+"stroke-line-cap",t),o=wn(r,e+"stroke-line-join",t),a=pb(r,e+"stroke-line-dash",t),l=Yt(r,e+"stroke-line-dash-offset",t),h=Yt(r,e+"stroke-miter-limit",t),u=new ki;return function(c){if(n){const d=n(c);if(d==="none")return null;u.setColor(d)}if(i&&u.setWidth(i(c)),s){const d=s(c);if(d!=="butt"&&d!=="round"&&d!=="square")throw new Error("Expected butt, round, or square line cap");u.setLineCap(d)}if(o){const d=o(c);if(d!=="bevel"&&d!=="round"&&d!=="miter")throw new Error("Expected bevel, round, or miter line join");u.setLineJoin(d)}return a&&u.setLineDash(a(c)),l&&u.setLineDashOffset(l(c)),h&&u.setMiterLimit(h(c)),u}}function tC(r,e){const t="text-",i=wn(r,t+"value",e);if(!i)return null;const n=Bo(r,t,e),s=Bo(r,t+"background-",e),o=Go(r,t,e),a=Go(r,t+"background-",e),l=wn(r,t+"font",e),h=Yt(r,t+"max-angle",e),u=Yt(r,t+"offset-x",e),c=Yt(r,t+"offset-y",e),d=Ho(r,t+"overflow",e),f=wn(r,t+"placement",e),g=Yt(r,t+"repeat",e),m=nh(r,t+"scale",e),w=Ho(r,t+"rotate-with-view",e),y=Yt(r,t+"rotation",e),E=wn(r,t+"align",e),x=wn(r,t+"justify",e),v=wn(r,t+"baseline",e),S=pb(r,t+"padding",e),R=rh(r,t+"declutter-mode"),L=new na({declutterMode:R});return function(C){if(L.setText(i(C)),n&&L.setFill(n(C)),s&&L.setBackgroundFill(s(C)),o&&L.setStroke(o(C)),a&&L.setBackgroundStroke(a(C)),l&&L.setFont(l(C)),h&&L.setMaxAngle(h(C)),u&&L.setOffsetX(u(C)),c&&L.setOffsetY(c(C)),d&&L.setOverflow(d(C)),f){const M=f(C);if(M!=="point"&&M!=="line")throw new Error("Expected point or line for text-placement");L.setPlacement(M)}if(g&&L.setRepeat(g(C)),m&&L.setScale(m(C)),w&&L.setRotateWithView(w(C)),y&&L.setRotation(y(C)),E){const M=E(C);if(M!=="left"&&M!=="center"&&M!=="right"&&M!=="end"&&M!=="start")throw new Error("Expected left, right, center, start, or end for text-align");L.setTextAlign(M)}if(x){const M=x(C);if(M!=="left"&&M!=="right"&&M!=="center")throw new Error("Expected left, right, or center for text-justify");L.setJustify(M)}if(v){const M=v(C);if(M!=="bottom"&&M!=="top"&&M!=="middle"&&M!=="alphabetic"&&M!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");L.setTextBaseline(M)}return S&&L.setPadding(S(C)),L}}function iC(r,e){return"icon-src"in r?nC(r,e):"shape-points"in r?rC(r,e):"circle-radius"in r?sC(r,e):null}function nC(r,e){const t="icon-",i=t+"src",n=mb(r[i],i),s=sl(r,t+"anchor",e),o=nh(r,t+"scale",e),a=Yt(r,t+"opacity",e),l=sl(r,t+"displacement",e),h=Yt(r,t+"rotation",e),u=Ho(r,t+"rotate-with-view",e),c=Sg(r,t+"anchor-origin"),d=Tg(r,t+"anchor-x-units"),f=Tg(r,t+"anchor-y-units"),g=uC(r,t+"color"),m=lC(r,t+"cross-origin"),w=hC(r,t+"offset"),y=Sg(r,t+"offset-origin"),E=ol(r,t+"width"),x=ol(r,t+"height"),v=aC(r,t+"size"),S=rh(r,t+"declutter-mode"),R=new jr({src:n,anchorOrigin:c,anchorXUnits:d,anchorYUnits:f,color:g,crossOrigin:m,offset:w,offsetOrigin:y,height:x,width:E,size:v,declutterMode:S});return function(L){return a&&R.setOpacity(a(L)),l&&R.setDisplacement(l(L)),h&&R.setRotation(h(L)),u&&R.setRotateWithView(u(L)),o&&R.setScale(o(L)),s&&R.setAnchor(s(L)),R}}function rC(r,e){const t="shape-",i=t+"points",n=t+"radius",s=Iu(r[i],i),o=Iu(r[n],n),a=Bo(r,t,e),l=Go(r,t,e),h=nh(r,t+"scale",e),u=sl(r,t+"displacement",e),c=Yt(r,t+"rotation",e),d=Ho(r,t+"rotate-with-view",e),f=ol(r,t+"radius2"),g=ol(r,t+"angle"),m=rh(r,t+"declutter-mode"),w=new th({points:s,radius:o,radius2:f,angle:g,declutterMode:m});return function(y){return a&&w.setFill(a(y)),l&&w.setStroke(l(y)),u&&w.setDisplacement(u(y)),c&&w.setRotation(c(y)),d&&w.setRotateWithView(d(y)),h&&w.setScale(h(y)),w}}function sC(r,e){const t="circle-",i=Bo(r,t,e),n=Go(r,t,e),s=Yt(r,t+"radius",e),o=nh(r,t+"scale",e),a=sl(r,t+"displacement",e),l=Yt(r,t+"rotation",e),h=Ho(r,t+"rotate-with-view",e),u=rh(r,t+"declutter-mode"),c=new Vs({radius:5,declutterMode:u});return function(d){return s&&c.setRadius(s(d)),i&&c.setFill(i(d)),n&&c.setStroke(n(d)),a&&c.setDisplacement(a(d)),l&&c.setRotation(l(d)),h&&c.setRotateWithView(h(d)),o&&c.setScale(o(d)),c}}function Yt(r,e,t){if(!(e in r))return;const i=On(r[e],ce,t);return function(n){return Iu(i(n),e)}}function wn(r,e,t){if(!(e in r))return null;const i=On(r[e],ni,t);return function(n){return mb(i(n),e)}}function oC(r,e,t){const i=wn(r,e+"pattern-src",t),n=Rg(r,e+"pattern-offset",t),s=Rg(r,e+"pattern-size",t),o=Id(r,e+"color",t);return function(a){return{src:i(a),offset:n&&n(a),size:s&&s(a),color:o&&o(a)}}}function Ho(r,e,t){if(!(e in r))return null;const i=On(r[e],tt,t);return function(n){const s=i(n);if(typeof s!="boolean")throw new Error(`Expected a boolean for ${e}`);return s}}function Id(r,e,t){if(!(e in r))return null;const i=On(r[e],gt|ni,t);return function(n){return bb(i(n),e)}}function pb(r,e,t){if(!(e in r))return null;const i=On(r[e],In,t);return function(n){return ra(i(n),e)}}function sl(r,e,t){if(!(e in r))return null;const i=On(r[e],In,t);return function(n){const s=ra(i(n),e);if(s.length!==2)throw new Error(`Expected two numbers for ${e}`);return s}}function Rg(r,e,t){if(!(e in r))return null;const i=On(r[e],In,t);return function(n){return yb(i(n),e)}}function nh(r,e,t){if(!(e in r))return null;const i=On(r[e],In|ce,t);return function(n){return cC(i(n),e)}}function ol(r,e){const t=r[e];if(t!==void 0){if(typeof t!="number")throw new Error(`Expected a number for ${e}`);return t}}function aC(r,e){const t=r[e];if(t!==void 0){if(typeof t=="number")return Nt(t);if(!Array.isArray(t))throw new Error(`Expected a number or size array for ${e}`);if(t.length!==2||typeof t[0]!="number"||typeof t[1]!="number")throw new Error(`Expected a number or size array for ${e}`);return t}}function lC(r,e){const t=r[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);return t}}function Sg(r,e){const t=r[e];if(t!==void 0){if(t!=="bottom-left"&&t!=="bottom-right"&&t!=="top-left"&&t!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${e}`);return t}}function Tg(r,e){const t=r[e];if(t!==void 0){if(t!=="pixels"&&t!=="fraction")throw new Error(`Expected pixels or fraction for ${e}`);return t}}function hC(r,e){const t=r[e];if(t!==void 0)return ra(t,e)}function rh(r,e){const t=r[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);if(t!=="declutter"&&t!=="obstacle"&&t!=="none")throw new Error(`Expected declutter, obstacle, or none for ${e}`);return t}}function uC(r,e){const t=r[e];if(t!==void 0)return bb(t,e)}function ra(r,e){if(!Array.isArray(r))throw new Error(`Expected an array for ${e}`);const t=r.length;for(let i=0;i<t;++i)if(typeof r[i]!="number")throw new Error(`Expected an array of numbers for ${e}`);return r}function mb(r,e){if(typeof r!="string")throw new Error(`Expected a string for ${e}`);return r}function Iu(r,e){if(typeof r!="number")throw new Error(`Expected a number for ${e}`);return r}function bb(r,e){if(typeof r=="string")return r;const t=ra(r,e),i=t.length;if(i<3||i>4)throw new Error(`Expected a color with 3 or 4 values for ${e}`);return t}function yb(r,e){const t=ra(r,e);if(t.length!==2)throw new Error(`Expected an array of two numbers for ${e}`);return t}function cC(r,e){return typeof r=="number"?r:yb(r,e)}const Mg={RENDER_ORDER:"renderOrder"};class Pd extends ta{constructor(e){e=e||{};const t=Object.assign({},e);delete t.style,delete t.renderBuffer,delete t.updateWhileAnimating,delete t.updateWhileInteracting,super(t),this.declutter_=e.declutter?String(e.declutter):void 0,this.renderBuffer_=e.renderBuffer!==void 0?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=e.updateWhileAnimating!==void 0?e.updateWhileAnimating:!1,this.updateWhileInteracting_=e.updateWhileInteracting!==void 0?e.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(Mg.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e,t){const i=this.getDeclutter();i in e.declutter||(e.declutter[i]=new eb(9)),this.getRenderer().renderDeclutter(e,t)}setRenderOrder(e){this.set(Mg.RENDER_ORDER,e)}setStyle(e){this.style_=dC(e),this.styleFunction_=e===null?void 0:C_(this.style_),this.changed()}}function dC(r){if(r===void 0)return x_;if(!r)return null;if(typeof r=="function"||r instanceof vt)return r;if(!Array.isArray(r))return xg([r]);if(r.length===0)return[];const e=r.length,t=r[0];if(t instanceof vt){const n=new Array(e);for(let s=0;s<e;++s){const o=r[s];if(!(o instanceof vt))throw new Error("Expected a list of style instances");n[s]=o}return n}if("style"in t){const n=new Array(e);for(let s=0;s<e;++s){const o=r[s];if(!("style"in o))throw new Error("Expected a list of rules with a style property");n[s]=o}return Q_(n)}return xg(r)}class fC extends nd{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){ge()}calculateMatrices2D(e){const t=e.viewState,i=e.coordinateToPixelTransform,n=e.pixelToCoordinateTransform;Si(i,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),Zl(n,i)}forEachFeatureAtCoordinate(e,t,i,n,s,o,a,l){let h;const u=t.viewState;function c(v,S,R,L){return s.call(o,S,v?R:null,L)}const d=u.projection,f=zc(e.slice(),d),g=[[0,0]];if(d.canWrapX()&&n){const v=d.getExtent(),S=Pe(v);g.push([-S,0],[S,0])}const m=t.layerStatesArray,w=m.length,y=[],E=[];for(let v=0;v<g.length;v++)for(let S=w-1;S>=0;--S){const R=m[S],L=R.layer;if(L.hasRenderer()&&Ed(R,u)&&a.call(l,L)){const C=L.getRenderer(),M=L.getSource();if(C&&M){const D=M.getWrapX()?f:e,A=c.bind(null,R.managed);E[0]=D[0]+g[v][0],E[1]=D[1]+g[v][1],h=C.forEachFeatureAtCoordinate(E,t,i,A,y)}if(h)return h}}if(y.length===0)return;const x=1/y.length;return y.forEach((v,S)=>v.distanceSq+=S*x),y.sort((v,S)=>v.distanceSq-S.distanceSq),y.some(v=>h=v.callback(v.feature,v.layer,v.geometry)),h}hasFeatureAtCoordinate(e,t,i,n,s,o){return this.forEachFeatureAtCoordinate(e,t,i,n,Po,this,s,o)!==void 0}getMap(){return this.map_}renderFrame(e){ge()}scheduleExpireIconCache(e){$i.canExpireCache()&&e.postRenderFunctions.push(gC)}}function gC(r,e){$i.expire()}class vb extends rn{constructor(e,t,i,n){super(e),this.inversePixelTransform=t,this.frameState=i,this.context=n}}class pC extends fC{constructor(e){super(e),this.fontChangeListenerKey_=Oe(mn,Ms.PROPERTYCHANGE,e.redrawText.bind(e)),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=eh+" ol-layers";const i=e.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){const i=this.getMap();if(i.hasListener(e)){const n=new vb(e,void 0,t);i.dispatchEvent(n)}}disposeInternal(){We(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(bi.PRECOMPOSE,e);const t=e.layerStatesArray.sort(function(a,l){return a.zIndex-l.zIndex});t.some(a=>a.layer instanceof Pd&&a.layer.getDeclutter())&&(e.declutter={});const n=e.viewState;this.children_.length=0;const s=[];let o=null;for(let a=0,l=t.length;a<l;++a){const h=t[a];e.layerIndex=a;const u=h.layer,c=u.getSourceState();if(!Ed(h,n)||c!="ready"&&c!="undefined"){u.unrender();continue}const d=u.render(e,o);d&&(d!==o&&(this.children_.push(d),o=d),s.push(h))}this.declutter(e,s),h_(this.element_,this.children_),this.dispatchRenderEvent(bi.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}declutter(e,t){for(let i=t.length-1;i>=0;--i){const n=t[i],s=n.layer;s.getDeclutter()&&s.renderDeclutter(e,n)}t.forEach(i=>i.layer.renderDeferred(e))}}class Un extends rn{constructor(e,t){super(e),this.layer=t}}const Bh={LAYERS:"layers"};class Ys extends Gm{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let i=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Bh.LAYERS,this.handleLayersChanged_),i?Array.isArray(i)?i=new Xi(i.slice(),{unique:!0}):Ae(typeof i.getArray=="function","Expected `layers` to be an array or a `Collection`"):i=new Xi(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(We),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(Oe(e,Vt.ADD,this.handleLayersAdd_,this),Oe(e,Vt.REMOVE,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(We);$o(this.listenerKeys_);const t=e.getArray();for(let i=0,n=t.length;i<n;i++){const s=t[i];this.registerLayerListeners_(s),this.dispatchEvent(new Un("addlayer",s))}this.changed()}registerLayerListeners_(e){const t=[Oe(e,Ms.PROPERTYCHANGE,this.handleLayerChange_,this),Oe(e,Ee.CHANGE,this.handleLayerChange_,this)];e instanceof Ys&&t.push(Oe(e,"addlayer",this.handleLayerGroupAdd_,this),Oe(e,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[xe(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new Un("addlayer",e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new Un("removelayer",e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new Un("addlayer",t)),this.changed()}handleLayersRemove_(e){const t=e.element,i=xe(t);this.listenerKeys_[i].forEach(We),delete this.listenerKeys_[i],this.dispatchEvent(new Un("removelayer",t)),this.changed()}getLayers(){return this.get(Bh.LAYERS)}setLayers(e){const t=this.getLayers();if(t){const i=t.getArray();for(let n=0,s=i.length;n<s;++n)this.dispatchEvent(new Un("removelayer",i[n]))}this.set(Bh.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const t=e!==void 0?e:[],i=t.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(t)});const n=this.getLayerState();let s=n.zIndex;!e&&n.zIndex===void 0&&(s=0);for(let o=i,a=t.length;o<a;o++){const l=t[o];l.opacity*=n.opacity,l.visible=l.visible&&n.visible,l.maxResolution=Math.min(l.maxResolution,n.maxResolution),l.minResolution=Math.max(l.minResolution,n.minResolution),l.minZoom=Math.max(l.minZoom,n.minZoom),l.maxZoom=Math.min(l.maxZoom,n.maxZoom),n.extent!==void 0&&(l.extent!==void 0?l.extent=ir(l.extent,n.extent):l.extent=n.extent),l.zIndex===void 0&&(l.zIndex=s)}return t}getSourceState(){return"ready"}}class ss extends rn{constructor(e,t,i){super(e),this.map=t,this.frameState=i!==void 0?i:null}}class Vn extends ss{constructor(e,t,i,n,s,o){super(e,t,s),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=n!==void 0?n:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const Je={SINGLECLICK:"singleclick",CLICK:Ee.CLICK,DBLCLICK:Ee.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Pu={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class mC extends Jo{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=Oe(i,Pu.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=Oe(i,Pu.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(Ee.TOUCHMOVE,this.boundHandleTouchMove_,rb?{passive:!1}:!1)}emulateClick_(e){let t=new Vn(Je.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new Vn(Je.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const i=new Vn(Je.SINGLECLICK,this.map_,e);this.dispatchEvent(i)},250)}updateActivePointers_(e){const t=e,i=t.pointerId;if(t.type==Je.POINTERUP||t.type==Je.POINTERCANCEL){delete this.trackedTouches_[i];for(const n in this.trackedTouches_)if(this.trackedTouches_[n].target!==t.target){delete this.trackedTouches_[n];break}}else(t.type==Je.POINTERDOWN||t.type==Je.POINTERMOVE)&&(this.trackedTouches_[i]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new Vn(Je.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(We),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new Vn(Je.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(Oe(i,Je.POINTERMOVE,this.handlePointerMove_,this),Oe(i,Je.POINTERUP,this.handlePointerUp_,this),Oe(this.element_,Je.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(Oe(this.element_.getRootNode(),Je.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new Vn(Je.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new Vn(Je.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(We(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(Ee.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(We(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(We),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const bn={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},Mt={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},al=1/0;class bC{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,$o(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,i=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const n=this.keyFunction_(i);return delete this.queuedElements_[n],i}enqueue(e){Ae(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const t=this.priorityFunction_(e);return t!=al?(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,i=this.priorities_,n=t.length,s=t[e],o=i[e],a=e;for(;e<n>>1;){const l=this.getLeftChildIndex_(e),h=this.getRightChildIndex_(e),u=h<n&&i[h]<i[l]?h:l;t[e]=t[u],i[e]=i[u],e=u}t[e]=s,i[e]=o,this.siftDown_(a,e)}siftDown_(e,t){const i=this.elements_,n=this.priorities_,s=i[t],o=n[t];for(;t>e;){const a=this.getParentIndex_(t);if(n[a]>o)i[t]=i[a],n[t]=n[a],t=a;else break}i[t]=s,n[t]=o}reprioritize(){const e=this.priorityFunction_,t=this.elements_,i=this.priorities_;let n=0;const s=t.length;let o,a,l;for(a=0;a<s;++a)o=t[a],l=e(o),l==al?delete this.queuedElements_[this.keyFunction_(o)]:(i[n]=l,t[n++]=o);t.length=n,i.length=n,this.heapify_()}}const he={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class yC extends bC{constructor(e,t){super(function(i){return e.apply(null,i)},function(i){return i[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(Ee.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,i=t.getState();if(i===he.LOADED||i===he.ERROR||i===he.EMPTY){i!==he.ERROR&&t.removeEventListener(Ee.CHANGE,this.boundHandleTileChange_);const n=t.getKey();n in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[n],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let i=0,n,s,o;for(;this.tilesLoading_<e&&i<t&&this.getCount()>0;)s=this.dequeue()[0],o=s.getKey(),n=s.getState(),n===he.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++i,s.load())}}function vC(r,e,t,i,n){if(!r||!(t in r.wantedTiles)||!r.wantedTiles[t][e.getKey()])return al;const s=r.viewState.center,o=i[0]-s[0],a=i[1]-s[1];return 65536*Math.log(n)+Math.sqrt(o*o+a*a)/n}class Fd extends Hi{constructor(e){super();const t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){il(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&il(this.element);for(let t=0,i=this.listenerKeys.length;t<i;++t)We(this.listenerKeys[t]);this.listenerKeys.length=0,this.map_=e,e&&((this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==Ls&&this.listenerKeys.push(Oe(e,bn.POSTRENDER,this.render,this)),e.render())}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}}class wC extends Fd{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const t=e.className!==void 0?e.className:"ol-attribution",i=e.tipLabel!==void 0?e.tipLabel:"Attributions",n=e.expandClassName!==void 0?e.expandClassName:t+"-expand",s=e.collapseLabel!==void 0?e.collapseLabel:"›",o=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s,this.collapseLabel_.className=o):this.collapseLabel_=s;const a=e.label!==void 0?e.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=n):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(Ee.CLICK,this.handleClick_.bind(this),!1);const h=t+" "+eh+" "+Ld+(this.collapsed_&&this.collapsible_?" "+yg:"")+(this.collapsible_?"":" ol-uncollapsible"),u=this.element;u.className=h,u.appendChild(this.toggleButton_),u.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=Array.from(new Set(this.getMap().getAllLayers().flatMap(n=>n.getAttributions(e)))),i=!this.getMap().getAllLayers().some(n=>n.getSource()&&n.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(i),t}async updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=await Promise.all(this.collectSourceAttributions_(e).map(n=>zm(()=>n))),i=t.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!ur(t,this.renderedAttributions_)){sb(this.ulElement_);for(let n=0,s=t.length;n<s;++n){const o=document.createElement("li");o.innerHTML=t[n],this.ulElement_.appendChild(o)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(yg),this.collapsed_?bg(this.collapseLabel_,this.label_):bg(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}const EC=wC;class _C extends Fd{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=e.className!==void 0?e.className:"ol-rotate",i=e.label!==void 0?e.label:"⇧",n=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=n,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(n));const s=e.tipLabel?e.tipLabel:"Reset rotation",o=document.createElement("button");o.className=t+"-reset",o.setAttribute("type","button"),o.title=s,o.appendChild(this.label_),o.addEventListener(Ee.CLICK,this.handleClick_.bind(this),!1);const a=t+" "+eh+" "+Ld,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Ea)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const i=t.getRotation();i!==void 0&&(this.duration_>0&&i%(2*Math.PI)!==0?t.animate({rotation:0,duration:this.duration_,easing:Hs}):t.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const i=t.viewState.rotation;if(i!=this.rotation_){const n="rotate("+i+"rad)";if(this.autoHide_){const s=this.element.classList.contains(Ea);!s&&i===0?this.element.classList.add(Ea):s&&i!==0&&this.element.classList.remove(Ea)}this.label_.style.transform=n}this.rotation_=i}}const CC=_C;class xC extends Fd{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=e.className!==void 0?e.className:"ol-zoom",i=e.delta!==void 0?e.delta:1,n=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",s=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",o=e.zoomInLabel!==void 0?e.zoomInLabel:"+",a=e.zoomOutLabel!==void 0?e.zoomOutLabel:"–",l=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",h=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",u=document.createElement("button");u.className=n,u.setAttribute("type","button"),u.title=l,u.appendChild(typeof o=="string"?document.createTextNode(o):o),u.addEventListener(Ee.CLICK,this.handleClick_.bind(this,i),!1);const c=document.createElement("button");c.className=s,c.setAttribute("type","button"),c.title=h,c.appendChild(typeof a=="string"?document.createTextNode(a):a),c.addEventListener(Ee.CLICK,this.handleClick_.bind(this,-i),!1);const d=t+" "+eh+" "+Ld,f=this.element;f.className=d,f.appendChild(u),f.appendChild(c),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const i=this.getMap().getView();if(!i)return;const n=i.getZoom();if(n!==void 0){const s=i.getConstrainedZoom(n+e);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:s,duration:this.duration_,easing:Hs})):i.setZoom(s)}}}const RC=xC;function SC(r){r=r||{};const e=new Xi;return(r.zoom!==void 0?r.zoom:!0)&&e.push(new RC(r.zoomOptions)),(r.rotate!==void 0?r.rotate:!0)&&e.push(new CC(r.rotateOptions)),(r.attribution!==void 0?r.attribution:!0)&&e.push(new EC(r.attributionOptions)),e}const Lg={ACTIVE:"active"};let sa=class extends Hi{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Lg.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(Lg.ACTIVE,e)}setMap(e){this.map_=e}};function TC(r,e,t){const i=r.getCenterInternal();if(i){const n=[i[0]+e[0],i[1]+e[1]];r.animateInternal({duration:t!==void 0?t:250,easing:yE,center:r.getConstrainedCenter(n)})}}function Od(r,e,t,i){const n=r.getZoom();if(n===void 0)return;const s=r.getConstrainedZoom(n+e),o=r.getResolutionForZoom(s);r.getAnimating()&&r.cancelAnimations(),r.animate({resolution:o,anchor:t,duration:i!==void 0?i:250,easing:Hs})}class MC extends sa{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==Je.DBLCLICK){const i=e.originalEvent,n=e.map,s=e.coordinate,o=i.shiftKey?-this.delta_:this.delta_,a=n.getView();Od(a,o,s,this.duration_),i.preventDefault(),t=!0}return!t}}const LC=MC;class oa extends sa{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==Je.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==Je.POINTERUP){const i=this.handleUpEvent(e);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(e.type==Je.POINTERDOWN){const i=this.handleDownEvent(e);this.handlingDownUpSequence=i,t=this.stopDown(i)}else e.type==Je.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function Dd(r){const e=r.length;let t=0,i=0;for(let n=0;n<e;n++)t+=r[n].clientX,i+=r[n].clientY;return{clientX:t/e,clientY:i/e}}function Fu(r){const e=arguments;return function(t){let i=!0;for(let n=0,s=e.length;n<s&&(i=i&&e[n](t),!!i);++n);return i}}const Kk=function(r){const e=r.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},AC=function(r){const e=r.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},IC=function(r){const e=r.map.getTargetElement(),t=r.map.getOwnerDocument().activeElement;return e.contains(t)},wb=function(r){return r.map.getTargetElement().hasAttribute("tabindex")?IC(r):!0},PC=Po,Eb=function(r){const e=r.originalEvent;return e.button==0&&!(s_&&Rd&&e.ctrlKey)},qk=qo,Jk=function(r){return r.type==Je.SINGLECLICK},_b=function(r){const e=r.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},Qk=function(r){const e=r.originalEvent;return!e.altKey&&(Rd?e.metaKey:e.ctrlKey)&&!e.shiftKey},FC=function(r){const e=r.originalEvent;return Rd?e.metaKey:e.ctrlKey},OC=function(r){const e=r.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Cb=function(r){const e=r.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!e.target.isContentEditable},Gh=function(r){const e=r.originalEvent;return Ae(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.pointerType=="mouse"},DC=function(r){const e=r.originalEvent;return Ae(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.isPrimary&&e.button===0};class kC extends oa{constructor(e){super({stopDown:qo}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:Fu(_b,DC);this.condition_=e.onFocusOnly?Fu(wb,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const i=this.targetPointers,n=t.getEventPixel(Dd(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(n[0],n[1]),this.lastCentroid){const s=[this.lastCentroid[0]-n[0],n[1]-this.lastCentroid[1]],a=e.map.getView();uw(s,a.getResolution()),Nc(s,a.getRotation()),a.adjustCenterInternal(s)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=n,this.lastPointersCount_=i.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,i=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const n=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),o=i.getCenterInternal(),a=t.getPixelFromCoordinateInternal(o),l=t.getCoordinateFromPixelInternal([a[0]-n*Math.cos(s),a[1]-n*Math.sin(s)]);i.animateInternal({center:i.getConstrainedCenter(l),duration:500,easing:Hs})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const i=e.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}const NC=kC;class zC extends oa{constructor(e){e=e||{},super({stopDown:qo}),this.condition_=e.condition?e.condition:AC,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!Gh(e))return;const t=e.map,i=t.getView();if(i.getConstraints().rotation===ad)return;const n=t.getSize(),s=e.pixel,o=Math.atan2(n[1]/2-s[1],s[0]-n[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;i.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(e){return Gh(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return Gh(e)&&Eb(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class BC extends nd{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,i="px",n=this.element_.style;n.left=Math.min(e[0],t[0])+i,n.top=Math.min(e[1],t[1])+i,n.width=Math.abs(t[0]-e[0])+i,n.height=Math.abs(t[1]-e[1])+i}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const e=this.startPixel_,t=this.endPixel_,n=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);n[4]=n[0].slice(),this.geometry_?this.geometry_.setCoordinates([n]):this.geometry_=new At([n])}getGeometry(){return this.geometry_}}const _a={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class Hh extends rn{constructor(e,t,i){super(e),this.coordinate=t,this.mapBrowserEvent=i}}class GC extends oa{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.box_=new BC(e.className||"ol-dragbox"),this.minArea_=e.minArea!==void 0?e.minArea:64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition?e.condition:Eb,this.boxEndCondition_=e.boxEndCondition?e.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,i){const n=i[0]-t[0],s=i[1]-t[1];return n*n+s*s>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new Hh(_a.BOXDRAG,e.coordinate,e))}handleUpEvent(e){this.box_.setMap(null);const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new Hh(t?_a.BOXEND:_a.BOXCANCEL,e.coordinate,e)),!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Hh(_a.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}}class HC extends GC{constructor(e){e=e||{};const t=e.condition?e.condition:OC;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const i=this.getMap().getView();let n=this.getGeometry();if(this.out_){const s=i.rotatedExtentForGeometry(n),o=i.getResolutionForExtentInternal(s),a=i.getResolution()/o;n=n.clone(),n.scale(a*a)}i.fitInternal(n,{duration:this.duration_,easing:Hs})}}const VC=HC,pr={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class WC extends sa{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return _b(t)&&Cb(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==Ee.KEYDOWN){const i=e.originalEvent,n=i.key;if(this.condition_(e)&&(n==pr.DOWN||n==pr.LEFT||n==pr.RIGHT||n==pr.UP)){const o=e.map.getView(),a=o.getResolution()*this.pixelDelta_;let l=0,h=0;n==pr.DOWN?h=-a:n==pr.LEFT?l=-a:n==pr.RIGHT?l=a:h=a;const u=[l,h];Nc(u,o.getRotation()),TC(o,u,this.duration_),i.preventDefault(),t=!0}}return!t}}class UC extends sa{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(t){return!FC(t)&&Cb(t)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==Ee.KEYDOWN||e.type==Ee.KEYPRESS){const i=e.originalEvent,n=i.key;if(this.condition_(e)&&(n==="+"||n==="-")){const s=e.map,o=n==="+"?this.delta_:-this.delta_,a=s.getView();Od(a,o,void 0,this.duration_),i.preventDefault(),t=!0}}return!t}}const YC=UC;class jC{constructor(e,t,i){this.decay_=e,this.minVelocity_=t,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let i=t-3;for(;i>0&&this.points_[i+2]>e;)i-=3;const n=this.points_[t+2]-this.points_[i+2];if(n<1e3/60)return!1;const s=this.points_[t]-this.points_[i],o=this.points_[t+1]-this.points_[i+1];return this.angle_=Math.atan2(o,s),this.initialVelocity_=Math.sqrt(s*s+o*o)/n,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}class XC extends sa{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const t=e.condition?e.condition:PC;this.condition_=e.onFocusOnly?Fu(wb,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();if(!e)return;e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(e){if(!this.condition_(e)||e.type!==Ee.WHEEL)return!0;const i=e.map,n=e.originalEvent;n.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.coordinate);let s;if(e.type==Ee.WHEEL&&(s=n.deltaY,n_&&n.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(s/=Sd),n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(s*=40)),s===0)return!1;this.lastDelta_=s;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(s)<4?"trackpad":"wheel");const a=i.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-s/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=o,!1;this.totalDelta_+=s;const l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),l),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let i=-it(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),Od(t,i,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}const $C=XC;class ZC extends oa{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=qo),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0;const i=this.targetPointers[0],n=this.targetPointers[1],s=Math.atan2(n.clientY-i.clientY,n.clientX-i.clientX);if(this.lastAngle_!==void 0){const l=s-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=l}this.lastAngle_=s;const o=e.map,a=o.getView();a.getConstraints().rotation!==ad&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(Dd(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}class KC extends oa{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=qo),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const i=this.targetPointers[0],n=this.targetPointers[1],s=i.clientX-n.clientX,o=i.clientY-n.clientY,a=Math.sqrt(s*s+o*o);this.lastDistance_!==void 0&&(t=this.lastDistance_/a),this.lastDistance_=a;const l=e.map,h=l.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(Dd(this.targetPointers))),l.render(),h.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const i=e.map.getView(),n=this.lastScaleDelta_>1?1:-1;return i.endInteraction(this.duration_,n),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}const qC=KC;function JC(r){r=r||{};const e=new Xi,t=new jC(-.005,.05,100);return(r.altShiftDragRotate!==void 0?r.altShiftDragRotate:!0)&&e.push(new zC),(r.doubleClickZoom!==void 0?r.doubleClickZoom:!0)&&e.push(new LC({delta:r.zoomDelta,duration:r.zoomDuration})),(r.dragPan!==void 0?r.dragPan:!0)&&e.push(new NC({onFocusOnly:r.onFocusOnly,kinetic:t})),(r.pinchRotate!==void 0?r.pinchRotate:!0)&&e.push(new ZC),(r.pinchZoom!==void 0?r.pinchZoom:!0)&&e.push(new qC({duration:r.zoomDuration})),(r.keyboard!==void 0?r.keyboard:!0)&&(e.push(new WC),e.push(new YC({delta:r.zoomDelta,duration:r.zoomDuration}))),(r.mouseWheelZoom!==void 0?r.mouseWheelZoom:!0)&&e.push(new $C({onFocusOnly:r.onFocusOnly,duration:r.zoomDuration})),(r.shiftDragZoom!==void 0?r.shiftDragZoom:!0)&&e.push(new VC({duration:r.zoomDuration})),e}function xb(r){if(r instanceof ta){r.setMapInternal(null);return}r instanceof Ys&&r.getLayers().forEach(xb)}function Rb(r,e){if(r instanceof ta){r.setMapInternal(e);return}if(r instanceof Ys){const t=r.getLayers().getArray();for(let i=0,n=t.length;i<n;++i)Rb(t[i],e)}}let e2=class extends Hi{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=QC(e);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:Sd,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=si(),this.pixelToCoordinateTransform_=si(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=t.controls||SC(),this.interactions=t.interactions||JC({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new yC(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Mt.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(Mt.VIEW,this.handleViewChanged_),this.addChangeListener(Mt.SIZE,this.handleSizeChanged_),this.addChangeListener(Mt.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const i=this;e.view&&!(e.view instanceof _n)&&e.view.then(function(n){i.setView(new _n(n))}),this.controls.addEventListener(Vt.ADD,n=>{n.element.setMap(this)}),this.controls.addEventListener(Vt.REMOVE,n=>{n.element.setMap(null)}),this.interactions.addEventListener(Vt.ADD,n=>{n.element.setMap(this)}),this.interactions.addEventListener(Vt.REMOVE,n=>{n.element.setMap(null)}),this.overlays_.addEventListener(Vt.ADD,n=>{this.addOverlayInternal_(n.element)}),this.overlays_.addEventListener(Vt.REMOVE,n=>{const s=n.element.getId();s!==void 0&&delete this.overlayIdIndex_[s.toString()],n.element.setMap(null)}),this.controls.forEach(n=>{n.setMap(this)}),this.interactions.forEach(n=>{n.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){Rb(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,i){if(!this.frameState_||!this.renderer_)return;const n=this.getCoordinateFromPixelInternal(e);i=i!==void 0?i:{};const s=i.hitTolerance!==void 0?i.hitTolerance:0,o=i.layerFilter!==void 0?i.layerFilter:Po,a=i.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,s,a,t,null,o,null)}getFeaturesAtPixel(e,t){const i=[];return this.forEachFeatureAtPixel(e,function(n){i.push(n)},t),i}getAllLayers(){const e=[];function t(i){i.forEach(function(n){n instanceof Ys?t(n.getLayers()):e.push(n)})}return t(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(e);t=t!==void 0?t:{};const n=t.layerFilter!==void 0?t.layerFilter:Po,s=t.hitTolerance!==void 0?t.hitTolerance:0,o=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,s,o,n,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const i=this.viewport_.getBoundingClientRect(),n=this.getSize(),s=i.width/n[0],o=i.height/n[1],a="changedTouches"in e?e.changedTouches[0]:e;return[(a.clientX-i.left)/s,(a.clientY-i.top)/o]}getTarget(){return this.get(Mt.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return wu(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?nt(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Mt.LAYERGROUP)}setLayers(e){const t=this.getLayerGroup();if(e instanceof Xi){t.setLayers(e);return}const i=t.getLayers();i.clear(),i.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const n=e[t];if(!n.visible)continue;const s=n.layer.getRenderer();if(s&&!s.ready)return!0;const o=n.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(e){const t=pn(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?nt(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Mt.SIZE)}getView(){return this.get(Mt.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,i,n){return vC(this.frameState_,e,t,i,n)}handleBrowserEvent(e,t){t=t||e.type;const i=new Vn(t,this,e);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,i=t.type;if(i===Pu.POINTERDOWN||i===Ee.WHEEL||i===Ee.KEYDOWN){const n=this.getOwnerDocument(),s=this.viewport_.getRootNode?this.viewport_.getRootNode():n,o=t.target;if(this.overlayContainerStopEvent_.contains(o)||!(s===n?n.documentElement:s).contains(o))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){const n=this.getInteractions().getArray().slice();for(let s=n.length-1;s>=0;s--){const o=n[s];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let n=this.maxTilesLoading_,s=n;if(e){const o=e.viewHints;if(o[Ke.ANIMATING]||o[Ke.INTERACTING]){const a=Date.now()-e.time>8;n=a?0:8,s=a?0:2}}t.getTilesLoading()<n&&(t.reprioritize(),t.loadMoreTiles(n,s))}e&&this.renderer_&&!e.animate&&(this.renderComplete_===!0?(this.hasListener(bi.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(bi.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new ss(bn.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new ss(bn.LOADSTART,this,e))));const i=this.postRenderFunctions_;for(let n=0,s=i.length;n<s;++n)i[n](this,e);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let i=0,n=this.targetChangeHandlerKeys_.length;i<n;++i)We(this.targetChangeHandlerKeys_[i]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(Ee.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(Ee.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,il(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const i=this.targetElement_.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.unobserve(i.host),this.setSize(void 0)}const e=this.getTarget(),t=typeof e=="string"?document.getElementById(e):e;if(this.targetElement_=t,!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new pC(this)),this.mapBrowserEventHandler_=new mC(this,this.moveTolerance_);for(const s in Je)this.mapBrowserEventHandler_.addEventListener(Je[s],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(Ee.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(Ee.WHEEL,this.boundHandleBrowserEvent_,rb?{passive:!1}:!1);const i=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.targetChangeHandlerKeys_=[Oe(i,Ee.KEYDOWN,this.handleBrowserEvent,this),Oe(i,Ee.KEYPRESS,this.handleBrowserEvent,this)];const n=t.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.observe(n.host),this.resizeObserver_.observe(t)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(We(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(We(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=Oe(e,Ms.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=Oe(e,Ee.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(We),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new Un("addlayer",e)),this.layerGroupPropertyListenerKeys_=[Oe(e,Ms.PROPERTYCHANGE,this.render,this),Oe(e,Ee.CHANGE,this.render,this),Oe(e,"addlayer",this.handleLayerAdd_,this),Oe(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const n=e[t].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){xb(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),i=this.getView(),n=this.frameState_;let s=null;if(t!==void 0&&fg(t)&&i&&i.isDef()){const o=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=i.getState();if(s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:Mo(a.center,a.resolution,a.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:xe(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;s.nextExtent=Mo(a.nextCenter,a.nextResolution,l,t)}}this.frameState_=s,this.renderer_.renderFrame(s),s&&(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),n&&(!this.previousExtent_||!Ur(this.previousExtent_)&&!zr(s.extent,this.previousExtent_))&&(this.dispatchEvent(new ss(bn.MOVESTART,this,n)),this.previousExtent_=zs(this.previousExtent_)),this.previousExtent_&&!s.viewHints[Ke.ANIMATING]&&!s.viewHints[Ke.INTERACTING]&&!zr(s.extent,this.previousExtent_)&&(this.dispatchEvent(new ss(bn.MOVEEND,this,s)),Zp(s.extent,this.previousExtent_))),this.dispatchEvent(new ss(bn.POSTRENDER,this,s)),this.renderComplete_=this.hasListener(bn.LOADSTART)||this.hasListener(bn.LOADEND)||this.hasListener(bi.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new Un("removelayer",t)),this.set(Mt.LAYERGROUP,e)}setSize(e){this.set(Mt.SIZE,e)}setTarget(e){this.set(Mt.TARGET,e)}setView(e){if(!e||e instanceof _n){this.set(Mt.VIEW,e);return}this.set(Mt.VIEW,new _n);const t=this;e.then(function(i){t.setView(new _n(i))})}updateSize(){const e=this.getTargetElement();let t;if(e){const n=getComputedStyle(e),s=e.offsetWidth-parseFloat(n.borderLeftWidth)-parseFloat(n.paddingLeft)-parseFloat(n.paddingRight)-parseFloat(n.borderRightWidth),o=e.offsetHeight-parseFloat(n.borderTopWidth)-parseFloat(n.paddingTop)-parseFloat(n.paddingBottom)-parseFloat(n.borderBottomWidth);!isNaN(s)&&!isNaN(o)&&(t=[s,o],!fg(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&nm("No map visible because the map container's width or height are 0."))}const i=this.getSize();t&&(!i||!ur(t,i))&&(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(e){const t=this.getView();t&&t.setViewportSize(e)}};function QC(r){let e=null;r.keyboardEventTarget!==void 0&&(e=typeof r.keyboardEventTarget=="string"?document.getElementById(r.keyboardEventTarget):r.keyboardEventTarget);const t={},i=r.layers&&typeof r.layers.getLayers=="function"?r.layers:new Ys({layers:r.layers});t[Mt.LAYERGROUP]=i,t[Mt.TARGET]=r.target,t[Mt.VIEW]=r.view instanceof _n?r.view:new _n;let n;r.controls!==void 0&&(Array.isArray(r.controls)?n=new Xi(r.controls.slice()):(Ae(typeof r.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),n=r.controls));let s;r.interactions!==void 0&&(Array.isArray(r.interactions)?s=new Xi(r.interactions.slice()):(Ae(typeof r.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),s=r.interactions));let o;return r.overlays!==void 0?Array.isArray(r.overlays)?o=new Xi(r.overlays.slice()):(Ae(typeof r.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),o=r.overlays):o=new Xi,{controls:n,interactions:s,keyboardEventTarget:e,overlays:o,values:t}}class Ti extends Hi{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(typeof e.getSimplifiedGeometry=="function"){const t=e;this.setGeometry(t)}else{const t=e;this.setProperties(t)}}clone(){const e=new Ti(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const i=this.getStyle();return i&&e.setStyle(i),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(We(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=Oe(e,Ee.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?ex(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function ex(r){if(typeof r=="function")return r;let e;return Array.isArray(r)?e=r:(Ae(typeof r.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),e=[r]),function(){return e}}function ll(r,e,t,i,n,s,o){let a,l;const h=(t-e)/i;if(h===1)a=e;else if(h===2)a=e,l=n;else if(h!==0){let u=r[e],c=r[e+1],d=0;const f=[0];for(let w=e+i;w<t;w+=i){const y=r[w],E=r[w+1];d+=Math.sqrt((y-u)*(y-u)+(E-c)*(E-c)),f.push(d),u=y,c=E}const g=n*d,m=oE(f,g);m<0?(l=(g-f[-m-2])/(f[-m-1]-f[-m-2]),a=e+(-m-2)*i):a=e+m*i}o=o>1?o:2,s=s||new Array(o);for(let u=0;u<o;++u)s[u]=a===void 0?NaN:l===void 0?r[a+u]:ii(r[a+u],r[a+i+u],l);return s}function Ou(r,e,t,i,n,s){if(t==e)return null;let o;if(n<r[e+i-1])return s?(o=r.slice(e,e+i),o[i-1]=n,o):null;if(r[t-1]<n)return s?(o=r.slice(t-i,t),o[i-1]=n,o):null;if(n==r[e+i-1])return r.slice(e,e+i);let a=e/i,l=t/i;for(;a<l;){const d=a+l>>1;n<r[(d+1)*i-1]?l=d:a=d+1}const h=r[a*i-1];if(n==h)return r.slice((a-1)*i,(a-1)*i+i);const u=r[(a+1)*i-1],c=(n-h)/(u-h);o=[];for(let d=0;d<i-1;++d)o.push(ii(r[(a-1)*i+d],r[a*i+d],c));return o.push(n),o}function tx(r,e,t,i,n,s,o){if(o)return Ou(r,e,t[t.length-1],i,n,s);let a;if(n<r[i-1])return s?(a=r.slice(0,i),a[i-1]=n,a):null;if(r[r.length-1]<n)return s?(a=r.slice(r.length-i),a[i-1]=n,a):null;for(let l=0,h=t.length;l<h;++l){const u=t[l];if(e!=u){if(n<r[e+i-1])return null;if(n<=r[u-1])return Ou(r,e,u,i,n,!1);e=u}}return null}function Sb(r,e,t,i){let n=r[e],s=r[e+1],o=0;for(let a=e+i;a<t;a+=i){const l=r[a],h=r[a+1];o+=Math.sqrt((l-n)*(l-n)+(h-s)*(h-s)),n=l,s=h}return o}class Kt extends cr{constructor(e,t){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendCoordinate(e){Fe(this.flatCoordinates,e),this.changed()}clone(){const e=new Kt(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,n){return n<Wr(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(dd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),gd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,i,n))}forEachSegment(e){return $m(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinateAtM(e,t){return this.layout!="XYM"&&this.layout!="XYZM"?null:(t=t!==void 0?t:!1,Ou(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t))}getCoordinates(){return qn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(e,t){return ll(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,this.stride)}getLength(){return Sb(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(e){const t=[];return t.length=ql(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new Kt(t,"XY")}getType(){return"LineString"}intersectsExtent(e){return Jl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Kl(this.flatCoordinates,0,e,this.stride),this.changed()}}const pe={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Ca=[pe.FILL],Qn=[pe.STROKE],Sr=[pe.BEGIN_PATH],Ag=[pe.CLOSE_PATH];class Tb{drawCustom(e,t,i,n,s){}drawGeometry(e){}setStyle(e){}drawCircle(e,t,i){}drawFeature(e,t,i){}drawGeometryCollection(e,t,i){}drawLineString(e,t,i){}drawMultiLineString(e,t,i){}drawMultiPoint(e,t,i){}drawMultiPolygon(e,t,i){}drawPoint(e,t,i){}drawPolygon(e,t,i){}drawText(e,t,i){}setFillStrokeStyle(e,t){}setImageStyle(e,t){}setTextStyle(e,t){}}class aa extends Tb{constructor(e,t,i,n){super(),this.tolerance=e,this.maxExtent=t,this.pixelRatio=n,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){const t=this.pixelRatio;return t==1?e:e.map(function(i){return i*t})}appendFlatPointCoordinates(e,t){const i=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,s=this.coordinates;let o=s.length;for(let a=0,l=e.length;a<l;a+=t)n[0]=e[a],n[1]=e[a+1],Nr(i,n)&&(s[o++]=n[0],s[o++]=n[1]);return o}appendFlatLineCoordinates(e,t,i,n,s,o){const a=this.coordinates;let l=a.length;const h=this.getBufferedMaxExtent();o&&(t+=n);let u=e[t],c=e[t+1];const d=this.tmpCoordinate_;let f=!0,g,m,w;for(g=t+n;g<i;g+=n)d[0]=e[g],d[1]=e[g+1],w=pu(h,d),w!==m?(f&&(a[l++]=u,a[l++]=c,f=!1),a[l++]=d[0],a[l++]=d[1]):w===ft.INTERSECTING?(a[l++]=d[0],a[l++]=d[1],f=!1):f=!0,u=d[0],c=d[1],m=w;return(s&&f||g===t+n)&&(a[l++]=u,a[l++]=c),l}drawCustomCoordinates_(e,t,i,n,s){for(let o=0,a=i.length;o<a;++o){const l=i[o],h=this.appendFlatLineCoordinates(e,t,l,n,!1,!1);s.push(h),t=l}return t}drawCustom(e,t,i,n,s){this.beginGeometry(e,t,s);const o=e.getType(),a=e.getStride(),l=this.coordinates.length;let h,u,c,d,f;switch(o){case"MultiPolygon":h=e.getOrientedFlatCoordinates(),d=[];const g=e.getEndss();f=0;for(let m=0,w=g.length;m<w;++m){const y=[];f=this.drawCustomCoordinates_(h,f,g[m],a,y),d.push(y)}this.instructions.push([pe.CUSTOM,l,d,e,i,Ru,s]),this.hitDetectionInstructions.push([pe.CUSTOM,l,d,e,n||i,Ru,s]);break;case"Polygon":case"MultiLineString":c=[],h=o=="Polygon"?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),f=this.drawCustomCoordinates_(h,0,e.getEnds(),a,c),this.instructions.push([pe.CUSTOM,l,c,e,i,Fo,s]),this.hitDetectionInstructions.push([pe.CUSTOM,l,c,e,n||i,Fo,s]);break;case"LineString":case"Circle":h=e.getFlatCoordinates(),u=this.appendFlatLineCoordinates(h,0,h.length,a,!1,!1),this.instructions.push([pe.CUSTOM,l,u,e,i,qn,s]),this.hitDetectionInstructions.push([pe.CUSTOM,l,u,e,n||i,qn,s]);break;case"MultiPoint":h=e.getFlatCoordinates(),u=this.appendFlatPointCoordinates(h,a),u>l&&(this.instructions.push([pe.CUSTOM,l,u,e,i,qn,s]),this.hitDetectionInstructions.push([pe.CUSTOM,l,u,e,n||i,qn,s]));break;case"Point":h=e.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),u=this.coordinates.length,this.instructions.push([pe.CUSTOM,l,u,e,i,void 0,s]),this.hitDetectionInstructions.push([pe.CUSTOM,l,u,e,n||i,void 0,s]);break}this.endGeometry(t)}beginGeometry(e,t,i){this.beginGeometryInstruction1_=[pe.BEGIN_GEOMETRY,t,0,e,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[pe.BEGIN_GEOMETRY,t,0,e,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const e=this.hitDetectionInstructions;e.reverse();let t;const i=e.length;let n,s,o=-1;for(t=0;t<i;++t)n=e[t],s=n[0],s==pe.END_GEOMETRY?o=t:s==pe.BEGIN_GEOMETRY&&(n[2]=t,aE(this.hitDetectionInstructions,o,t),o=-1)}setFillStrokeStyle(e,t){const i=this.state;if(e){const n=e.getColor();i.fillPatternScale=n&&typeof n=="object"&&"src"in n?this.pixelRatio:1,i.fillStyle=Zi(n||Wt)}else i.fillStyle=void 0;if(t){const n=t.getColor();i.strokeStyle=Zi(n||ko);const s=t.getLineCap();i.lineCap=s!==void 0?s:Is;const o=t.getLineDash();i.lineDash=o?o.slice():Sn;const a=t.getLineDashOffset();i.lineDashOffset=a||Tn;const l=t.getLineJoin();i.lineJoin=l!==void 0?l:Ps;const h=t.getWidth();i.lineWidth=h!==void 0?h:zo;const u=t.getMiterLimit();i.miterLimit=u!==void 0?u:Do,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(e){const t=e.fillStyle,i=[pe.SET_FILL_STYLE,t];return typeof t!="string"&&i.push(e.fillPatternScale),i}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[pe.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,this.applyPixelRatio(e.lineDash),e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,t){const i=e.fillStyle;(typeof i!="string"||e.currentFillStyle!=i)&&(i!==void 0&&this.instructions.push(t.call(this,e)),e.currentFillStyle=i)}updateStrokeStyle(e,t){const i=e.strokeStyle,n=e.lineCap,s=e.lineDash,o=e.lineDashOffset,a=e.lineJoin,l=e.lineWidth,h=e.miterLimit;(e.currentStrokeStyle!=i||e.currentLineCap!=n||s!=e.currentLineDash&&!ur(e.currentLineDash,s)||e.currentLineDashOffset!=o||e.currentLineJoin!=a||e.currentLineWidth!=l||e.currentMiterLimit!=h)&&(i!==void 0&&t.call(this,e),e.currentStrokeStyle=i,e.currentLineCap=n,e.currentLineDash=s,e.currentLineDashOffset=o,e.currentLineJoin=a,e.currentLineWidth=l,e.currentMiterLimit=h)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const t=[pe.END_GEOMETRY,e];this.instructions.push(t),this.hitDetectionInstructions.push(t)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Zp(this.maxExtent),this.maxLineWidth>0)){const e=this.resolution*(this.maxLineWidth+1)/2;kr(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class ix extends aa{constructor(e,t,i,n){super(e,t,i,n),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,t,i){if(!this.image_||this.maxExtent&&!Nr(this.maxExtent,e.getFlatCoordinates()))return;this.beginGeometry(e,t,i);const n=e.getFlatCoordinates(),s=e.getStride(),o=this.coordinates.length,a=this.appendFlatPointCoordinates(n,s);this.instructions.push([pe.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([pe.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}drawMultiPoint(e,t,i){if(!this.image_)return;this.beginGeometry(e,t,i);const n=e.getFlatCoordinates(),s=[];for(let l=0,h=n.length;l<h;l+=e.getStride())(!this.maxExtent||Nr(this.maxExtent,n.slice(l,l+2)))&&s.push(n[l],n[l+1]);const o=this.coordinates.length,a=this.appendFlatPointCoordinates(s,2);this.instructions.push([pe.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([pe.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,t){const i=e.getAnchor(),n=e.getSize(),s=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=e.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=n[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}const nx=ix;class rx extends aa{constructor(e,t,i,n){super(e,t,i,n)}drawFlatCoordinates_(e,t,i,n){const s=this.coordinates.length,o=this.appendFlatLineCoordinates(e,t,i,n,!1,!1),a=[pe.MOVE_TO_LINE_TO,s,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),i}drawLineString(e,t,i){const n=this.state,s=n.strokeStyle,o=n.lineWidth;if(s===void 0||o===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(e,t,i),this.hitDetectionInstructions.push([pe.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Sn,Tn],Sr);const a=e.getFlatCoordinates(),l=e.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(Qn),this.endGeometry(t)}drawMultiLineString(e,t,i){const n=this.state,s=n.strokeStyle,o=n.lineWidth;if(s===void 0||o===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(e,t,i),this.hitDetectionInstructions.push([pe.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Sn,Tn],Sr);const a=e.getEnds(),l=e.getFlatCoordinates(),h=e.getStride();let u=0;for(let c=0,d=a.length;c<d;++c)u=this.drawFlatCoordinates_(l,u,a[c],h);this.hitDetectionInstructions.push(Qn),this.endGeometry(t)}finish(){const e=this.state;return e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&this.instructions.push(Qn),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(Qn),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(Sr)}}const sx=rx;class ox extends aa{constructor(e,t,i,n){super(e,t,i,n)}drawFlatCoordinatess_(e,t,i,n){const s=this.state,o=s.fillStyle!==void 0,a=s.strokeStyle!==void 0,l=i.length;this.instructions.push(Sr),this.hitDetectionInstructions.push(Sr);for(let h=0;h<l;++h){const u=i[h],c=this.coordinates.length,d=this.appendFlatLineCoordinates(e,t,u,n,!0,!a),f=[pe.MOVE_TO_LINE_TO,c,d];this.instructions.push(f),this.hitDetectionInstructions.push(f),a&&(this.instructions.push(Ag),this.hitDetectionInstructions.push(Ag)),t=u}return o&&(this.instructions.push(Ca),this.hitDetectionInstructions.push(Ca)),a&&(this.instructions.push(Qn),this.hitDetectionInstructions.push(Qn)),t}drawCircle(e,t,i){const n=this.state,s=n.fillStyle,o=n.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([pe.SET_FILL_STYLE,Wt]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([pe.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Sn,Tn]);const a=e.getFlatCoordinates(),l=e.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);const u=[pe.CIRCLE,h];this.instructions.push(Sr,u),this.hitDetectionInstructions.push(Sr,u),n.fillStyle!==void 0&&(this.instructions.push(Ca),this.hitDetectionInstructions.push(Ca)),n.strokeStyle!==void 0&&(this.instructions.push(Qn),this.hitDetectionInstructions.push(Qn)),this.endGeometry(t)}drawPolygon(e,t,i){const n=this.state,s=n.fillStyle,o=n.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([pe.SET_FILL_STYLE,Wt]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([pe.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Sn,Tn]);const a=e.getEnds(),l=e.getOrientedFlatCoordinates(),h=e.getStride();this.drawFlatCoordinatess_(l,0,a,h),this.endGeometry(t)}drawMultiPolygon(e,t,i){const n=this.state,s=n.fillStyle,o=n.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([pe.SET_FILL_STYLE,Wt]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([pe.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Sn,Tn]);const a=e.getEndss(),l=e.getOrientedFlatCoordinates(),h=e.getStride();let u=0;for(let c=0,d=a.length;c<d;++c)u=this.drawFlatCoordinatess_(l,u,a[c],h);this.endGeometry(t)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(e!==0){const t=this.coordinates;for(let i=0,n=t.length;i<n;++i)t[i]=yr(t[i],e)}return super.finish()}setFillStrokeStyles_(){const e=this.state;e.fillStyle!==void 0&&this.updateFillStyle(e,this.createFill),e.strokeStyle!==void 0&&this.updateStrokeStyle(e,this.applyStroke)}}const Ig=ox;function ax(r,e,t,i,n){const s=[];let o=t,a=0,l=e.slice(t,2);for(;a<r&&o+n<i;){const[h,u]=l.slice(-2),c=e[o+n],d=e[o+n+1],f=Math.sqrt((c-h)*(c-h)+(d-u)*(d-u));if(a+=f,a>=r){const g=(r-a+f)/f,m=ii(h,c,g),w=ii(u,d,g);l.push(m,w),s.push(l),l=[m,w],a==r&&(o+=n),a=0}else if(a<r)l.push(e[o+n],e[o+n+1]),o+=n;else{const g=f-a,m=ii(h,c,g/f),w=ii(u,d,g/f);l.push(m,w),s.push(l),l=[m,w],a=0,o+=n}}return a>0&&s.push(l),s}function lx(r,e,t,i,n){let s=t,o=t,a=0,l=0,h=t,u,c,d,f,g,m,w,y,E,x;for(c=t;c<i;c+=n){const v=e[c],S=e[c+1];g!==void 0&&(E=v-g,x=S-m,f=Math.sqrt(E*E+x*x),w!==void 0&&(l+=d,u=Math.acos((w*E+y*x)/(d*f)),u>r&&(l>a&&(a=l,s=h,o=c),l=0,h=c-n)),d=f,w=E,y=x),g=v,m=S}return l+=f,l>a?[h,c]:[s,o]}const hl={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class hx extends aa{constructor(e,t,i,n){super(e,t,i,n),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[Wt]={fillStyle:Wt},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,t,i){const n=this.textFillState_,s=this.textStrokeState_,o=this.textState_;if(this.text_===""||!o||!n&&!s)return;const a=this.coordinates;let l=a.length;const h=e.getType();let u=null,c=e.getStride();if(o.placement==="line"&&(h=="LineString"||h=="MultiLineString"||h=="Polygon"||h=="MultiPolygon")){if(!ht(this.maxExtent,e.getExtent()))return;let d;if(u=e.getFlatCoordinates(),h=="LineString")d=[u.length];else if(h=="MultiLineString")d=e.getEnds();else if(h=="Polygon")d=e.getEnds().slice(0,1);else if(h=="MultiPolygon"){const w=e.getEndss();d=[];for(let y=0,E=w.length;y<E;++y)d.push(w[y][0])}this.beginGeometry(e,t,i);const f=o.repeat,g=f?void 0:o.textAlign;let m=0;for(let w=0,y=d.length;w<y;++w){let E;f?E=ax(f*this.resolution,u,m,d[w],c):E=[u.slice(m,d[w])];for(let x=0,v=E.length;x<v;++x){const S=E[x];let R=0,L=S.length;if(g==null){const M=lx(o.maxAngle,S,0,S.length,2);R=M[0],L=M[1]}for(let M=R;M<L;M+=c)a.push(S[M],S[M+1]);const C=a.length;m=d[w],this.drawChars_(l,C),l=C}}this.endGeometry(t)}else{let d=o.overflow?null:[];switch(h){case"Point":case"MultiPoint":u=e.getFlatCoordinates();break;case"LineString":u=e.getFlatMidpoint();break;case"Circle":u=e.getCenter();break;case"MultiLineString":u=e.getFlatMidpoints(),c=2;break;case"Polygon":u=e.getFlatInteriorPoint(),o.overflow||d.push(u[2]/this.resolution),c=3;break;case"MultiPolygon":const E=e.getFlatInteriorPoints();u=[];for(let x=0,v=E.length;x<v;x+=3)o.overflow||d.push(E[x+2]/this.resolution),u.push(E[x],E[x+1]);if(u.length===0)return;c=2;break}const f=this.appendFlatPointCoordinates(u,c);if(f===l)return;if(d&&(f-l)/2!==u.length/c){let E=l/2;d=d.filter((x,v)=>{const S=a[(E+v)*2]===u[v*c]&&a[(E+v)*2+1]===u[v*c+1];return S||--E,S})}this.saveTextStates_(),(o.backgroundFill||o.backgroundStroke)&&(this.setFillStrokeStyle(o.backgroundFill,o.backgroundStroke),o.backgroundFill&&this.updateFillStyle(this.state,this.createFill),o.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(e,t,i);let g=o.padding;if(g!=Rr&&(o.scale[0]<0||o.scale[1]<0)){let E=o.padding[0],x=o.padding[1],v=o.padding[2],S=o.padding[3];o.scale[0]<0&&(x=-x,S=-S),o.scale[1]<0&&(E=-E,v=-v),g=[E,x,v,S]}const m=this.pixelRatio;this.instructions.push([pe.DRAW_IMAGE,l,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,g==Rr?Rr:g.map(function(E){return E*m}),!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]);const w=1/m,y=this.state.fillStyle;o.backgroundFill&&(this.state.fillStyle=Wt,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([pe.DRAW_IMAGE,l,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[w,w],NaN,this.declutterMode_,this.declutterImageWithText_,g,!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?Wt:this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]),o.backgroundFill&&(this.state.fillStyle=y,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(t)}}saveTextStates_(){const e=this.textStrokeState_,t=this.textState_,i=this.textFillState_,n=this.strokeKey_;e&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));const s=this.textKey_;s in this.textStates||(this.textStates[s]={font:t.font,textAlign:t.textAlign||No,justify:t.justify,textBaseline:t.textBaseline||nl,scale:t.scale});const o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))}drawChars_(e,t){const i=this.textStrokeState_,n=this.textState_,s=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,h=hl[n.textBaseline],u=this.textOffsetY_*l,c=this.text_,d=i?i.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([pe.DRAW_CHARS,e,t,h,n.overflow,a,n.maxAngle,l,u,s,d*l,c,o,1,this.declutterMode_]),this.hitDetectionInstructions.push([pe.DRAW_CHARS,e,t,h,n.overflow,a&&Wt,n.maxAngle,l,u,s,d*l,c,o,1/l,this.declutterMode_])}setTextStyle(e,t){let i,n,s;if(!e)this.text_="";else{const o=e.getFill();o?(n=this.textFillState_,n||(n={},this.textFillState_=n),n.fillStyle=Zi(o.getColor()||Wt)):(n=null,this.textFillState_=n);const a=e.getStroke();if(!a)s=null,this.textStrokeState_=s;else{s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);const g=a.getLineDash(),m=a.getLineDashOffset(),w=a.getWidth(),y=a.getMiterLimit();s.lineCap=a.getLineCap()||Is,s.lineDash=g?g.slice():Sn,s.lineDashOffset=m===void 0?Tn:m,s.lineJoin=a.getLineJoin()||Ps,s.lineWidth=w===void 0?zo:w,s.miterLimit=y===void 0?Do:y,s.strokeStyle=Zi(a.getColor()||ko)}i=this.textState_;const l=e.getFont()||hb;y_(l);const h=e.getScaleArray();i.overflow=e.getOverflow(),i.font=l,i.maxAngle=e.getMaxAngle(),i.placement=e.getPlacement(),i.textAlign=e.getTextAlign(),i.repeat=e.getRepeat(),i.justify=e.getJustify(),i.textBaseline=e.getTextBaseline()||nl,i.backgroundFill=e.getBackgroundFill(),i.backgroundStroke=e.getBackgroundStroke(),i.padding=e.getPadding()||Rr,i.scale=h===void 0?[1,1]:h;const u=e.getOffsetX(),c=e.getOffsetY(),d=e.getRotateWithView(),f=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=u===void 0?0:u,this.textOffsetY_=c===void 0?0:c,this.textRotateWithView_=d===void 0?!1:d,this.textRotation_=f===void 0?0:f,this.strokeKey_=s?(typeof s.strokeStyle=="string"?s.strokeStyle:xe(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=n&&n.fillStyle?typeof n.fillStyle=="string"?n.fillStyle:"|"+xe(n.fillStyle):""}this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}const ux={Circle:Ig,Default:aa,Image:nx,LineString:sx,Polygon:Ig,Text:hx};class Mb{constructor(e,t,i,n){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=n,this.resolution_=i,this.buildersByZIndex_={}}finish(){const e={};for(const t in this.buildersByZIndex_){e[t]=e[t]||{};const i=this.buildersByZIndex_[t];for(const n in i){const s=i[n].finish();e[t][n]=s}}return e}getBuilder(e,t){const i=e!==void 0?e.toString():"0";let n=this.buildersByZIndex_[i];n===void 0&&(n={},this.buildersByZIndex_[i]=n);let s=n[t];if(s===void 0){const o=ux[t];s=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[t]=s}return s}}class cx extends Bm{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.declutterExecutorGroup=null}getFeatures(e){return ge()}getData(e){return null}prepareFrame(e){return ge()}renderFrame(e,t){return ge()}loadedTileCallback(e,t,i){e[t]||(e[t]={}),e[t][i.tileCoord.toString()]=i}createLoadedTileFinder(e,t,i){return(n,s)=>{const o=this.loadedTileCallback.bind(this,i,n);return e.forEachLoadedTile(t,n,s,o)}}forEachFeatureAtCoordinate(e,t,i,n,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;(t.getState()===oe.LOADED||t.getState()===oe.ERROR)&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=oe.LOADED&&t!=oe.ERROR&&e.addEventListener(Ee.CHANGE,this.boundHandleImageChange_),t==oe.IDLE&&(e.load(),t=e.getState()),t==oe.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}renderDeferred(e){}disposeInternal(){delete this.layer_,super.disposeInternal()}}class kd{constructor(){K(this,"pushMethodArgs_",(...e)=>(this.instructions_[this.zIndex+this.offset_].push(e),this));this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(CanvasRenderingContext2D.prototype,{get:(e,t)=>{if(typeof Tu()[t]=="function")return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(t),this.pushMethodArgs_},set:(e,t,i)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(t,i),!0)})}getContext(){return this.context_}draw(e){this.instructions_.forEach(t=>{for(let i=0,n=t.length;i<n;i+=2){const s=t[i],o=t[i+1];if(typeof e[s]=="function")e[s](...o);else{if(typeof o=="function"){e[s]=o(e);continue}e[s]=o}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const Pg=[];let os=null;function dx(){os=mt(1,1,void 0,{willReadFrequently:!0})}class Nd extends cx{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=si(),this.pixelTransform=si(),this.inversePixelTransform=si(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(e,t,i){os||dx(),os.clearRect(0,0,1,1);let n;try{os.drawImage(e,t,i,1,1,0,0,1,1),n=os.getImageData(0,0,1,1).data}catch{return os=null,null}return n}getBackground(e){let i=this.getLayer().getBackground();return typeof i=="function"&&(i=i(e.viewState.resolution)),i||void 0}useContainer(e,t,i){const n=this.getLayer().getClassName();let s,o;if(e&&e.className===n&&(!i||e&&e.style.backgroundColor&&ur(Rn(e.style.backgroundColor),Rn(i)))){const a=e.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===t?(this.container=e,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){s=document.createElement("div"),s.className=n;let a=s.style;a.position="absolute",a.width="100%",a.height="100%",o=mt();const l=o.canvas;s.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=s,this.context=o}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(e,t,i){const n=lr(i),s=Dl(i),o=Ol(i),a=Fl(i);nt(t.coordinateToPixelTransform,n),nt(t.coordinateToPixelTransform,s),nt(t.coordinateToPixelTransform,o),nt(t.coordinateToPixelTransform,a);const l=this.inversePixelTransform;nt(l,n),nt(l,s),nt(l,o),nt(l,a),e.save(),e.beginPath(),e.moveTo(Math.round(n[0]),Math.round(n[1])),e.lineTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}dispatchRenderEvent_(e,t,i){const n=this.getLayer();if(n.hasListener(e)){const s=new vb(e,this.inversePixelTransform,i,t);n.dispatchEvent(s)}}preRender(e,t){this.frameState=t,!t.declutter&&this.dispatchRenderEvent_(bi.PRERENDER,e,t)}postRender(e,t){t.declutter||this.dispatchRenderEvent_(bi.POSTRENDER,e,t)}renderDeferredInternal(e){}getRenderContext(e){return e.declutter&&!this.deferredContext_&&(this.deferredContext_=new kd),e.declutter?this.deferredContext_.getContext():this.context}renderDeferred(e){e.declutter&&(this.dispatchRenderEvent_(bi.PRERENDER,this.context,e),e.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(e),this.dispatchRenderEvent_(bi.POSTRENDER,this.context,e))}getRenderTransform(e,t,i,n,s,o,a){const l=s/2,h=o/2,u=n/t,c=-u,d=-e[0]+a,f=-e[1];return Si(this.tempTransform,l,h,u,c,-i,d,f)}disposeInternal(){delete this.frameState,super.disposeInternal()}}function fx(r,e,t,i,n,s,o,a,l,h,u,c){let d=r[e],f=r[e+1],g=0,m=0,w=0,y=0;function E(){g=d,m=f,e+=i,d=r[e],f=r[e+1],y+=w,w=Math.sqrt((d-g)*(d-g)+(f-m)*(f-m))}do E();while(e<t-i&&y+w<s);let x=w===0?0:(s-y)/w;const v=ii(g,d,x),S=ii(m,f,x),R=e-i,L=y,C=s+a*l(h,n,u);for(;e<t-i&&y+w<C;)E();x=w===0?0:(C-y)/w;const M=ii(g,d,x),D=ii(m,f,x);let A;if(c){const O=[v,S,M,D];ud(O,0,4,2,c,O,O),A=O[0]>O[2]}else A=v>M;const k=Math.PI,V=[],I=R+i===e;e=R,w=0,y=L,d=r[e],f=r[e+1];let B;if(I){E(),B=Math.atan2(f-m,d-g),A&&(B+=B>0?-k:k);const O=(M+v)/2,H=(D+S)/2;return V[0]=[O,H,(C-s)/2,B,n],V}n=n.replace(/\n/g," ");for(let O=0,H=n.length;O<H;){E();let j=Math.atan2(f-m,d-g);if(A&&(j+=j>0?-k:k),B!==void 0){let W=j-B;if(W+=W>k?-2*k:W<-k?2*k:0,Math.abs(W)>o)return null}B=j;const q=O;let J=0;for(;O<H;++O){const W=A?H-O-1:O,me=a*l(h,n[W],u);if(e+i<t&&y+w<s+J+me/2)break;J+=me}if(O===q)continue;const ee=A?n.substring(H-q,H-O):n.substring(q,O);x=w===0?0:(s+J/2-y)/w;const te=ii(g,d,x),Ce=ii(m,f,x);V.push([te,Ce,J/2,j,ee]),s+=J}return V}const Kr=oi(),zn=[],cn=[],dn=[],Bn=[];function Fg(r){return r[3].declutterBox}const Og=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function Vh(r,e){return e==="start"?e=Og.test(r)?"right":"left":e==="end"&&(e=Og.test(r)?"left":"right"),hl[e]}function gx(r,e,t){return t>0&&r.push(`
`,""),r.push(e,""),r}class px{constructor(e,t,i,n,s){this.overlaps=i,this.pixelRatio=t,this.resolution=e,this.alignAndScaleFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=si(),this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=s?new kd:null}getZIndexContext(){return this.zIndexContext_}createLabel(e,t,i,n){const s=e+t+i+n;if(this.labels_[s])return this.labels_[s];const o=n?this.strokeStates[n]:null,a=i?this.fillStates[i]:null,l=this.textStates[t],h=this.pixelRatio,u=[l.scale[0]*h,l.scale[1]*h],c=Array.isArray(e),d=l.justify?hl[l.justify]:Vh(Array.isArray(e)?e[0]:e,l.textAlign||No),f=n&&o.lineWidth?o.lineWidth:0,g=c?e:e.split(`
`).reduce(gx,[]),{width:m,height:w,widths:y,heights:E,lineWidths:x}=w_(l,g),v=m+f,S=[],R=(v+2)*u[0],L=(w+f)*u[1],C={width:R<0?Math.floor(R):Math.ceil(R),height:L<0?Math.floor(L):Math.ceil(L),contextInstructions:S};(u[0]!=1||u[1]!=1)&&S.push("scale",u),n&&(S.push("strokeStyle",o.strokeStyle),S.push("lineWidth",f),S.push("lineCap",o.lineCap),S.push("lineJoin",o.lineJoin),S.push("miterLimit",o.miterLimit),S.push("setLineDash",[o.lineDash]),S.push("lineDashOffset",o.lineDashOffset)),i&&S.push("fillStyle",a.fillStyle),S.push("textBaseline","middle"),S.push("textAlign","center");const M=.5-d;let D=d*v+M*f;const A=[],k=[];let V=0,I=0,B=0,O=0,H;for(let j=0,q=g.length;j<q;j+=2){const J=g[j];if(J===`
`){I+=V,V=0,D=d*v+M*f,++O;continue}const ee=g[j+1]||l.font;ee!==H&&(n&&A.push("font",ee),i&&k.push("font",ee),H=ee),V=Math.max(V,E[B]);const te=[J,D+M*y[B]+d*(y[B]-x[O]),.5*(f+V)+I];D+=y[B],n&&A.push("strokeText",te),i&&k.push("fillText",te),++B}return Array.prototype.push.apply(S,A),Array.prototype.push.apply(S,k),this.labels_[s]=C,C}replayTextBackground_(e,t,i,n,s,o,a){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,i),e.lineTo.apply(e,n),e.lineTo.apply(e,s),e.lineTo.apply(e,t),o&&(this.alignAndScaleFill_=o[2],this.fill_(e)),a&&(this.setStrokeStyle_(e,a),e.stroke())}calculateImageOrLabelDimensions_(e,t,i,n,s,o,a,l,h,u,c,d,f,g,m,w){a*=d[0],l*=d[1];let y=i-a,E=n-l;const x=s+h>e?e-h:s,v=o+u>t?t-u:o,S=g[3]+x*d[0]+g[1],R=g[0]+v*d[1]+g[2],L=y-g[3],C=E-g[0];(m||c!==0)&&(zn[0]=L,Bn[0]=L,zn[1]=C,cn[1]=C,cn[0]=L+S,dn[0]=cn[0],dn[1]=C+R,Bn[1]=dn[1]);let M;return c!==0?(M=Si(si(),i,n,1,1,c,-i,-n),nt(M,zn),nt(M,cn),nt(M,dn),nt(M,Bn),_i(Math.min(zn[0],cn[0],dn[0],Bn[0]),Math.min(zn[1],cn[1],dn[1],Bn[1]),Math.max(zn[0],cn[0],dn[0],Bn[0]),Math.max(zn[1],cn[1],dn[1],Bn[1]),Kr)):_i(Math.min(L,L+S),Math.min(C,C+R),Math.max(L,L+S),Math.max(C,C+R),Kr),f&&(y=Math.round(y),E=Math.round(E)),{drawImageX:y,drawImageY:E,drawImageW:x,drawImageH:v,originX:h,originY:u,declutterBox:{minX:Kr[0],minY:Kr[1],maxX:Kr[2],maxY:Kr[3],value:w},canvasTransform:M,scale:d}}replayImageOrLabel_(e,t,i,n,s,o,a){const l=!!(o||a),h=n.declutterBox,u=a?a[2]*n.scale[0]/2:0;return h.minX-u<=t[0]&&h.maxX+u>=0&&h.minY-u<=t[1]&&h.maxY+u>=0&&(l&&this.replayTextBackground_(e,zn,cn,dn,Bn,o,a),E_(e,n.canvasTransform,s,i,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0}fill_(e){const t=this.alignAndScaleFill_;if(t){const i=nt(this.renderedTransform_,[0,0]),n=512*this.pixelRatio;e.save(),e.translate(i[0]%n,i[1]%n),t!==1&&e.scale(t,t),e.rotate(this.viewRotation_)}e.fill(),t&&e.restore()}setStrokeStyle_(e,t){e.strokeStyle=t[1],e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.lineDashOffset=t[7],e.setLineDash(t[6])}drawLabelWithPointPlacement_(e,t,i,n){const s=this.textStates[t],o=this.createLabel(e,t,n,i),a=this.strokeStates[i],l=this.pixelRatio,h=Vh(Array.isArray(e)?e[0]:e,s.textAlign||No),u=hl[s.textBaseline||nl],c=a&&a.lineWidth?a.lineWidth:0,d=o.width/l-2*s.scale[0],f=h*d+2*(.5-h)*c,g=u*o.height/l+2*(.5-u)*c;return{label:o,anchorX:f,anchorY:g}}execute_(e,t,i,n,s,o,a,l){const h=this.zIndexContext_;let u;this.pixelCoordinates_&&ur(i,this.renderedTransform_)?u=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),u=rr(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),vE(this.renderedTransform_,i));let c=0;const d=n.length;let f=0,g,m,w,y,E,x,v,S,R,L,C,M,D,A=0,k=0,V=null,I=null;const B=this.coordinateCache_,O=this.viewRotation_,H=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,j={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:O},q=this.instructions!=n||this.overlaps?0:200;let J,ee,te,Ce;for(;c<d;){const W=n[c];switch(W[0]){case pe.BEGIN_GEOMETRY:J=W[1],Ce=W[3],J.getGeometry()?a!==void 0&&!ht(a,Ce.getExtent())?c=W[2]+1:++c:c=W[2],h&&(h.zIndex=W[4]);break;case pe.BEGIN_PATH:A>q&&(this.fill_(e),A=0),k>q&&(e.stroke(),k=0),!A&&!k&&(e.beginPath(),E=NaN,x=NaN),++c;break;case pe.CIRCLE:f=W[1];const Ie=u[f],Re=u[f+1],Se=u[f+2],Ue=u[f+3],Ye=Se-Ie,Bt=Ue-Re,Pt=Math.sqrt(Ye*Ye+Bt*Bt);e.moveTo(Ie+Pt,Re),e.arc(Ie,Re,Pt,0,2*Math.PI,!0),++c;break;case pe.CLOSE_PATH:e.closePath(),++c;break;case pe.CUSTOM:f=W[1],g=W[2];const _t=W[3],Ft=W[4],Mi=W[5];j.geometry=_t,j.feature=J,c in B||(B[c]=[]);const ot=B[c];Mi?Mi(u,f,g,2,ot):(ot[0]=u[f],ot[1]=u[f+1],ot.length=2),h&&(h.zIndex=W[6]),Ft(ot,j),++c;break;case pe.DRAW_IMAGE:f=W[1],g=W[2],R=W[3],m=W[4],w=W[5];let Ct=W[6];const Li=W[7],Wi=W[8],bt=W[9],ut=W[10];let Be=W[11];const qe=W[12];let ct=W[13];y=W[14]||"declutter";const je=W[15];if(!R&&W.length>=20){L=W[19],C=W[20],M=W[21],D=W[22];const at=this.drawLabelWithPointPlacement_(L,C,M,D);R=at.label,W[3]=R;const an=W[23];m=(at.anchorX-an)*this.pixelRatio,W[4]=m;const Rt=W[24];w=(at.anchorY-Rt)*this.pixelRatio,W[5]=w,Ct=R.height,W[6]=Ct,ct=R.width,W[13]=ct}let Qt;W.length>25&&(Qt=W[25]);let _,p,b;W.length>17?(_=W[16],p=W[17],b=W[18]):(_=Rr,p=!1,b=!1),ut&&H?Be+=O:!ut&&!H&&(Be-=O);let T=0;for(;f<g;f+=2){if(Qt&&Qt[T++]<ct/this.pixelRatio)continue;const at=this.calculateImageOrLabelDimensions_(R.width,R.height,u[f],u[f+1],ct,Ct,m,w,Wi,bt,Be,qe,s,_,p||b,J),an=[e,t,R,at,Li,p?V:null,b?I:null];if(l){let Rt,Ot,ui;if(je){const et=g-f;if(!je[et]){je[et]={args:an,declutterMode:y};continue}const Dt=je[et];Rt=Dt.args,Ot=Dt.declutterMode,delete je[et],ui=Fg(Rt)}let ln,hn;if(Rt&&(Ot!=="declutter"||!l.collides(ui))&&(ln=!0),(y!=="declutter"||!l.collides(at.declutterBox))&&(hn=!0),Ot==="declutter"&&y==="declutter"){const et=ln&&hn;ln=et,hn=et}ln&&(Ot!=="none"&&l.insert(ui),this.replayImageOrLabel_.apply(this,Rt)),hn&&(y!=="none"&&l.insert(at.declutterBox),this.replayImageOrLabel_.apply(this,an))}else this.replayImageOrLabel_.apply(this,an)}++c;break;case pe.DRAW_CHARS:const F=W[1],G=W[2],U=W[3],z=W[4];D=W[5];const Q=W[6],ie=W[7],de=W[8];M=W[9];const re=W[10];L=W[11],C=W[12];const dt=[W[13],W[13]];y=W[14]||"declutter";const xt=this.textStates[C],hi=xt.font,kn=[xt.scale[0]*ie,xt.scale[1]*ie];let ei;hi in this.widths_?ei=this.widths_[hi]:(ei={},this.widths_[hi]=ei);const Xr=Sb(u,F,G,2),fr=Math.abs(kn[0])*wg(hi,L,ei);if(z||fr<=Xr){const at=this.textStates[C].textAlign,an=(Xr-fr)*Vh(L,at),Rt=fx(u,F,G,2,L,an,Q,Math.abs(kn[0]),wg,hi,ei,H?0:this.viewRotation_);e:if(Rt){const Ot=[];let ui,ln,hn,et,Dt;if(M)for(ui=0,ln=Rt.length;ui<ln;++ui){Dt=Rt[ui],hn=Dt[4],et=this.createLabel(hn,C,"",M),m=Dt[2]+(kn[0]<0?-re:re),w=U*et.height+(.5-U)*2*re*kn[1]/kn[0]-de;const un=this.calculateImageOrLabelDimensions_(et.width,et.height,Dt[0],Dt[1],et.width,et.height,m,w,0,0,Dt[3],dt,!1,Rr,!1,J);if(l&&y==="declutter"&&l.collides(un.declutterBox))break e;Ot.push([e,t,et,un,1,null,null])}if(D)for(ui=0,ln=Rt.length;ui<ln;++ui){Dt=Rt[ui],hn=Dt[4],et=this.createLabel(hn,C,D,""),m=Dt[2],w=U*et.height-de;const un=this.calculateImageOrLabelDimensions_(et.width,et.height,Dt[0],Dt[1],et.width,et.height,m,w,0,0,Dt[3],dt,!1,Rr,!1,J);if(l&&y==="declutter"&&l.collides(un.declutterBox))break e;Ot.push([e,t,et,un,1,null,null])}l&&y!=="none"&&l.load(Ot.map(Fg));for(let un=0,Bv=Ot.length;un<Bv;++un)this.replayImageOrLabel_.apply(this,Ot[un])}}++c;break;case pe.END_GEOMETRY:if(o!==void 0){J=W[1];const at=o(J,Ce);if(at)return at}++c;break;case pe.FILL:q?A++:this.fill_(e),++c;break;case pe.MOVE_TO_LINE_TO:for(f=W[1],g=W[2],ee=u[f],te=u[f+1],v=ee+.5|0,S=te+.5|0,(v!==E||S!==x)&&(e.moveTo(ee,te),E=v,x=S),f+=2;f<g;f+=2)ee=u[f],te=u[f+1],v=ee+.5|0,S=te+.5|0,(f==g-2||v!==E||S!==x)&&(e.lineTo(ee,te),E=v,x=S);++c;break;case pe.SET_FILL_STYLE:V=W,this.alignAndScaleFill_=W[2],A&&(this.fill_(e),A=0,k&&(e.stroke(),k=0)),e.fillStyle=W[1],++c;break;case pe.SET_STROKE_STYLE:I=W,k&&(e.stroke(),k=0),this.setStrokeStyle_(e,W),++c;break;case pe.STROKE:q?k++:e.stroke(),++c;break;default:++c;break}}A&&this.fill_(e),k&&e.stroke()}execute(e,t,i,n,s,o){this.viewRotation_=n,this.execute_(e,t,i,this.instructions,s,void 0,void 0,o)}executeHitDetection(e,t,i,n,s){return this.viewRotation_=i,this.execute_(e,[e.canvas.width,e.canvas.height],t,this.hitDetectionInstructions,!0,n,s)}}const bo=["Polygon","Circle","LineString","Image","Text","Default"],ul=["Image","Text"],mx=bo.filter(r=>!ul.includes(r));class Lb{constructor(e,t,i,n,s,o,a){this.maxExtent_=e,this.overlaps_=n,this.pixelRatio_=i,this.resolution_=t,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=si(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(s,a)}clip(e,t){const i=this.getClipCoords(t);e.beginPath(),e.moveTo(i[0],i[1]),e.lineTo(i[2],i[3]),e.lineTo(i[4],i[5]),e.lineTo(i[6],i[7]),e.clip()}createExecutors_(e,t){for(const i in e){let n=this.executorsByZIndex_[i];n===void 0&&(n={},this.executorsByZIndex_[i]=n);const s=e[i];for(const o in s){const a=s[o];n[o]=new px(this.resolution_,this.pixelRatio_,this.overlaps_,a,t)}}}hasExecutors(e){for(const t in this.executorsByZIndex_){const i=this.executorsByZIndex_[t];for(let n=0,s=e.length;n<s;++n)if(e[n]in i)return!0}return!1}forEachFeatureAtCoordinate(e,t,i,n,s,o){n=Math.round(n);const a=n*2+1,l=Si(this.hitDetectionTransform_,n+.5,n+.5,1/t,-1/t,-i,-e[0],-e[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=mt(a,a,void 0,{willReadFrequently:!0}));const u=this.hitDetectionContext_;u.canvas.width!==a||u.canvas.height!==a?(u.canvas.width=a,u.canvas.height=a):h||u.clearRect(0,0,a,a);let c;this.renderBuffer_!==void 0&&(c=oi(),fo(c,e),kr(c,t*(this.renderBuffer_+n),c));const d=bx(n);let f;function g(S,R){const L=u.getImageData(0,0,a,a).data;for(let C=0,M=d.length;C<M;C++)if(L[d[C]]>0){if(!o||f!=="Image"&&f!=="Text"||o.includes(S)){const D=(d[C]-3)/4,A=n-D%a,k=n-(D/a|0),V=s(S,R,A*A+k*k);if(V)return V}u.clearRect(0,0,a,a);break}}const m=Object.keys(this.executorsByZIndex_).map(Number);m.sort(qi);let w,y,E,x,v;for(w=m.length-1;w>=0;--w){const S=m[w].toString();for(E=this.executorsByZIndex_[S],y=bo.length-1;y>=0;--y)if(f=bo[y],x=E[f],x!==void 0&&(v=x.executeHitDetection(u,l,i,g,c),v))return v}}getClipCoords(e){const t=this.maxExtent_;if(!t)return null;const i=t[0],n=t[1],s=t[2],o=t[3],a=[i,n,i,o,s,o,s,n];return rr(a,0,8,2,e,a),a}isEmpty(){return Dr(this.executorsByZIndex_)}execute(e,t,i,n,s,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(qi),o=o||bo;let h,u,c,d,f,g;for(a&&l.reverse(),h=0,u=l.length;h<u;++h){const m=l[h].toString();for(f=this.executorsByZIndex_[m],c=0,d=o.length;c<d;++c){const w=o[c];if(g=f[w],g!==void 0){const y=a===null?void 0:g.getZIndexContext(),E=y?y.getContext():e,x=this.maxExtent_&&w!=="Image"&&w!=="Text";if(x&&(E.save(),this.clip(E,i)),g.execute(E,t,i,n,s,a),x&&E.restore(),y){y.offset();const v=l[h];this.deferredZIndexContexts_[v]||(this.deferredZIndexContexts_[v]=[]),this.deferredZIndexContexts_[v].push(y)}}}}this.renderedContext_=e}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const e=this.deferredZIndexContexts_,t=Object.keys(e).map(Number).sort(qi);for(let i=0,n=t.length;i<n;++i)e[t[i]].forEach(s=>{s.draw(this.renderedContext_),s.clear()})}}const Wh={};function bx(r){if(Wh[r]!==void 0)return Wh[r];const e=r*2+1,t=r*r,i=new Array(t+1);for(let s=0;s<=r;++s)for(let o=0;o<=r;++o){const a=s*s+o*o;if(a>t)break;let l=i[a];l||(l=[],i[a]=l),l.push(((r+s)*e+(r+o))*4+3),s>0&&l.push(((r-s)*e+(r+o))*4+3),o>0&&(l.push(((r+s)*e+(r-o))*4+3),s>0&&l.push(((r-s)*e+(r-o))*4+3))}const n=[];for(let s=0,o=i.length;s<o;++s)i[s]&&n.push(...i[s]);return Wh[r]=n,n}class yx extends Tb{constructor(e,t,i,n,s,o,a){super(),this.context_=e,this.pixelRatio_=t,this.extent_=i,this.transform_=n,this.transformRotation_=n?kl(Math.atan2(n[1],n[0]),10):0,this.viewRotation_=s,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=si()}drawImages_(e,t,i,n){if(!this.image_)return;const s=rr(e,t,i,n,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let u=0,c=s.length;u<c;u+=2){const d=s[u]-this.imageAnchorX_,f=s[u+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const g=d+this.imageAnchorX_,m=f+this.imageAnchorY_;Si(a,g,m,1,1,h,-g,-m),o.save(),o.transform.apply(o,a),o.translate(g,m),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,f,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(e,t,i,n){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const s=rr(e,t,i,n,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);t<i;t+=n){const l=s[t]+this.textOffsetX_,h=s[t+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(l-this.textOffsetX_,h-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,l,h),this.textFillState_&&o.fillText(this.text_,l,h))}}moveToLineTo_(e,t,i,n,s){const o=this.context_,a=rr(e,t,i,n,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;s&&(l-=2);for(let h=2;h<l;h+=2)o.lineTo(a[h],a[h+1]);return s&&o.closePath(),i}drawRings_(e,t,i,n){for(let s=0,o=i.length;s<o;++s)t=this.moveToLineTo_(e,t,i[s],n,!0);return t}drawCircle(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ht(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=xE(e,this.transform_,this.pixelCoordinates_),i=t[2]-t[0],n=t[3]-t[1],s=Math.sqrt(i*i+n*n),o=this.context_;o.beginPath(),o.arc(t[0],t[1],s,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e);break}}drawFeature(e,t){const i=t.getGeometryFunction()(e);i&&(this.setStyle(t),this.drawGeometry(i))}drawGeometryCollection(e){const t=e.getGeometriesArray();for(let i=0,n=t.length;i<n;++i)this.drawGeometry(t[i])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ht(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(i,0,i.length,e.getStride(),!1),t.stroke()}if(this.text_!==""){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getExtent();if(ht(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,n=e.getFlatCoordinates();let s=0;const o=e.getEnds(),a=e.getStride();i.beginPath();for(let l=0,h=o.length;l<h;++l)s=this.moveToLineTo_(n,s,o[l],a,!1);i.stroke()}if(this.text_!==""){const i=e.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ht(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ht(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getOrientedFlatCoordinates();let n=0;const s=e.getEndss(),o=e.getStride();t.beginPath();for(let a=0,l=s.length;a<l;++a){const h=s[a];n=this.drawRings_(i,n,h,o)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}}setContextFillState_(e){const t=this.context_,i=this.contextFillState_;i?i.fillStyle!=e.fillStyle&&(i.fillStyle=e.fillStyle,t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const t=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=e.lineCap&&(i.lineCap=e.lineCap,t.lineCap=e.lineCap),ur(i.lineDash,e.lineDash)||t.setLineDash(i.lineDash=e.lineDash),i.lineDashOffset!=e.lineDashOffset&&(i.lineDashOffset=e.lineDashOffset,t.lineDashOffset=e.lineDashOffset),i.lineJoin!=e.lineJoin&&(i.lineJoin=e.lineJoin,t.lineJoin=e.lineJoin),i.lineWidth!=e.lineWidth&&(i.lineWidth=e.lineWidth,t.lineWidth=e.lineWidth),i.miterLimit!=e.miterLimit&&(i.miterLimit=e.miterLimit,t.miterLimit=e.miterLimit),i.strokeStyle!=e.strokeStyle&&(i.strokeStyle=e.strokeStyle,t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const t=this.context_,i=this.contextTextState_,n=e.textAlign?e.textAlign:No;i?(i.font!=e.font&&(i.font=e.font,t.font=e.font),i.textAlign!=n&&(i.textAlign=n,t.textAlign=n),i.textBaseline!=e.textBaseline&&(i.textBaseline=e.textBaseline,t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=n,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:n,textBaseline:e.textBaseline})}setFillStrokeStyle(e,t){if(!e)this.fillState_=null;else{const i=e.getColor();this.fillState_={fillStyle:Zi(i||Wt)}}if(!t)this.strokeState_=null;else{const i=t.getColor(),n=t.getLineCap(),s=t.getLineDash(),o=t.getLineDashOffset(),a=t.getLineJoin(),l=t.getWidth(),h=t.getMiterLimit(),u=s||Sn;this.strokeState_={lineCap:n!==void 0?n:Is,lineDash:this.pixelRatio_===1?u:u.map(c=>c*this.pixelRatio_),lineDashOffset:(o||Tn)*this.pixelRatio_,lineJoin:a!==void 0?a:Ps,lineWidth:(l!==void 0?l:zo)*this.pixelRatio_,miterLimit:h!==void 0?h:Do,strokeStyle:Zi(i||ko)}}}setImageStyle(e){let t;if(!e||!(t=e.getSize())){this.image_=null;return}const i=e.getPixelRatio(this.pixelRatio_),n=e.getAnchor(),s=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*i,this.imageAnchorY_=n[1]*i,this.imageHeight_=t[1]*i,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const o=e.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/i,o[1]*this.pixelRatio_/i],this.imageWidth_=t[0]*i}setTextStyle(e){if(!e)this.text_="";else{const t=e.getFill();if(!t)this.textFillState_=null;else{const f=t.getColor();this.textFillState_={fillStyle:Zi(f||Wt)}}const i=e.getStroke();if(!i)this.textStrokeState_=null;else{const f=i.getColor(),g=i.getLineCap(),m=i.getLineDash(),w=i.getLineDashOffset(),y=i.getLineJoin(),E=i.getWidth(),x=i.getMiterLimit();this.textStrokeState_={lineCap:g!==void 0?g:Is,lineDash:m||Sn,lineDashOffset:w||Tn,lineJoin:y!==void 0?y:Ps,lineWidth:E!==void 0?E:zo,miterLimit:x!==void 0?x:Do,strokeStyle:Zi(f||ko)}}const n=e.getFont(),s=e.getOffsetX(),o=e.getOffsetY(),a=e.getRotateWithView(),l=e.getRotation(),h=e.getScaleArray(),u=e.getText(),c=e.getTextAlign(),d=e.getTextBaseline();this.textState_={font:n!==void 0?n:hb,textAlign:c!==void 0?c:No,textBaseline:d!==void 0?d:nl},this.text_=u!==void 0?Array.isArray(u)?u.reduce((f,g,m)=>f+=m%2?" ":g,""):u:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const zd=yx,ri=.5;function Ab(r,e,t,i,n,s,o,a,l){const h=l?Hc(n):n,u=r[0]*ri,c=r[1]*ri,d=mt(u,c);d.imageSmoothingEnabled=!1;const f=d.canvas,g=new zd(d,ri,n,null,o,a,l?Nl(mw(),l):null),m=t.length,w=Math.floor((256*256*256-1)/m),y={};for(let x=1;x<=m;++x){const v=t[x-1],S=v.getStyleFunction()||i;if(!S)continue;let R=S(v,s);if(!R)continue;Array.isArray(R)||(R=[R]);const C=(x*w).toString(16).padStart(7,"#00000");for(let M=0,D=R.length;M<D;++M){const A=R[M],k=A.getGeometryFunction()(v);if(!k||!ht(h,k.getExtent()))continue;const V=A.clone(),I=V.getFill();I&&I.setColor(C);const B=V.getStroke();B&&(B.setColor(C),B.setLineDash(null)),V.setText(void 0);const O=A.getImage();if(O){const J=O.getImageSize();if(!J)continue;const ee=mt(J[0],J[1],void 0,{alpha:!1}),te=ee.canvas;ee.fillStyle=C,ee.fillRect(0,0,te.width,te.height),V.setImage(new jr({img:te,anchor:O.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:O.getOrigin(),opacity:1,size:O.getSize(),scale:O.getScale(),rotation:O.getRotation(),rotateWithView:O.getRotateWithView()}))}const H=V.getZIndex()||0;let j=y[H];j||(j={},y[H]=j,j.Polygon=[],j.Circle=[],j.LineString=[],j.Point=[]);const q=k.getType();if(q==="GeometryCollection"){const J=k.getGeometriesArrayRecursive();for(let ee=0,te=J.length;ee<te;++ee){const Ce=J[ee];j[Ce.getType().replace("Multi","")].push(Ce,V)}}else j[q.replace("Multi","")].push(k,V)}}const E=Object.keys(y).map(Number).sort(qi);for(let x=0,v=E.length;x<v;++x){const S=y[E[x]];for(const R in S){const L=S[R];for(let C=0,M=L.length;C<M;C+=2){g.setStyle(L[C+1]);for(let D=0,A=e.length;D<A;++D)g.setTransform(e[D]),g.drawGeometry(L[C])}}}return d.getImageData(0,0,f.width,f.height)}function Ib(r,e,t){const i=[];if(t){const n=Math.floor(Math.round(r[0])*ri),s=Math.floor(Math.round(r[1])*ri),o=(it(n,0,t.width-1)+it(s,0,t.height-1)*t.width)*4,a=t.data[o],l=t.data[o+1],u=t.data[o+2]+256*(l+256*a),c=Math.floor((256*256*256-1)/e.length);u&&u%c===0&&i.push(e[u/c-1])}return i}const vx=.5,Pb={Point:Tx,LineString:xx,Polygon:Lx,MultiPoint:Mx,MultiLineString:Rx,MultiPolygon:Sx,GeometryCollection:Cx,Circle:Ex};function wx(r,e){return parseInt(xe(r),10)-parseInt(xe(e),10)}function cl(r,e){const t=Fb(r,e);return t*t}function Fb(r,e){return vx*r/e}function Ex(r,e,t,i,n){const s=t.getFill(),o=t.getStroke();if(s||o){const l=r.getBuilder(t.getZIndex(),"Circle");l.setFillStrokeStyle(s,o),l.drawCircle(e,i,n)}const a=t.getText();if(a&&a.getText()){const l=r.getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i)}}function dl(r,e,t,i,n,s,o,a){const l=[],h=t.getImage();if(h){let d=!0;const f=h.getImageState();f==oe.LOADED||f==oe.ERROR?d=!1:f==oe.IDLE&&h.load(),d&&l.push(h.ready())}const u=t.getFill();u&&u.loading()&&l.push(u.ready());const c=l.length>0;return c&&Promise.all(l).then(()=>n(null)),_x(r,e,t,i,s,o,a),c}function _x(r,e,t,i,n,s,o){const a=t.getGeometryFunction()(e);if(!a)return;const l=a.simplifyTransformed(i,n);if(t.getRenderer())Ob(r,l,t,e,o);else{const u=Pb[l.getType()];u(r,l,t,e,o,s)}}function Ob(r,e,t,i,n){if(e.getType()=="GeometryCollection"){const o=e.getGeometries();for(let a=0,l=o.length;a<l;++a)Ob(r,o[a],t,i,n);return}r.getBuilder(t.getZIndex(),"Default").drawCustom(e,i,t.getRenderer(),t.getHitDetectionRenderer(),n)}function Cx(r,e,t,i,n,s){const o=e.getGeometriesArray();let a,l;for(a=0,l=o.length;a<l;++a){const h=Pb[o[a].getType()];h(r,o[a],t,i,n,s)}}function xx(r,e,t,i,n){const s=t.getStroke();if(s){const a=r.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawLineString(e,i,n)}const o=t.getText();if(o&&o.getText()){const a=r.getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,i,n)}}function Rx(r,e,t,i,n){const s=t.getStroke();if(s){const a=r.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawMultiLineString(e,i,n)}const o=t.getText();if(o&&o.getText()){const a=r.getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,i,n)}}function Sx(r,e,t,i,n){const s=t.getFill(),o=t.getStroke();if(o||s){const l=r.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawMultiPolygon(e,i,n)}const a=t.getText();if(a&&a.getText()){const l=r.getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i,n)}}function Tx(r,e,t,i,n,s){const o=t.getImage(),a=t.getText(),l=a&&a.getText(),h=s&&o&&l?{}:void 0;if(o){if(o.getImageState()!=oe.LOADED)return;const u=r.getBuilder(t.getZIndex(),"Image");u.setImageStyle(o,h),u.drawPoint(e,i,n)}if(l){const u=r.getBuilder(t.getZIndex(),"Text");u.setTextStyle(a,h),u.drawText(e,i,n)}}function Mx(r,e,t,i,n,s){const o=t.getImage(),a=o&&o.getOpacity()!==0,l=t.getText(),h=l&&l.getText(),u=s&&a&&h?{}:void 0;if(a){if(o.getImageState()!=oe.LOADED)return;const c=r.getBuilder(t.getZIndex(),"Image");c.setImageStyle(o,u),c.drawMultiPoint(e,i,n)}if(h){const c=r.getBuilder(t.getZIndex(),"Text");c.setTextStyle(l,u),c.drawText(e,i,n)}}function Lx(r,e,t,i,n){const s=t.getFill(),o=t.getStroke();if(s||o){const l=r.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawPolygon(e,i,n)}const a=t.getText();if(a&&a.getText()){const l=r.getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i,n)}}class Ax extends Nd{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=oi(),this.wrappedRenderedExtent_=oi(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(e,t,i){const n=t.extent,s=t.viewState,o=s.center,a=s.resolution,l=s.projection,h=s.rotation,u=l.getExtent(),c=this.getLayer().getSource(),d=this.getLayer().getDeclutter(),f=t.pixelRatio,g=t.viewHints,m=!(g[Ke.ANIMATING]||g[Ke.INTERACTING]),w=this.context,y=Math.round(Pe(n)/a*f),E=Math.round(st(n)/a*f),x=c.getWrapX()&&l.canWrapX(),v=x?Pe(u):null,S=x?Math.ceil((n[2]-u[2])/v)+1:1;let R=x?Math.floor((n[0]-u[0])/v):0;do{const L=this.getRenderTransform(o,a,h,f,y,E,R*v);e.execute(w,[w.canvas.width,w.canvas.height],L,h,m,i===void 0?bo:i?ul:mx,i?d&&t.declutter[d]:void 0)}while(++R<S)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=mt(this.context.canvas.width,this.context.canvas.height,Pg))}resetDrawContext_(){if(this.opacity_!==1){const e=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=e,ia(this.context),Pg.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(e){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,e,!0)}renderDeferredInternal(e){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.resetDrawContext_())}renderFrame(e,t){const i=e.pixelRatio,n=e.layerStatesArray[e.layerIndex];this.opacity_=n.opacity;const s=e.extent,o=e.viewState.resolution,a=Math.round(Pe(s)/o*i),l=Math.round(st(s)/o*i);Si(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/i,1/i,0,-a/2,-l/2),Zl(this.inversePixelTransform,this.pixelTransform);const h=hd(this.pixelTransform);this.useContainer(t,h,this.getBackground(e));const u=this.context,c=u.canvas,d=this.replayGroup_;let f=d&&!d.isEmpty();if(!f&&!(this.getLayer().hasListener(bi.PRERENDER)||this.getLayer().hasListener(bi.POSTRENDER)))return null;c.width!=a||c.height!=l?(c.width=a,c.height=l,c.style.transform!==h&&(c.style.transform=h)):this.containerReused||u.clearRect(0,0,a,l),this.setDrawContext_(),this.preRender(u,e);const g=e.viewState;g.projection;let m=!1;if(f&&n.extent&&this.clipping){const w=Cn(n.extent);f=ht(w,e.extent),m=f&&!mi(w,e.extent),m&&this.clipUnrotated(u,e,w)}return f&&this.renderWorlds(d,e,this.getLayer().getDeclutter()?!1:void 0),m&&u.restore(),this.postRender(u,e),this.renderedRotation_!==g.rotation&&(this.renderedRotation_=g.rotation,this.hitDetectionImageData_=null),e.declutter||this.resetDrawContext_(),this.container}getFeatures(e){return new Promise(t=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=[this.context.canvas.width,this.context.canvas.height];nt(this.pixelTransform,i);const n=this.renderedCenter_,s=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),u=[],c=i[0]*ri,d=i[1]*ri;u.push(this.getRenderTransform(n,s,o,ri,c,d,0).slice());const f=h.getSource(),g=a.getExtent();if(f.getWrapX()&&a.canWrapX()&&!mi(g,l)){let m=l[0];const w=Pe(g);let y=0,E;for(;m<g[0];)--y,E=w*y,u.push(this.getRenderTransform(n,s,o,ri,c,d,E).slice()),m+=w;for(y=0,m=l[2];m>g[2];)++y,E=w*y,u.push(this.getRenderTransform(n,s,o,ri,c,d,E).slice()),m-=w}this.hitDetectionImageData_=Ab(i,u,this.renderedFeatures_,h.getStyleFunction(),l,s,o,cl(s,this.renderedPixelRatio_),null)}t(Ib(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,i,n,s){if(!this.replayGroup_)return;const o=t.viewState.resolution,a=t.viewState.rotation,l=this.getLayer(),h={},u=function(g,m,w){const y=xe(g),E=h[y];if(E){if(E!==!0&&w<E.distanceSq){if(w===0)return h[y]=!0,s.splice(s.lastIndexOf(E),1),n(g,l,m);E.geometry=m,E.distanceSq=w}}else{if(w===0)return h[y]=!0,n(g,l,m);s.push(h[y]={feature:g,layer:l,geometry:m,distanceSq:w,callback:n})}};let c;const d=[this.replayGroup_],f=this.getLayer().getDeclutter();return d.some(g=>c=g.forEachFeatureAtCoordinate(e,o,a,i,u,f&&t.declutter[f]?t.declutter[f].all().map(m=>m.value):null)),c}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),i=t.getSource();if(!i)return!1;const n=e.viewHints[Ke.ANIMATING],s=e.viewHints[Ke.INTERACTING],o=t.getUpdateWhileAnimating(),a=t.getUpdateWhileInteracting();if(this.ready&&!o&&n||!a&&s)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=e.extent,h=e.viewState,u=h.projection,c=h.resolution,d=e.pixelRatio,f=t.getRevision(),g=t.getRenderBuffer();let m=t.getRenderOrder();m===void 0&&(m=wx);const w=h.center.slice(),y=kr(l,g*c),E=y.slice(),x=[y.slice()],v=u.getExtent();if(i.getWrapX()&&u.canWrapX()&&!mi(v,e.extent)){const I=Pe(v),B=Math.max(Pe(y)/2,I);y[0]=v[0]-B,y[2]=v[2]+B,zc(w,u);const O=Qp(x[0],u);O[0]<v[0]&&O[2]<v[2]?x.push([O[0]+I,O[1],O[2]+I,O[3]]):O[0]>v[0]&&O[2]>v[2]&&x.push([O[0]-I,O[1],O[2]-I,O[3]])}if(this.ready&&this.renderedResolution_==c&&this.renderedRevision_==f&&this.renderedRenderOrder_==m&&mi(this.wrappedRenderedExtent_,y))return ur(this.renderedExtent_,E)||(this.hitDetectionImageData_=null,this.renderedExtent_=E),this.renderedCenter_=w,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const S=new Mb(Fb(c,d),y,c,d);let R;for(let I=0,B=x.length;I<B;++I)i.loadFeatures(x[I],c,u);const L=cl(c,d);let C=!0;const M=(I,B)=>{let O;const H=I.getStyleFunction()||t.getStyleFunction();if(H&&(O=H(I,c)),O){const j=this.renderFeature(I,L,O,S,R,this.getLayer().getDeclutter(),B);C=C&&!j}},D=Hc(y),A=i.getFeaturesInExtent(D);m&&A.sort(m);for(let I=0,B=A.length;I<B;++I)M(A[I],I);this.renderedFeatures_=A,this.ready=C;const k=S.finish(),V=new Lb(y,c,d,i.getOverlaps(),k,t.getRenderBuffer(),!!e.declutter);return this.renderedResolution_=c,this.renderedRevision_=f,this.renderedRenderOrder_=m,this.renderedExtent_=E,this.wrappedRenderedExtent_=y,this.renderedCenter_=w,this.renderedProjection_=u,this.renderedPixelRatio_=d,this.replayGroup_=V,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,i,n,s,o,a){if(!i)return!1;let l=!1;if(Array.isArray(i))for(let h=0,u=i.length;h<u;++h)l=dl(n,e,i[h],t,this.boundHandleStyleImageChange_,s,o,a)||l;else l=dl(n,e,i,t,this.boundHandleStyleImageChange_,s,o,a);return l}}class i2 extends Pd{constructor(e){super(e)}createRenderer(){return new Ax(this)}}class Dg{constructor(e){this.rbush_=new eb(e),this.items_={}}insert(e,t){const i={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(i),this.items_[xe(t)]=i}load(e,t){const i=new Array(t.length);for(let n=0,s=t.length;n<s;n++){const o=e[n],a=t[n],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};i[n]=l,this.items_[xe(a)]=l}this.rbush_.load(i)}remove(e){const t=xe(e),i=this.items_[t];return delete this.items_[t],this.rbush_.remove(i)!==null}update(e,t){const i=this.items_[xe(t)],n=[i.minX,i.minY,i.maxX,i.maxY];zr(n,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(n){return n.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let i;for(let n=0,s=e.length;n<s;n++)if(i=t(e[n]),i)return i;return i}isEmpty(){return Dr(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return _i(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}}class Bd extends cr{constructor(e,t,i){super(),i!==void 0&&t===void 0?this.setFlatCoordinates(i,e):(t=t||0,this.setCenterAndRadius(e,t,i))}clone(){const e=new Bd(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,n){const s=this.flatCoordinates,o=e-s[0],a=t-s[1],l=o*o+a*a;if(l<n){if(l===0)for(let h=0;h<this.stride;++h)i[h]=s[h];else{const h=this.getRadius()/Math.sqrt(l);i[0]=s[0]+h*o,i[1]=s[1]+h*a;for(let u=2;u<this.stride;++u)i[u]=s[u]}return i.length=this.stride,l}return n}containsXY(e,t){const i=this.flatCoordinates,n=e-i[0],s=t-i[1];return n*n+s*s<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,i=t[this.stride]-t[0];return _i(t[0]-i,t[1]-i,t[0]+i,t[1]+i,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(ht(e,t)){const i=this.getCenter();return e[0]<=i[0]&&e[2]>=i[0]||e[1]<=i[1]&&e[3]>=i[1]?!0:Dc(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,i=this.flatCoordinates[t]-this.flatCoordinates[0],n=e.slice();n[t]=n[0]+i;for(let s=1;s<t;++s)n[t+s]=e[s];this.setFlatCoordinates(this.layout,n),this.changed()}setCenterAndRadius(e,t,i){this.setLayout(i,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const n=this.flatCoordinates;let s=Vm(n,0,e,this.stride);n[s++]=n[0]+t;for(let o=1,a=this.stride;o<a;++o)n[s++]=n[o];n.length=s,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const i=this.getCenter(),n=this.getStride();this.setCenter(ud(i,0,i.length,n,e,t,i)),this.changed()}}Bd.prototype.transform;class fl extends cd{constructor(e){super(),this.geometries_=e,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(We),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const e=this.geometries_;for(let t=0,i=e.length;t<i;++t)this.changeEventsKeys_.push(Oe(e[t],Ee.CHANGE,this.changed,this))}clone(){const e=new fl(Uh(this.geometries_));return e.applyProperties(this),e}closestPointXY(e,t,i,n){if(n<Wr(this.getExtent(),e,t))return n;const s=this.geometries_;for(let o=0,a=s.length;o<a;++o)n=s[o].closestPointXY(e,t,i,n);return n}containsXY(e,t){const i=this.geometries_;for(let n=0,s=i.length;n<s;++n)if(i[n].containsXY(e,t))return!0;return!1}computeExtent(e){zs(e);const t=this.geometries_;for(let i=0,n=t.length;i<n;++i)qp(e,t[i].getExtent());return e}getGeometries(){return Uh(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[];const t=this.geometries_;for(let i=0,n=t.length;i<n;++i)t[i].getType()===this.getType()?e=e.concat(t[i].getGeometriesArrayRecursive()):e.push(t[i]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=[],i=this.geometries_;let n=!1;for(let s=0,o=i.length;s<o;++s){const a=i[s],l=a.getSimplifiedGeometry(e);t.push(l),l!==a&&(n=!0)}return n?new fl(t):(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getType(){return"GeometryCollection"}intersectsExtent(e){const t=this.geometries_;for(let i=0,n=t.length;i<n;++i)if(t[i].intersectsExtent(e))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(e,t){const i=this.geometries_;for(let n=0,s=i.length;n<s;++n)i[n].rotate(e,t);this.changed()}scale(e,t,i){i||(i=en(this.getExtent()));const n=this.geometries_;for(let s=0,o=n.length;s<o;++s)n[s].scale(e,t,i);this.changed()}setGeometries(e){this.setGeometriesArray(Uh(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){const t=this.geometries_;for(let i=0,n=t.length;i<n;++i)t[i].applyTransform(e);this.changed()}translate(e,t){const i=this.geometries_;for(let n=0,s=i.length;n<s;++n)i[n].translate(e,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function Uh(r){return r.map(e=>e.clone())}const sr=fl;class Bi extends cr{constructor(e,t,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,t);else if(t!==void 0&&i)this.setFlatCoordinates(t,e),this.ends_=i;else{const n=e,s=[],o=[];for(let l=0,h=n.length;l<h;++l){const u=n[l];Fe(s,u.getFlatCoordinates()),o.push(s.length)}const a=n.length===0?this.getLayout():n[0].getLayout();this.setFlatCoordinates(a,s),this.ends_=o}}appendLineString(e){Fe(this.flatCoordinates,e.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Bi(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,n){return n<Wr(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(fd(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),pd(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,i,n))}getCoordinateAtM(e,t,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(t=t!==void 0?t:!1,i=i!==void 0?i:!1,tx(this.flatCoordinates,0,this.ends_,this.stride,e,t,i))}getCoordinates(){return Fo(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new Kt(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){const e=this.flatCoordinates,t=this.ends_,i=this.layout,n=[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=t[o],h=new Kt(e.slice(s,l),i);n.push(h),s=l}return n}getFlatMidpoints(){const e=[],t=this.flatCoordinates;let i=0;const n=this.ends_,s=this.stride;for(let o=0,a=n.length;o<a;++o){const l=n[o],h=ll(t,i,l,s,.5);Fe(e,h),i=l}return e}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=Um(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,i),new Bi(t,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(e){return PE(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=ea(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}class dr extends cr{constructor(e,t){super(),t&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendPoint(e){Fe(this.flatCoordinates,e.getFlatCoordinates()),this.changed()}clone(){const e=new dr(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,n){if(n<Wr(this.getExtent(),e,t))return n;const s=this.flatCoordinates,o=this.stride;for(let a=0,l=s.length;a<l;a+=o){const h=Lr(e,t,s[a],s[a+1]);if(h<n){n=h;for(let u=0;u<o;++u)i[u]=s[a+u];i.length=o}}return n}getCoordinates(){return qn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){const t=this.flatCoordinates.length/this.stride;return e<0||t<=e?null:new Ni(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){const e=this.flatCoordinates,t=this.layout,i=this.stride,n=[];for(let s=0,o=e.length;s<o;s+=i){const a=new Ni(e.slice(s,s+i),t);n.push(a)}return n}getType(){return"MultiPoint"}intersectsExtent(e){const t=this.flatCoordinates,i=this.stride;for(let n=0,s=t.length;n<s;n+=i){const o=t[n],a=t[n+1];if(Fc(e,o,a))return!0}return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Kl(this.flatCoordinates,0,e,this.stride),this.changed()}}function Db(r,e,t,i){const n=[];let s=oi();for(let o=0,a=t.length;o<a;++o){const l=t[o];s=Oc(r,e,l[0],i),n.push((s[0]+s[2])/2,(s[1]+s[3])/2),e=l[l.length-1]}return n}class Pn extends cr{constructor(e,t,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(e[0])){const n=e,s=[],o=[];for(let a=0,l=n.length;a<l;++a){const h=n[a],u=s.length,c=h.getEnds();for(let d=0,f=c.length;d<f;++d)c[d]+=u;Fe(s,h.getFlatCoordinates()),o.push(c)}t=n.length===0?this.getLayout():n[0].getLayout(),e=s,i=o}t!==void 0&&i?(this.setFlatCoordinates(t,e),this.endss_=i):this.setCoordinates(e,t)}appendPolygon(e){let t;if(!this.flatCoordinates)this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;Fe(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let n=0,s=t.length;n<s;++n)t[n]+=i}this.endss_.push(t),this.changed()}clone(){const e=this.endss_.length,t=new Array(e);for(let n=0;n<e;++n)t[n]=this.endss_[n].slice();const i=new Pn(this.flatCoordinates.slice(),this.layout,t);return i.applyProperties(this),i}closestPointXY(e,t,i,n){return n<Wr(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(RE(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),SE(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,i,n))}containsXY(e,t){return IE(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)}getArea(){return LE(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),Su(t,0,this.endss_,this.stride,e)):t=this.flatCoordinates,Ru(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=Db(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Xm(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new dr(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;qm(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=Su(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=ME(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,i),new Pn(t,"XY",i)}getPolygon(e){if(e<0||this.endss_.length<=e)return null;let t;if(e===0)t=0;else{const s=this.endss_[e-1];t=s[s.length-1]}const i=this.endss_[e].slice(),n=i[i.length-1];if(t!==0)for(let s=0,o=i.length;s<o;++s)i[s]-=t;return new At(this.flatCoordinates.slice(t,n),this.layout,i)}getPolygons(){const e=this.layout,t=this.flatCoordinates,i=this.endss_,n=[];let s=0;for(let o=0,a=i.length;o<a;++o){const l=i[o].slice(),h=l[l.length-1];if(s!==0)for(let c=0,d=l.length;c<d;++c)l[c]-=s;const u=new At(t.slice(s,h),e,l);n.push(u),s=h}return n}getType(){return"MultiPolygon"}intersectsExtent(e){return FE(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=Wm(this.flatCoordinates,0,e,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const n=i[i.length-1];this.flatCoordinates.length=n.length===0?0:n[n.length-1]}this.changed()}}const kg=si();class Fs{constructor(e,t,i,n,s,o){this.styleFunction,this.extent_,this.id_=o,this.type_=e,this.flatCoordinates_=t,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i||null,this.properties_=s,this.squaredTolerance_,this.stride_=n,this.simplifiedGeometry_}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?Kp(this.flatCoordinates_):Oc(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const e=en(this.getExtent());this.flatInteriorPoints_=yd(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const e=Jm(this.flatCoordinates_,this.ends_),t=Db(this.flatCoordinates_,0,e,2);this.flatInteriorPoints_=Xm(this.flatCoordinates_,0,e,2,t)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=ll(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let t=0;const i=this.ends_;for(let n=0,s=i.length;n<s;++n){const o=i[n],a=ll(e,t,o,2,.5);Fe(this.flatMidpoints_,a),t=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(e){return this}simplifyTransformed(e,t){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){e=we(e);const t=e.getExtent(),i=e.getWorldExtent();if(t&&i){const n=st(i)/st(t);Si(kg,i[0],i[3],n,-n,0,0,0),rr(this.flatCoordinates_,0,this.flatCoordinates_.length,2,kg,this.flatCoordinates_)}}applyTransform(e){e(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var e;return new Fs(this.type_,this.flatCoordinates_.slice(),(e=this.ends_)==null?void 0:e.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=Nm((e,t)=>{if(e===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),t&&this.simplifiedGeometry_.applyTransform(t);const i=this.simplifiedGeometry_.getFlatCoordinates();let n;switch(this.type_){case"LineString":i.length=ql(i,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,e,i,0),n=[i.length];break;case"MultiLineString":n=[],i.length=Um(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,e,i,0,n);break;case"Polygon":n=[],i.length=md(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(e),i,0,n);break}return n&&(this.simplifiedGeometry_=new Fs(this.type_,i,n,2,this.properties_,this.id_)),this.squaredTolerance_=e,this.simplifiedGeometry_}),this}}Fs.prototype.getFlatCoordinates=Fs.prototype.getOrientedFlatCoordinates;const Pi=Fs;class Gd extends Hi{constructor(e){super(),this.projection=we(e.projection),this.attributions_=Ng(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible!==void 0?e.attributionsCollapsible:!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(i,n){t.viewResolver=i,t.viewRejector=n})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=Ng(e),this.changed()}setState(e){this.state_=e,this.changed()}}function Ng(r){return r?Array.isArray(r)?function(e){return r}:typeof r=="function"?r:function(e){return[r]}:null}const ci={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function Ix(r,e){return[[-1/0,-1/0,1/0,1/0]]}function n2(r,e){return[r]}let Px=!1;function Fx(r,e,t,i,n,s,o){const a=new XMLHttpRequest;a.open("GET",typeof r=="function"?r(t,i,n):r,!0),e.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=Px,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const h=e.getType();let u;h=="json"?u=JSON.parse(a.responseText):h=="text"?u=a.responseText:h=="xml"?(u=a.responseXML,u||(u=new DOMParser().parseFromString(a.responseText,"application/xml"))):h=="arraybuffer"&&(u=a.response),u?s(e.readFeatures(u,{extent:t,featureProjection:n}),e.readProjection(u)):o()}else o()},a.onerror=o,a.send()}function zg(r,e){return function(t,i,n,s,o){const a=this;Fx(r,e,t,i,n,function(l,h){a.addFeatures(l),s!==void 0&&s(l)},o||Ls)}}class Gn extends rn{constructor(e,t,i){super(e),this.feature=t,this.features=i}}class Ox extends Gd{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=Ls,this.format_=e.format,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&(Ae(this.format_,"`format` must be set when `url` is set"),this.loader_=zg(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:Ix;const t=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=t?new Dg:null,this.loadedExtentsRtree_=new Dg,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,n;Array.isArray(e.features)?n=e.features:e.features&&(i=e.features,n=i.getArray()),!t&&i===void 0&&(i=new Xi(n)),n!==void 0&&this.addFeaturesInternal(n),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=xe(e);if(!this.addToIndex_(t,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(t,e);const i=e.getGeometry();if(i){const n=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new Gn(ci.ADDFEATURE,e))}setupChangeEvents_(e,t){t instanceof Pi||(this.featureChangeKeys_[e]=[Oe(t,Ee.CHANGE,this.handleFeatureChange_,this),Oe(t,Ms.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(e,t){let i=!0;if(t.getId()!==void 0){const n=String(t.getId());if(!(n in this.idIndex_))this.idIndex_[n]=t;else if(t instanceof Pi){const s=this.idIndex_[n];s instanceof Pi?Array.isArray(s)?s.push(t):this.idIndex_[n]=[s,t]:i=!1}else i=!1}return i&&(Ae(!(e in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[e]=t),i}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],i=[],n=[];for(let s=0,o=e.length;s<o;s++){const a=e[s],l=xe(a);this.addToIndex_(l,a)&&i.push(a)}for(let s=0,o=i.length;s<o;s++){const a=i[s],l=xe(a);this.setupChangeEvents_(l,a);const h=a.getGeometry();if(h){const u=h.getExtent();t.push(u),n.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(t,n),this.hasListener(ci.ADDFEATURE))for(let s=0,o=i.length;s<o;s++)this.dispatchEvent(new Gn(ci.ADDFEATURE,i[s]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(ci.ADDFEATURE,function(i){t||(t=!0,e.push(i.feature),t=!1)}),this.addEventListener(ci.REMOVEFEATURE,function(i){t||(t=!0,e.remove(i.feature),t=!1)}),e.addEventListener(Vt.ADD,i=>{t||(t=!0,this.addFeature(i.element),t=!1)}),e.addEventListener(Vt.REMOVE,i=>{t||(t=!0,this.removeFeature(i.element),t=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(We);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const i=n=>{this.removeFeatureInternal(n)};this.featuresRtree_.forEach(i);for(const n in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[n])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new Gn(ci.CLEAR);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const i=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(i,function(n){const s=n.getGeometry();if(s instanceof Pi||s.intersectsCoordinate(e))return t(n)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(i){const n=i.getGeometry();if(n instanceof Pi||n.intersectsExtent(e)){const s=t(i);if(s)return s}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),Dr(this.nullGeometryFeatures_)||Fe(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(i){t.push(i)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const n=sw(e,t);return[].concat(...n.map(s=>this.featuresRtree_.getInExtent(s)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,t){const i=e[0],n=e[1];let s=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return t=t||Po,this.featuresRtree_.forEachInExtent(l,function(h){if(t(h)){const u=h.getGeometry(),c=a;if(a=u instanceof Pi?0:u.closestPointXY(i,n,o,a),a<c){s=h;const d=Math.sqrt(a);l[0]=i-d,l[1]=n-d,l[2]=i+d,l[3]=n+d}}}),s}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const t=this.idIndex_[e.toString()];return t!==void 0?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,i=xe(t),n=t.getGeometry();if(!n)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[i]=t);else{const o=n.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(o,t)):this.featuresRtree_&&this.featuresRtree_.update(o,t)}const s=t.getId();if(s!==void 0){const o=s.toString();this.idIndex_[o]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[o]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[i]=t;this.changed(),this.dispatchEvent(new Gn(ci.CHANGEFEATURE,t))}hasFeature(e){const t=e.getId();return t!==void 0?t in this.idIndex_:xe(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Dr(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,t,i){const n=this.loadedExtentsRtree_,s=this.strategy_(e,t,i);for(let o=0,a=s.length;o<a;++o){const l=s[o];n.forEachInExtent(l,function(u){return mi(u.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Gn(ci.FEATURESLOADSTART)),this.loader_.call(this,l,t,i,u=>{--this.loadingExtentsCount_,this.dispatchEvent(new Gn(ci.FEATURESLOADEND,void 0,u))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Gn(ci.FEATURESLOADERROR))}),n.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_;let i;t.forEachInExtent(e,function(n){if(zr(n.extent,e))return i=n,!0}),i&&t.remove(i)}removeFeatures(e){const t=[];for(let i=0,n=e.length;i<n;++i){const s=e[i],o=this.removeFeatureInternal(s);o&&t.push(o)}t.length>0&&this.changed()}removeFeature(e){if(!e)return;this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=xe(e);t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e);const i=this.featureChangeKeys_[t];if(!i)return;i.forEach(We),delete this.featureChangeKeys_[t];const n=e.getId();return n!==void 0&&delete this.idIndex_[n.toString()],delete this.uidIndex_[t],this.hasListener(ci.REMOVEFEATURE)&&this.dispatchEvent(new Gn(ci.REMOVEFEATURE,e)),e}removeFromIdIndex_(e){let t=!1;for(const i in this.idIndex_){const n=this.idIndex_[i];if(e instanceof Pi&&Array.isArray(n)&&n.includes(e))n.splice(n.indexOf(e),1);else if(this.idIndex_[i]===e){delete this.idIndex_[i],t=!0;break}}return t}setLoader(e){this.loader_=e}setUrl(e){Ae(this.format_,"`format` must be set when `url` is set"),this.url_=e,this.setLoader(zg(e,this.format_))}}function r2(r,e){const t=r.canvas;e=e||{};const i=e.pixelRatio||Sd,n=e.size;n&&(t.width=n[0]*i,t.height=n[1]*i,t.style.width=n[0]+"px",t.style.height=n[1]+"px");const s=[0,0,t.width,t.height],o=Ba(si(),i,i);return new zd(r,i,s,o,0)}function s2(r){if(!(r.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const e=r.inversePixelTransform[0],t=r.inversePixelTransform[1],i=Math.sqrt(e*e+t*t),n=r.frameState,s=Qo(r.inversePixelTransform.slice(),n.coordinateToPixelTransform),o=cl(n.viewState.resolution,i);let a;return new zd(r.context,i,n.extent,s,n.viewState.rotation,o,a)}function o2(r,e){return nt(r.inversePixelTransform,e.slice(0))}class sh extends Jo{constructor(e,t,i){super(),i=i||{},this.tileCoord=e,this.state=t,this.interimTile=null,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(Ee.CHANGE)}release(){this.state===he.ERROR&&this.setState(he.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let e=this.interimTile;if(!e)return this;do{if(e.getState()==he.LOADED)return this.transition_=0,e;e=e.interimTile}while(e);return this}refreshInterimChain(){let e=this.interimTile;if(!e)return;let t=this;do{if(e.getState()==he.LOADED){e.interimTile=null;break}e.getState()==he.LOADING?t=e:e.getState()==he.IDLE?t.interimTile=e.interimTile:t=e,e=t.interimTile}while(e)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==he.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}load(){ge()}getAlpha(e,t){if(!this.transition_)return 1;let i=this.transitionStarts_[e];if(!i)i=t,this.transitionStarts_[e]=i;else if(i===-1)return 1;const n=t-i+1e3/60;return n>=this.transition_?1:Hm(n/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}}class kb extends sh{constructor(e,t,i,n,s,o){super(e,t,o),this.crossOrigin_=n,this.src_=i,this.key=i,this.image_=new Image,n!==null&&(this.image_.crossOrigin=n),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(e){this.image_=e,this.state=he.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=he.ERROR,this.unlistenImage_(),this.image_=Dx(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=he.LOADED:this.state=he.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==he.ERROR&&(this.state=he.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==he.IDLE&&(this.state=he.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=c_(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function Dx(){const r=mt(1,1);return r.fillStyle="rgba(0,0,0,0)",r.fillRect(0,0,1,1),r.canvas}const St={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class a2 extends Hi{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+m_,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(St.ELEMENT,this.handleElementChanged),this.addChangeListener(St.MAP,this.handleMapChanged),this.addChangeListener(St.OFFSET,this.handleOffsetChanged),this.addChangeListener(St.POSITION,this.handlePositionChanged),this.addChangeListener(St.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(St.ELEMENT)}getId(){return this.id}getMap(){return this.get(St.MAP)||null}getOffset(){return this.get(St.OFFSET)}getPosition(){return this.get(St.POSITION)}getPositioning(){return this.get(St.POSITIONING)}handleElementChanged(){sb(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(il(this.element),We(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=Oe(e,bn.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(St.ELEMENT,e)}setMap(e){this.set(St.MAP,e)}setOffset(e){this.set(St.OFFSET,e)}setPosition(e){this.set(St.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(St.POSITION))return;const i=this.getRect(t.getTargetElement(),t.getSize()),n=this.getElement(),s=this.getRect(n,[a_(n),l_(n)]);e=e||{};const o=e.margin===void 0?20:e.margin;if(!mi(i,s)){const a=s[0]-i[0],l=i[2]-s[2],h=s[1]-i[1],u=i[3]-s[3],c=[0,0];if(a<0?c[0]=a-o:l<0&&(c[0]=Math.abs(l)+o),h<0?c[1]=h-o:u<0&&(c[1]=Math.abs(u)+o),c[0]!==0||c[1]!==0){const d=t.getView().getCenterInternal(),f=t.getPixelFromCoordinateInternal(d);if(!f)return;const g=[f[0]+c[0],f[1]+c[1]],m=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(g),duration:m.duration,easing:m.easing})}}}getRect(e,t){const i=e.getBoundingClientRect(),n=i.left+window.pageXOffset,s=i.top+window.pageYOffset;return[n,s,n+t[0],s+t[1]]}setPositioning(e){this.set(St.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const i=e.getPixelFromCoordinate(t),n=e.getSize();this.updateRenderedPosition(i,n)}updateRenderedPosition(e,t){const i=this.element.style,n=this.getOffset(),s=this.getPositioning();this.setVisible(!0);const o=Math.round(e[0]+n[0])+"px",a=Math.round(e[1]+n[1])+"px";let l="0%",h="0%";s=="bottom-right"||s=="center-right"||s=="top-right"?l="-100%":(s=="bottom-center"||s=="center-center"||s=="top-center")&&(l="-50%"),s=="bottom-left"||s=="bottom-center"||s=="bottom-right"?h="-100%":(s=="center-left"||s=="center-center"||s=="center-right")&&(h="-50%");const u=`translate(${l}, ${h}) translate(${o}, ${a})`;this.rendered.transform_!=u&&(this.rendered.transform_=u,i.transform=u)}getOptions(){return this.options}}class kx{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const i=this.entries_[e];return Ae(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){const t=this.entries_[e];return Ae(t!==void 0,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.key_;return e}getValues(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){var t;return(t=this.entries_[e])==null?void 0:t.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){Ae(!(e in this.entries_),"Tried to set a value for a key that is used already");const i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}}function Bg(r,e,t,i){return i!==void 0?(i[0]=r,i[1]=e,i[2]=t,i):[r,e,t]}function la(r,e,t){return r+"/"+e+"/"+t}function Nb(r){return la(r[0],r[1],r[2])}function l2(r){const[e,t,i]=r.substring(r.lastIndexOf("/")+1,r.length).split(",").map(Number);return la(e,t,i)}function Nx(r){return r.split("/").map(Number)}function zb(r){return(r[1]<<r[0])+r[2]}function zx(r,e){const t=r[0],i=r[1],n=r[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const s=e.getFullTileRange(t);return s?s.containsXY(i,n):!0}class Bb extends kx{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(e){for(;this.canExpireCache()&&!(this.peekLast().getKey()in e);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const e=this.peekFirstKey(),i=Nx(e)[0];this.forEach(n=>{n.tileCoord[0]!==i&&(this.remove(Nb(n.tileCoord)),n.release())})}}class Hd{constructor(e,t,i,n){this.minX=e,this.maxX=t,this.minY=i,this.maxY=n}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function qr(r,e,t,i,n){return n!==void 0?(n.minX=r,n.maxX=e,n.minY=t,n.maxY=i,n):new Hd(r,e,t,i)}const Gg=[];class h2 extends sh{constructor(e,t,i,n){super(e,t,{transition:0}),this.context_={},this.executorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=n.bind(void 0,this),this.wrappedTileCoord=i}getContext(e){const t=xe(e);return t in this.context_||(this.context_[t]=mt(1,1,Gg)),this.context_[t]}hasContext(e){return xe(e)in this.context_}getImage(e){return this.hasContext(e)?this.getContext(e).canvas:null}getReplayState(e){const t=xe(e);return t in this.replayState_||(this.replayState_[t]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[t]}load(){this.getSourceTiles()}release(){for(const e in this.context_){const t=this.context_[e];ia(t),Gg.push(t.canvas),delete this.context_[e]}super.release()}}let u2=class extends sh{constructor(e,t,i,n,s,o){super(e,t,o),this.extent=null,this.format_=n,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=s,this.url_=i,this.key=i}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==he.IDLE&&(this.setState(he.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(e,t){this.setFeatures(e)}onError(){this.setState(he.ERROR)}setFeatures(e){this.features_=e,this.setState(he.LOADED)}setLoader(e){this.loader_=e}};class Bx{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=Ti,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let i=t.dataProjection?we(t.dataProjection):this.readProjection(e);t.extent&&i&&i.getUnits()==="tile-pixels"&&(i=we(i),i.setWorldExtent(t.extent)),t={dataProjection:i,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},e)}getType(){return ge()}readFeature(e,t){return ge()}readFeatures(e,t){return ge()}readGeometry(e,t){return ge()}readProjection(e){return ge()}writeFeature(e,t){return ge()}writeFeatures(e,t){return ge()}writeGeometry(e,t){return ge()}}const oh=Bx;function Et(r,e,t){const i=t?we(t.featureProjection):null,n=t?we(t.dataProjection):null;let s=r;if(i&&n&&!pi(i,n)){e&&(s=r.clone());const o=e?i:n,a=e?n:i;o.getUnits()==="tile-pixels"?s.transform(o,a):s.applyTransform(_s(o,a))}if(e&&t&&t.decimals!==void 0){const o=Math.pow(10,t.decimals),a=function(l){for(let h=0,u=l.length;h<u;++h)l[h]=Math.round(l[h]*o)/o;return l};s===r&&(s=r.clone()),s.applyTransform(a)}return s}function Vd(r,e){const t=e?we(e.featureProjection):null,i=e?we(e.dataProjection):null;return t&&i&&!pi(t,i)?om(r,i,t):r}const Gx={Point:Ni,LineString:Kt,Polygon:At,MultiPoint:dr,MultiLineString:Bi,MultiPolygon:Pn};function Hx(r,e,t){return Array.isArray(e[0])?(qm(r,0,e,t)||(r=r.slice(),Su(r,0,e,t)),r):(wd(r,0,e,t)||(r=r.slice(),tl(r,0,e,t)),r)}function Gb(r,e){var s;const t=r.geometry;if(!t)return[];if(Array.isArray(t))return t.map(o=>Gb({...r,geometry:o})).flat();const i=t.type==="MultiPolygon"?"Polygon":t.type;if(i==="GeometryCollection"||i==="Circle")throw new Error("Unsupported geometry type: "+i);const n=t.layout.length;return Et(new Pi(i,i==="Polygon"?Hx(t.flatCoordinates,t.ends,n):t.flatCoordinates,(s=t.ends)==null?void 0:s.flat(),n,r.properties||{},r.id).enableSimplifyTransformed(),!1,e)}function Wd(r,e){if(!r)return null;if(Array.isArray(r)){const i=r.map(n=>Wd(n,e));return new sr(i)}const t=Gx[r.type];return Et(new t(r.flatCoordinates,r.layout,r.ends),!1,e)}class Hb extends oh{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(xa(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(xa(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return ge()}readFeaturesFromObject(e,t){return ge()}readGeometry(e,t){return this.readGeometryFromObject(xa(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return ge()}readProjection(e){return this.readProjectionFromObject(xa(e))}readProjectionFromObject(e){return ge()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return ge()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return ge()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return ge()}}function xa(r){if(typeof r=="string"){const e=JSON.parse(r);return e||null}return r!==null?r:null}class Vx extends Hb{constructor(e){e=e||{},super(),this.dataProjection=we(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=we(e.featureProjection)),e.featureClass&&(this.featureClass=e.featureClass),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let i=null;e.type==="Feature"?i=e:i={type:"Feature",geometry:e,properties:null};const n=Ud(i.geometry);if(this.featureClass===Pi)return Gb({geometry:n,id:i.id,properties:i.properties},t);const s=new Ti;return this.geometryName_?s.setGeometryName(this.geometryName_):this.extractGeometryName_&&i.geometry_name&&s.setGeometryName(i.geometry_name),s.setGeometry(Wd(n,t)),"id"in i&&s.setId(i.id),i.properties&&s.setProperties(i.properties,!0),s}readFeaturesFromObject(e,t){const i=e;let n=null;if(i.type==="FeatureCollection"){const s=e;n=[];const o=s.features;for(let a=0,l=o.length;a<l;++a){const h=this.readFeatureFromObject(o[a],t);h&&n.push(h)}}else n=[this.readFeatureFromObject(e,t)];return n.flat()}readGeometryFromObject(e,t){return Wx(e,t)}readProjectionFromObject(e){const t=e.crs;let i;if(t)if(t.type=="name")i=we(t.properties.name);else if(t.type==="EPSG")i=we("EPSG:"+t.properties.code);else throw new Error("Unknown SRS type");else i=this.dataProjection;return i}writeFeatureObject(e,t){t=this.adaptOptions(t);const i={type:"Feature",geometry:null,properties:null},n=e.getId();if(n!==void 0&&(i.id=n),!e.hasProperties())return i;const s=e.getProperties(),o=e.getGeometry();return o&&(i.geometry=Du(o,t),delete s[e.getGeometryName()]),Dr(s)||(i.properties=s),i}writeFeaturesObject(e,t){t=this.adaptOptions(t);const i=[];for(let n=0,s=e.length;n<s;++n)i.push(this.writeFeatureObject(e[n],t));return{type:"FeatureCollection",features:i}}writeGeometryObject(e,t){return Du(e,this.adaptOptions(t))}}function Ud(r,e){if(!r)return null;let t;switch(r.type){case"Point":{t=Yx(r);break}case"LineString":{t=jx(r);break}case"Polygon":{t=Kx(r);break}case"MultiPoint":{t=$x(r);break}case"MultiLineString":{t=Xx(r);break}case"MultiPolygon":{t=Zx(r);break}case"GeometryCollection":{t=Ux(r);break}default:throw new Error("Unsupported GeoJSON type: "+r.type)}return t}function Wx(r,e){const t=Ud(r);return Wd(t,e)}function Ux(r,e){return r.geometries.map(function(i){return Ud(i)})}function Yx(r){const e=r.coordinates;return{type:"Point",flatCoordinates:e,layout:Yr(e.length)}}function jx(r){var i;const e=r.coordinates,t=e.flat();return{type:"LineString",flatCoordinates:t,ends:[t.length],layout:Yr(((i=e[0])==null?void 0:i.length)||2)}}function Xx(r){var s,o;const e=r.coordinates,t=((o=(s=e[0])==null?void 0:s[0])==null?void 0:o.length)||2,i=[],n=ea(i,0,e,t);return{type:"MultiLineString",flatCoordinates:i,ends:n,layout:Yr(t)}}function $x(r){var t;const e=r.coordinates;return{type:"MultiPoint",flatCoordinates:e.flat(),layout:Yr(((t=e[0])==null?void 0:t.length)||2)}}function Zx(r){var s,o;const e=r.coordinates,t=[],i=((o=(s=e[0])==null?void 0:s[0])==null?void 0:o[0].length)||2,n=Wm(t,0,e,i);return{type:"MultiPolygon",flatCoordinates:t,ends:n,layout:Yr(i)}}function Kx(r){var s,o;const e=r.coordinates,t=[],i=(o=(s=e[0])==null?void 0:s[0])==null?void 0:o.length,n=ea(t,0,e,i);return{type:"Polygon",flatCoordinates:t,ends:n,layout:Yr(i)}}function Du(r,e){r=Et(r,!0,e);const t=r.getType();let i;switch(t){case"Point":{i=iR(r);break}case"LineString":{i=Jx(r);break}case"Polygon":{i=nR(r,e);break}case"MultiPoint":{i=eR(r);break}case"MultiLineString":{i=Qx(r);break}case"MultiPolygon":{i=tR(r,e);break}case"GeometryCollection":{i=qx(r,e);break}case"Circle":{i={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+t)}return i}function qx(r,e){return e=Object.assign({},e),delete e.featureProjection,{type:"GeometryCollection",geometries:r.getGeometriesArray().map(function(i){return Du(i,e)})}}function Jx(r,e){return{type:"LineString",coordinates:r.getCoordinates()}}function Qx(r,e){return{type:"MultiLineString",coordinates:r.getCoordinates()}}function eR(r,e){return{type:"MultiPoint",coordinates:r.getCoordinates()}}function tR(r,e){let t;return e&&(t=e.rightHanded),{type:"MultiPolygon",coordinates:r.getCoordinates(t)}}function iR(r,e){return{type:"Point",coordinates:r.getCoordinates()}}function nR(r,e){let t;return e&&(t=e.rightHanded),{type:"Polygon",coordinates:r.getCoordinates(t)}}const Gr="http://www.w3.org/2001/XMLSchema-instance";function ve(r,e){return js().createElementNS(r,e)}function zt(r,e){return Vb(r,e,[]).join("")}function Vb(r,e,t){if(r.nodeType==Node.CDATA_SECTION_NODE||r.nodeType==Node.TEXT_NODE)e?t.push(String(r.nodeValue).replace(/(\r\n|\r|\n)/g,"")):t.push(r.nodeValue);else{let i;for(i=r.firstChild;i;i=i.nextSibling)Vb(i,e,t)}return t}function yi(r){return"documentElement"in r}function rR(r,e,t){return r.getAttributeNS(e,t)||""}function vi(r){return new DOMParser().parseFromString(r,"application/xml")}function gl(r,e){return function(t,i){const n=r.call(e!==void 0?e:this,t,i);if(n!==void 0){const s=i[i.length-1];Fe(s,n)}}}function ue(r,e){return function(t,i){const n=r.call(e!==void 0?e:this,t,i);n!==void 0&&i[i.length-1].push(n)}}function fe(r,e){return function(t,i){const n=r.call(e!==void 0?e:this,t,i);n!==void 0&&(i[i.length-1]=n)}}function Ut(r,e,t){return function(i,n){const s=r.call(t!==void 0?t:this,i,n);if(s!==void 0){const o=n[n.length-1],a=e!==void 0?e:i.localName;let l;a in o?l=o[a]:(l=[],o[a]=l),l.push(s)}}}function N(r,e,t){return function(i,n){const s=r.call(t!==void 0?t:this,i,n);if(s!==void 0){const o=n[n.length-1],a=e!==void 0?e:i.localName;o[a]=s}}}function P(r,e){return function(t,i,n){r.call(e!==void 0?e:this,t,i,n),n[n.length-1].node.appendChild(t)}}function Wb(r,e){let t,i;return function(n,s,o){if(t===void 0){t={};const a={};a[n.localName]=r,t[n.namespaceURI]=a,i=Qe(n.localName)}Ub(t,i,s,o)}}function Qe(r,e){return function(t,i,n){const o=i[i.length-1].node;let a=r;a===void 0&&(a=n);const l=e!==void 0?e:o.namespaceURI;return ve(l,a)}}const pt=Qe();function qt(r,e){const t=e.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=r[e[n]];return i}function X(r,e,t){t=t!==void 0?t:{};let i,n;for(i=0,n=r.length;i<n;++i)t[r[i]]=e;return t}function Zt(r,e,t,i){let n;for(n=e.firstElementChild;n;n=n.nextElementSibling){const s=r[n.namespaceURI];if(s!==void 0){const o=s[n.localName];o!==void 0&&o.call(i,n,t)}}}function Z(r,e,t,i,n){return i.push(r),Zt(e,t,i,n),i.pop()}function Ub(r,e,t,i,n,s){const o=(n!==void 0?n:t).length;let a,l;for(let h=0;h<o;++h)a=t[h],a!==void 0&&(l=e.call(s!==void 0?s:this,a,i,n!==void 0?n[h]:void 0),l!==void 0&&r[l.namespaceURI][l.localName].call(s,l,a,i))}function ye(r,e,t,i,n,s,o){return n.push(r),Ub(e,t,i,n,s,o),n.pop()}let Yh;function sR(){return Yh===void 0&&typeof XMLSerializer<"u"&&(Yh=new XMLSerializer),Yh}let jh;function js(){return jh===void 0&&typeof document<"u"&&(jh=document.implementation.createDocument("","",null)),jh}class ha extends oh{constructor(){super(),this.xmlSerializer_=sR()}getType(){return"xml"}readFeature(e,t){if(!e)return null;if(typeof e=="string"){const i=vi(e);return this.readFeatureFromDocument(i,t)}return yi(e)?this.readFeatureFromDocument(e,t):this.readFeatureFromNode(e,t)}readFeatureFromDocument(e,t){const i=this.readFeaturesFromDocument(e,t);return i.length>0?i[0]:null}readFeatureFromNode(e,t){return null}readFeatures(e,t){if(!e)return[];if(typeof e=="string"){const i=vi(e);return this.readFeaturesFromDocument(i,t)}return yi(e)?this.readFeaturesFromDocument(e,t):this.readFeaturesFromNode(e,t)}readFeaturesFromDocument(e,t){const i=[];for(let n=e.firstChild;n;n=n.nextSibling)n.nodeType==Node.ELEMENT_NODE&&Fe(i,this.readFeaturesFromNode(n,t));return i}readFeaturesFromNode(e,t){return ge()}readGeometry(e,t){if(!e)return null;if(typeof e=="string"){const i=vi(e);return this.readGeometryFromDocument(i,t)}return yi(e)?this.readGeometryFromDocument(e,t):this.readGeometryFromNode(e,t)}readGeometryFromDocument(e,t){return null}readGeometryFromNode(e,t){return null}readProjection(e){if(!e)return null;if(typeof e=="string"){const t=vi(e);return this.readProjectionFromDocument(t)}return yi(e)?this.readProjectionFromDocument(e):this.readProjectionFromNode(e)}readProjectionFromDocument(e){return this.dataProjection}readProjectionFromNode(e){return this.dataProjection}writeFeature(e,t){const i=this.writeFeatureNode(e,t);return this.xmlSerializer_.serializeToString(i)}writeFeatureNode(e,t){return null}writeFeatures(e,t){const i=this.writeFeaturesNode(e,t);return this.xmlSerializer_.serializeToString(i)}writeFeaturesNode(e,t){return null}writeGeometry(e,t){const i=this.writeGeometryNode(e,t);return this.xmlSerializer_.serializeToString(i)}writeGeometryNode(e,t){return null}}const Mn="http://www.opengis.net/gml",oR=/^\s*$/;class ae extends ha{constructor(e){super(),e=e||{},this.featureType=e.featureType,this.featureNS=e.featureNS,this.srsName=e.srsName,this.schemaLocation="",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:ue(this.readFeaturesInternal),featureMembers:fe(this.readFeaturesInternal)},this.supportedMediaTypes=["application/gml+xml"]}readFeaturesInternal(e,t){const i=e.localName;let n=null;if(i=="FeatureCollection")n=Z([],this.FEATURE_COLLECTION_PARSERS,e,t,this);else if(i=="featureMembers"||i=="featureMember"||i=="member"){const s=t[0];let o=s.featureType,a=s.featureNS;const l="p",h="p0";if(!o&&e.childNodes){o=[],a={};for(let d=0,f=e.childNodes.length;d<f;++d){const g=e.childNodes[d];if(g.nodeType===1){const m=g.nodeName.split(":").pop();if(!o.includes(m)){let w="",y=0;const E=g.namespaceURI;for(const x in a){if(a[x]===E){w=x;break}++y}w||(w=l+y,a[w]=E),o.push(w+":"+m)}}}i!="featureMember"&&(s.featureType=o,s.featureNS=a)}if(typeof a=="string"){const d=a;a={},a[h]=d}const u={},c=Array.isArray(o)?o:[o];for(const d in a){const f={};for(let g=0,m=c.length;g<m;++g)(c[g].includes(":")?c[g].split(":")[0]:h)===d&&(f[c[g].split(":").pop()]=i=="featureMembers"?ue(this.readFeatureElement,this):fe(this.readFeatureElement,this));u[a[d]]=f}i=="featureMember"||i=="member"?n=Z(void 0,u,e,t):n=Z([],u,e,t)}return n===null&&(n=[]),n}readGeometryOrExtent(e,t){const i=t[0];return i.srsName=e.firstElementChild.getAttribute("srsName"),i.srsDimension=e.firstElementChild.getAttribute("srsDimension"),Z(null,this.GEOMETRY_PARSERS,e,t,this)}readExtentElement(e,t){const i=t[0],n=this.readGeometryOrExtent(e,t);return n?Vd(n,i):void 0}readGeometryElement(e,t){const i=t[0],n=this.readGeometryOrExtent(e,t);return n?Et(n,!1,i):void 0}readFeatureElementInternal(e,t,i){let n;const s={};for(let l=e.firstElementChild;l;l=l.nextElementSibling){let h;const u=l.localName;l.childNodes.length===0||l.childNodes.length===1&&(l.firstChild.nodeType===3||l.firstChild.nodeType===4)?(h=zt(l,!1),oR.test(h)&&(h=void 0)):(i&&(h=u==="boundedBy"?this.readExtentElement(l,t):this.readGeometryElement(l,t)),h?u!=="boundedBy"&&(n=u):h=this.readFeatureElementInternal(l,t,!1));const c=l.attributes.length;if(c>0&&!(h instanceof cd)){h={_content_:h};for(let d=0;d<c;d++){const f=l.attributes[d].name;h[f]=l.attributes[d].value}}s[u]?(s[u]instanceof Array||(s[u]=[s[u]]),s[u].push(h)):s[u]=h}if(!i)return s;const o=new Ti(s);n&&o.setGeometryName(n);const a=e.getAttribute("fid")||rR(e,this.namespace,"id");return a&&o.setId(a),o}readFeatureElement(e,t){return this.readFeatureElementInternal(e,t,!0)}readPoint(e,t){const i=this.readFlatCoordinatesFromNode(e,t);if(i)return new Ni(i,"XYZ")}readMultiPoint(e,t){const i=Z([],this.MULTIPOINT_PARSERS,e,t,this);if(i)return new dr(i)}readMultiLineString(e,t){const i=Z([],this.MULTILINESTRING_PARSERS,e,t,this);if(i)return new Bi(i)}readMultiPolygon(e,t){const i=Z([],this.MULTIPOLYGON_PARSERS,e,t,this);if(i)return new Pn(i)}pointMemberParser(e,t){Zt(this.POINTMEMBER_PARSERS,e,t,this)}lineStringMemberParser(e,t){Zt(this.LINESTRINGMEMBER_PARSERS,e,t,this)}polygonMemberParser(e,t){Zt(this.POLYGONMEMBER_PARSERS,e,t,this)}readLineString(e,t){const i=this.readFlatCoordinatesFromNode(e,t);if(i)return new Kt(i,"XYZ")}readFlatLinearRing(e,t){const i=Z(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this);if(i)return i}readLinearRing(e,t){const i=this.readFlatCoordinatesFromNode(e,t);if(i)return new As(i,"XYZ")}readPolygon(e,t){const i=Z([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this);if(i&&i[0]){const n=i[0],s=[n.length];let o,a;for(o=1,a=i.length;o<a;++o)Fe(n,i[o]),s.push(n.length);return new At(n,"XYZ",s)}}readFlatCoordinatesFromNode(e,t){return Z(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}readGeometryFromNode(e,t){const i=this.readGeometryElement(e,[this.getReadOptions(e,t||{})]);return i||null}readFeaturesFromNode(e,t){const i={featureType:this.featureType,featureNS:this.featureNS};return i&&Object.assign(i,this.getReadOptions(e,t)),this.readFeaturesInternal(e,[i])||[]}readProjectionFromNode(e){return we(this.srsName?this.srsName:e.firstElementChild.getAttribute("srsName"))}}ae.prototype.namespace=Mn;ae.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}};ae.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}};ae.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}};ae.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:ue(ae.prototype.pointMemberParser),pointMembers:ue(ae.prototype.pointMemberParser)}};ae.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:ue(ae.prototype.lineStringMemberParser),lineStringMembers:ue(ae.prototype.lineStringMemberParser)}};ae.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:ue(ae.prototype.polygonMemberParser),polygonMembers:ue(ae.prototype.polygonMemberParser)}};ae.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:ue(ae.prototype.readFlatCoordinatesFromNode)}};ae.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:ue(ae.prototype.readLineString)}};ae.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:ue(ae.prototype.readPolygon)}};ae.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:fe(ae.prototype.readFlatLinearRing)}};function ar(r){const e=zt(r,!1);return aR(e)}function aR(r){const e=/^\s*(true|1)|(false|0)\s*$/.exec(r);if(e)return e[1]!==void 0||!1}function ah(r){const e=zt(r,!1),t=Date.parse(e);return isNaN(t)?void 0:t/1e3}function ke(r){const e=zt(r,!1);return lR(e)}function lR(r){const e=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(r);if(e)return parseFloat(e[1])}function lt(r){const e=zt(r,!1);return hs(e)}function hs(r){const e=/^\s*(\d+)\s*$/.exec(r);if(e)return parseInt(e[1],10)}function ne(r){return zt(r,!1).trim()}function Os(r,e){be(r,e?"1":"0")}function hR(r,e){r.appendChild(js().createCDATASection(e))}function uR(r,e){const t=new Date(e*1e3),i=t.getUTCFullYear()+"-"+Ks(t.getUTCMonth()+1,2)+"-"+Ks(t.getUTCDate(),2)+"T"+Ks(t.getUTCHours(),2)+":"+Ks(t.getUTCMinutes(),2)+":"+Ks(t.getUTCSeconds(),2)+"Z";r.appendChild(js().createTextNode(i))}function Ht(r,e){const t=e.toPrecision();r.appendChild(js().createTextNode(t))}function pl(r,e){const t=e.toString();r.appendChild(js().createTextNode(t))}function be(r,e){r.appendChild(js().createTextNode(e))}const cR=Mn+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",dR={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class Me extends ae{constructor(e){e=e||{},super(e),this.FEATURE_COLLECTION_PARSERS[Mn].featureMember=ue(this.readFeaturesInternal),this.schemaLocation=e.schemaLocation?e.schemaLocation:cR}readFlatCoordinates(e,t){const i=zt(e,!1).replace(/^\s*|\s*$/g,""),s=t[0].srsName;let o="enu";if(s){const h=we(s);h&&(o=h.getAxisOrientation())}const a=i.trim().split(/\s+/),l=[];for(let h=0,u=a.length;h<u;h++){const c=a[h].split(/,+/),d=parseFloat(c[0]),f=parseFloat(c[1]),g=c.length===3?parseFloat(c[2]):0;o.substr(0,2)==="en"?l.push(d,f,g):l.push(f,d,g)}return l}readBox(e,t){const i=Z([null],this.BOX_PARSERS_,e,t,this);return _i(i[1][0],i[1][1],i[1][3],i[1][4])}innerBoundaryIsParser(e,t){const i=Z(void 0,this.RING_PARSERS,e,t,this);i&&t[t.length-1].push(i)}outerBoundaryIsParser(e,t){const i=Z(void 0,this.RING_PARSERS,e,t,this);if(i){const n=t[t.length-1];n[0]=i}}GEOMETRY_NODE_FACTORY_(e,t,i){const n=t[t.length-1],s=n.multiSurface,o=n.surface,a=n.multiCurve;return Array.isArray(e)?i="Envelope":(i=e.getType(),i==="MultiPolygon"&&s===!0?i="MultiSurface":i==="Polygon"&&o===!0?i="Surface":i==="MultiLineString"&&a===!0&&(i="MultiCurve")),ve("http://www.opengis.net/gml",i)}writeFeatureElement(e,t,i){const n=t.getId();n&&e.setAttribute("fid",n);const s=i[i.length-1],o=s.featureNS,a=t.getGeometryName();s.serializers||(s.serializers={},s.serializers[o]={});const l=[],h=[];if(t.hasProperties()){const c=t.getProperties();for(const d in c){const f=c[d];f!==null&&(l.push(d),h.push(f),d==a||typeof f.getSimplifiedGeometry=="function"?d in s.serializers[o]||(s.serializers[o][d]=P(this.writeGeometryElement,this)):d in s.serializers[o]||(s.serializers[o][d]=P(be)))}}const u=Object.assign({},s);u.node=e,ye(u,s.serializers,Qe(void 0,o),h,i,l)}writeCurveOrLineString(e,t,i){const s=i[i.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&s&&e.setAttribute("srsName",s),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o),this.writeCoordinates_(o,t,i)}else if(e.nodeName==="Curve"){const o=ve(e.namespaceURI,"segments");e.appendChild(o),this.writeCurveSegments_(o,t,i)}}writeLineStringOrCurveMember(e,t,i){const n=this.GEOMETRY_NODE_FACTORY_(t,i);n&&(e.appendChild(n),this.writeCurveOrLineString(n,t,i))}writeMultiCurveOrLineString(e,t,i){const n=i[i.length-1],s=n.hasZ,o=n.srsName,a=n.curve;o&&e.setAttribute("srsName",o);const l=t.getLineStrings();ye({node:e,hasZ:s,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,i,void 0,this)}writeGeometryElement(e,t,i){const n=i[i.length-1],s=Object.assign({},n);s.node=e;let o;Array.isArray(t)?o=Vd(t,n):o=Et(t,!0,n),ye(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],i,void 0,this)}createCoordinatesNode_(e){const t=ve(e,"coordinates");return t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," "),t}writeCoordinates_(e,t,i){const n=i[i.length-1],s=n.hasZ,o=n.srsName,a=t.getCoordinates(),l=a.length,h=new Array(l);for(let u=0;u<l;++u){const c=a[u];h[u]=this.getCoords_(c,o,s)}be(e,h.join(" "))}writeCurveSegments_(e,t,i){const n=ve(e.namespaceURI,"LineStringSegment");e.appendChild(n),this.writeCurveOrLineString(n,t,i)}writeSurfaceOrPolygon(e,t,i){const n=i[i.length-1],s=n.hasZ,o=n.srsName;if(e.nodeName!=="PolygonPatch"&&o&&e.setAttribute("srsName",o),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const a=t.getLinearRings();ye({node:e,hasZ:s,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,i,void 0,this)}else if(e.nodeName==="Surface"){const a=ve(e.namespaceURI,"patches");e.appendChild(a),this.writeSurfacePatches_(a,t,i)}}RING_NODE_FACTORY_(e,t,i){const n=t[t.length-1],s=n.node,o=n.exteriorWritten;return o===void 0&&(n.exteriorWritten=!0),ve(s.namespaceURI,o!==void 0?"innerBoundaryIs":"outerBoundaryIs")}writeSurfacePatches_(e,t,i){const n=ve(e.namespaceURI,"PolygonPatch");e.appendChild(n),this.writeSurfaceOrPolygon(n,t,i)}writeRing(e,t,i){const n=ve(e.namespaceURI,"LinearRing");e.appendChild(n),this.writeLinearRing(n,t,i)}getCoords_(e,t,i){let n="enu";t&&(n=we(t).getAxisOrientation());let s=n.substr(0,2)==="en"?e[0]+","+e[1]:e[1]+","+e[0];if(i){const o=e[2]||0;s+=","+o}return s}writePoint(e,t,i){const n=i[i.length-1],s=n.hasZ,o=n.srsName;o&&e.setAttribute("srsName",o);const a=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(a);const l=t.getCoordinates(),h=this.getCoords_(l,o,s);be(a,h)}writeMultiPoint(e,t,i){const n=i[i.length-1],s=n.hasZ,o=n.srsName;o&&e.setAttribute("srsName",o);const a=t.getPoints();ye({node:e,hasZ:s,srsName:o},this.POINTMEMBER_SERIALIZERS,Qe("pointMember"),a,i,void 0,this)}writePointMember(e,t,i){const n=ve(e.namespaceURI,"Point");e.appendChild(n),this.writePoint(n,t,i)}writeLinearRing(e,t,i){const s=i[i.length-1].srsName;s&&e.setAttribute("srsName",s);const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o),this.writeCoordinates_(o,t,i)}writeMultiSurfaceOrPolygon(e,t,i){const n=i[i.length-1],s=n.hasZ,o=n.srsName,a=n.surface;o&&e.setAttribute("srsName",o);const l=t.getPolygons();ye({node:e,hasZ:s,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,i,void 0,this)}writeSurfaceOrPolygonMember(e,t,i){const n=this.GEOMETRY_NODE_FACTORY_(t,i);n&&(e.appendChild(n),this.writeSurfaceOrPolygon(n,t,i))}writeEnvelope(e,t,i){const s=i[i.length-1].srsName;s&&e.setAttribute("srsName",s);const o=["lowerCorner","upperCorner"],a=[t[0]+" "+t[1],t[2]+" "+t[3]];ye({node:e},this.ENVELOPE_SERIALIZERS,pt,a,i,o,this)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,i){const n=t[t.length-1].node;return ve("http://www.opengis.net/gml",dR[n.nodeName])}}Me.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:fe(Me.prototype.readFlatCoordinates)}};Me.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:Me.prototype.innerBoundaryIsParser,outerBoundaryIs:Me.prototype.outerBoundaryIsParser}};Me.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:ue(Me.prototype.readFlatCoordinates)}};Me.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:fe(ae.prototype.readPoint),MultiPoint:fe(ae.prototype.readMultiPoint),LineString:fe(ae.prototype.readLineString),MultiLineString:fe(ae.prototype.readMultiLineString),LinearRing:fe(ae.prototype.readLinearRing),Polygon:fe(ae.prototype.readPolygon),MultiPolygon:fe(ae.prototype.readMultiPolygon),Box:fe(Me.prototype.readBox)}};Me.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:P(Me.prototype.writeCurveOrLineString),MultiCurve:P(Me.prototype.writeMultiCurveOrLineString),Point:P(Me.prototype.writePoint),MultiPoint:P(Me.prototype.writeMultiPoint),LineString:P(Me.prototype.writeCurveOrLineString),MultiLineString:P(Me.prototype.writeMultiCurveOrLineString),LinearRing:P(Me.prototype.writeLinearRing),Polygon:P(Me.prototype.writeSurfaceOrPolygon),MultiPolygon:P(Me.prototype.writeMultiSurfaceOrPolygon),Surface:P(Me.prototype.writeSurfaceOrPolygon),MultiSurface:P(Me.prototype.writeMultiSurfaceOrPolygon),Envelope:P(Me.prototype.writeEnvelope)}};Me.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:P(Me.prototype.writeLineStringOrCurveMember),curveMember:P(Me.prototype.writeLineStringOrCurveMember)}};Me.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:P(Me.prototype.writeRing),innerBoundaryIs:P(Me.prototype.writeRing)}};Me.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:P(Me.prototype.writePointMember)}};Me.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:P(Me.prototype.writeSurfaceOrPolygonMember),polygonMember:P(Me.prototype.writeSurfaceOrPolygonMember)}};Me.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:P(be),upperCorner:P(be)}};const fR=Mn+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",gR={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class $ extends ae{constructor(e){e=e||{},super(e),this.surface_=e.surface!==void 0?e.surface:!1,this.curve_=e.curve!==void 0?e.curve:!1,this.multiCurve_=e.multiCurve!==void 0?e.multiCurve:!0,this.multiSurface_=e.multiSurface!==void 0?e.multiSurface:!0,this.schemaLocation=e.schemaLocation?e.schemaLocation:fR,this.hasZ=e.hasZ!==void 0?e.hasZ:!1}readMultiCurve(e,t){const i=Z([],this.MULTICURVE_PARSERS,e,t,this);if(i)return new Bi(i)}readFlatCurveRing(e,t){const i=Z([],this.MULTICURVE_PARSERS,e,t,this),n=[];for(let s=0,o=i.length;s<o;++s)Fe(n,i[s].getFlatCoordinates());return n}readMultiSurface(e,t){const i=Z([],this.MULTISURFACE_PARSERS,e,t,this);if(i)return new Pn(i)}curveMemberParser(e,t){Zt(this.CURVEMEMBER_PARSERS,e,t,this)}surfaceMemberParser(e,t){Zt(this.SURFACEMEMBER_PARSERS,e,t,this)}readPatch(e,t){return Z([null],this.PATCHES_PARSERS,e,t,this)}readSegment(e,t){return Z([],this.SEGMENTS_PARSERS,e,t,this)}readPolygonPatch(e,t){return Z([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this)}readLineStringSegment(e,t){return Z([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}interiorParser(e,t){const i=Z(void 0,this.RING_PARSERS,e,t,this);i&&t[t.length-1].push(i)}exteriorParser(e,t){const i=Z(void 0,this.RING_PARSERS,e,t,this);if(i){const n=t[t.length-1];n[0]=i}}readSurface(e,t){const i=Z([null],this.SURFACE_PARSERS,e,t,this);if(i&&i[0]){const n=i[0],s=[n.length];let o,a;for(o=1,a=i.length;o<a;++o)Fe(n,i[o]),s.push(n.length);return new At(n,"XYZ",s)}}readCurve(e,t){const i=Z([null],this.CURVE_PARSERS,e,t,this);if(i)return new Kt(i,"XYZ")}readEnvelope(e,t){const i=Z([null],this.ENVELOPE_PARSERS,e,t,this);return _i(i[1][0],i[1][1],i[2][0],i[2][1])}readFlatPos(e,t){let i=zt(e,!1);const n=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,s=[];let o;for(;o=n.exec(i);)s.push(parseFloat(o[1])),i=i.substr(o[0].length);if(i!=="")return;const l=t[0].srsName;let h="enu";if(l&&(h=we(l).getAxisOrientation()),h==="neu"){let c,d;for(c=0,d=s.length;c<d;c+=3){const f=s[c],g=s[c+1];s[c]=g,s[c+1]=f}}const u=s.length;if(u==2&&s.push(0),u!==0)return s}readFlatPosList(e,t){const i=zt(e,!1).replace(/^\s*|\s*$/g,""),n=t[0],s=n.srsName,o=n.srsDimension;let a="enu";s&&(a=we(s).getAxisOrientation());const l=i.split(/\s+/);let h=2;e.getAttribute("srsDimension")?h=hs(e.getAttribute("srsDimension")):e.getAttribute("dimension")?h=hs(e.getAttribute("dimension")):e.parentNode.getAttribute("srsDimension")?h=hs(e.parentNode.getAttribute("srsDimension")):o&&(h=hs(o));let u,c,d;const f=[];for(let g=0,m=l.length;g<m;g+=h)u=parseFloat(l[g]),c=parseFloat(l[g+1]),d=h===3?parseFloat(l[g+2]):0,a.substr(0,2)==="en"?f.push(u,c,d):f.push(c,u,d);return f}writePos_(e,t,i){const n=i[i.length-1],s=n.hasZ,o=s?"3":"2";e.setAttribute("srsDimension",o);const a=n.srsName;let l="enu";a&&(l=we(a).getAxisOrientation());const h=t.getCoordinates();let u;if(l.substr(0,2)==="en"?u=h[0]+" "+h[1]:u=h[1]+" "+h[0],s){const c=h[2]||0;u+=" "+c}be(e,u)}getCoords_(e,t,i){let n="enu";t&&(n=we(t).getAxisOrientation());let s=n.substr(0,2)==="en"?e[0]+" "+e[1]:e[1]+" "+e[0];if(i){const o=e[2]||0;s+=" "+o}return s}writePosList_(e,t,i){const n=i[i.length-1],s=n.hasZ,o=s?"3":"2";e.setAttribute("srsDimension",o);const a=n.srsName,l=t.getCoordinates(),h=l.length,u=new Array(h);let c;for(let d=0;d<h;++d)c=l[d],u[d]=this.getCoords_(c,a,s);be(e,u.join(" "))}writePoint(e,t,i){const s=i[i.length-1].srsName;s&&e.setAttribute("srsName",s);const o=ve(e.namespaceURI,"pos");e.appendChild(o),this.writePos_(o,t,i)}writeEnvelope(e,t,i){const s=i[i.length-1].srsName;s&&e.setAttribute("srsName",s);const o=["lowerCorner","upperCorner"],a=[t[0]+" "+t[1],t[2]+" "+t[3]];ye({node:e},this.ENVELOPE_SERIALIZERS,pt,a,i,o,this)}writeLinearRing(e,t,i){const s=i[i.length-1].srsName;s&&e.setAttribute("srsName",s);const o=ve(e.namespaceURI,"posList");e.appendChild(o),this.writePosList_(o,t,i)}RING_NODE_FACTORY_(e,t,i){const n=t[t.length-1],s=n.node,o=n.exteriorWritten;return o===void 0&&(n.exteriorWritten=!0),ve(s.namespaceURI,o!==void 0?"interior":"exterior")}writeSurfaceOrPolygon(e,t,i){const n=i[i.length-1],s=n.hasZ,o=n.srsName;if(e.nodeName!=="PolygonPatch"&&o&&e.setAttribute("srsName",o),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const a=t.getLinearRings();ye({node:e,hasZ:s,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,i,void 0,this)}else if(e.nodeName==="Surface"){const a=ve(e.namespaceURI,"patches");e.appendChild(a),this.writeSurfacePatches_(a,t,i)}}writeCurveOrLineString(e,t,i){const s=i[i.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&s&&e.setAttribute("srsName",s),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const o=ve(e.namespaceURI,"posList");e.appendChild(o),this.writePosList_(o,t,i)}else if(e.nodeName==="Curve"){const o=ve(e.namespaceURI,"segments");e.appendChild(o),this.writeCurveSegments_(o,t,i)}}writeMultiSurfaceOrPolygon(e,t,i){const n=i[i.length-1],s=n.hasZ,o=n.srsName,a=n.surface;o&&e.setAttribute("srsName",o);const l=t.getPolygons();ye({node:e,hasZ:s,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,i,void 0,this)}writeMultiPoint(e,t,i){const n=i[i.length-1],s=n.srsName,o=n.hasZ;s&&e.setAttribute("srsName",s);const a=t.getPoints();ye({node:e,hasZ:o,srsName:s},this.POINTMEMBER_SERIALIZERS,Qe("pointMember"),a,i,void 0,this)}writeMultiCurveOrLineString(e,t,i){const n=i[i.length-1],s=n.hasZ,o=n.srsName,a=n.curve;o&&e.setAttribute("srsName",o);const l=t.getLineStrings();ye({node:e,hasZ:s,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,i,void 0,this)}writeRing(e,t,i){const n=ve(e.namespaceURI,"LinearRing");e.appendChild(n),this.writeLinearRing(n,t,i)}writeSurfaceOrPolygonMember(e,t,i){const n=this.GEOMETRY_NODE_FACTORY_(t,i);n&&(e.appendChild(n),this.writeSurfaceOrPolygon(n,t,i))}writePointMember(e,t,i){const n=ve(e.namespaceURI,"Point");e.appendChild(n),this.writePoint(n,t,i)}writeLineStringOrCurveMember(e,t,i){const n=this.GEOMETRY_NODE_FACTORY_(t,i);n&&(e.appendChild(n),this.writeCurveOrLineString(n,t,i))}writeSurfacePatches_(e,t,i){const n=ve(e.namespaceURI,"PolygonPatch");e.appendChild(n),this.writeSurfaceOrPolygon(n,t,i)}writeCurveSegments_(e,t,i){const n=ve(e.namespaceURI,"LineStringSegment");e.appendChild(n),this.writeCurveOrLineString(n,t,i)}writeGeometryElement(e,t,i){const n=i[i.length-1],s=Object.assign({},n);s.node=e;let o;Array.isArray(t)?o=Vd(t,n):o=Et(t,!0,n),ye(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],i,void 0,this)}writeFeatureElement(e,t,i){const n=t.getId();n&&e.setAttribute("fid",n);const s=i[i.length-1],o=s.featureNS,a=t.getGeometryName();s.serializers||(s.serializers={},s.serializers[o]={});const l=[],h=[];if(t.hasProperties()){const c=t.getProperties();for(const d in c){const f=c[d];f!==null&&(l.push(d),h.push(f),d==a||typeof f.getSimplifiedGeometry=="function"?d in s.serializers[o]||(s.serializers[o][d]=P(this.writeGeometryElement,this)):d in s.serializers[o]||(s.serializers[o][d]=P(be)))}}const u=Object.assign({},s);u.node=e,ye(u,s.serializers,Qe(void 0,o),h,i,l)}writeFeatureMembers_(e,t,i){const n=i[i.length-1],s=n.featureType,o=n.featureNS,a={};a[o]={},a[o][s]=P(this.writeFeatureElement,this);const l=Object.assign({},n);l.node=e,ye(l,a,Qe(s,o),t,i)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,i){const n=t[t.length-1].node;return ve(this.namespace,gR[n.nodeName])}GEOMETRY_NODE_FACTORY_(e,t,i){const n=t[t.length-1],s=n.multiSurface,o=n.surface,a=n.curve,l=n.multiCurve;return Array.isArray(e)?i="Envelope":(i=e.getType(),i==="MultiPolygon"&&s===!0?i="MultiSurface":i==="Polygon"&&o===!0?i="Surface":i==="LineString"&&a===!0?i="Curve":i==="MultiLineString"&&l===!0&&(i="MultiCurve")),ve(this.namespace,i)}writeGeometryNode(e,t){t=this.adaptOptions(t);const i=ve(this.namespace,"geom"),n={node:i,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return t&&Object.assign(n,t),this.writeGeometryElement(i,e,[n]),i}writeFeaturesNode(e,t){t=this.adaptOptions(t);const i=ve(this.namespace,"featureMembers");i.setAttributeNS(Gr,"xsi:schemaLocation",this.schemaLocation);const n={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return t&&Object.assign(n,t),this.writeFeatureMembers_(i,e,[n]),i}}$.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:fe($.prototype.readFlatPos),posList:fe($.prototype.readFlatPosList),coordinates:fe(Me.prototype.readFlatCoordinates)}};$.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:$.prototype.interiorParser,exterior:$.prototype.exteriorParser}};$.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:fe(ae.prototype.readPoint),MultiPoint:fe(ae.prototype.readMultiPoint),LineString:fe(ae.prototype.readLineString),MultiLineString:fe(ae.prototype.readMultiLineString),LinearRing:fe(ae.prototype.readLinearRing),Polygon:fe(ae.prototype.readPolygon),MultiPolygon:fe(ae.prototype.readMultiPolygon),Surface:fe($.prototype.readSurface),MultiSurface:fe($.prototype.readMultiSurface),Curve:fe($.prototype.readCurve),MultiCurve:fe($.prototype.readMultiCurve),Envelope:fe($.prototype.readEnvelope)}};$.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:ue($.prototype.curveMemberParser),curveMembers:ue($.prototype.curveMemberParser)}};$.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:ue($.prototype.surfaceMemberParser),surfaceMembers:ue($.prototype.surfaceMemberParser)}};$.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:ue(ae.prototype.readLineString),Curve:ue($.prototype.readCurve)}};$.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:ue(ae.prototype.readPolygon),Surface:ue($.prototype.readSurface)}};$.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:fe($.prototype.readPatch)}};$.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:fe($.prototype.readSegment)}};$.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:ue($.prototype.readFlatPosList),upperCorner:ue($.prototype.readFlatPosList)}};$.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:fe($.prototype.readPolygonPatch)}};$.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:gl($.prototype.readLineStringSegment)}};ae.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:fe(ae.prototype.readFlatLinearRing),Ring:fe($.prototype.readFlatCurveRing)}};$.prototype.writeFeatures;$.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:P($.prototype.writeRing),interior:P($.prototype.writeRing)}};$.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:P(be),upperCorner:P(be)}};$.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:P($.prototype.writeSurfaceOrPolygonMember),polygonMember:P($.prototype.writeSurfaceOrPolygonMember)}};$.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:P($.prototype.writePointMember)}};$.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:P($.prototype.writeLineStringOrCurveMember),curveMember:P($.prototype.writeLineStringOrCurveMember)}};$.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:P($.prototype.writeCurveOrLineString),MultiCurve:P($.prototype.writeMultiCurveOrLineString),Point:P($.prototype.writePoint),MultiPoint:P($.prototype.writeMultiPoint),LineString:P($.prototype.writeCurveOrLineString),MultiLineString:P($.prototype.writeMultiCurveOrLineString),LinearRing:P($.prototype.writeLinearRing),Polygon:P($.prototype.writeSurfaceOrPolygon),MultiPolygon:P($.prototype.writeMultiSurfaceOrPolygon),Surface:P($.prototype.writeSurfaceOrPolygon),MultiSurface:P($.prototype.writeMultiSurfaceOrPolygon),Envelope:P($.prototype.writeEnvelope)}};const $e=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],pR="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",mR={rte:Yb,trk:jb,wpt:Xb},bR=X($e,{rte:ue(Yb),trk:ue(jb),wpt:ue(Xb)}),yR=X($e,{text:N(ne,"linkText"),type:N(ne,"linkType")}),vR=X($e,{name:N(ne),email:YR,link:ua}),wR=X($e,{name:N(ne),desc:N(ne),author:N(VR),copyright:N(WR),link:ua,time:N(ah),keywords:N(ne),bounds:UR,extensions:lh}),ER=X($e,{year:N(lt),license:N(ne)}),_R=X($e,{rte:P(ZR),trk:P(KR),wpt:P(JR)});class d2 extends ha{constructor(e){super(),e=e||{},this.dataProjection=we("EPSG:4326"),this.readExtensions_=e.readExtensions}handleReadExtensions_(e){e||(e=[]);for(let t=0,i=e.length;t<i;++t){const n=e[t];if(this.readExtensions_){const s=n.get("extensionsNode_")||null;this.readExtensions_(n,s)}n.set("extensionsNode_",void 0)}}readMetadata(e){return e?typeof e=="string"?this.readMetadataFromDocument(vi(e)):yi(e)?this.readMetadataFromDocument(e):this.readMetadataFromNode(e):null}readMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType===Node.ELEMENT_NODE){const i=this.readMetadataFromNode(t);if(i)return i}return null}readMetadataFromNode(e){if(!$e.includes(e.namespaceURI))return null;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if($e.includes(t.namespaceURI)&&t.localName==="metadata")return Z({},wR,t,[]);return null}readFeatureFromNode(e,t){if(!$e.includes(e.namespaceURI))return null;const i=mR[e.localName];if(!i)return null;const n=i(e,[this.getReadOptions(e,t)]);return n?(this.handleReadExtensions_([n]),n):null}readFeaturesFromNode(e,t){if(!$e.includes(e.namespaceURI))return[];if(e.localName=="gpx"){const i=Z([],bR,e,[this.getReadOptions(e,t)]);return i?(this.handleReadExtensions_(i),i):[]}return[]}writeFeaturesNode(e,t){t=this.adaptOptions(t);const i=ve("http://www.topografix.com/GPX/1/1","gpx");return i.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",Gr),i.setAttributeNS(Gr,"xsi:schemaLocation",pR),i.setAttribute("version","1.1"),i.setAttribute("creator","OpenLayers"),ye({node:i},_R,HR,e,[t]),i}}const CR=X($e,{name:N(ne),cmt:N(ne),desc:N(ne),src:N(ne),link:ua,number:N(lt),extensions:lh,type:N(ne),rtept:jR}),xR=X($e,{ele:N(ke),time:N(ah)}),RR=X($e,{name:N(ne),cmt:N(ne),desc:N(ne),src:N(ne),link:ua,number:N(lt),type:N(ne),extensions:lh,trkseg:$R}),SR=X($e,{trkpt:XR}),TR=X($e,{ele:N(ke),time:N(ah)}),MR=X($e,{ele:N(ke),time:N(ah),magvar:N(ke),geoidheight:N(ke),name:N(ne),cmt:N(ne),desc:N(ne),src:N(ne),link:ua,sym:N(ne),type:N(ne),fix:N(ne),sat:N(lt),hdop:N(ke),vdop:N(ke),pdop:N(ke),ageofdgpsdata:N(ke),dgpsid:N(lt),extensions:lh}),LR=["text","type"],AR=X($e,{text:P(be),type:P(be)}),IR=X($e,["name","cmt","desc","src","link","number","type","rtept"]),PR=X($e,{name:P(be),cmt:P(be),desc:P(be),src:P(be),link:P(Xd),number:P(pl),type:P(be),rtept:Wb(P($d))}),FR=X($e,["ele","time"]),OR=X($e,["name","cmt","desc","src","link","number","type","trkseg"]),DR=X($e,{name:P(be),cmt:P(be),desc:P(be),src:P(be),link:P(Xd),number:P(pl),type:P(be),trkseg:Wb(P(qR))}),kR=Qe("trkpt"),NR=X($e,{trkpt:P($d)}),zR=X($e,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),BR=X($e,{ele:P(Ht),time:P(uR),magvar:P(Ht),geoidheight:P(Ht),name:P(be),cmt:P(be),desc:P(be),src:P(be),link:P(Xd),sym:P(be),type:P(be),fix:P(be),sat:P(pl),hdop:P(Ht),vdop:P(Ht),pdop:P(Ht),ageofdgpsdata:P(Ht),dgpsid:P(pl)}),GR={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function HR(r,e,t){const i=r.getGeometry();if(i){const n=GR[i.getType()];if(n){const s=e[e.length-1].node;return ve(s.namespaceURI,n)}}}function Yd(r,e,t,i){return r.push(parseFloat(t.getAttribute("lon")),parseFloat(t.getAttribute("lat"))),"ele"in i?(r.push(i.ele),delete i.ele,e.hasZ=!0):r.push(0),"time"in i?(r.push(i.time),delete i.time,e.hasM=!0):r.push(0),r}function jd(r,e,t){let i="XY",n=2;if(r.hasZ&&r.hasM?(i="XYZM",n=4):r.hasZ?(i="XYZ",n=3):r.hasM&&(i="XYM",n=3),n!==4){for(let s=0,o=e.length/4;s<o;s++)e[s*n]=e[s*4],e[s*n+1]=e[s*4+1],r.hasZ&&(e[s*n+2]=e[s*4+2]),r.hasM&&(e[s*n+2]=e[s*4+3]);if(e.length=e.length/4*n,t)for(let s=0,o=t.length;s<o;s++)t[s]=t[s]/4*n}return i}function VR(r,e){const t=Z({},vR,r,e);if(t)return t}function WR(r,e){const t=Z({},ER,r,e);if(t){const i=r.getAttribute("author");return i!==null&&(t.author=i),t}}function UR(r,e){const t=e[e.length-1],i=r.getAttribute("minlat"),n=r.getAttribute("minlon"),s=r.getAttribute("maxlat"),o=r.getAttribute("maxlon");n!==null&&i!==null&&o!==null&&s!==null&&(t.bounds=[[parseFloat(n),parseFloat(i)],[parseFloat(o),parseFloat(s)]])}function YR(r,e){const t=e[e.length-1],i=r.getAttribute("id"),n=r.getAttribute("domain");i!==null&&n!==null&&(t.email=`${i}@${n}`)}function ua(r,e){const t=e[e.length-1],i=r.getAttribute("href");i!==null&&(t.link=i),Zt(yR,r,e)}function lh(r,e){const t=e[e.length-1];t.extensionsNode_=r}function jR(r,e){const t=Z({},xR,r,e);if(t){const i=e[e.length-1],n=i.flatCoordinates,s=i.layoutOptions;Yd(n,s,r,t)}}function XR(r,e){const t=Z({},TR,r,e);if(t){const i=e[e.length-1],n=i.flatCoordinates,s=i.layoutOptions;Yd(n,s,r,t)}}function $R(r,e){const t=e[e.length-1];Zt(SR,r,e);const i=t.flatCoordinates;t.ends.push(i.length)}function Yb(r,e){const t=e[0],i=Z({flatCoordinates:[],layoutOptions:{}},CR,r,e);if(!i)return;const n=i.flatCoordinates;delete i.flatCoordinates;const s=i.layoutOptions;delete i.layoutOptions;const o=jd(s,n),a=new Kt(n,o);Et(a,!1,t);const l=new Ti(a);return l.setProperties(i,!0),l}function jb(r,e){const t=e[0],i=Z({flatCoordinates:[],ends:[],layoutOptions:{}},RR,r,e);if(!i)return;const n=i.flatCoordinates;delete i.flatCoordinates;const s=i.ends;delete i.ends;const o=i.layoutOptions;delete i.layoutOptions;const a=jd(o,n,s),l=new Bi(n,a,s);Et(l,!1,t);const h=new Ti(l);return h.setProperties(i,!0),h}function Xb(r,e){const t=e[0],i=Z({},MR,r,e);if(!i)return;const n={},s=Yd([],n,r,i),o=jd(n,s),a=new Ni(s,o);Et(a,!1,t);const l=new Ti(a);return l.setProperties(i,!0),l}function Xd(r,e,t){r.setAttribute("href",e);const n=t[t.length-1].properties,s=[n.linkText,n.linkType];ye({node:r},AR,pt,s,t,LR)}function $d(r,e,t){const i=t[t.length-1],s=i.node.namespaceURI,o=i.properties;switch(r.setAttributeNS(null,"lat",String(e[1])),r.setAttributeNS(null,"lon",String(e[0])),i.geometryLayout){case"XYZM":e[3]!==0&&(o.time=e[3]);case"XYZ":e[2]!==0&&(o.ele=e[2]);break;case"XYM":e[2]!==0&&(o.time=e[2]);break}const l=r.nodeName=="rtept"?FR[s]:zR[s],h=qt(o,l);ye({node:r,properties:o},BR,pt,h,t,l)}function ZR(r,e,t){const i=t[0],n=e.getProperties(),s={node:r};s.properties=n;const o=e.getGeometry();if(o.getType()=="LineString"){const u=Et(o,!0,i);s.geometryLayout=u.getLayout(),n.rtept=u.getCoordinates()}const a=t[t.length-1].node,l=IR[a.namespaceURI],h=qt(n,l);ye(s,PR,pt,h,t,l)}function KR(r,e,t){const i=t[0],n=e.getProperties(),s={node:r};s.properties=n;const o=e.getGeometry();if(o.getType()=="MultiLineString"){const u=Et(o,!0,i);n.trkseg=u.getLineStrings()}const a=t[t.length-1].node,l=OR[a.namespaceURI],h=qt(n,l);ye(s,DR,pt,h,t,l)}function qR(r,e,t){const i={node:r};i.geometryLayout=e.getLayout(),i.properties={},ye(i,NR,kR,e.getCoordinates(),t)}function JR(r,e,t){const i=t[0],n=t[t.length-1];n.properties=e.getProperties();const s=e.getGeometry();if(s.getType()=="Point"){const o=Et(s,!0,i);n.geometryLayout=o.getLayout(),$d(r,o.getCoordinates(),t)}}class QR extends oh{constructor(){super()}getType(){return"text"}readFeature(e,t){return this.readFeatureFromText(Ra(e),this.adaptOptions(t))}readFeatureFromText(e,t){return ge()}readFeatures(e,t){return this.readFeaturesFromText(Ra(e),this.adaptOptions(t))}readFeaturesFromText(e,t){return ge()}readGeometry(e,t){return this.readGeometryFromText(Ra(e),this.adaptOptions(t))}readGeometryFromText(e,t){return ge()}readProjection(e){return this.readProjectionFromText(Ra(e))}readProjectionFromText(e){return this.dataProjection}writeFeature(e,t){return this.writeFeatureText(e,this.adaptOptions(t))}writeFeatureText(e,t){return ge()}writeFeatures(e,t){return this.writeFeaturesText(e,this.adaptOptions(t))}writeFeaturesText(e,t){return ge()}writeGeometry(e,t){return this.writeGeometryText(e,this.adaptOptions(t))}writeGeometryText(e,t){return ge()}}function Ra(r){return typeof r=="string"?r:""}const e1=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,t1=/^H.([A-Z]{3}).*?:(.*)/,i1=/^HFDTE(\d{2})(\d{2})(\d{2})/,n1=/\r\n|\r|\n/;class f2 extends QR{constructor(e){super(),e=e||{},this.dataProjection=we("EPSG:4326"),this.altitudeMode_=e.altitudeMode?e.altitudeMode:"none"}readFeatureFromText(e,t){const i=this.altitudeMode_,n=e.split(n1),s={},o=[];let a=2e3,l=0,h=1,u=-1,c,d;for(c=0,d=n.length;c<d;++c){const w=n[c];let y;if(w.charAt(0)=="B"){if(y=e1.exec(w),y){const E=parseInt(y[1],10),x=parseInt(y[2],10),v=parseInt(y[3],10);let S=parseInt(y[4],10)+parseInt(y[5],10)/6e4;y[6]=="S"&&(S=-S);let R=parseInt(y[7],10)+parseInt(y[8],10)/6e4;if(y[9]=="W"&&(R=-R),o.push(R,S),i!="none"){let C;i=="gps"?C=parseInt(y[11],10):i=="barometric"?C=parseInt(y[12],10):C=0,o.push(C)}let L=Date.UTC(a,l,h,E,x,v);L<u&&(L=Date.UTC(a,l,h+1,E,x,v)),o.push(L/1e3),u=L}}else w.charAt(0)=="H"&&(y=i1.exec(w),y?(h=parseInt(y[1],10),l=parseInt(y[2],10)-1,a=2e3+parseInt(y[3],10)):(y=t1.exec(w),y&&(s[y[1]]=y[2].trim())))}if(o.length===0)return null;const f=i=="none"?"XYM":"XYZM",g=new Kt(o,f),m=new Ti(Et(g,!1,t));return m.setProperties(s,!0),m}readFeaturesFromText(e,t){const i=this.readFeatureFromText(e,t);return i?[i]:[]}}const Dn=["http://www.google.com/kml/ext/2.2"],le=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],r1="http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd",Hg={fraction:"fraction",pixels:"pixels",insetPixels:"pixels"},s1=X(le,{ExtendedData:ly,Region:hy,MultiGeometry:N(sy,"geometry"),LineString:N(ny,"geometry"),LinearRing:N(ry,"geometry"),Point:N(oy,"geometry"),Polygon:N(ay,"geometry"),Style:N(qd),StyleMap:H1,address:N(ne),description:N(ne),name:N(ne),open:N(ar),phoneNumber:N(ne),styleUrl:N(Jb),visibility:N(ar)},X(Dn,{MultiTrack:N(M1,"geometry"),Track:N(iy,"geometry")})),o1=X(le,{ExtendedData:ly,Region:hy,Link:Q1,address:N(ne),description:N(ne),name:N(ne),open:N(ar),phoneNumber:N(ne),visibility:N(ar)}),a1=X(le,{href:N(qb)}),l1=X(le,{Altitude:N(ke),Longitude:N(ke),Latitude:N(ke),Tilt:N(ke),AltitudeMode:N(ne),Heading:N(ke),Roll:N(ke)}),$b=X(le,{LatLonAltBox:j1,Lod:$1}),h1=X(le,["Document","Placemark"]),u1=X(le,{Document:P(aS),Placemark:P(dy)});let bs,Ga=null,ku,yo,vo,wo,ml,Nu=null,Zd,zu=null,Bu,Tr=null,Vg=null,Gu=null;function bl(r){return 32/Math.min(r[0],r[1])}function c1(){bs=[255,255,255,1],Ga=new nn({color:bs}),ku=[20,2],yo="pixels",vo="pixels",wo=[64,64],ml="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",Nu=new jr({anchor:ku,anchorOrigin:"bottom-left",anchorXUnits:yo,anchorYUnits:vo,crossOrigin:"anonymous",rotation:0,scale:bl(wo),size:wo,src:ml}),Zd="NO_IMAGE",zu=new ki({color:bs,width:1}),Bu=new ki({color:[51,51,51,1],width:2}),Tr=new na({font:"bold 16px Helvetica",fill:Ga,stroke:Bu,scale:.8}),Vg=new vt({fill:Ga,image:Nu,text:Tr,stroke:zu,zIndex:0}),Gu=[Vg]}let Sa;function d1(r){return r}class g2 extends ha{constructor(e){super(),e=e||{},Gu||c1(),this.dataProjection=we("EPSG:4326"),this.defaultStyle_=e.defaultStyle?e.defaultStyle:Gu,this.extractStyles_=e.extractStyles!==void 0?e.extractStyles:!0,this.writeStyles_=e.writeStyles!==void 0?e.writeStyles:!0,this.sharedStyles_={},this.showPointNames_=e.showPointNames!==void 0?e.showPointNames:!0,this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",this.iconUrlFunction_=e.iconUrlFunction?e.iconUrlFunction:d1,this.supportedMediaTypes=["application/vnd.google-earth.kml+xml"]}readDocumentOrFolder_(e,t){const i=X(le,{Document:gl(this.readDocumentOrFolder_,this),Folder:gl(this.readDocumentOrFolder_,this),Placemark:ue(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),n=Z([],i,e,t,this);if(n)return n}readPlacemark_(e,t){const i=Z({geometry:null},s1,e,t,this);if(!i)return;const n=new Ti,s=e.getAttribute("id");s!==null&&n.setId(s);const o=t[0],a=i.geometry;if(a&&Et(a,!1,o),n.setGeometry(a),delete i.geometry,this.extractStyles_){const l=i.Style,h=i.styleUrl,u=g1(l,h,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);n.setStyle(u)}return delete i.Style,n.setProperties(i,!0),n}readSharedStyle_(e,t){const i=e.getAttribute("id");if(i!==null){const n=qd.call(this,e,t);if(n){let s,o=e.baseURI;(!o||o=="about:blank")&&(o=window.location.href),o?s=new URL("#"+i,o).href:s="#"+i,this.sharedStyles_[s]=n}}}readSharedStyleMap_(e,t){const i=e.getAttribute("id");if(i===null)return;const n=ey.call(this,e,t);if(!n)return;let s,o=e.baseURI;(!o||o=="about:blank")&&(o=window.location.href),o?s=new URL("#"+i,o).href:s="#"+i,this.sharedStyles_[s]=n}readFeatureFromNode(e,t){if(!le.includes(e.namespaceURI))return null;const i=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return i||null}readFeaturesFromNode(e,t){if(!le.includes(e.namespaceURI))return[];let i;const n=e.localName;if(n=="Document"||n=="Folder")return i=this.readDocumentOrFolder_(e,[this.getReadOptions(e,t)]),i||[];if(n=="Placemark"){const s=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return s?[s]:[]}if(n=="kml"){i=[];for(let s=e.firstElementChild;s;s=s.nextElementSibling){const o=this.readFeaturesFromNode(s,t);o&&Fe(i,o)}return i}return[]}readName(e){if(e){if(typeof e=="string"){const t=vi(e);return this.readNameFromDocument(t)}return yi(e)?this.readNameFromDocument(e):this.readNameFromNode(e)}}readNameFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE){const i=this.readNameFromNode(t);if(i)return i}}readNameFromNode(e){for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(le.includes(t.namespaceURI)&&t.localName=="name")return ne(t);for(let t=e.firstElementChild;t;t=t.nextElementSibling){const i=t.localName;if(le.includes(t.namespaceURI)&&(i=="Document"||i=="Folder"||i=="Placemark"||i=="kml")){const n=this.readNameFromNode(t);if(n)return n}}}readNetworkLinks(e){const t=[];if(typeof e=="string"){const i=vi(e);Fe(t,this.readNetworkLinksFromDocument(i))}else yi(e)?Fe(t,this.readNetworkLinksFromDocument(e)):Fe(t,this.readNetworkLinksFromNode(e));return t}readNetworkLinksFromDocument(e){const t=[];for(let i=e.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&Fe(t,this.readNetworkLinksFromNode(i));return t}readNetworkLinksFromNode(e){const t=[];for(let i=e.firstElementChild;i;i=i.nextElementSibling)if(le.includes(i.namespaceURI)&&i.localName=="NetworkLink"){const n=Z({},o1,i,[]);t.push(n)}for(let i=e.firstElementChild;i;i=i.nextElementSibling){const n=i.localName;le.includes(i.namespaceURI)&&(n=="Document"||n=="Folder"||n=="kml")&&Fe(t,this.readNetworkLinksFromNode(i))}return t}readRegion(e){const t=[];if(typeof e=="string"){const i=vi(e);Fe(t,this.readRegionFromDocument(i))}else yi(e)?Fe(t,this.readRegionFromDocument(e)):Fe(t,this.readRegionFromNode(e));return t}readRegionFromDocument(e){const t=[];for(let i=e.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&Fe(t,this.readRegionFromNode(i));return t}readRegionFromNode(e){const t=[];for(let i=e.firstElementChild;i;i=i.nextElementSibling)if(le.includes(i.namespaceURI)&&i.localName=="Region"){const n=Z({},$b,i,[]);t.push(n)}for(let i=e.firstElementChild;i;i=i.nextElementSibling){const n=i.localName;le.includes(i.namespaceURI)&&(n=="Document"||n=="Folder"||n=="kml")&&Fe(t,this.readRegionFromNode(i))}return t}readCamera(e){const t=[];if(typeof e=="string"){const i=vi(e);Fe(t,this.readCameraFromDocument(i))}else yi(e)?Fe(t,this.readCameraFromDocument(e)):Fe(t,this.readCameraFromNode(e));return t}readCameraFromDocument(e){const t=[];for(let i=e.firstChild;i;i=i.nextSibling)i.nodeType===Node.ELEMENT_NODE&&Fe(t,this.readCameraFromNode(i));return t}readCameraFromNode(e){const t=[];for(let i=e.firstElementChild;i;i=i.nextElementSibling)if(le.includes(i.namespaceURI)&&i.localName==="Camera"){const n=Z({},l1,i,[]);t.push(n)}for(let i=e.firstElementChild;i;i=i.nextElementSibling){const n=i.localName;le.includes(i.namespaceURI)&&(n==="Document"||n==="Folder"||n==="Placemark"||n==="kml")&&Fe(t,this.readCameraFromNode(i))}return t}writeFeaturesNode(e,t){t=this.adaptOptions(t);const i=ve(le[4],"kml"),n="http://www.w3.org/2000/xmlns/";i.setAttributeNS(n,"xmlns:gx",Dn[0]),i.setAttributeNS(n,"xmlns:xsi",Gr),i.setAttributeNS(Gr,"xsi:schemaLocation",r1);const s={node:i},o={};e.length>1?o.Document=e:e.length==1&&(o.Placemark=e[0]);const a=h1[i.namespaceURI],l=qt(o,a);return ye(s,u1,pt,l,[t],a,this),i}}function f1(r,e){const t=[0,0];let i="start";const n=r.getImage();if(n){const a=n.getSize();if(a&&a.length==2){const l=n.getScaleArray(),h=n.getAnchor();t[0]=l[0]*(a[0]-h[0]),t[1]=l[1]*(a[1]/2-h[1]),i="left"}}let s=r.getText();return s?(s=s.clone(),s.setFont(s.getFont()||Tr.getFont()),s.setScale(s.getScale()||Tr.getScale()),s.setFill(s.getFill()||Tr.getFill()),s.setStroke(s.getStroke()||Bu)):s=Tr.clone(),s.setText(e),s.setOffsetX(t[0]),s.setOffsetY(t[1]),s.setTextAlign(i),new vt({image:n,text:s})}function g1(r,e,t,i,n){return function(s,o){let a=n,l="",h=[];if(a){const c=s.getGeometry();if(c)if(c instanceof sr)h=c.getGeometriesArrayRecursive().filter(function(d){const f=d.getType();return f==="Point"||f==="MultiPoint"}),a=h.length>0;else{const d=c.getType();a=d==="Point"||d==="MultiPoint"}}a&&(l=s.get("name"),a=a&&!!l,a&&/&[^&]+;/.test(l)&&(Sa||(Sa=document.createElement("textarea")),Sa.innerHTML=l,l=Sa.value));let u=t;if(r?u=r:e&&(u=Zb(e,t,i)),a){const c=f1(u[0],l);if(h.length>0){c.setGeometry(new sr(h));const d=new vt({geometry:u[0].getGeometry(),image:null,fill:u[0].getFill(),stroke:u[0].getStroke(),text:null});return[c,d].concat(u.slice(1))}return c}return u}}function Zb(r,e,t){return Array.isArray(r)?r:typeof r=="string"?Zb(t[r],e,t):e}function hh(r){const e=zt(r,!1),t=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(e);if(t){const i=t[1];return[parseInt(i.substr(6,2),16),parseInt(i.substr(4,2),16),parseInt(i.substr(2,2),16),parseInt(i.substr(0,2),16)/255]}}function Kb(r){let e=zt(r,!1);const t=[];e=e.replace(/\s*,\s*/g,",");const i=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i;let n;for(;n=i.exec(e);){const s=parseFloat(n[1]),o=parseFloat(n[2]),a=n[3]?parseFloat(n[3]):0;t.push(s,o,a),e=e.substr(n[0].length)}if(e==="")return t}function qb(r){const e=zt(r,!1).trim();let t=r.baseURI;return(!t||t=="about:blank")&&(t=window.location.href),t?new URL(e,t).href:e}function Jb(r){const e=zt(r,!1).trim().replace(/^(?!.*#)/,"#");let t=r.baseURI;return(!t||t=="about:blank")&&(t=window.location.href),t?new URL(e,t).href:e}function p1(r){const e=r.getAttribute("xunits"),t=r.getAttribute("yunits");let i;return e!=="insetPixels"?t!=="insetPixels"?i="bottom-left":i="top-left":t!=="insetPixels"?i="bottom-right":i="top-right",{x:parseFloat(r.getAttribute("x")),xunits:Hg[e],y:parseFloat(r.getAttribute("y")),yunits:Hg[t],origin:i}}function Qb(r){return ke(r)}const m1=X(le,{Pair:G1});function ey(r,e){return Z(void 0,m1,r,e,this)}const b1=X(le,{Icon:N(I1),color:N(hh),heading:N(ke),hotSpot:N(p1),scale:N(Qb)});function y1(r,e){const t=Z({},b1,r,e);if(!t)return;const i=e[e.length-1],n="Icon"in t?t.Icon:{},s=!("Icon"in t)||Object.keys(n).length>0;let o;const a=n.href;a?o=a:s&&(o=ml);let l,h,u,c="bottom-left";const d=t.hotSpot;d?(l=[d.x,d.y],h=d.xunits,u=d.yunits,c=d.origin):/^https?:\/\/maps\.(?:google|gstatic)\.com\//.test(o)&&(o.includes("pushpin")?(l=ku,h=yo,u=vo):o.includes("arrow-reverse")?(l=[54,42],h=yo,u=vo):o.includes("paddle")&&(l=[32,1],h=yo,u=vo));let f;const g=n.x,m=n.y;g!==void 0&&m!==void 0&&(f=[g,m]);let w;const y=n.w,E=n.h;y!==void 0&&E!==void 0&&(w=[y,E]);let x;const v=t.heading;v!==void 0&&(x=Ar(v));const S=t.scale,R=t.color;if(s){o==ml&&(w=wo);const L=new jr({anchor:l,anchorOrigin:c,anchorXUnits:h,anchorYUnits:u,crossOrigin:this.crossOrigin_,offset:f,offsetOrigin:"bottom-left",rotation:x,scale:S,size:w,src:this.iconUrlFunction_(o),color:R}),C=L.getScaleArray()[0],M=L.getSize();if(M===null){const D=L.getImageState();if(D===oe.IDLE||D===oe.LOADING){const A=function(){const k=L.getImageState();if(!(k===oe.IDLE||k===oe.LOADING)){const V=L.getSize();if(V&&V.length==2){const I=bl(V);L.setScale(C*I)}L.unlistenImageChange(A)}};L.listenImageChange(A),D===oe.IDLE&&L.load()}}else if(M.length==2){const D=bl(M);L.setScale(C*D)}i.imageStyle=L}else i.imageStyle=Zd}const v1=X(le,{color:N(hh),scale:N(Qb)});function w1(r,e){const t=Z({},v1,r,e);if(!t)return;const i=e[e.length-1],n=new na({fill:new nn({color:"color"in t?t.color:bs}),scale:t.scale});i.textStyle=n}const E1=X(le,{color:N(hh),width:N(ke)});function _1(r,e){const t=Z({},E1,r,e);if(!t)return;const i=e[e.length-1],n=new ki({color:"color"in t?t.color:bs,width:"width"in t?t.width:1});i.strokeStyle=n}const C1=X(le,{color:N(hh),fill:N(ar),outline:N(ar)});function x1(r,e){const t=Z({},C1,r,e);if(!t)return;const i=e[e.length-1],n=new nn({color:"color"in t?t.color:bs});i.fillStyle=n;const s=t.fill;s!==void 0&&(i.fill=s);const o=t.outline;o!==void 0&&(i.outline=o)}const R1=X(le,{coordinates:fe(Kb)});function ty(r,e){return Z(null,R1,r,e)}function S1(r,e){const i=e[e.length-1].coordinates,n=zt(r,!1),o=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(n);if(o){const a=parseFloat(o[1]),l=parseFloat(o[2]),h=parseFloat(o[3]);i.push([a,l,h])}else i.push([])}const T1=X(Dn,{Track:ue(iy)});function M1(r,e){const t=Z([],T1,r,e);if(t)return new Bi(t)}const L1=X(le,{when:eS},X(Dn,{coord:S1}));function iy(r,e){const t=Z({coordinates:[],whens:[]},L1,r,e);if(!t)return;const i=[],n=t.coordinates,s=t.whens;for(let o=0,a=Math.min(n.length,s.length);o<a;++o)n[o].length==3&&i.push(n[o][0],n[o][1],n[o][2],s[o]);return new Kt(i,"XYZM")}const A1=X(le,{href:N(qb)},X(Dn,{x:N(ke),y:N(ke),w:N(ke),h:N(ke)}));function I1(r,e){const t=Z({},A1,r,e);return t||null}const P1=X(le,{coordinates:fe(Kb)});function Kd(r,e){return Z(null,P1,r,e)}const uh=X(le,{extrude:N(ar),tessellate:N(ar),altitudeMode:N(ne)});function ny(r,e){const t=Z({},uh,r,e),i=Kd(r,e);if(i){const n=new Kt(i,"XYZ");return n.setProperties(t,!0),n}}function ry(r,e){const t=Z({},uh,r,e),i=Kd(r,e);if(i){const n=new At(i,"XYZ",[i.length]);return n.setProperties(t,!0),n}}const F1=X(le,{LineString:ue(ny),LinearRing:ue(ry),MultiGeometry:ue(sy),Point:ue(oy),Polygon:ue(ay)});function sy(r,e){const t=Z([],F1,r,e);if(!t)return null;if(t.length===0)return new sr(t);let i,n=!0;const s=t[0].getType();let o;for(let a=1,l=t.length;a<l;++a)if(o=t[a],o.getType()!=s){n=!1;break}if(n){let a,l;if(s=="Point"){const h=t[0];a=h.getLayout(),l=h.getFlatCoordinates();for(let u=1,c=t.length;u<c;++u)o=t[u],Fe(l,o.getFlatCoordinates());i=new dr(l,a),Xh(i,t)}else if(s=="LineString")i=new Bi(t),Xh(i,t);else if(s=="Polygon")i=new Pn(t),Xh(i,t);else if(s=="GeometryCollection")i=new sr(t);else throw new Error("Unknown geometry type found")}else i=new sr(t);return i}function oy(r,e){const t=Z({},uh,r,e),i=Kd(r,e);if(i){const n=new Ni(i,"XYZ");return n.setProperties(t,!0),n}}const O1=X(le,{innerBoundaryIs:K1,outerBoundaryIs:J1});function ay(r,e){const t=Z({},uh,r,e),i=Z([null],O1,r,e);if(i&&i[0]){const n=i[0],s=[n.length];for(let a=1,l=i.length;a<l;++a)Fe(n,i[a]),s.push(n.length);const o=new At(n,"XYZ",s);return o.setProperties(t,!0),o}}const D1=X(le,{IconStyle:y1,LabelStyle:w1,LineStyle:_1,PolyStyle:x1});function qd(r,e){const t=Z({},D1,r,e,this);if(!t)return null;let i="fillStyle"in t?t.fillStyle:Ga;const n=t.fill;n!==void 0&&!n&&(i=null);let s;"imageStyle"in t?t.imageStyle!=Zd&&(s=t.imageStyle):s=Nu;const o="textStyle"in t?t.textStyle:Tr,a="strokeStyle"in t?t.strokeStyle:zu,l=t.outline;return l!==void 0&&!l?[new vt({geometry:function(h){const u=h.getGeometry(),c=u.getType();if(c==="GeometryCollection"){const d=u;return new sr(d.getGeometriesArrayRecursive().filter(function(f){const g=f.getType();return g!=="Polygon"&&g!=="MultiPolygon"}))}if(c!=="Polygon"&&c!=="MultiPolygon")return u},fill:i,image:s,stroke:a,text:o,zIndex:void 0}),new vt({geometry:function(h){const u=h.getGeometry(),c=u.getType();if(c==="GeometryCollection"){const d=u;return new sr(d.getGeometriesArrayRecursive().filter(function(f){const g=f.getType();return g==="Polygon"||g==="MultiPolygon"}))}if(c==="Polygon"||c==="MultiPolygon")return u},fill:i,stroke:null,zIndex:void 0})]:[new vt({fill:i,image:s,stroke:a,text:o,zIndex:void 0})]}function Xh(r,e){const t=e.length,i=new Array(e.length),n=new Array(e.length),s=new Array(e.length);let o,a,l;o=!1,a=!1,l=!1;for(let h=0;h<t;++h){const u=e[h];i[h]=u.get("extrude"),n[h]=u.get("tessellate"),s[h]=u.get("altitudeMode"),o=o||i[h]!==void 0,a=a||n[h]!==void 0,l=l||s[h]}o&&r.set("extrude",i),a&&r.set("tessellate",n),l&&r.set("altitudeMode",s)}const k1=X(le,{displayName:N(ne),value:N(ne)});function N1(r,e){const t=r.getAttribute("name");Zt(k1,r,e);const i=e[e.length-1];t&&i.displayName?i[t]={value:i.value,displayName:i.displayName,toString:function(){return i.value}}:t!==null?i[t]=i.value:i.displayName!==null&&(i[i.displayName]=i.value),delete i.value}const z1=X(le,{Data:N1,SchemaData:W1});function ly(r,e){Zt(z1,r,e)}function hy(r,e){Zt($b,r,e)}const B1=X(le,{Style:N(qd),key:N(ne),styleUrl:N(Jb)});function G1(r,e){const t=Z({},B1,r,e,this);if(!t)return;const i=t.key;if(i&&i=="normal"){const n=t.styleUrl;n&&(e[e.length-1]=n);const s=t.Style;s&&(e[e.length-1]=s)}}function H1(r,e){const t=ey.call(this,r,e);if(!t)return;const i=e[e.length-1];if(Array.isArray(t))i.Style=t;else if(typeof t=="string")i.styleUrl=t;else throw new Error("`styleMapValue` has an unknown type")}const V1=X(le,{SimpleData:U1});function W1(r,e){Zt(V1,r,e)}function U1(r,e){const t=r.getAttribute("name");if(t!==null){const i=ne(r),n=e[e.length-1];n[t]=i}}const Y1=X(le,{altitudeMode:N(ne),minAltitude:N(ke),maxAltitude:N(ke),north:N(ke),south:N(ke),east:N(ke),west:N(ke)});function j1(r,e){const t=Z({},Y1,r,e);if(!t)return;const i=e[e.length-1],n=[parseFloat(t.west),parseFloat(t.south),parseFloat(t.east),parseFloat(t.north)];i.extent=n,i.altitudeMode=t.altitudeMode,i.minAltitude=parseFloat(t.minAltitude),i.maxAltitude=parseFloat(t.maxAltitude)}const X1=X(le,{minLodPixels:N(ke),maxLodPixels:N(ke),minFadeExtent:N(ke),maxFadeExtent:N(ke)});function $1(r,e){const t=Z({},X1,r,e);if(!t)return;const i=e[e.length-1];i.minLodPixels=parseFloat(t.minLodPixels),i.maxLodPixels=parseFloat(t.maxLodPixels),i.minFadeExtent=parseFloat(t.minFadeExtent),i.maxFadeExtent=parseFloat(t.maxFadeExtent)}const Z1=X(le,{LinearRing:ue(ty)});function K1(r,e){const t=Z([],Z1,r,e);t.length>0&&e[e.length-1].push(...t)}const q1=X(le,{LinearRing:fe(ty)});function J1(r,e){const t=Z(void 0,q1,r,e);if(t){const i=e[e.length-1];i[0]=t}}function Q1(r,e){Zt(a1,r,e)}function eS(r,e){const i=e[e.length-1].whens,n=zt(r,!1),s=Date.parse(n);i.push(isNaN(s)?0:s)}function ch(r,e){const t=Rn(e),n=[(t.length==4?t[3]:1)*255,t[2],t[1],t[0]];for(let s=0;s<4;++s){const o=Math.floor(n[s]).toString(16);n[s]=o.length==1?"0"+o:o}be(r,n.join(""))}function tS(r,e,t){const i=t[t.length-1],n=i.layout,s=i.stride;let o;if(n=="XY"||n=="XYM")o=2;else if(n=="XYZ"||n=="XYZM")o=3;else throw new Error("Invalid geometry layout");const a=e.length;let l="";if(a>0){l+=e[0];for(let h=1;h<o;++h)l+=","+e[h];for(let h=s;h<a;h+=s){l+=" "+e[h];for(let u=1;u<o;++u)l+=","+e[h+u]}}be(r,l)}const Ha=X(le,{Data:P(iS),value:P(rS),displayName:P(nS)});function iS(r,e,t){r.setAttribute("name",e.name);const i={node:r},n=e.value;typeof n=="object"?(n!==null&&n.displayName&&ye(i,Ha,pt,[n.displayName],t,["displayName"]),n!==null&&n.value&&ye(i,Ha,pt,[n.value],t,["value"])):ye(i,Ha,pt,[n],t,["value"])}function nS(r,e){hR(r,e)}function rS(r,e){be(r,e)}const sS=X(le,{Placemark:P(dy)}),oS=function(r,e,t){const i=e[e.length-1].node;return ve(i.namespaceURI,"Placemark")};function aS(r,e,t){ye({node:r},sS,oS,e,t,void 0,this)}const lS=Qe("Data");function hS(r,e,t){const i={node:r},n=e.names,s=e.values,o=n.length;for(let a=0;a<o;a++)ye(i,Ha,lS,[{name:n[a],value:s[a]}],t)}const Wg=X(le,["href"],X(Dn,["x","y","w","h"])),Ug=X(le,{href:P(be)},X(Dn,{x:P(Ht),y:P(Ht),w:P(Ht),h:P(Ht)})),uS=function(r,e,t){return ve(Dn[0],"gx:"+t)};function cS(r,e,t){const i={node:r},n=t[t.length-1].node;let s=Wg[n.namespaceURI],o=qt(e,s);ye(i,Ug,pt,o,t,s),s=Wg[Dn[0]],o=qt(e,s),ye(i,Ug,uS,o,t,s)}const dS=X(le,["scale","heading","Icon","color","hotSpot"]),fS=X(le,{Icon:P(cS),color:P(ch),heading:P(Ht),hotSpot:P(GS),scale:P(gy)});function gS(r,e,t){const i={node:r},n={},s=e.getSrc(),o=e.getSize(),a=e.getImageSize(),l={href:s};if(o){l.w=o[0],l.h=o[1];const w=e.getAnchor(),y=e.getOrigin();if(y&&a&&y[0]!==0&&y[1]!==o[1]&&(l.x=y[0],l.y=a[1]-(y[1]+o[1])),w&&(w[0]!==o[0]/2||w[1]!==o[1]/2)){const E={x:w[0],xunits:"pixels",y:o[1]-w[1],yunits:"pixels"};n.hotSpot=E}}n.Icon=l;let h=e.getScaleArray()[0],u=o;if(u===null&&(u=wo),u.length==2){const w=bl(u);h=h/w}h!==1&&(n.scale=h);const c=e.getRotation();c!==0&&(n.heading=c);const d=e.getColor();d&&(n.color=d);const f=t[t.length-1].node,g=dS[f.namespaceURI],m=qt(n,g);ye(i,fS,pt,m,t,g)}const pS=X(le,["color","scale"]),mS=X(le,{color:P(ch),scale:P(gy)});function bS(r,e,t){const i={node:r},n={},s=e.getFill();s&&(n.color=s.getColor());const o=e.getScale();o&&o!==1&&(n.scale=o);const a=t[t.length-1].node,l=pS[a.namespaceURI],h=qt(n,l);ye(i,mS,pt,h,t,l)}const yS=X(le,["color","width"]),vS=X(le,{color:P(ch),width:P(Ht)});function wS(r,e,t){const i={node:r},n={color:e.getColor(),width:Number(e.getWidth())||1},s=t[t.length-1].node,o=yS[s.namespaceURI],a=qt(n,o);ye(i,vS,pt,a,t,o)}const ES={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},uy=function(r,e,t){if(r){const i=e[e.length-1].node;return ve(i.namespaceURI,ES[r.getType()])}},_S=Qe("Point"),CS=Qe("LineString"),xS=Qe("LinearRing"),RS=Qe("Polygon"),SS=X(le,{LineString:P(ys),Point:P(ys),Polygon:P(fy),GeometryCollection:P(cy)});function cy(r,e,t){const i={node:r},n=e.getType();let s=[],o;if(n==="GeometryCollection")e.getGeometriesArrayRecursive().forEach(function(a){const l=a.getType();if(l==="MultiPoint")s=s.concat(a.getPoints());else if(l==="MultiLineString")s=s.concat(a.getLineStrings());else if(l==="MultiPolygon")s=s.concat(a.getPolygons());else if(l==="Point"||l==="LineString"||l==="Polygon")s.push(a);else throw new Error("Unknown geometry type")}),o=uy;else if(n==="MultiPoint")s=e.getPoints(),o=_S;else if(n==="MultiLineString")s=e.getLineStrings(),o=CS;else if(n==="MultiPolygon")s=e.getPolygons(),o=RS;else throw new Error("Unknown geometry type");ye(i,SS,o,s,t)}const TS=X(le,{LinearRing:P(ys)});function Yg(r,e,t){ye({node:r},TS,xS,[e],t)}const $h=X(le,{ExtendedData:P(hS),MultiGeometry:P(cy),LineString:P(ys),LinearRing:P(ys),Point:P(ys),Polygon:P(fy),Style:P(BS),address:P(be),description:P(be),name:P(be),open:P(Os),phoneNumber:P(be),styleUrl:P(be),visibility:P(Os)}),MS=X(le,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),LS=Qe("ExtendedData");function dy(r,e,t){const i={node:r};e.getId()&&r.setAttribute("id",e.getId());const n=e.getProperties(),s={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};s[e.getGeometryName()]=1;const o=Object.keys(n||{}).sort().filter(function(f){return!s[f]}),a=e.getStyleFunction();if(a){const f=a(e,0);if(f){const g=Array.isArray(f)?f:[f];let m=g;if(e.getGeometry()&&(m=g.filter(function(w){const y=w.getGeometryFunction()(e);if(y){const E=y.getType();return E==="GeometryCollection"?y.getGeometriesArrayRecursive().filter(function(x){const v=x.getType();return v==="Point"||v==="MultiPoint"}).length:E==="Point"||E==="MultiPoint"}})),this.writeStyles_){let w=g,y=g;e.getGeometry()&&(w=g.filter(function(E){const x=E.getGeometryFunction()(e);if(x){const v=x.getType();return v==="GeometryCollection"?x.getGeometriesArrayRecursive().filter(function(S){const R=S.getType();return R==="LineString"||R==="MultiLineString"}).length:v==="LineString"||v==="MultiLineString"}}),y=g.filter(function(E){const x=E.getGeometryFunction()(e);if(x){const v=x.getType();return v==="GeometryCollection"?x.getGeometriesArrayRecursive().filter(function(S){const R=S.getType();return R==="Polygon"||R==="MultiPolygon"}).length:v==="Polygon"||v==="MultiPolygon"}})),n.Style={pointStyles:m,lineStyles:w,polyStyles:y}}if(m.length&&n.name===void 0){const w=m[0].getText();w&&(n.name=w.getText())}}}const l=t[t.length-1].node,h=MS[l.namespaceURI],u=qt(n,h);if(ye(i,$h,pt,u,t,h),o.length>0){const f=qt(n,o);ye(i,$h,LS,[{names:o,values:f}],t)}const c=t[0];let d=e.getGeometry();d&&(d=Et(d,!0,c)),ye(i,$h,uy,[d],t)}const AS=X(le,["extrude","tessellate","altitudeMode","coordinates"]),IS=X(le,{extrude:P(Os),tessellate:P(Os),altitudeMode:P(be),coordinates:P(tS)});function ys(r,e,t){const i=e.getFlatCoordinates(),n={node:r};n.layout=e.getLayout(),n.stride=e.getStride();const s=e.getProperties();s.coordinates=i;const o=t[t.length-1].node,a=AS[o.namespaceURI],l=qt(s,a);ye(n,IS,pt,l,t,a)}const PS=X(le,["color","fill","outline"]),jg=X(le,{outerBoundaryIs:P(Yg),innerBoundaryIs:P(Yg)}),FS=Qe("innerBoundaryIs"),OS=Qe("outerBoundaryIs");function fy(r,e,t){const i=e.getLinearRings(),n=i.shift(),s={node:r};ye(s,jg,FS,i,t),ye(s,jg,OS,[n],t)}const DS=X(le,{color:P(ch),fill:P(Os),outline:P(Os)});function kS(r,e,t){const i={node:r},n=e.getFill(),s=e.getStroke(),o={color:n?n.getColor():void 0,fill:n?void 0:!1,outline:s?void 0:!1},a=t[t.length-1].node,l=PS[a.namespaceURI],h=qt(o,l);ye(i,DS,pt,h,t,l)}function gy(r,e){Ht(r,Math.round(e*1e6)/1e6)}const NS=X(le,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),zS=X(le,{IconStyle:P(gS),LabelStyle:P(bS),LineStyle:P(wS),PolyStyle:P(kS)});function BS(r,e,t){const i={node:r},n={};if(e.pointStyles.length){const l=e.pointStyles[0].getText();l&&(n.LabelStyle=l);const h=e.pointStyles[0].getImage();h&&typeof h.getSrc=="function"&&(n.IconStyle=h)}if(e.lineStyles.length){const l=e.lineStyles[0].getStroke();l&&(n.LineStyle=l)}if(e.polyStyles.length){const l=e.polyStyles[0].getStroke();l&&!n.LineStyle&&(n.LineStyle=l),n.PolyStyle=e.polyStyles[0]}const s=t[t.length-1].node,o=NS[s.namespaceURI],a=qt(n,o);ye(i,zS,pt,a,t,o)}function GS(r,e){r.setAttribute("x",String(e.x)),r.setAttribute("y",String(e.y)),r.setAttribute("xunits",e.xunits),r.setAttribute("yunits",e.yunits)}var dh={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */dh.read=function(r,e,t,i,n){var s,o,a=n*8-i-1,l=(1<<a)-1,h=l>>1,u=-7,c=t?n-1:0,d=t?-1:1,f=r[e+c];for(c+=d,s=f&(1<<-u)-1,f>>=-u,u+=a;u>0;s=s*256+r[e+c],c+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=i;u>0;o=o*256+r[e+c],c+=d,u-=8);if(s===0)s=1-h;else{if(s===l)return o?NaN:(f?-1:1)*(1/0);o=o+Math.pow(2,i),s=s-h}return(f?-1:1)*o*Math.pow(2,s-i)};dh.write=function(r,e,t,i,n,s){var o,a,l,h=s*8-n-1,u=(1<<h)-1,c=u>>1,d=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:s-1,g=i?1:-1,m=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+c>=1?e+=d/l:e+=d*Math.pow(2,1-c),e*l>=2&&(o++,l/=2),o+c>=u?(a=0,o=u):o+c>=1?(a=(e*l-1)*Math.pow(2,n),o=o+c):(a=e*Math.pow(2,c-1)*Math.pow(2,n),o=0));n>=8;r[t+f]=a&255,f+=g,a/=256,n-=8);for(o=o<<n|a,h+=n;h>0;r[t+f]=o&255,f+=g,o/=256,h-=8);r[t+f-g]|=m*128};var HS=ze,Ta=dh;function ze(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}ze.Varint=0;ze.Fixed64=1;ze.Bytes=2;ze.Fixed32=5;var Hu=65536*65536,Xg=1/Hu,VS=12,py=typeof TextDecoder>"u"?null:new TextDecoder("utf8");ze.prototype={destroy:function(){this.buf=null},readFields:function(r,e,t){for(t=t||this.length;this.pos<t;){var i=this.readVarint(),n=i>>3,s=this.pos;this.type=i&7,r(n,e,this),this.pos===s&&this.skip(i)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=Ma(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=Zg(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=Ma(this.buf,this.pos)+Ma(this.buf,this.pos+4)*Hu;return this.pos+=8,r},readSFixed64:function(){var r=Ma(this.buf,this.pos)+Zg(this.buf,this.pos+4)*Hu;return this.pos+=8,r},readFloat:function(){var r=Ta.read(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=Ta.read(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e=this.buf,t,i;return i=e[this.pos++],t=i&127,i<128||(i=e[this.pos++],t|=(i&127)<<7,i<128)||(i=e[this.pos++],t|=(i&127)<<14,i<128)||(i=e[this.pos++],t|=(i&127)<<21,i<128)?t:(i=e[this.pos],t|=(i&15)<<28,WS(t,r,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2===1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=VS&&py?nT(this.buf,e,r):iT(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==ze.Bytes)return r.push(this.readVarint(e));var t=fn(this);for(r=r||[];this.pos<t;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==ze.Bytes)return r.push(this.readSVarint());var e=fn(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==ze.Bytes)return r.push(this.readBoolean());var e=fn(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==ze.Bytes)return r.push(this.readFloat());var e=fn(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==ze.Bytes)return r.push(this.readDouble());var e=fn(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==ze.Bytes)return r.push(this.readFixed32());var e=fn(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==ze.Bytes)return r.push(this.readSFixed32());var e=fn(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==ze.Bytes)return r.push(this.readFixed64());var e=fn(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==ze.Bytes)return r.push(this.readSFixed64());var e=fn(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=r&7;if(e===ze.Varint)for(;this.buf[this.pos++]>127;);else if(e===ze.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ze.Fixed32)this.pos+=4;else if(e===ze.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),Qr(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),Qr(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),Qr(this.buf,r&-1,this.pos),Qr(this.buf,Math.floor(r*Xg),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),Qr(this.buf,r&-1,this.pos),Qr(this.buf,Math.floor(r*Xg),this.pos+4),this.pos+=8},writeVarint:function(r){if(r=+r||0,r>268435455||r<0){US(r,this);return}this.realloc(4),this.buf[this.pos++]=r&127|(r>127?128:0),!(r<=127)&&(this.buf[this.pos++]=(r>>>=7)&127|(r>127?128:0),!(r<=127)&&(this.buf[this.pos++]=(r>>>=7)&127|(r>127?128:0),!(r<=127)&&(this.buf[this.pos++]=r>>>7&127)))},writeSVarint:function(r){this.writeVarint(r<0?-r*2-1:r*2)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(r.length*4),this.pos++;var e=this.pos;this.pos=rT(this.buf,r,this.pos);var t=this.pos-e;t>=128&&$g(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(r){this.realloc(4),Ta.write(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),Ta.write(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var t=0;t<e;t++)this.buf[this.pos++]=r[t]},writeRawMessage:function(r,e){this.pos++;var t=this.pos;r(e,this);var i=this.pos-t;i>=128&&$g(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeMessage:function(r,e,t){this.writeTag(r,ze.Bytes),this.writeRawMessage(e,t)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,XS,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,$S,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,qS,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,ZS,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,KS,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,JS,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,QS,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,eT,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,tT,e)},writeBytesField:function(r,e){this.writeTag(r,ze.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,ze.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,ze.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,ze.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,ze.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,ze.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,ze.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,ze.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,ze.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,ze.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,!!e)}};function WS(r,e,t){var i=t.buf,n,s;if(s=i[t.pos++],n=(s&112)>>4,s<128||(s=i[t.pos++],n|=(s&127)<<3,s<128)||(s=i[t.pos++],n|=(s&127)<<10,s<128)||(s=i[t.pos++],n|=(s&127)<<17,s<128)||(s=i[t.pos++],n|=(s&127)<<24,s<128)||(s=i[t.pos++],n|=(s&1)<<31,s<128))return Jr(r,n,e);throw new Error("Expected varint not more than 10 bytes")}function fn(r){return r.type===ze.Bytes?r.readVarint()+r.pos:r.pos+1}function Jr(r,e,t){return t?e*4294967296+(r>>>0):(e>>>0)*4294967296+(r>>>0)}function US(r,e){var t,i;if(r>=0?(t=r%4294967296|0,i=r/4294967296|0):(t=~(-r%4294967296),i=~(-r/4294967296),t^4294967295?t=t+1|0:(t=0,i=i+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),YS(t,i,e),jS(i,e)}function YS(r,e,t){t.buf[t.pos++]=r&127|128,r>>>=7,t.buf[t.pos++]=r&127|128,r>>>=7,t.buf[t.pos++]=r&127|128,r>>>=7,t.buf[t.pos++]=r&127|128,r>>>=7,t.buf[t.pos]=r&127}function jS(r,e){var t=(r&7)<<4;e.buf[e.pos++]|=t|((r>>>=3)?128:0),r&&(e.buf[e.pos++]=r&127|((r>>>=7)?128:0),r&&(e.buf[e.pos++]=r&127|((r>>>=7)?128:0),r&&(e.buf[e.pos++]=r&127|((r>>>=7)?128:0),r&&(e.buf[e.pos++]=r&127|((r>>>=7)?128:0),r&&(e.buf[e.pos++]=r&127)))))}function $g(r,e,t){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));t.realloc(i);for(var n=t.pos-1;n>=r;n--)t.buf[n+i]=t.buf[n]}function XS(r,e){for(var t=0;t<r.length;t++)e.writeVarint(r[t])}function $S(r,e){for(var t=0;t<r.length;t++)e.writeSVarint(r[t])}function ZS(r,e){for(var t=0;t<r.length;t++)e.writeFloat(r[t])}function KS(r,e){for(var t=0;t<r.length;t++)e.writeDouble(r[t])}function qS(r,e){for(var t=0;t<r.length;t++)e.writeBoolean(r[t])}function JS(r,e){for(var t=0;t<r.length;t++)e.writeFixed32(r[t])}function QS(r,e){for(var t=0;t<r.length;t++)e.writeSFixed32(r[t])}function eT(r,e){for(var t=0;t<r.length;t++)e.writeFixed64(r[t])}function tT(r,e){for(var t=0;t<r.length;t++)e.writeSFixed64(r[t])}function Ma(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+r[e+3]*16777216}function Qr(r,e,t){r[t]=e,r[t+1]=e>>>8,r[t+2]=e>>>16,r[t+3]=e>>>24}function Zg(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}function iT(r,e,t){for(var i="",n=e;n<t;){var s=r[n],o=null,a=s>239?4:s>223?3:s>191?2:1;if(n+a>t)break;var l,h,u;a===1?s<128&&(o=s):a===2?(l=r[n+1],(l&192)===128&&(o=(s&31)<<6|l&63,o<=127&&(o=null))):a===3?(l=r[n+1],h=r[n+2],(l&192)===128&&(h&192)===128&&(o=(s&15)<<12|(l&63)<<6|h&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(l=r[n+1],h=r[n+2],u=r[n+3],(l&192)===128&&(h&192)===128&&(u&192)===128&&(o=(s&15)<<18|(l&63)<<12|(h&63)<<6|u&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,i+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),i+=String.fromCharCode(o),n+=a}return i}function nT(r,e,t){return py.decode(r.subarray(e,t))}function rT(r,e,t){for(var i=0,n,s;i<e.length;i++){if(n=e.charCodeAt(i),n>55295&&n<57344)if(s)if(n<56320){r[t++]=239,r[t++]=191,r[t++]=189,s=n;continue}else n=s-55296<<10|n-56320|65536,s=null;else{n>56319||i+1===e.length?(r[t++]=239,r[t++]=191,r[t++]=189):s=n;continue}else s&&(r[t++]=239,r[t++]=191,r[t++]=189,s=null);n<128?r[t++]=n:(n<2048?r[t++]=n>>6|192:(n<65536?r[t++]=n>>12|224:(r[t++]=n>>18|240,r[t++]=n>>12&63|128),r[t++]=n>>6&63|128),r[t++]=n&63|128)}return t}const sT=Vl(HS);class p2 extends oh{constructor(e){super(),e=e||{},this.dataProjection=new Pc({code:"",units:"tile-pixels"}),this.featureClass_=e.featureClass?e.featureClass:Pi,this.geometryName_=e.geometryName,this.layerName_=e.layerName?e.layerName:"layer",this.layers_=e.layers?e.layers:null,this.idProperty_=e.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(e,t,i,n){e.pos=t.geometry;const s=e.readVarint()+e.pos;let o=1,a=0,l=0,h=0,u=0,c=0;for(;e.pos<s;){if(!a){const d=e.readVarint();o=d&7,a=d>>3}if(a--,o===1||o===2)l+=e.readSVarint(),h+=e.readSVarint(),o===1&&u>c&&(n.push(u),c=u),i.push(l,h),u+=2;else if(o===7)u>c&&(i.push(i[c],i[c+1]),u+=2);else throw new Error("Invalid command found in the PBF")}u>c&&(n.push(u),c=u)}createFeature_(e,t,i){const n=t.type;if(n===0)return null;let s;const o=t.properties;let a;this.idProperty_?(a=o[this.idProperty_],delete o[this.idProperty_]):a=t.id,o[this.layerName_]=t.layer.name;const l=[],h=[];this.readRawGeometry_(e,t,l,h);const u=uT(n,h.length);if(this.featureClass_===Pi)s=new this.featureClass_(u,l,h,2,o,a),s.transform(i.dataProjection);else{let c;if(u=="Polygon"){const g=Jm(l,h);c=g.length>1?new Pn(l,"XY",g):new At(l,"XY",h)}else c=u==="Point"?new Ni(l,"XY"):u==="LineString"?new Kt(l,"XY"):u==="MultiPoint"?new dr(l,"XY"):u==="MultiLineString"?new Bi(l,"XY",h):null;const d=this.featureClass_;s=new d,this.geometryName_&&s.setGeometryName(this.geometryName_);const f=Et(c,!1,i);s.setGeometry(f),a!==void 0&&s.setId(a),s.setProperties(o,!0)}return s}getType(){return"arraybuffer"}readFeatures(e,t){const i=this.layers_;t=this.adaptOptions(t);const n=we(t.dataProjection);n.setWorldExtent(t.extent),t.dataProjection=n;const s=new sT(e),o=s.readFields(oT,{}),a=[];for(const l in o){if(i&&!i.includes(l))continue;const h=o[l],u=h?[0,0,h.extent,h.extent]:null;n.setExtent(u);for(let c=0,d=h.length;c<d;++c){const f=hT(s,h,c),g=this.createFeature_(s,f,t);g!==null&&a.push(g)}}return a}readProjection(e){return this.dataProjection}setLayers(e){this.layers_=e}}function oT(r,e,t){if(r===3){const i={keys:[],values:[],features:[]},n=t.readVarint()+t.pos;t.readFields(aT,i,n),i.length=i.features.length,i.length&&(e[i.name]=i)}}function aT(r,e,t){if(r===15)e.version=t.readVarint();else if(r===1)e.name=t.readString();else if(r===5)e.extent=t.readVarint();else if(r===2)e.features.push(t.pos);else if(r===3)e.keys.push(t.readString());else if(r===4){let i=null;const n=t.readVarint()+t.pos;for(;t.pos<n;)r=t.readVarint()>>3,i=r===1?t.readString():r===2?t.readFloat():r===3?t.readDouble():r===4?t.readVarint64():r===5?t.readVarint():r===6?t.readSVarint():r===7?t.readBoolean():null;e.values.push(i)}}function lT(r,e,t){if(r==1)e.id=t.readVarint();else if(r==2){const i=t.readVarint()+t.pos;for(;t.pos<i;){const n=e.layer.keys[t.readVarint()],s=e.layer.values[t.readVarint()];e.properties[n]=s}}else r==3?e.type=t.readVarint():r==4&&(e.geometry=t.pos)}function hT(r,e,t){r.pos=e.features[t];const i=r.readVarint()+r.pos,n={layer:e,type:0,properties:{}};return r.readFields(lT,n,i),n}function uT(r,e){let t;return r===1?t=e===1?"Point":"MultiPoint":r===2?t=e===1?"LineString":"MultiLineString":r===3&&(t="Polygon"),t}class my{read(e){if(!e)return null;if(typeof e=="string"){const t=vi(e);return this.readFromDocument(t)}return yi(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null}readFromNode(e){ge()}}const cT="http://www.w3.org/1999/xlink";function Jd(r){return r.getAttributeNS(cT,"href")}const Jt=[null,"http://www.opengis.net/ows/1.1"],dT=X(Jt,{ServiceIdentification:N(NT),ServiceProvider:N(BT),OperationsMetadata:N(DT)});class fT extends my{constructor(){super()}readFromNode(e){const t=Z({},dT,e,[]);return t||null}}const gT=X(Jt,{DeliveryPoint:N(ne),City:N(ne),AdministrativeArea:N(ne),PostalCode:N(ne),Country:N(ne),ElectronicMailAddress:N(ne)}),pT=X(Jt,{Value:Ut(GT)}),mT=X(Jt,{AllowedValues:N(MT)}),bT=X(Jt,{Phone:N(kT),Address:N(TT)}),yT=X(Jt,{HTTP:N(FT)}),vT=X(Jt,{Get:Ut(PT),Post:void 0}),wT=X(Jt,{DCP:N(IT)}),ET=X(Jt,{Operation:OT}),_T=X(Jt,{Voice:N(ne),Facsimile:N(ne)}),CT=X(Jt,{Constraint:Ut(LT)}),xT=X(Jt,{IndividualName:N(ne),PositionName:N(ne),ContactInfo:N(AT)}),RT=X(Jt,{Abstract:N(ne),AccessConstraints:N(ne),Fees:N(ne),Title:N(ne),ServiceTypeVersion:N(ne),ServiceType:N(ne)}),ST=X(Jt,{ProviderName:N(ne),ProviderSite:N(Jd),ServiceContact:N(zT)});function TT(r,e){return Z({},gT,r,e)}function MT(r,e){return Z({},pT,r,e)}function LT(r,e){const t=r.getAttribute("name");if(t)return Z({name:t},mT,r,e)}function AT(r,e){return Z({},bT,r,e)}function IT(r,e){return Z({},yT,r,e)}function PT(r,e){const t=Jd(r);if(t)return Z({href:t},CT,r,e)}function FT(r,e){return Z({},vT,r,e)}function OT(r,e){const t=r.getAttribute("name"),i=Z({},wT,r,e);if(!i)return;const n=e[e.length-1];n[t]=i}function DT(r,e){return Z({},ET,r,e)}function kT(r,e){return Z({},_T,r,e)}function NT(r,e){return Z({},RT,r,e)}function zT(r,e){return Z({},xT,r,e)}function BT(r,e){return Z({},ST,r,e)}function GT(r,e){return ne(r)}class m2 extends Hb{constructor(e){super(),e=e||{},this.layerName_=e.layerName,this.layers_=e.layers?e.layers:null,this.dataProjection=we(e.dataProjection?e.dataProjection:"EPSG:4326")}readFeaturesFromObject(e,t){if(e.type=="Topology"){const i=e;let n,s=null,o=null;i.transform&&(n=i.transform,s=n.scale,o=n.translate);const a=i.arcs;n&&ZT(a,s,o);const l=[],h=i.objects,u=this.layerName_;let c;for(const d in h)this.layers_&&!this.layers_.includes(d)||(h[d].type==="GeometryCollection"?(c=h[d],l.push.apply(l,$T(c,a,s,o,u,d,t))):(c=h[d],l.push(by(c,a,s,o,u,d,t))));return l}return[]}readProjectionFromObject(e){return this.dataProjection}}const HT={Point:VT,LineString:UT,Polygon:jT,MultiPoint:WT,MultiLineString:YT,MultiPolygon:XT};function fh(r,e){const t=[];let i;for(let n=0,s=r.length;n<s;++n)if(i=r[n],n>0&&t.pop(),i>=0){const o=e[i];for(let a=0,l=o.length;a<l;++a)t.push(o[a].slice(0))}else{const o=e[~i];for(let a=o.length-1;a>=0;--a)t.push(o[a].slice(0))}return t}function VT(r,e,t){const i=r.coordinates;return e&&t&&Qd(i,e,t),new Ni(i)}function WT(r,e,t){const i=r.coordinates;if(e&&t)for(let n=0,s=i.length;n<s;++n)Qd(i[n],e,t);return new dr(i)}function UT(r,e){const t=fh(r.arcs,e);return new Kt(t)}function YT(r,e){const t=[];for(let i=0,n=r.arcs.length;i<n;++i)t[i]=fh(r.arcs[i],e);return new Bi(t)}function jT(r,e){const t=[];for(let i=0,n=r.arcs.length;i<n;++i)t[i]=fh(r.arcs[i],e);return new At(t)}function XT(r,e){const t=[];for(let i=0,n=r.arcs.length;i<n;++i){const s=r.arcs[i],o=[];for(let a=0,l=s.length;a<l;++a)o[a]=fh(s[a],e);t[i]=o}return new Pn(t)}function $T(r,e,t,i,n,s,o){const a=r.geometries,l=[];for(let h=0,u=a.length;h<u;++h)l[h]=by(a[h],e,t,i,n,s,o);return l}function by(r,e,t,i,n,s,o){let a=null;const l=r.type;if(l){const c=HT[l];l==="Point"||l==="MultiPoint"?a=c(r,t,i):a=c(r,e),a=Et(a,!1,o)}const h=new Ti({geometry:a});r.id!==void 0&&h.setId(r.id);let u=r.properties;return n&&(u||(u={}),u[n]=s),u&&h.setProperties(u,!0),h}function ZT(r,e,t){for(let i=0,n=r.length;i<n;++i)KT(r[i],e,t)}function KT(r,e,t){let i=0,n=0;for(let s=0,o=r.length;s<o;++s){const a=r[s];i+=a[0],n+=a[1],a[0]=i,a[1]=n,Qd(a,e,t)}}function Qd(r,e,t){r[0]=r[0]*e[0]+t[0],r[1]=r[1]*e[1]+t[1]}class Ne extends ${constructor(e){e=e||{},super(e),this.schemaLocation=e.schemaLocation?e.schemaLocation:this.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd"}writeGeometryElement(e,t,i){const n=i[i.length-1];i[i.length-1]=Object.assign({multiCurve:!0,multiSurface:!0},n),super.writeGeometryElement(e,t,i)}}Ne.prototype.namespace="http://www.opengis.net/gml/3.2";Ne.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:fe($.prototype.readFlatPos),posList:fe($.prototype.readFlatPosList),coordinates:fe(Me.prototype.readFlatCoordinates)}};Ne.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:$.prototype.interiorParser,exterior:$.prototype.exteriorParser}};Ne.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:fe(ae.prototype.readPoint),MultiPoint:fe(ae.prototype.readMultiPoint),LineString:fe(ae.prototype.readLineString),MultiLineString:fe(ae.prototype.readMultiLineString),LinearRing:fe(ae.prototype.readLinearRing),Polygon:fe(ae.prototype.readPolygon),MultiPolygon:fe(ae.prototype.readMultiPolygon),Surface:fe(Ne.prototype.readSurface),MultiSurface:fe($.prototype.readMultiSurface),Curve:fe(Ne.prototype.readCurve),MultiCurve:fe($.prototype.readMultiCurve),Envelope:fe(Ne.prototype.readEnvelope)}};Ne.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml/3.2":{curveMember:ue($.prototype.curveMemberParser),curveMembers:ue($.prototype.curveMemberParser)}};Ne.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{surfaceMember:ue($.prototype.surfaceMemberParser),surfaceMembers:ue($.prototype.surfaceMemberParser)}};Ne.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:ue(ae.prototype.readLineString),Curve:ue($.prototype.readCurve)}};Ne.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:ue(ae.prototype.readPolygon),Surface:ue($.prototype.readSurface)}};Ne.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{patches:fe($.prototype.readPatch)}};Ne.prototype.CURVE_PARSERS={"http://www.opengis.net/gml/3.2":{segments:fe($.prototype.readSegment)}};Ne.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml/3.2":{lowerCorner:ue($.prototype.readFlatPosList),upperCorner:ue($.prototype.readFlatPosList)}};Ne.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml/3.2":{PolygonPatch:fe($.prototype.readPolygonPatch)}};Ne.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml/3.2":{LineStringSegment:gl($.prototype.readLineStringSegment)}};Ne.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml/3.2":{pointMember:ue(ae.prototype.pointMemberParser),pointMembers:ue(ae.prototype.pointMemberParser)}};Ne.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml/3.2":{lineStringMember:ue(ae.prototype.lineStringMemberParser),lineStringMembers:ue(ae.prototype.lineStringMemberParser)}};Ne.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml/3.2":{polygonMember:ue(ae.prototype.polygonMemberParser),polygonMembers:ue(ae.prototype.polygonMemberParser)}};Ne.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Point:ue(ae.prototype.readFlatCoordinatesFromNode)}};Ne.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:ue(ae.prototype.readLineString)}};Ne.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:ue(ae.prototype.readPolygon)}};Ne.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:fe(ae.prototype.readFlatLinearRing),Ring:fe(Ne.prototype.readFlatCurveRing)}};Ne.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml/3.2":{exterior:P($.prototype.writeRing),interior:P($.prototype.writeRing)}};Ne.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lowerCorner:P(be),upperCorner:P(be)}};Ne.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{surfaceMember:P($.prototype.writeSurfaceOrPolygonMember),polygonMember:P($.prototype.writeSurfaceOrPolygonMember)}};Ne.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{pointMember:P($.prototype.writePointMember)}};Ne.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lineStringMember:P($.prototype.writeLineStringOrCurveMember),curveMember:P($.prototype.writeLineStringOrCurveMember)}};Ne.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml/3.2":{Curve:P($.prototype.writeCurveOrLineString),MultiCurve:P($.prototype.writeMultiCurveOrLineString),Point:P(Ne.prototype.writePoint),MultiPoint:P($.prototype.writeMultiPoint),LineString:P($.prototype.writeCurveOrLineString),MultiLineString:P($.prototype.writeMultiCurveOrLineString),LinearRing:P($.prototype.writeLinearRing),Polygon:P($.prototype.writeSurfaceOrPolygon),MultiPolygon:P($.prototype.writeMultiSurfaceOrPolygon),Surface:P($.prototype.writeSurfaceOrPolygon),MultiSurface:P($.prototype.writeMultiSurfaceOrPolygon),Envelope:P($.prototype.writeEnvelope)}};const ef=Ne;let gh=class{constructor(e){this.tagName_=e}getTagName(){return this.tagName_}};class qT extends gh{constructor(e,t){super(e),this.conditions=t,Ae(this.conditions.length>=2,"At least 2 conditions are required")}}class JT extends qT{constructor(e){super("And",Array.prototype.slice.call(arguments))}}const QT=JT;class eM extends gh{constructor(e,t,i){if(super("BBOX"),this.geometryName=e,this.extent=t,t.length!==4)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");this.srsName=i}}class tf extends gh{constructor(e,t){super(e),this.propertyName=t}}class Xs extends tf{constructor(e,t,i,n){super(e,t),this.expression=i,this.matchCase=n}}class tM extends Xs{constructor(e,t,i){super("PropertyIsEqualTo",e,t,i)}}const iM=tM;class nM extends Xs{constructor(e,t){super("PropertyIsGreaterThan",e,t)}}const rM=nM;class sM extends Xs{constructor(e,t){super("PropertyIsGreaterThanOrEqualTo",e,t)}}const oM=sM;class aM extends tf{constructor(e,t,i,n,s,o){super("PropertyIsLike",e),this.pattern=t,this.wildCard=i!==void 0?i:"*",this.singleChar=n!==void 0?n:".",this.escapeChar=s!==void 0?s:"!",this.matchCase=o}}const lM=aM;class hM extends tf{constructor(e){super("PropertyIsNull",e)}}const uM=hM;class cM extends Xs{constructor(e,t){super("PropertyIsLessThan",e,t)}}const dM=cM;class fM extends Xs{constructor(e,t){super("PropertyIsLessThanOrEqualTo",e,t)}}const gM=fM;class pM extends gh{constructor(e){super("Not"),this.condition=e}}const mM=pM;class bM extends Xs{constructor(e,t,i){super("PropertyIsNotEqualTo",e,t,i)}}const yM=bM;function vM(r){const e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(QT,e))}function y2(r){return new mM(r)}function wM(r,e,t){return new eM(r,e,t)}function v2(r,e,t){return new iM(r,e,t)}function w2(r,e,t){return new yM(r,e,t)}function E2(r,e){return new dM(r,e)}function _2(r,e){return new gM(r,e)}function C2(r,e){return new rM(r,e)}function x2(r,e){return new oM(r,e)}function R2(r){return new uM(r)}function S2(r,e,t,i,n,s){return new lM(r,e,t,i,n,s)}const Kg={"http://www.opengis.net/gml":{boundedBy:N(ae.prototype.readExtentElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:ue(ae.prototype.readFeaturesInternal)}},EM={"http://www.opengis.net/wfs":{totalInserted:N(lt),totalUpdated:N(lt),totalDeleted:N(lt)},"http://www.opengis.net/wfs/2.0":{totalInserted:N(lt),totalUpdated:N(lt),totalDeleted:N(lt)}},_M={"http://www.opengis.net/wfs":{TransactionSummary:N(Jg,"transactionSummary"),InsertResults:N(ep,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:N(Jg,"transactionSummary"),InsertResults:N(ep,"insertIds")}},CM={"http://www.opengis.net/wfs":{PropertyName:P(be)},"http://www.opengis.net/wfs/2.0":{PropertyName:P(be)}},yy={"http://www.opengis.net/wfs":{Insert:P(tp),Update:P(np),Delete:P(ip),Property:P(rp),Native:P(sp)},"http://www.opengis.net/wfs/2.0":{Insert:P(tp),Update:P(np),Delete:P(ip),Property:P(rp),Native:P(sp)}},vy="feature",nf="http://www.w3.org/2000/xmlns/",rf={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},Vu={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},sf={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},qg={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},of={"2.0.0":ef,"1.1.0":$,"1.0.0":Me},xM="1.1.0";class T2 extends ha{constructor(e){super(),e=e||{},this.version_=e.version?e.version:xM,this.featureType_=e.featureType,this.featureNS_=e.featureNS,this.gmlFormat_=e.gmlFormat?e.gmlFormat:new of[this.version_],this.schemaLocation_=e.schemaLocation?e.schemaLocation:qg[this.version_]}getFeatureType(){return this.featureType_}setFeatureType(e){this.featureType_=e}readFeaturesFromNode(e,t){const i={node:e};Object.assign(i,{featureType:this.featureType_,featureNS:this.featureNS_}),Object.assign(i,this.getReadOptions(e,t||{}));const n=[i];let s;this.version_==="2.0.0"?s=Kg:s=this.gmlFormat_.FEATURE_COLLECTION_PARSERS;let o=Z([],s,e,n,this.gmlFormat_);return o||(o=[]),o}readTransactionResponse(e){if(e){if(typeof e=="string"){const t=vi(e);return this.readTransactionResponseFromDocument(t)}return yi(e)?this.readTransactionResponseFromDocument(e):this.readTransactionResponseFromNode(e)}}readFeatureCollectionMetadata(e){if(e){if(typeof e=="string"){const t=vi(e);return this.readFeatureCollectionMetadataFromDocument(t)}return yi(e)?this.readFeatureCollectionMetadataFromDocument(e):this.readFeatureCollectionMetadataFromNode(e)}}readFeatureCollectionMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(t)}readFeatureCollectionMetadataFromNode(e){const t={},i=hs(e.getAttribute("numberOfFeatures"));return t.numberOfFeatures=i,Z(t,Kg,e,[],this.gmlFormat_)}readTransactionResponseFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(t)}readTransactionResponseFromNode(e){return Z({},_M,e,[])}writeGetFeature(e){const t=ve(Vu[this.version_],"GetFeature");t.setAttribute("service","WFS"),t.setAttribute("version",this.version_),e.handle&&t.setAttribute("handle",e.handle),e.outputFormat&&t.setAttribute("outputFormat",e.outputFormat),e.maxFeatures!==void 0&&t.setAttribute("maxFeatures",String(e.maxFeatures)),e.resultType&&t.setAttribute("resultType",e.resultType),e.startIndex!==void 0&&t.setAttribute("startIndex",String(e.startIndex)),e.count!==void 0&&t.setAttribute("count",String(e.count)),e.viewParams!==void 0&&t.setAttribute("viewParams",e.viewParams),t.setAttributeNS(Gr,"xsi:schemaLocation",this.schemaLocation_);const i={node:t};if(Object.assign(i,{version:this.version_,srsName:e.srsName,featureNS:e.featureNS?e.featureNS:this.featureNS_,featurePrefix:e.featurePrefix,propertyNames:e.propertyNames?e.propertyNames:[]}),Ae(Array.isArray(e.featureTypes),"`options.featureTypes` must be an Array"),typeof e.featureTypes[0]=="string"){let n=e.filter;e.bbox&&(Ae(e.geometryName,"`options.geometryName` must also be provided when `options.bbox` is set"),n=this.combineBboxAndFilter(e.geometryName,e.bbox,e.srsName,n)),Object.assign(i,{geometryName:e.geometryName,filter:n}),pp(t,e.featureTypes,[i])}else e.featureTypes.forEach(n=>{const s=this.combineBboxAndFilter(n.geometryName,n.bbox,e.srsName,e.filter);Object.assign(i,{geometryName:n.geometryName,filter:s}),pp(t,[n.name],[i])});return t}combineBboxAndFilter(e,t,i,n){const s=wM(e,t,i);return n?vM(n,s):s}writeTransaction(e,t,i,n){const s=[],o=n.version?n.version:this.version_,a=ve(Vu[o],"Transaction");a.setAttribute("service","WFS"),a.setAttribute("version",o);let l;n&&(l=n.gmlOptions?n.gmlOptions:{},n.handle&&a.setAttribute("handle",n.handle)),a.setAttributeNS(Gr,"xsi:schemaLocation",qg[o]);const h=RM(a,l,o,n);return e&&La("Insert",e,s,h),t&&La("Update",t,s,h),i&&La("Delete",i,s,h),n.nativeElements&&La("Native",n.nativeElements,s,h),a}readProjectionFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(t);return null}readProjectionFromNode(e){if(e.firstElementChild&&e.firstElementChild.firstElementChild){e=e.firstElementChild.firstElementChild;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(!(t.childNodes.length===0||t.childNodes.length===1&&t.firstChild.nodeType===3)){const i=[{}];return this.gmlFormat_.readGeometryElement(t,i),we(i.pop().srsName)}}return null}}function RM(r,e,t,i){const n=i.featurePrefix?i.featurePrefix:vy;let s;return t==="1.0.0"?s=2:t==="1.1.0"?s=3:t==="2.0.0"&&(s=3.2),Object.assign({node:r},{version:t,featureNS:i.featureNS,featureType:i.featureType,featurePrefix:n,gmlVersion:s,hasZ:i.hasZ,srsName:i.srsName},e)}function La(r,e,t,i){ye(i,yy,Qe(r),e,t)}function Jg(r,e){return Z({},EM,r,e)}const SM={"http://www.opengis.net/ogc":{FeatureId:ue(function(r,e){return r.getAttribute("fid")})},"http://www.opengis.net/ogc/1.1":{FeatureId:ue(function(r,e){return r.getAttribute("fid")})}};function Qg(r,e){Zt(SM,r,e)}const TM={"http://www.opengis.net/wfs":{Feature:Qg},"http://www.opengis.net/wfs/2.0":{Feature:Qg}};function ep(r,e){return Z([],TM,r,e)}function tp(r,e,t){const i=t[t.length-1],n=i.featureType,s=i.featureNS,o=i.gmlVersion,a=ve(s,n);r.appendChild(a),o===2?Me.prototype.writeFeatureElement(a,e,t):o===3?$.prototype.writeFeatureElement(a,e,t):ef.prototype.writeFeatureElement(a,e,t)}function wy(r,e,t){const n=t[t.length-1].version,s=rf[n],o=ve(s,"Filter"),a=ve(s,"FeatureId");o.appendChild(a),a.setAttribute("fid",e),r.appendChild(o)}function af(r,e){r=r||vy;const t=r+":";return e.startsWith(t)?e:t+e}function ip(r,e,t){const i=t[t.length-1];Ae(e.getId()!==void 0,"Features must have an id set");const n=i.featureType,s=i.featurePrefix,o=i.featureNS,a=af(s,n);r.setAttribute("typeName",a),r.setAttributeNS(nf,"xmlns:"+s,o);const l=e.getId();l!==void 0&&wy(r,l,t)}function np(r,e,t){const i=t[t.length-1];Ae(e.getId()!==void 0,"Features must have an id set");const n=i.version,s=i.featureType,o=i.featurePrefix,a=i.featureNS,l=af(o,s),h=e.getGeometryName();r.setAttribute("typeName",l),r.setAttributeNS(nf,"xmlns:"+o,a);const u=e.getId();if(u!==void 0){const c=e.getKeys(),d=[];for(let f=0,g=c.length;f<g;f++){const m=e.get(c[f]);if(m!==void 0){let w=c[f];m&&typeof m.getSimplifiedGeometry=="function"&&(w=h),d.push({name:w,value:m})}}ye({version:n,gmlVersion:i.gmlVersion,node:r,hasZ:i.hasZ,srsName:i.srsName},yy,Qe("Property"),d,t),wy(r,u,t)}}function rp(r,e,t){const i=t[t.length-1],n=i.version,s=Vu[n],a=ve(s,n==="2.0.0"?"ValueReference":"Name"),l=i.gmlVersion;if(r.appendChild(a),be(a,e.name),e.value!==void 0&&e.value!==null){const h=ve(s,"Value");r.appendChild(h),e.value&&typeof e.value.getSimplifiedGeometry=="function"?l===2?Me.prototype.writeGeometryElement(h,e.value,t):l===3?$.prototype.writeGeometryElement(h,e.value,t):ef.prototype.writeGeometryElement(h,e.value,t):be(h,e.value)}}function sp(r,e,t){e.vendorId&&r.setAttribute("vendorId",e.vendorId),e.safeToIgnore!==void 0&&r.setAttribute("safeToIgnore",String(e.safeToIgnore)),e.value!==void 0&&be(r,e.value)}const ph={"http://www.opengis.net/wfs":{Query:P(op)},"http://www.opengis.net/wfs/2.0":{Query:P(op)},"http://www.opengis.net/ogc":{During:P(hp),And:P(Aa),Or:P(Aa),Not:P(up),BBOX:P(ap),Contains:P(Wn),Intersects:P(Wn),Within:P(Wn),DWithin:P(lp),PropertyIsEqualTo:P(di),PropertyIsNotEqualTo:P(di),PropertyIsLessThan:P(di),PropertyIsLessThanOrEqualTo:P(di),PropertyIsGreaterThan:P(di),PropertyIsGreaterThanOrEqualTo:P(di),PropertyIsNull:P(cp),PropertyIsBetween:P(dp),PropertyIsLike:P(fp)},"http://www.opengis.net/fes/2.0":{During:P(hp),And:P(Aa),Or:P(Aa),Not:P(up),BBOX:P(ap),Contains:P(Wn),Disjoint:P(Wn),Intersects:P(Wn),ResourceId:P(LM),Within:P(Wn),DWithin:P(lp),PropertyIsEqualTo:P(di),PropertyIsNotEqualTo:P(di),PropertyIsLessThan:P(di),PropertyIsLessThanOrEqualTo:P(di),PropertyIsGreaterThan:P(di),PropertyIsGreaterThanOrEqualTo:P(di),PropertyIsNull:P(cp),PropertyIsBetween:P(dp),PropertyIsLike:P(fp)}};function op(r,e,t){const i=t[t.length-1],n=i.version,s=i.featurePrefix,o=i.featureNS,a=i.propertyNames,l=i.srsName;let h;s?h=af(s,e):h=e;let u;n==="2.0.0"?u="typeNames":u="typeName",r.setAttribute(u,h),l&&r.setAttribute("srsName",l),o&&r.setAttributeNS(nf,"xmlns:"+s,o);const c=Object.assign({},i);c.node=r,ye(c,CM,Qe("PropertyName"),a,t);const d=i.filter;if(d){const f=ve(mh(n),"Filter");r.appendChild(f),MM(f,d,t)}}function MM(r,e,t){const i=t[t.length-1],n={node:r};Object.assign(n,{context:i}),ye(n,ph,Qe(e.getTagName()),[e],t)}function ap(r,e,t){const i=t[t.length-1],s=i.context.version;i.srsName=e.srsName;const o=of[s];$s(s,r,e.geometryName),o.prototype.writeGeometryElement(r,e.extent,t)}function LM(r,e,t){r.setAttribute("rid",e.rid)}function Wn(r,e,t){const i=t[t.length-1],s=i.context.version;i.srsName=e.srsName;const o=of[s];$s(s,r,e.geometryName),o.prototype.writeGeometryElement(r,e.geometry,t)}function lp(r,e,t){const s=t[t.length-1].context.version;Wn(r,e,t);const o=ve(mh(s),"Distance");be(o,e.distance.toString()),s==="2.0.0"?o.setAttribute("uom",e.unit):o.setAttribute("units",e.unit),r.appendChild(o)}function hp(r,e,t){const s=t[t.length-1].context.version;yl(sf[s],"ValueReference",r,e.propertyName);const o=ve(Mn,"TimePeriod");r.appendChild(o);const a=ve(Mn,"begin");o.appendChild(a),gp(a,e.begin);const l=ve(Mn,"end");o.appendChild(l),gp(l,e.end)}function Aa(r,e,t){const n=t[t.length-1].context,s={node:r};Object.assign(s,{context:n});const o=e.conditions;for(let a=0,l=o.length;a<l;++a){const h=o[a];ye(s,ph,Qe(h.getTagName()),[h],t)}}function up(r,e,t){const n=t[t.length-1].context,s={node:r};Object.assign(s,{context:n});const o=e.condition;ye(s,ph,Qe(o.getTagName()),[o],t)}function di(r,e,t){const s=t[t.length-1].context.version;e.matchCase!==void 0&&r.setAttribute("matchCase",e.matchCase.toString()),$s(s,r,e.propertyName),vl(s,r,""+e.expression)}function cp(r,e,t){const s=t[t.length-1].context.version;$s(s,r,e.propertyName)}function dp(r,e,t){const s=t[t.length-1].context.version,o=mh(s);$s(s,r,e.propertyName);const a=ve(o,"LowerBoundary");r.appendChild(a),vl(s,a,""+e.lowerBoundary);const l=ve(o,"UpperBoundary");r.appendChild(l),vl(s,l,""+e.upperBoundary)}function fp(r,e,t){const s=t[t.length-1].context.version;r.setAttribute("wildCard",e.wildCard),r.setAttribute("singleChar",e.singleChar),r.setAttribute("escapeChar",e.escapeChar),e.matchCase!==void 0&&r.setAttribute("matchCase",e.matchCase.toString()),$s(s,r,e.propertyName),vl(s,r,""+e.pattern)}function yl(r,e,t,i){const n=ve(r,e);be(n,i),t.appendChild(n)}function vl(r,e,t){yl(mh(r),"Literal",e,t)}function $s(r,e,t){r==="2.0.0"?yl(sf[r],"ValueReference",e,t):yl(rf[r],"PropertyName",e,t)}function gp(r,e){const t=ve(Mn,"TimeInstant");r.appendChild(t);const i=ve(Mn,"timePosition");t.appendChild(i),be(i,e)}function pp(r,e,t){const i=t[t.length-1],n=Object.assign({},i);n.node=r,ye(n,ph,Qe("Query"),e,t)}function mh(r){let e;return r==="2.0.0"?e=sf[r]:e=rf[r],e}const AM="_feature",IM="_layer";class M2 extends ha{constructor(e){super(),e=e||{},this.featureNS_="http://mapserver.gis.umn.edu/mapserver",this.gmlFormat_=new Me,this.layers_=e.layers?e.layers:null}getLayers(){return this.layers_}setLayers(e){this.layers_=e}readFeatures_(e,t){e.setAttribute("namespaceURI",this.featureNS_);const i=e.localName;let n=[];if(e.childNodes.length===0)return n;if(i=="msGMLOutput")for(let s=0,o=e.childNodes.length;s<o;s++){const a=e.childNodes[s];if(a.nodeType!==Node.ELEMENT_NODE)continue;const l=a,h=t[0],u=IM,c=l.localName.replace(u,"");if(this.layers_&&!this.layers_.includes(c))continue;const d=c+AM;h.featureType=d,h.featureNS=this.featureNS_;const f={};f[d]=ue(this.gmlFormat_.readFeatureElement,this.gmlFormat_);const g=X([h.featureNS,null],f);l.setAttribute("namespaceURI",this.featureNS_);const m=Z([],g,l,t,this.gmlFormat_);m&&Fe(n,m)}if(i=="FeatureCollection"){const s=Z([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,[{}],this.gmlFormat_);s&&(n=s)}return n}readFeaturesFromNode(e,t){const i={};return t&&Object.assign(i,this.getReadOptions(e,t)),this.readFeatures_(e,[i])}}const sn=[null,"http://www.opengis.net/wmts/1.0"],Zs=[null,"http://www.opengis.net/ows/1.1"],PM=X(sn,{Contents:N(VM)});class L2 extends my{constructor(){super(),this.owsParser_=new fT}readFromNode(e){let t=e.getAttribute("version");t&&(t=t.trim());let i=this.owsParser_.readFromNode(e);return i?(i.version=t,i=Z(i,PM,e,[]),i||null):null}}const FM=X(sn,{Layer:Ut(WM),TileMatrixSet:Ut(UM)}),OM=X(sn,{Style:Ut(YM),Format:Ut(ne),TileMatrixSetLink:Ut(jM),Dimension:Ut(XM),ResourceURL:Ut($M)},X(Zs,{Title:N(ne),Abstract:N(ne),WGS84BoundingBox:N(_y),BoundingBox:Ut(ZM),Identifier:N(ne)})),DM=X(sn,{LegendURL:Ut(KM)},X(Zs,{Title:N(ne),Identifier:N(ne)})),kM=X(sn,{TileMatrixSet:N(ne),TileMatrixSetLimits:N(JM)}),NM=X(sn,{TileMatrixLimits:ue(QM)}),zM=X(sn,{TileMatrix:N(ne),MinTileRow:N(lt),MaxTileRow:N(lt),MinTileCol:N(lt),MaxTileCol:N(lt)}),BM=X(sn,{Default:N(ne),Value:Ut(ne)},X(Zs,{Identifier:N(ne)})),Ey=X(Zs,{LowerCorner:ue(Wu),UpperCorner:ue(Wu)}),GM=X(sn,{WellKnownScaleSet:N(ne),TileMatrix:Ut(qM)},X(Zs,{SupportedCRS:N(ne),Identifier:N(ne),BoundingBox:N(_y)})),HM=X(sn,{TopLeftCorner:N(Wu),ScaleDenominator:N(ke),TileWidth:N(lt),TileHeight:N(lt),MatrixWidth:N(lt),MatrixHeight:N(lt)},X(Zs,{Identifier:N(ne)}));function VM(r,e){return Z({},FM,r,e)}function WM(r,e){return Z({},OM,r,e)}function UM(r,e){return Z({},GM,r,e)}function YM(r,e){const t=Z({},DM,r,e);if(!t)return;const i=r.getAttribute("isDefault")==="true";return t.isDefault=i,t}function jM(r,e){return Z({},kM,r,e)}function XM(r,e){return Z({},BM,r,e)}function $M(r,e){const t=r.getAttribute("format"),i=r.getAttribute("template"),n=r.getAttribute("resourceType"),s={};return t&&(s.format=t),i&&(s.template=i),n&&(s.resourceType=n),s}function _y(r,e){const t=Z([],Ey,r,e);if(t.length==2)return To(t)}function ZM(r,e){const t=r.getAttribute("crs"),i=Z([],Ey,r,e);if(i.length==2)return{extent:To(i),crs:t}}function KM(r,e){const t={};return t.format=r.getAttribute("format"),t.href=Jd(r),t}function Wu(r,e){const t=ne(r).split(/\s+/);if(!t||t.length!=2)return;const i=+t[0],n=+t[1];if(!(isNaN(i)||isNaN(n)))return[i,n]}function qM(r,e){return Z({},HM,r,e)}function JM(r,e){return Z([],NM,r,e)}function QM(r,e){return Z({},zM,r,e)}function Va(r,e){return r==null||e==null?NaN:r<e?-1:r>e?1:r>=e?0:NaN}function eL(r,e){return r==null||e==null?NaN:e<r?-1:e>r?1:e>=r?0:NaN}function Cy(r){let e,t,i;r.length!==2?(e=Va,t=(a,l)=>Va(r(a),l),i=(a,l)=>r(a)-l):(e=r===Va||r===eL?r:tL,t=r,i=r);function n(a,l,h=0,u=a.length){if(h<u){if(e(l,l)!==0)return u;do{const c=h+u>>>1;t(a[c],l)<0?h=c+1:u=c}while(h<u)}return h}function s(a,l,h=0,u=a.length){if(h<u){if(e(l,l)!==0)return u;do{const c=h+u>>>1;t(a[c],l)<=0?h=c+1:u=c}while(h<u)}return h}function o(a,l,h=0,u=a.length){const c=n(a,l,h,u-1);return c>h&&i(a[c-1],l)>-i(a[c],l)?c-1:c}return{left:n,center:o,right:s}}function tL(){return 0}function iL(r){return r===null?NaN:+r}const nL=Cy(Va),rL=nL.right;Cy(iL).center;const sL=Math.sqrt(50),oL=Math.sqrt(10),aL=Math.sqrt(2);function wl(r,e,t){const i=(e-r)/Math.max(0,t),n=Math.floor(Math.log10(i)),s=i/Math.pow(10,n),o=s>=sL?10:s>=oL?5:s>=aL?2:1;let a,l,h;return n<0?(h=Math.pow(10,-n)/o,a=Math.round(r*h),l=Math.round(e*h),a/h<r&&++a,l/h>e&&--l,h=-h):(h=Math.pow(10,n)*o,a=Math.round(r/h),l=Math.round(e/h),a*h<r&&++a,l*h>e&&--l),l<a&&.5<=t&&t<2?wl(r,e,t*2):[a,l,h]}function lL(r,e,t){if(e=+e,r=+r,t=+t,!(t>0))return[];if(r===e)return[r];const i=e<r,[n,s,o]=i?wl(e,r,t):wl(r,e,t);if(!(s>=n))return[];const a=s-n+1,l=new Array(a);if(i)if(o<0)for(let h=0;h<a;++h)l[h]=(s-h)/-o;else for(let h=0;h<a;++h)l[h]=(s-h)*o;else if(o<0)for(let h=0;h<a;++h)l[h]=(n+h)/-o;else for(let h=0;h<a;++h)l[h]=(n+h)*o;return l}function Uu(r,e,t){return e=+e,r=+r,t=+t,wl(r,e,t)[2]}function hL(r,e,t){e=+e,r=+r,t=+t;const i=e<r,n=i?Uu(e,r,t):Uu(r,e,t);return(i?-1:1)*(n<0?1/-n:n)}function uL(r){return r}var Zh=1,Kh=2,Yu=3,ho=4,mp=1e-6;function cL(r){return"translate("+r+",0)"}function dL(r){return"translate(0,"+r+")"}function fL(r){return e=>+r(e)}function gL(r,e){return e=Math.max(0,r.bandwidth()-e*2)/2,r.round()&&(e=Math.round(e)),t=>+r(t)+e}function pL(){return!this.__axis}function xy(r,e){var t=[],i=null,n=null,s=6,o=6,a=3,l=typeof window<"u"&&window.devicePixelRatio>1?0:.5,h=r===Zh||r===ho?-1:1,u=r===ho||r===Kh?"x":"y",c=r===Zh||r===Yu?cL:dL;function d(f){var g=i??(e.ticks?e.ticks.apply(e,t):e.domain()),m=n??(e.tickFormat?e.tickFormat.apply(e,t):uL),w=Math.max(s,0)+a,y=e.range(),E=+y[0]+l,x=+y[y.length-1]+l,v=(e.bandwidth?gL:fL)(e.copy(),l),S=f.selection?f.selection():f,R=S.selectAll(".domain").data([null]),L=S.selectAll(".tick").data(g,e).order(),C=L.exit(),M=L.enter().append("g").attr("class","tick"),D=L.select("line"),A=L.select("text");R=R.merge(R.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),L=L.merge(M),D=D.merge(M.append("line").attr("stroke","currentColor").attr(u+"2",h*s)),A=A.merge(M.append("text").attr("fill","currentColor").attr(u,h*w).attr("dy",r===Zh?"0em":r===Yu?"0.71em":"0.32em")),f!==S&&(R=R.transition(f),L=L.transition(f),D=D.transition(f),A=A.transition(f),C=C.transition(f).attr("opacity",mp).attr("transform",function(k){return isFinite(k=v(k))?c(k+l):this.getAttribute("transform")}),M.attr("opacity",mp).attr("transform",function(k){var V=this.parentNode.__axis;return c((V&&isFinite(V=V(k))?V:v(k))+l)})),C.remove(),R.attr("d",r===ho||r===Kh?o?"M"+h*o+","+E+"H"+l+"V"+x+"H"+h*o:"M"+l+","+E+"V"+x:o?"M"+E+","+h*o+"V"+l+"H"+x+"V"+h*o:"M"+E+","+l+"H"+x),L.attr("opacity",1).attr("transform",function(k){return c(v(k)+l)}),D.attr(u+"2",h*s),A.attr(u,h*w).text(m),S.filter(pL).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",r===Kh?"start":r===ho?"end":"middle"),S.each(function(){this.__axis=v})}return d.scale=function(f){return arguments.length?(e=f,d):e},d.ticks=function(){return t=Array.from(arguments),d},d.tickArguments=function(f){return arguments.length?(t=f==null?[]:Array.from(f),d):t.slice()},d.tickValues=function(f){return arguments.length?(i=f==null?null:Array.from(f),d):i&&i.slice()},d.tickFormat=function(f){return arguments.length?(n=f,d):n},d.tickSize=function(f){return arguments.length?(s=o=+f,d):s},d.tickSizeInner=function(f){return arguments.length?(s=+f,d):s},d.tickSizeOuter=function(f){return arguments.length?(o=+f,d):o},d.tickPadding=function(f){return arguments.length?(a=+f,d):a},d.offset=function(f){return arguments.length?(l=+f,d):l},d}function A2(r){return xy(Yu,r)}function I2(r){return xy(ho,r)}var mL={value:()=>{}};function lf(){for(var r=0,e=arguments.length,t={},i;r<e;++r){if(!(i=arguments[r]+"")||i in t||/[\s.]/.test(i))throw new Error("illegal type: "+i);t[i]=[]}return new Wa(t)}function Wa(r){this._=r}function bL(r,e){return r.trim().split(/^|\s+/).map(function(t){var i="",n=t.indexOf(".");if(n>=0&&(i=t.slice(n+1),t=t.slice(0,n)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:i}})}Wa.prototype=lf.prototype={constructor:Wa,on:function(r,e){var t=this._,i=bL(r+"",t),n,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((n=(r=i[s]).type)&&(n=yL(t[n],r.name)))return n;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(n=(r=i[s]).type)t[n]=bp(t[n],r.name,e);else if(e==null)for(n in t)t[n]=bp(t[n],r.name,null);return this},copy:function(){var r={},e=this._;for(var t in e)r[t]=e[t].slice();return new Wa(r)},call:function(r,e){if((n=arguments.length-2)>0)for(var t=new Array(n),i=0,n,s;i<n;++i)t[i]=arguments[i+2];if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(s=this._[r],i=0,n=s.length;i<n;++i)s[i].value.apply(e,t)},apply:function(r,e,t){if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(var i=this._[r],n=0,s=i.length;n<s;++n)i[n].value.apply(e,t)}};function yL(r,e){for(var t=0,i=r.length,n;t<i;++t)if((n=r[t]).name===e)return n.value}function bp(r,e,t){for(var i=0,n=r.length;i<n;++i)if(r[i].name===e){r[i]=mL,r=r.slice(0,i).concat(r.slice(i+1));break}return t!=null&&r.push({name:e,value:t}),r}var ju="http://www.w3.org/1999/xhtml";const yp={svg:"http://www.w3.org/2000/svg",xhtml:ju,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function bh(r){var e=r+="",t=e.indexOf(":");return t>=0&&(e=r.slice(0,t))!=="xmlns"&&(r=r.slice(t+1)),yp.hasOwnProperty(e)?{space:yp[e],local:r}:r}function vL(r){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===ju&&e.documentElement.namespaceURI===ju?e.createElement(r):e.createElementNS(t,r)}}function wL(r){return function(){return this.ownerDocument.createElementNS(r.space,r.local)}}function Ry(r){var e=bh(r);return(e.local?wL:vL)(e)}function EL(){}function hf(r){return r==null?EL:function(){return this.querySelector(r)}}function _L(r){typeof r!="function"&&(r=hf(r));for(var e=this._groups,t=e.length,i=new Array(t),n=0;n<t;++n)for(var s=e[n],o=s.length,a=i[n]=new Array(o),l,h,u=0;u<o;++u)(l=s[u])&&(h=r.call(l,l.__data__,u,s))&&("__data__"in l&&(h.__data__=l.__data__),a[u]=h);return new li(i,this._parents)}function CL(r){return r==null?[]:Array.isArray(r)?r:Array.from(r)}function xL(){return[]}function Sy(r){return r==null?xL:function(){return this.querySelectorAll(r)}}function RL(r){return function(){return CL(r.apply(this,arguments))}}function SL(r){typeof r=="function"?r=RL(r):r=Sy(r);for(var e=this._groups,t=e.length,i=[],n=[],s=0;s<t;++s)for(var o=e[s],a=o.length,l,h=0;h<a;++h)(l=o[h])&&(i.push(r.call(l,l.__data__,h,o)),n.push(l));return new li(i,n)}function Ty(r){return function(){return this.matches(r)}}function My(r){return function(e){return e.matches(r)}}var TL=Array.prototype.find;function ML(r){return function(){return TL.call(this.children,r)}}function LL(){return this.firstElementChild}function AL(r){return this.select(r==null?LL:ML(typeof r=="function"?r:My(r)))}var IL=Array.prototype.filter;function PL(){return Array.from(this.children)}function FL(r){return function(){return IL.call(this.children,r)}}function OL(r){return this.selectAll(r==null?PL:FL(typeof r=="function"?r:My(r)))}function DL(r){typeof r!="function"&&(r=Ty(r));for(var e=this._groups,t=e.length,i=new Array(t),n=0;n<t;++n)for(var s=e[n],o=s.length,a=i[n]=[],l,h=0;h<o;++h)(l=s[h])&&r.call(l,l.__data__,h,s)&&a.push(l);return new li(i,this._parents)}function Ly(r){return new Array(r.length)}function kL(){return new li(this._enter||this._groups.map(Ly),this._parents)}function El(r,e){this.ownerDocument=r.ownerDocument,this.namespaceURI=r.namespaceURI,this._next=null,this._parent=r,this.__data__=e}El.prototype={constructor:El,appendChild:function(r){return this._parent.insertBefore(r,this._next)},insertBefore:function(r,e){return this._parent.insertBefore(r,e)},querySelector:function(r){return this._parent.querySelector(r)},querySelectorAll:function(r){return this._parent.querySelectorAll(r)}};function NL(r){return function(){return r}}function zL(r,e,t,i,n,s){for(var o=0,a,l=e.length,h=s.length;o<h;++o)(a=e[o])?(a.__data__=s[o],i[o]=a):t[o]=new El(r,s[o]);for(;o<l;++o)(a=e[o])&&(n[o]=a)}function BL(r,e,t,i,n,s,o){var a,l,h=new Map,u=e.length,c=s.length,d=new Array(u),f;for(a=0;a<u;++a)(l=e[a])&&(d[a]=f=o.call(l,l.__data__,a,e)+"",h.has(f)?n[a]=l:h.set(f,l));for(a=0;a<c;++a)f=o.call(r,s[a],a,s)+"",(l=h.get(f))?(i[a]=l,l.__data__=s[a],h.delete(f)):t[a]=new El(r,s[a]);for(a=0;a<u;++a)(l=e[a])&&h.get(d[a])===l&&(n[a]=l)}function GL(r){return r.__data__}function HL(r,e){if(!arguments.length)return Array.from(this,GL);var t=e?BL:zL,i=this._parents,n=this._groups;typeof r!="function"&&(r=NL(r));for(var s=n.length,o=new Array(s),a=new Array(s),l=new Array(s),h=0;h<s;++h){var u=i[h],c=n[h],d=c.length,f=VL(r.call(u,u&&u.__data__,h,i)),g=f.length,m=a[h]=new Array(g),w=o[h]=new Array(g),y=l[h]=new Array(d);t(u,c,m,w,y,f,e);for(var E=0,x=0,v,S;E<g;++E)if(v=m[E]){for(E>=x&&(x=E+1);!(S=w[x])&&++x<g;);v._next=S||null}}return o=new li(o,i),o._enter=a,o._exit=l,o}function VL(r){return typeof r=="object"&&"length"in r?r:Array.from(r)}function WL(){return new li(this._exit||this._groups.map(Ly),this._parents)}function UL(r,e,t){var i=this.enter(),n=this,s=this.exit();return typeof r=="function"?(i=r(i),i&&(i=i.selection())):i=i.append(r+""),e!=null&&(n=e(n),n&&(n=n.selection())),t==null?s.remove():t(s),i&&n?i.merge(n).order():n}function YL(r){for(var e=r.selection?r.selection():r,t=this._groups,i=e._groups,n=t.length,s=i.length,o=Math.min(n,s),a=new Array(n),l=0;l<o;++l)for(var h=t[l],u=i[l],c=h.length,d=a[l]=new Array(c),f,g=0;g<c;++g)(f=h[g]||u[g])&&(d[g]=f);for(;l<n;++l)a[l]=t[l];return new li(a,this._parents)}function jL(){for(var r=this._groups,e=-1,t=r.length;++e<t;)for(var i=r[e],n=i.length-1,s=i[n],o;--n>=0;)(o=i[n])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function XL(r){r||(r=$L);function e(c,d){return c&&d?r(c.__data__,d.__data__):!c-!d}for(var t=this._groups,i=t.length,n=new Array(i),s=0;s<i;++s){for(var o=t[s],a=o.length,l=n[s]=new Array(a),h,u=0;u<a;++u)(h=o[u])&&(l[u]=h);l.sort(e)}return new li(n,this._parents).order()}function $L(r,e){return r<e?-1:r>e?1:r>=e?0:NaN}function ZL(){var r=arguments[0];return arguments[0]=this,r.apply(null,arguments),this}function KL(){return Array.from(this)}function qL(){for(var r=this._groups,e=0,t=r.length;e<t;++e)for(var i=r[e],n=0,s=i.length;n<s;++n){var o=i[n];if(o)return o}return null}function JL(){let r=0;for(const e of this)++r;return r}function QL(){return!this.node()}function eA(r){for(var e=this._groups,t=0,i=e.length;t<i;++t)for(var n=e[t],s=0,o=n.length,a;s<o;++s)(a=n[s])&&r.call(a,a.__data__,s,n);return this}function tA(r){return function(){this.removeAttribute(r)}}function iA(r){return function(){this.removeAttributeNS(r.space,r.local)}}function nA(r,e){return function(){this.setAttribute(r,e)}}function rA(r,e){return function(){this.setAttributeNS(r.space,r.local,e)}}function sA(r,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(r):this.setAttribute(r,t)}}function oA(r,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(r.space,r.local):this.setAttributeNS(r.space,r.local,t)}}function aA(r,e){var t=bh(r);if(arguments.length<2){var i=this.node();return t.local?i.getAttributeNS(t.space,t.local):i.getAttribute(t)}return this.each((e==null?t.local?iA:tA:typeof e=="function"?t.local?oA:sA:t.local?rA:nA)(t,e))}function Ay(r){return r.ownerDocument&&r.ownerDocument.defaultView||r.document&&r||r.defaultView}function lA(r){return function(){this.style.removeProperty(r)}}function hA(r,e,t){return function(){this.style.setProperty(r,e,t)}}function uA(r,e,t){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(r):this.style.setProperty(r,i,t)}}function cA(r,e,t){return arguments.length>1?this.each((e==null?lA:typeof e=="function"?uA:hA)(r,e,t??"")):Ds(this.node(),r)}function Ds(r,e){return r.style.getPropertyValue(e)||Ay(r).getComputedStyle(r,null).getPropertyValue(e)}function dA(r){return function(){delete this[r]}}function fA(r,e){return function(){this[r]=e}}function gA(r,e){return function(){var t=e.apply(this,arguments);t==null?delete this[r]:this[r]=t}}function pA(r,e){return arguments.length>1?this.each((e==null?dA:typeof e=="function"?gA:fA)(r,e)):this.node()[r]}function Iy(r){return r.trim().split(/^|\s+/)}function uf(r){return r.classList||new Py(r)}function Py(r){this._node=r,this._names=Iy(r.getAttribute("class")||"")}Py.prototype={add:function(r){var e=this._names.indexOf(r);e<0&&(this._names.push(r),this._node.setAttribute("class",this._names.join(" ")))},remove:function(r){var e=this._names.indexOf(r);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(r){return this._names.indexOf(r)>=0}};function Fy(r,e){for(var t=uf(r),i=-1,n=e.length;++i<n;)t.add(e[i])}function Oy(r,e){for(var t=uf(r),i=-1,n=e.length;++i<n;)t.remove(e[i])}function mA(r){return function(){Fy(this,r)}}function bA(r){return function(){Oy(this,r)}}function yA(r,e){return function(){(e.apply(this,arguments)?Fy:Oy)(this,r)}}function vA(r,e){var t=Iy(r+"");if(arguments.length<2){for(var i=uf(this.node()),n=-1,s=t.length;++n<s;)if(!i.contains(t[n]))return!1;return!0}return this.each((typeof e=="function"?yA:e?mA:bA)(t,e))}function wA(){this.textContent=""}function EA(r){return function(){this.textContent=r}}function _A(r){return function(){var e=r.apply(this,arguments);this.textContent=e??""}}function CA(r){return arguments.length?this.each(r==null?wA:(typeof r=="function"?_A:EA)(r)):this.node().textContent}function xA(){this.innerHTML=""}function RA(r){return function(){this.innerHTML=r}}function SA(r){return function(){var e=r.apply(this,arguments);this.innerHTML=e??""}}function TA(r){return arguments.length?this.each(r==null?xA:(typeof r=="function"?SA:RA)(r)):this.node().innerHTML}function MA(){this.nextSibling&&this.parentNode.appendChild(this)}function LA(){return this.each(MA)}function AA(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function IA(){return this.each(AA)}function PA(r){var e=typeof r=="function"?r:Ry(r);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function FA(){return null}function OA(r,e){var t=typeof r=="function"?r:Ry(r),i=e==null?FA:typeof e=="function"?e:hf(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),i.apply(this,arguments)||null)})}function DA(){var r=this.parentNode;r&&r.removeChild(this)}function kA(){return this.each(DA)}function NA(){var r=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(r,this.nextSibling):r}function zA(){var r=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(r,this.nextSibling):r}function BA(r){return this.select(r?zA:NA)}function GA(r){return arguments.length?this.property("__data__",r):this.node().__data__}function HA(r){return function(e){r.call(this,e,this.__data__)}}function VA(r){return r.trim().split(/^|\s+/).map(function(e){var t="",i=e.indexOf(".");return i>=0&&(t=e.slice(i+1),e=e.slice(0,i)),{type:e,name:t}})}function WA(r){return function(){var e=this.__on;if(e){for(var t=0,i=-1,n=e.length,s;t<n;++t)s=e[t],(!r.type||s.type===r.type)&&s.name===r.name?this.removeEventListener(s.type,s.listener,s.options):e[++i]=s;++i?e.length=i:delete this.__on}}}function UA(r,e,t){return function(){var i=this.__on,n,s=HA(e);if(i){for(var o=0,a=i.length;o<a;++o)if((n=i[o]).type===r.type&&n.name===r.name){this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=s,n.options=t),n.value=e;return}}this.addEventListener(r.type,s,t),n={type:r.type,name:r.name,value:e,listener:s,options:t},i?i.push(n):this.__on=[n]}}function YA(r,e,t){var i=VA(r+""),n,s=i.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,h=a.length,u;l<h;++l)for(n=0,u=a[l];n<s;++n)if((o=i[n]).type===u.type&&o.name===u.name)return u.value}return}for(a=e?UA:WA,n=0;n<s;++n)this.each(a(i[n],e,t));return this}function Dy(r,e,t){var i=Ay(r),n=i.CustomEvent;typeof n=="function"?n=new n(e,t):(n=i.document.createEvent("Event"),t?(n.initEvent(e,t.bubbles,t.cancelable),n.detail=t.detail):n.initEvent(e,!1,!1)),r.dispatchEvent(n)}function jA(r,e){return function(){return Dy(this,r,e)}}function XA(r,e){return function(){return Dy(this,r,e.apply(this,arguments))}}function $A(r,e){return this.each((typeof e=="function"?XA:jA)(r,e))}function*ZA(){for(var r=this._groups,e=0,t=r.length;e<t;++e)for(var i=r[e],n=0,s=i.length,o;n<s;++n)(o=i[n])&&(yield o)}var ky=[null];function li(r,e){this._groups=r,this._parents=e}function ca(){return new li([[document.documentElement]],ky)}function KA(){return this}li.prototype=ca.prototype={constructor:li,select:_L,selectAll:SL,selectChild:AL,selectChildren:OL,filter:DL,data:HL,enter:kL,exit:WL,join:UL,merge:YL,selection:KA,order:jL,sort:XL,call:ZL,nodes:KL,node:qL,size:JL,empty:QL,each:eA,attr:aA,style:cA,property:pA,classed:vA,text:CA,html:TA,raise:LA,lower:IA,append:PA,insert:OA,remove:kA,clone:BA,datum:GA,on:YA,dispatch:$A,[Symbol.iterator]:ZA};function wr(r){return typeof r=="string"?new li([[document.querySelector(r)]],[document.documentElement]):new li([[r]],ky)}function qA(r){let e;for(;e=r.sourceEvent;)r=e;return r}function mr(r,e){if(r=qA(r),e===void 0&&(e=r.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var i=t.createSVGPoint();return i.x=r.clientX,i.y=r.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var n=e.getBoundingClientRect();return[r.clientX-n.left-e.clientLeft,r.clientY-n.top-e.clientTop]}}return[r.pageX,r.pageY]}const Xu={capture:!0,passive:!1};function $u(r){r.preventDefault(),r.stopImmediatePropagation()}function JA(r){var e=r.document.documentElement,t=wr(r).on("dragstart.drag",$u,Xu);"onselectstart"in e?t.on("selectstart.drag",$u,Xu):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function QA(r,e){var t=r.document.documentElement,i=wr(r).on("dragstart.drag",null);e&&(i.on("click.drag",$u,Xu),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in t?i.on("selectstart.drag",null):(t.style.MozUserSelect=t.__noselect,delete t.__noselect)}function cf(r,e,t){r.prototype=e.prototype=t,t.constructor=r}function Ny(r,e){var t=Object.create(r.prototype);for(var i in e)t[i]=e[i];return t}function da(){}var Vo=.7,_l=1/Vo,vs="\\s*([+-]?\\d+)\\s*",Wo="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Qi="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",eI=/^#([0-9a-f]{3,8})$/,tI=new RegExp(`^rgb\\(${vs},${vs},${vs}\\)$`),iI=new RegExp(`^rgb\\(${Qi},${Qi},${Qi}\\)$`),nI=new RegExp(`^rgba\\(${vs},${vs},${vs},${Wo}\\)$`),rI=new RegExp(`^rgba\\(${Qi},${Qi},${Qi},${Wo}\\)$`),sI=new RegExp(`^hsl\\(${Wo},${Qi},${Qi}\\)$`),oI=new RegExp(`^hsla\\(${Wo},${Qi},${Qi},${Wo}\\)$`),vp={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};cf(da,Hr,{copy(r){return Object.assign(new this.constructor,this,r)},displayable(){return this.rgb().displayable()},hex:wp,formatHex:wp,formatHex8:aI,formatHsl:lI,formatRgb:Ep,toString:Ep});function wp(){return this.rgb().formatHex()}function aI(){return this.rgb().formatHex8()}function lI(){return zy(this).formatHsl()}function Ep(){return this.rgb().formatRgb()}function Hr(r){var e,t;return r=(r+"").trim().toLowerCase(),(e=eI.exec(r))?(t=e[1].length,e=parseInt(e[1],16),t===6?_p(e):t===3?new jt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?Ia(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?Ia(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=tI.exec(r))?new jt(e[1],e[2],e[3],1):(e=iI.exec(r))?new jt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=nI.exec(r))?Ia(e[1],e[2],e[3],e[4]):(e=rI.exec(r))?Ia(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=sI.exec(r))?Rp(e[1],e[2]/100,e[3]/100,1):(e=oI.exec(r))?Rp(e[1],e[2]/100,e[3]/100,e[4]):vp.hasOwnProperty(r)?_p(vp[r]):r==="transparent"?new jt(NaN,NaN,NaN,0):null}function _p(r){return new jt(r>>16&255,r>>8&255,r&255,1)}function Ia(r,e,t,i){return i<=0&&(r=e=t=NaN),new jt(r,e,t,i)}function hI(r){return r instanceof da||(r=Hr(r)),r?(r=r.rgb(),new jt(r.r,r.g,r.b,r.opacity)):new jt}function Zu(r,e,t,i){return arguments.length===1?hI(r):new jt(r,e,t,i??1)}function jt(r,e,t,i){this.r=+r,this.g=+e,this.b=+t,this.opacity=+i}cf(jt,Zu,Ny(da,{brighter(r){return r=r==null?_l:Math.pow(_l,r),new jt(this.r*r,this.g*r,this.b*r,this.opacity)},darker(r){return r=r==null?Vo:Math.pow(Vo,r),new jt(this.r*r,this.g*r,this.b*r,this.opacity)},rgb(){return this},clamp(){return new jt(Fr(this.r),Fr(this.g),Fr(this.b),Cl(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Cp,formatHex:Cp,formatHex8:uI,formatRgb:xp,toString:xp}));function Cp(){return`#${Mr(this.r)}${Mr(this.g)}${Mr(this.b)}`}function uI(){return`#${Mr(this.r)}${Mr(this.g)}${Mr(this.b)}${Mr((isNaN(this.opacity)?1:this.opacity)*255)}`}function xp(){const r=Cl(this.opacity);return`${r===1?"rgb(":"rgba("}${Fr(this.r)}, ${Fr(this.g)}, ${Fr(this.b)}${r===1?")":`, ${r})`}`}function Cl(r){return isNaN(r)?1:Math.max(0,Math.min(1,r))}function Fr(r){return Math.max(0,Math.min(255,Math.round(r)||0))}function Mr(r){return r=Fr(r),(r<16?"0":"")+r.toString(16)}function Rp(r,e,t,i){return i<=0?r=e=t=NaN:t<=0||t>=1?r=e=NaN:e<=0&&(r=NaN),new Oi(r,e,t,i)}function zy(r){if(r instanceof Oi)return new Oi(r.h,r.s,r.l,r.opacity);if(r instanceof da||(r=Hr(r)),!r)return new Oi;if(r instanceof Oi)return r;r=r.rgb();var e=r.r/255,t=r.g/255,i=r.b/255,n=Math.min(e,t,i),s=Math.max(e,t,i),o=NaN,a=s-n,l=(s+n)/2;return a?(e===s?o=(t-i)/a+(t<i)*6:t===s?o=(i-e)/a+2:o=(e-t)/a+4,a/=l<.5?s+n:2-s-n,o*=60):a=l>0&&l<1?0:o,new Oi(o,a,l,r.opacity)}function cI(r,e,t,i){return arguments.length===1?zy(r):new Oi(r,e,t,i??1)}function Oi(r,e,t,i){this.h=+r,this.s=+e,this.l=+t,this.opacity=+i}cf(Oi,cI,Ny(da,{brighter(r){return r=r==null?_l:Math.pow(_l,r),new Oi(this.h,this.s,this.l*r,this.opacity)},darker(r){return r=r==null?Vo:Math.pow(Vo,r),new Oi(this.h,this.s,this.l*r,this.opacity)},rgb(){var r=this.h%360+(this.h<0)*360,e=isNaN(r)||isNaN(this.s)?0:this.s,t=this.l,i=t+(t<.5?t:1-t)*e,n=2*t-i;return new jt(qh(r>=240?r-240:r+120,n,i),qh(r,n,i),qh(r<120?r+240:r-120,n,i),this.opacity)},clamp(){return new Oi(Sp(this.h),Pa(this.s),Pa(this.l),Cl(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const r=Cl(this.opacity);return`${r===1?"hsl(":"hsla("}${Sp(this.h)}, ${Pa(this.s)*100}%, ${Pa(this.l)*100}%${r===1?")":`, ${r})`}`}}));function Sp(r){return r=(r||0)%360,r<0?r+360:r}function Pa(r){return Math.max(0,Math.min(1,r||0))}function qh(r,e,t){return(r<60?e+(t-e)*r/60:r<180?t:r<240?e+(t-e)*(240-r)/60:e)*255}const df=r=>()=>r;function dI(r,e){return function(t){return r+t*e}}function fI(r,e,t){return r=Math.pow(r,t),e=Math.pow(e,t)-r,t=1/t,function(i){return Math.pow(r+i*e,t)}}function gI(r){return(r=+r)==1?By:function(e,t){return t-e?fI(e,t,r):df(isNaN(e)?t:e)}}function By(r,e){var t=e-r;return t?dI(r,t):df(isNaN(r)?e:r)}const xl=function r(e){var t=gI(e);function i(n,s){var o=t((n=Zu(n)).r,(s=Zu(s)).r),a=t(n.g,s.g),l=t(n.b,s.b),h=By(n.opacity,s.opacity);return function(u){return n.r=o(u),n.g=a(u),n.b=l(u),n.opacity=h(u),n+""}}return i.gamma=r,i}(1);function pI(r,e){e||(e=[]);var t=r?Math.min(e.length,r.length):0,i=e.slice(),n;return function(s){for(n=0;n<t;++n)i[n]=r[n]*(1-s)+e[n]*s;return i}}function mI(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function bI(r,e){var t=e?e.length:0,i=r?Math.min(t,r.length):0,n=new Array(i),s=new Array(t),o;for(o=0;o<i;++o)n[o]=ff(r[o],e[o]);for(;o<t;++o)s[o]=e[o];return function(a){for(o=0;o<i;++o)s[o]=n[o](a);return s}}function yI(r,e){var t=new Date;return r=+r,e=+e,function(i){return t.setTime(r*(1-i)+e*i),t}}function Fi(r,e){return r=+r,e=+e,function(t){return r*(1-t)+e*t}}function vI(r,e){var t={},i={},n;(r===null||typeof r!="object")&&(r={}),(e===null||typeof e!="object")&&(e={});for(n in e)n in r?t[n]=ff(r[n],e[n]):i[n]=e[n];return function(s){for(n in t)i[n]=t[n](s);return i}}var Ku=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Jh=new RegExp(Ku.source,"g");function wI(r){return function(){return r}}function EI(r){return function(e){return r(e)+""}}function Gy(r,e){var t=Ku.lastIndex=Jh.lastIndex=0,i,n,s,o=-1,a=[],l=[];for(r=r+"",e=e+"";(i=Ku.exec(r))&&(n=Jh.exec(e));)(s=n.index)>t&&(s=e.slice(t,s),a[o]?a[o]+=s:a[++o]=s),(i=i[0])===(n=n[0])?a[o]?a[o]+=n:a[++o]=n:(a[++o]=null,l.push({i:o,x:Fi(i,n)})),t=Jh.lastIndex;return t<e.length&&(s=e.slice(t),a[o]?a[o]+=s:a[++o]=s),a.length<2?l[0]?EI(l[0].x):wI(e):(e=l.length,function(h){for(var u=0,c;u<e;++u)a[(c=l[u]).i]=c.x(h);return a.join("")})}function ff(r,e){var t=typeof e,i;return e==null||t==="boolean"?df(e):(t==="number"?Fi:t==="string"?(i=Hr(e))?(e=i,xl):Gy:e instanceof Hr?xl:e instanceof Date?yI:mI(e)?pI:Array.isArray(e)?bI:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?vI:Fi)(r,e)}function _I(r,e){return r=+r,e=+e,function(t){return Math.round(r*(1-t)+e*t)}}var Tp=180/Math.PI,qu={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Hy(r,e,t,i,n,s){var o,a,l;return(o=Math.sqrt(r*r+e*e))&&(r/=o,e/=o),(l=r*t+e*i)&&(t-=r*l,i-=e*l),(a=Math.sqrt(t*t+i*i))&&(t/=a,i/=a,l/=a),r*i<e*t&&(r=-r,e=-e,l=-l,o=-o),{translateX:n,translateY:s,rotate:Math.atan2(e,r)*Tp,skewX:Math.atan(l)*Tp,scaleX:o,scaleY:a}}var Fa;function CI(r){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(r+"");return e.isIdentity?qu:Hy(e.a,e.b,e.c,e.d,e.e,e.f)}function xI(r){return r==null||(Fa||(Fa=document.createElementNS("http://www.w3.org/2000/svg","g")),Fa.setAttribute("transform",r),!(r=Fa.transform.baseVal.consolidate()))?qu:(r=r.matrix,Hy(r.a,r.b,r.c,r.d,r.e,r.f))}function Vy(r,e,t,i){function n(h){return h.length?h.pop()+" ":""}function s(h,u,c,d,f,g){if(h!==c||u!==d){var m=f.push("translate(",null,e,null,t);g.push({i:m-4,x:Fi(h,c)},{i:m-2,x:Fi(u,d)})}else(c||d)&&f.push("translate("+c+e+d+t)}function o(h,u,c,d){h!==u?(h-u>180?u+=360:u-h>180&&(h+=360),d.push({i:c.push(n(c)+"rotate(",null,i)-2,x:Fi(h,u)})):u&&c.push(n(c)+"rotate("+u+i)}function a(h,u,c,d){h!==u?d.push({i:c.push(n(c)+"skewX(",null,i)-2,x:Fi(h,u)}):u&&c.push(n(c)+"skewX("+u+i)}function l(h,u,c,d,f,g){if(h!==c||u!==d){var m=f.push(n(f)+"scale(",null,",",null,")");g.push({i:m-4,x:Fi(h,c)},{i:m-2,x:Fi(u,d)})}else(c!==1||d!==1)&&f.push(n(f)+"scale("+c+","+d+")")}return function(h,u){var c=[],d=[];return h=r(h),u=r(u),s(h.translateX,h.translateY,u.translateX,u.translateY,c,d),o(h.rotate,u.rotate,c,d),a(h.skewX,u.skewX,c,d),l(h.scaleX,h.scaleY,u.scaleX,u.scaleY,c,d),h=u=null,function(f){for(var g=-1,m=d.length,w;++g<m;)c[(w=d[g]).i]=w.x(f);return c.join("")}}}var RI=Vy(CI,"px, ","px)","deg)"),SI=Vy(xI,", ",")",")"),TI=1e-12;function Mp(r){return((r=Math.exp(r))+1/r)/2}function MI(r){return((r=Math.exp(r))-1/r)/2}function LI(r){return((r=Math.exp(2*r))-1)/(r+1)}const AI=function r(e,t,i){function n(s,o){var a=s[0],l=s[1],h=s[2],u=o[0],c=o[1],d=o[2],f=u-a,g=c-l,m=f*f+g*g,w,y;if(m<TI)y=Math.log(d/h)/e,w=function(L){return[a+L*f,l+L*g,h*Math.exp(e*L*y)]};else{var E=Math.sqrt(m),x=(d*d-h*h+i*m)/(2*h*t*E),v=(d*d-h*h-i*m)/(2*d*t*E),S=Math.log(Math.sqrt(x*x+1)-x),R=Math.log(Math.sqrt(v*v+1)-v);y=(R-S)/e,w=function(L){var C=L*y,M=Mp(S),D=h/(t*E)*(M*LI(e*C+S)-MI(S));return[a+D*f,l+D*g,h*M/Mp(e*C+S)]}}return w.duration=y*1e3*e/Math.SQRT2,w}return n.rho=function(s){var o=Math.max(.001,+s),a=o*o,l=a*a;return r(o,a,l)},n}(Math.SQRT2,2,4);var ks=0,uo=0,no=0,Wy=1e3,Rl,co,Sl=0,Vr=0,yh=0,Uo=typeof performance=="object"&&performance.now?performance:Date,Uy=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(r){setTimeout(r,17)};function gf(){return Vr||(Uy(II),Vr=Uo.now()+yh)}function II(){Vr=0}function Tl(){this._call=this._time=this._next=null}Tl.prototype=Yy.prototype={constructor:Tl,restart:function(r,e,t){if(typeof r!="function")throw new TypeError("callback is not a function");t=(t==null?gf():+t)+(e==null?0:+e),!this._next&&co!==this&&(co?co._next=this:Rl=this,co=this),this._call=r,this._time=t,Ju()},stop:function(){this._call&&(this._call=null,this._time=1/0,Ju())}};function Yy(r,e,t){var i=new Tl;return i.restart(r,e,t),i}function PI(){gf(),++ks;for(var r=Rl,e;r;)(e=Vr-r._time)>=0&&r._call.call(void 0,e),r=r._next;--ks}function Lp(){Vr=(Sl=Uo.now())+yh,ks=uo=0;try{PI()}finally{ks=0,OI(),Vr=0}}function FI(){var r=Uo.now(),e=r-Sl;e>Wy&&(yh-=e,Sl=r)}function OI(){for(var r,e=Rl,t,i=1/0;e;)e._call?(i>e._time&&(i=e._time),r=e,e=e._next):(t=e._next,e._next=null,e=r?r._next=t:Rl=t);co=r,Ju(i)}function Ju(r){if(!ks){uo&&(uo=clearTimeout(uo));var e=r-Vr;e>24?(r<1/0&&(uo=setTimeout(Lp,r-Uo.now()-yh)),no&&(no=clearInterval(no))):(no||(Sl=Uo.now(),no=setInterval(FI,Wy)),ks=1,Uy(Lp))}}function Ap(r,e,t){var i=new Tl;return e=e==null?0:+e,i.restart(n=>{i.stop(),r(n+e)},e,t),i}var DI=lf("start","end","cancel","interrupt"),kI=[],jy=0,Ip=1,Qu=2,Ua=3,Pp=4,ec=5,Ya=6;function vh(r,e,t,i,n,s){var o=r.__transition;if(!o)r.__transition={};else if(t in o)return;NI(r,t,{name:e,index:i,group:n,on:DI,tween:kI,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:jy})}function pf(r,e){var t=Vi(r,e);if(t.state>jy)throw new Error("too late; already scheduled");return t}function on(r,e){var t=Vi(r,e);if(t.state>Ua)throw new Error("too late; already running");return t}function Vi(r,e){var t=r.__transition;if(!t||!(t=t[e]))throw new Error("transition not found");return t}function NI(r,e,t){var i=r.__transition,n;i[e]=t,t.timer=Yy(s,0,t.time);function s(h){t.state=Ip,t.timer.restart(o,t.delay,t.time),t.delay<=h&&o(h-t.delay)}function o(h){var u,c,d,f;if(t.state!==Ip)return l();for(u in i)if(f=i[u],f.name===t.name){if(f.state===Ua)return Ap(o);f.state===Pp?(f.state=Ya,f.timer.stop(),f.on.call("interrupt",r,r.__data__,f.index,f.group),delete i[u]):+u<e&&(f.state=Ya,f.timer.stop(),f.on.call("cancel",r,r.__data__,f.index,f.group),delete i[u])}if(Ap(function(){t.state===Ua&&(t.state=Pp,t.timer.restart(a,t.delay,t.time),a(h))}),t.state=Qu,t.on.call("start",r,r.__data__,t.index,t.group),t.state===Qu){for(t.state=Ua,n=new Array(d=t.tween.length),u=0,c=-1;u<d;++u)(f=t.tween[u].value.call(r,r.__data__,t.index,t.group))&&(n[++c]=f);n.length=c+1}}function a(h){for(var u=h<t.duration?t.ease.call(null,h/t.duration):(t.timer.restart(l),t.state=ec,1),c=-1,d=n.length;++c<d;)n[c].call(r,u);t.state===ec&&(t.on.call("end",r,r.__data__,t.index,t.group),l())}function l(){t.state=Ya,t.timer.stop(),delete i[e];for(var h in i)return;delete r.__transition}}function ja(r,e){var t=r.__transition,i,n,s=!0,o;if(t){e=e==null?null:e+"";for(o in t){if((i=t[o]).name!==e){s=!1;continue}n=i.state>Qu&&i.state<ec,i.state=Ya,i.timer.stop(),i.on.call(n?"interrupt":"cancel",r,r.__data__,i.index,i.group),delete t[o]}s&&delete r.__transition}}function zI(r){return this.each(function(){ja(this,r)})}function BI(r,e){var t,i;return function(){var n=on(this,r),s=n.tween;if(s!==t){i=t=s;for(var o=0,a=i.length;o<a;++o)if(i[o].name===e){i=i.slice(),i.splice(o,1);break}}n.tween=i}}function GI(r,e,t){var i,n;if(typeof t!="function")throw new Error;return function(){var s=on(this,r),o=s.tween;if(o!==i){n=(i=o).slice();for(var a={name:e,value:t},l=0,h=n.length;l<h;++l)if(n[l].name===e){n[l]=a;break}l===h&&n.push(a)}s.tween=n}}function HI(r,e){var t=this._id;if(r+="",arguments.length<2){for(var i=Vi(this.node(),t).tween,n=0,s=i.length,o;n<s;++n)if((o=i[n]).name===r)return o.value;return null}return this.each((e==null?BI:GI)(t,r,e))}function mf(r,e,t){var i=r._id;return r.each(function(){var n=on(this,i);(n.value||(n.value={}))[e]=t.apply(this,arguments)}),function(n){return Vi(n,i).value[e]}}function Xy(r,e){var t;return(typeof e=="number"?Fi:e instanceof Hr?xl:(t=Hr(e))?(e=t,xl):Gy)(r,e)}function VI(r){return function(){this.removeAttribute(r)}}function WI(r){return function(){this.removeAttributeNS(r.space,r.local)}}function UI(r,e,t){var i,n=t+"",s;return function(){var o=this.getAttribute(r);return o===n?null:o===i?s:s=e(i=o,t)}}function YI(r,e,t){var i,n=t+"",s;return function(){var o=this.getAttributeNS(r.space,r.local);return o===n?null:o===i?s:s=e(i=o,t)}}function jI(r,e,t){var i,n,s;return function(){var o,a=t(this),l;return a==null?void this.removeAttribute(r):(o=this.getAttribute(r),l=a+"",o===l?null:o===i&&l===n?s:(n=l,s=e(i=o,a)))}}function XI(r,e,t){var i,n,s;return function(){var o,a=t(this),l;return a==null?void this.removeAttributeNS(r.space,r.local):(o=this.getAttributeNS(r.space,r.local),l=a+"",o===l?null:o===i&&l===n?s:(n=l,s=e(i=o,a)))}}function $I(r,e){var t=bh(r),i=t==="transform"?SI:Xy;return this.attrTween(r,typeof e=="function"?(t.local?XI:jI)(t,i,mf(this,"attr."+r,e)):e==null?(t.local?WI:VI)(t):(t.local?YI:UI)(t,i,e))}function ZI(r,e){return function(t){this.setAttribute(r,e.call(this,t))}}function KI(r,e){return function(t){this.setAttributeNS(r.space,r.local,e.call(this,t))}}function qI(r,e){var t,i;function n(){var s=e.apply(this,arguments);return s!==i&&(t=(i=s)&&KI(r,s)),t}return n._value=e,n}function JI(r,e){var t,i;function n(){var s=e.apply(this,arguments);return s!==i&&(t=(i=s)&&ZI(r,s)),t}return n._value=e,n}function QI(r,e){var t="attr."+r;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;var i=bh(r);return this.tween(t,(i.local?qI:JI)(i,e))}function eP(r,e){return function(){pf(this,r).delay=+e.apply(this,arguments)}}function tP(r,e){return e=+e,function(){pf(this,r).delay=e}}function iP(r){var e=this._id;return arguments.length?this.each((typeof r=="function"?eP:tP)(e,r)):Vi(this.node(),e).delay}function nP(r,e){return function(){on(this,r).duration=+e.apply(this,arguments)}}function rP(r,e){return e=+e,function(){on(this,r).duration=e}}function sP(r){var e=this._id;return arguments.length?this.each((typeof r=="function"?nP:rP)(e,r)):Vi(this.node(),e).duration}function oP(r,e){if(typeof e!="function")throw new Error;return function(){on(this,r).ease=e}}function aP(r){var e=this._id;return arguments.length?this.each(oP(e,r)):Vi(this.node(),e).ease}function lP(r,e){return function(){var t=e.apply(this,arguments);if(typeof t!="function")throw new Error;on(this,r).ease=t}}function hP(r){if(typeof r!="function")throw new Error;return this.each(lP(this._id,r))}function uP(r){typeof r!="function"&&(r=Ty(r));for(var e=this._groups,t=e.length,i=new Array(t),n=0;n<t;++n)for(var s=e[n],o=s.length,a=i[n]=[],l,h=0;h<o;++h)(l=s[h])&&r.call(l,l.__data__,h,s)&&a.push(l);return new Fn(i,this._parents,this._name,this._id)}function cP(r){if(r._id!==this._id)throw new Error;for(var e=this._groups,t=r._groups,i=e.length,n=t.length,s=Math.min(i,n),o=new Array(i),a=0;a<s;++a)for(var l=e[a],h=t[a],u=l.length,c=o[a]=new Array(u),d,f=0;f<u;++f)(d=l[f]||h[f])&&(c[f]=d);for(;a<i;++a)o[a]=e[a];return new Fn(o,this._parents,this._name,this._id)}function dP(r){return(r+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||e==="start"})}function fP(r,e,t){var i,n,s=dP(e)?pf:on;return function(){var o=s(this,r),a=o.on;a!==i&&(n=(i=a).copy()).on(e,t),o.on=n}}function gP(r,e){var t=this._id;return arguments.length<2?Vi(this.node(),t).on.on(r):this.each(fP(t,r,e))}function pP(r){return function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==r)return;e&&e.removeChild(this)}}function mP(){return this.on("end.remove",pP(this._id))}function bP(r){var e=this._name,t=this._id;typeof r!="function"&&(r=hf(r));for(var i=this._groups,n=i.length,s=new Array(n),o=0;o<n;++o)for(var a=i[o],l=a.length,h=s[o]=new Array(l),u,c,d=0;d<l;++d)(u=a[d])&&(c=r.call(u,u.__data__,d,a))&&("__data__"in u&&(c.__data__=u.__data__),h[d]=c,vh(h[d],e,t,d,h,Vi(u,t)));return new Fn(s,this._parents,e,t)}function yP(r){var e=this._name,t=this._id;typeof r!="function"&&(r=Sy(r));for(var i=this._groups,n=i.length,s=[],o=[],a=0;a<n;++a)for(var l=i[a],h=l.length,u,c=0;c<h;++c)if(u=l[c]){for(var d=r.call(u,u.__data__,c,l),f,g=Vi(u,t),m=0,w=d.length;m<w;++m)(f=d[m])&&vh(f,e,t,m,d,g);s.push(d),o.push(u)}return new Fn(s,o,e,t)}var vP=ca.prototype.constructor;function wP(){return new vP(this._groups,this._parents)}function EP(r,e){var t,i,n;return function(){var s=Ds(this,r),o=(this.style.removeProperty(r),Ds(this,r));return s===o?null:s===t&&o===i?n:n=e(t=s,i=o)}}function $y(r){return function(){this.style.removeProperty(r)}}function _P(r,e,t){var i,n=t+"",s;return function(){var o=Ds(this,r);return o===n?null:o===i?s:s=e(i=o,t)}}function CP(r,e,t){var i,n,s;return function(){var o=Ds(this,r),a=t(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(r),Ds(this,r))),o===l?null:o===i&&l===n?s:(n=l,s=e(i=o,a))}}function xP(r,e){var t,i,n,s="style."+e,o="end."+s,a;return function(){var l=on(this,r),h=l.on,u=l.value[s]==null?a||(a=$y(e)):void 0;(h!==t||n!==u)&&(i=(t=h).copy()).on(o,n=u),l.on=i}}function RP(r,e,t){var i=(r+="")=="transform"?RI:Xy;return e==null?this.styleTween(r,EP(r,i)).on("end.style."+r,$y(r)):typeof e=="function"?this.styleTween(r,CP(r,i,mf(this,"style."+r,e))).each(xP(this._id,r)):this.styleTween(r,_P(r,i,e),t).on("end.style."+r,null)}function SP(r,e,t){return function(i){this.style.setProperty(r,e.call(this,i),t)}}function TP(r,e,t){var i,n;function s(){var o=e.apply(this,arguments);return o!==n&&(i=(n=o)&&SP(r,o,t)),i}return s._value=e,s}function MP(r,e,t){var i="style."+(r+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,TP(r,e,t??""))}function LP(r){return function(){this.textContent=r}}function AP(r){return function(){var e=r(this);this.textContent=e??""}}function IP(r){return this.tween("text",typeof r=="function"?AP(mf(this,"text",r)):LP(r==null?"":r+""))}function PP(r){return function(e){this.textContent=r.call(this,e)}}function FP(r){var e,t;function i(){var n=r.apply(this,arguments);return n!==t&&(e=(t=n)&&PP(n)),e}return i._value=r,i}function OP(r){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(r==null)return this.tween(e,null);if(typeof r!="function")throw new Error;return this.tween(e,FP(r))}function DP(){for(var r=this._name,e=this._id,t=Zy(),i=this._groups,n=i.length,s=0;s<n;++s)for(var o=i[s],a=o.length,l,h=0;h<a;++h)if(l=o[h]){var u=Vi(l,e);vh(l,r,t,h,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Fn(i,this._parents,r,t)}function kP(){var r,e,t=this,i=t._id,n=t.size();return new Promise(function(s,o){var a={value:o},l={value:function(){--n===0&&s()}};t.each(function(){var h=on(this,i),u=h.on;u!==r&&(e=(r=u).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),h.on=e}),n===0&&s()})}var NP=0;function Fn(r,e,t,i){this._groups=r,this._parents=e,this._name=t,this._id=i}function Zy(){return++NP}var gn=ca.prototype;Fn.prototype={constructor:Fn,select:bP,selectAll:yP,selectChild:gn.selectChild,selectChildren:gn.selectChildren,filter:uP,merge:cP,selection:wP,transition:DP,call:gn.call,nodes:gn.nodes,node:gn.node,size:gn.size,empty:gn.empty,each:gn.each,on:gP,attr:$I,attrTween:QI,style:RP,styleTween:MP,text:IP,textTween:OP,remove:mP,tween:HI,delay:iP,duration:sP,ease:aP,easeVarying:hP,end:kP,[Symbol.iterator]:gn[Symbol.iterator]};function zP(r){return((r*=2)<=1?r*r*r:(r-=2)*r*r+2)/2}var BP={time:null,delay:0,duration:250,ease:zP};function GP(r,e){for(var t;!(t=r.__transition)||!(t=t[e]);)if(!(r=r.parentNode))throw new Error(`transition ${e} not found`);return t}function HP(r){var e,t;r instanceof Fn?(e=r._id,r=r._name):(e=Zy(),(t=BP).time=gf(),r=r==null?null:r+"");for(var i=this._groups,n=i.length,s=0;s<n;++s)for(var o=i[s],a=o.length,l,h=0;h<a;++h)(l=o[h])&&vh(l,r,e,h,o,t||GP(l,e));return new Fn(i,this._parents,r,e)}ca.prototype.interrupt=zI;ca.prototype.transition=HP;function VP(r){return Math.abs(r=Math.round(r))>=1e21?r.toLocaleString("en").replace(/,/g,""):r.toString(10)}function Ml(r,e){if((t=(r=e?r.toExponential(e-1):r.toExponential()).indexOf("e"))<0)return null;var t,i=r.slice(0,t);return[i.length>1?i[0]+i.slice(2):i,+r.slice(t+1)]}function Ns(r){return r=Ml(Math.abs(r)),r?r[1]:NaN}function WP(r,e){return function(t,i){for(var n=t.length,s=[],o=0,a=r[0],l=0;n>0&&a>0&&(l+a+1>i&&(a=Math.max(1,i-l)),s.push(t.substring(n-=a,n+a)),!((l+=a+1)>i));)a=r[o=(o+1)%r.length];return s.reverse().join(e)}}function UP(r){return function(e){return e.replace(/[0-9]/g,function(t){return r[+t]})}}var YP=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ll(r){if(!(e=YP.exec(r)))throw new Error("invalid format: "+r);var e;return new bf({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Ll.prototype=bf.prototype;function bf(r){this.fill=r.fill===void 0?" ":r.fill+"",this.align=r.align===void 0?">":r.align+"",this.sign=r.sign===void 0?"-":r.sign+"",this.symbol=r.symbol===void 0?"":r.symbol+"",this.zero=!!r.zero,this.width=r.width===void 0?void 0:+r.width,this.comma=!!r.comma,this.precision=r.precision===void 0?void 0:+r.precision,this.trim=!!r.trim,this.type=r.type===void 0?"":r.type+""}bf.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function jP(r){e:for(var e=r.length,t=1,i=-1,n;t<e;++t)switch(r[t]){case".":i=n=t;break;case"0":i===0&&(i=t),n=t;break;default:if(!+r[t])break e;i>0&&(i=0);break}return i>0?r.slice(0,i)+r.slice(n+1):r}var Ky;function XP(r,e){var t=Ml(r,e);if(!t)return r+"";var i=t[0],n=t[1],s=n-(Ky=Math.max(-8,Math.min(8,Math.floor(n/3)))*3)+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+Ml(r,Math.max(0,e+s-1))[0]}function Fp(r,e){var t=Ml(r,e);if(!t)return r+"";var i=t[0],n=t[1];return n<0?"0."+new Array(-n).join("0")+i:i.length>n+1?i.slice(0,n+1)+"."+i.slice(n+1):i+new Array(n-i.length+2).join("0")}const Op={"%":(r,e)=>(r*100).toFixed(e),b:r=>Math.round(r).toString(2),c:r=>r+"",d:VP,e:(r,e)=>r.toExponential(e),f:(r,e)=>r.toFixed(e),g:(r,e)=>r.toPrecision(e),o:r=>Math.round(r).toString(8),p:(r,e)=>Fp(r*100,e),r:Fp,s:XP,X:r=>Math.round(r).toString(16).toUpperCase(),x:r=>Math.round(r).toString(16)};function Dp(r){return r}var kp=Array.prototype.map,Np=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function $P(r){var e=r.grouping===void 0||r.thousands===void 0?Dp:WP(kp.call(r.grouping,Number),r.thousands+""),t=r.currency===void 0?"":r.currency[0]+"",i=r.currency===void 0?"":r.currency[1]+"",n=r.decimal===void 0?".":r.decimal+"",s=r.numerals===void 0?Dp:UP(kp.call(r.numerals,String)),o=r.percent===void 0?"%":r.percent+"",a=r.minus===void 0?"−":r.minus+"",l=r.nan===void 0?"NaN":r.nan+"";function h(c){c=Ll(c);var d=c.fill,f=c.align,g=c.sign,m=c.symbol,w=c.zero,y=c.width,E=c.comma,x=c.precision,v=c.trim,S=c.type;S==="n"?(E=!0,S="g"):Op[S]||(x===void 0&&(x=12),v=!0,S="g"),(w||d==="0"&&f==="=")&&(w=!0,d="0",f="=");var R=m==="$"?t:m==="#"&&/[boxX]/.test(S)?"0"+S.toLowerCase():"",L=m==="$"?i:/[%p]/.test(S)?o:"",C=Op[S],M=/[defgprs%]/.test(S);x=x===void 0?6:/[gprs]/.test(S)?Math.max(1,Math.min(21,x)):Math.max(0,Math.min(20,x));function D(A){var k=R,V=L,I,B,O;if(S==="c")V=C(A)+V,A="";else{A=+A;var H=A<0||1/A<0;if(A=isNaN(A)?l:C(Math.abs(A),x),v&&(A=jP(A)),H&&+A==0&&g!=="+"&&(H=!1),k=(H?g==="("?g:a:g==="-"||g==="("?"":g)+k,V=(S==="s"?Np[8+Ky/3]:"")+V+(H&&g==="("?")":""),M){for(I=-1,B=A.length;++I<B;)if(O=A.charCodeAt(I),48>O||O>57){V=(O===46?n+A.slice(I+1):A.slice(I))+V,A=A.slice(0,I);break}}}E&&!w&&(A=e(A,1/0));var j=k.length+A.length+V.length,q=j<y?new Array(y-j+1).join(d):"";switch(E&&w&&(A=e(q+A,q.length?y-V.length:1/0),q=""),f){case"<":A=k+A+V+q;break;case"=":A=k+q+A+V;break;case"^":A=q.slice(0,j=q.length>>1)+k+A+V+q.slice(j);break;default:A=q+k+A+V;break}return s(A)}return D.toString=function(){return c+""},D}function u(c,d){var f=h((c=Ll(c),c.type="f",c)),g=Math.max(-8,Math.min(8,Math.floor(Ns(d)/3)))*3,m=Math.pow(10,-g),w=Np[8+g/3];return function(y){return f(m*y)+w}}return{format:h,formatPrefix:u}}var Oa,qy,Jy;ZP({thousands:",",grouping:[3],currency:["$",""]});function ZP(r){return Oa=$P(r),qy=Oa.format,Jy=Oa.formatPrefix,Oa}function KP(r){return Math.max(0,-Ns(Math.abs(r)))}function qP(r,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ns(e)/3)))*3-Ns(Math.abs(r)))}function JP(r,e){return r=Math.abs(r),e=Math.abs(e)-r,Math.max(0,Ns(e)-Ns(r))+1}function QP(r,e){switch(arguments.length){case 0:break;case 1:this.range(r);break;default:this.range(e).domain(r);break}return this}function eF(r){return function(){return r}}function tF(r){return+r}var zp=[0,1];function us(r){return r}function tc(r,e){return(e-=r=+r)?function(t){return(t-r)/e}:eF(isNaN(e)?NaN:.5)}function iF(r,e){var t;return r>e&&(t=r,r=e,e=t),function(i){return Math.max(r,Math.min(e,i))}}function nF(r,e,t){var i=r[0],n=r[1],s=e[0],o=e[1];return n<i?(i=tc(n,i),s=t(o,s)):(i=tc(i,n),s=t(s,o)),function(a){return s(i(a))}}function rF(r,e,t){var i=Math.min(r.length,e.length)-1,n=new Array(i),s=new Array(i),o=-1;for(r[i]<r[0]&&(r=r.slice().reverse(),e=e.slice().reverse());++o<i;)n[o]=tc(r[o],r[o+1]),s[o]=t(e[o],e[o+1]);return function(a){var l=rL(r,a,1,i)-1;return s[l](n[l](a))}}function sF(r,e){return e.domain(r.domain()).range(r.range()).interpolate(r.interpolate()).clamp(r.clamp()).unknown(r.unknown())}function oF(){var r=zp,e=zp,t=ff,i,n,s,o=us,a,l,h;function u(){var d=Math.min(r.length,e.length);return o!==us&&(o=iF(r[0],r[d-1])),a=d>2?rF:nF,l=h=null,c}function c(d){return d==null||isNaN(d=+d)?s:(l||(l=a(r.map(i),e,t)))(i(o(d)))}return c.invert=function(d){return o(n((h||(h=a(e,r.map(i),Fi)))(d)))},c.domain=function(d){return arguments.length?(r=Array.from(d,tF),u()):r.slice()},c.range=function(d){return arguments.length?(e=Array.from(d),u()):e.slice()},c.rangeRound=function(d){return e=Array.from(d),t=_I,u()},c.clamp=function(d){return arguments.length?(o=d?!0:us,u()):o!==us},c.interpolate=function(d){return arguments.length?(t=d,u()):t},c.unknown=function(d){return arguments.length?(s=d,c):s},function(d,f){return i=d,n=f,u()}}function aF(){return oF()(us,us)}function lF(r,e,t,i){var n=hL(r,e,t),s;switch(i=Ll(i??",f"),i.type){case"s":{var o=Math.max(Math.abs(r),Math.abs(e));return i.precision==null&&!isNaN(s=qP(n,o))&&(i.precision=s),Jy(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(s=JP(n,Math.max(Math.abs(r),Math.abs(e))))&&(i.precision=s-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(s=KP(n))&&(i.precision=s-(i.type==="%")*2);break}}return qy(i)}function hF(r){var e=r.domain;return r.ticks=function(t){var i=e();return lL(i[0],i[i.length-1],t??10)},r.tickFormat=function(t,i){var n=e();return lF(n[0],n[n.length-1],t??10,i)},r.nice=function(t){t==null&&(t=10);var i=e(),n=0,s=i.length-1,o=i[n],a=i[s],l,h,u=10;for(a<o&&(h=o,o=a,a=h,h=n,n=s,s=h);u-- >0;){if(h=Uu(o,a,t),h===l)return i[n]=o,i[s]=a,e(i);if(h>0)o=Math.floor(o/h)*h,a=Math.ceil(a/h)*h;else if(h<0)o=Math.ceil(o*h)/h,a=Math.floor(a*h)/h;else break;l=h}return r},r}function uF(){var r=aF();return r.copy=function(){return sF(r,uF())},QP.apply(r,arguments),hF(r)}const Da=r=>()=>r;function cF(r,{sourceEvent:e,target:t,transform:i,dispatch:n}){Object.defineProperties(this,{type:{value:r,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:t,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:n}})}function xn(r,e,t){this.k=r,this.x=e,this.y=t}xn.prototype={constructor:xn,scale:function(r){return r===1?this:new xn(this.k*r,this.x,this.y)},translate:function(r,e){return r===0&e===0?this:new xn(this.k,this.x+this.k*r,this.y+this.k*e)},apply:function(r){return[r[0]*this.k+this.x,r[1]*this.k+this.y]},applyX:function(r){return r*this.k+this.x},applyY:function(r){return r*this.k+this.y},invert:function(r){return[(r[0]-this.x)/this.k,(r[1]-this.y)/this.k]},invertX:function(r){return(r-this.x)/this.k},invertY:function(r){return(r-this.y)/this.k},rescaleX:function(r){return r.copy().domain(r.range().map(this.invertX,this).map(r.invert,r))},rescaleY:function(r){return r.copy().domain(r.range().map(this.invertY,this).map(r.invert,r))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Qy=new xn(1,0,0);xn.prototype;function Qh(r){r.stopImmediatePropagation()}function ro(r){r.preventDefault(),r.stopImmediatePropagation()}function dF(r){return(!r.ctrlKey||r.type==="wheel")&&!r.button}function fF(){var r=this;return r instanceof SVGElement?(r=r.ownerSVGElement||r,r.hasAttribute("viewBox")?(r=r.viewBox.baseVal,[[r.x,r.y],[r.x+r.width,r.y+r.height]]):[[0,0],[r.width.baseVal.value,r.height.baseVal.value]]):[[0,0],[r.clientWidth,r.clientHeight]]}function Bp(){return this.__zoom||Qy}function gF(r){return-r.deltaY*(r.deltaMode===1?.05:r.deltaMode?1:.002)*(r.ctrlKey?10:1)}function pF(){return navigator.maxTouchPoints||"ontouchstart"in this}function mF(r,e,t){var i=r.invertX(e[0][0])-t[0][0],n=r.invertX(e[1][0])-t[1][0],s=r.invertY(e[0][1])-t[0][1],o=r.invertY(e[1][1])-t[1][1];return r.translate(n>i?(i+n)/2:Math.min(0,i)||Math.max(0,n),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function P2(){var r=dF,e=fF,t=mF,i=gF,n=pF,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],a=250,l=AI,h=lf("start","zoom","end"),u,c,d,f=500,g=150,m=0,w=10;function y(I){I.property("__zoom",Bp).on("wheel.zoom",C,{passive:!1}).on("mousedown.zoom",M).on("dblclick.zoom",D).filter(n).on("touchstart.zoom",A).on("touchmove.zoom",k).on("touchend.zoom touchcancel.zoom",V).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}y.transform=function(I,B,O,H){var j=I.selection?I.selection():I;j.property("__zoom",Bp),I!==j?S(I,B,O,H):j.interrupt().each(function(){R(this,arguments).event(H).start().zoom(null,typeof B=="function"?B.apply(this,arguments):B).end()})},y.scaleBy=function(I,B,O,H){y.scaleTo(I,function(){var j=this.__zoom.k,q=typeof B=="function"?B.apply(this,arguments):B;return j*q},O,H)},y.scaleTo=function(I,B,O,H){y.transform(I,function(){var j=e.apply(this,arguments),q=this.__zoom,J=O==null?v(j):typeof O=="function"?O.apply(this,arguments):O,ee=q.invert(J),te=typeof B=="function"?B.apply(this,arguments):B;return t(x(E(q,te),J,ee),j,o)},O,H)},y.translateBy=function(I,B,O,H){y.transform(I,function(){return t(this.__zoom.translate(typeof B=="function"?B.apply(this,arguments):B,typeof O=="function"?O.apply(this,arguments):O),e.apply(this,arguments),o)},null,H)},y.translateTo=function(I,B,O,H,j){y.transform(I,function(){var q=e.apply(this,arguments),J=this.__zoom,ee=H==null?v(q):typeof H=="function"?H.apply(this,arguments):H;return t(Qy.translate(ee[0],ee[1]).scale(J.k).translate(typeof B=="function"?-B.apply(this,arguments):-B,typeof O=="function"?-O.apply(this,arguments):-O),q,o)},H,j)};function E(I,B){return B=Math.max(s[0],Math.min(s[1],B)),B===I.k?I:new xn(B,I.x,I.y)}function x(I,B,O){var H=B[0]-O[0]*I.k,j=B[1]-O[1]*I.k;return H===I.x&&j===I.y?I:new xn(I.k,H,j)}function v(I){return[(+I[0][0]+ +I[1][0])/2,(+I[0][1]+ +I[1][1])/2]}function S(I,B,O,H){I.on("start.zoom",function(){R(this,arguments).event(H).start()}).on("interrupt.zoom end.zoom",function(){R(this,arguments).event(H).end()}).tween("zoom",function(){var j=this,q=arguments,J=R(j,q).event(H),ee=e.apply(j,q),te=O==null?v(ee):typeof O=="function"?O.apply(j,q):O,Ce=Math.max(ee[1][0]-ee[0][0],ee[1][1]-ee[0][1]),W=j.__zoom,me=typeof B=="function"?B.apply(j,q):B,Ie=l(W.invert(te).concat(Ce/W.k),me.invert(te).concat(Ce/me.k));return function(Re){if(Re===1)Re=me;else{var Se=Ie(Re),Ue=Ce/Se[2];Re=new xn(Ue,te[0]-Se[0]*Ue,te[1]-Se[1]*Ue)}J.zoom(null,Re)}})}function R(I,B,O){return!O&&I.__zooming||new L(I,B)}function L(I,B){this.that=I,this.args=B,this.active=0,this.sourceEvent=null,this.extent=e.apply(I,B),this.taps=0}L.prototype={event:function(I){return I&&(this.sourceEvent=I),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(I,B){return this.mouse&&I!=="mouse"&&(this.mouse[1]=B.invert(this.mouse[0])),this.touch0&&I!=="touch"&&(this.touch0[1]=B.invert(this.touch0[0])),this.touch1&&I!=="touch"&&(this.touch1[1]=B.invert(this.touch1[0])),this.that.__zoom=B,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(I){var B=wr(this.that).datum();h.call(I,this.that,new cF(I,{sourceEvent:this.sourceEvent,target:y,type:I,transform:this.that.__zoom,dispatch:h}),B)}};function C(I,...B){if(!r.apply(this,arguments))return;var O=R(this,B).event(I),H=this.__zoom,j=Math.max(s[0],Math.min(s[1],H.k*Math.pow(2,i.apply(this,arguments)))),q=mr(I);if(O.wheel)(O.mouse[0][0]!==q[0]||O.mouse[0][1]!==q[1])&&(O.mouse[1]=H.invert(O.mouse[0]=q)),clearTimeout(O.wheel);else{if(H.k===j)return;O.mouse=[q,H.invert(q)],ja(this),O.start()}ro(I),O.wheel=setTimeout(J,g),O.zoom("mouse",t(x(E(H,j),O.mouse[0],O.mouse[1]),O.extent,o));function J(){O.wheel=null,O.end()}}function M(I,...B){if(d||!r.apply(this,arguments))return;var O=I.currentTarget,H=R(this,B,!0).event(I),j=wr(I.view).on("mousemove.zoom",te,!0).on("mouseup.zoom",Ce,!0),q=mr(I,O),J=I.clientX,ee=I.clientY;JA(I.view),Qh(I),H.mouse=[q,this.__zoom.invert(q)],ja(this),H.start();function te(W){if(ro(W),!H.moved){var me=W.clientX-J,Ie=W.clientY-ee;H.moved=me*me+Ie*Ie>m}H.event(W).zoom("mouse",t(x(H.that.__zoom,H.mouse[0]=mr(W,O),H.mouse[1]),H.extent,o))}function Ce(W){j.on("mousemove.zoom mouseup.zoom",null),QA(W.view,H.moved),ro(W),H.event(W).end()}}function D(I,...B){if(r.apply(this,arguments)){var O=this.__zoom,H=mr(I.changedTouches?I.changedTouches[0]:I,this),j=O.invert(H),q=O.k*(I.shiftKey?.5:2),J=t(x(E(O,q),H,j),e.apply(this,B),o);ro(I),a>0?wr(this).transition().duration(a).call(S,J,H,I):wr(this).call(y.transform,J,H,I)}}function A(I,...B){if(r.apply(this,arguments)){var O=I.touches,H=O.length,j=R(this,B,I.changedTouches.length===H).event(I),q,J,ee,te;for(Qh(I),J=0;J<H;++J)ee=O[J],te=mr(ee,this),te=[te,this.__zoom.invert(te),ee.identifier],j.touch0?!j.touch1&&j.touch0[2]!==te[2]&&(j.touch1=te,j.taps=0):(j.touch0=te,q=!0,j.taps=1+!!u);u&&(u=clearTimeout(u)),q&&(j.taps<2&&(c=te[0],u=setTimeout(function(){u=null},f)),ja(this),j.start())}}function k(I,...B){if(this.__zooming){var O=R(this,B).event(I),H=I.changedTouches,j=H.length,q,J,ee,te;for(ro(I),q=0;q<j;++q)J=H[q],ee=mr(J,this),O.touch0&&O.touch0[2]===J.identifier?O.touch0[0]=ee:O.touch1&&O.touch1[2]===J.identifier&&(O.touch1[0]=ee);if(J=O.that.__zoom,O.touch1){var Ce=O.touch0[0],W=O.touch0[1],me=O.touch1[0],Ie=O.touch1[1],Re=(Re=me[0]-Ce[0])*Re+(Re=me[1]-Ce[1])*Re,Se=(Se=Ie[0]-W[0])*Se+(Se=Ie[1]-W[1])*Se;J=E(J,Math.sqrt(Re/Se)),ee=[(Ce[0]+me[0])/2,(Ce[1]+me[1])/2],te=[(W[0]+Ie[0])/2,(W[1]+Ie[1])/2]}else if(O.touch0)ee=O.touch0[0],te=O.touch0[1];else return;O.zoom("touch",t(x(J,ee,te),O.extent,o))}}function V(I,...B){if(this.__zooming){var O=R(this,B).event(I),H=I.changedTouches,j=H.length,q,J;for(Qh(I),d&&clearTimeout(d),d=setTimeout(function(){d=null},f),q=0;q<j;++q)J=H[q],O.touch0&&O.touch0[2]===J.identifier?delete O.touch0:O.touch1&&O.touch1[2]===J.identifier&&delete O.touch1;if(O.touch1&&!O.touch0&&(O.touch0=O.touch1,delete O.touch1),O.touch0)O.touch0[1]=this.__zoom.invert(O.touch0[0]);else if(O.end(),O.taps===2&&(J=mr(J,this),Math.hypot(c[0]-J[0],c[1]-J[1])<w)){var ee=wr(this).on("dblclick.zoom");ee&&ee.apply(this,arguments)}}}return y.wheelDelta=function(I){return arguments.length?(i=typeof I=="function"?I:Da(+I),y):i},y.filter=function(I){return arguments.length?(r=typeof I=="function"?I:Da(!!I),y):r},y.touchable=function(I){return arguments.length?(n=typeof I=="function"?I:Da(!!I),y):n},y.extent=function(I){return arguments.length?(e=typeof I=="function"?I:Da([[+I[0][0],+I[0][1]],[+I[1][0],+I[1][1]]]),y):e},y.scaleExtent=function(I){return arguments.length?(s[0]=+I[0],s[1]=+I[1],y):[s[0],s[1]]},y.translateExtent=function(I){return arguments.length?(o[0][0]=+I[0][0],o[1][0]=+I[1][0],o[0][1]=+I[0][1],o[1][1]=+I[1][1],y):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},y.constrain=function(I){return arguments.length?(t=I,y):t},y.duration=function(I){return arguments.length?(a=+I,y):a},y.interpolate=function(I){return arguments.length?(l=I,y):l},y.on=function(){var I=h.on.apply(h,arguments);return I===h?y:I},y.clickDistance=function(I){return arguments.length?(m=(I=+I)*I,y):Math.sqrt(m)},y.tapDistance=function(I){return arguments.length?(w=+I,y):w},y}var bF={},wh={};wh.byteLength=wF;wh.toByteArray=_F;wh.fromByteArray=RF;var ji=[],gi=[],yF=typeof Uint8Array<"u"?Uint8Array:Array,eu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var es=0,vF=eu.length;es<vF;++es)ji[es]=eu[es],gi[eu.charCodeAt(es)]=es;gi[45]=62;gi[95]=63;function ev(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var i=t===e?0:4-t%4;return[t,i]}function wF(r){var e=ev(r),t=e[0],i=e[1];return(t+i)*3/4-i}function EF(r,e,t){return(e+t)*3/4-t}function _F(r){var e,t=ev(r),i=t[0],n=t[1],s=new yF(EF(r,i,n)),o=0,a=n>0?i-4:i,l;for(l=0;l<a;l+=4)e=gi[r.charCodeAt(l)]<<18|gi[r.charCodeAt(l+1)]<<12|gi[r.charCodeAt(l+2)]<<6|gi[r.charCodeAt(l+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return n===2&&(e=gi[r.charCodeAt(l)]<<2|gi[r.charCodeAt(l+1)]>>4,s[o++]=e&255),n===1&&(e=gi[r.charCodeAt(l)]<<10|gi[r.charCodeAt(l+1)]<<4|gi[r.charCodeAt(l+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function CF(r){return ji[r>>18&63]+ji[r>>12&63]+ji[r>>6&63]+ji[r&63]}function xF(r,e,t){for(var i,n=[],s=e;s<t;s+=3)i=(r[s]<<16&16711680)+(r[s+1]<<8&65280)+(r[s+2]&255),n.push(CF(i));return n.join("")}function RF(r){for(var e,t=r.length,i=t%3,n=[],s=16383,o=0,a=t-i;o<a;o+=s)n.push(xF(r,o,o+s>a?a:o+s));return i===1?(e=r[t-1],n.push(ji[e>>2]+ji[e<<4&63]+"==")):i===2&&(e=(r[t-2]<<8)+r[t-1],n.push(ji[e>>10]+ji[e>>4&63]+ji[e<<2&63]+"=")),n.join("")}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(r){const e=wh,t=dh,i=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;r.Buffer=a,r.SlowBuffer=E,r.INSPECT_MAX_BYTES=50;const n=2147483647;r.kMaxLength=n,a.TYPED_ARRAY_SUPPORT=s(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const _=new Uint8Array(1),p={foo:function(){return 42}};return Object.setPrototypeOf(p,Uint8Array.prototype),Object.setPrototypeOf(_,p),_.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function o(_){if(_>n)throw new RangeError('The value "'+_+'" is invalid for option "size"');const p=new Uint8Array(_);return Object.setPrototypeOf(p,a.prototype),p}function a(_,p,b){if(typeof _=="number"){if(typeof p=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return c(_)}return l(_,p,b)}a.poolSize=8192;function l(_,p,b){if(typeof _=="string")return d(_,p);if(ArrayBuffer.isView(_))return g(_);if(_==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof _);if(Be(_,ArrayBuffer)||_&&Be(_.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Be(_,SharedArrayBuffer)||_&&Be(_.buffer,SharedArrayBuffer)))return m(_,p,b);if(typeof _=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const T=_.valueOf&&_.valueOf();if(T!=null&&T!==_)return a.from(T,p,b);const F=w(_);if(F)return F;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof _[Symbol.toPrimitive]=="function")return a.from(_[Symbol.toPrimitive]("string"),p,b);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof _)}a.from=function(_,p,b){return l(_,p,b)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function h(_){if(typeof _!="number")throw new TypeError('"size" argument must be of type number');if(_<0)throw new RangeError('The value "'+_+'" is invalid for option "size"')}function u(_,p,b){return h(_),_<=0?o(_):p!==void 0?typeof b=="string"?o(_).fill(p,b):o(_).fill(p):o(_)}a.alloc=function(_,p,b){return u(_,p,b)};function c(_){return h(_),o(_<0?0:y(_)|0)}a.allocUnsafe=function(_){return c(_)},a.allocUnsafeSlow=function(_){return c(_)};function d(_,p){if((typeof p!="string"||p==="")&&(p="utf8"),!a.isEncoding(p))throw new TypeError("Unknown encoding: "+p);const b=x(_,p)|0;let T=o(b);const F=T.write(_,p);return F!==b&&(T=T.slice(0,F)),T}function f(_){const p=_.length<0?0:y(_.length)|0,b=o(p);for(let T=0;T<p;T+=1)b[T]=_[T]&255;return b}function g(_){if(Be(_,Uint8Array)){const p=new Uint8Array(_);return m(p.buffer,p.byteOffset,p.byteLength)}return f(_)}function m(_,p,b){if(p<0||_.byteLength<p)throw new RangeError('"offset" is outside of buffer bounds');if(_.byteLength<p+(b||0))throw new RangeError('"length" is outside of buffer bounds');let T;return p===void 0&&b===void 0?T=new Uint8Array(_):b===void 0?T=new Uint8Array(_,p):T=new Uint8Array(_,p,b),Object.setPrototypeOf(T,a.prototype),T}function w(_){if(a.isBuffer(_)){const p=y(_.length)|0,b=o(p);return b.length===0||_.copy(b,0,0,p),b}if(_.length!==void 0)return typeof _.length!="number"||qe(_.length)?o(0):f(_);if(_.type==="Buffer"&&Array.isArray(_.data))return f(_.data)}function y(_){if(_>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return _|0}function E(_){return+_!=_&&(_=0),a.alloc(+_)}a.isBuffer=function(p){return p!=null&&p._isBuffer===!0&&p!==a.prototype},a.compare=function(p,b){if(Be(p,Uint8Array)&&(p=a.from(p,p.offset,p.byteLength)),Be(b,Uint8Array)&&(b=a.from(b,b.offset,b.byteLength)),!a.isBuffer(p)||!a.isBuffer(b))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(p===b)return 0;let T=p.length,F=b.length;for(let G=0,U=Math.min(T,F);G<U;++G)if(p[G]!==b[G]){T=p[G],F=b[G];break}return T<F?-1:F<T?1:0},a.isEncoding=function(p){switch(String(p).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(p,b){if(!Array.isArray(p))throw new TypeError('"list" argument must be an Array of Buffers');if(p.length===0)return a.alloc(0);let T;if(b===void 0)for(b=0,T=0;T<p.length;++T)b+=p[T].length;const F=a.allocUnsafe(b);let G=0;for(T=0;T<p.length;++T){let U=p[T];if(Be(U,Uint8Array))G+U.length>F.length?(a.isBuffer(U)||(U=a.from(U)),U.copy(F,G)):Uint8Array.prototype.set.call(F,U,G);else if(a.isBuffer(U))U.copy(F,G);else throw new TypeError('"list" argument must be an Array of Buffers');G+=U.length}return F};function x(_,p){if(a.isBuffer(_))return _.length;if(ArrayBuffer.isView(_)||Be(_,ArrayBuffer))return _.byteLength;if(typeof _!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof _);const b=_.length,T=arguments.length>2&&arguments[2]===!0;if(!T&&b===0)return 0;let F=!1;for(;;)switch(p){case"ascii":case"latin1":case"binary":return b;case"utf8":case"utf-8":return Ct(_).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b*2;case"hex":return b>>>1;case"base64":return bt(_).length;default:if(F)return T?-1:Ct(_).length;p=(""+p).toLowerCase(),F=!0}}a.byteLength=x;function v(_,p,b){let T=!1;if((p===void 0||p<0)&&(p=0),p>this.length||((b===void 0||b>this.length)&&(b=this.length),b<=0)||(b>>>=0,p>>>=0,b<=p))return"";for(_||(_="utf8");;)switch(_){case"hex":return q(this,p,b);case"utf8":case"utf-8":return I(this,p,b);case"ascii":return H(this,p,b);case"latin1":case"binary":return j(this,p,b);case"base64":return V(this,p,b);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return J(this,p,b);default:if(T)throw new TypeError("Unknown encoding: "+_);_=(_+"").toLowerCase(),T=!0}}a.prototype._isBuffer=!0;function S(_,p,b){const T=_[p];_[p]=_[b],_[b]=T}a.prototype.swap16=function(){const p=this.length;if(p%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let b=0;b<p;b+=2)S(this,b,b+1);return this},a.prototype.swap32=function(){const p=this.length;if(p%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let b=0;b<p;b+=4)S(this,b,b+3),S(this,b+1,b+2);return this},a.prototype.swap64=function(){const p=this.length;if(p%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let b=0;b<p;b+=8)S(this,b,b+7),S(this,b+1,b+6),S(this,b+2,b+5),S(this,b+3,b+4);return this},a.prototype.toString=function(){const p=this.length;return p===0?"":arguments.length===0?I(this,0,p):v.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(p){if(!a.isBuffer(p))throw new TypeError("Argument must be a Buffer");return this===p?!0:a.compare(this,p)===0},a.prototype.inspect=function(){let p="";const b=r.INSPECT_MAX_BYTES;return p=this.toString("hex",0,b).replace(/(.{2})/g,"$1 ").trim(),this.length>b&&(p+=" ... "),"<Buffer "+p+">"},i&&(a.prototype[i]=a.prototype.inspect),a.prototype.compare=function(p,b,T,F,G){if(Be(p,Uint8Array)&&(p=a.from(p,p.offset,p.byteLength)),!a.isBuffer(p))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof p);if(b===void 0&&(b=0),T===void 0&&(T=p?p.length:0),F===void 0&&(F=0),G===void 0&&(G=this.length),b<0||T>p.length||F<0||G>this.length)throw new RangeError("out of range index");if(F>=G&&b>=T)return 0;if(F>=G)return-1;if(b>=T)return 1;if(b>>>=0,T>>>=0,F>>>=0,G>>>=0,this===p)return 0;let U=G-F,z=T-b;const Q=Math.min(U,z),ie=this.slice(F,G),de=p.slice(b,T);for(let re=0;re<Q;++re)if(ie[re]!==de[re]){U=ie[re],z=de[re];break}return U<z?-1:z<U?1:0};function R(_,p,b,T,F){if(_.length===0)return-1;if(typeof b=="string"?(T=b,b=0):b>2147483647?b=2147483647:b<-2147483648&&(b=-2147483648),b=+b,qe(b)&&(b=F?0:_.length-1),b<0&&(b=_.length+b),b>=_.length){if(F)return-1;b=_.length-1}else if(b<0)if(F)b=0;else return-1;if(typeof p=="string"&&(p=a.from(p,T)),a.isBuffer(p))return p.length===0?-1:L(_,p,b,T,F);if(typeof p=="number")return p=p&255,typeof Uint8Array.prototype.indexOf=="function"?F?Uint8Array.prototype.indexOf.call(_,p,b):Uint8Array.prototype.lastIndexOf.call(_,p,b):L(_,[p],b,T,F);throw new TypeError("val must be string, number or Buffer")}function L(_,p,b,T,F){let G=1,U=_.length,z=p.length;if(T!==void 0&&(T=String(T).toLowerCase(),T==="ucs2"||T==="ucs-2"||T==="utf16le"||T==="utf-16le")){if(_.length<2||p.length<2)return-1;G=2,U/=2,z/=2,b/=2}function Q(de,re){return G===1?de[re]:de.readUInt16BE(re*G)}let ie;if(F){let de=-1;for(ie=b;ie<U;ie++)if(Q(_,ie)===Q(p,de===-1?0:ie-de)){if(de===-1&&(de=ie),ie-de+1===z)return de*G}else de!==-1&&(ie-=ie-de),de=-1}else for(b+z>U&&(b=U-z),ie=b;ie>=0;ie--){let de=!0;for(let re=0;re<z;re++)if(Q(_,ie+re)!==Q(p,re)){de=!1;break}if(de)return ie}return-1}a.prototype.includes=function(p,b,T){return this.indexOf(p,b,T)!==-1},a.prototype.indexOf=function(p,b,T){return R(this,p,b,T,!0)},a.prototype.lastIndexOf=function(p,b,T){return R(this,p,b,T,!1)};function C(_,p,b,T){b=Number(b)||0;const F=_.length-b;T?(T=Number(T),T>F&&(T=F)):T=F;const G=p.length;T>G/2&&(T=G/2);let U;for(U=0;U<T;++U){const z=parseInt(p.substr(U*2,2),16);if(qe(z))return U;_[b+U]=z}return U}function M(_,p,b,T){return ut(Ct(p,_.length-b),_,b,T)}function D(_,p,b,T){return ut(Li(p),_,b,T)}function A(_,p,b,T){return ut(bt(p),_,b,T)}function k(_,p,b,T){return ut(Wi(p,_.length-b),_,b,T)}a.prototype.write=function(p,b,T,F){if(b===void 0)F="utf8",T=this.length,b=0;else if(T===void 0&&typeof b=="string")F=b,T=this.length,b=0;else if(isFinite(b))b=b>>>0,isFinite(T)?(T=T>>>0,F===void 0&&(F="utf8")):(F=T,T=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const G=this.length-b;if((T===void 0||T>G)&&(T=G),p.length>0&&(T<0||b<0)||b>this.length)throw new RangeError("Attempt to write outside buffer bounds");F||(F="utf8");let U=!1;for(;;)switch(F){case"hex":return C(this,p,b,T);case"utf8":case"utf-8":return M(this,p,b,T);case"ascii":case"latin1":case"binary":return D(this,p,b,T);case"base64":return A(this,p,b,T);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,p,b,T);default:if(U)throw new TypeError("Unknown encoding: "+F);F=(""+F).toLowerCase(),U=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function V(_,p,b){return p===0&&b===_.length?e.fromByteArray(_):e.fromByteArray(_.slice(p,b))}function I(_,p,b){b=Math.min(_.length,b);const T=[];let F=p;for(;F<b;){const G=_[F];let U=null,z=G>239?4:G>223?3:G>191?2:1;if(F+z<=b){let Q,ie,de,re;switch(z){case 1:G<128&&(U=G);break;case 2:Q=_[F+1],(Q&192)===128&&(re=(G&31)<<6|Q&63,re>127&&(U=re));break;case 3:Q=_[F+1],ie=_[F+2],(Q&192)===128&&(ie&192)===128&&(re=(G&15)<<12|(Q&63)<<6|ie&63,re>2047&&(re<55296||re>57343)&&(U=re));break;case 4:Q=_[F+1],ie=_[F+2],de=_[F+3],(Q&192)===128&&(ie&192)===128&&(de&192)===128&&(re=(G&15)<<18|(Q&63)<<12|(ie&63)<<6|de&63,re>65535&&re<1114112&&(U=re))}}U===null?(U=65533,z=1):U>65535&&(U-=65536,T.push(U>>>10&1023|55296),U=56320|U&1023),T.push(U),F+=z}return O(T)}const B=4096;function O(_){const p=_.length;if(p<=B)return String.fromCharCode.apply(String,_);let b="",T=0;for(;T<p;)b+=String.fromCharCode.apply(String,_.slice(T,T+=B));return b}function H(_,p,b){let T="";b=Math.min(_.length,b);for(let F=p;F<b;++F)T+=String.fromCharCode(_[F]&127);return T}function j(_,p,b){let T="";b=Math.min(_.length,b);for(let F=p;F<b;++F)T+=String.fromCharCode(_[F]);return T}function q(_,p,b){const T=_.length;(!p||p<0)&&(p=0),(!b||b<0||b>T)&&(b=T);let F="";for(let G=p;G<b;++G)F+=ct[_[G]];return F}function J(_,p,b){const T=_.slice(p,b);let F="";for(let G=0;G<T.length-1;G+=2)F+=String.fromCharCode(T[G]+T[G+1]*256);return F}a.prototype.slice=function(p,b){const T=this.length;p=~~p,b=b===void 0?T:~~b,p<0?(p+=T,p<0&&(p=0)):p>T&&(p=T),b<0?(b+=T,b<0&&(b=0)):b>T&&(b=T),b<p&&(b=p);const F=this.subarray(p,b);return Object.setPrototypeOf(F,a.prototype),F};function ee(_,p,b){if(_%1!==0||_<0)throw new RangeError("offset is not uint");if(_+p>b)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(p,b,T){p=p>>>0,b=b>>>0,T||ee(p,b,this.length);let F=this[p],G=1,U=0;for(;++U<b&&(G*=256);)F+=this[p+U]*G;return F},a.prototype.readUintBE=a.prototype.readUIntBE=function(p,b,T){p=p>>>0,b=b>>>0,T||ee(p,b,this.length);let F=this[p+--b],G=1;for(;b>0&&(G*=256);)F+=this[p+--b]*G;return F},a.prototype.readUint8=a.prototype.readUInt8=function(p,b){return p=p>>>0,b||ee(p,1,this.length),this[p]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(p,b){return p=p>>>0,b||ee(p,2,this.length),this[p]|this[p+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(p,b){return p=p>>>0,b||ee(p,2,this.length),this[p]<<8|this[p+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(p,b){return p=p>>>0,b||ee(p,4,this.length),(this[p]|this[p+1]<<8|this[p+2]<<16)+this[p+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(p,b){return p=p>>>0,b||ee(p,4,this.length),this[p]*16777216+(this[p+1]<<16|this[p+2]<<8|this[p+3])},a.prototype.readBigUInt64LE=je(function(p){p=p>>>0,_t(p,"offset");const b=this[p],T=this[p+7];(b===void 0||T===void 0)&&Ft(p,this.length-8);const F=b+this[++p]*2**8+this[++p]*2**16+this[++p]*2**24,G=this[++p]+this[++p]*2**8+this[++p]*2**16+T*2**24;return BigInt(F)+(BigInt(G)<<BigInt(32))}),a.prototype.readBigUInt64BE=je(function(p){p=p>>>0,_t(p,"offset");const b=this[p],T=this[p+7];(b===void 0||T===void 0)&&Ft(p,this.length-8);const F=b*2**24+this[++p]*2**16+this[++p]*2**8+this[++p],G=this[++p]*2**24+this[++p]*2**16+this[++p]*2**8+T;return(BigInt(F)<<BigInt(32))+BigInt(G)}),a.prototype.readIntLE=function(p,b,T){p=p>>>0,b=b>>>0,T||ee(p,b,this.length);let F=this[p],G=1,U=0;for(;++U<b&&(G*=256);)F+=this[p+U]*G;return G*=128,F>=G&&(F-=Math.pow(2,8*b)),F},a.prototype.readIntBE=function(p,b,T){p=p>>>0,b=b>>>0,T||ee(p,b,this.length);let F=b,G=1,U=this[p+--F];for(;F>0&&(G*=256);)U+=this[p+--F]*G;return G*=128,U>=G&&(U-=Math.pow(2,8*b)),U},a.prototype.readInt8=function(p,b){return p=p>>>0,b||ee(p,1,this.length),this[p]&128?(255-this[p]+1)*-1:this[p]},a.prototype.readInt16LE=function(p,b){p=p>>>0,b||ee(p,2,this.length);const T=this[p]|this[p+1]<<8;return T&32768?T|4294901760:T},a.prototype.readInt16BE=function(p,b){p=p>>>0,b||ee(p,2,this.length);const T=this[p+1]|this[p]<<8;return T&32768?T|4294901760:T},a.prototype.readInt32LE=function(p,b){return p=p>>>0,b||ee(p,4,this.length),this[p]|this[p+1]<<8|this[p+2]<<16|this[p+3]<<24},a.prototype.readInt32BE=function(p,b){return p=p>>>0,b||ee(p,4,this.length),this[p]<<24|this[p+1]<<16|this[p+2]<<8|this[p+3]},a.prototype.readBigInt64LE=je(function(p){p=p>>>0,_t(p,"offset");const b=this[p],T=this[p+7];(b===void 0||T===void 0)&&Ft(p,this.length-8);const F=this[p+4]+this[p+5]*2**8+this[p+6]*2**16+(T<<24);return(BigInt(F)<<BigInt(32))+BigInt(b+this[++p]*2**8+this[++p]*2**16+this[++p]*2**24)}),a.prototype.readBigInt64BE=je(function(p){p=p>>>0,_t(p,"offset");const b=this[p],T=this[p+7];(b===void 0||T===void 0)&&Ft(p,this.length-8);const F=(b<<24)+this[++p]*2**16+this[++p]*2**8+this[++p];return(BigInt(F)<<BigInt(32))+BigInt(this[++p]*2**24+this[++p]*2**16+this[++p]*2**8+T)}),a.prototype.readFloatLE=function(p,b){return p=p>>>0,b||ee(p,4,this.length),t.read(this,p,!0,23,4)},a.prototype.readFloatBE=function(p,b){return p=p>>>0,b||ee(p,4,this.length),t.read(this,p,!1,23,4)},a.prototype.readDoubleLE=function(p,b){return p=p>>>0,b||ee(p,8,this.length),t.read(this,p,!0,52,8)},a.prototype.readDoubleBE=function(p,b){return p=p>>>0,b||ee(p,8,this.length),t.read(this,p,!1,52,8)};function te(_,p,b,T,F,G){if(!a.isBuffer(_))throw new TypeError('"buffer" argument must be a Buffer instance');if(p>F||p<G)throw new RangeError('"value" argument is out of bounds');if(b+T>_.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(p,b,T,F){if(p=+p,b=b>>>0,T=T>>>0,!F){const z=Math.pow(2,8*T)-1;te(this,p,b,T,z,0)}let G=1,U=0;for(this[b]=p&255;++U<T&&(G*=256);)this[b+U]=p/G&255;return b+T},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(p,b,T,F){if(p=+p,b=b>>>0,T=T>>>0,!F){const z=Math.pow(2,8*T)-1;te(this,p,b,T,z,0)}let G=T-1,U=1;for(this[b+G]=p&255;--G>=0&&(U*=256);)this[b+G]=p/U&255;return b+T},a.prototype.writeUint8=a.prototype.writeUInt8=function(p,b,T){return p=+p,b=b>>>0,T||te(this,p,b,1,255,0),this[b]=p&255,b+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(p,b,T){return p=+p,b=b>>>0,T||te(this,p,b,2,65535,0),this[b]=p&255,this[b+1]=p>>>8,b+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(p,b,T){return p=+p,b=b>>>0,T||te(this,p,b,2,65535,0),this[b]=p>>>8,this[b+1]=p&255,b+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(p,b,T){return p=+p,b=b>>>0,T||te(this,p,b,4,4294967295,0),this[b+3]=p>>>24,this[b+2]=p>>>16,this[b+1]=p>>>8,this[b]=p&255,b+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(p,b,T){return p=+p,b=b>>>0,T||te(this,p,b,4,4294967295,0),this[b]=p>>>24,this[b+1]=p>>>16,this[b+2]=p>>>8,this[b+3]=p&255,b+4};function Ce(_,p,b,T,F){Pt(p,T,F,_,b,7);let G=Number(p&BigInt(4294967295));_[b++]=G,G=G>>8,_[b++]=G,G=G>>8,_[b++]=G,G=G>>8,_[b++]=G;let U=Number(p>>BigInt(32)&BigInt(4294967295));return _[b++]=U,U=U>>8,_[b++]=U,U=U>>8,_[b++]=U,U=U>>8,_[b++]=U,b}function W(_,p,b,T,F){Pt(p,T,F,_,b,7);let G=Number(p&BigInt(4294967295));_[b+7]=G,G=G>>8,_[b+6]=G,G=G>>8,_[b+5]=G,G=G>>8,_[b+4]=G;let U=Number(p>>BigInt(32)&BigInt(4294967295));return _[b+3]=U,U=U>>8,_[b+2]=U,U=U>>8,_[b+1]=U,U=U>>8,_[b]=U,b+8}a.prototype.writeBigUInt64LE=je(function(p,b=0){return Ce(this,p,b,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=je(function(p,b=0){return W(this,p,b,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(p,b,T,F){if(p=+p,b=b>>>0,!F){const Q=Math.pow(2,8*T-1);te(this,p,b,T,Q-1,-Q)}let G=0,U=1,z=0;for(this[b]=p&255;++G<T&&(U*=256);)p<0&&z===0&&this[b+G-1]!==0&&(z=1),this[b+G]=(p/U>>0)-z&255;return b+T},a.prototype.writeIntBE=function(p,b,T,F){if(p=+p,b=b>>>0,!F){const Q=Math.pow(2,8*T-1);te(this,p,b,T,Q-1,-Q)}let G=T-1,U=1,z=0;for(this[b+G]=p&255;--G>=0&&(U*=256);)p<0&&z===0&&this[b+G+1]!==0&&(z=1),this[b+G]=(p/U>>0)-z&255;return b+T},a.prototype.writeInt8=function(p,b,T){return p=+p,b=b>>>0,T||te(this,p,b,1,127,-128),p<0&&(p=255+p+1),this[b]=p&255,b+1},a.prototype.writeInt16LE=function(p,b,T){return p=+p,b=b>>>0,T||te(this,p,b,2,32767,-32768),this[b]=p&255,this[b+1]=p>>>8,b+2},a.prototype.writeInt16BE=function(p,b,T){return p=+p,b=b>>>0,T||te(this,p,b,2,32767,-32768),this[b]=p>>>8,this[b+1]=p&255,b+2},a.prototype.writeInt32LE=function(p,b,T){return p=+p,b=b>>>0,T||te(this,p,b,4,2147483647,-2147483648),this[b]=p&255,this[b+1]=p>>>8,this[b+2]=p>>>16,this[b+3]=p>>>24,b+4},a.prototype.writeInt32BE=function(p,b,T){return p=+p,b=b>>>0,T||te(this,p,b,4,2147483647,-2147483648),p<0&&(p=4294967295+p+1),this[b]=p>>>24,this[b+1]=p>>>16,this[b+2]=p>>>8,this[b+3]=p&255,b+4},a.prototype.writeBigInt64LE=je(function(p,b=0){return Ce(this,p,b,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=je(function(p,b=0){return W(this,p,b,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function me(_,p,b,T,F,G){if(b+T>_.length)throw new RangeError("Index out of range");if(b<0)throw new RangeError("Index out of range")}function Ie(_,p,b,T,F){return p=+p,b=b>>>0,F||me(_,p,b,4),t.write(_,p,b,T,23,4),b+4}a.prototype.writeFloatLE=function(p,b,T){return Ie(this,p,b,!0,T)},a.prototype.writeFloatBE=function(p,b,T){return Ie(this,p,b,!1,T)};function Re(_,p,b,T,F){return p=+p,b=b>>>0,F||me(_,p,b,8),t.write(_,p,b,T,52,8),b+8}a.prototype.writeDoubleLE=function(p,b,T){return Re(this,p,b,!0,T)},a.prototype.writeDoubleBE=function(p,b,T){return Re(this,p,b,!1,T)},a.prototype.copy=function(p,b,T,F){if(!a.isBuffer(p))throw new TypeError("argument should be a Buffer");if(T||(T=0),!F&&F!==0&&(F=this.length),b>=p.length&&(b=p.length),b||(b=0),F>0&&F<T&&(F=T),F===T||p.length===0||this.length===0)return 0;if(b<0)throw new RangeError("targetStart out of bounds");if(T<0||T>=this.length)throw new RangeError("Index out of range");if(F<0)throw new RangeError("sourceEnd out of bounds");F>this.length&&(F=this.length),p.length-b<F-T&&(F=p.length-b+T);const G=F-T;return this===p&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(b,T,F):Uint8Array.prototype.set.call(p,this.subarray(T,F),b),G},a.prototype.fill=function(p,b,T,F){if(typeof p=="string"){if(typeof b=="string"?(F=b,b=0,T=this.length):typeof T=="string"&&(F=T,T=this.length),F!==void 0&&typeof F!="string")throw new TypeError("encoding must be a string");if(typeof F=="string"&&!a.isEncoding(F))throw new TypeError("Unknown encoding: "+F);if(p.length===1){const U=p.charCodeAt(0);(F==="utf8"&&U<128||F==="latin1")&&(p=U)}}else typeof p=="number"?p=p&255:typeof p=="boolean"&&(p=Number(p));if(b<0||this.length<b||this.length<T)throw new RangeError("Out of range index");if(T<=b)return this;b=b>>>0,T=T===void 0?this.length:T>>>0,p||(p=0);let G;if(typeof p=="number")for(G=b;G<T;++G)this[G]=p;else{const U=a.isBuffer(p)?p:a.from(p,F),z=U.length;if(z===0)throw new TypeError('The value "'+p+'" is invalid for argument "value"');for(G=0;G<T-b;++G)this[G+b]=U[G%z]}return this};const Se={};function Ue(_,p,b){Se[_]=class extends b{constructor(){super(),Object.defineProperty(this,"message",{value:p.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${_}]`,this.stack,delete this.name}get code(){return _}set code(F){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:F,writable:!0})}toString(){return`${this.name} [${_}]: ${this.message}`}}}Ue("ERR_BUFFER_OUT_OF_BOUNDS",function(_){return _?`${_} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Ue("ERR_INVALID_ARG_TYPE",function(_,p){return`The "${_}" argument must be of type number. Received type ${typeof p}`},TypeError),Ue("ERR_OUT_OF_RANGE",function(_,p,b){let T=`The value of "${_}" is out of range.`,F=b;return Number.isInteger(b)&&Math.abs(b)>2**32?F=Ye(String(b)):typeof b=="bigint"&&(F=String(b),(b>BigInt(2)**BigInt(32)||b<-(BigInt(2)**BigInt(32)))&&(F=Ye(F)),F+="n"),T+=` It must be ${p}. Received ${F}`,T},RangeError);function Ye(_){let p="",b=_.length;const T=_[0]==="-"?1:0;for(;b>=T+4;b-=3)p=`_${_.slice(b-3,b)}${p}`;return`${_.slice(0,b)}${p}`}function Bt(_,p,b){_t(p,"offset"),(_[p]===void 0||_[p+b]===void 0)&&Ft(p,_.length-(b+1))}function Pt(_,p,b,T,F,G){if(_>b||_<p){const U=typeof p=="bigint"?"n":"";let z;throw G>3?p===0||p===BigInt(0)?z=`>= 0${U} and < 2${U} ** ${(G+1)*8}${U}`:z=`>= -(2${U} ** ${(G+1)*8-1}${U}) and < 2 ** ${(G+1)*8-1}${U}`:z=`>= ${p}${U} and <= ${b}${U}`,new Se.ERR_OUT_OF_RANGE("value",z,_)}Bt(T,F,G)}function _t(_,p){if(typeof _!="number")throw new Se.ERR_INVALID_ARG_TYPE(p,"number",_)}function Ft(_,p,b){throw Math.floor(_)!==_?(_t(_,b),new Se.ERR_OUT_OF_RANGE(b||"offset","an integer",_)):p<0?new Se.ERR_BUFFER_OUT_OF_BOUNDS:new Se.ERR_OUT_OF_RANGE(b||"offset",`>= ${b?1:0} and <= ${p}`,_)}const Mi=/[^+/0-9A-Za-z-_]/g;function ot(_){if(_=_.split("=")[0],_=_.trim().replace(Mi,""),_.length<2)return"";for(;_.length%4!==0;)_=_+"=";return _}function Ct(_,p){p=p||1/0;let b;const T=_.length;let F=null;const G=[];for(let U=0;U<T;++U){if(b=_.charCodeAt(U),b>55295&&b<57344){if(!F){if(b>56319){(p-=3)>-1&&G.push(239,191,189);continue}else if(U+1===T){(p-=3)>-1&&G.push(239,191,189);continue}F=b;continue}if(b<56320){(p-=3)>-1&&G.push(239,191,189),F=b;continue}b=(F-55296<<10|b-56320)+65536}else F&&(p-=3)>-1&&G.push(239,191,189);if(F=null,b<128){if((p-=1)<0)break;G.push(b)}else if(b<2048){if((p-=2)<0)break;G.push(b>>6|192,b&63|128)}else if(b<65536){if((p-=3)<0)break;G.push(b>>12|224,b>>6&63|128,b&63|128)}else if(b<1114112){if((p-=4)<0)break;G.push(b>>18|240,b>>12&63|128,b>>6&63|128,b&63|128)}else throw new Error("Invalid code point")}return G}function Li(_){const p=[];for(let b=0;b<_.length;++b)p.push(_.charCodeAt(b)&255);return p}function Wi(_,p){let b,T,F;const G=[];for(let U=0;U<_.length&&!((p-=2)<0);++U)b=_.charCodeAt(U),T=b>>8,F=b%256,G.push(F),G.push(T);return G}function bt(_){return e.toByteArray(ot(_))}function ut(_,p,b,T){let F;for(F=0;F<T&&!(F+b>=p.length||F>=_.length);++F)p[F+b]=_[F];return F}function Be(_,p){return _ instanceof p||_!=null&&_.constructor!=null&&_.constructor.name!=null&&_.constructor.name===p.name}function qe(_){return _!==_}const ct=function(){const _="0123456789abcdef",p=new Array(256);for(let b=0;b<16;++b){const T=b*16;for(let F=0;F<16;++F)p[T+F]=_[b]+_[F]}return p}();function je(_){return typeof BigInt>"u"?Qt:_}function Qt(){throw new Error("BigInt not supported")}})(bF);const SF="modulepreload",TF=function(r,e){return new URL(r,e).href},Gp={},O2=function(e,t,i){let n=Promise.resolve();if(t&&t.length>0){const s=document.getElementsByTagName("link"),o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));n=Promise.all(t.map(l=>{if(l=TF(l,i),l in Gp)return;Gp[l]=!0;const h=l.endsWith(".css"),u=h?'[rel="stylesheet"]':"";if(!!i)for(let f=s.length-1;f>=0;f--){const g=s[f];if(g.href===l&&(!h||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${u}`))return;const d=document.createElement("link");if(d.rel=h?"stylesheet":SF,h||(d.as="script",d.crossOrigin=""),d.href=l,a&&d.setAttribute("nonce",a),document.head.appendChild(d),h)return new Promise((f,g)=>{d.addEventListener("load",f),d.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}return n.then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})},tv=.5,MF=10,Hp=.25;class iv{constructor(e,t,i,n,s,o){this.sourceProj_=e,this.targetProj_=t;let a={};const l=_s(this.targetProj_,this.sourceProj_);this.transformInv_=function(E){const x=E[0]+"/"+E[1];return a[x]||(a[x]=l(E)),a[x]},this.maxSourceExtent_=n,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&Pe(n)>=Pe(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Pe(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Pe(this.targetProj_.getExtent()):null;const h=lr(i),u=Dl(i),c=Ol(i),d=Fl(i),f=this.transformInv_(h),g=this.transformInv_(u),m=this.transformInv_(c),w=this.transformInv_(d),y=MF+(o?Math.max(0,Math.ceil(Math.log2(mu(i)/(o*o*256*256)))):0);if(this.addQuad_(h,u,c,d,f,g,m,w,y),this.wrapsXInSource_){let E=1/0;this.triangles_.forEach(function(x,v,S){E=Math.min(E,x.source[0][0],x.source[1][0],x.source[2][0])}),this.triangles_.forEach(x=>{if(Math.max(x.source[0][0],x.source[1][0],x.source[2][0])-E>this.sourceWorldWidth_/2){const v=[[x.source[0][0],x.source[0][1]],[x.source[1][0],x.source[1][1]],[x.source[2][0],x.source[2][1]]];v[0][0]-E>this.sourceWorldWidth_/2&&(v[0][0]-=this.sourceWorldWidth_),v[1][0]-E>this.sourceWorldWidth_/2&&(v[1][0]-=this.sourceWorldWidth_),v[2][0]-E>this.sourceWorldWidth_/2&&(v[2][0]-=this.sourceWorldWidth_);const S=Math.min(v[0][0],v[1][0],v[2][0]);Math.max(v[0][0],v[1][0],v[2][0])-S<this.sourceWorldWidth_/2&&(x.source=v)}})}a={}}addTriangle_(e,t,i,n,s,o){this.triangles_.push({source:[n,s,o],target:[e,t,i]})}addQuad_(e,t,i,n,s,o,a,l,h){const u=To([s,o,a,l]),c=this.sourceWorldWidth_?Pe(u)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,f=this.sourceProj_.canWrapX()&&c>.5&&c<1;let g=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const w=To([e,t,i,n]);g=Pe(w)/this.targetWorldWidth_>Hp||g}!f&&this.sourceProj_.isGlobal()&&c&&(g=c>Hp||g)}if(!g&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!ht(u,this.maxSourceExtent_))return;let m=0;if(!g&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)g=!0;else if(m=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),m!=1&&m!=2&&m!=4&&m!=8)return}if(h>0){if(!g){const w=[(e[0]+i[0])/2,(e[1]+i[1])/2],y=this.transformInv_(w);let E;f?E=(nr(s[0],d)+nr(a[0],d))/2-nr(y[0],d):E=(s[0]+a[0])/2-y[0];const x=(s[1]+a[1])/2-y[1];g=E*E+x*x>this.errorThresholdSquared_}if(g){if(Math.abs(e[0]-i[0])<=Math.abs(e[1]-i[1])){const w=[(t[0]+i[0])/2,(t[1]+i[1])/2],y=this.transformInv_(w),E=[(n[0]+e[0])/2,(n[1]+e[1])/2],x=this.transformInv_(E);this.addQuad_(e,t,w,E,s,o,y,x,h-1),this.addQuad_(E,w,i,n,x,y,a,l,h-1)}else{const w=[(e[0]+t[0])/2,(e[1]+t[1])/2],y=this.transformInv_(w),E=[(i[0]+n[0])/2,(i[1]+n[1])/2],x=this.transformInv_(E);this.addQuad_(e,w,E,n,s,y,x,l,h-1),this.addQuad_(w,t,i,E,y,o,a,x,h-1)}return}}if(f){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}m&11||this.addTriangle_(e,i,n,s,a,l),m&14||this.addTriangle_(e,i,t,s,a,o),m&&(m&13||this.addTriangle_(t,n,e,o,l,s),m&7||this.addTriangle_(t,n,i,o,l,a))}calculateSourceExtent(){const e=oi();return this.triangles_.forEach(function(t,i,n){const s=t.source;fo(e,s[0]),fo(e,s[1]),fo(e,s[2])}),e}getTriangles(){return this.triangles_}}let tu;const ws=[];function Vp(r,e,t,i,n){r.beginPath(),r.moveTo(0,0),r.lineTo(e,t),r.lineTo(i,n),r.closePath(),r.save(),r.clip(),r.fillRect(0,0,Math.max(e,i)+1,Math.max(t,n)),r.restore()}function iu(r,e){return Math.abs(r[e*4]-210)>2||Math.abs(r[e*4+3]-.75*255)>2}function LF(){if(tu===void 0){const r=mt(6,6,ws);r.globalCompositeOperation="lighter",r.fillStyle="rgba(210, 0, 0, 0.75)",Vp(r,4,5,4,0),Vp(r,4,5,0,5);const e=r.getImageData(0,0,3,3).data;tu=iu(e,0)||iu(e,4)||iu(e,8),ia(r),ws.push(r.canvas)}return tu}function Yo(r,e,t,i){const n=zl(t,e,r);let s=Af(e,i,t);const o=e.getMetersPerUnit();o!==void 0&&(s*=o);const a=r.getMetersPerUnit();a!==void 0&&(s/=a);const l=r.getExtent();if(!l||Nr(l,n)){const h=Af(r,s,n)/s;isFinite(h)&&h>0&&(s/=h)}return s}function AF(r,e,t,i){const n=en(t);let s=Yo(r,e,n,i);return(!isFinite(s)||s<=0)&&Dc(t,function(o){return s=Yo(r,e,o,i),isFinite(s)&&s>0}),s}function nv(r,e,t,i,n,s,o,a,l,h,u,c,d,f){const g=mt(Math.round(t*r),Math.round(t*e),ws);if(c||(g.imageSmoothingEnabled=!1),l.length===0)return g.canvas;g.scale(t,t);function m(S){return Math.round(S*t)/t}g.globalCompositeOperation="lighter";const w=oi();l.forEach(function(S,R,L){qp(w,S.extent)});let y;const E=t/i,x=(c?1:1+Math.pow(2,-24))/E;if(!d||l.length!==1||h!==0){if(y=mt(Math.round(Pe(w)*E),Math.round(st(w)*E),ws),c||(y.imageSmoothingEnabled=!1),n&&f){const S=(n[0]-w[0])*E,R=-(n[3]-w[3])*E,L=Pe(n)*E,C=st(n)*E;y.rect(S,R,L,C),y.clip()}l.forEach(function(S,R,L){const C=(S.extent[0]-w[0])*E,M=-(S.extent[3]-w[3])*E,D=Pe(S.extent)*E,A=st(S.extent)*E;S.image.width>0&&S.image.height>0&&y.drawImage(S.image,h,h,S.image.width-2*h,S.image.height-2*h,c?C:Math.round(C),c?M:Math.round(M),c?D:Math.round(C+D)-Math.round(C),c?A:Math.round(M+A)-Math.round(M))})}const v=lr(o);return a.getTriangles().forEach(function(S,R,L){const C=S.source,M=S.target;let D=C[0][0],A=C[0][1],k=C[1][0],V=C[1][1],I=C[2][0],B=C[2][1];const O=m((M[0][0]-v[0])/s),H=m(-(M[0][1]-v[1])/s),j=m((M[1][0]-v[0])/s),q=m(-(M[1][1]-v[1])/s),J=m((M[2][0]-v[0])/s),ee=m(-(M[2][1]-v[1])/s),te=D,Ce=A;D=0,A=0,k-=te,V-=Ce,I-=te,B-=Ce;const W=[[k,V,0,0,j-O],[I,B,0,0,J-O],[0,0,k,V,q-H],[0,0,I,B,ee-H]],me=aw(W);if(!me)return;if(g.save(),g.beginPath(),LF()||!c){g.moveTo(j,q);const Re=4,Se=O-j,Ue=H-q;for(let Ye=0;Ye<Re;Ye++)g.lineTo(j+m((Ye+1)*Se/Re),q+m(Ye*Ue/(Re-1))),Ye!=Re-1&&g.lineTo(j+m((Ye+1)*Se/Re),q+m((Ye+1)*Ue/(Re-1)));g.lineTo(J,ee)}else g.moveTo(j,q),g.lineTo(O,H),g.lineTo(J,ee);g.clip(),g.transform(me[0],me[2],me[1],me[3],O,H),g.translate(w[0]-te,w[3]-Ce);let Ie;if(y)Ie=y.canvas,g.scale(x,-x);else{const Re=l[0],Se=Re.extent;Ie=Re.image,g.scale(Pe(Se)/Ie.width,-st(Se)/Ie.height)}g.drawImage(Ie,0,0),g.restore()}),y&&(ia(y),ws.push(y.canvas)),u&&(g.save(),g.globalCompositeOperation="source-over",g.strokeStyle="black",g.lineWidth=1,a.getTriangles().forEach(function(S,R,L){const C=S.target,M=(C[0][0]-v[0])/s,D=-(C[0][1]-v[1])/s,A=(C[1][0]-v[0])/s,k=-(C[1][1]-v[1])/s,V=(C[2][0]-v[0])/s,I=-(C[2][1]-v[1])/s;g.beginPath(),g.moveTo(A,k),g.lineTo(M,D),g.lineTo(V,I),g.closePath(),g.stroke()}),g.restore()),g.canvas}class ic extends sh{constructor(e,t,i,n,s,o,a,l,h,u,c,d){super(s,he.IDLE,d),this.renderEdges_=c!==void 0?c:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=n,this.wrappedTileCoord_=o||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const f=n.getTileCoordExtent(this.wrappedTileCoord_),g=this.targetTileGrid_.getExtent();let m=this.sourceTileGrid_.getExtent();const w=g?ir(f,g):f;if(mu(w)===0){this.state=he.EMPTY;return}const y=e.getExtent();y&&(m?m=ir(m,y):m=y);const E=n.getResolution(this.wrappedTileCoord_[0]),x=AF(e,i,w,E);if(!isFinite(x)||x<=0){this.state=he.EMPTY;return}const v=u!==void 0?u:tv;if(this.triangulation_=new iv(e,i,w,m,x*v,E),this.triangulation_.getTriangles().length===0){this.state=he.EMPTY;return}this.sourceZ_=t.getZForResolution(x);let S=this.triangulation_.calculateSourceExtent();if(m&&(e.canWrapX()?(S[1]=it(S[1],m[1],m[3]),S[3]=it(S[3],m[1],m[3])):S=ir(S,m)),!mu(S))this.state=he.EMPTY;else{const R=t.getTileRangeForExtentAndZ(S,this.sourceZ_);for(let L=R.minX;L<=R.maxX;L++)for(let C=R.minY;C<=R.maxY;C++){const M=h(this.sourceZ_,L,C,a);M&&this.sourceTiles_.push(M)}this.sourceTiles_.length===0&&(this.state=he.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{t&&t.getState()==he.LOADED&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}),this.sourceTiles_.length=0,e.length===0)this.state=he.ERROR;else{const t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),n=typeof i=="number"?i:i[0],s=typeof i=="number"?i:i[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=nv(n,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=he.LOADED}this.changed()}load(){if(this.state==he.IDLE){this.state=he.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const i=t.getState();if(i==he.IDLE||i==he.LOADING){e++;const n=Oe(t,Ee.CHANGE,function(s){const o=t.getState();(o==he.LOADED||o==he.ERROR||o==he.EMPTY)&&(We(n),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(n)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t,i,n){t.getState()==he.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(We),this.sourcesListenerKeys_=null}release(){this.canvas_&&(ia(this.canvas_.getContext("2d")),ws.push(this.canvas_),this.canvas_=null),super.release()}}class IF extends ta{constructor(e){e=e||{},super(e)}}class PF extends Nd{constructor(e){super(e),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],i=e.pixelRatio,n=e.viewState,s=n.resolution,o=this.getLayer().getSource(),a=e.viewHints;let l=e.extent;if(t.extent!==void 0&&(l=ir(l,Cn(t.extent,n.projection))),!a[Ke.ANIMATING]&&!a[Ke.INTERACTING]&&!Ur(l))if(o){const h=n.projection,u=o.getImage(l,s,i,h);u&&(this.loadImage(u)?this.image_=u:u.getState()===oe.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),n=nt(t.pixelToCoordinateTransform,e.slice()),s=i.getExtent();if(s&&!Nr(s,n))return null;const o=this.image_.getExtent(),a=this.image_.getImage(),l=Pe(o),h=Math.floor(a.width*((n[0]-o[0])/l));if(h<0||h>=a.width)return null;const u=st(o),c=Math.floor(a.height*((o[3]-n[1])/u));return c<0||c>=a.height?null:this.getImageData(a,h,c)}renderFrame(e,t){const i=this.image_,n=i.getExtent(),s=i.getResolution(),[o,a]=Array.isArray(s)?s:[s,s],l=i.getPixelRatio(),h=e.layerStatesArray[e.layerIndex],u=e.pixelRatio,c=e.viewState,d=c.center,f=c.resolution,g=u*o/(f*l),m=u*a/(f*l),w=e.extent,y=c.resolution,E=c.rotation,x=Math.round(Pe(w)/y*u),v=Math.round(st(w)/y*u);Si(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/u,1/u,E,-x/2,-v/2),Zl(this.inversePixelTransform,this.pixelTransform);const S=hd(this.pixelTransform);this.useContainer(t,S,this.getBackground(e));const R=this.getRenderContext(e),L=this.context.canvas;L.width!=x||L.height!=v?(L.width=x,L.height=v):this.containerReused||R.clearRect(0,0,x,v);let C=!1,M=!0;if(h.extent){const I=Cn(h.extent,c.projection);M=ht(I,e.extent),C=M&&!mi(I,e.extent),C&&this.clipUnrotated(R,e,I)}const D=i.getImage(),A=Si(this.tempTransform,x/2,v/2,g,m,0,l*(n[0]-d[0])/o,l*(d[1]-n[3])/a);this.renderedResolution=a*u/l;const k=D.width*A[0],V=D.height*A[3];if(this.getLayer().getSource().getInterpolate()||(R.imageSmoothingEnabled=!1),this.preRender(R,e),M&&k>=.5&&V>=.5){const I=A[4],B=A[5],O=h.opacity;O!==1&&(R.save(),R.globalAlpha=O),R.drawImage(D,0,0,+D.width,+D.height,I,B,k,V),O!==1&&R.restore()}return this.postRender(this.context,e),C&&R.restore(),R.imageSmoothingEnabled=!0,S!==L.style.transform&&(L.style.transform=S),this.container}}class D2 extends IF{constructor(e){super(e)}createRenderer(){return new PF(this)}getData(e){return super.getData(e)}}const er={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class FF extends ta{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getPreload(){return this.get(er.PRELOAD)}setPreload(e){this.set(er.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(er.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(er.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}class rv extends Nd{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=oi(),this.tmpTileRange_=new Hd(0,0,0,0)}isDrawableTile(e){const t=this.getLayer(),i=e.getState(),n=t.getUseInterimTilesOnError();return i==he.LOADED||i==he.EMPTY||i==he.ERROR&&!n}getTile(e,t,i,n){const s=n.pixelRatio,o=n.viewState.projection,a=this.getLayer();let h=a.getSource().getTile(e,t,i,s,o);return h.getState()==he.ERROR&&a.getUseInterimTilesOnError()&&a.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(h)||(h=h.getInterimTile()),h}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),n=nt(t.pixelToCoordinateTransform,e.slice()),s=i.getExtent();if(s&&!Nr(s,n))return null;const o=t.pixelRatio,a=t.viewState.projection,l=t.viewState,h=i.getRenderSource(),u=h.getTileGridForProjection(l.projection),c=h.getTilePixelRatio(t.pixelRatio);for(let d=u.getZForResolution(l.resolution);d>=u.getMinZoom();--d){const f=u.getTileCoordForCoordAndZ(n,d),g=h.getTile(d,f[1],f[2],o,a);if(!(g instanceof kb||g instanceof ic)||g instanceof ic&&g.getState()===he.EMPTY)return null;if(g.getState()!==he.LOADED)continue;const m=u.getOrigin(d),w=Nt(u.getTileSize(d)),y=u.getResolution(d),E=Math.floor(c*((n[0]-m[0])/y-f[1]*w[0])),x=Math.floor(c*((m[1]-n[1])/y-f[2]*w[1])),v=Math.round(c*h.getGutterForProjection(l.projection));return this.getImageData(g.getImage(),E+v,x+v)}return null}loadedTileCallback(e,t,i){return this.isDrawableTile(i)?super.loadedTileCallback(e,t,i):!1}prepareFrame(e){return!!this.getLayer().getSource()}renderFrame(e,t){const i=e.layerStatesArray[e.layerIndex],n=e.viewState,s=n.projection,o=n.resolution,a=n.center,l=n.rotation,h=e.pixelRatio,u=this.getLayer(),c=u.getSource(),d=c.getRevision(),f=c.getTileGridForProjection(s),g=f.getZForResolution(o,c.zDirection),m=f.getResolution(g);let w=e.extent;const y=e.viewState.resolution,E=c.getTilePixelRatio(h),x=Math.round(Pe(w)/y*h),v=Math.round(st(w)/y*h),S=i.extent&&Cn(i.extent);S&&(w=ir(w,Cn(i.extent)));const R=m*x/2/E,L=m*v/2/E,C=[a[0]-R,a[1]-L,a[0]+R,a[1]+L],M=f.getTileRangeForExtentAndZ(w,g),D={};D[g]={};const A=this.createLoadedTileFinder(c,s,D),k=this.tmpExtent,V=this.tmpTileRange_;this.newTiles_=!1;const I=l?bu(n.center,y,l,e.size):void 0;for(let Ce=M.minX;Ce<=M.maxX;++Ce)for(let W=M.minY;W<=M.maxY;++W){if(l&&!f.tileCoordIntersectsViewport([g,Ce,W],I))continue;const me=this.getTile(g,Ce,W,e);if(this.isDrawableTile(me)){const Se=xe(this);if(me.getState()==he.LOADED){D[g][me.tileCoord.toString()]=me;let Ue=me.inTransition(Se);Ue&&i.opacity!==1&&(me.endTransition(Se),Ue=!1),!this.newTiles_&&(Ue||!this.renderedTiles.includes(me))&&(this.newTiles_=!0)}if(me.getAlpha(Se,e.time)===1)continue}const Ie=f.getTileCoordChildTileRange(me.tileCoord,V,k);let Re=!1;Ie&&(Re=A(g+1,Ie)),Re||f.forEachTileCoordParentTileRange(me.tileCoord,A,V,k)}const B=m/o*h/E;Si(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/h,1/h,l,-x/2,-v/2);const O=hd(this.pixelTransform);this.useContainer(t,O,this.getBackground(e));const H=this.getRenderContext(e),j=this.context.canvas;Zl(this.inversePixelTransform,this.pixelTransform),Si(this.tempTransform,x/2,v/2,B,B,0,-x/2,-v/2),j.width!=x||j.height!=v?(j.width=x,j.height=v):this.containerReused||H.clearRect(0,0,x,v),S&&this.clipUnrotated(H,e,S),c.getInterpolate()||(H.imageSmoothingEnabled=!1),this.preRender(H,e),this.renderedTiles.length=0;let q=Object.keys(D).map(Number);q.sort(qi);let J,ee,te;i.opacity===1&&(!this.containerReused||c.getOpaque(e.viewState.projection))?q=q.reverse():(J=[],ee=[]);for(let Ce=q.length-1;Ce>=0;--Ce){const W=q[Ce],me=c.getTilePixelSize(W,h,s),Re=f.getResolution(W)/m,Se=me[0]*Re*B,Ue=me[1]*Re*B,Ye=f.getTileCoordForCoordAndZ(lr(C),W),Bt=f.getTileCoordExtent(Ye),Pt=nt(this.tempTransform,[E*(Bt[0]-C[0])/m,E*(C[3]-Bt[3])/m]),_t=E*c.getGutterForProjection(s),Ft=D[W];for(const Mi in Ft){const ot=Ft[Mi],Ct=ot.tileCoord,Li=Ye[1]-Ct[1],Wi=Math.round(Pt[0]-(Li-1)*Se),bt=Ye[2]-Ct[2],ut=Math.round(Pt[1]-(bt-1)*Ue),Be=Math.round(Pt[0]-Li*Se),qe=Math.round(Pt[1]-bt*Ue),ct=Wi-Be,je=ut-qe,Qt=g===W,_=Qt&&ot.getAlpha(xe(this),e.time)!==1;let p=!1;if(!_)if(J){te=[Be,qe,Be+ct,qe,Be+ct,qe+je,Be,qe+je];for(let b=0,T=J.length;b<T;++b)if(g!==W&&W<ee[b]){const F=J[b];ht([Be,qe,Be+ct,qe+je],[F[0],F[3],F[4],F[7]])&&(p||(H.save(),p=!0),H.beginPath(),H.moveTo(te[0],te[1]),H.lineTo(te[2],te[3]),H.lineTo(te[4],te[5]),H.lineTo(te[6],te[7]),H.moveTo(F[6],F[7]),H.lineTo(F[4],F[5]),H.lineTo(F[2],F[3]),H.lineTo(F[0],F[1]),H.clip())}J.push(te),ee.push(W)}else H.clearRect(Be,qe,ct,je);this.drawTileImage(ot,e,Be,qe,ct,je,_t,Qt),J&&!_?(p&&H.restore(),this.renderedTiles.unshift(ot)):this.renderedTiles.push(ot),this.updateUsedTiles(e.usedTiles,c,ot)}}return this.renderedRevision=d,this.renderedResolution=m,this.extentChanged=!this.renderedExtent_||!zr(this.renderedExtent_,C),this.renderedExtent_=C,this.renderedPixelRatio=h,this.renderedProjection=s,this.manageTilePyramid(e,c,f,h,s,w,g,u.getPreload()),this.scheduleExpireCache(e,c),this.postRender(this.context,e),i.extent&&H.restore(),H.imageSmoothingEnabled=!0,O!==j.style.transform&&(j.style.transform=O),this.container}drawTileImage(e,t,i,n,s,o,a,l){const h=this.getTileImage(e);if(!h)return;const u=this.getRenderContext(t),c=xe(this),d=t.layerStatesArray[t.layerIndex],f=d.opacity*(l?e.getAlpha(c,t.time):1),g=f!==u.globalAlpha;g&&(u.save(),u.globalAlpha=f),u.drawImage(h,a,a,h.width-2*a,h.height-2*a,i,n,s,o),g&&u.restore(),f!==d.opacity?t.animate=!0:l&&e.endTransition(c)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,t){if(t.canExpireCache()){const i=(function(n,s,o){const a=xe(n);a in o.usedTiles&&n.expireCache(o.viewState.projection,o.usedTiles[a])}).bind(null,t);e.postRenderFunctions.push(i)}}updateUsedTiles(e,t,i){const n=xe(t);n in e||(e[n]={}),e[n][i.getKey()]=!0}manageTilePyramid(e,t,i,n,s,o,a,l,h){const u=xe(t);u in e.wantedTiles||(e.wantedTiles[u]={});const c=e.wantedTiles[u],d=e.tileQueue,f=i.getMinZoom(),g=e.viewState.rotation,m=g?bu(e.viewState.center,e.viewState.resolution,g,e.size):void 0;let w=0,y,E,x,v,S,R;for(R=f;R<=a;++R)for(E=i.getTileRangeForExtentAndZ(o,R,E),x=i.getResolution(R),v=E.minX;v<=E.maxX;++v)for(S=E.minY;S<=E.maxY;++S)g&&!i.tileCoordIntersectsViewport([R,v,S],m)||(a-R<=l?(++w,y=t.getTile(R,v,S,n,s),y.getState()==he.IDLE&&(c[y.getKey()]=!0,d.isKeyQueued(y.getKey())||d.enqueue([y,u,i.getTileCoordCenter(y.tileCoord),x])),h!==void 0&&h(y)):t.useTile(R,v,S,s));t.updateCacheSize(w,s)}}class k2 extends FF{constructor(e){super(e)}createRenderer(){return new rv(this)}}function nc(r){return Array.isArray(r)?Math.min(...r):r}const OF={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},Wp={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class DF extends rv{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=si(),this.tileClipContexts_=null}prepareTile(e,t,i){let n;const s=e.getState();return(s===he.LOADED||s===he.ERROR)&&(this.updateExecutorGroup_(e,t,i),this.tileImageNeedsRender_(e)&&(n=!0)),n}getTile(e,t,i,n){const s=n.pixelRatio,o=n.viewState,a=o.resolution,l=o.projection,h=this.getLayer(),u=h.getSource().getTile(e,t,i,s,l),c=n.viewHints,d=!(c[Ke.ANIMATING]||c[Ke.INTERACTING]);return(d||!u.wantedResolution)&&(u.wantedResolution=a),this.prepareTile(u,s,l)&&(d||Date.now()-n.time<8)&&h.getRenderMode()!=="vector"&&this.renderTileImage_(u,n),super.getTile(e,t,i,n)}isDrawableTile(e){const t=this.getLayer();return super.isDrawableTile(e)&&(t.getRenderMode()==="vector"?xe(t)in e.executorGroups:e.hasContext(t))}getTileImage(e){return e.getImage(this.getLayer())}prepareFrame(e){const t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,i){var w;const n=this.getLayer(),s=n.getRevision(),o=n.getRenderOrder()||null,a=e.wantedResolution,l=e.getReplayState(n);if(!l.dirty&&l.renderedResolution===a&&l.renderedRevision==s&&l.renderedRenderOrder==o)return;const h=n.getSource(),u=!!n.getDeclutter(),c=h.getTileGrid(),f=h.getTileGridForProjection(i).getTileCoordExtent(e.wrappedTileCoord),g=h.getSourceTiles(t,i,e),m=xe(n);delete e.hitDetectionImageData[m],e.executorGroups[m]=[],l.dirty=!1;for(let y=0,E=g.length;y<E;++y){const x=g[y];if(x.getState()!=he.LOADED)continue;const v=x.tileCoord,S=c.getTileCoordExtent(v),R=ir(f,S),L=kr(R,n.getRenderBuffer()*a,this.tmpExtent),C=zr(S,R)?null:L,M=new Mb(0,R,a,t),D=cl(a,t),A=function(O,H){let j;const q=O.getStyleFunction()||n.getStyleFunction();if(q&&(j=q(O,a)),j){const J=this.renderFeature(O,D,j,M,u,H);l.dirty=l.dirty||J}},k=x.getFeatures();o&&o!==l.renderedRenderOrder&&k.sort(o);for(let O=0,H=k.length;O<H;++O){const j=k[O];(!C||ht(C,j.getGeometry().getExtent()))&&A.call(this,j,O)}const V=M.finish(),I=n.getRenderMode()!=="vector"&&u&&g.length===1?null:R,B=new Lb(I,a,t,h.getOverlaps(),V,n.getRenderBuffer(),!!((w=this.frameState)!=null&&w.declutter));e.executorGroups[m].push(B)}l.renderedRevision=s,l.renderedRenderOrder=o,l.renderedResolution=a}forEachFeatureAtCoordinate(e,t,i,n,s){const o=t.viewState.resolution,a=t.viewState.rotation;i=i??0;const l=this.getLayer(),u=l.getSource().getTileGridForProjection(t.viewState.projection),c=To([e]);kr(c,o*i,c);const d={},f=function(w,y,E){let x=w.getId();x===void 0&&(x=xe(w));const v=d[x];if(v){if(v!==!0&&E<v.distanceSq){if(E===0)return d[x]=!0,s.splice(s.lastIndexOf(v),1),n(w,l,y);v.geometry=y,v.distanceSq=E}}else{if(E===0)return d[x]=!0,n(w,l,y);s.push(d[x]={feature:w,layer:l,geometry:y,distanceSq:E,callback:n})}},g=this.renderedTiles;let m;for(let w=0,y=g.length;!m&&w<y;++w){const E=g[w],x=u.getTileCoordExtent(E.wrappedTileCoord);if(!ht(x,c))continue;const v=xe(l),S=[E.executorGroups[v]],R=l.getDeclutter();S.some(L=>{const C=R?t.declutter[R].all().map(M=>M.value):null;for(let M=0,D=L.length;M<D;++M)if(m=L[M].forEachFeatureAtCoordinate(e,o,a,i,f,C),m)return!0})}return m}getFeatures(e){return new Promise((t,i)=>{const n=this.getLayer(),s=xe(n),o=n.getSource(),a=this.renderedProjection,l=a.getExtent(),h=this.renderedResolution,u=o.getTileGridForProjection(a),c=nt(this.renderedPixelToCoordinateTransform_,e.slice()),d=u.getTileCoordForCoordAndResolution(c,h);let f;for(let x=0,v=this.renderedTiles.length;x<v;++x)if(d.toString()===this.renderedTiles[x].tileCoord.toString()){if(f=this.renderedTiles[x],f.getState()===he.LOADED){const S=u.getTileCoordExtent(f.tileCoord);o.getWrapX()&&a.canWrapX()&&!mi(l,S)&&zc(c,a);break}f=void 0}if(!f||f.loadingSourceTiles>0){t([]);return}const g=u.getTileCoordExtent(f.wrappedTileCoord),m=lr(g),w=[(c[0]-m[0])/h,(m[1]-c[1])/h],y=f.getSourceTiles().reduce(function(x,v){return x.concat(v.getFeatures())},[]);let E=f.hitDetectionImageData[s];if(!E){const x=Nt(u.getTileSize(u.getZForResolution(h,o.zDirection))),v=this.renderedRotation_,S=[this.getRenderTransform(u.getTileCoordCenter(f.wrappedTileCoord),h,0,ri,x[0]*ri,x[1]*ri,0)];E=Ab(x,S,y,n.getStyleFunction(),u.getTileCoordExtent(f.wrappedTileCoord),f.getReplayState(n).renderedResolution,v),f.hitDetectionImageData[s]=E}t(Ib(w,y,E))})}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.renderedLayerRevision_!==void 0&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e,t){const i=this.context,n=i.globalAlpha;i.globalAlpha=t.opacity;const s=e.viewHints,o=!(s[Ke.ANIMATING]||s[Ke.INTERACTING]),a=this.renderedTiles;for(let l=0,h=a.length;l<h;++l){const u=a[l],c=u.executorGroups[xe(this.getLayer())],d=this.getLayer().getDeclutter();if(c)for(let f=c.length-1;f>=0;--f)c[f].execute(this.context,[this.context.canvas.width,this.context.canvas.height],this.getTileRenderTransform(u,e),e.viewState.rotation,o,ul,d?e.declutter[d]:void 0)}i.globalAlpha=n}renderDeferredInternal(e){const i=this.renderedTiles.reduce((o,a,l)=>(a.executorGroups[xe(this.getLayer())].forEach(h=>o.push({executorGroup:h,index:l})),o),[]),n=i.map(({executorGroup:o})=>o.getDeferredZIndexContexts());n.map(o=>Object.keys(o)).flat().sort(qi).map(Number).forEach(o=>{n.forEach((a,l)=>{a[o]&&a[o].forEach(h=>{const{executorGroup:u,index:c}=i[l],d=u.getRenderedContext(),f=d.globalAlpha;d.globalAlpha=this.renderedOpacity_;const g=this.tileClipContexts_[c];g&&g.draw(d),h.draw(d),g&&d.restore(),d.globalAlpha=f,h.clear()})})})}getTileRenderTransform(e,t){const i=t.pixelRatio,n=t.viewState,s=n.center,o=n.resolution,a=n.rotation,l=t.size,h=Math.round(l[0]*i),u=Math.round(l[1]*i),d=this.getLayer().getSource().getTileGridForProjection(t.viewState.projection),f=e.tileCoord,g=d.getTileCoordExtent(e.wrappedTileCoord),m=d.getTileCoordExtent(f,this.tmpExtent)[0]-g[0];return Qo(Ba(this.inversePixelTransform.slice(),1/i,1/i),this.getRenderTransform(s,o,a,i,h,u,m))}postRender(e,t){const i=t.viewHints,n=!(i[Ke.ANIMATING]||i[Ke.INTERACTING]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation,this.renderedOpacity_=t.layerStatesArray[t.layerIndex].opacity;const s=this.getLayer(),o=s.getRenderMode(),a=e.globalAlpha;e.globalAlpha=this.renderedOpacity_;const l=s.getDeclutter(),h=l?Wp[o].filter(v=>!ul.includes(v)):Wp[o],u=t.viewState,c=u.rotation,d=s.getSource(),g=d.getTileGridForProjection(u.projection).getZForResolution(u.resolution,d.zDirection),m=this.renderedTiles,w=[],y=[],E=[];let x=!0;for(let v=m.length-1;v>=0;--v){const S=m[v];x=x&&!S.getReplayState(s).dirty;const R=S.executorGroups[xe(s)].filter(V=>V.hasExecutors(h));if(R.length===0)continue;const L=this.getTileRenderTransform(S,t),C=S.tileCoord[0];let M=!1;const D=R[0].getClipCoords(L);let A=e,k;if(D){l&&(k=new kd,A=k.getContext());for(let V=0,I=w.length;V<I;++V)if(g!==C&&C<y[V]){const B=w[V];ht([D[0],D[3],D[4],D[7]],[B[0],B[3],B[4],B[7]])&&(M||(A.save(),M=!0),A.beginPath(),A.moveTo(D[0],D[1]),A.lineTo(D[2],D[3]),A.lineTo(D[4],D[5]),A.lineTo(D[6],D[7]),A.moveTo(B[6],B[7]),A.lineTo(B[4],B[5]),A.lineTo(B[2],B[3]),A.lineTo(B[0],B[1]),A.clip())}w.push(D),y.push(C)}for(let V=0,I=R.length;V<I;++V)R[V].execute(e,[e.canvas.width,e.canvas.height],L,c,n,h);M&&(A===e?A.restore():E[v]=k)}e.globalAlpha=a,this.ready=x,this.tileClipContexts_=E,super.postRender(e,t)}renderFeature(e,t,i,n,s,o){if(!i)return!1;let a=!1;if(Array.isArray(i))for(let l=0,h=i.length;l<h;++l)a=dl(n,e,i[l],t,this.boundHandleStyleImageChange_,void 0,s,o)||a;else a=dl(n,e,i,t,this.boundHandleStyleImageChange_,void 0,s,o);return a}tileImageNeedsRender_(e){const t=this.getLayer();if(t.getRenderMode()==="vector")return!1;const i=e.getReplayState(t),n=t.getRevision(),s=e.wantedResolution;return i.renderedTileResolution!==s||i.renderedTileRevision!==n}renderTileImage_(e,t){const i=this.getLayer(),n=e.getReplayState(i),s=i.getRevision(),o=e.executorGroups[xe(i)];n.renderedTileRevision=s;const a=e.wrappedTileCoord,l=a[0],h=i.getSource();let u=t.pixelRatio;const d=t.viewState.projection,f=h.getTileGridForProjection(d),g=f.getResolution(e.tileCoord[0]),m=t.pixelRatio/e.wantedResolution*g,w=f.getResolution(l),y=e.getContext(i);u=Math.round(Math.max(u,m/u));const E=h.getTilePixelSize(l,u,d);y.canvas.width=E[0],y.canvas.height=E[1];const x=u/m;if(x!==1){const L=og(this.tmpTransform_);Ba(L,x,x),y.setTransform.apply(y,L)}const v=f.getTileCoordExtent(a,this.tmpExtent),S=m/w,R=og(this.tmpTransform_);Ba(R,S,-S),wE(R,-v[0],-v[3]);for(let L=0,C=o.length;L<C;++L)o[L].execute(y,[y.canvas.width*x,y.canvas.height*x],R,0,!0,OF[i.getRenderMode()],null);n.renderedTileResolution=e.wantedResolution}}class N2 extends Pd{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un;const i=e.renderMode||"hybrid";Ae(i=="hybrid"||i=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=i,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new DF(this)}getFeatures(e){return super.getFeatures(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(er.PRELOAD)}getUseInterimTilesOnError(){return this.get(er.USE_INTERIM_TILES_ON_ERROR)}setPreload(e){this.set(er.PRELOAD,e)}setUseInterimTilesOnError(e){this.set(er.USE_INTERIM_TILES_ON_ERROR,e)}}class kF extends lb{constructor(e,t,i,n,s,o,a){let l=e.getExtent();l&&e.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);let h=t.getExtent();h&&t.canWrapX()&&(h=h.slice(),h[0]=-1/0,h[2]=1/0);const u=h?ir(i,h):i,c=en(u),d=Yo(e,t,c,n),f=tv,g=new iv(e,t,u,l,d*f,n),m=g.calculateSourceExtent(),w=Ur(m)?null:o(m,d,s),y=w?oe.IDLE:oe.EMPTY,E=w?w.getPixelRatio():1;super(i,n,E,y),this.targetProj_=t,this.maxSourceExtent_=l,this.triangulation_=g,this.targetResolution_=n,this.targetExtent_=i,this.sourceImage_=w,this.sourcePixelRatio_=E,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==oe.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==oe.LOADED){const t=Pe(this.targetExtent_)/this.targetResolution_,i=st(this.targetExtent_)/this.targetResolution_;this.canvas_=nv(t,i,this.sourcePixelRatio_,nc(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==oe.IDLE){this.state=oe.LOADING,this.changed();const e=this.sourceImage_.getState();e==oe.LOADED||e==oe.ERROR?this.reproject_():(this.sourceListenerKey_=Oe(this.sourceImage_,Ee.CHANGE,function(t){const i=this.sourceImage_.getState();(i==oe.LOADED||i==oe.ERROR)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}}unlistenSource_(){We(this.sourceListenerKey_),this.sourceListenerKey_=null}}const tr=4,nu={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class NF extends rn{constructor(e,t){super(e),this.image=t}}class zF extends Gd{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate!==void 0?e.interpolate:!0}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=e.loader?e.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();if(t){const i=jl(t,e,0);e=t[i]}return e}getImage(e,t,i,n){const s=this.getProjection();if(!s||!n||pi(s,n))return s&&(n=s),this.getImageInternal(e,t,i,n);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&pi(this.reprojectedImage_.getProjection(),n)&&this.reprojectedImage_.getResolution()==t&&zr(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new kF(s,n,e,t,i,(o,a,l)=>this.getImageInternal(o,a,l,s),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,i,n){if(this.loader){const s=sv(e,t,i,1),o=this.findNearestResolution(t);if(this.image&&(this.static_||this.wantedProjection_===n&&(this.wantedExtent_&&mi(this.wantedExtent_,s)||mi(this.image.getExtent(),s))&&(this.wantedResolution_&&nc(this.wantedResolution_)===o||nc(this.image.getResolution())===o)))return this.image;this.wantedProjection_=n,this.wantedExtent_=s,this.wantedResolution_=o,this.image=new lb(s,o,i,this.loader),this.image.addEventListener(Ee.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const t=e.target;let i;switch(t.getState()){case oe.LOADING:this.loading=!0,i=nu.IMAGELOADSTART;break;case oe.LOADED:this.loading=!1,i=nu.IMAGELOADEND;break;case oe.ERROR:this.loading=!1,i=nu.IMAGELOADERROR;break;default:return}this.hasListener(i)&&this.dispatchEvent(new NF(i,t))}}function BF(r,e){r.getImage().src=e}function sv(r,e,t,i){const n=e/t,s=en(r),o=Kn(Pe(r)/n,tr),a=Kn(st(r)/n,tr),l=Kn((i-1)*o/2,tr),h=o+2*l,u=Kn((i-1)*a/2,tr),c=a+2*u;return Mo(s,n,0,[h,c])}function jo(r,e){const t=[];Object.keys(e).forEach(function(n){e[n]!==null&&e[n]!==void 0&&t.push(n+"="+encodeURIComponent(e[n]))});const i=t.join("&");return r=r.replace(/[?&]$/,""),r+=r.includes("?")?"&":"?",r+i}const Al="1.3.0",Up=[101,101];function ov(r,e,t,i,n){n.WIDTH=t[0],n.HEIGHT=t[1];const s=i.getAxisOrientation();let o;const a=kc(n.VERSION,"1.3")>=0;return n[a?"CRS":"SRS"]=i.getCode(),a&&s.substr(0,2)=="ne"?o=[e[1],e[0],e[3],e[2]]:o=e,n.BBOX=o.join(","),jo(r,n)}function av(r,e,t,i,n,s,o){s=Object.assign({REQUEST:"GetMap"},s);const a=e/t,l=[Mf(Pe(r)/a,tr),Mf(st(r)/a,tr)];if(t!=1)switch(o){case"geoserver":const u=90*t+.5|0;"FORMAT_OPTIONS"in s?s.FORMAT_OPTIONS+=";dpi:"+u:s.FORMAT_OPTIONS="dpi:"+u;break;case"mapserver":s.MAP_RESOLUTION=90*t;break;case"carmentaserver":case"qgis":s.DPI=90*t;break;default:throw new Error("Unknown `serverType` configured")}return ov(n,r,l,i,s)}function Il(r,e){return Object.assign({REQUEST:e,SERVICE:"WMS",VERSION:Al,FORMAT:"image/png",STYLES:"",TRANSPARENT:!0},r)}function GF(r){const e=r.hidpi===void 0?!0:r.hidpi,t=we(r.projection||"EPSG:3857"),i=r.ratio||1.5,n=r.load||ab;return(s,o,a)=>{s=sv(s,o,a,i),a!=1&&(!e||r.serverType===void 0)&&(a=1);const l=av(s,o,a,t,r.url,Il(r.params,"GetMap"),r.serverType),h=new Image;return r.crossOrigin!==null&&(h.crossOrigin=r.crossOrigin),n(h,l).then(u=>({image:u,extent:s,pixelRatio:a}))}}function HF(r,e,t){if(r.url===void 0)return;const i=we(r.projection||"EPSG:3857"),n=Mo(e,t,0,Up),s={QUERY_LAYERS:r.params.LAYERS,INFO_FORMAT:"application/json"};Object.assign(s,Il(r.params,"GetFeatureInfo"),r.params);const o=ls((e[0]-n[0])/t,tr),a=ls((n[3]-e[1])/t,tr),l=kc(s.VERSION,"1.3")>=0;return s[l?"I":"X"]=o,s[l?"J":"Y"]=a,ov(r.url,n,Up,i,s)}function VF(r,e){if(r.url===void 0)return;const t={SERVICE:"WMS",VERSION:Al,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(r.params===void 0||r.params.LAYER===void 0){const i=r.params.LAYERS;if(!(!Array.isArray(i)||i.length===1))return;t.LAYER=i}if(e!==void 0){const i=we(r.projection||"EPSG:3857").getMetersPerUnit()||1,n=28e-5;t.SCALE=e*i/n}return Object.assign(t,r.params),jo(r.url,t)}class z2 extends zF{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:BF,this.params_=Object.assign({},e.params),this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(e,t,i,n){const s=we(i),o=this.getProjection();o&&o!==s&&(t=Yo(o,s,e,t),e=zl(e,s,o));const a={url:this.url_,params:{...this.params_,...n},projection:o||s};return HF(a,e,t)}getLegendUrl(e,t){return VF({url:this.url_,params:{...this.params_,...t}},e)}getParams(){return this.params_}getImageInternal(e,t,i,n){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==n)&&(this.loaderProjection_=n,this.loader=GF({crossOrigin:this.crossOrigin_,params:this.params_,projection:n,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(s,o)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,o),ab(s))})),super.getImageInternal(e,t,i,n))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}const ru={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},ts=[0,0,0],Hn=5;class yf{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,Ae(lE(this.resolutions_,(n,s)=>s-n,!0),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let n=0,s=this.resolutions_.length-1;n<s;++n)if(!t)t=this.resolutions_[n]/this.resolutions_[n+1];else if(this.resolutions_[n]/this.resolutions_[n+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,Ae(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=e.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=lr(i)),Ae(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,Ae(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:rd,Ae(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((n,s)=>{const o=new Hd(Math.min(0,n[0]),Math.max(n[0]-1,-1),Math.min(0,n[1]),Math.max(n[1]-1,-1));if(i){const a=this.getTileRangeForExtentAndZ(i,s);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):i&&this.calculateTileRanges_(i)}forEachTileCoord(e,t,i){const n=this.getTileRangeForExtentAndZ(e,t);for(let s=n.minX,o=n.maxX;s<=o;++s)for(let a=n.minY,l=n.maxY;a<=l;++a)i([t,s,a])}forEachTileCoordParentTileRange(e,t,i,n){let s,o,a,l=null,h=e[0]-1;for(this.zoomFactor_===2?(o=e[1],a=e[2]):l=this.getTileCoordExtent(e,n);h>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),s=qr(o,o,a,a,i)):s=this.getTileRangeForExtentAndZ(l,h,i),t(h,s))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,i){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const s=e[1]*2,o=e[2]*2;return qr(s,s+1,o,o+1,t)}const n=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;const n=e[0],s=e[1],o=e[2];if(t===n)return qr(s,o,s,o,i);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,t-n),h=Math.floor(s*l),u=Math.floor(o*l);if(t<n)return qr(h,h,u,u,i);const c=Math.floor(l*(s+1))-1,d=Math.floor(l*(o+1))-1;return qr(h,c,u,d,i)}const a=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,t,i)}getTileRangeForExtentAndZ(e,t,i){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,ts);const n=ts[1],s=ts[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,ts);const o=ts[1],a=ts[2];return qr(n,o,s,a,i)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),i=this.getResolution(e[0]),n=Nt(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*n[0]*i,t[1]-(e[2]+.5)*n[1]*i]}getTileCoordExtent(e,t){const i=this.getOrigin(e[0]),n=this.getResolution(e[0]),s=Nt(this.getTileSize(e[0]),this.tmpSize_),o=i[0]+e[1]*s[0]*n,a=i[1]-(e[2]+1)*s[1]*n,l=o+s[0]*n,h=a+s[1]*n;return _i(o,a,l,h,t)}getTileCoordForCoordAndResolution(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)}getTileCoordForXYAndResolution_(e,t,i,n,s){const o=this.getZForResolution(i),a=i/this.getResolution(o),l=this.getOrigin(o),h=Nt(this.getTileSize(o),this.tmpSize_);let u=a*(e-l[0])/i/h[0],c=a*(l[1]-t)/i/h[1];return n?(u=Kn(u,Hn)-1,c=Kn(c,Hn)-1):(u=ls(u,Hn),c=ls(c,Hn)),Bg(o,u,c,s)}getTileCoordForXYAndZ_(e,t,i,n,s){const o=this.getOrigin(i),a=this.getResolution(i),l=Nt(this.getTileSize(i),this.tmpSize_);let h=(e-o[0])/a/l[0],u=(o[1]-t)/a/l[1];return n?(h=Kn(h,Hn)-1,u=Kn(u,Hn)-1):(h=ls(h,Hn),u=ls(u,Hn)),Bg(i,h,u,s)}getTileCoordForCoordAndZ(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const i=jl(this.resolutions_,e,t||0);return it(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return Zm(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,i=new Array(t);for(let n=this.minZoom;n<t;++n)i[n]=this.getTileRangeForExtentAndZ(e,n);this.fullTileRanges_=i}}class lv extends yf{constructor(e){super({extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes}),this.matrixIds_=e.matrixIds}getMatrixId(e){return this.matrixIds_[e]}getMatrixIds(){return this.matrixIds_}}const WF=lv;function UF(r,e,t){const i=[],n=[],s=[],o=[],a=[];t=t!==void 0?t:[];const l="SupportedCRS",h="TileMatrix",u="Identifier",c="ScaleDenominator",d="TopLeftCorner",f="TileWidth",g="TileHeight",m=r[l],w=we(m),y=w.getMetersPerUnit(),E=w.getAxisOrientation().substr(0,2)=="ne";return r[h].sort(function(x,v){return v[c]-x[c]}),r[h].forEach(function(x){let v;if(t.length>0?v=t.find(function(S){return x[u]==S[h]?!0:x[u].includes(":")?!1:r[u]+":"+x[u]===S[h]}):v=!0,v){n.push(x[u]);const S=x[c]*28e-5/y,R=x[f],L=x[g];E?s.push([x[d][1],x[d][0]]):s.push(x[d]),i.push(S),o.push(R==L?R:[R,L]),a.push([x.MatrixWidth,x.MatrixHeight])}}),new lv({extent:e,origins:s,resolutions:i,matrixIds:n,tileSizes:o,sizes:a})}function hv(r){let e=r.getDefaultTileGrid();return e||(e=$F(r),r.setDefaultTileGrid(e)),e}function YF(r,e,t){const i=e[0],n=r.getTileCoordCenter(e),s=vf(t);if(!Nr(s,n)){const o=Pe(s),a=Math.ceil((s[0]-n[0])/o);return n[0]+=o*a,r.getTileCoordForCoordAndZ(n,i)}return e}function jF(r,e,t,i){i=i!==void 0?i:"top-left";const n=uv(r,e,t);return new yf({extent:r,origin:tw(r,i),resolutions:n,tileSize:t})}function XF(r){const e=r||{},t=e.extent||we("EPSG:3857").getExtent(),i={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:uv(t,e.maxZoom,e.tileSize,e.maxResolution)};return new yf(i)}function uv(r,e,t,i){e=e!==void 0?e:cE,t=Nt(t!==void 0?t:rd);const n=st(r),s=Pe(r);i=i>0?i:Math.max(s/t[0],n/t[1]);const o=e+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=i/Math.pow(2,l);return a}function $F(r,e,t,i){const n=vf(r);return jF(n,e,t,i)}function vf(r){r=we(r);let e=r.getExtent();if(!e){const t=180*So.degrees/r.getMetersPerUnit();e=_i(-t,-t,t,t)}return e}class ZF extends Gd{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.opaque_=e.opaque!==void 0?e.opaque:!1,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&Nt(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tileCache=new Bb(e.cacheSize||0),this.tmpSize=[0,0],this.key_=e.key||"",this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(e,t){const i=this.getTileCacheForProjection(e);i&&i.expireCache(t)}forEachLoadedTile(e,t,i,n){const s=this.getTileCacheForProjection(e);if(!s)return!1;let o=!0,a,l,h;for(let u=i.minX;u<=i.maxX;++u)for(let c=i.minY;c<=i.maxY;++c)l=la(t,u,c),h=!1,s.containsKey(l)&&(a=s.get(l),h=a.getState()===he.LOADED,h&&(h=n(a)!==!1)),h||(o=!1);return o}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getOpaque(e){return this.opaque_}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,i,n,s){return ge()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:hv(e)}getTileCacheForProjection(e){const t=this.getProjection();return Ae(t===null||pi(t,e),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){const n=this.getTileGridForProjection(i),s=this.getTilePixelRatio(t),o=Nt(n.getTileSize(e),this.tmpSize);return s==1?o:$E(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){t=t!==void 0?t:this.getProjection();const i=this.getTileGridForProjection(t);return this.getWrapX()&&t.isGlobal()&&(e=YF(i,e,t)),zx(e,i)?e:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(e,t){const i=this.getTileCacheForProjection(t);e>i.highWaterMark&&(i.highWaterMark=e)}useTile(e,t,i,n){}}class KF extends rn{constructor(e,t){super(e),this.tile=t}}function qF(r,e){const t=/\{z\}/g,i=/\{x\}/g,n=/\{y\}/g,s=/\{-y\}/g;return function(o,a,l){if(o)return r.replace(t,o[0].toString()).replace(i,o[1].toString()).replace(n,o[2].toString()).replace(s,function(){const h=o[0],u=e.getFullTileRange(h);if(!u)throw new Error("The {-y} placeholder requires a tile grid with extent");return(u.getHeight()-o[2]-1).toString()})}}function JF(r,e){const t=r.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=qF(r[n],e);return rc(i)}function rc(r){return r.length===1?r[0]:function(e,t,i){if(!e)return;const n=zb(e),s=nr(n,r.length);return r[s](e,t,i)}}function cv(r){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(r);if(t){const i=t[1].charCodeAt(0),n=t[2].charCodeAt(0);let s;for(s=i;s<=n;++s)e.push(r.replace(t[0],String.fromCharCode(s)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(r),t){const i=parseInt(t[2],10);for(let n=parseInt(t[1],10);n<=i;n++)e.push(r.replace(t[0],n.toString()));return e}return e.push(r),e}class wf extends ZF{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===wf.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,i=xe(t),n=t.getState();let s;n==he.LOADING?(this.tileLoadingKeys_[i]=!0,s=ru.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],s=n==he.ERROR?ru.TILELOADERROR:n==he.LOADED?ru.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new KF(s,t))}setTileLoadFunction(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=cv(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(JF(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,i){}useTile(e,t,i){const n=la(e,t,i);this.tileCache.containsKey(n)&&this.tileCache.get(n)}}class QF extends wf{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:eO,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:kb,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1}expireCache(e,t){const i=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==i?t:{});for(const n in this.tileCacheForProjection){const s=this.tileCacheForProjection[n];s.expireCache(s==i?t:{})}}getGutterForProjection(e){return this.getProjection()&&e&&!pi(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getOpaque(e){return this.getProjection()&&e&&!pi(this.getProjection(),e)?!1:super.getOpaque(e)}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||pi(t,e)))return this.tileGrid;const i=xe(e);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=hv(e)),this.tileGridForProjection[i]}getTileCacheForProjection(e){const t=this.getProjection();if(!t||pi(t,e))return this.tileCache;const i=xe(e);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new Bb(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}createTile_(e,t,i,n,s,o){const a=[e,t,i],l=this.getTileCoordForTileUrlFunction(a,s),h=l?this.tileUrlFunction(l,n,s):void 0,u=new this.tileClass(a,h!==void 0?he.IDLE:he.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return u.key=o,u.addEventListener(Ee.CHANGE,this.handleTileChange.bind(this)),u}getTile(e,t,i,n,s){const o=this.getProjection();if(!o||!s||pi(o,s))return this.getTileInternal(e,t,i,n,o||s);const a=this.getTileCacheForProjection(s),l=[e,t,i];let h;const u=Nb(l);a.containsKey(u)&&(h=a.get(u));const c=this.getKey();if(h&&h.key==c)return h;const d=this.getTileGridForProjection(o),f=this.getTileGridForProjection(s),g=this.getTileCoordForTileUrlFunction(l,s),m=new ic(o,d,s,f,l,g,this.getTilePixelRatio(n),this.getGutter(),(w,y,E,x)=>this.getTileInternal(w,y,E,x,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return m.key=c,h?(m.interimTile=h,m.refreshInterimChain(),a.replace(u,m)):a.set(u,m),m}getTileInternal(e,t,i,n,s){let o=null;const a=la(e,t,i),l=this.getKey();if(!this.tileCache.containsKey(a))o=this.createTile_(e,t,i,n,s,l),this.tileCache.set(a,o);else if(o=this.tileCache.get(a),o.key!=l){const h=o;o=this.createTile_(e,t,i,n,s,l),h.getState()==he.IDLE?o.interimTile=h.interimTile:o.interimTile=h,o.refreshInterimChain(),this.tileCache.replace(a,o)}return o}setRenderReprojectionEdges(e){if(this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(e,t){const i=we(e);if(i){const n=xe(i);n in this.tileGridForProjection||(this.tileGridForProjection[n]=t)}}clear(){super.clear();for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear()}}function eO(r,e){r.getImage().src=e}const Ef=QF;class tO extends Ef{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",i=e.tileGrid!==void 0?e.tileGrid:XF({extent:vf(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:e.opaque,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}const iO='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class B2 extends tO{constructor(e){e=e||{};let t;e.attributions!==void 0?t=e.attributions:t=[iO];const i=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",n=e.url!==void 0?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:i,interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:19,opaque:e.opaque!==void 0?e.opaque:!0,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:n,wrapX:e.wrapX,zDirection:e.zDirection})}}class G2 extends Ef{constructor(e){const t=e.requestEncoding!==void 0?e.requestEncoding:"KVP",i=e.tileGrid;let n=e.urls;n===void 0&&e.url!==void 0&&(n=cv(e.url)),super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:n,wrapX:e.wrapX!==void 0?e.wrapX:!1,transition:e.transition,zDirection:e.zDirection}),this.version_=e.version!==void 0?e.version:"1.0.0",this.format_=e.format!==void 0?e.format:"image/jpeg",this.dimensions_=e.dimensions!==void 0?e.dimensions:{},this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style,this.requestEncoding_=t,this.setKey(this.getKeyForDimensions_()),n&&n.length>0&&(this.tileUrlFunction=rc(n.map(this.createFromWMTSTemplate.bind(this))))}setUrls(e){this.urls=e;const t=e.join(`
`);this.setTileUrlFunction(rc(e.map(this.createFromWMTSTemplate.bind(this))),t)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const e=this.urls?this.urls.slice(0):[];for(const t in this.dimensions_)e.push(t+"-"+this.dimensions_[t]);return e.join("/")}updateDimensions(e){Object.assign(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(e){const t=this.requestEncoding_,i={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};t=="KVP"&&Object.assign(i,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e=t=="KVP"?jo(e,i):e.replace(/\{(\w+?)\}/g,function(o,a){return a.toLowerCase()in i?i[a.toLowerCase()]:o});const n=this.tileGrid,s=this.dimensions_;return function(o,a,l){if(!o)return;const h={TileMatrix:n.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(h,s);let u=e;return t=="KVP"?u=jo(u,h):u=u.replace(/\{(\w+?)\}/g,function(c,d){return h[d]}),u}}}function H2(r,e){const t=r.Contents.Layer,i=t==null?void 0:t.find(function(k){return k.Identifier==e.layer});if(!i)return null;const n=r.Contents.TileMatrixSet;let s;i.TileMatrixSetLink.length>1?"projection"in e?s=i.TileMatrixSetLink.findIndex(function(k){const I=n.find(function(H){return H.Identifier==k.TileMatrixSet}).SupportedCRS,B=we(I),O=we(e.projection);return B&&O?pi(B,O):I==e.projection}):s=i.TileMatrixSetLink.findIndex(function(k){return k.TileMatrixSet==e.matrixSet}):s=0,s<0&&(s=0);const o=i.TileMatrixSetLink[s].TileMatrixSet,a=i.TileMatrixSetLink[s].TileMatrixSetLimits;let l=i.Format[0];"format"in e&&(l=e.format),s=i.Style.findIndex(function(k){return"style"in e?k.Title==e.style:k.isDefault}),s<0&&(s=0);const h=i.Style[s].Identifier,u={};"Dimension"in i&&i.Dimension.forEach(function(k,V,I){const B=k.Identifier;let O=k.Default;O===void 0&&(O=k.Value[0]),u[B]=O});const d=r.Contents.TileMatrixSet.find(function(k){return k.Identifier==o});let f;const g=d.SupportedCRS;if(g&&(f=we(g)),"projection"in e){const k=we(e.projection);k&&(!f||pi(k,f))&&(f=k)}let m=!1;const w=f.getAxisOrientation().substr(0,2)=="ne";let y=d.TileMatrix[0],E={MinTileCol:0,MinTileRow:0,MaxTileCol:y.MatrixWidth-1,MaxTileRow:y.MatrixHeight-1};if(a){E=a[a.length-1];const k=d.TileMatrix.find(V=>V.Identifier===E.TileMatrix||d.Identifier+":"+V.Identifier===E.TileMatrix);k&&(y=k)}const x=y.ScaleDenominator*28e-5/f.getMetersPerUnit(),v=w?[y.TopLeftCorner[1],y.TopLeftCorner[0]]:y.TopLeftCorner,S=y.TileWidth*x,R=y.TileHeight*x;let L=d.BoundingBox;L&&w&&(L=[L[1],L[0],L[3],L[2]]);let C=[v[0]+S*E.MinTileCol,v[1]-R*(1+E.MaxTileRow),v[0]+S*(1+E.MaxTileCol),v[1]-R*E.MinTileRow];if(L!==void 0&&!mi(L,C)){const k=i.WGS84BoundingBox,V=we("EPSG:4326").getExtent();if(C=L,k)m=k[0]===V[0]&&k[2]===V[2];else{const I=om(L,d.SupportedCRS,"EPSG:4326");m=I[0]-1e-10<=V[0]&&I[2]+1e-10>=V[2]}}const M=UF(d,C,a),D=[];let A=e.requestEncoding;if(A=A!==void 0?A:"","OperationsMetadata"in r&&"GetTile"in r.OperationsMetadata){const k=r.OperationsMetadata.GetTile.DCP.HTTP.Get;for(let V=0,I=k.length;V<I;++V)if(k[V].Constraint){const O=k[V].Constraint.find(function(H){return H.name=="GetEncoding"}).AllowedValues.Value;if(A===""&&(A=O[0]),A==="KVP")O.includes("KVP")&&D.push(k[V].href);else break}else k[V].href&&(A="KVP",D.push(k[V].href))}return D.length===0&&(A="REST",i.ResourceURL.forEach(function(k){k.resourceType==="tile"&&(l=k.format,D.push(k.template))})),{urls:D,layer:e.layer,matrixSet:o,format:l,projection:f,requestEncoding:A,tileGrid:M,style:h,dimensions:u,wrapX:m,crossOrigin:e.crossOrigin}}class V2 extends Ef{constructor(e){e=e||{};const t=Object.assign({},e.params),i="TRANSPARENT"in t?t.TRANSPARENT:!0;super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:!i,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.params_=t,this.v13_=!0,this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=oi(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(e,t,i,n){const s=we(i),o=this.getProjection()||s;let a=this.getTileGrid();a||(a=this.getTileGridForProjection(o));const l=zl(e,s,o),h=Yo(o,s,e,t),u=a.getZForResolution(h,this.zDirection),c=a.getResolution(u),d=a.getTileCoordForCoordAndZ(l,u);if(a.getResolutions().length<=d[0])return;let f=a.getTileCoordExtent(d,this.tmpExtent_);const g=this.gutter_;g!==0&&(f=kr(f,c*g,f));const m={QUERY_LAYERS:this.params_.LAYERS};Object.assign(m,Il(this.params_,"GetFeatureInfo"),n);const w=Math.floor((l[0]-f[0])/c),y=Math.floor((f[3]-l[1])/c);return m[this.v13_?"I":"X"]=w,m[this.v13_?"J":"Y"]=y,this.getRequestUrl_(d,f,1,o||s,m)}getLegendUrl(e,t){if(this.urls[0]===void 0)return;const i={SERVICE:"WMS",VERSION:Al,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(t===void 0||t.LAYER===void 0){const n=this.params_.LAYERS;if(!(!Array.isArray(n)||n.length===1))return;i.LAYER=n}if(e!==void 0){const n=this.getProjection()?this.getProjection().getMetersPerUnit():1,s=28e-5;i.SCALE=e*n/s}return Object.assign(i,t),jo(this.urls[0],i)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(e,t,i,n,s){const o=this.urls;if(!o)return;let a;if(o.length==1)a=o[0];else{const l=nr(zb(e),o.length);a=o[l]}return av(t,(this.tileGrid||this.getTileGridForProjection(n)).getResolution(e[0]),i,n,a,s,this.serverType_)}getTilePixelRatio(e){return!this.hidpi_||this.serverType_===void 0?1:e}getKeyForParams_(){let e=0;const t=[];for(const i in this.params_)t[e++]=i+"-"+this.params_[i];return t.join("/")}updateParams(e){Object.assign(this.params_,e),this.updateV13_(),this.setKey(this.getKeyForParams_())}updateV13_(){const e=this.params_.VERSION||Al;this.v13_=kc(e,"1.3")>=0}tileUrlFunction(e,t,i){let n=this.getTileGrid();if(n||(n=this.getTileGridForProjection(i)),n.getResolutions().length<=e[0])return;t!=1&&(!this.hidpi_||this.serverType_===void 0)&&(t=1);const s=n.getResolution(e[0]);let o=n.getTileCoordExtent(e,this.tmpExtent_);const a=this.gutter_;a!==0&&(o=kr(o,s*a,o));const l=Object.assign({},Il(this.params_,"GetMap"));return this.getRequestUrl_(e,o,t,i,l)}}class W2{constructor(e){K(this,"printExtent");this.setPrintExtent(e||[0,0,1/0,1/0])}getPrintExtent(){return this.printExtent}setPrintExtent(e){this.printExtent=e}layerFilter(e){return!0}geometryFilter(e){return!0}feature(e,t){}line(e,t,i,n){}point(e,t,i,n){}text(e,t,i,n){}wmtsLayer(e,t,i){}wmsLayer(e,t,i){}}const Pl={WMTS_PIXEL_SIZE:28e-5,DOTS_PER_INCH:72,METERS_PER_INCH:.0254,CIRCLE_TO_POLYGON_SIDES:64},nO={DPI_PER_DISTANCE_UNIT:()=>Pl.DOTS_PER_INCH/Pl.METERS_PER_INCH};function U2(r,e,t){const[i,n]=r.map(s=>s/nO.DPI_PER_DISTANCE_UNIT()*t/2);return[e[0]-i,e[1]-n,e[0]+i,e[1]+n]}function su(r){return r.length===1?`0${r}`:r}function ou(r){const e=r[0],t=r[1],i=r[2];if(e!==(e&255)||t!==(t&255)||i!==(i&255))throw new Error(`"(${e},${t},${i})" is not a valid RGB color`);const n=su(e.toString(16)),s=su(t.toString(16)),o=su(i.toString(16));return`#${n}${s}${o}`}function Y2(r){const e=r.getProjection(),t=r.getTileGrid();console.assert(t instanceof WF);const i=t.getMatrixIds(),n=[],s=e.getMetersPerUnit();console.assert(!!s);for(let o=0;o<i.length;o++){const a=t.getFullTileRange(o),l=t.getResolution(o)*s;n.push({identifier:i[o],scaleDenominator:l/Pl.WMTS_PIXEL_SIZE,tileSize:Nt(t.getTileSize(o)),topLeftCorner:t.getOrigin(o),matrixSize:[a.maxX-a.minX+1,a.maxY-a.minY+1]})}return n}document.createElement("canvas");function rO(r){const e=document.createElement("a");return e.href=encodeURI(r),decodeURI(e.href)}function j2(r){const e=r.getUrls();return console.assert(e.length>0),rO(e[0])}async function sO(r,e){return await(await fetch(`${r}/status/${e}.json`)).json()}async function X2(r,e){return{status:(await fetch(`${r}/cancel/${e}`,{method:"DELETE"})).status}}async function $2(r,e,t){return await(await fetch(`${r}/report.${e.format}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e,t)})).json()}async function Z2(r,e,t=1e3,i=3e4){let n=0-t;return new Promise((s,o)=>{const a=setInterval(async()=>{let l;try{if(l=await sO(r,e.ref),l.error)throw new Error(l.error)}catch(h){o(h)}l.done&&(clearInterval(a),s(`${r}/report/${e.ref}`)),n+=t,n>=i&&(clearInterval(a),o(new Error("Print duration exceeded")))},t)})}const En={LINE_STRING:"LineString",POINT:"Point",POLYGON:"Polygon"},dv=Object.freeze({LineString:En.LINE_STRING,Point:En.POINT,Polygon:En.POLYGON,MultiLineString:En.LINE_STRING,MultiPoint:En.POINT,MultiPolygon:En.POLYGON});function oO(r){return r in dv}const Xa="_mfp_style",aO=r=>{const e=r.geometry;return e&&e.type==="Point"?0:1},au=r=>{const e=Array.isArray(r)?r.join(","):r;return`[${Xa} = '${e}']`};class K2{constructor(e,t){K(this,"layerState_");K(this,"layer_");K(this,"customizer_");K(this,"geojsonFormat",new Vx);K(this,"deepIds_",new Map);K(this,"lastDeepId_",0);this.layerState_=e,this.layer_=this.layerState_.layer,this.customizer_=t}encodeVectorLayer(e){const t=this.layer_.getSource();if(!t)return null;console.assert(t instanceof Ox);const i=t.getFeaturesInExtent(this.customizer_.getPrintExtent()),n=[],s={version:2};return i.forEach(a=>this.encodeFeature(a,e,n,s)),n.length<=0||Object.keys(s).length<=1?null:(n.sort((a,l)=>{const h=aO;return h(l)-h(a)}),{geoJson:{type:"FeatureCollection",features:n},opacity:this.layerState_.opacity,style:s,type:"geojson",name:this.layer_.get("name")})}encodeFeature(e,t,i,n){let s=null;const o=e.getStyleFunction()||this.layer_.getStyleFunction();o&&(s=o(e,t)),e.getGeometry().getType()==="Circle"&&(e=this.featureCircleAsPolygon(e));const a=this.geojsonFormat.writeFeatureObject(e);let l=s!==null&&!Array.isArray(s)?[s]:s;if(!l||(l=l.filter(u=>!!u),l.length===0))return;console.assert(Array.isArray(l));let h=!1;l.forEach(u=>{let c=u.getGeometry(),d;if(c){const f=e.clone();f.setGeometry(c),d=this.geojsonFormat.writeFeatureObject(f),i.push(d)}else{if(d=a,c=e.getGeometry(),!c||!this.customizer_.geometryFilter(c))return;h||(i.push(d),h=!0)}this.addVectorStyle(n,d,u)})}getDeepStyleUid(e){const t=[e];let i="";for(;t.length;){const s=t.pop();i+="_k"+xe(s);for(const[o,a]of Object.entries(s))a!=null&&(["number","string","boolean"].includes(typeof a)?i+=`_${o}:${a}`:t.push(a))}if(this.deepIds_.has(i))return this.deepIds_.get(i).toString();const n=++this.lastDeepId_;return this.deepIds_.set(i,n),n.toString()}addVectorStyle(e,t,i){const n=this.getDeepStyleUid(i),s=au(n);let o;if(s in e)o=!0;else{const a=this.encodeVectorStyle(t,i);o=a&&a.symbolizers.length!==0,o&&(e[s]=a)}if(o){t.properties||(t.properties={}),this.customizer_.feature(this.layerState_,t);const a=t.properties[Xa];if(a){const l=[...a.split(","),n];e[au(l)]={symbolizers:[...e[au(a)].symbolizers,...e[s].symbolizers]},t.properties[Xa]=l.join(",")}else t.properties[Xa]=n}}encodeVectorStyle(e,t){const i=e.geometry.type;if(!oO(i))return console.warn("Unsupported geometry type: ",i),null;const n=dv[i],s={symbolizers:[]},o=t.getFill(),a=t.getImage(),l=t.getStroke(),h=t.getText();return n===En.POLYGON?o!==null&&this.encodeVectorStylePolygon(e,s.symbolizers,o,l):n===En.LINE_STRING?l!==null&&this.encodeVectorStyleLine(e,s.symbolizers,l):n===En.POINT&&a!==null&&this.encodeVectorStylePoint(e,s.symbolizers,a),h!==null&&this.encodeVectorStyleText(e,s.symbolizers,h),s}encodeVectorStyleFill(e,t,i){let n=i.getColor();n!==null&&(console.assert(typeof n=="string"||Array.isArray(n)),n=Rn(n),console.assert(Array.isArray(n),"only supporting fill colors"),t.fillColor=ou(n),t.fillOpacity=n[3])}encodeVectorStyleLine(e,t,i){const n={type:"line"};this.encodeVectorStyleStroke(e,n,i),this.customizer_.line(this.layerState_,e,n,i),t.push(n)}encodeVectorStylePoint(e,t,i){let n;i instanceof Vs?n=this.encodeVectorStylePointStyleCircle(e,i):i instanceof jr&&(n=this.encodeVectorStylePointStyleIcon(e,i)),n&&(this.customizer_.point(this.layerState_,e,n,i),t.push(n))}encodeVectorStylePointStyleCircle(e,t){const i={type:"point"};i.pointRadius=t.getRadius();const n=t.getScale();n&&(Array.isArray(n)?i.pointRadius*=(n[0]+n[1])/2:i.pointRadius*=n);const s=t.getFill();let o=t.getStroke();return s!==null&&(this.encodeVectorStyleFill(e,i,s),o||(o=new ki({color:s.getColor()}))),o!==null&&this.encodeVectorStyleStroke(e,i,o),i}encodeVectorStylePointStyleIcon(e,t){const i=t.getSrc();if(i===void 0)return;const n={type:"point",externalGraphic:i},s=t.getOpacity();s!==null&&(n.graphicOpacity=s);const o=t.getSize();if(o!==null){let l=t.getScale();Array.isArray(l)&&(l=(l[0]+l[1])/2),isNaN(l)&&(l=1);const h=o[0]*l,u=o[1]*l;n.graphicWidth=u,this.addGraphicOffset_(n,t,h,u)}let a=t.getRotation();return isNaN(a)&&(a=0),n.rotation=yu(a),n}addGraphicOffset_(e,t,i,n){if(this.hasDefaultAnchor_(t))return;const s=t.getAnchor(),o=i/2-s[0],a=n/2-s[1];e.graphicXOffset=o,e.graphicYOffset=a}hasDefaultAnchor_(e){const t=e,i=t.anchor_[0]===.5&&t.anchor_[1]===.5,n=t.anchorOrigin_==="top-left",s=t.anchorXUnits_==="fraction",o=t.anchorYUnits_==="fraction";return i&&n&&s&&o}encodeVectorStylePolygon(e,t,i,n){const s={type:"polygon"};this.encodeVectorStyleFill(e,s,i),n!==null&&this.encodeVectorStyleStroke(e,s,n),t.push(s)}encodeVectorStyleStroke(e,t,i){const n=i.getColor();if(n!==null){console.assert(typeof n=="string"||Array.isArray(n));const h=Rn(n);console.assert(Array.isArray(h),"only supporting stroke colors"),t.strokeColor=ou(h),t.strokeOpacity=h[3]}const s=i.getLineDash();s!==null&&(t.strokeDashstyle=s.join(" "));const o=i.getWidth();o!==void 0&&(t.strokeWidth=o);const a=i.getLineCap();a&&(t.strokeLinecap=a);const l=i.getLineJoin();l&&(t.strokeLinejoin=l)}encodeVectorStyleText(e,t,i){if(i.getText()){const s=Ad(i.getFont()||"sans-serif"),o={type:"text",label:i.getText(),fontFamily:s.family,fontSize:s.size,fontStyle:s.style,fontWeight:s.weight,labelXOffset:i.getOffsetX(),labelYOffset:-i.getOffsetY(),labelAlign:"cm"},a=i.getFill();a!==null&&(this.encodeVectorStyleFill(e,o,a),o.fontColor=o.fillColor);const l=i.getStroke();if(l!==null){const h=l.getColor();if(h){console.assert(typeof h=="string"||Array.isArray(h));const c=Rn(h);console.assert(Array.isArray(c),"only supporting stroke colors"),o.haloColor=ou(c),o.haloOpacity=c[3]}const u=l.getWidth();u!==void 0&&(o.haloRadius=u)}this.customizer_.text(this.layerState_,e,o,i),t.push(o)}}featureCircleAsPolygon(e){return new Ti({...e.getProperties(),geometry:DE(e.getGeometry(),Pl.CIRCLE_TO_POLYGON_SIDES)})}}/*!
 * vanilla-picker v2.12.3
 * https://vanilla-picker.js.org
 *
 * Copyright 2017-2024 Andreas Borgen (https://github.com/Sphinxxxx), Adam Brooks (https://github.com/dissimulate)
 * Released under the ISC license.
 */var _f=function(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")},Cf=function(){function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}}(),ka=function(){function r(e,t){var i=[],n=!0,s=!1,o=void 0;try{for(var a=e[Symbol.iterator](),l;!(n=(l=a.next()).done)&&(i.push(l.value),!(t&&i.length===t));n=!0);}catch(h){s=!0,o=h}finally{try{!n&&a.return&&a.return()}finally{if(s)throw o}}return i}return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return r(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();String.prototype.startsWith=String.prototype.startsWith||function(r){return this.indexOf(r)===0};String.prototype.padStart=String.prototype.padStart||function(r,e){for(var t=this;t.length<r;)t=e+t;return t};var lO={cb:"0f8ff",tqw:"aebd7",q:"-ffff",qmrn:"7fffd4",zr:"0ffff",bg:"5f5dc",bsq:"e4c4",bck:"---",nch:"ebcd",b:"--ff",bvt:"8a2be2",brwn:"a52a2a",brw:"deb887",ctb:"5f9ea0",hrt:"7fff-",chcT:"d2691e",cr:"7f50",rnw:"6495ed",crns:"8dc",crms:"dc143c",cn:"-ffff",Db:"--8b",Dcn:"-8b8b",Dgnr:"b8860b",Dgr:"a9a9a9",Dgrn:"-64-",Dkhk:"bdb76b",Dmgn:"8b-8b",Dvgr:"556b2f",Drng:"8c-",Drch:"9932cc",Dr:"8b--",Dsmn:"e9967a",Dsgr:"8fbc8f",DsTb:"483d8b",DsTg:"2f4f4f",Dtrq:"-ced1",Dvt:"94-d3",ppnk:"1493",pskb:"-bfff",mgr:"696969",grb:"1e90ff",rbrc:"b22222",rwht:"af0",stg:"228b22",chs:"-ff",gnsb:"dcdcdc",st:"8f8ff",g:"d7-",gnr:"daa520",gr:"808080",grn:"-8-0",grnw:"adff2f",hnw:"0fff0",htpn:"69b4",nnr:"cd5c5c",ng:"4b-82",vr:"0",khk:"0e68c",vnr:"e6e6fa",nrb:"0f5",wngr:"7cfc-",mnch:"acd",Lb:"add8e6",Lcr:"08080",Lcn:"e0ffff",Lgnr:"afad2",Lgr:"d3d3d3",Lgrn:"90ee90",Lpnk:"b6c1",Lsmn:"a07a",Lsgr:"20b2aa",Lskb:"87cefa",LsTg:"778899",Lstb:"b0c4de",Lw:"e0",m:"-ff-",mgrn:"32cd32",nn:"af0e6",mgnt:"-ff",mrn:"8--0",mqm:"66cdaa",mmb:"--cd",mmrc:"ba55d3",mmpr:"9370db",msg:"3cb371",mmsT:"7b68ee","":"-fa9a",mtr:"48d1cc",mmvt:"c71585",mnLb:"191970",ntc:"5fffa",mstr:"e4e1",mccs:"e4b5",vjw:"dead",nv:"--80",c:"df5e6",v:"808-0",vrb:"6b8e23",rng:"a5-",rngr:"45-",rch:"da70d6",pgnr:"eee8aa",pgrn:"98fb98",ptrq:"afeeee",pvtr:"db7093",ppwh:"efd5",pchp:"dab9",pr:"cd853f",pnk:"c0cb",pm:"dda0dd",pwrb:"b0e0e6",prp:"8-080",cc:"663399",r:"--",sbr:"bc8f8f",rb:"4169e1",sbrw:"8b4513",smn:"a8072",nbr:"4a460",sgrn:"2e8b57",ssh:"5ee",snn:"a0522d",svr:"c0c0c0",skb:"87ceeb",sTb:"6a5acd",sTgr:"708090",snw:"afa",n:"-ff7f",stb:"4682b4",tn:"d2b48c",t:"-8080",thst:"d8bfd8",tmT:"6347",trqs:"40e0d0",vt:"ee82ee",whT:"5deb3",wht:"",hts:"5f5f5",w:"-",wgrn:"9acd32"};function Yp(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=e>0?r.toFixed(e).replace(/0+$/,"").replace(/\.$/,""):r.toString();return t||"0"}var hO=function(){function r(e,t,i,n){_f(this,r);var s=this;function o(l){if(l.startsWith("hsl")){var h=l.match(/([\-\d\.e]+)/g).map(Number),u=ka(h,4),c=u[0],d=u[1],f=u[2],g=u[3];g===void 0&&(g=1),c/=360,d/=100,f/=100,s.hsla=[c,d,f,g]}else if(l.startsWith("rgb")){var m=l.match(/([\-\d\.e]+)/g).map(Number),w=ka(m,4),y=w[0],E=w[1],x=w[2],v=w[3];v===void 0&&(v=1),s.rgba=[y,E,x,v]}else l.startsWith("#")?s.rgba=r.hexToRgb(l):s.rgba=r.nameToRgb(l)||r.hexToRgb(l)}if(e!==void 0)if(Array.isArray(e))this.rgba=e;else if(i===void 0){var a=e&&""+e;a&&o(a.toLowerCase())}else this.rgba=[e,t,i,n===void 0?1:n]}return Cf(r,[{key:"printRGB",value:function(t){var i=t?this.rgba:this.rgba.slice(0,3),n=i.map(function(s,o){return Yp(s,o===3?3:0)});return t?"rgba("+n+")":"rgb("+n+")"}},{key:"printHSL",value:function(t){var i=[360,100,100,1],n=["","%","%",""],s=t?this.hsla:this.hsla.slice(0,3),o=s.map(function(a,l){return Yp(a*i[l],l===3?3:1)+n[l]});return t?"hsla("+o+")":"hsl("+o+")"}},{key:"printHex",value:function(t){var i=this.hex;return t?i:i.substring(0,7)}},{key:"rgba",get:function(){if(this._rgba)return this._rgba;if(!this._hsla)throw new Error("No color is set");return this._rgba=r.hslToRgb(this._hsla)},set:function(t){t.length===3&&(t[3]=1),this._rgba=t,this._hsla=null}},{key:"rgbString",get:function(){return this.printRGB()}},{key:"rgbaString",get:function(){return this.printRGB(!0)}},{key:"hsla",get:function(){if(this._hsla)return this._hsla;if(!this._rgba)throw new Error("No color is set");return this._hsla=r.rgbToHsl(this._rgba)},set:function(t){t.length===3&&(t[3]=1),this._hsla=t,this._rgba=null}},{key:"hslString",get:function(){return this.printHSL()}},{key:"hslaString",get:function(){return this.printHSL(!0)}},{key:"hex",get:function(){var t=this.rgba,i=t.map(function(n,s){return s<3?n.toString(16):Math.round(n*255).toString(16)});return"#"+i.map(function(n){return n.padStart(2,"0")}).join("")},set:function(t){this.rgba=r.hexToRgb(t)}}],[{key:"hexToRgb",value:function(t){var i=(t.startsWith("#")?t.slice(1):t).replace(/^(\w{3})$/,"$1F").replace(/^(\w)(\w)(\w)(\w)$/,"$1$1$2$2$3$3$4$4").replace(/^(\w{6})$/,"$1FF");if(!i.match(/^([0-9a-fA-F]{8})$/))throw new Error("Unknown hex color; "+t);var n=i.match(/^(\w\w)(\w\w)(\w\w)(\w\w)$/).slice(1).map(function(s){return parseInt(s,16)});return n[3]=n[3]/255,n}},{key:"nameToRgb",value:function(t){var i=t.toLowerCase().replace("at","T").replace(/[aeiouyldf]/g,"").replace("ght","L").replace("rk","D").slice(-5,4),n=lO[i];return n===void 0?n:r.hexToRgb(n.replace(/\-/g,"00").padStart(6,"f"))}},{key:"rgbToHsl",value:function(t){var i=ka(t,4),n=i[0],s=i[1],o=i[2],a=i[3];n/=255,s/=255,o/=255;var l=Math.max(n,s,o),h=Math.min(n,s,o),u=void 0,c=void 0,d=(l+h)/2;if(l===h)u=c=0;else{var f=l-h;switch(c=d>.5?f/(2-l-h):f/(l+h),l){case n:u=(s-o)/f+(s<o?6:0);break;case s:u=(o-n)/f+2;break;case o:u=(n-s)/f+4;break}u/=6}return[u,c,d,a]}},{key:"hslToRgb",value:function(t){var i=ka(t,4),n=i[0],s=i[1],o=i[2],a=i[3],l=void 0,h=void 0,u=void 0;if(s===0)l=h=u=o;else{var c=function(w,y,E){return E<0&&(E+=1),E>1&&(E-=1),E<.16666666666666666?w+(y-w)*6*E:E<.5?y:E<.6666666666666666?w+(y-w)*(.6666666666666666-E)*6:w},d=o<.5?o*(1+s):o+s-o*s,f=2*o-d;l=c(f,d,n+1/3),h=c(f,d,n),u=c(f,d,n-1/3)}var g=[l*255,h*255,u*255].map(Math.round);return g[3]=a,g}}]),r}(),uO=function(){function r(){_f(this,r),this._events=[]}return Cf(r,[{key:"add",value:function(t,i,n){t.addEventListener(i,n,!1),this._events.push({target:t,type:i,handler:n})}},{key:"remove",value:function(t,i,n){this._events=this._events.filter(function(s){var o=!0;return t&&t!==s.target&&(o=!1),i&&i!==s.type&&(o=!1),n&&n!==s.handler&&(o=!1),o&&r._doRemove(s.target,s.type,s.handler),!o})}},{key:"destroy",value:function(){this._events.forEach(function(t){return r._doRemove(t.target,t.type,t.handler)}),this._events=[]}}],[{key:"_doRemove",value:function(t,i,n){t.removeEventListener(i,n,!1)}}]),r}();function cO(r){var e=document.createElement("div");return e.innerHTML=r,e.firstElementChild}function lu(r,e,t){var i=!1;function n(l,h,u){return Math.max(h,Math.min(l,u))}function s(l,h,u){if(u&&(i=!0),!!i){l.preventDefault();var c=e.getBoundingClientRect(),d=c.width,f=c.height,g=h.clientX,m=h.clientY,w=n(g-c.left,0,d),y=n(m-c.top,0,f);t(w/d,y/f)}}function o(l,h){var u=l.buttons===void 0?l.which:l.buttons;u===1?s(l,l,h):i=!1}function a(l,h){l.touches.length===1?s(l,l.touches[0],h):i=!1}r.add(e,"mousedown",function(l){o(l,!0)}),r.add(e,"touchstart",function(l){a(l,!0)}),r.add(window,"mousemove",o),r.add(e,"touchmove",a),r.add(window,"mouseup",function(l){i=!1}),r.add(e,"touchend",function(l){i=!1}),r.add(e,"touchcancel",function(l){i=!1})}var dO=`linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%) 0 0 / 2em 2em,
                   linear-gradient(45deg, lightgrey 25%,       white 25%,       white 75%, lightgrey 75%) 1em 1em / 2em 2em`,fO=360,fv="keydown",Na="mousedown",hu="focusin";function Ui(r,e){return(e||document).querySelector(r)}function gv(r){r.preventDefault(),r.stopPropagation()}function uu(r,e,t,i,n){r.add(e,fv,function(s){t.indexOf(s.key)>=0&&(n&&gv(s),i(s))})}var gO=function(){function r(e){_f(this,r),this.settings={popup:"right",layout:"default",alpha:!0,editor:!0,editorFormat:"hex",cancelButton:!1,defaultColor:"#0cf"},this._events=new uO,this.onChange=null,this.onDone=null,this.onOpen=null,this.onClose=null,this.setOptions(e)}return Cf(r,[{key:"setOptions",value:function(t){var i=this;if(!t)return;var n=this.settings;function s(h,u,c){for(var d in h)c&&c.indexOf(d)>=0||(u[d]=h[d])}if(t instanceof HTMLElement)n.parent=t;else{n.parent&&t.parent&&n.parent!==t.parent&&(this._events.remove(n.parent),this._popupInited=!1),s(t,n),t.onChange&&(this.onChange=t.onChange),t.onDone&&(this.onDone=t.onDone),t.onOpen&&(this.onOpen=t.onOpen),t.onClose&&(this.onClose=t.onClose);var o=t.color||t.colour;o&&this._setColor(o)}var a=n.parent;if(a&&n.popup&&!this._popupInited){var l=function(u){return i.openHandler(u)};this._events.add(a,"click",l),uu(this._events,a,[" ","Spacebar","Enter"],l),this._popupInited=!0}else t.parent&&!n.popup&&this.show()}},{key:"openHandler",value:function(t){if(this.show()){t&&t.preventDefault(),this.settings.parent.style.pointerEvents="none";var i=t&&t.type===fv?this._domEdit:this.domElement;setTimeout(function(){return i.focus()},100),this.onOpen&&this.onOpen(this.colour)}}},{key:"closeHandler",value:function(t){var i=t&&t.type,n=!1;if(!t)n=!0;else if(i===Na||i===hu){var s=(this.__containedEvent||0)+100;t.timeStamp>s&&(n=!0)}else gv(t),n=!0;n&&this.hide()&&(this.settings.parent.style.pointerEvents="",i!==Na&&this.settings.parent.focus(),this.onClose&&this.onClose(this.colour))}},{key:"movePopup",value:function(t,i){this.closeHandler(),this.setOptions(t),i&&this.openHandler()}},{key:"setColor",value:function(t,i){this._setColor(t,{silent:i})}},{key:"_setColor",value:function(t,i){if(typeof t=="string"&&(t=t.trim()),!!t){i=i||{};var n=void 0;try{n=new hO(t)}catch(o){if(i.failSilently)return;throw o}if(!this.settings.alpha){var s=n.hsla;s[3]=1,n.hsla=s}this.colour=this.color=n,this._setHSLA(null,null,null,null,i)}}},{key:"setColour",value:function(t,i){this.setColor(t,i)}},{key:"show",value:function(){var t=this.settings.parent;if(!t)return!1;if(this.domElement){var i=this._toggleDOM(!0);return this._setPosition(),i}var n=this.settings.template||'<div class="picker_wrapper" tabindex="-1"><div class="picker_arrow"></div><div class="picker_hue picker_slider"><div class="picker_selector"></div></div><div class="picker_sl"><div class="picker_selector"></div></div><div class="picker_alpha picker_slider"><div class="picker_selector"></div></div><div class="picker_editor"><input aria-label="Type a color name or hex value"/></div><div class="picker_sample"></div><div class="picker_done"><button>Ok</button></div><div class="picker_cancel"><button>Cancel</button></div></div>',s=cO(n);return this.domElement=s,this._domH=Ui(".picker_hue",s),this._domSL=Ui(".picker_sl",s),this._domA=Ui(".picker_alpha",s),this._domEdit=Ui(".picker_editor input",s),this._domSample=Ui(".picker_sample",s),this._domOkay=Ui(".picker_done button",s),this._domCancel=Ui(".picker_cancel button",s),s.classList.add("layout_"+this.settings.layout),this.settings.alpha||s.classList.add("no_alpha"),this.settings.editor||s.classList.add("no_editor"),this.settings.cancelButton||s.classList.add("no_cancel"),this._ifPopup(function(){return s.classList.add("popup")}),this._setPosition(),this.colour?this._updateUI():this._setColor(this.settings.defaultColor),this._bindEvents(),!0}},{key:"hide",value:function(){return this._toggleDOM(!1)}},{key:"destroy",value:function(){this._events.destroy(),this.domElement&&this.settings.parent.removeChild(this.domElement)}},{key:"_bindEvents",value:function(){var t=this,i=this,n=this.domElement,s=this._events;function o(h,u,c){s.add(h,u,c)}o(n,"click",function(h){return h.preventDefault()}),lu(s,this._domH,function(h,u){return i._setHSLA(h)}),lu(s,this._domSL,function(h,u){return i._setHSLA(null,h,1-u)}),this.settings.alpha&&lu(s,this._domA,function(h,u){return i._setHSLA(null,null,null,1-u)});var a=this._domEdit;o(a,"input",function(h){i._setColor(this.value,{fromEditor:!0,failSilently:!0})}),o(a,"focus",function(h){var u=this;u.selectionStart===u.selectionEnd&&u.select()}),this._ifPopup(function(){var h=function(d){return t.closeHandler(d)};o(window,Na,h),o(window,hu,h),uu(s,n,["Esc","Escape"],h);var u=function(d){t.__containedEvent=d.timeStamp};o(n,Na,u),o(n,hu,u),o(t._domCancel,"click",h)});var l=function(u){t._ifPopup(function(){return t.closeHandler(u)}),t.onDone&&t.onDone(t.colour)};o(this._domOkay,"click",l),uu(s,n,["Enter"],l)}},{key:"_setPosition",value:function(){var t=this.settings.parent,i=this.domElement;t!==i.parentNode&&t.appendChild(i),this._ifPopup(function(n){getComputedStyle(t).position==="static"&&(t.style.position="relative");var s=n===!0?"popup_right":"popup_"+n;["popup_top","popup_bottom","popup_left","popup_right"].forEach(function(o){o===s?i.classList.add(o):i.classList.remove(o)}),i.classList.add(s)})}},{key:"_setHSLA",value:function(t,i,n,s,o){o=o||{};var a=this.colour,l=a.hsla;[t,i,n,s].forEach(function(h,u){(h||h===0)&&(l[u]=h)}),a.hsla=l,this._updateUI(o),this.onChange&&!o.silent&&this.onChange(a)}},{key:"_updateUI",value:function(t){if(!this.domElement)return;t=t||{};var i=this.colour,n=i.hsla,s="hsl("+n[0]*fO+", 100%, 50%)",o=i.hslString,a=i.hslaString,l=this._domH,h=this._domSL,u=this._domA,c=Ui(".picker_selector",l),d=Ui(".picker_selector",h),f=Ui(".picker_selector",u);function g(R,L,C){L.style.left=C*100+"%"}function m(R,L,C){L.style.top=C*100+"%"}g(l,c,n[0]),this._domSL.style.backgroundColor=this._domH.style.color=s,g(h,d,n[1]),m(h,d,1-n[2]),h.style.color=o,m(u,f,1-n[3]);var w=o,y=w.replace("hsl","hsla").replace(")",", 0)"),E="linear-gradient("+[w,y]+")";if(this._domA.style.background=E+", "+dO,!t.fromEditor){var x=this.settings.editorFormat,v=this.settings.alpha,S=void 0;switch(x){case"rgb":S=i.printRGB(v);break;case"hsl":S=i.printHSL(v);break;default:S=i.printHex(v)}this._domEdit.value=S}this._domSample.style.color=a}},{key:"_ifPopup",value:function(t,i){this.settings.parent&&this.settings.popup?t&&t(this.settings.popup):i&&i()}},{key:"_toggleDOM",value:function(t){var i=this.domElement;if(!i)return!1;var n=t?"":"none",s=i.style.display!==n;return s&&(i.style.display=n),s}}]),r}();{var cu=document.createElement("style");cu.textContent='.picker_wrapper.no_alpha .picker_alpha{display:none}.picker_wrapper.no_editor .picker_editor{position:absolute;z-index:-1;opacity:0}.picker_wrapper.no_cancel .picker_cancel{display:none}.layout_default.picker_wrapper{display:flex;flex-flow:row wrap;justify-content:space-between;align-items:stretch;font-size:10px;width:25em;padding:.5em}.layout_default.picker_wrapper input,.layout_default.picker_wrapper button{font-size:1rem}.layout_default.picker_wrapper>*{margin:.5em}.layout_default.picker_wrapper::before{content:"";display:block;width:100%;height:0;order:1}.layout_default .picker_slider,.layout_default .picker_selector{padding:1em}.layout_default .picker_hue{width:100%}.layout_default .picker_sl{flex:1 1 auto}.layout_default .picker_sl::before{content:"";display:block;padding-bottom:100%}.layout_default .picker_editor{order:1;width:6.5rem}.layout_default .picker_editor input{width:100%;height:100%}.layout_default .picker_sample{order:1;flex:1 1 auto}.layout_default .picker_done,.layout_default .picker_cancel{order:1}.picker_wrapper{box-sizing:border-box;background:#f2f2f2;box-shadow:0 0 0 1px silver;cursor:default;font-family:sans-serif;color:#444;pointer-events:auto}.picker_wrapper:focus{outline:none}.picker_wrapper button,.picker_wrapper input{box-sizing:border-box;border:none;box-shadow:0 0 0 1px silver;outline:none}.picker_wrapper button:focus,.picker_wrapper button:active,.picker_wrapper input:focus,.picker_wrapper input:active{box-shadow:0 0 2px 1px #1e90ff}.picker_wrapper button{padding:.4em .6em;cursor:pointer;background-color:#f5f5f5;background-image:linear-gradient(0deg, gainsboro, transparent)}.picker_wrapper button:active{background-image:linear-gradient(0deg, transparent, gainsboro)}.picker_wrapper button:hover{background-color:#fff}.picker_selector{position:absolute;z-index:1;display:block;-webkit-transform:translate(-50%, -50%);transform:translate(-50%, -50%);border:2px solid #fff;border-radius:100%;box-shadow:0 0 3px 1px #67b9ff;background:currentColor;cursor:pointer}.picker_slider .picker_selector{border-radius:2px}.picker_hue{position:relative;background-image:linear-gradient(90deg, red, yellow, lime, cyan, blue, magenta, red);box-shadow:0 0 0 1px silver}.picker_sl{position:relative;box-shadow:0 0 0 1px silver;background-image:linear-gradient(180deg, white, rgba(255, 255, 255, 0) 50%),linear-gradient(0deg, black, rgba(0, 0, 0, 0) 50%),linear-gradient(90deg, #808080, rgba(128, 128, 128, 0))}.picker_alpha,.picker_sample{position:relative;background:linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%) 0 0/2em 2em,linear-gradient(45deg, lightgrey 25%, white 25%, white 75%, lightgrey 75%) 1em 1em/2em 2em;box-shadow:0 0 0 1px silver}.picker_alpha .picker_selector,.picker_sample .picker_selector{background:none}.picker_editor input{font-family:monospace;padding:.2em .4em}.picker_sample::before{content:"";position:absolute;display:block;width:100%;height:100%;background:currentColor}.picker_arrow{position:absolute;z-index:-1}.picker_wrapper.popup{position:absolute;z-index:2;margin:1.5em}.picker_wrapper.popup,.picker_wrapper.popup .picker_arrow::before,.picker_wrapper.popup .picker_arrow::after{background:#f2f2f2;box-shadow:0 0 10px 1px rgba(0,0,0,.4)}.picker_wrapper.popup .picker_arrow{width:3em;height:3em;margin:0}.picker_wrapper.popup .picker_arrow::before,.picker_wrapper.popup .picker_arrow::after{content:"";display:block;position:absolute;top:0;left:0;z-index:-99}.picker_wrapper.popup .picker_arrow::before{width:100%;height:100%;-webkit-transform:skew(45deg);transform:skew(45deg);-webkit-transform-origin:0 100%;transform-origin:0 100%}.picker_wrapper.popup .picker_arrow::after{width:150%;height:150%;box-shadow:none}.popup.popup_top{bottom:100%;left:0}.popup.popup_top .picker_arrow{bottom:0;left:0;-webkit-transform:rotate(-90deg);transform:rotate(-90deg)}.popup.popup_bottom{top:100%;left:0}.popup.popup_bottom .picker_arrow{top:0;left:0;-webkit-transform:rotate(90deg) scale(1, -1);transform:rotate(90deg) scale(1, -1)}.popup.popup_left{top:0;right:100%}.popup.popup_left .picker_arrow{top:0;right:0;-webkit-transform:scale(-1, 1);transform:scale(-1, 1)}.popup.popup_right{top:0;left:100%}.popup.popup_right .picker_arrow{top:0;left:0}',document.documentElement.firstElementChild.appendChild(cu),gO.StyleElement=cu}class It{constructor(e){this.table=e}reloadData(e,t,i){return this.table.dataLoader.load(e,void 0,void 0,void 0,t,i)}langText(){return this.table.modules.localize.getText(...arguments)}langBind(){return this.table.modules.localize.bind(...arguments)}langLocale(){return this.table.modules.localize.getLocale(...arguments)}commsConnections(){return this.table.modules.comms.getConnections(...arguments)}commsSend(){return this.table.modules.comms.send(...arguments)}layoutMode(){return this.table.modules.layout.getMode()}layoutRefresh(e){return this.table.modules.layout.layout(e)}subscribe(){return this.table.eventBus.subscribe(...arguments)}unsubscribe(){return this.table.eventBus.unsubscribe(...arguments)}subscribed(e){return this.table.eventBus.subscribed(e)}subscriptionChange(){return this.table.eventBus.subscriptionChange(...arguments)}dispatch(){return this.table.eventBus.dispatch(...arguments)}chain(){return this.table.eventBus.chain(...arguments)}confirm(){return this.table.eventBus.confirm(...arguments)}dispatchExternal(){return this.table.externalEvents.dispatch(...arguments)}subscribedExternal(e){return this.table.externalEvents.subscribed(e)}subscriptionChangeExternal(){return this.table.externalEvents.subscriptionChange(...arguments)}options(e){return this.table.options[e]}setOption(e,t){return typeof t<"u"&&(this.table.options[e]=t),this.table.options[e]}deprecationCheck(e,t,i){return this.table.deprecationAdvisor.check(e,t,i)}deprecationCheckMsg(e,t){return this.table.deprecationAdvisor.checkMsg(e,t)}deprecationMsg(e){return this.table.deprecationAdvisor.msg(e)}module(e){return this.table.module(e)}}class Ze{static elVisible(e){return!(e.offsetWidth<=0&&e.offsetHeight<=0)}static elOffset(e){var t=e.getBoundingClientRect();return{top:t.top+window.pageYOffset-document.documentElement.clientTop,left:t.left+window.pageXOffset-document.documentElement.clientLeft}}static retrieveNestedData(e,t,i){var n=e?t.split(e):[t],s=n.length,o;for(let a=0;a<s&&(i=i[n[a]],o=i,!!i);a++);return o}static deepClone(e,t,i=[]){var n={}.__proto__,s=[].__proto__;t||(t=Object.assign(Array.isArray(e)?[]:{},e));for(var o in e){let a=e[o],l,h;a!=null&&typeof a=="object"&&(a.__proto__===n||a.__proto__===s)&&(l=i.findIndex(u=>u.subject===a),l>-1?t[o]=i[l].copy:(h=Object.assign(Array.isArray(a)?[]:{},a),i.unshift({subject:a,copy:h}),t[o]=this.deepClone(a,h,i)))}return t}}let pO=class pv extends It{constructor(e,t,i){super(e),this.element=t,this.container=this._lookupContainer(),this.parent=i,this.reversedX=!1,this.childPopup=null,this.blurable=!1,this.blurCallback=null,this.blurEventsBound=!1,this.renderedCallback=null,this.visible=!1,this.hideable=!0,this.element.classList.add("tabulator-popup-container"),this.blurEvent=this.hide.bind(this,!1),this.escEvent=this._escapeCheck.bind(this),this.destroyBinding=this.tableDestroyed.bind(this),this.destroyed=!1}tableDestroyed(){this.destroyed=!0,this.hide(!0)}_lookupContainer(){var e=this.table.options.popupContainer;return typeof e=="string"?(e=document.querySelector(e),e||console.warn("Menu Error - no container element found matching selector:",this.table.options.popupContainer,"(defaulting to document body)")):e===!0&&(e=this.table.element),e&&!this._checkContainerIsParent(e)&&(e=!1,console.warn("Menu Error - container element does not contain this table:",this.table.options.popupContainer,"(defaulting to document body)")),e||(e=document.body),e}_checkContainerIsParent(e,t=this.table.element){return e===t?!0:t.parentNode?this._checkContainerIsParent(e,t.parentNode):!1}renderCallback(e){this.renderedCallback=e}containerEventCoords(e){var t=!(e instanceof MouseEvent),i=t?e.touches[0].pageX:e.pageX,n=t?e.touches[0].pageY:e.pageY;if(this.container!==document.body){let s=Ze.elOffset(this.container);i-=s.left,n-=s.top}return{x:i,y:n}}elementPositionCoords(e,t="right"){var i=Ze.elOffset(e),n,s,o;switch(this.container!==document.body&&(n=Ze.elOffset(this.container),i.left-=n.left,i.top-=n.top),t){case"right":s=i.left+e.offsetWidth,o=i.top-1;break;case"bottom":s=i.left,o=i.top+e.offsetHeight;break;case"left":s=i.left,o=i.top-1;break;case"top":s=i.left,o=i.top;break;case"center":s=i.left+e.offsetWidth/2,o=i.top+e.offsetHeight/2;break}return{x:s,y:o,offset:i}}show(e,t){var i,n,s,o,a;return this.destroyed||this.table.destroyed?this:(e instanceof HTMLElement?(s=e,a=this.elementPositionCoords(e,t),o=a.offset,i=a.x,n=a.y):typeof e=="number"?(o={top:0,left:0},i=e,n=t):(a=this.containerEventCoords(e),i=a.x,n=a.y,this.reversedX=!1),this.element.style.top=n+"px",this.element.style.left=i+"px",this.container.appendChild(this.element),typeof this.renderedCallback=="function"&&this.renderedCallback(),this._fitToScreen(i,n,s,o,t),this.visible=!0,this.subscribe("table-destroy",this.destroyBinding),this.element.addEventListener("mousedown",l=>{l.stopPropagation()}),this)}_fitToScreen(e,t,i,n,s){var o=this.container===document.body?document.documentElement.scrollTop:this.container.scrollTop;(e+this.element.offsetWidth>=this.container.offsetWidth||this.reversedX)&&(this.element.style.left="",i?this.element.style.right=this.container.offsetWidth-n.left+"px":this.element.style.right=this.container.offsetWidth-e+"px",this.reversedX=!0);let a=Math.max(this.container.offsetHeight,o?this.container.scrollHeight:0);if(t+this.element.offsetHeight>a)if(i)switch(s){case"bottom":this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight-i.offsetHeight-1+"px";break;default:this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+i.offsetHeight+1+"px"}else this.element.style.height=a+"px"}isVisible(){return this.visible}hideOnBlur(e){return this.blurable=!0,this.visible&&(setTimeout(()=>{this.visible&&(this.table.rowManager.element.addEventListener("scroll",this.blurEvent),this.subscribe("cell-editing",this.blurEvent),document.body.addEventListener("click",this.blurEvent),document.body.addEventListener("contextmenu",this.blurEvent),document.body.addEventListener("mousedown",this.blurEvent),window.addEventListener("resize",this.blurEvent),document.body.addEventListener("keydown",this.escEvent),this.blurEventsBound=!0)},100),this.blurCallback=e),this}_escapeCheck(e){e.keyCode==27&&this.hide()}blockHide(){this.hideable=!1}restoreHide(){this.hideable=!0}hide(e=!1){return this.visible&&this.hideable&&(this.blurable&&this.blurEventsBound&&(document.body.removeEventListener("keydown",this.escEvent),document.body.removeEventListener("click",this.blurEvent),document.body.removeEventListener("contextmenu",this.blurEvent),document.body.removeEventListener("mousedown",this.blurEvent),window.removeEventListener("resize",this.blurEvent),this.table.rowManager.element.removeEventListener("scroll",this.blurEvent),this.unsubscribe("cell-editing",this.blurEvent),this.blurEventsBound=!1),this.childPopup&&this.childPopup.hide(),this.parent&&(this.parent.childPopup=null),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.visible=!1,this.blurCallback&&!e&&this.blurCallback(),this.unsubscribe("table-destroy",this.destroyBinding)),this}child(e){return this.childPopup&&this.childPopup.hide(),this.childPopup=new pv(this.table,e,this),this.childPopup}};class Le extends It{constructor(e,t){super(e),this._handler=null}initialize(){}registerTableOption(e,t){this.table.optionsList.register(e,t)}registerColumnOption(e,t){this.table.columnManager.optionsList.register(e,t)}registerTableFunction(e,t){typeof this.table[e]>"u"?this.table[e]=(...i)=>(this.table.initGuard(e),t(...i)):console.warn("Unable to bind table function, name already in use",e)}registerComponentFunction(e,t,i){return this.table.componentFunctionBinder.bind(e,t,i)}registerDataHandler(e,t){this.table.rowManager.registerDataPipelineHandler(e,t),this._handler=e}registerDisplayHandler(e,t){this.table.rowManager.registerDisplayPipelineHandler(e,t),this._handler=e}displayRows(e){var t=this.table.rowManager.displayRows.length-1,i;if(this._handler&&(i=this.table.rowManager.displayPipeline.findIndex(n=>n.handler===this._handler),i>-1&&(t=i)),e&&(t=t+e),this._handler)return t>-1?this.table.rowManager.getDisplayRows(t):this.activeRows()}activeRows(){return this.table.rowManager.activeRows}refreshData(e,t){t||(t=this._handler),t&&this.table.rowManager.refreshActiveData(t,!1,e)}footerAppend(e){return this.table.footerManager.append(e)}footerPrepend(e){return this.table.footerManager.prepend(e)}footerRemove(e){return this.table.footerManager.remove(e)}popup(e,t){return new pO(this.table,e,t)}alert(e,t){return this.table.alertManager.alert(e,t)}clearAlert(){return this.table.alertManager.clear()}}var mO={rownum:function(r,e,t,i,n,s){return s.getPosition()}};const ds=class ds extends Le{constructor(e){super(e),this.allowedTypes=["","data","download","clipboard","print","htmlOutput"],this.registerColumnOption("accessor"),this.registerColumnOption("accessorParams"),this.registerColumnOption("accessorData"),this.registerColumnOption("accessorDataParams"),this.registerColumnOption("accessorDownload"),this.registerColumnOption("accessorDownloadParams"),this.registerColumnOption("accessorClipboard"),this.registerColumnOption("accessorClipboardParams"),this.registerColumnOption("accessorPrint"),this.registerColumnOption("accessorPrintParams"),this.registerColumnOption("accessorHtmlOutput"),this.registerColumnOption("accessorHtmlOutputParams")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-retrieve",this.transformRow.bind(this))}initializeColumn(e){var t=!1,i={};this.allowedTypes.forEach(n=>{var s="accessor"+(n.charAt(0).toUpperCase()+n.slice(1)),o;e.definition[s]&&(o=this.lookupAccessor(e.definition[s]),o&&(t=!0,i[s]={accessor:o,params:e.definition[s+"Params"]||{}}))}),t&&(e.modules.accessor=i)}lookupAccessor(e){var t=!1;switch(typeof e){case"string":ds.accessors[e]?t=ds.accessors[e]:console.warn("Accessor Error - No such accessor found, ignoring: ",e);break;case"function":t=e;break}return t}transformRow(e,t){var i="accessor"+(t.charAt(0).toUpperCase()+t.slice(1)),n=e.getComponent(),s=Ze.deepClone(e.data||{});return this.table.columnManager.traverse(function(o){var a,l,h,u;o.modules.accessor&&(l=o.modules.accessor[i]||o.modules.accessor.accessor||!1,l&&(a=o.getFieldValue(s),a!="undefined"&&(u=o.getComponent(),h=typeof l.params=="function"?l.params(a,s,t,u,n):l.params,o.setFieldValue(s,l.accessor(a,s,t,h,u,n)))))}),s}};K(ds,"moduleName","accessor"),K(ds,"accessors",mO);let sc=ds;var bO={method:"GET"};function oc(r,e){var t=[];if(e=e||"",Array.isArray(r))r.forEach((n,s)=>{t=t.concat(oc(n,e?e+"["+s+"]":s))});else if(typeof r=="object")for(var i in r)t=t.concat(oc(r[i],e?e+"["+i+"]":i));else t.push({key:e,value:r});return t}function yO(r){var e=oc(r),t=[];return e.forEach(function(i){t.push(encodeURIComponent(i.key)+"="+encodeURIComponent(i.value))}),t.join("&")}function mv(r,e,t){return r&&t&&Object.keys(t).length&&(!e.method||e.method.toLowerCase()=="get")&&(e.method="get",r+=(r.includes("?")?"&":"?")+yO(t)),r}function vO(r,e,t){var i;return new Promise((n,s)=>{if(r=this.urlGenerator.call(this.table,r,e,t),e.method.toUpperCase()!="GET")if(i=typeof this.table.options.ajaxContentType=="object"?this.table.options.ajaxContentType:this.contentTypeFormatters[this.table.options.ajaxContentType],i){for(var o in i.headers)e.headers||(e.headers={}),typeof e.headers[o]>"u"&&(e.headers[o]=i.headers[o]);e.body=i.body.call(this,r,e,t)}else console.warn("Ajax Error - Invalid ajaxContentType value:",this.table.options.ajaxContentType);r?(typeof e.headers>"u"&&(e.headers={}),typeof e.headers.Accept>"u"&&(e.headers.Accept="application/json"),typeof e.headers["X-Requested-With"]>"u"&&(e.headers["X-Requested-With"]="XMLHttpRequest"),typeof e.mode>"u"&&(e.mode="cors"),e.mode=="cors"?(typeof e.headers.Origin>"u"&&(e.headers.Origin=window.location.origin),typeof e.credentials>"u"&&(e.credentials="same-origin")):typeof e.credentials>"u"&&(e.credentials="include"),fetch(r,e).then(a=>{a.ok?a.json().then(l=>{n(l)}).catch(l=>{s(l),console.warn("Ajax Load Error - Invalid JSON returned",l)}):(console.error("Ajax Load Error - Connection Error: "+a.status,a.statusText),s(a))}).catch(a=>{console.error("Ajax Load Error - Connection Error: ",a),s(a)})):(console.warn("Ajax Load Error - No URL Set"),n([]))})}function ac(r,e){var t=[];if(e=e||"",Array.isArray(r))r.forEach((n,s)=>{t=t.concat(ac(n,e?e+"["+s+"]":s))});else if(typeof r=="object")for(var i in r)t=t.concat(ac(r[i],e?e+"["+i+"]":i));else t.push({key:e,value:r});return t}var wO={json:{headers:{"Content-Type":"application/json"},body:function(r,e,t){return JSON.stringify(t)}},form:{headers:{},body:function(r,e,t){var i=ac(t),n=new FormData;return i.forEach(function(s){n.append(s.key,s.value)}),n}}};const Ii=class Ii extends Le{constructor(e){super(e),this.config={},this.url="",this.urlGenerator=!1,this.params=!1,this.loaderPromise=!1,this.registerTableOption("ajaxURL",!1),this.registerTableOption("ajaxURLGenerator",!1),this.registerTableOption("ajaxParams",{}),this.registerTableOption("ajaxConfig","get"),this.registerTableOption("ajaxContentType","form"),this.registerTableOption("ajaxRequestFunc",!1),this.registerTableOption("ajaxRequesting",function(){}),this.registerTableOption("ajaxResponse",!1),this.contentTypeFormatters=Ii.contentTypeFormatters}initialize(){this.loaderPromise=this.table.options.ajaxRequestFunc||Ii.defaultLoaderPromise,this.urlGenerator=this.table.options.ajaxURLGenerator||Ii.defaultURLGenerator,this.table.options.ajaxURL&&this.setUrl(this.table.options.ajaxURL),this.setDefaultConfig(this.table.options.ajaxConfig),this.registerTableFunction("getAjaxUrl",this.getUrl.bind(this)),this.subscribe("data-loading",this.requestDataCheck.bind(this)),this.subscribe("data-params",this.requestParams.bind(this)),this.subscribe("data-load",this.requestData.bind(this))}requestParams(e,t,i,n){var s=this.table.options.ajaxParams;return s&&(typeof s=="function"&&(s=s.call(this.table)),n=Object.assign(Object.assign({},s),n)),n}requestDataCheck(e,t,i,n){return!!(!e&&this.url||typeof e=="string")}requestData(e,t,i,n,s){var o;return!s&&this.requestDataCheck(e)?(e&&this.setUrl(e),o=this.generateConfig(i),this.sendRequest(this.url,t,o)):s}setDefaultConfig(e={}){this.config=Object.assign({},Ii.defaultConfig),typeof e=="string"?this.config.method=e:Object.assign(this.config,e)}generateConfig(e={}){var t=Object.assign({},this.config);return typeof e=="string"?t.method=e:Object.assign(t,e),t}setUrl(e){this.url=e}getUrl(){return this.url}sendRequest(e,t,i){return this.table.options.ajaxRequesting.call(this.table,e,t)!==!1?this.loaderPromise(e,i,t).then(n=>(this.table.options.ajaxResponse&&(n=this.table.options.ajaxResponse.call(this.table,e,t,n)),n)):Promise.reject()}};K(Ii,"moduleName","ajax"),K(Ii,"defaultConfig",bO),K(Ii,"defaultURLGenerator",mv),K(Ii,"defaultLoaderPromise",vO),K(Ii,"contentTypeFormatters",wO);let lc=Ii;var EO={replace:function(r){return this.table.setData(r)},update:function(r){return this.table.updateOrAddData(r)},insert:function(r){return this.table.addData(r)}},_O={table:function(r){var e=[],t=!0,i=this.table.columnManager.columns,n=[],s=[];return r=r.split(`
`),r.forEach(function(o){e.push(o.split("	"))}),e.length&&!(e.length===1&&e[0].length<2)?(e[0].forEach(function(o){var a=i.find(function(l){return o&&l.definition.title&&o.trim()&&l.definition.title.trim()===o.trim()});a?n.push(a):t=!1}),t||(t=!0,n=[],e[0].forEach(function(o){var a=i.find(function(l){return o&&l.field&&o.trim()&&l.field.trim()===o.trim()});a?n.push(a):t=!1}),t||(n=this.table.columnManager.columnsByIndex)),t&&e.shift(),e.forEach(function(o){var a={};o.forEach(function(l,h){n[h]&&(a[n[h].field]=l)}),s.push(a)}),s):!1}},CO={copyToClipboard:["ctrl + 67","meta + 67"]},xO={copyToClipboard:function(r){this.table.modules.edit.currentCell||this.table.modExists("clipboard",!0)&&this.table.modules.clipboard.copy(!1,!0)}},RO={keybindings:{bindings:CO,actions:xO}};const Yn=class Yn extends Le{constructor(e){super(e),this.mode=!0,this.pasteParser=function(){},this.pasteAction=function(){},this.customSelection=!1,this.rowRange=!1,this.blocked=!0,this.registerTableOption("clipboard",!1),this.registerTableOption("clipboardCopyStyled",!0),this.registerTableOption("clipboardCopyConfig",!1),this.registerTableOption("clipboardCopyFormatter",!1),this.registerTableOption("clipboardCopyRowRange","active"),this.registerTableOption("clipboardPasteParser","table"),this.registerTableOption("clipboardPasteAction","insert"),this.registerColumnOption("clipboard"),this.registerColumnOption("titleClipboard")}initialize(){this.mode=this.table.options.clipboard,this.rowRange=this.table.options.clipboardCopyRowRange,(this.mode===!0||this.mode==="copy")&&this.table.element.addEventListener("copy",e=>{var t,i,n;this.blocked||(e.preventDefault(),this.customSelection?(t=this.customSelection,this.table.options.clipboardCopyFormatter&&(t=this.table.options.clipboardCopyFormatter("plain",t))):(n=this.table.modules.export.generateExportList(this.table.options.clipboardCopyConfig,this.table.options.clipboardCopyStyled,this.rowRange,"clipboard"),i=this.table.modules.export.generateHTMLTable(n),t=i?this.generatePlainContent(n):"",this.table.options.clipboardCopyFormatter&&(t=this.table.options.clipboardCopyFormatter("plain",t),i=this.table.options.clipboardCopyFormatter("html",i))),window.clipboardData&&window.clipboardData.setData?window.clipboardData.setData("Text",t):e.clipboardData&&e.clipboardData.setData?(e.clipboardData.setData("text/plain",t),i&&e.clipboardData.setData("text/html",i)):e.originalEvent&&e.originalEvent.clipboardData.setData&&(e.originalEvent.clipboardData.setData("text/plain",t),i&&e.originalEvent.clipboardData.setData("text/html",i)),this.dispatchExternal("clipboardCopied",t,i),this.reset())}),(this.mode===!0||this.mode==="paste")&&this.table.element.addEventListener("paste",e=>{this.paste(e)}),this.setPasteParser(this.table.options.clipboardPasteParser),this.setPasteAction(this.table.options.clipboardPasteAction),this.registerTableFunction("copyToClipboard",this.copy.bind(this))}reset(){this.blocked=!0,this.customSelection=!1}generatePlainContent(e){var t=[];return e.forEach(i=>{var n=[];i.columns.forEach(s=>{var o="";if(s)if(i.type==="group"&&(s.value=s.component.getKey()),s.value===null)o="";else switch(typeof s.value){case"object":o=JSON.stringify(s.value);break;case"undefined":o="";break;default:o=s.value}n.push(o)}),t.push(n.join("	"))}),t.join(`
`)}copy(e,t){var i,n;this.blocked=!1,this.customSelection=!1,(this.mode===!0||this.mode==="copy")&&(this.rowRange=e||this.table.options.clipboardCopyRowRange,typeof window.getSelection<"u"&&typeof document.createRange<"u"?(e=document.createRange(),e.selectNodeContents(this.table.element),i=window.getSelection(),i.toString()&&t&&(this.customSelection=i.toString()),i.removeAllRanges(),i.addRange(e)):typeof document.selection<"u"&&typeof document.body.createTextRange<"u"&&(n=document.body.createTextRange(),n.moveToElementText(this.table.element),n.select()),document.execCommand("copy"),i&&i.removeAllRanges())}setPasteAction(e){switch(typeof e){case"string":this.pasteAction=Yn.pasteActions[e],this.pasteAction||console.warn("Clipboard Error - No such paste action found:",e);break;case"function":this.pasteAction=e;break}}setPasteParser(e){switch(typeof e){case"string":this.pasteParser=Yn.pasteParsers[e],this.pasteParser||console.warn("Clipboard Error - No such paste parser found:",e);break;case"function":this.pasteParser=e;break}}paste(e){var t,i,n;this.checkPasteOrigin(e)&&(t=this.getPasteData(e),i=this.pasteParser.call(this,t),i?(e.preventDefault(),this.table.modExists("mutator")&&(i=this.mutateData(i)),n=this.pasteAction.call(this,i),this.dispatchExternal("clipboardPasted",t,i,n)):this.dispatchExternal("clipboardPasteError",t))}mutateData(e){var t=[];return Array.isArray(e)?e.forEach(i=>{t.push(this.table.modules.mutator.transformRow(i,"clipboard"))}):t=e,t}checkPasteOrigin(e){var t=!0,i=this.confirm("clipboard-paste",[e]);return(i||!["DIV","SPAN"].includes(e.target.tagName))&&(t=!1),t}getPasteData(e){var t;return window.clipboardData&&window.clipboardData.getData?t=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData?t=e.clipboardData.getData("text/plain"):e.originalEvent&&e.originalEvent.clipboardData.getData&&(t=e.originalEvent.clipboardData.getData("text/plain")),t}};K(Yn,"moduleName","clipboard"),K(Yn,"moduleExtensions",RO),K(Yn,"pasteActions",EO),K(Yn,"pasteParsers",_O);let hc=Yn;class SO{constructor(e){return this._row=e,new Proxy(this,{get:function(t,i,n){return typeof t[i]<"u"?t[i]:t._row.table.componentFunctionBinder.handle("row",t._row,i)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getTable(){return this._row.table}getCells(){var e=[];return this._row.getCells().forEach(function(t){e.push(t.getComponent())}),e}getCell(e){var t=this._row.getCell(e);return t?t.getComponent():!1}_getSelf(){return this._row}}class bv{constructor(e){return this._cell=e,new Proxy(this,{get:function(t,i,n){return typeof t[i]<"u"?t[i]:t._cell.table.componentFunctionBinder.handle("cell",t._cell,i)}})}getValue(){return this._cell.getValue()}getOldValue(){return this._cell.getOldValue()}getInitialValue(){return this._cell.initialValue}getElement(){return this._cell.getElement()}getRow(){return this._cell.row.getComponent()}getData(e){return this._cell.row.getData(e)}getType(){return"cell"}getField(){return this._cell.column.getField()}getColumn(){return this._cell.column.getComponent()}setValue(e,t){typeof t>"u"&&(t=!0),this._cell.setValue(e,t)}restoreOldValue(){this._cell.setValueActual(this._cell.getOldValue())}restoreInitialValue(){this._cell.setValueActual(this._cell.initialValue)}checkHeight(){this._cell.checkHeight()}getTable(){return this._cell.table}_getSelf(){return this._cell}}class fa extends It{constructor(e,t){super(e.table),this.table=e.table,this.column=e,this.row=t,this.element=null,this.value=null,this.initialValue,this.oldValue=null,this.modules={},this.height=null,this.width=null,this.minWidth=null,this.component=null,this.loaded=!1,this.build()}build(){this.generateElement(),this.setWidth(),this._configureCell(),this.setValueActual(this.column.getFieldValue(this.row.data)),this.initialValue=this.value}generateElement(){this.element=document.createElement("div"),this.element.className="tabulator-cell",this.element.setAttribute("role","gridcell"),this.column.isRowHeader&&this.element.classList.add("tabulator-row-header")}_configureCell(){var e=this.element,t=this.column.getField(),i={top:"flex-start",bottom:"flex-end",middle:"center"},n={left:"flex-start",right:"flex-end",center:"center"};if(e.style.textAlign=this.column.hozAlign,this.column.vertAlign&&(e.style.display="inline-flex",e.style.alignItems=i[this.column.vertAlign]||"",this.column.hozAlign&&(e.style.justifyContent=n[this.column.hozAlign]||"")),t&&e.setAttribute("tabulator-field",t),this.column.definition.cssClass){var s=this.column.definition.cssClass.split(" ");s.forEach(o=>{e.classList.add(o)})}this.dispatch("cell-init",this),this.column.visible||this.hide()}_generateContents(){var e;switch(e=this.chain("cell-format",this,null,()=>this.element.innerHTML=this.value),typeof e){case"object":if(e instanceof Node){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(e)}else this.element.innerHTML="",e!=null&&console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",e);break;case"undefined":this.element.innerHTML="";break;default:this.element.innerHTML=e}}cellRendered(){this.dispatch("cell-rendered",this)}getElement(e){return this.loaded||(this.loaded=!0,e||this.layoutElement()),this.element}getValue(){return this.value}getOldValue(){return this.oldValue}setValue(e,t,i){var n=this.setValueProcessData(e,t,i);n&&(this.dispatch("cell-value-updated",this),this.cellRendered(),this.column.definition.cellEdited&&this.column.definition.cellEdited.call(this.table,this.getComponent()),this.dispatchExternal("cellEdited",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()))}setValueProcessData(e,t,i){var n=!1;return(this.value!==e||i)&&(n=!0,t&&(e=this.chain("cell-value-changing",[this,e],null,e))),this.setValueActual(e),n&&this.dispatch("cell-value-changed",this),n}setValueActual(e){this.oldValue=this.value,this.value=e,this.dispatch("cell-value-save-before",this),this.column.setFieldValue(this.row.data,e),this.dispatch("cell-value-save-after",this),this.loaded&&this.layoutElement()}layoutElement(){this._generateContents(),this.dispatch("cell-layout",this)}setWidth(){this.width=this.column.width,this.element.style.width=this.column.widthStyled}clearWidth(){this.width="",this.element.style.width=""}getWidth(){return this.width||this.element.offsetWidth}setMinWidth(){this.minWidth=this.column.minWidth,this.element.style.minWidth=this.column.minWidthStyled}setMaxWidth(){this.maxWidth=this.column.maxWidth,this.element.style.maxWidth=this.column.maxWidthStyled}checkHeight(){this.row.reinitializeHeight()}clearHeight(){this.element.style.height="",this.height=null,this.dispatch("cell-height",this,"")}setHeight(){this.height=this.row.height,this.element.style.height=this.row.heightStyled,this.dispatch("cell-height",this,this.row.heightStyled)}getHeight(){return this.height||this.element.offsetHeight}show(){this.element.style.display=this.column.vertAlign?"inline-flex":""}hide(){this.element.style.display="none"}delete(){this.dispatch("cell-delete",this),!this.table.rowManager.redrawBlock&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.column.deleteCell(this),this.row.deleteCell(this),this.calcs={}}getIndex(){return this.row.getCellIndex(this)}getComponent(){return this.component||(this.component=new bv(this)),this.component}}class yv{constructor(e){return this._column=e,this.type="ColumnComponent",new Proxy(this,{get:function(t,i,n){return typeof t[i]<"u"?t[i]:t._column.table.componentFunctionBinder.handle("column",t._column,i)}})}getElement(){return this._column.getElement()}getDefinition(){return this._column.getDefinition()}getField(){return this._column.getField()}getTitleDownload(){return this._column.getTitleDownload()}getCells(){var e=[];return this._column.cells.forEach(function(t){e.push(t.getComponent())}),e}isVisible(){return this._column.visible}show(){this._column.isGroup?this._column.columns.forEach(function(e){e.show()}):this._column.show()}hide(){this._column.isGroup?this._column.columns.forEach(function(e){e.hide()}):this._column.hide()}toggle(){this._column.visible?this.hide():this.show()}delete(){return this._column.delete()}getSubColumns(){var e=[];return this._column.columns.length&&this._column.columns.forEach(function(t){e.push(t.getComponent())}),e}getParentColumn(){return this._column.getParentComponent()}_getSelf(){return this._column}scrollTo(e,t){return this._column.table.columnManager.scrollToColumn(this._column,e,t)}getTable(){return this._column.table}move(e,t){var i=this._column.table.columnManager.findColumn(e);i?this._column.table.columnManager.moveColumn(this._column,i,t):console.warn("Move Error - No matching column found:",i)}getNextColumn(){var e=this._column.nextColumn();return e?e.getComponent():!1}getPrevColumn(){var e=this._column.prevColumn();return e?e.getComponent():!1}updateDefinition(e){return this._column.updateDefinition(e)}getWidth(){return this._column.getWidth()}setWidth(e){var t;return e===!0?t=this._column.reinitializeWidth(!0):t=this._column.setWidth(e),this._column.table.columnManager.rerenderColumns(!0),t}}var vv={title:void 0,field:void 0,columns:void 0,visible:void 0,hozAlign:void 0,vertAlign:void 0,width:void 0,minWidth:40,maxWidth:void 0,maxInitialWidth:void 0,cssClass:void 0,variableHeight:void 0,headerVertical:void 0,headerHozAlign:void 0,headerWordWrap:!1,editableTitle:void 0};const Er=class Er extends It{constructor(e,t,i){super(t.table),this.definition=e,this.parent=t,this.type="column",this.columns=[],this.cells=[],this.isGroup=!1,this.isRowHeader=i,this.element=this.createElement(),this.contentElement=!1,this.titleHolderElement=!1,this.titleElement=!1,this.groupElement=this.createGroupElement(),this.hozAlign="",this.vertAlign="",this.field="",this.fieldStructure="",this.getFieldValue="",this.setFieldValue="",this.titleDownload=null,this.titleFormatterRendered=!1,this.mapDefinitions(),this.setField(this.definition.field),this.modules={},this.width=null,this.widthStyled="",this.maxWidth=null,this.maxWidthStyled="",this.maxInitialWidth=null,this.minWidth=null,this.minWidthStyled="",this.widthFixed=!1,this.visible=!0,this.component=null,this.definition.columns?(this.isGroup=!0,this.definition.columns.forEach((n,s)=>{var o=new Er(n,this);this.attachColumn(o)}),this.checkColumnVisibility()):t.registerColumnField(this),this._initialize()}createElement(){var e=document.createElement("div");switch(e.classList.add("tabulator-col"),e.setAttribute("role","columnheader"),e.setAttribute("aria-sort","none"),this.isRowHeader&&e.classList.add("tabulator-row-header"),this.table.options.columnHeaderVertAlign){case"middle":e.style.justifyContent="center";break;case"bottom":e.style.justifyContent="flex-end";break}return e}createGroupElement(){var e=document.createElement("div");return e.classList.add("tabulator-col-group-cols"),e}mapDefinitions(){var e=this.table.options.columnDefaults;if(e)for(let t in e)typeof this.definition[t]>"u"&&(this.definition[t]=e[t]);this.definition=this.table.columnManager.optionsList.generate(Er.defaultOptionList,this.definition)}checkDefinition(){Object.keys(this.definition).forEach(e=>{Er.defaultOptionList.indexOf(e)===-1&&console.warn("Invalid column definition option in '"+(this.field||this.definition.title)+"' column:",e)})}setField(e){this.field=e,this.fieldStructure=e?this.table.options.nestedFieldSeparator?e.split(this.table.options.nestedFieldSeparator):[e]:[],this.getFieldValue=this.fieldStructure.length>1?this._getNestedData:this._getFlatData,this.setFieldValue=this.fieldStructure.length>1?this._setNestedData:this._setFlatData}registerColumnPosition(e){this.parent.registerColumnPosition(e)}registerColumnField(e){this.parent.registerColumnField(e)}reRegisterPosition(){this.isGroup?this.columns.forEach(function(e){e.reRegisterPosition()}):this.registerColumnPosition(this)}_initialize(){for(var e=this.definition;this.element.firstChild;)this.element.removeChild(this.element.firstChild);e.headerVertical&&(this.element.classList.add("tabulator-col-vertical"),e.headerVertical==="flip"&&this.element.classList.add("tabulator-col-vertical-flip")),this.contentElement=this._buildColumnHeaderContent(),this.element.appendChild(this.contentElement),this.isGroup?this._buildGroupHeader():this._buildColumnHeader(),this.dispatch("column-init",this)}_buildColumnHeader(){var e=this.definition;if(this.dispatch("column-layout",this),typeof e.visible<"u"&&(e.visible?this.show(!0):this.hide(!0)),e.cssClass){var t=e.cssClass.split(" ");t.forEach(i=>{this.element.classList.add(i)})}e.field&&this.element.setAttribute("tabulator-field",e.field),this.setMinWidth(parseInt(e.minWidth)),e.maxInitialWidth&&(this.maxInitialWidth=parseInt(e.maxInitialWidth)),e.maxWidth&&this.setMaxWidth(parseInt(e.maxWidth)),this.reinitializeWidth(),this.hozAlign=this.definition.hozAlign,this.vertAlign=this.definition.vertAlign,this.titleElement.style.textAlign=this.definition.headerHozAlign}_buildColumnHeaderContent(){var e=document.createElement("div");return e.classList.add("tabulator-col-content"),this.titleHolderElement=document.createElement("div"),this.titleHolderElement.classList.add("tabulator-col-title-holder"),e.appendChild(this.titleHolderElement),this.titleElement=this._buildColumnHeaderTitle(),this.titleHolderElement.appendChild(this.titleElement),e}_buildColumnHeaderTitle(){var e=this.definition,t=document.createElement("div");if(t.classList.add("tabulator-col-title"),e.headerWordWrap&&t.classList.add("tabulator-col-title-wrap"),e.editableTitle){var i=document.createElement("input");i.classList.add("tabulator-title-editor"),i.addEventListener("click",n=>{n.stopPropagation(),i.focus()}),i.addEventListener("mousedown",n=>{n.stopPropagation()}),i.addEventListener("change",()=>{e.title=i.value,this.dispatchExternal("columnTitleChanged",this.getComponent())}),t.appendChild(i),e.field?this.langBind("columns|"+e.field,n=>{i.value=n||e.title||"&nbsp;"}):i.value=e.title||"&nbsp;"}else e.field?this.langBind("columns|"+e.field,n=>{this._formatColumnHeaderTitle(t,n||e.title||"&nbsp;")}):this._formatColumnHeaderTitle(t,e.title||"&nbsp;");return t}_formatColumnHeaderTitle(e,t){var i=this.chain("column-format",[this,t,e],null,()=>t);switch(typeof i){case"object":i instanceof Node?e.appendChild(i):(e.innerHTML="",console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",i));break;case"undefined":e.innerHTML="";break;default:e.innerHTML=i}}_buildGroupHeader(){if(this.element.classList.add("tabulator-col-group"),this.element.setAttribute("role","columngroup"),this.element.setAttribute("aria-title",this.definition.title),this.definition.cssClass){var e=this.definition.cssClass.split(" ");e.forEach(t=>{this.element.classList.add(t)})}this.titleElement.style.textAlign=this.definition.headerHozAlign,this.element.appendChild(this.groupElement)}_getFlatData(e){return e[this.field]}_getNestedData(e){var t=e,i=this.fieldStructure,n=i.length,s;for(let o=0;o<n&&(t=t[i[o]],s=t,!!t);o++);return s}_setFlatData(e,t){this.field&&(e[this.field]=t)}_setNestedData(e,t){var i=e,n=this.fieldStructure,s=n.length;for(let o=0;o<s;o++)if(o==s-1)i[n[o]]=t;else{if(!i[n[o]])if(typeof t<"u")i[n[o]]={};else break;i=i[n[o]]}}attachColumn(e){this.groupElement?(this.columns.push(e),this.groupElement.appendChild(e.getElement()),e.columnRendered()):console.warn("Column Warning - Column being attached to another column instead of column group")}verticalAlign(e,t){var i=this.parent.isGroup?this.parent.getGroupElement().clientHeight:t||this.parent.getHeadersElement().clientHeight;this.element.style.height=i+"px",this.dispatch("column-height",this,this.element.style.height),this.isGroup&&(this.groupElement.style.minHeight=i-this.contentElement.offsetHeight+"px"),this.columns.forEach(function(n){n.verticalAlign(e)})}clearVerticalAlign(){this.element.style.paddingTop="",this.element.style.height="",this.element.style.minHeight="",this.groupElement.style.minHeight="",this.columns.forEach(function(e){e.clearVerticalAlign()}),this.dispatch("column-height",this,"")}getElement(){return this.element}getGroupElement(){return this.groupElement}getField(){return this.field}getTitleDownload(){return this.titleDownload}getFirstColumn(){return this.isGroup?this.columns.length?this.columns[0].getFirstColumn():!1:this}getLastColumn(){return this.isGroup?this.columns.length?this.columns[this.columns.length-1].getLastColumn():!1:this}getColumns(e){var t=[];return e?this.columns.forEach(i=>{t.push(i),t=t.concat(i.getColumns(!0))}):t=this.columns,t}getCells(){return this.cells}getTopColumn(){return this.parent.isGroup?this.parent.getTopColumn():this}getDefinition(e){var t=[];return this.isGroup&&e&&(this.columns.forEach(function(i){t.push(i.getDefinition(!0))}),this.definition.columns=t),this.definition}checkColumnVisibility(){var e=!1;this.columns.forEach(function(t){t.visible&&(e=!0)}),e?(this.show(),this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1)):this.hide()}show(e,t){this.visible||(this.visible=!0,this.element.style.display="",this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(i){i.show()}),!this.isGroup&&this.width===null&&this.reinitializeWidth(),this.table.columnManager.verticalAlignHeaders(),this.dispatch("column-show",this,t),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!0),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}hide(e,t){this.visible&&(this.visible=!1,this.element.style.display="none",this.table.columnManager.verticalAlignHeaders(),this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(i){i.hide()}),this.dispatch("column-hide",this,t),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}matchChildWidths(){var e=0;this.contentElement&&this.columns.length&&(this.columns.forEach(function(t){t.visible&&(e+=t.getWidth())}),this.contentElement.style.maxWidth=e-1+"px",this.table.initialized&&(this.element.style.width=e+"px"),this.parent.isGroup&&this.parent.matchChildWidths())}removeChild(e){var t=this.columns.indexOf(e);t>-1&&this.columns.splice(t,1),this.columns.length||this.delete()}setWidth(e){this.widthFixed=!0,this.setWidthActual(e)}setWidthActual(e){isNaN(e)&&(e=Math.floor(this.table.element.clientWidth/100*parseInt(e))),e=Math.max(this.minWidth,e),this.maxWidth&&(e=Math.min(this.maxWidth,e)),this.width=e,this.widthStyled=e?e+"px":"",this.element.style.width=this.widthStyled,this.isGroup||this.cells.forEach(function(t){t.setWidth()}),this.parent.isGroup&&this.parent.matchChildWidths(),this.dispatch("column-width",this),this.subscribedExternal("columnWidth")&&this.dispatchExternal("columnWidth",this.getComponent())}checkCellHeights(){var e=[];this.cells.forEach(function(t){t.row.heightInitialized&&(t.row.getElement().offsetParent!==null?(e.push(t.row),t.row.clearCellHeight()):t.row.heightInitialized=!1)}),e.forEach(function(t){t.calcHeight()}),e.forEach(function(t){t.setCellHeight()})}getWidth(){var e=0;return this.isGroup?this.columns.forEach(function(t){t.visible&&(e+=t.getWidth())}):e=this.width,e}getLeftOffset(){var e=this.element.offsetLeft;return this.parent.isGroup&&(e+=this.parent.getLeftOffset()),e}getHeight(){return Math.ceil(this.element.getBoundingClientRect().height)}setMinWidth(e){this.maxWidth&&e>this.maxWidth&&(e=this.maxWidth,console.warn("the minWidth ("+e+"px) for column '"+this.field+"' cannot be bigger that its maxWidth ("+this.maxWidthStyled+")")),this.minWidth=e,this.minWidthStyled=e?e+"px":"",this.element.style.minWidth=this.minWidthStyled,this.cells.forEach(function(t){t.setMinWidth()})}setMaxWidth(e){this.minWidth&&e<this.minWidth&&(e=this.minWidth,console.warn("the maxWidth ("+e+"px) for column '"+this.field+"' cannot be smaller that its minWidth ("+this.minWidthStyled+")")),this.maxWidth=e,this.maxWidthStyled=e?e+"px":"",this.element.style.maxWidth=this.maxWidthStyled,this.cells.forEach(function(t){t.setMaxWidth()})}delete(){return new Promise((e,t)=>{this.isGroup&&this.columns.forEach(function(n){n.delete()}),this.dispatch("column-delete",this);var i=this.cells.length;for(let n=0;n<i;n++)this.cells[0].delete();this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.contentElement=!1,this.titleElement=!1,this.groupElement=!1,this.parent.isGroup&&this.parent.removeChild(this),this.table.columnManager.deregisterColumn(this),this.table.columnManager.rerenderColumns(!0),this.dispatch("column-deleted",this),e()})}columnRendered(){this.titleFormatterRendered&&this.titleFormatterRendered(),this.dispatch("column-rendered",this)}generateCell(e){var t=new fa(this,e);return this.cells.push(t),t}nextColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._nextVisibleColumn(e+1):!1}_nextVisibleColumn(e){var t=this.table.columnManager.getColumnByIndex(e);return!t||t.visible?t:this._nextVisibleColumn(e+1)}prevColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._prevVisibleColumn(e-1):!1}_prevVisibleColumn(e){var t=this.table.columnManager.getColumnByIndex(e);return!t||t.visible?t:this._prevVisibleColumn(e-1)}reinitializeWidth(e){this.widthFixed=!1,typeof this.definition.width<"u"&&!e&&this.setWidth(this.definition.width),this.dispatch("column-width-fit-before",this),this.fitToData(e),this.dispatch("column-width-fit-after",this)}fitToData(e){if(!this.isGroup){this.widthFixed||(this.element.style.width="",this.cells.forEach(n=>{n.clearWidth()}));var t=this.element.offsetWidth;if((!this.width||!this.widthFixed)&&(this.cells.forEach(n=>{var s=n.getWidth();s>t&&(t=s)}),t)){var i=t+1;this.maxInitialWidth&&!e&&(i=Math.min(i,this.maxInitialWidth)),this.setWidthActual(i)}}}updateDefinition(e){var t;return this.isGroup||this.parent.isGroup?(console.error("Column Update Error - The updateDefinition function is only available on ungrouped columns"),Promise.reject("Column Update Error - The updateDefinition function is only available on columns, not column groups")):(t=Object.assign({},this.getDefinition()),t=Object.assign(t,e),this.table.columnManager.addColumn(t,!1,this).then(i=>(t.field==this.field&&(this.field=!1),this.delete().then(()=>i.getComponent()))))}deleteCell(e){var t=this.cells.indexOf(e);t>-1&&this.cells.splice(t,1)}getComponent(){return this.component||(this.component=new yv(this)),this.component}getPosition(){return this.table.columnManager.getVisibleColumnsByIndex().indexOf(this)+1}getParentComponent(){return this.parent instanceof Er?this.parent.getComponent():!1}};K(Er,"defaultOptionList",vv);let Or=Er;class Eh{constructor(e){return this._row=e,new Proxy(this,{get:function(t,i,n){return typeof t[i]<"u"?t[i]:t._row.table.componentFunctionBinder.handle("row",t._row,i)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getCells(){var e=[];return this._row.getCells().forEach(function(t){e.push(t.getComponent())}),e}getCell(e){var t=this._row.getCell(e);return t?t.getComponent():!1}getIndex(){return this._row.getData("data")[this._row.table.options.index]}getPosition(){return this._row.getPosition()}watchPosition(e){return this._row.watchPosition(e)}delete(){return this._row.delete()}scrollTo(e,t){return this._row.table.rowManager.scrollToRow(this._row,e,t)}move(e,t){this._row.moveToRow(e,t)}update(e){return this._row.updateData(e)}normalizeHeight(){this._row.normalizeHeight(!0)}_getSelf(){return this._row}reformat(){return this._row.reinitialize()}getTable(){return this._row.table}getNextRow(){var e=this._row.nextRow();return e&&e.getComponent()}getPrevRow(){var e=this._row.prevRow();return e&&e.getComponent()}}class kt extends It{constructor(e,t,i="row"){super(t.table),this.parent=t,this.data={},this.type=i,this.element=!1,this.modules={},this.cells=[],this.height=0,this.heightStyled="",this.manualHeight=!1,this.outerHeight=0,this.initialized=!1,this.heightInitialized=!1,this.position=0,this.positionWatchers=[],this.component=null,this.created=!1,this.setData(e)}create(){this.created||(this.created=!0,this.generateElement())}createElement(){var e=document.createElement("div");e.classList.add("tabulator-row"),e.setAttribute("role","row"),this.element=e}getElement(){return this.create(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}generateElement(){this.createElement(),this.dispatch("row-init",this)}generateCells(){this.cells=this.table.columnManager.generateCells(this)}initialize(e,t){if(this.create(),!this.initialized||e){for(this.deleteCells();this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.dispatch("row-layout-before",this),this.generateCells(),this.initialized=!0,this.table.columnManager.renderer.renderRowCells(this,t),e&&this.normalizeHeight(),this.dispatch("row-layout",this),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent()),this.dispatch("row-layout-after",this)}else this.table.columnManager.renderer.rerenderRowCells(this,t)}rendered(){this.cells.forEach(e=>{e.cellRendered()})}reinitializeHeight(){this.heightInitialized=!1,this.element&&this.element.offsetParent!==null&&this.normalizeHeight(!0)}deinitialize(){this.initialized=!1}deinitializeHeight(){this.heightInitialized=!1}reinitialize(e){this.initialized=!1,this.heightInitialized=!1,this.manualHeight||(this.height=0,this.heightStyled=""),this.element&&this.element.offsetParent!==null&&this.initialize(!0),this.dispatch("row-relayout",this)}calcHeight(e){var t=0,i=0;this.table.options.rowHeight?this.height=this.table.options.rowHeight:(i=this.calcMinHeight(),t=this.calcMaxHeight(),e?this.height=Math.max(t,i):this.height=this.manualHeight?this.height:Math.max(t,i)),this.heightStyled=this.height?this.height+"px":"",this.outerHeight=this.element.offsetHeight}calcMinHeight(){return this.table.options.resizableRows?this.element.clientHeight:0}calcMaxHeight(){var e=0;return this.cells.forEach(function(t){var i=t.getHeight();i>e&&(e=i)}),e}setCellHeight(){this.cells.forEach(function(e){e.setHeight()}),this.heightInitialized=!0}clearCellHeight(){this.cells.forEach(function(e){e.clearHeight()})}normalizeHeight(e){e&&!this.table.options.rowHeight&&this.clearCellHeight(),this.calcHeight(e),this.setCellHeight()}setHeight(e,t){(this.height!=e||t)&&(this.manualHeight=!0,this.height=e,this.heightStyled=e?e+"px":"",this.setCellHeight(),this.outerHeight=this.element.offsetHeight,this.subscribedExternal("rowHeight")&&this.dispatchExternal("rowHeight",this.getComponent()))}getHeight(){return this.outerHeight}getWidth(){return this.element.offsetWidth}deleteCell(e){var t=this.cells.indexOf(e);t>-1&&this.cells.splice(t,1)}setData(e){this.data=this.chain("row-data-init-before",[this,e],void 0,e),this.dispatch("row-data-init-after",this)}updateData(e){var t=this.element&&Ze.elVisible(this.element),i={},n;return new Promise((s,o)=>{typeof e=="string"&&(e=JSON.parse(e)),this.dispatch("row-data-save-before",this),this.subscribed("row-data-changing")&&(i=Object.assign(i,this.data),i=Object.assign(i,e)),n=this.chain("row-data-changing",[this,i,e],null,e);for(let a in n)this.data[a]=n[a];this.dispatch("row-data-save-after",this);for(let a in e)this.table.columnManager.getColumnsByFieldRoot(a).forEach(h=>{let u=this.getCell(h.getField());if(u){let c=h.getFieldValue(n);u.getValue()!==c&&(u.setValueProcessData(c),t&&u.cellRendered())}});t?(this.normalizeHeight(!0),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent())):(this.initialized=!1,this.height=0,this.heightStyled=""),this.dispatch("row-data-changed",this,t,e),this.dispatchExternal("rowUpdated",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),s()})}getData(e){return e?this.chain("row-data-retrieve",[this,e],null,this.data):this.data}getCell(e){var t=!1;return e=this.table.columnManager.findColumn(e),!this.initialized&&this.cells.length===0&&this.generateCells(),t=this.cells.find(function(i){return i.column===e}),t}getCellIndex(e){return this.cells.findIndex(function(t){return t===e})}findCell(e){return this.cells.find(t=>t.element===e)}getCells(){return!this.initialized&&this.cells.length===0&&this.generateCells(),this.cells}nextRow(){var e=this.table.rowManager.nextDisplayRow(this,!0);return e||!1}prevRow(){var e=this.table.rowManager.prevDisplayRow(this,!0);return e||!1}moveToRow(e,t){var i=this.table.rowManager.findRow(e);i?(this.table.rowManager.moveRowActual(this,i,!t),this.table.rowManager.refreshActiveData("display",!1,!0)):console.warn("Move Error - No matching row found:",e)}delete(){return this.dispatch("row-delete",this),this.deleteActual(),Promise.resolve()}deleteActual(e){this.detachModules(),this.table.rowManager.deleteRow(this,e),this.deleteCells(),this.initialized=!1,this.heightInitialized=!1,this.element=!1,this.dispatch("row-deleted",this)}detachModules(){this.dispatch("row-deleting",this)}deleteCells(){var e=this.cells.length;for(let t=0;t<e;t++)this.cells[0].delete()}wipe(){if(this.detachModules(),this.deleteCells(),this.element){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.parentNode&&this.element.parentNode.removeChild(this.element)}this.element=!1,this.modules={}}isDisplayed(){return this.table.rowManager.getDisplayRows().includes(this)}getPosition(){return this.isDisplayed()?this.position:!1}setPosition(e){e!=this.position&&(this.position=e,this.positionWatchers.forEach(t=>{t(this.position)}))}watchPosition(e){this.positionWatchers.push(e),e(this.position)}getGroup(){return this.modules.group||!1}getComponent(){return this.component||(this.component=new Eh(this)),this.component}}var TO={avg:function(r,e,t){var i=0,n=typeof t.precision<"u"?t.precision:2;return r.length&&(i=r.reduce(function(s,o){return Number(s)+Number(o)}),i=i/r.length,i=n!==!1?i.toFixed(n):i),parseFloat(i).toString()},max:function(r,e,t){var i=null,n=typeof t.precision<"u"?t.precision:!1;return r.forEach(function(s){s=Number(s),(s>i||i===null)&&(i=s)}),i!==null?n!==!1?i.toFixed(n):i:""},min:function(r,e,t){var i=null,n=typeof t.precision<"u"?t.precision:!1;return r.forEach(function(s){s=Number(s),(s<i||i===null)&&(i=s)}),i!==null?n!==!1?i.toFixed(n):i:""},sum:function(r,e,t){var i=0,n=typeof t.precision<"u"?t.precision:!1;return r.length&&r.forEach(function(s){s=Number(s),i+=isNaN(s)?0:Number(s)}),n!==!1?i.toFixed(n):i},concat:function(r,e,t){var i=0;return r.length&&(i=r.reduce(function(n,s){return String(n)+String(s)})),i},count:function(r,e,t){var i=0;return r.length&&r.forEach(function(n){n&&i++}),i},unique:function(r,e,t){var i=r.filter((n,s)=>(r||n===0)&&r.indexOf(n)===s);return i.length}};const jn=class jn extends Le{constructor(e){super(e),this.topCalcs=[],this.botCalcs=[],this.genColumn=!1,this.topElement=this.createElement(),this.botElement=this.createElement(),this.topRow=!1,this.botRow=!1,this.topInitialized=!1,this.botInitialized=!1,this.blocked=!1,this.recalcAfterBlock=!1,this.registerTableOption("columnCalcs",!0),this.registerColumnOption("topCalc"),this.registerColumnOption("topCalcParams"),this.registerColumnOption("topCalcFormatter"),this.registerColumnOption("topCalcFormatterParams"),this.registerColumnOption("bottomCalc"),this.registerColumnOption("bottomCalcParams"),this.registerColumnOption("bottomCalcFormatter"),this.registerColumnOption("bottomCalcFormatterParams")}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-calcs-holder"),e}initialize(){this.genColumn=new Or({field:"value"},this),this.subscribe("cell-value-changed",this.cellValueChanged.bind(this)),this.subscribe("column-init",this.initializeColumnCheck.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("column-moved",this.recalcActiveRows.bind(this)),this.subscribe("column-add",this.recalcActiveRows.bind(this)),this.subscribe("data-refreshed",this.recalcActiveRowsRefresh.bind(this)),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this)),this.subscribe("redraw-blocked",this.blockRedraw.bind(this)),this.subscribe("redraw-restored",this.restoreRedraw.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this)),this.registerTableFunction("getCalcResults",this.getResults.bind(this)),this.registerTableFunction("recalc",this.userRecalc.bind(this)),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}tableRedraw(e){this.recalc(this.table.rowManager.activeRows),e&&this.redraw()}blockRedraw(){this.blocked=!0,this.recalcAfterBlock=!1}restoreRedraw(){this.blocked=!1,this.recalcAfterBlock&&(this.recalcAfterBlock=!1,this.recalcActiveRowsRefresh())}userRecalc(){this.recalc(this.table.rowManager.activeRows)}blockCheck(){return this.blocked&&(this.recalcAfterBlock=!0),this.blocked}visibleRows(e,t){return this.topRow&&t.unshift(this.topRow),this.botRow&&t.push(this.botRow),t}rowsUpdated(e){this.table.options.groupBy?this.recalcRowGroup(e):this.recalcActiveRows()}recalcActiveRowsRefresh(){this.table.options.groupBy&&this.table.options.dataTreeStartExpanded&&this.table.options.dataTree?this.recalcAll():this.recalcActiveRows()}recalcActiveRows(){this.recalc(this.table.rowManager.activeRows)}cellValueChanged(e){(e.column.definition.topCalc||e.column.definition.bottomCalc)&&(this.table.options.groupBy?((this.table.options.columnCalcs=="table"||this.table.options.columnCalcs=="both")&&this.recalcActiveRows(),this.table.options.columnCalcs!="table"&&this.recalcRowGroup(e.row)):this.recalcActiveRows())}initializeColumnCheck(e){(e.definition.topCalc||e.definition.bottomCalc)&&this.initializeColumn(e)}initializeColumn(e){var t=e.definition,i={topCalcParams:t.topCalcParams||{},botCalcParams:t.bottomCalcParams||{}};if(t.topCalc){switch(typeof t.topCalc){case"string":jn.calculations[t.topCalc]?i.topCalc=jn.calculations[t.topCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",t.topCalc);break;case"function":i.topCalc=t.topCalc;break}i.topCalc&&(e.modules.columnCalcs=i,this.topCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeTopRow())}if(t.bottomCalc){switch(typeof t.bottomCalc){case"string":jn.calculations[t.bottomCalc]?i.botCalc=jn.calculations[t.bottomCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",t.bottomCalc);break;case"function":i.botCalc=t.bottomCalc;break}i.botCalc&&(e.modules.columnCalcs=i,this.botCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeBottomRow())}}registerColumnField(){}removeCalcs(){var e=!1;this.topInitialized&&(this.topInitialized=!1,this.topElement.parentNode.removeChild(this.topElement),e=!0),this.botInitialized&&(this.botInitialized=!1,this.footerRemove(this.botElement),e=!0),e&&this.table.rowManager.adjustTableSize()}reinitializeCalcs(){this.topCalcs.length&&this.initializeTopRow(),this.botCalcs.length&&this.initializeBottomRow()}initializeTopRow(){var e=document.createDocumentFragment();this.topInitialized||(e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.topInitialized=!0)}initializeBottomRow(){this.botInitialized||(this.footerPrepend(this.botElement),this.botInitialized=!0)}scrollHorizontal(e){this.botInitialized&&this.botRow&&(this.botElement.scrollLeft=e)}recalc(e){var t,i;if(!this.blockCheck()&&(this.topInitialized||this.botInitialized)){if(t=this.rowsToData(e),this.topInitialized){for(this.topRow&&this.topRow.deleteCells(),i=this.generateRow("top",t),this.topRow=i;this.topElement.firstChild;)this.topElement.removeChild(this.topElement.firstChild);this.topElement.appendChild(i.getElement()),i.initialize(!0)}if(this.botInitialized){for(this.botRow&&this.botRow.deleteCells(),i=this.generateRow("bottom",t),this.botRow=i;this.botElement.firstChild;)this.botElement.removeChild(this.botElement.firstChild);this.botElement.appendChild(i.getElement()),i.initialize(!0)}this.table.rowManager.adjustTableSize(),this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layout()}}recalcRowGroup(e){this.recalcGroup(this.table.modules.groupRows.getRowGroup(e))}recalcAll(){if((this.topCalcs.length||this.botCalcs.length)&&(this.table.options.columnCalcs!=="group"&&this.recalcActiveRows(),this.table.options.groupBy&&this.table.options.columnCalcs!=="table")){var e=this.table.modules.groupRows.getChildGroups();e.forEach(t=>{this.recalcGroup(t)})}}recalcGroup(e){var t,i;this.blockCheck()||e&&e.calcs&&(e.calcs.bottom&&(t=this.rowsToData(e.rows),i=this.generateRowData("bottom",t),e.calcs.bottom.updateData(i),e.calcs.bottom.reinitialize()),e.calcs.top&&(t=this.rowsToData(e.rows),i=this.generateRowData("top",t),e.calcs.top.updateData(i),e.calcs.top.reinitialize()))}generateTopRow(e){return this.generateRow("top",this.rowsToData(e))}generateBottomRow(e){return this.generateRow("bottom",this.rowsToData(e))}rowsToData(e){var t=[],i=this.table.options.dataTree&&this.table.options.dataTreeChildColumnCalcs,n=this.table.modules.dataTree;return e.forEach(s=>{var o;t.push(s.getData()),i&&((o=s.modules.dataTree)!=null&&o.open)&&this.rowsToData(n.getFilteredTreeChildren(s)).forEach(a=>{t.push(s)})}),t}generateRow(e,t){var i=this.generateRowData(e,t),n;return this.table.modExists("mutator")&&this.table.modules.mutator.disable(),n=new kt(i,this,"calc"),this.table.modExists("mutator")&&this.table.modules.mutator.enable(),n.getElement().classList.add("tabulator-calcs","tabulator-calcs-"+e),n.component=!1,n.getComponent=()=>(n.component||(n.component=new SO(n)),n.component),n.generateCells=()=>{var s=[];this.table.columnManager.columnsByIndex.forEach(o=>{this.genColumn.setField(o.getField()),this.genColumn.hozAlign=o.hozAlign,o.definition[e+"CalcFormatter"]&&this.table.modExists("format")?this.genColumn.modules.format={formatter:this.table.modules.format.getFormatter(o.definition[e+"CalcFormatter"]),params:o.definition[e+"CalcFormatterParams"]||{}}:this.genColumn.modules.format={formatter:this.table.modules.format.getFormatter("plaintext"),params:{}},this.genColumn.definition.cssClass=o.definition.cssClass;var a=new fa(this.genColumn,n);a.getElement(),a.column=o,a.setWidth(),o.cells.push(a),s.push(a),o.visible||a.hide()}),n.cells=s},n}generateRowData(e,t){var i={},n=e=="top"?this.topCalcs:this.botCalcs,s=e=="top"?"topCalc":"botCalc",o,a;return n.forEach(function(l){var h=[];l.modules.columnCalcs&&l.modules.columnCalcs[s]&&(t.forEach(function(u){h.push(l.getFieldValue(u))}),a=s+"Params",o=typeof l.modules.columnCalcs[a]=="function"?l.modules.columnCalcs[a](h,t):l.modules.columnCalcs[a],l.setFieldValue(i,l.modules.columnCalcs[s](h,t,o)))}),i}hasTopCalcs(){return!!this.topCalcs.length}hasBottomCalcs(){return!!this.botCalcs.length}redraw(){this.topRow&&this.topRow.normalizeHeight(!0),this.botRow&&this.botRow.normalizeHeight(!0)}getResults(){var e={},t;return this.table.options.groupBy&&this.table.modExists("groupRows")?(t=this.table.modules.groupRows.getGroups(!0),t.forEach(i=>{e[i.getKey()]=this.getGroupResults(i)})):e={top:this.topRow?this.topRow.getData():{},bottom:this.botRow?this.botRow.getData():{}},e}getGroupResults(e){var t=e._getSelf(),i=e.getSubGroups(),n={},s={};return i.forEach(o=>{n[o.getKey()]=this.getGroupResults(o)}),s={top:t.calcs.top?t.calcs.top.getData():{},bottom:t.calcs.bottom?t.calcs.bottom.getData():{},groups:n},s}adjustForScrollbar(e){this.botRow&&(this.table.rtl?this.botElement.style.paddingLeft=e+"px":this.botElement.style.paddingRight=e+"px")}};K(jn,"moduleName","columnCalcs"),K(jn,"calculations",TO);let uc=jn;class wv extends Le{constructor(e){super(e),this.indent=10,this.field="",this.collapseEl=null,this.expandEl=null,this.branchEl=null,this.elementField=!1,this.startOpen=function(){},this.registerTableOption("dataTree",!1),this.registerTableOption("dataTreeFilter",!0),this.registerTableOption("dataTreeSort",!0),this.registerTableOption("dataTreeElementColumn",!1),this.registerTableOption("dataTreeBranchElement",!0),this.registerTableOption("dataTreeChildIndent",9),this.registerTableOption("dataTreeChildField","_children"),this.registerTableOption("dataTreeCollapseElement",!1),this.registerTableOption("dataTreeExpandElement",!1),this.registerTableOption("dataTreeStartExpanded",!1),this.registerTableOption("dataTreeChildColumnCalcs",!1),this.registerTableOption("dataTreeSelectPropagate",!1),this.registerComponentFunction("row","treeCollapse",this.collapseRow.bind(this)),this.registerComponentFunction("row","treeExpand",this.expandRow.bind(this)),this.registerComponentFunction("row","treeToggle",this.toggleRow.bind(this)),this.registerComponentFunction("row","getTreeParent",this.getTreeParent.bind(this)),this.registerComponentFunction("row","getTreeChildren",this.getRowChildren.bind(this)),this.registerComponentFunction("row","addTreeChild",this.addTreeChildRow.bind(this)),this.registerComponentFunction("row","isTreeExpanded",this.isRowExpanded.bind(this))}initialize(){if(this.table.options.dataTree){var e=null,t=this.table.options;switch(this.field=t.dataTreeChildField,this.indent=t.dataTreeChildIndent,this.options("movableRows")&&console.warn("The movableRows option is not available with dataTree enabled, moving of child rows could result in unpredictable behavior"),t.dataTreeBranchElement?t.dataTreeBranchElement===!0?(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch")):typeof t.dataTreeBranchElement=="string"?(e=document.createElement("div"),e.innerHTML=t.dataTreeBranchElement,this.branchEl=e.firstChild):this.branchEl=t.dataTreeBranchElement:(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch-empty")),t.dataTreeCollapseElement?typeof t.dataTreeCollapseElement=="string"?(e=document.createElement("div"),e.innerHTML=t.dataTreeCollapseElement,this.collapseEl=e.firstChild):this.collapseEl=t.dataTreeCollapseElement:(this.collapseEl=document.createElement("div"),this.collapseEl.classList.add("tabulator-data-tree-control"),this.collapseEl.tabIndex=0,this.collapseEl.innerHTML="<div class='tabulator-data-tree-control-collapse'></div>"),t.dataTreeExpandElement?typeof t.dataTreeExpandElement=="string"?(e=document.createElement("div"),e.innerHTML=t.dataTreeExpandElement,this.expandEl=e.firstChild):this.expandEl=t.dataTreeExpandElement:(this.expandEl=document.createElement("div"),this.expandEl.classList.add("tabulator-data-tree-control"),this.expandEl.tabIndex=0,this.expandEl.innerHTML="<div class='tabulator-data-tree-control-expand'></div>"),typeof t.dataTreeStartExpanded){case"boolean":this.startOpen=function(i,n){return t.dataTreeStartExpanded};break;case"function":this.startOpen=t.dataTreeStartExpanded;break;default:this.startOpen=function(i,n){return t.dataTreeStartExpanded[n]};break}this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("row-deleted",this.rowDelete.bind(this),0),this.subscribe("row-data-changed",this.rowDataChanged.bind(this),10),this.subscribe("cell-value-updated",this.cellValueChanged.bind(this)),this.subscribe("edit-cancelled",this.cellValueChanged.bind(this)),this.subscribe("column-moving-rows",this.columnMoving.bind(this)),this.subscribe("table-built",this.initializeElementField.bind(this)),this.subscribe("table-redrawing",this.tableRedrawing.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),30)}}tableRedrawing(e){var t;e&&(t=this.table.rowManager.getRows(),t.forEach(i=>{this.reinitializeRowChildren(i)}))}initializeElementField(){var e=this.table.columnManager.getFirstVisibleColumn();this.elementField=this.table.options.dataTreeElementColumn||(e?e.field:!1)}getRowChildren(e){return this.getTreeChildren(e,!0)}columnMoving(){var e=[];return this.table.rowManager.rows.forEach(t=>{e=e.concat(this.getTreeChildren(t,!1,!0))}),e}rowDataChanged(e,t,i){this.redrawNeeded(i)&&(this.initializeRow(e),t&&(this.layoutRow(e),this.refreshData(!0)))}cellValueChanged(e){var t=e.column.getField();t===this.elementField&&this.layoutRow(e.row)}initializeRow(e){var t=e.getData()[this.field],i=Array.isArray(t),n=i||!i&&typeof t=="object"&&t!==null;!n&&e.modules.dataTree&&e.modules.dataTree.branchEl&&e.modules.dataTree.branchEl.parentNode.removeChild(e.modules.dataTree.branchEl),!n&&e.modules.dataTree&&e.modules.dataTree.controlEl&&e.modules.dataTree.controlEl.parentNode.removeChild(e.modules.dataTree.controlEl),e.modules.dataTree={index:e.modules.dataTree?e.modules.dataTree.index:0,open:n?e.modules.dataTree?e.modules.dataTree.open:this.startOpen(e.getComponent(),0):!1,controlEl:e.modules.dataTree&&n?e.modules.dataTree.controlEl:!1,branchEl:e.modules.dataTree&&n?e.modules.dataTree.branchEl:!1,parent:e.modules.dataTree?e.modules.dataTree.parent:!1,children:n}}reinitializeRowChildren(e){var t=this.getTreeChildren(e,!1,!0);t.forEach(function(i){i.reinitialize(!0)})}layoutRow(e){var t=this.elementField?e.getCell(this.elementField):e.getCells()[0],i=t.getElement(),n=e.modules.dataTree;n.branchEl&&(n.branchEl.parentNode&&n.branchEl.parentNode.removeChild(n.branchEl),n.branchEl=!1),n.controlEl&&(n.controlEl.parentNode&&n.controlEl.parentNode.removeChild(n.controlEl),n.controlEl=!1),this.generateControlElement(e,i),e.getElement().classList.add("tabulator-tree-level-"+n.index),n.index&&(this.branchEl?(n.branchEl=this.branchEl.cloneNode(!0),i.insertBefore(n.branchEl,i.firstChild),this.table.rtl?n.branchEl.style.marginRight=(n.branchEl.offsetWidth+n.branchEl.style.marginLeft)*(n.index-1)+n.index*this.indent+"px":n.branchEl.style.marginLeft=(n.branchEl.offsetWidth+n.branchEl.style.marginRight)*(n.index-1)+n.index*this.indent+"px"):this.table.rtl?i.style.paddingRight=parseInt(window.getComputedStyle(i,null).getPropertyValue("padding-right"))+n.index*this.indent+"px":i.style.paddingLeft=parseInt(window.getComputedStyle(i,null).getPropertyValue("padding-left"))+n.index*this.indent+"px")}generateControlElement(e,t){var i=e.modules.dataTree,n=i.controlEl;t=t||e.getCells()[0].getElement(),i.children!==!1&&(i.open?(i.controlEl=this.collapseEl.cloneNode(!0),i.controlEl.addEventListener("click",s=>{s.stopPropagation(),this.collapseRow(e)})):(i.controlEl=this.expandEl.cloneNode(!0),i.controlEl.addEventListener("click",s=>{s.stopPropagation(),this.expandRow(e)})),i.controlEl.addEventListener("mousedown",s=>{s.stopPropagation()}),n&&n.parentNode===t?n.parentNode.replaceChild(i.controlEl,n):t.insertBefore(i.controlEl,t.firstChild))}getRows(e){var t=[];return e.forEach((i,n)=>{var s,o;t.push(i),i instanceof kt&&(i.create(),s=i.modules.dataTree,!s.index&&s.children!==!1&&(o=this.getChildren(i,!1,!0),o.forEach(a=>{a.create(),t.push(a)})))}),t}getChildren(e,t,i){var n=e.modules.dataTree,s=[],o=[];return n.children!==!1&&(n.open||t)&&(Array.isArray(n.children)||(n.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?s=this.table.modules.filter.filter(n.children):s=n.children,this.table.modExists("sort")&&this.table.options.dataTreeSort&&this.table.modules.sort.sort(s,i),s.forEach(a=>{o.push(a);var l=this.getChildren(a,!1,!0);l.forEach(h=>{o.push(h)})})),o}generateChildren(e){var t=[],i=e.getData()[this.field];return Array.isArray(i)||(i=[i]),i.forEach(n=>{var s=new kt(n||{},this.table.rowManager);s.create(),s.modules.dataTree.index=e.modules.dataTree.index+1,s.modules.dataTree.parent=e,s.modules.dataTree.children&&(s.modules.dataTree.open=this.startOpen(s.getComponent(),s.modules.dataTree.index)),t.push(s)}),t}expandRow(e,t){var i=e.modules.dataTree;i.children!==!1&&(i.open=!0,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowExpanded",e.getComponent(),e.modules.dataTree.index))}collapseRow(e){var t=e.modules.dataTree;t.children!==!1&&(t.open=!1,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowCollapsed",e.getComponent(),e.modules.dataTree.index))}toggleRow(e){var t=e.modules.dataTree;t.children!==!1&&(t.open?this.collapseRow(e):this.expandRow(e))}isRowExpanded(e){return e.modules.dataTree.open}getTreeParent(e){return e.modules.dataTree.parent?e.modules.dataTree.parent.getComponent():!1}getTreeParentRoot(e){return e.modules.dataTree&&e.modules.dataTree.parent?this.getTreeParentRoot(e.modules.dataTree.parent):e}getFilteredTreeChildren(e){var t=e.modules.dataTree,i=[],n;return t.children&&(Array.isArray(t.children)||(t.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?n=this.table.modules.filter.filter(t.children):n=t.children,n.forEach(s=>{s instanceof kt&&i.push(s)})),i}rowDelete(e){var t=e.modules.dataTree.parent,i;t&&(i=this.findChildIndex(e,t),i!==!1&&t.data[this.field].splice(i,1),t.data[this.field].length||delete t.data[this.field],this.initializeRow(t),this.layoutRow(t)),this.refreshData(!0)}addTreeChildRow(e,t,i,n){var s=!1;typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(e.data[this.field])||(e.data[this.field]=[],e.modules.dataTree.open=this.startOpen(e.getComponent(),e.modules.dataTree.index)),typeof n<"u"&&(s=this.findChildIndex(n,e),s!==!1&&e.data[this.field].splice(i?s:s+1,0,t)),s===!1&&(i?e.data[this.field].unshift(t):e.data[this.field].push(t)),this.initializeRow(e),this.layoutRow(e),this.refreshData(!0)}findChildIndex(e,t){var i=!1;return typeof e=="object"?e instanceof kt?i=e.data:e instanceof Eh?i=e._getSelf().data:typeof HTMLElement<"u"&&e instanceof HTMLElement?t.modules.dataTree&&(i=t.modules.dataTree.children.find(n=>n instanceof kt?n.element===e:!1),i&&(i=i.data)):e===null&&(i=!1):typeof e>"u"?i=!1:i=t.data[this.field].find(n=>n.data[this.table.options.index]==e),i&&(Array.isArray(t.data[this.field])&&(i=t.data[this.field].indexOf(i)),i==-1&&(i=!1)),i}getTreeChildren(e,t,i){var n=e.modules.dataTree,s=[];return n&&n.children&&(Array.isArray(n.children)||(n.children=this.generateChildren(e)),n.children.forEach(o=>{o instanceof kt&&(s.push(t?o.getComponent():o),i&&this.getTreeChildren(o,t,i).forEach(a=>{s.push(a)}))})),s}getChildField(){return this.field}redrawNeeded(e){return(this.field?typeof e[this.field]<"u":!1)||(this.elementField?typeof e[this.elementField]<"u":!1)}}K(wv,"moduleName","dataTree");function MO(r,e={},t){var i=e.delimiter?e.delimiter:",",n=[],s=[];r.forEach(o=>{var a=[];switch(o.type){case"group":console.warn("Download Warning - CSV downloader cannot process row groups");break;case"calc":console.warn("Download Warning - CSV downloader cannot process column calculations");break;case"header":o.columns.forEach((l,h)=>{l&&l.depth===1&&(s[h]=typeof l.value>"u"||l.value===null?"":'"'+String(l.value).split('"').join('""')+'"')});break;case"row":o.columns.forEach(l=>{if(l){switch(typeof l.value){case"object":l.value=l.value!==null?JSON.stringify(l.value):"";break;case"undefined":l.value="";break}a.push('"'+String(l.value).split('"').join('""')+'"')}}),n.push(a.join(i));break}}),s.length&&n.unshift(s.join(i)),n=n.join(`
`),e.bom&&(n="\uFEFF"+n),t(n,"text/csv")}function LO(r,e,t){var i=[];r.forEach(n=>{var s={};switch(n.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":n.columns.forEach(o=>{o&&(s[o.component.getTitleDownload()||o.component.getField()]=o.value)}),i.push(s);break}}),i=JSON.stringify(i,null,"	"),t(i,"application/json")}function AO(r,e={},t){var i=[],n=[],s={},o=e.rowGroupStyles||{fontStyle:"bold",fontSize:12,cellPadding:6,fillColor:220},a=e.rowCalcStyles||{fontStyle:"bold",fontSize:10,cellPadding:4,fillColor:232},l=e.jsPDF||{},h=e.title?e.title:"";l.orientation||(l.orientation=e.orientation||"landscape"),l.unit||(l.unit="pt"),r.forEach(d=>{switch(d.type){case"header":i.push(u(d));break;case"group":n.push(u(d,o));break;case"calc":n.push(u(d,a));break;case"row":n.push(u(d));break}});function u(d,f){var g=[];return d.columns.forEach(m=>{var w;if(m){switch(typeof m.value){case"object":m.value=m.value!==null?JSON.stringify(m.value):"";break;case"undefined":m.value="";break}w={content:m.value,colSpan:m.width,rowSpan:m.height},f&&(w.styles=f),g.push(w)}}),g}var c=new jspdf.jsPDF(l);e.autoTable&&(typeof e.autoTable=="function"?s=e.autoTable(c)||{}:s=e.autoTable),h&&(s.didDrawPage=function(d){c.text(h,40,30)}),s.head=i,s.body=n,c.autoTable(s),e.documentProcessing&&e.documentProcessing(c),t(c.output("arraybuffer"),"application/pdf")}function IO(r,e,t){var i=this,n=e.sheetName||"Sheet1",s=XLSX.utils.book_new(),o=new It(this),a="compress"in e?e.compress:!0,l=e.writeOptions||{bookType:"xlsx",bookSST:!0,compression:a},h;l.type="binary",s.SheetNames=[],s.Sheets={};function u(){var f=[],g=[],m={},w={s:{c:0,r:0},e:{c:r[0]?r[0].columns.reduce((y,E)=>y+(E&&E.width?E.width:1),0):0,r:r.length}};return r.forEach((y,E)=>{var x=[];y.columns.forEach(function(v,S){v?(x.push(!(v.value instanceof Date)&&typeof v.value=="object"?JSON.stringify(v.value):v.value),(v.width>1||v.height>-1)&&(v.height>1||v.width>1)&&g.push({s:{r:E,c:S},e:{r:E+v.height-1,c:S+v.width-1}})):x.push("")}),f.push(x)}),XLSX.utils.sheet_add_aoa(m,f),m["!ref"]=XLSX.utils.encode_range(w),g.length&&(m["!merges"]=g),m}if(e.sheetOnly){t(u());return}if(e.sheets)for(var c in e.sheets)e.sheets[c]===!0?(s.SheetNames.push(c),s.Sheets[c]=u()):(s.SheetNames.push(c),o.commsSend(e.sheets[c],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},active:i.active,intercept:function(f){s.Sheets[c]=f}}));else s.SheetNames.push(n),s.Sheets[n]=u();e.documentProcessing&&(s=e.documentProcessing(s));function d(f){for(var g=new ArrayBuffer(f.length),m=new Uint8Array(g),w=0;w!=f.length;++w)m[w]=f.charCodeAt(w)&255;return g}h=XLSX.write(s,l),t(d(h),"application/octet-stream")}function PO(r,e,t){this.modExists("export",!0)&&t(this.modules.export.generateHTMLTable(r),"text/html")}function FO(r,e,t){const i=[];r.forEach(n=>{const s={};switch(n.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":n.columns.forEach(o=>{o&&(s[o.component.getTitleDownload()||o.component.getField()]=o.value)}),i.push(JSON.stringify(s));break}}),t(i.join(`
`),"application/x-ndjson")}var OO={csv:MO,json:LO,jsonLines:FO,pdf:AO,xlsx:IO,html:PO};const fs=class fs extends Le{constructor(e){super(e),this.registerTableOption("downloadEncoder",function(t,i){return new Blob([t],{type:i})}),this.registerTableOption("downloadConfig",{}),this.registerTableOption("downloadRowRange","active"),this.registerColumnOption("download"),this.registerColumnOption("titleDownload")}initialize(){this.deprecatedOptionsCheck(),this.registerTableFunction("download",this.download.bind(this)),this.registerTableFunction("downloadToTab",this.downloadToTab.bind(this))}deprecatedOptionsCheck(){}downloadToTab(e,t,i,n){this.download(e,t,i,n,!0)}download(e,t,i,n,s){var o=!1;function a(h,u){s?s===!0?this.triggerDownload(h,u,e,t,!0):s(h):this.triggerDownload(h,u,e,t)}if(typeof e=="function"?o=e:fs.downloaders[e]?o=fs.downloaders[e]:console.warn("Download Error - No such download type found: ",e),o){var l=this.generateExportList(n);o.call(this.table,l,i||{},a.bind(this))}}generateExportList(e){var t=this.table.modules.export.generateExportList(this.table.options.downloadConfig,!1,e||this.table.options.downloadRowRange,"download"),i=this.table.options.groupHeaderDownload;return i&&!Array.isArray(i)&&(i=[i]),t.forEach(n=>{var s;n.type==="group"&&(s=n.columns[0],i&&i[n.indent]&&(s.value=i[n.indent](s.value,n.component._group.getRowCount(),n.component._group.getData(),n.component)))}),t}triggerDownload(e,t,i,n,s){var o=document.createElement("a"),a=this.table.options.downloadEncoder(e,t);a&&(s?window.open(window.URL.createObjectURL(a)):(n=n||"Tabulator."+(typeof i=="function"?"txt":i),navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(a,n):(o.setAttribute("href",window.URL.createObjectURL(a)),o.setAttribute("download",n),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o))),this.dispatchExternal("downloadComplete"))}commsReceived(e,t,i){switch(t){case"intercept":this.download(i.type,"",i.options,i.active,i.intercept);break}}};K(fs,"moduleName","download"),K(fs,"downloaders",OO);let cc=fs;function _h(r,e){var t=e.mask,i=typeof e.maskLetterChar<"u"?e.maskLetterChar:"A",n=typeof e.maskNumberChar<"u"?e.maskNumberChar:"9",s=typeof e.maskWildcardChar<"u"?e.maskWildcardChar:"*";function o(a){var l=t[a];typeof l<"u"&&l!==s&&l!==i&&l!==n&&(r.value=r.value+""+l,o(a+1))}r.addEventListener("keydown",a=>{var l=r.value.length,h=a.key;if(a.keyCode>46&&!a.ctrlKey&&!a.metaKey){if(l>=t.length)return a.preventDefault(),a.stopPropagation(),!1;switch(t[l]){case i:if(h.toUpperCase()==h.toLowerCase())return a.preventDefault(),a.stopPropagation(),!1;break;case n:if(isNaN(h))return a.preventDefault(),a.stopPropagation(),!1;break;case s:break;default:if(h!==t[l])return a.preventDefault(),a.stopPropagation(),!1}}}),r.addEventListener("keyup",a=>{a.keyCode>46&&e.maskAutoFill&&o(r.value.length)}),r.placeholder||(r.placeholder=t),e.maskAutoFill&&o(r.value.length)}function DO(r,e,t,i,n){var s=r.getValue(),o=document.createElement("input");if(o.setAttribute("type",n.search?"search":"text"),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let l in n.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),o.setAttribute(l,o.getAttribute(l)+n.elementAttributes["+"+l])):o.setAttribute(l,n.elementAttributes[l]);o.value=typeof s<"u"?s:"",e(function(){r.getType()==="cell"&&(o.focus({preventScroll:!0}),o.style.height="100%",n.selectContents&&o.select())});function a(l){(s===null||typeof s>"u")&&o.value!==""||o.value!==s?t(o.value)&&(s=o.value):i()}return o.addEventListener("change",a),o.addEventListener("blur",a),o.addEventListener("keydown",function(l){switch(l.keyCode){case 13:a();break;case 27:i();break;case 35:case 36:l.stopPropagation();break}}),n.mask&&_h(o,n),o}function kO(r,e,t,i,n){var s=r.getValue(),o=n.verticalNavigation||"hybrid",a=String(s!==null&&typeof s<"u"?s:""),l=document.createElement("textarea"),h=0;if(l.style.display="block",l.style.padding="2px",l.style.height="100%",l.style.width="100%",l.style.boxSizing="border-box",l.style.whiteSpace="pre-wrap",l.style.resize="none",n.elementAttributes&&typeof n.elementAttributes=="object")for(let c in n.elementAttributes)c.charAt(0)=="+"?(c=c.slice(1),l.setAttribute(c,l.getAttribute(c)+n.elementAttributes["+"+c])):l.setAttribute(c,n.elementAttributes[c]);l.value=a,e(function(){r.getType()==="cell"&&(l.focus({preventScroll:!0}),l.style.height="100%",l.scrollHeight,l.style.height=l.scrollHeight+"px",r.getRow().normalizeHeight(),n.selectContents&&l.select())});function u(c){(s===null||typeof s>"u")&&l.value!==""||l.value!==s?(t(l.value)&&(s=l.value),setTimeout(function(){r.getRow().normalizeHeight()},300)):i()}return l.addEventListener("change",u),l.addEventListener("blur",u),l.addEventListener("keyup",function(){l.style.height="";var c=l.scrollHeight;l.style.height=c+"px",c!=h&&(h=c,r.getRow().normalizeHeight())}),l.addEventListener("keydown",function(c){switch(c.keyCode){case 13:c.shiftKey&&n.shiftEnterSubmit&&u();break;case 27:i();break;case 38:(o=="editor"||o=="hybrid"&&l.selectionStart)&&(c.stopImmediatePropagation(),c.stopPropagation());break;case 40:(o=="editor"||o=="hybrid"&&l.selectionStart!==l.value.length)&&(c.stopImmediatePropagation(),c.stopPropagation());break;case 35:case 36:c.stopPropagation();break}}),n.mask&&_h(l,n),l}function NO(r,e,t,i,n){var s=r.getValue(),o=n.verticalNavigation||"editor",a=document.createElement("input");if(a.setAttribute("type","number"),typeof n.max<"u"&&a.setAttribute("max",n.max),typeof n.min<"u"&&a.setAttribute("min",n.min),typeof n.step<"u"&&a.setAttribute("step",n.step),a.style.padding="4px",a.style.width="100%",a.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let u in n.elementAttributes)u.charAt(0)=="+"?(u=u.slice(1),a.setAttribute(u,a.getAttribute(u)+n.elementAttributes["+"+u])):a.setAttribute(u,n.elementAttributes[u]);a.value=s;var l=function(u){h()};e(function(){r.getType()==="cell"&&(a.removeEventListener("blur",l),a.focus({preventScroll:!0}),a.style.height="100%",a.addEventListener("blur",l),n.selectContents&&a.select())});function h(){var u=a.value;!isNaN(u)&&u!==""&&(u=Number(u)),u!==s?t(u)&&(s=u):i()}return a.addEventListener("keydown",function(u){switch(u.keyCode){case 13:h();break;case 27:i();break;case 38:case 40:o=="editor"&&(u.stopImmediatePropagation(),u.stopPropagation());break;case 35:case 36:u.stopPropagation();break}}),n.mask&&_h(a,n),a}function zO(r,e,t,i,n){var s=r.getValue(),o=document.createElement("input");if(o.setAttribute("type","range"),typeof n.max<"u"&&o.setAttribute("max",n.max),typeof n.min<"u"&&o.setAttribute("min",n.min),typeof n.step<"u"&&o.setAttribute("step",n.step),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let l in n.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),o.setAttribute(l,o.getAttribute(l)+n.elementAttributes["+"+l])):o.setAttribute(l,n.elementAttributes[l]);o.value=s,e(function(){r.getType()==="cell"&&(o.focus({preventScroll:!0}),o.style.height="100%")});function a(){var l=o.value;!isNaN(l)&&l!==""&&(l=Number(l)),l!=s?t(l)&&(s=l):i()}return o.addEventListener("blur",function(l){a()}),o.addEventListener("keydown",function(l){switch(l.keyCode){case 13:a();break;case 27:i();break}}),o}function BO(r,e,t,i,n){var s=n.format,o=n.verticalNavigation||"editor",a=s?window.DateTime||luxon.DateTime:null,l=r.getValue(),h=document.createElement("input");function u(d){var f;return a.isDateTime(d)?f=d:s==="iso"?f=a.fromISO(String(d)):f=a.fromFormat(String(d),s),f.toFormat("yyyy-MM-dd")}if(h.type="date",h.style.padding="4px",h.style.width="100%",h.style.boxSizing="border-box",n.max&&h.setAttribute("max",s?u(n.max):n.max),n.min&&h.setAttribute("min",s?u(n.min):n.min),n.elementAttributes&&typeof n.elementAttributes=="object")for(let d in n.elementAttributes)d.charAt(0)=="+"?(d=d.slice(1),h.setAttribute(d,h.getAttribute(d)+n.elementAttributes["+"+d])):h.setAttribute(d,n.elementAttributes[d]);l=typeof l<"u"?l:"",s&&(a?l=u(l):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),h.value=l,e(function(){r.getType()==="cell"&&(h.focus({preventScroll:!0}),h.style.height="100%",n.selectContents&&h.select())});function c(){var d=h.value,f;if((l===null||typeof l>"u")&&d!==""||d!==l){if(d&&s)switch(f=a.fromFormat(String(d),"yyyy-MM-dd"),s){case!0:d=f;break;case"iso":d=f.toISO();break;default:d=f.toFormat(s)}t(d)&&(l=h.value)}else i()}return h.addEventListener("blur",function(d){(d.relatedTarget||d.rangeParent||d.explicitOriginalTarget!==h)&&c()}),h.addEventListener("keydown",function(d){switch(d.keyCode){case 13:c();break;case 27:i();break;case 35:case 36:d.stopPropagation();break;case 38:case 40:o=="editor"&&(d.stopImmediatePropagation(),d.stopPropagation());break}}),h}function GO(r,e,t,i,n){var s=n.format,o=n.verticalNavigation||"editor",a=s?window.DateTime||luxon.DateTime:null,l,h=r.getValue(),u=document.createElement("input");if(u.type="time",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let d in n.elementAttributes)d.charAt(0)=="+"?(d=d.slice(1),u.setAttribute(d,u.getAttribute(d)+n.elementAttributes["+"+d])):u.setAttribute(d,n.elementAttributes[d]);h=typeof h<"u"?h:"",s&&(a?(a.isDateTime(h)?l=h:s==="iso"?l=a.fromISO(String(h)):l=a.fromFormat(String(h),s),h=l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),u.value=h,e(function(){r.getType()=="cell"&&(u.focus({preventScroll:!0}),u.style.height="100%",n.selectContents&&u.select())});function c(){var d=u.value,f;if((h===null||typeof h>"u")&&d!==""||d!==h){if(d&&s)switch(f=a.fromFormat(String(d),"hh:mm"),s){case!0:d=f;break;case"iso":d=f.toISO();break;default:d=f.toFormat(s)}t(d)&&(h=u.value)}else i()}return u.addEventListener("blur",function(d){(d.relatedTarget||d.rangeParent||d.explicitOriginalTarget!==u)&&c()}),u.addEventListener("keydown",function(d){switch(d.keyCode){case 13:c();break;case 27:i();break;case 35:case 36:d.stopPropagation();break;case 38:case 40:o=="editor"&&(d.stopImmediatePropagation(),d.stopPropagation());break}}),u}function HO(r,e,t,i,n){var s=n.format,o=n.verticalNavigation||"editor",a=s?window.DateTime||luxon.DateTime:null,l,h=r.getValue(),u=document.createElement("input");if(u.type="datetime-local",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let d in n.elementAttributes)d.charAt(0)=="+"?(d=d.slice(1),u.setAttribute(d,u.getAttribute(d)+n.elementAttributes["+"+d])):u.setAttribute(d,n.elementAttributes[d]);h=typeof h<"u"?h:"",s&&(a?(a.isDateTime(h)?l=h:s==="iso"?l=a.fromISO(String(h)):l=a.fromFormat(String(h),s),h=l.toFormat("yyyy-MM-dd")+"T"+l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),u.value=h,e(function(){r.getType()==="cell"&&(u.focus({preventScroll:!0}),u.style.height="100%",n.selectContents&&u.select())});function c(){var d=u.value,f;if((h===null||typeof h>"u")&&d!==""||d!==h){if(d&&s)switch(f=a.fromISO(String(d)),s){case!0:d=f;break;case"iso":d=f.toISO();break;default:d=f.toFormat(s)}t(d)&&(h=u.value)}else i()}return u.addEventListener("blur",function(d){(d.relatedTarget||d.rangeParent||d.explicitOriginalTarget!==u)&&c()}),u.addEventListener("keydown",function(d){switch(d.keyCode){case 13:c();break;case 27:i();break;case 35:case 36:d.stopPropagation();break;case 38:case 40:o=="editor"&&(d.stopImmediatePropagation(),d.stopPropagation());break}}),u}let VO=class{constructor(e,t,i,n,s,o){this.edit=e,this.table=e.table,this.cell=t,this.params=this._initializeParams(o),this.data=[],this.displayItems=[],this.currentItems=[],this.focusedItem=null,this.input=this._createInputElement(),this.listEl=this._createListElement(),this.initialValues=null,this.isFilter=t.getType()==="header",this.filterTimeout=null,this.filtered=!1,this.typing=!1,this.values=[],this.popup=null,this.listIteration=0,this.lastAction="",this.filterTerm="",this.blurable=!0,this.actions={success:n,cancel:s},this._deprecatedOptionsCheck(),this._initializeValue(),i(this._onRendered.bind(this))}_deprecatedOptionsCheck(){}_initializeValue(){var e=this.cell.getValue();typeof e>"u"&&typeof this.params.defaultValue<"u"&&(e=this.params.defaultValue),this.initialValues=this.params.multiselect?e:[e],this.isFilter&&(this.input.value=this.initialValues?this.initialValues.join(","):"",this.headerFilterInitialListGen())}_onRendered(){var e=this.cell.getElement();function t(i){i.stopPropagation()}this.isFilter||(this.input.style.height="100%",this.input.focus({preventScroll:!0})),e.addEventListener("click",t),setTimeout(()=>{e.removeEventListener("click",t)},1e3),this.input.addEventListener("mousedown",this._preventPopupBlur.bind(this))}_createListElement(){var e=document.createElement("div");return e.classList.add("tabulator-edit-list"),e.addEventListener("mousedown",this._preventBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e}_setListWidth(){var e=this.isFilter?this.input:this.cell.getElement();this.listEl.style.minWidth=e.offsetWidth+"px",this.params.maxWidth&&(this.params.maxWidth===!0?this.listEl.style.maxWidth=e.offsetWidth+"px":typeof this.params.maxWidth=="number"?this.listEl.style.maxWidth=this.params.maxWidth+"px":this.listEl.style.maxWidth=this.params.maxWidth)}_createInputElement(){var e=this.params.elementAttributes,t=document.createElement("input");if(t.setAttribute("type",this.params.clearable?"search":"text"),t.style.padding="4px",t.style.width="100%",t.style.boxSizing="border-box",this.params.autocomplete||(t.style.cursor="default",t.style.caretColor="transparent"),e&&typeof e=="object")for(let i in e)i.charAt(0)=="+"?(i=i.slice(1),t.setAttribute(i,t.getAttribute(i)+e["+"+i])):t.setAttribute(i,e[i]);return this.params.mask&&_h(t,this.params),this._bindInputEvents(t),t}_initializeParams(e){var t=["values","valuesURL","valuesLookup"],i;return e=Object.assign({},e),e.verticalNavigation=e.verticalNavigation||"editor",e.placeholderLoading=typeof e.placeholderLoading>"u"?"Searching ...":e.placeholderLoading,e.placeholderEmpty=typeof e.placeholderEmpty>"u"?"No Results Found":e.placeholderEmpty,e.filterDelay=typeof e.filterDelay>"u"?300:e.filterDelay,e.emptyValue=Object.keys(e).includes("emptyValue")?e.emptyValue:"",i=Object.keys(e).filter(n=>t.includes(n)).length,i?i>1&&console.warn("list editor config error - only one of the values, valuesURL, or valuesLookup options can be set on the same editor"):console.warn("list editor config error - either the values, valuesURL, or valuesLookup option must be set"),e.autocomplete?e.multiselect&&(e.multiselect=!1,console.warn("list editor config error - multiselect option is not available when autocomplete is enabled")):(e.freetext&&(e.freetext=!1,console.warn("list editor config error - freetext option is only available when autocomplete is enabled")),e.filterFunc&&(e.filterFunc=!1,console.warn("list editor config error - filterFunc option is only available when autocomplete is enabled")),e.filterRemote&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option is only available when autocomplete is enabled")),e.mask&&(e.mask=!1,console.warn("list editor config error - mask option is only available when autocomplete is enabled")),e.allowEmpty&&(e.allowEmpty=!1,console.warn("list editor config error - allowEmpty option is only available when autocomplete is enabled")),e.listOnEmpty&&(e.listOnEmpty=!1,console.warn("list editor config error - listOnEmpty option is only available when autocomplete is enabled"))),e.filterRemote&&!(typeof e.valuesLookup=="function"||e.valuesURL)&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option should only be used when values list is populated from a remote source")),e}_bindInputEvents(e){e.addEventListener("focus",this._inputFocus.bind(this)),e.addEventListener("click",this._inputClick.bind(this)),e.addEventListener("blur",this._inputBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e.addEventListener("search",this._inputSearch.bind(this)),this.params.autocomplete&&e.addEventListener("keyup",this._inputKeyUp.bind(this))}_inputFocus(e){this.rebuildOptionsList()}_filter(){this.params.filterRemote?(clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout(()=>{this.rebuildOptionsList()},this.params.filterDelay)):this._filterList()}_inputClick(e){e.stopPropagation()}_inputBlur(e){this.blurable&&(this.popup?this.popup.hide():this._resolveValue(!0))}_inputSearch(){this._clearChoices()}_inputKeyDown(e){switch(e.keyCode){case 38:this._keyUp(e);break;case 40:this._keyDown(e);break;case 37:case 39:this._keySide(e);break;case 13:this._keyEnter();break;case 27:this._keyEsc();break;case 36:case 35:this._keyHomeEnd(e);break;case 9:this._keyTab(e);break;default:this._keySelectLetter(e)}}_inputKeyUp(e){switch(e.keyCode){case 38:case 37:case 39:case 40:case 13:case 27:break;default:this._keyAutoCompLetter(e)}}_preventPopupBlur(){this.popup&&this.popup.blockHide(),setTimeout(()=>{this.popup&&this.popup.restoreHide()},10)}_preventBlur(){this.blurable=!1,setTimeout(()=>{this.blurable=!0},10)}_keyTab(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem,!0)}_keyUp(e){var t=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&t)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),t>0&&this._focusItem(this.displayItems[t-1]))}_keyDown(e){var t=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&t<this.displayItems.length-1)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),t<this.displayItems.length-1&&(t==-1?this._focusItem(this.displayItems[0]):this._focusItem(this.displayItems[t+1])))}_keySide(e){this.params.autocomplete||(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())}_keyEnter(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem)}_keyEsc(e){this._cancel()}_keyHomeEnd(e){this.params.autocomplete&&e.stopImmediatePropagation()}_keySelectLetter(e){this.params.autocomplete||(e.preventDefault(),e.keyCode>=38&&e.keyCode<=90&&this._scrollToValue(e.keyCode))}_keyAutoCompLetter(e){this._filter(),this.lastAction="typing",this.typing=!0}_scrollToValue(e){clearTimeout(this.filterTimeout);var t=String.fromCharCode(e).toLowerCase();this.filterTerm+=t.toLowerCase();var i=this.displayItems.find(n=>typeof n.label<"u"&&n.label.toLowerCase().startsWith(this.filterTerm));i&&this._focusItem(i),this.filterTimeout=setTimeout(()=>{this.filterTerm=""},800)}_focusItem(e){this.lastAction="focus",this.focusedItem&&this.focusedItem.element&&this.focusedItem.element.classList.remove("focused"),this.focusedItem=e,e&&e.element&&(e.element.classList.add("focused"),e.element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}headerFilterInitialListGen(){this._generateOptions(!0)}rebuildOptionsList(){this._generateOptions().then(this._sortOptions.bind(this)).then(this._buildList.bind(this)).then(this._showList.bind(this)).catch(e=>{Number.isInteger(e)||console.error("List generation error",e)})}_filterList(){this._buildList(this._filterOptions()),this._showList()}_generateOptions(e){var t=[],i=++this.listIteration;return this.filtered=!1,this.params.values?t=this.params.values:this.params.valuesURL?t=this._ajaxRequest(this.params.valuesURL,this.input.value):typeof this.params.valuesLookup=="function"?t=this.params.valuesLookup(this.cell,this.input.value):this.params.valuesLookup&&(t=this._uniqueColumnValues(this.params.valuesLookupField)),t instanceof Promise?(e||this._addPlaceholder(this.params.placeholderLoading),t.then().then(n=>this.listIteration===i?this._parseList(n):Promise.reject(i))):Promise.resolve(this._parseList(t))}_addPlaceholder(e){var t=document.createElement("div");typeof e=="function"&&(e=e(this.cell.getComponent(),this.listEl)),e&&(this._clearList(),e instanceof HTMLElement?t=e:(t.classList.add("tabulator-edit-list-placeholder"),t.innerHTML=e),this.listEl.appendChild(t),this._showList())}_ajaxRequest(e,t){var i=this.params.filterRemote?{term:t}:{};return e=mv(e,{},i),fetch(e).then(n=>n.ok?n.json().catch(s=>(console.warn("List Ajax Load Error - Invalid JSON returned",s),Promise.reject(s))):(console.error("List Ajax Load Error - Connection Error: "+n.status,n.statusText),Promise.reject(n))).catch(n=>(console.error("List Ajax Load Error - Connection Error: ",n),Promise.reject(n)))}_uniqueColumnValues(e){var t={},i=this.table.getData(this.params.valuesLookup),n;return e?n=this.table.columnManager.getColumnByField(e):n=this.cell.getColumn()._getSelf(),n?i.forEach(s=>{var o=n.getFieldValue(s);o!==null&&typeof o<"u"&&o!==""&&(t[o]=!0)}):(console.warn("unable to find matching column to create select lookup list:",e),t=[]),Object.keys(t)}_parseList(e){var t=[];return Array.isArray(e)||(e=Object.entries(e).map(([i,n])=>({label:n,value:i}))),e.forEach(i=>{typeof i!="object"&&(i={label:i,value:i}),this._parseListItem(i,t,0)}),!this.currentItems.length&&this.params.freetext&&(this.input.value=this.initialValues,this.typing=!0,this.lastAction="typing"),this.data=t,t}_parseListItem(e,t,i){var n={};e.options?n=this._parseListGroup(e,i+1):(n={label:e.label,value:e.value,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,selected:!1,visible:!0,level:i,original:e},this.initialValues&&this.initialValues.indexOf(e.value)>-1&&this._chooseItem(n,!0)),t.push(n)}_parseListGroup(e,t){var i={label:e.label,group:!0,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,visible:!0,level:t,options:[],original:e};return e.options.forEach(n=>{this._parseListItem(n,i.options,t)}),i}_sortOptions(e){var t;return this.params.sort&&(t=typeof this.params.sort=="function"?this.params.sort:this._defaultSortFunction.bind(this),this._sortGroup(t,e)),e}_sortGroup(e,t){t.sort((i,n)=>e(i.label,n.label,i.value,n.value,i.original,n.original)),t.forEach(i=>{i.group&&this._sortGroup(e,i.options)})}_defaultSortFunction(e,t){var i,n,s,o,a=0,l,h=/(\d+)|(\D+)/g,u=/\d/,c=0;if(this.params.sort==="desc"&&([e,t]=[t,e]),!e&&e!==0)c=!t&&t!==0?0:-1;else if(!t&&t!==0)c=1;else{if(isFinite(e)&&isFinite(t))return e-t;if(i=String(e).toLowerCase(),n=String(t).toLowerCase(),i===n)return 0;if(!(u.test(i)&&u.test(n)))return i>n?1:-1;for(i=i.match(h),n=n.match(h),l=i.length>n.length?n.length:i.length;a<l;)if(s=i[a],o=n[a++],s!==o)return isFinite(s)&&isFinite(o)?(s.charAt(0)==="0"&&(s="."+s),o.charAt(0)==="0"&&(o="."+o),s-o):s>o?1:-1;return i.length>n.length}return c}_filterOptions(){var e=this.params.filterFunc||this._defaultFilterFunc,t=this.input.value;return t?(this.filtered=!0,this.data.forEach(i=>{this._filterItem(e,t,i)})):this.filtered=!1,this.data}_filterItem(e,t,i){var n=!1;return i.group?(i.options.forEach(s=>{this._filterItem(e,t,s)&&(n=!0)}),i.visible=n):i.visible=e(t,i.label,i.value,i.original),i.visible}_defaultFilterFunc(e,t,i,n){return e=String(e).toLowerCase(),t!==null&&typeof t<"u"&&(String(t).toLowerCase().indexOf(e)>-1||String(i).toLowerCase().indexOf(e)>-1)}_clearList(){for(;this.listEl.firstChild;)this.listEl.removeChild(this.listEl.firstChild);this.displayItems=[]}_buildList(e){this._clearList(),e.forEach(t=>{this._buildItem(t)}),this.displayItems.length||this._addPlaceholder(this.params.placeholderEmpty)}_buildItem(e){var t=e.element,i;if(!this.filtered||e.visible){if(!t){if(t=document.createElement("div"),t.tabIndex=0,i=this.params.itemFormatter?this.params.itemFormatter(e.label,e.value,e.original,t):e.label,i instanceof HTMLElement?t.appendChild(i):t.innerHTML=i,e.group?t.classList.add("tabulator-edit-list-group"):t.classList.add("tabulator-edit-list-item"),t.classList.add("tabulator-edit-list-group-level-"+e.level),e.elementAttributes&&typeof e.elementAttributes=="object")for(let n in e.elementAttributes)n.charAt(0)=="+"?(n=n.slice(1),t.setAttribute(n,this.input.getAttribute(n)+e.elementAttributes["+"+n])):t.setAttribute(n,e.elementAttributes[n]);e.group?t.addEventListener("click",this._groupClick.bind(this,e)):t.addEventListener("click",this._itemClick.bind(this,e)),t.addEventListener("mousedown",this._preventBlur.bind(this)),e.element=t}this._styleItem(e),this.listEl.appendChild(t),e.group?e.options.forEach(n=>{this._buildItem(n)}):this.displayItems.push(e)}}_showList(){var e=this.popup&&this.popup.isVisible();if(this.input.parentNode){if(this.params.autocomplete&&this.input.value===""&&!this.params.listOnEmpty){this.popup&&this.popup.hide(!0);return}this._setListWidth(),this.popup||(this.popup=this.edit.popup(this.listEl)),this.popup.show(this.cell.getElement(),"bottom"),e||setTimeout(()=>{this.popup.hideOnBlur(this._resolveValue.bind(this,!0))},10)}}_styleItem(e){e&&e.element&&(e.selected?e.element.classList.add("active"):e.element.classList.remove("active"))}_itemClick(e,t){t.stopPropagation(),this._chooseItem(e)}_groupClick(e,t){t.stopPropagation()}_cancel(){this.popup.hide(!0),this.actions.cancel()}_clearChoices(){this.typing=!0,this.currentItems.forEach(e=>{e.selected=!1,this._styleItem(e)}),this.currentItems=[],this.focusedItem=null}_chooseItem(e,t){var i;this.typing=!1,this.params.multiselect?(i=this.currentItems.indexOf(e),i>-1?(this.currentItems.splice(i,1),e.selected=!1):(this.currentItems.push(e),e.selected=!0),this.input.value=this.currentItems.map(n=>n.label).join(","),this._styleItem(e)):(this.currentItems=[e],e.selected=!0,this.input.value=e.label,this._styleItem(e),t||this._resolveValue()),this._focusItem(e)}_resolveValue(e){var t,i;if(this.popup&&this.popup.hide(!0),this.params.multiselect)t=this.currentItems.map(n=>n.value);else if(e&&this.params.autocomplete&&this.typing)if(this.params.freetext||this.params.allowEmpty&&this.input.value==="")t=this.input.value;else{this.actions.cancel();return}else this.currentItems[0]?t=this.currentItems[0].value:(i=Array.isArray(this.initialValues)?this.initialValues[0]:this.initialValues,i===null||typeof i>"u"||i===""?t=i:t=this.params.emptyValue);t===""&&(t=this.params.emptyValue),this.actions.success(t),this.isFilter&&(this.initialValues=t&&!Array.isArray(t)?[t]:t,this.currentItems=[])}};function WO(r,e,t,i,n){var s=new VO(this,r,e,t,i,n);return s.input}function UO(r,e,t,i,n){var s=this,o=r.getElement(),a=r.getValue(),l=o.getElementsByTagName("svg").length||5,h=o.getElementsByTagName("svg")[0]?o.getElementsByTagName("svg")[0].getAttribute("width"):14,u=[],c=document.createElement("div"),d=document.createElementNS("http://www.w3.org/2000/svg","svg");function f(y){u.forEach(function(E,x){x<y?(s.table.browser=="ie"?E.setAttribute("class","tabulator-star-active"):E.classList.replace("tabulator-star-inactive","tabulator-star-active"),E.innerHTML='<polygon fill="#488CE9" stroke="#014AAE" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>'):(s.table.browser=="ie"?E.setAttribute("class","tabulator-star-inactive"):E.classList.replace("tabulator-star-active","tabulator-star-inactive"),E.innerHTML='<polygon fill="#010155" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>')})}function g(y){var E=document.createElement("span"),x=d.cloneNode(!0);u.push(x),E.addEventListener("mouseenter",function(v){v.stopPropagation(),v.stopImmediatePropagation(),f(y)}),E.addEventListener("mousemove",function(v){v.stopPropagation(),v.stopImmediatePropagation()}),E.addEventListener("click",function(v){v.stopPropagation(),v.stopImmediatePropagation(),t(y),o.blur()}),E.appendChild(x),c.appendChild(E)}function m(y){a=y,f(y)}if(o.style.whiteSpace="nowrap",o.style.overflow="hidden",o.style.textOverflow="ellipsis",c.style.verticalAlign="middle",c.style.display="inline-block",c.style.padding="4px",d.setAttribute("width",h),d.setAttribute("height",h),d.setAttribute("viewBox","0 0 512 512"),d.setAttribute("xml:space","preserve"),d.style.padding="0 1px",n.elementAttributes&&typeof n.elementAttributes=="object")for(let y in n.elementAttributes)y.charAt(0)=="+"?(y=y.slice(1),c.setAttribute(y,c.getAttribute(y)+n.elementAttributes["+"+y])):c.setAttribute(y,n.elementAttributes[y]);for(var w=1;w<=l;w++)g(w);return a=Math.min(parseInt(a),l),f(a),c.addEventListener("mousemove",function(y){f(0)}),c.addEventListener("click",function(y){t(0)}),o.addEventListener("blur",function(y){i()}),o.addEventListener("keydown",function(y){switch(y.keyCode){case 39:m(a+1);break;case 37:m(a-1);break;case 13:t(a);break;case 27:i();break}}),c}function YO(r,e,t,i,n){var s=r.getElement(),o=typeof n.max>"u"?s.getElementsByTagName("div")[0]&&s.getElementsByTagName("div")[0].getAttribute("max")||100:n.max,a=typeof n.min>"u"?s.getElementsByTagName("div")[0]&&s.getElementsByTagName("div")[0].getAttribute("min")||0:n.min,l=(o-a)/100,h=r.getValue()||0,u=document.createElement("div"),c=document.createElement("div"),d,f;function g(){var m=window.getComputedStyle(s,null),w=l*Math.round(c.offsetWidth/((s.clientWidth-parseInt(m.getPropertyValue("padding-left"))-parseInt(m.getPropertyValue("padding-right")))/100))+a;t(w),s.setAttribute("aria-valuenow",w),s.setAttribute("aria-label",h)}if(u.style.position="absolute",u.style.right="0",u.style.top="0",u.style.bottom="0",u.style.width="5px",u.classList.add("tabulator-progress-handle"),c.style.display="inline-block",c.style.position="relative",c.style.height="100%",c.style.backgroundColor="#488CE9",c.style.maxWidth="100%",c.style.minWidth="0%",n.elementAttributes&&typeof n.elementAttributes=="object")for(let m in n.elementAttributes)m.charAt(0)=="+"?(m=m.slice(1),c.setAttribute(m,c.getAttribute(m)+n.elementAttributes["+"+m])):c.setAttribute(m,n.elementAttributes[m]);return s.style.padding="4px 4px",h=Math.min(parseFloat(h),o),h=Math.max(parseFloat(h),a),h=Math.round((h-a)/l),c.style.width=h+"%",s.setAttribute("aria-valuemin",a),s.setAttribute("aria-valuemax",o),c.appendChild(u),u.addEventListener("mousedown",function(m){d=m.screenX,f=c.offsetWidth}),u.addEventListener("mouseover",function(){u.style.cursor="ew-resize"}),s.addEventListener("mousemove",function(m){d&&(c.style.width=f+m.screenX-d+"px")}),s.addEventListener("mouseup",function(m){d&&(m.stopPropagation(),m.stopImmediatePropagation(),d=!1,f=!1,g())}),s.addEventListener("keydown",function(m){switch(m.keyCode){case 39:m.preventDefault(),c.style.width=c.clientWidth+s.clientWidth/100+"px";break;case 37:m.preventDefault(),c.style.width=c.clientWidth-s.clientWidth/100+"px";break;case 9:case 13:g();break;case 27:i();break}}),s.addEventListener("blur",function(){i()}),c}function jO(r,e,t,i,n){var s=r.getValue(),o=document.createElement("input"),a=n.tristate,l=typeof n.indeterminateValue>"u"?null:n.indeterminateValue,h=!1,u=Object.keys(n).includes("trueValue"),c=Object.keys(n).includes("falseValue");if(o.setAttribute("type","checkbox"),o.style.marginTop="5px",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let f in n.elementAttributes)f.charAt(0)=="+"?(f=f.slice(1),o.setAttribute(f,o.getAttribute(f)+n.elementAttributes["+"+f])):o.setAttribute(f,n.elementAttributes[f]);o.value=s,a&&(typeof s>"u"||s===l||s==="")&&(h=!0,o.indeterminate=!0),this.table.browser!="firefox"&&this.table.browser!="safari"&&e(function(){r.getType()==="cell"&&o.focus({preventScroll:!0})}),o.checked=u?s===n.trueValue:s===!0||s==="true"||s==="True"||s===1;function d(f){var g=o.checked;return u&&g?g=n.trueValue:c&&!g&&(g=n.falseValue),a?f?h?l:g:o.checked&&!h?(o.checked=!1,o.indeterminate=!0,h=!0,l):(h=!1,g):g}return o.addEventListener("change",function(f){t(d())}),o.addEventListener("blur",function(f){t(d(!0))}),o.addEventListener("keydown",function(f){f.keyCode==13&&t(d()),f.keyCode==27&&i()}),o}var XO={input:DO,textarea:kO,number:NO,range:zO,date:BO,time:GO,datetime:HO,list:WO,star:UO,progress:YO,tickCross:jO};const Eo=class Eo extends Le{constructor(e){super(e),this.currentCell=!1,this.mouseClick=!1,this.recursionBlock=!1,this.invalidEdit=!1,this.editedCells=[],this.convertEmptyValues=!1,this.editors=Eo.editors,this.registerTableOption("editTriggerEvent","focus"),this.registerTableOption("editorEmptyValue"),this.registerTableOption("editorEmptyValueFunc",this.emptyValueCheck.bind(this)),this.registerColumnOption("editable"),this.registerColumnOption("editor"),this.registerColumnOption("editorParams"),this.registerColumnOption("editorEmptyValue"),this.registerColumnOption("editorEmptyValueFunc"),this.registerColumnOption("cellEditing"),this.registerColumnOption("cellEdited"),this.registerColumnOption("cellEditCancelled"),this.registerTableFunction("getEditedCells",this.getEditedCells.bind(this)),this.registerTableFunction("clearCellEdited",this.clearCellEdited.bind(this)),this.registerTableFunction("navigatePrev",this.navigatePrev.bind(this)),this.registerTableFunction("navigateNext",this.navigateNext.bind(this)),this.registerTableFunction("navigateLeft",this.navigateLeft.bind(this)),this.registerTableFunction("navigateRight",this.navigateRight.bind(this)),this.registerTableFunction("navigateUp",this.navigateUp.bind(this)),this.registerTableFunction("navigateDown",this.navigateDown.bind(this)),this.registerComponentFunction("cell","isEdited",this.cellIsEdited.bind(this)),this.registerComponentFunction("cell","clearEdited",this.clearEdited.bind(this)),this.registerComponentFunction("cell","edit",this.editCell.bind(this)),this.registerComponentFunction("cell","cancelEdit",this.cellCancelEdit.bind(this)),this.registerComponentFunction("cell","navigatePrev",this.navigatePrev.bind(this)),this.registerComponentFunction("cell","navigateNext",this.navigateNext.bind(this)),this.registerComponentFunction("cell","navigateLeft",this.navigateLeft.bind(this)),this.registerComponentFunction("cell","navigateRight",this.navigateRight.bind(this)),this.registerComponentFunction("cell","navigateUp",this.navigateUp.bind(this)),this.registerComponentFunction("cell","navigateDown",this.navigateDown.bind(this))}initialize(){this.subscribe("cell-init",this.bindEditor.bind(this)),this.subscribe("cell-delete",this.clearEdited.bind(this)),this.subscribe("cell-value-changed",this.updateCellClass.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("column-delete",this.columnDeleteCheck.bind(this)),this.subscribe("row-deleting",this.rowDeleteCheck.bind(this)),this.subscribe("row-layout",this.rowEditableCheck.bind(this)),this.subscribe("data-refreshing",this.cancelEdit.bind(this)),this.subscribe("clipboard-paste",this.pasteBlocker.bind(this)),this.subscribe("keybinding-nav-prev",this.navigatePrev.bind(this,void 0)),this.subscribe("keybinding-nav-next",this.keybindingNavigateNext.bind(this)),this.subscribe("keybinding-nav-up",this.navigateUp.bind(this,void 0)),this.subscribe("keybinding-nav-down",this.navigateDown.bind(this,void 0)),Object.keys(this.table.options).includes("editorEmptyValue")&&(this.convertEmptyValues=!0)}pasteBlocker(e){if(this.currentCell)return!0}keybindingNavigateNext(e){var t=this.currentCell,i=this.options("tabEndNewRow");t&&(this.navigateNext(t,e)||i&&(t.getElement().firstChild.blur(),this.invalidEdit||(i===!0?i=this.table.addRow({}):typeof i=="function"?i=this.table.addRow(i(t.row.getComponent())):i=this.table.addRow(Object.assign({},i)),i.then(()=>{setTimeout(()=>{t.getComponent().navigateNext()})}))))}cellIsEdited(e){return!!e.modules.edit&&e.modules.edit.edited}cellCancelEdit(e){e===this.currentCell?this.table.modules.edit.cancelEdit():console.warn("Cancel Editor Error - This cell is not currently being edited ")}updateCellClass(e){this.allowEdit(e)?e.getElement().classList.add("tabulator-editable"):e.getElement().classList.remove("tabulator-editable")}clearCellEdited(e){e||(e=this.table.modules.edit.getEditedCells()),Array.isArray(e)||(e=[e]),e.forEach(t=>{this.table.modules.edit.clearEdited(t._getSelf())})}navigatePrev(e=this.currentCell,t){var i,n;if(e){if(t&&t.preventDefault(),i=this.navigateLeft(),i)return!0;if(n=this.table.rowManager.prevDisplayRow(e.row,!0),n&&(i=this.findPrevEditableCell(n,n.cells.length),i))return i.getComponent().edit(),!0}return!1}navigateNext(e=this.currentCell,t){var i,n;if(e){if(t&&t.preventDefault(),i=this.navigateRight(),i)return!0;if(n=this.table.rowManager.nextDisplayRow(e.row,!0),n&&(i=this.findNextEditableCell(n,-1),i))return i.getComponent().edit(),!0}return!1}navigateLeft(e=this.currentCell,t){var i,n;return e&&(t&&t.preventDefault(),i=e.getIndex(),n=this.findPrevEditableCell(e.row,i),n)?(n.getComponent().edit(),!0):!1}navigateRight(e=this.currentCell,t){var i,n;return e&&(t&&t.preventDefault(),i=e.getIndex(),n=this.findNextEditableCell(e.row,i),n)?(n.getComponent().edit(),!0):!1}navigateUp(e=this.currentCell,t){var i,n;return e&&(t&&t.preventDefault(),i=e.getIndex(),n=this.table.rowManager.prevDisplayRow(e.row,!0),n)?(n.cells[i].getComponent().edit(),!0):!1}navigateDown(e=this.currentCell,t){var i,n;return e&&(t&&t.preventDefault(),i=e.getIndex(),n=this.table.rowManager.nextDisplayRow(e.row,!0),n)?(n.cells[i].getComponent().edit(),!0):!1}findNextEditableCell(e,t){var i=!1;if(t<e.cells.length-1)for(var n=t+1;n<e.cells.length;n++){let s=e.cells[n];if(s.column.modules.edit&&Ze.elVisible(s.getElement())&&this.allowEdit(s)){i=s;break}}return i}findPrevEditableCell(e,t){var i=!1;if(t>0)for(var n=t-1;n>=0;n--){let s=e.cells[n];if(s.column.modules.edit&&Ze.elVisible(s.getElement())&&this.allowEdit(s)){i=s;break}}return i}initializeColumnCheck(e){typeof e.definition.editor<"u"&&this.initializeColumn(e)}columnDeleteCheck(e){this.currentCell&&this.currentCell.column===e&&this.cancelEdit()}rowDeleteCheck(e){this.currentCell&&this.currentCell.row===e&&this.cancelEdit()}rowEditableCheck(e){e.getCells().forEach(t=>{t.column.modules.edit&&typeof t.column.modules.edit.check=="function"&&this.updateCellClass(t)})}initializeColumn(e){var t=Object.keys(e.definition).includes("editorEmptyValue"),i={editor:!1,blocked:!1,check:e.definition.editable,params:e.definition.editorParams||{},convertEmptyValues:t,editorEmptyValue:e.definition.editorEmptyValue,editorEmptyValueFunc:e.definition.editorEmptyValueFunc};switch(typeof e.definition.editor){case"string":this.editors[e.definition.editor]?i.editor=this.editors[e.definition.editor]:console.warn("Editor Error - No such editor found: ",e.definition.editor);break;case"function":i.editor=e.definition.editor;break;case"boolean":e.definition.editor===!0&&(typeof e.definition.formatter!="function"?this.editors[e.definition.formatter]?i.editor=this.editors[e.definition.formatter]:i.editor=this.editors.input:console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ",e.definition.formatter));break}i.editor&&(e.modules.edit=i)}getCurrentCell(){return this.currentCell?this.currentCell.getComponent():!1}clearEditor(e){var t=this.currentCell,i;if(this.invalidEdit=!1,t){for(this.currentCell=!1,i=t.getElement(),this.dispatch("edit-editor-clear",t,e),i.classList.remove("tabulator-editing");i.firstChild;)i.removeChild(i.firstChild);t.row.getElement().classList.remove("tabulator-editing"),t.table.element.classList.remove("tabulator-editing")}}cancelEdit(){if(this.currentCell){var e=this.currentCell,t=this.currentCell.getComponent();this.clearEditor(!0),e.setValueActual(e.getValue()),e.cellRendered(),(e.column.definition.editor=="textarea"||e.column.definition.variableHeight)&&e.row.normalizeHeight(!0),e.column.definition.cellEditCancelled&&e.column.definition.cellEditCancelled.call(this.table,t),this.dispatch("edit-cancelled",e),this.dispatchExternal("cellEditCancelled",t)}}bindEditor(e){if(e.column.modules.edit){var t=this,i=e.getElement(!0);this.updateCellClass(e),i.setAttribute("tabindex",0),i.addEventListener("mousedown",function(n){n.button===2?n.preventDefault():t.mouseClick=!0}),this.options("editTriggerEvent")==="dblclick"&&i.addEventListener("dblclick",function(n){i.classList.contains("tabulator-editing")||(i.focus({preventScroll:!0}),t.edit(e,n,!1))}),(this.options("editTriggerEvent")==="focus"||this.options("editTriggerEvent")==="click")&&i.addEventListener("click",function(n){i.classList.contains("tabulator-editing")||(i.focus({preventScroll:!0}),t.edit(e,n,!1))}),this.options("editTriggerEvent")==="focus"&&i.addEventListener("focus",function(n){t.recursionBlock||t.edit(e,n,!1)})}}focusCellNoEvent(e,t){this.recursionBlock=!0,t&&this.table.browser==="ie"||e.getElement().focus({preventScroll:!0}),this.recursionBlock=!1}editCell(e,t){this.focusCellNoEvent(e),this.edit(e,!1,t)}focusScrollAdjust(e){if(this.table.rowManager.getRenderMode()=="virtual"){var t=this.table.rowManager.element.scrollTop,i=this.table.rowManager.element.clientHeight+this.table.rowManager.element.scrollTop,n=e.row.getElement();n.offsetTop<t?this.table.rowManager.element.scrollTop-=t-n.offsetTop:n.offsetTop+n.offsetHeight>i&&(this.table.rowManager.element.scrollTop+=n.offsetTop+n.offsetHeight-i);var s=this.table.rowManager.element.scrollLeft,o=this.table.rowManager.element.clientWidth+this.table.rowManager.element.scrollLeft,a=e.getElement();this.table.modExists("frozenColumns")&&(s+=parseInt(this.table.modules.frozenColumns.leftMargin||0),o-=parseInt(this.table.modules.frozenColumns.rightMargin||0)),this.table.options.renderHorizontal==="virtual"&&(s-=parseInt(this.table.columnManager.renderer.vDomPadLeft),o-=parseInt(this.table.columnManager.renderer.vDomPadLeft)),a.offsetLeft<s?this.table.rowManager.element.scrollLeft-=s-a.offsetLeft:a.offsetLeft+a.offsetWidth>o&&(this.table.rowManager.element.scrollLeft+=a.offsetLeft+a.offsetWidth-o)}}allowEdit(e){var t=!!e.column.modules.edit;if(e.column.modules.edit)switch(typeof e.column.modules.edit.check){case"function":e.row.initialized&&(t=e.column.modules.edit.check(e.getComponent()));break;case"string":t=!!e.row.data[e.column.modules.edit.check];break;case"boolean":t=e.column.modules.edit.check;break}return t}edit(e,t,i){var n=this,s=!0,o=function(){},a=e.getElement(),l=!1,h,u,c;if(this.currentCell){!this.invalidEdit&&this.currentCell!==e&&this.cancelEdit();return}function d(y){if(n.currentCell===e&&!l){var E=n.chain("edit-success",[e,y],!0,!0);return E===!0||n.table.options.validationMode==="highlight"?(l=!0,n.clearEditor(),e.modules.edit||(e.modules.edit={}),e.modules.edit.edited=!0,n.editedCells.indexOf(e)==-1&&n.editedCells.push(e),y=n.transformEmptyValues(y,e),e.setValue(y,!0),E===!0):(l=!0,n.invalidEdit=!0,n.focusCellNoEvent(e,!0),o(),setTimeout(()=>{l=!1},10),!1)}}function f(){n.currentCell===e&&!l&&n.cancelEdit()}function g(y){o=y}if(e.column.modules.edit.blocked)return this.mouseClick=!1,this.blur(a),!1;if(t&&t.stopPropagation(),s=this.allowEdit(e),s||i){if(n.cancelEdit(),n.currentCell=e,this.focusScrollAdjust(e),u=e.getComponent(),this.mouseClick&&(this.mouseClick=!1,e.column.definition.cellClick&&e.column.definition.cellClick.call(this.table,t,u)),e.column.definition.cellEditing&&e.column.definition.cellEditing.call(this.table,u),this.dispatch("cell-editing",e),this.dispatchExternal("cellEditing",u),c=typeof e.column.modules.edit.params=="function"?e.column.modules.edit.params(u):e.column.modules.edit.params,h=e.column.modules.edit.editor.call(n,u,g,d,f,c),this.currentCell&&h!==!1)if(h instanceof Node){for(a.classList.add("tabulator-editing"),e.row.getElement().classList.add("tabulator-editing"),e.table.element.classList.add("tabulator-editing");a.firstChild;)a.removeChild(a.firstChild);a.appendChild(h),o();for(var m=a.children,w=0;w<m.length;w++)m[w].addEventListener("click",function(y){y.stopPropagation()})}else return console.warn("Edit Error - Editor should return an instance of Node, the editor returned:",h),this.blur(a),!1;else return this.blur(a),!1;return!0}else return this.mouseClick=!1,this.blur(a),!1}emptyValueCheck(e){return e===""||e===null||typeof e>"u"}transformEmptyValues(e,t){var i=t.column.modules.edit,n=i.convertEmptyValues||this.convertEmptyValues,s;return n&&(s=i.editorEmptyValueFunc||this.options("editorEmptyValueFunc"),s&&s(e)&&(e=i.convertEmptyValues?i.editorEmptyValue:this.options("editorEmptyValue"))),e}blur(e){this.confirm("edit-blur",[e])||e.blur()}getEditedCells(){var e=[];return this.editedCells.forEach(t=>{e.push(t.getComponent())}),e}clearEdited(e){var t;e.modules.edit&&e.modules.edit.edited&&(e.modules.edit.edited=!1,this.dispatch("edit-edited-clear",e)),t=this.editedCells.indexOf(e),t>-1&&this.editedCells.splice(t,1)}};K(Eo,"moduleName","edit"),K(Eo,"editors",XO);let dc=Eo;class jp{constructor(e,t,i,n){this.type=e,this.columns=t,this.component=i||!1,this.indent=n||0}}class du{constructor(e,t,i,n,s){this.value=e,this.component=t||!1,this.width=i,this.height=n,this.depth=s}}var $O={},ZO={visible:function(){return this.rowManager.getVisibleRows(!1,!0)},all:function(){return this.rowManager.rows},selected:function(){return this.modules.selectRow.selectedRows},active:function(){return this.options.pagination?this.rowManager.getDisplayRows(this.rowManager.displayRows.length-2):this.rowManager.getDisplayRows()}};const Xn=class Xn extends Le{constructor(e){super(e),this.config={},this.cloneTableStyle=!0,this.colVisProp="",this.colVisPropAttach="",this.registerTableOption("htmlOutputConfig",!1),this.registerColumnOption("htmlOutput"),this.registerColumnOption("titleHtmlOutput")}initialize(){this.registerTableFunction("getHtml",this.getHtml.bind(this))}generateExportList(e,t,i,n){var s,o,a,l;return this.cloneTableStyle=t,this.config=e||{},this.colVisProp=n,this.colVisPropAttach=this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1),l=Xn.columnLookups[i],l&&(a=l.call(this.table),a=a.filter(h=>this.columnVisCheck(h))),s=this.config.columnHeaders!==!1?this.headersToExportRows(this.generateColumnGroupHeaders(a)):[],a&&(a=a.map(h=>h.getComponent())),o=this.bodyToExportRows(this.rowLookup(i),a),s.concat(o)}generateTable(e,t,i,n){var s=this.generateExportList(e,t,i,n);return this.generateTableElement(s)}rowLookup(e){var t=[],i;return typeof e=="function"?e.call(this.table).forEach(n=>{n=this.table.rowManager.findRow(n),n&&t.push(n)}):(i=Xn.rowLookups[e]||Xn.rowLookups.active,t=i.call(this.table)),Object.assign([],t)}generateColumnGroupHeaders(e){var t=[];return e||(e=this.config.columnGroups!==!1?this.table.columnManager.columns:this.table.columnManager.columnsByIndex),e.forEach(i=>{var n=this.processColumnGroup(i);n&&t.push(n)}),t}processColumnGroup(e){var t=e.columns,i=0,n=e.definition["title"+this.colVisPropAttach]||e.definition.title,s={title:n,column:e,depth:1};if(t.length){if(s.subGroups=[],s.width=0,t.forEach(o=>{var a=this.processColumnGroup(o);a&&(s.width+=a.width,s.subGroups.push(a),a.depth>i&&(i=a.depth))}),s.depth+=i,!s.width)return!1}else if(this.columnVisCheck(e))s.width=1;else return!1;return s}columnVisCheck(e){var t=e.definition[this.colVisProp];return this.config.rowHeaders===!1&&e.isRowHeader?!1:(typeof t=="function"&&(t=t.call(this.table,e.getComponent())),t===!1||t===!0?t:e.visible&&e.field)}headersToExportRows(e){var t=[],i=0,n=[];function s(o,a){var l=i-a;if(typeof t[a]>"u"&&(t[a]=[]),o.height=o.subGroups?1:l-o.depth+1,t[a].push(o),o.height>1)for(let h=1;h<o.height;h++)typeof t[a+h]>"u"&&(t[a+h]=[]),t[a+h].push(!1);if(o.width>1)for(let h=1;h<o.width;h++)t[a].push(!1);o.subGroups&&o.subGroups.forEach(function(h){s(h,a+1)})}return e.forEach(function(o){o.depth>i&&(i=o.depth)}),e.forEach(function(o){s(o,0)}),t.forEach(o=>{var a=[];o.forEach(l=>{if(l){let h=typeof l.title>"u"?"":l.title;a.push(new du(h,l.column.getComponent(),l.width,l.height,l.depth))}else a.push(null)}),n.push(new jp("header",a))}),n}bodyToExportRows(e,t=[]){var i=[];return t.length===0&&this.table.columnManager.columnsByIndex.forEach(n=>{this.columnVisCheck(n)&&t.push(n.getComponent())}),this.config.columnCalcs!==!1&&this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&e.unshift(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&e.push(this.table.modules.columnCalcs.botRow)),e=e.filter(n=>{switch(n.type){case"group":return this.config.rowGroups!==!1;case"calc":return this.config.columnCalcs!==!1;case"row":return!(this.table.options.dataTree&&this.config.dataTree===!1&&n.modules.dataTree.parent)}return!0}),e.forEach((n,s)=>{var o=n.getData(this.colVisProp),a=[],l=0;switch(n.type){case"group":l=n.level,a.push(new du(n.key,n.getComponent(),t.length,1));break;case"calc":case"row":t.forEach(h=>{a.push(new du(h._column.getFieldValue(o),h,1,1))}),this.table.options.dataTree&&this.config.dataTree!==!1&&(l=n.modules.dataTree.index);break}i.push(new jp(n.type,a,n.getComponent(),l))}),i}generateTableElement(e){var t=document.createElement("table"),i=document.createElement("thead"),n=document.createElement("tbody"),s=this.lookupTableStyles(),o=this.table.options["rowFormatter"+this.colVisPropAttach],a={};return a.rowFormatter=o!==null?o:this.table.options.rowFormatter,this.table.options.dataTree&&this.config.dataTree!==!1&&this.table.modExists("columnCalcs")&&(a.treeElementField=this.table.modules.dataTree.elementField),a.groupHeader=this.table.options["groupHeader"+this.colVisPropAttach],a.groupHeader&&!Array.isArray(a.groupHeader)&&(a.groupHeader=[a.groupHeader]),t.classList.add("tabulator-print-table"),this.mapElementStyles(this.table.columnManager.getHeadersElement(),i,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),e.length>1e3&&console.warn("It may take a long time to render an HTML table with more than 1000 rows"),e.forEach((l,h)=>{let u;switch(l.type){case"header":i.appendChild(this.generateHeaderElement(l,a,s));break;case"group":n.appendChild(this.generateGroupElement(l,a,s));break;case"calc":n.appendChild(this.generateCalcElement(l,a,s));break;case"row":u=this.generateRowElement(l,a,s),this.mapElementStyles(h%2&&s.evenRow?s.evenRow:s.oddRow,u,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),n.appendChild(u);break}}),i.innerHTML&&t.appendChild(i),t.appendChild(n),this.mapElementStyles(this.table.element,t,["border-top","border-left","border-right","border-bottom"]),t}lookupTableStyles(){var e={};return this.cloneTableStyle&&window.getComputedStyle&&(e.oddRow=this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)"),e.evenRow=this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)"),e.calcRow=this.table.element.querySelector(".tabulator-row.tabulator-calcs"),e.firstRow=this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)"),e.firstGroup=this.table.element.getElementsByClassName("tabulator-group")[0],e.firstRow&&(e.styleCells=e.firstRow.getElementsByClassName("tabulator-cell"),e.styleRowHeader=e.firstRow.getElementsByClassName("tabulator-row-header")[0],e.firstCell=e.styleCells[0],e.lastCell=e.styleCells[e.styleCells.length-1])),e}generateHeaderElement(e,t,i){var n=document.createElement("tr");return e.columns.forEach(s=>{if(s){var o=document.createElement("th"),a=s.component._column.definition.cssClass?s.component._column.definition.cssClass.split(" "):[];o.colSpan=s.width,o.rowSpan=s.height,o.innerHTML=s.value,this.cloneTableStyle&&(o.style.boxSizing="border-box"),a.forEach(function(l){o.classList.add(l)}),this.mapElementStyles(s.component.getElement(),o,["text-align","border-left","border-right","background-color","color","font-weight","font-family","font-size"]),this.mapElementStyles(s.component._column.contentElement,o,["padding-top","padding-left","padding-right","padding-bottom"]),s.component._column.visible?this.mapElementStyles(s.component.getElement(),o,["width"]):s.component._column.definition.width&&(o.style.width=s.component._column.definition.width+"px"),s.component._column.parent&&s.component._column.parent.isGroup?this.mapElementStyles(s.component._column.parent.groupElement,o,["border-top"]):this.mapElementStyles(s.component.getElement(),o,["border-top"]),s.component._column.isGroup?this.mapElementStyles(s.component.getElement(),o,["border-bottom"]):this.mapElementStyles(this.table.columnManager.getElement(),o,["border-bottom"]),n.appendChild(o)}}),n}generateGroupElement(e,t,i){var n=document.createElement("tr"),s=document.createElement("td"),o=e.columns[0];return n.classList.add("tabulator-print-table-row"),t.groupHeader&&t.groupHeader[e.indent]?o.value=t.groupHeader[e.indent](o.value,e.component._group.getRowCount(),e.component._group.getData(),e.component):t.groupHeader!==!1&&(o.value=e.component._group.generator(o.value,e.component._group.getRowCount(),e.component._group.getData(),e.component)),s.colSpan=o.width,s.innerHTML=o.value,n.classList.add("tabulator-print-table-group"),n.classList.add("tabulator-group-level-"+e.indent),o.component.isVisible()&&n.classList.add("tabulator-group-visible"),this.mapElementStyles(i.firstGroup,n,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),this.mapElementStyles(i.firstGroup,s,["padding-top","padding-left","padding-right","padding-bottom"]),n.appendChild(s),n}generateCalcElement(e,t,i){var n=this.generateRowElement(e,t,i);return n.classList.add("tabulator-print-table-calcs"),this.mapElementStyles(i.calcRow,n,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),n}generateRowElement(e,t,i){var n=document.createElement("tr");if(n.classList.add("tabulator-print-table-row"),e.columns.forEach((s,o)=>{if(s){var a=document.createElement("td"),l=s.component._column,h=this.table,u=h.columnManager.findColumnIndex(l),c=s.value,d,f,g={modules:{},getValue:function(){return c},getField:function(){return l.definition.field},getElement:function(){return a},getType:function(){return"cell"},getColumn:function(){return l.getComponent()},getData:function(){return e.component.getData()},getRow:function(){return e.component},getTable:function(){return h},getComponent:function(){return g},column:l},m=l.definition.cssClass?l.definition.cssClass.split(" "):[];if(m.forEach(function(w){a.classList.add(w)}),this.table.modExists("format")&&this.config.formatCells!==!1)c=this.table.modules.format.formatExportValue(g,this.colVisProp);else switch(typeof c){case"object":c=c!==null?JSON.stringify(c):"";break;case"undefined":c="";break}c instanceof Node?a.appendChild(c):a.innerHTML=c,f=["padding-top","padding-left","padding-right","padding-bottom","border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","text-align"],l.isRowHeader?(d=i.styleRowHeader,f.push("background-color")):d=i.styleCells&&i.styleCells[u]?i.styleCells[u]:i.firstCell,d&&(this.mapElementStyles(d,a,f),l.definition.align&&(a.style.textAlign=l.definition.align)),this.table.options.dataTree&&this.config.dataTree!==!1&&(t.treeElementField&&t.treeElementField==l.field||!t.treeElementField&&o==0)&&(e.component._row.modules.dataTree.controlEl&&a.insertBefore(e.component._row.modules.dataTree.controlEl.cloneNode(!0),a.firstChild),e.component._row.modules.dataTree.branchEl&&a.insertBefore(e.component._row.modules.dataTree.branchEl.cloneNode(!0),a.firstChild)),n.appendChild(a),g.modules.format&&g.modules.format.renderedCallback&&g.modules.format.renderedCallback()}}),t.rowFormatter&&e.type==="row"&&this.config.formatCells!==!1){let s=Object.assign(e.component);s.getElement=function(){return n},t.rowFormatter(e.component)}return n}generateHTMLTable(e){var t=document.createElement("div");return t.appendChild(this.generateTableElement(e)),t.innerHTML}getHtml(e,t,i,n){var s=this.generateExportList(i||this.table.options.htmlOutputConfig,t,e,n||"htmlOutput");return this.generateHTMLTable(s)}mapElementStyles(e,t,i){if(this.cloneTableStyle&&e&&t){var n={"background-color":"backgroundColor",color:"fontColor",width:"width","font-weight":"fontWeight","font-family":"fontFamily","font-size":"fontSize","text-align":"textAlign","border-top":"borderTop","border-left":"borderLeft","border-right":"borderRight","border-bottom":"borderBottom","padding-top":"paddingTop","padding-left":"paddingLeft","padding-right":"paddingRight","padding-bottom":"paddingBottom"};if(window.getComputedStyle){var s=window.getComputedStyle(e);i.forEach(function(o){t.style[n[o]]||(t.style[n[o]]=s.getPropertyValue(o))})}}}};K(Xn,"moduleName","export"),K(Xn,"columnLookups",$O),K(Xn,"rowLookups",ZO);let fc=Xn;var KO={"=":function(r,e,t,i){return e==r},"<":function(r,e,t,i){return e<r},"<=":function(r,e,t,i){return e<=r},">":function(r,e,t,i){return e>r},">=":function(r,e,t,i){return e>=r},"!=":function(r,e,t,i){return e!=r},regex:function(r,e,t,i){return typeof r=="string"&&(r=new RegExp(r)),r.test(e)},like:function(r,e,t,i){return r===null||typeof r>"u"?e===r:typeof e<"u"&&e!==null?String(e).toLowerCase().indexOf(r.toLowerCase())>-1:!1},keywords:function(r,e,t,i){var n=r.toLowerCase().split(typeof i.separator>"u"?" ":i.separator),s=String(e===null||typeof e>"u"?"":e).toLowerCase(),o=[];return n.forEach(a=>{s.includes(a)&&o.push(!0)}),i.matchAll?o.length===n.length:!!o.length},starts:function(r,e,t,i){return r===null||typeof r>"u"?e===r:typeof e<"u"&&e!==null?String(e).toLowerCase().startsWith(r.toLowerCase()):!1},ends:function(r,e,t,i){return r===null||typeof r>"u"?e===r:typeof e<"u"&&e!==null?String(e).toLowerCase().endsWith(r.toLowerCase()):!1},in:function(r,e,t,i){return Array.isArray(r)?r.length?r.indexOf(e)>-1:!0:(console.warn("Filter Error - filter value is not an array:",r),!1)}};const yn=class yn extends Le{constructor(e){super(e),this.filterList=[],this.headerFilters={},this.headerFilterColumns=[],this.prevHeaderFilterChangeCheck="",this.prevHeaderFilterChangeCheck="{}",this.changed=!1,this.tableInitialized=!1,this.registerTableOption("filterMode","local"),this.registerTableOption("initialFilter",!1),this.registerTableOption("initialHeaderFilter",!1),this.registerTableOption("headerFilterLiveFilterDelay",300),this.registerTableOption("placeholderHeaderFilter",!1),this.registerColumnOption("headerFilter"),this.registerColumnOption("headerFilterPlaceholder"),this.registerColumnOption("headerFilterParams"),this.registerColumnOption("headerFilterEmptyCheck"),this.registerColumnOption("headerFilterFunc"),this.registerColumnOption("headerFilterFuncParams"),this.registerColumnOption("headerFilterLiveFilter"),this.registerTableFunction("searchRows",this.searchRows.bind(this)),this.registerTableFunction("searchData",this.searchData.bind(this)),this.registerTableFunction("setFilter",this.userSetFilter.bind(this)),this.registerTableFunction("refreshFilter",this.userRefreshFilter.bind(this)),this.registerTableFunction("addFilter",this.userAddFilter.bind(this)),this.registerTableFunction("getFilters",this.getFilters.bind(this)),this.registerTableFunction("setHeaderFilterFocus",this.userSetHeaderFilterFocus.bind(this)),this.registerTableFunction("getHeaderFilterValue",this.userGetHeaderFilterValue.bind(this)),this.registerTableFunction("setHeaderFilterValue",this.userSetHeaderFilterValue.bind(this)),this.registerTableFunction("getHeaderFilters",this.getHeaderFilters.bind(this)),this.registerTableFunction("removeFilter",this.userRemoveFilter.bind(this)),this.registerTableFunction("clearFilter",this.userClearFilter.bind(this)),this.registerTableFunction("clearHeaderFilter",this.userClearHeaderFilter.bind(this)),this.registerComponentFunction("column","headerFilterFocus",this.setHeaderFilterFocus.bind(this)),this.registerComponentFunction("column","reloadHeaderFilter",this.reloadHeaderFilter.bind(this)),this.registerComponentFunction("column","getHeaderFilterValue",this.getHeaderFilterValue.bind(this)),this.registerComponentFunction("column","setHeaderFilterValue",this.setHeaderFilterValue.bind(this))}initialize(){this.subscribe("column-init",this.initializeColumnHeaderFilter.bind(this)),this.subscribe("column-width-fit-before",this.hideHeaderFilterElements.bind(this)),this.subscribe("column-width-fit-after",this.showHeaderFilterElements.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.subscribe("placeholder",this.generatePlaceholder.bind(this)),this.table.options.filterMode==="remote"&&this.subscribe("data-params",this.remoteFilterParams.bind(this)),this.registerDataHandler(this.filter.bind(this),10)}tableBuilt(){this.table.options.initialFilter&&this.setFilter(this.table.options.initialFilter),this.table.options.initialHeaderFilter&&this.table.options.initialHeaderFilter.forEach(e=>{var t=this.table.columnManager.findColumn(e.field);if(t)this.setHeaderFilterValue(t,e.value);else return console.warn("Column Filter Error - No matching column found:",e.field),!1}),this.tableInitialized=!0}remoteFilterParams(e,t,i,n){return n.filter=this.getFilters(!0,!0),n}generatePlaceholder(e){if(this.table.options.placeholderHeaderFilter&&Object.keys(this.headerFilters).length)return this.table.options.placeholderHeaderFilter}userSetFilter(e,t,i,n){this.setFilter(e,t,i,n),this.refreshFilter()}userRefreshFilter(){this.refreshFilter()}userAddFilter(e,t,i,n){this.addFilter(e,t,i,n),this.refreshFilter()}userSetHeaderFilterFocus(e){var t=this.table.columnManager.findColumn(e);if(t)this.setHeaderFilterFocus(t);else return console.warn("Column Filter Focus Error - No matching column found:",e),!1}userGetHeaderFilterValue(e){var t=this.table.columnManager.findColumn(e);if(t)return this.getHeaderFilterValue(t);console.warn("Column Filter Error - No matching column found:",e)}userSetHeaderFilterValue(e,t){var i=this.table.columnManager.findColumn(e);if(i)this.setHeaderFilterValue(i,t);else return console.warn("Column Filter Error - No matching column found:",e),!1}userRemoveFilter(e,t,i){this.removeFilter(e,t,i),this.refreshFilter()}userClearFilter(e){this.clearFilter(e),this.refreshFilter()}userClearHeaderFilter(){this.clearHeaderFilter(),this.refreshFilter()}searchRows(e,t,i){return this.search("rows",e,t,i)}searchData(e,t,i){return this.search("data",e,t,i)}initializeColumnHeaderFilter(e){var t=e.definition;t.headerFilter&&this.initializeColumn(e)}initializeColumn(e,t){var i=this,n=e.getField();function s(o){var a=e.modules.filter.tagType=="input"&&e.modules.filter.attrType=="text"||e.modules.filter.tagType=="textarea"?"partial":"match",l="",h="",u;if(typeof e.modules.filter.prevSuccess>"u"||e.modules.filter.prevSuccess!==o){if(e.modules.filter.prevSuccess=o,e.modules.filter.emptyFunc(o))delete i.headerFilters[n];else{switch(e.modules.filter.value=o,typeof e.definition.headerFilterFunc){case"string":yn.filters[e.definition.headerFilterFunc]?(l=e.definition.headerFilterFunc,u=function(c){var d=e.definition.headerFilterFuncParams||{},f=e.getFieldValue(c);return d=typeof d=="function"?d(o,f,c):d,yn.filters[e.definition.headerFilterFunc](o,f,c,d)}):console.warn("Header Filter Error - Matching filter function not found: ",e.definition.headerFilterFunc);break;case"function":u=function(c){var d=e.definition.headerFilterFuncParams||{},f=e.getFieldValue(c);return d=typeof d=="function"?d(o,f,c):d,e.definition.headerFilterFunc(o,f,c,d)},l=u;break}if(!u)switch(a){case"partial":u=function(c){var d=e.getFieldValue(c);return typeof d<"u"&&d!==null?String(d).toLowerCase().indexOf(String(o).toLowerCase())>-1:!1},l="like";break;default:u=function(c){return e.getFieldValue(c)==o},l="="}i.headerFilters[n]={value:o,func:u,type:l}}e.modules.filter.value=o,h=JSON.stringify(i.headerFilters),i.prevHeaderFilterChangeCheck!==h&&(i.prevHeaderFilterChangeCheck=h,i.trackChanges(),i.refreshFilter())}return!0}e.modules.filter={success:s,attrType:!1,tagType:!1,emptyFunc:!1},this.generateHeaderFilterElement(e)}generateHeaderFilterElement(e,t,i){var n=this,s=e.modules.filter.success,o=e.getField(),a,l,h,u,c,d,f,g;e.modules.filter.value=t;function m(){}function w(y){g=y}if(e.modules.filter.headerElement&&e.modules.filter.headerElement.parentNode&&e.contentElement.removeChild(e.modules.filter.headerElement.parentNode),o){switch(e.modules.filter.emptyFunc=e.definition.headerFilterEmptyCheck||function(y){return!y&&y!==0},a=document.createElement("div"),a.classList.add("tabulator-header-filter"),typeof e.definition.headerFilter){case"string":n.table.modules.edit.editors[e.definition.headerFilter]?(l=n.table.modules.edit.editors[e.definition.headerFilter],(e.definition.headerFilter==="tick"||e.definition.headerFilter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(y){return y!==!0&&y!==!1})):console.warn("Filter Error - Cannot build header filter, No such editor found: ",e.definition.editor);break;case"function":l=e.definition.headerFilter;break;case"boolean":e.modules.edit&&e.modules.edit.editor?l=e.modules.edit.editor:e.definition.formatter&&n.table.modules.edit.editors[e.definition.formatter]?(l=n.table.modules.edit.editors[e.definition.formatter],(e.definition.formatter==="tick"||e.definition.formatter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(y){return y!==!0&&y!==!1})):l=n.table.modules.edit.editors.input;break}if(l){if(u={getValue:function(){return typeof t<"u"?t:""},getField:function(){return e.definition.field},getElement:function(){return a},getColumn:function(){return e.getComponent()},getTable:()=>this.table,getType:()=>"header",getRow:function(){return{normalizeHeight:function(){}}}},f=e.definition.headerFilterParams||{},f=typeof f=="function"?f.call(n.table,u):f,h=l.call(this.table.modules.edit,u,w,s,m,f),!h){console.warn("Filter Error - Cannot add filter to "+o+" column, editor returned a value of false");return}if(!(h instanceof Node)){console.warn("Filter Error - Cannot add filter to "+o+" column, editor should return an instance of Node, the editor returned:",h);return}n.langBind("headerFilters|columns|"+e.definition.field,function(y){h.setAttribute("placeholder",typeof y<"u"&&y?y:e.definition.headerFilterPlaceholder||n.langText("headerFilters|default"))}),h.addEventListener("click",function(y){y.stopPropagation(),h.focus()}),h.addEventListener("focus",y=>{var E=this.table.columnManager.contentsElement.scrollLeft,x=this.table.rowManager.element.scrollLeft;E!==x&&(this.table.rowManager.scrollHorizontal(E),this.table.columnManager.scrollHorizontal(E))}),c=!1,d=function(y){c&&clearTimeout(c),c=setTimeout(function(){s(h.value)},n.table.options.headerFilterLiveFilterDelay)},e.modules.filter.headerElement=h,e.modules.filter.attrType=h.hasAttribute("type")?h.getAttribute("type").toLowerCase():"",e.modules.filter.tagType=h.tagName.toLowerCase(),e.definition.headerFilterLiveFilter!==!1&&(e.definition.headerFilter==="autocomplete"||e.definition.headerFilter==="tickCross"||(e.definition.editor==="autocomplete"||e.definition.editor==="tickCross")&&e.definition.headerFilter===!0||(h.addEventListener("keyup",d),h.addEventListener("search",d),e.modules.filter.attrType=="number"&&h.addEventListener("change",function(y){s(h.value)}),e.modules.filter.attrType=="text"&&this.table.browser!=="ie"&&h.setAttribute("type","search")),(e.modules.filter.tagType=="input"||e.modules.filter.tagType=="select"||e.modules.filter.tagType=="textarea")&&h.addEventListener("mousedown",function(y){y.stopPropagation()})),a.appendChild(h),e.contentElement.appendChild(a),i||n.headerFilterColumns.push(e),g&&g()}}else console.warn("Filter Error - Cannot add header filter, column has no field set:",e.definition.title)}hideHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="none")})}showHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="")})}setHeaderFilterFocus(e){e.modules.filter&&e.modules.filter.headerElement?e.modules.filter.headerElement.focus():console.warn("Column Filter Focus Error - No header filter set on column:",e.getField())}getHeaderFilterValue(e){if(e.modules.filter&&e.modules.filter.headerElement)return e.modules.filter.value;console.warn("Column Filter Error - No header filter set on column:",e.getField())}setHeaderFilterValue(e,t){e&&(e.modules.filter&&e.modules.filter.headerElement?(this.generateHeaderFilterElement(e,t,!0),e.modules.filter.success(t)):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}reloadHeaderFilter(e){e&&(e.modules.filter&&e.modules.filter.headerElement?this.generateHeaderFilterElement(e,e.modules.filter.value,!0):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}refreshFilter(){this.tableInitialized&&(this.table.options.filterMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0))}trackChanges(){this.changed=!0,this.dispatch("filter-changed")}hasChanged(){var e=this.changed;return this.changed=!1,e}setFilter(e,t,i,n){this.filterList=[],Array.isArray(e)||(e=[{field:e,type:t,value:i,params:n}]),this.addFilter(e)}addFilter(e,t,i,n){var s=!1;Array.isArray(e)||(e=[{field:e,type:t,value:i,params:n}]),e.forEach(o=>{o=this.findFilter(o),o&&(this.filterList.push(o),s=!0)}),s&&this.trackChanges()}findFilter(e){var t;if(Array.isArray(e))return this.findSubFilters(e);var i=!1;return typeof e.field=="function"?i=function(n){return e.field(n,e.type||{})}:yn.filters[e.type]?(t=this.table.columnManager.getColumnByField(e.field),t?i=function(n){return yn.filters[e.type](e.value,t.getFieldValue(n),n,e.params||{})}:i=function(n){return yn.filters[e.type](e.value,n[e.field],n,e.params||{})}):console.warn("Filter Error - No such filter type found, ignoring: ",e.type),e.func=i,e.func?e:!1}findSubFilters(e){var t=[];return e.forEach(i=>{i=this.findFilter(i),i&&t.push(i)}),t.length?t:!1}getFilters(e,t){var i=[];return e&&(i=this.getHeaderFilters()),t&&i.forEach(function(n){typeof n.type=="function"&&(n.type="function")}),i=i.concat(this.filtersToArray(this.filterList,t)),i}filtersToArray(e,t){var i=[];return e.forEach(n=>{var s;Array.isArray(n)?i.push(this.filtersToArray(n,t)):(s={field:n.field,type:n.type,value:n.value},t&&typeof s.type=="function"&&(s.type="function"),i.push(s))}),i}getHeaderFilters(){var e=[];for(var t in this.headerFilters)e.push({field:t,type:this.headerFilters[t].type,value:this.headerFilters[t].value});return e}removeFilter(e,t,i){Array.isArray(e)||(e=[{field:e,type:t,value:i}]),e.forEach(n=>{var s=-1;typeof n.field=="object"?s=this.filterList.findIndex(o=>n===o):s=this.filterList.findIndex(o=>n.field===o.field&&n.type===o.type&&n.value===o.value),s>-1?this.filterList.splice(s,1):console.warn("Filter Error - No matching filter type found, ignoring: ",n.type)}),this.trackChanges()}clearFilter(e){this.filterList=[],e&&this.clearHeaderFilter(),this.trackChanges()}clearHeaderFilter(){this.headerFilters={},this.prevHeaderFilterChangeCheck="{}",this.headerFilterColumns.forEach(e=>{typeof e.modules.filter.value<"u"&&delete e.modules.filter.value,e.modules.filter.prevSuccess=void 0,this.reloadHeaderFilter(e)}),this.trackChanges()}search(e,t,i,n){var s=[],o=[];return Array.isArray(t)||(t=[{field:t,type:i,value:n}]),t.forEach(a=>{a=this.findFilter(a),a&&o.push(a)}),this.table.rowManager.rows.forEach(a=>{var l=!0;o.forEach(h=>{this.filterRecurse(h,a.getData())||(l=!1)}),l&&s.push(e==="data"?a.getData("data"):a.getComponent())}),s}filter(e,t){var i=[],n=[];return this.subscribedExternal("dataFiltering")&&this.dispatchExternal("dataFiltering",this.getFilters(!0)),this.table.options.filterMode!=="remote"&&(this.filterList.length||Object.keys(this.headerFilters).length)?e.forEach(s=>{this.filterRow(s)&&i.push(s)}):i=e.slice(0),this.subscribedExternal("dataFiltered")&&(i.forEach(s=>{n.push(s.getComponent())}),this.dispatchExternal("dataFiltered",this.getFilters(!0),n)),i}filterRow(e,t){var i=!0,n=e.getData();this.filterList.forEach(o=>{this.filterRecurse(o,n)||(i=!1)});for(var s in this.headerFilters)this.headerFilters[s].func(n)||(i=!1);return i}filterRecurse(e,t){var i=!1;return Array.isArray(e)?e.forEach(n=>{this.filterRecurse(n,t)&&(i=!0)}):i=e.func(t),i}};K(yn,"moduleName","filter"),K(yn,"filters",KO);let gc=yn;function qO(r,e,t){return this.emptyToSpace(this.sanitizeHTML(r.getValue()))}function JO(r,e,t){return r.getValue()}function QO(r,e,t){return r.getElement().style.whiteSpace="pre-wrap",this.emptyToSpace(this.sanitizeHTML(r.getValue()))}function eD(r,e,t){var i=parseFloat(r.getValue()),n="",s,o,a,l,h,u=e.decimal||".",c=e.thousand||",",d=e.negativeSign||"-",f=e.symbol||"",g=!!e.symbolAfter,m=typeof e.precision<"u"?e.precision:2;if(isNaN(i))return this.emptyToSpace(this.sanitizeHTML(r.getValue()));if(i<0&&(i=Math.abs(i),n=d),s=m!==!1?i.toFixed(m):i,s=String(s).split("."),o=s[0],a=s.length>1?u+s[1]:"",e.thousand!==!1)for(l=/(\d+)(\d{3})/;l.test(o);)o=o.replace(l,"$1"+c+"$2");return h=o+a,n===!0?(h="("+h+")",g?h+f:f+h):g?n+h+f:n+f+h}function tD(r,e,t){var i=r.getValue(),n=e.urlPrefix||"",s=e.download,o=i,a=document.createElement("a"),l;function h(u,c){var d=u.shift(),f=c[d];return u.length&&typeof f=="object"?h(u,f):f}if(e.labelField&&(l=r.getData(),o=h(e.labelField.split(this.table.options.nestedFieldSeparator),l)),e.label)switch(typeof e.label){case"string":o=e.label;break;case"function":o=e.label(r);break}if(o){if(e.urlField&&(l=r.getData(),i=Ze.retrieveNestedData(this.table.options.nestedFieldSeparator,e.urlField,l)),e.url)switch(typeof e.url){case"string":i=e.url;break;case"function":i=e.url(r);break}return a.setAttribute("href",n+i),e.target&&a.setAttribute("target",e.target),e.download&&(typeof s=="function"?s=s(r):s=s===!0?"":s,a.setAttribute("download",s)),a.innerHTML=this.emptyToSpace(this.sanitizeHTML(o)),a}else return"&nbsp;"}function iD(r,e,t){var i=document.createElement("img"),n=r.getValue();switch(e.urlPrefix&&(n=e.urlPrefix+r.getValue()),e.urlSuffix&&(n=n+e.urlSuffix),i.setAttribute("src",n),typeof e.height){case"number":i.style.height=e.height+"px";break;case"string":i.style.height=e.height;break}switch(typeof e.width){case"number":i.style.width=e.width+"px";break;case"string":i.style.width=e.width;break}return i.addEventListener("load",function(){r.getRow().normalizeHeight()}),i}function nD(r,e,t){var i=r.getValue(),n=r.getElement(),s=e.allowEmpty,o=e.allowTruthy,a=Object.keys(e).includes("trueValue"),l=typeof e.tickElement<"u"?e.tickElement:'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>',h=typeof e.crossElement<"u"?e.crossElement:'<svg enable-background="new 0 0 24 24" height="14" width="14"  viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';return a&&i===e.trueValue||!a&&(o&&i||i===!0||i==="true"||i==="True"||i===1||i==="1")?(n.setAttribute("aria-checked",!0),l||""):s&&(i==="null"||i===""||i===null||typeof i>"u")?(n.setAttribute("aria-checked","mixed"),""):(n.setAttribute("aria-checked",!1),h||"")}function rD(r,e,t){var i=window.DateTime||luxon.DateTime,n=e.inputFormat||"yyyy-MM-dd HH:mm:ss",s=e.outputFormat||"dd/MM/yyyy HH:mm:ss",o=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",a=r.getValue();if(typeof i<"u"){var l;return i.isDateTime(a)?l=a:n==="iso"?l=i.fromISO(String(a)):l=i.fromFormat(String(a),n),l.isValid?(e.timezone&&(l=l.setZone(e.timezone)),l.toFormat(s)):o===!0||!a?a:typeof o=="function"?o(a):o}else console.error("Format Error - 'datetime' formatter is dependant on luxon.js")}function sD(r,e,t){var i=window.DateTime||luxon.DateTime,n=e.inputFormat||"yyyy-MM-dd HH:mm:ss",s=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",o=typeof e.suffix<"u"?e.suffix:!1,a=typeof e.unit<"u"?e.unit:"days",l=typeof e.humanize<"u"?e.humanize:!1,h=typeof e.date<"u"?e.date:i.now(),u=r.getValue();if(typeof i<"u"){var c;return i.isDateTime(u)?c=u:n==="iso"?c=i.fromISO(String(u)):c=i.fromFormat(String(u),n),c.isValid?l?c.diff(h,a).toHuman()+(o?" "+o:""):parseInt(c.diff(h,a)[a])+(o?" "+o:""):s===!0?u:typeof s=="function"?s(u):s}else console.error("Format Error - 'datetimediff' formatter is dependant on luxon.js")}function oD(r,e,t){var i=r.getValue();return typeof e[i]>"u"?(console.warn("Missing display value for "+i),i):e[i]}function aD(r,e,t){var i=r.getValue(),n=r.getElement(),s=e&&e.stars?e.stars:5,o=document.createElement("span"),a=document.createElementNS("http://www.w3.org/2000/svg","svg"),l='<polygon fill="#FFEA00" stroke="#C1AB60" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>',h='<polygon fill="#D2D2D2" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';o.style.verticalAlign="middle",a.setAttribute("width","14"),a.setAttribute("height","14"),a.setAttribute("viewBox","0 0 512 512"),a.setAttribute("xml:space","preserve"),a.style.padding="0 1px",i=i&&!isNaN(i)?parseInt(i):0,i=Math.max(0,Math.min(i,s));for(var u=1;u<=s;u++){var c=a.cloneNode(!0);c.innerHTML=u<=i?l:h,o.appendChild(c)}return n.style.whiteSpace="nowrap",n.style.overflow="hidden",n.style.textOverflow="ellipsis",n.setAttribute("aria-label",i),o}function lD(r,e,t){var i=this.sanitizeHTML(r.getValue())||0,n=document.createElement("span"),s=e&&e.max?e.max:100,o=e&&e.min?e.min:0,a=e&&typeof e.color<"u"?e.color:["red","orange","green"],l="#666666",h,u;if(!(isNaN(i)||typeof r.getValue()>"u")){switch(n.classList.add("tabulator-traffic-light"),u=parseFloat(i)<=s?parseFloat(i):s,u=parseFloat(u)>=o?parseFloat(u):o,h=(s-o)/100,u=Math.round((u-o)/h),typeof a){case"string":l=a;break;case"function":l=a(i);break;case"object":if(Array.isArray(a)){var c=100/a.length,d=Math.floor(u/c);d=Math.min(d,a.length-1),d=Math.max(d,0),l=a[d];break}}return n.style.backgroundColor=l,n}}function hD(r,e={},t){var i=this.sanitizeHTML(r.getValue())||0,n=r.getElement(),s=e.max?e.max:100,o=e.min?e.min:0,a=e.legendAlign?e.legendAlign:"center",l,h,u,c,d;switch(h=parseFloat(i)<=s?parseFloat(i):s,h=parseFloat(h)>=o?parseFloat(h):o,l=(s-o)/100,h=Math.round((h-o)/l),typeof e.color){case"string":u=e.color;break;case"function":u=e.color(i);break;case"object":if(Array.isArray(e.color)){let w=100/e.color.length,y=Math.floor(h/w);y=Math.min(y,e.color.length-1),y=Math.max(y,0),u=e.color[y];break}default:u="#2DC214"}switch(typeof e.legend){case"string":c=e.legend;break;case"function":c=e.legend(i);break;case"boolean":c=i;break;default:c=!1}switch(typeof e.legendColor){case"string":d=e.legendColor;break;case"function":d=e.legendColor(i);break;case"object":if(Array.isArray(e.legendColor)){let w=100/e.legendColor.length,y=Math.floor(h/w);y=Math.min(y,e.legendColor.length-1),y=Math.max(y,0),d=e.legendColor[y]}break;default:d="#000"}n.style.minWidth="30px",n.style.position="relative",n.setAttribute("aria-label",h);var f=document.createElement("div");f.style.display="inline-block",f.style.width=h+"%",f.style.backgroundColor=u,f.style.height="100%",f.setAttribute("data-max",s),f.setAttribute("data-min",o);var g=document.createElement("div");if(g.style.position="relative",g.style.width="100%",g.style.height="100%",c){var m=document.createElement("div");m.style.position="absolute",m.style.top=0,m.style.left=0,m.style.textAlign=a,m.style.width="100%",m.style.color=d,m.innerHTML=c}return t(function(){if(!(r instanceof bv)){var w=document.createElement("div");w.style.position="absolute",w.style.top="4px",w.style.bottom="4px",w.style.left="4px",w.style.right="4px",n.appendChild(w),n=w}n.appendChild(g),g.appendChild(f),c&&g.appendChild(m)}),""}function uD(r,e,t){return r.getElement().style.backgroundColor=this.sanitizeHTML(r.getValue()),""}function cD(r,e,t){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>'}function dD(r,e,t){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>'}function fD(r,e,t){var i=r.getValue(),n=e.size||15,s=n+"px",o,a,l=e.hasOwnProperty("onValue")?e.onValue:!0,h=e.hasOwnProperty("offValue")?e.offValue:!1,u=e.onTruthy?i:i===l;return o=document.createElement("div"),o.classList.add("tabulator-toggle"),u?(o.classList.add("tabulator-toggle-on"),o.style.flexDirection="row-reverse",e.onColor&&(o.style.background=e.onColor)):e.offColor&&(o.style.background=e.offColor),o.style.width=2.5*n+"px",o.style.borderRadius=s,e.clickable&&o.addEventListener("click",c=>{r.setValue(u?h:l)}),a=document.createElement("div"),a.classList.add("tabulator-toggle-switch"),a.style.height=s,a.style.width=s,a.style.borderRadius=s,o.appendChild(a),o}function gD(r,e,t){var i=document.createElement("span"),n=r.getRow(),s=r.getTable();return n.watchPosition(o=>{e.relativeToPage&&(o+=s.modules.page.getPageSize()*(s.modules.page.getPage()-1)),i.innerText=o}),i}function pD(r,e,t){return r.getElement().classList.add("tabulator-row-handle"),"<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>"}var mD={plaintext:qO,html:JO,textarea:QO,money:eD,link:tD,image:iD,tickCross:nD,datetime:rD,datetimediff:sD,lookup:oD,star:aD,traffic:lD,progress:hD,color:uD,buttonTick:cD,buttonCross:dD,toggle:fD,rownum:gD,handle:pD};const fi=class fi extends Le{constructor(e){super(e),this.registerColumnOption("formatter"),this.registerColumnOption("formatterParams"),this.registerColumnOption("formatterPrint"),this.registerColumnOption("formatterPrintParams"),this.registerColumnOption("formatterClipboard"),this.registerColumnOption("formatterClipboardParams"),this.registerColumnOption("formatterHtmlOutput"),this.registerColumnOption("formatterHtmlOutputParams"),this.registerColumnOption("titleFormatter"),this.registerColumnOption("titleFormatterParams")}initialize(){this.subscribe("cell-format",this.formatValue.bind(this)),this.subscribe("cell-rendered",this.cellRendered.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-format",this.formatHeader.bind(this))}initializeColumn(e){e.modules.format=this.lookupFormatter(e,""),typeof e.definition.formatterPrint<"u"&&(e.modules.format.print=this.lookupFormatter(e,"Print")),typeof e.definition.formatterClipboard<"u"&&(e.modules.format.clipboard=this.lookupFormatter(e,"Clipboard")),typeof e.definition.formatterHtmlOutput<"u"&&(e.modules.format.htmlOutput=this.lookupFormatter(e,"HtmlOutput"))}lookupFormatter(e,t){var i={params:e.definition["formatter"+t+"Params"]||{}},n=e.definition["formatter"+t];switch(typeof n){case"string":fi.formatters[n]?i.formatter=fi.formatters[n]:(console.warn("Formatter Error - No such formatter found: ",n),i.formatter=fi.formatters.plaintext);break;case"function":i.formatter=n;break;default:i.formatter=fi.formatters.plaintext;break}return i}cellRendered(e){e.modules.format&&e.modules.format.renderedCallback&&!e.modules.format.rendered&&(e.modules.format.renderedCallback(),e.modules.format.rendered=!0)}formatHeader(e,t,i){var n,s,o,a;return e.definition.titleFormatter?(n=this.getFormatter(e.definition.titleFormatter),o=l=>{e.titleFormatterRendered=l},a={getValue:function(){return t},getElement:function(){return i},getType:function(){return"header"},getColumn:function(){return e.getComponent()},getTable:()=>this.table},s=e.definition.titleFormatterParams||{},s=typeof s=="function"?s():s,n.call(this,a,s,o)):t}formatValue(e){var t=e.getComponent(),i=typeof e.column.modules.format.params=="function"?e.column.modules.format.params(t):e.column.modules.format.params;function n(s){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=s,e.modules.format.rendered=!1}return e.column.modules.format.formatter.call(this,t,i,n)}formatExportValue(e,t){var i=e.column.modules.format[t],n;if(i){let s=function(o){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=o,e.modules.format.rendered=!1};return n=typeof i.params=="function"?i.params(e.getComponent()):i.params,i.formatter.call(this,e.getComponent(),n,s)}else return this.formatValue(e)}sanitizeHTML(e){if(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=/]/g,function(i){return t[i]})}else return e}emptyToSpace(e){return e===null||typeof e>"u"||e===""?"&nbsp;":e}getFormatter(e){switch(typeof e){case"string":fi.formatters[e]?e=fi.formatters[e]:(console.warn("Formatter Error - No such formatter found: ",e),e=fi.formatters.plaintext);break;case"function":break;default:e=fi.formatters.plaintext;break}return e}};K(fi,"moduleName","format"),K(fi,"formatters",mD);let pc=fi;class Ev extends Le{constructor(e){super(e),this.leftColumns=[],this.rightColumns=[],this.initializationMode="left",this.active=!1,this.blocked=!0,this.registerColumnOption("frozen")}reset(){this.initializationMode="left",this.leftColumns=[],this.rightColumns=[],this.active=!1}initialize(){this.subscribe("cell-layout",this.layoutCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-width",this.layout.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("table-layout",this.layout.bind(this)),this.subscribe("columns-loading",this.reset.bind(this)),this.subscribe("column-add",this.reinitializeColumns.bind(this)),this.subscribe("column-deleted",this.reinitializeColumns.bind(this)),this.subscribe("column-hide",this.reinitializeColumns.bind(this)),this.subscribe("column-show",this.reinitializeColumns.bind(this)),this.subscribe("columns-loaded",this.reinitializeColumns.bind(this)),this.subscribe("table-redraw",this.layout.bind(this)),this.subscribe("layout-refreshing",this.blockLayout.bind(this)),this.subscribe("layout-refreshed",this.unblockLayout.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this))}blockLayout(){this.blocked=!0}unblockLayout(){this.blocked=!1}layoutCell(e){this.layoutElement(e.element,e.column)}reinitializeColumns(){this.reset(),this.table.columnManager.columnsByIndex.forEach(e=>{this.initializeColumn(e)}),this.layout()}initializeColumn(e){var t={margin:0,edge:!1};e.isGroup||(this.frozenCheck(e)?(t.position=this.initializationMode,this.initializationMode=="left"?this.leftColumns.push(e):this.rightColumns.unshift(e),this.active=!0,e.modules.frozen=t):this.initializationMode="right")}frozenCheck(e){return e.parent.isGroup&&e.definition.frozen&&console.warn("Frozen Column Error - Parent column group must be frozen, not individual columns or sub column groups"),e.parent.isGroup?this.frozenCheck(e.parent):e.definition.frozen}layoutCalcRows(){this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&this.table.modules.columnCalcs.topRow&&this.layoutRow(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&this.table.modules.columnCalcs.botRow&&this.layoutRow(this.table.modules.columnCalcs.botRow),this.table.modExists("groupRows")&&this.layoutGroupCalcs(this.table.modules.groupRows.getGroups()))}layoutGroupCalcs(e){e.forEach(t=>{t.calcs.top&&this.layoutRow(t.calcs.top),t.calcs.bottom&&this.layoutRow(t.calcs.bottom),t.groupList&&t.groupList.length&&this.layoutGroupCalcs(t.groupList)})}layoutColumnPosition(e){var t=[],i=0,n=0;this.leftColumns.forEach((s,o)=>{if(s.modules.frozen.marginValue=i,s.modules.frozen.margin=s.modules.frozen.marginValue+"px",s.visible&&(i+=s.getWidth()),o==this.leftColumns.length-1?s.modules.frozen.edge=!0:s.modules.frozen.edge=!1,s.parent.isGroup){var a=this.getColGroupParentElement(s);t.includes(a)||(this.layoutElement(a,s),t.push(a)),a.classList.toggle("tabulator-frozen-left",s.modules.frozen.edge&&s.modules.frozen.position==="left"),a.classList.toggle("tabulator-frozen-right",s.modules.frozen.edge&&s.modules.frozen.position==="right")}else this.layoutElement(s.getElement(),s);e&&s.cells.forEach(l=>{this.layoutElement(l.getElement(!0),s)})}),this.rightColumns.forEach((s,o)=>{s.modules.frozen.marginValue=n,s.modules.frozen.margin=s.modules.frozen.marginValue+"px",s.visible&&(n+=s.getWidth()),o==this.rightColumns.length-1?s.modules.frozen.edge=!0:s.modules.frozen.edge=!1,s.parent.isGroup?this.layoutElement(this.getColGroupParentElement(s),s):this.layoutElement(s.getElement(),s),e&&s.cells.forEach(a=>{this.layoutElement(a.getElement(!0),s)})})}getColGroupParentElement(e){return e.parent.isGroup?this.getColGroupParentElement(e.parent):e.getElement()}layout(){this.active&&!this.blocked&&(this.layoutColumnPosition(),this.reinitializeRows(),this.layoutCalcRows())}reinitializeRows(){var e=this.table.rowManager.getVisibleRows(!0),t=this.table.rowManager.getRows().filter(i=>!e.includes(i));t.forEach(i=>{i.deinitialize()}),e.forEach(i=>{i.type==="row"&&this.layoutRow(i)})}layoutRow(e){this.table.options.layout==="fitDataFill"&&this.rightColumns.length&&(this.table.rowManager.getTableElement().style.minWidth="calc(100% - "+this.rightMargin+")"),this.leftColumns.forEach(t=>{var i=e.getCell(t);i&&this.layoutElement(i.getElement(!0),t)}),this.rightColumns.forEach(t=>{var i=e.getCell(t);i&&this.layoutElement(i.getElement(!0),t)})}layoutElement(e,t){var i;t.modules.frozen&&e&&(e.style.position="sticky",this.table.rtl?i=t.modules.frozen.position==="left"?"right":"left":i=t.modules.frozen.position,e.style[i]=t.modules.frozen.margin,e.classList.add("tabulator-frozen"),e.classList.toggle("tabulator-frozen-left",t.modules.frozen.edge&&t.modules.frozen.position==="left"),e.classList.toggle("tabulator-frozen-right",t.modules.frozen.edge&&t.modules.frozen.position==="right"))}adjustForScrollbar(e){this.rightColumns.length&&(this.table.columnManager.getContentsElement().style.width="calc(100% - "+e+"px)")}getFrozenColumns(){return this.leftColumns.concat(this.rightColumns)}_calcSpace(e,t){var i=0;for(let n=0;n<t;n++)e[n].visible&&(i+=e[n].getWidth());return i}}K(Ev,"moduleName","frozenColumns");class _v extends Le{constructor(e){super(e),this.topElement=document.createElement("div"),this.rows=[],this.registerComponentFunction("row","freeze",this.freezeRow.bind(this)),this.registerComponentFunction("row","unfreeze",this.unfreezeRow.bind(this)),this.registerComponentFunction("row","isFrozen",this.isRowFrozen.bind(this)),this.registerTableOption("frozenRowsField","id"),this.registerTableOption("frozenRows",!1)}initialize(){var e=document.createDocumentFragment();this.rows=[],this.topElement.classList.add("tabulator-frozen-rows-holder"),e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.subscribe("row-deleting",this.detachRow.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),10),this.table.options.frozenRows&&(this.subscribe("data-processed",this.initializeRows.bind(this)),this.subscribe("row-added",this.initializeRow.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this))),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}initializeRows(){this.table.rowManager.getRows().forEach(e=>{this.initializeRow(e)})}initializeRow(e){var t=this.table.options.frozenRows,i=typeof t;i==="number"?e.getPosition()&&e.getPosition()+this.rows.length<=t&&this.freezeRow(e):i==="function"?t.call(this.table,e.getComponent())&&this.freezeRow(e):Array.isArray(t)&&t.includes(e.data[this.options("frozenRowsField")])&&this.freezeRow(e)}isRowFrozen(e){var t=this.rows.indexOf(e);return t>-1}isFrozen(){return!!this.rows.length}visibleRows(e,t){return this.rows.forEach(i=>{t.push(i)}),t}getRows(e){var t=e.slice(0);return this.rows.forEach(function(i){var n=t.indexOf(i);n>-1&&t.splice(n,1)}),t}freezeRow(e){e.modules.frozen?console.warn("Freeze Error - Row is already frozen"):(e.modules.frozen=!0,this.topElement.appendChild(e.getElement()),e.initialize(),e.normalizeHeight(),this.rows.push(e),this.refreshData(!1,"display"),this.table.rowManager.adjustTableSize(),this.styleRows())}unfreezeRow(e){e.modules.frozen?(e.modules.frozen=!1,this.detachRow(e),this.table.rowManager.adjustTableSize(),this.refreshData(!1,"display"),this.rows.length&&this.styleRows()):console.warn("Freeze Error - Row is already unfrozen")}detachRow(e){var t=this.rows.indexOf(e);if(t>-1){var i=e.getElement();i.parentNode&&i.parentNode.removeChild(i),this.rows.splice(t,1)}}styleRows(e){this.rows.forEach((t,i)=>{this.table.rowManager.styleRow(t,i)})}}K(_v,"moduleName","frozenRows");class bD{constructor(e){return this._group=e,this.type="GroupComponent",new Proxy(this,{get:function(t,i,n){return typeof t[i]<"u"?t[i]:t._group.groupManager.table.componentFunctionBinder.handle("group",t._group,i)}})}getKey(){return this._group.key}getField(){return this._group.field}getElement(){return this._group.element}getRows(){return this._group.getRows(!0)}getSubGroups(){return this._group.getSubGroups(!0)}getParentGroup(){return this._group.parent?this._group.parent.getComponent():!1}isVisible(){return this._group.visible}show(){this._group.show()}hide(){this._group.hide()}toggle(){this._group.toggleVisibility()}scrollTo(e,t){return this._group.groupManager.table.rowManager.scrollToRow(this._group,e,t)}_getSelf(){return this._group}getTable(){return this._group.groupManager.table}}class cs{constructor(e,t,i,n,s,o,a){this.groupManager=e,this.parent=t,this.key=n,this.level=i,this.field=s,this.hasSubGroups=i<e.groupIDLookups.length-1,this.addRow=this.hasSubGroups?this._addRowToGroup:this._addRow,this.type="group",this.old=a,this.rows=[],this.groups=[],this.groupList=[],this.generator=o,this.element=!1,this.elementContents=!1,this.height=0,this.outerHeight=0,this.initialized=!1,this.calcs={},this.initialized=!1,this.modules={},this.arrowElement=!1,this.visible=a?a.visible:typeof e.startOpen[i]<"u"?e.startOpen[i]:e.startOpen[0],this.component=null,this.createElements(),this.addBindings(),this.createValueGroups()}wipe(e){e||(this.groupList.length?this.groupList.forEach(function(t){t.wipe()}):this.rows.forEach(t=>{t.modules&&delete t.modules.group})),this.element=!1,this.arrowElement=!1,this.elementContents=!1}createElements(){var e=document.createElement("div");e.classList.add("tabulator-arrow"),this.element=document.createElement("div"),this.element.classList.add("tabulator-row"),this.element.classList.add("tabulator-group"),this.element.classList.add("tabulator-group-level-"+this.level),this.element.setAttribute("role","rowgroup"),this.arrowElement=document.createElement("div"),this.arrowElement.classList.add("tabulator-group-toggle"),this.arrowElement.appendChild(e),this.groupManager.table.options.movableRows!==!1&&this.groupManager.table.modExists("moveRow")&&this.groupManager.table.modules.moveRow.initializeGroupHeader(this)}createValueGroups(){var e=this.level+1;this.groupManager.allowedValues&&this.groupManager.allowedValues[e]&&this.groupManager.allowedValues[e].forEach(t=>{this._createGroup(t,e)})}addBindings(){var e;this.groupManager.table.options.groupToggleElement&&(e=this.groupManager.table.options.groupToggleElement=="arrow"?this.arrowElement:this.element,e.addEventListener("click",t=>{this.groupManager.table.options.groupToggleElement==="arrow"&&(t.stopPropagation(),t.stopImmediatePropagation()),setTimeout(()=>{this.toggleVisibility()})}))}_createGroup(e,t){var i=t+"_"+e,n=new cs(this.groupManager,this,t,e,this.groupManager.groupIDLookups[t].field,this.groupManager.headerGenerator[t]||this.groupManager.headerGenerator[0],this.old?this.old.groups[i]:!1);this.groups[i]=n,this.groupList.push(n)}_addRowToGroup(e){var t=this.level+1;if(this.hasSubGroups){var i=this.groupManager.groupIDLookups[t].func(e.getData()),n=t+"_"+i;this.groupManager.allowedValues&&this.groupManager.allowedValues[t]?this.groups[n]&&this.groups[n].addRow(e):(this.groups[n]||this._createGroup(i,t),this.groups[n].addRow(e))}}_addRow(e){this.rows.push(e),e.modules.group=this}insertRow(e,t,i){var n=this.conformRowData({});e.updateData(n);var s=this.rows.indexOf(t);s>-1?i?this.rows.splice(s+1,0,e):this.rows.splice(s,0,e):i?this.rows.push(e):this.rows.unshift(e),e.modules.group=this,this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this),this.groupManager.updateGroupRows(!0)}scrollHeader(e){this.arrowElement&&(this.arrowElement.style.marginLeft=e,this.groupList.forEach(function(t){t.scrollHeader(e)}))}getRowIndex(e){}conformRowData(e){return this.field?e[this.field]=this.key:console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function"),this.parent&&(e=this.parent.conformRowData(e)),e}removeRow(e){var t=this.rows.indexOf(e),i=e.getElement();t>-1&&this.rows.splice(t,1),!this.groupManager.table.options.groupValues&&!this.rows.length?(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this),this.groupManager.updateGroupRows(!0)):(i.parentNode&&i.parentNode.removeChild(i),this.groupManager.blockRedraw||(this.generateGroupHeaderContents(),this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this)))}removeGroup(e){var t=e.level+"_"+e.key,i;this.groups[t]&&(delete this.groups[t],i=this.groupList.indexOf(e),i>-1&&this.groupList.splice(i,1),this.groupList.length||(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this)))}getHeadersAndRows(){var e=[];return e.push(this),this._visSet(),this.calcs.top&&(this.calcs.top.detachElement(),this.calcs.top.deleteCells()),this.calcs.bottom&&(this.calcs.bottom.detachElement(),this.calcs.bottom.deleteCells()),this.visible?this.groupList.length?this.groupList.forEach(function(t){e=e.concat(t.getHeadersAndRows())}):(this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),e=e.concat(this.rows),this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))):!this.groupList.length&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&(this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))),e}getData(e,t){var i=[];return this._visSet(),(!e||e&&this.visible)&&this.rows.forEach(n=>{i.push(n.getData(t||"data"))}),i}getRowCount(){var e=0;return this.groupList.length?this.groupList.forEach(t=>{e+=t.getRowCount()}):e=this.rows.length,e}toggleVisibility(){this.visible?this.hide():this.show()}hide(){this.visible=!1,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination?(this.element.classList.remove("tabulator-group-visible"),this.groupList.length?this.groupList.forEach(e=>{var t=e.getHeadersAndRows();t.forEach(i=>{i.detachElement()})}):this.rows.forEach(e=>{var t=e.getElement();t.parentNode.removeChild(t)}),this.groupManager.updateGroupRows(!0)):this.groupManager.updateGroupRows(!0),this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!1)}show(){if(this.visible=!0,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination){this.element.classList.add("tabulator-group-visible");var e=this.generateElement();this.groupList.length?this.groupList.forEach(t=>{var i=t.getHeadersAndRows();i.forEach(n=>{var s=n.getElement();e.parentNode.insertBefore(s,e.nextSibling),n.initialize(),e=s})}):this.rows.forEach(t=>{var i=t.getElement();e.parentNode.insertBefore(i,e.nextSibling),t.initialize(),e=i}),this.groupManager.updateGroupRows(!0)}else this.groupManager.updateGroupRows(!0);this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!0)}_visSet(){var e=[];typeof this.visible=="function"&&(this.rows.forEach(function(t){e.push(t.getData())}),this.visible=this.visible(this.key,this.getRowCount(),e,this.getComponent()))}getRowGroup(e){var t=!1;return this.groupList.length?this.groupList.forEach(function(i){var n=i.getRowGroup(e);n&&(t=n)}):this.rows.find(function(i){return i===e})&&(t=this),t}getSubGroups(e){var t=[];return this.groupList.forEach(function(i){t.push(e?i.getComponent():i)}),t}getRows(e,t){var i=[];return t&&this.groupList.length?this.groupList.forEach(n=>{i=i.concat(n.getRows(e,t))}):this.rows.forEach(function(n){i.push(e?n.getComponent():n)}),i}generateGroupHeaderContents(){var e=[],t=this.getRows(!1,!0);for(t.forEach(function(i){e.push(i.getData())}),this.elementContents=this.generator(this.key,this.getRowCount(),e,this.getComponent());this.element.firstChild;)this.element.removeChild(this.element.firstChild);typeof this.elementContents=="string"?this.element.innerHTML=this.elementContents:this.element.appendChild(this.elementContents),this.element.insertBefore(this.arrowElement,this.element.firstChild)}getPath(e=[]){return e.unshift(this.key),this.parent&&this.parent.getPath(e),e}getElement(){return this.elementContents?this.element:this.generateElement()}generateElement(){this.addBindings=!1,this._visSet(),this.visible?this.element.classList.add("tabulator-group-visible"):this.element.classList.remove("tabulator-group-visible");for(var e=0;e<this.element.childNodes.length;++e)this.element.childNodes[e].parentNode.removeChild(this.element.childNodes[e]);return this.generateGroupHeaderContents(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}normalizeHeight(){this.setHeight(this.element.clientHeight)}initialize(e){(!this.initialized||e)&&(this.normalizeHeight(),this.initialized=!0)}reinitialize(){this.initialized=!1,this.height=0,Ze.elVisible(this.element)&&this.initialize(!0)}setHeight(e){this.height!=e&&(this.height=e,this.outerHeight=this.element.offsetHeight)}getHeight(){return this.outerHeight}getGroup(){return this}reinitializeHeight(){}calcHeight(){}setCellHeight(){}clearCellHeight(){}deinitializeHeight(){}rendered(){}getComponent(){return this.component||(this.component=new bD(this)),this.component}}class Cv extends Le{constructor(e){super(e),this.groupIDLookups=!1,this.startOpen=[function(){return!1}],this.headerGenerator=[function(){return""}],this.groupList=[],this.allowedValues=!1,this.groups={},this.displayHandler=this.getRows.bind(this),this.blockRedraw=!1,this.registerTableOption("groupBy",!1),this.registerTableOption("groupStartOpen",!0),this.registerTableOption("groupValues",!1),this.registerTableOption("groupUpdateOnCellEdit",!1),this.registerTableOption("groupHeader",!1),this.registerTableOption("groupHeaderPrint",null),this.registerTableOption("groupHeaderClipboard",null),this.registerTableOption("groupHeaderHtmlOutput",null),this.registerTableOption("groupHeaderDownload",null),this.registerTableOption("groupToggleElement","arrow"),this.registerTableOption("groupClosedShowCalcs",!1),this.registerTableFunction("setGroupBy",this.setGroupBy.bind(this)),this.registerTableFunction("setGroupValues",this.setGroupValues.bind(this)),this.registerTableFunction("setGroupStartOpen",this.setGroupStartOpen.bind(this)),this.registerTableFunction("setGroupHeader",this.setGroupHeader.bind(this)),this.registerTableFunction("getGroups",this.userGetGroups.bind(this)),this.registerTableFunction("getGroupedData",this.userGetGroupedData.bind(this)),this.registerComponentFunction("row","getGroup",this.rowGetGroup.bind(this))}initialize(){this.subscribe("table-destroy",this._blockRedrawing.bind(this)),this.subscribe("rows-wipe",this._blockRedrawing.bind(this)),this.subscribe("rows-wiped",this._restore_redrawing.bind(this)),this.table.options.groupBy&&(this.table.options.groupUpdateOnCellEdit&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("row-data-changed",this.reassignRowToGroup.bind(this),0)),this.subscribe("table-built",this.configureGroupSetup.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHeaders.bind(this)),this.subscribe("rows-wipe",this.wipe.bind(this)),this.subscribe("rows-added",this.rowsUpdated.bind(this)),this.subscribe("row-moving",this.rowMoving.bind(this)),this.subscribe("row-adding-index",this.rowAddingIndex.bind(this)),this.subscribe("rows-sample",this.rowSample.bind(this)),this.subscribe("render-virtual-fill",this.virtualRenderFill.bind(this)),this.registerDisplayHandler(this.displayHandler,20),this.initialized=!0)}_blockRedrawing(){this.blockRedraw=!0}_restore_redrawing(){this.blockRedraw=!1}configureGroupSetup(){if(this.table.options.groupBy){var e=this.table.options.groupBy,t=this.table.options.groupStartOpen,i=this.table.options.groupHeader;if(this.allowedValues=this.table.options.groupValues,Array.isArray(e)&&Array.isArray(i)&&e.length>i.length&&console.warn("Error creating group headers, groupHeader array is shorter than groupBy array"),this.headerGenerator=[function(){return""}],this.startOpen=[function(){return!1}],this.langBind("groups|item",(s,o)=>{this.headerGenerator[0]=(a,l,h)=>(typeof a>"u"?"":a)+"<span>("+l+" "+(l===1?s:o.groups.items)+")</span>"}),this.groupIDLookups=[],e)this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="table"&&this.table.options.columnCalcs!="both"&&this.table.modules.columnCalcs.removeCalcs();else if(this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="group"){var n=this.table.columnManager.getRealColumns();n.forEach(s=>{s.definition.topCalc&&this.table.modules.columnCalcs.initializeTopRow(),s.definition.bottomCalc&&this.table.modules.columnCalcs.initializeBottomRow()})}Array.isArray(e)||(e=[e]),e.forEach((s,o)=>{var a,l;typeof s=="function"?a=s:(l=this.table.columnManager.getColumnByField(s),l?a=function(h){return l.getFieldValue(h)}:a=function(h){return h[s]}),this.groupIDLookups.push({field:typeof s=="function"?!1:s,func:a,values:this.allowedValues?this.allowedValues[o]:!1})}),t&&(Array.isArray(t)||(t=[t]),t.forEach(s=>{}),this.startOpen=t),i&&(this.headerGenerator=Array.isArray(i)?i:[i])}else this.groupList=[],this.groups={}}rowSample(e,t){if(this.table.options.groupBy){var i=this.getGroups(!1)[0];t.push(i.getRows(!1)[0])}return t}virtualRenderFill(){var e=this.table.rowManager.tableElement,t=this.table.rowManager.getVisibleRows();if(this.table.options.groupBy)t=t.filter(i=>i.type!=="group"),e.style.minWidth=t.length?"":this.table.columnManager.getWidth()+"px";else return t}rowAddingIndex(e,t,i){if(this.table.options.groupBy){this.assignRowToGroup(e);var n=e.modules.group.rows;return n.length>1&&(!t||t&&n.indexOf(t)==-1?i?n[0]!==e&&(t=n[0],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,t,!i)):n[n.length-1]!==e&&(t=n[n.length-1],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,t,!i)):this.table.rowManager.moveRowInArray(e.modules.group.rows,e,t,!i)),t}}trackChanges(){this.dispatch("group-changed")}setGroupBy(e){this.table.options.groupBy=e,this.initialized||this.initialize(),this.configureGroupSetup(),!e&&this.table.modExists("columnCalcs")&&this.table.options.columnCalcs===!0&&this.table.modules.columnCalcs.reinitializeCalcs(),this.refreshData(),this.trackChanges()}setGroupValues(e){this.table.options.groupValues=e,this.configureGroupSetup(),this.refreshData(),this.trackChanges()}setGroupStartOpen(e){this.table.options.groupStartOpen=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}setGroupHeader(e){this.table.options.groupHeader=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}userGetGroups(e){return this.getGroups(!0)}userGetGroupedData(){return this.table.options.groupBy?this.getGroupedData():this.getData()}rowGetGroup(e){return e.modules.group?e.modules.group.getComponent():!1}rowMoving(e,t,i){if(this.table.options.groupBy){!i&&t instanceof cs&&(t=this.table.rowManager.prevDisplayRow(e)||t);var n=t instanceof cs?t:t.modules.group,s=e instanceof cs?e:e.modules.group;n===s?this.table.rowManager.moveRowInArray(n.rows,e,t,i):(s&&s.removeRow(e),n.insertRow(e,t,i))}}rowDeleting(e){this.table.options.groupBy&&e.modules.group&&e.modules.group.removeRow(e)}rowsUpdated(e){this.table.options.groupBy&&this.updateGroupRows(!0)}cellUpdated(e){this.table.options.groupBy&&this.reassignRowToGroup(e.row)}getRows(e){return this.table.options.groupBy&&this.groupIDLookups.length?(this.dispatchExternal("dataGrouping"),this.generateGroups(e),this.subscribedExternal("dataGrouped")&&this.dispatchExternal("dataGrouped",this.getGroups(!0)),this.updateGroupRows()):e.slice(0)}getGroups(e){var t=[];return this.groupList.forEach(function(i){t.push(e?i.getComponent():i)}),t}getChildGroups(e){var t=[];return e||(e=this),e.groupList.forEach(i=>{i.groupList.length?t=t.concat(this.getChildGroups(i)):t.push(i)}),t}wipe(){this.table.options.groupBy&&(this.groupList.forEach(function(e){e.wipe()}),this.groupList=[],this.groups={})}pullGroupListData(e){var t=[];return e.forEach(i=>{var n={};n.level=0,n.rowCount=0,n.headerContent="";var s=[];i.hasSubGroups?(s=this.pullGroupListData(i.groupList),n.level=i.level,n.rowCount=s.length-i.groupList.length,n.headerContent=i.generator(i.key,n.rowCount,i.rows,i),t.push(n),t=t.concat(s)):(n.level=i.level,n.headerContent=i.generator(i.key,i.rows.length,i.rows,i),n.rowCount=i.getRows().length,t.push(n),i.getRows().forEach(o=>{t.push(o.getData("data"))}))}),t}getGroupedData(){return this.pullGroupListData(this.groupList)}getRowGroup(e){var t=!1;return this.options("dataTree")&&(e=this.table.modules.dataTree.getTreeParentRoot(e)),this.groupList.forEach(i=>{var n=i.getRowGroup(e);n&&(t=n)}),t}countGroups(){return this.groupList.length}generateGroups(e){var t=this.groups;this.groups={},this.groupList=[],this.allowedValues&&this.allowedValues[0]?(this.allowedValues[0].forEach(i=>{this.createGroup(i,0,t)}),e.forEach(i=>{this.assignRowToExistingGroup(i,t)})):e.forEach(i=>{this.assignRowToGroup(i,t)}),Object.values(t).forEach(i=>{i.wipe(!0)})}createGroup(e,t,i){var n=t+"_"+e,s;i=i||[],s=new cs(this,!1,t,e,this.groupIDLookups[0].field,this.headerGenerator[0],i[n]),this.groups[n]=s,this.groupList.push(s)}assignRowToExistingGroup(e,t){var i=this.groupIDLookups[0].func(e.getData()),n="0_"+i;this.groups[n]&&this.groups[n].addRow(e)}assignRowToGroup(e,t){var i=this.groupIDLookups[0].func(e.getData()),n=!this.groups["0_"+i];return n&&this.createGroup(i,0,t),this.groups["0_"+i].addRow(e),!n}reassignRowToGroup(e){if(e.type==="row"){var t=e.modules.group,i=t.getPath(),n=this.getExpectedPath(e),s;s=i.length==n.length&&i.every((o,a)=>o===n[a]),s||(t.removeRow(e),this.assignRowToGroup(e,this.groups),this.refreshData(!0))}}getExpectedPath(e){var t=[],i=e.getData();return this.groupIDLookups.forEach(n=>{t.push(n.func(i))}),t}updateGroupRows(e){var t=[];return this.blockRedraw||(this.groupList.forEach(i=>{t=t.concat(i.getHeadersAndRows())}),e&&this.refreshData(!0)),t}scrollHeaders(e){this.table.options.groupBy&&(this.table.options.renderHorizontal==="virtual"&&(e-=this.table.columnManager.renderer.vDomPadLeft),e=e+"px",this.groupList.forEach(t=>{t.scrollHeader(e)}))}removeGroup(e){var t=e.level+"_"+e.key,i;this.groups[t]&&(delete this.groups[t],i=this.groupList.indexOf(e),i>-1&&this.groupList.splice(i,1))}checkBasicModeGroupHeaderWidth(){var e=this.table.rowManager.tableElement,t=!0;this.table.rowManager.getDisplayRows().forEach((i,n)=>{this.table.rowManager.styleRow(i,n),e.appendChild(i.getElement()),i.initialize(!0),i.type!=="group"&&(t=!1)}),t?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}}K(Cv,"moduleName","groupRows");var yD={cellEdit:function(r){r.component.setValueProcessData(r.data.oldValue),r.component.cellRendered()},rowAdd:function(r){r.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowDelete:function(r){var e=this.table.rowManager.addRowActual(r.data.data,r.data.pos,r.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(r.component,e),this.table.rowManager.checkPlaceholder()},rowMove:function(r){var e=r.data.posFrom-r.data.posTo>0;this.table.rowManager.moveRowActual(r.component,this.table.rowManager.getRowFromPosition(r.data.posFrom),e),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},vD={cellEdit:function(r){r.component.setValueProcessData(r.data.newValue),r.component.cellRendered()},rowAdd:function(r){var e=this.table.rowManager.addRowActual(r.data.data,r.data.pos,r.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(r.component,e),this.table.rowManager.checkPlaceholder()},rowDelete:function(r){r.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowMove:function(r){this.table.rowManager.moveRowActual(r.component,this.table.rowManager.getRowFromPosition(r.data.posTo),r.data.after),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},wD={undo:["ctrl + 90","meta + 90"],redo:["ctrl + 89","meta + 89"]},ED={undo:function(r){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(r.preventDefault(),this.table.modules.history.undo()))},redo:function(r){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(r.preventDefault(),this.table.modules.history.redo()))}},_D={keybindings:{bindings:wD,actions:ED}};const $n=class $n extends Le{constructor(e){super(e),this.history=[],this.index=-1,this.registerTableOption("history",!1)}initialize(){this.table.options.history&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("cell-delete",this.clearComponentHistory.bind(this)),this.subscribe("row-delete",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clear.bind(this)),this.subscribe("row-added",this.rowAdded.bind(this)),this.subscribe("row-move",this.rowMoved.bind(this))),this.registerTableFunction("undo",this.undo.bind(this)),this.registerTableFunction("redo",this.redo.bind(this)),this.registerTableFunction("getHistoryUndoSize",this.getHistoryUndoSize.bind(this)),this.registerTableFunction("getHistoryRedoSize",this.getHistoryRedoSize.bind(this)),this.registerTableFunction("clearHistory",this.clear.bind(this))}rowMoved(e,t,i){this.action("rowMove",e,{posFrom:e.getPosition(),posTo:t.getPosition(),to:t,after:i})}rowAdded(e,t,i,n){this.action("rowAdd",e,{data:t,pos:i,index:n})}rowDeleted(e){var t,i;this.table.options.groupBy?(i=e.getComponent().getGroup()._getSelf().rows,t=i.indexOf(e),t&&(t=i[t-1])):(t=e.table.rowManager.getRowIndex(e),t&&(t=e.table.rowManager.rows[t-1])),this.action("rowDelete",e,{data:e.getData(),pos:!t,index:t})}cellUpdated(e){this.action("cellEdit",e,{oldValue:e.oldValue,newValue:e.value})}clear(){this.history=[],this.index=-1}action(e,t,i){this.history=this.history.slice(0,this.index+1),this.history.push({type:e,component:t,data:i}),this.index++}getHistoryUndoSize(){return this.index+1}getHistoryRedoSize(){return this.history.length-(this.index+1)}clearComponentHistory(e){var t=this.history.findIndex(function(i){return i.component===e});t>-1&&(this.history.splice(t,1),t<=this.index&&this.index--,this.clearComponentHistory(e))}undo(){if(this.index>-1){let e=this.history[this.index];return $n.undoers[e.type].call(this,e),this.index--,this.dispatchExternal("historyUndo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Undo Error - No more history to undo":"History module not enabled"),!1}redo(){if(this.history.length-1>this.index){this.index++;let e=this.history[this.index];return $n.redoers[e.type].call(this,e),this.dispatchExternal("historyRedo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Redo Error - No more history to redo":"History module not enabled"),!1}_rebindRow(e,t){this.history.forEach(function(i){if(i.component instanceof kt)i.component===e&&(i.component=t);else if(i.component instanceof fa&&i.component.row===e){var n=i.component.column.getField();n&&(i.component=t.getCell(n))}})}};K($n,"moduleName","history"),K($n,"moduleExtensions",_D),K($n,"undoers",yD),K($n,"redoers",vD);let mc=$n;class xv extends Le{constructor(e){super(e),this.fieldIndex=[],this.hasIndex=!1}initialize(){this.tableElementCheck()}tableElementCheck(){this.table.originalElement&&this.table.originalElement.tagName==="TABLE"&&(this.table.originalElement.childNodes.length?this.parseTable():console.warn("Unable to parse data from empty table tag, Tabulator should be initialized on a div tag unless importing data from a table element."))}parseTable(){var e=this.table.originalElement,t=this.table.options,i=e.getElementsByTagName("th"),n=e.getElementsByTagName("tbody")[0],s=[];this.hasIndex=!1,this.dispatchExternal("htmlImporting"),n=n?n.getElementsByTagName("tr"):[],this._extractOptions(e,t),i.length?this._extractHeaders(i,n):this._generateBlankHeaders(i,n);for(var o=0;o<n.length;o++){var a=n[o],l=a.getElementsByTagName("td"),h={};this.hasIndex||(h[t.index]=o);for(var u=0;u<l.length;u++){var c=l[u];typeof this.fieldIndex[u]<"u"&&(h[this.fieldIndex[u]]=c.innerHTML)}s.push(h)}t.data=s,this.dispatchExternal("htmlImported")}_extractOptions(e,t,i){var n=e.attributes,s=Object.keys(i||t),o={};s.forEach(u=>{o[u.toLowerCase()]=u});for(var a in n){var l=n[a],h;l&&typeof l=="object"&&l.name&&l.name.indexOf("tabulator-")===0&&(h=l.name.replace("tabulator-",""),typeof o[h]<"u"&&(t[o[h]]=this._attribValue(l.value)))}}_attribValue(e){return e==="true"?!0:e==="false"?!1:e}_findCol(e){var t=this.table.options.columns.find(i=>i.title===e);return t||!1}_extractHeaders(e,t){for(var i=0;i<e.length;i++){var n=e[i],s=!1,o=this._findCol(n.textContent),a;o?s=!0:o={title:n.textContent.trim()},o.field||(o.field=n.textContent.trim().toLowerCase().replaceAll(" ","_")),a=n.getAttribute("width"),a&&!o.width&&(o.width=a),this._extractOptions(n,o,this.table.columnManager.optionsList.registeredDefaults),this.fieldIndex[i]=o.field,o.field==this.table.options.index&&(this.hasIndex=!0),s||this.table.options.columns.push(o)}}_generateBlankHeaders(e,t){for(var i=0;i<e.length;i++){var n=e[i],s={title:"",field:"col"+i};this.fieldIndex[i]=s.field;var o=n.getAttribute("width");o&&(s.width=o),this.table.options.columns.push(s)}}}K(xv,"moduleName","htmlTableImport");function CD(r){var e=[],t=0,i=0,n=!1;for(let s=0;s<r.length;s++){let o=r[s],a=r[s+1];if(e[t]||(e[t]=[]),e[t][i]||(e[t][i]=""),o=='"'&&n&&a=='"'){e[t][i]+=o,s++;continue}if(o=='"'){n=!n;continue}if(o==","&&!n){i++;continue}if(o=="\r"&&a==`
`&&!n){i=0,t++,s++;continue}if((o=="\r"||o==`
`)&&!n){i=0,t++;continue}e[t][i]+=o}return e}function xD(r){try{return JSON.parse(r)}catch(e){return console.warn("JSON Import Error - File contents is invalid JSON",e),Promise.reject()}}function RD(r){return r}function SD(r,e){var t=XLSX.read(r),i=t.Sheets[t.SheetNames[0]];return XLSX.utils.sheet_to_json(i,{})}var TD={csv:CD,json:xD,array:RD,xlsx:SD};const _o=class _o extends Le{constructor(e){super(e),this.registerTableOption("importFormat"),this.registerTableOption("importReader","text")}initialize(){this.registerTableFunction("import",this.importFromFile.bind(this)),this.table.options.importFormat&&(this.subscribe("data-loading",this.loadDataCheck.bind(this),10),this.subscribe("data-load",this.loadData.bind(this),10))}loadDataCheck(e){return this.table.options.importFormat&&(typeof e=="string"||Array.isArray(e)&&e.length&&Array.isArray(e))}loadData(e,t,i,n,s){return this.importData(this.lookupImporter(),e).then(this.structureData.bind(this)).catch(o=>(console.error("Import Error:",o||"Unable to import data"),Promise.reject(o)))}lookupImporter(e){var t;return e||(e=this.table.options.importFormat),typeof e=="string"?t=_o.importers[e]:t=e,t||console.error("Import Error - Importer not found:",e),t}importFromFile(e,t,i){var n=this.lookupImporter(e);if(n)return this.pickFile(t,i).then(this.importData.bind(this,n)).then(this.structureData.bind(this)).then(this.setData.bind(this)).catch(s=>(this.dispatch("import-error",s),this.dispatchExternal("importError",s),console.error("Import Error:",s||"Unable to import file"),Promise.reject(s)))}pickFile(e,t){return new Promise((i,n)=>{var s=document.createElement("input");s.type="file",s.accept=e,s.addEventListener("change",o=>{var a=s.files[0],l=new FileReader;switch(this.dispatch("import-importing",s.files),this.dispatchExternal("importImporting",s.files),t||this.table.options.importReader){case"buffer":l.readAsArrayBuffer(a);break;case"binary":l.readAsBinaryString(a);break;case"url":l.readAsDataURL(a);break;case"text":default:l.readAsText(a)}l.onload=h=>{i(l.result)},l.onerror=h=>{console.warn("File Load Error - Unable to read file"),n()}}),this.dispatch("import-choose"),this.dispatchExternal("importChoose"),s.click()})}importData(e,t){var i=e.call(this.table,t);return i instanceof Promise?i:i?Promise.resolve(i):Promise.reject()}structureData(e){var t=[];return Array.isArray(e)&&e.length&&Array.isArray(e[0])?(this.table.options.autoColumns?t=this.structureArrayToObject(e):t=this.structureArrayToColumns(e),t):e}structureArrayToObject(e){var t=e.shift(),i=e.map(n=>{var s={};return t.forEach((o,a)=>{s[o]=n[a]}),s});return i}structureArrayToColumns(e){var t=[],i=this.table.getColumns();return i[0]&&e[0][0]&&i[0].getDefinition().title===e[0][0]&&e.shift(),e.forEach(n=>{var s={};n.forEach((o,a)=>{var l=i[a];l&&(s[l.getField()]=o)}),t.push(s)}),t}setData(e){return this.dispatch("import-imported",e),this.dispatchExternal("importImported",e),this.table.setData(e)}};K(_o,"moduleName","import"),K(_o,"importers",TD);let bc=_o;class Rv extends Le{constructor(e){super(e),this.eventMap={rowClick:"row-click",rowDblClick:"row-dblclick",rowContext:"row-contextmenu",rowMouseEnter:"row-mouseenter",rowMouseLeave:"row-mouseleave",rowMouseOver:"row-mouseover",rowMouseOut:"row-mouseout",rowMouseMove:"row-mousemove",rowMouseDown:"row-mousedown",rowMouseUp:"row-mouseup",rowTap:"row",rowDblTap:"row",rowTapHold:"row",cellClick:"cell-click",cellDblClick:"cell-dblclick",cellContext:"cell-contextmenu",cellMouseEnter:"cell-mouseenter",cellMouseLeave:"cell-mouseleave",cellMouseOver:"cell-mouseover",cellMouseOut:"cell-mouseout",cellMouseMove:"cell-mousemove",cellMouseDown:"cell-mousedown",cellMouseUp:"cell-mouseup",cellTap:"cell",cellDblTap:"cell",cellTapHold:"cell",headerClick:"column-click",headerDblClick:"column-dblclick",headerContext:"column-contextmenu",headerMouseEnter:"column-mouseenter",headerMouseLeave:"column-mouseleave",headerMouseOver:"column-mouseover",headerMouseOut:"column-mouseout",headerMouseMove:"column-mousemove",headerMouseDown:"column-mousedown",headerMouseUp:"column-mouseup",headerTap:"column",headerDblTap:"column",headerTapHold:"column",groupClick:"group-click",groupDblClick:"group-dblclick",groupContext:"group-contextmenu",groupMouseEnter:"group-mouseenter",groupMouseLeave:"group-mouseleave",groupMouseOver:"group-mouseover",groupMouseOut:"group-mouseout",groupMouseMove:"group-mousemove",groupMouseDown:"group-mousedown",groupMouseUp:"group-mouseup",groupTap:"group",groupDblTap:"group",groupTapHold:"group"},this.subscribers={},this.touchSubscribers={},this.columnSubscribers={},this.touchWatchers={row:{tap:null,tapDbl:null,tapHold:null},cell:{tap:null,tapDbl:null,tapHold:null},column:{tap:null,tapDbl:null,tapHold:null},group:{tap:null,tapDbl:null,tapHold:null}},this.registerColumnOption("headerClick"),this.registerColumnOption("headerDblClick"),this.registerColumnOption("headerContext"),this.registerColumnOption("headerMouseEnter"),this.registerColumnOption("headerMouseLeave"),this.registerColumnOption("headerMouseOver"),this.registerColumnOption("headerMouseOut"),this.registerColumnOption("headerMouseMove"),this.registerColumnOption("headerMouseDown"),this.registerColumnOption("headerMouseUp"),this.registerColumnOption("headerTap"),this.registerColumnOption("headerDblTap"),this.registerColumnOption("headerTapHold"),this.registerColumnOption("cellClick"),this.registerColumnOption("cellDblClick"),this.registerColumnOption("cellContext"),this.registerColumnOption("cellMouseEnter"),this.registerColumnOption("cellMouseLeave"),this.registerColumnOption("cellMouseOver"),this.registerColumnOption("cellMouseOut"),this.registerColumnOption("cellMouseMove"),this.registerColumnOption("cellMouseDown"),this.registerColumnOption("cellMouseUp"),this.registerColumnOption("cellTap"),this.registerColumnOption("cellDblTap"),this.registerColumnOption("cellTapHold")}initialize(){this.initializeExternalEvents(),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("cell-dblclick",this.cellContentsSelectionFixer.bind(this)),this.subscribe("scroll-horizontal",this.clearTouchWatchers.bind(this)),this.subscribe("scroll-vertical",this.clearTouchWatchers.bind(this))}clearTouchWatchers(){var e=Object.values(this.touchWatchers);e.forEach(t=>{for(let i in t)t[i]=null})}cellContentsSelectionFixer(e,t){var i;if(!(this.table.modExists("edit")&&this.table.modules.edit.currentCell===t)){e.preventDefault();try{document.selection?(i=document.body.createTextRange(),i.moveToElementText(t.getElement()),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(t.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(i))}catch{}}}initializeExternalEvents(){for(let e in this.eventMap)this.subscriptionChangeExternal(e,this.subscriptionChanged.bind(this,e))}subscriptionChanged(e,t){t?this.subscribers[e]||(this.eventMap[e].includes("-")?(this.subscribers[e]=this.handle.bind(this,e),this.subscribe(this.eventMap[e],this.subscribers[e])):this.subscribeTouchEvents(e)):this.eventMap[e].includes("-")?this.subscribers[e]&&!this.columnSubscribers[e]&&!this.subscribedExternal(e)&&(this.unsubscribe(this.eventMap[e],this.subscribers[e]),delete this.subscribers[e]):this.unsubscribeTouchEvents(e)}subscribeTouchEvents(e){var t=this.eventMap[e];this.touchSubscribers[t+"-touchstart"]||(this.touchSubscribers[t+"-touchstart"]=this.handleTouch.bind(this,t,"start"),this.touchSubscribers[t+"-touchend"]=this.handleTouch.bind(this,t,"end"),this.subscribe(t+"-touchstart",this.touchSubscribers[t+"-touchstart"]),this.subscribe(t+"-touchend",this.touchSubscribers[t+"-touchend"])),this.subscribers[e]=!0}unsubscribeTouchEvents(e){var t=!0,i=this.eventMap[e];if(this.subscribers[e]&&!this.subscribedExternal(e)){delete this.subscribers[e];for(let n in this.eventMap)this.eventMap[n]===i&&this.subscribers[n]&&(t=!1);t&&(this.unsubscribe(i+"-touchstart",this.touchSubscribers[i+"-touchstart"]),this.unsubscribe(i+"-touchend",this.touchSubscribers[i+"-touchend"]),delete this.touchSubscribers[i+"-touchstart"],delete this.touchSubscribers[i+"-touchend"])}}initializeColumn(e){var t=e.definition;for(let i in this.eventMap)t[i]&&(this.subscriptionChanged(i,!0),this.columnSubscribers[i]||(this.columnSubscribers[i]=[]),this.columnSubscribers[i].push(e))}handle(e,t,i){this.dispatchEvent(e,t,i)}handleTouch(e,t,i,n){var s=this.touchWatchers[e];switch(e==="column"&&(e="header"),t){case"start":s.tap=!0,clearTimeout(s.tapHold),s.tapHold=setTimeout(()=>{clearTimeout(s.tapHold),s.tapHold=null,s.tap=null,clearTimeout(s.tapDbl),s.tapDbl=null,this.dispatchEvent(e+"TapHold",i,n)},1e3);break;case"end":s.tap&&(s.tap=null,this.dispatchEvent(e+"Tap",i,n)),s.tapDbl?(clearTimeout(s.tapDbl),s.tapDbl=null,this.dispatchEvent(e+"DblTap",i,n)):s.tapDbl=setTimeout(()=>{clearTimeout(s.tapDbl),s.tapDbl=null},300),clearTimeout(s.tapHold),s.tapHold=null;break}}dispatchEvent(e,t,i){var n=i.getComponent(),s;this.columnSubscribers[e]&&(i instanceof fa?s=i.column.definition[e]:i instanceof Or&&(s=i.definition[e]),s&&s(t,n)),this.dispatchExternal(e,t,n)}}K(Rv,"moduleName","interaction");var MD={navPrev:"shift + 9",navNext:9,navUp:38,navDown:40,navLeft:37,navRight:39,scrollPageUp:33,scrollPageDown:34,scrollToStart:36,scrollToEnd:35},LD={keyBlock:function(r){r.stopPropagation(),r.preventDefault()},scrollPageUp:function(r){var e=this.table.rowManager,t=e.scrollTop-e.element.clientHeight;r.preventDefault(),e.displayRowsCount&&(t>=0?e.element.scrollTop=t:e.scrollToRow(e.getDisplayRows()[0])),this.table.element.focus()},scrollPageDown:function(r){var e=this.table.rowManager,t=e.scrollTop+e.element.clientHeight,i=e.element.scrollHeight;r.preventDefault(),e.displayRowsCount&&(t<=i?e.element.scrollTop=t:e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1])),this.table.element.focus()},scrollToStart:function(r){var e=this.table.rowManager;r.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[0]),this.table.element.focus()},scrollToEnd:function(r){var e=this.table.rowManager;r.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1]),this.table.element.focus()},navPrev:function(r){this.dispatch("keybinding-nav-prev",r)},navNext:function(r){this.dispatch("keybinding-nav-next",r)},navLeft:function(r){this.dispatch("keybinding-nav-left",r)},navRight:function(r){this.dispatch("keybinding-nav-right",r)},navUp:function(r){this.dispatch("keybinding-nav-up",r)},navDown:function(r){this.dispatch("keybinding-nav-down",r)}};const Zn=class Zn extends Le{constructor(e){super(e),this.watchKeys=null,this.pressedKeys=null,this.keyupBinding=!1,this.keydownBinding=!1,this.registerTableOption("keybindings",{}),this.registerTableOption("tabEndNewRow",!1)}initialize(){var e=this.table.options.keybindings,t={};this.watchKeys={},this.pressedKeys=[],e!==!1&&(Object.assign(t,Zn.bindings),Object.assign(t,e),this.mapBindings(t),this.bindEvents()),this.subscribe("table-destroy",this.clearBindings.bind(this))}mapBindings(e){for(let t in e)Zn.actions[t]?e[t]&&(typeof e[t]!="object"&&(e[t]=[e[t]]),e[t].forEach(i=>{var n=Array.isArray(i)?i:[i];n.forEach(s=>{this.mapBinding(t,s)})})):console.warn("Key Binding Error - no such action:",t)}mapBinding(e,t){var i={action:Zn.actions[e],keys:[],ctrl:!1,shift:!1,meta:!1},n=t.toString().toLowerCase().split(" ").join("").split("+");n.forEach(s=>{switch(s){case"ctrl":i.ctrl=!0;break;case"shift":i.shift=!0;break;case"meta":i.meta=!0;break;default:s=isNaN(s)?s.toUpperCase().charCodeAt(0):parseInt(s),i.keys.push(s),this.watchKeys[s]||(this.watchKeys[s]=[]),this.watchKeys[s].push(i)}})}bindEvents(){var e=this;this.keyupBinding=function(t){var i=t.keyCode,n=e.watchKeys[i];n&&(e.pressedKeys.push(i),n.forEach(function(s){e.checkBinding(t,s)}))},this.keydownBinding=function(t){var i=t.keyCode,n=e.watchKeys[i];if(n){var s=e.pressedKeys.indexOf(i);s>-1&&e.pressedKeys.splice(s,1)}},this.table.element.addEventListener("keydown",this.keyupBinding),this.table.element.addEventListener("keyup",this.keydownBinding)}clearBindings(){this.keyupBinding&&this.table.element.removeEventListener("keydown",this.keyupBinding),this.keydownBinding&&this.table.element.removeEventListener("keyup",this.keydownBinding)}checkBinding(e,t){var i=!0;return e.ctrlKey==t.ctrl&&e.shiftKey==t.shift&&e.metaKey==t.meta?(t.keys.forEach(n=>{var s=this.pressedKeys.indexOf(n);s==-1&&(i=!1)}),i&&t.action.call(this,e),!0):!1}};K(Zn,"moduleName","keybindings"),K(Zn,"bindings",MD),K(Zn,"actions",LD);let yc=Zn;class Sv extends Le{constructor(e){super(e),this.menuContainer=null,this.nestedMenuBlock=!1,this.currentComponent=null,this.rootPopup=null,this.columnSubscribers={},this.registerTableOption("rowContextMenu",!1),this.registerTableOption("rowClickMenu",!1),this.registerTableOption("rowDblClickMenu",!1),this.registerTableOption("groupContextMenu",!1),this.registerTableOption("groupClickMenu",!1),this.registerTableOption("groupDblClickMenu",!1),this.registerColumnOption("headerContextMenu"),this.registerColumnOption("headerClickMenu"),this.registerColumnOption("headerDblClickMenu"),this.registerColumnOption("headerMenu"),this.registerColumnOption("headerMenuIcon"),this.registerColumnOption("contextMenu"),this.registerColumnOption("clickMenu"),this.registerColumnOption("dblClickMenu")}initialize(){this.deprecatedOptionsCheck(),this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeRowWatchers(){this.table.options.rowContextMenu&&(this.subscribe("row-contextmenu",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu)),this.table.on("rowTapHold",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu))),this.table.options.rowClickMenu&&this.subscribe("row-click",this.loadMenuEvent.bind(this,this.table.options.rowClickMenu)),this.table.options.rowDblClickMenu&&this.subscribe("row-dblclick",this.loadMenuEvent.bind(this,this.table.options.rowDblClickMenu))}initializeGroupWatchers(){this.table.options.groupContextMenu&&(this.subscribe("group-contextmenu",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu)),this.table.on("groupTapHold",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu))),this.table.options.groupClickMenu&&this.subscribe("group-click",this.loadMenuEvent.bind(this,this.table.options.groupClickMenu)),this.table.options.groupDblClickMenu&&this.subscribe("group-dblclick",this.loadMenuEvent.bind(this,this.table.options.groupDblClickMenu))}initializeColumn(e){var t=e.definition;t.headerContextMenu&&!this.columnSubscribers.headerContextMenu&&(this.columnSubscribers.headerContextMenu=this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextMenu),this.table.on("headerTapHold",this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"))),t.headerClickMenu&&!this.columnSubscribers.headerClickMenu&&(this.columnSubscribers.headerClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerClickMenu"),this.subscribe("column-click",this.columnSubscribers.headerClickMenu)),t.headerDblClickMenu&&!this.columnSubscribers.headerDblClickMenu&&(this.columnSubscribers.headerDblClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerDblClickMenu"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickMenu)),t.headerMenu&&this.initializeColumnHeaderMenu(e),t.contextMenu&&!this.columnSubscribers.contextMenu&&(this.columnSubscribers.contextMenu=this.loadMenuTableCellEvent.bind(this,"contextMenu"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextMenu),this.table.on("cellTapHold",this.loadMenuTableCellEvent.bind(this,"contextMenu"))),t.clickMenu&&!this.columnSubscribers.clickMenu&&(this.columnSubscribers.clickMenu=this.loadMenuTableCellEvent.bind(this,"clickMenu"),this.subscribe("cell-click",this.columnSubscribers.clickMenu)),t.dblClickMenu&&!this.columnSubscribers.dblClickMenu&&(this.columnSubscribers.dblClickMenu=this.loadMenuTableCellEvent.bind(this,"dblClickMenu"),this.subscribe("cell-dblclick",this.columnSubscribers.dblClickMenu))}initializeColumnHeaderMenu(e){var t=e.definition.headerMenuIcon,i;i=document.createElement("span"),i.classList.add("tabulator-header-popup-button"),t?(typeof t=="function"&&(t=t(e.getComponent())),t instanceof HTMLElement?i.appendChild(t):i.innerHTML=t):i.innerHTML="&vellip;",i.addEventListener("click",n=>{n.stopPropagation(),n.preventDefault(),this.loadMenuEvent(e.definition.headerMenu,n,e)}),e.titleElement.insertBefore(i,e.titleElement.firstChild)}loadMenuTableCellEvent(e,t,i){i._cell&&(i=i._cell),i.column.definition[e]&&this.loadMenuEvent(i.column.definition[e],t,i)}loadMenuTableColumnEvent(e,t,i){i._column&&(i=i._column),i.definition[e]&&this.loadMenuEvent(i.definition[e],t,i)}loadMenuEvent(e,t,i){i._group?i=i._group:i._row&&(i=i._row),e=typeof e=="function"?e.call(this.table,t,i.getComponent()):e,this.loadMenu(t,i,e)}loadMenu(e,t,i,n,s){var o=!(e instanceof MouseEvent),a=document.createElement("div"),l;if(a.classList.add("tabulator-menu"),o||e.preventDefault(),!(!i||!i.length)){if(n)l=s.child(a);else{if(this.nestedMenuBlock){if(this.rootPopup)return}else this.nestedMenuBlock=setTimeout(()=>{this.nestedMenuBlock=!1},100);this.rootPopup&&this.rootPopup.hide(),this.rootPopup=l=this.popup(a)}i.forEach(h=>{var u=document.createElement("div"),c=h.label,d=h.disabled;h.separator?u.classList.add("tabulator-menu-separator"):(u.classList.add("tabulator-menu-item"),typeof c=="function"&&(c=c.call(this.table,t.getComponent())),c instanceof Node?u.appendChild(c):u.innerHTML=c,typeof d=="function"&&(d=d.call(this.table,t.getComponent())),d?(u.classList.add("tabulator-menu-item-disabled"),u.addEventListener("click",f=>{f.stopPropagation()})):h.menu&&h.menu.length?u.addEventListener("click",f=>{f.stopPropagation(),this.loadMenu(f,t,h.menu,u,l)}):h.action&&u.addEventListener("click",f=>{h.action(f,t.getComponent())}),h.menu&&h.menu.length&&u.classList.add("tabulator-menu-item-submenu")),a.appendChild(u)}),a.addEventListener("click",h=>{this.rootPopup&&this.rootPopup.hide()}),l.show(n||e),l===this.rootPopup&&(this.rootPopup.hideOnBlur(()=>{this.rootPopup=null,this.currentComponent&&(this.dispatch("menu-closed",i,l),this.dispatchExternal("menuClosed",this.currentComponent.getComponent()),this.currentComponent=null)}),this.currentComponent=t,this.dispatch("menu-opened",i,l),this.dispatchExternal("menuOpened",t.getComponent()))}}}K(Sv,"moduleName","menu");class Tv extends Le{constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=250,this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.startX=0,this.autoScrollMargin=40,this.autoScrollStep=5,this.autoScrollTimeout=!1,this.touchMove=!1,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.registerTableOption("movableColumns",!1)}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-col"),e.classList.add("tabulator-col-placeholder"),e}initialize(){this.table.options.movableColumns&&(this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("alert-show",this.abortMove.bind(this)))}abortMove(){clearTimeout(this.checkTimeout)}initializeColumn(e){var t=this,i={},n;!e.modules.frozen&&!e.isGroup&&!e.isRowHeader&&(n=e.getElement(),i.mousemove=(function(s){e.parent===t.moving.parent&&((t.touchMove?s.touches[0].pageX:s.pageX)-Ze.elOffset(n).left+t.table.columnManager.contentsElement.scrollLeft>e.getWidth()/2?(t.toCol!==e||!t.toColAfter)&&(n.parentNode.insertBefore(t.placeholderElement,n.nextSibling),t.moveColumn(e,!0)):(t.toCol!==e||t.toColAfter)&&(n.parentNode.insertBefore(t.placeholderElement,n),t.moveColumn(e,!1)))}).bind(t),n.addEventListener("mousedown",function(s){t.touchMove=!1,s.which===1&&(t.checkTimeout=setTimeout(function(){t.startMove(s,e)},t.checkPeriod))}),n.addEventListener("mouseup",function(s){s.which===1&&t.checkTimeout&&clearTimeout(t.checkTimeout)}),t.bindTouchEvents(e)),e.modules.moveColumn=i}bindTouchEvents(e){var t=e.getElement(),i=!1,n,s,o,a,l,h;t.addEventListener("touchstart",u=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,n=e.nextColumn(),o=n?n.getWidth()/2:0,s=e.prevColumn(),a=s?s.getWidth()/2:0,l=0,h=0,i=!1,this.startMove(u,e)},this.checkPeriod)},{passive:!0}),t.addEventListener("touchmove",u=>{var c,d;this.moving&&(this.moveHover(u),i||(i=u.touches[0].pageX),c=u.touches[0].pageX-i,c>0?n&&c-l>o&&(d=n,d!==e&&(i=u.touches[0].pageX,d.getElement().parentNode.insertBefore(this.placeholderElement,d.getElement().nextSibling),this.moveColumn(d,!0))):s&&-c-h>a&&(d=s,d!==e&&(i=u.touches[0].pageX,d.getElement().parentNode.insertBefore(this.placeholderElement,d.getElement()),this.moveColumn(d,!1))),d&&(n=d.nextColumn(),l=o,o=n?n.getWidth()/2:0,s=d.prevColumn(),h=a,a=s?s.getWidth()/2:0))},{passive:!0}),t.addEventListener("touchend",u=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&this.endMove(u)})}startMove(e,t){var i=t.getElement(),n=this.table.columnManager.getContentsElement(),s=this.table.columnManager.getHeadersElement();this.table.modules.selectRange&&this.table.modules.selectRange.columnSelection&&this.table.modules.selectRange.mousedown&&this.table.modules.selectRange.selecting==="column"||(this.moving=t,this.startX=(this.touchMove?e.touches[0].pageX:e.pageX)-Ze.elOffset(i).left,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=t.getWidth()+"px",this.placeholderElement.style.height=t.getHeight()+"px",i.parentNode.insertBefore(this.placeholderElement,i),i.parentNode.removeChild(i),this.hoverElement=i.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),n.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.bottom=n.clientHeight-s.offsetHeight+"px",this.touchMove||(this._bindMouseMove(),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove)),this.moveHover(e),this.dispatch("column-moving",e,this.moving))}_bindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveColumn.mousemove)})}_unbindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveColumn.mousemove)})}moveColumn(e,t){var i=this.moving.getCells();this.toCol=e,this.toColAfter=t,t?e.getCells().forEach(function(n,s){var o=n.getElement(!0);o.parentNode&&i[s]&&o.parentNode.insertBefore(i[s].getElement(),o.nextSibling)}):e.getCells().forEach(function(n,s){var o=n.getElement(!0);o.parentNode&&i[s]&&o.parentNode.insertBefore(i[s].getElement(),o)})}endMove(e){(e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toCol&&this.table.columnManager.moveColumnActual(this.moving,this.toCol,this.toColAfter),this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.touchMove||(document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove)))}moveHover(e){var t=this.table.columnManager.getContentsElement(),i=t.scrollLeft,n=(this.touchMove?e.touches[0].pageX:e.pageX)-Ze.elOffset(t).left+i,s;this.hoverElement.style.left=n-this.startX+"px",n-i<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{s=Math.max(0,i-5),this.table.rowManager.getElement().scrollLeft=s,this.autoScrollTimeout=!1},1))),i+t.clientWidth-n<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{s=Math.min(t.clientWidth,i+5),this.table.rowManager.getElement().scrollLeft=s,this.autoScrollTimeout=!1},1)))}}K(Tv,"moduleName","moveColumn");var AD={delete:function(r,e,t){r.delete()}},ID={insert:function(r,e,t){return this.table.addRow(r.getData(),void 0,e),!0},add:function(r,e,t){return this.table.addRow(r.getData()),!0},update:function(r,e,t){return e?(e.update(r.getData()),!0):!1},replace:function(r,e,t){return e?(this.table.addRow(r.getData(),void 0,e),e.delete(),!0):!1}};const _r=class _r extends Le{constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=150,this.moving=!1,this.toRow=!1,this.toRowAfter=!1,this.hasHandle=!1,this.startY=0,this.startX=0,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.tableRowDropEvent=!1,this.touchMove=!1,this.connection=!1,this.connectionSelectorsTables=!1,this.connectionSelectorsElements=!1,this.connectionElements=[],this.connections=[],this.connectedTable=!1,this.connectedRow=!1,this.registerTableOption("movableRows",!1),this.registerTableOption("movableRowsConnectedTables",!1),this.registerTableOption("movableRowsConnectedElements",!1),this.registerTableOption("movableRowsSender",!1),this.registerTableOption("movableRowsReceiver","insert"),this.registerColumnOption("rowHandle")}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-row"),e.classList.add("tabulator-row-placeholder"),e}initialize(){this.table.options.movableRows&&(this.connectionSelectorsTables=this.table.options.movableRowsConnectedTables,this.connectionSelectorsElements=this.table.options.movableRowsConnectedElements,this.connection=this.connectionSelectorsTables||this.connectionSelectorsElements,this.subscribe("cell-init",this.initializeCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)))}initializeGroupHeader(e){var t=this,i={};i.mouseup=(function(n){t.tableRowDrop(n,e)}).bind(t),i.mousemove=(function(n){var s;n.pageY-Ze.elOffset(e.element).top+t.table.rowManager.element.scrollTop>e.getHeight()/2?(t.toRow!==e||!t.toRowAfter)&&(s=e.getElement(),s.parentNode.insertBefore(t.placeholderElement,s.nextSibling),t.moveRow(e,!0)):(t.toRow!==e||t.toRowAfter)&&(s=e.getElement(),s.previousSibling&&(s.parentNode.insertBefore(t.placeholderElement,s),t.moveRow(e,!1)))}).bind(t),e.modules.moveRow=i}initializeRow(e){var t=this,i={},n;i.mouseup=(function(s){t.tableRowDrop(s,e)}).bind(t),i.mousemove=(function(s){var o=e.getElement();s.pageY-Ze.elOffset(o).top+t.table.rowManager.element.scrollTop>e.getHeight()/2?(t.toRow!==e||!t.toRowAfter)&&(o.parentNode.insertBefore(t.placeholderElement,o.nextSibling),t.moveRow(e,!0)):(t.toRow!==e||t.toRowAfter)&&(o.parentNode.insertBefore(t.placeholderElement,o),t.moveRow(e,!1))}).bind(t),this.hasHandle||(n=e.getElement(),n.addEventListener("mousedown",function(s){s.which===1&&(t.checkTimeout=setTimeout(function(){t.startMove(s,e)},t.checkPeriod))}),n.addEventListener("mouseup",function(s){s.which===1&&t.checkTimeout&&clearTimeout(t.checkTimeout)}),this.bindTouchEvents(e,e.getElement())),e.modules.moveRow=i}initializeColumn(e){e.definition.rowHandle&&this.table.options.movableRows!==!1&&(this.hasHandle=!0)}initializeCell(e){if(e.column.definition.rowHandle&&this.table.options.movableRows!==!1){var t=this,i=e.getElement(!0);i.addEventListener("mousedown",function(n){n.which===1&&(t.checkTimeout=setTimeout(function(){t.startMove(n,e.row)},t.checkPeriod))}),i.addEventListener("mouseup",function(n){n.which===1&&t.checkTimeout&&clearTimeout(t.checkTimeout)}),this.bindTouchEvents(e.row,i)}}bindTouchEvents(e,t){var i=!1,n,s,o,a,l,h;t.addEventListener("touchstart",u=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,n=e.nextRow(),o=n?n.getHeight()/2:0,s=e.prevRow(),a=s?s.getHeight()/2:0,l=0,h=0,i=!1,this.startMove(u,e)},this.checkPeriod)},{passive:!0}),this.moving,this.toRow,this.toRowAfter,t.addEventListener("touchmove",u=>{var c,d;this.moving&&(u.preventDefault(),this.moveHover(u),i||(i=u.touches[0].pageY),c=u.touches[0].pageY-i,c>0?n&&c-l>o&&(d=n,d!==e&&(i=u.touches[0].pageY,d.getElement().parentNode.insertBefore(this.placeholderElement,d.getElement().nextSibling),this.moveRow(d,!0))):s&&-c-h>a&&(d=s,d!==e&&(i=u.touches[0].pageY,d.getElement().parentNode.insertBefore(this.placeholderElement,d.getElement()),this.moveRow(d,!1))),d&&(n=d.nextRow(),l=o,o=n?n.getHeight()/2:0,s=d.prevRow(),h=a,a=s?s.getHeight()/2:0))}),t.addEventListener("touchend",u=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&(this.endMove(u),this.touchMove=!1)})}_bindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveRow.mousemove)})}_unbindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveRow.mousemove)})}startMove(e,t){var i=t.getElement();this.setStartPosition(e,t),this.moving=t,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=t.getWidth()+"px",this.placeholderElement.style.height=t.getHeight()+"px",this.connection?(this.table.element.classList.add("tabulator-movingrow-sending"),this.connectToTables(t)):(i.parentNode.insertBefore(this.placeholderElement,i),i.parentNode.removeChild(i)),this.hoverElement=i.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),this.connection?(document.body.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this.hoverElement.style.width=this.table.element.clientWidth+"px",this.hoverElement.style.whiteSpace="nowrap",this.hoverElement.style.overflow="hidden",this.hoverElement.style.pointerEvents="none"):(this.table.rowManager.getTableElement().appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this._bindMouseMove()),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove),this.dispatchExternal("rowMoving",t.getComponent()),this.moveHover(e)}setStartPosition(e,t){var i=this.touchMove?e.touches[0].pageX:e.pageX,n=this.touchMove?e.touches[0].pageY:e.pageY,s,o;s=t.getElement(),this.connection?(o=s.getBoundingClientRect(),this.startX=o.left-i+window.pageXOffset,this.startY=o.top-n+window.pageYOffset):this.startY=n-s.getBoundingClientRect().top}endMove(e){(!e||e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.connection||(this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement)),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toRow?this.table.rowManager.moveRow(this.moving,this.toRow,this.toRowAfter):this.dispatchExternal("rowMoveCancelled",this.moving.getComponent()),this.moving=!1,this.toRow=!1,this.toRowAfter=!1,document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove),this.connection&&(this.table.element.classList.remove("tabulator-movingrow-sending"),this.disconnectFromTables()))}moveRow(e,t){this.toRow=e,this.toRowAfter=t}moveHover(e){this.connection?this.moveHoverConnections.call(this,e):this.moveHoverTable.call(this,e)}moveHoverTable(e){var t=this.table.rowManager.getElement(),i=t.scrollTop,n=(this.touchMove?e.touches[0].pageY:e.pageY)-t.getBoundingClientRect().top+i;this.hoverElement.style.top=Math.min(n-this.startY,this.table.rowManager.element.scrollHeight-this.hoverElement.offsetHeight)+"px"}moveHoverConnections(e){this.hoverElement.style.left=this.startX+(this.touchMove?e.touches[0].pageX:e.pageX)+"px",this.hoverElement.style.top=this.startY+(this.touchMove?e.touches[0].pageY:e.pageY)+"px"}elementRowDrop(e,t,i){this.dispatchExternal("movableRowsElementDrop",e,t,i?i.getComponent():!1)}connectToTables(e){var t;this.connectionSelectorsTables&&(t=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStart",t),this.commsSend(this.connectionSelectorsTables,"moveRow","connect",{row:e})),this.connectionSelectorsElements&&(this.connectionElements=[],Array.isArray(this.connectionSelectorsElements)||(this.connectionSelectorsElements=[this.connectionSelectorsElements]),this.connectionSelectorsElements.forEach(i=>{typeof i=="string"?this.connectionElements=this.connectionElements.concat(Array.prototype.slice.call(document.querySelectorAll(i))):this.connectionElements.push(i)}),this.connectionElements.forEach(i=>{var n=s=>{this.elementRowDrop(s,i,this.moving)};i.addEventListener("mouseup",n),i.tabulatorElementDropEvent=n,i.classList.add("tabulator-movingrow-receiving")}))}disconnectFromTables(){var e;this.connectionSelectorsTables&&(e=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStop",e),this.commsSend(this.connectionSelectorsTables,"moveRow","disconnect")),this.connectionElements.forEach(t=>{t.classList.remove("tabulator-movingrow-receiving"),t.removeEventListener("mouseup",t.tabulatorElementDropEvent),delete t.tabulatorElementDropEvent})}connect(e,t){return this.connectedTable?(console.warn("Move Row Error - Table cannot accept connection, already connected to table:",this.connectedTable),!1):(this.connectedTable=e,this.connectedRow=t,this.table.element.classList.add("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(i=>{i.type==="row"&&i.modules.moveRow&&i.modules.moveRow.mouseup&&i.getElement().addEventListener("mouseup",i.modules.moveRow.mouseup)}),this.tableRowDropEvent=this.tableRowDrop.bind(this),this.table.element.addEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStart",t,e),!0)}disconnect(e){e===this.connectedTable?(this.connectedTable=!1,this.connectedRow=!1,this.table.element.classList.remove("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(t=>{t.type==="row"&&t.modules.moveRow&&t.modules.moveRow.mouseup&&t.getElement().removeEventListener("mouseup",t.modules.moveRow.mouseup)}),this.table.element.removeEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStop",e)):console.warn("Move Row Error - trying to disconnect from non connected table")}dropComplete(e,t,i){var n=!1;if(i){switch(typeof this.table.options.movableRowsSender){case"string":n=_r.senders[this.table.options.movableRowsSender];break;case"function":n=this.table.options.movableRowsSender;break}n?n.call(this,this.moving?this.moving.getComponent():void 0,t?t.getComponent():void 0,e):this.table.options.movableRowsSender&&console.warn("Mover Row Error - no matching sender found:",this.table.options.movableRowsSender),this.dispatchExternal("movableRowsSent",this.moving.getComponent(),t?t.getComponent():void 0,e)}else this.dispatchExternal("movableRowsSentFailed",this.moving.getComponent(),t?t.getComponent():void 0,e);this.endMove()}tableRowDrop(e,t){var i=!1,n=!1;switch(e.stopImmediatePropagation(),typeof this.table.options.movableRowsReceiver){case"string":i=_r.receivers[this.table.options.movableRowsReceiver];break;case"function":i=this.table.options.movableRowsReceiver;break}i?n=i.call(this,this.connectedRow.getComponent(),t?t.getComponent():void 0,this.connectedTable):console.warn("Mover Row Error - no matching receiver found:",this.table.options.movableRowsReceiver),n?this.dispatchExternal("movableRowsReceived",this.connectedRow.getComponent(),t?t.getComponent():void 0,this.connectedTable):this.dispatchExternal("movableRowsReceivedFailed",this.connectedRow.getComponent(),t?t.getComponent():void 0,this.connectedTable),this.commsSend(this.connectedTable,"moveRow","dropcomplete",{row:t,success:n})}commsReceived(e,t,i){switch(t){case"connect":return this.connect(e,i.row);case"disconnect":return this.disconnect(e);case"dropcomplete":return this.dropComplete(e,i.row,i.success)}}};K(_r,"moduleName","moveRow"),K(_r,"senders",AD),K(_r,"receivers",ID);let vc=_r;var PD={};const gs=class gs extends Le{constructor(e){super(e),this.allowedTypes=["","data","edit","clipboard"],this.enabled=!0,this.registerColumnOption("mutator"),this.registerColumnOption("mutatorParams"),this.registerColumnOption("mutatorData"),this.registerColumnOption("mutatorDataParams"),this.registerColumnOption("mutatorEdit"),this.registerColumnOption("mutatorEditParams"),this.registerColumnOption("mutatorClipboard"),this.registerColumnOption("mutatorClipboardParams"),this.registerColumnOption("mutateLink")}initialize(){this.subscribe("cell-value-changing",this.transformCell.bind(this)),this.subscribe("cell-value-changed",this.mutateLink.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-init-before",this.rowDataChanged.bind(this)),this.subscribe("row-data-changing",this.rowDataChanged.bind(this))}rowDataChanged(e,t,i){return this.transformRow(t,"data",i)}initializeColumn(e){var t=!1,i={};this.allowedTypes.forEach(n=>{var s="mutator"+(n.charAt(0).toUpperCase()+n.slice(1)),o;e.definition[s]&&(o=this.lookupMutator(e.definition[s]),o&&(t=!0,i[s]={mutator:o,params:e.definition[s+"Params"]||{}}))}),t&&(e.modules.mutate=i)}lookupMutator(e){var t=!1;switch(typeof e){case"string":gs.mutators[e]?t=gs.mutators[e]:console.warn("Mutator Error - No such mutator found, ignoring: ",e);break;case"function":t=e;break}return t}transformRow(e,t,i){var n="mutator"+(t.charAt(0).toUpperCase()+t.slice(1)),s;return this.enabled&&this.table.columnManager.traverse(o=>{var a,l,h;o.modules.mutate&&(a=o.modules.mutate[n]||o.modules.mutate.mutator||!1,a&&(s=o.getFieldValue(typeof i<"u"?i:e),(t=="data"&&!i||typeof s<"u")&&(h=o.getComponent(),l=typeof a.params=="function"?a.params(s,e,t,h):a.params,o.setFieldValue(e,a.mutator(s,e,t,l,h)))))}),e}transformCell(e,t){if(e.column.modules.mutate){var i=e.column.modules.mutate.mutatorEdit||e.column.modules.mutate.mutator||!1,n={};if(i)return n=Object.assign(n,e.row.getData()),e.column.setFieldValue(n,t),i.mutator(t,n,"edit",i.params,e.getComponent())}return t}mutateLink(e){var t=e.column.definition.mutateLink;t&&(Array.isArray(t)||(t=[t]),t.forEach(i=>{var n=e.row.getCell(i);n&&n.setValue(n.getValue(),!0,!0)}))}enable(){this.enabled=!0}disable(){this.enabled=!1}};K(gs,"moduleName","mutator"),K(gs,"mutators",PD);let wc=gs;function FD(r,e,t,i,n){var s=document.createElement("span"),o=document.createElement("span"),a=document.createElement("span"),l=document.createElement("span"),h=document.createElement("span"),u=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",c=>{o.innerHTML=c}),this.table.modules.localize.langBind("pagination|counter|of",c=>{l.innerHTML=c}),this.table.modules.localize.langBind("pagination|counter|rows",c=>{u.innerHTML=c}),i?(a.innerHTML=" "+e+"-"+Math.min(e+r-1,i)+" ",h.innerHTML=" "+i+" ",s.appendChild(o),s.appendChild(a),s.appendChild(l),s.appendChild(h),s.appendChild(u)):(a.innerHTML=" 0 ",s.appendChild(o),s.appendChild(a),s.appendChild(u)),s}function OD(r,e,t,i,n){var s=document.createElement("span"),o=document.createElement("span"),a=document.createElement("span"),l=document.createElement("span"),h=document.createElement("span"),u=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",c=>{o.innerHTML=c}),a.innerHTML=" "+t+" ",this.table.modules.localize.langBind("pagination|counter|of",c=>{l.innerHTML=c}),h.innerHTML=" "+n+" ",this.table.modules.localize.langBind("pagination|counter|pages",c=>{u.innerHTML=c}),s.appendChild(o),s.appendChild(a),s.appendChild(l),s.appendChild(h),s.appendChild(u),s}var DD={rows:FD,pages:OD};const Co=class Co extends Le{constructor(e){super(e),this.mode="local",this.progressiveLoad=!1,this.element=null,this.pageCounterElement=null,this.pageCounter=null,this.size=0,this.page=1,this.count=5,this.max=1,this.remoteRowCountEstimate=null,this.initialLoad=!0,this.dataChanging=!1,this.pageSizes=[],this.registerTableOption("pagination",!1),this.registerTableOption("paginationMode","local"),this.registerTableOption("paginationSize",!1),this.registerTableOption("paginationInitialPage",1),this.registerTableOption("paginationCounter",!1),this.registerTableOption("paginationCounterElement",!1),this.registerTableOption("paginationButtonCount",5),this.registerTableOption("paginationSizeSelector",!1),this.registerTableOption("paginationElement",!1),this.registerTableOption("paginationAddRow","page"),this.registerTableOption("progressiveLoad",!1),this.registerTableOption("progressiveLoadDelay",0),this.registerTableOption("progressiveLoadScrollMargin",0),this.registerTableFunction("setMaxPage",this.setMaxPage.bind(this)),this.registerTableFunction("setPage",this.setPage.bind(this)),this.registerTableFunction("setPageToRow",this.userSetPageToRow.bind(this)),this.registerTableFunction("setPageSize",this.userSetPageSize.bind(this)),this.registerTableFunction("getPageSize",this.getPageSize.bind(this)),this.registerTableFunction("previousPage",this.previousPage.bind(this)),this.registerTableFunction("nextPage",this.nextPage.bind(this)),this.registerTableFunction("getPage",this.getPage.bind(this)),this.registerTableFunction("getPageMax",this.getPageMax.bind(this)),this.registerComponentFunction("row","pageTo",this.setPageToRow.bind(this))}initialize(){this.table.options.pagination?(this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("footer-redraw",this.footerRedraw.bind(this)),this.table.options.paginationAddRow=="page"&&this.subscribe("row-adding-position",this.rowAddingPosition.bind(this)),this.table.options.paginationMode==="remote"&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this))),this.table.options.progressiveLoad&&console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time"),this.registerDisplayHandler(this.restOnRenderBefore.bind(this),40),this.registerDisplayHandler(this.getRows.bind(this),50),this.createElements(),this.initializePageCounter(),this.initializePaginator()):this.table.options.progressiveLoad&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.initializeProgressive(this.table.options.progressiveLoad),this.table.options.progressiveLoad==="scroll"&&this.subscribe("scroll-vertical",this.scrollVertical.bind(this)))}rowAddingPosition(e,t){var i=this.table.rowManager,n=i.getDisplayRows(),s;return t?n.length?s=n[0]:i.activeRows.length&&(s=i.activeRows[i.activeRows.length-1],t=!1):n.length&&(s=n[n.length-1],t=!(n.length<this.size)),{index:s,top:t}}calculatePageSizes(){var e,t;this.table.options.paginationSize?this.size=this.table.options.paginationSize:(e=document.createElement("div"),e.classList.add("tabulator-row"),e.style.visibility="hidden",t=document.createElement("div"),t.classList.add("tabulator-cell"),t.innerHTML="Page Row Test",e.appendChild(t),this.table.rowManager.getTableElement().appendChild(e),this.size=Math.floor(this.table.rowManager.getElement().clientHeight/e.offsetHeight),this.table.rowManager.getTableElement().removeChild(e)),this.dispatchExternal("pageSizeChanged",this.size),this.generatePageSizeSelectList()}initialLoadComplete(){this.initialLoad=!1}remotePageParams(e,t,i,n){return this.initialLoad||(this.progressiveLoad&&!i||!this.progressiveLoad&&!this.dataChanging)&&this.reset(!0),n.page=this.page,this.size&&(n.size=this.size),n}userSetPageToRow(e){return this.table.options.pagination&&(e=this.table.rowManager.findRow(e),e)?this.setPageToRow(e):Promise.reject()}userSetPageSize(e){return this.table.options.pagination?(this.setPageSize(e),this.setPage(1)):!1}scrollVertical(e,t){var i,n,s;!t&&!this.table.dataLoader.loading&&(i=this.table.rowManager.getElement(),n=i.scrollHeight-i.clientHeight-e,s=this.table.options.progressiveLoadScrollMargin||i.clientHeight*2,n<s&&this.nextPage().catch(()=>{}))}restOnRenderBefore(e,t){return t||this.mode==="local"&&this.reset(),e}rowsUpdated(){this.refreshData(!0,"all")}createElements(){var e;this.element=document.createElement("span"),this.element.classList.add("tabulator-paginator"),this.pagesElement=document.createElement("span"),this.pagesElement.classList.add("tabulator-pages"),e=document.createElement("button"),e.classList.add("tabulator-page"),e.setAttribute("type","button"),e.setAttribute("role","button"),e.setAttribute("aria-label",""),e.setAttribute("title",""),this.firstBut=e.cloneNode(!0),this.firstBut.setAttribute("data-page","first"),this.prevBut=e.cloneNode(!0),this.prevBut.setAttribute("data-page","prev"),this.nextBut=e.cloneNode(!0),this.nextBut.setAttribute("data-page","next"),this.lastBut=e.cloneNode(!0),this.lastBut.setAttribute("data-page","last"),this.table.options.paginationSizeSelector&&(this.pageSizeSelect=document.createElement("select"),this.pageSizeSelect.classList.add("tabulator-page-size"))}generatePageSizeSelectList(){var e=[];if(this.pageSizeSelect){if(Array.isArray(this.table.options.paginationSizeSelector))e=this.table.options.paginationSizeSelector,this.pageSizes=e,this.pageSizes.indexOf(this.size)==-1&&e.unshift(this.size);else if(this.pageSizes.indexOf(this.size)==-1){e=[];for(let t=1;t<5;t++)e.push(this.size*t);this.pageSizes=e}else e=this.pageSizes;for(;this.pageSizeSelect.firstChild;)this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild);e.forEach(t=>{var i=document.createElement("option");i.value=t,t===!0?this.langBind("pagination|all",function(n){i.innerHTML=n}):i.innerHTML=t,this.pageSizeSelect.appendChild(i)}),this.pageSizeSelect.value=this.size}}initializePageCounter(){var e=this.table.options.paginationCounter,t=null;e&&(typeof e=="function"?t=e:t=Co.pageCounters[e],t?(this.pageCounter=t,this.pageCounterElement=document.createElement("span"),this.pageCounterElement.classList.add("tabulator-page-counter")):console.warn("Pagination Error - No such page counter found: ",e))}initializePaginator(e){var t,i;e||(this.langBind("pagination|first",n=>{this.firstBut.innerHTML=n}),this.langBind("pagination|first_title",n=>{this.firstBut.setAttribute("aria-label",n),this.firstBut.setAttribute("title",n)}),this.langBind("pagination|prev",n=>{this.prevBut.innerHTML=n}),this.langBind("pagination|prev_title",n=>{this.prevBut.setAttribute("aria-label",n),this.prevBut.setAttribute("title",n)}),this.langBind("pagination|next",n=>{this.nextBut.innerHTML=n}),this.langBind("pagination|next_title",n=>{this.nextBut.setAttribute("aria-label",n),this.nextBut.setAttribute("title",n)}),this.langBind("pagination|last",n=>{this.lastBut.innerHTML=n}),this.langBind("pagination|last_title",n=>{this.lastBut.setAttribute("aria-label",n),this.lastBut.setAttribute("title",n)}),this.firstBut.addEventListener("click",()=>{this.setPage(1)}),this.prevBut.addEventListener("click",()=>{this.previousPage()}),this.nextBut.addEventListener("click",()=>{this.nextPage()}),this.lastBut.addEventListener("click",()=>{this.setPage(this.max)}),this.table.options.paginationElement&&(this.element=this.table.options.paginationElement),this.pageSizeSelect&&(t=document.createElement("label"),this.langBind("pagination|page_size",n=>{this.pageSizeSelect.setAttribute("aria-label",n),this.pageSizeSelect.setAttribute("title",n),t.innerHTML=n}),this.element.appendChild(t),this.element.appendChild(this.pageSizeSelect),this.pageSizeSelect.addEventListener("change",n=>{this.setPageSize(this.pageSizeSelect.value=="true"?!0:this.pageSizeSelect.value),this.setPage(1)})),this.element.appendChild(this.firstBut),this.element.appendChild(this.prevBut),this.element.appendChild(this.pagesElement),this.element.appendChild(this.nextBut),this.element.appendChild(this.lastBut),this.table.options.paginationElement||(this.table.options.paginationCounter&&(this.table.options.paginationCounterElement?this.table.options.paginationCounterElement instanceof HTMLElement?this.table.options.paginationCounterElement.appendChild(this.pageCounterElement):typeof this.table.options.paginationCounterElement=="string"&&(i=document.querySelector(this.table.options.paginationCounterElement),i?i.appendChild(this.pageCounterElement):console.warn("Pagination Error - Unable to find element matching paginationCounterElement selector:",this.table.options.paginationCounterElement)):this.footerAppend(this.pageCounterElement)),this.footerAppend(this.element)),this.page=this.table.options.paginationInitialPage,this.count=this.table.options.paginationButtonCount),this.mode=this.table.options.paginationMode}initializeProgressive(e){this.initializePaginator(!0),this.mode="progressive_"+e,this.progressiveLoad=!0}trackChanges(){this.dispatch("page-changed")}setMaxRows(e){e?this.max=this.size===!0?1:Math.ceil(e/this.size):this.max=1,this.page>this.max&&(this.page=this.max)}reset(e){this.initialLoad||(this.mode=="local"||e)&&(this.page=1,this.trackChanges())}setMaxPage(e){e=parseInt(e),this.max=e||1,this.page>this.max&&(this.page=this.max,this.trigger())}setPage(e){switch(e){case"first":return this.setPage(1);case"prev":return this.previousPage();case"next":return this.nextPage();case"last":return this.setPage(this.max)}return e=parseInt(e),e>0&&e<=this.max||this.mode!=="local"?(this.page=e,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Requested page is out of range of 1 - "+this.max+":",e),Promise.reject())}setPageToRow(e){var t=this.displayRows(-1),i=t.indexOf(e);if(i>-1){var n=this.size===!0?1:Math.ceil((i+1)/this.size);return this.setPage(n)}else return console.warn("Pagination Error - Requested row is not visible"),Promise.reject()}setPageSize(e){e!==!0&&(e=parseInt(e)),e>0&&(this.size=e,this.dispatchExternal("pageSizeChanged",e)),this.pageSizeSelect&&this.generatePageSizeSelectList(),this.trackChanges()}_setPageCounter(e,t,i){var n;if(this.pageCounter)switch(this.mode==="remote"&&(t=this.size,i=(this.page-1)*this.size+1,e=this.remoteRowCountEstimate),n=this.pageCounter.call(this,t,i,this.page,e,this.max),typeof n){case"object":if(n instanceof Node){for(;this.pageCounterElement.firstChild;)this.pageCounterElement.removeChild(this.pageCounterElement.firstChild);this.pageCounterElement.appendChild(n)}else this.pageCounterElement.innerHTML="",n!=null&&console.warn("Page Counter Error - Page Counter has returned a type of object, the only valid page counter object return is an instance of Node, the page counter returned:",n);break;case"undefined":this.pageCounterElement.innerHTML="";break;default:this.pageCounterElement.innerHTML=n}}_setPageButtons(){let e=Math.floor((this.count-1)/2),t=Math.ceil((this.count-1)/2),i=this.max-this.page+e+1<this.count?this.max-this.count+1:Math.max(this.page-e,1),n=this.page<=t?Math.min(this.count,this.max):Math.min(this.page+t,this.max);for(;this.pagesElement.firstChild;)this.pagesElement.removeChild(this.pagesElement.firstChild);this.page==1?(this.firstBut.disabled=!0,this.prevBut.disabled=!0):(this.firstBut.disabled=!1,this.prevBut.disabled=!1),this.page==this.max?(this.lastBut.disabled=!0,this.nextBut.disabled=!0):(this.lastBut.disabled=!1,this.nextBut.disabled=!1);for(let s=i;s<=n;s++)s>0&&s<=this.max&&this.pagesElement.appendChild(this._generatePageButton(s));this.footerRedraw()}_generatePageButton(e){var t=document.createElement("button");return t.classList.add("tabulator-page"),e==this.page&&t.classList.add("active"),t.setAttribute("type","button"),t.setAttribute("role","button"),this.langBind("pagination|page_title",i=>{t.setAttribute("aria-label",i+" "+e),t.setAttribute("title",i+" "+e)}),t.setAttribute("data-page",e),t.textContent=e,t.addEventListener("click",i=>{this.setPage(e)}),t}previousPage(){return this.page>1?(this.page--,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Previous page would be less than page 1:",0),Promise.reject())}nextPage(){return this.page<this.max?(this.page++,this.trackChanges(),this.trigger()):(this.progressiveLoad||console.warn("Pagination Error - Next page would be greater than maximum page of "+this.max+":",this.max+1),Promise.reject())}getPage(){return this.page}getPageMax(){return this.max}getPageSize(e){return this.size}getMode(){return this.mode}getRows(e){var t=0,i,n,s,o,a=e.filter(l=>l.type==="row");if(this.mode=="local"){i=[],this.setMaxRows(e.length),this.size===!0?(n=0,s=e.length):(n=this.size*(this.page-1),s=n+parseInt(this.size)),this._setPageButtons();for(let l=n;l<s;l++){let h=e[l];h&&(i.push(h),h.type==="row"&&(o||(o=h),t++))}return this._setPageCounter(a.length,t,o?a.indexOf(o)+1:0),i}else return this._setPageButtons(),this._setPageCounter(a.length),e.slice(0)}trigger(){var e;switch(this.mode){case"local":return e=this.table.rowManager.scrollLeft,this.refreshData(),this.table.rowManager.scrollHorizontal(e),this.dispatchExternal("pageLoaded",this.getPage()),Promise.resolve();case"remote":return this.dataChanging=!0,this.reloadData(null).finally(()=>{this.dataChanging=!1});case"progressive_load":case"progressive_scroll":return this.reloadData(null,!0);default:return console.warn("Pagination Error - no such pagination mode:",this.mode),Promise.reject()}}_parseRemoteData(e){var t;if(typeof e.last_page>"u"&&console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").last_page||"last_page")+"' property"),e.data)if(this.max=parseInt(e.last_page)||1,this.remoteRowCountEstimate=typeof e.last_row<"u"?e.last_row:e.last_page*this.size-(this.page==e.last_page?this.size-e.data.length:0),this.progressiveLoad){switch(this.mode){case"progressive_load":this.page==1?this.table.rowManager.setData(e.data,!1,this.page==1):this.table.rowManager.addRows(e.data),this.page<this.max&&setTimeout(()=>{this.nextPage()},this.table.options.progressiveLoadDelay);break;case"progressive_scroll":e=this.page===1?e.data:this.table.rowManager.getData().concat(e.data),this.table.rowManager.setData(e,this.page!==1,this.page==1),t=this.table.options.progressiveLoadScrollMargin||this.table.rowManager.element.clientHeight*2,this.table.rowManager.element.scrollHeight<=this.table.rowManager.element.clientHeight+t&&this.page<this.max&&setTimeout(()=>{this.nextPage()});break}return!1}else this.dispatchExternal("pageLoaded",this.getPage());else console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").data||"data")+"' property");return e.data}footerRedraw(){var e=this.table.footerManager.containerElement;Math.ceil(e.clientWidth)-e.scrollWidth<0?this.pagesElement.style.display="none":(this.pagesElement.style.display="",Math.ceil(e.clientWidth)-e.scrollWidth<0&&(this.pagesElement.style.display="none"))}};K(Co,"moduleName","page"),K(Co,"pageCounters",DD);let Ec=Co;var kD={local:function(r,e){var t=localStorage.getItem(r+"-"+e);return t?JSON.parse(t):!1},cookie:function(r,e){var t=document.cookie,i=r+"-"+e,n=t.indexOf(i+"="),s,o;return n>-1&&(t=t.slice(n),s=t.indexOf(";"),s>-1&&(t=t.slice(0,s)),o=t.replace(i+"=","")),o?JSON.parse(o):!1}},ND={local:function(r,e,t){localStorage.setItem(r+"-"+e,JSON.stringify(t))},cookie:function(r,e,t){var i=new Date;i.setDate(i.getDate()+1e4),document.cookie=r+"-"+e+"="+JSON.stringify(t)+"; expires="+i.toUTCString()}};const Gt=class Gt extends Le{constructor(e){super(e),this.mode="",this.id="",this.defWatcherBlock=!1,this.config={},this.readFunc=!1,this.writeFunc=!1,this.registerTableOption("persistence",!1),this.registerTableOption("persistenceID",""),this.registerTableOption("persistenceMode",!0),this.registerTableOption("persistenceReaderFunc",!1),this.registerTableOption("persistenceWriterFunc",!1)}localStorageTest(){var e="_tabulator_test";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch{return!1}}initialize(){if(this.table.options.persistence){var e=this.table.options.persistenceMode,t=this.table.options.persistenceID,i;this.mode=e!==!0?e:this.localStorageTest()?"local":"cookie",this.table.options.persistenceReaderFunc?typeof this.table.options.persistenceReaderFunc=="function"?this.readFunc=this.table.options.persistenceReaderFunc:Gt.readers[this.table.options.persistenceReaderFunc]?this.readFunc=Gt.readers[this.table.options.persistenceReaderFunc]:console.warn("Persistence Read Error - invalid reader set",this.table.options.persistenceReaderFunc):Gt.readers[this.mode]?this.readFunc=Gt.readers[this.mode]:console.warn("Persistence Read Error - invalid reader set",this.mode),this.table.options.persistenceWriterFunc?typeof this.table.options.persistenceWriterFunc=="function"?this.writeFunc=this.table.options.persistenceWriterFunc:Gt.writers[this.table.options.persistenceWriterFunc]?this.writeFunc=Gt.writers[this.table.options.persistenceWriterFunc]:console.warn("Persistence Write Error - invalid reader set",this.table.options.persistenceWriterFunc):Gt.writers[this.mode]?this.writeFunc=Gt.writers[this.mode]:console.warn("Persistence Write Error - invalid writer set",this.mode),this.id="tabulator-"+(t||this.table.element.getAttribute("id")||""),this.config={sort:this.table.options.persistence===!0||this.table.options.persistence.sort,filter:this.table.options.persistence===!0||this.table.options.persistence.filter,headerFilter:this.table.options.persistence===!0||this.table.options.persistence.headerFilter,group:this.table.options.persistence===!0||this.table.options.persistence.group,page:this.table.options.persistence===!0||this.table.options.persistence.page,columns:this.table.options.persistence===!0?["title","width","visible"]:this.table.options.persistence.columns},this.config.page&&(i=this.retrieveData("page"),i&&(typeof i.paginationSize<"u"&&(this.config.page===!0||this.config.page.size)&&(this.table.options.paginationSize=i.paginationSize),typeof i.paginationInitialPage<"u"&&(this.config.page===!0||this.config.page.page)&&(this.table.options.paginationInitialPage=i.paginationInitialPage))),this.config.group&&(i=this.retrieveData("group"),i&&(typeof i.groupBy<"u"&&(this.config.group===!0||this.config.group.groupBy)&&(this.table.options.groupBy=i.groupBy),typeof i.groupStartOpen<"u"&&(this.config.group===!0||this.config.group.groupStartOpen)&&(this.table.options.groupStartOpen=i.groupStartOpen),typeof i.groupHeader<"u"&&(this.config.group===!0||this.config.group.groupHeader)&&(this.table.options.groupHeader=i.groupHeader))),this.config.columns&&(this.table.options.columns=this.load("columns",this.table.options.columns),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-show",this.save.bind(this,"columns")),this.subscribe("column-hide",this.save.bind(this,"columns")),this.subscribe("column-moved",this.save.bind(this,"columns"))),this.subscribe("table-built",this.tableBuilt.bind(this),0),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("filter-changed",this.eventSave.bind(this,"filter")),this.subscribe("filter-changed",this.eventSave.bind(this,"headerFilter")),this.subscribe("sort-changed",this.eventSave.bind(this,"sort")),this.subscribe("group-changed",this.eventSave.bind(this,"group")),this.subscribe("page-changed",this.eventSave.bind(this,"page")),this.subscribe("column-resized",this.eventSave.bind(this,"columns")),this.subscribe("column-width",this.eventSave.bind(this,"columns")),this.subscribe("layout-refreshed",this.eventSave.bind(this,"columns"))}this.registerTableFunction("getColumnLayout",this.getColumnLayout.bind(this)),this.registerTableFunction("setColumnLayout",this.setColumnLayout.bind(this))}eventSave(e){this.config[e]&&this.save(e)}tableBuilt(){var e,t,i;this.config.sort&&(e=this.load("sort"),e&&(this.table.options.initialSort=e)),this.config.filter&&(t=this.load("filter"),t&&(this.table.options.initialFilter=t)),this.config.headerFilter&&(i=this.load("headerFilter"),i&&(this.table.options.initialHeaderFilter=i))}tableRedraw(e){e&&this.config.columns&&this.save("columns")}getColumnLayout(){return this.parseColumns(this.table.columnManager.getColumns())}setColumnLayout(e){return this.table.columnManager.setColumns(this.mergeDefinition(this.table.options.columns,e,!0)),!0}initializeColumn(e){var t,i;this.config.columns&&(this.defWatcherBlock=!0,t=e.getDefinition(),i=this.config.columns===!0?Object.keys(t):this.config.columns,i.forEach(n=>{var s=Object.getOwnPropertyDescriptor(t,n),o=t[n];s&&Object.defineProperty(t,n,{set:a=>{o=a,this.defWatcherBlock||this.save("columns"),s.set&&s.set(a)},get:()=>(s.get&&s.get(),o)})}),this.defWatcherBlock=!1)}load(e,t){var i=this.retrieveData(e);return t&&(i=i?this.mergeDefinition(t,i):t),i}retrieveData(e){return this.readFunc?this.readFunc(this.id,e):!1}mergeDefinition(e,t,i){var n=[];return t=t||[],t.forEach((s,o)=>{var a=this._findColumn(e,s),l;a&&(i?l=Object.keys(s):this.config.columns===!0||this.config.columns==null?(l=Object.keys(a),l.push("width")):l=this.config.columns,l.forEach(h=>{h!=="columns"&&typeof s[h]<"u"&&(a[h]=s[h])}),a.columns&&(a.columns=this.mergeDefinition(a.columns,s.columns)),n.push(a))}),e.forEach((s,o)=>{var a=this._findColumn(t,s);a||(n.length>o?n.splice(o,0,s):n.push(s))}),n}_findColumn(e,t){var i=t.columns?"group":t.field?"field":"object";return e.find(function(n){switch(i){case"group":return n.title===t.title&&n.columns.length===t.columns.length;case"field":return n.field===t.field;case"object":return n===t}})}save(e){var t={};switch(e){case"columns":t=this.parseColumns(this.table.columnManager.getColumns());break;case"filter":t=this.table.modules.filter.getFilters();break;case"headerFilter":t=this.table.modules.filter.getHeaderFilters();break;case"sort":t=this.validateSorters(this.table.modules.sort.getSort());break;case"group":t=this.getGroupConfig();break;case"page":t=this.getPageConfig();break}this.writeFunc&&this.writeFunc(this.id,e,t)}validateSorters(e){return e.forEach(function(t){t.column=t.field,delete t.field}),e}getGroupConfig(){var e={};return this.config.group&&((this.config.group===!0||this.config.group.groupBy)&&(e.groupBy=this.table.options.groupBy),(this.config.group===!0||this.config.group.groupStartOpen)&&(e.groupStartOpen=this.table.options.groupStartOpen),(this.config.group===!0||this.config.group.groupHeader)&&(e.groupHeader=this.table.options.groupHeader)),e}getPageConfig(){var e={};return this.config.page&&((this.config.page===!0||this.config.page.size)&&(e.paginationSize=this.table.modules.page.getPageSize()),(this.config.page===!0||this.config.page.page)&&(e.paginationInitialPage=this.table.modules.page.getPage())),e}parseColumns(e){var t=[],i=["headerContextMenu","headerMenu","contextMenu","clickMenu"];return e.forEach(n=>{var s={},o=n.getDefinition(),a;n.isGroup?(s.title=o.title,s.columns=this.parseColumns(n.getColumns())):(s.field=n.getField(),this.config.columns===!0||this.config.columns==null?(a=Object.keys(o),a.push("width"),a.push("visible")):a=this.config.columns,a.forEach(l=>{switch(l){case"width":s.width=n.getWidth();break;case"visible":s.visible=n.visible;break;default:typeof o[l]!="function"&&i.indexOf(l)===-1&&(s[l]=o[l])}})),t.push(s)}),t}};K(Gt,"moduleName","persistence"),K(Gt,"moduleInitOrder",-10),K(Gt,"readers",kD),K(Gt,"writers",ND);let _c=Gt;class Mv extends Le{constructor(e){super(e),this.columnSubscribers={},this.registerTableOption("rowContextPopup",!1),this.registerTableOption("rowClickPopup",!1),this.registerTableOption("rowDblClickPopup",!1),this.registerTableOption("groupContextPopup",!1),this.registerTableOption("groupClickPopup",!1),this.registerTableOption("groupDblClickPopup",!1),this.registerColumnOption("headerContextPopup"),this.registerColumnOption("headerClickPopup"),this.registerColumnOption("headerDblClickPopup"),this.registerColumnOption("headerPopup"),this.registerColumnOption("headerPopupIcon"),this.registerColumnOption("contextPopup"),this.registerColumnOption("clickPopup"),this.registerColumnOption("dblClickPopup"),this.registerComponentFunction("cell","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("column","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("row","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("group","popup",this._componentPopupCall.bind(this))}initialize(){this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}_componentPopupCall(e,t,i){this.loadPopupEvent(t,null,e,i)}initializeRowWatchers(){this.table.options.rowContextPopup&&(this.subscribe("row-contextmenu",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup)),this.table.on("rowTapHold",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup))),this.table.options.rowClickPopup&&this.subscribe("row-click",this.loadPopupEvent.bind(this,this.table.options.rowClickPopup)),this.table.options.rowDblClickPopup&&this.subscribe("row-dblclick",this.loadPopupEvent.bind(this,this.table.options.rowDblClickPopup))}initializeGroupWatchers(){this.table.options.groupContextPopup&&(this.subscribe("group-contextmenu",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup)),this.table.on("groupTapHold",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup))),this.table.options.groupClickPopup&&this.subscribe("group-click",this.loadPopupEvent.bind(this,this.table.options.groupClickPopup)),this.table.options.groupDblClickPopup&&this.subscribe("group-dblclick",this.loadPopupEvent.bind(this,this.table.options.groupDblClickPopup))}initializeColumn(e){var t=e.definition;t.headerContextPopup&&!this.columnSubscribers.headerContextPopup&&(this.columnSubscribers.headerContextPopup=this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextPopup),this.table.on("headerTapHold",this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"))),t.headerClickPopup&&!this.columnSubscribers.headerClickPopup&&(this.columnSubscribers.headerClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerClickPopup"),this.subscribe("column-click",this.columnSubscribers.headerClickPopup)),t.headerDblClickPopup&&!this.columnSubscribers.headerDblClickPopup&&(this.columnSubscribers.headerDblClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerDblClickPopup"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickPopup)),t.headerPopup&&this.initializeColumnHeaderPopup(e),t.contextPopup&&!this.columnSubscribers.contextPopup&&(this.columnSubscribers.contextPopup=this.loadPopupTableCellEvent.bind(this,"contextPopup"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextPopup),this.table.on("cellTapHold",this.loadPopupTableCellEvent.bind(this,"contextPopup"))),t.clickPopup&&!this.columnSubscribers.clickPopup&&(this.columnSubscribers.clickPopup=this.loadPopupTableCellEvent.bind(this,"clickPopup"),this.subscribe("cell-click",this.columnSubscribers.clickPopup)),t.dblClickPopup&&!this.columnSubscribers.dblClickPopup&&(this.columnSubscribers.dblClickPopup=this.loadPopupTableCellEvent.bind(this,"dblClickPopup"),this.subscribe("cell-click",this.columnSubscribers.dblClickPopup))}initializeColumnHeaderPopup(e){var t=e.definition.headerPopupIcon,i;i=document.createElement("span"),i.classList.add("tabulator-header-popup-button"),t?(typeof t=="function"&&(t=t(e.getComponent())),t instanceof HTMLElement?i.appendChild(t):i.innerHTML=t):i.innerHTML="&vellip;",i.addEventListener("click",n=>{n.stopPropagation(),n.preventDefault(),this.loadPopupEvent(e.definition.headerPopup,n,e)}),e.titleElement.insertBefore(i,e.titleElement.firstChild)}loadPopupTableCellEvent(e,t,i){i._cell&&(i=i._cell),i.column.definition[e]&&this.loadPopupEvent(i.column.definition[e],t,i)}loadPopupTableColumnEvent(e,t,i){i._column&&(i=i._column),i.definition[e]&&this.loadPopupEvent(i.definition[e],t,i)}loadPopupEvent(e,t,i,n){var s;function o(a){s=a}i._group?i=i._group:i._row&&(i=i._row),e=typeof e=="function"?e.call(this.table,t,i.getComponent(),o):e,this.loadPopup(t,i,e,s,n)}loadPopup(e,t,i,n,s){var o=!(e instanceof MouseEvent),a,l;i instanceof HTMLElement?a=i:(a=document.createElement("div"),a.innerHTML=i),a.classList.add("tabulator-popup"),a.addEventListener("click",h=>{h.stopPropagation()}),o||e.preventDefault(),l=this.popup(a),typeof n=="function"&&l.renderCallback(n),e?l.show(e):l.show(t.getElement(),s||"center"),l.hideOnBlur(()=>{this.dispatchExternal("popupClosed",t.getComponent())}),this.dispatchExternal("popupOpened",t.getComponent())}}K(Mv,"moduleName","popup");class Lv extends Le{constructor(e){super(e),this.element=!1,this.manualBlock=!1,this.beforeprintEventHandler=null,this.afterprintEventHandler=null,this.registerTableOption("printAsHtml",!1),this.registerTableOption("printFormatter",!1),this.registerTableOption("printHeader",!1),this.registerTableOption("printFooter",!1),this.registerTableOption("printStyled",!0),this.registerTableOption("printRowRange","visible"),this.registerTableOption("printConfig",{}),this.registerColumnOption("print"),this.registerColumnOption("titlePrint")}initialize(){this.table.options.printAsHtml&&(this.beforeprintEventHandler=this.replaceTable.bind(this),this.afterprintEventHandler=this.cleanup.bind(this),window.addEventListener("beforeprint",this.beforeprintEventHandler),window.addEventListener("afterprint",this.afterprintEventHandler),this.subscribe("table-destroy",this.destroy.bind(this))),this.registerTableFunction("print",this.printFullscreen.bind(this))}destroy(){this.table.options.printAsHtml&&(window.removeEventListener("beforeprint",this.beforeprintEventHandler),window.removeEventListener("afterprint",this.afterprintEventHandler))}replaceTable(){this.manualBlock||(this.element=document.createElement("div"),this.element.classList.add("tabulator-print-table"),this.element.appendChild(this.table.modules.export.generateTable(this.table.options.printConfig,this.table.options.printStyled,this.table.options.printRowRange,"print")),this.table.element.style.display="none",this.table.element.parentNode.insertBefore(this.element,this.table.element))}cleanup(){document.body.classList.remove("tabulator-print-fullscreen-hide"),this.element&&this.element.parentNode&&(this.element.parentNode.removeChild(this.element),this.table.element.style.display="")}printFullscreen(e,t,i){var n=window.scrollX,s=window.scrollY,o=document.createElement("div"),a=document.createElement("div"),l=this.table.modules.export.generateTable(typeof i<"u"?i:this.table.options.printConfig,typeof t<"u"?t:this.table.options.printStyled,e||this.table.options.printRowRange,"print"),h,u;this.manualBlock=!0,this.element=document.createElement("div"),this.element.classList.add("tabulator-print-fullscreen"),this.table.options.printHeader&&(o.classList.add("tabulator-print-header"),h=typeof this.table.options.printHeader=="function"?this.table.options.printHeader.call(this.table):this.table.options.printHeader,typeof h=="string"?o.innerHTML=h:o.appendChild(h),this.element.appendChild(o)),this.element.appendChild(l),this.table.options.printFooter&&(a.classList.add("tabulator-print-footer"),u=typeof this.table.options.printFooter=="function"?this.table.options.printFooter.call(this.table):this.table.options.printFooter,typeof u=="string"?a.innerHTML=u:a.appendChild(u),this.element.appendChild(a)),document.body.classList.add("tabulator-print-fullscreen-hide"),document.body.appendChild(this.element),this.table.options.printFormatter&&this.table.options.printFormatter(this.element,l),window.print(),this.cleanup(),window.scrollTo(n,s),this.manualBlock=!1}}K(Lv,"moduleName","print");class Av extends Le{constructor(e){super(e),this.data=!1,this.blocked=!1,this.origFuncs={},this.currentVersion=0,this.registerTableOption("reactiveData",!1)}initialize(){this.table.options.reactiveData&&(this.subscribe("cell-value-save-before",this.block.bind(this,"cellsave")),this.subscribe("cell-value-save-after",this.unblock.bind(this,"cellsave")),this.subscribe("row-data-save-before",this.block.bind(this,"rowsave")),this.subscribe("row-data-save-after",this.unblock.bind(this,"rowsave")),this.subscribe("row-data-init-after",this.watchRow.bind(this)),this.subscribe("data-processing",this.watchData.bind(this)),this.subscribe("table-destroy",this.unwatchData.bind(this)))}watchData(e){var t=this,i;this.currentVersion++,i=this.currentVersion,this.unwatchData(),this.data=e,this.origFuncs.push=e.push,Object.defineProperty(this.data,"push",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),s;return!t.blocked&&i===t.currentVersion&&(t.block("data-push"),n.forEach(o=>{t.table.rowManager.addRowActual(o,!1)}),s=t.origFuncs.push.apply(e,arguments),t.unblock("data-push")),s}}),this.origFuncs.unshift=e.unshift,Object.defineProperty(this.data,"unshift",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),s;return!t.blocked&&i===t.currentVersion&&(t.block("data-unshift"),n.forEach(o=>{t.table.rowManager.addRowActual(o,!0)}),s=t.origFuncs.unshift.apply(e,arguments),t.unblock("data-unshift")),s}}),this.origFuncs.shift=e.shift,Object.defineProperty(this.data,"shift",{enumerable:!1,configurable:!0,value:function(){var n,s;return!t.blocked&&i===t.currentVersion&&(t.block("data-shift"),t.data.length&&(n=t.table.rowManager.getRowFromDataObject(t.data[0]),n&&n.deleteActual()),s=t.origFuncs.shift.call(e),t.unblock("data-shift")),s}}),this.origFuncs.pop=e.pop,Object.defineProperty(this.data,"pop",{enumerable:!1,configurable:!0,value:function(){var n,s;return!t.blocked&&i===t.currentVersion&&(t.block("data-pop"),t.data.length&&(n=t.table.rowManager.getRowFromDataObject(t.data[t.data.length-1]),n&&n.deleteActual()),s=t.origFuncs.pop.call(e),t.unblock("data-pop")),s}}),this.origFuncs.splice=e.splice,Object.defineProperty(this.data,"splice",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),s=n[0]<0?e.length+n[0]:n[0],o=n[1],a=n[2]?n.slice(2):!1,l,h;if(!t.blocked&&i===t.currentVersion){if(t.block("data-splice"),a&&(l=e[s]?t.table.rowManager.getRowFromDataObject(e[s]):!1,l?a.forEach(c=>{t.table.rowManager.addRowActual(c,!0,l,!0)}):(a=a.slice().reverse(),a.forEach(c=>{t.table.rowManager.addRowActual(c,!0,!1,!0)}))),o!==0){var u=e.slice(s,typeof n[1]>"u"?n[1]:s+o);u.forEach((c,d)=>{var f=t.table.rowManager.getRowFromDataObject(c);f&&f.deleteActual(d!==u.length-1)})}(a||o!==0)&&t.table.rowManager.reRenderInPosition(),h=t.origFuncs.splice.apply(e,arguments),t.unblock("data-splice")}return h}})}unwatchData(){if(this.data!==!1)for(var e in this.origFuncs)Object.defineProperty(this.data,e,{enumerable:!0,configurable:!0,writable:!0,value:this.origFuncs.key})}watchRow(e){var t=e.getData();for(var i in t)this.watchKey(e,t,i);this.table.options.dataTree&&this.watchTreeChildren(e)}watchTreeChildren(e){var t=this,i=e.getData()[this.table.options.dataTreeChildField],n={};i&&(n.push=i.push,Object.defineProperty(i,"push",{enumerable:!1,configurable:!0,value:()=>{if(!t.blocked){t.block("tree-push");var s=n.push.apply(i,arguments);this.rebuildTree(e),t.unblock("tree-push")}return s}}),n.unshift=i.unshift,Object.defineProperty(i,"unshift",{enumerable:!1,configurable:!0,value:()=>{if(!t.blocked){t.block("tree-unshift");var s=n.unshift.apply(i,arguments);this.rebuildTree(e),t.unblock("tree-unshift")}return s}}),n.shift=i.shift,Object.defineProperty(i,"shift",{enumerable:!1,configurable:!0,value:()=>{if(!t.blocked){t.block("tree-shift");var s=n.shift.call(i);this.rebuildTree(e),t.unblock("tree-shift")}return s}}),n.pop=i.pop,Object.defineProperty(i,"pop",{enumerable:!1,configurable:!0,value:()=>{if(!t.blocked){t.block("tree-pop");var s=n.pop.call(i);this.rebuildTree(e),t.unblock("tree-pop")}return s}}),n.splice=i.splice,Object.defineProperty(i,"splice",{enumerable:!1,configurable:!0,value:()=>{if(!t.blocked){t.block("tree-splice");var s=n.splice.apply(i,arguments);this.rebuildTree(e),t.unblock("tree-splice")}return s}}))}rebuildTree(e){this.table.modules.dataTree.initializeRow(e),this.table.modules.dataTree.layoutRow(e),this.table.rowManager.refreshActiveData("tree",!1,!0)}watchKey(e,t,i){var n=this,s=Object.getOwnPropertyDescriptor(t,i),o=t[i],a=this.currentVersion;Object.defineProperty(t,i,{set:l=>{if(o=l,!n.blocked&&a===n.currentVersion){n.block("key");var h={};h[i]=l,e.updateData(h),n.unblock("key")}s.set&&s.set(l)},get:()=>(s.get&&s.get(),o)})}unwatchRow(e){var t=e.getData();for(var i in t)Object.defineProperty(t,i,{value:t[i]})}block(e){this.blocked||(this.blocked=e)}unblock(e){this.blocked===e&&(this.blocked=!1)}}K(Av,"moduleName","reactiveData");class Iv extends Le{constructor(e){super(e),this.startColumn=!1,this.startX=!1,this.startWidth=!1,this.latestX=!1,this.handle=null,this.initialNextColumn=null,this.nextColumn=null,this.initialized=!1,this.registerColumnOption("resizable",!0),this.registerTableOption("resizableColumnFit",!1),this.registerTableOption("resizableColumnGuide",!1)}initialize(){this.subscribe("column-rendered",this.layoutColumnHeader.bind(this))}initializeEventWatchers(){this.initialized||(this.subscribe("cell-rendered",this.layoutCellHandles.bind(this)),this.subscribe("cell-delete",this.deInitializeComponent.bind(this)),this.subscribe("cell-height",this.resizeHandle.bind(this)),this.subscribe("column-moved",this.columnLayoutUpdated.bind(this)),this.subscribe("column-hide",this.deInitializeColumn.bind(this)),this.subscribe("column-show",this.columnLayoutUpdated.bind(this)),this.subscribe("column-width",this.columnWidthUpdated.bind(this)),this.subscribe("column-delete",this.deInitializeComponent.bind(this)),this.subscribe("column-height",this.resizeHandle.bind(this)),this.initialized=!0)}layoutCellHandles(e){e.row.type==="row"&&(this.deInitializeComponent(e),this.initializeColumn("cell",e,e.column,e.element))}layoutColumnHeader(e){e.definition.resizable&&(this.initializeEventWatchers(),this.deInitializeComponent(e),this.initializeColumn("header",e,e,e.element))}columnLayoutUpdated(e){var t=e.prevColumn();this.reinitializeColumn(e),t&&this.reinitializeColumn(t)}columnWidthUpdated(e){e.modules.frozen&&(this.table.modules.frozenColumns.leftColumns.includes(e)?this.table.modules.frozenColumns.leftColumns.forEach(t=>{this.reinitializeColumn(t)}):this.table.modules.frozenColumns.rightColumns.includes(e)&&this.table.modules.frozenColumns.rightColumns.forEach(t=>{this.reinitializeColumn(t)}))}frozenColumnOffset(e){var t=!1;return e.modules.frozen&&(t=e.modules.frozen.marginValue,e.modules.frozen.position==="left"?t+=e.getWidth()-3:t&&(t-=3)),t!==!1?t+"px":!1}reinitializeColumn(e){var t=this.frozenColumnOffset(e);e.cells.forEach(i=>{i.modules.resize&&i.modules.resize.handleEl&&(t&&(i.modules.resize.handleEl.style[e.modules.frozen.position]=t,i.modules.resize.handleEl.style["z-index"]=11),i.element.after(i.modules.resize.handleEl))}),e.modules.resize&&e.modules.resize.handleEl&&(t&&(e.modules.resize.handleEl.style[e.modules.frozen.position]=t),e.element.after(e.modules.resize.handleEl))}initializeColumn(e,t,i,n){var s=this,o=!1,a=i.definition.resizable,l={},h=i.getLastColumn();if(e==="header"&&(o=i.definition.formatter=="textarea"||i.definition.variableHeight,l={variableHeight:o}),(a===!0||a==e)&&this._checkResizability(h)){var u=document.createElement("span");u.className="tabulator-col-resize-handle",u.addEventListener("click",function(d){d.stopPropagation()});var c=function(d){s.startColumn=i,s.initialNextColumn=s.nextColumn=h.nextColumn(),s._mouseDown(d,h,u)};u.addEventListener("mousedown",c),u.addEventListener("touchstart",c,{passive:!0}),u.addEventListener("dblclick",d=>{var f=h.getWidth();d.stopPropagation(),h.reinitializeWidth(!0),f!==h.getWidth()&&(s.dispatch("column-resized",h),s.dispatchExternal("columnResized",h.getComponent()))}),i.modules.frozen&&(u.style.position="sticky",u.style[i.modules.frozen.position]=this.frozenColumnOffset(i)),l.handleEl=u,n.parentNode&&i.visible&&n.after(u)}t.modules.resize=l}deInitializeColumn(e){this.deInitializeComponent(e),e.cells.forEach(t=>{this.deInitializeComponent(t)})}deInitializeComponent(e){var t;e.modules.resize&&(t=e.modules.resize.handleEl,t&&t.parentElement&&t.parentElement.removeChild(t))}resizeHandle(e,t){e.modules.resize&&e.modules.resize.handleEl&&(e.modules.resize.handleEl.style.height=t)}resize(e,t){var i=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,n=i-this.startX,s=i-this.latestX,o,a;if(this.latestX=i,this.table.rtl&&(n=-n,s=-s),o=t.width==t.minWidth||t.width==t.maxWidth,t.setWidth(this.startWidth+n),a=t.width==t.minWidth||t.width==t.maxWidth,s<0&&(this.nextColumn=this.initialNextColumn),this.table.options.resizableColumnFit&&this.nextColumn&&!(o&&a)){let l=this.nextColumn.getWidth();s>0&&l<=this.nextColumn.minWidth&&(this.nextColumn=this.nextColumn.nextColumn()),this.nextColumn&&this.nextColumn.setWidth(this.nextColumn.getWidth()-s)}this.table.columnManager.rerenderColumns(!0),!this.table.browserSlow&&t.modules.resize&&t.modules.resize.variableHeight&&t.checkCellHeights()}calcGuidePosition(e,t,i){var n=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,s=i.getBoundingClientRect().x-this.table.element.getBoundingClientRect().x,o=this.table.element.getBoundingClientRect().x,a=t.element.getBoundingClientRect().left-o,l=n-this.startX,h=Math.max(s+l,a+t.minWidth);return t.maxWidth&&(h=Math.min(h,a+t.maxWidth)),h}_checkResizability(e){return e.definition.resizable}_mouseDown(e,t,i){var n=this,s;this.dispatchExternal("columnResizing",t.getComponent()),n.table.options.resizableColumnGuide&&(s=document.createElement("span"),s.classList.add("tabulator-col-resize-guide"),n.table.element.appendChild(s),setTimeout(()=>{s.style.left=n.calcGuidePosition(e,t,i)+"px"})),n.table.element.classList.add("tabulator-block-select");function o(l){n.table.options.resizableColumnGuide?s.style.left=n.calcGuidePosition(l,t,i)+"px":n.resize(l,t)}function a(l){n.table.options.resizableColumnGuide&&(n.resize(l,t),s.remove()),n.startColumn.modules.edit&&(n.startColumn.modules.edit.blocked=!1),n.table.browserSlow&&t.modules.resize&&t.modules.resize.variableHeight&&t.checkCellHeights(),document.body.removeEventListener("mouseup",a),document.body.removeEventListener("mousemove",o),i.removeEventListener("touchmove",o),i.removeEventListener("touchend",a),n.table.element.classList.remove("tabulator-block-select"),n.startWidth!==t.getWidth()&&(n.table.columnManager.verticalAlignHeaders(),n.dispatch("column-resized",t),n.dispatchExternal("columnResized",t.getComponent()))}e.stopPropagation(),n.startColumn.modules.edit&&(n.startColumn.modules.edit.blocked=!0),n.startX=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,n.latestX=n.startX,n.startWidth=t.getWidth(),document.body.addEventListener("mousemove",o),document.body.addEventListener("mouseup",a),i.addEventListener("touchmove",o,{passive:!0}),i.addEventListener("touchend",a)}}K(Iv,"moduleName","resizeColumns");class Pv extends Le{constructor(e){super(e),this.startColumn=!1,this.startY=!1,this.startHeight=!1,this.handle=null,this.prevHandle=null,this.registerTableOption("resizableRows",!1),this.registerTableOption("resizableRowGuide",!1)}initialize(){this.table.options.resizableRows&&this.subscribe("row-layout-after",this.initializeRow.bind(this))}initializeRow(e){var t=this,i=e.getElement(),n=document.createElement("div");n.className="tabulator-row-resize-handle";var s=document.createElement("div");s.className="tabulator-row-resize-handle prev",n.addEventListener("click",function(l){l.stopPropagation()});var o=function(l){t.startRow=e,t._mouseDown(l,e,n)};n.addEventListener("mousedown",o),n.addEventListener("touchstart",o,{passive:!0}),s.addEventListener("click",function(l){l.stopPropagation()});var a=function(l){var h=t.table.rowManager.prevDisplayRow(e);h&&(t.startRow=h,t._mouseDown(l,h,s))};s.addEventListener("mousedown",a),s.addEventListener("touchstart",a,{passive:!0}),i.appendChild(n),i.appendChild(s)}resize(e,t){t.setHeight(this.startHeight+((typeof e.screenY>"u"?e.touches[0].screenY:e.screenY)-this.startY))}calcGuidePosition(e,t,i){var n=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,s=i.getBoundingClientRect().y-this.table.element.getBoundingClientRect().y,o=this.table.element.getBoundingClientRect().y,a=t.element.getBoundingClientRect().top-o,l=n-this.startY;return Math.max(s+l,a)}_mouseDown(e,t,i){var n=this,s;n.dispatchExternal("rowResizing",t.getComponent()),n.table.options.resizableRowGuide&&(s=document.createElement("span"),s.classList.add("tabulator-row-resize-guide"),n.table.element.appendChild(s),setTimeout(()=>{s.style.top=n.calcGuidePosition(e,t,i)+"px"})),n.table.element.classList.add("tabulator-block-select");function o(l){n.table.options.resizableRowGuide?s.style.top=n.calcGuidePosition(l,t,i)+"px":n.resize(l,t)}function a(l){n.table.options.resizableRowGuide&&(n.resize(l,t),s.remove()),document.body.removeEventListener("mouseup",o),document.body.removeEventListener("mousemove",o),i.removeEventListener("touchmove",o),i.removeEventListener("touchend",a),n.table.element.classList.remove("tabulator-block-select"),n.dispatchExternal("rowResized",t.getComponent())}e.stopPropagation(),n.startY=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,n.startHeight=t.getHeight(),document.body.addEventListener("mousemove",o),document.body.addEventListener("mouseup",a),i.addEventListener("touchmove",o,{passive:!0}),i.addEventListener("touchend",a)}}K(Pv,"moduleName","resizeRows");class Fv extends Le{constructor(e){super(e),this.binding=!1,this.visibilityObserver=!1,this.resizeObserver=!1,this.containerObserver=!1,this.tableHeight=0,this.tableWidth=0,this.containerHeight=0,this.containerWidth=0,this.autoResize=!1,this.visible=!1,this.initialized=!1,this.initialRedraw=!1,this.registerTableOption("autoResize",!0)}initialize(){if(this.table.options.autoResize){var e=this.table,t;this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),typeof IntersectionObserver<"u"&&typeof ResizeObserver<"u"&&e.rowManager.getRenderMode()==="virtual"?(this.initializeVisibilityObserver(),this.autoResize=!0,this.resizeObserver=new ResizeObserver(i=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var n=Math.floor(i[0].contentRect.height),s=Math.floor(i[0].contentRect.width);(this.tableHeight!=n||this.tableWidth!=s)&&(this.tableHeight=n,this.tableWidth=s,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),this.redrawTable())}}),this.resizeObserver.observe(e.element),t=window.getComputedStyle(e.element),this.table.element.parentNode&&!this.table.rowManager.fixedHeight&&(t.getPropertyValue("max-height")||t.getPropertyValue("min-height"))&&(this.containerObserver=new ResizeObserver(i=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var n=Math.floor(i[0].contentRect.height),s=Math.floor(i[0].contentRect.width);(this.containerHeight!=n||this.containerWidth!=s)&&(this.containerHeight=n,this.containerWidth=s,this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth),this.redrawTable()}}),this.containerObserver.observe(this.table.element.parentNode)),this.subscribe("table-resize",this.tableResized.bind(this))):(this.binding=function(){(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell))&&(e.columnManager.rerenderColumns(!0),e.redraw())},window.addEventListener("resize",this.binding)),this.subscribe("table-destroy",this.clearBindings.bind(this))}}initializeVisibilityObserver(){this.visibilityObserver=new IntersectionObserver(e=>{this.visible=e[0].isIntersecting,this.initialized?this.visible&&(this.redrawTable(this.initialRedraw),this.initialRedraw=!1):(this.initialized=!0,this.initialRedraw=!this.visible)}),this.visibilityObserver.observe(this.table.element)}redrawTable(e){this.initialized&&this.visible&&(this.table.columnManager.rerenderColumns(!0),this.table.redraw(e))}tableResized(){this.table.rowManager.redraw()}clearBindings(){this.binding&&window.removeEventListener("resize",this.binding),this.resizeObserver&&this.resizeObserver.unobserve(this.table.element),this.visibilityObserver&&this.visibilityObserver.unobserve(this.table.element),this.containerObserver&&this.containerObserver.unobserve(this.table.element.parentNode)}}K(Fv,"moduleName","resizeTable");function zD(r,e,t){var i=document.createElement("div"),n=r.getRow()._row.modules.responsiveLayout;i.classList.add("tabulator-responsive-collapse-toggle"),i.innerHTML=`<svg class='tabulator-responsive-collapse-toggle-open' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12" fill="none" stroke-width="3" stroke-linecap="round" />
  <line y1="7" x1="12" y2="17" x2="12" fill="none" stroke-width="3" stroke-linecap="round" />
</svg>

<svg class='tabulator-responsive-collapse-toggle-close' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12"  fill="none" stroke-width="3" stroke-linecap="round" />
</svg>`,r.getElement().classList.add("tabulator-row-handle");function s(o){var a=n.element;n.open=o,a&&(n.open?(i.classList.add("open"),a.style.display=""):(i.classList.remove("open"),a.style.display="none"))}return i.addEventListener("click",function(o){o.stopImmediatePropagation(),s(!n.open),r.getTable().rowManager.adjustTableSize()}),s(n.open),i}var BD={format:{formatters:{responsiveCollapse:zD}}};class Cc extends Le{constructor(e){super(e),this.columns=[],this.hiddenColumns=[],this.mode="",this.index=0,this.collapseFormatter=[],this.collapseStartOpen=!0,this.collapseHandleColumn=!1,this.registerTableOption("responsiveLayout",!1),this.registerTableOption("responsiveLayoutCollapseStartOpen",!0),this.registerTableOption("responsiveLayoutCollapseUseFormatters",!0),this.registerTableOption("responsiveLayoutCollapseFormatter",!1),this.registerColumnOption("responsive")}initialize(){this.table.options.responsiveLayout&&(this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-show",this.updateColumnVisibility.bind(this)),this.subscribe("column-hide",this.updateColumnVisibility.bind(this)),this.subscribe("columns-loaded",this.initializeResponsivity.bind(this)),this.subscribe("column-moved",this.initializeResponsivity.bind(this)),this.subscribe("column-add",this.initializeResponsivity.bind(this)),this.subscribe("column-delete",this.initializeResponsivity.bind(this)),this.subscribe("table-redrawing",this.tableRedraw.bind(this)),this.table.options.responsiveLayout==="collapse"&&(this.subscribe("row-data-changed",this.generateCollapsedRowContent.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout",this.layoutRow.bind(this))))}tableRedraw(e){["fitColumns","fitDataStretch"].indexOf(this.layoutMode())===-1&&(e||this.update())}initializeResponsivity(){var e=[];this.mode=this.table.options.responsiveLayout,this.collapseFormatter=this.table.options.responsiveLayoutCollapseFormatter||this.formatCollapsedData,this.collapseStartOpen=this.table.options.responsiveLayoutCollapseStartOpen,this.hiddenColumns=[],this.collapseFormatter&&(this.collapseFormatter=this.collapseFormatter.bind(this.table)),this.table.columnManager.columnsByIndex.forEach((t,i)=>{t.modules.responsive&&t.modules.responsive.order&&t.modules.responsive.visible&&(t.modules.responsive.index=i,e.push(t),!t.visible&&this.mode==="collapse"&&this.hiddenColumns.push(t))}),e=e.reverse(),e=e.sort((t,i)=>{var n=i.modules.responsive.order-t.modules.responsive.order;return n||i.modules.responsive.index-t.modules.responsive.index}),this.columns=e,this.mode==="collapse"&&this.generateCollapsedContent();for(let t of this.table.columnManager.columnsByIndex)if(t.definition.formatter=="responsiveCollapse"){this.collapseHandleColumn=t;break}this.collapseHandleColumn&&(this.hiddenColumns.length?this.collapseHandleColumn.show():this.collapseHandleColumn.hide())}initializeColumn(e){var t=e.getDefinition();e.modules.responsive={order:typeof t.responsive>"u"?1:t.responsive,visible:t.visible!==!1}}initializeRow(e){var t;e.type!=="calc"&&(t=document.createElement("div"),t.classList.add("tabulator-responsive-collapse"),e.modules.responsiveLayout={element:t,open:this.collapseStartOpen},this.collapseStartOpen||(t.style.display="none"))}layoutRow(e){var t=e.getElement();e.modules.responsiveLayout&&(t.appendChild(e.modules.responsiveLayout.element),this.generateCollapsedRowContent(e))}updateColumnVisibility(e,t){!t&&e.modules.responsive&&(e.modules.responsive.visible=e.visible,this.initializeResponsivity())}hideColumn(e){var t=this.hiddenColumns.length;e.hide(!1,!0),this.mode==="collapse"&&(this.hiddenColumns.unshift(e),this.generateCollapsedContent(),this.collapseHandleColumn&&!t&&this.collapseHandleColumn.show())}showColumn(e){var t;e.show(!1,!0),e.setWidth(e.getWidth()),this.mode==="collapse"&&(t=this.hiddenColumns.indexOf(e),t>-1&&this.hiddenColumns.splice(t,1),this.generateCollapsedContent(),this.collapseHandleColumn&&!this.hiddenColumns.length&&this.collapseHandleColumn.hide())}update(){for(var e=!0;e;){let t=this.table.modules.layout.getMode()=="fitColumns"?this.table.columnManager.getFlexBaseWidth():this.table.columnManager.getWidth(),i=(this.table.options.headerVisible?this.table.columnManager.element.clientWidth:this.table.element.clientWidth)-t;if(i<0){let n=this.columns[this.index];n?(this.hideColumn(n),this.index++):e=!1}else{let n=this.columns[this.index-1];n&&i>0&&i>=n.getWidth()?(this.showColumn(n),this.index--):e=!1}this.table.rowManager.activeRowsCount||this.table.rowManager.renderEmptyScroll()}}generateCollapsedContent(){var e=this.table.rowManager.getDisplayRows();e.forEach(t=>{this.generateCollapsedRowContent(t)})}generateCollapsedRowContent(e){var t,i;if(e.modules.responsiveLayout){for(t=e.modules.responsiveLayout.element;t.firstChild;)t.removeChild(t.firstChild);i=this.collapseFormatter(this.generateCollapsedRowData(e)),i&&t.appendChild(i),e.calcHeight(!0)}}generateCollapsedRowData(e){var t=e.getData(),i=[],n;return this.hiddenColumns.forEach(s=>{var o=s.getFieldValue(t);if(s.definition.title&&s.field)if(s.modules.format&&this.table.options.responsiveLayoutCollapseUseFormatters){let a=function(l){l()};n={value:!1,data:{},getValue:function(){return o},getData:function(){return t},getType:function(){return"cell"},getElement:function(){return document.createElement("div")},getRow:function(){return e.getComponent()},getColumn:function(){return s.getComponent()},getTable:()=>this.table},i.push({field:s.field,title:s.definition.title,value:s.modules.format.formatter.call(this.table.modules.format,n,s.modules.format.params,a)})}else i.push({field:s.field,title:s.definition.title,value:o})}),i}formatCollapsedData(e){var t=document.createElement("table");return e.forEach(i=>{var n=document.createElement("tr"),s=document.createElement("td"),o=document.createElement("td"),a,l=document.createElement("strong");s.appendChild(l),this.modules.localize.bind("columns|"+i.field,function(h){l.innerHTML=h||i.title}),i.value instanceof Node?(a=document.createElement("div"),a.appendChild(i.value),o.appendChild(a)):o.innerHTML=i.value,n.appendChild(s),n.appendChild(o),t.appendChild(n)}),Object.keys(e).length?t:""}}K(Cc,"moduleName","responsiveLayout"),K(Cc,"moduleExtensions",BD);function GD(r,e,t){var i=document.createElement("input"),n=!1;if(i.type="checkbox",i.setAttribute("aria-label","Select Row"),this.table.modExists("selectRow",!0))if(i.addEventListener("click",o=>{o.stopPropagation()}),typeof r.getRow=="function"){var s=r.getRow();s instanceof Eh?(i.addEventListener("change",o=>{this.table.options.selectableRowsRangeMode==="click"&&n?n=!1:s.toggleSelect()}),this.table.options.selectableRowsRangeMode==="click"&&i.addEventListener("click",o=>{n=!0,this.table.modules.selectRow.handleComplexRowClick(s._row,o)}),i.checked=s.isSelected&&s.isSelected(),this.table.modules.selectRow.registerRowSelectCheckbox(s,i)):i=""}else i.addEventListener("change",o=>{this.table.modules.selectRow.selectedRows.length?this.table.deselectRow():this.table.selectRow(e.rowRange)}),this.table.modules.selectRow.registerHeaderSelectCheckbox(i);return i}var HD={format:{formatters:{rowSelection:GD}}};class xc extends Le{constructor(e){super(e),this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],this.headerCheckboxElement=null,this.registerTableOption("selectableRows","highlight"),this.registerTableOption("selectableRowsRangeMode","drag"),this.registerTableOption("selectableRowsRollingSelection",!0),this.registerTableOption("selectableRowsPersistence",!0),this.registerTableOption("selectableRowsCheck",function(t,i){return!0}),this.registerTableFunction("selectRow",this.selectRows.bind(this)),this.registerTableFunction("deselectRow",this.deselectRows.bind(this)),this.registerTableFunction("toggleSelectRow",this.toggleRow.bind(this)),this.registerTableFunction("getSelectedRows",this.getSelectedRows.bind(this)),this.registerTableFunction("getSelectedData",this.getSelectedData.bind(this)),this.registerComponentFunction("row","select",this.selectRows.bind(this)),this.registerComponentFunction("row","deselect",this.deselectRows.bind(this)),this.registerComponentFunction("row","toggleSelect",this.toggleRow.bind(this)),this.registerComponentFunction("row","isSelected",this.isRowSelected.bind(this))}initialize(){this.deprecatedOptionsCheck(),this.table.options.selectableRows==="highlight"&&this.table.options.selectableRange&&(this.table.options.selectableRows=!1),this.table.options.selectableRows!==!1&&(this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-deleting",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clearSelectionData.bind(this)),this.subscribe("rows-retrieve",this.rowRetrieve.bind(this)),this.table.options.selectableRows&&!this.table.options.selectableRowsPersistence&&this.subscribe("data-refreshing",this.deselectRows.bind(this)))}deprecatedOptionsCheck(){}rowRetrieve(e,t){return e==="selected"?this.selectedRows:t}rowDeleted(e){this._deselectRow(e,!0)}clearSelectionData(e){var t=this.selectedRows.length;this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],t&&e!==!0&&this._rowSelectionChanged()}initializeRow(e){var t=this,i=t.checkRowSelectability(e),n=e.getElement(),s=function(){setTimeout(function(){t.selecting=!1},50),document.body.removeEventListener("mouseup",s)};e.modules.select={selected:!1},n.classList.toggle("tabulator-selectable",i),n.classList.toggle("tabulator-unselectable",!i),t.checkRowSelectability(e)&&t.table.options.selectableRows&&t.table.options.selectableRows!="highlight"&&(t.table.options.selectableRowsRangeMode==="click"?n.addEventListener("click",this.handleComplexRowClick.bind(this,e)):(n.addEventListener("click",function(o){(!t.table.modExists("edit")||!t.table.modules.edit.getCurrentCell())&&t.table._clearSelection(),t.selecting||t.toggleRow(e)}),n.addEventListener("mousedown",function(o){if(o.shiftKey)return t.table._clearSelection(),t.selecting=!0,t.selectPrev=[],document.body.addEventListener("mouseup",s),document.body.addEventListener("keyup",s),t.toggleRow(e),!1}),n.addEventListener("mouseenter",function(o){t.selecting&&(t.table._clearSelection(),t.toggleRow(e),t.selectPrev[1]==e&&t.toggleRow(t.selectPrev[0]))}),n.addEventListener("mouseout",function(o){t.selecting&&(t.table._clearSelection(),t.selectPrev.unshift(e))})))}handleComplexRowClick(e,t){if(t.shiftKey){this.table._clearSelection(),this.lastClickedRow=this.lastClickedRow||e;var i=this.table.rowManager.getDisplayRowIndex(this.lastClickedRow),n=this.table.rowManager.getDisplayRowIndex(e),s=i<=n?i:n,o=i>=n?i:n,a=this.table.rowManager.getDisplayRows().slice(0),l=a.splice(s,o-s+1);t.ctrlKey||t.metaKey?(l.forEach(h=>{h!==this.lastClickedRow&&(this.table.options.selectableRows!==!0&&!this.isRowSelected(e)?this.selectedRows.length<this.table.options.selectableRows&&this.toggleRow(h):this.toggleRow(h))}),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.table.options.selectableRows!==!0&&l.length>this.table.options.selectableRows&&(l=l.slice(0,this.table.options.selectableRows)),this.selectRows(l)),this.table._clearSelection()}else t.ctrlKey||t.metaKey?(this.toggleRow(e),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.selectRows(e),this.lastClickedRow=e)}checkRowSelectability(e){return e&&e.type==="row"?this.table.options.selectableRowsCheck.call(this.table,e.getComponent()):!1}toggleRow(e){this.checkRowSelectability(e)&&(e.modules.select&&e.modules.select.selected?this._deselectRow(e):this._selectRow(e))}selectRows(e){var t=[],i,n;switch(typeof e){case"undefined":i=this.table.rowManager.rows;break;case"number":i=this.table.rowManager.findRow(e);break;case"string":i=this.table.rowManager.findRow(e),i||(i=this.table.rowManager.getRows(e));break;default:i=e;break}Array.isArray(i)?i.length&&(i.forEach(s=>{n=this._selectRow(s,!0,!0),n&&t.push(n)}),this._rowSelectionChanged(!1,t)):i&&this._selectRow(i,!1,!0)}_selectRow(e,t,i){if(!isNaN(this.table.options.selectableRows)&&this.table.options.selectableRows!==!0&&!i&&this.selectedRows.length>=this.table.options.selectableRows)if(this.table.options.selectableRowsRollingSelection)this._deselectRow(this.selectedRows[0]);else return!1;var n=this.table.rowManager.findRow(e);if(n){if(this.selectedRows.indexOf(n)==-1)return n.getElement().classList.add("tabulator-selected"),n.modules.select||(n.modules.select={}),n.modules.select.selected=!0,n.modules.select.checkboxEl&&(n.modules.select.checkboxEl.checked=!0),this.selectedRows.push(n),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(n,!0),this.dispatchExternal("rowSelected",n.getComponent()),this._rowSelectionChanged(t,n),n}else t||console.warn("Selection Error - No such row found, ignoring selection:"+e)}isRowSelected(e){return this.selectedRows.indexOf(e)!==-1}deselectRows(e,t){var i=[],n,s;switch(typeof e){case"undefined":n=Object.assign([],this.selectedRows);break;case"number":n=this.table.rowManager.findRow(e);break;case"string":n=this.table.rowManager.findRow(e),n||(n=this.table.rowManager.getRows(e));break;default:n=e;break}Array.isArray(n)?n.length&&(n.forEach(o=>{s=this._deselectRow(o,!0,!0),s&&i.push(s)}),this._rowSelectionChanged(t,[],i)):n&&this._deselectRow(n,t,!0)}_deselectRow(e,t){var i=this,n=i.table.rowManager.findRow(e),s,o;if(n){if(s=i.selectedRows.findIndex(function(a){return a==n}),s>-1)return o=n.getElement(),o&&o.classList.remove("tabulator-selected"),n.modules.select||(n.modules.select={}),n.modules.select.selected=!1,n.modules.select.checkboxEl&&(n.modules.select.checkboxEl.checked=!1),i.selectedRows.splice(s,1),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(n,!1),this.dispatchExternal("rowDeselected",n.getComponent()),i._rowSelectionChanged(t,void 0,n),n}else t||console.warn("Deselection Error - No such row found, ignoring selection:"+e)}getSelectedData(){var e=[];return this.selectedRows.forEach(function(t){e.push(t.getData())}),e}getSelectedRows(){var e=[];return this.selectedRows.forEach(function(t){e.push(t.getComponent())}),e}_rowSelectionChanged(e,t=[],i=[]){this.headerCheckboxElement&&(this.selectedRows.length===0?(this.headerCheckboxElement.checked=!1,this.headerCheckboxElement.indeterminate=!1):this.table.rowManager.rows.length===this.selectedRows.length?(this.headerCheckboxElement.checked=!0,this.headerCheckboxElement.indeterminate=!1):(this.headerCheckboxElement.indeterminate=!0,this.headerCheckboxElement.checked=!1)),e||(Array.isArray(t)||(t=[t]),t=t.map(n=>n.getComponent()),Array.isArray(i)||(i=[i]),i=i.map(n=>n.getComponent()),this.dispatchExternal("rowSelectionChanged",this.getSelectedData(),this.getSelectedRows(),t,i))}registerRowSelectCheckbox(e,t){e._row.modules.select||(e._row.modules.select={}),e._row.modules.select.checkboxEl=t}registerHeaderSelectCheckbox(e){this.headerCheckboxElement=e}childRowSelection(e,t){var i=this.table.modules.dataTree.getChildren(e,!0,!0);if(t)for(let n of i)this._selectRow(n,!0);else for(let n of i)this._deselectRow(n,!0)}}K(xc,"moduleName","selectRow"),K(xc,"moduleExtensions",HD);class VD{constructor(e){return this._range=e,new Proxy(this,{get:function(t,i,n){return typeof t[i]<"u"?t[i]:t._range.table.componentFunctionBinder.handle("range",t._range,i)}})}getElement(){return this._range.element}getData(){return this._range.getData()}getCells(){return this._range.getCells(!0,!0)}getStructuredCells(){return this._range.getStructuredCells()}getRows(){return this._range.getRows().map(e=>e.getComponent())}getColumns(){return this._range.getColumns().map(e=>e.getComponent())}getBounds(){return this._range.getBounds()}getTopEdge(){return this._range.top}getBottomEdge(){return this._range.bottom}getLeftEdge(){return this._range.left}getRightEdge(){return this._range.right}setBounds(e,t){this._range.destroyedGuard("setBounds")&&this._range.setBounds(e&&e._cell,t&&t._cell)}setStartBound(e){this._range.destroyedGuard("setStartBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}setEndBound(e){this._range.destroyedGuard("setEndBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}clearValues(){this._range.destroyedGuard("clearValues")&&this._range.clearValues()}remove(){this._range.destroyedGuard("remove")&&this._range.destroy(!0)}}class WD extends It{constructor(e,t,i,n){super(e),this.rangeManager=t,this.element=null,this.initialized=!1,this.initializing={start:!1,end:!1},this.destroyed=!1,this.top=0,this.bottom=0,this.left=0,this.right=0,this.table=e,this.start={row:0,col:0},this.end={row:0,col:0},this.rangeManager.rowHeader&&(this.left=1,this.right=1,this.start.col=1,this.end.col=1),this.initElement(),setTimeout(()=>{this.initBounds(i,n)})}initElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-range")}initBounds(e,t){this._updateMinMax(),e&&this.setBounds(e,t||e)}setStart(e,t){(this.start.row!==e||this.start.col!==t)&&(this.start.row=e,this.start.col=t,this.initializing.start=!0,this._updateMinMax())}setEnd(e,t){(this.end.row!==e||this.end.col!==t)&&(this.end.row=e,this.end.col=t,this.initializing.end=!0,this._updateMinMax())}setBounds(e,t,i){e&&this.setStartBound(e),this.setEndBound(t||e),this.rangeManager.layoutElement(i)}setStartBound(e){var t,i;e.type==="column"?this.rangeManager.columnSelection&&this.setStart(0,e.getPosition()-1):(t=e.row.position-1,i=e.column.getPosition()-1,e.column===this.rangeManager.rowHeader?this.setStart(t,1):this.setStart(t,i))}setEndBound(e){var t=this._getTableRows().length,i,n,s;e.type==="column"?this.rangeManager.columnSelection&&(this.rangeManager.selecting==="column"?this.setEnd(t-1,e.getPosition()-1):this.rangeManager.selecting==="cell"&&this.setEnd(0,e.getPosition()-1)):(i=e.row.position-1,n=e.column.getPosition()-1,s=e.column===this.rangeManager.rowHeader,this.rangeManager.selecting==="row"?this.setEnd(i,this._getTableColumns().length-1):this.rangeManager.selecting!=="row"&&s?this.setEnd(i,0):this.rangeManager.selecting==="column"?this.setEnd(t-1,n):this.setEnd(i,n))}_updateMinMax(){this.top=Math.min(this.start.row,this.end.row),this.bottom=Math.max(this.start.row,this.end.row),this.left=Math.min(this.start.col,this.end.col),this.right=Math.max(this.start.col,this.end.col),this.initialized?this.dispatchExternal("rangeChanged",this.getComponent()):this.initializing.start&&this.initializing.end&&(this.initialized=!0,this.dispatchExternal("rangeAdded",this.getComponent()))}_getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}_getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}layout(){var e=this.table.rowManager.renderer.vDomTop,t=this.table.rowManager.renderer.vDomBottom,i=this.table.columnManager.renderer.leftCol,n=this.table.columnManager.renderer.rightCol,s,o,a,l,h,u,c,d,f,g;this.table.options.renderHorizontal==="virtual"&&this.rangeManager.rowHeader&&(n+=1),e==null&&(e=0),t==null&&(t=1/0),i==null&&(i=0),n==null&&(n=1/0),this.overlaps(i,e,n,t)&&(s=Math.max(this.top,e),o=Math.min(this.bottom,t),a=Math.max(this.left,i),l=Math.min(this.right,n),h=this.rangeManager.getCell(s,a),u=this.rangeManager.getCell(o,l),c=h.getElement(),d=u.getElement(),f=h.row.getElement(),g=u.row.getElement(),this.element.classList.add("tabulator-range-active"),this.table.rtl?(this.element.style.right=f.offsetWidth-c.offsetLeft-c.offsetWidth+"px",this.element.style.width=c.offsetLeft+c.offsetWidth-d.offsetLeft+"px"):(this.element.style.left=f.offsetLeft+c.offsetLeft+"px",this.element.style.width=d.offsetLeft+d.offsetWidth-c.offsetLeft+"px"),this.element.style.top=f.offsetTop+"px",this.element.style.height=g.offsetTop+g.offsetHeight-f.offsetTop+"px")}atTopLeft(e){return e.row.position-1===this.top&&e.column.getPosition()-1===this.left}atBottomRight(e){return e.row.position-1===this.bottom&&e.column.getPosition()-1===this.right}occupies(e){return this.occupiesRow(e.row)&&this.occupiesColumn(e.column)}occupiesRow(e){return this.top<=e.position-1&&e.position-1<=this.bottom}occupiesColumn(e){return this.left<=e.getPosition()-1&&e.getPosition()-1<=this.right}overlaps(e,t,i,n){return!(this.left>i||e>this.right||this.top>n||t>this.bottom)}getData(){var e=[],t=this.getRows(),i=this.getColumns();return t.forEach(n=>{var s=n.getData(),o={};i.forEach(a=>{o[a.field]=s[a.field]}),e.push(o)}),e}getCells(e,t){var i=[],n=this.getRows(),s=this.getColumns();return e?i=n.map(o=>{var a=[];return o.getCells().forEach(l=>{s.includes(l.column)&&a.push(t?l.getComponent():l)}),a}):n.forEach(o=>{o.getCells().forEach(a=>{s.includes(a.column)&&i.push(t?a.getComponent():a)})}),i}getStructuredCells(){return this.getCells(!0,!0)}getRows(){return this._getTableRows().slice(this.top,this.bottom+1)}getColumns(){return this._getTableColumns().slice(this.left,this.right+1)}clearValues(){var e=this.getCells(),t=this.table.options.selectableRangeClearCellsValue;this.table.blockRedraw(),e.forEach(i=>{i.setValue(t)}),this.table.restoreRedraw()}getBounds(e){var t=this.getCells(!1,e),i={start:null,end:null};return t.length?(i.start=t[0],i.end=t[t.length-1]):console.warn("No bounds defined on range"),i}getComponent(){return this.component||(this.component=new VD(this)),this.component}destroy(e){this.destroyed=!0,this.element.remove(),e&&this.rangeManager.rangeRemoved(this),this.initialized&&this.dispatchExternal("rangeRemoved",this.getComponent())}destroyedGuard(e){return this.destroyed&&console.warn("You cannot call the "+e+" function on a destroyed range"),!this.destroyed}}var UD={rangeJumpUp:["ctrl + 38","meta + 38"],rangeJumpDown:["ctrl + 40","meta + 40"],rangeJumpLeft:["ctrl + 37","meta + 37"],rangeJumpRight:["ctrl + 39","meta + 39"],rangeExpandUp:"shift + 38",rangeExpandDown:"shift + 40",rangeExpandLeft:"shift + 37",rangeExpandRight:"shift + 39",rangeExpandJumpUp:["ctrl + shift + 38","meta + shift + 38"],rangeExpandJumpDown:["ctrl + shift + 40","meta + shift + 40"],rangeExpandJumpLeft:["ctrl + shift + 37","meta + shift + 37"],rangeExpandJumpRight:["ctrl + shift + 39","meta + shift + 39"]},YD={rangeJumpLeft:function(r){this.dispatch("keybinding-nav-range",r,"left",!0,!1)},rangeJumpRight:function(r){this.dispatch("keybinding-nav-range",r,"right",!0,!1)},rangeJumpUp:function(r){this.dispatch("keybinding-nav-range",r,"up",!0,!1)},rangeJumpDown:function(r){this.dispatch("keybinding-nav-range",r,"down",!0,!1)},rangeExpandLeft:function(r){this.dispatch("keybinding-nav-range",r,"left",!1,!0)},rangeExpandRight:function(r){this.dispatch("keybinding-nav-range",r,"right",!1,!0)},rangeExpandUp:function(r){this.dispatch("keybinding-nav-range",r,"up",!1,!0)},rangeExpandDown:function(r){this.dispatch("keybinding-nav-range",r,"down",!1,!0)},rangeExpandJumpLeft:function(r){this.dispatch("keybinding-nav-range",r,"left",!0,!0)},rangeExpandJumpRight:function(r){this.dispatch("keybinding-nav-range",r,"right",!0,!0)},rangeExpandJumpUp:function(r){this.dispatch("keybinding-nav-range",r,"up",!0,!0)},rangeExpandJumpDown:function(r){this.dispatch("keybinding-nav-range",r,"down",!0,!0)}},jD={range:function(r){var e=[],t=this.table.modules.selectRange.activeRange,i=!1,n,s,o,a,l;return l=r.length,t&&(n=t.getBounds(),s=n.start,n.start===n.end&&(i=!0),s&&(e=this.table.rowManager.activeRows.slice(),o=e.indexOf(s.row),i?a=r.length:a=e.indexOf(n.end.row)-o+1,o>-1&&(this.table.blockRedraw(),e=e.slice(o,o+a),e.forEach((h,u)=>{h.updateData(r[u%l])}),this.table.restoreRedraw()))),e}},XD={range:function(r){var e=[],t=[],i=this.table.modules.selectRange.activeRange,n=!1,s,o,a,l,h;return i&&(s=i.getBounds(),o=s.start,s.start===s.end&&(n=!0),o&&(r=r.split(`
`),r.forEach(function(u){e.push(u.split("	"))}),e.length&&(l=this.table.columnManager.getVisibleColumnsByIndex(),h=l.indexOf(o.column),h>-1)))?(n?a=e[0].length:a=l.indexOf(s.end.column)-h+1,l=l.slice(h,h+a),e.forEach(u=>{var c={},d=u.length;l.forEach(function(f,g){c[f.field]=u[g%d]}),t.push(c)}),t):!1}},$D={range:function(){var r=this.modules.selectRange.selectedColumns();return this.columnManager.rowHeader&&r.unshift(this.columnManager.rowHeader),r}},ZD={range:function(){return this.modules.selectRange.selectedRows()}},KD={keybindings:{bindings:UD,actions:YD},clipboard:{pasteActions:jD,pasteParsers:XD},export:{columnLookups:$D,rowLookups:ZD}};class $a extends Le{constructor(e){super(e),this.selecting="cell",this.mousedown=!1,this.ranges=[],this.overlay=null,this.rowHeader=null,this.layoutChangeTimeout=null,this.columnSelection=!1,this.rowSelection=!1,this.maxRanges=0,this.activeRange=!1,this.blockKeydown=!1,this.keyDownEvent=this._handleKeyDown.bind(this),this.mouseUpEvent=this._handleMouseUp.bind(this),this.registerTableOption("selectableRange",!1),this.registerTableOption("selectableRangeColumns",!1),this.registerTableOption("selectableRangeRows",!1),this.registerTableOption("selectableRangeClearCells",!1),this.registerTableOption("selectableRangeClearCellsValue",void 0),this.registerTableFunction("getRangesData",this.getRangesData.bind(this)),this.registerTableFunction("getRanges",this.getRanges.bind(this)),this.registerTableFunction("addRange",this.addRangeFromComponent.bind(this)),this.registerComponentFunction("cell","getRanges",this.cellGetRanges.bind(this)),this.registerComponentFunction("row","getRanges",this.rowGetRanges.bind(this)),this.registerComponentFunction("column","getRanges",this.colGetRanges.bind(this))}initialize(){this.options("selectableRange")&&(this.options("selectableRows")?console.warn("SelectRange functionality cannot be used in conjunction with row selection"):(this.maxRanges=this.options("selectableRange"),this.initializeTable(),this.initializeWatchers()),this.options("columns").findIndex(e=>e.frozen)>0&&console.warn("Having frozen column in arbitrary position with selectRange option may result in unpredictable behavior."),this.options("columns").filter(e=>e.frozen)>1&&console.warn("Having multiple frozen columns with selectRange option may result in unpredictable behavior."))}initializeTable(){this.overlay=document.createElement("div"),this.overlay.classList.add("tabulator-range-overlay"),this.rangeContainer=document.createElement("div"),this.rangeContainer.classList.add("tabulator-range-container"),this.activeRangeCellElement=document.createElement("div"),this.activeRangeCellElement.classList.add("tabulator-range-cell-active"),this.overlay.appendChild(this.rangeContainer),this.overlay.appendChild(this.activeRangeCellElement),this.table.rowManager.element.addEventListener("keydown",this.keyDownEvent),this.resetRanges(),this.table.rowManager.element.appendChild(this.overlay),this.table.columnManager.element.setAttribute("tabindex",0),this.table.element.classList.add("tabulator-ranges")}initializeWatchers(){this.columnSelection=this.options("selectableRangeColumns"),this.rowSelection=this.options("selectableRangeRows"),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-mousedown",this.handleColumnMouseDown.bind(this)),this.subscribe("column-mousemove",this.handleColumnMouseMove.bind(this)),this.subscribe("column-resized",this.handleColumnResized.bind(this)),this.subscribe("column-moving",this.handleColumnMoving.bind(this)),this.subscribe("column-moved",this.handleColumnMoved.bind(this)),this.subscribe("column-width",this.layoutChange.bind(this)),this.subscribe("column-height",this.layoutChange.bind(this)),this.subscribe("column-resized",this.layoutChange.bind(this)),this.subscribe("columns-loaded",this.updateHeaderColumn.bind(this)),this.subscribe("cell-height",this.layoutChange.bind(this)),this.subscribe("cell-rendered",this.renderCell.bind(this)),this.subscribe("cell-mousedown",this.handleCellMouseDown.bind(this)),this.subscribe("cell-mousemove",this.handleCellMouseMove.bind(this)),this.subscribe("cell-click",this.handleCellClick.bind(this)),this.subscribe("cell-editing",this.handleEditingCell.bind(this)),this.subscribe("page-changed",this.redraw.bind(this)),this.subscribe("scroll-vertical",this.layoutChange.bind(this)),this.subscribe("scroll-horizontal",this.layoutChange.bind(this)),this.subscribe("data-destroy",this.tableDestroyed.bind(this)),this.subscribe("data-processed",this.resetRanges.bind(this)),this.subscribe("table-layout",this.layoutElement.bind(this)),this.subscribe("table-redraw",this.redraw.bind(this)),this.subscribe("table-destroy",this.tableDestroyed.bind(this)),this.subscribe("edit-editor-clear",this.finishEditingCell.bind(this)),this.subscribe("edit-blur",this.restoreFocus.bind(this)),this.subscribe("keybinding-nav-prev",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-next",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-left",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-right",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-up",this.keyNavigate.bind(this,"up")),this.subscribe("keybinding-nav-down",this.keyNavigate.bind(this,"down")),this.subscribe("keybinding-nav-range",this.keyNavigateRange.bind(this))}initializeColumn(e){this.columnSelection&&e.definition.headerSort&&this.options("headerSortClickElement")!=="icon"&&console.warn("Using column headerSort with selectableRangeColumns option may result in unpredictable behavior. Consider using headerSortClickElement: 'icon'."),e.modules.edit}updateHeaderColumn(){var e;this.rowSelection&&(this.rowHeader=this.table.columnManager.getVisibleColumnsByIndex()[0],this.rowHeader&&(this.rowHeader.definition.cssClass=this.rowHeader.definition.cssClass+" tabulator-range-row-header",this.rowHeader.definition.headerSort&&console.warn("Using column headerSort with selectableRangeRows option may result in unpredictable behavior"),this.rowHeader.definition.editor&&console.warn("Using column editor with selectableRangeRows option may result in unpredictable behavior"))),this.table.modules.frozenColumns&&this.table.modules.frozenColumns.active&&(e=this.table.modules.frozenColumns.getFrozenColumns(),(e.length>1||e.length===1&&e[0]!==this.rowHeader)&&console.warn("Using frozen columns that are not the range header in combination with the selectRange option may result in unpredictable behavior"))}getRanges(){return this.ranges.map(e=>e.getComponent())}getRangesData(){return this.ranges.map(e=>e.getData())}addRangeFromComponent(e,t){return e=e?e._cell:null,t=t?t._cell:null,this.addRange(e,t)}cellGetRanges(e){var t=[];return e.column===this.rowHeader?t=this.ranges.filter(i=>i.occupiesRow(e.row)):t=this.ranges.filter(i=>i.occupies(e)),t.map(i=>i.getComponent())}rowGetRanges(e){var t=this.ranges.filter(i=>i.occupiesRow(e));return t.map(i=>i.getComponent())}colGetRanges(e){var t=this.ranges.filter(i=>i.occupiesColumn(e));return t.map(i=>i.getComponent())}_handleMouseUp(e){this.mousedown=!1,document.removeEventListener("mouseup",this.mouseUpEvent)}_handleKeyDown(e){if(!this.blockKeydown&&(!this.table.modules.edit||this.table.modules.edit&&!this.table.modules.edit.currentCell)){if(e.key==="Enter"){if(this.table.modules.edit&&this.table.modules.edit.currentCell)return;this.table.modules.edit.editCell(this.getActiveCell()),e.preventDefault()}(e.key==="Backspace"||e.key==="Delete")&&this.options("selectableRangeClearCells")&&this.activeRange&&this.activeRange.clearValues()}}initializeFocus(e){var t;this.restoreFocus();try{document.selection?(t=document.body.createTextRange(),t.moveToElementText(e.getElement()),t.select()):window.getSelection&&(t=document.createRange(),t.selectNode(e.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(t))}catch{}}restoreFocus(e){return this.table.rowManager.element.focus(),!0}handleColumnResized(e){var t;this.selecting!=="column"&&this.selecting!=="all"||(t=this.ranges.some(i=>i.occupiesColumn(e)),t&&this.ranges.forEach(i=>{var n=i.getColumns(!0);n.forEach(s=>{s!==e&&s.setWidth(e.width)})}))}handleColumnMoving(e,t){this.resetRanges().setBounds(t),this.overlay.style.visibility="hidden"}handleColumnMoved(e,t,i){this.activeRange.setBounds(e),this.layoutElement()}handleColumnMouseDown(e,t){e.button===2&&(this.selecting==="column"||this.selecting==="all")&&this.activeRange.occupiesColumn(t)||this.table.options.movableColumns&&this.selecting==="column"&&this.activeRange.occupiesColumn(t)||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,t))}handleColumnMouseMove(e,t){t===this.rowHeader||!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,t,!0)}renderCell(e){var t=e.getElement(),i=this.ranges.findIndex(n=>n.occupies(e));t.classList.toggle("tabulator-range-selected",i!==-1),t.classList.toggle("tabulator-range-only-cell-selected",this.ranges.length===1&&this.ranges[0].atTopLeft(e)&&this.ranges[0].atBottomRight(e)),t.dataset.range=i}handleCellMouseDown(e,t){e.button===2&&(this.activeRange.occupies(t)||(this.selecting==="row"||this.selecting==="all")&&this.activeRange.occupiesRow(t.row))||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,t))}handleCellMouseMove(e,t){!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,t,!0)}handleCellClick(e,t){this.initializeFocus(t)}handleEditingCell(e){this.activeRange&&this.activeRange.setBounds(e)}finishEditingCell(){this.blockKeydown=!0,this.table.rowManager.element.focus(),setTimeout(()=>{this.blockKeydown=!1},10)}keyNavigate(e,t){this.navigate(!1,!1,e),t.preventDefault()}keyNavigateRange(e,t,i,n){this.navigate(i,n,t),e.preventDefault()}navigate(e,t,i){var n=!1,s,o,a,l,h,u;if(this.table.modules.edit&&this.table.modules.edit.currentCell)return!1;if(this.ranges.length>1&&(this.ranges=this.ranges.filter(c=>c===this.activeRange?(c.setEnd(c.start.row,c.start.col),!0):(c.destroy(),!1))),s=this.activeRange,o=t?s.end:s.start,a=o.row,l=o.col,e)switch(i){case"left":l=this.findJumpCellLeft(s.start.row,o.col);break;case"right":l=this.findJumpCellRight(s.start.row,o.col);break;case"up":a=this.findJumpCellUp(o.row,s.start.col);break;case"down":a=this.findJumpCellDown(o.row,s.start.col);break}else{if(t&&(this.selecting==="row"&&(i==="left"||i==="right")||this.selecting==="column"&&(i==="up"||i==="down")))return;switch(i){case"left":l=Math.max(l-1,0);break;case"right":l=Math.min(l+1,this.getTableColumns().length-1);break;case"up":a=Math.max(a-1,0);break;case"down":a=Math.min(a+1,this.getTableRows().length-1);break}}if(this.rowHeader&&l===0&&(l=1),n=l!==o.col||a!==o.row,t||s.setStart(a,l),s.setEnd(a,l),t||(this.selecting="cell"),n)return h=this.getRowByRangePos(s.end.row),u=this.getColumnByRangePos(s.end.col),(i==="left"||i==="right")&&u.getElement().parentNode===null?u.getComponent().scrollTo(void 0,!1):(i==="up"||i==="down")&&h.getElement().parentNode===null?h.getComponent().scrollTo(void 0,!1):this.autoScroll(s,h.getElement(),u.getElement()),this.layoutElement(),!0}rangeRemoved(e){this.ranges=this.ranges.filter(t=>t!==e),this.activeRange===e&&(this.ranges.length?this.activeRange=this.ranges[this.ranges.length-1]:this.addRange()),this.layoutElement()}findJumpRow(e,t,i,n,s){return i&&(t=t.reverse()),this.findJumpItem(n,s,t,function(o){return o.getData()[e.getField()]})}findJumpCol(e,t,i,n,s){return i&&(t=t.reverse()),this.findJumpItem(n,s,t,function(o){return e.getData()[o.getField()]})}findJumpItem(e,t,i,n){var s;for(let o of i){let a=n(o);if(e){if(s=o,a)break}else if(t){if(s=o,a)break}else if(a)s=o;else break}return s}findJumpCellLeft(e,t){var i=this.getRowByRangePos(e),n=this.getTableColumns(),s=this.isEmpty(i.getData()[n[t].getField()]),o=n[t-1]?this.isEmpty(i.getData()[n[t-1].getField()]):!1,a=this.rowHeader?n.slice(1,t):n.slice(0,t),l=this.findJumpCol(i,a,!0,s,o);return l?l.getPosition()-1:t}findJumpCellRight(e,t){var i=this.getRowByRangePos(e),n=this.getTableColumns(),s=this.isEmpty(i.getData()[n[t].getField()]),o=n[t+1]?this.isEmpty(i.getData()[n[t+1].getField()]):!1,a=this.findJumpCol(i,n.slice(t+1,n.length),!1,s,o);return a?a.getPosition()-1:t}findJumpCellUp(e,t){var i=this.getColumnByRangePos(t),n=this.getTableRows(),s=this.isEmpty(n[e].getData()[i.getField()]),o=n[e-1]?this.isEmpty(n[e-1].getData()[i.getField()]):!1,a=this.findJumpRow(i,n.slice(0,e),!0,s,o);return a?a.position-1:e}findJumpCellDown(e,t){var i=this.getColumnByRangePos(t),n=this.getTableRows(),s=this.isEmpty(n[e].getData()[i.getField()]),o=n[e+1]?this.isEmpty(n[e+1].getData()[i.getField()]):!1,a=this.findJumpRow(i,n.slice(e+1,n.length),!1,s,o);return a?a.position-1:e}newSelection(e,t){var i;if(t.type==="column"){if(!this.columnSelection)return;if(t===this.rowHeader){i=this.resetRanges(),this.selecting="all";var n,s=this.getCell(-1,-1);this.rowHeader?n=this.getCell(0,1):n=this.getCell(0,0),i.setBounds(n,s);return}else this.selecting="column"}else t.column===this.rowHeader?this.selecting="row":this.selecting="cell";e.shiftKey?this.activeRange.setBounds(!1,t):e.ctrlKey?this.addRange().setBounds(t):this.resetRanges().setBounds(t)}autoScroll(e,t,i){var n=this.table.rowManager.element,s,o,a,l,h;typeof t>"u"&&(t=this.getRowByRangePos(e.end.row).getElement()),typeof i>"u"&&(i=this.getColumnByRangePos(e.end.col).getElement()),this.rowHeader&&(s=this.rowHeader.getElement()),o={left:i.offsetLeft,right:i.offsetLeft+i.offsetWidth,top:t.offsetTop,bottom:t.offsetTop+t.offsetHeight},a={left:n.scrollLeft,right:Math.ceil(n.scrollLeft+n.clientWidth),top:n.scrollTop,bottom:n.scrollTop+n.offsetHeight-this.table.rowManager.scrollbarWidth},s&&(a.left+=s.offsetWidth),l=a.left<o.left&&o.left<a.right&&a.left<o.right&&o.right<a.right,h=a.top<o.top&&o.top<a.bottom&&a.top<o.bottom&&o.bottom<a.bottom,l||(o.left<a.left?(n.scrollLeft=o.left,s&&(n.scrollLeft-=s.offsetWidth)):o.right>a.right&&(n.scrollLeft=o.right-n.clientWidth)),h||(o.top<a.top?n.scrollTop=o.top:o.bottom>a.bottom&&(n.scrollTop=o.bottom-n.clientHeight))}layoutChange(){this.overlay.style.visibility="hidden",clearTimeout(this.layoutChangeTimeout),this.layoutChangeTimeout=setTimeout(this.layoutRanges.bind(this),200)}redraw(e){e&&(this.selecting="cell",this.resetRanges(),this.layoutElement())}layoutElement(e){var t;e?t=this.table.rowManager.getVisibleRows(!0):t=this.table.rowManager.getRows(),t.forEach(i=>{i.type==="row"&&(this.layoutRow(i),i.cells.forEach(n=>this.renderCell(n)))}),this.getTableColumns().forEach(i=>{this.layoutColumn(i)}),this.layoutRanges()}layoutRow(e){var t=e.getElement(),i=!1,n=this.ranges.some(s=>s.occupiesRow(e));this.selecting==="row"?i=n:this.selecting==="all"&&(i=!0),t.classList.toggle("tabulator-range-selected",i),t.classList.toggle("tabulator-range-highlight",n)}layoutColumn(e){var t=e.getElement(),i=!1,n=this.ranges.some(s=>s.occupiesColumn(e));this.selecting==="column"?i=n:this.selecting==="all"&&(i=!0),t.classList.toggle("tabulator-range-selected",i),t.classList.toggle("tabulator-range-highlight",n)}layoutRanges(){var e,t,i;this.table.initialized&&(e=this.getActiveCell(),e&&(t=e.getElement(),i=e.row.getElement(),this.table.rtl?this.activeRangeCellElement.style.right=i.offsetWidth-t.offsetLeft-t.offsetWidth+"px":this.activeRangeCellElement.style.left=i.offsetLeft+t.offsetLeft+"px",this.activeRangeCellElement.style.top=i.offsetTop+"px",this.activeRangeCellElement.style.width=t.offsetWidth+"px",this.activeRangeCellElement.style.height=i.offsetHeight+"px",this.ranges.forEach(n=>n.layout()),this.overlay.style.visibility="visible"))}getCell(e,t){var i;return t<0&&(t=this.getTableColumns().length+t,t<0)?null:(e<0&&(e=this.getTableRows().length+e),i=this.table.rowManager.getRowFromPosition(e+1),i?i.getCells(!1,!0).filter(n=>n.column.visible)[t]:null)}getActiveCell(){return this.getCell(this.activeRange.start.row,this.activeRange.start.col)}getRowByRangePos(e){return this.getTableRows()[e]}getColumnByRangePos(e){return this.getTableColumns()[e]}getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}addRange(e,t){var i;return this.maxRanges!==!0&&this.ranges.length>=this.maxRanges&&this.ranges.shift().destroy(),i=new WD(this.table,this,e,t),this.activeRange=i,this.ranges.push(i),this.rangeContainer.appendChild(i.element),i}resetRanges(){var e,t,i;return this.ranges.forEach(n=>n.destroy()),this.ranges=[],e=this.addRange(),this.table.rowManager.activeRows.length&&(i=this.table.rowManager.activeRows[0].cells.filter(n=>n.column.visible),t=i[this.rowHeader?1:0],t&&(e.setBounds(t),this.initializeFocus(t))),e}tableDestroyed(){document.removeEventListener("mouseup",this.mouseUpEvent),this.table.rowManager.element.removeEventListener("keydown",this.keyDownEvent)}selectedRows(e){return e?this.activeRange.getRows().map(t=>t.getComponent()):this.activeRange.getRows()}selectedColumns(e){return e?this.activeRange.getColumns().map(t=>t.getComponent()):this.activeRange.getColumns()}isEmpty(e){return e==null||e===""}}K($a,"moduleName","selectRange"),K($a,"moduleInitOrder",1),K($a,"moduleExtensions",KD);function qD(r,e,t,i,n,s,o){var a=o.alignEmptyValues,l=o.decimalSeparator,h=o.thousandSeparator,u=0;if(r=String(r),e=String(e),h&&(r=r.split(h).join(""),e=e.split(h).join("")),l&&(r=r.split(l).join("."),e=e.split(l).join(".")),r=parseFloat(r),e=parseFloat(e),isNaN(r))u=isNaN(e)?0:-1;else if(isNaN(e))u=1;else return r-e;return(a==="top"&&s==="desc"||a==="bottom"&&s==="asc")&&(u*=-1),u}function JD(r,e,t,i,n,s,o){var a=o.alignEmptyValues,l=0,h;if(!r)l=e?-1:0;else if(!e)l=1;else{switch(typeof o.locale){case"boolean":o.locale&&(h=this.langLocale());break;case"string":h=o.locale;break}return String(r).toLowerCase().localeCompare(String(e).toLowerCase(),h)}return(a==="top"&&s==="desc"||a==="bottom"&&s==="asc")&&(l*=-1),l}function xf(r,e,t,i,n,s,o){var a=window.DateTime||luxon.DateTime,l=o.format||"dd/MM/yyyy HH:mm:ss",h=o.alignEmptyValues,u=0;if(typeof a<"u"){if(a.isDateTime(r)||(l==="iso"?r=a.fromISO(String(r)):r=a.fromFormat(String(r),l)),a.isDateTime(e)||(l==="iso"?e=a.fromISO(String(e)):e=a.fromFormat(String(e),l)),!r.isValid)u=e.isValid?-1:0;else if(!e.isValid)u=1;else return r-e;return(h==="top"&&s==="desc"||h==="bottom"&&s==="asc")&&(u*=-1),u}else console.error("Sort Error - 'datetime' sorter is dependant on luxon.js")}function QD(r,e,t,i,n,s,o){return o.format||(o.format="dd/MM/yyyy"),xf.call(this,r,e,t,i,n,s,o)}function ek(r,e,t,i,n,s,o){return o.format||(o.format="HH:mm"),xf.call(this,r,e,t,i,n,s,o)}function tk(r,e,t,i,n,s,o){var a=r===!0||r==="true"||r==="True"||r===1?1:0,l=e===!0||e==="true"||e==="True"||e===1?1:0;return a-l}function ik(r,e,t,i,n,s,o){var a=o.type||"length",l=o.alignEmptyValues,h=0;function u(c){var d;switch(a){case"length":d=c.length;break;case"sum":d=c.reduce(function(f,g){return f+g});break;case"max":d=Math.max.apply(null,c);break;case"min":d=Math.min.apply(null,c);break;case"avg":d=c.reduce(function(f,g){return f+g})/c.length;break}return d}if(!Array.isArray(r))h=Array.isArray(e)?-1:0;else if(!Array.isArray(e))h=1;else return u(e)-u(r);return(l==="top"&&s==="desc"||l==="bottom"&&s==="asc")&&(h*=-1),h}function nk(r,e,t,i,n,s,o){var a=typeof r>"u"?0:1,l=typeof e>"u"?0:1;return a-l}function rk(r,e,t,i,n,s,o){var a,l,h,u,c=0,d,f=/(\d+)|(\D+)/g,g=/\d/,m=o.alignEmptyValues,w=0;if(!r&&r!==0)w=!e&&e!==0?0:-1;else if(!e&&e!==0)w=1;else{if(isFinite(r)&&isFinite(e))return r-e;if(a=String(r).toLowerCase(),l=String(e).toLowerCase(),a===l)return 0;if(!(g.test(a)&&g.test(l)))return a>l?1:-1;for(a=a.match(f),l=l.match(f),d=a.length>l.length?l.length:a.length;c<d;)if(h=a[c],u=l[c++],h!==u)return isFinite(h)&&isFinite(u)?(h.charAt(0)==="0"&&(h="."+h),u.charAt(0)==="0"&&(u="."+u),h-u):h>u?1:-1;return a.length>l.length}return(m==="top"&&s==="desc"||m==="bottom"&&s==="asc")&&(w*=-1),w}var sk={number:qD,string:JD,date:QD,time:ek,datetime:xf,boolean:tk,array:ik,exists:nk,alphanum:rk};const Cr=class Cr extends Le{constructor(e){super(e),this.sortList=[],this.changed=!1,this.registerTableOption("sortMode","local"),this.registerTableOption("initialSort",!1),this.registerTableOption("columnHeaderSortMulti",!0),this.registerTableOption("sortOrderReverse",!1),this.registerTableOption("headerSortElement","<div class='tabulator-arrow'></div>"),this.registerTableOption("headerSortClickElement","header"),this.registerColumnOption("sorter"),this.registerColumnOption("sorterParams"),this.registerColumnOption("headerSort",!0),this.registerColumnOption("headerSortStartingDir"),this.registerColumnOption("headerSortTristate")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.registerDataHandler(this.sort.bind(this),20),this.registerTableFunction("setSort",this.userSetSort.bind(this)),this.registerTableFunction("getSorters",this.getSort.bind(this)),this.registerTableFunction("clearSort",this.clearSort.bind(this)),this.table.options.sortMode==="remote"&&this.subscribe("data-params",this.remoteSortParams.bind(this))}tableBuilt(){this.table.options.initialSort&&this.setSort(this.table.options.initialSort)}remoteSortParams(e,t,i,n){var s=this.getSort();return s.forEach(o=>{delete o.column}),n.sort=s,n}userSetSort(e,t){this.setSort(e,t),this.refreshSort()}clearSort(){this.clear(),this.refreshSort()}initializeColumn(e){var t=!1,i,n;switch(typeof e.definition.sorter){case"string":Cr.sorters[e.definition.sorter]?t=Cr.sorters[e.definition.sorter]:console.warn("Sort Error - No such sorter found: ",e.definition.sorter);break;case"function":t=e.definition.sorter;break}if(e.modules.sort={sorter:t,dir:"none",params:e.definition.sorterParams||{},startingDir:e.definition.headerSortStartingDir||"asc",tristate:e.definition.headerSortTristate},e.definition.headerSort!==!1){switch(i=e.getElement(),i.classList.add("tabulator-sortable"),n=document.createElement("div"),n.classList.add("tabulator-col-sorter"),this.table.options.headerSortClickElement){case"icon":n.classList.add("tabulator-col-sorter-element");break;case"header":i.classList.add("tabulator-col-sorter-element");break;default:i.classList.add("tabulator-col-sorter-element");break}switch(this.table.options.headerSortElement){case"function":break;case"object":n.appendChild(this.table.options.headerSortElement);break;default:n.innerHTML=this.table.options.headerSortElement}e.titleHolderElement.appendChild(n),e.modules.sort.element=n,this.setColumnHeaderSortIcon(e,"none"),this.table.options.headerSortClickElement==="icon"&&n.addEventListener("mousedown",s=>{s.stopPropagation()}),(this.table.options.headerSortClickElement==="icon"?n:i).addEventListener("click",s=>{var o="",a=[],l=!1;if(e.modules.sort){if(e.modules.sort.tristate)e.modules.sort.dir=="none"?o=e.modules.sort.startingDir:e.modules.sort.dir==e.modules.sort.startingDir?o=e.modules.sort.dir=="asc"?"desc":"asc":o="none";else switch(e.modules.sort.dir){case"asc":o="desc";break;case"desc":o="asc";break;default:o=e.modules.sort.startingDir}this.table.options.columnHeaderSortMulti&&(s.shiftKey||s.ctrlKey)?(a=this.getSort(),l=a.findIndex(h=>h.field===e.getField()),l>-1?(a[l].dir=o,l=a.splice(l,1)[0],o!="none"&&a.push(l)):o!="none"&&a.push({column:e,dir:o}),this.setSort(a)):o=="none"?this.clear():this.setSort(e,o),this.refreshSort()}})}}refreshSort(){this.table.options.sortMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0)}hasChanged(){var e=this.changed;return this.changed=!1,e}getSort(){var e=this,t=[];return e.sortList.forEach(function(i){i.column&&t.push({column:i.column.getComponent(),field:i.column.getField(),dir:i.dir})}),t}setSort(e,t){var i=this,n=[];Array.isArray(e)||(e=[{column:e,dir:t}]),e.forEach(function(s){var o;o=i.table.columnManager.findColumn(s.column),o?(s.column=o,n.push(s),i.changed=!0):console.warn("Sort Warning - Sort field does not exist and is being ignored: ",s.column)}),i.sortList=n,this.dispatch("sort-changed")}clear(){this.setSort([])}findSorter(e){var t=this.table.rowManager.activeRows[0],i="string",n,s;if(t&&(t=t.getData(),n=e.getField(),n))switch(s=e.getFieldValue(t),typeof s){case"undefined":i="string";break;case"boolean":i="boolean";break;default:!isNaN(s)&&s!==""?i="number":s.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)&&(i="alphanum");break}return Cr.sorters[i]}sort(e,t){var i=this,n=this.table.options.sortOrderReverse?i.sortList.slice().reverse():i.sortList,s=[],o=[];return this.subscribedExternal("dataSorting")&&this.dispatchExternal("dataSorting",i.getSort()),t||i.clearColumnHeaders(),this.table.options.sortMode!=="remote"?(n.forEach(function(a,l){var h;a.column&&(h=a.column.modules.sort,h&&(h.sorter||(h.sorter=i.findSorter(a.column)),a.params=typeof h.params=="function"?h.params(a.column.getComponent(),a.dir):h.params,s.push(a)),t||i.setColumnHeader(a.column,a.dir))}),s.length&&i._sortItems(e,s)):t||n.forEach(function(a,l){i.setColumnHeader(a.column,a.dir)}),this.subscribedExternal("dataSorted")&&(e.forEach(a=>{o.push(a.getComponent())}),this.dispatchExternal("dataSorted",i.getSort(),o)),e}clearColumnHeaders(){this.table.columnManager.getRealColumns().forEach(e=>{e.modules.sort&&(e.modules.sort.dir="none",e.getElement().setAttribute("aria-sort","none"),this.setColumnHeaderSortIcon(e,"none"))})}setColumnHeader(e,t){e.modules.sort.dir=t,e.getElement().setAttribute("aria-sort",t==="asc"?"ascending":"descending"),this.setColumnHeaderSortIcon(e,t)}setColumnHeaderSortIcon(e,t){var i=e.modules.sort.element,n;if(e.definition.headerSort&&typeof this.table.options.headerSortElement=="function"){for(;i.firstChild;)i.removeChild(i.firstChild);n=this.table.options.headerSortElement.call(this.table,e.getComponent(),t),typeof n=="object"?i.appendChild(n):i.innerHTML=n}}_sortItems(e,t){var i=t.length-1;e.sort((n,s)=>{for(var o,a=i;a>=0;a--){let l=t[a];if(o=this._sortRow(n,s,l.column,l.dir,l.params),o!==0)break}return o})}_sortRow(e,t,i,n,s){var o,a,l=n=="asc"?e:t,h=n=="asc"?t:e;return e=i.getFieldValue(l.getData()),t=i.getFieldValue(h.getData()),e=typeof e<"u"?e:"",t=typeof t<"u"?t:"",o=l.getComponent(),a=h.getComponent(),i.modules.sort.sorter.call(this,e,t,o,a,i.getComponent(),n,s)}};K(Cr,"moduleName","sort"),K(Cr,"sorters",sk);let Rc=Cr;class ok{constructor(e,t){this.columnCount=e,this.rowCount=t,this.columnString=[],this.columns=[],this.rows=[]}genColumns(e){var t=Math.max(this.columnCount,Math.max(...e.map(i=>i.length)));this.columnString=[],this.columns=[];for(let i=1;i<=t;i++)this.incrementChar(this.columnString.length-1),this.columns.push(this.columnString.join(""));return this.columns}genRows(e){var t=Math.max(this.rowCount,e.length);this.rows=[];for(let i=1;i<=t;i++)this.rows.push(i);return this.rows}incrementChar(e){let t=this.columnString[e];t?t!=="Z"?this.columnString[e]=String.fromCharCode(this.columnString[e].charCodeAt(0)+1):(this.columnString[e]="A",e?this.incrementChar(e-1):this.columnString.push("A")):this.columnString.push("A")}setRowCount(e){this.rowCount=e}setColumnCount(e){this.columnCount=e}}class Ov{constructor(e){return this._sheet=e,new Proxy(this,{get:function(t,i,n){return typeof t[i]<"u"?t[i]:t._sheet.table.componentFunctionBinder.handle("sheet",t._sheet,i)}})}getTitle(){return this._sheet.title}getKey(){return this._sheet.key}getDefinition(){return this._sheet.getDefinition()}getData(){return this._sheet.getData()}setData(e){return this._sheet.setData(e)}clear(){return this._sheet.clear()}remove(){return this._sheet.remove()}active(){return this._sheet.active()}setTitle(e){return this._sheet.setTitle(e)}setRows(e){return this._sheet.setRows(e)}setColumns(e){return this._sheet.setColumns(e)}}class Xp extends It{constructor(e,t){super(e.table),this.spreadsheetManager=e,this.definition=t,this.title=this.definition.title||"",this.key=this.definition.key||this.definition.title,this.rowCount=this.definition.rows,this.columnCount=this.definition.columns,this.data=this.definition.data||[],this.element=null,this.isActive=!1,this.grid=new ok(this.columnCount,this.rowCount),this.defaultColumnDefinition={width:100,headerHozAlign:"center",headerSort:!1},this.columnDefinition=Object.assign(this.defaultColumnDefinition,this.options("spreadsheetColumnDefinition")),this.columnDefs=[],this.rowDefs=[],this.columnFields=[],this.columns=[],this.rows=[],this.scrollTop=null,this.scrollLeft=null,this.initialize(),this.dispatchExternal("sheetAdded",this.getComponent())}initialize(){this.initializeElement(),this.initializeColumns(),this.initializeRows()}reinitialize(){this.initializeColumns(),this.initializeRows()}initializeElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tab"),this.element.innerText=this.title,this.element.addEventListener("click",()=>{this.spreadsheetManager.loadSheet(this)})}initializeColumns(){this.grid.setColumnCount(this.columnCount),this.columnFields=this.grid.genColumns(this.data),this.columnDefs=[],this.columnFields.forEach(e=>{var t=Object.assign({},this.columnDefinition);t.field=e,t.title=e,this.columnDefs.push(t)})}initializeRows(){var e;this.grid.setRowCount(this.rowCount),e=this.grid.genRows(this.data),this.rowDefs=[],e.forEach((t,i)=>{var n={_id:t},s=this.data[i];s&&s.forEach((o,a)=>{var l=this.columnFields[a];l&&(n[l]=o)}),this.rowDefs.push(n)})}unload(){this.isActive=!1,this.scrollTop=this.table.rowManager.scrollTop,this.scrollLeft=this.table.rowManager.scrollLeft,this.data=this.getData(!0),this.element.classList.remove("tabulator-spreadsheet-tab-active")}load(){var e=!this.isActive;this.isActive=!0,this.table.blockRedraw(),this.table.setData([]),this.table.setColumns(this.columnDefs),this.table.setData(this.rowDefs),this.table.restoreRedraw(),e&&this.scrollTop!==null&&(this.table.rowManager.element.scrollLeft=this.scrollLeft,this.table.rowManager.element.scrollTop=this.scrollTop),this.element.classList.add("tabulator-spreadsheet-tab-active"),this.dispatchExternal("sheetLoaded",this.getComponent())}getComponent(){return new Ov(this)}getDefinition(){return{title:this.title,key:this.key,rows:this.rowCount,columns:this.columnCount,data:this.getData()}}getData(e){var t=[],i,n,s;return this.rowDefs.forEach(o=>{var a=[];this.columnFields.forEach(l=>{a.push(o[l])}),t.push(a)}),!e&&!this.options("spreadsheetOutputFull")&&(i=t.map(o=>o.findLastIndex(a=>typeof a<"u")+1),n=Math.max(...i),s=i.findLastIndex(o=>o>0)+1,t=t.slice(0,s),t=t.map(o=>o.slice(0,n))),t}setData(e){this.data=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}clear(){this.setData([])}setTitle(e){this.title=e,this.element.innerText=e,this.dispatchExternal("sheetUpdated",this.getComponent())}setRows(e){this.rowCount=e,this.initializeRows(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}setColumns(e){this.columnCount=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}remove(){this.spreadsheetManager.removeSheet(this)}destroy(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.dispatchExternal("sheetRemoved",this.getComponent())}active(){this.spreadsheetManager.loadSheet(this)}}class Dv extends Le{constructor(e){super(e),this.sheets=[],this.element=null,this.registerTableOption("spreadsheet",!1),this.registerTableOption("spreadsheetRows",50),this.registerTableOption("spreadsheetColumns",50),this.registerTableOption("spreadsheetColumnDefinition",{}),this.registerTableOption("spreadsheetOutputFull",!1),this.registerTableOption("spreadsheetData",!1),this.registerTableOption("spreadsheetSheets",!1),this.registerTableOption("spreadsheetSheetTabs",!1),this.registerTableOption("spreadsheetSheetTabsElement",!1),this.registerTableFunction("setSheets",this.setSheets.bind(this)),this.registerTableFunction("addSheet",this.addSheet.bind(this)),this.registerTableFunction("getSheets",this.getSheets.bind(this)),this.registerTableFunction("getSheetDefinitions",this.getSheetDefinitions.bind(this)),this.registerTableFunction("setSheetData",this.setSheetData.bind(this)),this.registerTableFunction("getSheet",this.getSheet.bind(this)),this.registerTableFunction("getSheetData",this.getSheetData.bind(this)),this.registerTableFunction("clearSheet",this.clearSheet.bind(this)),this.registerTableFunction("removeSheet",this.removeSheetFunc.bind(this)),this.registerTableFunction("activeSheet",this.activeSheetFunc.bind(this))}initialize(){this.options("spreadsheet")&&(this.subscribe("table-initialized",this.tableInitialized.bind(this)),this.subscribe("data-loaded",this.loadRemoteData.bind(this)),this.table.options.index="_id",this.options("spreadsheetData")&&this.options("spreadsheetSheets")&&(console.warn("You cannot use spreadsheetData and spreadsheetSheets at the same time, ignoring spreadsheetData"),this.table.options.spreadsheetData=!1),this.compatibilityCheck(),this.options("spreadsheetSheetTabs")&&this.initializeTabset())}compatibilityCheck(){this.options("data")&&console.warn("Do not use the data option when working with spreadsheets, use either spreadsheetData or spreadsheetSheets to pass data into the table"),this.options("pagination")&&console.warn("The spreadsheet module is not compatible with the pagination module"),this.options("groupBy")&&console.warn("The spreadsheet module is not compatible with the row grouping module"),this.options("responsiveCollapse")&&console.warn("The spreadsheet module is not compatible with the responsive collapse module")}initializeTabset(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tabs");var e=this.options("spreadsheetSheetTabsElement");e&&!(e instanceof HTMLElement)&&(e=document.querySelector(e),e||console.warn("Unable to find element matching spreadsheetSheetTabsElement selector:",this.options("spreadsheetSheetTabsElement"))),e?e.appendChild(this.element):this.footerAppend(this.element)}tableInitialized(){this.sheets.length?this.loadSheet(this.sheets[0]):this.options("spreadsheetSheets")?this.loadSheets(this.options("spreadsheetSheets")):this.options("spreadsheetData")&&this.loadData(this.options("spreadsheetData"))}loadRemoteData(e,t,i){return console.log("data",e,t,i),Array.isArray(e)?(this.table.dataLoader.clearAlert(),this.dispatchExternal("dataLoaded",e),!e.length||Array.isArray(e[0])?this.loadData(e):this.loadSheets(e)):console.error(`Spreadsheet Loading Error - Unable to process remote data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e),!1}loadData(e){var t={data:e};this.loadSheet(this.newSheet(t))}destroySheets(){this.sheets.forEach(e=>{e.destroy()}),this.sheets=[],this.activeSheet=null}loadSheets(e){Array.isArray(e)||(e=[]),this.destroySheets(),e.forEach(t=>{this.newSheet(t)}),this.loadSheet(this.sheets[0])}loadSheet(e){this.activeSheet!==e&&(this.activeSheet&&this.activeSheet.unload(),this.activeSheet=e,e.load())}newSheet(e={}){var t;return e.rows||(e.rows=this.options("spreadsheetRows")),e.columns||(e.columns=this.options("spreadsheetColumns")),t=new Xp(this,e),this.sheets.push(t),this.element&&this.element.appendChild(t.element),t}removeSheet(e){var t=this.sheets.indexOf(e),i;this.sheets.length>1?t>-1&&(this.sheets.splice(t,1),e.destroy(),this.activeSheet===e&&(i=this.sheets[t-1]||this.sheets[0],i?this.loadSheet(i):this.activeSheet=null)):console.warn("Unable to remove sheet, at least one sheet must be active")}lookupSheet(e){return e?e instanceof Xp?e:e instanceof Ov?e._sheet:this.sheets.find(t=>t.key===e)||!1:this.activeSheet}setSheets(e){return this.loadSheets(e),this.getSheets()}addSheet(e){return this.newSheet(e).getComponent()}getSheetDefinitions(){return this.sheets.map(e=>e.getDefinition())}getSheets(){return this.sheets.map(e=>e.getComponent())}getSheet(e){var t=this.lookupSheet(e);return t?t.getComponent():!1}setSheetData(e,t){e&&!t&&(t=e,e=!1);var i=this.lookupSheet(e);return i?i.setData(t):!1}getSheetData(e){var t=this.lookupSheet(e);return t?t.getData():!1}clearSheet(e){var t=this.lookupSheet(e);return t?t.clear():!1}removeSheetFunc(e){var t=this.lookupSheet(e);t&&this.removeSheet(t)}activeSheetFunc(e){var t=this.lookupSheet(e);return t?this.loadSheet(t):!1}}K(Dv,"moduleName","spreadsheet");class kv extends Le{constructor(e){super(e),this.tooltipSubscriber=null,this.headerSubscriber=null,this.timeout=null,this.popupInstance=null,this.registerTableOption("tooltipDelay",300),this.registerColumnOption("tooltip"),this.registerColumnOption("headerTooltip")}initialize(){this.deprecatedOptionsCheck(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeColumn(e){e.definition.headerTooltip&&!this.headerSubscriber&&(this.headerSubscriber=!0,this.subscribe("column-mousemove",this.mousemoveCheck.bind(this,"headerTooltip")),this.subscribe("column-mouseout",this.mouseoutCheck.bind(this,"headerTooltip"))),e.definition.tooltip&&!this.tooltipSubscriber&&(this.tooltipSubscriber=!0,this.subscribe("cell-mousemove",this.mousemoveCheck.bind(this,"tooltip")),this.subscribe("cell-mouseout",this.mouseoutCheck.bind(this,"tooltip")))}mousemoveCheck(e,t,i){var n=e==="tooltip"?i.column.definition.tooltip:i.definition.headerTooltip;n&&(this.clearPopup(),this.timeout=setTimeout(this.loadTooltip.bind(this,t,i,n),this.table.options.tooltipDelay))}mouseoutCheck(e,t,i){this.popupInstance||this.clearPopup()}clearPopup(e,t,i){clearTimeout(this.timeout),this.timeout=null,this.popupInstance&&this.popupInstance.hide()}loadTooltip(e,t,i){var n,s,o;function a(l){s=l}typeof i=="function"&&(i=i(e,t.getComponent(),a)),i instanceof HTMLElement?n=i:(n=document.createElement("div"),i===!0&&(t instanceof fa?i=t.value:t.definition.field?this.langBind("columns|"+t.definition.field,l=>{n.innerHTML=i=l||t.definition.title}):i=t.definition.title),n.innerHTML=i),(i||i===0||i===!1)&&(n.classList.add("tabulator-tooltip"),n.addEventListener("mousemove",l=>l.preventDefault()),this.popupInstance=this.popup(n),typeof s=="function"&&this.popupInstance.renderCallback(s),o=this.popupInstance.containerEventCoords(e),this.popupInstance.show(o.x+15,o.y+15).hideOnBlur(()=>{this.dispatchExternal("TooltipClosed",t.getComponent()),this.popupInstance=null}),this.dispatchExternal("TooltipOpened",t.getComponent()))}}K(kv,"moduleName","tooltip");var ak={integer:function(r,e,t){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&Math.floor(e)===e)},float:function(r,e,t){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&e%1!==0)},numeric:function(r,e,t){return e===""||e===null||typeof e>"u"?!0:!isNaN(e)},string:function(r,e,t){return e===""||e===null||typeof e>"u"?!0:isNaN(e)},alphanumeric:function(r,e,t){if(e===""||e===null||typeof e>"u")return!0;var i=new RegExp(/^[a-z0-9]+$/i);return i.test(e)},max:function(r,e,t){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)<=t},min:function(r,e,t){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)>=t},starts:function(r,e,t){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().startsWith(String(t).toLowerCase())},ends:function(r,e,t){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().endsWith(String(t).toLowerCase())},minLength:function(r,e,t){return e===""||e===null||typeof e>"u"?!0:String(e).length>=t},maxLength:function(r,e,t){return e===""||e===null||typeof e>"u"?!0:String(e).length<=t},in:function(r,e,t){return e===""||e===null||typeof e>"u"?!0:(typeof t=="string"&&(t=t.split("|")),t.indexOf(e)>-1)},regex:function(r,e,t){if(e===""||e===null||typeof e>"u")return!0;var i=new RegExp(t);return i.test(e)},unique:function(r,e,t){if(e===""||e===null||typeof e>"u")return!0;var i=!0,n=r.getData(),s=r.getColumn()._getSelf();return this.table.rowManager.rows.forEach(function(o){var a=o.getData();a!==n&&e==s.getFieldValue(a)&&(i=!1)}),i},required:function(r,e,t){return e!==""&&e!==null&&typeof e<"u"}};const xo=class xo extends Le{constructor(e){super(e),this.invalidCells=[],this.registerTableOption("validationMode","blocking"),this.registerColumnOption("validator"),this.registerTableFunction("getInvalidCells",this.getInvalidCells.bind(this)),this.registerTableFunction("clearCellValidation",this.userClearCellValidation.bind(this)),this.registerTableFunction("validate",this.userValidate.bind(this)),this.registerComponentFunction("cell","isValid",this.cellIsValid.bind(this)),this.registerComponentFunction("cell","clearValidation",this.clearValidation.bind(this)),this.registerComponentFunction("cell","validate",this.cellValidate.bind(this)),this.registerComponentFunction("column","validate",this.columnValidate.bind(this)),this.registerComponentFunction("row","validate",this.rowValidate.bind(this))}initialize(){this.subscribe("cell-delete",this.clearValidation.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("edit-success",this.editValidate.bind(this)),this.subscribe("edit-editor-clear",this.editorClear.bind(this)),this.subscribe("edit-edited-clear",this.editedClear.bind(this))}editValidate(e,t,i){var n=this.table.options.validationMode!=="manual"?this.validate(e.column.modules.validate,e,t):!0;return n!==!0&&setTimeout(()=>{e.getElement().classList.add("tabulator-validation-fail"),this.dispatchExternal("validationFailed",e.getComponent(),t,n)}),n}editorClear(e,t){t&&e.column.modules.validate&&this.cellValidate(e),e.getElement().classList.remove("tabulator-validation-fail")}editedClear(e){e.modules.validate&&(e.modules.validate.invalid=!1)}cellIsValid(e){return e.modules.validate&&e.modules.validate.invalid||!0}cellValidate(e){return this.validate(e.column.modules.validate,e,e.getValue())}columnValidate(e){var t=[];return e.cells.forEach(i=>{this.cellValidate(i)!==!0&&t.push(i.getComponent())}),t.length?t:!0}rowValidate(e){var t=[];return e.cells.forEach(i=>{this.cellValidate(i)!==!0&&t.push(i.getComponent())}),t.length?t:!0}userClearCellValidation(e){e||(e=this.getInvalidCells()),Array.isArray(e)||(e=[e]),e.forEach(t=>{this.clearValidation(t._getSelf())})}userValidate(e){var t=[];return this.table.rowManager.rows.forEach(i=>{i=i.getComponent();var n=i.validate();n!==!0&&(t=t.concat(n))}),t.length?t:!0}initializeColumnCheck(e){typeof e.definition.validator<"u"&&this.initializeColumn(e)}initializeColumn(e){var t=this,i=[],n;e.definition.validator&&(Array.isArray(e.definition.validator)?e.definition.validator.forEach(s=>{n=t._extractValidator(s),n&&i.push(n)}):(n=this._extractValidator(e.definition.validator),n&&i.push(n)),e.modules.validate=i.length?i:!1)}_extractValidator(e){var t,i,n;switch(typeof e){case"string":return n=e.indexOf(":"),n>-1?(t=e.substring(0,n),i=e.substring(n+1)):t=e,this._buildValidator(t,i);case"function":return this._buildValidator(e);case"object":return this._buildValidator(e.type,e.parameters)}}_buildValidator(e,t){var i=typeof e=="function"?e:xo.validators[e];return i?{type:typeof e=="function"?"function":e,func:i,params:t}:(console.warn("Validator Setup Error - No matching validator found:",e),!1)}validate(e,t,i){var n=this,s=[],o=this.invalidCells.indexOf(t);return e&&e.forEach(a=>{a.func.call(n,t.getComponent(),i,a.params)||s.push({type:a.type,parameters:a.params})}),t.modules.validate||(t.modules.validate={}),s.length?(t.modules.validate.invalid=s,this.table.options.validationMode!=="manual"&&t.getElement().classList.add("tabulator-validation-fail"),o==-1&&this.invalidCells.push(t)):(t.modules.validate.invalid=!1,t.getElement().classList.remove("tabulator-validation-fail"),o>-1&&this.invalidCells.splice(o,1)),s.length?s:!0}getInvalidCells(){var e=[];return this.invalidCells.forEach(t=>{e.push(t.getComponent())}),e}clearValidation(e){var t;e.modules.validate&&e.modules.validate.invalid&&(e.getElement().classList.remove("tabulator-validation-fail"),e.modules.validate.invalid=!1,t=this.invalidCells.indexOf(e),t>-1&&this.invalidCells.splice(t,1))}};K(xo,"moduleName","validate"),K(xo,"validators",ak);let Sc=xo;var fu=Object.freeze({__proto__:null,AccessorModule:sc,AjaxModule:lc,ClipboardModule:hc,ColumnCalcsModule:uc,DataTreeModule:wv,DownloadModule:cc,EditModule:dc,ExportModule:fc,FilterModule:gc,FormatModule:pc,FrozenColumnsModule:Ev,FrozenRowsModule:_v,GroupRowsModule:Cv,HistoryModule:mc,HtmlTableImportModule:xv,ImportModule:bc,InteractionModule:Rv,KeybindingsModule:yc,MenuModule:Sv,MoveColumnsModule:Tv,MoveRowsModule:vc,MutatorModule:wc,PageModule:Ec,PersistenceModule:_c,PopupModule:Mv,PrintModule:Lv,ReactiveDataModule:Av,ResizeColumnsModule:Iv,ResizeRowsModule:Pv,ResizeTableModule:Fv,ResponsiveLayoutModule:Cc,SelectRangeModule:$a,SelectRowModule:xc,SortModule:Rc,SpreadsheetModule:Dv,TooltipModule:kv,ValidateModule:Sc}),lk={debugEventsExternal:!1,debugEventsInternal:!1,debugInvalidOptions:!0,debugInvalidComponentFuncs:!0,debugInitialization:!0,debugDeprecation:!0,height:!1,minHeight:!1,maxHeight:!1,columnHeaderVertAlign:"top",popupContainer:!1,columns:[],columnDefaults:{},rowHeader:!1,data:!1,autoColumns:!1,autoColumnsDefinitions:!1,nestedFieldSeparator:".",footerElement:!1,index:"id",textDirection:"auto",addRowPos:"bottom",headerVisible:!0,renderVertical:"virtual",renderHorizontal:"basic",renderVerticalBuffer:0,scrollToRowPosition:"top",scrollToRowIfVisible:!0,scrollToColumnPosition:"left",scrollToColumnIfVisible:!0,rowFormatter:!1,rowFormatterPrint:null,rowFormatterClipboard:null,rowFormatterHtmlOutput:null,rowHeight:null,placeholder:!1,dataLoader:!0,dataLoaderLoading:!1,dataLoaderError:!1,dataLoaderErrorTimeout:3e3,dataSendParams:{},dataReceiveParams:{}};class Nv{constructor(e,t,i={}){this.table=e,this.msgType=t,this.registeredDefaults=Object.assign({},i)}register(e,t){this.registeredDefaults[e]=t}generate(e,t={}){var i=Object.assign({},this.registeredDefaults),n=this.table.options.debugInvalidOptions||t.debugInvalidOptions===!0;Object.assign(i,e);for(let s in t)i.hasOwnProperty(s)||(n&&console.warn("Invalid "+this.msgType+" option:",s),i[s]=t.key);for(let s in i)s in t?i[s]=t[s]:Array.isArray(i[s])?i[s]=Object.assign([],i[s]):typeof i[s]=="object"&&i[s]!==null?i[s]=Object.assign({},i[s]):typeof i[s]>"u"&&delete i[s];return i}}class Ch extends It{constructor(e){super(e),this.elementVertical=e.rowManager.element,this.elementHorizontal=e.columnManager.element,this.tableElement=e.rowManager.tableElement,this.verticalFillMode="fit"}initialize(){}clearRows(){}clearColumns(){}reinitializeColumnWidths(e){}renderRows(){}renderColumns(){}rerenderRows(e){e&&e()}rerenderColumns(e,t){}renderRowCells(e){}rerenderRowCells(e,t){}scrollColumns(e,t){}scrollRows(e,t){}resize(){}scrollToRow(e){}scrollToRowNearestTop(e){}visibleRows(e){return[]}rows(){return this.table.rowManager.getDisplayRows()}styleRow(e,t){var i=e.getElement();t%2?(i.classList.add("tabulator-row-even"),i.classList.remove("tabulator-row-odd")):(i.classList.add("tabulator-row-odd"),i.classList.remove("tabulator-row-even"))}clear(){this.clearRows(),this.clearColumns()}render(){this.renderRows(),this.renderColumns()}rerender(e){this.rerenderRows(),this.rerenderColumns()}scrollToRowPosition(e,t,i){var n=this.rows().indexOf(e),s=e.getElement(),o=0;return new Promise((a,l)=>{if(n>-1){if(typeof i>"u"&&(i=this.table.options.scrollToRowIfVisible),!i&&Ze.elVisible(s)&&(o=Ze.elOffset(s).top-Ze.elOffset(this.elementVertical).top,o>0&&o<this.elementVertical.clientHeight-s.offsetHeight))return a(),!1;switch(typeof t>"u"&&(t=this.table.options.scrollToRowPosition),t==="nearest"&&(t=this.scrollToRowNearestTop(e)?"top":"bottom"),this.scrollToRow(e),t){case"middle":case"center":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop+(s.offsetTop-this.elementVertical.scrollTop)-(this.elementVertical.scrollHeight-s.offsetTop)/2:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight/2;break;case"bottom":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop-(this.elementVertical.scrollHeight-s.offsetTop)+s.offsetHeight:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight+s.offsetHeight;break;case"top":this.elementVertical.scrollTop=s.offsetTop;break}a()}else console.warn("Scroll Error - Row not visible"),l("Scroll Error - Row not visible")})}}class hk extends Ch{constructor(e){super(e)}renderRowCells(e,t){const i=document.createDocumentFragment();e.cells.forEach(n=>{i.appendChild(n.getElement())}),e.element.appendChild(i),t||e.cells.forEach(n=>{n.cellRendered()})}reinitializeColumnWidths(e){e.forEach(function(t){t.reinitializeWidth()})}}class uk extends Ch{constructor(e){super(e),this.leftCol=0,this.rightCol=0,this.scrollLeft=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0,this.fitDataColAvg=0,this.windowBuffer=200,this.visibleRows=null,this.initialized=!1,this.isFitData=!1,this.columns=[]}initialize(){this.compatibilityCheck(),this.layoutCheck(),this.vertScrollListen()}compatibilityCheck(){this.options("layout")=="fitDataTable"&&console.warn("Horizontal Virtual DOM is not compatible with fitDataTable layout mode"),this.options("responsiveLayout")&&console.warn("Horizontal Virtual DOM is not compatible with responsive columns"),this.options("rtl")&&console.warn("Horizontal Virtual DOM is not currently compatible with RTL text direction")}layoutCheck(){this.isFitData=this.options("layout").startsWith("fitData")}vertScrollListen(){this.subscribe("scroll-vertical",this.clearVisRowCache.bind(this)),this.subscribe("data-refreshed",this.clearVisRowCache.bind(this))}clearVisRowCache(){this.visibleRows=null}renderColumns(e,t){this.dataChange()}scrollColumns(e,t){this.scrollLeft!=e&&(this.scrollLeft=e,this.scroll(e-(this.vDomScrollPosLeft+this.windowBuffer)))}calcWindowBuffer(){var e=this.elementVertical.clientWidth;this.table.columnManager.columnsByIndex.forEach(t=>{if(t.visible){var i=t.getWidth();i>e&&(e=i)}}),this.windowBuffer=e*2}rerenderColumns(e,t){var i={cols:this.columns,leftCol:this.leftCol,rightCol:this.rightCol},n=0;e&&!this.initialized||(this.clear(),this.calcWindowBuffer(),this.scrollLeft=this.elementVertical.scrollLeft,this.vDomScrollPosLeft=this.scrollLeft-this.windowBuffer,this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,this.table.columnManager.columnsByIndex.forEach(s=>{var o={},a;s.visible&&(s.modules.frozen||(a=s.getWidth(),o.leftPos=n,o.rightPos=n+a,o.width=a,this.isFitData&&(o.fitDataCheck=s.modules.vdomHoz?s.modules.vdomHoz.fitDataCheck:!0),n+a>this.vDomScrollPosLeft&&n<this.vDomScrollPosRight?(this.leftCol==-1&&(this.leftCol=this.columns.length,this.vDomPadLeft=n),this.rightCol=this.columns.length):this.leftCol!==-1&&(this.vDomPadRight+=a),this.columns.push(s),s.modules.vdomHoz=o,n+=a))}),this.tableElement.style.paddingLeft=this.vDomPadLeft+"px",this.tableElement.style.paddingRight=this.vDomPadRight+"px",this.initialized=!0,t||(!e||this.reinitChanged(i))&&this.reinitializeRows(),this.elementVertical.scrollLeft=this.scrollLeft)}renderRowCells(e){if(this.initialized)this.initializeRow(e);else{const t=document.createDocumentFragment();e.cells.forEach(i=>{t.appendChild(i.getElement())}),e.element.appendChild(t),e.cells.forEach(i=>{i.cellRendered()})}}rerenderRowCells(e,t){this.reinitializeRow(e,t)}reinitializeColumnWidths(e){for(let t=this.leftCol;t<=this.rightCol;t++)this.columns[t].reinitializeWidth()}deinitialize(){this.initialized=!1}clear(){this.columns=[],this.leftCol=-1,this.rightCol=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0}dataChange(){var e=!1,t,i;if(this.isFitData){if(this.table.columnManager.columnsByIndex.forEach(n=>{!n.definition.width&&n.visible&&(e=!0)}),e&&this.table.rowManager.getDisplayRows().length&&(this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,t=this.chain("rows-sample",[1],[],()=>this.table.rowManager.getDisplayRows())[0],t)){i=t.getElement(),t.generateCells(),this.tableElement.appendChild(i);for(let n=0;n<t.cells.length;n++){let s=t.cells[n];i.appendChild(s.getElement()),s.column.reinitializeWidth()}i.parentNode.removeChild(i),this.rerenderColumns(!1,!0)}}else this.options("layout")==="fitColumns"&&(this.layoutRefresh(),this.rerenderColumns(!1,!0))}reinitChanged(e){var t=!0;return e.cols.length!==this.columns.length||e.leftCol!==this.leftCol||e.rightCol!==this.rightCol?!0:(e.cols.forEach((i,n)=>{i!==this.columns[n]&&(t=!1)}),!t)}reinitializeRows(){var e=this.getVisibleRows(),t=this.table.rowManager.getRows().filter(i=>!e.includes(i));e.forEach(i=>{this.reinitializeRow(i,!0)}),t.forEach(i=>{i.deinitialize()})}getVisibleRows(){return this.visibleRows||(this.visibleRows=this.table.rowManager.getVisibleRows()),this.visibleRows}scroll(e){this.vDomScrollPosLeft+=e,this.vDomScrollPosRight+=e,Math.abs(e)>this.windowBuffer/2?this.rerenderColumns():e>0?(this.addColRight(),this.removeColLeft()):(this.addColLeft(),this.removeColRight())}colPositionAdjust(e,t,i){for(let n=e;n<t;n++){let s=this.columns[n];s.modules.vdomHoz.leftPos+=i,s.modules.vdomHoz.rightPos+=i}}addColRight(){for(var e=!1,t=!0;t;){let i=this.columns[this.rightCol+1];i&&i.modules.vdomHoz.leftPos<=this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var s=n.getCell(i);n.getElement().insertBefore(s.getElement(),n.getCell(this.columns[this.rightCol]).getElement().nextSibling),s.cellRendered()}}),this.fitDataColActualWidthCheck(i),this.rightCol++,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.rightCol=this.rightCol)}),this.rightCol>=this.columns.length-1?this.vDomPadRight=0:this.vDomPadRight-=i.getWidth()):t=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}addColLeft(){for(var e=!1,t=!0;t;){let i=this.columns[this.leftCol-1];if(i)if(i.modules.vdomHoz.rightPos>=this.vDomScrollPosLeft){e=!0,this.getVisibleRows().forEach(s=>{if(s.type!=="group"){var o=s.getCell(i);s.getElement().insertBefore(o.getElement(),s.getCell(this.columns[this.leftCol]).getElement()),o.cellRendered()}}),this.leftCol--,this.getVisibleRows().forEach(s=>{s.type!=="group"&&(s.modules.vdomHoz.leftCol=this.leftCol)}),this.leftCol<=0?this.vDomPadLeft=0:this.vDomPadLeft-=i.getWidth();let n=this.fitDataColActualWidthCheck(i);n&&(this.scrollLeft=this.elementVertical.scrollLeft=this.elementVertical.scrollLeft+n,this.vDomPadRight-=n)}else t=!1;else t=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}removeColRight(){for(var e=!1,t=!0;t;){let i=this.columns[this.rightCol];i&&i.modules.vdomHoz.leftPos>this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var s=n.getCell(i);try{n.getElement().removeChild(s.getElement())}catch(o){console.warn("Could not removeColRight",o.message)}}}),this.vDomPadRight+=i.getWidth(),this.rightCol--,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.rightCol=this.rightCol)})):t=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}removeColLeft(){for(var e=!1,t=!0;t;){let i=this.columns[this.leftCol];i&&i.modules.vdomHoz.rightPos<this.vDomScrollPosLeft?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var s=n.getCell(i);try{n.getElement().removeChild(s.getElement())}catch(o){console.warn("Could not removeColLeft",o.message)}}}),this.vDomPadLeft+=i.getWidth(),this.leftCol++,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.leftCol=this.leftCol)})):t=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}fitDataColActualWidthCheck(e){var t,i;return e.modules.vdomHoz.fitDataCheck&&(e.reinitializeWidth(),t=e.getWidth(),i=t-e.modules.vdomHoz.width,i&&(e.modules.vdomHoz.rightPos+=i,e.modules.vdomHoz.width=t,this.colPositionAdjust(this.columns.indexOf(e)+1,this.columns.length,i)),e.modules.vdomHoz.fitDataCheck=!1),i}initializeRow(e){if(e.type!=="group"){e.modules.vdomHoz={leftCol:this.leftCol,rightCol:this.rightCol},this.table.modules.frozenColumns&&this.table.modules.frozenColumns.leftColumns.forEach(t=>{this.appendCell(e,t)});for(let t=this.leftCol;t<=this.rightCol;t++)this.appendCell(e,this.columns[t]);this.table.modules.frozenColumns&&this.table.modules.frozenColumns.rightColumns.forEach(t=>{this.appendCell(e,t)})}}appendCell(e,t){if(t&&t.visible){let i=e.getCell(t);e.getElement().appendChild(i.getElement()),i.cellRendered()}}reinitializeRow(e,t){if(e.type!=="group"&&(t||!e.modules.vdomHoz||e.modules.vdomHoz.leftCol!==this.leftCol||e.modules.vdomHoz.rightCol!==this.rightCol)){for(var i=e.getElement();i.firstChild;)i.removeChild(i.firstChild);this.initializeRow(e)}}}class ck extends It{constructor(e){super(e),this.blockHozScrollEvent=!1,this.headersElement=null,this.contentsElement=null,this.rowHeader=null,this.element=null,this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.scrollLeft=0,this.optionsList=new Nv(this.table,"column definition",vv),this.redrawBlock=!1,this.redrawBlockUpdate=null,this.renderer=null}initialize(){this.initializeRenderer(),this.headersElement=this.createHeadersElement(),this.contentsElement=this.createHeaderContentsElement(),this.element=this.createHeaderElement(),this.contentsElement.insertBefore(this.headersElement,this.contentsElement.firstChild),this.element.insertBefore(this.contentsElement,this.element.firstChild),this.initializeScrollWheelWatcher(),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("scrollbar-vertical",this.padVerticalScrollbar.bind(this))}padVerticalScrollbar(e){this.table.rtl?this.headersElement.style.marginLeft=e+"px":this.headersElement.style.marginRight=e+"px"}initializeRenderer(){var e,t={virtual:uk,basic:hk};typeof this.table.options.renderHorizontal=="string"?e=t[this.table.options.renderHorizontal]:e=this.table.options.renderHorizontal,e?(this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize()):console.error("Unable to find matching renderer:",this.table.options.renderHorizontal)}createHeadersElement(){var e=document.createElement("div");return e.classList.add("tabulator-headers"),e.setAttribute("role","row"),e}createHeaderContentsElement(){var e=document.createElement("div");return e.classList.add("tabulator-header-contents"),e.setAttribute("role","rowgroup"),e}createHeaderElement(){var e=document.createElement("div");return e.classList.add("tabulator-header"),e.setAttribute("role","rowgroup"),this.table.options.headerVisible||e.classList.add("tabulator-header-hidden"),e}getElement(){return this.element}getContentsElement(){return this.contentsElement}getHeadersElement(){return this.headersElement}scrollHorizontal(e){this.contentsElement.scrollLeft=e,this.scrollLeft=e,this.renderer.scrollColumns(e)}initializeScrollWheelWatcher(){this.contentsElement.addEventListener("wheel",e=>{var t;e.deltaX&&(t=this.contentsElement.scrollLeft+e.deltaX,this.table.rowManager.scrollHorizontal(t),this.table.columnManager.scrollHorizontal(t))})}generateColumnsFromRowData(e){var t=[],i={},n=this.table.options.autoColumns==="full"?e:[e[0]],s=this.table.options.autoColumnsDefinitions;if(e&&e.length){if(n.forEach(o=>{Object.keys(o).forEach((a,l)=>{let h=o[a],u;i[a]?i[a]!==!0&&typeof h<"u"&&(i[a].sorter=this.calculateSorterFromValue(h),i[a]=!0):(u={field:a,title:a,sorter:this.calculateSorterFromValue(h)},t.splice(l,0,u),i[a]=typeof h>"u"?u:!0)})}),s)switch(typeof s){case"function":this.table.options.columns=s.call(this.table,t);break;case"object":Array.isArray(s)?t.forEach(o=>{var a=s.find(l=>l.field===o.field);a&&Object.assign(o,a)}):t.forEach(o=>{s[o.field]&&Object.assign(o,s[o.field])}),this.table.options.columns=t;break}else this.table.options.columns=t;this.setColumns(this.table.options.columns)}}calculateSorterFromValue(e){var t;switch(typeof e){case"undefined":t="string";break;case"boolean":t="boolean";break;case"number":t="number";break;case"object":Array.isArray(e)?t="array":t="string";break;default:!isNaN(e)&&e!==""?t="number":e.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)?t="alphanum":t="string";break}return t}setColumns(e,t){for(;this.headersElement.firstChild;)this.headersElement.removeChild(this.headersElement.firstChild);this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.dispatch("columns-loading"),this.dispatchExternal("columnsLoading"),this.table.options.rowHeader&&(this.rowHeader=new Or(this.table.options.rowHeader===!0?{}:this.table.options.rowHeader,this,!0),this.columns.push(this.rowHeader),this.headersElement.appendChild(this.rowHeader.getElement()),this.rowHeader.columnRendered()),e.forEach((i,n)=>{this._addColumn(i)}),this._reIndexColumns(),this.dispatch("columns-loaded"),this.subscribedExternal("columnsLoaded")&&this.dispatchExternal("columnsLoaded",this.getComponents()),this.rerenderColumns(!1,!0),this.redraw(!0)}_addColumn(e,t,i){var n=new Or(e,this),s=n.getElement(),o=i&&this.findColumnIndex(i);if(t&&this.rowHeader&&(!i||i===this.rowHeader)&&(t=!1,i=this.rowHeader,o=0),i&&o>-1){var a=i.getTopColumn(),l=this.columns.indexOf(a),h=a.getElement();t?(this.columns.splice(l,0,n),h.parentNode.insertBefore(s,h)):(this.columns.splice(l+1,0,n),h.parentNode.insertBefore(s,h.nextSibling))}else t?(this.columns.unshift(n),this.headersElement.insertBefore(n.getElement(),this.headersElement.firstChild)):(this.columns.push(n),this.headersElement.appendChild(n.getElement()));return n.columnRendered(),n}registerColumnField(e){e.definition.field&&(this.columnsByField[e.definition.field]=e)}registerColumnPosition(e){this.columnsByIndex.push(e)}_reIndexColumns(){this.columnsByIndex=[],this.columns.forEach(function(e){e.reRegisterPosition()})}verticalAlignHeaders(){var e=0;this.redrawBlock||(this.headersElement.style.height="",this.columns.forEach(t=>{t.clearVerticalAlign()}),this.columns.forEach(t=>{var i=t.getHeight();i>e&&(e=i)}),this.headersElement.style.height=e+"px",this.columns.forEach(t=>{t.verticalAlign(this.table.options.columnHeaderVertAlign,e)}),this.table.rowManager.adjustTableSize())}findColumn(e){var t;if(typeof e=="object"){if(e instanceof Or)return e;if(e instanceof yv)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return t=[],this.columns.forEach(n=>{t.push(n),t=t.concat(n.getColumns(!0))}),t.find(n=>n.element===e)||!1}else return this.columnsByField[e]||!1;return!1}getColumnByField(e){return this.columnsByField[e]}getColumnsByFieldRoot(e){var t=[];return Object.keys(this.columnsByField).forEach(i=>{var n=this.table.options.nestedFieldSeparator?i.split(this.table.options.nestedFieldSeparator)[0]:i;n===e&&t.push(this.columnsByField[i])}),t}getColumnByIndex(e){return this.columnsByIndex[e]}getFirstVisibleColumn(){var e=this.columnsByIndex.findIndex(t=>t.visible);return e>-1?this.columnsByIndex[e]:!1}getVisibleColumnsByIndex(){return this.columnsByIndex.filter(e=>e.visible)}getColumns(){return this.columns}findColumnIndex(e){return this.columnsByIndex.findIndex(t=>e===t)}getRealColumns(){return this.columnsByIndex}traverse(e){this.columnsByIndex.forEach((t,i)=>{e(t,i)})}getDefinitions(e){var t=[];return this.columnsByIndex.forEach(i=>{(!e||e&&i.visible)&&t.push(i.getDefinition())}),t}getDefinitionTree(){var e=[];return this.columns.forEach(t=>{e.push(t.getDefinition(!0))}),e}getComponents(e){var t=[],i=e?this.columns:this.columnsByIndex;return i.forEach(n=>{t.push(n.getComponent())}),t}getWidth(){var e=0;return this.columnsByIndex.forEach(t=>{t.visible&&(e+=t.getWidth())}),e}moveColumn(e,t,i){t.element.parentNode.insertBefore(e.element,t.element),i&&t.element.parentNode.insertBefore(t.element,e.element),this.moveColumnActual(e,t,i),this.verticalAlignHeaders(),this.table.rowManager.reinitialize()}moveColumnActual(e,t,i){e.parent.isGroup?this._moveColumnInArray(e.parent.columns,e,t,i):this._moveColumnInArray(this.columns,e,t,i),this._moveColumnInArray(this.columnsByIndex,e,t,i,!0),this.rerenderColumns(!0),this.dispatch("column-moved",e,t,i),this.subscribedExternal("columnMoved")&&this.dispatchExternal("columnMoved",e.getComponent(),this.table.columnManager.getComponents())}_moveColumnInArray(e,t,i,n,s){var o=e.indexOf(t),a,l=[];o>-1&&(e.splice(o,1),a=e.indexOf(i),a>-1?n&&(a=a+1):a=o,e.splice(a,0,t),s&&(l=this.chain("column-moving-rows",[t,i,n],null,[])||[],l=l.concat(this.table.rowManager.rows),l.forEach(function(h){if(h.cells.length){var u=h.cells.splice(o,1)[0];h.cells.splice(a,0,u)}})))}scrollToColumn(e,t,i){var n=0,s=e.getLeftOffset(),o=0,a=e.getElement();return new Promise((l,h)=>{if(typeof t>"u"&&(t=this.table.options.scrollToColumnPosition),typeof i>"u"&&(i=this.table.options.scrollToColumnIfVisible),e.visible){switch(t){case"middle":case"center":o=-this.element.clientWidth/2;break;case"right":o=a.clientWidth-this.headersElement.clientWidth;break}if(!i&&s>0&&s+a.offsetWidth<this.element.clientWidth)return!1;n=s+o,n=Math.max(Math.min(n,this.table.rowManager.element.scrollWidth-this.table.rowManager.element.clientWidth),0),this.table.rowManager.scrollHorizontal(n),this.scrollHorizontal(n),l()}else console.warn("Scroll Error - Column not visible"),h("Scroll Error - Column not visible")})}generateCells(e){var t=[];return this.columnsByIndex.forEach(i=>{t.push(i.generateCell(e))}),t}getFlexBaseWidth(){var e=this.table.element.clientWidth,t=0;return this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(e-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),this.columnsByIndex.forEach(function(i){var n,s,o;i.visible&&(n=i.definition.width||0,s=parseInt(i.minWidth),typeof n=="string"?n.indexOf("%")>-1?o=e/100*parseInt(n):o=parseInt(n):o=n,t+=o>s?o:s)}),t}addColumn(e,t,i){return new Promise((n,s)=>{var o=this._addColumn(e,t,i);this._reIndexColumns(),this.dispatch("column-add",e,t,i),this.layoutMode()!="fitColumns"&&o.reinitializeWidth(),this.redraw(!0),this.table.rowManager.reinitialize(),this.rerenderColumns(),n(o)})}deregisterColumn(e){var t=e.getField(),i;t&&delete this.columnsByField[t],i=this.columnsByIndex.indexOf(e),i>-1&&this.columnsByIndex.splice(i,1),i=this.columns.indexOf(e),i>-1&&this.columns.splice(i,1),this.verticalAlignHeaders(),this.redraw()}rerenderColumns(e,t){this.redrawBlock?(e===!1||e===!0&&this.redrawBlockUpdate===null)&&(this.redrawBlockUpdate=e):this.renderer.rerenderColumns(e,t)}blockRedraw(){this.redrawBlock=!0,this.redrawBlockUpdate=null}restoreRedraw(){this.redrawBlock=!1,this.verticalAlignHeaders(),this.renderer.rerenderColumns(this.redrawBlockUpdate)}redraw(e){Ze.elVisible(this.element)&&this.verticalAlignHeaders(),e&&(this.table.rowManager.resetScroll(),this.table.rowManager.reinitialize()),this.confirm("table-redrawing",e)||this.layoutRefresh(e),this.dispatch("table-redraw",e),this.table.footerManager.redraw()}}class dk extends Ch{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.scrollTop=0,e.scrollLeft=0,e.style.minWidth="",e.style.minHeight="",e.style.display="",e.style.visibility=""}renderRows(){var e=this.tableElement,t=!0,i=document.createDocumentFragment(),n=this.rows();n.forEach((s,o)=>{this.styleRow(s,o),s.initialize(!1,!0),s.type!=="group"&&(t=!1),i.appendChild(s.getElement())}),e.appendChild(i),n.forEach(s=>{s.rendered(),s.heightInitialized||s.calcHeight(!0)}),n.forEach(s=>{s.heightInitialized||s.setCellHeight()}),t?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}rerenderRows(e){this.clearRows(),e&&e(),this.renderRows(),this.rows().length||this.table.rowManager.tableEmpty()}scrollToRowNearestTop(e){var t=Ze.elOffset(e.getElement()).top;return!(Math.abs(this.elementVertical.scrollTop-t)>Math.abs(this.elementVertical.scrollTop+this.elementVertical.clientHeight-t))}scrollToRow(e){var t=e.getElement();this.elementVertical.scrollTop=Ze.elOffset(t).top-Ze.elOffset(this.elementVertical).top+this.elementVertical.scrollTop}visibleRows(e){return this.rows()}}class fk extends Ch{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.vDomRowHeight=20,this.vDomTop=0,this.vDomBottom=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomMaxRenderChain=90,this.vDomWindowBuffer=0,this.vDomWindowMinTotalRows=20,this.vDomWindowMinMarginRows=5,this.vDomTopNewRows=[],this.vDomBottomNewRows=[]}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.style.paddingTop="",e.style.paddingBottom="",e.style.minHeight="",e.style.display="",e.style.visibility="",this.elementVertical.scrollTop=0,this.elementVertical.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0,this.vDomTop=0,this.vDomBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0}renderRows(){this._virtualRenderFill()}rerenderRows(e){for(var t=this.elementVertical.scrollTop,i=!1,n=!1,s=this.table.rowManager.scrollLeft,o=this.rows(),a=this.vDomTop;a<=this.vDomBottom;a++)if(o[a]){var l=t-o[a].getElement().offsetTop;if(n===!1||Math.abs(l)<n)n=l,i=a;else break}o.forEach(h=>{h.deinitializeHeight()}),e&&e(),this.rows().length?this._virtualRenderFill(i===!1?this.rows.length-1:i,!0,n||0):(this.clear(),this.table.rowManager.tableEmpty()),this.scrollColumns(s)}scrollColumns(e){this.table.rowManager.scrollHorizontal(e)}scrollRows(e,t){var i=e-this.vDomScrollPosTop,n=e-this.vDomScrollPosBottom,s=this.vDomWindowBuffer*2,o=this.rows();if(this.scrollTop=e,-i>s||n>s){var a=this.table.rowManager.scrollLeft;this._virtualRenderFill(Math.floor(this.elementVertical.scrollTop/this.elementVertical.scrollHeight*o.length)),this.scrollColumns(a)}else t?(i<0&&this._addTopRow(o,-i),n<0&&(this.vDomScrollHeight-this.scrollTop>this.vDomWindowBuffer?this._removeBottomRow(o,-n):this.vDomScrollPosBottom=this.scrollTop)):(n>=0&&this._addBottomRow(o,n),i>=0&&(this.scrollTop>this.vDomWindowBuffer?this._removeTopRow(o,i):this.vDomScrollPosTop=this.scrollTop))}resize(){this.vDomWindowBuffer=this.table.options.renderVerticalBuffer||this.elementVertical.clientHeight}scrollToRowNearestTop(e){var t=this.rows().indexOf(e);return!(Math.abs(this.vDomTop-t)>Math.abs(this.vDomBottom-t))}scrollToRow(e){var t=this.rows().indexOf(e);t>-1&&this._virtualRenderFill(t,!0)}visibleRows(e){var t=this.elementVertical.scrollTop,i=this.elementVertical.clientHeight+t,n=!1,s=0,o=0,a=this.rows();if(e)s=this.vDomTop,o=this.vDomBottom;else for(var l=this.vDomTop;l<=this.vDomBottom;l++)if(a[l])if(n)if(i-a[l].getElement().offsetTop>=0)o=l;else break;else if(t-a[l].getElement().offsetTop>=0)s=l;else if(n=!0,i-a[l].getElement().offsetTop>=0)o=l;else break;return a.slice(s,o+1)}_virtualRenderFill(e,t,i){var n=this.tableElement,s=this.elementVertical,o=0,a=0,l=0,h=0,u=0,c=0,d=this.rows(),f=d.length,g=0,m,w,y=[],E=0,x=0,v=this.table.rowManager.fixedHeight,S=this.elementVertical.clientHeight,R=this.table.options.rowHeight,L=!0;if(e=e||0,i=i||0,!e)this.clear();else{for(;n.firstChild;)n.removeChild(n.firstChild);h=(f-e+1)*this.vDomRowHeight,h<S&&(e-=Math.ceil((S-h)/this.vDomRowHeight),e<0&&(e=0)),o=Math.min(Math.max(Math.floor(this.vDomWindowBuffer/this.vDomRowHeight),this.vDomWindowMinMarginRows),e),e-=o}if(f&&Ze.elVisible(this.elementVertical)){for(this.vDomTop=e,this.vDomBottom=e-1,v||this.table.options.maxHeight?(R&&(x=S/R+this.vDomWindowBuffer/R),x=Math.max(this.vDomWindowMinTotalRows,Math.ceil(x))):x=f;(x==f||a<=S+this.vDomWindowBuffer||E<this.vDomWindowMinTotalRows)&&this.vDomBottom<f-1;){for(y=[],w=document.createDocumentFragment(),c=0;c<x&&this.vDomBottom<f-1;)g=this.vDomBottom+1,m=d[g],this.styleRow(m,g),m.initialize(!1,!0),!m.heightInitialized&&!this.table.options.rowHeight&&m.clearCellHeight(),w.appendChild(m.getElement()),y.push(m),this.vDomBottom++,c++;if(!y.length)break;n.appendChild(w),y.forEach(C=>{C.rendered(),C.heightInitialized||C.calcHeight(!0)}),y.forEach(C=>{C.heightInitialized||C.setCellHeight()}),y.forEach(C=>{l=C.getHeight(),E<o?u+=l:a+=l,l>this.vDomWindowBuffer&&(this.vDomWindowBuffer=l*2),E++}),L=this.table.rowManager.adjustTableSize(),S=this.elementVertical.clientHeight,L&&(v||this.table.options.maxHeight)&&(R=a/E,x=Math.max(this.vDomWindowMinTotalRows,Math.ceil(S/R+this.vDomWindowBuffer/R)))}e?(this.vDomTopPad=t?this.vDomRowHeight*this.vDomTop+i:this.scrollTop-u,this.vDomBottomPad=this.vDomBottom==f-1?0:Math.max(this.vDomScrollHeight-this.vDomTopPad-a-u,0)):(this.vDomTopPad=0,this.vDomRowHeight=Math.floor((a+u)/E),this.vDomBottomPad=this.vDomRowHeight*(f-this.vDomBottom-1),this.vDomScrollHeight=u+a+this.vDomBottomPad-S),n.style.paddingTop=this.vDomTopPad+"px",n.style.paddingBottom=this.vDomBottomPad+"px",t&&(this.scrollTop=this.vDomTopPad+u+i-(this.elementVertical.scrollWidth>this.elementVertical.clientWidth?this.elementVertical.offsetHeight-S:0)),this.scrollTop=Math.min(this.scrollTop,this.elementVertical.scrollHeight-S),this.elementVertical.scrollWidth>this.elementVertical.clientWidth&&t&&(this.scrollTop+=this.elementVertical.offsetHeight-S),this.vDomScrollPosTop=this.scrollTop,this.vDomScrollPosBottom=this.scrollTop,s.scrollTop=this.scrollTop,this.dispatch("render-virtual-fill")}}_addTopRow(e,t){for(var i=this.tableElement,n=[],s=0,o=this.vDomTop-1,a=0,l=!0;l;)if(this.vDomTop){let h=e[o],u,c;h&&a<this.vDomMaxRenderChain?(u=h.getHeight()||this.vDomRowHeight,c=h.initialized,t>=u?(this.styleRow(h,o),i.insertBefore(h.getElement(),i.firstChild),(!h.initialized||!h.heightInitialized)&&n.push(h),h.initialize(),c||(u=h.getElement().offsetHeight,u>this.vDomWindowBuffer&&(this.vDomWindowBuffer=u*2)),t-=u,s+=u,this.vDomTop--,o--,a++):l=!1):l=!1}else l=!1;for(let h of n)h.clearCellHeight();this._quickNormalizeRowHeight(n),s&&(this.vDomTopPad-=s,this.vDomTopPad<0&&(this.vDomTopPad=o*this.vDomRowHeight),o<1&&(this.vDomTopPad=0),i.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop-=s)}_removeTopRow(e,t){for(var i=[],n=0,s=0,o=!0;o;){let a=e[this.vDomTop],l;a&&s<this.vDomMaxRenderChain?(l=a.getHeight()||this.vDomRowHeight,t>=l?(this.vDomTop++,t-=l,n+=l,i.push(a),s++):o=!1):o=!1}for(let a of i){let l=a.getElement();l.parentNode&&l.parentNode.removeChild(l)}n&&(this.vDomTopPad+=n,this.tableElement.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop+=this.vDomTop?n:n+this.vDomWindowBuffer)}_addBottomRow(e,t){for(var i=this.tableElement,n=[],s=0,o=this.vDomBottom+1,a=0,l=!0;l;){let h=e[o],u,c;h&&a<this.vDomMaxRenderChain?(u=h.getHeight()||this.vDomRowHeight,c=h.initialized,t>=u?(this.styleRow(h,o),i.appendChild(h.getElement()),(!h.initialized||!h.heightInitialized)&&n.push(h),h.initialize(),c||(u=h.getElement().offsetHeight,u>this.vDomWindowBuffer&&(this.vDomWindowBuffer=u*2)),t-=u,s+=u,this.vDomBottom++,o++,a++):l=!1):l=!1}for(let h of n)h.clearCellHeight();this._quickNormalizeRowHeight(n),s&&(this.vDomBottomPad-=s,(this.vDomBottomPad<0||o==e.length-1)&&(this.vDomBottomPad=0),i.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom+=s)}_removeBottomRow(e,t){for(var i=[],n=0,s=0,o=!0;o;){let a=e[this.vDomBottom],l;a&&s<this.vDomMaxRenderChain?(l=a.getHeight()||this.vDomRowHeight,t>=l?(this.vDomBottom--,t-=l,n+=l,i.push(a),s++):o=!1):o=!1}for(let a of i){let l=a.getElement();l.parentNode&&l.parentNode.removeChild(l)}n&&(this.vDomBottomPad+=n,this.vDomBottomPad<0&&(this.vDomBottomPad=0),this.tableElement.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom-=n)}_quickNormalizeRowHeight(e){for(let t of e)t.calcHeight();for(let t of e)t.setCellHeight()}}class gk extends It{constructor(e){super(e),this.element=this.createHolderElement(),this.tableElement=this.createTableElement(),this.heightFixer=this.createTableElement(),this.placeholder=null,this.placeholderContents=null,this.firstRender=!1,this.renderMode="virtual",this.fixedHeight=!1,this.rows=[],this.activeRowsPipeline=[],this.activeRows=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0,this.scrollTop=0,this.scrollLeft=0,this.redrawBlock=!1,this.redrawBlockRestoreConfig=!1,this.redrawBlockRenderInPosition=!1,this.dataPipeline=[],this.displayPipeline=[],this.scrollbarWidth=0,this.renderer=null}createHolderElement(){var e=document.createElement("div");return e.classList.add("tabulator-tableholder"),e.setAttribute("tabindex",0),e}createTableElement(){var e=document.createElement("div");return e.classList.add("tabulator-table"),e.setAttribute("role","rowgroup"),e}initializePlaceholder(){var e=this.table.options.placeholder;if(typeof e=="function"&&(e=e.call(this.table)),e=this.chain("placeholder",[e],e,e)||e,e){let t=document.createElement("div");if(t.classList.add("tabulator-placeholder"),typeof e=="string"){let i=document.createElement("div");i.classList.add("tabulator-placeholder-contents"),i.innerHTML=e,t.appendChild(i),this.placeholderContents=i}else typeof HTMLElement<"u"&&e instanceof HTMLElement?(t.appendChild(e),this.placeholderContents=e):(console.warn("Invalid placeholder provided, must be string or HTML Element",e),this.el=null);this.placeholder=t}}getElement(){return this.element}getTableElement(){return this.tableElement}initialize(){this.initializePlaceholder(),this.initializeRenderer(),this.element.appendChild(this.tableElement),this.firstRender=!0,this.element.addEventListener("scroll",()=>{var e=this.element.scrollLeft,t=this.scrollLeft>e,i=this.element.scrollTop,n=this.scrollTop>i;this.scrollLeft!=e&&(this.scrollLeft=e,this.dispatch("scroll-horizontal",e,t),this.dispatchExternal("scrollHorizontal",e,t),this._positionPlaceholder()),this.scrollTop!=i&&(this.scrollTop=i,this.renderer.scrollRows(i,n),this.dispatch("scroll-vertical",i,n),this.dispatchExternal("scrollVertical",i,n))})}findRow(e){if(typeof e=="object"){if(e instanceof kt)return e;if(e instanceof Eh)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return this.rows.find(i=>i.getElement()===e)||!1;if(e===null)return!1}else return typeof e>"u"?!1:this.rows.find(i=>i.data[this.table.options.index]==e)||!1;return!1}getRowFromDataObject(e){var t=this.rows.find(i=>i.data===e);return t||!1}getRowFromPosition(e){return this.getDisplayRows().find(t=>t.type==="row"&&t.getPosition()===e&&t.isDisplayed())}scrollToRow(e,t,i){return this.renderer.scrollToRowPosition(e,t,i)}setData(e,t,i){return new Promise((n,s)=>{t&&this.getDisplayRows().length?this.table.options.pagination?this._setDataActual(e,!0):this.reRenderInPosition(()=>{this._setDataActual(e)}):(this.table.options.autoColumns&&i&&this.table.initialized&&this.table.columnManager.generateColumnsFromRowData(e),this.resetScroll(),this._setDataActual(e)),n()})}_setDataActual(e,t){this.dispatchExternal("dataProcessing",e),this._wipeElements(),Array.isArray(e)?(this.dispatch("data-processing",e),e.forEach((i,n)=>{if(i&&typeof i=="object"){var s=new kt(i,this);this.rows.push(s)}else console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:",i)}),this.refreshActiveData(!1,!1,t),this.dispatch("data-processed",e),this.dispatchExternal("dataProcessed",e)):console.error(`Data Loading Error - Unable to process data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e)}_wipeElements(){this.dispatch("rows-wipe"),this.destroy(),this.adjustTableSize(),this.dispatch("rows-wiped")}destroy(){this.rows.forEach(e=>{e.wipe()}),this.rows=[],this.activeRows=[],this.activeRowsPipeline=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0}deleteRow(e,t){var i=this.rows.indexOf(e),n=this.activeRows.indexOf(e);n>-1&&this.activeRows.splice(n,1),i>-1&&this.rows.splice(i,1),this.setActiveRows(this.activeRows),this.displayRowIterator(s=>{var o=s.indexOf(e);o>-1&&s.splice(o,1)}),t||this.reRenderInPosition(),this.regenerateRowPositions(),this.dispatchExternal("rowDeleted",e.getComponent()),this.displayRowsCount||this.tableEmpty(),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.getData())}addRow(e,t,i,n){var s=this.addRowActual(e,t,i,n);return s}addRows(e,t,i,n){var s=[];return new Promise((o,a)=>{t=this.findAddRowPos(t),Array.isArray(e)||(e=[e]),(typeof i>"u"&&t||typeof i<"u"&&!t)&&e.reverse(),e.forEach((l,h)=>{var u=this.addRow(l,t,i,!0);s.push(u),this.dispatch("row-added",u,l,t,i)}),this.refreshActiveData(n?"displayPipeline":!1,!1,!0),this.regenerateRowPositions(),this.displayRowsCount&&this._clearPlaceholder(),o(s)})}findAddRowPos(e){return typeof e>"u"&&(e=this.table.options.addRowPos),e==="pos"&&(e=!0),e==="bottom"&&(e=!1),e}addRowActual(e,t,i,n){var s=e instanceof kt?e:new kt(e||{},this),o=this.findAddRowPos(t),a=-1,l,h;return i||(h=this.chain("row-adding-position",[s,o],null,{index:i,top:o}),i=h.index,o=h.top),typeof i<"u"&&(i=this.findRow(i)),i=this.chain("row-adding-index",[s,i,o],null,i),i&&(a=this.rows.indexOf(i)),i&&a>-1?(l=this.activeRows.indexOf(i),this.displayRowIterator(function(u){var c=u.indexOf(i);c>-1&&u.splice(o?c:c+1,0,s)}),l>-1&&this.activeRows.splice(o?l:l+1,0,s),this.rows.splice(o?a:a+1,0,s)):o?(this.displayRowIterator(function(u){u.unshift(s)}),this.activeRows.unshift(s),this.rows.unshift(s)):(this.displayRowIterator(function(u){u.push(s)}),this.activeRows.push(s),this.rows.push(s)),this.setActiveRows(this.activeRows),this.dispatchExternal("rowAdded",s.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),n||this.reRenderInPosition(),s}moveRow(e,t,i){this.dispatch("row-move",e,t,i),this.moveRowActual(e,t,i),this.regenerateRowPositions(),this.dispatch("row-moved",e,t,i),this.dispatchExternal("rowMoved",e.getComponent())}moveRowActual(e,t,i){this.moveRowInArray(this.rows,e,t,i),this.moveRowInArray(this.activeRows,e,t,i),this.displayRowIterator(n=>{this.moveRowInArray(n,e,t,i)}),this.dispatch("row-moving",e,t,i)}moveRowInArray(e,t,i,n){var s,o,a,l;if(t!==i&&(s=e.indexOf(t),s>-1&&(e.splice(s,1),o=e.indexOf(i),o>-1?n?e.splice(o+1,0,t):e.splice(o,0,t):e.splice(s,0,t)),e===this.getDisplayRows())){a=s<o?s:o,l=o>s?o:s+1;for(let h=a;h<=l;h++)e[h]&&this.styleRow(e[h],h)}}clearData(){this.setData([])}getRowIndex(e){return this.findRowIndex(e,this.rows)}getDisplayRowIndex(e){var t=this.getDisplayRows().indexOf(e);return t>-1?t:!1}nextDisplayRow(e,t){var i=this.getDisplayRowIndex(e),n=!1;return i!==!1&&i<this.displayRowsCount-1&&(n=this.getDisplayRows()[i+1]),n&&(!(n instanceof kt)||n.type!="row")?this.nextDisplayRow(n,t):n}prevDisplayRow(e,t){var i=this.getDisplayRowIndex(e),n=!1;return i&&(n=this.getDisplayRows()[i-1]),t&&n&&(!(n instanceof kt)||n.type!="row")?this.prevDisplayRow(n,t):n}findRowIndex(e,t){var i;return e=this.findRow(e),e&&(i=t.indexOf(e),i>-1)?i:!1}getData(e,t){var i=[],n=this.getRows(e);return n.forEach(function(s){s.type=="row"&&i.push(s.getData(t||"data"))}),i}getComponents(e){var t=[],i=this.getRows(e);return i.forEach(function(n){t.push(n.getComponent())}),t}getDataCount(e){var t=this.getRows(e);return t.length}scrollHorizontal(e){this.scrollLeft=e,this.element.scrollLeft=e,this.dispatch("scroll-horizontal",e)}registerDataPipelineHandler(e,t){typeof t<"u"?(this.dataPipeline.push({handler:e,priority:t}),this.dataPipeline.sort((i,n)=>i.priority-n.priority)):console.error("Data pipeline handlers must have a priority in order to be registered")}registerDisplayPipelineHandler(e,t){typeof t<"u"?(this.displayPipeline.push({handler:e,priority:t}),this.displayPipeline.sort((i,n)=>i.priority-n.priority)):console.error("Display pipeline handlers must have a priority in order to be registered")}refreshActiveData(e,t,i){var n=this.table,s="",o=0,a=["all","dataPipeline","display","displayPipeline","end"];if(!this.table.destroyed){if(typeof e=="function")if(o=this.dataPipeline.findIndex(l=>l.handler===e),o>-1)s="dataPipeline",t&&(o==this.dataPipeline.length-1?s="display":o++);else if(o=this.displayPipeline.findIndex(l=>l.handler===e),o>-1)s="displayPipeline",t&&(o==this.displayPipeline.length-1?s="end":o++);else{console.error("Unable to refresh data, invalid handler provided",e);return}else s=e||"all",o=0;if(this.redrawBlock){(!this.redrawBlockRestoreConfig||this.redrawBlockRestoreConfig&&(this.redrawBlockRestoreConfig.stage===s&&o<this.redrawBlockRestoreConfig.index||a.indexOf(s)<a.indexOf(this.redrawBlockRestoreConfig.stage)))&&(this.redrawBlockRestoreConfig={handler:e,skipStage:t,renderInPosition:i,stage:s,index:o});return}else Ze.elVisible(this.element)?i?this.reRenderInPosition(this.refreshPipelines.bind(this,e,s,o,i)):(this.refreshPipelines(e,s,o,i),e||this.table.columnManager.renderer.renderColumns(),this.renderTable(),n.options.layoutColumnsOnNewData&&this.table.columnManager.redraw(!0)):this.refreshPipelines(e,s,o,i),this.dispatch("data-refreshed")}}refreshPipelines(e,t,i,n){switch(this.dispatch("data-refreshing"),(!e||!this.activeRowsPipeline[0])&&(this.activeRowsPipeline[0]=this.rows.slice(0)),t){case"all":case"dataPipeline":for(let s=i;s<this.dataPipeline.length;s++){let o=this.dataPipeline[s].handler(this.activeRowsPipeline[s].slice(0));this.activeRowsPipeline[s+1]=o||this.activeRowsPipeline[s].slice(0)}this.setActiveRows(this.activeRowsPipeline[this.dataPipeline.length]);case"display":i=0,this.resetDisplayRows();case"displayPipeline":for(let s=i;s<this.displayPipeline.length;s++){let o=this.displayPipeline[s].handler((s?this.getDisplayRows(s-1):this.activeRows).slice(0),n);this.setDisplayRows(o||this.getDisplayRows(s-1).slice(0),s)}case"end":this.regenerateRowPositions()}this.getDisplayRows().length&&this._clearPlaceholder()}regenerateRowPositions(){var e=this.getDisplayRows(),t=1;e.forEach(i=>{i.type==="row"&&(i.setPosition(t),t++)})}setActiveRows(e){this.activeRows=this.activeRows=Object.assign([],e),this.activeRowsCount=this.activeRows.length}resetDisplayRows(){this.displayRows=[],this.displayRows.push(this.activeRows.slice(0)),this.displayRowsCount=this.displayRows[0].length}setDisplayRows(e,t){this.displayRows[t]=e,t==this.displayRows.length-1&&(this.displayRowsCount=this.displayRows[this.displayRows.length-1].length)}getDisplayRows(e){return typeof e>"u"?this.displayRows.length?this.displayRows[this.displayRows.length-1]:[]:this.displayRows[e]||[]}getVisibleRows(e,t){var i=Object.assign([],this.renderer.visibleRows(!t));return e&&(i=this.chain("rows-visible",[t],i,i)),i}displayRowIterator(e){this.activeRowsPipeline.forEach(e),this.displayRows.forEach(e),this.displayRowsCount=this.displayRows[this.displayRows.length-1].length}getRows(e){var t=[];switch(e){case"active":t=this.activeRows;break;case"display":t=this.table.rowManager.getDisplayRows();break;case"visible":t=this.getVisibleRows(!1,!0);break;default:t=this.chain("rows-retrieve",e,null,this.rows)||this.rows}return t}reRenderInPosition(e){this.redrawBlock?e?e():this.redrawBlockRenderInPosition=!0:(this.dispatchExternal("renderStarted"),this.renderer.rerenderRows(e),this.fixedHeight||this.adjustTableSize(),this.scrollBarCheck(),this.dispatchExternal("renderComplete"))}scrollBarCheck(){var e=0;this.element.scrollHeight>this.element.clientHeight&&(e=this.element.offsetWidth-this.element.clientWidth),e!==this.scrollbarWidth&&(this.scrollbarWidth=e,this.dispatch("scrollbar-vertical",e))}initializeRenderer(){var e,t={virtual:fk,basic:dk};typeof this.table.options.renderVertical=="string"?e=t[this.table.options.renderVertical]:e=this.table.options.renderVertical,e?(this.renderMode=this.table.options.renderVertical,this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize(),(this.table.element.clientHeight||this.table.options.height)&&!(this.table.options.minHeight&&this.table.options.maxHeight)?this.fixedHeight=!0:this.fixedHeight=!1):console.error("Unable to find matching renderer:",this.table.options.renderVertical)}getRenderMode(){return this.renderMode}renderTable(){this.dispatchExternal("renderStarted"),this.element.scrollTop=0,this._clearTable(),this.displayRowsCount?(this.renderer.renderRows(),this.firstRender&&(this.firstRender=!1,this.fixedHeight||this.adjustTableSize(),this.layoutRefresh(!0))):this.renderEmptyScroll(),this.fixedHeight||this.adjustTableSize(),this.dispatch("table-layout"),this.displayRowsCount||this._showPlaceholder(),this.scrollBarCheck(),this.dispatchExternal("renderComplete")}renderEmptyScroll(){this.placeholder?this.tableElement.style.display="none":this.tableElement.style.minWidth=this.table.columnManager.getWidth()+"px"}_clearTable(){this._clearPlaceholder(),this.scrollTop=0,this.scrollLeft=0,this.renderer.clearRows()}tableEmpty(){this.renderEmptyScroll(),this._showPlaceholder()}checkPlaceholder(){this.displayRowsCount?this._clearPlaceholder():this.tableEmpty()}_showPlaceholder(){this.placeholder&&(this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.initializePlaceholder(),this.placeholder.setAttribute("tabulator-render-mode",this.renderMode),this.getElement().appendChild(this.placeholder),this._positionPlaceholder(),this.adjustTableSize())}_clearPlaceholder(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.tableElement.style.minWidth="",this.tableElement.style.display=""}_positionPlaceholder(){this.placeholder&&this.placeholder.parentNode&&(this.placeholder.style.width=this.table.columnManager.getWidth()+"px",this.placeholderContents.style.width=this.table.rowManager.element.clientWidth+"px",this.placeholderContents.style.marginLeft=this.scrollLeft+"px")}styleRow(e,t){var i=e.getElement();t%2?(i.classList.add("tabulator-row-even"),i.classList.remove("tabulator-row-odd")):(i.classList.add("tabulator-row-odd"),i.classList.remove("tabulator-row-even"))}normalizeHeight(){this.activeRows.forEach(function(e){e.normalizeHeight()})}adjustTableSize(){let e=this.element.clientHeight,t,i=!1;if(this.renderer.verticalFillMode==="fill"){let n=Math.floor(this.table.columnManager.getElement().getBoundingClientRect().height+(this.table.footerManager&&this.table.footerManager.active&&!this.table.footerManager.external?this.table.footerManager.getElement().getBoundingClientRect().height:0));if(this.fixedHeight){t=isNaN(this.table.options.minHeight)?this.table.options.minHeight:this.table.options.minHeight+"px";const s="calc(100% - "+n+"px)";this.element.style.minHeight=t||"calc(100% - "+n+"px)",this.element.style.height=s,this.element.style.maxHeight=s}else this.element.style.height="",this.element.style.height=this.table.element.clientHeight-n+"px",this.element.scrollTop=this.scrollTop;this.renderer.resize(),!this.fixedHeight&&e!=this.element.clientHeight&&(i=!0,this.subscribed("table-resize")?this.dispatch("table-resize"):this.redraw()),this.scrollBarCheck()}return this._positionPlaceholder(),i}reinitialize(){this.rows.forEach(function(e){e.reinitialize(!0)})}blockRedraw(){this.redrawBlock=!0,this.redrawBlockRestoreConfig=!1}restoreRedraw(){this.redrawBlock=!1,this.redrawBlockRestoreConfig?(this.refreshActiveData(this.redrawBlockRestoreConfig.handler,this.redrawBlockRestoreConfig.skipStage,this.redrawBlockRestoreConfig.renderInPosition),this.redrawBlockRestoreConfig=!1):this.redrawBlockRenderInPosition&&this.reRenderInPosition(),this.redrawBlockRenderInPosition=!1}redraw(e){this.adjustTableSize(),this.table.tableWidth=this.table.element.clientWidth,e?this.renderTable():(this.reRenderInPosition(),this.scrollHorizontal(this.scrollLeft))}resetScroll(){if(this.element.scrollLeft=0,this.element.scrollTop=0,this.table.browser==="ie"){var e=document.createEvent("Event");e.initEvent("scroll",!1,!0),this.element.dispatchEvent(e)}else this.element.dispatchEvent(new Event("scroll"))}}class pk extends It{constructor(e){super(e),this.active=!1,this.element=this.createElement(),this.containerElement=this.createContainerElement(),this.external=!1}initialize(){this.initializeElement()}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer"),e}createContainerElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer-contents"),this.element.appendChild(e),e}initializeElement(){if(this.table.options.footerElement)switch(typeof this.table.options.footerElement){case"string":this.table.options.footerElement[0]==="<"?this.containerElement.innerHTML=this.table.options.footerElement:(this.external=!0,this.containerElement=document.querySelector(this.table.options.footerElement));break;default:this.element=this.table.options.footerElement;break}}getElement(){return this.element}append(e){this.activate(),this.containerElement.appendChild(e),this.table.rowManager.adjustTableSize()}prepend(e){this.activate(),this.element.insertBefore(e,this.element.firstChild),this.table.rowManager.adjustTableSize()}remove(e){e.parentNode.removeChild(e),this.deactivate()}deactivate(e){(!this.element.firstChild||e)&&(this.external||this.element.parentNode.removeChild(this.element),this.active=!1)}activate(){this.active||(this.active=!0,this.external||(this.table.element.appendChild(this.getElement()),this.table.element.style.display=""))}redraw(){this.dispatch("footer-redraw")}}class mk extends It{constructor(e){super(e),this.el=null,this.abortClasses=["tabulator-headers","tabulator-table"],this.previousTargets={},this.listeners=["click","dblclick","contextmenu","mouseenter","mouseleave","mouseover","mouseout","mousemove","mouseup","mousedown","touchstart","touchend"],this.componentMap={"tabulator-cell":"cell","tabulator-row":"row","tabulator-group":"group","tabulator-col":"column"},this.pseudoTrackers={row:{subscriber:null,target:null},cell:{subscriber:null,target:null},group:{subscriber:null,target:null},column:{subscriber:null,target:null}},this.pseudoTracking=!1}initialize(){this.el=this.table.element,this.buildListenerMap(),this.bindSubscriptionWatchers()}buildListenerMap(){var e={};this.listeners.forEach(t=>{e[t]={handler:null,components:[]}}),this.listeners=e}bindPseudoEvents(){Object.keys(this.pseudoTrackers).forEach(e=>{this.pseudoTrackers[e].subscriber=this.pseudoMouseEnter.bind(this,e),this.subscribe(e+"-mouseover",this.pseudoTrackers[e].subscriber)}),this.pseudoTracking=!0}pseudoMouseEnter(e,t,i){this.pseudoTrackers[e].target!==i&&(this.pseudoTrackers[e].target&&this.dispatch(e+"-mouseleave",t,this.pseudoTrackers[e].target),this.pseudoMouseLeave(e,t),this.pseudoTrackers[e].target=i,this.dispatch(e+"-mouseenter",t,i))}pseudoMouseLeave(e,t){var i=Object.keys(this.pseudoTrackers),n={row:["cell"],cell:["row"]};i=i.filter(s=>{var o=n[e];return s!==e&&(!o||o&&!o.includes(s))}),i.forEach(s=>{var o=this.pseudoTrackers[s].target;this.pseudoTrackers[s].target&&(this.dispatch(s+"-mouseleave",t,o),this.pseudoTrackers[s].target=null)})}bindSubscriptionWatchers(){var e=Object.keys(this.listeners),t=Object.values(this.componentMap);for(let i of t)for(let n of e){let s=i+"-"+n;this.subscriptionChange(s,this.subscriptionChanged.bind(this,i,n))}this.subscribe("table-destroy",this.clearWatchers.bind(this))}subscriptionChanged(e,t,i){var n=this.listeners[t].components,s=n.indexOf(e),o=!1;i?s===-1&&(n.push(e),o=!0):this.subscribed(e+"-"+t)||s>-1&&(n.splice(s,1),o=!0),(t==="mouseenter"||t==="mouseleave")&&!this.pseudoTracking&&this.bindPseudoEvents(),o&&this.updateEventListeners()}updateEventListeners(){for(let e in this.listeners){let t=this.listeners[e];t.components.length?t.handler||(t.handler=this.track.bind(this,e),this.el.addEventListener(e,t.handler)):t.handler&&(this.el.removeEventListener(e,t.handler),t.handler=null)}}track(e,t){var i=t.composedPath&&t.composedPath()||t.path,n=this.findTargets(i);n=this.bindComponents(e,n),this.triggerEvents(e,t,n),this.pseudoTracking&&(e=="mouseover"||e=="mouseleave")&&!Object.keys(n).length&&this.pseudoMouseLeave("none",t)}findTargets(e){var t={};let i=Object.keys(this.componentMap);for(let n of e){let s=n.classList?[...n.classList]:[];if(s.filter(l=>this.abortClasses.includes(l)).length)break;let a=s.filter(l=>i.includes(l));for(let l of a)t[this.componentMap[l]]||(t[this.componentMap[l]]=n)}return t.group&&t.group===t.row&&delete t.row,t}bindComponents(e,t){var i=Object.keys(t).reverse(),n=this.listeners[e],s={},o={};for(let a of i){let l,h=t[a],u=this.previousTargets[a];if(u&&u.target===h)l=u.component;else switch(a){case"row":case"group":(n.components.includes("row")||n.components.includes("cell")||n.components.includes("group"))&&(l=this.table.rowManager.getVisibleRows(!0).find(d=>d.getElement()===h),t.row&&t.row.parentNode&&t.row.parentNode.closest(".tabulator-row")&&(t[a]=!1));break;case"column":n.components.includes("column")&&(l=this.table.columnManager.findColumn(h));break;case"cell":n.components.includes("cell")&&(s.row instanceof kt?l=s.row.findCell(h):t.row&&console.warn("Event Target Lookup Error - The row this cell is attached to cannot be found, has the table been reinitialized without being destroyed first?"));break}l&&(s[a]=l,o[a]={target:h,component:l})}return this.previousTargets=o,s}triggerEvents(e,t,i){var n=this.listeners[e];for(let s in i)i[s]&&n.components.includes(s)&&this.dispatch(s+"-"+e,t,i[s])}clearWatchers(){for(let e in this.listeners){let t=this.listeners[e];t.handler&&(this.el.removeEventListener(e,t.handler),t.handler=null)}}}class bk{constructor(e){this.table=e,this.bindings={}}bind(e,t,i){this.bindings[e]||(this.bindings[e]={}),this.bindings[e][t]?console.warn("Unable to bind component handler, a matching function name is already bound",e,t,i):this.bindings[e][t]=i}handle(e,t,i){if(this.bindings[e]&&this.bindings[e][i]&&typeof this.bindings[e][i].bind=="function")return this.bindings[e][i].bind(null,t);i!=="then"&&typeof i=="string"&&!i.startsWith("_")&&this.table.options.debugInvalidComponentFuncs&&console.error("The "+e+" component does not have a "+i+" function, have you checked that you have the correct Tabulator module installed?")}}class yk extends It{constructor(e){super(e),this.requestOrder=0,this.loading=!1}initialize(){}load(e,t,i,n,s,o){var a=++this.requestOrder;if(this.table.destroyed)return Promise.resolve();if(this.dispatchExternal("dataLoading",e),e&&(e.indexOf("{")==0||e.indexOf("[")==0)&&(e=JSON.parse(e)),this.confirm("data-loading",[e,t,i,s])){this.loading=!0,s||this.alertLoader(),t=this.chain("data-params",[e,i,s],t||{},t||{}),t=this.mapParams(t,this.table.options.dataSendParams);var l=this.chain("data-load",[e,t,i,s],!1,Promise.resolve([]));return l.then(h=>{if(this.table.destroyed)console.warn("Data Load Response Blocked - Table has been destroyed");else{!Array.isArray(h)&&typeof h=="object"&&(h=this.mapParams(h,this.objectInvert(this.table.options.dataReceiveParams)));var u=this.chain("data-loaded",[h],null,h);a==this.requestOrder?(this.clearAlert(),u!==!1&&(this.dispatchExternal("dataLoaded",u),this.table.rowManager.setData(u,n,typeof o>"u"?!n:o))):console.warn("Data Load Response Blocked - An active data load request was blocked by an attempt to change table data while the request was being made")}}).catch(h=>{console.error("Data Load Error: ",h),this.dispatchExternal("dataLoadError",h),s||this.alertError(),setTimeout(()=>{this.clearAlert()},this.table.options.dataLoaderErrorTimeout)}).finally(()=>{this.loading=!1})}else return this.dispatchExternal("dataLoaded",e),e||(e=[]),this.table.rowManager.setData(e,n,typeof o>"u"?!n:o),Promise.resolve()}mapParams(e,t){var i={};for(let n in e)i[t.hasOwnProperty(n)?t[n]:n]=e[n];return i}objectInvert(e){var t={};for(let i in e)t[e[i]]=i;return t}blockActiveLoad(){this.requestOrder++}alertLoader(){var e=typeof this.table.options.dataLoader=="function"?this.table.options.dataLoader():this.table.options.dataLoader;e&&this.table.alertManager.alert(this.table.options.dataLoaderLoading||this.langText("data|loading"))}alertError(){this.table.alertManager.alert(this.table.options.dataLoaderError||this.langText("data|error"),"error")}clearAlert(){this.table.alertManager.clear()}}class vk{constructor(e,t,i){this.table=e,this.events={},this.optionsList=t||{},this.subscriptionNotifiers={},this.dispatch=i?this._debugDispatch.bind(this):this._dispatch.bind(this),this.debug=i}subscriptionChange(e,t){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(t),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t),this._notifySubscriptionChange(e,!0)}unsubscribe(e,t){var i;if(this.events[e])if(t)if(i=this.events[e].findIndex(n=>n===t),i>-1)this.events[e].splice(i,1);else{console.warn("Cannot remove event, no matching event found:",e,t);return}else delete this.events[e];else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_notifySubscriptionChange(e,t){var i=this.subscriptionNotifiers[e];i&&i.forEach(n=>{n(t)})}_dispatch(){var e=Array.from(arguments),t=e.shift(),i;return this.events[t]&&this.events[t].forEach((n,s)=>{let o=n.apply(this.table,e);s||(i=o)}),i}_debugDispatch(){var e=Array.from(arguments),t=e[0];return e[0]="ExternalEvent:"+e[0],(this.debug===!0||this.debug.includes(t))&&console.log(...e),this._dispatch(...arguments)}}class wk{constructor(e){this.events={},this.subscriptionNotifiers={},this.dispatch=e?this._debugDispatch.bind(this):this._dispatch.bind(this),this.chain=e?this._debugChain.bind(this):this._chain.bind(this),this.confirm=e?this._debugConfirm.bind(this):this._confirm.bind(this),this.debug=e}subscriptionChange(e,t){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(t),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,t,i=1e4){this.events[e]||(this.events[e]=[]),this.events[e].push({callback:t,priority:i}),this.events[e].sort((n,s)=>n.priority-s.priority),this._notifySubscriptionChange(e,!0)}unsubscribe(e,t){var i;if(this.events[e]){if(t)if(i=this.events[e].findIndex(n=>n.callback===t),i>-1)this.events[e].splice(i,1);else{console.warn("Cannot remove event, no matching event found:",e,t);return}}else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_chain(e,t,i,n){var s=i;return Array.isArray(t)||(t=[t]),this.subscribed(e)?(this.events[e].forEach((o,a)=>{s=o.callback.apply(this,t.concat([s]))}),s):typeof n=="function"?n():n}_confirm(e,t){var i=!1;return Array.isArray(t)||(t=[t]),this.subscribed(e)&&this.events[e].forEach((n,s)=>{n.callback.apply(this,t)&&(i=!0)}),i}_notifySubscriptionChange(e,t){var i=this.subscriptionNotifiers[e];i&&i.forEach(n=>{n(t)})}_dispatch(){var e=Array.from(arguments),t=e.shift();this.events[t]&&this.events[t].forEach(i=>{i.callback.apply(this,e)})}_debugDispatch(){var e=Array.from(arguments),t=e[0];return e[0]="InternalEvent:"+t,(this.debug===!0||this.debug.includes(t))&&console.log(...e),this._dispatch(...arguments)}_debugChain(){var e=Array.from(arguments),t=e[0];return e[0]="InternalEvent:"+t,(this.debug===!0||this.debug.includes(t))&&console.log(...e),this._chain(...arguments)}_debugConfirm(){var e=Array.from(arguments),t=e[0];return e[0]="InternalEvent:"+t,(this.debug===!0||this.debug.includes(t))&&console.log(...e),this._confirm(...arguments)}}class Ek extends It{constructor(e){super(e)}_warnUser(){this.options("debugDeprecation")&&console.warn(...arguments)}check(e,t,i){var n="";return typeof this.options(e)<"u"?(n="Deprecated Setup Option - Use of the %c"+e+"%c option is now deprecated",t?(n=n+", Please use the %c"+t+"%c option instead",this._warnUser(n,"font-weight: bold;","font-weight: normal;","font-weight: bold;","font-weight: normal;"),i&&(this.table.options[t]=this.table.options[e])):this._warnUser(n,"font-weight: bold;","font-weight: normal;"),!1):!0}checkMsg(e,t){return typeof this.options(e)<"u"?(this._warnUser("%cDeprecated Setup Option - Use of the %c"+e+" %c option is now deprecated, "+t,"font-weight: normal;","font-weight: bold;","font-weight: normal;"),!1):!0}msg(e){this._warnUser(e)}}function _k(r,e){e&&this.table.columnManager.renderer.reinitializeColumnWidths(r),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function $p(r,e){r.forEach(function(t){t.reinitializeWidth()}),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function Ck(r,e){var t=0,i=this.table.rowManager.element.clientWidth,n=0,s=!1;r.forEach((o,a)=>{o.widthFixed||o.reinitializeWidth(),(this.table.options.responsiveLayout?o.modules.responsive.visible:o.visible)&&(s=o),o.visible&&(t+=o.getWidth())}),s?(n=i-t+s.getWidth(),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&(s.setWidth(0),this.table.modules.responsiveLayout.update()),n>0?s.setWidth(n):s.reinitializeWidth()):this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function xk(r,e){var t=this.table.rowManager.element.getBoundingClientRect().width,i=0,n=0,s=0,o=0,a=[],l=[],h=0,u=0,c=0;function d(g){var m;return typeof g=="string"?g.indexOf("%")>-1?m=t/100*parseInt(g):m=parseInt(g):m=g,m}function f(g,m,w,y){var E=[],x=0,v=0,S=0,R=s,L=0,C=0,M=[];function D(k){return w*(k.column.definition.widthGrow||1)}function A(k){return d(k.width)-w*(k.column.definition.widthShrink||0)}return g.forEach(function(k,V){var I=y?A(k):D(k);k.column.minWidth>=I?E.push(k):k.column.maxWidth&&k.column.maxWidth<I?(k.width=k.column.maxWidth,m-=k.column.maxWidth,R-=y?k.column.definition.widthShrink||1:k.column.definition.widthGrow||1,R&&(w=Math.floor(m/R))):(M.push(k),C+=y?k.column.definition.widthShrink||1:k.column.definition.widthGrow||1)}),E.length?(E.forEach(function(k){x+=y?k.width-k.column.minWidth:k.column.minWidth,k.width=k.column.minWidth}),v=m-x,S=C?Math.floor(v/C):v,L=f(M,v,S,y)):(L=C?m-Math.floor(m/C)*C:m,M.forEach(function(k){k.width=y?A(k):D(k)})),L}this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update(),this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(t-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),r.forEach(function(g){var m,w,y;g.visible&&(m=g.definition.width,w=parseInt(g.minWidth),m?(y=d(m),i+=y>w?y:w,g.definition.widthShrink&&(l.push({column:g,width:y>w?y:w}),h+=g.definition.widthShrink)):(a.push({column:g,width:0}),s+=g.definition.widthGrow||1))}),n=t-i,o=Math.floor(n/s),c=f(a,n,o,!1),a.length&&c>0&&(a[a.length-1].width+=c),a.forEach(function(g){n-=g.width}),u=Math.abs(c)+n,u>0&&h&&(c=f(l,u,Math.floor(u/h),!0)),c&&l.length&&(l[l.length-1].width-=c),a.forEach(function(g){g.column.setWidth(g.width)}),l.forEach(function(g){g.column.setWidth(g.width)})}var Rk={fitData:_k,fitDataFill:$p,fitDataTable:$p,fitDataStretch:Ck,fitColumns:xk};const ps=class ps extends Le{constructor(e){super(e,"layout"),this.mode=null,this.registerTableOption("layout","fitData"),this.registerTableOption("layoutColumnsOnNewData",!1),this.registerColumnOption("widthGrow"),this.registerColumnOption("widthShrink")}initialize(){var e=this.table.options.layout;ps.modes[e]?this.mode=e:(console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : "+e),this.mode="fitData"),this.table.element.setAttribute("tabulator-layout",this.mode),this.subscribe("column-init",this.initializeColumn.bind(this))}initializeColumn(e){e.definition.widthGrow&&(e.definition.widthGrow=Number(e.definition.widthGrow)),e.definition.widthShrink&&(e.definition.widthShrink=Number(e.definition.widthShrink))}getMode(){return this.mode}layout(e){this.dispatch("layout-refreshing"),ps.modes[this.mode].call(this,this.table.columnManager.columnsByIndex,e),this.dispatch("layout-refreshed")}};K(ps,"moduleName","layout"),K(ps,"modes",Rk);let Tc=ps;var Sk={default:{groups:{item:"item",items:"items"},columns:{},data:{loading:"Loading",error:"Error"},pagination:{page_size:"Page Size",page_title:"Show Page",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page",all:"All",counter:{showing:"Showing",of:"of",rows:"rows",pages:"pages"}},headerFilters:{default:"filter column...",columns:{}}}};const Ro=class Ro extends Le{constructor(e){super(e),this.locale="default",this.lang=!1,this.bindings={},this.langList={},this.registerTableOption("locale",!1),this.registerTableOption("langs",{})}initialize(){this.langList=Ze.deepClone(Ro.langs),this.table.options.columnDefaults.headerFilterPlaceholder!==!1&&this.setHeaderFilterPlaceholder(this.table.options.columnDefaults.headerFilterPlaceholder);for(let e in this.table.options.langs)this.installLang(e,this.table.options.langs[e]);this.setLocale(this.table.options.locale),this.registerTableFunction("setLocale",this.setLocale.bind(this)),this.registerTableFunction("getLocale",this.getLocale.bind(this)),this.registerTableFunction("getLang",this.getLang.bind(this))}setHeaderFilterPlaceholder(e){this.langList.default.headerFilters.default=e}installLang(e,t){this.langList[e]?this._setLangProp(this.langList[e],t):this.langList[e]=t}_setLangProp(e,t){for(let i in t)e[i]&&typeof e[i]=="object"?this._setLangProp(e[i],t[i]):e[i]=t[i]}setLocale(e){e=e||"default";function t(i,n){for(var s in i)typeof i[s]=="object"?(n[s]||(n[s]={}),t(i[s],n[s])):n[s]=i[s]}if(e===!0&&navigator.language&&(e=navigator.language.toLowerCase()),e&&!this.langList[e]){let i=e.split("-")[0];this.langList[i]?(console.warn("Localization Error - Exact matching locale not found, using closest match: ",e,i),e=i):(console.warn("Localization Error - Matching locale not found, using default: ",e),e="default")}this.locale=e,this.lang=Ze.deepClone(this.langList.default||{}),e!="default"&&t(this.langList[e],this.lang),this.dispatchExternal("localized",this.locale,this.lang),this._executeBindings()}getLocale(e){return this.locale}getLang(e){return e?this.langList[e]:this.lang}getText(e,t){var i=t?e+"|"+t:e,n=i.split("|"),s=this._getLangElement(n,this.locale);return s||""}_getLangElement(e,t){var i=this.lang;return e.forEach(function(n){var s;i&&(s=i[n],typeof s<"u"?i=s:i=!1)}),i}bind(e,t){this.bindings[e]||(this.bindings[e]=[]),this.bindings[e].push(t),t(this.getText(e),this.lang)}_executeBindings(){for(let e in this.bindings)this.bindings[e].forEach(t=>{t(this.getText(e),this.lang)})}};K(Ro,"moduleName","localize"),K(Ro,"langs",Sk);let Mc=Ro;class zv extends Le{constructor(e){super(e)}initialize(){this.registerTableFunction("tableComms",this.receive.bind(this))}getConnections(e){var t=[],i;return i=this.table.constructor.registry.lookupTable(e),i.forEach(n=>{this.table!==n&&t.push(n)}),t}send(e,t,i,n){var s=this.getConnections(e);s.forEach(o=>{o.tableComms(this.table.element,t,i,n)}),!s.length&&e&&console.warn("Table Connection Error - No tables matching selector found",e)}receive(e,t,i,n){if(this.table.modExists(t))return this.table.modules[t].commsReceived(e,i,n);console.warn("Inter-table Comms Error - no such module:",t)}}K(zv,"moduleName","comms");var Tk=Object.freeze({__proto__:null,CommsModule:zv,LayoutModule:Tc,LocalizeModule:Mc});const ti=class ti{static findTable(e){var t=ti.registry.lookupTable(e,!0);return Array.isArray(t)&&!t.length?!1:t}};K(ti,"registry",{tables:[],register(e){ti.registry.tables.push(e)},deregister(e){var t=ti.registry.tables.indexOf(e);t>-1&&ti.registry.tables.splice(t,1)},lookupTable(e,t){var i=[],n,s;if(typeof e=="string"){if(n=document.querySelectorAll(e),n.length)for(var o=0;o<n.length;o++)s=ti.registry.matchElement(n[o]),s&&i.push(s)}else typeof HTMLElement<"u"&&e instanceof HTMLElement||e instanceof ti?(s=ti.registry.matchElement(e),s&&i.push(s)):Array.isArray(e)?e.forEach(function(a){i=i.concat(ti.registry.lookupTable(a))}):t||console.warn("Table Connection Error - Invalid Selector",e);return i},matchElement(e){return ti.registry.tables.find(function(t){return e instanceof ti?t===e:t.element===e})}});let Lc=ti;const Ve=class Ve extends Lc{constructor(){super()}static initializeModuleBinder(e){Ve.modulesRegistered||(Ve.modulesRegistered=!0,Ve._registerModules(Tk,!0),e&&Ve._registerModules(e))}static _extendModule(e,t,i){if(Ve.moduleBindings[e]){var n=Ve.moduleBindings[e][t];if(n)if(typeof i=="object")for(let s in i)n[s]=i[s];else console.warn("Module Error - Invalid value type, it must be an object");else console.warn("Module Error - property does not exist:",t)}else console.warn("Module Error - module does not exist:",e)}static _registerModules(e,t){var i=Object.values(e);t&&i.forEach(n=>{n.prototype.moduleCore=!0}),Ve._registerModule(i)}static _registerModule(e){Array.isArray(e)||(e=[e]),e.forEach(t=>{Ve._registerModuleBinding(t),Ve._registerModuleExtensions(t)})}static _registerModuleBinding(e){e.moduleName?Ve.moduleBindings[e.moduleName]=e:console.error("Unable to bind module, no moduleName defined",e.moduleName)}static _registerModuleExtensions(e){var t=e.moduleExtensions;if(e.moduleExtensions)for(let i in t){let n=t[i];if(Ve.moduleBindings[i])for(let s in n)Ve._extendModule(i,s,n[s]);else{Ve.moduleExtensions[i]||(Ve.moduleExtensions[i]={});for(let s in n)Ve.moduleExtensions[i][s]||(Ve.moduleExtensions[i][s]={}),Object.assign(Ve.moduleExtensions[i][s],n[s])}}Ve._extendModuleFromQueue(e)}static _extendModuleFromQueue(e){var t=Ve.moduleExtensions[e.moduleName];if(t)for(let i in t)Ve._extendModule(e.moduleName,i,t[i])}_bindModules(){var e=[],t=[],i=[];this.modules={};for(var n in Ve.moduleBindings){let s=Ve.moduleBindings[n],o=new s(this);this.modules[n]=o,s.prototype.moduleCore?this.modulesCore.push(o):s.moduleInitOrder?s.moduleInitOrder<0?e.push(o):t.push(o):i.push(o)}e.sort((s,o)=>s.moduleInitOrder>o.moduleInitOrder?1:-1),t.sort((s,o)=>s.moduleInitOrder>o.moduleInitOrder?1:-1),this.modulesRegular=e.concat(i.concat(t))}};K(Ve,"moduleBindings",{}),K(Ve,"moduleExtensions",{}),K(Ve,"modulesRegistered",!1),K(Ve,"defaultModules",!1);let Ac=Ve;class Mk extends It{constructor(e){super(e),this.element=this._createAlertElement(),this.msgElement=this._createMsgElement(),this.type=null,this.element.appendChild(this.msgElement)}_createAlertElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert"),e}_createMsgElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert-msg"),e.setAttribute("role","alert"),e}_typeClass(){return"tabulator-alert-state-"+this.type}alert(e,t="msg"){if(e){for(this.clear(),this.dispatch("alert-show",t),this.type=t;this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.add(this._typeClass()),typeof e=="function"&&(e=e()),e instanceof HTMLElement?this.msgElement.appendChild(e):this.msgElement.innerHTML=e,this.table.element.appendChild(this.element)}}clear(){this.dispatch("alert-hide",this.type),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.msgElement.classList.remove(this._typeClass())}}const vn=class vn extends Ac{static extendModule(){vn.initializeModuleBinder(),vn._extendModule(...arguments)}static registerModule(){vn.initializeModuleBinder(),vn._registerModule(...arguments)}constructor(e,t,i){super(),vn.initializeModuleBinder(i),this.options={},this.columnManager=null,this.rowManager=null,this.footerManager=null,this.alertManager=null,this.vdomHoz=null,this.externalEvents=null,this.eventBus=null,this.interactionMonitor=!1,this.browser="",this.browserSlow=!1,this.browserMobile=!1,this.rtl=!1,this.originalElement=null,this.componentFunctionBinder=new bk(this),this.dataLoader=!1,this.modules={},this.modulesCore=[],this.modulesRegular=[],this.deprecationAdvisor=new Ek(this),this.optionsList=new Nv(this,"table constructor"),this.initialized=!1,this.destroyed=!1,this.initializeElement(e)&&(this.initializeCoreSystems(t),setTimeout(()=>{this._create()})),this.constructor.registry.register(this)}initializeElement(e){return typeof HTMLElement<"u"&&e instanceof HTMLElement?(this.element=e,!0):typeof e=="string"?(this.element=document.querySelector(e),this.element?!0:(console.error("Tabulator Creation Error - no element found matching selector: ",e),!1)):(console.error("Tabulator Creation Error - Invalid element provided:",e),!1)}initializeCoreSystems(e){this.columnManager=new ck(this),this.rowManager=new gk(this),this.footerManager=new pk(this),this.dataLoader=new yk(this),this.alertManager=new Mk(this),this._bindModules(),this.options=this.optionsList.generate(vn.defaultOptions,e),this._clearObjectPointers(),this._mapDeprecatedFunctionality(),this.externalEvents=new vk(this,this.options,this.options.debugEventsExternal),this.eventBus=new wk(this.options.debugEventsInternal),this.interactionMonitor=new mk(this),this.dataLoader.initialize(),this.footerManager.initialize()}_mapDeprecatedFunctionality(){}_clearSelection(){this.element.classList.add("tabulator-block-select"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),this.element.classList.remove("tabulator-block-select")}_create(){this.externalEvents.dispatch("tableBuilding"),this.eventBus.dispatch("table-building"),this._rtlCheck(),this._buildElement(),this._initializeTable(),this.initialized=!0,this._loadInitialData().finally(()=>{this.eventBus.dispatch("table-initialized"),this.externalEvents.dispatch("tableBuilt")})}_rtlCheck(){var e=window.getComputedStyle(this.element);switch(this.options.textDirection){case"auto":if(e.direction!=="rtl")break;case"rtl":this.element.classList.add("tabulator-rtl"),this.rtl=!0;break;case"ltr":this.element.classList.add("tabulator-ltr");default:this.rtl=!1}}_clearObjectPointers(){this.options.columns=this.options.columns.slice(0),Array.isArray(this.options.data)&&!this.options.reactiveData&&(this.options.data=this.options.data.slice(0))}_buildElement(){var e=this.element,t=this.options,i;if(e.tagName==="TABLE"){this.originalElement=this.element,i=document.createElement("div");var n=e.attributes;for(var s in n)typeof n[s]=="object"&&i.setAttribute(n[s].name,n[s].value);e.parentNode.replaceChild(i,e),this.element=e=i}for(e.classList.add("tabulator"),e.setAttribute("role","grid");e.firstChild;)e.removeChild(e.firstChild);t.height&&(t.height=isNaN(t.height)?t.height:t.height+"px",e.style.height=t.height),t.minHeight!==!1&&(t.minHeight=isNaN(t.minHeight)?t.minHeight:t.minHeight+"px",e.style.minHeight=t.minHeight),t.maxHeight!==!1&&(t.maxHeight=isNaN(t.maxHeight)?t.maxHeight:t.maxHeight+"px",e.style.maxHeight=t.maxHeight)}_initializeTable(){var e=this.element,t=this.options;this.interactionMonitor.initialize(),this.columnManager.initialize(),this.rowManager.initialize(),this._detectBrowser(),this.modulesCore.forEach(i=>{i.initialize()}),e.appendChild(this.columnManager.getElement()),e.appendChild(this.rowManager.getElement()),t.footerElement&&this.footerManager.activate(),t.autoColumns&&t.data&&this.columnManager.generateColumnsFromRowData(this.options.data),this.modulesRegular.forEach(i=>{i.initialize()}),this.columnManager.setColumns(t.columns),this.eventBus.dispatch("table-built")}_loadInitialData(){return this.dataLoader.load(this.options.data).finally(()=>{this.columnManager.verticalAlignHeaders()})}destroy(){var e=this.element;for(this.destroyed=!0,this.constructor.registry.deregister(this),this.eventBus.dispatch("table-destroy"),this.rowManager.destroy();e.firstChild;)e.removeChild(e.firstChild);e.classList.remove("tabulator"),this.externalEvents.dispatch("tableDestroyed")}_detectBrowser(){var e=navigator.userAgent||navigator.vendor||window.opera;e.indexOf("Trident")>-1?(this.browser="ie",this.browserSlow=!0):e.indexOf("Edge")>-1?(this.browser="edge",this.browserSlow=!0):e.indexOf("Firefox")>-1?(this.browser="firefox",this.browserSlow=!1):e.indexOf("Mac OS")>-1?(this.browser="safari",this.browserSlow=!1):(this.browser="other",this.browserSlow=!1),this.browserMobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(e.slice(0,4))}initGuard(e,t){var i,n;return this.options.debugInitialization&&!this.initialized&&(e||(i=new Error().stack.split(`
`),n=i[0]=="Error"?i[2]:i[1],n[0]==" "?e=n.trim().split(" ")[1].split(".")[1]:e=n.trim().split("@")[0]),console.warn("Table Not Initialized - Calling the "+e+" function before the table is initialized may result in inconsistent behavior, Please wait for the `tableBuilt` event before calling this function."+(t?" "+t:""))),this.initialized}blockRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-blocking"),this.rowManager.blockRedraw(),this.columnManager.blockRedraw(),this.eventBus.dispatch("redraw-blocked")}restoreRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-restoring"),this.rowManager.restoreRedraw(),this.columnManager.restoreRedraw(),this.eventBus.dispatch("redraw-restored")}setData(e,t,i){return this.initGuard(!1,"To set initial data please use the 'data' property in the table constructor."),this.dataLoader.load(e,t,i,!1)}clearData(){this.initGuard(),this.dataLoader.blockActiveLoad(),this.rowManager.clearData()}getData(e){return this.rowManager.getData(e)}getDataCount(e){return this.rowManager.getDataCount(e)}replaceData(e,t,i){return this.initGuard(),this.dataLoader.load(e,t,i,!0,!0)}updateData(e){var t=0;return this.initGuard(),new Promise((i,n)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(s=>{var o=this.rowManager.findRow(s[this.options.index]);o?(t++,o.updateData(s).then(()=>{t--,t||i()}).catch(a=>{n("Update Error - Unable to update row",s,a)})):n("Update Error - Unable to find row",s)}):(console.warn("Update Error - No data provided"),n("Update Error - No data provided"))})}addData(e,t,i){return this.initGuard(),new Promise((n,s)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e?this.rowManager.addRows(e,t,i).then(o=>{var a=[];o.forEach(function(l){a.push(l.getComponent())}),n(a)}):(console.warn("Update Error - No data provided"),s("Update Error - No data provided"))})}updateOrAddData(e){var t=[],i=0;return this.initGuard(),new Promise((n,s)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(o=>{var a=this.rowManager.findRow(o[this.options.index]);i++,a?a.updateData(o).then(()=>{i--,t.push(a.getComponent()),i||n(t)}):this.rowManager.addRows(o).then(l=>{i--,t.push(l[0].getComponent()),i||n(t)})}):(console.warn("Update Error - No data provided"),s("Update Error - No data provided"))})}getRow(e){var t=this.rowManager.findRow(e);return t?t.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}getRowFromPosition(e){var t=this.rowManager.getRowFromPosition(e);return t?t.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}deleteRow(e){var t=[];this.initGuard(),Array.isArray(e)||(e=[e]);for(let i of e){let n=this.rowManager.findRow(i,!0);if(n)t.push(n);else return console.error("Delete Error - No matching row found:",i),Promise.reject("Delete Error - No matching row found")}return t.sort((i,n)=>this.rowManager.rows.indexOf(i)>this.rowManager.rows.indexOf(n)?1:-1),t.forEach(i=>{i.delete()}),this.rowManager.reRenderInPosition(),Promise.resolve()}addRow(e,t,i){return this.initGuard(),typeof e=="string"&&(e=JSON.parse(e)),this.rowManager.addRows(e,t,i,!0).then(n=>n[0].getComponent())}updateOrAddRow(e,t){var i=this.rowManager.findRow(e);return this.initGuard(),typeof t=="string"&&(t=JSON.parse(t)),i?i.updateData(t).then(()=>i.getComponent()):this.rowManager.addRows(t).then(n=>n[0].getComponent())}updateRow(e,t){var i=this.rowManager.findRow(e);return this.initGuard(),typeof t=="string"&&(t=JSON.parse(t)),i?i.updateData(t).then(()=>Promise.resolve(i.getComponent())):(console.warn("Update Error - No matching row found:",e),Promise.reject("Update Error - No matching row found"))}scrollToRow(e,t,i){var n=this.rowManager.findRow(e);return n?this.rowManager.scrollToRow(n,t,i):(console.warn("Scroll Error - No matching row found:",e),Promise.reject("Scroll Error - No matching row found"))}moveRow(e,t,i){var n=this.rowManager.findRow(e);this.initGuard(),n?n.moveToRow(t,i):console.warn("Move Error - No matching row found:",e)}getRows(e){return this.rowManager.getComponents(e)}getRowPosition(e){var t=this.rowManager.findRow(e);return t?t.getPosition():(console.warn("Position Error - No matching row found:",e),!1)}setColumns(e){this.initGuard(!1,"To set initial columns please use the 'columns' property in the table constructor"),this.columnManager.setColumns(e)}getColumns(e){return this.columnManager.getComponents(e)}getColumn(e){var t=this.columnManager.findColumn(e);return t?t.getComponent():(console.warn("Find Error - No matching column found:",e),!1)}getColumnDefinitions(){return this.columnManager.getDefinitionTree()}showColumn(e){var t=this.columnManager.findColumn(e);if(this.initGuard(),t)t.show();else return console.warn("Column Show Error - No matching column found:",e),!1}hideColumn(e){var t=this.columnManager.findColumn(e);if(this.initGuard(),t)t.hide();else return console.warn("Column Hide Error - No matching column found:",e),!1}toggleColumn(e){var t=this.columnManager.findColumn(e);if(this.initGuard(),t)t.visible?t.hide():t.show();else return console.warn("Column Visibility Toggle Error - No matching column found:",e),!1}addColumn(e,t,i){var n=this.columnManager.findColumn(i);return this.initGuard(),this.columnManager.addColumn(e,t,n).then(s=>s.getComponent())}deleteColumn(e){var t=this.columnManager.findColumn(e);return this.initGuard(),t?t.delete():(console.warn("Column Delete Error - No matching column found:",e),Promise.reject())}updateColumnDefinition(e,t){var i=this.columnManager.findColumn(e);return this.initGuard(),i?i.updateDefinition(t):(console.warn("Column Update Error - No matching column found:",e),Promise.reject())}moveColumn(e,t,i){var n=this.columnManager.findColumn(e),s=this.columnManager.findColumn(t);this.initGuard(),n?s?this.columnManager.moveColumn(n,s,i):console.warn("Move Error - No matching column found:",s):console.warn("Move Error - No matching column found:",e)}scrollToColumn(e,t,i){return new Promise((n,s)=>{var o=this.columnManager.findColumn(e);return o?this.columnManager.scrollToColumn(o,t,i):(console.warn("Scroll Error - No matching column found:",e),Promise.reject("Scroll Error - No matching column found"))})}redraw(e){this.initGuard(),this.columnManager.redraw(e),this.rowManager.redraw(e)}setHeight(e){this.options.height=isNaN(e)?e:e+"px",this.element.style.height=this.options.height,this.rowManager.initializeRenderer(),this.rowManager.redraw(!0)}on(e,t){this.externalEvents.subscribe(e,t)}off(e,t){this.externalEvents.unsubscribe(e,t)}dispatchEvent(){var e=Array.from(arguments);e.shift(),this.externalEvents.dispatch(...arguments)}alert(e,t){this.initGuard(),this.alertManager.alert(e,t)}clearAlert(){this.initGuard(),this.alertManager.clear()}modExists(e,t){return this.modules[e]?!0:(t&&console.error("Tabulator Module Not Installed: "+e),!1)}module(e){var t=this.modules[e];return t||console.error("Tabulator module not installed: "+e),t}};K(vn,"defaultOptions",lk);let Ic=vn;var so=Ic;class Lk extends so{static extendModule(){so.initializeModuleBinder(fu),so._extendModule(...arguments)}static registerModule(){so.initializeModuleBinder(fu),so._registerModule(...arguments)}constructor(e,t,i){super(e,t,fu)}}var J2=Lk;export{g2 as $,it as A,rn as B,Bd as C,Xi as D,Ee as E,qo as F,sr as G,ki as H,Lg as I,nn as J,wr as K,Kt as L,Je as M,bF as N,Vk as O,oa as P,uF as Q,th as R,vt as S,Po as T,P2 as U,i2 as V,A2 as W,I2 as X,mr as Y,Vs as Z,a2 as _,Ox as a,Bk as a$,DC as a0,Kk as a1,Jk as a2,Dg as a3,ci as a4,Vt as a5,Kp as a6,xe as a7,Za as a8,wu as a9,Ar as aA,Ks as aB,y2 as aC,R2 as aD,S2 as aE,_2 as aF,E2 as aG,x2 as aH,C2 as aI,w2 as aJ,v2 as aK,Vx as aL,na as aM,gO as aN,d2 as aO,en as aP,J2 as aQ,cd as aR,z2 as aS,we as aT,dw as aU,Pc as aV,Jv as aW,If as aX,kk as aY,zk as aZ,Hk as a_,Cn as aa,Hc as ab,kr as ac,ur as ad,hw as ae,Ok as af,oi as ag,Oe as ah,We as ai,Pk as aj,Hl as ak,jo as al,yu as am,K2 as an,rO as ao,j2 as ap,Y2 as aq,hE as ar,W2 as as,$2 as at,X2 as au,Z2 as av,U2 as aw,ht as ax,ta as ay,mt as az,PC as b,Us as b$,Gk as b0,e2 as b1,cg as b2,T2 as b3,$ as b4,Nk as b5,sa as b6,mw as b7,Fd as b8,eh as b9,kb as bA,ge as bB,Nt as bC,ic as bD,Nb as bE,Hd as bF,Bg as bG,kx as bH,Ur as bI,og as bJ,Ba as bK,Uk as bL,wE as bM,Wk as bN,nt as bO,Nr as bP,Ge as bQ,ih as bR,Ji as bS,Lt as bT,M_ as bU,ce as bV,tt as bW,ni as bX,gt as bY,In as bZ,Rn as b_,Af as ba,So as bb,Vl as bc,vr as bd,o2 as be,Xk as bf,Ae as bg,nd as bh,si as bi,Si as bj,$o as bk,cx as bl,He as bm,bi as bn,vb as bo,sh as bp,he as bq,ir as br,mu as bs,AF as bt,tv as bu,iv as bv,ws as bw,nv as bx,ia as by,Jo as bz,OC as c,BF as c$,Y as c0,fb as c1,db as c2,FF as c3,D2 as c4,M2 as c5,k2 as c6,B2 as c7,Ef as c8,Nl as c9,G2 as cA,L2 as cB,_n as cC,zl as cD,ZF as cE,KF as cF,hv as cG,ru as cH,O2 as cI,Dk as cJ,Ik as cK,f2 as cL,m2 as cM,qp as cN,s2 as cO,Hs as cP,tO as cQ,GC as cR,Qk as cS,Pe as cT,st as cU,mi as cV,eb as cW,lw as cX,uw as cY,ab as cZ,zF as c_,rw as ca,vf as cb,XF as cc,JF as cd,wf as ce,Bb as cf,u2 as cg,Nx as ch,l2 as ci,h2 as cj,yf as ck,Fx as cl,Dr as cm,la as cn,cE as co,N2 as cp,zm as cq,y_ as cr,mn as cs,pi as ct,p2 as cu,n2 as cv,cv as cw,Pi as cx,jr as cy,H2 as cz,Vn as d,lb as d0,r2 as d1,yE as d2,om as d3,V2 as d4,_s as d5,Ys as d6,Pd as d7,Yk as d8,cr as d9,Bm as da,To as e,pn as f,Fk as g,Ti as h,Ni as i,hg as j,dr as k,Bi as l,Pn as m,_b as n,$k as o,DE as p,kE as q,At as r,em as s,kl as t,Lr as u,qk as v,Fl as w,Ol as x,Dl as y,lr as z};
//# sourceMappingURL=lazy-CNpw-HpO.js.map
