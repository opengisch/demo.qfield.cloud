var q1=Object.defineProperty;var j1=(i,e,t)=>e in i?q1(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var v=(i,e,t)=>(j1(i,typeof e!="symbol"?e+"":e,t),t),Mc=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)};var Z=(i,e,t)=>(Mc(i,e,"read from private field"),t?t.call(i):e.get(i)),re=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},Ke=(i,e,t,n)=>(Mc(i,e,"write to private field"),n?n.call(i,t):e.set(i,t),t);var Cc=(i,e,t,n)=>({set _(s){Ke(i,e,s,t)},get _(){return Z(i,e,n)}}),le=(i,e,t)=>(Mc(i,e,"access private method"),t);import{g as Xm,t as Yo,a as Eg,G as W1,I as V1}from"./lazy-af36d162.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();function X1(i){i("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),i("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),i("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),i.WGS84=i["EPSG:4326"],i["EPSG:3785"]=i["EPSG:3857"],i.GOOGLE=i["EPSG:3857"],i["EPSG:900913"]=i["EPSG:3857"],i["EPSG:102113"]=i["EPSG:3857"]}var Gs=1,zs=2,Lr=3,Y1=4,vu=5,Mg=6378137,H1=6356752314e-3,Cg=.0066943799901413165,$o=484813681109536e-20,O=Math.PI/2,Z1=.16666666666666666,K1=.04722222222222222,J1=.022156084656084655,U=1e-10,St=.017453292519943295,an=57.29577951308232,De=Math.PI/4,Ho=Math.PI*2,rt=3.14159265359,ri={};ri.greenwich=0;ri.lisbon=-9.131906111111;ri.paris=2.337229166667;ri.bogota=-74.080916666667;ri.madrid=-3.687938888889;ri.rome=12.452333333333;ri.bern=7.439583333333;ri.jakarta=106.807719444444;ri.ferro=-17.666666666667;ri.brussels=4.367975;ri.stockholm=18.058277777778;ri.athens=23.7163375;ri.oslo=10.722916666667;const Q1={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var Sg=/[\s_\-\/\(\)]/g;function as(i,e){if(i[e])return i[e];for(var t=Object.keys(i),n=e.toLowerCase().replace(Sg,""),s=-1,r,o;++s<t.length;)if(r=t[s],o=r.toLowerCase().replace(Sg,""),o===n)return i[r]}function xu(i){var e={},t=i.split("+").map(function(a){return a.trim()}).filter(function(a){return a}).reduce(function(a,l){var h=l.split("=");return h.push(!0),a[h[0].toLowerCase()]=h[1],a},{}),n,s,r,o={proj:"projName",datum:"datumCode",rf:function(a){e.rf=parseFloat(a)},lat_0:function(a){e.lat0=a*St},lat_1:function(a){e.lat1=a*St},lat_2:function(a){e.lat2=a*St},lat_ts:function(a){e.lat_ts=a*St},lon_0:function(a){e.long0=a*St},lon_1:function(a){e.long1=a*St},lon_2:function(a){e.long2=a*St},alpha:function(a){e.alpha=parseFloat(a)*St},gamma:function(a){e.rectified_grid_angle=parseFloat(a)},lonc:function(a){e.longc=a*St},x_0:function(a){e.x0=parseFloat(a)},y_0:function(a){e.y0=parseFloat(a)},k_0:function(a){e.k0=parseFloat(a)},k:function(a){e.k0=parseFloat(a)},a:function(a){e.a=parseFloat(a)},b:function(a){e.b=parseFloat(a)},r_a:function(){e.R_A=!0},zone:function(a){e.zone=parseInt(a,10)},south:function(){e.utmSouth=!0},towgs84:function(a){e.datum_params=a.split(",").map(function(l){return parseFloat(l)})},to_meter:function(a){e.to_meter=parseFloat(a)},units:function(a){e.units=a;var l=as(Q1,a);l&&(e.to_meter=l.to_meter)},from_greenwich:function(a){e.from_greenwich=a*St},pm:function(a){var l=as(ri,a);e.from_greenwich=(l||parseFloat(a))*St},nadgrids:function(a){a==="@null"?e.datumCode="none":e.nadgrids=a},axis:function(a){var l="ewnsud";a.length===3&&l.indexOf(a.substr(0,1))!==-1&&l.indexOf(a.substr(1,1))!==-1&&l.indexOf(a.substr(2,1))!==-1&&(e.axis=a)},approx:function(){e.approx=!0}};for(n in t)s=t[n],n in o?(r=o[n],typeof r=="function"?r(s):e[r]=s):e[n]=s;return typeof e.datumCode=="string"&&e.datumCode!=="WGS84"&&(e.datumCode=e.datumCode.toLowerCase()),e}var Zo=1,Ym=2,Hm=3,Bl=4,Zm=5,wd=-1,ev=/\s/,tv=/[A-Za-z]/,iv=/[A-Za-z84_]/,Yh=/[,\]]/,Km=/[\d\.E\-\+]/;function Nn(i){if(typeof i!="string")throw new Error("not a string");this.text=i.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Zo}Nn.prototype.readCharicter=function(){var i=this.text[this.place++];if(this.state!==Bl)for(;ev.test(i);){if(this.place>=this.text.length)return;i=this.text[this.place++]}switch(this.state){case Zo:return this.neutral(i);case Ym:return this.keyword(i);case Bl:return this.quoted(i);case Zm:return this.afterquote(i);case Hm:return this.number(i);case wd:return}};Nn.prototype.afterquote=function(i){if(i==='"'){this.word+='"',this.state=Bl;return}if(Yh.test(i)){this.word=this.word.trim(),this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in afterquote yet, index '+this.place)};Nn.prototype.afterItem=function(i){if(i===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=Zo;return}if(i==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=Zo,this.currentObject=this.stack.pop(),this.currentObject||(this.state=wd);return}};Nn.prototype.number=function(i){if(Km.test(i)){this.word+=i;return}if(Yh.test(i)){this.word=parseFloat(this.word),this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in number yet, index '+this.place)};Nn.prototype.quoted=function(i){if(i==='"'){this.state=Zm;return}this.word+=i};Nn.prototype.keyword=function(i){if(iv.test(i)){this.word+=i;return}if(i==="["){var e=[];e.push(this.word),this.level++,this.root===null?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,this.state=Zo;return}if(Yh.test(i)){this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in keyword yet, index '+this.place)};Nn.prototype.neutral=function(i){if(tv.test(i)){this.word=i,this.state=Ym;return}if(i==='"'){this.word="",this.state=Bl;return}if(Km.test(i)){this.word=i,this.state=Hm;return}if(Yh.test(i)){this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in neutral yet, index '+this.place)};Nn.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===wd)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function nv(i){var e=new Nn(i);return e.output()}function Tg(i,e,t){Array.isArray(e)&&(t.unshift(e),e=null);var n=e?{}:i,s=t.reduce(function(r,o){return _r(o,r),r},n);e&&(i[e]=s)}function _r(i,e){if(!Array.isArray(i)){e[i]=!0;return}var t=i.shift();if(t==="PARAMETER"&&(t=i.shift()),i.length===1){if(Array.isArray(i[0])){e[t]={},_r(i[0],e[t]);return}e[t]=i[0];return}if(!i.length){e[t]=!0;return}if(t==="TOWGS84"){e[t]=i;return}if(t==="AXIS"){t in e||(e[t]=[]),e[t].push(i);return}Array.isArray(t)||(e[t]={});var n;switch(t){case"UNIT":case"PRIMEM":case"VERT_DATUM":e[t]={name:i[0].toLowerCase(),convert:i[1]},i.length===3&&_r(i[2],e[t]);return;case"SPHEROID":case"ELLIPSOID":e[t]={name:i[0],a:i[1],rf:i[2]},i.length===4&&_r(i[3],e[t]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":i[0]=["name",i[0]],Tg(e,t,i);return;default:for(n=-1;++n<i.length;)if(!Array.isArray(i[n]))return _r(i,e[t]);return Tg(e,t,i)}}var sv=.017453292519943295;function rv(i,e){var t=e[0],n=e[1];!(t in i)&&n in i&&(i[t]=i[n],e.length===3&&(i[t]=e[2](i[t])))}function Qi(i){return i*sv}function ov(i){if(i.type==="GEOGCS"?i.projName="longlat":i.type==="LOCAL_CS"?(i.projName="identity",i.local=!0):typeof i.PROJECTION=="object"?i.projName=Object.keys(i.PROJECTION)[0]:i.projName=i.PROJECTION,i.AXIS){for(var e="",t=0,n=i.AXIS.length;t<n;++t){var s=[i.AXIS[t][0].toLowerCase(),i.AXIS[t][1].toLowerCase()];s[0].indexOf("north")!==-1||(s[0]==="y"||s[0]==="lat")&&s[1]==="north"?e+="n":s[0].indexOf("south")!==-1||(s[0]==="y"||s[0]==="lat")&&s[1]==="south"?e+="s":s[0].indexOf("east")!==-1||(s[0]==="x"||s[0]==="lon")&&s[1]==="east"?e+="e":(s[0].indexOf("west")!==-1||(s[0]==="x"||s[0]==="lon")&&s[1]==="west")&&(e+="w")}e.length===2&&(e+="u"),e.length===3&&(i.axis=e)}i.UNIT&&(i.units=i.UNIT.name.toLowerCase(),i.units==="metre"&&(i.units="meter"),i.UNIT.convert&&(i.type==="GEOGCS"?i.DATUM&&i.DATUM.SPHEROID&&(i.to_meter=i.UNIT.convert*i.DATUM.SPHEROID.a):i.to_meter=i.UNIT.convert));var r=i.GEOGCS;i.type==="GEOGCS"&&(r=i),r&&(r.DATUM?i.datumCode=r.DATUM.name.toLowerCase():i.datumCode=r.name.toLowerCase(),i.datumCode.slice(0,2)==="d_"&&(i.datumCode=i.datumCode.slice(2)),(i.datumCode==="new_zealand_geodetic_datum_1949"||i.datumCode==="new_zealand_1949")&&(i.datumCode="nzgd49"),(i.datumCode==="wgs_1984"||i.datumCode==="world_geodetic_system_1984")&&(i.PROJECTION==="Mercator_Auxiliary_Sphere"&&(i.sphere=!0),i.datumCode="wgs84"),i.datumCode.slice(-6)==="_ferro"&&(i.datumCode=i.datumCode.slice(0,-6)),i.datumCode.slice(-8)==="_jakarta"&&(i.datumCode=i.datumCode.slice(0,-8)),~i.datumCode.indexOf("belge")&&(i.datumCode="rnb72"),r.DATUM&&r.DATUM.SPHEROID&&(i.ellps=r.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),i.ellps.toLowerCase().slice(0,13)==="international"&&(i.ellps="intl"),i.a=r.DATUM.SPHEROID.a,i.rf=parseFloat(r.DATUM.SPHEROID.rf,10)),r.DATUM&&r.DATUM.TOWGS84&&(i.datum_params=r.DATUM.TOWGS84),~i.datumCode.indexOf("osgb_1936")&&(i.datumCode="osgb36"),~i.datumCode.indexOf("osni_1952")&&(i.datumCode="osni52"),(~i.datumCode.indexOf("tm65")||~i.datumCode.indexOf("geodetic_datum_of_1965"))&&(i.datumCode="ire65"),i.datumCode==="ch1903+"&&(i.datumCode="ch1903"),~i.datumCode.indexOf("israel")&&(i.datumCode="isr93")),i.b&&!isFinite(i.b)&&(i.b=i.a);function o(h){var c=i.to_meter||1;return h*c}var a=function(h){return rv(i,h)},l=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Qi],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Qi],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",Qi],["lat0","latitude_of_origin",Qi],["lat0","standard_parallel_1",Qi],["lat1","standard_parallel_1",Qi],["lat2","standard_parallel_2",Qi],["azimuth","Azimuth"],["alpha","azimuth",Qi],["srsCode","name"]];l.forEach(a),!i.long0&&i.longc&&(i.projName==="Albers_Conic_Equal_Area"||i.projName==="Lambert_Azimuthal_Equal_Area")&&(i.long0=i.longc),!i.lat_ts&&i.lat1&&(i.projName==="Stereographic_South_Pole"||i.projName==="Polar Stereographic (variant B)")?(i.lat0=Qi(i.lat1>0?90:-90),i.lat_ts=i.lat1):!i.lat_ts&&i.lat0&&i.projName==="Polar_Stereographic"&&(i.lat_ts=i.lat0,i.lat0=Qi(i.lat0>0?90:-90))}function Jm(i){var e=nv(i),t=e.shift(),n=e.shift();e.unshift(["name",n]),e.unshift(["type",t]);var s={};return _r(e,s),ov(s),s}function qt(i){var e=this;if(arguments.length===2){var t=arguments[1];typeof t=="string"?t.charAt(0)==="+"?qt[i]=xu(arguments[1]):qt[i]=Jm(arguments[1]):qt[i]=t}else if(arguments.length===1){if(Array.isArray(i))return i.map(function(n){Array.isArray(n)?qt.apply(e,n):qt(n)});if(typeof i=="string"){if(i in qt)return qt[i]}else"EPSG"in i?qt["EPSG:"+i.EPSG]=i:"ESRI"in i?qt["ESRI:"+i.ESRI]=i:"IAU2000"in i?qt["IAU2000:"+i.IAU2000]=i:console.log(i);return}}X1(qt);function av(i){return typeof i=="string"}function lv(i){return i in qt}var hv=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function cv(i){return hv.some(function(e){return i.indexOf(e)>-1})}var uv=["3857","900913","3785","102113"];function dv(i){var e=as(i,"authority");if(e){var t=as(e,"epsg");return t&&uv.indexOf(t)>-1}}function fv(i){var e=as(i,"extension");if(e)return as(e,"proj4")}function gv(i){return i[0]==="+"}function pv(i){if(av(i)){if(lv(i))return qt[i];if(cv(i)){var e=Jm(i);if(dv(e))return qt["EPSG:3857"];var t=fv(e);return t?xu(t):e}if(gv(i))return xu(i)}else return i}function Rg(i,e){i=i||{};var t,n;if(!e)return i;for(n in e)t=e[n],t!==void 0&&(i[n]=t);return i}function pn(i,e,t){var n=i*e;return t/Math.sqrt(1-n*n)}function Ca(i){return i<0?-1:1}function j(i){return Math.abs(i)<=rt?i:i-Ca(i)*Ho}function Wi(i,e,t){var n=i*t,s=.5*i;return n=Math.pow((1-n)/(1+n),s),Math.tan(.5*(O-e))/n}function Ko(i,e){for(var t=.5*i,n,s,r=O-2*Math.atan(e),o=0;o<=15;o++)if(n=i*Math.sin(r),s=O-2*Math.atan(e*Math.pow((1-n)/(1+n),t))-r,r+=s,Math.abs(s)<=1e-10)return r;return-9999}function mv(){var i=this.b/this.a;this.es=1-i*i,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=pn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function yv(i){var e=i.x,t=i.y;if(t*an>90&&t*an<-90&&e*an>180&&e*an<-180)return null;var n,s;if(Math.abs(Math.abs(t)-O)<=U)return null;if(this.sphere)n=this.x0+this.a*this.k0*j(e-this.long0),s=this.y0+this.a*this.k0*Math.log(Math.tan(De+.5*t));else{var r=Math.sin(t),o=Wi(this.e,t,r);n=this.x0+this.a*this.k0*j(e-this.long0),s=this.y0-this.a*this.k0*Math.log(o)}return i.x=n,i.y=s,i}function _v(i){var e=i.x-this.x0,t=i.y-this.y0,n,s;if(this.sphere)s=O-2*Math.atan(Math.exp(-t/(this.a*this.k0)));else{var r=Math.exp(-t/(this.a*this.k0));if(s=Ko(this.e,r),s===-9999)return null}return n=j(this.long0+e/(this.a*this.k0)),i.x=n,i.y=s,i}var vv=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const xv={init:mv,forward:yv,inverse:_v,names:vv};function wv(){}function Ig(i){return i}var bv=["longlat","identity"];const Ev={init:wv,forward:Ig,inverse:Ig,names:bv};var Mv=[xv,Ev],Al={},$l=[];function Qm(i,e){var t=$l.length;return i.names?($l[t]=i,i.names.forEach(function(n){Al[n.toLowerCase()]=t}),this):(console.log(e),!0)}function Cv(i){if(!i)return!1;var e=i.toLowerCase();if(typeof Al[e]<"u"&&$l[Al[e]])return $l[Al[e]]}function Sv(){Mv.forEach(Qm)}const Tv={start:Sv,add:Qm,get:Cv};var ae={};ae.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};ae.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};ae.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};ae.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};ae.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};ae.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};ae.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};ae.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};ae.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};ae.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};ae.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};ae.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};ae.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};ae.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};ae.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};ae.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};ae.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};ae.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};ae.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};ae.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};ae.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};ae.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};ae.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};ae.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};ae.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};ae.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};ae.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};ae.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};ae.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};ae.hough={a:6378270,rf:297,ellipseName:"Hough"};ae.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};ae.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};ae.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};ae.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};ae.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};ae.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};ae.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};ae.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};ae.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};ae.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};ae.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};ae.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var Rv=ae.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};ae.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function Iv(i,e,t,n){var s=i*i,r=e*e,o=(s-r)/s,a=0;n?(i*=1-o*(Z1+o*(K1+o*J1)),s=i*i,o=0):a=Math.sqrt(o);var l=(s-r)/r;return{es:o,e:a,ep2:l}}function Lv(i,e,t,n,s){if(!i){var r=as(ae,n);r||(r=Rv),i=r.a,e=r.b,t=r.rf}return t&&!e&&(e=(1-1/t)*i),(t===0||Math.abs(i-e)<U)&&(s=!0,e=i),{a:i,b:e,rf:t,sphere:s}}var Et={};Et.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};Et.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};Et.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};Et.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};Et.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};Et.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};Et.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};Et.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};Et.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};Et.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};Et.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};Et.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};Et.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};Et.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};Et.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};Et.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};Et.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function Pv(i,e,t,n,s,r,o){var a={};return i===void 0||i==="none"?a.datum_type=vu:a.datum_type=Y1,e&&(a.datum_params=e.map(parseFloat),(a.datum_params[0]!==0||a.datum_params[1]!==0||a.datum_params[2]!==0)&&(a.datum_type=Gs),a.datum_params.length>3&&(a.datum_params[3]!==0||a.datum_params[4]!==0||a.datum_params[5]!==0||a.datum_params[6]!==0)&&(a.datum_type=zs,a.datum_params[3]*=$o,a.datum_params[4]*=$o,a.datum_params[5]*=$o,a.datum_params[6]=a.datum_params[6]/1e6+1)),o&&(a.datum_type=Lr,a.grids=o),a.a=t,a.b=n,a.es=s,a.ep2=r,a}var e0={};function Av(i,e){var t=new DataView(e),n=Ov(t),s=Nv(t,n),r=Dv(t,s,n),o={header:s,subgrids:r};return e0[i]=o,o}function Fv(i){if(i===void 0)return null;var e=i.split(",");return e.map(kv)}function kv(i){if(i.length===0)return null;var e=i[0]==="@";return e&&(i=i.slice(1)),i==="null"?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:i,mandatory:!e,grid:e0[i]||null,isNull:!1}}function vr(i){return i/3600*Math.PI/180}function Ov(i){var e=i.getInt32(8,!1);return e===11?!1:(e=i.getInt32(8,!0),e!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function Nv(i,e){return{nFields:i.getInt32(8,e),nSubgridFields:i.getInt32(24,e),nSubgrids:i.getInt32(40,e),shiftType:wu(i,56,56+8).trim(),fromSemiMajorAxis:i.getFloat64(120,e),fromSemiMinorAxis:i.getFloat64(136,e),toSemiMajorAxis:i.getFloat64(152,e),toSemiMinorAxis:i.getFloat64(168,e)}}function wu(i,e,t){return String.fromCharCode.apply(null,new Uint8Array(i.buffer.slice(e,t)))}function Dv(i,e,t){for(var n=176,s=[],r=0;r<e.nSubgrids;r++){var o=zv(i,n,t),a=Bv(i,n,o,t),l=Math.round(1+(o.upperLongitude-o.lowerLongitude)/o.longitudeInterval),h=Math.round(1+(o.upperLatitude-o.lowerLatitude)/o.latitudeInterval);s.push({ll:[vr(o.lowerLongitude),vr(o.lowerLatitude)],del:[vr(o.longitudeInterval),vr(o.latitudeInterval)],lim:[l,h],count:o.gridNodeCount,cvs:Gv(a)}),n+=176+o.gridNodeCount*16}return s}function Gv(i){return i.map(function(e){return[vr(e.longitudeShift),vr(e.latitudeShift)]})}function zv(i,e,t){return{name:wu(i,e+8,e+16).trim(),parent:wu(i,e+24,e+24+8).trim(),lowerLatitude:i.getFloat64(e+72,t),upperLatitude:i.getFloat64(e+88,t),lowerLongitude:i.getFloat64(e+104,t),upperLongitude:i.getFloat64(e+120,t),latitudeInterval:i.getFloat64(e+136,t),longitudeInterval:i.getFloat64(e+152,t),gridNodeCount:i.getInt32(e+168,t)}}function Bv(i,e,t,n){for(var s=e+176,r=16,o=[],a=0;a<t.gridNodeCount;a++){var l={latitudeShift:i.getFloat32(s+a*r,n),longitudeShift:i.getFloat32(s+a*r+4,n),latitudeAccuracy:i.getFloat32(s+a*r+8,n),longitudeAccuracy:i.getFloat32(s+a*r+12,n)};o.push(l)}return o}function cn(i,e){if(!(this instanceof cn))return new cn(i);e=e||function(h){if(h)throw h};var t=pv(i);if(typeof t!="object"){e(i);return}var n=cn.projections.get(t.projName);if(!n){e(i);return}if(t.datumCode&&t.datumCode!=="none"){var s=as(Et,t.datumCode);s&&(t.datum_params=t.datum_params||(s.towgs84?s.towgs84.split(","):null),t.ellps=s.ellipse,t.datumName=s.datumName?s.datumName:t.datumCode)}t.k0=t.k0||1,t.axis=t.axis||"enu",t.ellps=t.ellps||"wgs84",t.lat1=t.lat1||t.lat0;var r=Lv(t.a,t.b,t.rf,t.ellps,t.sphere),o=Iv(r.a,r.b,r.rf,t.R_A),a=Fv(t.nadgrids),l=t.datum||Pv(t.datumCode,t.datum_params,r.a,r.b,o.es,o.ep2,a);Rg(this,t),Rg(this,n),this.a=r.a,this.b=r.b,this.rf=r.rf,this.sphere=r.sphere,this.es=o.es,this.e=o.e,this.ep2=o.ep2,this.datum=l,this.init(),e(null,this)}cn.projections=Tv;cn.projections.start();function $v(i,e){return i.datum_type!==e.datum_type||i.a!==e.a||Math.abs(i.es-e.es)>5e-11?!1:i.datum_type===Gs?i.datum_params[0]===e.datum_params[0]&&i.datum_params[1]===e.datum_params[1]&&i.datum_params[2]===e.datum_params[2]:i.datum_type===zs?i.datum_params[0]===e.datum_params[0]&&i.datum_params[1]===e.datum_params[1]&&i.datum_params[2]===e.datum_params[2]&&i.datum_params[3]===e.datum_params[3]&&i.datum_params[4]===e.datum_params[4]&&i.datum_params[5]===e.datum_params[5]&&i.datum_params[6]===e.datum_params[6]:!0}function t0(i,e,t){var n=i.x,s=i.y,r=i.z?i.z:0,o,a,l,h;if(s<-O&&s>-1.001*O)s=-O;else if(s>O&&s<1.001*O)s=O;else{if(s<-O)return{x:-1/0,y:-1/0,z:i.z};if(s>O)return{x:1/0,y:1/0,z:i.z}}return n>Math.PI&&(n-=2*Math.PI),a=Math.sin(s),h=Math.cos(s),l=a*a,o=t/Math.sqrt(1-e*l),{x:(o+r)*h*Math.cos(n),y:(o+r)*h*Math.sin(n),z:(o*(1-e)+r)*a}}function i0(i,e,t,n){var s=1e-12,r=s*s,o=30,a,l,h,c,u,d,f,g,p,m,_,y,x,w=i.x,b=i.y,E=i.z?i.z:0,M,C,R;if(a=Math.sqrt(w*w+b*b),l=Math.sqrt(w*w+b*b+E*E),a/t<s){if(M=0,l/t<s)return C=O,R=-n,{x:i.x,y:i.y,z:i.z}}else M=Math.atan2(b,w);h=E/l,c=a/l,u=1/Math.sqrt(1-e*(2-e)*c*c),g=c*(1-e)*u,p=h*u,x=0;do x++,f=t/Math.sqrt(1-e*p*p),R=a*g+E*p-f*(1-e*p*p),d=e*f/(f+R),u=1/Math.sqrt(1-d*(2-d)*c*c),m=c*(1-d)*u,_=h*u,y=_*g-m*p,g=m,p=_;while(y*y>r&&x<o);return C=Math.atan(_/Math.abs(m)),{x:M,y:C,z:R}}function Uv(i,e,t){if(e===Gs)return{x:i.x+t[0],y:i.y+t[1],z:i.z+t[2]};if(e===zs){var n=t[0],s=t[1],r=t[2],o=t[3],a=t[4],l=t[5],h=t[6];return{x:h*(i.x-l*i.y+a*i.z)+n,y:h*(l*i.x+i.y-o*i.z)+s,z:h*(-a*i.x+o*i.y+i.z)+r}}}function qv(i,e,t){if(e===Gs)return{x:i.x-t[0],y:i.y-t[1],z:i.z-t[2]};if(e===zs){var n=t[0],s=t[1],r=t[2],o=t[3],a=t[4],l=t[5],h=t[6],c=(i.x-n)/h,u=(i.y-s)/h,d=(i.z-r)/h;return{x:c+l*u-a*d,y:-l*c+u+o*d,z:a*c-o*u+d}}}function Qa(i){return i===Gs||i===zs}function jv(i,e,t){if($v(i,e)||i.datum_type===vu||e.datum_type===vu)return t;var n=i.a,s=i.es;if(i.datum_type===Lr){var r=Lg(i,!1,t);if(r!==0)return;n=Mg,s=Cg}var o=e.a,a=e.b,l=e.es;if(e.datum_type===Lr&&(o=Mg,a=H1,l=Cg),s===l&&n===o&&!Qa(i.datum_type)&&!Qa(e.datum_type))return t;if(t=t0(t,s,n),Qa(i.datum_type)&&(t=Uv(t,i.datum_type,i.datum_params)),Qa(e.datum_type)&&(t=qv(t,e.datum_type,e.datum_params)),t=i0(t,l,o,a),e.datum_type===Lr){var h=Lg(e,!0,t);if(h!==0)return}return t}function Lg(i,e,t){if(i.grids===null||i.grids.length===0)return console.log("Grid shift grids not found"),-1;var n={x:-t.x,y:t.y},s={x:Number.NaN,y:Number.NaN},r=[];e:for(var o=0;o<i.grids.length;o++){var a=i.grids[o];if(r.push(a.name),a.isNull){s=n;break}if(a.mandatory,a.grid===null){if(a.mandatory)return console.log("Unable to find mandatory grid '"+a.name+"'"),-1;continue}for(var l=a.grid.subgrids,h=0,c=l.length;h<c;h++){var u=l[h],d=(Math.abs(u.del[1])+Math.abs(u.del[0]))/1e4,f=u.ll[0]-d,g=u.ll[1]-d,p=u.ll[0]+(u.lim[0]-1)*u.del[0]+d,m=u.ll[1]+(u.lim[1]-1)*u.del[1]+d;if(!(g>n.y||f>n.x||m<n.y||p<n.x)&&(s=Wv(n,e,u),!isNaN(s.x)))break e}}return isNaN(s.x)?(console.log("Failed to find a grid shift table for location '"+-n.x*an+" "+n.y*an+" tried: '"+r+"'"),-1):(t.x=-s.x,t.y=s.y,0)}function Wv(i,e,t){var n={x:Number.NaN,y:Number.NaN};if(isNaN(i.x))return n;var s={x:i.x,y:i.y};s.x-=t.ll[0],s.y-=t.ll[1],s.x=j(s.x-Math.PI)+Math.PI;var r=Pg(s,t);if(e){if(isNaN(r.x))return n;r.x=s.x-r.x,r.y=s.y-r.y;var o=9,a=1e-12,l,h;do{if(h=Pg(r,t),isNaN(h.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}l={x:s.x-(h.x+r.x),y:s.y-(h.y+r.y)},r.x+=l.x,r.y+=l.y}while(o--&&Math.abs(l.x)>a&&Math.abs(l.y)>a);if(o<0)return console.log("Inverse grid shift iterator failed to converge."),n;n.x=j(r.x+t.ll[0]),n.y=r.y+t.ll[1]}else isNaN(r.x)||(n.x=i.x+r.x,n.y=i.y+r.y);return n}function Pg(i,e){var t={x:i.x/e.del[0],y:i.y/e.del[1]},n={x:Math.floor(t.x),y:Math.floor(t.y)},s={x:t.x-1*n.x,y:t.y-1*n.y},r={x:Number.NaN,y:Number.NaN},o;if(n.x<0||n.x>=e.lim[0]||n.y<0||n.y>=e.lim[1])return r;o=n.y*e.lim[0]+n.x;var a={x:e.cvs[o][0],y:e.cvs[o][1]};o++;var l={x:e.cvs[o][0],y:e.cvs[o][1]};o+=e.lim[0];var h={x:e.cvs[o][0],y:e.cvs[o][1]};o--;var c={x:e.cvs[o][0],y:e.cvs[o][1]},u=s.x*s.y,d=s.x*(1-s.y),f=(1-s.x)*(1-s.y),g=(1-s.x)*s.y;return r.x=f*a.x+d*l.x+g*c.x+u*h.x,r.y=f*a.y+d*l.y+g*c.y+u*h.y,r}function Ag(i,e,t){var n=t.x,s=t.y,r=t.z||0,o,a,l,h={};for(l=0;l<3;l++)if(!(e&&l===2&&t.z===void 0))switch(l===0?(o=n,"ew".indexOf(i.axis[l])!==-1?a="x":a="y"):l===1?(o=s,"ns".indexOf(i.axis[l])!==-1?a="y":a="x"):(o=r,a="z"),i.axis[l]){case"e":h[a]=o;break;case"w":h[a]=-o;break;case"n":h[a]=o;break;case"s":h[a]=-o;break;case"u":t[a]!==void 0&&(h.z=o);break;case"d":t[a]!==void 0&&(h.z=-o);break;default:return null}return h}function n0(i){var e={x:i[0],y:i[1]};return i.length>2&&(e.z=i[2]),i.length>3&&(e.m=i[3]),e}function Vv(i){Fg(i.x),Fg(i.y)}function Fg(i){if(typeof Number.isFinite=="function"){if(Number.isFinite(i))return;throw new TypeError("coordinates must be finite numbers")}if(typeof i!="number"||i!==i||!isFinite(i))throw new TypeError("coordinates must be finite numbers")}function Xv(i,e){return(i.datum.datum_type===Gs||i.datum.datum_type===zs||i.datum.datum_type===Lr)&&e.datumCode!=="WGS84"||(e.datum.datum_type===Gs||e.datum.datum_type===zs||e.datum.datum_type===Lr)&&i.datumCode!=="WGS84"}function Ul(i,e,t,n){var s;Array.isArray(t)?t=n0(t):t={x:t.x,y:t.y,z:t.z,m:t.m};var r=t.z!==void 0;if(Vv(t),i.datum&&e.datum&&Xv(i,e)&&(s=new cn("WGS84"),t=Ul(i,s,t,n),i=s),n&&i.axis!=="enu"&&(t=Ag(i,!1,t)),i.projName==="longlat")t={x:t.x*St,y:t.y*St,z:t.z||0};else if(i.to_meter&&(t={x:t.x*i.to_meter,y:t.y*i.to_meter,z:t.z||0}),t=i.inverse(t),!t)return;if(i.from_greenwich&&(t.x+=i.from_greenwich),t=jv(i.datum,e.datum,t),!!t)return e.from_greenwich&&(t={x:t.x-e.from_greenwich,y:t.y,z:t.z||0}),e.projName==="longlat"?t={x:t.x*an,y:t.y*an,z:t.z||0}:(t=e.forward(t),e.to_meter&&(t={x:t.x/e.to_meter,y:t.y/e.to_meter,z:t.z||0})),n&&e.axis!=="enu"?Ag(e,!0,t):(t&&!r&&delete t.z,t)}var kg=cn("WGS84");function Sc(i,e,t,n){var s,r,o;return Array.isArray(t)?(s=Ul(i,e,t,n)||{x:NaN,y:NaN},t.length>2?typeof i.name<"u"&&i.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"?typeof s.z=="number"?[s.x,s.y,s.z].concat(t.splice(3)):[s.x,s.y,t[2]].concat(t.splice(3)):[s.x,s.y].concat(t.splice(2)):[s.x,s.y]):(r=Ul(i,e,t,n),o=Object.keys(t),o.length===2||o.forEach(function(a){if(typeof i.name<"u"&&i.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"){if(a==="x"||a==="y"||a==="z")return}else if(a==="x"||a==="y")return;r[a]=t[a]}),r)}function Og(i){return i instanceof cn?i:i.oProj?i.oProj:cn(i)}function Yt(i,e,t){i=Og(i);var n=!1,s;return typeof e>"u"?(e=i,i=kg,n=!0):(typeof e.x<"u"||Array.isArray(e))&&(t=e,e=i,i=kg,n=!0),e=Og(e),t?Sc(i,e,t):(s={forward:function(r,o){return Sc(i,e,r,o)},inverse:function(r,o){return Sc(e,i,r,o)}},n&&(s.oProj=e),s)}var Ng=6,s0="AJSAJS",r0="AFAFAF",xr=65,Zt=73,Si=79,Oo=86,No=90;const Yv={forward:o0,inverse:Hv,toPoint:a0};function o0(i,e){return e=e||5,Jv(Zv({lat:i[1],lon:i[0]}),e)}function Hv(i){var e=bd(h0(i.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]}function a0(i){var e=bd(h0(i.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function Tc(i){return i*(Math.PI/180)}function Dg(i){return 180*(i/Math.PI)}function Zv(i){var e=i.lat,t=i.lon,n=6378137,s=.00669438,r=.9996,o,a,l,h,c,u,d,f=Tc(e),g=Tc(t),p,m;m=Math.floor((t+180)/6)+1,t===180&&(m=60),e>=56&&e<64&&t>=3&&t<12&&(m=32),e>=72&&e<84&&(t>=0&&t<9?m=31:t>=9&&t<21?m=33:t>=21&&t<33?m=35:t>=33&&t<42&&(m=37)),o=(m-1)*6-180+3,p=Tc(o),a=s/(1-s),l=n/Math.sqrt(1-s*Math.sin(f)*Math.sin(f)),h=Math.tan(f)*Math.tan(f),c=a*Math.cos(f)*Math.cos(f),u=Math.cos(f)*(g-p),d=n*((1-s/4-3*s*s/64-5*s*s*s/256)*f-(3*s/8+3*s*s/32+45*s*s*s/1024)*Math.sin(2*f)+(15*s*s/256+45*s*s*s/1024)*Math.sin(4*f)-35*s*s*s/3072*Math.sin(6*f));var _=r*l*(u+(1-h+c)*u*u*u/6+(5-18*h+h*h+72*c-58*a)*u*u*u*u*u/120)+5e5,y=r*(d+l*Math.tan(f)*(u*u/2+(5-h+9*c+4*c*c)*u*u*u*u/24+(61-58*h+h*h+600*c-330*a)*u*u*u*u*u*u/720));return e<0&&(y+=1e7),{northing:Math.round(y),easting:Math.round(_),zoneNumber:m,zoneLetter:Kv(e)}}function bd(i){var e=i.northing,t=i.easting,n=i.zoneLetter,s=i.zoneNumber;if(s<0||s>60)return null;var r=.9996,o=6378137,a=.00669438,l,h=(1-Math.sqrt(1-a))/(1+Math.sqrt(1-a)),c,u,d,f,g,p,m,_,y,x=t-5e5,w=e;n<"N"&&(w-=1e7),m=(s-1)*6-180+3,l=a/(1-a),p=w/r,_=p/(o*(1-a/4-3*a*a/64-5*a*a*a/256)),y=_+(3*h/2-27*h*h*h/32)*Math.sin(2*_)+(21*h*h/16-55*h*h*h*h/32)*Math.sin(4*_)+151*h*h*h/96*Math.sin(6*_),c=o/Math.sqrt(1-a*Math.sin(y)*Math.sin(y)),u=Math.tan(y)*Math.tan(y),d=l*Math.cos(y)*Math.cos(y),f=o*(1-a)/Math.pow(1-a*Math.sin(y)*Math.sin(y),1.5),g=x/(c*r);var b=y-c*Math.tan(y)/f*(g*g/2-(5+3*u+10*d-4*d*d-9*l)*g*g*g*g/24+(61+90*u+298*d+45*u*u-252*l-3*d*d)*g*g*g*g*g*g/720);b=Dg(b);var E=(g-(1+2*u+d)*g*g*g/6+(5-2*d+28*u-3*d*d+8*l+24*u*u)*g*g*g*g*g/120)/Math.cos(y);E=m+Dg(E);var M;if(i.accuracy){var C=bd({northing:i.northing+i.accuracy,easting:i.easting+i.accuracy,zoneLetter:i.zoneLetter,zoneNumber:i.zoneNumber});M={top:C.lat,right:C.lon,bottom:b,left:E}}else M={lat:b,lon:E};return M}function Kv(i){var e="Z";return 84>=i&&i>=72?e="X":72>i&&i>=64?e="W":64>i&&i>=56?e="V":56>i&&i>=48?e="U":48>i&&i>=40?e="T":40>i&&i>=32?e="S":32>i&&i>=24?e="R":24>i&&i>=16?e="Q":16>i&&i>=8?e="P":8>i&&i>=0?e="N":0>i&&i>=-8?e="M":-8>i&&i>=-16?e="L":-16>i&&i>=-24?e="K":-24>i&&i>=-32?e="J":-32>i&&i>=-40?e="H":-40>i&&i>=-48?e="G":-48>i&&i>=-56?e="F":-56>i&&i>=-64?e="E":-64>i&&i>=-72?e="D":-72>i&&i>=-80&&(e="C"),e}function Jv(i,e){var t="00000"+i.easting,n="00000"+i.northing;return i.zoneNumber+i.zoneLetter+Qv(i.easting,i.northing,i.zoneNumber)+t.substr(t.length-5,e)+n.substr(n.length-5,e)}function Qv(i,e,t){var n=l0(t),s=Math.floor(i/1e5),r=Math.floor(e/1e5)%20;return ex(s,r,n)}function l0(i){var e=i%Ng;return e===0&&(e=Ng),e}function ex(i,e,t){var n=t-1,s=s0.charCodeAt(n),r=r0.charCodeAt(n),o=s+i-1,a=r+e,l=!1;o>No&&(o=o-No+xr-1,l=!0),(o===Zt||s<Zt&&o>Zt||(o>Zt||s<Zt)&&l)&&o++,(o===Si||s<Si&&o>Si||(o>Si||s<Si)&&l)&&(o++,o===Zt&&o++),o>No&&(o=o-No+xr-1),a>Oo?(a=a-Oo+xr-1,l=!0):l=!1,(a===Zt||r<Zt&&a>Zt||(a>Zt||r<Zt)&&l)&&a++,(a===Si||r<Si&&a>Si||(a>Si||r<Si)&&l)&&(a++,a===Zt&&a++),a>Oo&&(a=a-Oo+xr-1);var h=String.fromCharCode(o)+String.fromCharCode(a);return h}function h0(i){if(i&&i.length===0)throw"MGRSPoint coverting from nothing";for(var e=i.length,t=null,n="",s,r=0;!/[A-Z]/.test(s=i.charAt(r));){if(r>=2)throw"MGRSPoint bad conversion from: "+i;n+=s,r++}var o=parseInt(n,10);if(r===0||r+3>e)throw"MGRSPoint bad conversion from: "+i;var a=i.charAt(r++);if(a<="A"||a==="B"||a==="Y"||a>="Z"||a==="I"||a==="O")throw"MGRSPoint zone letter "+a+" not handled: "+i;t=i.substring(r,r+=2);for(var l=l0(o),h=tx(t.charAt(0),l),c=ix(t.charAt(1),l);c<nx(a);)c+=2e6;var u=e-r;if(u%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+i;var d=u/2,f=0,g=0,p,m,_,y,x;return d>0&&(p=1e5/Math.pow(10,d),m=i.substring(r,r+d),f=parseFloat(m)*p,_=i.substring(r+d),g=parseFloat(_)*p),y=f+h,x=g+c,{easting:y,northing:x,zoneLetter:a,zoneNumber:o,accuracy:p}}function tx(i,e){for(var t=s0.charCodeAt(e-1),n=1e5,s=!1;t!==i.charCodeAt(0);){if(t++,t===Zt&&t++,t===Si&&t++,t>No){if(s)throw"Bad character: "+i;t=xr,s=!0}n+=1e5}return n}function ix(i,e){if(i>"V")throw"MGRSPoint given invalid Northing "+i;for(var t=r0.charCodeAt(e-1),n=0,s=!1;t!==i.charCodeAt(0);){if(t++,t===Zt&&t++,t===Si&&t++,t>Oo){if(s)throw"Bad character: "+i;t=xr,s=!0}n+=1e5}return n}function nx(i){var e;switch(i){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+i}function io(i,e,t){if(!(this instanceof io))return new io(i,e,t);if(Array.isArray(i))this.x=i[0],this.y=i[1],this.z=i[2]||0;else if(typeof i=="object")this.x=i.x,this.y=i.y,this.z=i.z||0;else if(typeof i=="string"&&typeof e>"u"){var n=i.split(",");this.x=parseFloat(n[0],10),this.y=parseFloat(n[1],10),this.z=parseFloat(n[2],10)||0}else this.x=i,this.y=e,this.z=t||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}io.fromMGRS=function(i){return new io(a0(i))};io.prototype.toMGRS=function(i){return o0([this.x,this.y],i)};var sx=1,rx=.25,Gg=.046875,zg=.01953125,Bg=.01068115234375,ox=.75,ax=.46875,lx=.013020833333333334,hx=.007120768229166667,cx=.3645833333333333,ux=.005696614583333333,dx=.3076171875;function c0(i){var e=[];e[0]=sx-i*(rx+i*(Gg+i*(zg+i*Bg))),e[1]=i*(ox-i*(Gg+i*(zg+i*Bg)));var t=i*i;return e[2]=t*(ax-i*(lx+i*hx)),t*=i,e[3]=t*(cx-i*ux),e[4]=t*i*dx,e}function Hh(i,e,t,n){return t*=e,e*=e,n[0]*i-t*(n[1]+e*(n[2]+e*(n[3]+e*n[4])))}var fx=20;function u0(i,e,t){for(var n=1/(1-e),s=i,r=fx;r;--r){var o=Math.sin(s),a=1-e*o*o;if(a=(Hh(s,o,Math.cos(s),t)-i)*(a*Math.sqrt(a))*n,s-=a,Math.abs(a)<U)return s}return s}function gx(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=c0(this.es),this.ml0=Hh(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function px(i){var e=i.x,t=i.y,n=j(e-this.long0),s,r,o,a=Math.sin(t),l=Math.cos(t);if(this.es){var c=l*n,u=Math.pow(c,2),d=this.ep2*Math.pow(l,2),f=Math.pow(d,2),g=Math.abs(l)>U?Math.tan(t):0,p=Math.pow(g,2),m=Math.pow(p,2);s=1-this.es*Math.pow(a,2),c=c/Math.sqrt(s);var _=Hh(t,a,l,this.en);r=this.a*(this.k0*c*(1+u/6*(1-p+d+u/20*(5-18*p+m+14*d-58*p*d+u/42*(61+179*m-m*p-479*p)))))+this.x0,o=this.a*(this.k0*(_-this.ml0+a*n*c/2*(1+u/12*(5-p+9*d+4*f+u/30*(61+m-58*p+270*d-330*p*d+u/56*(1385+543*m-m*p-3111*p))))))+this.y0}else{var h=l*Math.sin(n);if(Math.abs(Math.abs(h)-1)<U)return 93;if(r=.5*this.a*this.k0*Math.log((1+h)/(1-h))+this.x0,o=l*Math.cos(n)/Math.sqrt(1-Math.pow(h,2)),h=Math.abs(o),h>=1){if(h-1>U)return 93;o=0}else o=Math.acos(o);t<0&&(o=-o),o=this.a*this.k0*(o-this.lat0)+this.y0}return i.x=r,i.y=o,i}function mx(i){var e,t,n,s,r=(i.x-this.x0)*(1/this.a),o=(i.y-this.y0)*(1/this.a);if(this.es)if(e=this.ml0+o/this.k0,t=u0(e,this.es,this.en),Math.abs(t)<O){var u=Math.sin(t),d=Math.cos(t),f=Math.abs(d)>U?Math.tan(t):0,g=this.ep2*Math.pow(d,2),p=Math.pow(g,2),m=Math.pow(f,2),_=Math.pow(m,2);e=1-this.es*Math.pow(u,2);var y=r*Math.sqrt(e)/this.k0,x=Math.pow(y,2);e=e*f,n=t-e*x/(1-this.es)*.5*(1-x/12*(5+3*m-9*g*m+g-4*p-x/30*(61+90*m-252*g*m+45*_+46*g-x/56*(1385+3633*m+4095*_+1574*_*m)))),s=j(this.long0+y*(1-x/6*(1+2*m+g-x/20*(5+28*m+24*_+8*g*m+6*g-x/42*(61+662*m+1320*_+720*_*m))))/d)}else n=O*Ca(o),s=0;else{var a=Math.exp(r/this.k0),l=.5*(a-1/a),h=this.lat0+o/this.k0,c=Math.cos(h);e=Math.sqrt((1-Math.pow(c,2))/(1+Math.pow(l,2))),n=Math.asin(e),o<0&&(n=-n),l===0&&c===0?s=0:s=j(Math.atan2(l,c)+this.long0)}return i.x=s,i.y=n,i}var yx=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const Fl={init:gx,forward:px,inverse:mx,names:yx};function d0(i){var e=Math.exp(i);return e=(e-1/e)/2,e}function $i(i,e){i=Math.abs(i),e=Math.abs(e);var t=Math.max(i,e),n=Math.min(i,e)/(t||1);return t*Math.sqrt(1+Math.pow(n,2))}function _x(i){var e=1+i,t=e-1;return t===0?i:i*Math.log(e)/t}function vx(i){var e=Math.abs(i);return e=_x(e*(1+e/($i(1,e)+1))),i<0?-e:e}function Ed(i,e){for(var t=2*Math.cos(2*e),n=i.length-1,s=i[n],r=0,o;--n>=0;)o=-r+t*s+i[n],r=s,s=o;return e+o*Math.sin(2*e)}function xx(i,e){for(var t=2*Math.cos(e),n=i.length-1,s=i[n],r=0,o;--n>=0;)o=-r+t*s+i[n],r=s,s=o;return Math.sin(e)*o}function wx(i){var e=Math.exp(i);return e=(e+1/e)/2,e}function f0(i,e,t){for(var n=Math.sin(e),s=Math.cos(e),r=d0(t),o=wx(t),a=2*s*o,l=-2*n*r,h=i.length-1,c=i[h],u=0,d=0,f=0,g,p;--h>=0;)g=d,p=u,d=c,u=f,c=-g+a*d-l*u+i[h],f=-p+l*d+a*u;return a=n*o,l=s*r,[a*c-l*f,a*f+l*c]}function bx(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Fl.init.apply(this),this.forward=Fl.forward,this.inverse=Fl.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var i=this.es/(1+Math.sqrt(1-this.es)),e=i/(2-i),t=e;this.cgb[0]=e*(2+e*(-2/3+e*(-2+e*(116/45+e*(26/45+e*(-2854/675)))))),this.cbg[0]=e*(-2+e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))),t=t*e,this.cgb[1]=t*(7/3+e*(-8/5+e*(-227/45+e*(2704/315+e*(2323/945))))),this.cbg[1]=t*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),t=t*e,this.cgb[2]=t*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=t*(-26/15+e*(34/21+e*(8/5+e*(-12686/2835)))),t=t*e,this.cgb[3]=t*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=t*(1237/630+e*(-12/5+e*(-24832/14175))),t=t*e,this.cgb[4]=t*(4174/315+e*(-144838/6237)),this.cbg[4]=t*(-734/315+e*(109598/31185)),t=t*e,this.cgb[5]=t*(601676/22275),this.cbg[5]=t*(444337/155925),t=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+t*(1/4+t*(1/64+t/256))),this.utg[0]=e*(-.5+e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=t*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=t*(13/48+e*(-3/5+e*(557/1440+e*(281/630+e*(-1983433/1935360))))),t=t*e,this.utg[2]=t*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=t*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),t=t*e,this.utg[3]=t*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=t*(49561/161280+e*(-179/168+e*(6601661/7257600))),t=t*e,this.utg[4]=t*(-4583/161280+e*(108847/3991680)),this.gtu[4]=t*(34729/80640+e*(-3418889/1995840)),t=t*e,this.utg[5]=t*(-20648693/638668800),this.gtu[5]=t*(212378941/319334400);var n=Ed(this.cbg,this.lat0);this.Zb=-this.Qn*(n+xx(this.gtu,2*n))}function Ex(i){var e=j(i.x-this.long0),t=i.y;t=Ed(this.cbg,t);var n=Math.sin(t),s=Math.cos(t),r=Math.sin(e),o=Math.cos(e);t=Math.atan2(n,o*s),e=Math.atan2(r*s,$i(n,s*o)),e=vx(Math.tan(e));var a=f0(this.gtu,2*t,2*e);t=t+a[0],e=e+a[1];var l,h;return Math.abs(e)<=2.623395162778?(l=this.a*(this.Qn*e)+this.x0,h=this.a*(this.Qn*t+this.Zb)+this.y0):(l=1/0,h=1/0),i.x=l,i.y=h,i}function Mx(i){var e=(i.x-this.x0)*(1/this.a),t=(i.y-this.y0)*(1/this.a);t=(t-this.Zb)/this.Qn,e=e/this.Qn;var n,s;if(Math.abs(e)<=2.623395162778){var r=f0(this.utg,2*t,2*e);t=t+r[0],e=e+r[1],e=Math.atan(d0(e));var o=Math.sin(t),a=Math.cos(t),l=Math.sin(e),h=Math.cos(e);t=Math.atan2(o*h,$i(l,h*a)),e=Math.atan2(l,h*a),n=j(e+this.long0),s=Ed(this.cgb,t)}else n=1/0,s=1/0;return i.x=n,i.y=s,i}var Cx=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"];const kl={init:bx,forward:Ex,inverse:Mx,names:Cx};function Sx(i,e){if(i===void 0){if(i=Math.floor((j(e)+Math.PI)*30/Math.PI)+1,i<0)return 0;if(i>60)return 60}return i}var Tx="etmerc";function Rx(){var i=Sx(this.zone,this.long0);if(i===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(i)-183)*St,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,kl.init.apply(this),this.forward=kl.forward,this.inverse=kl.inverse}var Ix=["Universal Transverse Mercator System","utm"];const Lx={init:Rx,names:Ix,dependsOn:Tx};function Md(i,e){return Math.pow((1-i)/(1+i),e)}var Px=20;function Ax(){var i=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*i*i),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(i/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+De)/(Math.pow(Math.tan(.5*this.lat0+De),this.C)*Md(this.e*i,this.ratexp))}function Fx(i){var e=i.x,t=i.y;return i.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*t+De),this.C)*Md(this.e*Math.sin(t),this.ratexp))-O,i.x=this.C*e,i}function kx(i){for(var e=1e-14,t=i.x/this.C,n=i.y,s=Math.pow(Math.tan(.5*n+De)/this.K,1/this.C),r=Px;r>0&&(n=2*Math.atan(s*Md(this.e*Math.sin(i.y),-.5*this.e))-O,!(Math.abs(n-i.y)<e));--r)i.y=n;return r?(i.x=t,i.y=n,i):null}var Ox=["gauss"];const Cd={init:Ax,forward:Fx,inverse:kx,names:Ox};function Nx(){Cd.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function Dx(i){var e,t,n,s;return i.x=j(i.x-this.long0),Cd.forward.apply(this,[i]),e=Math.sin(i.y),t=Math.cos(i.y),n=Math.cos(i.x),s=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*t*n),i.x=s*t*Math.sin(i.x),i.y=s*(this.cosc0*e-this.sinc0*t*n),i.x=this.a*i.x+this.x0,i.y=this.a*i.y+this.y0,i}function Gx(i){var e,t,n,s,r;if(i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,i.x/=this.k0,i.y/=this.k0,r=Math.sqrt(i.x*i.x+i.y*i.y)){var o=2*Math.atan2(r,this.R2);e=Math.sin(o),t=Math.cos(o),s=Math.asin(t*this.sinc0+i.y*e*this.cosc0/r),n=Math.atan2(i.x*e,r*this.cosc0*t-i.y*this.sinc0*e)}else s=this.phic0,n=0;return i.x=n,i.y=s,Cd.inverse.apply(this,[i]),i.x=j(i.x+this.long0),i}var zx=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const Bx={init:Nx,forward:Dx,inverse:Gx,names:zx};function $x(i,e,t){return e*=t,Math.tan(.5*(O+i))*Math.pow((1-e)/(1+e),.5*t)}function Ux(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=U&&(this.k0=.5*(1+Ca(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=U&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=U&&Math.abs(Math.cos(this.lat_ts))>U&&(this.k0=.5*this.cons*pn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Wi(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=pn(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-O,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function qx(i){var e=i.x,t=i.y,n=Math.sin(t),s=Math.cos(t),r,o,a,l,h,c,u=j(e-this.long0);return Math.abs(Math.abs(e-this.long0)-Math.PI)<=U&&Math.abs(t+this.lat0)<=U?(i.x=NaN,i.y=NaN,i):this.sphere?(r=2*this.k0/(1+this.sinlat0*n+this.coslat0*s*Math.cos(u)),i.x=this.a*r*s*Math.sin(u)+this.x0,i.y=this.a*r*(this.coslat0*n-this.sinlat0*s*Math.cos(u))+this.y0,i):(o=2*Math.atan(this.ssfn_(t,n,this.e))-O,l=Math.cos(o),a=Math.sin(o),Math.abs(this.coslat0)<=U?(h=Wi(this.e,t*this.con,this.con*n),c=2*this.a*this.k0*h/this.cons,i.x=this.x0+c*Math.sin(e-this.long0),i.y=this.y0-this.con*c*Math.cos(e-this.long0),i):(Math.abs(this.sinlat0)<U?(r=2*this.a*this.k0/(1+l*Math.cos(u)),i.y=r*a):(r=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*a+this.cosX0*l*Math.cos(u))),i.y=r*(this.cosX0*a-this.sinX0*l*Math.cos(u))+this.y0),i.x=r*l*Math.sin(u)+this.x0,i))}function jx(i){i.x-=this.x0,i.y-=this.y0;var e,t,n,s,r,o=Math.sqrt(i.x*i.x+i.y*i.y);if(this.sphere){var a=2*Math.atan(o/(2*this.a*this.k0));return e=this.long0,t=this.lat0,o<=U?(i.x=e,i.y=t,i):(t=Math.asin(Math.cos(a)*this.sinlat0+i.y*Math.sin(a)*this.coslat0/o),Math.abs(this.coslat0)<U?this.lat0>0?e=j(this.long0+Math.atan2(i.x,-1*i.y)):e=j(this.long0+Math.atan2(i.x,i.y)):e=j(this.long0+Math.atan2(i.x*Math.sin(a),o*this.coslat0*Math.cos(a)-i.y*this.sinlat0*Math.sin(a))),i.x=e,i.y=t,i)}else if(Math.abs(this.coslat0)<=U){if(o<=U)return t=this.lat0,e=this.long0,i.x=e,i.y=t,i;i.x*=this.con,i.y*=this.con,n=o*this.cons/(2*this.a*this.k0),t=this.con*Ko(this.e,n),e=this.con*j(this.con*this.long0+Math.atan2(i.x,-1*i.y))}else s=2*Math.atan(o*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,o<=U?r=this.X0:(r=Math.asin(Math.cos(s)*this.sinX0+i.y*Math.sin(s)*this.cosX0/o),e=j(this.long0+Math.atan2(i.x*Math.sin(s),o*this.cosX0*Math.cos(s)-i.y*this.sinX0*Math.sin(s)))),t=-1*Ko(this.e,Math.tan(.5*(O+r)));return i.x=e,i.y=t,i}var Wx=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const Vx={init:Ux,forward:qx,inverse:jx,names:Wx,ssfn_:$x};function Xx(){var i=this.lat0;this.lambda0=this.long0;var e=Math.sin(i),t=this.a,n=this.rf,s=1/n,r=2*s-Math.pow(s,2),o=this.e=Math.sqrt(r);this.R=this.k0*t*Math.sqrt(1-r)/(1-r*Math.pow(e,2)),this.alpha=Math.sqrt(1+r/(1-r)*Math.pow(Math.cos(i),4)),this.b0=Math.asin(e/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),l=Math.log(Math.tan(Math.PI/4+i/2)),h=Math.log((1+o*e)/(1-o*e));this.K=a-this.alpha*l+this.alpha*o/2*h}function Yx(i){var e=Math.log(Math.tan(Math.PI/4-i.y/2)),t=this.e/2*Math.log((1+this.e*Math.sin(i.y))/(1-this.e*Math.sin(i.y))),n=-this.alpha*(e+t)+this.K,s=2*(Math.atan(Math.exp(n))-Math.PI/4),r=this.alpha*(i.x-this.lambda0),o=Math.atan(Math.sin(r)/(Math.sin(this.b0)*Math.tan(s)+Math.cos(this.b0)*Math.cos(r))),a=Math.asin(Math.cos(this.b0)*Math.sin(s)-Math.sin(this.b0)*Math.cos(s)*Math.cos(r));return i.y=this.R/2*Math.log((1+Math.sin(a))/(1-Math.sin(a)))+this.y0,i.x=this.R*o+this.x0,i}function Hx(i){for(var e=i.x-this.x0,t=i.y-this.y0,n=e/this.R,s=2*(Math.atan(Math.exp(t/this.R))-Math.PI/4),r=Math.asin(Math.cos(this.b0)*Math.sin(s)+Math.sin(this.b0)*Math.cos(s)*Math.cos(n)),o=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(s))),a=this.lambda0+o/this.alpha,l=0,h=r,c=-1e3,u=0;Math.abs(h-c)>1e-7;){if(++u>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+r/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(h))/2)),c=h,h=2*Math.atan(Math.exp(l))-Math.PI/2}return i.x=a,i.y=h,i}var Zx=["somerc"];const Kx={init:Xx,forward:Yx,inverse:Hx,names:Zx};var cr=1e-7;function Jx(i){var e=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],t=typeof i.PROJECTION=="object"?Object.keys(i.PROJECTION)[0]:i.PROJECTION;return"no_uoff"in i||"no_off"in i||e.indexOf(t)!==-1}function Qx(){var i,e,t,n,s,r,o,a,l,h,c=0,u,d=0,f=0,g=0,p=0,m=0,_=0;this.no_off=Jx(this),this.no_rot="no_rot"in this;var y=!1;"alpha"in this&&(y=!0);var x=!1;if("rectified_grid_angle"in this&&(x=!0),y&&(_=this.alpha),x&&(c=this.rectified_grid_angle*St),y||x)d=this.longc;else if(f=this.long1,p=this.lat1,g=this.long2,m=this.lat2,Math.abs(p-m)<=cr||(i=Math.abs(p))<=cr||Math.abs(i-O)<=cr||Math.abs(Math.abs(this.lat0)-O)<=cr||Math.abs(Math.abs(m)-O)<=cr)throw new Error;var w=1-this.es;e=Math.sqrt(w),Math.abs(this.lat0)>U?(a=Math.sin(this.lat0),t=Math.cos(this.lat0),i=1-this.es*a*a,this.B=t*t,this.B=Math.sqrt(1+this.es*this.B*this.B/w),this.A=this.B*this.k0*e/i,n=this.B*e/(t*Math.sqrt(i)),s=n*n-1,s<=0?s=0:(s=Math.sqrt(s),this.lat0<0&&(s=-s)),this.E=s+=n,this.E*=Math.pow(Wi(this.e,this.lat0,a),this.B)):(this.B=1/e,this.A=this.k0,this.E=n=s=1),y||x?(y?(u=Math.asin(Math.sin(_)/n),x||(c=_)):(u=c,_=Math.asin(n*Math.sin(u))),this.lam0=d-Math.asin(.5*(s-1/s)*Math.tan(u))/this.B):(r=Math.pow(Wi(this.e,p,Math.sin(p)),this.B),o=Math.pow(Wi(this.e,m,Math.sin(m)),this.B),s=this.E/r,l=(o-r)/(o+r),h=this.E*this.E,h=(h-o*r)/(h+o*r),i=f-g,i<-Math.pi?g-=Ho:i>Math.pi&&(g+=Ho),this.lam0=j(.5*(f+g)-Math.atan(h*Math.tan(.5*this.B*(f-g))/l)/this.B),u=Math.atan(2*Math.sin(this.B*j(f-this.lam0))/(s-1/s)),c=_=Math.asin(n*Math.sin(u))),this.singam=Math.sin(u),this.cosgam=Math.cos(u),this.sinrot=Math.sin(c),this.cosrot=Math.cos(c),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(n*n-1)/Math.cos(_))),this.lat0<0&&(this.u_0=-this.u_0)),s=.5*u,this.v_pole_n=this.ArB*Math.log(Math.tan(De-s)),this.v_pole_s=this.ArB*Math.log(Math.tan(De+s))}function ew(i){var e={},t,n,s,r,o,a,l,h;if(i.x=i.x-this.lam0,Math.abs(Math.abs(i.y)-O)>U){if(o=this.E/Math.pow(Wi(this.e,i.y,Math.sin(i.y)),this.B),a=1/o,t=.5*(o-a),n=.5*(o+a),r=Math.sin(this.B*i.x),s=(t*this.singam-r*this.cosgam)/n,Math.abs(Math.abs(s)-1)<U)throw new Error;h=.5*this.ArB*Math.log((1-s)/(1+s)),a=Math.cos(this.B*i.x),Math.abs(a)<cr?l=this.A*i.x:l=this.ArB*Math.atan2(t*this.cosgam+r*this.singam,a)}else h=i.y>0?this.v_pole_n:this.v_pole_s,l=this.ArB*i.y;return this.no_rot?(e.x=l,e.y=h):(l-=this.u_0,e.x=h*this.cosrot+l*this.sinrot,e.y=l*this.cosrot-h*this.sinrot),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function tw(i){var e,t,n,s,r,o,a,l={};if(i.x=(i.x-this.x0)*(1/this.a),i.y=(i.y-this.y0)*(1/this.a),this.no_rot?(t=i.y,e=i.x):(t=i.x*this.cosrot-i.y*this.sinrot,e=i.y*this.cosrot+i.x*this.sinrot+this.u_0),n=Math.exp(-this.BrA*t),s=.5*(n-1/n),r=.5*(n+1/n),o=Math.sin(this.BrA*e),a=(o*this.cosgam+s*this.singam)/r,Math.abs(Math.abs(a)-1)<U)l.x=0,l.y=a<0?-O:O;else{if(l.y=this.E/Math.sqrt((1+a)/(1-a)),l.y=Ko(this.e,Math.pow(l.y,1/this.B)),l.y===1/0)throw new Error;l.x=-this.rB*Math.atan2(s*this.cosgam-o*this.singam,Math.cos(this.BrA*e))}return l.x+=this.lam0,l}var iw=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const nw={init:Qx,forward:ew,inverse:tw,names:iw};function sw(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<U)){var i=this.b/this.a;this.e=Math.sqrt(1-i*i);var e=Math.sin(this.lat1),t=Math.cos(this.lat1),n=pn(this.e,e,t),s=Wi(this.e,this.lat1,e),r=Math.sin(this.lat2),o=Math.cos(this.lat2),a=pn(this.e,r,o),l=Wi(this.e,this.lat2,r),h=Wi(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>U?this.ns=Math.log(n/a)/Math.log(s/l):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=n/(this.ns*Math.pow(s,this.ns)),this.rh=this.a*this.f0*Math.pow(h,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function rw(i){var e=i.x,t=i.y;Math.abs(2*Math.abs(t)-Math.PI)<=U&&(t=Ca(t)*(O-2*U));var n=Math.abs(Math.abs(t)-O),s,r;if(n>U)s=Wi(this.e,t,Math.sin(t)),r=this.a*this.f0*Math.pow(s,this.ns);else{if(n=t*this.ns,n<=0)return null;r=0}var o=this.ns*j(e-this.long0);return i.x=this.k0*(r*Math.sin(o))+this.x0,i.y=this.k0*(this.rh-r*Math.cos(o))+this.y0,i}function ow(i){var e,t,n,s,r,o=(i.x-this.x0)/this.k0,a=this.rh-(i.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(o*o+a*a),t=1):(e=-Math.sqrt(o*o+a*a),t=-1);var l=0;if(e!==0&&(l=Math.atan2(t*o,t*a)),e!==0||this.ns>0){if(t=1/this.ns,n=Math.pow(e/(this.a*this.f0),t),s=Ko(this.e,n),s===-9999)return null}else s=-O;return r=j(l/this.ns+this.long0),i.x=r,i.y=s,i}var aw=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const lw={init:sw,forward:rw,inverse:ow,names:aw};function hw(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function cw(i){var e,t,n,s,r,o,a,l=i.x,h=i.y,c=j(l-this.long0);return e=Math.pow((1+this.e*Math.sin(h))/(1-this.e*Math.sin(h)),this.alfa*this.e/2),t=2*(Math.atan(this.k*Math.pow(Math.tan(h/2+this.s45),this.alfa)/e)-this.s45),n=-c*this.alfa,s=Math.asin(Math.cos(this.ad)*Math.sin(t)+Math.sin(this.ad)*Math.cos(t)*Math.cos(n)),r=Math.asin(Math.cos(t)*Math.sin(n)/Math.cos(s)),o=this.n*r,a=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(s/2+this.s45),this.n),i.y=a*Math.cos(o)/1,i.x=a*Math.sin(o)/1,this.czech||(i.y*=-1,i.x*=-1),i}function uw(i){var e,t,n,s,r,o,a,l,h=i.x;i.x=i.y,i.y=h,this.czech||(i.y*=-1,i.x*=-1),o=Math.sqrt(i.x*i.x+i.y*i.y),r=Math.atan2(i.y,i.x),s=r/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(s)),t=Math.asin(Math.cos(n)*Math.sin(s)/Math.cos(e)),i.x=this.long0-t/this.alfa,a=e,l=0;var c=0;do i.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-i.y)<1e-10&&(l=1),a=i.y,c+=1;while(l===0&&c<15);return c>=15?null:i}var dw=["Krovak","krovak"];const fw={init:hw,forward:cw,inverse:uw,names:dw};function Wt(i,e,t,n,s){return i*s-e*Math.sin(2*s)+t*Math.sin(4*s)-n*Math.sin(6*s)}function Sa(i){return 1-.25*i*(1+i/16*(3+1.25*i))}function Ta(i){return .375*i*(1+.25*i*(1+.46875*i))}function Ra(i){return .05859375*i*i*(1+.75*i)}function Ia(i){return i*i*i*(35/3072)}function no(i,e,t){var n=e*t;return i/Math.sqrt(1-n*n)}function go(i){return Math.abs(i)<O?i:i-Ca(i)*Math.PI}function ql(i,e,t,n,s){var r,o;r=i/e;for(var a=0;a<15;a++)if(o=(i-(e*r-t*Math.sin(2*r)+n*Math.sin(4*r)-s*Math.sin(6*r)))/(e-2*t*Math.cos(2*r)+4*n*Math.cos(4*r)-6*s*Math.cos(6*r)),r+=o,Math.abs(o)<=1e-10)return r;return NaN}function gw(){this.sphere||(this.e0=Sa(this.es),this.e1=Ta(this.es),this.e2=Ra(this.es),this.e3=Ia(this.es),this.ml0=this.a*Wt(this.e0,this.e1,this.e2,this.e3,this.lat0))}function pw(i){var e,t,n=i.x,s=i.y;if(n=j(n-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(s)*Math.sin(n)),t=this.a*(Math.atan2(Math.tan(s),Math.cos(n))-this.lat0);else{var r=Math.sin(s),o=Math.cos(s),a=no(this.a,this.e,r),l=Math.tan(s)*Math.tan(s),h=n*Math.cos(s),c=h*h,u=this.es*o*o/(1-this.es),d=this.a*Wt(this.e0,this.e1,this.e2,this.e3,s);e=a*h*(1-c*l*(1/6-(8-l+8*u)*c/120)),t=d-this.ml0+a*r/o*c*(.5+(5-l+6*u)*c/24)}return i.x=e+this.x0,i.y=t+this.y0,i}function mw(i){i.x-=this.x0,i.y-=this.y0;var e=i.x/this.a,t=i.y/this.a,n,s;if(this.sphere){var r=t+this.lat0;n=Math.asin(Math.sin(r)*Math.cos(e)),s=Math.atan2(Math.tan(e),Math.cos(r))}else{var o=this.ml0/this.a+t,a=ql(o,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(a)-O)<=U)return i.x=this.long0,i.y=O,t<0&&(i.y*=-1),i;var l=no(this.a,this.e,Math.sin(a)),h=l*l*l/this.a/this.a*(1-this.es),c=Math.pow(Math.tan(a),2),u=e*this.a/l,d=u*u;n=a-l*Math.tan(a)/h*u*u*(.5-(1+3*c)*u*u/24),s=u*(1-d*(c/3+(1+3*c)*c*d/15))/Math.cos(a)}return i.x=j(s+this.long0),i.y=go(n),i}var yw=["Cassini","Cassini_Soldner","cass"];const _w={init:gw,forward:pw,inverse:mw,names:yw};function ns(i,e){var t;return i>1e-7?(t=i*e,(1-i*i)*(e/(1-t*t)-.5/i*Math.log((1-t)/(1+t)))):2*e}var vw=1,xw=2,ww=3,bw=4;function Ew(){var i=Math.abs(this.lat0);if(Math.abs(i-O)<U?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(i)<U?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var e;switch(this.qp=ns(this.e,1),this.mmf=.5/(1-this.es),this.apa=Aw(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=ns(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function Mw(i){var e,t,n,s,r,o,a,l,h,c,u=i.x,d=i.y;if(u=j(u-this.long0),this.sphere){if(r=Math.sin(d),c=Math.cos(d),n=Math.cos(u),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t=this.mode===this.EQUIT?1+c*n:1+this.sinph0*r+this.cosph0*c*n,t<=U)return null;t=Math.sqrt(2/t),e=t*c*Math.sin(u),t*=this.mode===this.EQUIT?r:this.cosph0*r-this.sinph0*c*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(d+this.lat0)<U)return null;t=De-d*.5,t=2*(this.mode===this.S_POLE?Math.cos(t):Math.sin(t)),e=t*Math.sin(u),t*=n}}else{switch(a=0,l=0,h=0,n=Math.cos(u),s=Math.sin(u),r=Math.sin(d),o=ns(this.e,r),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(a=o/this.qp,l=Math.sqrt(1-a*a)),this.mode){case this.OBLIQ:h=1+this.sinb1*a+this.cosb1*l*n;break;case this.EQUIT:h=1+l*n;break;case this.N_POLE:h=O+d,o=this.qp-o;break;case this.S_POLE:h=d-O,o=this.qp+o;break}if(Math.abs(h)<U)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:h=Math.sqrt(2/h),this.mode===this.OBLIQ?t=this.ymf*h*(this.cosb1*a-this.sinb1*l*n):t=(h=Math.sqrt(2/(1+l*n)))*a*this.ymf,e=this.xmf*h*l*s;break;case this.N_POLE:case this.S_POLE:o>=0?(e=(h=Math.sqrt(o))*s,t=n*(this.mode===this.S_POLE?h:-h)):e=t=0;break}}return i.x=this.a*e+this.x0,i.y=this.a*t+this.y0,i}function Cw(i){i.x-=this.x0,i.y-=this.y0;var e=i.x/this.a,t=i.y/this.a,n,s,r,o,a,l,h;if(this.sphere){var c=0,u,d=0;if(u=Math.sqrt(e*e+t*t),s=u*.5,s>1)return null;switch(s=2*Math.asin(s),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(d=Math.sin(s),c=Math.cos(s)),this.mode){case this.EQUIT:s=Math.abs(u)<=U?0:Math.asin(t*d/u),e*=d,t=c*u;break;case this.OBLIQ:s=Math.abs(u)<=U?this.lat0:Math.asin(c*this.sinph0+t*d*this.cosph0/u),e*=d*this.cosph0,t=(c-Math.sin(s)*this.sinph0)*u;break;case this.N_POLE:t=-t,s=O-s;break;case this.S_POLE:s-=O;break}n=t===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(e,t)}else{if(h=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e/=this.dd,t*=this.dd,l=Math.sqrt(e*e+t*t),l<U)return i.x=this.long0,i.y=this.lat0,i;o=2*Math.asin(.5*l/this.rq),r=Math.cos(o),e*=o=Math.sin(o),this.mode===this.OBLIQ?(h=r*this.sinb1+t*o*this.cosb1/l,a=this.qp*h,t=l*this.cosb1*r-t*this.sinb1*o):(h=t*o/l,a=this.qp*h,t=l*r)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(t=-t),a=e*e+t*t,!a)return i.x=this.long0,i.y=this.lat0,i;h=1-a/this.qp,this.mode===this.S_POLE&&(h=-h)}n=Math.atan2(e,t),s=Fw(Math.asin(h),this.apa)}return i.x=j(this.long0+n),i.y=s,i}var Sw=.3333333333333333,Tw=.17222222222222222,Rw=.10257936507936508,Iw=.06388888888888888,Lw=.0664021164021164,Pw=.016415012942191543;function Aw(i){var e,t=[];return t[0]=i*Sw,e=i*i,t[0]+=e*Tw,t[1]=e*Iw,e*=i,t[0]+=e*Rw,t[1]+=e*Lw,t[2]=e*Pw,t}function Fw(i,e){var t=i+i;return i+e[0]*Math.sin(t)+e[1]*Math.sin(t+t)+e[2]*Math.sin(t+t+t)}var kw=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const Ow={init:Ew,forward:Mw,inverse:Cw,names:kw,S_POLE:vw,N_POLE:xw,EQUIT:ww,OBLIQ:bw};function ls(i){return Math.abs(i)>1&&(i=i>1?1:-1),Math.asin(i)}function Nw(){Math.abs(this.lat1+this.lat2)<U||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=pn(this.e3,this.sin_po,this.cos_po),this.qs1=ns(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=pn(this.e3,this.sin_po,this.cos_po),this.qs2=ns(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=ns(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>U?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function Dw(i){var e=i.x,t=i.y;this.sin_phi=Math.sin(t),this.cos_phi=Math.cos(t);var n=ns(this.e3,this.sin_phi),s=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,r=this.ns0*j(e-this.long0),o=s*Math.sin(r)+this.x0,a=this.rh-s*Math.cos(r)+this.y0;return i.x=o,i.y=a,i}function Gw(i){var e,t,n,s,r,o;return i.x-=this.x0,i.y=this.rh-i.y+this.y0,this.ns0>=0?(e=Math.sqrt(i.x*i.x+i.y*i.y),n=1):(e=-Math.sqrt(i.x*i.x+i.y*i.y),n=-1),s=0,e!==0&&(s=Math.atan2(n*i.x,n*i.y)),n=e*this.ns0/this.a,this.sphere?o=Math.asin((this.c-n*n)/(2*this.ns0)):(t=(this.c-n*n)/this.ns0,o=this.phi1z(this.e3,t)),r=j(s/this.ns0+this.long0),i.x=r,i.y=o,i}function zw(i,e){var t,n,s,r,o,a=ls(.5*e);if(i<U)return a;for(var l=i*i,h=1;h<=25;h++)if(t=Math.sin(a),n=Math.cos(a),s=i*t,r=1-s*s,o=.5*r*r/n*(e/(1-l)-t/r+.5/i*Math.log((1-s)/(1+s))),a=a+o,Math.abs(o)<=1e-7)return a;return null}var Bw=["Albers_Conic_Equal_Area","Albers","aea"];const $w={init:Nw,forward:Dw,inverse:Gw,names:Bw,phi1z:zw};function Uw(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function qw(i){var e,t,n,s,r,o,a,l,h=i.x,c=i.y;return n=j(h-this.long0),e=Math.sin(c),t=Math.cos(c),s=Math.cos(n),o=this.sin_p14*e+this.cos_p14*t*s,r=1,o>0||Math.abs(o)<=U?(a=this.x0+this.a*r*t*Math.sin(n)/o,l=this.y0+this.a*r*(this.cos_p14*e-this.sin_p14*t*s)/o):(a=this.x0+this.infinity_dist*t*Math.sin(n),l=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*t*s)),i.x=a,i.y=l,i}function jw(i){var e,t,n,s,r,o;return i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,i.x/=this.k0,i.y/=this.k0,(e=Math.sqrt(i.x*i.x+i.y*i.y))?(s=Math.atan2(e,this.rc),t=Math.sin(s),n=Math.cos(s),o=ls(n*this.sin_p14+i.y*t*this.cos_p14/e),r=Math.atan2(i.x*t,e*this.cos_p14*n-i.y*this.sin_p14*t),r=j(this.long0+r)):(o=this.phic0,r=0),i.x=r,i.y=o,i}var Ww=["gnom"];const Vw={init:Uw,forward:qw,inverse:jw,names:Ww};function Xw(i,e){var t=1-(1-i*i)/(2*i)*Math.log((1-i)/(1+i));if(Math.abs(Math.abs(e)-t)<1e-6)return e<0?-1*O:O;for(var n=Math.asin(.5*e),s,r,o,a,l=0;l<30;l++)if(r=Math.sin(n),o=Math.cos(n),a=i*r,s=Math.pow(1-a*a,2)/(2*o)*(e/(1-i*i)-r/(1-a*a)+.5/i*Math.log((1-a)/(1+a))),n+=s,Math.abs(s)<=1e-10)return n;return NaN}function Yw(){this.sphere||(this.k0=pn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function Hw(i){var e=i.x,t=i.y,n,s,r=j(e-this.long0);if(this.sphere)n=this.x0+this.a*r*Math.cos(this.lat_ts),s=this.y0+this.a*Math.sin(t)/Math.cos(this.lat_ts);else{var o=ns(this.e,Math.sin(t));n=this.x0+this.a*this.k0*r,s=this.y0+this.a*o*.5/this.k0}return i.x=n,i.y=s,i}function Zw(i){i.x-=this.x0,i.y-=this.y0;var e,t;return this.sphere?(e=j(this.long0+i.x/this.a/Math.cos(this.lat_ts)),t=Math.asin(i.y/this.a*Math.cos(this.lat_ts))):(t=Xw(this.e,2*i.y*this.k0/this.a),e=j(this.long0+i.x/(this.a*this.k0))),i.x=e,i.y=t,i}var Kw=["cea"];const Jw={init:Yw,forward:Hw,inverse:Zw,names:Kw};function Qw(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function eb(i){var e=i.x,t=i.y,n=j(e-this.long0),s=go(t-this.lat0);return i.x=this.x0+this.a*n*this.rc,i.y=this.y0+this.a*s,i}function tb(i){var e=i.x,t=i.y;return i.x=j(this.long0+(e-this.x0)/(this.a*this.rc)),i.y=go(this.lat0+(t-this.y0)/this.a),i}var ib=["Equirectangular","Equidistant_Cylindrical","eqc"];const nb={init:Qw,forward:eb,inverse:tb,names:ib};var $g=20;function sb(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Sa(this.es),this.e1=Ta(this.es),this.e2=Ra(this.es),this.e3=Ia(this.es),this.ml0=this.a*Wt(this.e0,this.e1,this.e2,this.e3,this.lat0)}function rb(i){var e=i.x,t=i.y,n,s,r,o=j(e-this.long0);if(r=o*Math.sin(t),this.sphere)Math.abs(t)<=U?(n=this.a*o,s=-1*this.a*this.lat0):(n=this.a*Math.sin(r)/Math.tan(t),s=this.a*(go(t-this.lat0)+(1-Math.cos(r))/Math.tan(t)));else if(Math.abs(t)<=U)n=this.a*o,s=-1*this.ml0;else{var a=no(this.a,this.e,Math.sin(t))/Math.tan(t);n=a*Math.sin(r),s=this.a*Wt(this.e0,this.e1,this.e2,this.e3,t)-this.ml0+a*(1-Math.cos(r))}return i.x=n+this.x0,i.y=s+this.y0,i}function ob(i){var e,t,n,s,r,o,a,l,h;if(n=i.x-this.x0,s=i.y-this.y0,this.sphere)if(Math.abs(s+this.a*this.lat0)<=U)e=j(n/this.a+this.long0),t=0;else{o=this.lat0+s/this.a,a=n*n/this.a/this.a+o*o,l=o;var c;for(r=$g;r;--r)if(c=Math.tan(l),h=-1*(o*(l*c+1)-l-.5*(l*l+a)*c)/((l-o)/c-1),l+=h,Math.abs(h)<=U){t=l;break}e=j(this.long0+Math.asin(n*Math.tan(l)/this.a)/Math.sin(t))}else if(Math.abs(s+this.ml0)<=U)t=0,e=j(this.long0+n/this.a);else{o=(this.ml0+s)/this.a,a=n*n/this.a/this.a+o*o,l=o;var u,d,f,g,p;for(r=$g;r;--r)if(p=this.e*Math.sin(l),u=Math.sqrt(1-p*p)*Math.tan(l),d=this.a*Wt(this.e0,this.e1,this.e2,this.e3,l),f=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),g=d/this.a,h=(o*(u*g+1)-g-.5*u*(g*g+a))/(this.es*Math.sin(2*l)*(g*g+a-2*o*g)/(4*u)+(o-g)*(u*f-2/Math.sin(2*l))-f),l-=h,Math.abs(h)<=U){t=l;break}u=Math.sqrt(1-this.es*Math.pow(Math.sin(t),2))*Math.tan(t),e=j(this.long0+Math.asin(n*u/this.a)/Math.sin(t))}return i.x=e,i.y=t,i}var ab=["Polyconic","poly"];const lb={init:sb,forward:rb,inverse:ob,names:ab};function hb(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function cb(i){var e,t=i.x,n=i.y,s=n-this.lat0,r=t-this.long0,o=s/$o*1e-5,a=r,l=1,h=0;for(e=1;e<=10;e++)l=l*o,h=h+this.A[e]*l;var c=h,u=a,d=1,f=0,g,p,m=0,_=0;for(e=1;e<=6;e++)g=d*c-f*u,p=f*c+d*u,d=g,f=p,m=m+this.B_re[e]*d-this.B_im[e]*f,_=_+this.B_im[e]*d+this.B_re[e]*f;return i.x=_*this.a+this.x0,i.y=m*this.a+this.y0,i}function ub(i){var e,t=i.x,n=i.y,s=t-this.x0,r=n-this.y0,o=r/this.a,a=s/this.a,l=1,h=0,c,u,d=0,f=0;for(e=1;e<=6;e++)c=l*o-h*a,u=h*o+l*a,l=c,h=u,d=d+this.C_re[e]*l-this.C_im[e]*h,f=f+this.C_im[e]*l+this.C_re[e]*h;for(var g=0;g<this.iterations;g++){var p=d,m=f,_,y,x=o,w=a;for(e=2;e<=6;e++)_=p*d-m*f,y=m*d+p*f,p=_,m=y,x=x+(e-1)*(this.B_re[e]*p-this.B_im[e]*m),w=w+(e-1)*(this.B_im[e]*p+this.B_re[e]*m);p=1,m=0;var b=this.B_re[1],E=this.B_im[1];for(e=2;e<=6;e++)_=p*d-m*f,y=m*d+p*f,p=_,m=y,b=b+e*(this.B_re[e]*p-this.B_im[e]*m),E=E+e*(this.B_im[e]*p+this.B_re[e]*m);var M=b*b+E*E;d=(x*b+w*E)/M,f=(w*b-x*E)/M}var C=d,R=f,N=1,D=0;for(e=1;e<=9;e++)N=N*C,D=D+this.D[e]*N;var S=this.lat0+D*$o*1e5,B=this.long0+R;return i.x=B,i.y=S,i}var db=["New_Zealand_Map_Grid","nzmg"];const fb={init:hb,forward:cb,inverse:ub,names:db};function gb(){}function pb(i){var e=i.x,t=i.y,n=j(e-this.long0),s=this.x0+this.a*n,r=this.y0+this.a*Math.log(Math.tan(Math.PI/4+t/2.5))*1.25;return i.x=s,i.y=r,i}function mb(i){i.x-=this.x0,i.y-=this.y0;var e=j(this.long0+i.x/this.a),t=2.5*(Math.atan(Math.exp(.8*i.y/this.a))-Math.PI/4);return i.x=e,i.y=t,i}var yb=["Miller_Cylindrical","mill"];const _b={init:gb,forward:pb,inverse:mb,names:yb};var vb=20;function xb(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=c0(this.es)}function wb(i){var e,t,n=i.x,s=i.y;if(n=j(n-this.long0),this.sphere){if(!this.m)s=this.n!==1?Math.asin(this.n*Math.sin(s)):s;else for(var r=this.n*Math.sin(s),o=vb;o;--o){var a=(this.m*s+Math.sin(s)-r)/(this.m+Math.cos(s));if(s-=a,Math.abs(a)<U)break}e=this.a*this.C_x*n*(this.m+Math.cos(s)),t=this.a*this.C_y*s}else{var l=Math.sin(s),h=Math.cos(s);t=this.a*Hh(s,l,h,this.en),e=this.a*n*h/Math.sqrt(1-this.es*l*l)}return i.x=e,i.y=t,i}function bb(i){var e,t,n,s;return i.x-=this.x0,n=i.x/this.a,i.y-=this.y0,e=i.y/this.a,this.sphere?(e/=this.C_y,n=n/(this.C_x*(this.m+Math.cos(e))),this.m?e=ls((this.m*e+Math.sin(e))/this.n):this.n!==1&&(e=ls(Math.sin(e)/this.n)),n=j(n+this.long0),e=go(e)):(e=u0(i.y/this.a,this.es,this.en),s=Math.abs(e),s<O?(s=Math.sin(e),t=this.long0+i.x*Math.sqrt(1-this.es*s*s)/(this.a*Math.cos(e)),n=j(t)):s-U<O&&(n=this.long0)),i.x=n,i.y=e,i}var Eb=["Sinusoidal","sinu"];const Mb={init:xb,forward:wb,inverse:bb,names:Eb};function Cb(){}function Sb(i){for(var e=i.x,t=i.y,n=j(e-this.long0),s=t,r=Math.PI*Math.sin(t);;){var o=-(s+Math.sin(s)-r)/(1+Math.cos(s));if(s+=o,Math.abs(o)<U)break}s/=2,Math.PI/2-Math.abs(t)<U&&(n=0);var a=.900316316158*this.a*n*Math.cos(s)+this.x0,l=1.4142135623731*this.a*Math.sin(s)+this.y0;return i.x=a,i.y=l,i}function Tb(i){var e,t;i.x-=this.x0,i.y-=this.y0,t=i.y/(1.4142135623731*this.a),Math.abs(t)>.999999999999&&(t=.999999999999),e=Math.asin(t);var n=j(this.long0+i.x/(.900316316158*this.a*Math.cos(e)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),t=(2*e+Math.sin(2*e))/Math.PI,Math.abs(t)>1&&(t=1);var s=Math.asin(t);return i.x=n,i.y=s,i}var Rb=["Mollweide","moll"];const Ib={init:Cb,forward:Sb,inverse:Tb,names:Rb};function Lb(){Math.abs(this.lat1+this.lat2)<U||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Sa(this.es),this.e1=Ta(this.es),this.e2=Ra(this.es),this.e3=Ia(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=pn(this.e,this.sinphi,this.cosphi),this.ml1=Wt(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<U?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=pn(this.e,this.sinphi,this.cosphi),this.ml2=Wt(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Wt(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function Pb(i){var e=i.x,t=i.y,n;if(this.sphere)n=this.a*(this.g-t);else{var s=Wt(this.e0,this.e1,this.e2,this.e3,t);n=this.a*(this.g-s)}var r=this.ns*j(e-this.long0),o=this.x0+n*Math.sin(r),a=this.y0+this.rh-n*Math.cos(r);return i.x=o,i.y=a,i}function Ab(i){i.x-=this.x0,i.y=this.rh-i.y+this.y0;var e,t,n,s;this.ns>=0?(t=Math.sqrt(i.x*i.x+i.y*i.y),e=1):(t=-Math.sqrt(i.x*i.x+i.y*i.y),e=-1);var r=0;if(t!==0&&(r=Math.atan2(e*i.x,e*i.y)),this.sphere)return s=j(this.long0+r/this.ns),n=go(this.g-t/this.a),i.x=s,i.y=n,i;var o=this.g-t/this.a;return n=ql(o,this.e0,this.e1,this.e2,this.e3),s=j(this.long0+r/this.ns),i.x=s,i.y=n,i}var Fb=["Equidistant_Conic","eqdc"];const kb={init:Lb,forward:Pb,inverse:Ab,names:Fb};function Ob(){this.R=this.a}function Nb(i){var e=i.x,t=i.y,n=j(e-this.long0),s,r;Math.abs(t)<=U&&(s=this.x0+this.R*n,r=this.y0);var o=ls(2*Math.abs(t/Math.PI));(Math.abs(n)<=U||Math.abs(Math.abs(t)-O)<=U)&&(s=this.x0,t>=0?r=this.y0+Math.PI*this.R*Math.tan(.5*o):r=this.y0+Math.PI*this.R*-Math.tan(.5*o));var a=.5*Math.abs(Math.PI/n-n/Math.PI),l=a*a,h=Math.sin(o),c=Math.cos(o),u=c/(h+c-1),d=u*u,f=u*(2/h-1),g=f*f,p=Math.PI*this.R*(a*(u-g)+Math.sqrt(l*(u-g)*(u-g)-(g+l)*(d-g)))/(g+l);n<0&&(p=-p),s=this.x0+p;var m=l+u;return p=Math.PI*this.R*(f*m-a*Math.sqrt((g+l)*(l+1)-m*m))/(g+l),t>=0?r=this.y0+p:r=this.y0-p,i.x=s,i.y=r,i}function Db(i){var e,t,n,s,r,o,a,l,h,c,u,d,f;return i.x-=this.x0,i.y-=this.y0,u=Math.PI*this.R,n=i.x/u,s=i.y/u,r=n*n+s*s,o=-Math.abs(s)*(1+r),a=o-2*s*s+n*n,l=-2*o+1+2*s*s+r*r,f=s*s/l+(2*a*a*a/l/l/l-9*o*a/l/l)/27,h=(o-a*a/3/l)/l,c=2*Math.sqrt(-h/3),u=3*f/h/c,Math.abs(u)>1&&(u>=0?u=1:u=-1),d=Math.acos(u)/3,i.y>=0?t=(-c*Math.cos(d+Math.PI/3)-a/3/l)*Math.PI:t=-(-c*Math.cos(d+Math.PI/3)-a/3/l)*Math.PI,Math.abs(n)<U?e=this.long0:e=j(this.long0+Math.PI*(r-1+Math.sqrt(1+2*(n*n-s*s)+r*r))/2/n),i.x=e,i.y=t,i}var Gb=["Van_der_Grinten_I","VanDerGrinten","vandg"];const zb={init:Ob,forward:Nb,inverse:Db,names:Gb};function Bb(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function $b(i){var e=i.x,t=i.y,n=Math.sin(i.y),s=Math.cos(i.y),r=j(e-this.long0),o,a,l,h,c,u,d,f,g,p,m,_,y,x,w,b,E,M,C,R,N,D,S;return this.sphere?Math.abs(this.sin_p12-1)<=U?(i.x=this.x0+this.a*(O-t)*Math.sin(r),i.y=this.y0-this.a*(O-t)*Math.cos(r),i):Math.abs(this.sin_p12+1)<=U?(i.x=this.x0+this.a*(O+t)*Math.sin(r),i.y=this.y0+this.a*(O+t)*Math.cos(r),i):(M=this.sin_p12*n+this.cos_p12*s*Math.cos(r),b=Math.acos(M),E=b?b/Math.sin(b):1,i.x=this.x0+this.a*E*s*Math.sin(r),i.y=this.y0+this.a*E*(this.cos_p12*n-this.sin_p12*s*Math.cos(r)),i):(o=Sa(this.es),a=Ta(this.es),l=Ra(this.es),h=Ia(this.es),Math.abs(this.sin_p12-1)<=U?(c=this.a*Wt(o,a,l,h,O),u=this.a*Wt(o,a,l,h,t),i.x=this.x0+(c-u)*Math.sin(r),i.y=this.y0-(c-u)*Math.cos(r),i):Math.abs(this.sin_p12+1)<=U?(c=this.a*Wt(o,a,l,h,O),u=this.a*Wt(o,a,l,h,t),i.x=this.x0+(c+u)*Math.sin(r),i.y=this.y0+(c+u)*Math.cos(r),i):(d=n/s,f=no(this.a,this.e,this.sin_p12),g=no(this.a,this.e,n),p=Math.atan((1-this.es)*d+this.es*f*this.sin_p12/(g*s)),m=Math.atan2(Math.sin(r),this.cos_p12*Math.tan(p)-this.sin_p12*Math.cos(r)),m===0?C=Math.asin(this.cos_p12*Math.sin(p)-this.sin_p12*Math.cos(p)):Math.abs(Math.abs(m)-Math.PI)<=U?C=-Math.asin(this.cos_p12*Math.sin(p)-this.sin_p12*Math.cos(p)):C=Math.asin(Math.sin(r)*Math.cos(p)/Math.sin(m)),_=this.e*this.sin_p12/Math.sqrt(1-this.es),y=this.e*this.cos_p12*Math.cos(m)/Math.sqrt(1-this.es),x=_*y,w=y*y,R=C*C,N=R*C,D=N*C,S=D*C,b=f*C*(1-R*w*(1-w)/6+N/8*x*(1-2*w)+D/120*(w*(4-7*w)-3*_*_*(1-7*w))-S/48*x),i.x=this.x0+b*Math.sin(m),i.y=this.y0+b*Math.cos(m),i))}function Ub(i){i.x-=this.x0,i.y-=this.y0;var e,t,n,s,r,o,a,l,h,c,u,d,f,g,p,m,_,y,x,w,b,E,M,C;return this.sphere?(e=Math.sqrt(i.x*i.x+i.y*i.y),e>2*O*this.a?void 0:(t=e/this.a,n=Math.sin(t),s=Math.cos(t),r=this.long0,Math.abs(e)<=U?o=this.lat0:(o=ls(s*this.sin_p12+i.y*n*this.cos_p12/e),a=Math.abs(this.lat0)-O,Math.abs(a)<=U?this.lat0>=0?r=j(this.long0+Math.atan2(i.x,-i.y)):r=j(this.long0-Math.atan2(-i.x,i.y)):r=j(this.long0+Math.atan2(i.x*n,e*this.cos_p12*s-i.y*this.sin_p12*n))),i.x=r,i.y=o,i)):(l=Sa(this.es),h=Ta(this.es),c=Ra(this.es),u=Ia(this.es),Math.abs(this.sin_p12-1)<=U?(d=this.a*Wt(l,h,c,u,O),e=Math.sqrt(i.x*i.x+i.y*i.y),f=d-e,o=ql(f/this.a,l,h,c,u),r=j(this.long0+Math.atan2(i.x,-1*i.y)),i.x=r,i.y=o,i):Math.abs(this.sin_p12+1)<=U?(d=this.a*Wt(l,h,c,u,O),e=Math.sqrt(i.x*i.x+i.y*i.y),f=e-d,o=ql(f/this.a,l,h,c,u),r=j(this.long0+Math.atan2(i.x,i.y)),i.x=r,i.y=o,i):(e=Math.sqrt(i.x*i.x+i.y*i.y),m=Math.atan2(i.x,i.y),g=no(this.a,this.e,this.sin_p12),_=Math.cos(m),y=this.e*this.cos_p12*_,x=-y*y/(1-this.es),w=3*this.es*(1-x)*this.sin_p12*this.cos_p12*_/(1-this.es),b=e/g,E=b-x*(1+x)*Math.pow(b,3)/6-w*(1+3*x)*Math.pow(b,4)/24,M=1-x*E*E/2-b*E*E*E/6,p=Math.asin(this.sin_p12*Math.cos(E)+this.cos_p12*Math.sin(E)*_),r=j(this.long0+Math.asin(Math.sin(m)*Math.sin(E)/Math.cos(p))),C=Math.sin(p),o=Math.atan2((C-this.es*M*this.sin_p12)*Math.tan(p),C*(1-this.es)),i.x=r,i.y=o,i))}var qb=["Azimuthal_Equidistant","aeqd"];const jb={init:Bb,forward:$b,inverse:Ub,names:qb};function Wb(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function Vb(i){var e,t,n,s,r,o,a,l,h=i.x,c=i.y;return n=j(h-this.long0),e=Math.sin(c),t=Math.cos(c),s=Math.cos(n),o=this.sin_p14*e+this.cos_p14*t*s,r=1,(o>0||Math.abs(o)<=U)&&(a=this.a*r*t*Math.sin(n),l=this.y0+this.a*r*(this.cos_p14*e-this.sin_p14*t*s)),i.x=a,i.y=l,i}function Xb(i){var e,t,n,s,r,o,a;return i.x-=this.x0,i.y-=this.y0,e=Math.sqrt(i.x*i.x+i.y*i.y),t=ls(e/this.a),n=Math.sin(t),s=Math.cos(t),o=this.long0,Math.abs(e)<=U?(a=this.lat0,i.x=o,i.y=a,i):(a=ls(s*this.sin_p14+i.y*n*this.cos_p14/e),r=Math.abs(this.lat0)-O,Math.abs(r)<=U?(this.lat0>=0?o=j(this.long0+Math.atan2(i.x,-i.y)):o=j(this.long0-Math.atan2(-i.x,i.y)),i.x=o,i.y=a,i):(o=j(this.long0+Math.atan2(i.x*n,e*this.cos_p14*s-i.y*this.sin_p14*n)),i.x=o,i.y=a,i))}var Yb=["ortho"];const Hb={init:Wb,forward:Vb,inverse:Xb,names:Yb};var Je={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},Ge={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function Zb(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=O-De/2?this.face=Je.TOP:this.lat0<=-(O-De/2)?this.face=Je.BOTTOM:Math.abs(this.long0)<=De?this.face=Je.FRONT:Math.abs(this.long0)<=O+De?this.face=this.long0>0?Je.RIGHT:Je.LEFT:this.face=Je.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function Kb(i){var e={x:0,y:0},t,n,s,r,o,a,l={value:0};if(i.x-=this.long0,this.es!==0?t=Math.atan(this.one_minus_f_squared*Math.tan(i.y)):t=i.y,n=i.x,this.face===Je.TOP)r=O-t,n>=De&&n<=O+De?(l.value=Ge.AREA_0,s=n-O):n>O+De||n<=-(O+De)?(l.value=Ge.AREA_1,s=n>0?n-rt:n+rt):n>-(O+De)&&n<=-De?(l.value=Ge.AREA_2,s=n+O):(l.value=Ge.AREA_3,s=n);else if(this.face===Je.BOTTOM)r=O+t,n>=De&&n<=O+De?(l.value=Ge.AREA_0,s=-n+O):n<De&&n>=-De?(l.value=Ge.AREA_1,s=-n):n<-De&&n>=-(O+De)?(l.value=Ge.AREA_2,s=-n-O):(l.value=Ge.AREA_3,s=n>0?-n+rt:-n-rt);else{var h,c,u,d,f,g,p;this.face===Je.RIGHT?n=Pr(n,+O):this.face===Je.BACK?n=Pr(n,+rt):this.face===Je.LEFT&&(n=Pr(n,-O)),d=Math.sin(t),f=Math.cos(t),g=Math.sin(n),p=Math.cos(n),h=f*p,c=f*g,u=d,this.face===Je.FRONT?(r=Math.acos(h),s=el(r,u,c,l)):this.face===Je.RIGHT?(r=Math.acos(c),s=el(r,u,-h,l)):this.face===Je.BACK?(r=Math.acos(-h),s=el(r,u,-c,l)):this.face===Je.LEFT?(r=Math.acos(-c),s=el(r,u,h,l)):(r=s=0,l.value=Ge.AREA_0)}return a=Math.atan(12/rt*(s+Math.acos(Math.sin(s)*Math.cos(De))-O)),o=Math.sqrt((1-Math.cos(r))/(Math.cos(a)*Math.cos(a))/(1-Math.cos(Math.atan(1/Math.cos(s))))),l.value===Ge.AREA_1?a+=O:l.value===Ge.AREA_2?a+=rt:l.value===Ge.AREA_3&&(a+=1.5*rt),e.x=o*Math.cos(a),e.y=o*Math.sin(a),e.x=e.x*this.a+this.x0,e.y=e.y*this.a+this.y0,i.x=e.x,i.y=e.y,i}function Jb(i){var e={lam:0,phi:0},t,n,s,r,o,a,l,h,c,u={value:0};if(i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,n=Math.atan(Math.sqrt(i.x*i.x+i.y*i.y)),t=Math.atan2(i.y,i.x),i.x>=0&&i.x>=Math.abs(i.y)?u.value=Ge.AREA_0:i.y>=0&&i.y>=Math.abs(i.x)?(u.value=Ge.AREA_1,t-=O):i.x<0&&-i.x>=Math.abs(i.y)?(u.value=Ge.AREA_2,t=t<0?t+rt:t-rt):(u.value=Ge.AREA_3,t+=O),c=rt/12*Math.tan(t),o=Math.sin(c)/(Math.cos(c)-1/Math.sqrt(2)),a=Math.atan(o),s=Math.cos(t),r=Math.tan(n),l=1-s*s*r*r*(1-Math.cos(Math.atan(1/Math.cos(a)))),l<-1?l=-1:l>1&&(l=1),this.face===Je.TOP)h=Math.acos(l),e.phi=O-h,u.value===Ge.AREA_0?e.lam=a+O:u.value===Ge.AREA_1?e.lam=a<0?a+rt:a-rt:u.value===Ge.AREA_2?e.lam=a-O:e.lam=a;else if(this.face===Je.BOTTOM)h=Math.acos(l),e.phi=h-O,u.value===Ge.AREA_0?e.lam=-a+O:u.value===Ge.AREA_1?e.lam=-a:u.value===Ge.AREA_2?e.lam=-a-O:e.lam=a<0?-a-rt:-a+rt;else{var d,f,g;d=l,c=d*d,c>=1?g=0:g=Math.sqrt(1-c)*Math.sin(a),c+=g*g,c>=1?f=0:f=Math.sqrt(1-c),u.value===Ge.AREA_1?(c=f,f=-g,g=c):u.value===Ge.AREA_2?(f=-f,g=-g):u.value===Ge.AREA_3&&(c=f,f=g,g=-c),this.face===Je.RIGHT?(c=d,d=-f,f=c):this.face===Je.BACK?(d=-d,f=-f):this.face===Je.LEFT&&(c=d,d=f,f=-c),e.phi=Math.acos(-g)-O,e.lam=Math.atan2(f,d),this.face===Je.RIGHT?e.lam=Pr(e.lam,-O):this.face===Je.BACK?e.lam=Pr(e.lam,-rt):this.face===Je.LEFT&&(e.lam=Pr(e.lam,+O))}if(this.es!==0){var p,m,_;p=e.phi<0?1:0,m=Math.tan(e.phi),_=this.b/Math.sqrt(m*m+this.one_minus_f_squared),e.phi=Math.atan(Math.sqrt(this.a*this.a-_*_)/(this.one_minus_f*_)),p&&(e.phi=-e.phi)}return e.lam+=this.long0,i.x=e.lam,i.y=e.phi,i}function el(i,e,t,n){var s;return i<U?(n.value=Ge.AREA_0,s=0):(s=Math.atan2(e,t),Math.abs(s)<=De?n.value=Ge.AREA_0:s>De&&s<=O+De?(n.value=Ge.AREA_1,s-=O):s>O+De||s<=-(O+De)?(n.value=Ge.AREA_2,s=s>=0?s-rt:s+rt):(n.value=Ge.AREA_3,s+=O)),s}function Pr(i,e){var t=i+e;return t<-rt?t+=Ho:t>+rt&&(t-=Ho),t}var Qb=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const eE={init:Zb,forward:Kb,inverse:Jb,names:Qb};var bu=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Do=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],g0=.8487,p0=1.3523,m0=an/5,tE=1/m0,wr=18,jl=function(i,e){return i[0]+e*(i[1]+e*(i[2]+e*i[3]))},iE=function(i,e){return i[1]+e*(2*i[2]+e*3*i[3])};function nE(i,e,t,n){for(var s=e;n;--n){var r=i(s);if(s-=r,Math.abs(r)<t)break}return s}function sE(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function rE(i){var e=j(i.x-this.long0),t=Math.abs(i.y),n=Math.floor(t*m0);n<0?n=0:n>=wr&&(n=wr-1),t=an*(t-tE*n);var s={x:jl(bu[n],t)*e,y:jl(Do[n],t)};return i.y<0&&(s.y=-s.y),s.x=s.x*this.a*g0+this.x0,s.y=s.y*this.a*p0+this.y0,s}function oE(i){var e={x:(i.x-this.x0)/(this.a*g0),y:Math.abs(i.y-this.y0)/(this.a*p0)};if(e.y>=1)e.x/=bu[wr][0],e.y=i.y<0?-O:O;else{var t=Math.floor(e.y*wr);for(t<0?t=0:t>=wr&&(t=wr-1);;)if(Do[t][0]>e.y)--t;else if(Do[t+1][0]<=e.y)++t;else break;var n=Do[t],s=5*(e.y-n[0])/(Do[t+1][0]-n[0]);s=nE(function(r){return(jl(n,r)-e.y)/iE(n,r)},s,U,100),e.x/=jl(bu[t],s),e.y=(5*t+s)*St,i.y<0&&(e.y=-e.y)}return e.x=j(e.x+this.long0),e}var aE=["Robinson","robin"];const lE={init:sE,forward:rE,inverse:oE,names:aE};function hE(){this.name="geocent"}function cE(i){var e=t0(i,this.es,this.a);return e}function uE(i){var e=i0(i,this.es,this.a,this.b);return e}var dE=["Geocentric","geocentric","geocent","Geocent"];const fE={init:hE,forward:cE,inverse:uE,names:dE};var Nt={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},So={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function gE(){if(Object.keys(So).forEach((function(t){if(typeof this[t]>"u")this[t]=So[t].def;else{if(So[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);So[t].num&&(this[t]=parseFloat(this[t]))}So[t].degrees&&(this[t]=this[t]*St)}).bind(this)),Math.abs(Math.abs(this.lat0)-O)<U?this.mode=this.lat0<0?Nt.S_POLE:Nt.N_POLE:Math.abs(this.lat0)<U?this.mode=Nt.EQUIT:(this.mode=Nt.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var i=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(i),this.sw=Math.sin(i)}function pE(i){i.x-=this.long0;var e=Math.sin(i.y),t=Math.cos(i.y),n=Math.cos(i.x),s,r;switch(this.mode){case Nt.OBLIQ:r=this.sinph0*e+this.cosph0*t*n;break;case Nt.EQUIT:r=t*n;break;case Nt.S_POLE:r=-e;break;case Nt.N_POLE:r=e;break}switch(r=this.pn1/(this.p-r),s=r*t*Math.sin(i.x),this.mode){case Nt.OBLIQ:r*=this.cosph0*e-this.sinph0*t*n;break;case Nt.EQUIT:r*=e;break;case Nt.N_POLE:r*=-(t*n);break;case Nt.S_POLE:r*=t*n;break}var o,a;return o=r*this.cg+s*this.sg,a=1/(o*this.sw*this.h1+this.cw),s=(s*this.cg-r*this.sg)*this.cw*a,r=o*a,i.x=s*this.a,i.y=r*this.a,i}function mE(i){i.x/=this.a,i.y/=this.a;var e={x:i.x,y:i.y},t,n,s;s=1/(this.pn1-i.y*this.sw),t=this.pn1*i.x*s,n=this.pn1*i.y*this.cw*s,i.x=t*this.cg+n*this.sg,i.y=n*this.cg-t*this.sg;var r=$i(i.x,i.y);if(Math.abs(r)<U)e.x=0,e.y=i.y;else{var o,a;switch(a=1-r*r*this.pfact,a=(this.p-Math.sqrt(a))/(this.pn1/r+r/this.pn1),o=Math.sqrt(1-a*a),this.mode){case Nt.OBLIQ:e.y=Math.asin(o*this.sinph0+i.y*a*this.cosph0/r),i.y=(o-this.sinph0*Math.sin(e.y))*r,i.x*=a*this.cosph0;break;case Nt.EQUIT:e.y=Math.asin(i.y*a/r),i.y=o*r,i.x*=a;break;case Nt.N_POLE:e.y=Math.asin(o),i.y=-i.y;break;case Nt.S_POLE:e.y=-Math.asin(o);break}e.x=Math.atan2(i.x,i.y)}return i.x=e.x+this.long0,i.y=e.y,i}var yE=["Tilted_Perspective","tpers"];const _E={init:gE,forward:pE,inverse:mE,names:yE};function vE(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var i=1-this.es,e=1/i;this.radius_p=Math.sqrt(i),this.radius_p2=i,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function xE(i){var e=i.x,t=i.y,n,s,r,o;if(e=e-this.long0,this.shape==="ellipse"){t=Math.atan(this.radius_p2*Math.tan(t));var a=this.radius_p/$i(this.radius_p*Math.cos(t),Math.sin(t));if(s=a*Math.cos(e)*Math.cos(t),r=a*Math.sin(e)*Math.cos(t),o=a*Math.sin(t),(this.radius_g-s)*s-r*r-o*o*this.radius_p_inv2<0)return i.x=Number.NaN,i.y=Number.NaN,i;n=this.radius_g-s,this.flip_axis?(i.x=this.radius_g_1*Math.atan(r/$i(o,n)),i.y=this.radius_g_1*Math.atan(o/n)):(i.x=this.radius_g_1*Math.atan(r/n),i.y=this.radius_g_1*Math.atan(o/$i(r,n)))}else this.shape==="sphere"&&(n=Math.cos(t),s=Math.cos(e)*n,r=Math.sin(e)*n,o=Math.sin(t),n=this.radius_g-s,this.flip_axis?(i.x=this.radius_g_1*Math.atan(r/$i(o,n)),i.y=this.radius_g_1*Math.atan(o/n)):(i.x=this.radius_g_1*Math.atan(r/n),i.y=this.radius_g_1*Math.atan(o/$i(r,n))));return i.x=i.x*this.a,i.y=i.y*this.a,i}function wE(i){var e=-1,t=0,n=0,s,r,o,a;if(i.x=i.x/this.a,i.y=i.y/this.a,this.shape==="ellipse"){this.flip_axis?(n=Math.tan(i.y/this.radius_g_1),t=Math.tan(i.x/this.radius_g_1)*$i(1,n)):(t=Math.tan(i.x/this.radius_g_1),n=Math.tan(i.y/this.radius_g_1)*$i(1,t));var l=n/this.radius_p;if(s=t*t+l*l+e*e,r=2*this.radius_g*e,o=r*r-4*s*this.C,o<0)return i.x=Number.NaN,i.y=Number.NaN,i;a=(-r-Math.sqrt(o))/(2*s),e=this.radius_g+a*e,t*=a,n*=a,i.x=Math.atan2(t,e),i.y=Math.atan(n*Math.cos(i.x)/e),i.y=Math.atan(this.radius_p_inv2*Math.tan(i.y))}else if(this.shape==="sphere"){if(this.flip_axis?(n=Math.tan(i.y/this.radius_g_1),t=Math.tan(i.x/this.radius_g_1)*Math.sqrt(1+n*n)):(t=Math.tan(i.x/this.radius_g_1),n=Math.tan(i.y/this.radius_g_1)*Math.sqrt(1+t*t)),s=t*t+n*n+e*e,r=2*this.radius_g*e,o=r*r-4*s*this.C,o<0)return i.x=Number.NaN,i.y=Number.NaN,i;a=(-r-Math.sqrt(o))/(2*s),e=this.radius_g+a*e,t*=a,n*=a,i.x=Math.atan2(t,e),i.y=Math.atan(n*Math.cos(i.x)/e)}return i.x=i.x+this.long0,i}var bE=["Geostationary Satellite View","Geostationary_Satellite","geos"];const EE={init:vE,forward:xE,inverse:wE,names:bE};function ME(i){i.Proj.projections.add(Fl),i.Proj.projections.add(kl),i.Proj.projections.add(Lx),i.Proj.projections.add(Bx),i.Proj.projections.add(Vx),i.Proj.projections.add(Kx),i.Proj.projections.add(nw),i.Proj.projections.add(lw),i.Proj.projections.add(fw),i.Proj.projections.add(_w),i.Proj.projections.add(Ow),i.Proj.projections.add($w),i.Proj.projections.add(Vw),i.Proj.projections.add(Jw),i.Proj.projections.add(nb),i.Proj.projections.add(lb),i.Proj.projections.add(fb),i.Proj.projections.add(_b),i.Proj.projections.add(Mb),i.Proj.projections.add(Ib),i.Proj.projections.add(kb),i.Proj.projections.add(zb),i.Proj.projections.add(jb),i.Proj.projections.add(Hb),i.Proj.projections.add(eE),i.Proj.projections.add(lE),i.Proj.projections.add(fE),i.Proj.projections.add(_E),i.Proj.projections.add(EE)}Yt.defaultDatum="WGS84";Yt.Proj=cn;Yt.WGS84=new Yt.Proj("WGS84");Yt.Point=io;Yt.toPoint=n0;Yt.defs=qt;Yt.nadgrid=Av;Yt.transform=Ul;Yt.mgrs=Yv;Yt.version="__VERSION__";ME(Yt);const Bs={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class CE{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==void 0?e.extent:null,this.worldExtent_=e.worldExtent!==void 0?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==void 0?e.axisOrientation:"enu",this.global_=e.global!==void 0?e.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Bs[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const Zh=CE,La=6378137,br=Math.PI*La,SE=[-br,-br,br,br],TE=[-180,-85,180,85],tl=La*Math.log(Math.tan(Math.PI/2));class tr extends Zh{constructor(e){super({code:e,units:"m",extent:SE,global:!0,worldExtent:TE,getPointResolution:function(t,n){return t/Math.cosh(n[1]/La)}})}}const Ug=[new tr("EPSG:3857"),new tr("EPSG:102100"),new tr("EPSG:102113"),new tr("EPSG:900913"),new tr("http://www.opengis.net/def/crs/EPSG/0/3857"),new tr("http://www.opengis.net/gml/srs/epsg.xml#3857")];function RE(i,e,t){const n=i.length;t=t>1?t:2,e===void 0&&(t>2?e=i.slice():e=new Array(n));for(let s=0;s<n;s+=t){e[s]=br*i[s]/180;let r=La*Math.log(Math.tan(Math.PI*(+i[s+1]+90)/360));r>tl?r=tl:r<-tl&&(r=-tl),e[s+1]=r}return e}function IE(i,e,t){const n=i.length;t=t>1?t:2,e===void 0&&(t>2?e=i.slice():e=new Array(n));for(let s=0;s<n;s+=t)e[s]=180*i[s]/br,e[s+1]=360*Math.atan(Math.exp(i[s+1]/La))/Math.PI-90;return e}const LE=6378137,qg=[-180,-90,180,90],PE=Math.PI*LE/180;class ws extends Zh{constructor(e,t){super({code:e,units:"degrees",extent:qg,axisOrientation:t,global:!0,metersPerUnit:PE,worldExtent:qg})}}const jg=[new ws("CRS:84"),new ws("EPSG:4326","neu"),new ws("urn:ogc:def:crs:OGC:1.3:CRS84"),new ws("urn:ogc:def:crs:OGC:2:84"),new ws("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new ws("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new ws("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Eu={};function AE(i){return Eu[i]||Eu[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function FE(i,e){Eu[i]=e}function Pa(i){for(const e in i)delete i[e]}function hs(i){let e;for(e in i)return!1;return!e}let Ar={};function so(i,e,t){const n=i.getCode(),s=e.getCode();n in Ar||(Ar[n]={}),Ar[n][s]=t}function y0(i,e){let t;return i in Ar&&e in Ar[i]&&(t=Ar[i][e]),t}const xt={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function wt(i){const e=_i();for(let t=0,n=i.length;t<n;++t)qo(e,i[t]);return e}function kE(i,e,t){const n=Math.min.apply(null,i),s=Math.min.apply(null,e),r=Math.max.apply(null,i),o=Math.max.apply(null,e);return Fi(n,s,r,o,t)}function Vi(i,e,t){return t?(t[0]=i[0]-e,t[1]=i[1]-e,t[2]=i[2]+e,t[3]=i[3]+e,t):[i[0]-e,i[1]-e,i[2]+e,i[3]+e]}function _0(i,e){return e?(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e):i.slice()}function Xs(i,e,t){let n,s;return e<i[0]?n=i[0]-e:i[2]<e?n=e-i[2]:n=0,t<i[1]?s=i[1]-t:i[3]<t?s=t-i[3]:s=0,n*n+s*s}function Aa(i,e){return Sd(i,e[0],e[1])}function qi(i,e){return i[0]<=e[0]&&e[2]<=i[2]&&i[1]<=e[1]&&e[3]<=i[3]}function Sd(i,e,t){return i[0]<=e&&e<=i[2]&&i[1]<=t&&t<=i[3]}function Mu(i,e){const t=i[0],n=i[1],s=i[2],r=i[3],o=e[0],a=e[1];let l=xt.UNKNOWN;return o<t?l=l|xt.LEFT:o>s&&(l=l|xt.RIGHT),a<n?l=l|xt.BELOW:a>r&&(l=l|xt.ABOVE),l===xt.UNKNOWN&&(l=xt.INTERSECTING),l}function _i(){return[1/0,1/0,-1/0,-1/0]}function Fi(i,e,t,n,s){return s?(s[0]=i,s[1]=e,s[2]=t,s[3]=n,s):[i,e,t,n]}function po(i){return Fi(1/0,1/0,-1/0,-1/0,i)}function Uo(i,e){const t=i[0],n=i[1];return Fi(t,n,t,n,e)}function Td(i,e,t,n,s){const r=po(s);return x0(r,i,e,t,n)}function $s(i,e){return i[0]==e[0]&&i[2]==e[2]&&i[1]==e[1]&&i[3]==e[3]}function v0(i,e){return e[0]<i[0]&&(i[0]=e[0]),e[2]>i[2]&&(i[2]=e[2]),e[1]<i[1]&&(i[1]=e[1]),e[3]>i[3]&&(i[3]=e[3]),i}function qo(i,e){e[0]<i[0]&&(i[0]=e[0]),e[0]>i[2]&&(i[2]=e[0]),e[1]<i[1]&&(i[1]=e[1]),e[1]>i[3]&&(i[3]=e[1])}function x0(i,e,t,n,s){for(;t<n;t+=s)OE(i,e[t],e[t+1]);return i}function OE(i,e,t){i[0]=Math.min(i[0],e),i[1]=Math.min(i[1],t),i[2]=Math.max(i[2],e),i[3]=Math.max(i[3],t)}function Rd(i,e){let t;return t=e(ro(i)),t||(t=e(Fa(i)),t)||(t=e(ka(i)),t)||(t=e(yn(i)),t)?t:!1}function Cu(i){let e=0;return Ys(i)||(e=Re(i)*_t(i)),e}function ro(i){return[i[0],i[1]]}function Fa(i){return[i[2],i[1]]}function pi(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function NE(i,e){let t;if(e==="bottom-left")t=ro(i);else if(e==="bottom-right")t=Fa(i);else if(e==="top-left")t=yn(i);else if(e==="top-right")t=ka(i);else throw new Error("Invalid corner");return t}function Jo(i,e,t,n,s){const[r,o,a,l,h,c,u,d]=Su(i,e,t,n);return Fi(Math.min(r,a,h,u),Math.min(o,l,c,d),Math.max(r,a,h,u),Math.max(o,l,c,d),s)}function Su(i,e,t,n){const s=e*n[0]/2,r=e*n[1]/2,o=Math.cos(t),a=Math.sin(t),l=s*o,h=s*a,c=r*o,u=r*a,d=i[0],f=i[1];return[d-l+u,f-h-c,d-l-u,f-h+c,d+l-u,f+h+c,d+l+u,f+h-c,d-l+u,f-h-c]}function _t(i){return i[3]-i[1]}function Tn(i,e,t){const n=t||_i();return Qe(i,e)?(i[0]>e[0]?n[0]=i[0]:n[0]=e[0],i[1]>e[1]?n[1]=i[1]:n[1]=e[1],i[2]<e[2]?n[2]=i[2]:n[2]=e[2],i[3]<e[3]?n[3]=i[3]:n[3]=e[3]):po(n),n}function yn(i){return[i[0],i[3]]}function ka(i){return[i[2],i[3]]}function Re(i){return i[2]-i[0]}function Qe(i,e){return i[0]<=e[2]&&i[2]>=e[0]&&i[1]<=e[3]&&i[3]>=e[1]}function Ys(i){return i[2]<i[0]||i[3]<i[1]}function DE(i,e){return e?(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e):i}function GE(i,e,t){let n=!1;const s=Mu(i,e),r=Mu(i,t);if(s===xt.INTERSECTING||r===xt.INTERSECTING)n=!0;else{const o=i[0],a=i[1],l=i[2],h=i[3],c=e[0],u=e[1],d=t[0],f=t[1],g=(f-u)/(d-c);let p,m;r&xt.ABOVE&&!(s&xt.ABOVE)&&(p=d-(f-h)/g,n=p>=o&&p<=l),!n&&r&xt.RIGHT&&!(s&xt.RIGHT)&&(m=f-(d-l)*g,n=m>=a&&m<=h),!n&&r&xt.BELOW&&!(s&xt.BELOW)&&(p=d-(f-a)/g,n=p>=o&&p<=l),!n&&r&xt.LEFT&&!(s&xt.LEFT)&&(m=f-(d-o)*g,n=m>=a&&m<=h)}return n}function w0(i,e,t,n){if(Ys(i))return po(t);let s=[];if(n>1){const a=i[2]-i[0],l=i[3]-i[1];for(let h=0;h<n;++h)s.push(i[0]+a*h/n,i[1],i[2],i[1]+l*h/n,i[2]-a*h/n,i[3],i[0],i[3]-l*h/n)}else s=[i[0],i[1],i[2],i[1],i[2],i[3],i[0],i[3]];e(s,s,2);const r=[],o=[];for(let a=0,l=s.length;a<l;a+=2)r.push(s[a]),o.push(s[a+1]);return kE(r,o,t)}function b0(i,e){const t=e.getExtent(),n=pi(i);if(e.canWrapX()&&(n[0]<t[0]||n[0]>=t[2])){const s=Re(t),o=Math.floor((n[0]-t[0])/s)*s;i[0]-=o,i[2]-=o}return i}function zE(i,e){if(e.canWrapX()){const t=e.getExtent();if(!isFinite(i[0])||!isFinite(i[2]))return[[t[0],i[1],t[2],i[3]]];b0(i,e);const n=Re(t);if(Re(i)>n)return[[t[0],i[1],t[2],i[3]]];if(i[0]<t[0])return[[i[0]+n,i[1],t[2],i[3]],[t[0],i[1],i[2],i[3]]];if(i[2]>t[2])return[[i[0],i[1],t[2],i[3]],[t[0],i[1],i[2]-n,i[3]]]}return[i]}function et(i,e,t){return Math.min(Math.max(i,e),t)}function BE(i,e,t,n,s,r){const o=s-t,a=r-n;if(o!==0||a!==0){const l=((i-t)*o+(e-n)*a)/(o*o+a*a);l>1?(t=s,n=r):l>0&&(t+=o*l,n+=a*l)}return Rn(i,e,t,n)}function Rn(i,e,t,n){const s=t-i,r=n-e;return s*s+r*r}function $E(i){const e=i.length;for(let n=0;n<e;n++){let s=n,r=Math.abs(i[n][n]);for(let a=n+1;a<e;a++){const l=Math.abs(i[a][n]);l>r&&(r=l,s=a)}if(r===0)return null;const o=i[s];i[s]=i[n],i[n]=o;for(let a=n+1;a<e;a++){const l=-i[a][n]/i[n][n];for(let h=n;h<e+1;h++)n==h?i[a][h]=0:i[a][h]+=l*i[n][h]}}const t=new Array(e);for(let n=e-1;n>=0;n--){t[n]=i[n][e]/i[n][n];for(let s=n-1;s>=0;s--)i[s][e]-=i[s][n]*t[n]}return t}function Wg(i){return i*180/Math.PI}function ks(i){return i*Math.PI/180}function Os(i,e){const t=i%e;return t*e<0?t+e:t}function ci(i,e,t){return i+t*(e-i)}function Oa(i,e){const t=Math.pow(10,e);return Math.round(i*t)/t}function Vg(i,e){return Math.round(Oa(i,e))}function Er(i,e){return Math.floor(Oa(i,e))}function Hn(i,e){return Math.ceil(Oa(i,e))}function E0(i,e){const t=(""+i).split("."),n=(""+e).split(".");for(let s=0;s<Math.max(t.length,n.length);s++){const r=parseInt(t[s]||"0",10),o=parseInt(n[s]||"0",10);if(r>o)return 1;if(o>r)return-1}return 0}function UE(i,e){return i[0]+=+e[0],i[1]+=+e[1],i}function qE(i,e){const t=e.getRadius(),n=e.getCenter(),s=n[0],r=n[1],o=i[0],a=i[1];let l=o-s;const h=a-r;l===0&&h===0&&(l=1);const c=Math.sqrt(l*l+h*h),u=s+t*l/c,d=r+t*h/c;return[u,d]}function Id(i,e){const t=i[0],n=i[1],s=e[0],r=e[1],o=s[0],a=s[1],l=r[0],h=r[1],c=l-o,u=h-a,d=c===0&&u===0?0:(c*(t-o)+u*(n-a))/(c*c+u*u||0);let f,g;return d<=0?(f=o,g=a):d>=1?(f=l,g=h):(f=o+d*c,g=a+d*u),[f,g]}function Bi(i,e){let t=!0;for(let n=i.length-1;n>=0;--n)if(i[n]!=e[n]){t=!1;break}return t}function Ld(i,e){const t=Math.cos(e),n=Math.sin(e),s=i[0]*t-i[1]*n,r=i[1]*t+i[0]*n;return i[0]=s,i[1]=r,i}function jE(i,e){return i[0]*=e,i[1]*=e,i}function un(i,e){const t=i[0]-e[0],n=i[1]-e[1];return t*t+n*n}function Wl(i,e){return Math.sqrt(un(i,e))}function WE(i,e){return un(i,Id(i,e))}function Pd(i,e){if(e.canWrapX()){const t=Re(e.getExtent()),n=M0(i,e,t);n&&(i[0]-=n*t)}return i}function M0(i,e,t){const n=e.getExtent();let s=0;return e.canWrapX()&&(i[0]<n[0]||i[0]>n[2])&&(t=t||Re(n),s=Math.floor((i[0]-n[0])/t)),s}const C0=63710088e-1;function Xg(i,e,t){t=t||C0;const n=ks(i[1]),s=ks(e[1]),r=(s-n)/2,o=ks(e[0]-i[0])/2,a=Math.sin(r)*Math.sin(r)+Math.sin(o)*Math.sin(o)*Math.cos(n)*Math.cos(s);return 2*t*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function VE(i,e,t,n){n=n||C0;const s=ks(i[1]),r=ks(i[0]),o=e/n,a=Math.asin(Math.sin(s)*Math.cos(o)+Math.cos(s)*Math.sin(o)*Math.cos(t)),l=r+Math.atan2(Math.sin(t)*Math.sin(o)*Math.cos(s),Math.cos(o)-Math.sin(s)*Math.sin(a));return[Wg(l),Wg(a)]}const S0={info:1,warn:2,error:3,none:4};let XE=S0.info;function T0(...i){XE>S0.warn||console.warn(...i)}let Tu=!0;function R0(i){Tu=!(i===void 0?!0:i)}function Ad(i,e){if(e!==void 0){for(let t=0,n=i.length;t<n;++t)e[t]=i[t];e=e}else e=i.slice();return e}function I0(i,e){if(e!==void 0&&i!==e){for(let t=0,n=i.length;t<n;++t)e[t]=i[t];i=e}return i}function L0(i){FE(i.getCode(),i),so(i,i,Ad)}function YE(i){i.forEach(L0)}function K(i){return typeof i=="string"?AE(i):i||null}function Vl(i,e,t,n){i=K(i);let s;const r=i.getPointResolutionFunc();if(r){if(s=r(e,t),n&&n!==i.getUnits()){const o=i.getMetersPerUnit();o&&(s=s*o/Bs[n])}}else{const o=i.getUnits();if(o=="degrees"&&!n||n=="degrees")s=e;else{const a=Kh(i,K("EPSG:4326"));if(a===I0&&o!=="degrees")s=e*i.getMetersPerUnit();else{let h=[t[0]-e/2,t[1],t[0]+e/2,t[1],t[0],t[1]-e/2,t[0],t[1]+e/2];h=a(h,h,2);const c=Xg(h.slice(0,2),h.slice(2,4)),u=Xg(h.slice(4,6),h.slice(6,8));s=(c+u)/2}const l=n?Bs[n]:i.getMetersPerUnit();l!==void 0&&(s/=l)}}return s}function Ru(i){YE(i),i.forEach(function(e){i.forEach(function(t){e!==t&&so(e,t,Ad)})})}function HE(i,e,t,n){i.forEach(function(s){e.forEach(function(r){so(s,r,t),so(r,s,n)})})}function Fd(i,e){return i?typeof i=="string"?K(i):i:K(e)}function Yg(i){return function(e,t,n){const s=e.length;n=n!==void 0?n:2,t=t!==void 0?t:new Array(s);for(let r=0;r<s;r+=n){const o=i(e.slice(r,r+n)),a=o.length;for(let l=0,h=n;l<h;++l)t[r+l]=l>=a?e[r+l]:o[l]}return t}}function ZE(i,e,t,n){const s=K(i),r=K(e);so(s,r,Yg(t)),so(r,s,Yg(n))}function Hg(i,e){return R0(),Fr(i,"EPSG:4326",e!==void 0?e:"EPSG:3857")}function ui(i,e){if(i===e)return!0;const t=i.getUnits()===e.getUnits();return(i.getCode()===e.getCode()||Kh(i,e)===Ad)&&t}function Kh(i,e){const t=i.getCode(),n=e.getCode();let s=y0(t,n);return s||(s=I0),s}function oo(i,e){const t=K(i),n=K(e);return Kh(t,n)}function Fr(i,e,t){return oo(e,t)(i,void 0,i.length)}function P0(i,e,t,n){const s=oo(e,t);return w0(i,s,void 0,n)}function Us(i,e){return i}function je(i,e){return Tu&&!Bi(i,[0,0])&&i[0]>=-180&&i[0]<=180&&i[1]>=-90&&i[1]<=90&&(Tu=!1,T0("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),i}function Jh(i,e){return i}function ln(i,e){return i}function Zg(i,e,t){return function(n){let s,r;if(i.canWrapX()){const o=i.getExtent(),a=Re(o);n=n.slice(0),r=M0(n,i,a),r&&(n[0]=n[0]-r*a),n[0]=et(n[0],o[0],o[2]),n[1]=et(n[1],o[1],o[3]),s=t(n)}else s=t(n);return r&&e.canWrapX()&&(s[0]+=r*Re(e.getExtent())),s}}function KE(){Ru(Ug),Ru(jg),HE(jg,Ug,RE,IE)}KE();let JE=null;function QE(i){JE=i;const e=Object.keys(i.defs),t=e.length;let n,s;for(n=0;n<t;++n){const r=e[n];if(!K(r)){const o=i.defs(r);let a=o.units;!a&&o.projName==="longlat"&&(a="degrees"),L0(new Zh({code:r,axisOrientation:o.axis,metersPerUnit:o.to_meter,units:a}))}}for(n=0;n<t;++n){const r=e[n],o=K(r);for(s=0;s<t;++s){const a=e[s],l=K(a);if(!y0(r,a))if(i.defs[r]===i.defs[a])Ru([o,l]);else{const h=i(r,a);ZE(o,l,Zg(o,l,h.forward),Zg(l,o,h.inverse))}}}}const zi=class zi{constructor(e){if(!(e in zi.initializingSingletons)||!zi.initializingSingletons[e])throw new Error("This is a singleton. Please use the getInstance() method.")}static getInstance(){const e=this.name;if(!(e in zi.instances)){zi.initializingSingletons[e]=!0;try{console.log(`Creating Singleton ${e}`);const t=new this(e);zi.instances[e]=t}finally{zi.initializingSingletons[e]=!1}}return zi.instances[e]}isNullOrUndefined(e){return e==null}isNullOrUndefinedOrBlank(e){return e==null||e===""}};v(zi,"instances",{}),v(zi,"initializingSingletons",{});let mn=zi;class eM{constructor(e){v(this,"general");v(this,"languages");v(this,"themes");v(this,"basemaps");v(this,"treeview");v(this,"search");v(this,"print");v(this,"selection");v(this,"redlining");v(this,"projections");v(this,"map");v(this,"map3d");if(!e.general||!e.general.locale)throw new Error("general.locale is required");if(this.general={locale:e.general.locale},!e.languages)throw new Error("languages is required");if(this.languages=e.languages,!e.themes||!e.themes.url)throw new Error("themes.url is required");if(this.themes={url:e.themes.url,defaultTheme:e.themes.defaultTheme,imagesUrlPrefix:e.themes.imagesUrlPrefix??""},!e.basemaps||!e.basemaps.defaultBasemap)throw new Error("basemaps.defaultBasemap is required");if(this.basemaps={show:e.basemaps.show??!0,defaultBasemap:e.basemaps.defaultBasemap,OSM:e.basemaps.OSM??!1,SwissTopoVectorTiles:e.basemaps.SwissTopoVectorTiles??!1},this.treeview={useCheckboxes:e.treeview.useCheckboxes??!1,useLegendIcons:e.treeview.useLegendIcons??!1,hideLegendWhenLayerIsDeactivated:e.treeview.hideLegendWhenLayerIsDeactivated??!1,defaultIconSize:{height:e.treeview.defaultIconSize.height??20,width:e.treeview.defaultIconSize.width??20}},!e.search)throw new Error("search is required");this.search=e.search;try{e.print.url.length===0&&console.warn("Your print.url is not configured, print will not work"),e.print.defaultLayout.length===0&&console.warn("Your print.defaultLayout is not configured, print will not work")}catch{console.warn("print.url and print.defaultLayout are required")}if(this.print=e.print,e.selection||(e.selection={defaultFillColor:"#ff66667f",defaultStrokeColor:"#ff3333",defaultStrokeWidth:4,defaultFocusFillColor:"#ff33337f",defaultFocusStrokeColor:"#ff0000",defaultFocusStrokeWidth:4}),this.selection=e.selection,e.redlining||(e.redlining={defaultFillColor:"#6666ff7f",defaultStrokeColor:"#0000ff",defaultStrokeWidth:2,defaultTextSize:12,defaultFont:"Arial"}),this.redlining=e.redlining,!e.projections)throw new Error("projections is required");if(this.projections=e.projections,!e.map.srid)throw new Error("map.srid is required");if(!e.map.scales)throw new Error("map.scales is required");if(e.map.startZoom||(e.map.startZoom="4"),!e.map.maxExtent)throw new Error("map.maxExtent is required");e.map.constraintScales||(e.map.constraintScales=!1),this.map=e.map,this.map3d=e.map3d}}var $r,Ur;const nn=class nn extends mn{get Config(){return Z(nn,$r)}async loadConfig(){if(Z(nn,Ur))await new Promise(e=>setTimeout(e,100)),await this.loadConfig();else{Ke(nn,Ur,!0);try{if(!Z(nn,$r)){console.log("Loading Application Configuration...");const t=await(await fetch("config.json")).json(),n=new eM(t);Ke(nn,$r,n),console.log("Application Configuration loaded.")}}catch(e){console.error("Error loading application configuration:",e)}finally{Ke(nn,Ur,!1)}}}};$r=new WeakMap,Ur=new WeakMap,re(nn,$r,void 0),re(nn,Ur,!1);let kn=nn;class A0{constructor(){v(this,"center",[]);v(this,"zoom",null);v(this,"resolution",100);v(this,"scale",0)}get isValid(){return!(Number.isNaN(this.resolution)||!this.center[0]||!this.center[1]||Number.isNaN(this.center[0])||Number.isNaN(this.center[1]))}}class tM{constructor(){v(this,"themes",{});v(this,"basemaps",{});v(this,"ogcServers",{});v(this,"activeBasemap",null);v(this,"projection",null);v(this,"mouseCoordinates",[]);v(this,"interface",{helpVisible:!1,redliningPanelVisible:!1,printPanelVisible:!1,selectionGridVisible:!1,aboutVisible:!1,darkMode:!1,darkFrontendMode:!1});v(this,"language",null);v(this,"loading",!1);v(this,"position",new A0);v(this,"selectedTheme",null);v(this,"layers",{layersList:[],swipedLayers:{left:[],right:[]}});v(this,"redlining",{activeTool:null,features:[]});v(this,"treeview",{advanced:!1});v(this,"print",{format:null,scale:null});v(this,"globe",{display:"none"});v(this,"olMap",null);v(this,"selection",{selectionParameters:[],selectedFeatures:[],focusedFeature:null});v(this,"theme",null);v(this,"extendedState",{})}}const To=".",kd=Symbol("target"),F0=Symbol("unsubscribe");function Iu(i){return i instanceof Date||i instanceof Set||i instanceof Map||i instanceof WeakSet||i instanceof WeakMap||ArrayBuffer.isView(i)}function iM(i){return(typeof i=="object"?i===null:typeof i!="function")||i instanceof RegExp}const sn=Array.isArray;function Od(i){return typeof i=="symbol"}const Ii={after:(i,e)=>sn(i)?i.slice(e.length):e===""?i:i.slice(e.length+1),concat:(i,e)=>sn(i)?(i=[...i],e&&i.push(e),i):e&&e.toString!==void 0?(i!==""&&(i+=To),Od(e)?i+e.toString():i+e):i,initial:i=>{if(sn(i))return i.slice(0,-1);if(i==="")return i;const e=i.lastIndexOf(To);return e===-1?"":i.slice(0,e)},last:i=>{if(sn(i))return i[i.length-1]||"";if(i==="")return i;const e=i.lastIndexOf(To);return e===-1?i:i.slice(e+1)},walk:(i,e)=>{if(sn(i))for(const t of i)e(t);else if(i!==""){let t=0,n=i.indexOf(To);if(n===-1)e(i);else for(;t<i.length;)n===-1&&(n=i.length),e(i.slice(t,n)),t=n+1,n=i.indexOf(To,t)}},get(i,e){return this.walk(e,t=>{i&&(i=i[t])}),i}};function nM(i){return typeof i=="object"&&typeof i.next=="function"}function sM(i,e,t,n,s){const r=i.next;if(e.name==="entries")i.next=function(){const o=r.call(this);return o.done===!1&&(o.value[0]=s(o.value[0],e,o.value[0],n),o.value[1]=s(o.value[1],e,o.value[0],n)),o};else if(e.name==="values"){const o=t[kd].keys();i.next=function(){const a=r.call(this);return a.done===!1&&(a.value=s(a.value,e,o.next().value,n)),a}}else i.next=function(){const o=r.call(this);return o.done===!1&&(o.value=s(o.value,e,o.value,n)),o};return i}function Kg(i,e,t){return i.isUnsubscribed||e.ignoreSymbols&&Od(t)||e.ignoreUnderscores&&t.charAt(0)==="_"||"ignoreKeys"in e&&e.ignoreKeys.includes(t)}class rM{constructor(e){this._equals=e,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return this._descriptorCache===void 0&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(e){const t=this._getDescriptorCache();let n=t.get(e);return n===void 0&&(n={},t.set(e,n)),n}_getOwnPropertyDescriptor(e,t){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(e,t);const n=this._getProperties(e);let s=n[t];return s===void 0&&(s=Reflect.getOwnPropertyDescriptor(e,t),n[t]=s),s}getProxy(e,t,n,s){if(this.isUnsubscribed)return e;const r=e[s],o=r||e;this._pathCache.set(o,t);let a=this._proxyCache.get(o);return a===void 0&&(a=r===void 0?new Proxy(e,n):e,this._proxyCache.set(o,a)),a}getPath(e){return this.isUnsubscribed?void 0:this._pathCache.get(e)}isDetached(e,t){return!Object.is(e,Ii.get(t,this.getPath(e)))}defineProperty(e,t,n){return Reflect.defineProperty(e,t,n)?(this.isUnsubscribed||(this._getProperties(e)[t]=n),!0):!1}setProperty(e,t,n,s,r){if(!this._equals(r,n)||!(t in e)){const o=this._getOwnPropertyDescriptor(e,t);return o!==void 0&&"set"in o?Reflect.set(e,t,n,s):Reflect.set(e,t,n)}return!0}deleteProperty(e,t,n){if(Reflect.deleteProperty(e,t)){if(!this.isUnsubscribed){const s=this._getDescriptorCache().get(e);s&&(delete s[t],this._pathCache.delete(n))}return!0}return!1}isSameDescriptor(e,t,n){const s=this._getOwnPropertyDescriptor(t,n);return e!==void 0&&s!==void 0&&Object.is(e.value,s.value)&&(e.writable||!1)===(s.writable||!1)&&(e.enumerable||!1)===(s.enumerable||!1)&&(e.configurable||!1)===(s.configurable||!1)&&e.get===s.get&&e.set===s.set}isGetInvariant(e,t){const n=this._getOwnPropertyDescriptor(e,t);return n!==void 0&&n.configurable!==!0&&n.writable!==!0}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}}function Lu(i){return toString.call(i)==="[object Object]"}function il(){return!0}function ir(i,e){return i.length!==e.length||i.some((t,n)=>e[n]!==t)}const k0=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),oM=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),O0={push:il,pop:il,shift:il,unshift:il,copyWithin:ir,reverse:ir,sort:ir,splice:ir,flat:ir,fill:ir},aM=new Set([...k0,...oM,...Object.keys(O0)]);function nl(i,e){if(i.size!==e.size)return!0;for(const t of i)if(!e.has(t))return!0;return!1}const N0=["keys","values","entries"],D0=new Set(["has","toString"]),G0={add:nl,clear:nl,delete:nl,forEach:nl},lM=new Set([...D0,...Object.keys(G0),...N0]);function sl(i,e){if(i.size!==e.size)return!0;let t;for(const[n,s]of i)if(t=e.get(n),t!==s||t===void 0&&!e.has(n))return!0;return!1}const hM=new Set([...D0,"get"]),z0={set:sl,clear:sl,delete:sl,forEach:sl},cM=new Set([...hM,...Object.keys(z0),...N0]);class cs{constructor(e,t,n,s){this._path=t,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=s,this._changes=s?[]:null,this.clone=t===void 0?e:this._shallowClone(e)}static isHandledMethod(e){return k0.has(e)}_shallowClone(e){let t=e;if(Lu(e))t={...e};else if(sn(e)||ArrayBuffer.isView(e))t=[...e];else if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set([...e].map(n=>this._shallowClone(n)));else if(e instanceof Map){t=new Map;for(const[n,s]of e.entries())t.set(n,this._shallowClone(s))}return this._clonedCache.add(t),t}preferredThisArg(e,t,n,s){return e?(sn(s)?this._onIsChanged=O0[t]:s instanceof Set?this._onIsChanged=G0[t]:s instanceof Map&&(this._onIsChanged=z0[t]),s):n}update(e,t,n){const s=Ii.after(e,this._path);if(t!=="length"){let r=this.clone;Ii.walk(s,o=>{r&&r[o]&&(this._clonedCache.has(r[o])||(r[o]=this._shallowClone(r[o])),r=r[o])}),this._hasOnValidate&&this._changes.push({path:s,property:t,previous:n}),r&&r[t]&&(r[t]=n)}this._isChanged=!0}undo(e){let t;for(let n=this._changes.length-1;n!==-1;n--)t=this._changes[n],Ii.get(e,t.path)[t.property]=t.previous}isChanged(e){return this._onIsChanged===void 0?this._isChanged:this._onIsChanged(this.clone,e)}}class Jg extends cs{static isHandledMethod(e){return aM.has(e)}}class uM extends cs{undo(e){e.setTime(this.clone.getTime())}isChanged(e,t){return!t(this.clone.valueOf(),e.valueOf())}}class Qg extends cs{static isHandledMethod(e){return lM.has(e)}undo(e){for(const t of this.clone)e.add(t);for(const t of e)this.clone.has(t)||e.delete(t)}}class ep extends cs{static isHandledMethod(e){return cM.has(e)}undo(e){for(const[t,n]of this.clone.entries())e.set(t,n);for(const t of e.keys())this.clone.has(t)||e.delete(t)}}class dM extends cs{constructor(e,t,n,s){super(void 0,t,n,s),this._arg1=n[0],this._weakValue=e.has(this._arg1)}isChanged(e){return this._weakValue!==e.has(this._arg1)}undo(e){this._weakValue&&!e.has(this._arg1)?e.add(this._arg1):e.delete(this._arg1)}}class fM extends cs{constructor(e,t,n,s){super(void 0,t,n,s),this._weakKey=n[0],this._weakHas=e.has(this._weakKey),this._weakValue=e.get(this._weakKey)}isChanged(e){return this._weakValue!==e.get(this._weakKey)}undo(e){const t=e.has(this._weakKey);this._weakHas&&!t?e.set(this._weakKey,this._weakValue):!this._weakHas&&t?e.delete(this._weakKey):this._weakValue!==e.get(this._weakKey)&&e.set(this._weakKey,this._weakValue)}}class Rs{constructor(e){this._stack=[],this._hasOnValidate=e}static isHandledType(e){return Lu(e)||sn(e)||Iu(e)}static isHandledMethod(e,t){return Lu(e)?cs.isHandledMethod(t):sn(e)?Jg.isHandledMethod(t):e instanceof Set?Qg.isHandledMethod(t):e instanceof Map?ep.isHandledMethod(t):Iu(e)}get isCloning(){return this._stack.length>0}start(e,t,n){let s=cs;sn(e)?s=Jg:e instanceof Date?s=uM:e instanceof Set?s=Qg:e instanceof Map?s=ep:e instanceof WeakSet?s=dM:e instanceof WeakMap&&(s=fM),this._stack.push(new s(e,t,n,this._hasOnValidate))}update(e,t,n){this._stack[this._stack.length-1].update(e,t,n)}preferredThisArg(e,t,n){const{name:s}=e,r=Rs.isHandledMethod(n,s);return this._stack[this._stack.length-1].preferredThisArg(r,s,t,n)}isChanged(e,t,n){return this._stack[this._stack.length-1].isChanged(e,t,n)}undo(e){this._previousClone!==void 0&&this._previousClone.undo(e)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}}const gM={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},Nd=(i,e,t={})=>{t={...gM,...t};const n=Symbol("ProxyTarget"),{equals:s,isShallow:r,ignoreDetached:o,details:a}=t,l=new rM(s),h=typeof t.onValidate=="function",c=new Rs(h),u=(y,x,w,b,E)=>!h||c.isCloning||t.onValidate(Ii.concat(l.getPath(y),x),w,b,E)===!0,d=(y,x,w,b)=>{!Kg(l,t,x)&&!(o&&l.isDetached(y,i))&&f(l.getPath(y),x,w,b)},f=(y,x,w,b,E)=>{c.isCloning?c.update(y,x,b):e(Ii.concat(y,x),w,b,E)},g=y=>y&&(y[n]||y),p=(y,x,w,b)=>iM(y)||w==="constructor"||r&&!Rs.isHandledMethod(x,w)||Kg(l,t,w)||l.isGetInvariant(x,w)||o&&l.isDetached(x,i)?y:(b===void 0&&(b=l.getPath(x)),l.getProxy(y,Ii.concat(b,w),m,n)),m={get(y,x,w){if(Od(x)){if(x===n||x===kd)return y;if(x===F0&&!l.isUnsubscribed&&l.getPath(y).length===0)return l.unsubscribe(),y}const b=Iu(y)?Reflect.get(y,x):Reflect.get(y,x,w);return p(b,y,x)},set(y,x,w,b){w=g(w);const E=y[n]||y,M=E[x];if(s(M,w)&&x in y)return!0;const C=u(y,x,w,M);return C&&l.setProperty(E,x,w,b,M)?(d(y,x,y[x],M),!0):!C},defineProperty(y,x,w){if(!l.isSameDescriptor(w,y,x)){const b=y[x];u(y,x,w.value,b)&&l.defineProperty(y,x,w,b)&&d(y,x,w.value,b)}return!0},deleteProperty(y,x){if(!Reflect.has(y,x))return!0;const w=Reflect.get(y,x),b=u(y,x,void 0,w);return b&&l.deleteProperty(y,x,w)?(d(y,x,void 0,w),!0):!b},apply(y,x,w){const b=x[n]||x;if(l.isUnsubscribed)return Reflect.apply(y,b,w);if((a===!1||a!==!0&&!a.includes(y.name))&&Rs.isHandledType(b)){let E=Ii.initial(l.getPath(y));const M=Rs.isHandledMethod(b,y.name);c.start(b,E,w);let C=Reflect.apply(y,c.preferredThisArg(y,x,b),M?w.map(D=>g(D)):w);const R=c.isChanged(b,s),N=c.stop();if(Rs.isHandledType(C)&&M&&(x instanceof Map&&y.name==="get"&&(E=Ii.concat(E,w[0])),C=l.getProxy(C,E,m)),R){const D={name:y.name,args:w,result:C},S=c.isCloning?Ii.initial(E):E,B=c.isCloning?Ii.last(E):"";u(Ii.get(i,S),B,b,N,D)?f(S,B,b,N,D):c.undo(b)}return(x instanceof Map||x instanceof Set)&&nM(C)?sM(C,y,x,E,p):C}return Reflect.apply(y,x,w)}},_=l.getProxy(i,t.pathAsArray?[]:"",m);return e=e.bind(_),h&&(t.onValidate=t.onValidate.bind(_)),_};Nd.target=i=>i&&i[kd]||i;Nd.unsubscribe=i=>i[F0]||i;var qr,fa,Ti;class Xi extends mn{constructor(t){super(t);re(this,qr,null);re(this,fa,void 0);re(this,Ti,{});v(this,"configManager",null);this.configManager=kn.getInstance(),Ke(this,qr,new tM),Ke(this,fa,Nd(Z(this,qr),(n,s,r,o)=>{this.areEqual(r,s)||(console.debug(`${n} has changed.`),this.onChange(n,r,s))})),Object.preventExtensions(Z(this,qr)),this.setDefaultValues()}get state(){return Z(this,fa)}setDefaultValues(){var t;(t=this.configManager)==null||t.loadConfig().then(()=>{var n;this.state&&((n=this.configManager)!=null&&n.Config)&&(this.state.projection=this.configManager.Config.map.srid,this.state.language=this.configManager.Config.languages.defaultLanguage)})}onChange(t,n,s){const r=t.trim();for(const o in Z(this,Ti)){const a=new RegExp("^"+o+"$");if(r.match(a)){const l=r.substring(0,r.lastIndexOf(".")),h=this.getPropertyByPath(this.state,l);h.found||console.warn("Parent object could not be found in the state");const c=Z(this,Ti)[o];for(const u of c)u(n,s,h.object)}}}subscribe(t,n){t in Z(this,Ti)||(Z(this,Ti)[t]=[]),Z(this,Ti)[t].push(n),console.debug(`Subscribing to ${t}. ${Z(this,Ti)[t].length} are currently subscribing ${t}.`);const s=this.getPropertyByPath(this.state,t);if(s.found&&!(s.object===null||s.object===void 0||Array.isArray(s.object)&&s.object.length===0||s.object instanceof Object&&Object.keys(s.object).length===0)){const r=t.substring(0,t.lastIndexOf(".")),o=this.getPropertyByPath(this.state,r);n(null,s.object,o)}}unsubscribe(t){for(const n in Z(this,Ti)){const s=Z(this,Ti)[n],r=s.indexOf(t);r!==-1&&(s.splice(r,1),console.debug(`Unsubscribing to ${n}. ${Z(this,Ti)[n].length} subscribtions remaining.`))}}getPropertyByPath(t,n){let s=t;if(n.trim()!==""){const r=n.split(".");for(const o of r)if(o in s)s=s[o];else return{found:!1,object:null}}return{found:!0,object:s}}getCircularReplacer(){const t=new WeakSet;return function(n,s){return typeof s!="object"||s===null?s:t.has(s)?"[Circular]":(t.add(s),s)}}areEqual(t,n){if(typeof t=="number"&&typeof n=="number")return Number.isNaN(t)&&Number.isNaN(n)?!0:t===n;if(typeof t!="object"||typeof n!="object"||t===null||n===null||t===void 0||n===void 0)return t===n;const s=Object.keys(t),r=Object.keys(n);return!(s.length!==r.length||JSON.stringify(t,this.getCircularReplacer())!==JSON.stringify(n,this.getCircularReplacer()))}}qr=new WeakMap,fa=new WeakMap,Ti=new WeakMap;var Ah,B0;class Xl extends mn{constructor(t){super(t);re(this,Ah);v(this,"translations",{});v(this,"loadingLanguagePromise",null);v(this,"configManager");v(this,"stateManager");this.configManager=kn.getInstance(),this.stateManager=Xi.getInstance()}getTranslation(t){var r,o;const n=((o=(r=this.stateManager)==null?void 0:r.state)==null?void 0:o.language)??"en",s=this.translations[n][t];return s??t}translate(t){this.stateManager.state&&this.stateManager.state.language&&le(this,Ah,B0).call(this,this.stateManager.state.language).then(()=>{t.querySelectorAll("[i18n]").forEach(s=>{const r=s.getAttribute("i18n");if(r){const o=this.getTranslation(r);s.hasAttribute("placeholder")?s.setAttribute("placeholder",o):s.innerHTML=o}})})}}Ah=new WeakSet,B0=async function(t){return this.loadingLanguagePromise?this.loadingLanguagePromise:t in this.translations?Promise.resolve(this.translations[t]):(this.loadingLanguagePromise=this.configManager.loadConfig().then(async()=>{if(this.configManager.Config&&this.configManager.Config.languages){const n=this.configManager.Config.languages[t],r=await(await fetch(n)).json();return this.translations[t]=r[t],this.loadingLanguagePromise=null,this.translations[t]}else throw new Error("No languages found in config.json")}),this.loadingLanguagePromise)};var qs=(i=>(i.CustomEventType="GeoGirafe.App",i.undoDraw="undoDraw",i.zoomToExtent="zoomToExtent",i))(qs||{});class Qh extends mn{constructor(){super(...arguments);v(this,"translations",null)}sendMessage(t){window.dispatchEvent(new CustomEvent(qs.CustomEventType,{bubbles:!0,cancelable:!1,composed:!0,detail:t}))}register(t){window.addEventListener(qs.CustomEventType,n=>{t(n.detail)})}}let rl;const pM=new Uint8Array(16);function mM(){if(!rl&&(rl=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!rl))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return rl(pM)}const Ct=[];for(let i=0;i<256;++i)Ct.push((i+256).toString(16).slice(1));function yM(i,e=0){return Ct[i[e+0]]+Ct[i[e+1]]+Ct[i[e+2]]+Ct[i[e+3]]+"-"+Ct[i[e+4]]+Ct[i[e+5]]+"-"+Ct[i[e+6]]+Ct[i[e+7]]+"-"+Ct[i[e+8]]+Ct[i[e+9]]+"-"+Ct[i[e+10]]+Ct[i[e+11]]+Ct[i[e+12]]+Ct[i[e+13]]+Ct[i[e+14]]+Ct[i[e+15]]}const _M=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),tp={randomUUID:_M};function $0(i,e,t){if(tp.randomUUID&&!e&&!i)return tp.randomUUID();i=i||{};const n=i.random||(i.rng||mM)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=n[s];return e}return yM(n)}let U0=class{constructor(e,t,n,s){v(this,"id");v(this,"treeItemId");v(this,"name");v(this,"order");v(this,"isDefaultChecked");v(this,"hasError",!1);v(this,"errorMessage",null);v(this,"parent",null);this.id=e,this.treeItemId=$0(),this.name=t,this.order=n,this.isDefaultChecked=s}},In=class extends U0{constructor(t,n){var r;const s=((r=t.metadata)==null?void 0:r.isChecked)??!1;super(t.id,t.name,n,s);v(this,"activeState","off");v(this,"opacity",1);v(this,"order",0);v(this,"basemap",!1)}get isTransparent(){return this.opacity!==1}get active(){return this.activeState==="on"}get inactive(){return this.activeState==="off"}};class Yl extends In{constructor(t,n){super(t,n);v(this,"style");v(this,"source");v(this,"projection");this.style=t.style,this.projection=t.projection,this.source=t.source}}class Rc{constructor(e){v(this,"id");v(this,"name");v(this,"layersList",[]);this.id=e.id,this.name=e.name}get projection(){return this.layersList[0]instanceof Yl&&this.layersList[0].projection?this.layersList[0].projection:null}}class vM{constructor(e){v(this,"id");v(this,"icon");v(this,"name");v(this,"location");v(this,"zoom");v(this,"favorite");v(this,"layersTree",[]);this.id=e.id,this.name=e.name,this.icon=e.icon,this.location=e.location,this.zoom=e.zoom,this.favorite=e.favorite}}class Qt extends U0{constructor(t,n){var o,a,l;const s=((o=t.metadata)==null?void 0:o.isChecked)??!1;super(t.id,t.name,n,s);v(this,"isExclusiveGroup");v(this,"isExpanded");v(this,"activeState","off");v(this,"children",[]);const r=((a=t.metadata)==null?void 0:a.isExpanded)??!1;this.isExpanded=r,this.isExclusiveGroup=((l=t.metadata)==null?void 0:l.exclusiveGroup)??!1}get active(){return this.activeState==="on"}get inactive(){return this.activeState==="off"}get semiActive(){return this.activeState==="semi"}}class Pu extends In{constructor(e,t){super(e,t)}}class ur extends In{constructor(t,n){if(!t.url||!t.layer)throw new Error("No URL or layer defined for WMTS layer "+t.name);super(t,n);v(this,"url");v(this,"layers");v(this,"dimensions");this.url=t.url,this.layers=t.layer,this.dimensions=t.dimensions??null}get layerUniqueId(){return this.dimensions!==null?this.layers+JSON.stringify(this.dimensions):this.name}}class dt extends In{constructor(t,n,s,r,o){super(t,o);v(this,"serverName");v(this,"url");v(this,"urlWfs");v(this,"imageType");v(this,"minResolution");v(this,"maxResolution");v(this,"layers");v(this,"legend");v(this,"iconUrl");v(this,"legendRule");v(this,"legendImage");v(this,"isLegendExpanded");v(this,"wasLegendExpanded");v(this,"queryable",!1);v(this,"queryLayers",null);v(this,"filter",null);this.serverName=n,this.url=s,this.urlWfs=r,this.imageType=t.imageType,this.minResolution=t.minResolutionHint,this.maxResolution=t.maxResolutionHint,this.legend=t.metadata.legend,this.iconUrl=t.metadata.iconUrl,this.legendRule=t.metadata.legendRule,this.legendImage=t.metadata.legendImage,this.isLegendExpanded=t.metadata.isLegendExpanded??!1,this.wasLegendExpanded=this.isLegendExpanded,t.childLayers&&(this.layers=t.layers,t.childLayers.length===0?console.warn(`WMS Layer ${t.name} has no defined child-layer`):(this.queryable=t.childLayers[0].queryable,this.queryLayers=this.queryable?t.childLayers.map(a=>a.name).join(","):"",this.queryable&&((!this.queryLayers||this.queryLayers.length==0)&&(this.hasError=!0,this.errorMessage="This layer is defined as queryable but no layer to query has been defined.",this.queryable=!1),(!this.urlWfs||this.urlWfs.length==0)&&(this.hasError=!0,this.errorMessage="This layer is defined as queryable but no Url for Wfs has been defined.",this.queryable=!1))))}hasRestrictedResolution(){return this.minResolution&&this.minResolution!==0||this.maxResolution&&this.maxResolution!==999999999}get hasFilter(){return this.filter!==null&&this.filter!==void 0&&this.filter!==""}get serverUniqueQueryId(){return this.serverName+this.imageType}}var ga,Au,pa,Fu,Fh,q0,ma,ku,kh,j0,Oh,W0,ya,Ou;class Na extends mn{constructor(t){super(t);re(this,ga);re(this,pa);re(this,Fh);re(this,ma);re(this,kh);re(this,Oh);re(this,ya);v(this,"configManager");v(this,"stateManager");v(this,"hideLegendWhenLayerIsDeactivated",!1);this.configManager=kn.getInstance(),this.stateManager=Xi.getInstance(),this.configManager.loadConfig().then(()=>{this.hideLegendWhenLayerIsDeactivated=this.configManager.Config.treeview.hideLegendWhenLayerIsDeactivated??!1}),this.stateManager.subscribe("layers.layersList..*.activeState",(n,s,r)=>this.onLayerToggled(r))}get state(){return this.stateManager.state}getTreeItem(t){const n=le(this,ga,Au).call(this,this.state.layers.layersList,t);if(n)return n;throw new Error(`BaseLayer ${t} not found !`)}activateIfDefaultChecked(t){t.isDefaultChecked&&this.toggle(t,"on")}initializeLegends(t){t.inactive&&this.hideLegendWhenLayerIsDeactivated&&(t.isLegendExpanded=!1)}toggle(t,n){t instanceof Qt?this.toggleGroup(t,n):t instanceof In&&this.toggleLayer(t,n)}onLayerToggled(t){t instanceof Qt?(le(this,ma,ku).call(this,t),le(this,pa,Fu).call(this,t),t.activeState!=="semi"&&le(this,Fh,q0).call(this,t,t.activeState)):t instanceof In&&(t instanceof dt&&this.hideLegendWhenLayerIsDeactivated&&(t.active?t.isLegendExpanded=t.wasLegendExpanded:(t.wasLegendExpanded=t.isLegendExpanded,t.isLegendExpanded=!1)),le(this,ma,ku).call(this,t),le(this,pa,Fu).call(this,t))}toggleLayer(t,n){if(!(t instanceof In))throw new Error("This method should only be called on leafs layers, not on groups");let s;n?s=n:t.activeState==="off"?s="on":s="off",t.activeState!=s&&(console.log(`Setting Layer ${t.name} to ${s}`),t.activeState=s)}toggleGroup(t,n){let s;n?s=n:t.activeState==="off"?s="on":s="off",t.activeState!=s&&(console.log(`Setting Group ${t.name} to ${s}`),t.activeState=s)}setError(t,n){t.hasError=!0,t.errorMessage=n,console.warn(t.errorMessage)}unsetError(t){t.hasError=!1,t.errorMessage=null}}ga=new WeakSet,Au=function(t,n){for(const s of t){if(s.treeItemId===n)return s;if(s instanceof Qt){const r=le(this,ga,Au).call(this,s.children,n);if(r)return r}}return null},pa=new WeakSet,Fu=function(t){t.parent&&(t.parent.isExclusiveGroup?le(this,ya,Ou).call(this,t.parent)?this.toggleGroup(t.parent,"on"):this.toggleGroup(t.parent,"off"):le(this,kh,j0).call(this,t.parent)?this.toggleGroup(t.parent,"on"):le(this,Oh,W0).call(this,t.parent)?this.toggleGroup(t.parent,"off"):this.toggleGroup(t.parent,"semi"))},Fh=new WeakSet,q0=function(t,n){if(t.active&&t.isExclusiveGroup&&t.children.length>=1)le(this,ya,Ou).call(this,t)||this.toggle(t.children[0],n);else for(const s of t.children)this.toggle(s,n)},ma=new WeakSet,ku=function(t){if((t.active||t instanceof Qt&&t.semiActive)&&t.parent!=null&&t.parent.isExclusiveGroup)for(const n of t.parent.children){const s=this.getTreeItem(n.treeItemId);s.treeItemId!==t.treeItemId&&(s.active||s instanceof Qt&&s.semiActive)&&this.toggle(s,"off")}},kh=new WeakSet,j0=function(t){let n=!0;for(const s of t.children)s.active||(n=!1);return n},Oh=new WeakSet,W0=function(t){let n=!0;for(const s of t.children)s.inactive||(n=!1);return n},ya=new WeakSet,Ou=function(t){for(const n of t.children)if(n.active||n instanceof Qt&&n.semiActive)return!0;return!1};class xM extends mn{constructor(t){super(t);v(this,"configManager");v(this,"stateManager");v(this,"layerManager");this.configManager=kn.getInstance(),this.stateManager=Xi.getInstance(),this.layerManager=Na.getInstance(),this.configManager.loadConfig().then(()=>{this.loadThemes()}).then(()=>{console.log("Themes were loaded")}),this.stateManager.subscribe("selectedTheme",(n,s)=>this.onChangeTheme(s))}get state(){return this.stateManager.state}async loadThemes(){const n=await(await fetch(this.configManager.Config.themes.url)).json();this.state.ogcServers=n.ogcServers,this.configManager.Config.basemaps.show&&(this.state.basemaps=this.prepareBasemaps(n.background_layers)),this.state.themes=this.prepareThemes(n.themes),this.setDefaultTheme()}setDefaultTheme(){if(!this.isNullOrUndefinedOrBlank(this.configManager.Config.themes.defaultTheme)){const n=Object.values(this.state.themes).find(s=>s.name===this.configManager.Config.themes.defaultTheme);n?this.state.selectedTheme=n:console.warn(`The default theme ${this.configManager.Config.themes.defaultTheme} could not be found.`)}}prepareBasemaps(t){const n={};if(this.configManager.Config.basemaps.OSM){const s=new Rc({id:-1,name:"OpenStreetMap"});n[s.id]=s;const r={id:-1,name:"OpenStreetMap",type:"OSM",metadata:{isLegendExpanded:!1,wasLegendExpanded:!1,exclusiveGroup:!1,isExpanded:!1,isChecked:!1}};s.layersList.push(new Pu(r,0))}if(this.configManager.Config.basemaps.SwissTopoVectorTiles){const s=new Rc({id:-2,name:"Vector-Tiles"});n[s.id]=s;const r={id:-2,name:"Vector-Tiles",type:"VectorTiles",style:"https://vectortiles.geo.admin.ch/styles/ch.swisstopo.leichte-basiskarte.vt/style.json",source:"leichtebasiskarte_v3.0.1",projection:"EPSG:3857",metadata:{isLegendExpanded:!1,wasLegendExpanded:!1,exclusiveGroup:!1,isExpanded:!1,isChecked:!1}};s.layersList.push(new Yl(r,0))}return t.forEach(s=>{const r=new Rc(s);n[r.id]=r;const o={value:0};s.children?s.children.forEach(a=>{r.layersList.push(this.prepareThemeLayer(a,null,o))}):r.layersList.push(this.prepareThemeLayer(s,null,o))}),n}prepareThemes(t){const n={},s={value:0};return t.forEach((r,o)=>{!r.icon.startsWith("http")&&this.configManager.Config.themes.imagesUrlPrefix&&(r.icon=this.configManager.Config.themes.imagesUrlPrefix+r.icon);const a=new vM(r);r.children.forEach(l=>{const h=this.prepareThemeLayer(l,null,s);a.layersTree.push(h)}),n[o]=a}),n}prepareThemeLayer(t,n,s){const r=t.ogcServer?t.ogcServer:n;let o;switch(t.type){case"OSM":{o=new Pu(t,s.value);break}case"VectorTiles":{o=new Yl(t,s.value);break}case"WMTS":{o=new ur(t,s.value);break}case"WMS":{if(r){const a=this.state.ogcServers[r],l=a.wfsSupport?a.urlWfs:null;o=new dt(t,r,a.url,l,s.value)}else o=new In(t,s.value),this.layerManager.setError(o,`No OGC-Server was found for layer ${t.name}, please verify the backend configuration.`);break}default:{const a=new Qt(t,s.value);t.children&&t.children.forEach(l=>{const h=this.prepareThemeLayer(l,r,s);h.parent=a,a.children.push(h)}),o=a}}return s.value=s.value+1,o}onChangeTheme(t){for(const s of this.state.layers.layersList)s.activeState="off";const n=[];t&&t.layersTree.forEach(s=>{this.addLayerToLoadedList(n,s)}),this.state.layers.layersList=n}addLayerToLoadedList(t,n){t.push(n),n instanceof Qt&&n.children.forEach(s=>{this.addLayerToLoadedList(t,s)})}}class wM extends mn{}class bM{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const xi=bM,ao={PROPERTYCHANGE:"propertychange"};class EM{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}const Dd=EM;function MM(i,e,t){let n,s;t=t||us;let r=0,o=i.length,a=!1;for(;r<o;)n=r+(o-r>>1),s=+t(i[n],e),s<0?r=n+1:(o=n,a=!s);return a?r:~r}function us(i,e){return i>e?1:i<e?-1:0}function ec(i,e,t){if(i[0]<=e)return 0;const n=i.length;if(e<=i[n-1])return n-1;if(typeof t=="function"){for(let s=1;s<n;++s){const r=i[s];if(r===e)return s;if(r<e)return t(e,i[s-1],r)>0?s-1:s}return n-1}if(t>0){for(let s=1;s<n;++s)if(i[s]<e)return s-1;return n-1}if(t<0){for(let s=1;s<n;++s)if(i[s]<=e)return s;return n-1}for(let s=1;s<n;++s){if(i[s]==e)return s;if(i[s]<e)return i[s-1]-e<e-i[s]?s-1:s}return n-1}function CM(i,e,t){for(;e<t;){const n=i[e];i[e]=i[t],i[t]=n,++e,--t}}function Gt(i,e){const t=Array.isArray(e)?e:[e],n=t.length;for(let s=0;s<n;s++)i[i.length]=t[s]}function Dn(i,e){const t=i.length;if(t!==e.length)return!1;for(let n=0;n<t;n++)if(i[n]!==e[n])return!1;return!0}function SM(i,e,t){const n=e||us;return i.every(function(s,r){if(r===0)return!0;const o=n(i[r-1],s);return!(o>0||t&&o===0)})}function js(){return!0}function Hs(){return!1}function lo(){}function V0(i){let e=!1,t,n,s;return function(){const r=Array.prototype.slice.call(arguments);return(!e||this!==s||!Dn(r,n))&&(e=!0,s=this,n=r,t=i.apply(this,arguments)),t}}function Qo(i){function e(){let t;try{t=i()}catch(n){return Promise.reject(n)}return t instanceof Promise?t:Promise.resolve(t)}return e()}class TM extends Dd{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const n=this.listeners_||(this.listeners_={}),s=n[e]||(n[e]=[]);s.includes(t)||s.push(t)}dispatchEvent(e){const t=typeof e=="string",n=t?e:e.type,s=this.listeners_&&this.listeners_[n];if(!s)return;const r=t?new xi(e):e;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,a[n]=0),++o[n];let l;for(let h=0,c=s.length;h<c;++h)if("handleEvent"in s[h]?l=s[h].handleEvent(r):l=s[h].call(this,r),l===!1||r.propagationStopped){l=!1;break}if(--o[n]===0){let h=a[n];for(delete a[n];h--;)this.removeEventListener(n,lo);delete o[n]}return l}disposeInternal(){this.listeners_&&Pa(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,t){if(!this.listeners_)return;const n=this.listeners_[e];if(!n)return;const s=n.indexOf(t);s!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(n[s]=lo,++this.pendingRemovals_[e]):(n.splice(s,1),n.length===0&&delete this.listeners_[e]))}}const Da=TM,ee={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function ye(i,e,t,n,s){if(n&&n!==i&&(t=t.bind(n)),s){const o=t;t=function(){i.removeEventListener(e,t),o.apply(this,arguments)}}const r={target:i,type:e,listener:t};return i.addEventListener(e,t),r}function Hl(i,e,t,n){return ye(i,e,t,n,!0)}function qe(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),Pa(i))}class Ga extends Da{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(ee.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const n=e.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=ye(this,e[r],t);return s}return ye(this,e,t)}onceInternal(e,t){let n;if(Array.isArray(e)){const s=e.length;n=new Array(s);for(let r=0;r<s;++r)n[r]=Hl(this,e[r],t)}else n=Hl(this,e,t);return t.ol_key=n,n}unInternal(e,t){const n=t.ol_key;if(n)X0(n);else if(Array.isArray(e))for(let s=0,r=e.length;s<r;++s)this.removeEventListener(e[s],t);else this.removeEventListener(e,t)}}Ga.prototype.on;Ga.prototype.once;Ga.prototype.un;function X0(i){if(Array.isArray(i))for(let e=0,t=i.length;e<t;++e)qe(i[e]);else qe(i)}function ie(){throw new Error("Unimplemented abstract method.")}let RM=0;function H(i){return i.ol_uid||(i.ol_uid=String(++RM))}class ip extends xi{constructor(e,t,n){super(e),this.key=t,this.oldValue=n}}class IM extends Ga{constructor(e){super(),this.on,this.once,this.un,H(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,t){let n;n=`change:${e}`,this.hasListener(n)&&this.dispatchEvent(new ip(n,e,t)),n=ao.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new ip(n,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,n){const s=this.values_||(this.values_={});if(n)s[e]=t;else{const r=s[e];s[e]=t,r!==t&&this.notify(e,r)}}setProperties(e,t){for(const n in e)this.set(n,e[n],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const n=this.values_[e];delete this.values_[e],hs(this.values_)&&(this.values_=null),t||this.notify(e,n)}}}const _n=IM;function _e(i,e){if(!i)throw new Error(e)}class Gd extends _n{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(typeof e.getSimplifiedGeometry=="function"){const t=e;this.setGeometry(t)}else{const t=e;this.setProperties(t)}}clone(){const e=new Gd(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const n=this.getStyle();return n&&e.setStyle(n),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(qe(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=ye(e,ee.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?LM(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function LM(i){if(typeof i=="function")return i;let e;return Array.isArray(i)?e=i:(_e(typeof i.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),e=[i]),function(){return e}}const rn=Gd,ds=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",PM=ds.includes("firefox"),AM=ds.includes("safari")&&!ds.includes("chrom");AM&&(ds.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(ds));const FM=ds.includes("webkit")&&!ds.includes("edge"),zd=ds.includes("macintosh"),Bd=typeof devicePixelRatio<"u"?devicePixelRatio:1,$d=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Ud=typeof Image<"u"&&Image.prototype.decode,kM=typeof createImageBitmap=="function",Y0=function(){let i=!1;try{const e=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return i}(),H0=new Array(6);function mi(){return[1,0,0,1,0,0]}function np(i){return ic(i,1,0,0,1,0,0)}function tc(i,e){const t=i[0],n=i[1],s=i[2],r=i[3],o=i[4],a=i[5],l=e[0],h=e[1],c=e[2],u=e[3],d=e[4],f=e[5];return i[0]=t*l+s*h,i[1]=n*l+r*h,i[2]=t*c+s*u,i[3]=n*c+r*u,i[4]=t*d+s*f+o,i[5]=n*d+r*f+a,i}function ic(i,e,t,n,s,r,o){return i[0]=e,i[1]=t,i[2]=n,i[3]=s,i[4]=r,i[5]=o,i}function OM(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i}function ot(i,e){const t=e[0],n=e[1];return e[0]=i[0]*t+i[2]*n+i[4],e[1]=i[1]*t+i[3]*n+i[5],e}function Ol(i,e,t){return tc(i,ic(H0,e,0,0,t,0,0))}function NM(i,e,t){return ic(i,e,0,0,t,0,0)}function DM(i,e,t){return tc(i,ic(H0,1,0,0,1,e,t))}function Hi(i,e,t,n,s,r,o,a){const l=Math.sin(r),h=Math.cos(r);return i[0]=n*h,i[1]=s*l,i[2]=-n*l,i[3]=s*h,i[4]=o*n*h-a*n*l+e,i[5]=o*s*l+a*s*h+t,i}function nc(i,e){const t=GM(e);_e(t!==0,"Transformation matrix cannot be inverted");const n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5];return i[0]=o/t,i[1]=-s/t,i[2]=-r/t,i[3]=n/t,i[4]=(r*l-o*a)/t,i[5]=-(n*l-s*a)/t,i}function GM(i){return i[0]*i[3]-i[1]*i[2]}let sp;function qd(i){const e="matrix("+i.join(", ")+")";if($d)return e;const t=sp||(sp=document.createElement("div"));return t.style.transform=e,t.style.transform}function ss(i,e,t,n,s,r){r=r||[];let o=0;for(let a=e;a<t;a+=n){const l=i[a],h=i[a+1];r[o++]=s[0]*l+s[2]*h+s[4],r[o++]=s[1]*l+s[3]*h+s[5]}return r&&r.length!=o&&(r.length=o),r}function jd(i,e,t,n,s,r,o){o=o||[];const a=Math.cos(s),l=Math.sin(s),h=r[0],c=r[1];let u=0;for(let d=e;d<t;d+=n){const f=i[d]-h,g=i[d+1]-c;o[u++]=h+f*a-g*l,o[u++]=c+f*l+g*a;for(let p=d+2;p<d+n;++p)o[u++]=i[p]}return o&&o.length!=u&&(o.length=u),o}function zM(i,e,t,n,s,r,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let u=e;u<t;u+=n){const d=i[u]-l,f=i[u+1]-h;a[c++]=l+s*d,a[c++]=h+r*f;for(let g=u+2;g<u+n;++g)a[c++]=i[g]}return a&&a.length!=c&&(a.length=c),a}function BM(i,e,t,n,s,r,o){o=o||[];let a=0;for(let l=e;l<t;l+=n){o[a++]=i[l]+s,o[a++]=i[l+1]+r;for(let h=l+2;h<l+n;++h)o[a++]=i[h]}return o&&o.length!=a&&(o.length=a),o}const rp=mi();class $M extends _n{constructor(){super(),this.extent_=_i(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=V0((e,t,n)=>{if(!n)return this.getSimplifiedGeometry(t);const s=this.clone();return s.applyTransform(n),s.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return ie()}closestPointXY(e,t,n,s){return ie()}containsXY(e,t){const n=this.getClosestPoint([e,t]);return n[0]===e&&n[1]===t}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return ie()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&po(t),this.extentRevision_=this.getRevision()}return DE(this.extent_,e)}rotate(e,t){ie()}scale(e,t,n){ie()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return ie()}getType(){return ie()}applyTransform(e){ie()}intersectsExtent(e){return ie()}translate(e,t){ie()}transform(e,t){const n=K(e),s=n.getUnits()=="tile-pixels"?function(r,o,a){const l=n.getExtent(),h=n.getWorldExtent(),c=_t(h)/_t(l);return Hi(rp,h[0],h[3],c,-c,0,0,0),ss(r,0,r.length,a,rp,o),oo(n,t)(r,o,a)}:oo(n,t);return this.applyTransform(s),this}}const sc=$M;class UM extends sc{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(e){return Td(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return ie()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=Zl(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){ie()}setLayout(e,t,n){let s;if(e)s=Zl(e);else{for(let r=0;r<n;++r){if(t.length===0){this.layout="XY",this.stride=2;return}t=t[0]}s=t.length,e=Zs(s)}this.layout=e,this.stride=s}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(e,t){const n=this.getFlatCoordinates();if(n){const s=this.getStride();jd(n,0,n.length,s,e,t,n),this.changed()}}scale(e,t,n){t===void 0&&(t=e),n||(n=pi(this.getExtent()));const s=this.getFlatCoordinates();if(s){const r=this.getStride();zM(s,0,s.length,r,e,t,n,s),this.changed()}}translate(e,t){const n=this.getFlatCoordinates();if(n){const s=this.getStride();BM(n,0,n.length,s,e,t,n),this.changed()}}}function Zs(i){let e;return i==2?e="XY":i==3?e="XYZ":i==4&&(e="XYZM"),e}function Zl(i){let e;return i=="XY"?e=2:i=="XYZ"||i=="XYM"?e=3:i=="XYZM"&&(e=4),e}function qM(i,e,t){const n=i.getFlatCoordinates();if(!n)return null;const s=i.getStride();return ss(n,0,n.length,s,e,t)}const ps=UM;function Z0(i,e,t,n){for(let s=0,r=t.length;s<r;++s)i[e++]=t[s];return e}function rc(i,e,t,n){for(let s=0,r=t.length;s<r;++s){const o=t[s];for(let a=0;a<n;++a)i[e++]=o[a]}return e}function za(i,e,t,n,s){s=s||[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=rc(i,e,t[o],n);s[r++]=l,e=l}return s.length=r,s}function K0(i,e,t,n,s){s=s||[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=za(i,e,t[o],n,s[r]);l.length===0&&(l[0]=e),s[r++]=l,e=l[l.length-1]}return s.length=r,s}let J0=class Q0 extends ps{constructor(e,t,n){super(),n!==void 0&&t===void 0?this.setFlatCoordinates(n,e):(t=t||0,this.setCenterAndRadius(e,t,n))}clone(){const e=new Q0(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,s){const r=this.flatCoordinates,o=e-r[0],a=t-r[1],l=o*o+a*a;if(l<s){if(l===0)for(let h=0;h<this.stride;++h)n[h]=r[h];else{const h=this.getRadius()/Math.sqrt(l);n[0]=r[0]+h*o,n[1]=r[1]+h*a;for(let c=2;c<this.stride;++c)n[c]=r[c]}return n.length=this.stride,l}return s}containsXY(e,t){const n=this.flatCoordinates,s=e-n[0],r=t-n[1];return s*s+r*r<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,n=t[this.stride]-t[0];return Fi(t[0]-n,t[1]-n,t[0]+n,t[1]+n,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(Qe(e,t)){const n=this.getCenter();return e[0]<=n[0]&&e[2]>=n[0]||e[1]<=n[1]&&e[3]>=n[1]?!0:Rd(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,n=this.flatCoordinates[t]-this.flatCoordinates[0],s=e.slice();s[t]=s[0]+n;for(let r=1;r<t;++r)s[t+r]=e[r];this.setFlatCoordinates(this.layout,s),this.changed()}setCenterAndRadius(e,t,n){this.setLayout(n,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const s=this.flatCoordinates;let r=Z0(s,0,e,this.stride);s[r++]=s[0]+t;for(let o=1,a=this.stride;o<a;++o)s[r++]=s[o];s.length=r,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const n=this.getCenter(),s=this.getStride();this.setCenter(jd(n,0,n.length,s,e,t,n)),this.changed()}};J0.prototype.transform;const ey=J0;class Kl extends sc{constructor(e){super(),this.geometries_=e||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(qe),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let e=0,t=this.geometries_.length;e<t;++e)this.changeEventsKeys_.push(ye(this.geometries_[e],ee.CHANGE,this.changed,this))}clone(){const e=new Kl(null);return e.setGeometries(this.geometries_),e.applyProperties(this),e}closestPointXY(e,t,n,s){if(s<Xs(this.getExtent(),e,t))return s;const r=this.geometries_;for(let o=0,a=r.length;o<a;++o)s=r[o].closestPointXY(e,t,n,s);return s}containsXY(e,t){const n=this.geometries_;for(let s=0,r=n.length;s<r;++s)if(n[s].containsXY(e,t))return!0;return!1}computeExtent(e){po(e);const t=this.geometries_;for(let n=0,s=t.length;n<s;++n)v0(e,t[n].getExtent());return e}getGeometries(){return op(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[];const t=this.geometries_;for(let n=0,s=t.length;n<s;++n)t[n].getType()===this.getType()?e=e.concat(t[n].getGeometriesArrayRecursive()):e.push(t[n]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=[],n=this.geometries_;let s=!1;for(let r=0,o=n.length;r<o;++r){const a=n[r],l=a.getSimplifiedGeometry(e);t.push(l),l!==a&&(s=!0)}if(s){const r=new Kl(null);return r.setGeometriesArray(t),r}return this.simplifiedGeometryMaxMinSquaredTolerance=e,this}getType(){return"GeometryCollection"}intersectsExtent(e){const t=this.geometries_;for(let n=0,s=t.length;n<s;++n)if(t[n].intersectsExtent(e))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(e,t){const n=this.geometries_;for(let s=0,r=n.length;s<r;++s)n[s].rotate(e,t);this.changed()}scale(e,t,n){n||(n=pi(this.getExtent()));const s=this.geometries_;for(let r=0,o=s.length;r<o;++r)s[r].scale(e,t,n);this.changed()}setGeometries(e){this.setGeometriesArray(op(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){const t=this.geometries_;for(let n=0,s=t.length;n<s;++n)t[n].applyTransform(e);this.changed()}translate(e,t){const n=this.geometries_;for(let s=0,r=n.length;s<r;++s)n[s].translate(e,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function op(i){const e=[];for(let t=0,n=i.length;t<n;++t)e.push(i[t].clone());return e}const ty=Kl;function ap(i,e,t,n,s,r,o){const a=i[e],l=i[e+1],h=i[t]-a,c=i[t+1]-l;let u;if(h===0&&c===0)u=e;else{const d=((s-a)*h+(r-l)*c)/(h*h+c*c);if(d>1)u=t;else if(d>0){for(let f=0;f<n;++f)o[f]=ci(i[e+f],i[t+f],d);o.length=n;return}else u=e}for(let d=0;d<n;++d)o[d]=i[u+d];o.length=n}function Wd(i,e,t,n,s){let r=i[e],o=i[e+1];for(e+=n;e<t;e+=n){const a=i[e],l=i[e+1],h=Rn(r,o,a,l);h>s&&(s=h),r=a,o=l}return s}function Vd(i,e,t,n,s){for(let r=0,o=t.length;r<o;++r){const a=t[r];s=Wd(i,e,a,n,s),e=a}return s}function jM(i,e,t,n,s){for(let r=0,o=t.length;r<o;++r){const a=t[r];s=Vd(i,e,a,n,s),e=a[a.length-1]}return s}function Xd(i,e,t,n,s,r,o,a,l,h,c){if(e==t)return h;let u,d;if(s===0){if(d=Rn(o,a,i[e],i[e+1]),d<h){for(u=0;u<n;++u)l[u]=i[e+u];return l.length=n,d}return h}c=c||[NaN,NaN];let f=e+n;for(;f<t;)if(ap(i,f-n,f,n,o,a,c),d=Rn(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<n;++u)l[u]=c[u];l.length=n,f+=n}else f+=n*Math.max((Math.sqrt(d)-Math.sqrt(h))/s|0,1);if(r&&(ap(i,t-n,e,n,o,a,c),d=Rn(o,a,c[0],c[1]),d<h)){for(h=d,u=0;u<n;++u)l[u]=c[u];l.length=n}return h}function Yd(i,e,t,n,s,r,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=t.length;u<d;++u){const f=t[u];h=Xd(i,e,f,n,s,r,o,a,l,h,c),e=f}return h}function WM(i,e,t,n,s,r,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=t.length;u<d;++u){const f=t[u];h=Yd(i,e,f,n,s,r,o,a,l,h,c),e=f[f.length-1]}return h}function oc(i,e,t,n,s,r,o){const a=(t-e)/n;if(a<3){for(;e<t;e+=n)r[o++]=i[e],r[o++]=i[e+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[e,t-n];let c=0;for(;h.length>0;){const u=h.pop(),d=h.pop();let f=0;const g=i[d],p=i[d+1],m=i[u],_=i[u+1];for(let y=d+n;y<u;y+=n){const x=i[y],w=i[y+1],b=BE(x,w,g,p,m,_);b>f&&(c=y,f=b)}f>s&&(l[(c-e)/n]=1,d+n<c&&h.push(d,c),c+n<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(r[o++]=i[e+u*n],r[o++]=i[e+u*n+1]);return o}function iy(i,e,t,n,s,r,o,a){for(let l=0,h=t.length;l<h;++l){const c=t[l];o=oc(i,e,c,n,s,r,o),a.push(o),e=c}return o}function Ts(i,e){return e*Math.round(i/e)}function VM(i,e,t,n,s,r,o){if(e==t)return o;let a=Ts(i[e],s),l=Ts(i[e+1],s);e+=n,r[o++]=a,r[o++]=l;let h,c;do if(h=Ts(i[e],s),c=Ts(i[e+1],s),e+=n,e==t)return r[o++]=h,r[o++]=c,o;while(h==a&&c==l);for(;e<t;){const u=Ts(i[e],s),d=Ts(i[e+1],s);if(e+=n,u==h&&d==c)continue;const f=h-a,g=c-l,p=u-a,m=d-l;if(f*m==g*p&&(f<0&&p<f||f==p||f>0&&p>f)&&(g<0&&m<g||g==m||g>0&&m>g)){h=u,c=d;continue}r[o++]=h,r[o++]=c,a=h,l=c,h=u,c=d}return r[o++]=h,r[o++]=c,o}function Hd(i,e,t,n,s,r,o,a){for(let l=0,h=t.length;l<h;++l){const c=t[l];o=VM(i,e,c,n,s,r,o),a.push(o),e=c}return o}function XM(i,e,t,n,s,r,o,a){for(let l=0,h=t.length;l<h;++l){const c=t[l],u=[];o=Hd(i,e,c,n,s,r,o,u),a.push(u),e=c[c.length-1]}return o}function Zn(i,e,t,n,s){s=s!==void 0?s:[];let r=0;for(let o=e;o<t;o+=n)s[r++]=i.slice(o,o+n);return s.length=r,s}function ea(i,e,t,n,s){s=s!==void 0?s:[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];s[r++]=Zn(i,e,l,n,s[r]),e=l}return s.length=r,s}function Nu(i,e,t,n,s){s=s!==void 0?s:[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];s[r++]=l.length===1&&l[0]===e?[]:ea(i,e,l,n,s[r]),e=l[l.length-1]}return s.length=r,s}function ny(i,e,t,n){let s=0,r=i[t-n],o=i[t-n+1];for(;e<t;e+=n){const a=i[e],l=i[e+1];s+=o*a-r*l,r=a,o=l}return s/2}function sy(i,e,t,n){let s=0;for(let r=0,o=t.length;r<o;++r){const a=t[r];s+=ny(i,e,a,n),e=a}return s}function YM(i,e,t,n){let s=0;for(let r=0,o=t.length;r<o;++r){const a=t[r];s+=sy(i,e,a,n),e=a[a.length-1]}return s}class Jl extends ps{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}clone(){return new Jl(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,n,s){return s<Xs(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Wd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Xd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,n,s))}getArea(){return ny(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Zn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=oc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new Jl(t,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=rc(this.flatCoordinates,0,e,this.stride),this.changed()}}const Du=Jl;function ry(i,e,t,n,s){let r;for(e+=n;e<t;e+=n)if(r=s(i.slice(e-n,e),i.slice(e,e+n)),r)return r;return!1}function Ql(i,e,t,n,s,r,o){let a,l;const h=(t-e)/n;if(h===1)a=e;else if(h===2)a=e,l=s;else if(h!==0){let c=i[e],u=i[e+1],d=0;const f=[0];for(let m=e+n;m<t;m+=n){const _=i[m],y=i[m+1];d+=Math.sqrt((_-c)*(_-c)+(y-u)*(y-u)),f.push(d),c=_,u=y}const g=s*d,p=MM(f,g);p<0?(l=(g-f[-p-2])/(f[-p-1]-f[-p-2]),a=e+(-p-2)*n):a=e+p*n}o=o>1?o:2,r=r||new Array(o);for(let c=0;c<o;++c)r[c]=a===void 0?NaN:l===void 0?i[a+c]:ci(i[a+c],i[a+n+c],l);return r}function Gu(i,e,t,n,s,r){if(t==e)return null;let o;if(s<i[e+n-1])return r?(o=i.slice(e,e+n),o[n-1]=s,o):null;if(i[t-1]<s)return r?(o=i.slice(t-n,t),o[n-1]=s,o):null;if(s==i[e+n-1])return i.slice(e,e+n);let a=e/n,l=t/n;for(;a<l;){const d=a+l>>1;s<i[(d+1)*n-1]?l=d:a=d+1}const h=i[a*n-1];if(s==h)return i.slice((a-1)*n,(a-1)*n+n);const c=i[(a+1)*n-1],u=(s-h)/(c-h);o=[];for(let d=0;d<n-1;++d)o.push(ci(i[(a-1)*n+d],i[a*n+d],u));return o.push(s),o}function HM(i,e,t,n,s,r,o){if(o)return Gu(i,e,t[t.length-1],n,s,r);let a;if(s<i[n-1])return r?(a=i.slice(0,n),a[n-1]=s,a):null;if(i[i.length-1]<s)return r?(a=i.slice(i.length-n),a[n-1]=s,a):null;for(let l=0,h=t.length;l<h;++l){const c=t[l];if(e!=c){if(s<i[e+n-1])return null;if(s<=i[c-1])return Gu(i,e,c,n,s,!1);e=c}}return null}function ZM(i,e,t,n,s){return!Rd(s,function(o){return!Is(i,e,t,n,o[0],o[1])})}function Is(i,e,t,n,s,r){let o=0,a=i[t-n],l=i[t-n+1];for(;e<t;e+=n){const h=i[e],c=i[e+1];l<=r?c>r&&(h-a)*(r-l)-(s-a)*(c-l)>0&&o++:c<=r&&(h-a)*(r-l)-(s-a)*(c-l)<0&&o--,a=h,l=c}return o!==0}function Zd(i,e,t,n,s,r){if(t.length===0||!Is(i,e,t[0],n,s,r))return!1;for(let o=1,a=t.length;o<a;++o)if(Is(i,t[o-1],t[o],n,s,r))return!1;return!0}function KM(i,e,t,n,s,r){if(t.length===0)return!1;for(let o=0,a=t.length;o<a;++o){const l=t[o];if(Zd(i,e,l,n,s,r))return!0;e=l[l.length-1]}return!1}function ac(i,e,t,n,s){const r=x0(_i(),i,e,t,n);return Qe(s,r)?qi(s,r)||r[0]>=s[0]&&r[2]<=s[2]||r[1]>=s[1]&&r[3]<=s[3]?!0:ry(i,e,t,n,function(o,a){return GE(s,o,a)}):!1}function JM(i,e,t,n,s){for(let r=0,o=t.length;r<o;++r){if(ac(i,e,t[r],n,s))return!0;e=t[r]}return!1}function oy(i,e,t,n,s){return!!(ac(i,e,t,n,s)||Is(i,e,t,n,s[0],s[1])||Is(i,e,t,n,s[0],s[3])||Is(i,e,t,n,s[2],s[1])||Is(i,e,t,n,s[2],s[3]))}function ay(i,e,t,n,s){if(!oy(i,e,t[0],n,s))return!1;if(t.length===1)return!0;for(let r=1,o=t.length;r<o;++r)if(ZM(i,t[r-1],t[r],n,s)&&!ac(i,t[r-1],t[r],n,s))return!1;return!0}function QM(i,e,t,n,s){for(let r=0,o=t.length;r<o;++r){const a=t[r];if(ay(i,e,a,n,s))return!0;e=a[a.length-1]}return!1}function ly(i,e,t,n){let s=i[e],r=i[e+1],o=0;for(let a=e+n;a<t;a+=n){const l=i[a],h=i[a+1];o+=Math.sqrt((l-s)*(l-s)+(h-r)*(h-r)),s=l,r=h}return o}class eh extends ps{constructor(e,t){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendCoordinate(e){Gt(this.flatCoordinates,e),this.changed()}clone(){const e=new eh(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,s){return s<Xs(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Wd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Xd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,n,s))}forEachSegment(e){return ry(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinateAtM(e,t){return this.layout!="XYM"&&this.layout!="XYZM"?null:(t=t!==void 0?t:!1,Gu(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t))}getCoordinates(){return Zn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(e,t){return Ql(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,this.stride)}getLength(){return ly(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(e){const t=[];return t.length=oc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new eh(t,"XY")}getType(){return"LineString"}intersectsExtent(e){return ac(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=rc(this.flatCoordinates,0,e,this.stride),this.changed()}}const Yi=eh;class th extends ps{constructor(e,t,n){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,t);else if(t!==void 0&&n)this.setFlatCoordinates(t,e),this.ends_=n;else{const s=e,r=[],o=[];for(let l=0,h=s.length;l<h;++l){const c=s[l];Gt(r,c.getFlatCoordinates()),o.push(r.length)}const a=s.length===0?this.getLayout():s[0].getLayout();this.setFlatCoordinates(a,r),this.ends_=o}}appendLineString(e){Gt(this.flatCoordinates,e.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new th(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,n,s){return s<Xs(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Vd(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Yd(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,n,s))}getCoordinateAtM(e,t,n){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(t=t!==void 0?t:!1,n=n!==void 0?n:!1,HM(this.flatCoordinates,0,this.ends_,this.stride,e,t,n))}getCoordinates(){return ea(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new Yi(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){const e=this.flatCoordinates,t=this.ends_,n=this.layout,s=[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=t[o],h=new Yi(e.slice(r,l),n);s.push(h),r=l}return s}getFlatMidpoints(){const e=[],t=this.flatCoordinates;let n=0;const s=this.ends_,r=this.stride;for(let o=0,a=s.length;o<a;++o){const l=s[o],h=Ql(t,n,l,r,.5);Gt(e,h),n=l}return e}getSimplifiedGeometryInternal(e){const t=[],n=[];return t.length=iy(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,n),new th(t,"XY",n)}getType(){return"MultiLineString"}intersectsExtent(e){return JM(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=za(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}const Ks=th;class Kd extends ps{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new Kd(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,s){const r=this.flatCoordinates,o=Rn(e,t,r[0],r[1]);if(o<s){const a=this.stride;for(let l=0;l<a;++l)n[l]=r[l];return n.length=a,o}return s}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(e){return Uo(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return Sd(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Z0(this.flatCoordinates,0,e,this.stride),this.changed()}}const Ai=Kd;class Jd extends ps{constructor(e,t){super(),t&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendPoint(e){Gt(this.flatCoordinates,e.getFlatCoordinates()),this.changed()}clone(){const e=new Jd(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,s){if(s<Xs(this.getExtent(),e,t))return s;const r=this.flatCoordinates,o=this.stride;for(let a=0,l=r.length;a<l;a+=o){const h=Rn(e,t,r[a],r[a+1]);if(h<s){s=h;for(let c=0;c<o;++c)n[c]=r[a+c];n.length=o}}return s}getCoordinates(){return Zn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){const t=this.flatCoordinates.length/this.stride;return e<0||t<=e?null:new Ai(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){const e=this.flatCoordinates,t=this.layout,n=this.stride,s=[];for(let r=0,o=e.length;r<o;r+=n){const a=new Ai(e.slice(r,r+n),t);s.push(a)}return s}getType(){return"MultiPoint"}intersectsExtent(e){const t=this.flatCoordinates,n=this.stride;for(let s=0,r=t.length;s<r;s+=n){const o=t[s],a=t[s+1];if(Sd(e,o,a))return!0}return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=rc(this.flatCoordinates,0,e,this.stride),this.changed()}}const mo=Jd;function Qd(i,e,t,n,s,r,o){let a,l,h,c,u,d,f;const g=s[r+1],p=[];for(let y=0,x=t.length;y<x;++y){const w=t[y];for(c=i[w-n],d=i[w-n+1],a=e;a<w;a+=n)u=i[a],f=i[a+1],(g<=d&&f<=g||d<=g&&g<=f)&&(h=(g-d)/(f-d)*(u-c)+c,p.push(h)),c=u,d=f}let m=NaN,_=-1/0;for(p.sort(us),c=p[0],a=1,l=p.length;a<l;++a){u=p[a];const y=Math.abs(u-c);y>_&&(h=(c+u)/2,Zd(i,e,t,n,h,g)&&(m=h,_=y)),c=u}return isNaN(m)&&(m=s[r]),o?(o.push(m,g,_),o):[m,g,_]}function hy(i,e,t,n,s){let r=[];for(let o=0,a=t.length;o<a;++o){const l=t[o];r=Qd(i,e,l,n,s,2*o,r),e=l[l.length-1]}return r}function eC(i,e,t,n){for(;e<t-n;){for(let s=0;s<n;++s){const r=i[e+s];i[e+s]=i[t-n+s],i[t-n+s]=r}e+=n,t-=n}}function ef(i,e,t,n){let s=0,r=i[t-n],o=i[t-n+1];for(;e<t;e+=n){const a=i[e],l=i[e+1];s+=(a-r)*(l+o),r=a,o=l}return s===0?void 0:s>0}function tf(i,e,t,n,s){s=s!==void 0?s:!1;for(let r=0,o=t.length;r<o;++r){const a=t[r],l=ef(i,e,a,n);if(r===0){if(s&&l||!s&&!l)return!1}else if(s&&!l||!s&&l)return!1;e=a}return!0}function cy(i,e,t,n,s){for(let r=0,o=t.length;r<o;++r){const a=t[r];if(!tf(i,e,a,n,s))return!1;a.length&&(e=a[a.length-1])}return!0}function ih(i,e,t,n,s){s=s!==void 0?s:!1;for(let r=0,o=t.length;r<o;++r){const a=t[r],l=ef(i,e,a,n);(r===0?s&&l||!s&&!l:s&&!l||!s&&l)&&eC(i,e,a,n),e=a}return e}function zu(i,e,t,n,s){for(let r=0,o=t.length;r<o;++r)e=ih(i,e,t[r],n,s);return e}function uy(i,e){const t=[];let n=0,s=0,r;for(let o=0,a=e.length;o<a;++o){const l=e[o],h=ef(i,n,l,2);if(r===void 0&&(r=h),h===r)t.push(e.slice(s,o+1));else{if(t.length===0)continue;t[t.length-1].push(e[s])}s=o+1,n=l}return t}class Ws extends ps{constructor(e,t,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,t!==void 0&&n?(this.setFlatCoordinates(t,e),this.ends_=n):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?Gt(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Ws(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,n,s){return s<Xs(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Vd(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Yd(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,n,s))}containsXY(e,t){return Zd(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return sy(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),ih(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,ea(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=pi(this.getExtent());this.flatInteriorPoint_=Qd(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Ai(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new Du(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,t=this.flatCoordinates,n=this.ends_,s=[];let r=0;for(let o=0,a=n.length;o<a;++o){const l=n[o],h=new Du(t.slice(r,l),e);s.push(h),r=l}return s}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;tf(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=ih(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],n=[];return t.length=Hd(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,n),new Ws(t,"XY",n)}getType(){return"Polygon"}intersectsExtent(e){return ay(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=za(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}const Zi=Ws;function uO(i,e,t,n){t=t||32;const s=[];for(let r=0;r<t;++r)Gt(s,VE(i,e,2*Math.PI*r/t,n));return s.push(s[0],s[1]),new Ws(s,"XY",[s.length])}function lp(i){if(Ys(i))throw new Error("Cannot create polygon from empty extent");const e=i[0],t=i[1],n=i[2],s=i[3],r=[e,t,e,s,n,s,n,t,e,t];return new Ws(r,"XY",[r.length])}function dy(i,e,t){e=e||32;const n=i.getStride(),s=i.getLayout(),r=i.getCenter(),o=n*(e+1),a=new Array(o);for(let c=0;c<o;c+=n){a[c]=0,a[c+1]=0;for(let u=2;u<n;u++)a[c+u]=r[u]}const l=[a.length],h=new Ws(a,s,l);return fy(h,r,i.getRadius(),t),h}function fy(i,e,t,n){const s=i.getFlatCoordinates(),r=i.getStride(),o=s.length/r-1,a=n||0;for(let l=0;l<=o;++l){const h=l*r,c=a+Os(l,o)*2*Math.PI/o;s[h]=e[0]+t*Math.cos(c),s[h+1]=e[1]+t*Math.sin(c)}i.changed()}function gy(i,e,t,n){const s=[];let r=_i();for(let o=0,a=t.length;o<a;++o){const l=t[o];r=Td(i,e,l[0],n),s.push((r[0]+r[2])/2,(r[1]+r[3])/2),e=l[l.length-1]}return s}class nh extends ps{constructor(e,t,n){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(e[0])){const s=e,r=[],o=[];for(let a=0,l=s.length;a<l;++a){const h=s[a],c=r.length,u=h.getEnds();for(let d=0,f=u.length;d<f;++d)u[d]+=c;Gt(r,h.getFlatCoordinates()),o.push(u)}t=s.length===0?this.getLayout():s[0].getLayout(),e=r,n=o}t!==void 0&&n?(this.setFlatCoordinates(t,e),this.endss_=n):this.setCoordinates(e,t)}appendPolygon(e){let t;if(!this.flatCoordinates)this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();else{const n=this.flatCoordinates.length;Gt(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let s=0,r=t.length;s<r;++s)t[s]+=n}this.endss_.push(t),this.changed()}clone(){const e=this.endss_.length,t=new Array(e);for(let s=0;s<e;++s)t[s]=this.endss_[s].slice();const n=new nh(this.flatCoordinates.slice(),this.layout,t);return n.applyProperties(this),n}closestPointXY(e,t,n,s){return s<Xs(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(jM(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),WM(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,n,s))}containsXY(e,t){return KM(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)}getArea(){return YM(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),zu(t,0,this.endss_,this.stride,e)):t=this.flatCoordinates,Nu(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=gy(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=hy(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new mo(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;cy(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=zu(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],n=[];return t.length=XM(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,n),new nh(t,"XY",n)}getPolygon(e){if(e<0||this.endss_.length<=e)return null;let t;if(e===0)t=0;else{const r=this.endss_[e-1];t=r[r.length-1]}const n=this.endss_[e].slice(),s=n[n.length-1];if(t!==0)for(let r=0,o=n.length;r<o;++r)n[r]-=t;return new Zi(this.flatCoordinates.slice(t,s),this.layout,n)}getPolygons(){const e=this.layout,t=this.flatCoordinates,n=this.endss_,s=[];let r=0;for(let o=0,a=n.length;o<a;++o){const l=n[o].slice(),h=l[l.length-1];if(r!==0)for(let u=0,d=l.length;u<d;++u)l[u]-=r;const c=new Zi(t.slice(r,h),e,l);s.push(c),r=h}return s}getType(){return"MultiPolygon"}intersectsExtent(e){return QM(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const n=K0(this.flatCoordinates,0,e,this.stride,this.endss_);if(n.length===0)this.flatCoordinates.length=0;else{const s=n[n.length-1];this.flatCoordinates.length=s.length===0?0:s[s.length-1]}this.changed()}}const Js=nh,hp=mi();class ho{constructor(e,t,n,s,r,o){this.styleFunction,this.extent_,this.id_=o,this.type_=e,this.flatCoordinates_=t,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=n,this.properties_=r,this.squaredTolerance_,this.stride_=s,this.simplifiedGeometry_}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?Uo(this.flatCoordinates_):Td(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const e=pi(this.getExtent());this.flatInteriorPoints_=Qd(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const e=uy(this.flatCoordinates_,this.ends_),t=gy(this.flatCoordinates_,0,e,2);this.flatInteriorPoints_=hy(this.flatCoordinates_,0,e,2,t)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=Ql(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let t=0;const n=this.ends_;for(let s=0,r=n.length;s<r;++s){const o=n[s],a=Ql(e,t,o,2,.5);Gt(this.flatMidpoints_,a),t=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(e){return this}simplifyTransformed(e,t){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){e=K(e);const t=e.getExtent(),n=e.getWorldExtent();if(t&&n){const s=_t(n)/_t(t);Hi(hp,n[0],n[3],s,-s,0,0,0),ss(this.flatCoordinates_,0,this.flatCoordinates_.length,2,hp,this.flatCoordinates_)}}applyTransform(e){e(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new ho(this.type_,this.flatCoordinates_.slice(),this.ends_.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=V0((e,t)=>{if(e===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),t&&this.simplifiedGeometry_.applyTransform(t);const n=this.simplifiedGeometry_.getFlatCoordinates();let s;switch(this.type_){case"LineString":n.length=oc(n,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,e,n,0),s=[n.length];break;case"MultiLineString":s=[],n.length=iy(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,e,n,0,s);break;case"Polygon":s=[],n.length=Hd(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(e),n,0,s);break}return s&&(this.simplifiedGeometry_=new ho(this.type_,n,s,2,this.properties_,this.id_)),this.squaredTolerance_=e,this.simplifiedGeometry_}),this}}ho.prototype.getFlatCoordinates=ho.prototype.getOrientedFlatCoordinates;const Li=ho;class tC{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=rn,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let n=t.dataProjection?K(t.dataProjection):this.readProjection(e);t.extent&&n&&n.getUnits()==="tile-pixels"&&(n=K(n),n.setWorldExtent(t.extent)),t={dataProjection:n,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},e)}getType(){return ie()}readFeature(e,t){return ie()}readFeatures(e,t){return ie()}readGeometry(e,t){return ie()}readProjection(e){return ie()}writeFeature(e,t){return ie()}writeFeatures(e,t){return ie()}writeGeometry(e,t){return ie()}}const nf=tC;function Qs(i,e,t){const n=t?K(t.featureProjection):null,s=t?K(t.dataProjection):null;let r=i;if(n&&s&&!ui(n,s)){e&&(r=i.clone());const o=e?n:s,a=e?s:n;o.getUnits()==="tile-pixels"?r.transform(o,a):r.applyTransform(oo(o,a))}if(e&&t&&t.decimals!==void 0){const o=Math.pow(10,t.decimals),a=function(l){for(let h=0,c=l.length;h<c;++h)l[h]=Math.round(l[h]*o)/o;return l};r===i&&(r=i.clone()),r.applyTransform(a)}return r}function sf(i,e){const t=e?K(e.featureProjection):null,n=e?K(e.dataProjection):null;return t&&n&&!ui(t,n)?P0(i,n,t):i}const iC={Point:Ai,LineString:Yi,Polygon:Zi,MultiPoint:mo,MultiLineString:Ks,MultiPolygon:Js};function nC(i,e,t){return Array.isArray(e[0])?(cy(i,0,e,t)||(i=i.slice(),zu(i,0,e,t)),i):(tf(i,0,e,t)||(i=i.slice(),ih(i,0,e,t)),i)}function py(i,e){var r;const t=i.geometry;if(!t)return[];if(Array.isArray(t))return t.map(o=>py({...i,geometry:o})).flat();const n=t.type==="MultiPolygon"?"Polygon":t.type;if(n==="GeometryCollection"||n==="Circle")throw new Error("Unsupported geometry type: "+n);const s=t.layout.length;return Qs(new Li(n,n==="Polygon"?nC(t.flatCoordinates,t.ends,s):t.flatCoordinates,(r=t.ends)==null?void 0:r.flat(),s,i.properties||{},i.id).enableSimplifyTransformed(),!1,e)}function rf(i,e){if(!i)return null;if(Array.isArray(i)){const n=i.map(s=>rf(s,e));return new ty(n)}const t=iC[i.type];return Qs(new t(i.flatCoordinates,i.layout,i.ends),!1,e)}class sC extends nf{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(ol(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(ol(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return ie()}readFeaturesFromObject(e,t){return ie()}readGeometry(e,t){return this.readGeometryFromObject(ol(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return ie()}readProjection(e){return this.readProjectionFromObject(ol(e))}readProjectionFromObject(e){return ie()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return ie()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return ie()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return ie()}}function ol(i){if(typeof i=="string"){const e=JSON.parse(i);return e||null}return i!==null?i:null}const rC=sC;class oC extends rC{constructor(e){e=e||{},super(),this.dataProjection=K(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=K(e.featureProjection)),e.featureClass&&(this.featureClass=e.featureClass),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let n=null;e.type==="Feature"?n=e:n={type:"Feature",geometry:e,properties:null};const s=of(n.geometry);if(this.featureClass===Li)return py({geometry:s,id:n.id,properties:n.properties},t);const r=new rn;return this.geometryName_?r.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in n!==void 0&&r.setGeometryName(n.geometry_name),r.setGeometry(rf(s,t)),"id"in n&&r.setId(n.id),n.properties&&r.setProperties(n.properties,!0),r}readFeaturesFromObject(e,t){const n=e;let s=null;if(n.type==="FeatureCollection"){const r=e;s=[];const o=r.features;for(let a=0,l=o.length;a<l;++a){const h=this.readFeatureFromObject(o[a],t);h&&s.push(h)}}else s=[this.readFeatureFromObject(e,t)];return s.flat()}readGeometryFromObject(e,t){return aC(e,t)}readProjectionFromObject(e){const t=e.crs;let n;if(t)if(t.type=="name")n=K(t.properties.name);else if(t.type==="EPSG")n=K("EPSG:"+t.properties.code);else throw new Error("Unknown SRS type");else n=this.dataProjection;return n}writeFeatureObject(e,t){t=this.adaptOptions(t);const n={type:"Feature",geometry:null,properties:null},s=e.getId();if(s!==void 0&&(n.id=s),!e.hasProperties())return n;const r=e.getProperties(),o=e.getGeometry();return o&&(n.geometry=Bu(o,t),delete r[e.getGeometryName()]),hs(r)||(n.properties=r),n}writeFeaturesObject(e,t){t=this.adaptOptions(t);const n=[];for(let s=0,r=e.length;s<r;++s)n.push(this.writeFeatureObject(e[s],t));return{type:"FeatureCollection",features:n}}writeGeometryObject(e,t){return Bu(e,this.adaptOptions(t))}}function of(i,e){if(!i)return null;let t;switch(i.type){case"Point":{t=hC(i);break}case"LineString":{t=cC(i);break}case"Polygon":{t=gC(i);break}case"MultiPoint":{t=dC(i);break}case"MultiLineString":{t=uC(i);break}case"MultiPolygon":{t=fC(i);break}case"GeometryCollection":{t=lC(i);break}default:throw new Error("Unsupported GeoJSON type: "+i.type)}return t}function aC(i,e){const t=of(i);return rf(t,e)}function lC(i,e){return i.geometries.map(function(n){return of(n)})}function hC(i){const e=i.coordinates;return{type:"Point",flatCoordinates:e,layout:Zs(e.length)}}function cC(i){const e=i.coordinates,t=e.flat();return{type:"LineString",flatCoordinates:t,ends:[t.length],layout:Zs(e[0].length)}}function uC(i){const e=i.coordinates,t=e[0][0].length,n=[],s=za(n,0,e,t);return{type:"MultiLineString",flatCoordinates:n,ends:s,layout:Zs(t)}}function dC(i){const e=i.coordinates;return{type:"MultiPoint",flatCoordinates:e.flat(),layout:Zs(e[0].length)}}function fC(i){const e=i.coordinates,t=[],n=e[0][0][0].length,s=K0(t,0,e,n);return{type:"MultiPolygon",flatCoordinates:t,ends:s,layout:Zs(n)}}function gC(i){const e=i.coordinates,t=[],n=e[0][0].length,s=za(t,0,e,n);return{type:"Polygon",flatCoordinates:t,ends:s,layout:Zs(n)}}function Bu(i,e){i=Qs(i,!0,e);const t=i.getType();let n;switch(t){case"Point":{n=xC(i);break}case"LineString":{n=mC(i);break}case"Polygon":{n=wC(i,e);break}case"MultiPoint":{n=_C(i);break}case"MultiLineString":{n=yC(i);break}case"MultiPolygon":{n=vC(i,e);break}case"GeometryCollection":{n=pC(i,e);break}case"Circle":{n={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+t)}return n}function pC(i,e){return e=Object.assign({},e),delete e.featureProjection,{type:"GeometryCollection",geometries:i.getGeometriesArray().map(function(n){return Bu(n,e)})}}function mC(i,e){return{type:"LineString",coordinates:i.getCoordinates()}}function yC(i,e){return{type:"MultiLineString",coordinates:i.getCoordinates()}}function _C(i,e){return{type:"MultiPoint",coordinates:i.getCoordinates()}}function vC(i,e){let t;return e&&(t=e.rightHanded),{type:"MultiPolygon",coordinates:i.getCoordinates(t)}}function xC(i,e){return{type:"Point",coordinates:i.getCoordinates()}}function wC(i,e){let t;return e&&(t=e.rightHanded),{type:"Polygon",coordinates:i.getCoordinates(t)}}const cp=oC,$u="http://www.w3.org/2001/XMLSchema-instance";function de(i,e){return vy().createElementNS(i,e)}function Vs(i,e){return my(i,e,[]).join("")}function my(i,e,t){if(i.nodeType==Node.CDATA_SECTION_NODE||i.nodeType==Node.TEXT_NODE)e?t.push(String(i.nodeValue).replace(/(\r\n|\r|\n)/g,"")):t.push(i.nodeValue);else{let n;for(n=i.firstChild;n;n=n.nextSibling)my(n,e,t)}return t}function Ls(i){return"documentElement"in i}function bC(i,e,t){return i.getAttributeNS(e,t)||""}function Ps(i){return new DOMParser().parseFromString(i,"application/xml")}function yy(i,e){return function(t,n){const s=i.call(e!==void 0?e:this,t,n);if(s!==void 0){const r=n[n.length-1];Gt(r,s)}}}function se(i,e){return function(t,n){const s=i.call(e!==void 0?e:this,t,n);s!==void 0&&n[n.length-1].push(s)}}function J(i,e){return function(t,n){const s=i.call(e!==void 0?e:this,t,n);s!==void 0&&(n[n.length-1]=s)}}function di(i,e,t){return function(n,s){const r=i.call(t!==void 0?t:this,n,s);if(r!==void 0){const o=s[s.length-1],a=e!==void 0?e:n.localName;let l;a in o?l=o[a]:(l=[],o[a]=l),l.push(r)}}}function W(i,e,t){return function(n,s){const r=i.call(t!==void 0?t:this,n,s);if(r!==void 0){const o=s[s.length-1],a=e!==void 0?e:n.localName;o[a]=r}}}function T(i,e){return function(t,n,s){i.call(e!==void 0?e:this,t,n,s),s[s.length-1].node.appendChild(t)}}function yi(i,e){return function(t,n,s){const o=n[n.length-1].node;let a=i;a===void 0&&(a=s);const l=e!==void 0?e:o.namespaceURI;return de(l,a)}}const _y=yi();function Be(i,e,t){t=t!==void 0?t:{};let n,s;for(n=0,s=i.length;n<s;++n)t[i[n]]=e;return t}function Ns(i,e,t,n){let s;for(s=e.firstElementChild;s;s=s.nextElementSibling){const r=i[s.namespaceURI];if(r!==void 0){const o=r[s.localName];o!==void 0&&o.call(n,s,t)}}}function Y(i,e,t,n,s){return n.push(i),Ns(e,t,n,s),n.pop()}function EC(i,e,t,n,s,r){const o=(s!==void 0?s:t).length;let a,l;for(let h=0;h<o;++h)a=t[h],a!==void 0&&(l=e.call(r!==void 0?r:this,a,n,s!==void 0?s[h]:void 0),l!==void 0&&i[l.namespaceURI][l.localName].call(r,l,a,n))}function it(i,e,t,n,s,r,o){return s.push(i),EC(e,t,n,s,r,o),s.pop()}let Ic;function MC(){return Ic===void 0&&typeof XMLSerializer<"u"&&(Ic=new XMLSerializer),Ic}let Lc;function vy(){return Lc===void 0&&typeof document<"u"&&(Lc=document.implementation.createDocument("","",null)),Lc}class CC extends nf{constructor(){super(),this.xmlSerializer_=MC()}getType(){return"xml"}readFeature(e,t){if(!e)return null;if(typeof e=="string"){const n=Ps(e);return this.readFeatureFromDocument(n,t)}return Ls(e)?this.readFeatureFromDocument(e,t):this.readFeatureFromNode(e,t)}readFeatureFromDocument(e,t){const n=this.readFeaturesFromDocument(e,t);return n.length>0?n[0]:null}readFeatureFromNode(e,t){return null}readFeatures(e,t){if(!e)return[];if(typeof e=="string"){const n=Ps(e);return this.readFeaturesFromDocument(n,t)}return Ls(e)?this.readFeaturesFromDocument(e,t):this.readFeaturesFromNode(e,t)}readFeaturesFromDocument(e,t){const n=[];for(let s=e.firstChild;s;s=s.nextSibling)s.nodeType==Node.ELEMENT_NODE&&Gt(n,this.readFeaturesFromNode(s,t));return n}readFeaturesFromNode(e,t){return ie()}readGeometry(e,t){if(!e)return null;if(typeof e=="string"){const n=Ps(e);return this.readGeometryFromDocument(n,t)}return Ls(e)?this.readGeometryFromDocument(e,t):this.readGeometryFromNode(e,t)}readGeometryFromDocument(e,t){return null}readGeometryFromNode(e,t){return null}readProjection(e){if(!e)return null;if(typeof e=="string"){const t=Ps(e);return this.readProjectionFromDocument(t)}return Ls(e)?this.readProjectionFromDocument(e):this.readProjectionFromNode(e)}readProjectionFromDocument(e){return this.dataProjection}readProjectionFromNode(e){return this.dataProjection}writeFeature(e,t){const n=this.writeFeatureNode(e,t);return this.xmlSerializer_.serializeToString(n)}writeFeatureNode(e,t){return null}writeFeatures(e,t){const n=this.writeFeaturesNode(e,t);return this.xmlSerializer_.serializeToString(n)}writeFeaturesNode(e,t){return null}writeGeometry(e,t){const n=this.writeGeometryNode(e,t);return this.xmlSerializer_.serializeToString(n)}writeGeometryNode(e,t){return null}}const xy=CC,Ln="http://www.opengis.net/gml",SC=/^\s*$/;class nt extends xy{constructor(e){super(),e=e||{},this.featureType=e.featureType,this.featureNS=e.featureNS,this.srsName=e.srsName,this.schemaLocation="",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:se(this.readFeaturesInternal),featureMembers:J(this.readFeaturesInternal)},this.supportedMediaTypes=["application/gml+xml"]}readFeaturesInternal(e,t){const n=e.localName;let s=null;if(n=="FeatureCollection")s=Y([],this.FEATURE_COLLECTION_PARSERS,e,t,this);else if(n=="featureMembers"||n=="featureMember"||n=="member"){const r=t[0];let o=r.featureType,a=r.featureNS;const l="p",h="p0";if(!o&&e.childNodes){o=[],a={};for(let d=0,f=e.childNodes.length;d<f;++d){const g=e.childNodes[d];if(g.nodeType===1){const p=g.nodeName.split(":").pop();if(!o.includes(p)){let m="",_=0;const y=g.namespaceURI;for(const x in a){if(a[x]===y){m=x;break}++_}m||(m=l+_,a[m]=y),o.push(m+":"+p)}}}n!="featureMember"&&(r.featureType=o,r.featureNS=a)}if(typeof a=="string"){const d=a;a={},a[h]=d}const c={},u=Array.isArray(o)?o:[o];for(const d in a){const f={};for(let g=0,p=u.length;g<p;++g)(u[g].includes(":")?u[g].split(":")[0]:h)===d&&(f[u[g].split(":").pop()]=n=="featureMembers"?se(this.readFeatureElement,this):J(this.readFeatureElement,this));c[a[d]]=f}n=="featureMember"||n=="member"?s=Y(void 0,c,e,t):s=Y([],c,e,t)}return s===null&&(s=[]),s}readGeometryOrExtent(e,t){const n=t[0];return n.srsName=e.firstElementChild.getAttribute("srsName"),n.srsDimension=e.firstElementChild.getAttribute("srsDimension"),Y(null,this.GEOMETRY_PARSERS,e,t,this)}readExtentElement(e,t){const n=t[0],s=this.readGeometryOrExtent(e,t);return s?sf(s,n):void 0}readGeometryElement(e,t){const n=t[0],s=this.readGeometryOrExtent(e,t);return s?Qs(s,!1,n):void 0}readFeatureElementInternal(e,t,n){let s;const r={};for(let l=e.firstElementChild;l;l=l.nextElementSibling){let h;const c=l.localName;l.childNodes.length===0||l.childNodes.length===1&&(l.firstChild.nodeType===3||l.firstChild.nodeType===4)?(h=Vs(l,!1),SC.test(h)&&(h=void 0)):(n&&(h=c==="boundedBy"?this.readExtentElement(l,t):this.readGeometryElement(l,t)),h?c!=="boundedBy"&&(s=c):h=this.readFeatureElementInternal(l,t,!1));const u=l.attributes.length;if(u>0&&!(h instanceof sc)){h={_content_:h};for(let d=0;d<u;d++){const f=l.attributes[d].name;h[f]=l.attributes[d].value}}r[c]?(r[c]instanceof Array||(r[c]=[r[c]]),r[c].push(h)):r[c]=h}if(!n)return r;const o=new rn(r);s&&o.setGeometryName(s);const a=e.getAttribute("fid")||bC(e,this.namespace,"id");return a&&o.setId(a),o}readFeatureElement(e,t){return this.readFeatureElementInternal(e,t,!0)}readPoint(e,t){const n=this.readFlatCoordinatesFromNode(e,t);if(n)return new Ai(n,"XYZ")}readMultiPoint(e,t){const n=Y([],this.MULTIPOINT_PARSERS,e,t,this);if(n)return new mo(n)}readMultiLineString(e,t){const n=Y([],this.MULTILINESTRING_PARSERS,e,t,this);if(n)return new Ks(n)}readMultiPolygon(e,t){const n=Y([],this.MULTIPOLYGON_PARSERS,e,t,this);if(n)return new Js(n)}pointMemberParser(e,t){Ns(this.POINTMEMBER_PARSERS,e,t,this)}lineStringMemberParser(e,t){Ns(this.LINESTRINGMEMBER_PARSERS,e,t,this)}polygonMemberParser(e,t){Ns(this.POLYGONMEMBER_PARSERS,e,t,this)}readLineString(e,t){const n=this.readFlatCoordinatesFromNode(e,t);if(n)return new Yi(n,"XYZ")}readFlatLinearRing(e,t){const n=Y(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this);if(n)return n}readLinearRing(e,t){const n=this.readFlatCoordinatesFromNode(e,t);if(n)return new Du(n,"XYZ")}readPolygon(e,t){const n=Y([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this);if(n&&n[0]){const s=n[0],r=[s.length];let o,a;for(o=1,a=n.length;o<a;++o)Gt(s,n[o]),r.push(s.length);return new Zi(s,"XYZ",r)}}readFlatCoordinatesFromNode(e,t){return Y(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}readGeometryFromNode(e,t){const n=this.readGeometryElement(e,[this.getReadOptions(e,t||{})]);return n||null}readFeaturesFromNode(e,t){const n={featureType:this.featureType,featureNS:this.featureNS};return n&&Object.assign(n,this.getReadOptions(e,t)),this.readFeaturesInternal(e,[n])||[]}readProjectionFromNode(e){return K(this.srsName?this.srsName:e.firstElementChild.getAttribute("srsName"))}}nt.prototype.namespace=Ln;nt.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}};nt.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}};nt.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}};nt.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:se(nt.prototype.pointMemberParser),pointMembers:se(nt.prototype.pointMemberParser)}};nt.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:se(nt.prototype.lineStringMemberParser),lineStringMembers:se(nt.prototype.lineStringMemberParser)}};nt.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:se(nt.prototype.polygonMemberParser),polygonMembers:se(nt.prototype.polygonMemberParser)}};nt.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:se(nt.prototype.readFlatCoordinatesFromNode)}};nt.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:se(nt.prototype.readLineString)}};nt.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:se(nt.prototype.readPolygon)}};nt.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:J(nt.prototype.readFlatLinearRing)}};const ge=nt;function TC(i){const e=Vs(i,!1);return RC(e)}function RC(i){const e=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(i);if(e)return parseFloat(e[1])}function ei(i){const e=Vs(i,!1);return Mr(e)}function Mr(i){const e=/^\s*(\d+)\s*$/.exec(i);if(e)return parseInt(e[1],10)}function Ie(i){return Vs(i,!1).trim()}function ft(i,e){i.appendChild(vy().createTextNode(e))}const IC=Ln+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",LC={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class Te extends ge{constructor(e){e=e||{},super(e),this.FEATURE_COLLECTION_PARSERS[Ln].featureMember=se(this.readFeaturesInternal),this.schemaLocation=e.schemaLocation?e.schemaLocation:IC}readFlatCoordinates(e,t){const n=Vs(e,!1).replace(/^\s*|\s*$/g,""),r=t[0].srsName;let o="enu";if(r){const h=K(r);h&&(o=h.getAxisOrientation())}const a=n.trim().split(/\s+/),l=[];for(let h=0,c=a.length;h<c;h++){const u=a[h].split(/,+/),d=parseFloat(u[0]),f=parseFloat(u[1]),g=u.length===3?parseFloat(u[2]):0;o.substr(0,2)==="en"?l.push(d,f,g):l.push(f,d,g)}return l}readBox(e,t){const n=Y([null],this.BOX_PARSERS_,e,t,this);return Fi(n[1][0],n[1][1],n[1][3],n[1][4])}innerBoundaryIsParser(e,t){const n=Y(void 0,this.RING_PARSERS,e,t,this);n&&t[t.length-1].push(n)}outerBoundaryIsParser(e,t){const n=Y(void 0,this.RING_PARSERS,e,t,this);if(n){const s=t[t.length-1];s[0]=n}}GEOMETRY_NODE_FACTORY_(e,t,n){const s=t[t.length-1],r=s.multiSurface,o=s.surface,a=s.multiCurve;return Array.isArray(e)?n="Envelope":(n=e.getType(),n==="MultiPolygon"&&r===!0?n="MultiSurface":n==="Polygon"&&o===!0?n="Surface":n==="MultiLineString"&&a===!0&&(n="MultiCurve")),de("http://www.opengis.net/gml",n)}writeFeatureElement(e,t,n){const s=t.getId();s&&e.setAttribute("fid",s);const r=n[n.length-1],o=r.featureNS,a=t.getGeometryName();r.serializers||(r.serializers={},r.serializers[o]={});const l=[],h=[];if(t.hasProperties()){const u=t.getProperties();for(const d in u){const f=u[d];f!==null&&(l.push(d),h.push(f),d==a||typeof f.getSimplifiedGeometry=="function"?d in r.serializers[o]||(r.serializers[o][d]=T(this.writeGeometryElement,this)):d in r.serializers[o]||(r.serializers[o][d]=T(ft)))}}const c=Object.assign({},r);c.node=e,it(c,r.serializers,yi(void 0,o),h,n,l)}writeCurveOrLineString(e,t,n){const r=n[n.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&r&&e.setAttribute("srsName",r),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o),this.writeCoordinates_(o,t,n)}else if(e.nodeName==="Curve"){const o=de(e.namespaceURI,"segments");e.appendChild(o),this.writeCurveSegments_(o,t,n)}}writeLineStringOrCurveMember(e,t,n){const s=this.GEOMETRY_NODE_FACTORY_(t,n);s&&(e.appendChild(s),this.writeCurveOrLineString(s,t,n))}writeMultiCurveOrLineString(e,t,n){const s=n[n.length-1],r=s.hasZ,o=s.srsName,a=s.curve;o&&e.setAttribute("srsName",o);const l=t.getLineStrings();it({node:e,hasZ:r,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeGeometryElement(e,t,n){const s=n[n.length-1],r=Object.assign({},s);r.node=e;let o;Array.isArray(t)?o=sf(t,s):o=Qs(t,!0,s),it(r,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],n,void 0,this)}createCoordinatesNode_(e){const t=de(e,"coordinates");return t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," "),t}writeCoordinates_(e,t,n){const s=n[n.length-1],r=s.hasZ,o=s.srsName,a=t.getCoordinates(),l=a.length,h=new Array(l);for(let c=0;c<l;++c){const u=a[c];h[c]=this.getCoords_(u,o,r)}ft(e,h.join(" "))}writeCurveSegments_(e,t,n){const s=de(e.namespaceURI,"LineStringSegment");e.appendChild(s),this.writeCurveOrLineString(s,t,n)}writeSurfaceOrPolygon(e,t,n){const s=n[n.length-1],r=s.hasZ,o=s.srsName;if(e.nodeName!=="PolygonPatch"&&o&&e.setAttribute("srsName",o),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const a=t.getLinearRings();it({node:e,hasZ:r,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,n,void 0,this)}else if(e.nodeName==="Surface"){const a=de(e.namespaceURI,"patches");e.appendChild(a),this.writeSurfacePatches_(a,t,n)}}RING_NODE_FACTORY_(e,t,n){const s=t[t.length-1],r=s.node,o=s.exteriorWritten;return o===void 0&&(s.exteriorWritten=!0),de(r.namespaceURI,o!==void 0?"innerBoundaryIs":"outerBoundaryIs")}writeSurfacePatches_(e,t,n){const s=de(e.namespaceURI,"PolygonPatch");e.appendChild(s),this.writeSurfaceOrPolygon(s,t,n)}writeRing(e,t,n){const s=de(e.namespaceURI,"LinearRing");e.appendChild(s),this.writeLinearRing(s,t,n)}getCoords_(e,t,n){let s="enu";t&&(s=K(t).getAxisOrientation());let r=s.substr(0,2)==="en"?e[0]+","+e[1]:e[1]+","+e[0];if(n){const o=e[2]||0;r+=","+o}return r}writePoint(e,t,n){const s=n[n.length-1],r=s.hasZ,o=s.srsName;o&&e.setAttribute("srsName",o);const a=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(a);const l=t.getCoordinates(),h=this.getCoords_(l,o,r);ft(a,h)}writeMultiPoint(e,t,n){const s=n[n.length-1],r=s.hasZ,o=s.srsName;o&&e.setAttribute("srsName",o);const a=t.getPoints();it({node:e,hasZ:r,srsName:o},this.POINTMEMBER_SERIALIZERS,yi("pointMember"),a,n,void 0,this)}writePointMember(e,t,n){const s=de(e.namespaceURI,"Point");e.appendChild(s),this.writePoint(s,t,n)}writeLinearRing(e,t,n){const r=n[n.length-1].srsName;r&&e.setAttribute("srsName",r);const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o),this.writeCoordinates_(o,t,n)}writeMultiSurfaceOrPolygon(e,t,n){const s=n[n.length-1],r=s.hasZ,o=s.srsName,a=s.surface;o&&e.setAttribute("srsName",o);const l=t.getPolygons();it({node:e,hasZ:r,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeSurfaceOrPolygonMember(e,t,n){const s=this.GEOMETRY_NODE_FACTORY_(t,n);s&&(e.appendChild(s),this.writeSurfaceOrPolygon(s,t,n))}writeEnvelope(e,t,n){const r=n[n.length-1].srsName;r&&e.setAttribute("srsName",r);const o=["lowerCorner","upperCorner"],a=[t[0]+" "+t[1],t[2]+" "+t[3]];it({node:e},this.ENVELOPE_SERIALIZERS,_y,a,n,o,this)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,n){const s=t[t.length-1].node;return de("http://www.opengis.net/gml",LC[s.nodeName])}}Te.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:J(Te.prototype.readFlatCoordinates)}};Te.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:Te.prototype.innerBoundaryIsParser,outerBoundaryIs:Te.prototype.outerBoundaryIsParser}};Te.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:se(Te.prototype.readFlatCoordinates)}};Te.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:J(ge.prototype.readPoint),MultiPoint:J(ge.prototype.readMultiPoint),LineString:J(ge.prototype.readLineString),MultiLineString:J(ge.prototype.readMultiLineString),LinearRing:J(ge.prototype.readLinearRing),Polygon:J(ge.prototype.readPolygon),MultiPolygon:J(ge.prototype.readMultiPolygon),Box:J(Te.prototype.readBox)}};Te.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:T(Te.prototype.writeCurveOrLineString),MultiCurve:T(Te.prototype.writeMultiCurveOrLineString),Point:T(Te.prototype.writePoint),MultiPoint:T(Te.prototype.writeMultiPoint),LineString:T(Te.prototype.writeCurveOrLineString),MultiLineString:T(Te.prototype.writeMultiCurveOrLineString),LinearRing:T(Te.prototype.writeLinearRing),Polygon:T(Te.prototype.writeSurfaceOrPolygon),MultiPolygon:T(Te.prototype.writeMultiSurfaceOrPolygon),Surface:T(Te.prototype.writeSurfaceOrPolygon),MultiSurface:T(Te.prototype.writeMultiSurfaceOrPolygon),Envelope:T(Te.prototype.writeEnvelope)}};Te.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:T(Te.prototype.writeLineStringOrCurveMember),curveMember:T(Te.prototype.writeLineStringOrCurveMember)}};Te.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:T(Te.prototype.writeRing),innerBoundaryIs:T(Te.prototype.writeRing)}};Te.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:T(Te.prototype.writePointMember)}};Te.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:T(Te.prototype.writeSurfaceOrPolygonMember),polygonMember:T(Te.prototype.writeSurfaceOrPolygonMember)}};Te.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:T(ft),upperCorner:T(ft)}};const Ba=Te,PC=Ln+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",AC={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class V extends ge{constructor(e){e=e||{},super(e),this.surface_=e.surface!==void 0?e.surface:!1,this.curve_=e.curve!==void 0?e.curve:!1,this.multiCurve_=e.multiCurve!==void 0?e.multiCurve:!0,this.multiSurface_=e.multiSurface!==void 0?e.multiSurface:!0,this.schemaLocation=e.schemaLocation?e.schemaLocation:PC,this.hasZ=e.hasZ!==void 0?e.hasZ:!1}readMultiCurve(e,t){const n=Y([],this.MULTICURVE_PARSERS,e,t,this);if(n)return new Ks(n)}readFlatCurveRing(e,t){const n=Y([],this.MULTICURVE_PARSERS,e,t,this),s=[];for(let r=0,o=n.length;r<o;++r)Gt(s,n[r].getFlatCoordinates());return s}readMultiSurface(e,t){const n=Y([],this.MULTISURFACE_PARSERS,e,t,this);if(n)return new Js(n)}curveMemberParser(e,t){Ns(this.CURVEMEMBER_PARSERS,e,t,this)}surfaceMemberParser(e,t){Ns(this.SURFACEMEMBER_PARSERS,e,t,this)}readPatch(e,t){return Y([null],this.PATCHES_PARSERS,e,t,this)}readSegment(e,t){return Y([],this.SEGMENTS_PARSERS,e,t,this)}readPolygonPatch(e,t){return Y([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this)}readLineStringSegment(e,t){return Y([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}interiorParser(e,t){const n=Y(void 0,this.RING_PARSERS,e,t,this);n&&t[t.length-1].push(n)}exteriorParser(e,t){const n=Y(void 0,this.RING_PARSERS,e,t,this);if(n){const s=t[t.length-1];s[0]=n}}readSurface(e,t){const n=Y([null],this.SURFACE_PARSERS,e,t,this);if(n&&n[0]){const s=n[0],r=[s.length];let o,a;for(o=1,a=n.length;o<a;++o)Gt(s,n[o]),r.push(s.length);return new Zi(s,"XYZ",r)}}readCurve(e,t){const n=Y([null],this.CURVE_PARSERS,e,t,this);if(n)return new Yi(n,"XYZ")}readEnvelope(e,t){const n=Y([null],this.ENVELOPE_PARSERS,e,t,this);return Fi(n[1][0],n[1][1],n[2][0],n[2][1])}readFlatPos(e,t){let n=Vs(e,!1);const s=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,r=[];let o;for(;o=s.exec(n);)r.push(parseFloat(o[1])),n=n.substr(o[0].length);if(n!=="")return;const l=t[0].srsName;let h="enu";if(l&&(h=K(l).getAxisOrientation()),h==="neu"){let u,d;for(u=0,d=r.length;u<d;u+=3){const f=r[u],g=r[u+1];r[u]=g,r[u+1]=f}}const c=r.length;if(c==2&&r.push(0),c!==0)return r}readFlatPosList(e,t){const n=Vs(e,!1).replace(/^\s*|\s*$/g,""),s=t[0],r=s.srsName,o=s.srsDimension;let a="enu";r&&(a=K(r).getAxisOrientation());const l=n.split(/\s+/);let h=2;e.getAttribute("srsDimension")?h=Mr(e.getAttribute("srsDimension")):e.getAttribute("dimension")?h=Mr(e.getAttribute("dimension")):e.parentNode.getAttribute("srsDimension")?h=Mr(e.parentNode.getAttribute("srsDimension")):o&&(h=Mr(o));let c,u,d;const f=[];for(let g=0,p=l.length;g<p;g+=h)c=parseFloat(l[g]),u=parseFloat(l[g+1]),d=h===3?parseFloat(l[g+2]):0,a.substr(0,2)==="en"?f.push(c,u,d):f.push(u,c,d);return f}writePos_(e,t,n){const s=n[n.length-1],r=s.hasZ,o=r?"3":"2";e.setAttribute("srsDimension",o);const a=s.srsName;let l="enu";a&&(l=K(a).getAxisOrientation());const h=t.getCoordinates();let c;if(l.substr(0,2)==="en"?c=h[0]+" "+h[1]:c=h[1]+" "+h[0],r){const u=h[2]||0;c+=" "+u}ft(e,c)}getCoords_(e,t,n){let s="enu";t&&(s=K(t).getAxisOrientation());let r=s.substr(0,2)==="en"?e[0]+" "+e[1]:e[1]+" "+e[0];if(n){const o=e[2]||0;r+=" "+o}return r}writePosList_(e,t,n){const s=n[n.length-1],r=s.hasZ,o=r?"3":"2";e.setAttribute("srsDimension",o);const a=s.srsName,l=t.getCoordinates(),h=l.length,c=new Array(h);let u;for(let d=0;d<h;++d)u=l[d],c[d]=this.getCoords_(u,a,r);ft(e,c.join(" "))}writePoint(e,t,n){const r=n[n.length-1].srsName;r&&e.setAttribute("srsName",r);const o=de(e.namespaceURI,"pos");e.appendChild(o),this.writePos_(o,t,n)}writeEnvelope(e,t,n){const r=n[n.length-1].srsName;r&&e.setAttribute("srsName",r);const o=["lowerCorner","upperCorner"],a=[t[0]+" "+t[1],t[2]+" "+t[3]];it({node:e},this.ENVELOPE_SERIALIZERS,_y,a,n,o,this)}writeLinearRing(e,t,n){const r=n[n.length-1].srsName;r&&e.setAttribute("srsName",r);const o=de(e.namespaceURI,"posList");e.appendChild(o),this.writePosList_(o,t,n)}RING_NODE_FACTORY_(e,t,n){const s=t[t.length-1],r=s.node,o=s.exteriorWritten;return o===void 0&&(s.exteriorWritten=!0),de(r.namespaceURI,o!==void 0?"interior":"exterior")}writeSurfaceOrPolygon(e,t,n){const s=n[n.length-1],r=s.hasZ,o=s.srsName;if(e.nodeName!=="PolygonPatch"&&o&&e.setAttribute("srsName",o),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const a=t.getLinearRings();it({node:e,hasZ:r,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,n,void 0,this)}else if(e.nodeName==="Surface"){const a=de(e.namespaceURI,"patches");e.appendChild(a),this.writeSurfacePatches_(a,t,n)}}writeCurveOrLineString(e,t,n){const r=n[n.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&r&&e.setAttribute("srsName",r),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const o=de(e.namespaceURI,"posList");e.appendChild(o),this.writePosList_(o,t,n)}else if(e.nodeName==="Curve"){const o=de(e.namespaceURI,"segments");e.appendChild(o),this.writeCurveSegments_(o,t,n)}}writeMultiSurfaceOrPolygon(e,t,n){const s=n[n.length-1],r=s.hasZ,o=s.srsName,a=s.surface;o&&e.setAttribute("srsName",o);const l=t.getPolygons();it({node:e,hasZ:r,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeMultiPoint(e,t,n){const s=n[n.length-1],r=s.srsName,o=s.hasZ;r&&e.setAttribute("srsName",r);const a=t.getPoints();it({node:e,hasZ:o,srsName:r},this.POINTMEMBER_SERIALIZERS,yi("pointMember"),a,n,void 0,this)}writeMultiCurveOrLineString(e,t,n){const s=n[n.length-1],r=s.hasZ,o=s.srsName,a=s.curve;o&&e.setAttribute("srsName",o);const l=t.getLineStrings();it({node:e,hasZ:r,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeRing(e,t,n){const s=de(e.namespaceURI,"LinearRing");e.appendChild(s),this.writeLinearRing(s,t,n)}writeSurfaceOrPolygonMember(e,t,n){const s=this.GEOMETRY_NODE_FACTORY_(t,n);s&&(e.appendChild(s),this.writeSurfaceOrPolygon(s,t,n))}writePointMember(e,t,n){const s=de(e.namespaceURI,"Point");e.appendChild(s),this.writePoint(s,t,n)}writeLineStringOrCurveMember(e,t,n){const s=this.GEOMETRY_NODE_FACTORY_(t,n);s&&(e.appendChild(s),this.writeCurveOrLineString(s,t,n))}writeSurfacePatches_(e,t,n){const s=de(e.namespaceURI,"PolygonPatch");e.appendChild(s),this.writeSurfaceOrPolygon(s,t,n)}writeCurveSegments_(e,t,n){const s=de(e.namespaceURI,"LineStringSegment");e.appendChild(s),this.writeCurveOrLineString(s,t,n)}writeGeometryElement(e,t,n){const s=n[n.length-1],r=Object.assign({},s);r.node=e;let o;Array.isArray(t)?o=sf(t,s):o=Qs(t,!0,s),it(r,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],n,void 0,this)}writeFeatureElement(e,t,n){const s=t.getId();s&&e.setAttribute("fid",s);const r=n[n.length-1],o=r.featureNS,a=t.getGeometryName();r.serializers||(r.serializers={},r.serializers[o]={});const l=[],h=[];if(t.hasProperties()){const u=t.getProperties();for(const d in u){const f=u[d];f!==null&&(l.push(d),h.push(f),d==a||typeof f.getSimplifiedGeometry=="function"?d in r.serializers[o]||(r.serializers[o][d]=T(this.writeGeometryElement,this)):d in r.serializers[o]||(r.serializers[o][d]=T(ft)))}}const c=Object.assign({},r);c.node=e,it(c,r.serializers,yi(void 0,o),h,n,l)}writeFeatureMembers_(e,t,n){const s=n[n.length-1],r=s.featureType,o=s.featureNS,a={};a[o]={},a[o][r]=T(this.writeFeatureElement,this);const l=Object.assign({},s);l.node=e,it(l,a,yi(r,o),t,n)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,n){const s=t[t.length-1].node;return de(this.namespace,AC[s.nodeName])}GEOMETRY_NODE_FACTORY_(e,t,n){const s=t[t.length-1],r=s.multiSurface,o=s.surface,a=s.curve,l=s.multiCurve;return Array.isArray(e)?n="Envelope":(n=e.getType(),n==="MultiPolygon"&&r===!0?n="MultiSurface":n==="Polygon"&&o===!0?n="Surface":n==="LineString"&&a===!0?n="Curve":n==="MultiLineString"&&l===!0&&(n="MultiCurve")),de(this.namespace,n)}writeGeometryNode(e,t){t=this.adaptOptions(t);const n=de(this.namespace,"geom"),s={node:n,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return t&&Object.assign(s,t),this.writeGeometryElement(n,e,[s]),n}writeFeaturesNode(e,t){t=this.adaptOptions(t);const n=de(this.namespace,"featureMembers");n.setAttributeNS($u,"xsi:schemaLocation",this.schemaLocation);const s={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return t&&Object.assign(s,t),this.writeFeatureMembers_(n,e,[s]),n}}V.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:J(V.prototype.readFlatPos),posList:J(V.prototype.readFlatPosList),coordinates:J(Ba.prototype.readFlatCoordinates)}};V.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:V.prototype.interiorParser,exterior:V.prototype.exteriorParser}};V.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:J(ge.prototype.readPoint),MultiPoint:J(ge.prototype.readMultiPoint),LineString:J(ge.prototype.readLineString),MultiLineString:J(ge.prototype.readMultiLineString),LinearRing:J(ge.prototype.readLinearRing),Polygon:J(ge.prototype.readPolygon),MultiPolygon:J(ge.prototype.readMultiPolygon),Surface:J(V.prototype.readSurface),MultiSurface:J(V.prototype.readMultiSurface),Curve:J(V.prototype.readCurve),MultiCurve:J(V.prototype.readMultiCurve),Envelope:J(V.prototype.readEnvelope)}};V.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:se(V.prototype.curveMemberParser),curveMembers:se(V.prototype.curveMemberParser)}};V.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:se(V.prototype.surfaceMemberParser),surfaceMembers:se(V.prototype.surfaceMemberParser)}};V.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:se(ge.prototype.readLineString),Curve:se(V.prototype.readCurve)}};V.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:se(ge.prototype.readPolygon),Surface:se(V.prototype.readSurface)}};V.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:J(V.prototype.readPatch)}};V.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:J(V.prototype.readSegment)}};V.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:se(V.prototype.readFlatPosList),upperCorner:se(V.prototype.readFlatPosList)}};V.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:J(V.prototype.readPolygonPatch)}};V.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:yy(V.prototype.readLineStringSegment)}};ge.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:J(ge.prototype.readFlatLinearRing),Ring:J(V.prototype.readFlatCurveRing)}};V.prototype.writeFeatures;V.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:T(V.prototype.writeRing),interior:T(V.prototype.writeRing)}};V.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:T(ft),upperCorner:T(ft)}};V.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:T(V.prototype.writeSurfaceOrPolygonMember),polygonMember:T(V.prototype.writeSurfaceOrPolygonMember)}};V.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:T(V.prototype.writePointMember)}};V.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:T(V.prototype.writeLineStringOrCurveMember),curveMember:T(V.prototype.writeLineStringOrCurveMember)}};V.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:T(V.prototype.writeCurveOrLineString),MultiCurve:T(V.prototype.writeMultiCurveOrLineString),Point:T(V.prototype.writePoint),MultiPoint:T(V.prototype.writeMultiPoint),LineString:T(V.prototype.writeCurveOrLineString),MultiLineString:T(V.prototype.writeMultiCurveOrLineString),LinearRing:T(V.prototype.writeLinearRing),Polygon:T(V.prototype.writeSurfaceOrPolygon),MultiPolygon:T(V.prototype.writeMultiSurfaceOrPolygon),Surface:T(V.prototype.writeSurfaceOrPolygon),MultiSurface:T(V.prototype.writeMultiSurfaceOrPolygon),Envelope:T(V.prototype.writeEnvelope)}};const fe=V;class af{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null}clone(){const e=this.getColor();return new af({color:Array.isArray(e)?e.slice():e||void 0})}getColor(){return this.color_}setColor(e){this.color_=e}}const jt=af,oe={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function up(i){return i[0]>0&&i[1]>0}function FC(i,e,t){return t===void 0&&(t=[0,0]),t[0]=i[0]*e+.5|0,t[1]=i[1]*e+.5|0,t}function Vt(i,e){return Array.isArray(i)?i:(e===void 0?e=[i,i]:(e[0]=i,e[1]=i),e)}class lf{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=Vt(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new lf({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return ie()}getImage(e){return ie()}getHitDetectionImage(){return ie()}getPixelRatio(e){return 1}getImageState(){return ie()}getImageSize(){return ie()}getOrigin(){return ie()}getSize(){return ie()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=Vt(e)}listenImageChange(e){ie()}load(){ie()}unlistenImageChange(e){ie()}}const wy=lf,ta={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var Rt={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};Rt.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}};Rt.max=Rt.whitepoint[2].D65;Rt.rgb=function(i,e){e=e||Rt.whitepoint[2].E;var t=i[0]/e[0],n=i[1]/e[1],s=i[2]/e[2],r,o,a;return r=t*3.240969941904521+n*-1.537383177570093+s*-.498610760293,o=t*-.96924363628087+n*1.87596750150772+s*.041555057407175,a=t*.055630079696993+n*-.20397695888897+s*1.056971514242878,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:r=r*12.92,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o=o*12.92,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=a*12.92,r=Math.min(Math.max(0,r),1),o=Math.min(Math.max(0,o),1),a=Math.min(Math.max(0,a),1),[r*255,o*255,a*255]};ta.xyz=function(i,e){var t=i[0]/255,n=i[1]/255,s=i[2]/255;t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,s=s>.04045?Math.pow((s+.055)/1.055,2.4):s/12.92;var r=t*.41239079926595+n*.35758433938387+s*.18048078840183,o=t*.21263900587151+n*.71516867876775+s*.072192315360733,a=t*.019330818715591+n*.11919477979462+s*.95053215224966;return e=e||Rt.whitepoint[2].E,[r*e[0],o*e[1],a*e[2]]};const hf={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(i,e,t){var n,s,r,o,a,l,h,c,u,d,f,g,p;if(r=i[0],o=i[1],a=i[2],r===0)return[0,0,0];var m=.0011070564598794539;return e=e||"D65",t=t||2,u=Rt.whitepoint[t][e][0],d=Rt.whitepoint[t][e][1],f=Rt.whitepoint[t][e][2],g=4*u/(u+15*d+3*f),p=9*d/(u+15*d+3*f),n=o/(13*r)+g||0,s=a/(13*r)+p||0,h=r>8?d*Math.pow((r+16)/116,3):d*r*m,l=h*9*n/(4*s)||0,c=h*(12-3*n-20*s)/(4*s)||0,[l,h,c]}};Rt.luv=function(i,e,t){var n,s,r,o,a,l,h,c,u,d,f,g,p,m=.008856451679035631,_=903.2962962962961;e=e||"D65",t=t||2,u=Rt.whitepoint[t][e][0],d=Rt.whitepoint[t][e][1],f=Rt.whitepoint[t][e][2],g=4*u/(u+15*d+3*f),p=9*d/(u+15*d+3*f),l=i[0],h=i[1],c=i[2],n=4*l/(l+15*h+3*c)||0,s=9*h/(l+15*h+3*c)||0;var y=h/d;return r=y<=m?_*y:116*Math.pow(y,1/3)-16,o=13*r*(n-g),a=13*r*(s-p),[r,o,a]};var by={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(i){var e=i[0],t=i[1],n=i[2],s,r,o;return o=n/360*2*Math.PI,s=t*Math.cos(o),r=t*Math.sin(o),[e,s,r]},xyz:function(i){return hf.xyz(by.luv(i))}};hf.lchuv=function(i){var e=i[0],t=i[1],n=i[2],s=Math.sqrt(t*t+n*n),r=Math.atan2(n,t),o=r*360/2/Math.PI;return o<0&&(o+=360),[e,s,o]};Rt.lchuv=function(i){return hf.lchuv(Rt.luv(i))};var kC={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};const dp=Xm(kC);var fp={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function OC(i){var c,u;var e,t=[],n=1,s;if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(i=String(i).toLowerCase(),dp[i])t=dp[i].slice(),s="rgb";else if(i==="transparent")n=0,s="rgb",t=[0,0,0];else if(i[0]==="#"){var r=i.slice(1),o=r.length,a=o<=4;n=1,a?(t=[parseInt(r[0]+r[0],16),parseInt(r[1]+r[1],16),parseInt(r[2]+r[2],16)],o===4&&(n=parseInt(r[3]+r[3],16)/255)):(t=[parseInt(r[0]+r[1],16),parseInt(r[2]+r[3],16),parseInt(r[4]+r[5],16)],o===8&&(n=parseInt(r[6]+r[7],16)/255)),t[0]||(t[0]=0),t[1]||(t[1]=0),t[2]||(t[2]=0),s="rgb"}else if(e=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(i)){var l=e[1];s=l.replace(/a$/,"");var h=s==="cmyk"?4:s==="gray"?1:3;t=e[2].trim().split(/\s*[,\/]\s*|\s+/),s==="color"&&(s=t.shift()),t=t.map(function(d,f){if(d[d.length-1]==="%")return d=parseFloat(d)/100,f===3?d:s==="rgb"?d*255:s[0]==="h"||s[0]==="l"&&!f?d*100:s==="lab"?d*125:s==="lch"?f<2?d*150:d*360:s[0]==="o"&&!f?d:s==="oklab"?d*.4:s==="oklch"?f<2?d*.4:d*360:d;if(s[f]==="h"||f===2&&s[s.length-1]==="h"){if(fp[d]!==void 0)return fp[d];if(d.endsWith("deg"))return parseFloat(d);if(d.endsWith("turn"))return parseFloat(d)*360;if(d.endsWith("grad"))return parseFloat(d)*360/400;if(d.endsWith("rad"))return parseFloat(d)*180/Math.PI}return d==="none"?0:parseFloat(d)}),n=t.length>h?t.pop():1}else/[0-9](?:\s|\/|,)/.test(i)&&(t=i.match(/([0-9]+)/g).map(function(d){return parseFloat(d)}),s=((u=(c=i.match(/([a-z])/ig))==null?void 0:c.join(""))==null?void 0:u.toLowerCase())||"rgb");return{space:s,values:t,alpha:n}}const Pc={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(i){var e=i[0]/360,t=i[1]/100,n=i[2]/100,s,r,o,a,l,h=0;if(t===0)return l=n*255,[l,l,l];for(r=n<.5?n*(1+t):n+t-n*t,s=2*n-r,a=[0,0,0];h<3;)o=e+1/3*-(h-1),o<0?o++:o>1&&o--,l=6*o<1?s+(r-s)*6*o:2*o<1?r:3*o<2?s+(r-s)*(2/3-o)*6:s,a[h++]=l*255;return a}};ta.hsl=function(i){var e=i[0]/255,t=i[1]/255,n=i[2]/255,s=Math.min(e,t,n),r=Math.max(e,t,n),o=r-s,a,l,h;return r===s?a=0:e===r?a=(t-n)/o:t===r?a=2+(n-e)/o:n===r&&(a=4+(e-t)/o),a=Math.min(a*60,360),a<0&&(a+=360),h=(s+r)/2,r===s?l=0:h<=.5?l=o/(r+s):l=o/(2-r-s),[a,l*100,h*100]};function NC(i){Array.isArray(i)&&i.raw&&(i=String.raw(...arguments)),i instanceof Number&&(i=+i);var e,t=OC(i);if(!t.space)return[];const n=t.space[0]==="h"?Pc.min:ta.min,s=t.space[0]==="h"?Pc.max:ta.max;return e=Array(3),e[0]=Math.min(Math.max(t.values[0],n[0]),s[0]),e[1]=Math.min(Math.max(t.values[1],n[1]),s[1]),e[2]=Math.min(Math.max(t.values[2],n[2]),s[2]),t.space[0]==="h"&&(e=Pc.rgb(e)),e.push(Math.min(Math.max(t.alpha,0),1)),e}function Ey(i){return typeof i=="string"?i:Cy(i)}const DC=1024,Ro={};let Ac=0;function GC(i){if(i.length===4)return i;const e=i.slice();return e[3]=1,e}function gp(i){const e=Rt.lchuv(ta.xyz(i));return e[3]=i[3],e}function zC(i){const e=Rt.rgb(by.xyz(i));return e[3]=i[3],e}function cf(i){if(Ro.hasOwnProperty(i))return Ro[i];if(Ac>=DC){let t=0;for(const n in Ro)t++&3||(delete Ro[n],--Ac)}const e=NC(i);if(e.length!==4)throw new Error('Failed to parse "'+i+'" as color');for(const t of e)if(isNaN(t))throw new Error('Failed to parse "'+i+'" as color');return My(e),Ro[i]=e,++Ac,e}function sh(i){return Array.isArray(i)?i:cf(i)}function My(i){return i[0]=et(i[0]+.5|0,0,255),i[1]=et(i[1]+.5|0,0,255),i[2]=et(i[2]+.5|0,0,255),i[3]=et(i[3],0,1),i}function Cy(i){let e=i[0];e!=(e|0)&&(e=e+.5|0);let t=i[1];t!=(t|0)&&(t=t+.5|0);let n=i[2];n!=(n|0)&&(n=n+.5|0);const s=i[3]===void 0?1:Math.round(i[3]*100)/100;return"rgba("+e+","+t+","+n+","+s+")"}function BC(i){try{return cf(i),!0}catch{return!1}}function Lt(i,e,t,n){let s;return t&&t.length?s=t.shift():$d?s=new OffscreenCanvas(i||300,e||300):s=document.createElement("canvas"),i&&(s.width=i),e&&(s.height=e),s.getContext("2d",n)}function $a(i){const e=i.canvas;e.width=1,e.height=1,i.clearRect(0,0,1,1)}function dO(i){let e=i.offsetWidth;const t=getComputedStyle(i);return e+=parseInt(t.marginLeft,10)+parseInt(t.marginRight,10),e}function fO(i){let e=i.offsetHeight;const t=getComputedStyle(i);return e+=parseInt(t.marginTop,10)+parseInt(t.marginBottom,10),e}function pp(i,e){const t=e.parentNode;t&&t.replaceChild(i,e)}function Uu(i){return i&&i.parentNode?i.parentNode.removeChild(i):null}function $C(i){for(;i.lastChild;)i.removeChild(i.lastChild)}function UC(i,e){const t=i.childNodes;for(let n=0;;++n){const s=t[n],r=e[n];if(!s&&!r)break;if(s!==r){if(!s){i.appendChild(r);continue}if(!r){i.removeChild(s),--n;continue}i.insertBefore(r,s)}}}class Sy extends Da{constructor(e,t,n,s){super(),this.extent=e,this.pixelRatio_=n,this.resolution=t,this.state=typeof s=="function"?oe.IDLE:s,this.image_=null,this.loader=typeof s=="function"?s:null}changed(){this.dispatchEvent(ee.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==oe.IDLE&&this.loader){this.state=oe.LOADING,this.changed();const e=this.getResolution(),t=Array.isArray(e)?e[0]:e;Qo(()=>this.loader(this.getExtent(),t,this.getPixelRatio())).then(n=>{"image"in n&&(this.image_=n.image),"extent"in n&&(this.extent=n.extent),"resolution"in n&&(this.resolution=n.resolution),"pixelRatio"in n&&(this.pixelRatio_=n.pixelRatio),(n instanceof HTMLImageElement||n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement)&&(this.image_=n),this.state=oe.LOADED}).catch(n=>{this.state=oe.ERROR,console.error(n)}).finally(()=>this.changed())}}setImage(e){this.image_=e}setResolution(e){this.resolution=e}}function qC(i,e,t){const n=i;let s=!0,r=!1,o=!1;const a=[Hl(n,ee.LOAD,function(){o=!0,r||e()})];return n.src&&Ud?(r=!0,n.decode().then(function(){s&&e()}).catch(function(l){s&&(o?e():t())})):a.push(Hl(n,ee.ERROR,t)),function(){s=!1,a.forEach(qe)}}function jC(i,e){return new Promise((t,n)=>{function s(){o(),t(i)}function r(){o(),n(new Error("Image load error"))}function o(){i.removeEventListener("load",s),i.removeEventListener("error",r)}i.addEventListener("load",s),i.addEventListener("error",r),e&&(i.src=e)})}function Ty(i,e){return e&&(i.src=e),i.src&&Ud?new Promise((t,n)=>i.decode().then(()=>t(i)).catch(s=>i.complete&&i.width?t(i):n(s))):jC(i)}function Ry(i,e){return e&&(i.src=e),i.src&&Ud&&kM?i.decode().then(()=>createImageBitmap(i)).catch(t=>{if(i.complete&&i.width)return i;throw t}):Ty(i)}class WC{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const n=this.cache_[t];!(e++&3)&&!n.hasListener()&&(delete this.cache_[t],--this.cacheSize_)}}}get(e,t,n){const s=mp(e,t,n);return s in this.cache_?this.cache_[s]:null}set(e,t,n,s){const r=mp(e,t,n);this.cache_[r]=s,++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function mp(i,e,t){const n=t?Ey(t):"null";return e+":"+i+":"+n}const rh=new WC;let Io=null;class VC extends Da{constructor(e,t,n,s,r){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=n,this.canvas_={},this.color_=r,this.imageState_=s===void 0?oe.IDLE:s,this.size_=e&&e.width&&e.height?[e.width,e.height]:null,this.src_=t,this.tainted_}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===oe.LOADED){Io||(Io=Lt(1,1,void 0,{willReadFrequently:!0})),Io.drawImage(this.image_,0,0);try{Io.getImageData(0,0,1,1),this.tainted_=!1}catch{Io=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(ee.CHANGE)}handleImageError_(){this.imageState_=oe.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=oe.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],t=this.size_[1],n=Lt(e,t);n.fillRect(0,0,e,t),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===oe.IDLE){this.image_||this.initializeImage_(),this.imageState_=oe.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&Ty(this.image_,this.src_).then(e=>{this.image_=e,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||this.imageState_!==oe.LOADED)return;const t=this.image_,n=document.createElement("canvas");n.width=Math.ceil(t.width*e),n.height=Math.ceil(t.height*e);const s=n.getContext("2d");s.scale(e,e),s.drawImage(t,0,0),s.globalCompositeOperation="multiply",s.fillStyle=Ey(this.color_),s.fillRect(0,0,n.width/e,n.height/e),s.globalCompositeOperation="destination-in",s.drawImage(t,0,0),this.canvas_[e]=n}}function XC(i,e,t,n,s){let r=e===void 0?void 0:rh.get(e,t,s);return r||(r=new VC(i,i instanceof HTMLImageElement?i.src||void 0:e,t,n,s),rh.set(e,t,s,r)),r}function yp(i,e,t,n){return t!==void 0&&n!==void 0?[t/i,n/e]:t!==void 0?t/i:n!==void 0?n/e:1}class uf extends wy{constructor(e){e=e||{};const t=e.opacity!==void 0?e.opacity:1,n=e.rotation!==void 0?e.rotation:0,s=e.scale!==void 0?e.scale:1,r=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:t,rotation:n,scale:s,displacement:e.displacement!==void 0?e.displacement:[0,0],rotateWithView:r,declutterMode:e.declutterMode}),this.anchor_=e.anchor!==void 0?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=e.anchorOrigin!==void 0?e.anchorOrigin:"top-left",this.anchorXUnits_=e.anchorXUnits!==void 0?e.anchorXUnits:"fraction",this.anchorYUnits_=e.anchorYUnits!==void 0?e.anchorYUnits:"fraction",this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null;const o=e.img!==void 0?e.img:null;let a=e.src;_e(!(a!==void 0&&o),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&o&&(a=o.src||H(o)),_e(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),_e(!((e.width!==void 0||e.height!==void 0)&&e.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(e.src!==void 0?l=oe.IDLE:o!==void 0&&(o instanceof HTMLImageElement?o.complete?l=o.src?oe.LOADED:oe.IDLE:l=oe.LOADING:l=oe.LOADED),this.color_=e.color!==void 0?sh(e.color):null,this.iconImage_=XC(o,a,this.crossOrigin_,l,this.color_),this.offset_=e.offset!==void 0?e.offset:[0,0],this.offsetOrigin_=e.offsetOrigin!==void 0?e.offsetOrigin:"top-left",this.origin_=null,this.size_=e.size!==void 0?e.size:null,e.width!==void 0||e.height!==void 0){let h,c;if(e.size)[h,c]=e.size;else{const u=this.getImage(1);if(u.width&&u.height)h=u.width,c=u.height;else if(u instanceof HTMLImageElement){this.initialOptions_=e;const d=()=>{if(this.unlistenImageChange(d),!this.initialOptions_)return;const f=this.iconImage_.getSize();this.setScale(yp(f[0],f[1],e.width,e.height))};this.listenImageChange(d);return}}h!==void 0&&this.setScale(yp(h,c,e.width,e.height))}}clone(){let e,t,n;return this.initialOptions_?(t=this.initialOptions_.width,n=this.initialOptions_.height):(e=this.getScale(),e=Array.isArray(e)?e.slice():e),new uf({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:e,width:t,height:n,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const s=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!s)return null;e=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(e[0]*=s[0]),this.anchorYUnits_=="fraction"&&(e[1]*=s[1])}if(this.anchorOrigin_!="top-left"){if(!s)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(e[0]=-e[0]+s[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(e[1]=-e[1]+s[1])}this.normalizedAnchor_=e}const t=this.getDisplacement(),n=this.getScaleArray();return[e[0]-t[0]/n[0],e[1]+t[1]/n[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!="top-left"){const t=this.getSize(),n=this.iconImage_.getSize();if(!t||!n)return null;e=e.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(e[0]=n[0]-t[0]-e[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(e[1]=n[1]-t[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const e=this.getScaleArray();if(this.size_)return this.size_[0]*e[0];if(this.iconImage_.getImageState()==oe.LOADED)return this.iconImage_.getSize()[0]*e[0]}getHeight(){const e=this.getScaleArray();if(this.size_)return this.size_[1]*e[1];if(this.iconImage_.getImageState()==oe.LOADED)return this.iconImage_.getSize()[1]*e[1]}setScale(e){delete this.initialOptions_,super.setScale(e)}listenImageChange(e){this.iconImage_.addEventListener(ee.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(ee.CHANGE,e)}}const oh=uf;class df{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=e.lineDash!==void 0?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}clone(){const e=this.getColor();return new df({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setWidth(e){this.width_=e}}const Tt=df;function hn(i){return Array.isArray(i)?Cy(i):i}const al="ol-hidden",gO="ol-selectable",lc="ol-unselectable",ff="ol-control",_p="ol-collapsed",YC=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),vp=["style","variant","weight","size","lineHeight","family"],Iy=function(i){const e=i.match(YC);if(!e)return null;const t={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let n=0,s=vp.length;n<s;++n){const r=e[n+1];r!==void 0&&(t[vp[n]]=r)}return t.families=t.family.split(/,\s?/),t},Ly="10px sans-serif",ti="#000",co="round",Pn=[],An=0,uo="round",ia=10,na="#000",sa="center",ah="middle",As=[0,0,0,0],ra=1,tn=new _n;let dr=null,qu;const ju={},Py=function(){const e="32px ",t=["monospace","serif"],n=t.length,s="wmytzilWMYTZIL@#/&?$%10";let r,o;function a(h,c,u){let d=!0;for(let f=0;f<n;++f){const g=t[f];if(o=lh(h+" "+c+" "+e+g,s),u!=g){const p=lh(h+" "+c+" "+e+u+","+g,s);d=d&&p!=o}}return!!d}function l(){let h=!0;const c=tn.getKeys();for(let u=0,d=c.length;u<d;++u){const f=c[u];tn.get(f)<100&&(a.apply(this,f.split(`
`))?(Pa(ju),dr=null,qu=void 0,tn.set(f,100)):(tn.set(f,tn.get(f)+1,!0),h=!1))}h&&(clearInterval(r),r=void 0)}return function(h){const c=Iy(h);if(!c)return;const u=c.families;for(let d=0,f=u.length;d<f;++d){const g=u[d],p=c.style+`
`+c.weight+`
`+g;tn.get(p)===void 0&&(tn.set(p,100,!0),a(c.style,c.weight,g)||(tn.set(p,0,!0),r===void 0&&(r=setInterval(l,32))))}}}(),HC=function(){let i;return function(e){let t=ju[e];if(t==null){if($d){const n=Iy(e),s=Ay(e,"g");t=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(s.actualBoundingBoxAscent+s.actualBoundingBoxDescent)}else i||(i=document.createElement("div"),i.innerHTML="M",i.style.minHeight="0",i.style.maxHeight="none",i.style.height="auto",i.style.padding="0",i.style.border="none",i.style.position="absolute",i.style.display="block",i.style.left="-99999px"),i.style.font=e,document.body.appendChild(i),t=i.offsetHeight,document.body.removeChild(i);ju[e]=t}return t}}();function Ay(i,e){return dr||(dr=Lt(1,1)),i!=qu&&(dr.font=i,qu=dr.font),dr.measureText(e)}function lh(i,e){return Ay(i,e).width}function xp(i,e,t){if(e in t)return t[e];const n=e.split(`
`).reduce((s,r)=>Math.max(s,lh(i,r)),0);return t[e]=n,n}function ZC(i,e){const t=[],n=[],s=[];let r=0,o=0,a=0,l=0;for(let h=0,c=e.length;h<=c;h+=2){const u=e[h];if(u===`
`||h===c){r=Math.max(r,o),s.push(o),o=0,a+=l;continue}const d=e[h+1]||i.font,f=lh(d,u);t.push(f),o+=f;const g=HC(d);n.push(g),l=Math.max(l,g)}return{width:r,height:a,widths:t,heights:n,lineWidths:s}}function KC(i,e,t,n,s,r,o,a,l,h,c){i.save(),t!==1&&(i.globalAlpha*=t),e&&i.transform.apply(i,e),n.contextInstructions?(i.translate(l,h),i.scale(c[0],c[1]),JC(n,i)):c[0]<0||c[1]<0?(i.translate(l,h),i.scale(c[0],c[1]),i.drawImage(n,s,r,o,a,0,0,o,a)):i.drawImage(n,s,r,o,a,l,h,o*c[0],a*c[1]),i.restore()}function JC(i,e){const t=i.contextInstructions;for(let n=0,s=t.length;n<s;n+=2)Array.isArray(t[n+1])?e[t[n]].apply(e,t[n+1]):e[t[n]]=t[n+1]}class gf extends wy{constructor(e){const t=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:1,rotateWithView:t,rotation:e.rotation!==void 0?e.rotation:0,scale:e.scale!==void 0?e.scale:1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode}),this.canvases_,this.hitDetectionCanvas_=null,this.fill_=e.fill!==void 0?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius_=e.radius!==void 0?e.radius:e.radius1,this.radius2_=e.radius2,this.angle_=e.angle!==void 0?e.angle:0,this.stroke_=e.stroke!==void 0?e.stroke:null,this.size_,this.renderOptions_,this.render()}clone(){const e=this.getScale(),t=new gf({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}getAnchor(){const e=this.size_,t=this.getDisplacement(),n=this.getScaleArray();return[e[0]/2-t[0]/n[0],e[1]/2+t[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(e){let t=this.canvases_[e];if(!t){const n=this.renderOptions_,s=Lt(n.size*e,n.size*e);this.draw_(n,s,e),t=s.canvas,this.canvases_[e]=t}return t}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return oe.LOADED}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(e){}load(){}unlistenImageChange(e){}calculateLineJoinSize_(e,t,n){if(t===0||this.points_===1/0||e!=="bevel"&&e!=="miter")return t;let s=this.radius_,r=this.radius2_===void 0?s:this.radius2_;if(s<r){const E=s;s=r,r=E}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=r*Math.sin(a),h=Math.sqrt(r*r-l*l),c=s-h,u=Math.sqrt(l*l+c*c),d=u/l;if(e==="miter"&&d<=n)return d*t;const f=t/2/d,g=t/2*(c/u),m=Math.sqrt((s+f)*(s+f)+g*g)-s;if(this.radius2_===void 0||e==="bevel")return m*2;const _=s*Math.sin(a),y=Math.sqrt(s*s-_*_),x=r-y,b=Math.sqrt(_*_+x*x)/_;if(b<=n){const E=b*t/2-r-s;return 2*Math.max(m,E)}return m*2}createRenderOptions(){let e=co,t=uo,n=0,s=null,r=0,o,a=0;this.stroke_&&(o=hn(this.stroke_.getColor()??na),a=this.stroke_.getWidth()??ra,s=this.stroke_.getLineDash(),r=this.stroke_.getLineDashOffset()??0,t=this.stroke_.getLineJoin()??uo,e=this.stroke_.getLineCap()??co,n=this.stroke_.getMiterLimit()??ia);const l=this.calculateLineJoinSize_(t,a,n),h=Math.max(this.radius_,this.radius2_||0),c=Math.ceil(2*h+l);return{strokeStyle:o,strokeWidth:a,size:c,lineCap:e,lineDash:s,lineDashOffset:r,lineJoin:t,miterLimit:n}}render(){this.renderOptions_=this.createRenderOptions();const e=this.renderOptions_.size;this.canvases_={},this.hitDetectionCanvas_=null,this.size_=[e,e]}draw_(e,t,n){if(t.scale(n,n),t.translate(e.size/2,e.size/2),this.createPath_(t),this.fill_){let s=this.fill_.getColor();s===null&&(s=ti),t.fillStyle=hn(s),t.fill()}e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}createHitDetectionCanvas_(e){let t;if(this.fill_){let n=this.fill_.getColor(),s=0;typeof n=="string"&&(n=sh(n)),n===null?s=1:Array.isArray(n)&&(s=n.length===4?n[3]:1),s===0&&(t=Lt(e.size,e.size),this.drawHitDetectionCanvas_(e,t))}return t?t.canvas:this.getImage(1)}createPath_(e){let t=this.points_;const n=this.radius_;if(t===1/0)e.arc(0,0,n,0,2*Math.PI);else{const s=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(t*=2);const r=this.angle_-Math.PI/2,o=2*Math.PI/t;for(let a=0;a<t;a++){const l=r+a*o,h=a%2===0?n:s;e.lineTo(h*Math.cos(l),h*Math.sin(l))}e.closePath()}}drawHitDetectionCanvas_(e,t){t.translate(e.size/2,e.size/2),this.createPath_(t),t.fillStyle=ti,t.fill(),e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}}const Fy=gf;class pf extends Fy{constructor(e){e=e||{radius:5},super({points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:e.scale!==void 0?e.scale:1,rotation:e.rotation!==void 0?e.rotation:0,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){const e=this.getScale(),t=new pf({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}setRadius(e){this.radius_=e,this.render()}}const Kn=pf;class Jn{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=wp,e.geometry!==void 0&&this.setGeometry(e.geometry),this.fill_=e.fill!==void 0?e.fill:null,this.image_=e.image!==void 0?e.image:null,this.renderer_=e.renderer!==void 0?e.renderer:null,this.hitDetectionRenderer_=e.hitDetectionRenderer!==void 0?e.hitDetectionRenderer:null,this.stroke_=e.stroke!==void 0?e.stroke:null,this.text_=e.text!==void 0?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&typeof e=="object"&&(e=e.clone()),new Jn({geometry:e??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){typeof e=="function"?this.geometryFunction_=e:typeof e=="string"?this.geometryFunction_=function(t){return t.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=wp,this.geometry_=e}setZIndex(e){this.zIndex_=e}}function QC(i){let e;if(typeof i=="function")e=i;else{let t;Array.isArray(i)?t=i:(_e(typeof i.getZIndex=="function","Expected an `Style` or an array of `Style`"),t=[i]),e=function(){return t}}return e}let Fc=null;function eS(i,e){if(!Fc){const t=new jt({color:"rgba(255,255,255,0.4)"}),n=new Tt({color:"#3399CC",width:1.25});Fc=[new Jn({image:new Kn({fill:t,stroke:n,radius:5}),fill:t,stroke:n})]}return Fc}function ky(){const i={},e=[255,255,255,1],t=[0,153,255,1],n=3;return i.Polygon=[new Jn({fill:new jt({color:[255,255,255,.5]})})],i.MultiPolygon=i.Polygon,i.LineString=[new Jn({stroke:new Tt({color:e,width:n+2})}),new Jn({stroke:new Tt({color:t,width:n})})],i.MultiLineString=i.LineString,i.Circle=i.Polygon.concat(i.LineString),i.Point=[new Jn({image:new Kn({radius:n*2,fill:new jt({color:t}),stroke:new Tt({color:e,width:n/2})}),zIndex:1/0})],i.MultiPoint=i.Point,i.GeometryCollection=i.Polygon.concat(i.LineString,i.Point),i}function wp(i){return i.getGeometry()}const ii=Jn,tS="#333";class mf{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.scale_=e.scale,this.scaleArray_=Vt(e.scale!==void 0?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.repeat_=e.repeat,this.textBaseline_=e.textBaseline,this.fill_=e.fill!==void 0?e.fill:new jt({color:tS}),this.maxAngle_=e.maxAngle!==void 0?e.maxAngle:Math.PI/4,this.placement_=e.placement!==void 0?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=e.stroke!==void 0?e.stroke:null,this.offsetX_=e.offsetX!==void 0?e.offsetX:0,this.offsetY_=e.offsetY!==void 0?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=e.padding===void 0?null:e.padding}clone(){const e=this.getScale();return new mf({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRepeat(e){this.repeat_=e}setRotateWithView(e){this.rotateWithView_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=Vt(e!==void 0?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}}const yf=mf;var _f={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */_f.read=function(i,e,t,n,s){var r,o,a=s*8-n-1,l=(1<<a)-1,h=l>>1,c=-7,u=t?s-1:0,d=t?-1:1,f=i[e+u];for(u+=d,r=f&(1<<-c)-1,f>>=-c,c+=a;c>0;r=r*256+i[e+u],u+=d,c-=8);for(o=r&(1<<-c)-1,r>>=-c,c+=n;c>0;o=o*256+i[e+u],u+=d,c-=8);if(r===0)r=1-h;else{if(r===l)return o?NaN:(f?-1:1)*(1/0);o=o+Math.pow(2,n),r=r-h}return(f?-1:1)*o*Math.pow(2,r-n)};_f.write=function(i,e,t,n,s,r){var o,a,l,h=r*8-s-1,c=(1<<h)-1,u=c>>1,d=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:r-1,g=n?1:-1,p=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+u>=1?e+=d/l:e+=d*Math.pow(2,1-u),e*l>=2&&(o++,l/=2),o+u>=c?(a=0,o=c):o+u>=1?(a=(e*l-1)*Math.pow(2,s),o=o+u):(a=e*Math.pow(2,u-1)*Math.pow(2,s),o=0));s>=8;i[t+f]=a&255,f+=g,a/=256,s-=8);for(o=o<<s|a,h+=s;h>0;i[t+f]=o&255,f+=g,o/=256,h-=8);i[t+f-g]|=p*128};var iS=Ne,ll=_f;function Ne(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Ne.Varint=0;Ne.Fixed64=1;Ne.Bytes=2;Ne.Fixed32=5;var Wu=65536*65536,bp=1/Wu,nS=12,Oy=typeof TextDecoder>"u"?null:new TextDecoder("utf8");Ne.prototype={destroy:function(){this.buf=null},readFields:function(i,e,t){for(t=t||this.length;this.pos<t;){var n=this.readVarint(),s=n>>3,r=this.pos;this.type=n&7,i(s,e,this),this.pos===r&&this.skip(n)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=hl(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Mp(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=hl(this.buf,this.pos)+hl(this.buf,this.pos+4)*Wu;return this.pos+=8,i},readSFixed64:function(){var i=hl(this.buf,this.pos)+Mp(this.buf,this.pos+4)*Wu;return this.pos+=8,i},readFloat:function(){var i=ll.read(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=ll.read(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e=this.buf,t,n;return n=e[this.pos++],t=n&127,n<128||(n=e[this.pos++],t|=(n&127)<<7,n<128)||(n=e[this.pos++],t|=(n&127)<<14,n<128)||(n=e[this.pos++],t|=(n&127)<<21,n<128)?t:(n=e[this.pos],t|=(n&15)<<28,sS(t,i,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2===1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=nS&&Oy?_S(this.buf,e,i):yS(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Ne.Bytes)return i.push(this.readVarint(e));var t=bn(this);for(i=i||[];this.pos<t;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Ne.Bytes)return i.push(this.readSVarint());var e=bn(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Ne.Bytes)return i.push(this.readBoolean());var e=bn(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Ne.Bytes)return i.push(this.readFloat());var e=bn(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Ne.Bytes)return i.push(this.readDouble());var e=bn(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Ne.Bytes)return i.push(this.readFixed32());var e=bn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Ne.Bytes)return i.push(this.readSFixed32());var e=bn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Ne.Bytes)return i.push(this.readFixed64());var e=bn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Ne.Bytes)return i.push(this.readSFixed64());var e=bn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=i&7;if(e===Ne.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ne.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ne.Fixed32)this.pos+=4;else if(e===Ne.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),sr(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),sr(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),sr(this.buf,i&-1,this.pos),sr(this.buf,Math.floor(i*bp),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),sr(this.buf,i&-1,this.pos),sr(this.buf,Math.floor(i*bp),this.pos+4),this.pos+=8},writeVarint:function(i){if(i=+i||0,i>268435455||i<0){rS(i,this);return}this.realloc(4),this.buf[this.pos++]=i&127|(i>127?128:0),!(i<=127)&&(this.buf[this.pos++]=(i>>>=7)&127|(i>127?128:0),!(i<=127)&&(this.buf[this.pos++]=(i>>>=7)&127|(i>127?128:0),!(i<=127)&&(this.buf[this.pos++]=i>>>7&127)))},writeSVarint:function(i){this.writeVarint(i<0?-i*2-1:i*2)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(i.length*4),this.pos++;var e=this.pos;this.pos=vS(this.buf,i,this.pos);var t=this.pos-e;t>=128&&Ep(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(i){this.realloc(4),ll.write(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),ll.write(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var t=0;t<e;t++)this.buf[this.pos++]=i[t]},writeRawMessage:function(i,e){this.pos++;var t=this.pos;i(e,this);var n=this.pos-t;n>=128&&Ep(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeMessage:function(i,e,t){this.writeTag(i,Ne.Bytes),this.writeRawMessage(e,t)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,lS,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,hS,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,dS,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,cS,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,uS,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,fS,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,gS,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,pS,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,mS,e)},writeBytesField:function(i,e){this.writeTag(i,Ne.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Ne.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Ne.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Ne.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Ne.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Ne.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Ne.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Ne.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Ne.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Ne.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};function sS(i,e,t){var n=t.buf,s,r;if(r=n[t.pos++],s=(r&112)>>4,r<128||(r=n[t.pos++],s|=(r&127)<<3,r<128)||(r=n[t.pos++],s|=(r&127)<<10,r<128)||(r=n[t.pos++],s|=(r&127)<<17,r<128)||(r=n[t.pos++],s|=(r&127)<<24,r<128)||(r=n[t.pos++],s|=(r&1)<<31,r<128))return nr(i,s,e);throw new Error("Expected varint not more than 10 bytes")}function bn(i){return i.type===Ne.Bytes?i.readVarint()+i.pos:i.pos+1}function nr(i,e,t){return t?e*4294967296+(i>>>0):(e>>>0)*4294967296+(i>>>0)}function rS(i,e){var t,n;if(i>=0?(t=i%4294967296|0,n=i/4294967296|0):(t=~(-i%4294967296),n=~(-i/4294967296),t^4294967295?t=t+1|0:(t=0,n=n+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),oS(t,n,e),aS(n,e)}function oS(i,e,t){t.buf[t.pos++]=i&127|128,i>>>=7,t.buf[t.pos++]=i&127|128,i>>>=7,t.buf[t.pos++]=i&127|128,i>>>=7,t.buf[t.pos++]=i&127|128,i>>>=7,t.buf[t.pos]=i&127}function aS(i,e){var t=(i&7)<<4;e.buf[e.pos++]|=t|((i>>>=3)?128:0),i&&(e.buf[e.pos++]=i&127|((i>>>=7)?128:0),i&&(e.buf[e.pos++]=i&127|((i>>>=7)?128:0),i&&(e.buf[e.pos++]=i&127|((i>>>=7)?128:0),i&&(e.buf[e.pos++]=i&127|((i>>>=7)?128:0),i&&(e.buf[e.pos++]=i&127)))))}function Ep(i,e,t){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));t.realloc(n);for(var s=t.pos-1;s>=i;s--)t.buf[s+n]=t.buf[s]}function lS(i,e){for(var t=0;t<i.length;t++)e.writeVarint(i[t])}function hS(i,e){for(var t=0;t<i.length;t++)e.writeSVarint(i[t])}function cS(i,e){for(var t=0;t<i.length;t++)e.writeFloat(i[t])}function uS(i,e){for(var t=0;t<i.length;t++)e.writeDouble(i[t])}function dS(i,e){for(var t=0;t<i.length;t++)e.writeBoolean(i[t])}function fS(i,e){for(var t=0;t<i.length;t++)e.writeFixed32(i[t])}function gS(i,e){for(var t=0;t<i.length;t++)e.writeSFixed32(i[t])}function pS(i,e){for(var t=0;t<i.length;t++)e.writeFixed64(i[t])}function mS(i,e){for(var t=0;t<i.length;t++)e.writeSFixed64(i[t])}function hl(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+i[e+3]*16777216}function sr(i,e,t){i[t]=e,i[t+1]=e>>>8,i[t+2]=e>>>16,i[t+3]=e>>>24}function Mp(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function yS(i,e,t){for(var n="",s=e;s<t;){var r=i[s],o=null,a=r>239?4:r>223?3:r>191?2:1;if(s+a>t)break;var l,h,c;a===1?r<128&&(o=r):a===2?(l=i[s+1],(l&192)===128&&(o=(r&31)<<6|l&63,o<=127&&(o=null))):a===3?(l=i[s+1],h=i[s+2],(l&192)===128&&(h&192)===128&&(o=(r&15)<<12|(l&63)<<6|h&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(l=i[s+1],h=i[s+2],c=i[s+3],(l&192)===128&&(h&192)===128&&(c&192)===128&&(o=(r&15)<<18|(l&63)<<12|(h&63)<<6|c&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,n+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),n+=String.fromCharCode(o),s+=a}return n}function _S(i,e,t){return Oy.decode(i.subarray(e,t))}function vS(i,e,t){for(var n=0,s,r;n<e.length;n++){if(s=e.charCodeAt(n),s>55295&&s<57344)if(r)if(s<56320){i[t++]=239,i[t++]=191,i[t++]=189,r=s;continue}else s=r-55296<<10|s-56320|65536,r=null;else{s>56319||n+1===e.length?(i[t++]=239,i[t++]=191,i[t++]=189):r=s;continue}else r&&(i[t++]=239,i[t++]=191,i[t++]=189,r=null);s<128?i[t++]=s:(s<2048?i[t++]=s>>6|192:(s<65536?i[t++]=s>>12|224:(i[t++]=s>>18|240,i[t++]=s>>12&63|128),i[t++]=s>>6&63|128),i[t++]=s&63|128)}return t}const xS=Xm(iS);class wS extends nf{constructor(e){super(),e=e||{},this.dataProjection=new Zh({code:"",units:"tile-pixels"}),this.featureClass_=e.featureClass?e.featureClass:Li,this.geometryName_=e.geometryName,this.layerName_=e.layerName?e.layerName:"layer",this.layers_=e.layers?e.layers:null,this.idProperty_=e.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(e,t,n,s){e.pos=t.geometry;const r=e.readVarint()+e.pos;let o=1,a=0,l=0,h=0,c=0,u=0;for(;e.pos<r;){if(!a){const d=e.readVarint();o=d&7,a=d>>3}if(a--,o===1||o===2)l+=e.readSVarint(),h+=e.readSVarint(),o===1&&c>u&&(s.push(c),u=c),n.push(l,h),c+=2;else if(o===7)c>u&&(n.push(n[u],n[u+1]),c+=2);else throw new Error("Invalid command found in the PBF")}c>u&&(s.push(c),u=c)}createFeature_(e,t,n){const s=t.type;if(s===0)return null;let r;const o=t.properties;let a;this.idProperty_?(a=o[this.idProperty_],delete o[this.idProperty_]):a=t.id,o[this.layerName_]=t.layer.name;const l=[],h=[];this.readRawGeometry_(e,t,l,h);const c=SS(s,h.length);if(this.featureClass_===Li)r=new this.featureClass_(c,l,h,2,o,a),r.transform(n.dataProjection);else{let u;if(c=="Polygon"){const g=uy(l,h);u=g.length>1?new Js(l,"XY",g):new Zi(l,"XY",h)}else u=c==="Point"?new Ai(l,"XY"):c==="LineString"?new Yi(l,"XY"):c==="MultiPoint"?new mo(l,"XY"):c==="MultiLineString"?new Ks(l,"XY",h):null;const d=this.featureClass_;r=new d,this.geometryName_&&r.setGeometryName(this.geometryName_);const f=Qs(u,!1,n);r.setGeometry(f),a!==void 0&&r.setId(a),r.setProperties(o,!0)}return r}getType(){return"arraybuffer"}readFeatures(e,t){const n=this.layers_;t=this.adaptOptions(t);const s=K(t.dataProjection);s.setWorldExtent(t.extent),t.dataProjection=s;const r=new xS(e),o=r.readFields(bS,{}),a=[];for(const l in o){if(n&&!n.includes(l))continue;const h=o[l],c=h?[0,0,h.extent,h.extent]:null;s.setExtent(c);for(let u=0,d=h.length;u<d;++u){const f=CS(r,h,u),g=this.createFeature_(r,f,t);g!==null&&a.push(g)}}return a}readProjection(e){return this.dataProjection}setLayers(e){this.layers_=e}}function bS(i,e,t){if(i===3){const n={keys:[],values:[],features:[]},s=t.readVarint()+t.pos;t.readFields(ES,n,s),n.length=n.features.length,n.length&&(e[n.name]=n)}}function ES(i,e,t){if(i===15)e.version=t.readVarint();else if(i===1)e.name=t.readString();else if(i===5)e.extent=t.readVarint();else if(i===2)e.features.push(t.pos);else if(i===3)e.keys.push(t.readString());else if(i===4){let n=null;const s=t.readVarint()+t.pos;for(;t.pos<s;)i=t.readVarint()>>3,n=i===1?t.readString():i===2?t.readFloat():i===3?t.readDouble():i===4?t.readVarint64():i===5?t.readVarint():i===6?t.readSVarint():i===7?t.readBoolean():null;e.values.push(n)}}function MS(i,e,t){if(i==1)e.id=t.readVarint();else if(i==2){const n=t.readVarint()+t.pos;for(;t.pos<n;){const s=e.layer.keys[t.readVarint()],r=e.layer.values[t.readVarint()];e.properties[s]=r}}else i==3?e.type=t.readVarint():i==4&&(e.geometry=t.pos)}function CS(i,e,t){i.pos=e.features[t];const n=i.readVarint()+i.pos,s={layer:e,type:0,properties:{}};return i.readFields(MS,s,n),s}function SS(i,e){let t;return i===1?t=e===1?"Point":"MultiPoint":i===2?t=e===1?"LineString":"MultiLineString":i===3&&(t="Polygon"),t}const TS=wS;class RS{read(e){if(!e)return null;if(typeof e=="string"){const t=Ps(e);return this.readFromDocument(t)}return Ls(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null}readFromNode(e){ie()}}const Ny=RS,IS="http://www.w3.org/1999/xlink";function vf(i){return i.getAttributeNS(IS,"href")}const oi=[null,"http://www.opengis.net/ows/1.1"],LS=Be(oi,{ServiceIdentification:W(tT),ServiceProvider:W(nT),OperationsMetadata:W(QS)});class PS extends Ny{constructor(){super()}readFromNode(e){const t=Y({},LS,e,[]);return t||null}}const AS=Be(oi,{DeliveryPoint:W(Ie),City:W(Ie),AdministrativeArea:W(Ie),PostalCode:W(Ie),Country:W(Ie),ElectronicMailAddress:W(Ie)}),FS=Be(oi,{Value:di(sT)}),kS=Be(oi,{AllowedValues:W(VS)}),OS=Be(oi,{Phone:W(eT),Address:W(WS)}),NS=Be(oi,{HTTP:W(KS)}),DS=Be(oi,{Get:di(ZS),Post:void 0}),GS=Be(oi,{DCP:W(HS)}),zS=Be(oi,{Operation:JS}),BS=Be(oi,{Voice:W(Ie),Facsimile:W(Ie)}),$S=Be(oi,{Constraint:di(XS)}),US=Be(oi,{IndividualName:W(Ie),PositionName:W(Ie),ContactInfo:W(YS)}),qS=Be(oi,{Abstract:W(Ie),AccessConstraints:W(Ie),Fees:W(Ie),Title:W(Ie),ServiceTypeVersion:W(Ie),ServiceType:W(Ie)}),jS=Be(oi,{ProviderName:W(Ie),ProviderSite:W(vf),ServiceContact:W(iT)});function WS(i,e){return Y({},AS,i,e)}function VS(i,e){return Y({},FS,i,e)}function XS(i,e){const t=i.getAttribute("name");if(t)return Y({name:t},kS,i,e)}function YS(i,e){return Y({},OS,i,e)}function HS(i,e){return Y({},NS,i,e)}function ZS(i,e){const t=vf(i);if(t)return Y({href:t},$S,i,e)}function KS(i,e){return Y({},DS,i,e)}function JS(i,e){const t=i.getAttribute("name"),n=Y({},GS,i,e);if(!n)return;const s=e[e.length-1];s[t]=n}function QS(i,e){return Y({},zS,i,e)}function eT(i,e){return Y({},BS,i,e)}function tT(i,e){return Y({},qS,i,e)}function iT(i,e){return Y({},US,i,e)}function nT(i,e){return Y({},jS,i,e)}function sT(i,e){return Ie(i)}const rT=PS;class Fe extends fe{constructor(e){e=e||{},super(e),this.schemaLocation=e.schemaLocation?e.schemaLocation:this.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd"}writeGeometryElement(e,t,n){const s=n[n.length-1];n[n.length-1]=Object.assign({multiCurve:!0,multiSurface:!0},s),super.writeGeometryElement(e,t,n)}}Fe.prototype.namespace="http://www.opengis.net/gml/3.2";Fe.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:J(fe.prototype.readFlatPos),posList:J(fe.prototype.readFlatPosList),coordinates:J(Ba.prototype.readFlatCoordinates)}};Fe.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:fe.prototype.interiorParser,exterior:fe.prototype.exteriorParser}};Fe.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:J(ge.prototype.readPoint),MultiPoint:J(ge.prototype.readMultiPoint),LineString:J(ge.prototype.readLineString),MultiLineString:J(ge.prototype.readMultiLineString),LinearRing:J(ge.prototype.readLinearRing),Polygon:J(ge.prototype.readPolygon),MultiPolygon:J(ge.prototype.readMultiPolygon),Surface:J(Fe.prototype.readSurface),MultiSurface:J(fe.prototype.readMultiSurface),Curve:J(Fe.prototype.readCurve),MultiCurve:J(fe.prototype.readMultiCurve),Envelope:J(Fe.prototype.readEnvelope)}};Fe.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml/3.2":{curveMember:se(fe.prototype.curveMemberParser),curveMembers:se(fe.prototype.curveMemberParser)}};Fe.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{surfaceMember:se(fe.prototype.surfaceMemberParser),surfaceMembers:se(fe.prototype.surfaceMemberParser)}};Fe.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:se(ge.prototype.readLineString),Curve:se(fe.prototype.readCurve)}};Fe.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:se(ge.prototype.readPolygon),Surface:se(fe.prototype.readSurface)}};Fe.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{patches:J(fe.prototype.readPatch)}};Fe.prototype.CURVE_PARSERS={"http://www.opengis.net/gml/3.2":{segments:J(fe.prototype.readSegment)}};Fe.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml/3.2":{lowerCorner:se(fe.prototype.readFlatPosList),upperCorner:se(fe.prototype.readFlatPosList)}};Fe.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml/3.2":{PolygonPatch:J(fe.prototype.readPolygonPatch)}};Fe.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml/3.2":{LineStringSegment:yy(fe.prototype.readLineStringSegment)}};Fe.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml/3.2":{pointMember:se(ge.prototype.pointMemberParser),pointMembers:se(ge.prototype.pointMemberParser)}};Fe.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml/3.2":{lineStringMember:se(ge.prototype.lineStringMemberParser),lineStringMembers:se(ge.prototype.lineStringMemberParser)}};Fe.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml/3.2":{polygonMember:se(ge.prototype.polygonMemberParser),polygonMembers:se(ge.prototype.polygonMemberParser)}};Fe.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Point:se(ge.prototype.readFlatCoordinatesFromNode)}};Fe.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:se(ge.prototype.readLineString)}};Fe.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:se(ge.prototype.readPolygon)}};Fe.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:J(ge.prototype.readFlatLinearRing),Ring:J(Fe.prototype.readFlatCurveRing)}};Fe.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml/3.2":{exterior:T(fe.prototype.writeRing),interior:T(fe.prototype.writeRing)}};Fe.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lowerCorner:T(ft),upperCorner:T(ft)}};Fe.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{surfaceMember:T(fe.prototype.writeSurfaceOrPolygonMember),polygonMember:T(fe.prototype.writeSurfaceOrPolygonMember)}};Fe.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{pointMember:T(fe.prototype.writePointMember)}};Fe.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lineStringMember:T(fe.prototype.writeLineStringOrCurveMember),curveMember:T(fe.prototype.writeLineStringOrCurveMember)}};Fe.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml/3.2":{Curve:T(fe.prototype.writeCurveOrLineString),MultiCurve:T(fe.prototype.writeMultiCurveOrLineString),Point:T(Fe.prototype.writePoint),MultiPoint:T(fe.prototype.writeMultiPoint),LineString:T(fe.prototype.writeCurveOrLineString),MultiLineString:T(fe.prototype.writeMultiCurveOrLineString),LinearRing:T(fe.prototype.writeLinearRing),Polygon:T(fe.prototype.writeSurfaceOrPolygon),MultiPolygon:T(fe.prototype.writeMultiSurfaceOrPolygon),Surface:T(fe.prototype.writeSurfaceOrPolygon),MultiSurface:T(fe.prototype.writeMultiSurfaceOrPolygon),Envelope:T(fe.prototype.writeEnvelope)}};const xf=Fe;class oT{constructor(e){this.tagName_=e}getTagName(){return this.tagName_}}const Dy=oT;class aT extends Dy{constructor(e,t){super(e),this.conditions=t,_e(this.conditions.length>=2,"At least 2 conditions are required")}}const lT=aT;class hT extends lT{constructor(e){super("And",Array.prototype.slice.call(arguments))}}const cT=hT;class uT extends Dy{constructor(e,t,n){if(super("BBOX"),this.geometryName=e,this.extent=t,t.length!==4)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");this.srsName=n}}const dT=uT;function fT(i){const e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(cT,e))}function gT(i,e,t){return new dT(i,e,t)}const Cp={"http://www.opengis.net/gml":{boundedBy:W(ge.prototype.readExtentElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:se(ge.prototype.readFeaturesInternal)}},pT={"http://www.opengis.net/wfs":{totalInserted:W(ei),totalUpdated:W(ei),totalDeleted:W(ei)},"http://www.opengis.net/wfs/2.0":{totalInserted:W(ei),totalUpdated:W(ei),totalDeleted:W(ei)}},mT={"http://www.opengis.net/wfs":{TransactionSummary:W(Tp,"transactionSummary"),InsertResults:W(Ip,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:W(Tp,"transactionSummary"),InsertResults:W(Ip,"insertIds")}},yT={"http://www.opengis.net/wfs":{PropertyName:T(ft)},"http://www.opengis.net/wfs/2.0":{PropertyName:T(ft)}},Gy={"http://www.opengis.net/wfs":{Insert:T(Lp),Update:T(Ap),Delete:T(Pp),Property:T(Fp),Native:T(kp)},"http://www.opengis.net/wfs/2.0":{Insert:T(Lp),Update:T(Ap),Delete:T(Pp),Property:T(Fp),Native:T(kp)}},zy="feature",wf="http://www.w3.org/2000/xmlns/",bf={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},Vu={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},Ef={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},Sp={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},Mf={"2.0.0":xf,"1.1.0":fe,"1.0.0":Ba},_T="1.1.0";class vT extends xy{constructor(e){super(),e=e||{},this.version_=e.version?e.version:_T,this.featureType_=e.featureType,this.featureNS_=e.featureNS,this.gmlFormat_=e.gmlFormat?e.gmlFormat:new Mf[this.version_],this.schemaLocation_=e.schemaLocation?e.schemaLocation:Sp[this.version_]}getFeatureType(){return this.featureType_}setFeatureType(e){this.featureType_=e}readFeaturesFromNode(e,t){const n={node:e};Object.assign(n,{featureType:this.featureType_,featureNS:this.featureNS_}),Object.assign(n,this.getReadOptions(e,t||{}));const s=[n];let r;this.version_==="2.0.0"?r=Cp:r=this.gmlFormat_.FEATURE_COLLECTION_PARSERS;let o=Y([],r,e,s,this.gmlFormat_);return o||(o=[]),o}readTransactionResponse(e){if(e){if(typeof e=="string"){const t=Ps(e);return this.readTransactionResponseFromDocument(t)}return Ls(e)?this.readTransactionResponseFromDocument(e):this.readTransactionResponseFromNode(e)}}readFeatureCollectionMetadata(e){if(e){if(typeof e=="string"){const t=Ps(e);return this.readFeatureCollectionMetadataFromDocument(t)}return Ls(e)?this.readFeatureCollectionMetadataFromDocument(e):this.readFeatureCollectionMetadataFromNode(e)}}readFeatureCollectionMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(t)}readFeatureCollectionMetadataFromNode(e){const t={},n=Mr(e.getAttribute("numberOfFeatures"));return t.numberOfFeatures=n,Y(t,Cp,e,[],this.gmlFormat_)}readTransactionResponseFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(t)}readTransactionResponseFromNode(e){return Y({},mT,e,[])}writeGetFeature(e){const t=de(Vu[this.version_],"GetFeature");t.setAttribute("service","WFS"),t.setAttribute("version",this.version_),e.handle&&t.setAttribute("handle",e.handle),e.outputFormat&&t.setAttribute("outputFormat",e.outputFormat),e.maxFeatures!==void 0&&t.setAttribute("maxFeatures",String(e.maxFeatures)),e.resultType&&t.setAttribute("resultType",e.resultType),e.startIndex!==void 0&&t.setAttribute("startIndex",String(e.startIndex)),e.count!==void 0&&t.setAttribute("count",String(e.count)),e.viewParams!==void 0&&t.setAttribute("viewParams",e.viewParams),t.setAttributeNS($u,"xsi:schemaLocation",this.schemaLocation_);const n={node:t};if(Object.assign(n,{version:this.version_,srsName:e.srsName,featureNS:e.featureNS?e.featureNS:this.featureNS_,featurePrefix:e.featurePrefix,propertyNames:e.propertyNames?e.propertyNames:[]}),_e(Array.isArray(e.featureTypes),"`options.featureTypes` must be an Array"),typeof e.featureTypes[0]=="string"){let s=e.filter;e.bbox&&(_e(e.geometryName,"`options.geometryName` must also be provided when `options.bbox` is set"),s=this.combineBboxAndFilter(e.geometryName,e.bbox,e.srsName,s)),Object.assign(n,{geometryName:e.geometryName,filter:s}),jp(t,e.featureTypes,[n])}else e.featureTypes.forEach(s=>{const r=this.combineBboxAndFilter(s.geometryName,s.bbox,e.srsName,e.filter);Object.assign(n,{geometryName:s.geometryName,filter:r}),jp(t,[s.name],[n])});return t}combineBboxAndFilter(e,t,n,s){const r=gT(e,t,n);return s?fT(s,r):r}writeTransaction(e,t,n,s){const r=[],o=s.version?s.version:this.version_,a=de(Vu[o],"Transaction");a.setAttribute("service","WFS"),a.setAttribute("version",o);let l;s&&(l=s.gmlOptions?s.gmlOptions:{},s.handle&&a.setAttribute("handle",s.handle)),a.setAttributeNS($u,"xsi:schemaLocation",Sp[o]);const h=xT(a,l,o,s);return e&&cl("Insert",e,r,h),t&&cl("Update",t,r,h),n&&cl("Delete",n,r,h),s.nativeElements&&cl("Native",s.nativeElements,r,h),a}readProjectionFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(t);return null}readProjectionFromNode(e){if(e.firstElementChild&&e.firstElementChild.firstElementChild){e=e.firstElementChild.firstElementChild;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(!(t.childNodes.length===0||t.childNodes.length===1&&t.firstChild.nodeType===3)){const n=[{}];return this.gmlFormat_.readGeometryElement(t,n),K(n.pop().srsName)}}return null}}function xT(i,e,t,n){const s=n.featurePrefix?n.featurePrefix:zy;let r;return t==="1.0.0"?r=2:t==="1.1.0"?r=3:t==="2.0.0"&&(r=3.2),Object.assign({node:i},{version:t,featureNS:n.featureNS,featureType:n.featureType,featurePrefix:s,gmlVersion:r,hasZ:n.hasZ,srsName:n.srsName},e)}function cl(i,e,t,n){it(n,Gy,yi(i),e,t)}function Tp(i,e){return Y({},pT,i,e)}const wT={"http://www.opengis.net/ogc":{FeatureId:se(function(i,e){return i.getAttribute("fid")})},"http://www.opengis.net/ogc/1.1":{FeatureId:se(function(i,e){return i.getAttribute("fid")})}};function Rp(i,e){Ns(wT,i,e)}const bT={"http://www.opengis.net/wfs":{Feature:Rp},"http://www.opengis.net/wfs/2.0":{Feature:Rp}};function Ip(i,e){return Y([],bT,i,e)}function Lp(i,e,t){const n=t[t.length-1],s=n.featureType,r=n.featureNS,o=n.gmlVersion,a=de(r,s);i.appendChild(a),o===2?Ba.prototype.writeFeatureElement(a,e,t):o===3?fe.prototype.writeFeatureElement(a,e,t):xf.prototype.writeFeatureElement(a,e,t)}function By(i,e,t){const s=t[t.length-1].version,r=bf[s],o=de(r,"Filter"),a=de(r,"FeatureId");o.appendChild(a),a.setAttribute("fid",e),i.appendChild(o)}function Cf(i,e){i=i||zy;const t=i+":";return e.startsWith(t)?e:t+e}function Pp(i,e,t){const n=t[t.length-1];_e(e.getId()!==void 0,"Features must have an id set");const s=n.featureType,r=n.featurePrefix,o=n.featureNS,a=Cf(r,s);i.setAttribute("typeName",a),i.setAttributeNS(wf,"xmlns:"+r,o);const l=e.getId();l!==void 0&&By(i,l,t)}function Ap(i,e,t){const n=t[t.length-1];_e(e.getId()!==void 0,"Features must have an id set");const s=n.version,r=n.featureType,o=n.featurePrefix,a=n.featureNS,l=Cf(o,r),h=e.getGeometryName();i.setAttribute("typeName",l),i.setAttributeNS(wf,"xmlns:"+o,a);const c=e.getId();if(c!==void 0){const u=e.getKeys(),d=[];for(let f=0,g=u.length;f<g;f++){const p=e.get(u[f]);if(p!==void 0){let m=u[f];p&&typeof p.getSimplifiedGeometry=="function"&&(m=h),d.push({name:m,value:p})}}it({version:s,gmlVersion:n.gmlVersion,node:i,hasZ:n.hasZ,srsName:n.srsName},Gy,yi("Property"),d,t),By(i,c,t)}}function Fp(i,e,t){const n=t[t.length-1],s=n.version,r=Vu[s],a=de(r,s==="2.0.0"?"ValueReference":"Name"),l=n.gmlVersion;if(i.appendChild(a),ft(a,e.name),e.value!==void 0&&e.value!==null){const h=de(r,"Value");i.appendChild(h),e.value&&typeof e.value.getSimplifiedGeometry=="function"?l===2?Ba.prototype.writeGeometryElement(h,e.value,t):l===3?fe.prototype.writeGeometryElement(h,e.value,t):xf.prototype.writeGeometryElement(h,e.value,t):ft(h,e.value)}}function kp(i,e,t){e.vendorId&&i.setAttribute("vendorId",e.vendorId),e.safeToIgnore!==void 0&&i.setAttribute("safeToIgnore",String(e.safeToIgnore)),e.value!==void 0&&ft(i,e.value)}const hc={"http://www.opengis.net/wfs":{Query:T(Op)},"http://www.opengis.net/wfs/2.0":{Query:T(Op)},"http://www.opengis.net/ogc":{During:T(Gp),And:T(ul),Or:T(ul),Not:T(zp),BBOX:T(Np),Contains:T(jn),Intersects:T(jn),Within:T(jn),DWithin:T(Dp),PropertyIsEqualTo:T(Ci),PropertyIsNotEqualTo:T(Ci),PropertyIsLessThan:T(Ci),PropertyIsLessThanOrEqualTo:T(Ci),PropertyIsGreaterThan:T(Ci),PropertyIsGreaterThanOrEqualTo:T(Ci),PropertyIsNull:T(Bp),PropertyIsBetween:T($p),PropertyIsLike:T(Up)},"http://www.opengis.net/fes/2.0":{During:T(Gp),And:T(ul),Or:T(ul),Not:T(zp),BBOX:T(Np),Contains:T(jn),Disjoint:T(jn),Intersects:T(jn),ResourceId:T(MT),Within:T(jn),DWithin:T(Dp),PropertyIsEqualTo:T(Ci),PropertyIsNotEqualTo:T(Ci),PropertyIsLessThan:T(Ci),PropertyIsLessThanOrEqualTo:T(Ci),PropertyIsGreaterThan:T(Ci),PropertyIsGreaterThanOrEqualTo:T(Ci),PropertyIsNull:T(Bp),PropertyIsBetween:T($p),PropertyIsLike:T(Up)}};function Op(i,e,t){const n=t[t.length-1],s=n.version,r=n.featurePrefix,o=n.featureNS,a=n.propertyNames,l=n.srsName;let h;r?h=Cf(r,e):h=e;let c;s==="2.0.0"?c="typeNames":c="typeName",i.setAttribute(c,h),l&&i.setAttribute("srsName",l),o&&i.setAttributeNS(wf,"xmlns:"+r,o);const u=Object.assign({},n);u.node=i,it(u,yT,yi("PropertyName"),a,t);const d=n.filter;if(d){const f=de(cc(s),"Filter");i.appendChild(f),ET(f,d,t)}}function ET(i,e,t){const n=t[t.length-1],s={node:i};Object.assign(s,{context:n}),it(s,hc,yi(e.getTagName()),[e],t)}function Np(i,e,t){const n=t[t.length-1],r=n.context.version;n.srsName=e.srsName;const o=Mf[r];yo(r,i,e.geometryName),o.prototype.writeGeometryElement(i,e.extent,t)}function MT(i,e,t){i.setAttribute("rid",e.rid)}function jn(i,e,t){const n=t[t.length-1],r=n.context.version;n.srsName=e.srsName;const o=Mf[r];yo(r,i,e.geometryName),o.prototype.writeGeometryElement(i,e.geometry,t)}function Dp(i,e,t){const r=t[t.length-1].context.version;jn(i,e,t);const o=de(cc(r),"Distance");ft(o,e.distance.toString()),r==="2.0.0"?o.setAttribute("uom",e.unit):o.setAttribute("units",e.unit),i.appendChild(o)}function Gp(i,e,t){const r=t[t.length-1].context.version;hh(Ef[r],"ValueReference",i,e.propertyName);const o=de(Ln,"TimePeriod");i.appendChild(o);const a=de(Ln,"begin");o.appendChild(a),qp(a,e.begin);const l=de(Ln,"end");o.appendChild(l),qp(l,e.end)}function ul(i,e,t){const s=t[t.length-1].context,r={node:i};Object.assign(r,{context:s});const o=e.conditions;for(let a=0,l=o.length;a<l;++a){const h=o[a];it(r,hc,yi(h.getTagName()),[h],t)}}function zp(i,e,t){const s=t[t.length-1].context,r={node:i};Object.assign(r,{context:s});const o=e.condition;it(r,hc,yi(o.getTagName()),[o],t)}function Ci(i,e,t){const r=t[t.length-1].context.version;e.matchCase!==void 0&&i.setAttribute("matchCase",e.matchCase.toString()),yo(r,i,e.propertyName),ch(r,i,""+e.expression)}function Bp(i,e,t){const r=t[t.length-1].context.version;yo(r,i,e.propertyName)}function $p(i,e,t){const r=t[t.length-1].context.version,o=cc(r);yo(r,i,e.propertyName);const a=de(o,"LowerBoundary");i.appendChild(a),ch(r,a,""+e.lowerBoundary);const l=de(o,"UpperBoundary");i.appendChild(l),ch(r,l,""+e.upperBoundary)}function Up(i,e,t){const r=t[t.length-1].context.version;i.setAttribute("wildCard",e.wildCard),i.setAttribute("singleChar",e.singleChar),i.setAttribute("escapeChar",e.escapeChar),e.matchCase!==void 0&&i.setAttribute("matchCase",e.matchCase.toString()),yo(r,i,e.propertyName),ch(r,i,""+e.pattern)}function hh(i,e,t,n){const s=de(i,e);ft(s,n),t.appendChild(s)}function ch(i,e,t){hh(cc(i),"Literal",e,t)}function yo(i,e,t){i==="2.0.0"?hh(Ef[i],"ValueReference",e,t):hh(bf[i],"PropertyName",e,t)}function qp(i,e){const t=de(Ln,"TimeInstant");i.appendChild(t);const n=de(Ln,"timePosition");t.appendChild(n),ft(n,e)}function jp(i,e,t){const n=t[t.length-1],s=Object.assign({},n);s.node=i,it(s,hc,yi("Query"),e,t)}function cc(i){let e;return i==="2.0.0"?e=Ef[i]:e=bf[i],e}const CT=vT,vn=[null,"http://www.opengis.net/wmts/1.0"],_o=[null,"http://www.opengis.net/ows/1.1"],ST=Be(vn,{Contents:W(GT)});class TT extends Ny{constructor(){super(),this.owsParser_=new rT}readFromNode(e){let t=e.getAttribute("version");t&&(t=t.trim());let n=this.owsParser_.readFromNode(e);return n?(n.version=t,n=Y(n,ST,e,[]),n||null):null}}const RT=Be(vn,{Layer:di(zT),TileMatrixSet:di(BT)}),IT=Be(vn,{Style:di($T),Format:di(Ie),TileMatrixSetLink:di(UT),Dimension:di(qT),ResourceURL:di(jT)},Be(_o,{Title:W(Ie),Abstract:W(Ie),WGS84BoundingBox:W($y),Identifier:W(Ie)})),LT=Be(vn,{LegendURL:di(WT)},Be(_o,{Title:W(Ie),Identifier:W(Ie)})),PT=Be(vn,{TileMatrixSet:W(Ie),TileMatrixSetLimits:W(XT)}),AT=Be(vn,{TileMatrixLimits:se(YT)}),FT=Be(vn,{TileMatrix:W(Ie),MinTileRow:W(ei),MaxTileRow:W(ei),MinTileCol:W(ei),MaxTileCol:W(ei)}),kT=Be(vn,{Default:W(Ie),Value:di(Ie)},Be(_o,{Identifier:W(Ie)})),OT=Be(_o,{LowerCorner:se(Xu),UpperCorner:se(Xu)}),NT=Be(vn,{WellKnownScaleSet:W(Ie),TileMatrix:di(VT)},Be(_o,{SupportedCRS:W(Ie),Identifier:W(Ie),BoundingBox:W($y)})),DT=Be(vn,{TopLeftCorner:W(Xu),ScaleDenominator:W(TC),TileWidth:W(ei),TileHeight:W(ei),MatrixWidth:W(ei),MatrixHeight:W(ei)},Be(_o,{Identifier:W(Ie)}));function GT(i,e){return Y({},RT,i,e)}function zT(i,e){return Y({},IT,i,e)}function BT(i,e){return Y({},NT,i,e)}function $T(i,e){const t=Y({},LT,i,e);if(!t)return;const n=i.getAttribute("isDefault")==="true";return t.isDefault=n,t}function UT(i,e){return Y({},PT,i,e)}function qT(i,e){return Y({},kT,i,e)}function jT(i,e){const t=i.getAttribute("format"),n=i.getAttribute("template"),s=i.getAttribute("resourceType"),r={};return t&&(r.format=t),n&&(r.template=n),s&&(r.resourceType=s),r}function $y(i,e){const t=Y([],OT,i,e);if(t.length==2)return wt(t)}function WT(i,e){const t={};return t.format=i.getAttribute("format"),t.href=vf(i),t}function Xu(i,e){const t=Ie(i).split(/\s+/);if(!t||t.length!=2)return;const n=+t[0],s=+t[1];if(!(isNaN(n)||isNaN(s)))return[n,s]}function VT(i,e){return Y({},DT,i,e)}function XT(i,e){return Y([],AT,i,e)}function YT(i,e){return Y({},FT,i,e)}const HT=TT;class ZT{constructor(e,t){v(this,"name");v(this,"url");v(this,"layers");v(this,"initialized");this.name=e,this.url=t,this.layers={},this.initialized=!1}addLayerAttribute(e,t,n){if(!["string","integer","double","long","date"].includes(n)){console.warn(`Unmanaged attribute type: ${n}.`);return}e in this.layers||(this.layers[e]=[]),this.layers[e].push({name:t,type:n})}}var _a,Yu;class Uy extends mn{constructor(t){super(t);re(this,_a);v(this,"messageManager");v(this,"stateManager");v(this,"maxFeatures",1e4);v(this,"serversWfs",{});v(this,"featureTypeToGeometryColumnName",{});this.stateManager=Xi.getInstance(),this.messageManager=Qh.getInstance(),this.stateManager.subscribe("selection.selectionParameters",(n,s)=>this.onSelectFeatures(s))}get state(){return this.stateManager.state}onSelectFeatures(t){this.state.loading=!0,this.state.selection.selectedFeatures=[];const n=[];for(const s of t)for(const r of s.layers)r.queryable&&r.urlWfs&&!(r.urlWfs in this.serversWfs)&&n.push(r.urlWfs);n.length===0?this.wfsQuery(t):le(this,_a,Yu).call(this,n).then(()=>{this.wfsQuery(t)})}async getServerWfs(t){return t in this.serversWfs||await le(this,_a,Yu).call(this,[t]),this.serversWfs[t]}manageLayerAttribute(t,n,s){let r=!1;const o=n.getAttribute("type");if(o&&o.startsWith("gml:")){const a=n.getAttribute("name");if(a)this.featureTypeToGeometryColumnName[s]=a,r=!0;else throw new Error("Why is geometryAttributeName null here ?")}else{const a=n.getAttribute("name"),l=n.getAttribute("type");!a||!l?console.warn(`Error while loading attribute for layer ${s}. Querying or filtering this layer won't work correctly.`):t.addLayerAttribute(s,a,l)}return r}getElementToTypeName(t){const n={},s=t.querySelectorAll(":scope>element");for(const r of s)if(r.hasAttribute("name")&&r.hasAttribute("type")){const o=r.getAttribute("name");let a=r.getAttribute("type");a&&o&&(a.includes(":")&&(a=a.split(":")[1]),n[a]=o)}else console.log("What happend with this element?");return n}getDescribeFeatureTypeUrl(t){const n=new URL(t);return n.searchParams.set("service","WFS"),n.searchParams.set("request","DescribeFeatureType"),n.searchParams.set("version","1.1.0"),n.href}wfsQuery(t){const n=[];for(const s of t){const r=this.getQueryableLayers(s);if(r.length<=0)continue;if(!r[0].urlWfs)throw new Error("The queryable Layers must have a WFS Url!");const o=this.getGeometryColumnNameToFeatureTypes(r);for(const[a,l]of Object.entries(o)){const h=new CT().writeGetFeature({srsName:s.srid,featureNS:"https://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureTypes:l,maxFeatures:this.maxFeatures,outputFormat:"GML3",geometryName:a,bbox:s.selectionBox});n.push(fetch(r[0].urlWfs,{method:"POST",body:new XMLSerializer().serializeToString(h)}))}}Promise.all(n).then(async s=>{const r=[];for(let o=0;o<s.length;++o){const a=await s[o].text(),l=new fe().readFeatures(a);r.push(...l)}r.length===0?this.state.interface.selectionGridVisible=!1:(this.state.selection.selectedFeatures=r,this.state.interface.selectionGridVisible=!0),this.state.loading=!1})}getQueryableLayers(t){const n=t.layers.filter(s=>s.queryable);if(n.length>0){if(!n[0].urlWfs)throw new Error("The queryable Layers must have a WFS Url!");if(!n.every(r=>r.urlWfs===n[0].urlWfs))throw new Error("Not all layers of this list have the same WFS URL. We cannot do que WFS query.")}return n}getGeometryColumnNameToFeatureTypes(t){const n={},s=t.map(r=>r.queryLayers.split(",")).flat(1);for(const r of s){const o=this.featureTypeToGeometryColumnName[r];o in n||(n[o]=[]),n[o].push(r)}return n}}_a=new WeakSet,Yu=async function(t){for(const n of t){const s=new ZT("",n),r=this.getDescribeFeatureTypeUrl(n),a=await(await fetch(r)).text(),l=new DOMParser().parseFromString(a,"text/xml"),h=this.getElementToTypeName(l),c=l.getElementsByTagName("complexType");for(const u of c){const d=u.getAttribute("name");if(!d)throw new Error("Could not find a name for the complex type");const f=h[d],g=u.getElementsByTagName("sequence")[0].getElementsByTagName("element");let p=!1;for(const m of g)this.manageLayerAttribute(s,m,f)&&(p=!0);if(!p)throw new Error("No Geometry column for the type "+f)}s.initialized=!0,this.serversWfs[n]=s}};class KT extends Map{set(e,t){return super.set(e,t),t}}class Sf extends WeakMap{set(e,t){return super.set(e,t),t}}/*! (c) Andrea Giammarchi - ISC */const JT=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,QT=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/?)>/g,e2=/([^\s\\>"'=]+)\s*=\s*(['"]?)\x01/g,t2=/[\x01\x02]/g,i2=(i,e,t)=>{let n=0;return i.join("").trim().replace(QT,(s,r,o,a)=>{let l=r+o.replace(e2,"=$2$1").trimEnd();return a.length&&(l+=t||JT.test(r)?" /":"></"+r),"<"+l+">"}).replace(t2,s=>s===""?"<!--"+e+n+++"-->":e+n++)},n2=1,qy=111,s2=({firstChild:i,lastChild:e})=>{const t=document.createRange();return t.setStartAfter(i),t.setEndAfter(e),t.deleteContents(),i},r2=(i,e)=>i.nodeType===qy?1/e<0?e?s2(i):i.lastChild:e?i.valueOf():i.firstChild:i,o2=i=>{const{firstChild:e,lastChild:t}=i;if(e===t)return t||i;const{childNodes:n}=i,s=[...n];return{ELEMENT_NODE:n2,nodeType:qy,firstChild:e,lastChild:t,valueOf(){return n.length!==s.length&&i.append(...s),i}}},{isArray:a2}=Array,l2=i=>e=>{for(const t in e){const n=t==="role"?t:`aria-${t}`,s=e[t];s==null?i.removeAttribute(n):i.setAttribute(n,s)}},Tf=i=>i==null?i:i.valueOf(),h2=(i,e)=>{let t,n=!0;const s=document.createAttributeNS(null,e);return r=>{const o=Tf(r);t!==o&&((t=o)==null?n||(i.removeAttributeNode(s),n=!0):(s.value=o,n&&(i.setAttributeNodeNS(s),n=!1)))}},c2=(i,e,t)=>n=>{const s=!!Tf(n);t!==s&&((t=s)?i.setAttribute(e,""):i.removeAttribute(e))},u2=({dataset:i})=>e=>{for(const t in e){const n=e[t];n==null?delete i[t]:i[t]=n}},Wp=(i,e)=>{let t,n,s=e.slice(2);return!(e in i)&&(n=e.toLowerCase())in i&&(s=n.slice(2)),r=>{const o=a2(r)?r:[r,!1];t!==o[0]&&(t&&i.removeEventListener(s,t,o[1]),(t=o[0])&&i.addEventListener(s,t,o[1]))}},d2=i=>{let e;return t=>{e!==t&&(e=t,typeof t=="function"?t(i):t.current=i)}},f2=(i,e)=>e==="dataset"?u2(i):t=>{i[e]=t},g2=i=>{let e;return t=>{const n=Tf(t);e!=n&&(e=n,i.textContent=n??"")}},p2=(i,e,t,n,s)=>{const r=t.length;let o=e.length,a=r,l=0,h=0,c=null;for(;l<o||h<a;)if(o===l){const u=a<r?h?n(t[h-1],-0).nextSibling:n(t[a-h],0):s;for(;h<a;)i.insertBefore(n(t[h++],1),u)}else if(a===h)for(;l<o;)(!c||!c.has(e[l]))&&i.removeChild(n(e[l],-1)),l++;else if(e[l]===t[h])l++,h++;else if(e[o-1]===t[a-1])o--,a--;else if(e[l]===t[a-1]&&t[h]===e[o-1]){const u=n(e[--o],-1).nextSibling;i.insertBefore(n(t[h++],1),n(e[l++],-1).nextSibling),i.insertBefore(n(t[--a],1),u),e[o]=t[a]}else{if(!c){c=new Map;let u=h;for(;u<a;)c.set(t[u],u++)}if(c.has(e[l])){const u=c.get(e[l]);if(h<u&&u<a){let d=l,f=1;for(;++d<o&&d<a&&c.get(e[d])===u+f;)f++;if(f>u-h){const g=n(e[l],0);for(;h<u;)i.insertBefore(n(t[h++],1),g)}else i.replaceChild(n(t[h++],1),n(e[l++],-1))}else l++}else i.removeChild(n(e[l++],-1))}return t},{isArray:jy,prototype:m2}=Array,{indexOf:y2}=m2,{createDocumentFragment:_2,createElement:v2,createElementNS:x2,createTextNode:w2,createTreeWalker:b2,importNode:E2}=new Proxy({},{get:(i,e)=>document[e].bind(document)}),M2=i=>{const e=v2("template");return e.innerHTML=i,e.content};let dl;const C2=i=>{dl||(dl=x2("http://www.w3.org/2000/svg","svg")),dl.innerHTML=i;const e=_2();return e.append(...dl.childNodes),e},S2=(i,e)=>e?C2(i):M2(i),T2=({childNodes:i},e)=>i[e],Lo=(i,e,t)=>p2(i.parentNode,e,t,r2,i),R2=i=>{let e,t,n=[];const s=r=>{switch(typeof r){case"string":case"number":case"boolean":e!==r&&(e=r,t||(t=w2("")),t.data=r,n=Lo(i,n,[t]));break;case"object":case"undefined":if(r==null){e!=r&&(e=r,n=Lo(i,n,[]));break}if(jy(r)){e=r,r.length===0?n=Lo(i,n,[]):typeof r[0]=="object"?n=Lo(i,n,r):s(String(r));break}if(e!==r)if("ELEMENT_NODE"in r)e=r,n=Lo(i,n,r.nodeType===11?[...r.childNodes]:[r]);else{const o=r.valueOf();o!==r&&s(o)}break;case"function":s(r(i));break}};return s},I2=(i,e)=>{switch(e[0]){case"?":return c2(i,e.slice(1),!1);case".":return f2(i,e.slice(1));case"@":return Wp(i,"on"+e.slice(1));case"o":if(e[1]==="n")return Wp(i,e)}switch(e){case"ref":return d2(i);case"aria":return l2(i)}return h2(i,e)};function L2(i){const{type:e,path:t}=i,n=t.reduceRight(T2,this);return e==="node"?R2(n):e==="attr"?I2(n,i.name):g2(n)}const kc=i=>{const e=[];let{parentNode:t}=i;for(;t;)e.push(y2.call(t.childNodes,i)),i=t,{parentNode:t}=i;return e},Po="is",Vp=new Sf,P2=/^(?:textarea|script|style|title|plaintext|xmp)$/,oa=()=>({stack:[],entry:null,wire:null}),A2=(i,e)=>{const{content:t,updates:n}=k2(i,e);return{type:i,template:e,content:t,updates:n,wire:null}},F2=(i,e)=>{const t=i==="svg",n=i2(e,Po,t),s=S2(n,t),r=b2(s,129),o=[],a=e.length-1;let l=0,h=`${Po}${l}`;for(;l<a;){const c=r.nextNode();if(!c)throw`bad template: ${n}`;if(c.nodeType===8)c.data===h&&(o.push({type:"node",path:kc(c)}),h=`${Po}${++l}`);else{for(;c.hasAttribute(h);)o.push({type:"attr",path:kc(c),name:c.getAttribute(h)}),c.removeAttribute(h),h=`${Po}${++l}`;P2.test(c.localName)&&c.textContent.trim()===`<!--${h}-->`&&(c.textContent="",o.push({type:"text",path:kc(c)}),h=`${Po}${++l}`)}}return{content:s,nodes:o}},k2=(i,e)=>{const{content:t,nodes:n}=Vp.get(e)||Vp.set(e,F2(i,e)),s=E2(t,!0),r=n.map(L2,s);return{content:s,updates:r}},uh=(i,{type:e,template:t,values:n})=>{const s=Wy(i,n);let{entry:r}=i;(!r||r.template!==t||r.type!==e)&&(i.entry=r=A2(e,t));const{content:o,updates:a,wire:l}=r;for(let h=0;h<s;h++)a[h](n[h]);return l||(r.wire=o2(o))},Wy=({stack:i},e)=>{const{length:t}=e;for(let n=0;n<t;n++){const s=e[n];s instanceof dh?e[n]=uh(i[n]||(i[n]=oa()),s):jy(s)?Wy(i[n]||(i[n]=oa()),s):i[n]=null}return t<i.length&&i.splice(t),t};class dh{constructor(e,t,n){this.type=e,this.template=t,this.values=n}}const Vy=i=>{const e=new Sf,t=n=>(s,...r)=>uh(n,{type:i,template:s,values:r});return Object.assign((n,...s)=>new dh(i,n,s),{for(n,s){const r=e.get(n)||e.set(n,new KT);return r.get(s)||r.set(s,t(oa()))},node:(n,...s)=>uh(oa(),new dh(i,n,s)).valueOf()})},Xp=new Sf,O2=(i,e)=>{const t=typeof e=="function"?e():e,n=Xp.get(i)||Xp.set(i,oa()),s=t instanceof dh?uh(n,t):t;return s!==n.wire&&(n.wire=s,i.replaceChildren(s.valueOf())),i},Ee=Vy("html");Vy("svg");class at extends HTMLElement{constructor(t){super();v(this,"templateUrl",null);v(this,"styleUrl",null);v(this,"template");v(this,"component");v(this,"shadow");v(this,"activeTooltips",[]);v(this,"messageManager");v(this,"configManager");v(this,"stateManager");this.component=t,this.configManager=kn.getInstance(),this.messageManager=Qh.getInstance(),this.stateManager=Xi.getInstance(),this.shadow=this.attachShadow({mode:"open"}),this.stateManager.subscribe("language",(n,s)=>this.girafeTranslate())}get state(){return this.stateManager.state}async loadConfig(){await this.configManager.loadConfig()}girafeTranslate(){Xl.getInstance().translate(this.shadow)}isNullOrUndefined(t){return t==null}isNullOrUndefinedOrBlank(t){return t==null||t===""}delayed(t,n){new MutationObserver((r,o)=>{t()&&(n(),o.disconnect())}).observe(this.shadow,{childList:!0,subtree:!0})}getParentOfType(t,n){if(n===null||n.nodeName===t)return n;let s=null;return n instanceof ShadowRoot?s=n.host:s=n.parentNode,this.getParentOfType(t,s)}activateTooltips(t,n,s){for(const o of this.activeTooltips)o.destroy();this.activeTooltips=[],Array.from(this.shadow.querySelectorAll("[tip]")).forEach(o=>{if(o.getAttribute("tip")!==""){const l=o.getAttribute("tip-placement")??s,h=Yo(o,{arrow:t,delay:n,placement:l,content:o.getAttribute("tip")});this.activeTooltips.push(h)}})}render(){O2(this.shadow,this.template)}hide(){this.style.display="none"}}class Xy extends at{constructor(t){super(t);v(this,"button");v(this,"div");v(this,"header");v(this,"closeButton");v(this,"pos1",0);v(this,"pos2",0);v(this,"pos3",0);v(this,"pos4",0)}get host(){return this.shadow.getRootNode().host}makeDraggable(){this.div=this.shadow.querySelector("#draggable"),this.header=this.shadow.querySelector("#header"),this.header.onmousedown=t=>this.dragMouseDown(this,t),this.closeButton=this.shadow.getElementById("close"),this.isNullOrUndefined(this.closeButton)||(this.closeButton.onclick=()=>this.closeWindow())}closeWindow(){throw new Error("This function must be overriden to close the associated window")}dragMouseDown(t,n){n.preventDefault(),t.pos3=n.clientX,t.pos4=n.clientY,document.onmouseup=()=>t.closeDragElement(),document.onmousemove=s=>t.elementDrag(t,s)}elementDrag(t,n){n.preventDefault();const s=t.host.getBoundingClientRect(),r=t.pos3-n.clientX,o=t.host.offsetLeft-r,a=o+s.width;o<0?t.host.style.left="0px":a>this.getBodyWidth()?t.host.style.left=this.getBodyWidth()-s.width+"px":(t.pos1=r,t.pos3=n.clientX,t.host.style.left=o+"px");const l=t.pos4-n.clientY,h=t.host.offsetTop-l,c=h+s.height;h<0?t.host.style.top="0px":c>this.getBodyHeight()?t.host.style.top=this.getBodyHeight()-s.height+"px":(t.pos2=l,t.pos4=n.clientY,t.host.style.top=h+"px")}getBodyWidth(){return Math.max(document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth,document.documentElement.clientWidth)}getBodyHeight(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight)}closeDragElement(){document.onmouseup=null,document.onmousemove=null}}class N2 extends Xy{constructor(){super("about");v(this,"template",()=>Ee`<style>
#draggable {
  border-radius: 1px;
  box-shadow: var(--bx-shdw);
}

#header {
  padding: 0.5rem;
  cursor: grabbing;
  z-index: 10;
  background: var(--bkg-color-grad2);
  color: var(--text-color);
  text-align: center;
}

#content {
  padding: 0rem 2rem;
  width: 23rem;
  height: 13rem;
}

#close {
  cursor: pointer;
  float: right;
}

img {
  margin-top: 1rem;
  margin-bottom: 1rem;
}

h3 {
  font-size: 1rem;
  font-weight: normal;
  margin: 0.2rem;
  color: var(--text-color);
}

a:link {
  color: var(--lnk);
}

a:visited {
  color: var(--lnk-visited);
}

a:hover {
  color: var(--lnk-hover);
}

a:active {
  color: var(--lnk-active);
  text-decoration: none;
  font-weight: normal;
}

</style>
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />

<div id="draggable">
  <div id="header">
    About
    <div id="close">
      <i class="fa-solid fa-xmark"></i>
    </div>
  </div>
  <div id="content">
    <img alt="GeoGirafe logo" src="components/about/images/Girafe_Opengis.png" width="250px"/>
    <h3>powered by: <a href="https://www.opengis.ch" rel="noopener" target="_blank">https://www.opengis.ch</a></h3>
    <hr />    <h3>Version: ${this.version}</h3>
    <h3>Build: ${this.build}</span></h3>
    <h3>Date: ${this.date}</span></h3>
    <h3>Source: <a href="https://gitlab.com/geogirafe/gg-viewer" rel="noopener" target="_blank">https://gitlab.com/geogirafe/gg-viewer</a></h3>
  </div>
</div>
`);v(this,"loaded",!1);v(this,"version");v(this,"build");v(this,"date")}async loadVersionInfos(){if(!this.loaded){const n=await(await fetch("about.json")).json();this.version=n.version,this.build=n.build,this.date=n.date,this.loaded=!0,console.log(this.version),console.log(this.build),console.log(this.date)}this.render()}registerEvents(){this.stateManager.subscribe("interface.aboutVisible",(t,n)=>this.toggleAbout(n))}toggleAbout(t){t?this.loadVersionInfos().then(()=>{this.shadow.getRootNode().host.style.display="block"}):this.shadow.getRootNode().host.style.display="none"}closeWindow(){this.state.interface.aboutVisible=!1}connectedCallback(){this.loadConfig().then(()=>{this.render(),this.girafeTranslate(),this.makeDraggable(),this.registerEvents()})}}class D2 extends at{constructor(){super("basemap");v(this,"template",()=>Ee`<style>
#container {
  display: inline-flex;
  flex-direction: column;
  width: max-content;
}

</style>
<girafe-menu-button icon-style="fa-sm fa-solid fa-layer-group" size="small" open="up" class="transparent">
  <div slot="menu-content">
    <div id="container">
      ${Object.values(this.state.basemaps).map(t=>Ee.for(t)`
      <girafe-button
        text="${t.name}"
        size="large"
        class="border-top"
        onclick="${()=>this.changeBasemap(t)}"></girafe-button
      >`)}
    </div>
  </div>
</girafe-menu-button>
`);v(this,"servers",{});v(this,"basemapJson",{});this.configManager.loadConfig().then(()=>{this.configManager.Config.basemaps.show||this.hide()})}render(){super.render()}onBasemapsLoaded(t){super.render();for(const n of Object.values(t))if(n.name===this.configManager.Config.basemaps.defaultBasemap){this.state.activeBasemap=n;break}}changeBasemap(t){console.log("change basemap",t),t.projection&&(this.state.projection=t.projection),this.state.activeBasemap=t}registerEvents(){this.stateManager.subscribe("basemaps",(t,n)=>this.onBasemapsLoaded(n))}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}}class Yy extends at{constructor(){super("button");v(this,"template",()=>Ee`<style>
:host {
  display: inline-block;
}

#button {
  border: none;
  border-right: solid 1px #fff;
  width: 4rem;
  height: 4.6rem;
  background-color: var(--bkg-color-grad1);
  color: var(--text-color-grad1);
  padding: 0;
  cursor: pointer;
  margin: 0;
  display: inline-block;
  line-height: 4rem;
}

#container.transparent #button {
  background-color: transparent;
  color: var(--text-color-grad2);
}

#container.transparent #button:hover {
  background-color: transparent;
  color: var(--text-color);
}

#container.transparent.selected #button {
  background-color: var(--text-color-grad1);
  color: var(--text-color-grad1);
}

#container.transparent.selected #button:hover {
  background-color: var(--text-color-grad2);
}

#button.small {
  width: 2.3rem;
  height: 2.3rem;
  line-height: 2.3rem;
}
#button.extra-small {
  width: 1rem;
  height: 1rem;
  line-height: 1rem;
}

span {
  font-size: 1.3rem;
}

#button.large {
  width: 100%;
  height: 2.3rem;
  line-height: 2.3rem;
  padding-left: 1rem;
  padding-right: 1rem;
  text-align: left;
}

#button.large span {
  font-size: 0.8rem;
  display: inline-block;
}

#button.hybrid {
  display: flex;
  flex-direction: column;
}

#button.hybrid i {
  display: inline-block;
  height: 55%;
  width: 100%;
  line-height: 3.5rem;
}

#button.hybrid span {
  font-size: 0.8rem;
  height: 45%;
  width: 100%;
  line-height: 1.5rem;
}

#button:hover {
  background-color: var(--bkg-color);
}

</style>
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />

<div id="container">
  <button id="button" title="TODO: Generate this label from the button configuration"></button>
</div>
`);v(this,"button");v(this,"container");v(this,"icon",null);v(this,"textSpan",null);v(this,"text",null);v(this,"option",null);v(this,"href",null);v(this,"actionState",null);v(this,"actionValue",null)}render(){if(super.render(),this.container=this.shadow.querySelector("#container"),this.button=this.shadow.querySelector("#button"),this.hasAttribute("icon-style")&&(this.icon=document.createElement("i"),this.icon.className=this.getAttribute("icon-style"),this.button.appendChild(this.icon)),this.hasAttribute("text")&&(this.text=this.getAttribute("text"),this.textSpan=document.createElement("span"),this.textSpan.innerHTML=this.text,this.textSpan.setAttribute("i18n",this.text),this.button.appendChild(this.textSpan)),this.hasAttribute("size")){const t=this.getAttribute("size");this.button.classList.add(t)}this.container.classList.add(...this.classList),this.setButtonStyle()}setButtonStyle(){this.icon!==null&&this.textSpan!==null&&(this.button.className="hybrid")}setText(t){this.textSpan!==null&&this.isNullOrUndefinedOrBlank(t)?(this.text=null,this.textSpan.remove(),this.textSpan=null):this.textSpan===null&&!this.isNullOrUndefinedOrBlank(t)?(this.text=t,this.textSpan=document.createElement("span"),this.textSpan.innerHTML=this.text,this.isNullOrUndefined(this.button)?super.delayed(()=>this.button!==null,()=>this.button.appendChild(this.textSpan)):this.button.appendChild(this.textSpan)):(this.text=t,this.textSpan.innerHTML=this.text),this.setButtonStyle()}registerEvents(){if(this.hasAttribute("href"))this.href=this.getAttribute("href");else if(this.hasAttribute("message")){this.option={},this.option.message=this.getAttribute("message");for(const n in this.dataset)this.option[n]=this.dataset[n]}else this.hasAttribute("state-action")&&(this.actionState=this.getAttribute("state-action"),this.actionValue=this.getActionValue());new MutationObserver(this.parentAttributeChanged.bind(this)).observe(this,{attributes:!0}),this.button.addEventListener("click",()=>this.onClick())}getActionValue(){if(Object.keys(this.dataset).length>1)throw new Error("Maximum 1 parameter is allowed here.");if(Object.keys(this.dataset).length===0)return null;const t=Object.values(this.dataset)[0];return t==="true"?!0:t==="false"?!1:t.startsWith("[")&&t.endsWith("]")?t.substring(1,t.length-1).split(",").map(r=>parseFloat(r)?parseFloat(r):r):t}parentAttributeChanged(t){t.forEach(n=>{n.attributeName==="class"&&this.container.classList.add(...this.classList),n.attributeName==="icon-style"&&this.icon&&(this.icon.className=this.getAttribute("icon-style"))})}onClick(){if(!this.isNullOrUndefined(this.href))window.open(this.href,"_blank");else if(this.option)this.messageManager.sendMessage(this.option);else if(this.actionState){const n=this.actionState.split(".");let s=this.state;for(let r=0;r<n.length-1;++r)s=s[n[r]];if(this.actionValue===null){if(typeof s[n[n.length-1]]!="boolean")throw new Error("Cannot invert boolean value: it isn't a boolean");s[n[n.length-1]]=!s[n[n.length-1]]}else s[n[n.length-1]]=this.actionValue}const t=super.getParentOfType("GIRAFE-MENU-BUTTON",this.shadow.host.parentNode);t!==null&&t.closeMenu()}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}}class G2 extends at{constructor(){super("colorswitcher");v(this,"template",()=>Ee`<style>
.lbl {
  position: inherit;
  top: -0.75rem;
}

/* The switch - the box around the slider */
.switch {
  position: relative;
  display: inline-block;
  vertical-align: middle;
  border-right: solid 1px #fff;
  width: 4rem;
  height: 4.6rem;
  text-align: center;
  background-color: var(--bkg-color-grad1);
}

/* Hide default HTML checkbox */
.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

/* The slider */
.slider {
  position: absolute;
  cursor: pointer;
  top: 2.2rem;
  left: 0.5rem;
  right: 0.5rem;
  bottom: 1.4rem;
  width: 3rem;
  height: 1.5rem;
  vertical-align: middle;
  background-color: var(--bkg-color);
  -webkit-transition: 0.4s;
  transition: 0.4s;
}

.slider:before {
  position: absolute;
  content: '';
  height: 1.3rem;
  width: 1.3rem;
  left: 4px;
  bottom: 0.1rem;
  background-color: var(--text-color-grad1);
  -webkit-transition: 0.4s;
  transition: 0.4s;
}

input:checked + .slider {
  background-color: #222;
}

input:focus + .slider {
  box-shadow: 0 0 1px #222;
}

input:checked + .slider:before {
  -webkit-transform: translateX(18px);
  -ms-transform: translateX(18px);
  transform: translateX(18px);
}

/* Rounded sliders */
.slider.round {
  border-radius: 1rem;
}

.slider.round:before {
  border-radius: 50%;
}

</style>
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />

<div id="container">
  <label class="switch">
    <h6 class="lbl">Color mode</h6>
    <input id="colorswitchSwitcher" type="checkbox" />
    <span id="colorswitcher" class="slider round"></span>
  </label>
</div>
`);v(this,"colorswitcherContainer");v(this,"colorswitchSwitcher");v(this,"header");v(this,"currentTheme",localStorage.getItem("theme"))}render(){super.render(),this.colorswitcherContainer=this.shadow.querySelector("#colorswitcherContainer"),this.colorswitchSwitcher=this.shadow.querySelector("#colorswitchSwitcher")}getHeader(){this.header=this.shadow.querySelector("body")}registerEvents(){this.colorswitchSwitcher.addEventListener("click",()=>this.toggleDarkFrontendMode())}toggleClassList(t){t?this.activateThemeMode("dark","replace"):this.activateThemeMode("light","replace")}toggleDarkFrontendMode(){let t=Xi.getInstance().state.interface.darkFrontendMode;t=!t,Xi.getInstance().state.interface.darkFrontendMode=t;let n="light";t&&(n="dark"),this.toggleClassList(t),localStorage.setItem("theme",n)}initValue(){if(this.currentTheme!=null&&this.currentTheme==="dark"){this.activateThemeMode("dark","toggle");return}else if(this.currentTheme!=null&&this.currentTheme==="light"){this.activateThemeMode("light","toggle");return}window.matchMedia("(prefers-color-scheme: dark)").matches?this.activateThemeMode("dark","toggle"):this.activateThemeMode("light","toggle")}activateThemeMode(t,n){if(n==="toggle")document.body.classList.toggle(`${t}-theme`);else{const s=t==="dark"?"light":"dark";document.body.classList.replace(`${s}-theme`,`${t}-theme`)}Xi.getInstance().state.interface.darkFrontendMode=t==="dark",t==="dark"?document.body.querySelector("#logo").src="images/logo_black_small.webp":document.body.querySelector("#logo").src="images/logo_small.webp"}connectedCallback(){this.loadConfig().then(()=>{this.render(),this.girafeTranslate(),this.registerEvents(),this.getHeader(),this.initValue()})}}function Hu(i,e){const t=(Math.round(i[0]*100)/100).toLocaleString(e,{minimumFractionDigits:2}),n=(Math.round(i[1]*100)/100).toLocaleString(e,{minimumFractionDigits:2});return[t,n]}var jr;class z2 extends at{constructor(){super("coordinate");v(this,"template",()=>Ee`<style>
#content {
  background: var(--t-bkg);
  color: var(--text-color);
  width: -moz-fit-content;
  width: fit-content;
  white-space: nowrap;
  padding: 0 0.5rem;
  font-size: 1rem;
  height: 2.3rem;
  line-height: 2.3rem;
}

span {
  font-weight: bold;
}

</style>
<div id="content">
  <span id="coords">E ${this.east} / N ${this.north}</span>
</div>
`);re(this,jr,void 0);v(this,"east",null);v(this,"north",null)}get locale(){if(!Z(this,jr))throw new Error("You called locale before render");return Z(this,jr)}render(){super.render(),Ke(this,jr,this.configManager.Config.general.locale)}registerEvents(){this.stateManager.subscribe("mouseCoordinates",(t,n)=>this.onChangeCoordinates(n))}onChangeCoordinates(t){[this.east,this.north]=Hu(t,this.locale),this.render()}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}}jr=new WeakMap;var Wr;class B2 extends at{constructor(){super("globe");v(this,"template",()=>Ee`<style>

</style>
<girafe-menu-button id="menu-button" icon-style="fa-xl fa-solid fa-globe" text="2D / 3D" open="left">
  <div slot="menu-content">
    <girafe-button icon-style="fa-xl fa-solid fa-map" text="2D" onclick="this.state.globe.display='none'">
    </girafe-button>
    <girafe-button icon-style="fa-xl fa-solid fa-right-left" text="Both" onclick="this.state.globe.display='side'">
    </girafe-button>
    <girafe-button icon-style="fa-xl fa-solid fa-earth-europe" text="3D" onclick="this.state.globe.display='full'">
    </girafe-button>
  </div>
</girafe-menu-button>
`);re(this,Wr,void 0)}get menuButton(){if(!Z(this,Wr))throw new Error("You called menuButton before render");return Z(this,Wr)}render(){super.render(),Ke(this,Wr,this.shadow.querySelector("#menu-button"))}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate()})}}Wr=new WeakMap;class $2 extends at{constructor(){super("help");v(this,"template",()=>Ee`<style>
#content {
  z-index: 10000;
  position: fixed;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  background-color: rgba(0, 0, 0, 0.65);
  display: none;
}

#themes {
  position: absolute;
  top: 4.5rem;
  left: 0;
  width: 150px;
  height: 120px;
  background-image: url(components/help/images/arrow_white.webp);
  background-repeat: no-repeat;
  transform: rotateY(0deg) rotateX(0deg) rotateZ(90deg);
  background-position: bottom -50px left -60px;
}

#search {
  position: absolute;
  top: 8rem;
  left: 45%;
  width: 180px;
  height: 70px;
  background-image: url(components/help/images/arrow_white.webp);
  background-repeat: no-repeat;
  transform: rotateY(0deg) rotateX(0deg) rotateZ(90deg);
  background-position: -60px -30px;
}

#menu {
  position: absolute;
  top: 4.5rem;
  right: 0;
  width: 150px;
  height: 120px;
  background-image: url(components/help/images/arrow_white.webp);
  background-repeat: no-repeat;
  transform: rotateY(180deg) rotateX(0deg) rotateZ(90deg);
  background-position: bottom -50px left -60px;
}

#basemap {
  position: absolute;
  bottom: 3rem;
  left: 21rem;
  width: 150px;
  height: 120px;
  background-image: url(components/help/images/arrow_white.webp);
  background-repeat: no-repeat;
  transform: rotateY(0deg) rotateX(180deg) rotateZ(90deg);
  background-position: bottom -50px left -60px;
}

#themes-descr {
  position: absolute;
  top: 10rem;
  left: 10rem;
  color: #fff;
  font-size: 1.2rem;
  width: 12rem;
}

#search-descr {
  position: absolute;
  top: 16rem;
  left: 45%;
  color: #fff;
  font-size: 1.2rem;
  width: 12rem;
}

#menu-descr {
  position: absolute;
  top: 10rem;
  right: 10rem;
  color: #fff;
  font-size: 1.2rem;
  width: 12rem;
  text-align: right;
}

#basemap-descr {
  position: absolute;
  bottom: 9rem;
  left: 31rem;
  color: #fff;
  font-size: 1.2rem;
  width: 12rem;
}

</style>
<div id="content">
  <div id="themes"></div>
  <div id="themes-descr">
    Clicking the Topics button opens the topic overview. After selecting the desired topic, all assigned maps are
    loaded.
  </div>

  <div id="search"></div>
  <div id="search-descr">Search for a place, an address, a map or a geographical data.</div>

  <div id="menu"></div>
  <div id="menu-descr">This menu contains advanced functions such as printing, drawing, language, 3D view, etc...</div>

  <div id="basemap"></div>
  <div id="basemap-descr">Here, you can choose which background layers you want to use.</div>
</div>
`);v(this,"content")}render(){super.render(),this.content=this.shadow.querySelector("#content"),this.configManager.Config.basemaps.show||(this.shadow.querySelector("#basemap").style.display="none",this.shadow.querySelector("#basemap-descr").style.display="none")}registerEvents(){this.stateManager.subscribe("interface.helpVisible",(t,n)=>this.toggleHelp(n)),this.content.addEventListener("click",()=>{this.state.interface.helpVisible=!1})}toggleHelp(t){t?this.content.style.display="block":this.content.style.display="none"}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}}var Vr;class U2 extends at{constructor(){super("language");v(this,"template",()=>Ee`<style>

</style>
<girafe-menu-button id="menu-button" icon-style="fa-xl fa-solid fa-language" open="left">
  <div slot="menu-content">
    ${this.languages.map((t,n)=>Ee`
    <girafe-button
      text="${t.toUpperCase()}"
      icon-style="fa-xl fa-solid fa-language"
      onclick="${()=>this.changeLanguage(t)}"></girafe-button
    >`)}
  </div>
</girafe-menu-button>
`);v(this,"languages",[]);re(this,Vr,void 0)}get menuButton(){if(!Z(this,Vr))throw new Error("You called menuButton before render");return Z(this,Vr)}render(){for(const t in this.configManager.Config.languages)!t.startsWith("//")&&t!=="defaultLanguage"&&this.languages.push(t);super.render(),Ke(this,Vr,this.shadow.querySelector("#menu-button")),this.languages.length==1&&this.menuButton.hide()}changeLanguage(t){console.log("change language",t),this.state.language=t}registerEvents(){this.stateManager.subscribe("language",(t,n)=>this.onTranslate(n))}onTranslate(t){this.menuButton.setText(t.toUpperCase()),this.menuButton.closeMenu()}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}}Vr=new WeakMap;const q2="modulepreload",j2=function(i,e){return new URL(i,e).href},Yp={},Hp=function(e,t,n){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(r=>{if(r=j2(r,n),r in Yp)return;Yp[r]=!0;const o=r.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!n)for(let c=s.length-1;c>=0;c--){const u=s[c];if(u.href===r&&(!o||u.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${a}`))return;const h=document.createElement("link");if(h.rel=o?"stylesheet":q2,o||(h.as="script",h.crossOrigin=""),h.href=r,document.head.appendChild(h),o)return new Promise((c,u)=>{h.addEventListener("load",c),h.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>e()).catch(r=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=r,window.dispatchEvent(o),!o.defaultPrevented)throw r})},bt={ADD:"add",REMOVE:"remove"},Zp={LENGTH:"length"};class fl extends xi{constructor(e,t,n){super(e),this.element=t,this.index=n}}class W2 extends _n{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e||[],this.unique_)for(let n=0,s=this.array_.length;n<s;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,n=e.length;t<n;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let n=0,s=t.length;n<s;++n)e(t[n],n,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(Zp.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new fl(bt.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){this.unique_&&this.assertUnique_(e);const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let n=0,s=t.length;n<s;++n)if(t[n]===e)return this.removeAt(n)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new fl(bt.REMOVE,t,e)),t}setAt(e,t){const n=this.getLength();if(e>=n){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const s=this.array_[e];this.array_[e]=t,this.dispatchEvent(new fl(bt.REMOVE,s,e)),this.dispatchEvent(new fl(bt.ADD,t,e))}updateLength_(){this.set(Zp.LENGTH,this.array_.length)}assertUnique_(e,t){for(let n=0,s=this.array_.length;n<s;++n)if(this.array_[n]===e&&n!==t)throw new Error("Duplicate item added to a unique collection")}}const Xt=W2,Ue={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class V2 extends _n{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[Ue.OPACITY]=e.opacity!==void 0?e.opacity:1,_e(typeof t[Ue.OPACITY]=="number","Layer opacity must be a number"),t[Ue.VISIBLE]=e.visible!==void 0?e.visible:!0,t[Ue.Z_INDEX]=e.zIndex,t[Ue.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[Ue.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[Ue.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[Ue.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0?!0:e},n=this.getZIndex();return t.opacity=et(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=n===void 0&&!t.managed?1/0:n,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return ie()}getLayerStatesArray(e){return ie()}getExtent(){return this.get(Ue.EXTENT)}getMaxResolution(){return this.get(Ue.MAX_RESOLUTION)}getMinResolution(){return this.get(Ue.MIN_RESOLUTION)}getMinZoom(){return this.get(Ue.MIN_ZOOM)}getMaxZoom(){return this.get(Ue.MAX_ZOOM)}getOpacity(){return this.get(Ue.OPACITY)}getSourceState(){return ie()}getVisible(){return this.get(Ue.VISIBLE)}getZIndex(){return this.get(Ue.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(Ue.EXTENT,e)}setMaxResolution(e){this.set(Ue.MAX_RESOLUTION,e)}setMinResolution(e){this.set(Ue.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(Ue.MAX_ZOOM,e)}setMinZoom(e){this.set(Ue.MIN_ZOOM,e)}setOpacity(e){_e(typeof e=="number","Layer opacity must be a number"),this.set(Ue.OPACITY,e)}setVisible(e){this.set(Ue.VISIBLE,e)}setZIndex(e){this.set(Ue.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const Hy=V2,dn={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},Ye={ANIMATING:0,INTERACTING:1},Gi={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},Zy=42,Rf=256;function Kp(i,e,t){return function(n,s,r,o,a){if(!n)return;if(!s&&!e)return n;const l=e?0:r[0]*s,h=e?0:r[1]*s,c=a?a[0]:0,u=a?a[1]:0;let d=i[0]+l/2+c,f=i[2]-l/2+c,g=i[1]+h/2+u,p=i[3]-h/2+u;d>f&&(d=(f+d)/2,f=d),g>p&&(g=(p+g)/2,p=g);let m=et(n[0],d,f),_=et(n[1],g,p);if(o&&t&&s){const y=30*s;m+=-y*Math.log(1+Math.max(0,d-n[0])/y)+y*Math.log(1+Math.max(0,n[0]-f)/y),_+=-y*Math.log(1+Math.max(0,g-n[1])/y)+y*Math.log(1+Math.max(0,n[1]-p)/y)}return[m,_]}}function X2(i){return i}function If(i,e,t,n){const s=Re(e)/t[0],r=_t(e)/t[1];return n?Math.min(i,Math.max(s,r)):Math.min(i,Math.min(s,r))}function Lf(i,e,t){let n=Math.min(i,e);const s=50;return n*=Math.log(1+s*Math.max(0,i/e-1))/s+1,t&&(n=Math.max(n,t),n/=Math.log(1+s*Math.max(0,t/i-1))/s+1),et(n,t/2,e*2)}function Y2(i,e,t,n){return e=e!==void 0?e:!0,function(s,r,o,a){if(s!==void 0){const l=i[0],h=i[i.length-1],c=t?If(l,t,o,n):l;if(a)return e?Lf(s,c,h):et(s,h,c);const u=Math.min(c,s),d=Math.floor(ec(i,u,r));return i[d]>c&&d<i.length-1?i[d+1]:i[d]}}}function H2(i,e,t,n,s,r){return n=n!==void 0?n:!0,t=t!==void 0?t:0,function(o,a,l,h){if(o!==void 0){const c=s?If(e,s,l,r):e;if(h)return n?Lf(o,c,t):et(o,t,c);const u=1e-9,d=Math.ceil(Math.log(e/c)/Math.log(i)-u),f=-a*(.5-u)+.5,g=Math.min(c,o),p=Math.floor(Math.log(e/g)/Math.log(i)+f),m=Math.max(d,p),_=e/Math.pow(i,m);return et(_,t,c)}}}function Jp(i,e,t,n,s){return t=t!==void 0?t:!0,function(r,o,a,l){if(r!==void 0){const h=n?If(i,n,a,s):i;return!t||!l?et(r,e,h):Lf(r,h,e)}}}function Pf(i){if(i!==void 0)return 0}function Qp(i){if(i!==void 0)return i}function Z2(i){const e=2*Math.PI/i;return function(t,n){if(n)return t;if(t!==void 0)return t=Math.floor(t/e+.5)*e,t}}function K2(i){const e=i===void 0?ks(5):i;return function(t,n){return n||t===void 0?t:Math.abs(t)<=e?0:t}}function Ky(i){return Math.pow(i,3)}function fs(i){return 1-Ky(1-i)}function J2(i){return 3*i*i-2*i*i*i}function Q2(i){return i}const Oc=0;class eR extends _n{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Fd(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&R0(),e.center&&(e.center=je(e.center,this.projection_)),e.extent&&(e.extent=ln(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const a in Gi)delete t[a];this.setProperties(t,!0);const n=iR(e);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=n.minZoom;const s=tR(e),r=n.constraint,o=nR(e);this.constraints_={center:s,resolution:r,rotation:o},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const n=this.getCenterInternal();if(n){const s=e||[0,0,0,0];t=t||[0,0,0,0];const r=this.getResolution(),o=r/2*(s[3]-t[3]+t[1]-s[1]),a=r/2*(s[0]-t[0]+t[2]-s[2]);this.setCenterInternal([n[0]+o,n[1]-a])}}getUpdatedOptions_(e){const t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let n=0;n<t.length;++n){let s=arguments[n];s.center&&(s=Object.assign({},s),s.center=je(s.center,this.getProjection())),s.anchor&&(s=Object.assign({},s),s.anchor=je(s.anchor,this.getProjection())),t[n]=s}this.animateInternal.apply(this,t)}animateInternal(e){let t=arguments.length,n;t>1&&typeof arguments[t-1]=="function"&&(n=arguments[t-1],--t);let s=0;for(;s<t&&!this.isDef();++s){const c=arguments[s];c.center&&this.setCenterInternal(c.center),c.zoom!==void 0?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),c.rotation!==void 0&&this.setRotation(c.rotation)}if(s===t){n&&gl(n,!0);return}let r=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;s<t;++s){const c=arguments[s],u={start:r,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||J2,callback:n};if(c.center&&(u.sourceCenter=o,u.targetCenter=c.center.slice(),o=u.targetCenter),c.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(c.zoom),a=u.targetResolution):c.resolution&&(u.sourceResolution=a,u.targetResolution=c.resolution,a=u.targetResolution),c.rotation!==void 0){u.sourceRotation=l;const d=Os(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}sR(u)?u.complete=!0:r+=u.duration,h.push(u)}this.animations_.push(h),this.setHint(Ye.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[Ye.ANIMATING]>0}getInteracting(){return this.hints_[Ye.INTERACTING]>0}cancelAnimations(){this.setHint(Ye.ANIMATING,-this.hints_[Ye.ANIMATING]);let e;for(let t=0,n=this.animations_.length;t<n;++t){const s=this.animations_[t];if(s[0].callback&&gl(s[0].callback,!1),!e)for(let r=0,o=s.length;r<o;++r){const a=s[r];if(!a.complete){e=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let n=this.animations_.length-1;n>=0;--n){const s=this.animations_[n];let r=!0;for(let o=0,a=s.length;o<a;++o){const l=s[o];if(l.complete)continue;const h=e-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):r=!1;const u=l.easing(c);if(l.sourceCenter){const d=l.sourceCenter[0],f=l.sourceCenter[1],g=l.targetCenter[0],p=l.targetCenter[1];this.nextCenter_=l.targetCenter;const m=d+u*(g-d),_=f+u*(p-f);this.targetCenter_=[m,_]}if(l.sourceResolution&&l.targetResolution){const d=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const f=this.getViewportSize_(this.getRotation()),g=this.constraints_.resolution(d,0,f,!0);this.targetCenter_=this.calculateCenterZoom(g,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const d=u===1?Os(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const f=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(f,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),t=!0,!l.complete)break}if(r){this.animations_[n]=null,this.setHint(Ye.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=s[0].callback;o&&gl(o,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let n;const s=this.getCenterInternal();return s!==void 0&&(n=[s[0]-t[0],s[1]-t[1]],Ld(n,e-this.getRotation()),UE(n,t)),n}calculateCenterZoom(e,t){let n;const s=this.getCenterInternal(),r=this.getResolution();if(s!==void 0&&r!==void 0){const o=t[0]-e*(t[0]-s[0])/r,a=t[1]-e*(t[1]-s[1])/r;n=[o,a]}return n}getViewportSize_(e){const t=this.viewportSize_;if(e){const n=t[0],s=t[1];return[Math.abs(n*Math.cos(e))+Math.abs(s*Math.sin(e)),Math.abs(n*Math.sin(e))+Math.abs(s*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&Us(e,this.getProjection())}getCenterInternal(){return this.get(Gi.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return Jh(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();_e(t,"The view center is not defined");const n=this.getResolution();_e(n!==void 0,"The view resolution is not defined");const s=this.getRotation();return _e(s!==void 0,"The view rotation is not defined"),Jo(t,n,s,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(Gi.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(ln(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const n=Re(e)/t[0],s=_t(e)/t[1];return Math.max(n,s)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,s=Math.log(t/n)/Math.log(e);return function(r){return t/Math.pow(e,r*s)}}getRotation(){return this.get(Gi.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),n=this.getConstrainedResolution(this.maxResolution_),s=this.minResolution_,r=Math.log(n/s)/t;return function(o){return Math.log(n/o)/t/r}}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const n=this.padding_;return n&&(t=[t[0]-n[1]-n[3],t[1]-n[0]-n[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),n=this.getRotation();let s=this.getCenterInternal();const r=this.padding_;if(r){const o=this.getViewportSizeMinusPadding_();s=Nc(s,this.getViewportSize_(),[o[0]/2+r[3],o[1]/2+r[0]],t,n)}return{center:s.slice(0),projection:e!==void 0?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return t!==void 0&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t=this.minZoom_||0,n,s;if(this.resolutions_){const r=ec(this.resolutions_,e,1);t=r,n=this.resolutions_[r],r==this.resolutions_.length-1?s=2:s=n/this.resolutions_[r+1]}else n=this.maxResolution_,s=this.zoomFactor_;return t+Math.log(n/e)/Math.log(s)}getResolutionForZoom(e){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const t=et(Math.floor(e),0,this.resolutions_.length-2),n=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(n,et(e-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let n;if(_e(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(e)){_e(!Ys(e),"Cannot fit empty extent provided as `geometry`");const s=ln(e,this.getProjection());n=lp(s)}else if(e.getType()==="Circle"){const s=ln(e.getExtent(),this.getProjection());n=lp(s),n.rotate(this.getRotation(),pi(s))}else n=e;this.fitInternal(n,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),n=Math.cos(t),s=Math.sin(-t),r=e.getFlatCoordinates(),o=e.getStride();let a=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,d=r.length;u<d;u+=o){const f=r[u]*n-r[u+1]*s,g=r[u]*s+r[u+1]*n;a=Math.min(a,f),l=Math.min(l,g),h=Math.max(h,f),c=Math.max(c,g)}return[a,l,h,c]}fitInternal(e,t){t=t||{};let n=t.size;n||(n=this.getViewportSizeMinusPadding_());const s=t.padding!==void 0?t.padding:[0,0,0,0],r=t.nearest!==void 0?t.nearest:!1;let o;t.minResolution!==void 0?o=t.minResolution:t.maxZoom!==void 0?o=this.getResolutionForZoom(t.maxZoom):o=0;const a=this.rotatedExtentForGeometry(e);let l=this.getResolutionForExtentInternal(a,[n[0]-s[1]-s[3],n[1]-s[0]-s[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,r?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),d=pi(a);d[0]+=(s[1]-s[3])/2*l,d[1]+=(s[0]-s[2])/2*l;const f=d[0]*u-d[1]*c,g=d[1]*u+d[0]*c,p=this.getConstrainedCenter([f,g],l),m=t.callback?t.callback:lo;t.duration!==void 0?this.animateInternal({resolution:l,center:p,duration:t.duration,easing:t.easing},m):(this.targetResolution_=l,this.targetCenter_=p,this.applyTargetState_(!1,!0),gl(m,!0))}centerOn(e,t,n){this.centerOnInternal(je(e,this.getProjection()),t,n)}centerOnInternal(e,t,n){this.setCenterInternal(Nc(e,t,n,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,n,s){let r;const o=this.padding_;if(o&&e){const a=this.getViewportSizeMinusPadding_(-n),l=Nc(e,s,[a[0]/2+o[3],a[1]/2+o[0]],t,n);r=[e[0]-l[0],e[1]-l[1]]}return r}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const t=Us(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&je(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const n=this.getAnimating()||this.getInteracting(),s=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*e,0,s,n);t&&(this.targetCenter_=this.calculateCenterZoom(r,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=je(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const n=this.getAnimating()||this.getInteracting(),s=this.constraints_.rotation(this.targetRotation_+e,n);t&&(this.targetCenter_=this.calculateCenterRotate(s,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&je(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const n=this.getAnimating()||this.getInteracting()||t,s=this.constraints_.rotation(this.targetRotation_,n),r=this.getViewportSize_(s),o=this.constraints_.resolution(this.targetResolution_,0,r,n),a=this.constraints_.center(this.targetCenter_,o,r,n,this.calculateCenterShift(this.targetCenter_,o,s,r));this.get(Gi.ROTATION)!==s&&this.set(Gi.ROTATION,s),this.get(Gi.RESOLUTION)!==o&&(this.set(Gi.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(Gi.CENTER)||!Bi(this.get(Gi.CENTER),a))&&this.set(Gi.CENTER,a),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,n){e=e!==void 0?e:200;const s=t||0,r=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(r),a=this.constraints_.resolution(this.targetResolution_,s,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,r,o));if(e===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=r,this.targetCenter_=l,this.applyTargetState_();return}n=n||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==r||!this.getCenterInternal()||!Bi(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:l,resolution:a,duration:e,easing:fs,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(Ye.INTERACTING,1)}endInteraction(e,t,n){n=n&&je(n,this.getProjection()),this.endInteractionInternal(e,t,n)}endInteractionInternal(e,t,n){this.getInteracting()&&(this.setHint(Ye.INTERACTING,-1),this.resolveConstraints(e,t,n))}getConstrainedCenter(e,t){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),n)}getConstrainedZoom(e,t){const n=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(n,t))}getConstrainedResolution(e,t){t=t||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,n)}}function gl(i,e){setTimeout(function(){i(e)},0)}function tR(i){if(i.extent!==void 0){const t=i.smoothExtentConstraint!==void 0?i.smoothExtentConstraint:!0;return Kp(i.extent,i.constrainOnlyCenter,t)}const e=Fd(i.projection,"EPSG:3857");if(i.multiWorld!==!0&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,Kp(t,!1,!1)}return X2}function iR(i){let e,t,n,o=i.minZoom!==void 0?i.minZoom:Oc,a=i.maxZoom!==void 0?i.maxZoom:28;const l=i.zoomFactor!==void 0?i.zoomFactor:2,h=i.multiWorld!==void 0?i.multiWorld:!1,c=i.smoothResolutionConstraint!==void 0?i.smoothResolutionConstraint:!0,u=i.showFullExtent!==void 0?i.showFullExtent:!1,d=Fd(i.projection,"EPSG:3857"),f=d.getExtent();let g=i.constrainOnlyCenter,p=i.extent;if(!h&&!p&&d.isGlobal()&&(g=!1,p=f),i.resolutions!==void 0){const m=i.resolutions;t=m[o],n=m[a]!==void 0?m[a]:m[m.length-1],i.constrainResolution?e=Y2(m,c,!g&&p,u):e=Jp(t,n,c,!g&&p,u)}else{const _=(f?Math.max(Re(f),_t(f)):360*Bs.degrees/d.getMetersPerUnit())/Rf/Math.pow(2,Oc),y=_/Math.pow(2,28-Oc);t=i.maxResolution,t!==void 0?o=0:t=_/Math.pow(l,o),n=i.minResolution,n===void 0&&(i.maxZoom!==void 0?i.maxResolution!==void 0?n=t/Math.pow(l,a):n=_/Math.pow(l,a):n=y),a=o+Math.floor(Math.log(t/n)/Math.log(l)),n=t/Math.pow(l,a-o),i.constrainResolution?e=H2(l,t,n,c,!g&&p,u):e=Jp(t,n,c,!g&&p,u)}return{constraint:e,maxResolution:t,minResolution:n,minZoom:o,zoomFactor:l}}function nR(i){if(i.enableRotation!==void 0?i.enableRotation:!0){const t=i.constrainRotation;return t===void 0||t===!0?K2():t===!1?Qp:typeof t=="number"?Z2(t):Qp}return Pf}function sR(i){return!(i.sourceCenter&&i.targetCenter&&!Bi(i.sourceCenter,i.targetCenter)||i.sourceResolution!==i.targetResolution||i.sourceRotation!==i.targetRotation)}function Nc(i,e,t,n,s){const r=Math.cos(-s);let o=Math.sin(-s),a=i[0]*r-i[1]*o,l=i[1]*r+i[0]*o;a+=(e[0]/2-t[0])*n,l+=(t[1]-e[1]/2)*n,o=-o;const h=a*r-l*o,c=l*r+a*o;return[h,c]}const Ui=eR;class rR extends Hy{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(Ue.SOURCE,this.handleSourcePropertyChange_);const n=e.source?e.source:null;this.setSource(n)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(Ue.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(qe(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=ye(e,ee.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let t;const n=this.getMapInternal();!e&&n&&(e=n.getView()),e instanceof Ui?t={viewState:e.getState(),extent:e.calculateExtent()}:t=e,!t.layerStatesArray&&n&&(t.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let s;t.layerStatesArray?s=t.layerStatesArray.find(o=>o.layer===this):s=this.getLayerState();const r=this.getExtent();return Af(s,t.viewState)&&(!r||Qe(r,t.extent))}getAttributions(e){if(!this.isVisible(e))return[];let t;const n=this.getSource();if(n&&(t=n.getAttributions()),!t)return[];const s=e instanceof Ui?e.getViewStateAndExtent():e;let r=t(s);return Array.isArray(r)||(r=[r]),r}render(e,t){const n=this.getRenderer();return n.prepareFrame(e)?(this.rendered=!0,n.renderFrame(e,t)):null}unrender(){this.rendered=!1}setMapInternal(e){e||this.unrender(),this.set(Ue.MAP,e)}getMapInternal(){return this.get(Ue.MAP)}setMap(e){this.mapPrecomposeKey_&&(qe(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(qe(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=ye(e,dn.PRECOMPOSE,function(t){const s=t.frameState.layerStatesArray,r=this.getLayerState(!1);_e(!s.some(function(o){return o.layer===r.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),s.push(r)},this),this.mapRenderKey_=ye(this,ee.CHANGE,e.render,e),this.changed())}setSource(e){this.set(Ue.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function Af(i,e){if(!i.visible)return!1;const t=e.resolution;if(t<i.minResolution||t>=i.maxResolution)return!1;const n=e.zoom;return n>i.minZoom&&n<=i.maxZoom}const vo=rR;class oR extends Dd{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){ie()}calculateMatrices2D(e){const t=e.viewState,n=e.coordinateToPixelTransform,s=e.pixelToCoordinateTransform;Hi(n,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),nc(s,n)}forEachFeatureAtCoordinate(e,t,n,s,r,o,a,l){let h;const c=t.viewState;function u(w,b,E,M){return r.call(o,b,w?E:null,M)}const d=c.projection,f=Pd(e.slice(),d),g=[[0,0]];if(d.canWrapX()&&s){const w=d.getExtent(),b=Re(w);g.push([-b,0],[b,0])}const p=t.layerStatesArray,m=p.length,_=[],y=[];for(let w=0;w<g.length;w++)for(let b=m-1;b>=0;--b){const E=p[b],M=E.layer;if(M.hasRenderer()&&Af(E,c)&&a.call(l,M)){const C=M.getRenderer(),R=M.getSource();if(C&&R){const N=R.getWrapX()?f:e,D=u.bind(null,E.managed);y[0]=N[0]+g[w][0],y[1]=N[1]+g[w][1],h=C.forEachFeatureAtCoordinate(y,t,n,D,_)}if(h)return h}}if(_.length===0)return;const x=1/_.length;return _.forEach((w,b)=>w.distanceSq+=b*x),_.sort((w,b)=>w.distanceSq-b.distanceSq),_.some(w=>h=w.callback(w.feature,w.layer,w.geometry)),h}hasFeatureAtCoordinate(e,t,n,s,r,o){return this.forEachFeatureAtCoordinate(e,t,n,s,js,this,r,o)!==void 0}getMap(){return this.map_}renderFrame(e){ie()}flushDeclutterItems(e){}scheduleExpireIconCache(e){rh.canExpireCache()&&e.postRenderFunctions.push(aR)}}function aR(i,e){rh.expire()}const lR=oR;class hR extends xi{constructor(e,t,n,s){super(e),this.inversePixelTransform=t,this.frameState=n,this.context=s}}const Jy=hR;class cR extends lR{constructor(e){super(e),this.fontChangeListenerKey_=ye(tn,ao.PROPERTYCHANGE,e.redrawText.bind(e)),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=lc+" ol-layers";const n=e.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0,this.declutterLayers_=[]}dispatchRenderEvent(e,t){const n=this.getMap();if(n.hasListener(e)){const s=new Jy(e,void 0,t);n.dispatchEvent(s)}}disposeInternal(){qe(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(dn.PRECOMPOSE,e);const t=e.layerStatesArray.sort(function(o,a){return o.zIndex-a.zIndex}),n=e.viewState;this.children_.length=0;const s=this.declutterLayers_;s.length=0;let r=null;for(let o=0,a=t.length;o<a;++o){const l=t[o];e.layerIndex=o;const h=l.layer,c=h.getSourceState();if(!Af(l,n)||c!="ready"&&c!="undefined"){h.unrender();continue}const u=h.render(e,r);u&&(u!==r&&(this.children_.push(u),r=u),"getDeclutter"in h&&s.push(h))}this.flushDeclutterItems(e),UC(this.element_,this.children_),this.dispatchRenderEvent(dn.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}flushDeclutterItems(e){const t=this.declutterLayers_;for(let n=t.length-1;n>=0;--n)t[n].renderDeclutter(e);t.length=0}}const uR=cR;class Vn extends xi{constructor(e,t){super(e),this.layer=t}}const Dc={LAYERS:"layers"};class Ff extends Hy{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let n=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Dc.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new Xt(n.slice(),{unique:!0}):_e(typeof n.getArray=="function","Expected `layers` to be an array or a `Collection`"):n=new Xt(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(qe),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(ye(e,bt.ADD,this.handleLayersAdd_,this),ye(e,bt.REMOVE,this.handleLayersRemove_,this));for(const n in this.listenerKeys_)this.listenerKeys_[n].forEach(qe);Pa(this.listenerKeys_);const t=e.getArray();for(let n=0,s=t.length;n<s;n++){const r=t[n];this.registerLayerListeners_(r),this.dispatchEvent(new Vn("addlayer",r))}this.changed()}registerLayerListeners_(e){const t=[ye(e,ao.PROPERTYCHANGE,this.handleLayerChange_,this),ye(e,ee.CHANGE,this.handleLayerChange_,this)];e instanceof Ff&&t.push(ye(e,"addlayer",this.handleLayerGroupAdd_,this),ye(e,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[H(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new Vn("addlayer",e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new Vn("removelayer",e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new Vn("addlayer",t)),this.changed()}handleLayersRemove_(e){const t=e.element,n=H(t);this.listenerKeys_[n].forEach(qe),delete this.listenerKeys_[n],this.dispatchEvent(new Vn("removelayer",t)),this.changed()}getLayers(){return this.get(Dc.LAYERS)}setLayers(e){const t=this.getLayers();if(t){const n=t.getArray();for(let s=0,r=n.length;s<r;++s)this.dispatchEvent(new Vn("removelayer",n[s]))}this.set(Dc.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const t=e!==void 0?e:[],n=t.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(t)});const s=this.getLayerState();let r=s.zIndex;!e&&s.zIndex===void 0&&(r=0);for(let o=n,a=t.length;o<a;o++){const l=t[o];l.opacity*=s.opacity,l.visible=l.visible&&s.visible,l.maxResolution=Math.min(l.maxResolution,s.maxResolution),l.minResolution=Math.max(l.minResolution,s.minResolution),l.minZoom=Math.max(l.minZoom,s.minZoom),l.maxZoom=Math.min(l.maxZoom,s.maxZoom),s.extent!==void 0&&(l.extent!==void 0?l.extent=Tn(l.extent,s.extent):l.extent=s.extent),l.zIndex===void 0&&(l.zIndex=r)}return t}getSourceState(){return"ready"}}const uc=Ff;class dR extends xi{constructor(e,t,n){super(e),this.map=t,this.frameState=n!==void 0?n:null}}const fr=dR;class fR extends fr{constructor(e,t,n,s,r,o){super(e,t,r),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=s!==void 0?s:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const Cn=fR,Se={SINGLECLICK:"singleclick",CLICK:ee.CLICK,DBLCLICK:ee.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Zu={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class gR extends Da{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;const n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=ye(n,Zu.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=ye(n,Zu.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(ee.TOUCHMOVE,this.boundHandleTouchMove_,Y0?{passive:!1}:!1)}emulateClick_(e){let t=new Cn(Se.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new Cn(Se.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const n=new Cn(Se.SINGLECLICK,this.map_,e);this.dispatchEvent(n)},250)}updateActivePointers_(e){const t=e,n=t.pointerId;if(t.type==Se.POINTERUP||t.type==Se.POINTERCANCEL){delete this.trackedTouches_[n];for(const s in this.trackedTouches_)if(this.trackedTouches_[s].target!==t.target){delete this.trackedTouches_[s];break}}else(t.type==Se.POINTERDOWN||t.type==Se.POINTERMOVE)&&(this.trackedTouches_[n]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new Cn(Se.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(qe),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new Cn(Se.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const n=this.map_.getOwnerDocument();this.dragListenerKeys_.push(ye(n,Se.POINTERMOVE,this.handlePointerMove_,this),ye(n,Se.POINTERUP,this.handlePointerUp_,this),ye(this.element_,Se.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==n&&this.dragListenerKeys_.push(ye(this.element_.getRootNode(),Se.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new Cn(Se.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new Cn(Se.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(qe(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(ee.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(qe(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(qe),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const pR=gR,Wn={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},Ot={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},fh=1/0;class mR{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Pa(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,n=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const s=this.keyFunction_(n);return delete this.queuedElements_[s],n}enqueue(e){_e(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const t=this.priorityFunction_(e);return t!=fh?(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,n=this.priorities_,s=t.length,r=t[e],o=n[e],a=e;for(;e<s>>1;){const l=this.getLeftChildIndex_(e),h=this.getRightChildIndex_(e),c=h<s&&n[h]<n[l]?h:l;t[e]=t[c],n[e]=n[c],e=c}t[e]=r,n[e]=o,this.siftDown_(a,e)}siftDown_(e,t){const n=this.elements_,s=this.priorities_,r=n[t],o=s[t];for(;t>e;){const a=this.getParentIndex_(t);if(s[a]>o)n[t]=n[a],s[t]=s[a],t=a;else break}n[t]=r,s[t]=o}reprioritize(){const e=this.priorityFunction_,t=this.elements_,n=this.priorities_;let s=0;const r=t.length;let o,a,l;for(a=0;a<r;++a)o=t[a],l=e(o),l==fh?delete this.queuedElements_[this.keyFunction_(o)]:(n[s]=l,t[s++]=o);t.length=s,n.length=s,this.heapify_()}}const yR=mR,$={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class _R extends yR{constructor(e,t){super(function(n){return e.apply(null,n)},function(n){return n[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(ee.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,n=t.getState();if(n===$.LOADED||n===$.ERROR||n===$.EMPTY){n!==$.ERROR&&t.removeEventListener(ee.CHANGE,this.boundHandleTileChange_);const s=t.getKey();s in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[s],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let n=0,s,r,o;for(;this.tilesLoading_<e&&n<t&&this.getCount()>0;)r=this.dequeue()[0],o=r.getKey(),s=r.getState(),s===$.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++n,r.load())}}const vR=_R;function xR(i,e,t,n,s){if(!i||!(t in i.wantedTiles)||!i.wantedTiles[t][e.getKey()])return fh;const r=i.viewState.center,o=n[0]-r[0],a=n[1]-r[1];return 65536*Math.log(s)+Math.sqrt(o*o+a*a)/s}class wR extends _n{constructor(e){super();const t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){Uu(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&Uu(this.element);for(let t=0,n=this.listenerKeys.length;t<n;++t)qe(this.listenerKeys[t]);this.listenerKeys.length=0,this.map_=e,e&&((this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==lo&&this.listenerKeys.push(ye(e,Wn.POSTRENDER,this.render,this)),e.render())}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}}const kf=wR;class bR extends kf{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const t=e.className!==void 0?e.className:"ol-attribution",n=e.tipLabel!==void 0?e.tipLabel:"Attributions",s=e.expandClassName!==void 0?e.expandClassName:t+"-expand",r=e.collapseLabel!==void 0?e.collapseLabel:"",o=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof r=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=o):this.collapseLabel_=r;const a=e.label!==void 0?e.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=s):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(ee.CLICK,this.handleClick_.bind(this),!1);const h=t+" "+lc+" "+ff+(this.collapsed_&&this.collapsible_?" "+_p:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=h,c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=Array.from(new Set(this.getMap().getAllLayers().flatMap(s=>s.getAttributions(e)))),n=!this.getMap().getAllLayers().some(s=>s.getSource()&&s.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(n),t}updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=this.collectSourceAttributions_(e),n=t.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!Dn(t,this.renderedAttributions_)){$C(this.ulElement_);for(let s=0,r=t.length;s<r;++s){const o=document.createElement("li");o.innerHTML=t[s],this.ulElement_.appendChild(o)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(_p),this.collapsed_?pp(this.collapseLabel_,this.label_):pp(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}const ER=bR;class MR extends kf{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=e.className!==void 0?e.className:"ol-rotate",n=e.label!==void 0?e.label:"",s=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof n=="string"?(this.label_=document.createElement("span"),this.label_.className=s,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(s));const r=e.tipLabel?e.tipLabel:"Reset rotation",o=document.createElement("button");o.className=t+"-reset",o.setAttribute("type","button"),o.title=r,o.appendChild(this.label_),o.addEventListener(ee.CLICK,this.handleClick_.bind(this),!1);const a=t+" "+lc+" "+ff,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(al)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const n=t.getRotation();n!==void 0&&(this.duration_>0&&n%(2*Math.PI)!==0?t.animate({rotation:0,duration:this.duration_,easing:fs}):t.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const n=t.viewState.rotation;if(n!=this.rotation_){const s="rotate("+n+"rad)";if(this.autoHide_){const r=this.element.classList.contains(al);!r&&n===0?this.element.classList.add(al):r&&n!==0&&this.element.classList.remove(al)}this.label_.style.transform=s}this.rotation_=n}}const CR=MR;class SR extends kf{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=e.className!==void 0?e.className:"ol-zoom",n=e.delta!==void 0?e.delta:1,s=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",r=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",o=e.zoomInLabel!==void 0?e.zoomInLabel:"+",a=e.zoomOutLabel!==void 0?e.zoomOutLabel:"",l=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",h=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=s,c.setAttribute("type","button"),c.title=l,c.appendChild(typeof o=="string"?document.createTextNode(o):o),c.addEventListener(ee.CLICK,this.handleClick_.bind(this,n),!1);const u=document.createElement("button");u.className=r,u.setAttribute("type","button"),u.title=h,u.appendChild(typeof a=="string"?document.createTextNode(a):a),u.addEventListener(ee.CLICK,this.handleClick_.bind(this,-n),!1);const d=t+" "+lc+" "+ff,f=this.element;f.className=d,f.appendChild(c),f.appendChild(u),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const n=this.getMap().getView();if(!n)return;const s=n.getZoom();if(s!==void 0){const r=n.getConstrainedZoom(s+e);this.duration_>0?(n.getAnimating()&&n.cancelAnimations(),n.animate({zoom:r,duration:this.duration_,easing:fs})):n.setZoom(r)}}}const TR=SR;function RR(i){i=i||{};const e=new Xt;return(i.zoom!==void 0?i.zoom:!0)&&e.push(new TR(i.zoomOptions)),(i.rotate!==void 0?i.rotate:!0)&&e.push(new CR(i.rotateOptions)),(i.attribution!==void 0?i.attribution:!0)&&e.push(new ER(i.attributionOptions)),e}const Ku={ACTIVE:"active"};class IR extends _n{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Ku.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(Ku.ACTIVE,e)}setMap(e){this.map_=e}}function LR(i,e,t){const n=i.getCenterInternal();if(n){const s=[n[0]+e[0],n[1]+e[1]];i.animateInternal({duration:t!==void 0?t:250,easing:Q2,center:i.getConstrainedCenter(s)})}}function Of(i,e,t,n){const s=i.getZoom();if(s===void 0)return;const r=i.getConstrainedZoom(s+e),o=i.getResolutionForZoom(r);i.getAnimating()&&i.cancelAnimations(),i.animate({resolution:o,anchor:t,duration:n!==void 0?n:250,easing:fs})}const Ua=IR;class PR extends Ua{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==Se.DBLCLICK){const n=e.originalEvent,s=e.map,r=e.coordinate,o=n.shiftKey?-this.delta_:this.delta_,a=s.getView();Of(a,o,r,this.duration_),n.preventDefault(),t=!0}return!t}}const AR=PR;class FR extends Ua{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==Se.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==Se.POINTERUP){const n=this.handleUpEvent(e);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(e.type==Se.POINTERDOWN){const n=this.handleDownEvent(e);this.handlingDownUpSequence=n,t=this.stopDown(n)}else e.type==Se.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function Nf(i){const e=i.length;let t=0,n=0;for(let s=0;s<e;s++)t+=i[s].clientX,n+=i[s].clientY;return{clientX:t/e,clientY:n/e}}const ms=FR;function Ju(i){const e=arguments;return function(t){let n=!0;for(let s=0,r=e.length;s<r&&(n=n&&e[s](t),!!n);++s);return n}}const kR=function(i){const e=i.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},OR=function(i){const e=i.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},NR=function(i){const e=i.map.getTargetElement(),t=i.map.getOwnerDocument().activeElement;return e.contains(t)},Qy=function(i){return i.map.getTargetElement().hasAttribute("tabindex")?NR(i):!0},gh=js,e_=function(i){const e=i.originalEvent;return e.button==0&&!(FM&&zd&&e.ctrlKey)},DR=Hs,GR=function(i){return i.type==Se.SINGLECLICK},Df=function(i){const e=i.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},zR=function(i){const e=i.originalEvent;return!e.altKey&&(zd?e.metaKey:e.ctrlKey)&&!e.shiftKey},BR=function(i){const e=i.originalEvent;return zd?e.metaKey:e.ctrlKey},t_=function(i){const e=i.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},i_=function(i){const e=i.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!e.target.isContentEditable},Gc=function(i){const e=i.originalEvent;return _e(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.pointerType=="mouse"},n_=function(i){const e=i.originalEvent;return _e(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.isPrimary&&e.button===0};class $R extends ms{constructor(e){super({stopDown:Hs}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:Ju(Df,n_);this.condition_=e.onFocusOnly?Ju(Qy,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const n=this.targetPointers,s=t.getEventPixel(Nf(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(s[0],s[1]),this.lastCentroid){const r=[this.lastCentroid[0]-s[0],s[1]-this.lastCentroid[1]],a=e.map.getView();jE(r,a.getResolution()),Ld(r,a.getRotation()),a.adjustCenterInternal(r)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=s,this.lastPointersCount_=n.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,n=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const s=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),o=n.getCenterInternal(),a=t.getPixelFromCoordinateInternal(o),l=t.getCoordinateFromPixelInternal([a[0]-s*Math.cos(r),a[1]-s*Math.sin(r)]);n.animateInternal({center:n.getConstrainedCenter(l),duration:500,easing:fs})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const n=e.map.getView();return this.lastCentroid=null,n.getAnimating()&&n.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}const UR=$R;class qR extends ms{constructor(e){e=e||{},super({stopDown:Hs}),this.condition_=e.condition?e.condition:OR,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!Gc(e))return;const t=e.map,n=t.getView();if(n.getConstraints().rotation===Pf)return;const s=t.getSize(),r=e.pixel,o=Math.atan2(s[1]/2-r[1],r[0]-s[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;n.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(e){return Gc(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return Gc(e)&&e_(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}const jR=qR;class WR extends Dd{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,n="px",s=this.element_.style;s.left=Math.min(e[0],t[0])+n,s.top=Math.min(e[1],t[1])+n,s.width=Math.abs(t[0]-e[0])+n,s.height=Math.abs(t[1]-e[1])+n}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const e=this.startPixel_,t=this.endPixel_,s=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);s[4]=s[0].slice(),this.geometry_?this.geometry_.setCoordinates([s]):this.geometry_=new Zi([s])}getGeometry(){return this.geometry_}}const VR=WR,pl={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class zc extends xi{constructor(e,t,n){super(e),this.coordinate=t,this.mapBrowserEvent=n}}class XR extends ms{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.box_=new VR(e.className||"ol-dragbox"),this.minArea_=e.minArea!==void 0?e.minArea:64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition?e.condition:e_,this.boxEndCondition_=e.boxEndCondition?e.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,n){const s=n[0]-t[0],r=n[1]-t[1];return s*s+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new zc(pl.BOXDRAG,e.coordinate,e))}handleUpEvent(e){this.box_.setMap(null);const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new zc(t?pl.BOXEND:pl.BOXCANCEL,e.coordinate,e)),!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new zc(pl.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}}const s_=XR;class YR extends s_{constructor(e){e=e||{};const t=e.condition?e.condition:t_;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const n=this.getMap().getView();let s=this.getGeometry();if(this.out_){const r=n.rotatedExtentForGeometry(s),o=n.getResolutionForExtentInternal(r),a=n.getResolution()/o;s=s.clone(),s.scale(a*a)}n.fitInternal(s,{duration:this.duration_,easing:fs})}}const HR=YR,bs={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class ZR extends Ua{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return Df(t)&&i_(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==ee.KEYDOWN){const n=e.originalEvent,s=n.key;if(this.condition_(e)&&(s==bs.DOWN||s==bs.LEFT||s==bs.RIGHT||s==bs.UP)){const o=e.map.getView(),a=o.getResolution()*this.pixelDelta_;let l=0,h=0;s==bs.DOWN?h=-a:s==bs.LEFT?l=-a:s==bs.RIGHT?l=a:h=a;const c=[l,h];Ld(c,o.getRotation()),LR(o,c,this.duration_),n.preventDefault(),t=!0}}return!t}}const KR=ZR;class JR extends Ua{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(t){return!BR(t)&&i_(t)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==ee.KEYDOWN||e.type==ee.KEYPRESS){const n=e.originalEvent,s=n.key;if(this.condition_(e)&&(s==="+"||s==="-")){const r=e.map,o=s==="+"?this.delta_:-this.delta_,a=r.getView();Of(a,o,void 0,this.duration_),n.preventDefault(),t=!0}}return!t}}const QR=JR;class eI{constructor(e,t,n){this.decay_=e,this.minVelocity_=t,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let n=t-3;for(;n>0&&this.points_[n+2]>e;)n-=3;const s=this.points_[t+2]-this.points_[n+2];if(s<1e3/60)return!1;const r=this.points_[t]-this.points_[n],o=this.points_[t+1]-this.points_[n+1];return this.angle_=Math.atan2(o,r),this.initialVelocity_=Math.sqrt(r*r+o*o)/s,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const tI=eI;class iI extends Ua{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const t=e.condition?e.condition:gh;this.condition_=e.onFocusOnly?Ju(Qy,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();if(!e)return;e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(e){if(!this.condition_(e)||e.type!==ee.WHEEL)return!0;const n=e.map,s=e.originalEvent;s.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.coordinate);let r;if(e.type==ee.WHEEL&&(r=s.deltaY,PM&&s.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(r/=Bd),s.deltaMode===WheelEvent.DOM_DELTA_LINE&&(r*=40)),r===0)return!1;this.lastDelta_=r;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?"trackpad":"wheel");const a=n.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=o,!1;this.totalDelta_+=r;const l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),l),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let n=-et(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),Of(t,n,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}const nI=iI;class sI extends ms{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=Hs),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0;const n=this.targetPointers[0],s=this.targetPointers[1],r=Math.atan2(s.clientY-n.clientY,s.clientX-n.clientX);if(this.lastAngle_!==void 0){const l=r-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=l}this.lastAngle_=r;const o=e.map,a=o.getView();a.getConstraints().rotation!==Pf&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(Nf(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}const rI=sI;class oI extends ms{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=Hs),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const n=this.targetPointers[0],s=this.targetPointers[1],r=n.clientX-s.clientX,o=n.clientY-s.clientY,a=Math.sqrt(r*r+o*o);this.lastDistance_!==void 0&&(t=this.lastDistance_/a),this.lastDistance_=a;const l=e.map,h=l.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(Nf(this.targetPointers))),l.render(),h.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const n=e.map.getView(),s=this.lastScaleDelta_>1?1:-1;return n.endInteraction(this.duration_,s),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}const aI=oI;function lI(i){i=i||{};const e=new Xt,t=new tI(-.005,.05,100);return(i.altShiftDragRotate!==void 0?i.altShiftDragRotate:!0)&&e.push(new jR),(i.doubleClickZoom!==void 0?i.doubleClickZoom:!0)&&e.push(new AR({delta:i.zoomDelta,duration:i.zoomDuration})),(i.dragPan!==void 0?i.dragPan:!0)&&e.push(new UR({onFocusOnly:i.onFocusOnly,kinetic:t})),(i.pinchRotate!==void 0?i.pinchRotate:!0)&&e.push(new rI),(i.pinchZoom!==void 0?i.pinchZoom:!0)&&e.push(new aI({duration:i.zoomDuration})),(i.keyboard!==void 0?i.keyboard:!0)&&(e.push(new KR),e.push(new QR({delta:i.zoomDelta,duration:i.zoomDuration}))),(i.mouseWheelZoom!==void 0?i.mouseWheelZoom:!0)&&e.push(new nI({onFocusOnly:i.onFocusOnly,duration:i.zoomDuration})),(i.shiftDragZoom!==void 0?i.shiftDragZoom:!0)&&e.push(new HR({duration:i.zoomDuration})),e}function r_(i){if(i instanceof vo){i.setMapInternal(null);return}i instanceof uc&&i.getLayers().forEach(r_)}function o_(i,e){if(i instanceof vo){i.setMapInternal(e);return}if(i instanceof uc){const t=i.getLayers().getArray();for(let n=0,s=t.length;n<s;++n)o_(t[n],e)}}let hI=class extends _n{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=cI(e);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:Bd,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=mi(),this.pixelToCoordinateTransform_=mi(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=t.controls||RR(),this.interactions=t.interactions||lI({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new vR(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Ot.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(Ot.VIEW,this.handleViewChanged_),this.addChangeListener(Ot.SIZE,this.handleSizeChanged_),this.addChangeListener(Ot.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const n=this;e.view&&!(e.view instanceof Ui)&&e.view.then(function(s){n.setView(new Ui(s))}),this.controls.addEventListener(bt.ADD,s=>{s.element.setMap(this)}),this.controls.addEventListener(bt.REMOVE,s=>{s.element.setMap(null)}),this.interactions.addEventListener(bt.ADD,s=>{s.element.setMap(this)}),this.interactions.addEventListener(bt.REMOVE,s=>{s.element.setMap(null)}),this.overlays_.addEventListener(bt.ADD,s=>{this.addOverlayInternal_(s.element)}),this.overlays_.addEventListener(bt.REMOVE,s=>{const r=s.element.getId();r!==void 0&&delete this.overlayIdIndex_[r.toString()],s.element.setMap(null)}),this.controls.forEach(s=>{s.setMap(this)}),this.interactions.forEach(s=>{s.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){o_(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,n){if(!this.frameState_||!this.renderer_)return;const s=this.getCoordinateFromPixelInternal(e);n=n!==void 0?n:{};const r=n.hitTolerance!==void 0?n.hitTolerance:0,o=n.layerFilter!==void 0?n.layerFilter:js,a=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(s,this.frameState_,r,a,t,null,o,null)}getFeaturesAtPixel(e,t){const n=[];return this.forEachFeatureAtPixel(e,function(s){n.push(s)},t),n}getAllLayers(){const e=[];function t(n){n.forEach(function(s){s instanceof uc?t(s.getLayers()):e.push(s)})}return t(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const n=this.getCoordinateFromPixelInternal(e);t=t!==void 0?t:{};const s=t.layerFilter!==void 0?t.layerFilter:js,r=t.hitTolerance!==void 0?t.hitTolerance:0,o=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,r,o,s,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const n=this.viewport_.getBoundingClientRect(),s=this.getSize(),r=n.width/s[0],o=n.height/s[1],a="changedTouches"in e?e.changedTouches[0]:e;return[(a.clientX-n.left)/r,(a.clientY-n.top)/o]}getTarget(){return this.get(Ot.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return Us(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?ot(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Ot.LAYERGROUP)}setLayers(e){const t=this.getLayerGroup();if(e instanceof Xt){t.setLayers(e);return}const n=t.getLayers();n.clear(),n.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,n=e.length;t<n;++t){const s=e[t];if(!s.visible)continue;const r=s.layer.getRenderer();if(r&&!r.ready)return!0;const o=s.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(e){const t=je(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?ot(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Ot.SIZE)}getView(){return this.get(Ot.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,n,s){return xR(this.frameState_,e,t,n,s)}handleBrowserEvent(e,t){t=t||e.type;const n=new Cn(t,this,e);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,n=t.type;if(n===Zu.POINTERDOWN||n===ee.WHEEL||n===ee.KEYDOWN){const s=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():s,o=t.target;if(this.overlayContainerStopEvent_.contains(o)||!(r===s?s.documentElement:r).contains(o))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){const s=this.getInteractions().getArray().slice();for(let r=s.length-1;r>=0;r--){const o=s[r];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let s=this.maxTilesLoading_,r=s;if(e){const o=e.viewHints;if(o[Ye.ANIMATING]||o[Ye.INTERACTING]){const a=Date.now()-e.time>8;s=a?0:8,r=a?0:2}}t.getTilesLoading()<s&&(t.reprioritize(),t.loadMoreTiles(s,r))}e&&this.renderer_&&!e.animate&&(this.renderComplete_===!0?(this.hasListener(dn.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(dn.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new fr(Wn.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new fr(Wn.LOADSTART,this,e))));const n=this.postRenderFunctions_;for(let s=0,r=n.length;s<r;++s)n[s](this,e);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let n=0,s=this.targetChangeHandlerKeys_.length;n<s;++n)qe(this.targetChangeHandlerKeys_[n]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(ee.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(ee.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,Uu(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const n=this.targetElement_.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.unobserve(n.host),this.setSize(void 0)}const e=this.getTarget(),t=typeof e=="string"?document.getElementById(e):e;if(this.targetElement_=t,!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new uR(this)),this.mapBrowserEventHandler_=new pR(this,this.moveTolerance_);for(const r in Se)this.mapBrowserEventHandler_.addEventListener(Se[r],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(ee.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(ee.WHEEL,this.boundHandleBrowserEvent_,Y0?{passive:!1}:!1);const n=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.targetChangeHandlerKeys_=[ye(n,ee.KEYDOWN,this.handleBrowserEvent,this),ye(n,ee.KEYPRESS,this.handleBrowserEvent,this)];const s=t.getRootNode();s instanceof ShadowRoot&&this.resizeObserver_.observe(s.host),this.resizeObserver_.observe(t)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(qe(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(qe(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=ye(e,ao.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=ye(e,ee.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(qe),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new Vn("addlayer",e)),this.layerGroupPropertyListenerKeys_=[ye(e,ao.PROPERTYCHANGE,this.render,this),ye(e,ee.CHANGE,this.render,this),ye(e,"addlayer",this.handleLayerAdd_,this),ye(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,n=e.length;t<n;++t){const s=e[t].layer;s.hasRenderer()&&s.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}flushDeclutterItems(){const e=this.frameState_;e&&this.renderer_.flushDeclutterItems(e)}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){r_(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),n=this.getView(),s=this.frameState_;let r=null;if(t!==void 0&&up(t)&&n&&n.isDef()){const o=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=n.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:Jo(a.center,a.resolution,a.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:H(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;r.nextExtent=Jo(a.nextCenter,a.nextResolution,l,t)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),s&&(!this.previousExtent_||!Ys(this.previousExtent_)&&!$s(r.extent,this.previousExtent_))&&(this.dispatchEvent(new fr(Wn.MOVESTART,this,s)),this.previousExtent_=po(this.previousExtent_)),this.previousExtent_&&!r.viewHints[Ye.ANIMATING]&&!r.viewHints[Ye.INTERACTING]&&!$s(r.extent,this.previousExtent_)&&(this.dispatchEvent(new fr(Wn.MOVEEND,this,r)),_0(r.extent,this.previousExtent_))),this.dispatchEvent(new fr(Wn.POSTRENDER,this,r)),this.renderComplete_=this.hasListener(Wn.LOADSTART)||this.hasListener(Wn.LOADEND)||this.hasListener(dn.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new Vn("removelayer",t)),this.set(Ot.LAYERGROUP,e)}setSize(e){this.set(Ot.SIZE,e)}setTarget(e){this.set(Ot.TARGET,e)}setView(e){if(!e||e instanceof Ui){this.set(Ot.VIEW,e);return}this.set(Ot.VIEW,new Ui);const t=this;e.then(function(n){t.setView(new Ui(n))})}updateSize(){const e=this.getTargetElement();let t;if(e){const s=getComputedStyle(e),r=e.offsetWidth-parseFloat(s.borderLeftWidth)-parseFloat(s.paddingLeft)-parseFloat(s.paddingRight)-parseFloat(s.borderRightWidth),o=e.offsetHeight-parseFloat(s.borderTopWidth)-parseFloat(s.paddingTop)-parseFloat(s.paddingBottom)-parseFloat(s.borderBottomWidth);!isNaN(r)&&!isNaN(o)&&(t=[r,o],!up(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&T0("No map visible because the map container's width or height are 0."))}const n=this.getSize();t&&(!n||!Dn(t,n))&&(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(e){const t=this.getView();t&&t.setViewportSize(e)}};function cI(i){let e=null;i.keyboardEventTarget!==void 0&&(e=typeof i.keyboardEventTarget=="string"?document.getElementById(i.keyboardEventTarget):i.keyboardEventTarget);const t={},n=i.layers&&typeof i.layers.getLayers=="function"?i.layers:new uc({layers:i.layers});t[Ot.LAYERGROUP]=n,t[Ot.TARGET]=i.target,t[Ot.VIEW]=i.view instanceof Ui?i.view:new Ui;let s;i.controls!==void 0&&(Array.isArray(i.controls)?s=new Xt(i.controls.slice()):(_e(typeof i.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),s=i.controls));let r;i.interactions!==void 0&&(Array.isArray(i.interactions)?r=new Xt(i.interactions.slice()):(_e(typeof i.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),r=i.interactions));let o;return i.overlays!==void 0?Array.isArray(i.overlays)?o=new Xt(i.overlays.slice()):(_e(typeof i.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),o=i.overlays):o=new Xt,{controls:s,interactions:r,keyboardEventTarget:e,overlays:o,values:t}}const uI=hI;function dI(i,e,t,n,s){a_(i,e,t||0,n||i.length-1,s||fI)}function a_(i,e,t,n,s){for(;n>t;){if(n-t>600){var r=n-t+1,o=e-t+1,a=Math.log(r),l=.5*Math.exp(2*a/3),h=.5*Math.sqrt(a*l*(r-l)/r)*(o-r/2<0?-1:1),c=Math.max(t,Math.floor(e-o*l/r+h)),u=Math.min(n,Math.floor(e+(r-o)*l/r+h));a_(i,e,c,u,s)}var d=i[e],f=t,g=n;for(Ao(i,t,e),s(i[n],d)>0&&Ao(i,t,n);f<g;){for(Ao(i,f,g),f++,g--;s(i[f],d)<0;)f++;for(;s(i[g],d)>0;)g--}s(i[t],d)===0?Ao(i,t,g):(g++,Ao(i,g,n)),g<=e&&(t=g+1),e<=g&&(n=g-1)}}function Ao(i,e,t){var n=i[e];i[e]=i[t],i[t]=n}function fI(i,e){return i<e?-1:i>e?1:0}let l_=class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const n=[];if(!yl(e,t))return n;const s=this.toBBox,r=[];for(;t;){for(let o=0;o<t.children.length;o++){const a=t.children[o],l=t.leaf?s(a):a;yl(e,l)&&(t.leaf?n.push(a):$c(e,l)?this._all(a,n):r.push(a))}t=r.pop()}return n}collides(e){let t=this.data;if(!yl(e,t))return!1;const n=[];for(;t;){for(let s=0;s<t.children.length;s++){const r=t.children[s],o=t.leaf?this.toBBox(r):r;if(yl(e,o)){if(t.leaf||$c(e,o))return!0;n.push(r)}}t=n.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let n=0;n<e.length;n++)this.insert(e[n]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const n=this.data;this.data=t,t=n}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=gr([]),this}remove(e,t){if(!e)return this;let n=this.data;const s=this.toBBox(e),r=[],o=[];let a,l,h;for(;n||r.length;){if(n||(n=r.pop(),l=r[r.length-1],a=o.pop(),h=!0),n.leaf){const c=gI(e,n.children,t);if(c!==-1)return n.children.splice(c,1),r.push(n),this._condense(r),this}!h&&!n.leaf&&$c(n,s)?(r.push(n),o.push(a),a=0,l=n,n=n.children[0]):l?(a++,n=l.children[a],h=!1):n=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const n=[];for(;e;)e.leaf?t.push(...e.children):n.push(...e.children),e=n.pop();return t}_build(e,t,n,s){const r=n-t+1;let o=this._maxEntries,a;if(r<=o)return a=gr(e.slice(t,n+1)),rr(a,this.toBBox),a;s||(s=Math.ceil(Math.log(r)/Math.log(o)),o=Math.ceil(r/Math.pow(o,s-1))),a=gr([]),a.leaf=!1,a.height=s;const l=Math.ceil(r/o),h=l*Math.ceil(Math.sqrt(o));em(e,t,n,h,this.compareMinX);for(let c=t;c<=n;c+=h){const u=Math.min(c+h-1,n);em(e,c,u,l,this.compareMinY);for(let d=c;d<=u;d+=l){const f=Math.min(d+l-1,u);a.children.push(this._build(e,d,f,s-1))}}return rr(a,this.toBBox),a}_chooseSubtree(e,t,n,s){for(;s.push(t),!(t.leaf||s.length-1===n);){let r=1/0,o=1/0,a;for(let l=0;l<t.children.length;l++){const h=t.children[l],c=Bc(h),u=yI(e,h)-c;u<o?(o=u,r=c<r?c:r,a=h):u===o&&c<r&&(r=c,a=h)}t=a||t.children[0]}return t}_insert(e,t,n){const s=n?e:this.toBBox(e),r=[],o=this._chooseSubtree(s,this.data,t,r);for(o.children.push(e),zo(o,s);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(s,r,t)}_split(e,t){const n=e[t],s=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,s);const o=this._chooseSplitIndex(n,r,s),a=gr(n.children.splice(o,n.children.length-o));a.height=n.height,a.leaf=n.leaf,rr(n,this.toBBox),rr(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(n,a)}_splitRoot(e,t){this.data=gr([e,t]),this.data.height=e.height+1,this.data.leaf=!1,rr(this.data,this.toBBox)}_chooseSplitIndex(e,t,n){let s,r=1/0,o=1/0;for(let a=t;a<=n-t;a++){const l=Go(e,0,a,this.toBBox),h=Go(e,a,n,this.toBBox),c=_I(l,h),u=Bc(l)+Bc(h);c<r?(r=c,s=a,o=u<o?u:o):c===r&&u<o&&(o=u,s=a)}return s||n-t}_chooseSplitAxis(e,t,n){const s=e.leaf?this.compareMinX:pI,r=e.leaf?this.compareMinY:mI,o=this._allDistMargin(e,t,n,s),a=this._allDistMargin(e,t,n,r);o<a&&e.children.sort(s)}_allDistMargin(e,t,n,s){e.children.sort(s);const r=this.toBBox,o=Go(e,0,t,r),a=Go(e,n-t,n,r);let l=ml(o)+ml(a);for(let h=t;h<n-t;h++){const c=e.children[h];zo(o,e.leaf?r(c):c),l+=ml(o)}for(let h=n-t-1;h>=t;h--){const c=e.children[h];zo(a,e.leaf?r(c):c),l+=ml(a)}return l}_adjustParentBBoxes(e,t,n){for(let s=n;s>=0;s--)zo(t[s],e)}_condense(e){for(let t=e.length-1,n;t>=0;t--)e[t].children.length===0?t>0?(n=e[t-1].children,n.splice(n.indexOf(e[t]),1)):this.clear():rr(e[t],this.toBBox)}};function gI(i,e,t){if(!t)return e.indexOf(i);for(let n=0;n<e.length;n++)if(t(i,e[n]))return n;return-1}function rr(i,e){Go(i,0,i.children.length,e,i)}function Go(i,e,t,n,s){s||(s=gr(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let r=e;r<t;r++){const o=i.children[r];zo(s,i.leaf?n(o):o)}return s}function zo(i,e){return i.minX=Math.min(i.minX,e.minX),i.minY=Math.min(i.minY,e.minY),i.maxX=Math.max(i.maxX,e.maxX),i.maxY=Math.max(i.maxY,e.maxY),i}function pI(i,e){return i.minX-e.minX}function mI(i,e){return i.minY-e.minY}function Bc(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function ml(i){return i.maxX-i.minX+(i.maxY-i.minY)}function yI(i,e){return(Math.max(e.maxX,i.maxX)-Math.min(e.minX,i.minX))*(Math.max(e.maxY,i.maxY)-Math.min(e.minY,i.minY))}function _I(i,e){const t=Math.max(i.minX,e.minX),n=Math.max(i.minY,e.minY),s=Math.min(i.maxX,e.maxX),r=Math.min(i.maxY,e.maxY);return Math.max(0,s-t)*Math.max(0,r-n)}function $c(i,e){return i.minX<=e.minX&&i.minY<=e.minY&&e.maxX<=i.maxX&&e.maxY<=i.maxY}function yl(i,e){return e.minX<=i.maxX&&e.minY<=i.maxY&&e.maxX>=i.minX&&e.maxY>=i.minY}function gr(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function em(i,e,t,n,s){const r=[e,t];for(;r.length;){if(t=r.pop(),e=r.pop(),t-e<=n)continue;const o=e+Math.ceil((t-e)/n/2)*n;dI(i,o,e,t,s),r.push(e,o,o,t)}}class vI{constructor(e){this.rbush_=new l_(e),this.items_={}}insert(e,t){const n={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(n),this.items_[H(t)]=n}load(e,t){const n=new Array(t.length);for(let s=0,r=t.length;s<r;s++){const o=e[s],a=t[s],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};n[s]=l,this.items_[H(a)]=l}this.rbush_.load(n)}remove(e){const t=H(e),n=this.items_[t];return delete this.items_[t],this.rbush_.remove(n)!==null}update(e,t){const n=this.items_[H(t)],s=[n.minX,n.minY,n.maxX,n.maxY];$s(s,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(s){return s.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let n;for(let s=0,r=e.length;s<r;s++)if(n=t(e[s]),n)return n;return n}isEmpty(){return hs(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return Fi(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}}const ph=vI;class xI extends _n{constructor(e){super(),this.projection=K(e.projection),this.attributions_=tm(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible!==void 0?e.attributionsCollapsible:!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(n,s){t.viewResolver=n,t.viewRejector=s})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=tm(e),this.changed()}setState(e){this.state_=e,this.changed()}}function tm(i){return i?Array.isArray(i)?function(e){return i}:typeof i=="function"?i:function(e){return[i]}:null}const Gf=xI,Ut={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function wI(i,e){return[[-1/0,-1/0,1/0,1/0]]}function bI(i,e){return[i]}let EI=!1;function h_(i,e,t,n,s,r,o){const a=new XMLHttpRequest;a.open("GET",typeof i=="function"?i(t,n,s):i,!0),e.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=EI,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const h=e.getType();let c;h=="json"?c=JSON.parse(a.responseText):h=="text"?c=a.responseText:h=="xml"?(c=a.responseXML,c||(c=new DOMParser().parseFromString(a.responseText,"application/xml"))):h=="arraybuffer"&&(c=a.response),c?r(e.readFeatures(c,{extent:t,featureProjection:s}),e.readProjection(c)):o()}else o()},a.onerror=o,a.send()}function im(i,e){return function(t,n,s,r,o){const a=this;h_(i,e,t,n,s,function(l,h){a.addFeatures(l),r!==void 0&&r(l)},o||lo)}}class zn extends xi{constructor(e,t,n){super(e),this.feature=t,this.features=n}}class MI extends Gf{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=lo,this.format_=e.format,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&(_e(this.format_,"`format` must be set when `url` is set"),this.loader_=im(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:wI;const t=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=t?new ph:null,this.loadedExtentsRtree_=new ph,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let n,s;Array.isArray(e.features)?s=e.features:e.features&&(n=e.features,s=n.getArray()),!t&&n===void 0&&(n=new Xt(s)),s!==void 0&&this.addFeaturesInternal(s),n!==void 0&&this.bindFeaturesCollection_(n)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=H(e);if(!this.addToIndex_(t,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(t,e);const n=e.getGeometry();if(n){const s=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(s,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new zn(Ut.ADDFEATURE,e))}setupChangeEvents_(e,t){t instanceof Li||(this.featureChangeKeys_[e]=[ye(t,ee.CHANGE,this.handleFeatureChange_,this),ye(t,ao.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(e,t){let n=!0;if(t.getId()!==void 0){const s=String(t.getId());if(!(s in this.idIndex_))this.idIndex_[s]=t;else if(t instanceof Li){const r=this.idIndex_[s];r instanceof Li?Array.isArray(r)?r.push(t):this.idIndex_[s]=[r,t]:n=!1}else n=!1}return n&&(_e(!(e in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[e]=t),n}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],n=[],s=[];for(let r=0,o=e.length;r<o;r++){const a=e[r],l=H(a);this.addToIndex_(l,a)&&n.push(a)}for(let r=0,o=n.length;r<o;r++){const a=n[r],l=H(a);this.setupChangeEvents_(l,a);const h=a.getGeometry();if(h){const c=h.getExtent();t.push(c),s.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(t,s),this.hasListener(Ut.ADDFEATURE))for(let r=0,o=n.length;r<o;r++)this.dispatchEvent(new zn(Ut.ADDFEATURE,n[r]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(Ut.ADDFEATURE,function(n){t||(t=!0,e.push(n.feature),t=!1)}),this.addEventListener(Ut.REMOVEFEATURE,function(n){t||(t=!0,e.remove(n.feature),t=!1)}),e.addEventListener(bt.ADD,n=>{t||(t=!0,this.addFeature(n.element),t=!1)}),e.addEventListener(bt.REMOVE,n=>{t||(t=!0,this.removeFeature(n.element),t=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const n in this.featureChangeKeys_)this.featureChangeKeys_[n].forEach(qe);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const n=s=>{this.removeFeatureInternal(s)};this.featuresRtree_.forEach(n);for(const s in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[s])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new zn(Ut.CLEAR);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const n=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(n,function(s){const r=s.getGeometry();if(r instanceof Li||r.intersectsCoordinate(e))return t(s)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(n){const s=n.getGeometry();if(s instanceof Li||s.intersectsExtent(e)){const r=t(n);if(r)return r}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),hs(this.nullGeometryFeatures_)||Gt(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(n){t.push(n)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const s=zE(e,t);return[].concat(...s.map(r=>this.featuresRtree_.getInExtent(r)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,t){const n=e[0],s=e[1];let r=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return t=t||js,this.featuresRtree_.forEachInExtent(l,function(h){if(t(h)){const c=h.getGeometry(),u=a;if(a=c instanceof Li?0:c.closestPointXY(n,s,o,a),a<u){r=h;const d=Math.sqrt(a);l[0]=n-d,l[1]=s-d,l[2]=n+d,l[3]=s+d}}}),r}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const t=this.idIndex_[e.toString()];return t!==void 0?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,n=H(t),s=t.getGeometry();if(!s)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[n]=t);else{const o=s.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(o,t)):this.featuresRtree_&&this.featuresRtree_.update(o,t)}const r=t.getId();if(r!==void 0){const o=r.toString();this.idIndex_[o]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[o]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[n]=t;this.changed(),this.dispatchEvent(new zn(Ut.CHANGEFEATURE,t))}hasFeature(e){const t=e.getId();return t!==void 0?t in this.idIndex_:H(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&hs(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,t,n){const s=this.loadedExtentsRtree_,r=this.strategy_(e,t,n);for(let o=0,a=r.length;o<a;++o){const l=r[o];s.forEachInExtent(l,function(c){return qi(c.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new zn(Ut.FEATURESLOADSTART)),this.loader_.call(this,l,t,n,c=>{--this.loadingExtentsCount_,this.dispatchEvent(new zn(Ut.FEATURESLOADEND,void 0,c))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new zn(Ut.FEATURESLOADERROR))}),s.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_;let n;t.forEachInExtent(e,function(s){if($s(s.extent,e))return n=s,!0}),n&&t.remove(n)}removeFeature(e){if(!e)return;const t=H(e);t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=H(e),n=this.featureChangeKeys_[t];if(!n)return;n.forEach(qe),delete this.featureChangeKeys_[t];const s=e.getId();return s!==void 0&&delete this.idIndex_[s.toString()],delete this.uidIndex_[t],this.dispatchEvent(new zn(Ut.REMOVEFEATURE,e)),e}removeFromIdIndex_(e){let t=!1;for(const n in this.idIndex_){const s=this.idIndex_[n];if(e instanceof Li&&Array.isArray(s)&&s.includes(e))s.splice(s.indexOf(e),1);else if(this.idIndex_[n]===e){delete this.idIndex_[n],t=!0;break}}return t}setLoader(e){this.loader_=e}setUrl(e){_e(this.format_,"`format` must be set when `url` is set"),this.url_=e,this.setLoader(im(e,this.format_))}}const rs=MI;let xo=0;const wo=0,st=1<<xo++,X=1<<xo++,ji=1<<xo++,Dt=1<<xo++,gs=1<<xo++,Kt=Math.pow(2,xo)-1,c_={[st]:"boolean",[X]:"number",[ji]:"string",[Dt]:"color",[gs]:"number[]"},CI=Object.keys(c_).map(Number).sort(us);function zt(i){const e=[];for(const t of CI)SI(i,t)&&e.push(c_[t]);return e.length===0?"untyped":e.length<3?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e[e.length-1]}function SI(i,e){return(i&e)===e}function fn(i,e){return!!(i&e)}function dc(i,e){return i===e}class Qn{constructor(e,t){this.type=e,this.value=t}}class TI{constructor(e,t,...n){this.type=e,this.operator=t,this.args=n}}function u_(){return{variables:new Set,properties:new Set,featureId:!1,style:{}}}function RI(i){switch(i){case"string":return ji;case"color":return Dt;case"number":return X;case"boolean":return st;case"number[]":return gs;default:throw new Error(`Unrecognized type hint: ${i}`)}}function ze(i,e,t){switch(typeof i){case"boolean":return new Qn(st,i);case"number":return new Qn(X,i);case"string":{let s=ji;return BC(i)&&(s|=Dt),dc(s&t,wo)||(s&=t),new Qn(s,i)}}if(!Array.isArray(i))throw new Error("Expression must be an array or a primitive value");if(i.length===0)throw new Error("Empty expression");if(typeof i[0]=="string")return zI(i,e,t);for(const s of i)if(typeof s!="number")throw new Error("Expected an array of numbers");let n=gs;return(i.length===3||i.length===4)&&(n|=Dt),t&&(n&=t),new Qn(n,i)}const L={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette"},II={[L.Get]:he(([i,e])=>e!==void 0?RI(e.value):Kt,xe(1,2),LI),[L.Var]:he(([i])=>i.type,xe(1,1),PI),[L.Id]:he(X|ji,Fo,AI),[L.Concat]:he(ji,xe(2,1/0),Oe(Kt)),[L.GeometryType]:he(ji,Fo),[L.Resolution]:he(X,Fo),[L.Zoom]:he(X,Fo),[L.Time]:he(X,Fo),[L.Any]:he(st,xe(2,1/0),Oe(st)),[L.All]:he(st,xe(2,1/0),Oe(st)),[L.Not]:he(st,xe(1,1),Oe(st)),[L.Equal]:he(st,xe(2,2),Oe(Kt),Es),[L.NotEqual]:he(st,xe(2,2),Oe(Kt),Es),[L.GreaterThan]:he(st,xe(2,2),Oe(Kt),Es),[L.GreaterThanOrEqualTo]:he(st,xe(2,2),Oe(Kt),Es),[L.LessThan]:he(st,xe(2,2),Oe(Kt),Es),[L.LessThanOrEqualTo]:he(st,xe(2,2),Oe(Kt),Es),[L.Multiply]:he(i=>{let e=X|Dt;for(let t=0;t<i.length;t++)e&=i[t].type;return e},xe(2,1/0),Oe(X|Dt),Es),[L.Divide]:he(X,xe(2,2),Oe(X)),[L.Add]:he(X,xe(2,1/0),Oe(X)),[L.Subtract]:he(X,xe(2,2),Oe(X)),[L.Clamp]:he(X,xe(3,3),Oe(X)),[L.Mod]:he(X,xe(2,2),Oe(X)),[L.Pow]:he(X,xe(2,2),Oe(X)),[L.Abs]:he(X,xe(1,1),Oe(X)),[L.Floor]:he(X,xe(1,1),Oe(X)),[L.Ceil]:he(X,xe(1,1),Oe(X)),[L.Round]:he(X,xe(1,1),Oe(X)),[L.Sin]:he(X,xe(1,1),Oe(X)),[L.Cos]:he(X,xe(1,1),Oe(X)),[L.Atan]:he(X,xe(1,2),Oe(X)),[L.Sqrt]:he(X,xe(1,1),Oe(X)),[L.Match]:he(i=>{let e=Kt;for(let t=2;t<i.length;t+=2)e&=i[t].type;return e&=i[i.length-1].type,e},xe(4,1/0),nm,kI),[L.Between]:he(st,xe(3,3),Oe(X)),[L.Interpolate]:he(i=>{let e=Dt|X;for(let t=3;t<i.length;t+=2)e&=i[t].type;return e},xe(6,1/0),nm,OI),[L.Case]:he(i=>{let e=Kt;for(let t=1;t<i.length;t+=2)e&=i[t].type;return e&=i[i.length-1].type,e},xe(3,1/0),FI,NI),[L.In]:he(st,xe(2,2),DI),[L.Number]:he(X,xe(1,1/0),Oe(Kt)),[L.String]:he(ji,xe(1,1/0),Oe(Kt)),[L.Array]:he(i=>i.length===3||i.length===4?gs|Dt:gs,xe(1,1/0),Oe(X)),[L.Color]:he(Dt,xe(3,4),Oe(X)),[L.Band]:he(X,xe(1,3),Oe(X)),[L.Palette]:he(Dt,xe(2,2),GI)};function LI(i,e){const t=ze(i[1],e);if(!(t instanceof Qn))throw new Error("Expected a literal argument for get operation");if(typeof t.value!="string")throw new Error("Expected a string argument for get operation");if(e.properties.add(t.value),i.length===3){const n=ze(i[2],e);return[t,n]}return[t]}function PI(i,e,t,n){const s=i[1];if(typeof s!="string")throw new Error("Expected a string argument for var operation");if(e.variables.add(s),!("variables"in e.style)||e.style.variables[s]===void 0)return[new Qn(Kt,s)];const r=e.style.variables[s],o=ze(r,e);if(o.value=s,n&&!fn(n,o.type))throw new Error(`The variable ${s} has type ${zt(o.type)} but the following type was expected: ${zt(n)}`);return[o]}function AI(i,e){e.featureId=!0}function Fo(i,e){const t=i[0];if(i.length!==1)throw new Error(`Expected no arguments for ${t} operation`);return[]}function xe(i,e){return function(t,n){const s=t[0],r=t.length-1;if(i===e){if(r!==i){const o=i===1?"":"s";throw new Error(`Expected ${i} argument${o} for ${s}, got ${r}`)}}else if(r<i||r>e){const o=e===1/0?`${i} or more`:`${i} to ${e}`;throw new Error(`Expected ${o} arguments for ${s}, got ${r}`)}}}function Oe(i){return function(e,t){const n=e[0],s=e.length-1,r=new Array(s);for(let o=0;o<s;++o){const a=ze(e[o+1],t);if(!fn(i,a.type)){const l=zt(i),h=zt(a.type);throw new Error(`Unexpected type for argument ${o} of ${n} operation, got ${l} but expected ${h}`)}a.type&=i,r[o]=a}return r}}function Es(i,e,t){const n=i[0],s=i.length-1;let r=Kt;for(let a=0;a<t.length;++a)r&=t[a].type;if(r===wo)throw new Error(`No common type could be found for arguments of ${n} operation`);const o=new Array(s);for(let a=0;a<s;++a)o[a]=ze(i[a+1],e,r);return o}function FI(i,e){const t=i[0],n=i.length-1;if(n%2===0)throw new Error(`An odd amount of arguments was expected for operation ${t}, got ${JSON.stringify(n)} instead`)}function nm(i,e){const t=i[0],n=i.length-1;if(n%2===1)throw new Error(`An even amount of arguments was expected for operation ${t}, got ${JSON.stringify(n)} instead`)}function kI(i,e,t,n){const s=i.length-1;let o=ze(i[1],e).type;const a=ze(i[i.length-1],e);let l=n!==void 0?n&a.type:a.type;const h=new Array(s-2);for(let u=0;u<s-2;u+=2){const d=ze(i[u+2],e),f=ze(i[u+3],e);o&=d.type,l&=f.type,h[u]=d,h[u+1]=f}const c=ji|X|st;if(!fn(c,o))throw new Error(`Expected an input of type ${zt(c)} for the interpolate operation, got ${zt(o)} instead`);if(dc(l,wo))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(i));for(let u=0;u<s-2;u+=2){const d=ze(i[u+2],e,o),f=ze(i[u+3],e,l);h[u]=d,h[u+1]=f}return[ze(i[1],e,o),...h,ze(i[i.length-1],e,l)]}function OI(i,e,t,n){const s=i[1];let r;switch(s[0]){case"linear":r=1;break;case"exponential":if(r=s[1],typeof r!="number")throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(r)} instead`);break;default:r=null}if(!r)throw new Error(`Invalid interpolation type: ${JSON.stringify(s)}`);r=ze(r,e);let o=ze(i[2],e);if(!fn(X,o.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${zt(o.type)} instead`);o=ze(i[2],e,X);const a=new Array(i.length-3);for(let l=0;l<a.length;l+=2){let h=ze(i[l+3],e);if(!fn(X,h.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${zt(h.type)} at position ${l+2} instead`);let c=ze(i[l+4],e);if(!fn(X|Dt,c.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${zt(c.type)} at position ${l+3} instead`);h=ze(i[l+3],e,X),c=ze(i[l+4],e,X|Dt),a[l]=h,a[l+1]=c}return[r,o,...a]}function NI(i,e,t,n){const s=ze(i[i.length-1],e);let r=n!==void 0?n&s.type:s.type;const o=new Array(i.length-1);for(let a=0;a<o.length-1;a+=2){const l=ze(i[a+1],e),h=ze(i[a+2],e);if(!fn(st,l.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${zt(l.type)} at position ${a} instead`);r&=h.type,o[a]=l,o[a+1]=h}if(dc(r,wo))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(i));for(let a=0;a<o.length-1;a+=2)o[a+1]=ze(i[a+2],e,r);return o[o.length-1]=ze(i[i.length-1],e,r),o}function DI(i,e){let t=i[2];if(!Array.isArray(t))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if(typeof t[0]=="string"){if(t[0]!=="literal")throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(t[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');t=t[1]}let n=ji|X;const s=new Array(t.length);for(let o=0;o<s.length;o++){const a=ze(t[o],e);n&=a.type,s[o]=a}if(dc(n,wo))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(i));return[ze(i[1],e,n),...s]}function GI(i,e){const t=ze(i[1],e,X);if(t.type!==X)throw new Error(`The first argument of palette must be an number, got ${zt(t.type)} instead`);const n=i[2];if(!Array.isArray(n))throw new Error("The second argument of palette must be an array");const s=new Array(n.length);for(let r=0;r<s.length;r++){const o=ze(n[r],e,Dt);if(!(o instanceof Qn))throw new Error(`The palette color at index ${r} must be a literal value`);if(!fn(o.type,Dt))throw new Error(`The palette color at index ${r} should be of type color, got ${zt(o.type)} instead`);s[r]=o}return[t,...s]}function he(i,...e){return function(t,n,s){const r=t[0];let o=[];for(let l=0;l<e.length;l++)o=e[l](t,n,o,s)||o;let a=typeof i=="function"?i(o):i;if(s!==void 0){if(!fn(a,s))throw new Error(`The following expression was expected to return ${zt(s)}, but returns ${zt(a)} instead: ${JSON.stringify(t)}`);a&=s}if(a===wo)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(t)}`);return new TI(a,r,...o)}}function zI(i,e,t){const n=i[0],s=II[n];if(!s)throw new Error(`Unknown operator: ${n}`);return s(i,e,t)}function d_(){return{variables:{},properties:{},resolution:NaN,featureId:null}}function ys(i,e,t){const n=ze(i,t);if(!fn(e,n.type)){const s=zt(e),r=zt(n.type);throw new Error(`Expected expression to be of type ${s}, got ${r}`)}return On(n)}function On(i,e){if(i instanceof Qn){if(i.type===Dt&&typeof i.value=="string"){const n=cf(i.value);return function(){return n}}return function(){return i.value}}const t=i.operator;switch(t){case L.Number:case L.String:return BI(i);case L.Get:case L.Var:return $I(i);case L.Id:return n=>n.featureId;case L.Concat:{const n=i.args.map(s=>On(s));return s=>"".concat(...n.map(r=>r(s).toString()))}case L.Resolution:return n=>n.resolution;case L.Any:case L.All:case L.Not:return qI(i);case L.Equal:case L.NotEqual:case L.LessThan:case L.LessThanOrEqualTo:case L.GreaterThan:case L.GreaterThanOrEqualTo:return UI(i);case L.Multiply:case L.Divide:case L.Add:case L.Subtract:case L.Clamp:case L.Mod:case L.Pow:case L.Abs:case L.Floor:case L.Ceil:case L.Round:case L.Sin:case L.Cos:case L.Atan:case L.Sqrt:return jI(i);case L.Match:return WI(i);case L.Interpolate:return VI(i);default:throw new Error(`Unsupported operator ${t}`)}}function BI(i,e){const t=i.operator,n=i.args.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=On(i.args[r]);switch(t){case L.Number:case L.String:return r=>{for(let o=0;o<n;++o){const a=s[o](r);if(typeof a===t)return a}throw new Error(`Expected one of the values to be a ${t}`)};default:throw new Error(`Unsupported assertion operator ${t}`)}}function $I(i,e){const n=i.args[0].value;switch(i.operator){case L.Get:return s=>s.properties[n];case L.Var:return s=>s.variables[n];default:throw new Error(`Unsupported accessor operator ${i.operator}`)}}function UI(i,e){const t=i.operator,n=On(i.args[0]),s=On(i.args[1]);switch(t){case L.Equal:return r=>n(r)===s(r);case L.NotEqual:return r=>n(r)!==s(r);case L.LessThan:return r=>n(r)<s(r);case L.LessThanOrEqualTo:return r=>n(r)<=s(r);case L.GreaterThan:return r=>n(r)>s(r);case L.GreaterThanOrEqualTo:return r=>n(r)>=s(r);default:throw new Error(`Unsupported comparison operator ${t}`)}}function qI(i,e){const t=i.operator,n=i.args.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=On(i.args[r]);switch(t){case L.Any:return r=>{for(let o=0;o<n;++o)if(s[o](r))return!0;return!1};case L.All:return r=>{for(let o=0;o<n;++o)if(!s[o](r))return!1;return!0};case L.Not:return r=>!s[0](r);default:throw new Error(`Unsupported logical operator ${t}`)}}function jI(i,e){const t=i.operator,n=i.args.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=On(i.args[r]);switch(t){case L.Multiply:return r=>{let o=1;for(let a=0;a<n;++a)o*=s[a](r);return o};case L.Divide:return r=>s[0](r)/s[1](r);case L.Add:return r=>{let o=0;for(let a=0;a<n;++a)o+=s[a](r);return o};case L.Subtract:return r=>s[0](r)-s[1](r);case L.Clamp:return r=>{const o=s[0](r),a=s[1](r);if(o<a)return a;const l=s[2](r);return o>l?l:o};case L.Mod:return r=>s[0](r)%s[1](r);case L.Pow:return r=>Math.pow(s[0](r),s[1](r));case L.Abs:return r=>Math.abs(s[0](r));case L.Floor:return r=>Math.floor(s[0](r));case L.Ceil:return r=>Math.ceil(s[0](r));case L.Round:return r=>Math.round(s[0](r));case L.Sin:return r=>Math.sin(s[0](r));case L.Cos:return r=>Math.cos(s[0](r));case L.Atan:return n===2?r=>Math.atan2(s[0](r),s[1](r)):r=>Math.atan(s[0](r));case L.Sqrt:return r=>Math.sqrt(s[0](r));default:throw new Error(`Unsupported numeric operator ${t}`)}}function WI(i,e){const t=i.args.length,n=new Array(t);for(let s=0;s<t;++s)n[s]=On(i.args[s]);return s=>{const r=n[0](s);for(let o=1;o<t;o+=2)if(r===n[o](s))return n[o+1](s);return n[t-1](s)}}function VI(i,e){const t=i.args.length,n=new Array(t);for(let s=0;s<t;++s)n[s]=On(i.args[s]);return s=>{const r=n[0](s),o=n[1](s);let a,l;for(let h=2;h<t;h+=2){const c=n[h](s);let u=n[h+1](s);const d=Array.isArray(u);if(d&&(u=GC(u)),c>=o)return h===2?u:d?XI(r,o,a,l,c,u):Bo(r,o,a,l,c,u);a=c,l=u}return l}}function Bo(i,e,t,n,s,r){const o=s-t;if(o===0)return n;const a=e-t,l=i===1?a/o:(Math.pow(i,a)-1)/(Math.pow(i,o)-1);return n+l*(r-n)}function XI(i,e,t,n,s,r){if(s-t===0)return n;const a=gp(n),l=gp(r);let h=l[2]-a[2];h>180?h-=360:h<-180&&(h+=360);const c=[Bo(i,e,t,a[0],s,l[0]),Bo(i,e,t,a[1],s,l[1]),a[2]+Bo(i,e,t,0,s,h),Bo(i,e,t,n[3],s,r[3])];return My(zC(c))}function YI(i){return!0}function HI(i){const e=u_(),t=ZI(i,e),n=d_();return function(s,r){if(n.properties=s.getPropertiesInternal(),n.resolution=r,e.featureId){const o=s.getId();o!==void 0?n.featureId=o:n.featureId=null}return t(n)}}function sm(i){const e=u_(),t=i.length,n=new Array(t);for(let o=0;o<t;++o)n[o]=Qu(i[o],e);const s=d_(),r=new Array(t);return function(o,a){if(s.properties=o.getPropertiesInternal(),s.resolution=a,e.featureId){const h=o.getId();h!==void 0?s.featureId=h:s.featureId=null}let l=0;for(let h=0;h<t;++h){const c=n[h](s);c&&(r[l]=c,l+=1)}return r.length=l,r}}function ZI(i,e){const t=i.length,n=new Array(t);for(let s=0;s<t;++s){const r=i[s],o="filter"in r?ys(r.filter,st,e):YI;let a;if(Array.isArray(r.style)){const l=r.style.length;a=new Array(l);for(let h=0;h<l;++h)a[h]=Qu(r.style[h],e)}else a=[Qu(r.style,e)];n[s]={filter:o,styles:a}}return function(s){const r=[];let o=!1;for(let a=0;a<t;++a){const l=n[a].filter;if(l(s)&&!(i[a].else&&o)){o=!0;for(const h of n[a].styles){const c=h(s);c&&r.push(c)}}}return r}}function Qu(i,e){const t=aa(i,"",e),n=la(i,"",e),s=KI(i,e),r=JI(i,e),o=si(i,"z-index",e);if(!t&&!n&&!s&&!r&&!hs(i))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(i));const a=new ii;return function(l){let h=!0;if(t){const c=t(l);c&&(h=!1),a.setFill(c)}if(n){const c=n(l);c&&(h=!1),a.setStroke(c)}if(s){const c=s(l);c&&(h=!1),a.setText(c)}if(r){const c=r(l);c&&(h=!1),a.setImage(c)}return o&&a.setZIndex(o(l)),h?null:a}}function aa(i,e,t){const n=f_(i,e+"fill-color",t);if(!n)return null;const s=new jt;return function(r){const o=n(r);return o==="none"?null:(s.setColor(o),s)}}function la(i,e,t){const n=si(i,e+"stroke-width",t),s=f_(i,e+"stroke-color",t);if(!n&&!s)return null;const r=Xn(i,e+"stroke-line-cap",t),o=Xn(i,e+"stroke-line-join",t),a=g_(i,e+"stroke-line-dash",t),l=si(i,e+"stroke-line-dash-offset",t),h=si(i,e+"stroke-miter-limit",t),c=new Tt;return function(u){if(s){const d=s(u);if(d==="none")return null;c.setColor(d)}if(n&&c.setWidth(n(u)),r){const d=r(u);if(d!=="butt"&&d!=="round"&&d!=="square")throw new Error("Expected butt, round, or square line cap");c.setLineCap(d)}if(o){const d=o(u);if(d!=="bevel"&&d!=="round"&&d!=="miter")throw new Error("Expected bevel, round, or miter line join");c.setLineJoin(d)}return a&&c.setLineDash(a(u)),l&&c.setLineDashOffset(l(u)),h&&c.setMiterLimit(h(u)),c}}function KI(i,e){const t="text-",n=Xn(i,t+"value",e);if(!n)return null;const s=aa(i,t,e),r=aa(i,t+"background-",e),o=la(i,t,e),a=la(i,t+"background-",e),l=Xn(i,t+"font",e),h=si(i,t+"max-angle",e),c=si(i,t+"offset-x",e),u=si(i,t+"offset-y",e),d=ha(i,t+"overflow",e),f=Xn(i,t+"placement",e),g=si(i,t+"repeat",e),p=fc(i,t+"scale",e),m=ha(i,t+"rotate-with-view",e),_=si(i,t+"rotation",e),y=Xn(i,t+"align",e),x=Xn(i,t+"justify",e),w=Xn(i,t+"baseline",e),b=g_(i,t+"padding",e),E=new yf({});return function(M){if(E.setText(n(M)),s&&E.setFill(s(M)),r&&E.setBackgroundFill(r(M)),o&&E.setStroke(o(M)),a&&E.setBackgroundStroke(a(M)),l&&E.setFont(l(M)),h&&E.setMaxAngle(h(M)),c&&E.setOffsetX(c(M)),u&&E.setOffsetY(u(M)),d&&E.setOverflow(d(M)),f){const C=f(M);if(C!=="point"&&C!=="line")throw new Error("Expected point or line for text-placement");E.setPlacement(C)}if(g&&E.setRepeat(g(M)),p&&E.setScale(p(M)),m&&E.setRotateWithView(m(M)),_&&E.setRotation(_(M)),y){const C=y(M);if(C!=="left"&&C!=="center"&&C!=="right"&&C!=="end"&&C!=="start")throw new Error("Expected left, right, center, start, or end for text-align");E.setTextAlign(C)}if(x){const C=x(M);if(C!=="left"&&C!=="right"&&C!=="center")throw new Error("Expected left, right, or center for text-justify");E.setJustify(C)}if(w){const C=w(M);if(C!=="bottom"&&C!=="top"&&C!=="middle"&&C!=="alphabetic"&&C!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");E.setTextBaseline(C)}return b&&E.setPadding(b(M)),E}}function JI(i,e){return"icon-src"in i?QI(i,e):"shape-points"in i?eL(i,e):"circle-radius"in i?tL(i,e):null}function QI(i,e){const t="icon-",n=t+"src",s=p_(i[n],n),r=mh(i,t+"anchor",e),o=fc(i,t+"scale",e),a=si(i,t+"opacity",e),l=mh(i,t+"displacement",e),h=si(i,t+"rotation",e),c=ha(i,t+"rotate-with-view",e),u=rm(i,t+"anchor-origin"),d=om(i,t+"anchor-x-units"),f=om(i,t+"anchor-y-units"),g=rL(i,t+"color"),p=nL(i,t+"cross-origin"),m=sL(i,t+"offset"),_=rm(i,t+"offset-origin"),y=Cr(i,t+"width"),x=Cr(i,t+"height"),w=iL(i,t+"size"),b=zf(i,t+"declutter"),E=new oh({src:s,anchorOrigin:u,anchorXUnits:d,anchorYUnits:f,color:g,crossOrigin:p,offset:m,offsetOrigin:_,height:x,width:y,size:w,declutterMode:b});return function(M){return a&&E.setOpacity(a(M)),l&&E.setDisplacement(l(M)),h&&E.setRotation(h(M)),c&&E.setRotateWithView(c(M)),o&&E.setScale(o(M)),r&&E.setAnchor(r(M)),E}}function eL(i,e){const t="shape-",n=t+"points",s=m_(i[n],n),r=aa(i,t,e),o=la(i,t,e),a=fc(i,t+"scale",e),l=mh(i,t+"displacement",e),h=si(i,t+"rotation",e),c=ha(i,t+"rotate-with-view",e),u=Cr(i,t+"radius"),d=Cr(i,t+"radius1"),f=Cr(i,t+"radius2"),g=Cr(i,t+"angle"),p=zf(i,t+"declutter-mode"),m=new Fy({points:s,radius:u,radius1:d,radius2:f,angle:g,declutterMode:p});return function(_){return r&&m.setFill(r(_)),o&&m.setStroke(o(_)),l&&m.setDisplacement(l(_)),h&&m.setRotation(h(_)),c&&m.setRotateWithView(c(_)),a&&m.setScale(a(_)),m}}function tL(i,e){const t="circle-",n=aa(i,t,e),s=la(i,t,e),r=si(i,t+"radius",e),o=fc(i,t+"scale",e),a=mh(i,t+"displacement",e),l=si(i,t+"rotation",e),h=ha(i,t+"rotate-with-view",e),c=zf(i,t+"declutter-mode"),u=new Kn({radius:5,declutterMode:c});return function(d){return r&&u.setRadius(r(d)),n&&u.setFill(n(d)),s&&u.setStroke(s(d)),a&&u.setDisplacement(a(d)),l&&u.setRotation(l(d)),h&&u.setRotateWithView(h(d)),o&&u.setScale(o(d)),u}}function si(i,e,t){if(!(e in i))return;const n=ys(i[e],X,t);return function(s){return m_(n(s),e)}}function Xn(i,e,t){if(!(e in i))return null;const n=ys(i[e],ji,t);return function(s){return p_(n(s),e)}}function ha(i,e,t){if(!(e in i))return null;const n=ys(i[e],st,t);return function(s){const r=n(s);if(typeof r!="boolean")throw new Error(`Expected a boolean for ${e}`);return r}}function f_(i,e,t){if(!(e in i))return null;const n=ys(i[e],Dt|ji,t);return function(s){return y_(n(s),e)}}function g_(i,e,t){if(!(e in i))return null;const n=ys(i[e],gs,t);return function(s){return qa(n(s),e)}}function mh(i,e,t){if(!(e in i))return null;const n=ys(i[e],gs,t);return function(s){const r=qa(n(s),e);if(r.length!==2)throw new Error(`Expected two numbers for ${e}`);return r}}function fc(i,e,t){if(!(e in i))return null;const n=ys(i[e],gs|X,t);return function(s){return oL(n(s),e)}}function Cr(i,e){const t=i[e];if(t!==void 0){if(typeof t!="number")throw new Error(`Expected a number for ${e}`);return t}}function iL(i,e){const t=i[e];if(t!==void 0){if(typeof t=="number")return Vt(t);if(!Array.isArray(t))throw new Error(`Expected a number or size array for ${e}`);if(t.length!==2||typeof t[0]!="number"||typeof t[1]!="number")throw new Error(`Expected a number or size array for ${e}`);return t}}function nL(i,e){const t=i[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);return t}}function rm(i,e){const t=i[e];if(t!==void 0){if(t!=="bottom-left"&&t!=="bottom-right"&&t!=="top-left"&&t!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${e}`);return t}}function om(i,e){const t=i[e];if(t!==void 0){if(t!=="pixels"&&t!=="fraction")throw new Error(`Expected pixels or fraction for ${e}`);return t}}function sL(i,e){const t=i[e];if(t!==void 0)return qa(t,e)}function zf(i,e){const t=i[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);if(t!=="declutter"&&t!=="obstacle"&&t!=="none")throw new Error(`Expected declutter, obstacle, or none for ${e}`);return t}}function rL(i,e){const t=i[e];if(t!==void 0)return y_(t,e)}function qa(i,e){if(!Array.isArray(i))throw new Error(`Expected an array for ${e}`);const t=i.length;for(let n=0;n<t;++n)if(typeof i[n]!="number")throw new Error(`Expected an array of numbers for ${e}`);return i}function p_(i,e){if(typeof i!="string")throw new Error(`Expected a string for ${e}`);return i}function m_(i,e){if(typeof i!="number")throw new Error(`Expected a number for ${e}`);return i}function y_(i,e){if(typeof i=="string")return i;const t=qa(i,e),n=t.length;if(n<3||n>4)throw new Error(`Expected a color with 3 or 4 values for ${e}`);return t}function oL(i,e){if(typeof i=="number")return i;const t=qa(i,e);if(t.length!==2)throw new Error(`Expected an array of two numbers for ${e}`);return t}const am={RENDER_ORDER:"renderOrder"};class aL extends vo{constructor(e){e=e||{};const t=Object.assign({},e);delete t.style,delete t.renderBuffer,delete t.updateWhileAnimating,delete t.updateWhileInteracting,super(t),this.declutter_=e.declutter!==void 0?e.declutter:!1,this.renderBuffer_=e.renderBuffer!==void 0?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=e.updateWhileAnimating!==void 0?e.updateWhileAnimating:!1,this.updateWhileInteracting_=e.updateWhileInteracting!==void 0?e.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(am.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e){e.declutterTree||(e.declutterTree=new l_(9)),this.getRenderer().renderDeclutter(e)}setRenderOrder(e){this.set(am.RENDER_ORDER,e)}setStyle(e){this.style_=lL(e),this.styleFunction_=e===null?void 0:QC(this.style_),this.changed()}}function lL(i){if(i===void 0)return eS;if(!i)return null;if(typeof i=="function"||i instanceof ii)return i;if(!Array.isArray(i))return sm([i]);if(i.length===0)return[];const e=i.length,t=i[0];if(t instanceof ii){const s=new Array(e);for(let r=0;r<e;++r){const o=i[r];if(!(o instanceof ii))throw new Error("Expected a list of style instances");s[r]=o}return s}if("style"in t){const s=new Array(e);for(let r=0;r<e;++r){const o=i[r];if(!("style"in o))throw new Error("Expected a list of rules with a style property");s[r]=o}return HI(s)}return sm(i)}const __=aL,ja={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},_l=[ja.FILL],es=[ja.STROKE],Fs=[ja.BEGIN_PATH],lm=[ja.CLOSE_PATH],te=ja;class hL{drawCustom(e,t,n,s){}drawGeometry(e){}setStyle(e){}drawCircle(e,t){}drawFeature(e,t){}drawGeometryCollection(e,t){}drawLineString(e,t){}drawMultiLineString(e,t){}drawMultiPoint(e,t){}drawMultiPolygon(e,t){}drawPoint(e,t){}drawPolygon(e,t){}drawText(e,t){}setFillStrokeStyle(e,t){}setImageStyle(e,t){}setTextStyle(e,t){}}const v_=hL;class cL extends v_{constructor(e,t,n,s){super(),this.tolerance=e,this.maxExtent=t,this.pixelRatio=s,this.maxLineWidth=0,this.resolution=n,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){const t=this.pixelRatio;return t==1?e:e.map(function(n){return n*t})}appendFlatPointCoordinates(e,t){const n=this.getBufferedMaxExtent(),s=this.tmpCoordinate_,r=this.coordinates;let o=r.length;for(let a=0,l=e.length;a<l;a+=t)s[0]=e[a],s[1]=e[a+1],Aa(n,s)&&(r[o++]=s[0],r[o++]=s[1]);return o}appendFlatLineCoordinates(e,t,n,s,r,o){const a=this.coordinates;let l=a.length;const h=this.getBufferedMaxExtent();o&&(t+=s);let c=e[t],u=e[t+1];const d=this.tmpCoordinate_;let f=!0,g,p,m;for(g=t+s;g<n;g+=s)d[0]=e[g],d[1]=e[g+1],m=Mu(h,d),m!==p?(f&&(a[l++]=c,a[l++]=u,f=!1),a[l++]=d[0],a[l++]=d[1]):m===xt.INTERSECTING?(a[l++]=d[0],a[l++]=d[1],f=!1):f=!0,c=d[0],u=d[1],p=m;return(r&&f||g===t+s)&&(a[l++]=c,a[l++]=u),l}drawCustomCoordinates_(e,t,n,s,r){for(let o=0,a=n.length;o<a;++o){const l=n[o],h=this.appendFlatLineCoordinates(e,t,l,s,!1,!1);r.push(h),t=l}return t}drawCustom(e,t,n,s){this.beginGeometry(e,t);const r=e.getType(),o=e.getStride(),a=this.coordinates.length;let l,h,c,u,d;switch(r){case"MultiPolygon":l=e.getOrientedFlatCoordinates(),u=[];const f=e.getEndss();d=0;for(let g=0,p=f.length;g<p;++g){const m=[];d=this.drawCustomCoordinates_(l,d,f[g],o,m),u.push(m)}this.instructions.push([te.CUSTOM,a,u,e,n,Nu]),this.hitDetectionInstructions.push([te.CUSTOM,a,u,e,s||n,Nu]);break;case"Polygon":case"MultiLineString":c=[],l=r=="Polygon"?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),d=this.drawCustomCoordinates_(l,0,e.getEnds(),o,c),this.instructions.push([te.CUSTOM,a,c,e,n,ea]),this.hitDetectionInstructions.push([te.CUSTOM,a,c,e,s||n,ea]);break;case"LineString":case"Circle":l=e.getFlatCoordinates(),h=this.appendFlatLineCoordinates(l,0,l.length,o,!1,!1),this.instructions.push([te.CUSTOM,a,h,e,n,Zn]),this.hitDetectionInstructions.push([te.CUSTOM,a,h,e,s||n,Zn]);break;case"MultiPoint":l=e.getFlatCoordinates(),h=this.appendFlatPointCoordinates(l,o),h>a&&(this.instructions.push([te.CUSTOM,a,h,e,n,Zn]),this.hitDetectionInstructions.push([te.CUSTOM,a,h,e,s||n,Zn]));break;case"Point":l=e.getFlatCoordinates(),this.coordinates.push(l[0],l[1]),h=this.coordinates.length,this.instructions.push([te.CUSTOM,a,h,e,n]),this.hitDetectionInstructions.push([te.CUSTOM,a,h,e,s||n]);break}this.endGeometry(t)}beginGeometry(e,t){this.beginGeometryInstruction1_=[te.BEGIN_GEOMETRY,t,0,e],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[te.BEGIN_GEOMETRY,t,0,e],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const e=this.hitDetectionInstructions;e.reverse();let t;const n=e.length;let s,r,o=-1;for(t=0;t<n;++t)s=e[t],r=s[0],r==te.END_GEOMETRY?o=t:r==te.BEGIN_GEOMETRY&&(s[2]=t,CM(this.hitDetectionInstructions,o,t),o=-1)}setFillStrokeStyle(e,t){const n=this.state;if(e){const s=e.getColor();n.fillStyle=hn(s||ti)}else n.fillStyle=void 0;if(t){const s=t.getColor();n.strokeStyle=hn(s||na);const r=t.getLineCap();n.lineCap=r!==void 0?r:co;const o=t.getLineDash();n.lineDash=o?o.slice():Pn;const a=t.getLineDashOffset();n.lineDashOffset=a||An;const l=t.getLineJoin();n.lineJoin=l!==void 0?l:uo;const h=t.getWidth();n.lineWidth=h!==void 0?h:ra;const c=t.getMiterLimit();n.miterLimit=c!==void 0?c:ia,n.lineWidth>this.maxLineWidth&&(this.maxLineWidth=n.lineWidth,this.bufferedMaxExtent_=null)}else n.strokeStyle=void 0,n.lineCap=void 0,n.lineDash=null,n.lineDashOffset=void 0,n.lineJoin=void 0,n.lineWidth=void 0,n.miterLimit=void 0}createFill(e){const t=e.fillStyle,n=[te.SET_FILL_STYLE,t];return typeof t!="string"&&n.push(!0),n}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[te.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,this.applyPixelRatio(e.lineDash),e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,t){const n=e.fillStyle;(typeof n!="string"||e.currentFillStyle!=n)&&(n!==void 0&&this.instructions.push(t.call(this,e)),e.currentFillStyle=n)}updateStrokeStyle(e,t){const n=e.strokeStyle,s=e.lineCap,r=e.lineDash,o=e.lineDashOffset,a=e.lineJoin,l=e.lineWidth,h=e.miterLimit;(e.currentStrokeStyle!=n||e.currentLineCap!=s||r!=e.currentLineDash&&!Dn(e.currentLineDash,r)||e.currentLineDashOffset!=o||e.currentLineJoin!=a||e.currentLineWidth!=l||e.currentMiterLimit!=h)&&(n!==void 0&&t.call(this,e),e.currentStrokeStyle=n,e.currentLineCap=s,e.currentLineDash=r,e.currentLineDashOffset=o,e.currentLineJoin=a,e.currentLineWidth=l,e.currentMiterLimit=h)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const t=[te.END_GEOMETRY,e];this.instructions.push(t),this.hitDetectionInstructions.push(t)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=_0(this.maxExtent),this.maxLineWidth>0)){const e=this.resolution*(this.maxLineWidth+1)/2;Vi(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}const Wa=cL;class uL extends Wa{constructor(e,t,n,s){super(e,t,n,s),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,t){if(!this.image_)return;this.beginGeometry(e,t);const n=e.getFlatCoordinates(),s=e.getStride(),r=this.coordinates.length,o=this.appendFlatPointCoordinates(n,s);this.instructions.push([te.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([te.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}drawMultiPoint(e,t){if(!this.image_)return;this.beginGeometry(e,t);const n=e.getFlatCoordinates(),s=e.getStride(),r=this.coordinates.length,o=this.appendFlatPointCoordinates(n,s);this.instructions.push([te.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([te.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,t){const n=e.getAnchor(),s=e.getSize(),r=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=s[1],this.opacity_=e.getOpacity(),this.originX_=r[0],this.originY_=r[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=s[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}const dL=uL;class fL extends Wa{constructor(e,t,n,s){super(e,t,n,s)}drawFlatCoordinates_(e,t,n,s){const r=this.coordinates.length,o=this.appendFlatLineCoordinates(e,t,n,s,!1,!1),a=[te.MOVE_TO_LINE_TO,r,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),n}drawLineString(e,t){const n=this.state,s=n.strokeStyle,r=n.lineWidth;if(s===void 0||r===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(e,t),this.hitDetectionInstructions.push([te.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Pn,An],Fs);const o=e.getFlatCoordinates(),a=e.getStride();this.drawFlatCoordinates_(o,0,o.length,a),this.hitDetectionInstructions.push(es),this.endGeometry(t)}drawMultiLineString(e,t){const n=this.state,s=n.strokeStyle,r=n.lineWidth;if(s===void 0||r===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(e,t),this.hitDetectionInstructions.push([te.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Pn,An],Fs);const o=e.getEnds(),a=e.getFlatCoordinates(),l=e.getStride();let h=0;for(let c=0,u=o.length;c<u;++c)h=this.drawFlatCoordinates_(a,h,o[c],l);this.hitDetectionInstructions.push(es),this.endGeometry(t)}finish(){const e=this.state;return e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&this.instructions.push(es),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(es),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(Fs)}}const gL=fL;class pL extends Wa{constructor(e,t,n,s){super(e,t,n,s)}drawFlatCoordinatess_(e,t,n,s){const r=this.state,o=r.fillStyle!==void 0,a=r.strokeStyle!==void 0,l=n.length;this.instructions.push(Fs),this.hitDetectionInstructions.push(Fs);for(let h=0;h<l;++h){const c=n[h],u=this.coordinates.length,d=this.appendFlatLineCoordinates(e,t,c,s,!0,!a),f=[te.MOVE_TO_LINE_TO,u,d];this.instructions.push(f),this.hitDetectionInstructions.push(f),a&&(this.instructions.push(lm),this.hitDetectionInstructions.push(lm)),t=c}return o&&(this.instructions.push(_l),this.hitDetectionInstructions.push(_l)),a&&(this.instructions.push(es),this.hitDetectionInstructions.push(es)),t}drawCircle(e,t){const n=this.state,s=n.fillStyle,r=n.strokeStyle;if(s===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([te.SET_FILL_STYLE,ti]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([te.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Pn,An]);const o=e.getFlatCoordinates(),a=e.getStride(),l=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,a,!1,!1);const h=[te.CIRCLE,l];this.instructions.push(Fs,h),this.hitDetectionInstructions.push(Fs,h),n.fillStyle!==void 0&&(this.instructions.push(_l),this.hitDetectionInstructions.push(_l)),n.strokeStyle!==void 0&&(this.instructions.push(es),this.hitDetectionInstructions.push(es)),this.endGeometry(t)}drawPolygon(e,t){const n=this.state,s=n.fillStyle,r=n.strokeStyle;if(s===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([te.SET_FILL_STYLE,ti]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([te.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Pn,An]);const o=e.getEnds(),a=e.getOrientedFlatCoordinates(),l=e.getStride();this.drawFlatCoordinatess_(a,0,o,l),this.endGeometry(t)}drawMultiPolygon(e,t){const n=this.state,s=n.fillStyle,r=n.strokeStyle;if(s===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([te.SET_FILL_STYLE,ti]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([te.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Pn,An]);const o=e.getEndss(),a=e.getOrientedFlatCoordinates(),l=e.getStride();let h=0;for(let c=0,u=o.length;c<u;++c)h=this.drawFlatCoordinatess_(a,h,o[c],l);this.endGeometry(t)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(e!==0){const t=this.coordinates;for(let n=0,s=t.length;n<s;++n)t[n]=Ts(t[n],e)}return super.finish()}setFillStrokeStyles_(){const e=this.state;e.fillStyle!==void 0&&this.updateFillStyle(e,this.createFill),e.strokeStyle!==void 0&&this.updateStrokeStyle(e,this.applyStroke)}}const hm=pL;function mL(i,e,t,n,s){const r=[];let o=t,a=0,l=e.slice(t,2);for(;a<i&&o+s<n;){const[h,c]=l.slice(-2),u=e[o+s],d=e[o+s+1],f=Math.sqrt((u-h)*(u-h)+(d-c)*(d-c));if(a+=f,a>=i){const g=(i-a+f)/f,p=ci(h,u,g),m=ci(c,d,g);l.push(p,m),r.push(l),l=[p,m],a==i&&(o+=s),a=0}else if(a<i)l.push(e[o+s],e[o+s+1]),o+=s;else{const g=f-a,p=ci(h,u,g/f),m=ci(c,d,g/f);l.push(p,m),r.push(l),l=[p,m],a=0,o+=s}}return a>0&&r.push(l),r}function yL(i,e,t,n,s){let r=t,o=t,a=0,l=0,h=t,c,u,d,f,g,p,m,_,y,x;for(u=t;u<n;u+=s){const w=e[u],b=e[u+1];g!==void 0&&(y=w-g,x=b-p,f=Math.sqrt(y*y+x*x),m!==void 0&&(l+=d,c=Math.acos((m*y+_*x)/(d*f)),c>i&&(l>a&&(a=l,r=h,o=u),l=0,h=u-s)),d=f,m=y,_=x),g=w,p=b}return l+=f,l>a?[h,u]:[r,o]}const yh={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class _L extends Wa{constructor(e,t,n,s){super(e,t,n,s),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[ti]={fillStyle:ti},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterImageWithText_=void 0}finish(){const e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,t){const n=this.textFillState_,s=this.textStrokeState_,r=this.textState_;if(this.text_===""||!r||!n&&!s)return;const o=this.coordinates;let a=o.length;const l=e.getType();let h=null,c=e.getStride();if(r.placement==="line"&&(l=="LineString"||l=="MultiLineString"||l=="Polygon"||l=="MultiPolygon")){if(!Qe(this.getBufferedMaxExtent(),e.getExtent()))return;let u;if(h=e.getFlatCoordinates(),l=="LineString")u=[h.length];else if(l=="MultiLineString")u=e.getEnds();else if(l=="Polygon")u=e.getEnds().slice(0,1);else if(l=="MultiPolygon"){const p=e.getEndss();u=[];for(let m=0,_=p.length;m<_;++m)u.push(p[m][0])}this.beginGeometry(e,t);const d=r.repeat,f=d?void 0:r.textAlign;let g=0;for(let p=0,m=u.length;p<m;++p){let _;d?_=mL(d*this.resolution,h,g,u[p],c):_=[h.slice(g,u[p])];for(let y=0,x=_.length;y<x;++y){const w=_[y];let b=0,E=w.length;if(f==null){const C=yL(r.maxAngle,w,0,w.length,2);b=C[0],E=C[1]}for(let C=b;C<E;C+=c)o.push(w[C],w[C+1]);const M=o.length;g=u[p],this.drawChars_(a,M),a=M}}this.endGeometry(t)}else{let u=r.overflow?null:[];switch(l){case"Point":case"MultiPoint":h=e.getFlatCoordinates();break;case"LineString":h=e.getFlatMidpoint();break;case"Circle":h=e.getCenter();break;case"MultiLineString":h=e.getFlatMidpoints(),c=2;break;case"Polygon":h=e.getFlatInteriorPoint(),r.overflow||u.push(h[2]/this.resolution),c=3;break;case"MultiPolygon":const _=e.getFlatInteriorPoints();h=[];for(let y=0,x=_.length;y<x;y+=3)r.overflow||u.push(_[y+2]/this.resolution),h.push(_[y],_[y+1]);if(h.length===0)return;c=2;break}const d=this.appendFlatPointCoordinates(h,c);if(d===a)return;if(u&&(d-a)/2!==h.length/c){let _=a/2;u=u.filter((y,x)=>{const w=o[(_+x)*2]===h[x*c]&&o[(_+x)*2+1]===h[x*c+1];return w||--_,w})}this.saveTextStates_(),(r.backgroundFill||r.backgroundStroke)&&(this.setFillStrokeStyle(r.backgroundFill,r.backgroundStroke),r.backgroundFill&&this.updateFillStyle(this.state,this.createFill),r.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(e,t);let f=r.padding;if(f!=As&&(r.scale[0]<0||r.scale[1]<0)){let _=r.padding[0],y=r.padding[1],x=r.padding[2],w=r.padding[3];r.scale[0]<0&&(y=-y,w=-w),r.scale[1]<0&&(_=-_,x=-x),f=[_,y,x,w]}const g=this.pixelRatio;this.instructions.push([te.DRAW_IMAGE,a,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,f==As?As:f.map(function(_){return _*g}),!!r.backgroundFill,!!r.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,u]);const p=1/g,m=this.state.fillStyle;r.backgroundFill&&(this.state.fillStyle=ti,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([te.DRAW_IMAGE,a,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[p,p],NaN,void 0,this.declutterImageWithText_,f,!!r.backgroundFill,!!r.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?ti:this.fillKey_,this.textOffsetX_,this.textOffsetY_,u]),r.backgroundFill&&(this.state.fillStyle=m,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(t)}}saveTextStates_(){const e=this.textStrokeState_,t=this.textState_,n=this.textFillState_,s=this.strokeKey_;e&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));const r=this.textKey_;r in this.textStates||(this.textStates[r]={font:t.font,textAlign:t.textAlign||sa,justify:t.justify,textBaseline:t.textBaseline||ah,scale:t.scale});const o=this.fillKey_;n&&(o in this.fillStates||(this.fillStates[o]={fillStyle:n.fillStyle}))}drawChars_(e,t){const n=this.textStrokeState_,s=this.textState_,r=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,h=yh[s.textBaseline],c=this.textOffsetY_*l,u=this.text_,d=n?n.lineWidth*Math.abs(s.scale[0])/2:0;this.instructions.push([te.DRAW_CHARS,e,t,h,s.overflow,a,s.maxAngle,l,c,r,d*l,u,o,1]),this.hitDetectionInstructions.push([te.DRAW_CHARS,e,t,h,s.overflow,a&&ti,s.maxAngle,l,c,r,d*l,u,o,1/l])}setTextStyle(e,t){let n,s,r;if(!e)this.text_="";else{const o=e.getFill();o?(s=this.textFillState_,s||(s={},this.textFillState_=s),s.fillStyle=hn(o.getColor()||ti)):(s=null,this.textFillState_=s);const a=e.getStroke();if(!a)r=null,this.textStrokeState_=r;else{r=this.textStrokeState_,r||(r={},this.textStrokeState_=r);const g=a.getLineDash(),p=a.getLineDashOffset(),m=a.getWidth(),_=a.getMiterLimit();r.lineCap=a.getLineCap()||co,r.lineDash=g?g.slice():Pn,r.lineDashOffset=p===void 0?An:p,r.lineJoin=a.getLineJoin()||uo,r.lineWidth=m===void 0?ra:m,r.miterLimit=_===void 0?ia:_,r.strokeStyle=hn(a.getColor()||na)}n=this.textState_;const l=e.getFont()||Ly;Py(l);const h=e.getScaleArray();n.overflow=e.getOverflow(),n.font=l,n.maxAngle=e.getMaxAngle(),n.placement=e.getPlacement(),n.textAlign=e.getTextAlign(),n.repeat=e.getRepeat(),n.justify=e.getJustify(),n.textBaseline=e.getTextBaseline()||ah,n.backgroundFill=e.getBackgroundFill(),n.backgroundStroke=e.getBackgroundStroke(),n.padding=e.getPadding()||As,n.scale=h===void 0?[1,1]:h;const c=e.getOffsetX(),u=e.getOffsetY(),d=e.getRotateWithView(),f=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=c===void 0?0:c,this.textOffsetY_=u===void 0?0:u,this.textRotateWithView_=d===void 0?!1:d,this.textRotation_=f===void 0?0:f,this.strokeKey_=r?(typeof r.strokeStyle=="string"?r.strokeStyle:H(r.strokeStyle))+r.lineCap+r.lineDashOffset+"|"+r.lineWidth+r.lineJoin+r.miterLimit+"["+r.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.repeat||"?")+(n.justify||"?")+(n.textBaseline||"?"),this.fillKey_=s?typeof s.fillStyle=="string"?s.fillStyle:"|"+H(s.fillStyle):""}this.declutterImageWithText_=t}}const vL={Circle:hm,Default:Wa,Image:dL,LineString:gL,Polygon:hm,Text:_L};class xL{constructor(e,t,n,s){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=s,this.resolution_=n,this.buildersByZIndex_={}}finish(){const e={};for(const t in this.buildersByZIndex_){e[t]=e[t]||{};const n=this.buildersByZIndex_[t];for(const s in n){const r=n[s].finish();e[t][s]=r}}return e}getBuilder(e,t){const n=e!==void 0?e.toString():"0";let s=this.buildersByZIndex_[n];s===void 0&&(s={},this.buildersByZIndex_[n]=s);let r=s[t];if(r===void 0){const o=vL[t];r=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),s[t]=r}return r}}const _h=xL;class wL extends Ga{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.declutterExecutorGroup=null}getFeatures(e){return ie()}getData(e){return null}prepareFrame(e){return ie()}renderFrame(e,t){return ie()}loadedTileCallback(e,t,n){e[t]||(e[t]={}),e[t][n.tileCoord.toString()]=n}createLoadedTileFinder(e,t,n){return(s,r)=>{const o=this.loadedTileCallback.bind(this,n,s);return e.forEachLoadedTile(t,s,r,o)}}forEachFeatureAtCoordinate(e,t,n,s,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;(t.getState()===oe.LOADED||t.getState()===oe.ERROR)&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=oe.LOADED&&t!=oe.ERROR&&e.addEventListener(ee.CHANGE,this.boundHandleImageChange_),t==oe.IDLE&&(e.load(),t=e.getState()),t==oe.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}}const bL=wL,cm=[];let pr=null;function EL(){pr=Lt(1,1,void 0,{willReadFrequently:!0})}class ML extends bL{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=mi(),this.pixelTransform=mi(),this.inversePixelTransform=mi(),this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(e,t,n){pr||EL(),pr.clearRect(0,0,1,1);let s;try{pr.drawImage(e,t,n,1,1,0,0,1,1),s=pr.getImageData(0,0,1,1).data}catch{return pr=null,null}return s}getBackground(e){let n=this.getLayer().getBackground();return typeof n=="function"&&(n=n(e.viewState.resolution)),n||void 0}useContainer(e,t,n){const s=this.getLayer().getClassName();let r,o;if(e&&e.className===s&&(!n||e&&e.style.backgroundColor&&Dn(sh(e.style.backgroundColor),sh(n)))){const a=e.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===t?(this.container=e,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){r=document.createElement("div"),r.className=s;let a=r.style;a.position="absolute",a.width="100%",a.height="100%",o=Lt();const l=o.canvas;r.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=r,this.context=o}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(e,t,n){const s=yn(n),r=ka(n),o=Fa(n),a=ro(n);ot(t.coordinateToPixelTransform,s),ot(t.coordinateToPixelTransform,r),ot(t.coordinateToPixelTransform,o),ot(t.coordinateToPixelTransform,a);const l=this.inversePixelTransform;ot(l,s),ot(l,r),ot(l,o),ot(l,a),e.save(),e.beginPath(),e.moveTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(r[0]),Math.round(r[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}dispatchRenderEvent_(e,t,n){const s=this.getLayer();if(s.hasListener(e)){const r=new Jy(e,this.inversePixelTransform,n,t);s.dispatchEvent(r)}}preRender(e,t){this.frameState=t,this.dispatchRenderEvent_(dn.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(dn.POSTRENDER,e,t)}getRenderTransform(e,t,n,s,r,o,a){const l=r/2,h=o/2,c=s/t,u=-c,d=-e[0]+a,f=-e[1];return Hi(this.tempTransform,l,h,c,u,-n,d,f)}disposeInternal(){delete this.frameState,super.disposeInternal()}}const Bf=ML;function CL(i,e,t,n,s,r,o,a,l,h,c,u){let d=i[e],f=i[e+1],g=0,p=0,m=0,_=0;function y(){g=d,p=f,e+=n,d=i[e],f=i[e+1],_+=m,m=Math.sqrt((d-g)*(d-g)+(f-p)*(f-p))}do y();while(e<t-n&&_+m<r);let x=m===0?0:(r-_)/m;const w=ci(g,d,x),b=ci(p,f,x),E=e-n,M=_,C=r+a*l(h,s,c);for(;e<t-n&&_+m<C;)y();x=m===0?0:(C-_)/m;const R=ci(g,d,x),N=ci(p,f,x);let D;if(u){const F=[w,b,R,N];jd(F,0,4,2,u,F,F),D=F[0]>F[2]}else D=w>R;const S=Math.PI,B=[],k=E+n===e;e=E,m=0,_=M,d=i[e],f=i[e+1];let I;if(k){y(),I=Math.atan2(f-p,d-g),D&&(I+=I>0?-S:S);const F=(R+w)/2,z=(N+b)/2;return B[0]=[F,z,(C-r)/2,I,s],B}s=s.replace(/\n/g," ");for(let F=0,z=s.length;F<z;){y();let ne=Math.atan2(f-p,d-g);if(D&&(ne+=ne>0?-S:S),I!==void 0){let we=ne-I;if(we+=we>S?-2*S:we<-S?2*S:0,Math.abs(we)>o)return null}I=ne;const Le=F;let P=0;for(;F<z;++F){const we=D?z-F-1:F,ve=a*l(h,s[we],c);if(e+n<t&&_+m<r+P+ve/2)break;P+=ve}if(F===Le)continue;const gt=D?s.substring(z-Le,z-F):s.substring(Le,F);x=m===0?0:(r+P/2-_)/m;const A=ci(g,d,x),We=ci(p,f,x);B.push([A,We,P/2,ne,gt]),r+=P}return B}const or=_i(),Bn=[],En=[],Mn=[],$n=[];function um(i){return i[3].declutterBox}const dm=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function Uc(i,e){return e==="start"?e=dm.test(i)?"right":"left":e==="end"&&(e=dm.test(i)?"left":"right"),yh[e]}function SL(i,e,t){return t>0&&i.push(`
`,""),i.push(e,""),i}class TL{constructor(e,t,n,s){this.overlaps=n,this.pixelRatio=t,this.resolution=e,this.alignFill_,this.instructions=s.instructions,this.coordinates=s.coordinates,this.coordinateCache_={},this.renderedTransform_=mi(),this.hitDetectionInstructions=s.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=s.fillStates||{},this.strokeStates=s.strokeStates||{},this.textStates=s.textStates||{},this.widths_={},this.labels_={}}createLabel(e,t,n,s){const r=e+t+n+s;if(this.labels_[r])return this.labels_[r];const o=s?this.strokeStates[s]:null,a=n?this.fillStates[n]:null,l=this.textStates[t],h=this.pixelRatio,c=[l.scale[0]*h,l.scale[1]*h],u=Array.isArray(e),d=l.justify?yh[l.justify]:Uc(Array.isArray(e)?e[0]:e,l.textAlign||sa),f=s&&o.lineWidth?o.lineWidth:0,g=u?e:e.split(`
`).reduce(SL,[]),{width:p,height:m,widths:_,heights:y,lineWidths:x}=ZC(l,g),w=p+f,b=[],E=(w+2)*c[0],M=(m+f)*c[1],C={width:E<0?Math.floor(E):Math.ceil(E),height:M<0?Math.floor(M):Math.ceil(M),contextInstructions:b};(c[0]!=1||c[1]!=1)&&b.push("scale",c),s&&(b.push("strokeStyle",o.strokeStyle),b.push("lineWidth",f),b.push("lineCap",o.lineCap),b.push("lineJoin",o.lineJoin),b.push("miterLimit",o.miterLimit),b.push("setLineDash",[o.lineDash]),b.push("lineDashOffset",o.lineDashOffset)),n&&b.push("fillStyle",a.fillStyle),b.push("textBaseline","middle"),b.push("textAlign","center");const R=.5-d;let N=d*w+R*f;const D=[],S=[];let B=0,k=0,I=0,F=0,z;for(let ne=0,Le=g.length;ne<Le;ne+=2){const P=g[ne];if(P===`
`){k+=B,B=0,N=d*w+R*f,++F;continue}const gt=g[ne+1]||l.font;gt!==z&&(s&&D.push("font",gt),n&&S.push("font",gt),z=gt),B=Math.max(B,y[I]);const A=[P,N+R*_[I]+d*(_[I]-x[F]),.5*(f+B)+k];N+=_[I],s&&D.push("strokeText",A),n&&S.push("fillText",A),++I}return Array.prototype.push.apply(b,D),Array.prototype.push.apply(b,S),this.labels_[r]=C,C}replayTextBackground_(e,t,n,s,r,o,a){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,n),e.lineTo.apply(e,s),e.lineTo.apply(e,r),e.lineTo.apply(e,t),o&&(this.alignFill_=o[2],this.fill_(e)),a&&(this.setStrokeStyle_(e,a),e.stroke())}calculateImageOrLabelDimensions_(e,t,n,s,r,o,a,l,h,c,u,d,f,g,p,m){a*=d[0],l*=d[1];let _=n-a,y=s-l;const x=r+h>e?e-h:r,w=o+c>t?t-c:o,b=g[3]+x*d[0]+g[1],E=g[0]+w*d[1]+g[2],M=_-g[3],C=y-g[0];(p||u!==0)&&(Bn[0]=M,$n[0]=M,Bn[1]=C,En[1]=C,En[0]=M+b,Mn[0]=En[0],Mn[1]=C+E,$n[1]=Mn[1]);let R;return u!==0?(R=Hi(mi(),n,s,1,1,u,-n,-s),ot(R,Bn),ot(R,En),ot(R,Mn),ot(R,$n),Fi(Math.min(Bn[0],En[0],Mn[0],$n[0]),Math.min(Bn[1],En[1],Mn[1],$n[1]),Math.max(Bn[0],En[0],Mn[0],$n[0]),Math.max(Bn[1],En[1],Mn[1],$n[1]),or)):Fi(Math.min(M,M+b),Math.min(C,C+E),Math.max(M,M+b),Math.max(C,C+E),or),f&&(_=Math.round(_),y=Math.round(y)),{drawImageX:_,drawImageY:y,drawImageW:x,drawImageH:w,originX:h,originY:c,declutterBox:{minX:or[0],minY:or[1],maxX:or[2],maxY:or[3],value:m},canvasTransform:R,scale:d}}replayImageOrLabel_(e,t,n,s,r,o,a){const l=!!(o||a),h=s.declutterBox,c=e.canvas,u=a?a[2]*s.scale[0]/2:0;return h.minX-u<=c.width/t&&h.maxX+u>=0&&h.minY-u<=c.height/t&&h.maxY+u>=0&&(l&&this.replayTextBackground_(e,Bn,En,Mn,$n,o,a),KC(e,s.canvasTransform,r,n,s.originX,s.originY,s.drawImageW,s.drawImageH,s.drawImageX,s.drawImageY,s.scale)),!0}fill_(e){if(this.alignFill_){const t=ot(this.renderedTransform_,[0,0]),n=512*this.pixelRatio;e.save(),e.translate(t[0]%n,t[1]%n),e.rotate(this.viewRotation_)}e.fill(),this.alignFill_&&e.restore()}setStrokeStyle_(e,t){e.strokeStyle=t[1],e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.lineDashOffset=t[7],e.setLineDash(t[6])}drawLabelWithPointPlacement_(e,t,n,s){const r=this.textStates[t],o=this.createLabel(e,t,s,n),a=this.strokeStates[n],l=this.pixelRatio,h=Uc(Array.isArray(e)?e[0]:e,r.textAlign||sa),c=yh[r.textBaseline||ah],u=a&&a.lineWidth?a.lineWidth:0,d=o.width/l-2*r.scale[0],f=h*d+2*(.5-h)*u,g=c*o.height/l+2*(.5-c)*u;return{label:o,anchorX:f,anchorY:g}}execute_(e,t,n,s,r,o,a,l){let h;this.pixelCoordinates_&&Dn(n,this.renderedTransform_)?h=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=ss(this.coordinates,0,this.coordinates.length,2,n,this.pixelCoordinates_),OM(this.renderedTransform_,n));let c=0;const u=s.length;let d=0,f,g,p,m,_,y,x,w,b,E,M,C,R=0,N=0,D=null,S=null;const B=this.coordinateCache_,k=this.viewRotation_,I=Math.round(Math.atan2(-n[1],n[0])*1e12)/1e12,F={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:k},z=this.instructions!=s||this.overlaps?0:200;let ne,Le,P,gt;for(;c<u;){const A=s[c];switch(A[0]){case te.BEGIN_GEOMETRY:ne=A[1],gt=A[3],ne.getGeometry()?a!==void 0&&!Qe(a,gt.getExtent())?c=A[2]+1:++c:c=A[2];break;case te.BEGIN_PATH:R>z&&(this.fill_(e),R=0),N>z&&(e.stroke(),N=0),!R&&!N&&(e.beginPath(),m=NaN,_=NaN),++c;break;case te.CIRCLE:d=A[1];const we=h[d],ve=h[d+1],vt=h[d+2],lt=h[d+3],ht=vt-we,pt=lt-ve,q=Math.sqrt(ht*ht+pt*pt);e.moveTo(we+q,ve),e.arc(we,ve,q,0,2*Math.PI,!0),++c;break;case te.CLOSE_PATH:e.closePath(),++c;break;case te.CUSTOM:d=A[1],f=A[2];const ki=A[3],Oi=A[4],$e=A.length==6?A[5]:void 0;F.geometry=ki,F.feature=ne,c in B||(B[c]=[]);const Ni=B[c];$e?$e(h,d,f,2,Ni):(Ni[0]=h[d],Ni[1]=h[d+1],Ni.length=2),Oi(Ni,F),++c;break;case te.DRAW_IMAGE:d=A[1],f=A[2],w=A[3],g=A[4],p=A[5];let Di=A[6];const Xe=A[7],Gn=A[8],tt=A[9],Ji=A[10];let wi=A[11];const bi=A[12];let ct=A[13];const Pt=A[14],Ce=A[15];if(!w&&A.length>=20){b=A[19],E=A[20],M=A[21],C=A[22];const li=this.drawLabelWithPointPlacement_(b,E,M,C);w=li.label,A[3]=w;const er=A[23];g=(li.anchorX-er)*this.pixelRatio,A[4]=g;const Ei=A[24];p=(li.anchorY-Ei)*this.pixelRatio,A[5]=p,Di=w.height,A[6]=Di,ct=w.width,A[13]=ct}let Pe;A.length>25&&(Pe=A[25]);let Ae,ke,me;A.length>17?(Ae=A[16],ke=A[17],me=A[18]):(Ae=As,ke=!1,me=!1),Ji&&I?wi+=k:!Ji&&!I&&(wi-=k);let Me=0;for(;d<f;d+=2){if(Pe&&Pe[Me++]<ct/this.pixelRatio)continue;const li=this.calculateImageOrLabelDimensions_(w.width,w.height,h[d],h[d+1],ct,Di,g,p,Gn,tt,wi,bi,r,Ae,ke||me,ne),er=[e,t,w,li,Xe,ke?D:null,me?S:null];if(l){if(Pt==="none")continue;if(Pt==="obstacle"){l.insert(li.declutterBox);continue}else{let Ei,xn;if(Ce){const hi=f-d;if(!Ce[hi]){Ce[hi]=er;continue}if(Ei=Ce[hi],delete Ce[hi],xn=um(Ei),l.collides(xn))continue}if(l.collides(li.declutterBox))continue;Ei&&(l.insert(xn),this.replayImageOrLabel_.apply(this,Ei)),l.insert(li.declutterBox)}}this.replayImageOrLabel_.apply(this,er)}++c;break;case te.DRAW_CHARS:const ut=A[1],be=A[2],Mt=A[3],Bt=A[4];C=A[5];const At=A[6],Ft=A[7],Ve=A[8];M=A[9];const mt=A[10];b=A[11],E=A[12];const $t=[A[13],A[13]],Ze=this.textStates[E],ai=Ze.font,vs=[Ze.scale[0]*Ft,Ze.scale[1]*Ft];let xs;ai in this.widths_?xs=this.widths_[ai]:(xs={},this.widths_[ai]=xs);const Ha=ly(h,ut,be,2),Za=Math.abs(vs[0])*xp(ai,b,xs);if(Bt||Za<=Ha){const li=this.textStates[E].textAlign,er=(Ha-Za)*Uc(b,li),Ei=CL(h,ut,be,2,b,er,At,Math.abs(vs[0]),xp,ai,xs,I?0:this.viewRotation_);e:if(Ei){const xn=[];let hi,Ka,Ja,Ht,Mi;if(M)for(hi=0,Ka=Ei.length;hi<Ka;++hi){Mi=Ei[hi],Ja=Mi[4],Ht=this.createLabel(Ja,E,"",M),g=Mi[2]+(vs[0]<0?-mt:mt),p=Mt*Ht.height+(.5-Mt)*2*mt*vs[1]/vs[0]-Ve;const wn=this.calculateImageOrLabelDimensions_(Ht.width,Ht.height,Mi[0],Mi[1],Ht.width,Ht.height,g,p,0,0,Mi[3],$t,!1,As,!1,ne);if(l&&l.collides(wn.declutterBox))break e;xn.push([e,t,Ht,wn,1,null,null])}if(C)for(hi=0,Ka=Ei.length;hi<Ka;++hi){Mi=Ei[hi],Ja=Mi[4],Ht=this.createLabel(Ja,E,C,""),g=Mi[2],p=Mt*Ht.height-Ve;const wn=this.calculateImageOrLabelDimensions_(Ht.width,Ht.height,Mi[0],Mi[1],Ht.width,Ht.height,g,p,0,0,Mi[3],$t,!1,As,!1,ne);if(l&&l.collides(wn.declutterBox))break e;xn.push([e,t,Ht,wn,1,null,null])}l&&l.load(xn.map(um));for(let wn=0,U1=xn.length;wn<U1;++wn)this.replayImageOrLabel_.apply(this,xn[wn])}}++c;break;case te.END_GEOMETRY:if(o!==void 0){ne=A[1];const li=o(ne,gt);if(li)return li}++c;break;case te.FILL:z?R++:this.fill_(e),++c;break;case te.MOVE_TO_LINE_TO:for(d=A[1],f=A[2],Le=h[d],P=h[d+1],y=Le+.5|0,x=P+.5|0,(y!==m||x!==_)&&(e.moveTo(Le,P),m=y,_=x),d+=2;d<f;d+=2)Le=h[d],P=h[d+1],y=Le+.5|0,x=P+.5|0,(d==f-2||y!==m||x!==_)&&(e.lineTo(Le,P),m=y,_=x);++c;break;case te.SET_FILL_STYLE:D=A,this.alignFill_=A[2],R&&(this.fill_(e),R=0,N&&(e.stroke(),N=0)),e.fillStyle=A[1],++c;break;case te.SET_STROKE_STYLE:S=A,N&&(e.stroke(),N=0),this.setStrokeStyle_(e,A),++c;break;case te.STROKE:z?N++:e.stroke(),++c;break;default:++c;break}}R&&this.fill_(e),N&&e.stroke()}execute(e,t,n,s,r,o){this.viewRotation_=s,this.execute_(e,t,n,this.instructions,r,void 0,void 0,o)}executeHitDetection(e,t,n,s,r){return this.viewRotation_=n,this.execute_(e,1,t,this.hitDetectionInstructions,!0,s,r)}}const RL=TL,qc=["Polygon","Circle","LineString","Image","Text","Default"];class IL{constructor(e,t,n,s,r,o){this.maxExtent_=e,this.overlaps_=s,this.pixelRatio_=n,this.resolution_=t,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=mi(),this.createExecutors_(r)}clip(e,t){const n=this.getClipCoords(t);e.beginPath(),e.moveTo(n[0],n[1]),e.lineTo(n[2],n[3]),e.lineTo(n[4],n[5]),e.lineTo(n[6],n[7]),e.clip()}createExecutors_(e){for(const t in e){let n=this.executorsByZIndex_[t];n===void 0&&(n={},this.executorsByZIndex_[t]=n);const s=e[t];for(const r in s){const o=s[r];n[r]=new RL(this.resolution_,this.pixelRatio_,this.overlaps_,o)}}}hasExecutors(e){for(const t in this.executorsByZIndex_){const n=this.executorsByZIndex_[t];for(let s=0,r=e.length;s<r;++s)if(e[s]in n)return!0}return!1}forEachFeatureAtCoordinate(e,t,n,s,r,o){s=Math.round(s);const a=s*2+1,l=Hi(this.hitDetectionTransform_,s+.5,s+.5,1/t,-1/t,-n,-e[0],-e[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=Lt(a,a,void 0,{willReadFrequently:!0}));const c=this.hitDetectionContext_;c.canvas.width!==a||c.canvas.height!==a?(c.canvas.width=a,c.canvas.height=a):h||c.clearRect(0,0,a,a);let u;this.renderBuffer_!==void 0&&(u=_i(),qo(u,e),Vi(u,t*(this.renderBuffer_+s),u));const d=LL(s);let f;function g(b,E){const M=c.getImageData(0,0,a,a).data;for(let C=0,R=d.length;C<R;C++)if(M[d[C]]>0){if(!o||f!=="Image"&&f!=="Text"||o.includes(b)){const N=(d[C]-3)/4,D=s-N%a,S=s-(N/a|0),B=r(b,E,D*D+S*S);if(B)return B}c.clearRect(0,0,a,a);break}}const p=Object.keys(this.executorsByZIndex_).map(Number);p.sort(us);let m,_,y,x,w;for(m=p.length-1;m>=0;--m){const b=p[m].toString();for(y=this.executorsByZIndex_[b],_=qc.length-1;_>=0;--_)if(f=qc[_],x=y[f],x!==void 0&&(w=x.executeHitDetection(c,l,n,g,u),w))return w}}getClipCoords(e){const t=this.maxExtent_;if(!t)return null;const n=t[0],s=t[1],r=t[2],o=t[3],a=[n,s,n,o,r,o,r,s];return ss(a,0,8,2,e,a),a}isEmpty(){return hs(this.executorsByZIndex_)}execute(e,t,n,s,r,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(us),this.maxExtent_&&(e.save(),this.clip(e,n)),o=o||qc;let h,c,u,d,f,g;for(a&&l.reverse(),h=0,c=l.length;h<c;++h){const p=l[h].toString();for(f=this.executorsByZIndex_[p],u=0,d=o.length;u<d;++u){const m=o[u];g=f[m],g!==void 0&&g.execute(e,t,n,s,r,a)}}this.maxExtent_&&e.restore()}}const jc={};function LL(i){if(jc[i]!==void 0)return jc[i];const e=i*2+1,t=i*i,n=new Array(t+1);for(let r=0;r<=i;++r)for(let o=0;o<=i;++o){const a=r*r+o*o;if(a>t)break;let l=n[a];l||(l=[],n[a]=l),l.push(((i+r)*e+(i+o))*4+3),r>0&&l.push(((i-r)*e+(i+o))*4+3),o>0&&(l.push(((i+r)*e+(i-o))*4+3),r>0&&l.push(((i-r)*e+(i-o))*4+3))}const s=[];for(let r=0,o=n.length;r<o;++r)n[r]&&s.push(...n[r]);return jc[i]=s,s}const vh=IL;class PL extends v_{constructor(e,t,n,s,r,o,a){super(),this.context_=e,this.pixelRatio_=t,this.extent_=n,this.transform_=s,this.transformRotation_=s?Oa(Math.atan2(s[1],s[0]),10):0,this.viewRotation_=r,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=mi()}drawImages_(e,t,n,s){if(!this.image_)return;const r=ss(e,t,n,s,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let c=0,u=r.length;c<u;c+=2){const d=r[c]-this.imageAnchorX_,f=r[c+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const g=d+this.imageAnchorX_,p=f+this.imageAnchorY_;Hi(a,g,p,1,1,h,-g,-p),o.save(),o.transform.apply(o,a),o.translate(g,p),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,f,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(e,t,n,s){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const r=ss(e,t,n,s,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);t<n;t+=s){const l=r[t]+this.textOffsetX_,h=r[t+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(l-this.textOffsetX_,h-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,l,h),this.textFillState_&&o.fillText(this.text_,l,h))}}moveToLineTo_(e,t,n,s,r){const o=this.context_,a=ss(e,t,n,s,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;r&&(l-=2);for(let h=2;h<l;h+=2)o.lineTo(a[h],a[h+1]);return r&&o.closePath(),n}drawRings_(e,t,n,s){for(let r=0,o=n.length;r<o;++r)t=this.moveToLineTo_(e,t,n[r],s,!0);return t}drawCircle(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Qe(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=qM(e,this.transform_,this.pixelCoordinates_),n=t[2]-t[0],s=t[3]-t[1],r=Math.sqrt(n*n+s*s),o=this.context_;o.beginPath(),o.arc(t[0],t[1],r,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e);break}}drawFeature(e,t){const n=t.getGeometryFunction()(e);n&&(this.setStyle(t),this.drawGeometry(n))}drawGeometryCollection(e){const t=e.getGeometriesArray();for(let n=0,s=t.length;n<s;++n)this.drawGeometry(t[n])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),n=e.getStride();this.image_&&this.drawImages_(t,0,t.length,n),this.text_!==""&&this.drawText_(t,0,t.length,n)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),n=e.getStride();this.image_&&this.drawImages_(t,0,t.length,n),this.text_!==""&&this.drawText_(t,0,t.length,n)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Qe(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,n=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(n,0,n.length,e.getStride(),!1),t.stroke()}if(this.text_!==""){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getExtent();if(Qe(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const n=this.context_,s=e.getFlatCoordinates();let r=0;const o=e.getEnds(),a=e.getStride();n.beginPath();for(let l=0,h=o.length;l<h;++l)r=this.moveToLineTo_(s,r,o[l],a,!1);n.stroke()}if(this.text_!==""){const n=e.getFlatMidpoints();this.drawText_(n,0,n.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Qe(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Qe(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,n=e.getOrientedFlatCoordinates();let s=0;const r=e.getEndss(),o=e.getStride();t.beginPath();for(let a=0,l=r.length;a<l;++a){const h=r[a];s=this.drawRings_(n,s,h,o)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}}setContextFillState_(e){const t=this.context_,n=this.contextFillState_;n?n.fillStyle!=e.fillStyle&&(n.fillStyle=e.fillStyle,t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const t=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=e.lineCap&&(n.lineCap=e.lineCap,t.lineCap=e.lineCap),Dn(n.lineDash,e.lineDash)||t.setLineDash(n.lineDash=e.lineDash),n.lineDashOffset!=e.lineDashOffset&&(n.lineDashOffset=e.lineDashOffset,t.lineDashOffset=e.lineDashOffset),n.lineJoin!=e.lineJoin&&(n.lineJoin=e.lineJoin,t.lineJoin=e.lineJoin),n.lineWidth!=e.lineWidth&&(n.lineWidth=e.lineWidth,t.lineWidth=e.lineWidth),n.miterLimit!=e.miterLimit&&(n.miterLimit=e.miterLimit,t.miterLimit=e.miterLimit),n.strokeStyle!=e.strokeStyle&&(n.strokeStyle=e.strokeStyle,t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const t=this.context_,n=this.contextTextState_,s=e.textAlign?e.textAlign:sa;n?(n.font!=e.font&&(n.font=e.font,t.font=e.font),n.textAlign!=s&&(n.textAlign=s,t.textAlign=s),n.textBaseline!=e.textBaseline&&(n.textBaseline=e.textBaseline,t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=s,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:s,textBaseline:e.textBaseline})}setFillStrokeStyle(e,t){if(!e)this.fillState_=null;else{const n=e.getColor();this.fillState_={fillStyle:hn(n||ti)}}if(!t)this.strokeState_=null;else{const n=t.getColor(),s=t.getLineCap(),r=t.getLineDash(),o=t.getLineDashOffset(),a=t.getLineJoin(),l=t.getWidth(),h=t.getMiterLimit(),c=r||Pn;this.strokeState_={lineCap:s!==void 0?s:co,lineDash:this.pixelRatio_===1?c:c.map(u=>u*this.pixelRatio_),lineDashOffset:(o||An)*this.pixelRatio_,lineJoin:a!==void 0?a:uo,lineWidth:(l!==void 0?l:ra)*this.pixelRatio_,miterLimit:h!==void 0?h:ia,strokeStyle:hn(n||na)}}}setImageStyle(e){let t;if(!e||!(t=e.getSize())){this.image_=null;return}const n=e.getPixelRatio(this.pixelRatio_),s=e.getAnchor(),r=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*n,this.imageAnchorY_=s[1]*n,this.imageHeight_=t[1]*n,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const o=e.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/n,o[1]*this.pixelRatio_/n],this.imageWidth_=t[0]*n}setTextStyle(e){if(!e)this.text_="";else{const t=e.getFill();if(!t)this.textFillState_=null;else{const f=t.getColor();this.textFillState_={fillStyle:hn(f||ti)}}const n=e.getStroke();if(!n)this.textStrokeState_=null;else{const f=n.getColor(),g=n.getLineCap(),p=n.getLineDash(),m=n.getLineDashOffset(),_=n.getLineJoin(),y=n.getWidth(),x=n.getMiterLimit();this.textStrokeState_={lineCap:g!==void 0?g:co,lineDash:p||Pn,lineDashOffset:m||An,lineJoin:_!==void 0?_:uo,lineWidth:y!==void 0?y:ra,miterLimit:x!==void 0?x:ia,strokeStyle:hn(f||na)}}const s=e.getFont(),r=e.getOffsetX(),o=e.getOffsetY(),a=e.getRotateWithView(),l=e.getRotation(),h=e.getScaleArray(),c=e.getText(),u=e.getTextAlign(),d=e.getTextBaseline();this.textState_={font:s!==void 0?s:Ly,textAlign:u!==void 0?u:sa,textBaseline:d!==void 0?d:ah},this.text_=c!==void 0?Array.isArray(c)?c.reduce((f,g,p)=>f+=p%2?" ":g,""):c:"",this.textOffsetX_=r!==void 0?this.pixelRatio_*r:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const $f=PL,fi=.5;function x_(i,e,t,n,s,r,o){const a=i[0]*fi,l=i[1]*fi,h=Lt(a,l);h.imageSmoothingEnabled=!1;const c=h.canvas,u=new $f(h,fi,s,null,o),d=t.length,f=Math.floor((256*256*256-1)/d),g={};for(let m=1;m<=d;++m){const _=t[m-1],y=_.getStyleFunction()||n;if(!y)continue;let x=y(_,r);if(!x)continue;Array.isArray(x)||(x=[x]);const b=(m*f).toString(16).padStart(7,"#00000");for(let E=0,M=x.length;E<M;++E){const C=x[E],R=C.getGeometryFunction()(_);if(!R||!Qe(s,R.getExtent()))continue;const N=C.clone(),D=N.getFill();D&&D.setColor(b);const S=N.getStroke();S&&(S.setColor(b),S.setLineDash(null)),N.setText(void 0);const B=C.getImage();if(B){const z=B.getImageSize();if(!z)continue;const ne=Lt(z[0],z[1],void 0,{alpha:!1}),Le=ne.canvas;ne.fillStyle=b,ne.fillRect(0,0,Le.width,Le.height),N.setImage(new oh({img:Le,anchor:B.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:B.getOrigin(),opacity:1,size:B.getSize(),scale:B.getScale(),rotation:B.getRotation(),rotateWithView:B.getRotateWithView()}))}const k=N.getZIndex()||0;let I=g[k];I||(I={},g[k]=I,I.Polygon=[],I.Circle=[],I.LineString=[],I.Point=[]);const F=R.getType();if(F==="GeometryCollection"){const z=R.getGeometriesArrayRecursive();for(let ne=0,Le=z.length;ne<Le;++ne){const P=z[ne];I[P.getType().replace("Multi","")].push(P,N)}}else I[F.replace("Multi","")].push(R,N)}}const p=Object.keys(g).map(Number).sort(us);for(let m=0,_=p.length;m<_;++m){const y=g[p[m]];for(const x in y){const w=y[x];for(let b=0,E=w.length;b<E;b+=2){u.setStyle(w[b+1]);for(let M=0,C=e.length;M<C;++M)u.setTransform(e[M]),u.drawGeometry(w[b])}}}return h.getImageData(0,0,c.width,c.height)}function w_(i,e,t){const n=[];if(t){const s=Math.floor(Math.round(i[0])*fi),r=Math.floor(Math.round(i[1])*fi),o=(et(s,0,t.width-1)+et(r,0,t.height-1)*t.width)*4,a=t.data[o],l=t.data[o+1],c=t.data[o+2]+256*(l+256*a),u=Math.floor((256*256*256-1)/e.length);c&&c%u===0&&n.push(e[c/u-1])}return n}const AL=.5,b_={Point:BL,LineString:DL,Polygon:UL,MultiPoint:$L,MultiLineString:GL,MultiPolygon:zL,GeometryCollection:NL,Circle:kL};function FL(i,e){return parseInt(H(i),10)-parseInt(H(e),10)}function Uf(i,e){const t=ed(i,e);return t*t}function ed(i,e){return AL*i/e}function kL(i,e,t,n,s){const r=t.getFill(),o=t.getStroke();if(r||o){const l=i.getBuilder(t.getZIndex(),"Circle");l.setFillStrokeStyle(r,o),l.drawCircle(e,n)}const a=t.getText();if(a&&a.getText()){const l=(s||i).getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,n)}}function xh(i,e,t,n,s,r,o){let a=!1;const l=t.getImage();if(l){const h=l.getImageState();h==oe.LOADED||h==oe.ERROR?l.unlistenImageChange(s):(h==oe.IDLE&&l.load(),l.listenImageChange(s),a=!0)}return OL(i,e,t,n,r,o),a}function OL(i,e,t,n,s,r){const o=t.getGeometryFunction()(e);if(!o)return;const a=o.simplifyTransformed(n,s);if(t.getRenderer())E_(i,a,t,e);else{const h=b_[a.getType()];h(i,a,t,e,r)}}function E_(i,e,t,n){if(e.getType()=="GeometryCollection"){const r=e.getGeometries();for(let o=0,a=r.length;o<a;++o)E_(i,r[o],t,n);return}i.getBuilder(t.getZIndex(),"Default").drawCustom(e,n,t.getRenderer(),t.getHitDetectionRenderer())}function NL(i,e,t,n,s){const r=e.getGeometriesArray();let o,a;for(o=0,a=r.length;o<a;++o){const l=b_[r[o].getType()];l(i,r[o],t,n,s)}}function DL(i,e,t,n,s){const r=t.getStroke();if(r){const a=i.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawLineString(e,n)}const o=t.getText();if(o&&o.getText()){const a=(s||i).getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,n)}}function GL(i,e,t,n,s){const r=t.getStroke();if(r){const a=i.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawMultiLineString(e,n)}const o=t.getText();if(o&&o.getText()){const a=(s||i).getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,n)}}function zL(i,e,t,n,s){const r=t.getFill(),o=t.getStroke();if(o||r){const l=i.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawMultiPolygon(e,n)}const a=t.getText();if(a&&a.getText()){const l=(s||i).getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,n)}}function BL(i,e,t,n,s){const r=t.getImage(),o=t.getText();let a;if(r){if(r.getImageState()!=oe.LOADED)return;let l=i;if(s){const c=r.getDeclutterMode();if(c!=="none")if(l=s,c==="obstacle"){const u=i.getBuilder(t.getZIndex(),"Image");u.setImageStyle(r,a),u.drawPoint(e,n)}else o&&o.getText()&&(a={})}const h=l.getBuilder(t.getZIndex(),"Image");h.setImageStyle(r,a),h.drawPoint(e,n)}if(o&&o.getText()){let l=i;s&&(l=s);const h=l.getBuilder(t.getZIndex(),"Text");h.setTextStyle(o,a),h.drawText(e,n)}}function $L(i,e,t,n,s){const r=t.getImage(),o=t.getText();let a;if(r){if(r.getImageState()!=oe.LOADED)return;let l=i;if(s){const c=r.getDeclutterMode();if(c!=="none")if(l=s,c==="obstacle"){const u=i.getBuilder(t.getZIndex(),"Image");u.setImageStyle(r,a),u.drawMultiPoint(e,n)}else o&&o.getText()&&(a={})}const h=l.getBuilder(t.getZIndex(),"Image");h.setImageStyle(r,a),h.drawMultiPoint(e,n)}if(o&&o.getText()){let l=i;s&&(l=s);const h=l.getBuilder(t.getZIndex(),"Text");h.setTextStyle(o,a),h.drawText(e,n)}}function UL(i,e,t,n,s){const r=t.getFill(),o=t.getStroke();if(r||o){const l=i.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawPolygon(e,n)}const a=t.getText();if(a&&a.getText()){const l=(s||i).getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,n)}}class qL extends Bf{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=_i(),this.wrappedRenderedExtent_=_i(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(e,t,n){const s=t.extent,r=t.viewState,o=r.center,a=r.resolution,l=r.projection,h=r.rotation,c=l.getExtent(),u=this.getLayer().getSource(),d=t.pixelRatio,f=t.viewHints,g=!(f[Ye.ANIMATING]||f[Ye.INTERACTING]),p=this.compositionContext_,m=Math.round(t.size[0]*d),_=Math.round(t.size[1]*d),y=u.getWrapX()&&l.canWrapX(),x=y?Re(c):null,w=y?Math.ceil((s[2]-c[2])/x)+1:1;let b=y?Math.floor((s[0]-c[0])/x):0;do{const E=this.getRenderTransform(o,a,h,d,m,_,b*x);e.execute(p,1,E,h,g,void 0,n)}while(++b<w)}setupCompositionContext_(){if(this.opacity_!==1){const e=Lt(this.context.canvas.width,this.context.canvas.height,cm);this.compositionContext_=e}else this.compositionContext_=this.context}releaseCompositionContext_(){if(this.opacity_!==1){const e=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=e,$a(this.compositionContext_),cm.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(e){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,e,e.declutterTree),this.releaseCompositionContext_())}renderFrame(e,t){const n=e.pixelRatio,s=e.layerStatesArray[e.layerIndex];NM(this.pixelTransform,1/n,1/n),nc(this.inversePixelTransform,this.pixelTransform);const r=qd(this.pixelTransform);this.useContainer(t,r,this.getBackground(e));const o=this.context,a=o.canvas,l=this.replayGroup_,h=this.declutterExecutorGroup;let c=l&&!l.isEmpty()||h&&!h.isEmpty();if(!c&&!(this.getLayer().hasListener(dn.PRERENDER)||this.getLayer().hasListener(dn.POSTRENDER)))return null;const u=Math.round(e.size[0]*n),d=Math.round(e.size[1]*n);a.width!=u||a.height!=d?(a.width=u,a.height=d,a.style.transform!==r&&(a.style.transform=r)):this.containerReused||o.clearRect(0,0,u,d),this.preRender(o,e);const f=e.viewState;f.projection,this.opacity_=s.opacity,this.setupCompositionContext_();let g=!1;if(c&&s.extent&&this.clipping){const p=ln(s.extent);c=Qe(p,e.extent),g=c&&!qi(p,e.extent),g&&this.clipUnrotated(this.compositionContext_,e,p)}return c&&this.renderWorlds(l,e),g&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(o,e),this.renderedRotation_!==f.rotation&&(this.renderedRotation_=f.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(e){return new Promise(t=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const n=[this.context.canvas.width,this.context.canvas.height];ot(this.pixelTransform,n);const s=this.renderedCenter_,r=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),c=[],u=n[0]*fi,d=n[1]*fi;c.push(this.getRenderTransform(s,r,o,fi,u,d,0).slice());const f=h.getSource(),g=a.getExtent();if(f.getWrapX()&&a.canWrapX()&&!qi(g,l)){let p=l[0];const m=Re(g);let _=0,y;for(;p<g[0];)--_,y=m*_,c.push(this.getRenderTransform(s,r,o,fi,u,d,y).slice()),p+=m;for(_=0,p=l[2];p>g[2];)++_,y=m*_,c.push(this.getRenderTransform(s,r,o,fi,u,d,y).slice()),p-=m}this.hitDetectionImageData_=x_(n,c,this.renderedFeatures_,h.getStyleFunction(),l,r,o)}t(w_(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,n,s,r){if(!this.replayGroup_)return;const o=t.viewState.resolution,a=t.viewState.rotation,l=this.getLayer(),h={},c=function(f,g,p){const m=H(f),_=h[m];if(_){if(_!==!0&&p<_.distanceSq){if(p===0)return h[m]=!0,r.splice(r.lastIndexOf(_),1),s(f,l,g);_.geometry=g,_.distanceSq=p}}else{if(p===0)return h[m]=!0,s(f,l,g);r.push(h[m]={feature:f,layer:l,geometry:g,distanceSq:p,callback:s})}};let u;const d=[this.replayGroup_];return this.declutterExecutorGroup&&d.push(this.declutterExecutorGroup),d.some(f=>u=f.forEachFeatureAtCoordinate(e,o,a,n,c,f===this.declutterExecutorGroup&&t.declutterTree?t.declutterTree.all().map(g=>g.value):null)),u}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),n=t.getSource();if(!n)return!1;const s=e.viewHints[Ye.ANIMATING],r=e.viewHints[Ye.INTERACTING],o=t.getUpdateWhileAnimating(),a=t.getUpdateWhileInteracting();if(this.ready&&!o&&s||!a&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=e.extent,h=e.viewState,c=h.projection,u=h.resolution,d=e.pixelRatio,f=t.getRevision(),g=t.getRenderBuffer();let p=t.getRenderOrder();p===void 0&&(p=FL);const m=h.center.slice(),_=Vi(l,g*u),y=_.slice(),x=[_.slice()],w=c.getExtent();if(n.getWrapX()&&c.canWrapX()&&!qi(w,e.extent)){const I=Re(w),F=Math.max(Re(_)/2,I);_[0]=w[0]-F,_[2]=w[2]+F,Pd(m,c);const z=b0(x[0],c);z[0]<w[0]&&z[2]<w[2]?x.push([z[0]+I,z[1],z[2]+I,z[3]]):z[0]>w[0]&&z[2]>w[2]&&x.push([z[0]-I,z[1],z[2]-I,z[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==f&&this.renderedRenderOrder_==p&&qi(this.wrappedRenderedExtent_,_))return Dn(this.renderedExtent_,y)||(this.hitDetectionImageData_=null,this.renderedExtent_=y),this.renderedCenter_=m,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const b=new _h(ed(u,d),_,u,d);let E;this.getLayer().getDeclutter()&&(E=new _h(ed(u,d),_,u,d));let M;for(let I=0,F=x.length;I<F;++I)n.loadFeatures(x[I],u,c);const C=Uf(u,d);let R=!0;const N=I=>{let F;const z=I.getStyleFunction()||t.getStyleFunction();if(z&&(F=z(I,u)),F){const ne=this.renderFeature(I,C,F,b,M,E);R=R&&!ne}},D=Jh(_),S=n.getFeaturesInExtent(D);p&&S.sort(p);for(let I=0,F=S.length;I<F;++I)N(S[I]);this.renderedFeatures_=S,this.ready=R;const B=b.finish(),k=new vh(_,u,d,n.getOverlaps(),B,t.getRenderBuffer());return E&&(this.declutterExecutorGroup=new vh(_,u,d,n.getOverlaps(),E.finish(),t.getRenderBuffer())),this.renderedResolution_=u,this.renderedRevision_=f,this.renderedRenderOrder_=p,this.renderedExtent_=y,this.wrappedRenderedExtent_=_,this.renderedCenter_=m,this.renderedProjection_=c,this.replayGroup_=k,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,n,s,r,o){if(!n)return!1;let a=!1;if(Array.isArray(n))for(let l=0,h=n.length;l<h;++l)a=xh(s,e,n[l],t,this.boundHandleStyleImageChange_,r,o)||a;else a=xh(s,e,n,t,this.boundHandleStyleImageChange_,r,o);return a}}const jL=qL;class WL extends __{constructor(e){super(e)}createRenderer(){return new jL(this)}}const kr=WL,vl={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class xl extends xi{constructor(e,t){super(e),this.feature=t}}function VL(i,e){const t=[];for(let n=0;n<e.length;++n){const r=e[n].getGeometry();M_(i,r,t)}return t}function wl(i,e){return Rn(i[0],i[1],e[0],e[1])}function Sr(i,e){const t=i.length;return e<0?i[e+t]:e>=t?i[e-t]:i[e]}function bl(i,e,t){let n,s;e<t?(n=e,s=t):(n=t,s=e);const r=Math.ceil(n),o=Math.floor(s);if(r>o){const l=Tr(i,n),h=Tr(i,s);return wl(l,h)}let a=0;if(n<r){const l=Tr(i,n),h=Sr(i,r);a+=wl(l,h)}if(o<s){const l=Sr(i,o),h=Tr(i,s);a+=wl(l,h)}for(let l=r;l<o-1;++l){const h=Sr(i,l),c=Sr(i,l+1);a+=wl(h,c)}return a}function M_(i,e,t){if(e instanceof Yi){El(i,e.getCoordinates(),!1,t);return}if(e instanceof Ks){const n=e.getCoordinates();for(let s=0,r=n.length;s<r;++s)El(i,n[s],!1,t);return}if(e instanceof Zi){const n=e.getCoordinates();for(let s=0,r=n.length;s<r;++s)El(i,n[s],!0,t);return}if(e instanceof Js){const n=e.getCoordinates();for(let s=0,r=n.length;s<r;++s){const o=n[s];for(let a=0,l=o.length;a<l;++a)El(i,o[a],!0,t)}return}if(e instanceof ty){const n=e.getGeometries();for(let s=0;s<n.length;++s)M_(i,n[s],t);return}}const Wc={index:-1,endIndex:NaN};function XL(i,e,t,n){const s=i[0],r=i[1];let o=1/0,a=-1,l=NaN;for(let u=0;u<e.targets.length;++u){const d=e.targets[u],f=d.coordinates;let g=1/0,p;for(let m=0;m<f.length-1;++m){const _=f[m],y=f[m+1],x=C_(s,r,_,y);x.squaredDistance<g&&(g=x.squaredDistance,p=m+x.along)}g<o&&(o=g,d.ring&&e.targetIndex===u&&(d.endIndex>d.startIndex?p<d.startIndex&&(p+=f.length):d.endIndex<d.startIndex&&p>d.startIndex&&(p-=f.length)),l=p,a=u)}const h=e.targets[a];let c=h.ring;if(e.targetIndex===a&&c){const u=Tr(h.coordinates,l),d=t.getPixelFromCoordinate(u);Wl(d,e.startPx)>n&&(c=!1)}if(c){const u=h.coordinates,d=u.length,f=h.startIndex,g=l;if(f<g){const p=bl(u,f,g);bl(u,f,g-d)<p&&(l-=d)}else{const p=bl(u,f,g);bl(u,f,g+d)<p&&(l+=d)}}return Wc.index=a,Wc.endIndex=l,Wc}function El(i,e,t,n){const s=i[0],r=i[1];for(let o=0,a=e.length-1;o<a;++o){const l=e[o],h=e[o+1],c=C_(s,r,l,h);if(c.squaredDistance===0){const u=o+c.along;n.push({coordinates:e,ring:t,startIndex:u,endIndex:u});return}}}const Vc={along:0,squaredDistance:0};function C_(i,e,t,n){const s=t[0],r=t[1],o=n[0],a=n[1],l=o-s,h=a-r;let c=0,u=s,d=r;return(l!==0||h!==0)&&(c=et(((i-s)*l+(e-r)*h)/(l*l+h*h),0,1),u+=l*c,d+=h*c),Vc.along=c,Vc.squaredDistance=Oa(Rn(i,e,u,d),10),Vc}function Tr(i,e){const t=i.length;let n=Math.floor(e);const s=e-n;n>=t?n-=t:n<0&&(n+=t);let r=n+1;r>=t&&(r-=t);const o=i[n],a=o[0],l=o[1],h=i[r],c=h[0]-a,u=h[1]-l;return[a+c*s,l+u*s]}class YL extends ms{constructor(e){const t=e;t.stopDown||(t.stopDown=Hs),super(t),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=JL(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:js,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let n=e.geometryFunction;if(!n){const s=this.mode_;if(s==="Circle")n=function(r,o,a){const l=o||new ey([NaN,NaN]),h=je(r[0]),c=un(h,je(r[r.length-1]));return l.setCenterAndRadius(h,Math.sqrt(c),this.geometryLayout_),l};else{let r;s==="Point"?r=Ai:s==="LineString"?r=Yi:s==="Polygon"&&(r=Zi),n=function(o,a,l){return a?s==="Polygon"?o[0].length?a.setCoordinates([o[0].concat([o[0][0]])],this.geometryLayout_):a.setCoordinates([],this.geometryLayout_):a.setCoordinates(o,this.geometryLayout_):a=new r(o,this.geometryLayout_),a}}}this.geometryFunction_=n,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new kr({source:new rs({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:HL(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:Df,this.freehandCondition_,e.freehand?this.freehandCondition_=gh:this.freehandCondition_=e.freehandCondition?e.freehandCondition:t_,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(Ku.ACTIVE,this.updateState_)}setTrace(e){let t;e?e===!0?t=gh:t=e:t=DR,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(e){e.originalEvent.type===ee.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===Se.POINTERMOVE,n=!0;return!this.freehand_&&this.lastDragTime_&&e.type===Se.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===Se.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),n=!1):this.freehand_&&e.type===Se.POINTERDOWN?n=!1:t&&this.getPointerCount()<2?(n=e.type===Se.POINTERMOVE,n&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===Se.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===Se.DBLCLICK&&(n=!1),super.handleEvent(e)&&n}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new Cn(Se.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const t=this.getMap(),n=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),s=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),r=wt([n,s]),o=this.traceSource_.getFeaturesInExtent(r);if(o.length===0)return;const a=VL(e.coordinate,o);a.length&&(this.traceState_={active:!0,startPx:e.pixel.slice(),targets:a,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const n=e.startIndex<=e.endIndex,s=e.startIndex<=t;n===s?n&&t>e.endIndex||!n&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(n&&t<e.endIndex||!n&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let n=0;if(e<t){const s=Math.ceil(e);let r=Math.floor(t);r===t&&(r-=1),n=r-s+1}else{const s=Math.floor(e);let r=Math.ceil(t);r===t&&(r+=1),n=s-r+1}n>0&&this.removeLastPoints_(n)}addTracedCoordinates_(e,t,n){if(t===n)return;const s=[];if(t<n){const r=Math.ceil(t);let o=Math.floor(n);o===n&&(o-=1);for(let a=r;a<=o;++a)s.push(Sr(e.coordinates,a))}else{const r=Math.floor(t);let o=Math.ceil(n);o===n&&(o+=1);for(let a=r;a>=o;--a)s.push(Sr(e.coordinates,a))}s.length&&this.appendCoordinates(s)}updateTrace_(e){const t=this.traceState_;if(!t.active||t.targetIndex===-1&&Wl(t.startPx,e.pixel)<this.snapTolerance_)return;const n=XL(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==n.index){if(t.targetIndex!==-1){const l=t.targets[t.targetIndex];this.removeTracedCoordinates_(l.startIndex,l.endIndex)}const a=t.targets[n.index];this.addTracedCoordinates_(a,a.startIndex,n.endIndex)}else{const a=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(a,n.endIndex)}t.targetIndex=n.index;const s=t.targets[t.targetIndex];s.endIndex=n.endIndex;const r=Tr(s.coordinates,s.endIndex),o=this.getMap().getPixelFromCoordinate(r);e.coordinate=r,e.pixel=[Math.round(o[0]),Math.round(o[1])]}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const n=this.traceState_.active;if(this.toggleTraceState_(e),this.shouldHandle_){const s=!this.finishCoordinate_;s&&this.startDrawing_(e.coordinate),!s&&this.freehand_?this.finishDrawing():!this.freehand_&&(!s||this.mode_==="Point")&&(this.atFinish_(e.pixel,n)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,n=e.pixel,s=t[0]-n[0],r=t[1]-n[1],o=s*s+r*r;if(this.shouldHandle_=this.freehand_?o>this.squaredClickTolerance_:o<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,t){let n=!1;if(this.sketchFeature_){let s=!1,r=[this.finishCoordinate_];const o=this.mode_;if(o==="Point")n=!0;else if(o==="Circle")n=this.sketchCoords_.length===2;else if(o==="LineString")s=!t&&this.sketchCoords_.length>this.minPoints_;else if(o==="Polygon"){const a=this.sketchCoords_;s=a[0].length>this.minPoints_,r=[a[0][0],a[0][a[0].length-2]],t?r=[a[0][0]]:r=[a[0][0],a[0][a[0].length-2]]}if(s){const a=this.getMap();for(let l=0,h=r.length;l<h;l++){const c=r[l],u=a.getPixelFromCoordinate(c),d=e[0]-u[0],f=e[1]-u[1],g=this.freehand_?1:this.snapTolerance_;if(n=Math.sqrt(d*d+f*f)<=g,n){this.finishCoordinate_=c;break}}}}return n}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new rn(new Ai(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new rn);const t=e.getLinearRing(0);let n=this.sketchLine_.getGeometry();n?(n.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),n.changed()):(n=new Yi(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(n))}startDrawing_(e){const t=this.getMap().getView().getProjection(),n=Zl(this.geometryLayout_);for(;e.length<n;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new rn(new Yi(this.sketchLineCoords_)));const s=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new rn,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(s),this.updateSketchFeatures_(),this.dispatchEvent(new xl(vl.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),n=this.sketchFeature_.getGeometry(),s=t.getView().getProjection(),r=Zl(this.geometryLayout_);let o,a;for(;e.length<r;)e.push(0);this.mode_==="Point"?a=this.sketchCoords_:this.mode_==="Polygon"?(o=this.sketchCoords_[0],a=o[o.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(o=this.sketchCoords_,a=o[o.length-1]),a[0]=e[0],a[1]=e[1],this.geometryFunction_(this.sketchCoords_,n,s),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),n.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(n):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),n=this.getMap().getView().getProjection();let s,r;const o=this.mode_;o==="LineString"||o==="Circle"?(this.finishCoordinate_=e.slice(),r=this.sketchCoords_,r.length>=this.maxPoints_&&(this.freehand_?r.pop():s=!0),r.push(e.slice()),this.geometryFunction_(r,t,n)):o==="Polygon"&&(r=this.sketchCoords_[0],r.length>=this.maxPoints_&&(this.freehand_?r.pop():s=!0),r.push(e.slice()),s&&(this.finishCoordinate_=r[0]),this.geometryFunction_(this.sketchCoords_,t,n)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),s&&this.finishDrawing()}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),n=this.getMap().getView().getProjection(),s=this.mode_;for(let r=0;r<e;++r){let o;if(s==="LineString"||s==="Circle"){if(o=this.sketchCoords_,o.splice(-2,1),o.length>=2){this.finishCoordinate_=o[o.length-2].slice();const a=this.finishCoordinate_.slice();o[o.length-1]=a,this.createOrUpdateSketchPoint_(a)}this.geometryFunction_(o,t,n),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(s==="Polygon"){o=this.sketchCoords_[0],o.splice(-2,1);const a=this.sketchLine_.getGeometry();if(o.length>=2){const l=o[o.length-2].slice();o[o.length-1]=l,this.createOrUpdateSketchPoint_(l)}a.setCoordinates(o),this.geometryFunction_(this.sketchCoords_,t,n)}if(o.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return;let t=this.sketchCoords_;const n=e.getGeometry(),s=this.getMap().getView().getProjection();this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,n,s)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,n,s),t=n.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new mo([t])):this.type_==="MultiLineString"?e.setGeometry(new Ks([t])):this.type_==="MultiPolygon"&&e.setGeometry(new Js([t])),this.dispatchEvent(new xl(vl.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e)}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new xl(vl.DRAWABORT,e))}appendCoordinates(e){const t=this.mode_,n=!this.sketchFeature_;n&&this.startDrawing_(e[0]);let s;if(t==="LineString"||t==="Circle")s=this.sketchCoords_;else if(t==="Polygon")s=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;n&&s.shift(),s.pop();for(let o=0;o<e.length;o++)this.addToDrawing_(e[o]);const r=e[e.length-1];this.addToDrawing_(r),this.modifyDrawing_(r)}extend(e){const n=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=n.getCoordinates();const s=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=s.slice(),this.sketchCoords_.push(s.slice()),this.sketchPoint_=new rn(new Ai(s)),this.updateSketchFeatures_(),this.dispatchEvent(new xl(vl.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function HL(){const i=ky();return function(e,t){return i[e.getGeometry().getType()]}}function ZL(i,e){return function(t,n,s){const r=je(t[0]),o=je(t[t.length-1]),a=Math.sqrt(un(r,o));n=n||dy(new ey(r),i);let l=e;if(!e&&e!==0){const h=o[0]-r[0],c=o[1]-r[1];l=Math.atan2(c,h)}return fy(n,r,a,l),n}}function KL(){return function(i,e,t){const n=wt([i[0],i[i.length-1]].map(function(r){return je(r)})),s=[[ro(n),Fa(n),ka(n),yn(n),ro(n)]];return e?e.setCoordinates(s):e=new Zi(s),e}}function JL(i){switch(i){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+i)}}const QL=YL,fm=0,jo=1,gm=[0,0,0,0],Or=[],Xc={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class Yc extends xi{constructor(e,t,n){super(e),this.features=t,this.mapBrowserEvent=n}}class eP extends ms{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:n_,this.defaultDeleteCondition_=function(n){return kR(n)&&GR(n)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:gh,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new ph,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new kr({source:new rs({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:iP(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new Xt(this.source_.getFeatures()),this.source_.addEventListener(Ut.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(Ut.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(bt.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(bt.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const s=this.SEGMENT_WRITERS_[t.getType()];s&&s(e,t)}const n=this.getMap();n&&n.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,n),e.addEventListener(ee.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new Xt;const n=this.featuresBeingModified_.getArray();for(let s=0,r=t.length;s<r;++s){const o=t[s];for(let a=0,l=o.length;a<l;++a){const h=o[a].feature;h&&!n.includes(h)&&this.featuresBeingModified_.push(h)}}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new Yc(Xc.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(ee.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,n=[];t.forEach(function(s){e===s.feature&&n.push(s)});for(let s=n.length-1;s>=0;--s){const r=n[s];for(let o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===r&&this.dragSegments_.splice(o,1);t.remove(r)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const n=t.getCoordinates(),s={feature:e,geometry:t,segment:[n,n]};this.rBush_.insert(t.getExtent(),s)}writeMultiPointGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const o=n[s],a={feature:e,geometry:t,depth:[s],index:s,segment:[o,o]};this.rBush_.insert(t.getExtent(),a)}}writeLineStringGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length-1;s<r;++s){const o=n.slice(s,s+2),a={feature:e,geometry:t,index:s,segment:o};this.rBush_.insert(wt(o),a)}}writeMultiLineStringGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const o=n[s];for(let a=0,l=o.length-1;a<l;++a){const h=o.slice(a,a+2),c={feature:e,geometry:t,depth:[s],index:a,segment:h};this.rBush_.insert(wt(h),c)}}}writePolygonGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const o=n[s];for(let a=0,l=o.length-1;a<l;++a){const h=o.slice(a,a+2),c={feature:e,geometry:t,depth:[s],index:a,segment:h};this.rBush_.insert(wt(h),c)}}}writeMultiPolygonGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const o=n[s];for(let a=0,l=o.length;a<l;++a){const h=o[a];for(let c=0,u=h.length-1;c<u;++c){const d=h.slice(c,c+2),f={feature:e,geometry:t,depth:[a,s],index:c,segment:d};this.rBush_.insert(wt(d),f)}}}}writeCircleGeometry_(e,t){const n=t.getCenter(),s={feature:e,geometry:t,index:fm,segment:[n,n]},r={feature:e,geometry:t,index:jo,segment:[n,n]},o=[s,r];s.featureSegments=o,r.featureSegments=o,this.rBush_.insert(Uo(n),s);let a=t;this.rBush_.insert(a.getExtent(),r)}writeGeometryCollectionGeometry_(e,t){const n=t.getGeometriesArray();for(let s=0;s<n.length;++s){const r=n[s],o=this.SEGMENT_WRITERS_[r.getType()];o(e,r)}}createOrUpdateVertexFeature_(e,t,n){let s=this.vertexFeature_;return s?s.getGeometry().setCoordinates(e):(s=new rn(new Ai(e)),this.vertexFeature_=s,this.overlay_.getSource().addFeature(s)),s.set("features",t),s.set("geometries",n),s}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==Se.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=Se.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==Se.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_);const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],n=[],s=[];for(let r=0,o=this.dragSegments_.length;r<o;++r){const a=this.dragSegments_[r],l=a[0],h=l.feature;n.includes(h)||n.push(h);const c=l.geometry;s.includes(c)||s.push(c);const u=l.depth;let d;const f=l.segment,g=a[1];for(;t.length<c.getStride();)t.push(f[g][t.length]);switch(c.getType()){case"Point":d=t,f[0]=t,f[1]=t;break;case"MultiPoint":d=c.getCoordinates(),d[l.index]=t,f[0]=t,f[1]=t;break;case"LineString":d=c.getCoordinates(),d[l.index+g]=t,f[g]=t;break;case"MultiLineString":d=c.getCoordinates(),d[u[0]][l.index+g]=t,f[g]=t;break;case"Polygon":d=c.getCoordinates(),d[u[0]][l.index+g]=t,f[g]=t;break;case"MultiPolygon":d=c.getCoordinates(),d[u[1]][u[0]][l.index+g]=t,f[g]=t;break;case"Circle":if(f[0]=t,f[1]=t,l.index===fm)this.changingFeature_=!0,c.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let p=Wl(je(c.getCenter()),je(t));c.setRadius(p),this.changingFeature_=!1}break}d&&this.setGeometryCoordinates_(c,d)}this.createOrUpdateVertexFeature_(t,n,s)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate;this.handlePointerAtPixel_(e.pixel,e.map,t),this.dragSegments_.length=0,this.featuresBeingModified_=null;const n=this.vertexFeature_;if(n){e.map.getView().getProjection();const s=[],r=n.getGeometry().getCoordinates(),o=wt([r]),a=this.rBush_.getInExtent(o),l={};a.sort(tP);for(let h=0,c=a.length;h<c;++h){const u=a[h],d=u.segment;let f=H(u.geometry);const g=u.depth;if(g&&(f+="-"+g.join("-")),l[f]||(l[f]=new Array(2)),u.geometry.getType()==="Circle"&&u.index===jo){const p=mm(t,u);Bi(p,r)&&!l[f][0]&&(this.dragSegments_.push([u,0]),l[f][0]=u);continue}if(Bi(d[0],r)&&!l[f][0]){this.dragSegments_.push([u,0]),l[f][0]=u;continue}if(Bi(d[1],r)&&!l[f][1]){if(l[f][0]&&l[f][0].index===0){let p=u.geometry.getCoordinates();switch(u.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":p=p[g[1]];case"Polygon":if(u.index!==p[g[0]].length-2)continue;break}}this.dragSegments_.push([u,1]),l[f][1]=u;continue}H(d)in this.vertexSegments_&&!l[f][0]&&!l[f][1]&&this.insertVertexCondition_(e)&&s.push(u)}s.length&&this.willModifyFeatures_(e,[s]);for(let h=s.length-1;h>=0;--h)this.insertVertex_(s[h],r)}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const n=this.dragSegments_[t][0],s=n.geometry;if(s.getType()==="Circle"){const r=s.getCenter(),o=n.featureSegments[0],a=n.featureSegments[1];o.segment[0]=r,o.segment[1]=r,a.segment[0]=r,a.segment[1]=r,this.rBush_.update(Uo(r),o);let l=s;this.rBush_.update(l.getExtent(),a)}else this.rBush_.update(wt(n.segment),n)}return this.featuresBeingModified_&&(this.dispatchEvent(new Yc(Xc.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map,e.coordinate)}handlePointerAtPixel_(e,t,n){const s=n||t.getCoordinateFromPixel(e);t.getView().getProjection();const r=function(l,h){return pm(s,l)-pm(s,h)};let o,a;if(this.hitDetection_){const l=typeof this.hitDetection_=="object"?h=>h===this.hitDetection_:void 0;t.forEachFeatureAtPixel(e,(h,c,u)=>{u&&u.getType()==="Point"&&(u=new Ai(Us(u.getCoordinates())));const d=u||h.getGeometry();if(h instanceof rn&&this.features_.getArray().includes(h)){a=d;const f=h.getGeometry().getFlatCoordinates().slice(0,2);o=[{feature:h,geometry:a,segment:[f,f]}]}return!0},{layerFilter:l})}if(!o){const l=ln(Uo(s,gm)),h=t.getView().getResolution()*this.pixelTolerance_,c=Jh(Vi(l,h,gm));o=this.rBush_.getInExtent(c)}if(o&&o.length>0){const l=o.sort(r)[0],h=l.segment;let c=mm(s,l);const u=t.getPixelFromCoordinate(c);let d=Wl(e,u);if(a||d<=this.pixelTolerance_){const f={};if(f[H(h)]=!0,this.snapToPointer_||(this.delta_[0]=c[0]-s[0],this.delta_[1]=c[1]-s[1]),l.geometry.getType()==="Circle"&&l.index===jo)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(c,[l.feature],[l.geometry]);else{const g=t.getPixelFromCoordinate(h[0]),p=t.getPixelFromCoordinate(h[1]),m=un(u,g),_=un(u,p);d=Math.sqrt(Math.min(m,_)),this.snappedToVertex_=d<=this.pixelTolerance_,this.snappedToVertex_&&(c=m>_?h[1]:h[0]),this.createOrUpdateVertexFeature_(c,[l.feature],[l.geometry]);const y={};y[H(l.geometry)]=!0;for(let x=1,w=o.length;x<w;++x){const b=o[x].segment;if(Bi(h[0],b[0])&&Bi(h[1],b[1])||Bi(h[0],b[1])&&Bi(h[1],b[0])){const E=H(o[x].geometry);E in y||(y[E]=!0,f[H(b)]=!0)}else break}}this.vertexSegments_=f;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const n=e.segment,s=e.feature,r=e.geometry,o=e.depth,a=e.index;let l;for(;t.length<r.getStride();)t.push(0);switch(r.getType()){case"MultiLineString":l=r.getCoordinates(),l[o[0]].splice(a+1,0,t);break;case"Polygon":l=r.getCoordinates(),l[o[0]].splice(a+1,0,t);break;case"MultiPolygon":l=r.getCoordinates(),l[o[1]][o[0]].splice(a+1,0,t);break;case"LineString":l=r.getCoordinates(),l.splice(a+1,0,t);break;default:return}this.setGeometryCoordinates_(r,l);const h=this.rBush_;h.remove(e),this.updateSegmentIndices_(r,a,o,1);const c={segment:[n[0],t],feature:s,geometry:r,depth:o,index:a};h.insert(wt(c.segment),c),this.dragSegments_.push([c,1]);const u={segment:[t,n[1]],feature:s,geometry:r,depth:o,index:a+1};h.insert(wt(u.segment),u),this.dragSegments_.push([u,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=Se.POINTERDRAG){const e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_);const t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Yc(Xc.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){const e=this.dragSegments_,t={};let n=!1,s,r,o,a,l,h,c,u,d,f,g;for(l=e.length-1;l>=0;--l)o=e[l],f=o[0],g=H(f.feature),f.depth&&(g+="-"+f.depth.join("-")),g in t||(t[g]={}),o[1]===0?(t[g].right=f,t[g].index=f.index):o[1]==1&&(t[g].left=f,t[g].index=f.index+1);for(g in t){switch(d=t[g].right,c=t[g].left,h=t[g].index,u=h-1,c!==void 0?f=c:f=d,u<0&&(u=0),a=f.geometry,r=a.getCoordinates(),s=r,n=!1,a.getType()){case"MultiLineString":r[f.depth[0]].length>2&&(r[f.depth[0]].splice(h,1),n=!0);break;case"LineString":r.length>2&&(r.splice(h,1),n=!0);break;case"MultiPolygon":s=s[f.depth[1]];case"Polygon":s=s[f.depth[0]],s.length>4&&(h==s.length-1&&(h=0),s.splice(h,1),n=!0,h===0&&(s.pop(),s.push(s[0]),u=s.length-1));break}if(n){this.setGeometryCoordinates_(a,r);const p=[];if(c!==void 0&&(this.rBush_.remove(c),p.push(c.segment[0])),d!==void 0&&(this.rBush_.remove(d),p.push(d.segment[1])),c!==void 0&&d!==void 0){const m={depth:f.depth,feature:f.feature,geometry:f.geometry,index:u,segment:p};this.rBush_.insert(wt(m.segment),m)}this.updateSegmentIndices_(a,h,f.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return n}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,n,s){this.rBush_.forEachInExtent(e.getExtent(),function(r){r.geometry===e&&(n===void 0||r.depth===void 0||Dn(r.depth,n))&&r.index>t&&(r.index+=s)})}}function tP(i,e){return i.index-e.index}function pm(i,e,t){const n=e.geometry;if(n.getType()==="Circle"){let r=n;if(e.index===jo){const o=un(r.getCenter(),je(i)),a=Math.sqrt(o)-r.getRadius();return a*a}}const s=je(i);return Or[0]=je(e.segment[0]),Or[1]=je(e.segment[1]),WE(s,Or)}function mm(i,e,t){const n=e.geometry;if(n.getType()==="Circle"&&e.index===jo)return Us(n.getClosestPoint(je(i)));const s=je(i);return Or[0]=je(e.segment[0]),Or[1]=je(e.segment[1]),Us(Id(s,Or))}function iP(){const i=ky();return function(e,t){return i.Point}}const nP=eP,sP={SNAP:"snap"};class rP extends xi{constructor(e,t){super(e),this.vertex=t.vertex,this.vertexPixel=t.vertexPixel,this.feature=t.feature,this.segment=t.segment}}function ym(i){return i.feature?i.feature:i.element?i.element:null}const Hc=[];class oP extends ms{constructor(e){e=e||{};const t=e;t.handleDownEvent||(t.handleDownEvent=js),t.stopDown||(t.stopDown=Hs),super(t),this.on,this.once,this.un,this.source_=e.source?e.source:null,this.vertex_=e.vertex!==void 0?e.vertex:!0,this.edge_=e.edge!==void 0?e.edge:!0,this.features_=e.features?e.features:null,this.featuresListenerKeys_=[],this.featureChangeListenerKeys_={},this.indexedFeaturesExtents_={},this.pendingFeatures_={},this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.rBush_=new ph,this.GEOMETRY_SEGMENTERS_={Point:this.segmentPointGeometry_.bind(this),LineString:this.segmentLineStringGeometry_.bind(this),LinearRing:this.segmentLineStringGeometry_.bind(this),Polygon:this.segmentPolygonGeometry_.bind(this),MultiPoint:this.segmentMultiPointGeometry_.bind(this),MultiLineString:this.segmentMultiLineStringGeometry_.bind(this),MultiPolygon:this.segmentMultiPolygonGeometry_.bind(this),GeometryCollection:this.segmentGeometryCollectionGeometry_.bind(this),Circle:this.segmentCircleGeometry_.bind(this)}}addFeature(e,t){t=t!==void 0?t:!0;const n=H(e),s=e.getGeometry();if(s){const r=this.GEOMETRY_SEGMENTERS_[s.getType()];if(r){this.indexedFeaturesExtents_[n]=s.getExtent(_i());const o=[];if(r(o,s),o.length===1)this.rBush_.insert(wt(o[0]),{feature:e,segment:o[0]});else if(o.length>1){const a=o.map(h=>wt(h)),l=o.map(h=>({feature:e,segment:h}));this.rBush_.load(a,l)}}}t&&(this.featureChangeListenerKeys_[n]=ye(e,ee.CHANGE,this.handleFeatureChange_,this))}getFeatures_(){let e;return this.features_?e=this.features_:this.source_&&(e=this.source_.getFeatures()),e}handleEvent(e){const t=this.snapTo(e.pixel,e.coordinate,e.map);return t&&(e.coordinate=t.vertex.slice(0,2),e.pixel=t.vertexPixel,this.dispatchEvent(new rP(sP.SNAP,{vertex:e.coordinate,vertexPixel:e.pixel,feature:t.feature,segment:t.segment}))),super.handleEvent(e)}handleFeatureAdd_(e){const t=ym(e);t&&this.addFeature(t)}handleFeatureRemove_(e){const t=ym(e);t&&this.removeFeature(t)}handleFeatureChange_(e){const t=e.target;if(this.handlingDownUpSequence){const n=H(t);n in this.pendingFeatures_||(this.pendingFeatures_[n]=t)}else this.updateFeature_(t)}handleUpEvent(e){const t=Object.values(this.pendingFeatures_);return t.length&&(t.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1}removeFeature(e,t){const n=t!==void 0?t:!0,s=H(e),r=this.indexedFeaturesExtents_[s];if(r){const o=this.rBush_,a=[];o.forEachInExtent(r,function(l){e===l.feature&&a.push(l)});for(let l=a.length-1;l>=0;--l)o.remove(a[l])}n&&(qe(this.featureChangeListenerKeys_[s]),delete this.featureChangeListenerKeys_[s])}setMap(e){const t=this.getMap(),n=this.featuresListenerKeys_,s=this.getFeatures_();t&&(n.forEach(qe),n.length=0,this.rBush_.clear(),Object.values(this.featureChangeListenerKeys_).forEach(qe),this.featureChangeListenerKeys_={}),super.setMap(e),e&&(this.features_?n.push(ye(this.features_,bt.ADD,this.handleFeatureAdd_,this),ye(this.features_,bt.REMOVE,this.handleFeatureRemove_,this)):this.source_&&n.push(ye(this.source_,Ut.ADDFEATURE,this.handleFeatureAdd_,this),ye(this.source_,Ut.REMOVEFEATURE,this.handleFeatureRemove_,this)),s.forEach(r=>this.addFeature(r)))}snapTo(e,t,n){n.getView().getProjection();const s=je(t),r=Jh(Vi(wt([s]),n.getView().getResolution()*this.pixelTolerance_)),o=this.rBush_.getInExtent(r),a=o.length;if(a===0)return null;let l,h=1/0,c,u=null;const d=this.pixelTolerance_*this.pixelTolerance_,f=()=>{if(l){const g=n.getPixelFromCoordinate(l);if(un(e,g)<=d)return{vertex:l,vertexPixel:[Math.round(g[0]),Math.round(g[1])],feature:c,segment:u}}return null};if(this.vertex_){for(let p=0;p<a;++p){const m=o[p];m.feature.getGeometry().getType()!=="Circle"&&m.segment.forEach(_=>{const y=je(_),x=un(s,y);x<h&&(l=_,h=x,c=m.feature)})}const g=f();if(g)return g}if(this.edge_){for(let p=0;p<a;++p){let m=null;const _=o[p];if(_.feature.getGeometry().getType()==="Circle"){let y=_.feature.getGeometry();m=qE(s,y)}else{const[y,x]=_.segment;x&&(Hc[0]=je(y),Hc[1]=je(x),m=Id(s,Hc))}if(m){const y=un(s,m);y<h&&(l=Us(m),u=_.feature.getGeometry().getType()==="Circle"?null:_.segment,h=y)}}const g=f();if(g)return g}return null}updateFeature_(e){this.removeFeature(e,!1),this.addFeature(e,!1)}segmentCircleGeometry_(e,t){this.getMap().getView().getProjection();const r=dy(t).getCoordinates()[0];for(let o=0,a=r.length-1;o<a;++o)e.push(r.slice(o,o+2))}segmentGeometryCollectionGeometry_(e,t){const n=t.getGeometriesArray();for(let s=0;s<n.length;++s){const r=this.GEOMETRY_SEGMENTERS_[n[s].getType()];r&&r(e,n[s])}}segmentLineStringGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length-1;s<r;++s)e.push(n.slice(s,s+2))}segmentMultiLineStringGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const o=n[s];for(let a=0,l=o.length-1;a<l;++a)e.push(o.slice(a,a+2))}}segmentMultiPointGeometry_(e,t){t.getCoordinates().forEach(n=>{e.push([n])})}segmentMultiPolygonGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const o=n[s];for(let a=0,l=o.length;a<l;++a){const h=o[a];for(let c=0,u=h.length-1;c<u;++c)e.push(h.slice(c,c+2))}}}segmentPointGeometry_(e,t){e.push([t.getCoordinates()])}segmentPolygonGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const o=n[s];for(let a=0,l=o.length-1;a<l;++a)e.push(o.slice(a,a+2))}}}const aP=oP;function yO(i,e){const t=i.canvas;e=e||{};const n=e.pixelRatio||Bd,s=e.size;s&&(t.width=s[0]*n,t.height=s[1]*n,t.style.width=s[0]+"px",t.style.height=s[1]+"px");const r=[0,0,t.width,t.height],o=Ol(mi(),n,n);return new $f(i,n,r,o,0)}function lP(i){if(!(i.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const e=i.inversePixelTransform[0],t=i.inversePixelTransform[1],n=Math.sqrt(e*e+t*t),s=i.frameState,r=tc(i.inversePixelTransform.slice(),s.coordinateToPixelTransform),o=Uf(s.viewState.resolution,n);let a;return new $f(i.context,n,s.extent,r,s.viewState.rotation,o,a)}function Un(i,e){return ot(i.inversePixelTransform,e.slice(0))}class ni{}v(ni,"INCHES_PER_METER",39.37),v(ni,"PRINT_DOTS_PER_INCH",72),v(ni,"SCREEN_DOTS_PER_INCH",96),v(ni,"METERS_PER_UNIT",Bs);class hP extends vo{constructor(t={}){super(t);v(this,"size",null);v(this,"scale",null);v(this,"context");this.context=Lt(),this.context.canvas.style.opacity="0.5",this.context.canvas.style.position="absolute"}updateSize(t){this.size=t}updateScale(t){this.scale=t}getRotation(){return 0}render(t){if(this.size===null)throw Error("Cannot render Mask : size has not been set.");if(this.scale===null)throw Error("Cannot render Mask : scale has not been set.");const n=t.size[0];this.context.canvas.width=n;const s=t.size[1];this.context.canvas.height=s;const r=[n/2,s/2];this.context.beginPath(),this.context.moveTo(0,0),this.context.lineTo(n,0),this.context.lineTo(n,s),this.context.lineTo(0,s),this.context.lineTo(0,0),this.context.closePath();const o=this.size[1],a=this.size[0],l=t.viewState.resolution,h=a/ni.PRINT_DOTS_PER_INCH/ni.INCHES_PER_METER*this.scale/l/2,c=o/ni.PRINT_DOTS_PER_INCH/ni.INCHES_PER_METER*this.scale/l/2,u=this.getRotation!==void 0?ks(this.getRotation()):0,d=Math.sqrt(Math.pow(h,2)+Math.pow(c,2)),f=Math.atan(c/h)-u,g=Math.atan(h/c)-u,p=r[0]-Math.cos(f)*d,m=r[1]+Math.sin(f)*d,_=r[0]+Math.sin(g)*d,y=r[1]+Math.cos(g)*d,x=r[0]+Math.cos(f)*d,w=r[1]-Math.sin(f)*d,b=r[0]-Math.sin(g)*d,E=r[1]-Math.cos(g)*d;return this.context.moveTo(p,m),this.context.lineTo(_,y),this.context.lineTo(x,w),this.context.lineTo(b,E),this.context.lineTo(p,m),this.context.closePath(),this.context.fillStyle="#000",this.context.fill(),this.context.canvas}}var Nh,S_,Dh,T_,va,td,Gh,R_,zh,I_;class cP{constructor(e,t,n,s){re(this,Nh);re(this,Dh);re(this,va);re(this,Gh);re(this,zh);v(this,"map");v(this,"swiper");v(this,"swiperEventListeners",{});v(this,"swiperMaxVal");v(this,"wmtsManager");v(this,"wmsManager");this.map=e,this.swiper=t;const r=t.getAttribute("max");if(!r)throw new Error("The Attribute <max> on the swiper is not defined !");this.swiperMaxVal=parseInt(r),this.wmtsManager=n,this.wmsManager=s}activateSwipeForWmts(e,t){if(this.wmtsManager.layerExists(e)){const n=this.wmtsManager.getLayer(e);le(this,va,td).call(this,e.layers,n,t)}else throw new Error("Cannot swipe this layer: it does not exist.")}activateSwipeForWms(e,t){if(this.wmsManager.layerExists(e)){this.wmsManager.makeLayerIndependent(e);const n=this.wmsManager.getOLayer(e);le(this,va,td).call(this,e.name,n,t)}else throw new Error("Layer does not exists. Cannot activate swiper.")}deactivateSwipe(){for(const[e,t]of Object.entries(this.swiperEventListeners))t.olayer.removeEventListener("prerender",t.prerender),t.olayer.removeEventListener("postrender",t.postrender);le(this,Dh,T_).call(this),this.map.render()}}Nh=new WeakSet,S_=function(){this.swiper.style.display="block"},Dh=new WeakSet,T_=function(){this.swiper.style.display="none"},va=new WeakSet,td=function(e,t,n){if(e in this.swiperEventListeners){const o=this.swiperEventListeners[e];t.removeEventListener("prerender",o.prerender),t.removeEventListener("postrender",o.postrender),delete this.swiperEventListeners[e]}const s=o=>le(this,Gh,R_).call(this,o,n),r=o=>le(this,zh,I_).call(this,o);this.swiperEventListeners[e]={olayer:t,prerender:s,postrender:r},t.addEventListener("prerender",s),t.addEventListener("postrender",r),le(this,Nh,S_).call(this),this.map.render()},Gh=new WeakSet,R_=function(e,t){const n=e.context,s=this.map.getSize();if(!s)throw new Error("The size of the map is null !");const r=s,o=r[0]*(parseInt(this.swiper.value)/this.swiperMaxVal);let a=null,l=null,h=null,c=null;if(t==="right")a=Un(e,[o,0]),l=Un(e,[r[0],0]),h=Un(e,[o,r[1]]),c=Un(e,r);else if(t==="left")a=Un(e,[0,0]),l=Un(e,[o,0]),h=Un(e,[0,r[1]]),c=Un(e,[o,r[1]]);else throw new Error("Invalid value for parameter side");n.save(),n.beginPath(),n.moveTo(a[0],a[1]),n.lineTo(h[0],h[1]),n.lineTo(c[0],c[1]),n.lineTo(l[0],l[1]),n.closePath(),n.clip()},zh=new WeakSet,I_=function(e){e.context.restore()};const L_=.5;class uP extends Da{constructor(e,t,n){super(),n=n||{},this.tileCoord=e,this.state=t,this.interimTile=null,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(ee.CHANGE)}release(){this.state===$.ERROR&&this.setState($.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let e=this.interimTile;if(!e)return this;do{if(e.getState()==$.LOADED)return this.transition_=0,e;e=e.interimTile}while(e);return this}refreshInterimChain(){let e=this.interimTile;if(!e)return;let t=this;do{if(e.getState()==$.LOADED){e.interimTile=null;break}e.getState()==$.LOADING?t=e:e.getState()==$.IDLE?t.interimTile=e.interimTile:t=e,e=t.interimTile}while(e)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==$.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}load(){ie()}getAlpha(e,t){if(!this.transition_)return 1;let n=this.transitionStarts_[e];if(!n)n=t,this.transitionStarts_[e]=n;else if(n===-1)return 1;const s=t-n+1e3/60;return s>=this.transition_?1:Ky(s/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}}const gc=uP,dP=10,_m=.25;class fP{constructor(e,t,n,s,r,o){this.sourceProj_=e,this.targetProj_=t;let a={};const l=oo(this.targetProj_,this.sourceProj_);this.transformInv_=function(y){const x=y[0]+"/"+y[1];return a[x]||(a[x]=l(y)),a[x]},this.maxSourceExtent_=s,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!s&&!!this.sourceProj_.getExtent()&&Re(s)>=Re(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Re(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Re(this.targetProj_.getExtent()):null;const h=yn(n),c=ka(n),u=Fa(n),d=ro(n),f=this.transformInv_(h),g=this.transformInv_(c),p=this.transformInv_(u),m=this.transformInv_(d),_=dP+(o?Math.max(0,Math.ceil(Math.log2(Cu(n)/(o*o*256*256)))):0);if(this.addQuad_(h,c,u,d,f,g,p,m,_),this.wrapsXInSource_){let y=1/0;this.triangles_.forEach(function(x,w,b){y=Math.min(y,x.source[0][0],x.source[1][0],x.source[2][0])}),this.triangles_.forEach(x=>{if(Math.max(x.source[0][0],x.source[1][0],x.source[2][0])-y>this.sourceWorldWidth_/2){const w=[[x.source[0][0],x.source[0][1]],[x.source[1][0],x.source[1][1]],[x.source[2][0],x.source[2][1]]];w[0][0]-y>this.sourceWorldWidth_/2&&(w[0][0]-=this.sourceWorldWidth_),w[1][0]-y>this.sourceWorldWidth_/2&&(w[1][0]-=this.sourceWorldWidth_),w[2][0]-y>this.sourceWorldWidth_/2&&(w[2][0]-=this.sourceWorldWidth_);const b=Math.min(w[0][0],w[1][0],w[2][0]);Math.max(w[0][0],w[1][0],w[2][0])-b<this.sourceWorldWidth_/2&&(x.source=w)}})}a={}}addTriangle_(e,t,n,s,r,o){this.triangles_.push({source:[s,r,o],target:[e,t,n]})}addQuad_(e,t,n,s,r,o,a,l,h){const c=wt([r,o,a,l]),u=this.sourceWorldWidth_?Re(c)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,f=this.sourceProj_.canWrapX()&&u>.5&&u<1;let g=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const m=wt([e,t,n,s]);g=Re(m)/this.targetWorldWidth_>_m||g}!f&&this.sourceProj_.isGlobal()&&u&&(g=u>_m||g)}if(!g&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!Qe(c,this.maxSourceExtent_))return;let p=0;if(!g&&(!isFinite(r[0])||!isFinite(r[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)g=!0;else if(p=(!isFinite(r[0])||!isFinite(r[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),p!=1&&p!=2&&p!=4&&p!=8)return}if(h>0){if(!g){const m=[(e[0]+n[0])/2,(e[1]+n[1])/2],_=this.transformInv_(m);let y;f?y=(Os(r[0],d)+Os(a[0],d))/2-Os(_[0],d):y=(r[0]+a[0])/2-_[0];const x=(r[1]+a[1])/2-_[1];g=y*y+x*x>this.errorThresholdSquared_}if(g){if(Math.abs(e[0]-n[0])<=Math.abs(e[1]-n[1])){const m=[(t[0]+n[0])/2,(t[1]+n[1])/2],_=this.transformInv_(m),y=[(s[0]+e[0])/2,(s[1]+e[1])/2],x=this.transformInv_(y);this.addQuad_(e,t,m,y,r,o,_,x,h-1),this.addQuad_(y,m,n,s,x,_,a,l,h-1)}else{const m=[(e[0]+t[0])/2,(e[1]+t[1])/2],_=this.transformInv_(m),y=[(n[0]+s[0])/2,(n[1]+s[1])/2],x=this.transformInv_(y);this.addQuad_(e,m,y,s,r,_,x,l,h-1),this.addQuad_(m,t,n,y,_,o,a,x,h-1)}return}}if(f){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}p&11||this.addTriangle_(e,n,s,r,a,l),p&14||this.addTriangle_(e,n,t,r,a,o),p&&(p&13||this.addTriangle_(t,s,e,o,l,r),p&7||this.addTriangle_(t,s,n,o,l,a))}calculateSourceExtent(){const e=_i();return this.triangles_.forEach(function(t,n,s){const r=t.source;qo(e,r[0]),qo(e,r[1]),qo(e,r[2])}),e}getTriangles(){return this.triangles_}}const P_=fP;let Zc;const Nr=[];function vm(i,e,t,n,s){i.beginPath(),i.moveTo(0,0),i.lineTo(e,t),i.lineTo(n,s),i.closePath(),i.save(),i.clip(),i.fillRect(0,0,Math.max(e,n)+1,Math.max(t,s)),i.restore()}function Kc(i,e){return Math.abs(i[e*4]-210)>2||Math.abs(i[e*4+3]-.75*255)>2}function gP(){if(Zc===void 0){const i=Lt(6,6,Nr);i.globalCompositeOperation="lighter",i.fillStyle="rgba(210, 0, 0, 0.75)",vm(i,4,5,4,0),vm(i,4,5,0,5);const e=i.getImageData(0,0,3,3).data;Zc=Kc(e,0)||Kc(e,4)||Kc(e,8),$a(i),Nr.push(i.canvas)}return Zc}function wh(i,e,t,n){const s=Fr(t,e,i);let r=Vl(e,n,t);const o=e.getMetersPerUnit();o!==void 0&&(r*=o);const a=i.getMetersPerUnit();a!==void 0&&(r/=a);const l=i.getExtent();if(!l||Aa(l,s)){const h=Vl(i,r,s)/r;isFinite(h)&&h>0&&(r/=h)}return r}function pP(i,e,t,n){const s=pi(t);let r=wh(i,e,s,n);return(!isFinite(r)||r<=0)&&Rd(t,function(o){return r=wh(i,e,o,n),isFinite(r)&&r>0}),r}function A_(i,e,t,n,s,r,o,a,l,h,c,u,d){const f=Lt(Math.round(t*i),Math.round(t*e),Nr);if(u||(f.imageSmoothingEnabled=!1),l.length===0)return f.canvas;f.scale(t,t);function g(y){return Math.round(y*t)/t}f.globalCompositeOperation="lighter";const p=_i();l.forEach(function(y,x,w){v0(p,y.extent)});let m;if(!d||l.length!==1||h!==0){const y=Re(p),x=_t(p);m=Lt(Math.round(t*y/n),Math.round(t*x/n),Nr),u||(m.imageSmoothingEnabled=!1);const w=t/n;l.forEach(function(b,E,M){const C=b.extent[0]-p[0],R=-(b.extent[3]-p[3]),N=Re(b.extent),D=_t(b.extent);b.image.width>0&&b.image.height>0&&m.drawImage(b.image,h,h,b.image.width-2*h,b.image.height-2*h,C*w,R*w,N*w,D*w)})}const _=yn(o);return a.getTriangles().forEach(function(y,x,w){const b=y.source,E=y.target;let M=b[0][0],C=b[0][1],R=b[1][0],N=b[1][1],D=b[2][0],S=b[2][1];const B=g((E[0][0]-_[0])/r),k=g(-(E[0][1]-_[1])/r),I=g((E[1][0]-_[0])/r),F=g(-(E[1][1]-_[1])/r),z=g((E[2][0]-_[0])/r),ne=g(-(E[2][1]-_[1])/r),Le=M,P=C;M=0,C=0,R-=Le,N-=P,D-=Le,S-=P;const gt=[[R,N,0,0,I-B],[D,S,0,0,z-B],[0,0,R,N,F-k],[0,0,D,S,ne-k]],A=$E(gt);if(!A)return;if(f.save(),f.beginPath(),gP()||!u){f.moveTo(I,F);const we=4,ve=B-I,vt=k-F;for(let lt=0;lt<we;lt++)f.lineTo(I+g((lt+1)*ve/we),F+g(lt*vt/(we-1))),lt!=we-1&&f.lineTo(I+g((lt+1)*ve/we),F+g((lt+1)*vt/(we-1)));f.lineTo(z,ne)}else f.moveTo(I,F),f.lineTo(B,k),f.lineTo(z,ne);f.clip(),f.transform(A[0],A[2],A[1],A[3],B,k),f.translate(p[0]-Le,p[3]-P);let We;if(m)We=m.canvas,f.scale(n/t,-n/t);else{const we=l[0],ve=we.extent;We=we.image,f.scale(Re(ve)/We.width,-_t(ve)/We.height)}f.drawImage(We,0,0),f.restore()}),m&&($a(m),Nr.push(m.canvas)),c&&(f.save(),f.globalCompositeOperation="source-over",f.strokeStyle="black",f.lineWidth=1,a.getTriangles().forEach(function(y,x,w){const b=y.target,E=(b[0][0]-_[0])/r,M=-(b[0][1]-_[1])/r,C=(b[1][0]-_[0])/r,R=-(b[1][1]-_[1])/r,N=(b[2][0]-_[0])/r,D=-(b[2][1]-_[1])/r;f.beginPath(),f.moveTo(C,R),f.lineTo(E,M),f.lineTo(N,D),f.closePath(),f.stroke()}),f.restore()),f.canvas}class mP extends gc{constructor(e,t,n,s,r,o,a,l,h,c,u,d){super(r,$.IDLE,d),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=s,this.wrappedTileCoord_=o||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const f=s.getTileCoordExtent(this.wrappedTileCoord_),g=this.targetTileGrid_.getExtent();let p=this.sourceTileGrid_.getExtent();const m=g?Tn(f,g):f;if(Cu(m)===0){this.state=$.EMPTY;return}const _=e.getExtent();_&&(p?p=Tn(p,_):p=_);const y=s.getResolution(this.wrappedTileCoord_[0]),x=pP(e,n,m,y);if(!isFinite(x)||x<=0){this.state=$.EMPTY;return}const w=c!==void 0?c:L_;if(this.triangulation_=new P_(e,n,m,p,x*w,y),this.triangulation_.getTriangles().length===0){this.state=$.EMPTY;return}this.sourceZ_=t.getZForResolution(x);let b=this.triangulation_.calculateSourceExtent();if(p&&(e.canWrapX()?(b[1]=et(b[1],p[1],p[3]),b[3]=et(b[3],p[1],p[3])):b=Tn(b,p)),!Cu(b))this.state=$.EMPTY;else{const E=t.getTileRangeForExtentAndZ(b,this.sourceZ_);for(let M=E.minX;M<=E.maxX;M++)for(let C=E.minY;C<=E.maxY;C++){const R=h(this.sourceZ_,M,C,a);R&&this.sourceTiles_.push(R)}this.sourceTiles_.length===0&&(this.state=$.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{t&&t.getState()==$.LOADED&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}),this.sourceTiles_.length=0,e.length===0)this.state=$.ERROR;else{const t=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(t),s=typeof n=="number"?n:n[0],r=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=A_(s,r,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=$.LOADED}this.changed()}load(){if(this.state==$.IDLE){this.state=$.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const n=t.getState();if(n==$.IDLE||n==$.LOADING){e++;const s=ye(t,ee.CHANGE,function(r){const o=t.getState();(o==$.LOADED||o==$.ERROR||o==$.EMPTY)&&(qe(s),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(s)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t,n,s){t.getState()==$.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(qe),this.sourcesListenerKeys_=null}release(){this.canvas_&&($a(this.canvas_.getContext("2d")),Nr.push(this.canvas_),this.canvas_=null),super.release()}}const id=mP;class yP extends gc{constructor(e,t,n,s,r,o){super(e,t,o),this.crossOrigin_=s,this.src_=n,this.key=n,this.image_=new Image,s!==null&&(this.image_.crossOrigin=s),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(e){this.image_=e,this.state=$.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=$.ERROR,this.unlistenImage_(),this.image_=_P(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=$.LOADED:this.state=$.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==$.ERROR&&(this.state=$.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==$.IDLE&&(this.state=$.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=qC(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function _P(){const i=Lt(1,1);return i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,1,1),i.canvas}const F_=yP;class vP{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const n=this.entries_[e];return _e(n!==void 0,"Tried to get a value for a key that does not exist in the cache"),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(e){const t=this.entries_[e];return _e(t!==void 0,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,n;for(n=this.newest_;n;n=n.older)e[t++]=n.key_;return e}getValues(){const e=new Array(this.count_);let t=0,n;for(n=this.newest_;n;n=n.older)e[t++]=n.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){var t;return(t=this.entries_[e])==null?void 0:t.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){_e(!(e in this.entries_),"Tried to set a value for a key that is used already");const n={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[e]=n,++this.count_}setSize(e){this.highWaterMark=e}}const xP=vP;class k_{constructor(e,t,n,s){this.minX=e,this.maxX=t,this.minY=n,this.maxY=s}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function ar(i,e,t,n,s){return s!==void 0?(s.minX=i,s.maxX=e,s.minY=t,s.maxY=n,s):new k_(i,e,t,n)}const O_=k_;function xm(i,e,t,n){return n!==void 0?(n[0]=i,n[1]=e,n[2]=t,n):[i,e,t]}function bo(i,e,t){return i+"/"+e+"/"+t}function N_(i){return bo(i[0],i[1],i[2])}function wP(i){const[e,t,n]=i.substring(i.lastIndexOf("/")+1,i.length).split(",").map(Number);return bo(e,t,n)}function D_(i){return i.split("/").map(Number)}function bP(i){return(i[1]<<i[0])+i[2]}function EP(i,e){const t=i[0],n=i[1],s=i[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const r=e.getFullTileRange(t);return r?r.containsXY(n,s):!0}class MP extends vo{constructor(e){e=e||{},super(e)}}const CP=MP;class SP extends Bf{constructor(e){super(e),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],n=e.pixelRatio,s=e.viewState,r=s.resolution,o=this.getLayer().getSource(),a=e.viewHints;let l=e.extent;if(t.extent!==void 0&&(l=Tn(l,ln(t.extent,s.projection))),!a[Ye.ANIMATING]&&!a[Ye.INTERACTING]&&!Ys(l))if(o){const h=s.projection,c=o.getImage(l,r,n,h);c&&(this.loadImage(c)?this.image_=c:c.getState()===oe.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(e){const t=this.frameState;if(!t)return null;const n=this.getLayer(),s=ot(t.pixelToCoordinateTransform,e.slice()),r=n.getExtent();if(r&&!Aa(r,s))return null;const o=this.image_.getExtent(),a=this.image_.getImage(),l=Re(o),h=Math.floor(a.width*((s[0]-o[0])/l));if(h<0||h>=a.width)return null;const c=_t(o),u=Math.floor(a.height*((o[3]-s[1])/c));return u<0||u>=a.height?null:this.getImageData(a,h,u)}renderFrame(e,t){const n=this.image_,s=n.getExtent(),r=n.getResolution(),[o,a]=Array.isArray(r)?r:[r,r],l=n.getPixelRatio(),h=e.layerStatesArray[e.layerIndex],c=e.pixelRatio,u=e.viewState,d=u.center,f=u.resolution,g=c*o/(f*l),p=c*a/(f*l),m=e.extent,_=u.resolution,y=u.rotation,x=Math.round(Re(m)/_*c),w=Math.round(_t(m)/_*c);Hi(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/c,1/c,y,-x/2,-w/2),nc(this.inversePixelTransform,this.pixelTransform);const b=qd(this.pixelTransform);this.useContainer(t,b,this.getBackground(e));const E=this.context,M=E.canvas;M.width!=x||M.height!=w?(M.width=x,M.height=w):this.containerReused||E.clearRect(0,0,x,w);let C=!1,R=!0;if(h.extent){const k=ln(h.extent,u.projection);R=Qe(k,e.extent),C=R&&!qi(k,e.extent),C&&this.clipUnrotated(E,e,k)}const N=n.getImage(),D=Hi(this.tempTransform,x/2,w/2,g,p,0,l*(s[0]-d[0])/o,l*(d[1]-s[3])/a);this.renderedResolution=a*c/l;const S=N.width*D[0],B=N.height*D[3];if(this.getLayer().getSource().getInterpolate()||(E.imageSmoothingEnabled=!1),this.preRender(E,e),R&&S>=.5&&B>=.5){const k=D[4],I=D[5],F=h.opacity;let z;F!==1&&(z=E.globalAlpha,E.globalAlpha=F),E.drawImage(N,0,0,+N.width,+N.height,k,I,S,B),F!==1&&(E.globalAlpha=z)}return this.postRender(E,e),C&&E.restore(),E.imageSmoothingEnabled=!0,b!==M.style.transform&&(M.style.transform=b),this.container}}const TP=SP;class RP extends CP{constructor(e){super(e)}createRenderer(){return new TP(this)}getData(e){return super.getData(e)}}const Jc=RP,ts={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class IP extends vo{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getPreload(){return this.get(ts.PRELOAD)}setPreload(e){this.set(ts.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(ts.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(ts.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}const LP=IP;class PP extends Bf{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=_i(),this.tmpTileRange_=new O_(0,0,0,0)}isDrawableTile(e){const t=this.getLayer(),n=e.getState(),s=t.getUseInterimTilesOnError();return n==$.LOADED||n==$.EMPTY||n==$.ERROR&&!s}getTile(e,t,n,s){const r=s.pixelRatio,o=s.viewState.projection,a=this.getLayer();let h=a.getSource().getTile(e,t,n,r,o);return h.getState()==$.ERROR&&a.getUseInterimTilesOnError()&&a.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(h)||(h=h.getInterimTile()),h}getData(e){const t=this.frameState;if(!t)return null;const n=this.getLayer(),s=ot(t.pixelToCoordinateTransform,e.slice()),r=n.getExtent();if(r&&!Aa(r,s))return null;const o=t.pixelRatio,a=t.viewState.projection,l=t.viewState,h=n.getRenderSource(),c=h.getTileGridForProjection(l.projection),u=h.getTilePixelRatio(t.pixelRatio);for(let d=c.getZForResolution(l.resolution);d>=c.getMinZoom();--d){const f=c.getTileCoordForCoordAndZ(s,d),g=h.getTile(d,f[1],f[2],o,a);if(!(g instanceof F_||g instanceof id)||g instanceof id&&g.getState()===$.EMPTY)return null;if(g.getState()!==$.LOADED)continue;const p=c.getOrigin(d),m=Vt(c.getTileSize(d)),_=c.getResolution(d),y=Math.floor(u*((s[0]-p[0])/_-f[1]*m[0])),x=Math.floor(u*((p[1]-s[1])/_-f[2]*m[1])),w=Math.round(u*h.getGutterForProjection(l.projection));return this.getImageData(g.getImage(),y+w,x+w)}return null}loadedTileCallback(e,t,n){return this.isDrawableTile(n)?super.loadedTileCallback(e,t,n):!1}prepareFrame(e){return!!this.getLayer().getSource()}renderFrame(e,t){const n=e.layerStatesArray[e.layerIndex],s=e.viewState,r=s.projection,o=s.resolution,a=s.center,l=s.rotation,h=e.pixelRatio,c=this.getLayer(),u=c.getSource(),d=u.getRevision(),f=u.getTileGridForProjection(r),g=f.getZForResolution(o,u.zDirection),p=f.getResolution(g);let m=e.extent;const _=e.viewState.resolution,y=u.getTilePixelRatio(h),x=Math.round(Re(m)/_*h),w=Math.round(_t(m)/_*h),b=n.extent&&ln(n.extent);b&&(m=Tn(m,ln(n.extent)));const E=p*x/2/y,M=p*w/2/y,C=[a[0]-E,a[1]-M,a[0]+E,a[1]+M],R=f.getTileRangeForExtentAndZ(m,g),N={};N[g]={};const D=this.createLoadedTileFinder(u,r,N),S=this.tmpExtent,B=this.tmpTileRange_;this.newTiles_=!1;const k=l?Su(s.center,_,l,e.size):void 0;for(let We=R.minX;We<=R.maxX;++We)for(let we=R.minY;we<=R.maxY;++we){if(l&&!f.tileCoordIntersectsViewport([g,We,we],k))continue;const ve=this.getTile(g,We,we,e);if(this.isDrawableTile(ve)){const ht=H(this);if(ve.getState()==$.LOADED){N[g][ve.tileCoord.toString()]=ve;let pt=ve.inTransition(ht);pt&&n.opacity!==1&&(ve.endTransition(ht),pt=!1),!this.newTiles_&&(pt||!this.renderedTiles.includes(ve))&&(this.newTiles_=!0)}if(ve.getAlpha(ht,e.time)===1)continue}const vt=f.getTileCoordChildTileRange(ve.tileCoord,B,S);let lt=!1;vt&&(lt=D(g+1,vt)),lt||f.forEachTileCoordParentTileRange(ve.tileCoord,D,B,S)}const I=p/o*h/y;Hi(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/h,1/h,l,-x/2,-w/2);const F=qd(this.pixelTransform);this.useContainer(t,F,this.getBackground(e));const z=this.context,ne=z.canvas;nc(this.inversePixelTransform,this.pixelTransform),Hi(this.tempTransform,x/2,w/2,I,I,0,-x/2,-w/2),ne.width!=x||ne.height!=w?(ne.width=x,ne.height=w):this.containerReused||z.clearRect(0,0,x,w),b&&this.clipUnrotated(z,e,b),u.getInterpolate()||(z.imageSmoothingEnabled=!1),this.preRender(z,e),this.renderedTiles.length=0;let Le=Object.keys(N).map(Number);Le.sort(us);let P,gt,A;n.opacity===1&&(!this.containerReused||u.getOpaque(e.viewState.projection))?Le=Le.reverse():(P=[],gt=[]);for(let We=Le.length-1;We>=0;--We){const we=Le[We],ve=u.getTilePixelSize(we,h,r),lt=f.getResolution(we)/p,ht=ve[0]*lt*I,pt=ve[1]*lt*I,q=f.getTileCoordForCoordAndZ(yn(C),we),ki=f.getTileCoordExtent(q),Oi=ot(this.tempTransform,[y*(ki[0]-C[0])/p,y*(C[3]-ki[3])/p]),$e=y*u.getGutterForProjection(r),Ni=N[we];for(const Di in Ni){const Xe=Ni[Di],Gn=Xe.tileCoord,tt=q[1]-Gn[1],Ji=Math.round(Oi[0]-(tt-1)*ht),wi=q[2]-Gn[2],bi=Math.round(Oi[1]-(wi-1)*pt),ct=Math.round(Oi[0]-tt*ht),Pt=Math.round(Oi[1]-wi*pt),Ce=Ji-ct,Pe=bi-Pt,Ae=g===we,ke=Ae&&Xe.getAlpha(H(this),e.time)!==1;let me=!1;if(!ke)if(P){A=[ct,Pt,ct+Ce,Pt,ct+Ce,Pt+Pe,ct,Pt+Pe];for(let Me=0,ut=P.length;Me<ut;++Me)if(g!==we&&we<gt[Me]){const be=P[Me];Qe([ct,Pt,ct+Ce,Pt+Pe],[be[0],be[3],be[4],be[7]])&&(me||(z.save(),me=!0),z.beginPath(),z.moveTo(A[0],A[1]),z.lineTo(A[2],A[3]),z.lineTo(A[4],A[5]),z.lineTo(A[6],A[7]),z.moveTo(be[6],be[7]),z.lineTo(be[4],be[5]),z.lineTo(be[2],be[3]),z.lineTo(be[0],be[1]),z.clip())}P.push(A),gt.push(we)}else z.clearRect(ct,Pt,Ce,Pe);this.drawTileImage(Xe,e,ct,Pt,Ce,Pe,$e,Ae),P&&!ke?(me&&z.restore(),this.renderedTiles.unshift(Xe)):this.renderedTiles.push(Xe),this.updateUsedTiles(e.usedTiles,u,Xe)}}return this.renderedRevision=d,this.renderedResolution=p,this.extentChanged=!this.renderedExtent_||!$s(this.renderedExtent_,C),this.renderedExtent_=C,this.renderedPixelRatio=h,this.renderedProjection=r,this.manageTilePyramid(e,u,f,h,r,m,g,c.getPreload()),this.scheduleExpireCache(e,u),this.postRender(z,e),n.extent&&z.restore(),z.imageSmoothingEnabled=!0,F!==ne.style.transform&&(ne.style.transform=F),this.container}drawTileImage(e,t,n,s,r,o,a,l){const h=this.getTileImage(e);if(!h)return;const c=H(this),u=t.layerStatesArray[t.layerIndex],d=u.opacity*(l?e.getAlpha(c,t.time):1),f=d!==this.context.globalAlpha;f&&(this.context.save(),this.context.globalAlpha=d),this.context.drawImage(h,a,a,h.width-2*a,h.height-2*a,n,s,r,o),f&&this.context.restore(),d!==u.opacity?t.animate=!0:l&&e.endTransition(c)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,t){if(t.canExpireCache()){const n=(function(s,r,o){const a=H(s);a in o.usedTiles&&s.expireCache(o.viewState.projection,o.usedTiles[a])}).bind(null,t);e.postRenderFunctions.push(n)}}updateUsedTiles(e,t,n){const s=H(t);s in e||(e[s]={}),e[s][n.getKey()]=!0}manageTilePyramid(e,t,n,s,r,o,a,l,h){const c=H(t);c in e.wantedTiles||(e.wantedTiles[c]={});const u=e.wantedTiles[c],d=e.tileQueue,f=n.getMinZoom(),g=e.viewState.rotation,p=g?Su(e.viewState.center,e.viewState.resolution,g,e.size):void 0;let m=0,_,y,x,w,b,E;for(E=f;E<=a;++E)for(y=n.getTileRangeForExtentAndZ(o,E,y),x=n.getResolution(E),w=y.minX;w<=y.maxX;++w)for(b=y.minY;b<=y.maxY;++b)g&&!n.tileCoordIntersectsViewport([E,w,b],p)||(a-E<=l?(++m,_=t.getTile(E,w,b,s,r),_.getState()==$.IDLE&&(u[_.getKey()]=!0,d.isKeyQueued(_.getKey())||d.enqueue([_,c,n.getTileCoordCenter(_.tileCoord),x])),h!==void 0&&h(_)):t.useTile(E,w,b,r));t.updateCacheSize(m,r)}}const G_=PP;class AP extends LP{constructor(e){super(e)}createRenderer(){return new G_(this)}}const z_=AP;function nd(i){return Array.isArray(i)?Math.min(...i):i}const FP={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},kP={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class OP extends G_{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.tmpTransform_=mi()}prepareTile(e,t,n){let s;const r=e.getState();return(r===$.LOADED||r===$.ERROR)&&(this.updateExecutorGroup_(e,t,n),this.tileImageNeedsRender_(e)&&(s=!0)),s}getTile(e,t,n,s){const r=s.pixelRatio,o=s.viewState,a=o.resolution,l=o.projection,h=this.getLayer(),c=h.getSource().getTile(e,t,n,r,l),u=s.viewHints,d=!(u[Ye.ANIMATING]||u[Ye.INTERACTING]);return(d||!c.wantedResolution)&&(c.wantedResolution=a),this.prepareTile(c,r,l)&&(d||Date.now()-s.time<8)&&h.getRenderMode()!=="vector"&&this.renderTileImage_(c,s),super.getTile(e,t,n,s)}isDrawableTile(e){const t=this.getLayer();return super.isDrawableTile(e)&&(t.getRenderMode()==="vector"?H(t)in e.executorGroups:e.hasContext(t))}getTileImage(e){return e.getImage(this.getLayer())}prepareFrame(e){const t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,n){const s=this.getLayer(),r=s.getRevision(),o=s.getRenderOrder()||null,a=e.wantedResolution,l=e.getReplayState(s);if(!l.dirty&&l.renderedResolution===a&&l.renderedRevision==r&&l.renderedRenderOrder==o)return;const h=s.getSource(),c=s.getDeclutter(),u=h.getTileGrid(),f=h.getTileGridForProjection(n).getTileCoordExtent(e.wrappedTileCoord),g=h.getSourceTiles(t,n,e),p=H(s);delete e.hitDetectionImageData[p],e.executorGroups[p]=[],c&&(e.declutterExecutorGroups[p]=[]),l.dirty=!1;for(let m=0,_=g.length;m<_;++m){const y=g[m];if(y.getState()!=$.LOADED)continue;const x=y.tileCoord,w=u.getTileCoordExtent(x),b=Tn(f,w),E=Vi(b,s.getRenderBuffer()*a,this.tmpExtent),M=$s(w,b)?null:E,C=new _h(0,E,a,t),R=c?new _h(0,b,a,t):void 0,N=Uf(a,t),D=function(F){let z;const ne=F.getStyleFunction()||s.getStyleFunction();if(ne&&(z=ne(F,a)),z){const Le=this.renderFeature(F,N,z,C,R);l.dirty=l.dirty||Le}},S=y.getFeatures();o&&o!==l.renderedRenderOrder&&S.sort(o);for(let F=0,z=S.length;F<z;++F){const ne=S[F];(!M||Qe(M,ne.getGeometry().getExtent()))&&D.call(this,ne)}const B=C.finish(),k=s.getRenderMode()!=="vector"&&c&&g.length===1?null:b,I=new vh(k,a,t,h.getOverlaps(),B,s.getRenderBuffer());if(e.executorGroups[p].push(I),R){const F=new vh(null,a,t,h.getOverlaps(),R.finish(),s.getRenderBuffer());e.declutterExecutorGroups[p].push(F)}}l.renderedRevision=r,l.renderedRenderOrder=o,l.renderedResolution=a}forEachFeatureAtCoordinate(e,t,n,s,r){const o=t.viewState.resolution,a=t.viewState.rotation;n=n??0;const l=this.getLayer(),c=l.getSource().getTileGridForProjection(t.viewState.projection),u=wt([e]);Vi(u,o*n,u);const d={},f=function(m,_,y){let x=m.getId();x===void 0&&(x=H(m));const w=d[x];if(w){if(w!==!0&&y<w.distanceSq){if(y===0)return d[x]=!0,r.splice(r.lastIndexOf(w),1),s(m,l,_);w.geometry=_,w.distanceSq=y}}else{if(y===0)return d[x]=!0,s(m,l,_);r.push(d[x]={feature:m,layer:l,geometry:_,distanceSq:y,callback:s})}},g=this.renderedTiles;let p;for(let m=0,_=g.length;!p&&m<_;++m){const y=g[m],x=c.getTileCoordExtent(y.wrappedTileCoord);if(!Qe(x,u))continue;const w=H(l),b=[y.executorGroups[w]],E=y.declutterExecutorGroups[w];E&&b.push(E),b.some(M=>{const C=M===E?t.declutterTree.all().map(R=>R.value):null;for(let R=0,N=M.length;R<N;++R)if(p=M[R].forEachFeatureAtCoordinate(e,o,a,n,f,C),p)return!0})}return p}getFeatures(e){return new Promise((t,n)=>{const s=this.getLayer(),r=H(s),o=s.getSource(),a=this.renderedProjection,l=a.getExtent(),h=this.renderedResolution,c=o.getTileGridForProjection(a),u=ot(this.renderedPixelToCoordinateTransform_,e.slice()),d=c.getTileCoordForCoordAndResolution(u,h);let f;for(let x=0,w=this.renderedTiles.length;x<w;++x)if(d.toString()===this.renderedTiles[x].tileCoord.toString()){if(f=this.renderedTiles[x],f.getState()===$.LOADED){const b=c.getTileCoordExtent(f.tileCoord);o.getWrapX()&&a.canWrapX()&&!qi(l,b)&&Pd(u,a);break}f=void 0}if(!f||f.loadingSourceTiles>0){t([]);return}const g=c.getTileCoordExtent(f.wrappedTileCoord),p=yn(g),m=[(u[0]-p[0])/h,(p[1]-u[1])/h],_=f.getSourceTiles().reduce(function(x,w){return x.concat(w.getFeatures())},[]);let y=f.hitDetectionImageData[r];if(!y){const x=Vt(c.getTileSize(c.getZForResolution(h,o.zDirection))),w=this.renderedRotation_,b=[this.getRenderTransform(c.getTileCoordCenter(f.wrappedTileCoord),h,0,fi,x[0]*fi,x[1]*fi,0)];y=x_(x,b,_,s.getStyleFunction(),c.getTileCoordExtent(f.wrappedTileCoord),f.getReplayState(s).renderedResolution,w),f.hitDetectionImageData[r]=y}t(w_(m,_,y))})}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.renderedLayerRevision_!==void 0&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e){const t=this.context,n=t.globalAlpha;t.globalAlpha=this.getLayer().getOpacity();const s=e.viewHints,r=!(s[Ye.ANIMATING]||s[Ye.INTERACTING]),o=this.renderedTiles;for(let a=0,l=o.length;a<l;++a){const h=o[a],c=h.declutterExecutorGroups[H(this.getLayer())];if(c)for(let u=c.length-1;u>=0;--u)c[u].execute(this.context,1,this.getTileRenderTransform(h,e),e.viewState.rotation,r,void 0,e.declutterTree)}t.globalAlpha=n}getTileRenderTransform(e,t){const n=t.pixelRatio,s=t.viewState,r=s.center,o=s.resolution,a=s.rotation,l=t.size,h=Math.round(l[0]*n),c=Math.round(l[1]*n),d=this.getLayer().getSource().getTileGridForProjection(t.viewState.projection),f=e.tileCoord,g=d.getTileCoordExtent(e.wrappedTileCoord),p=d.getTileCoordExtent(f,this.tmpExtent)[0]-g[0];return tc(Ol(this.inversePixelTransform.slice(),1/n,1/n),this.getRenderTransform(r,o,a,n,h,c,p))}postRender(e,t){const n=t.viewHints,s=!(n[Ye.ANIMATING]||n[Ye.INTERACTING]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation;const r=this.getLayer(),o=r.getRenderMode(),a=e.globalAlpha;e.globalAlpha=r.getOpacity();const l=kP[o],h=t.viewState,c=h.rotation,u=r.getSource(),f=u.getTileGridForProjection(h.projection).getZForResolution(h.resolution,u.zDirection),g=this.renderedTiles,p=[],m=[];let _=!0;for(let y=g.length-1;y>=0;--y){const x=g[y];_=_&&!x.getReplayState(r).dirty;const w=x.executorGroups[H(r)].filter(R=>R.hasExecutors(l));if(w.length===0)continue;const b=this.getTileRenderTransform(x,t),E=x.tileCoord[0];let M=!1;const C=w[0].getClipCoords(b);if(C){for(let R=0,N=p.length;R<N;++R)if(f!==E&&E<m[R]){const D=p[R];Qe([C[0],C[3],C[4],C[7]],[D[0],D[3],D[4],D[7]])&&(M||(e.save(),M=!0),e.beginPath(),e.moveTo(C[0],C[1]),e.lineTo(C[2],C[3]),e.lineTo(C[4],C[5]),e.lineTo(C[6],C[7]),e.moveTo(D[6],D[7]),e.lineTo(D[4],D[5]),e.lineTo(D[2],D[3]),e.lineTo(D[0],D[1]),e.clip())}p.push(C),m.push(E)}for(let R=0,N=w.length;R<N;++R)w[R].execute(e,1,b,c,s,l);M&&e.restore()}e.globalAlpha=a,this.ready=_,super.postRender(e,t)}renderFeature(e,t,n,s,r){if(!n)return!1;let o=!1;if(Array.isArray(n))for(let a=0,l=n.length;a<l;++a)o=xh(s,e,n[a],t,this.boundHandleStyleImageChange_,void 0,r)||o;else o=xh(s,e,n,t,this.boundHandleStyleImageChange_,void 0,r);return o}tileImageNeedsRender_(e){const t=this.getLayer();if(t.getRenderMode()==="vector")return!1;const n=e.getReplayState(t),s=t.getRevision(),r=e.wantedResolution;return n.renderedTileResolution!==r||n.renderedTileRevision!==s}renderTileImage_(e,t){const n=this.getLayer(),s=e.getReplayState(n),r=n.getRevision(),o=e.executorGroups[H(n)];s.renderedTileRevision=r;const a=e.wrappedTileCoord,l=a[0],h=n.getSource();let c=t.pixelRatio;const d=t.viewState.projection,f=h.getTileGridForProjection(d),g=f.getResolution(e.tileCoord[0]),p=t.pixelRatio/e.wantedResolution*g,m=f.getResolution(l),_=e.getContext(n);c=Math.round(Math.max(c,p/c));const y=h.getTilePixelSize(l,c,d);_.canvas.width=y[0],_.canvas.height=y[1];const x=c/p;if(x!==1){const M=np(this.tmpTransform_);Ol(M,x,x),_.setTransform.apply(_,M)}const w=f.getTileCoordExtent(a,this.tmpExtent),b=p/m,E=np(this.tmpTransform_);Ol(E,b,-b),DM(E,-w[0],-w[3]);for(let M=0,C=o.length;M<C;++M)o[M].execute(_,x,E,0,!0,FP[n.getRenderMode()]);s.renderedTileResolution=e.wantedResolution}}const NP=OP;class DP extends __{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un;const n=e.renderMode||"hybrid";_e(n=="hybrid"||n=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=n,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new NP(this)}getFeatures(e){return super.getFeatures(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(ts.PRELOAD)}getUseInterimTilesOnError(){return this.get(ts.USE_INTERIM_TILES_ON_ERROR)}setPreload(e){this.set(ts.PRELOAD,e)}setUseInterimTilesOnError(e){this.set(ts.USE_INTERIM_TILES_ON_ERROR,e)}}const Nl=DP;class GP extends Sy{constructor(e,t,n,s,r,o,a){let l=e.getExtent();l&&e.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);let h=t.getExtent();h&&t.canWrapX()&&(h=h.slice(),h[0]=-1/0,h[2]=1/0);const c=h?Tn(n,h):n,u=pi(c),d=wh(e,t,u,s),f=L_,g=new P_(e,t,c,l,d*f,s),p=g.calculateSourceExtent(),m=Ys(p)?null:o(p,d,r),_=m?oe.IDLE:oe.EMPTY,y=m?m.getPixelRatio():1;super(n,s,y,_),this.targetProj_=t,this.maxSourceExtent_=l,this.triangulation_=g,this.targetResolution_=s,this.targetExtent_=n,this.sourceImage_=m,this.sourcePixelRatio_=y,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==oe.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==oe.LOADED){const t=Re(this.targetExtent_)/this.targetResolution_,n=_t(this.targetExtent_)/this.targetResolution_;this.canvas_=A_(t,n,this.sourcePixelRatio_,nd(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==oe.IDLE){this.state=oe.LOADING,this.changed();const e=this.sourceImage_.getState();e==oe.LOADED||e==oe.ERROR?this.reproject_():(this.sourceListenerKey_=ye(this.sourceImage_,ee.CHANGE,function(t){const n=this.sourceImage_.getState();(n==oe.LOADED||n==oe.ERROR)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}}unlistenSource_(){qe(this.sourceListenerKey_),this.sourceListenerKey_=null}}const zP=GP,is=4,Qc={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class BP extends xi{constructor(e,t){super(e),this.image=t}}class $P extends Gf{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate!==void 0?e.interpolate:!0}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=e.loader?e.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();if(t){const n=ec(t,e,0);e=t[n]}return e}getImage(e,t,n,s){const r=this.getProjection();if(!r||!s||ui(r,s))return r&&(s=r),this.getImageInternal(e,t,n,s);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&ui(this.reprojectedImage_.getProjection(),s)&&this.reprojectedImage_.getResolution()==t&&$s(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new zP(r,s,e,t,n,(o,a,l)=>this.getImageInternal(o,a,l,r),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,n,s){if(this.loader){const r=B_(e,t,n,1),o=this.findNearestResolution(t);if(this.image&&(this.static_||this.wantedProjection_===s&&(this.wantedExtent_&&qi(this.wantedExtent_,r)||qi(this.image.getExtent(),r))&&(this.wantedResolution_&&nd(this.wantedResolution_)===o||nd(this.image.getResolution())===o)))return this.image;this.wantedProjection_=s,this.wantedExtent_=r,this.wantedResolution_=o,this.image=new Sy(r,o,n,this.loader),this.image.addEventListener(ee.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const t=e.target;let n;switch(t.getState()){case oe.LOADING:this.loading=!0,n=Qc.IMAGELOADSTART;break;case oe.LOADED:this.loading=!1,n=Qc.IMAGELOADEND;break;case oe.ERROR:this.loading=!1,n=Qc.IMAGELOADERROR;break;default:return}this.hasListener(n)&&this.dispatchEvent(new BP(n,t))}}function UP(i,e){i.getImage().src=e}function B_(i,e,t,n){const s=e/t,r=pi(i),o=Hn(Re(i)/s,is),a=Hn(_t(i)/s,is),l=Hn((n-1)*o/2,is),h=o+2*l,c=Hn((n-1)*a/2,is),u=a+2*c;return Jo(r,s,0,[h,u])}const qP=$P;function bh(i,e){const t=[];Object.keys(e).forEach(function(s){e[s]!==null&&e[s]!==void 0&&t.push(s+"="+encodeURIComponent(e[s]))});const n=t.join("&");return i=i.replace(/[?&]$/,""),i+=i.includes("?")?"&":"?",i+n}const $_="1.3.0",wm=[101,101];function U_(i,e,t,n,s){s.WIDTH=t[0],s.HEIGHT=t[1];const r=n.getAxisOrientation();let o;const a=E0(s.VERSION,"1.3")>=0;return s[a?"CRS":"SRS"]=n.getCode(),a&&r.substr(0,2)=="ne"?o=[e[1],e[0],e[3],e[2]]:o=e,s.BBOX=o.join(","),bh(i,s)}function jP(i,e,t,n,s,r,o){r=Object.assign({REQUEST:"GetMap"},r);const a=e/t,l=[Vg(Re(i)/a,is),Vg(_t(i)/a,is)];if(t!=1)switch(o){case"geoserver":const c=90*t+.5|0;"FORMAT_OPTIONS"in r?r.FORMAT_OPTIONS+=";dpi:"+c:r.FORMAT_OPTIONS="dpi:"+c;break;case"mapserver":r.MAP_RESOLUTION=90*t;break;case"carmentaserver":case"qgis":r.DPI=90*t;break;default:throw new Error("Unknown `serverType` configured")}return U_(s,i,l,n,r)}function q_(i,e){return Object.assign({REQUEST:e,SERVICE:"WMS",VERSION:$_,FORMAT:"image/png",STYLES:"",TRANSPARENT:!0},i)}function WP(i){const e=i.hidpi===void 0?!0:i.hidpi,t=K(i.projection||"EPSG:3857"),n=i.ratio||1.5,s=i.load||Ry;return(r,o,a)=>{r=B_(r,o,a,n),a!=1&&(!e||i.serverType===void 0)&&(a=1);const l=jP(r,o,a,t,i.url,q_(i.params,"GetMap"),i.serverType),h=new Image;return i.crossOrigin!==null&&(h.crossOrigin=i.crossOrigin),s(h,l).then(c=>({image:c,extent:r,pixelRatio:a}))}}function VP(i,e,t){if(i.url===void 0)return;const n=K(i.projection||"EPSG:3857"),s=Jo(e,t,0,wm),r={QUERY_LAYERS:i.params.LAYERS,INFO_FORMAT:"application/json"};Object.assign(r,q_(i.params,"GetFeatureInfo"),i.params);const o=Er((e[0]-s[0])/t,is),a=Er((s[3]-e[1])/t,is),l=E0(r.VERSION,"1.3")>=0;return r[l?"I":"X"]=o,r[l?"J":"Y"]=a,U_(i.url,s,wm,n,r)}function XP(i,e){if(i.url===void 0)return;const t={SERVICE:"WMS",VERSION:$_,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(i.params===void 0||i.params.LAYER===void 0){const n=i.params.LAYERS;if(!(!Array.isArray(n)||n.length===1))return;t.LAYER=n}if(e!==void 0){const n=K(i.projection||"EPSG:3857").getMetersPerUnit()||1,s=28e-5;t.SCALE=e*n/s}return Object.assign(t,i.params),bh(i.url,t)}class YP extends qP{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:UP,this.params_=e.params,this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(e,t,n,s){const r=K(n),o=this.getProjection();o&&o!==r&&(t=wh(o,r,e,t),e=Fr(e,r,o));const a={url:this.url_,params:{...this.params_,...s},projection:o||r};return VP(a,e,t)}getLegendUrl(e,t){return XP({url:this.url_,params:{...this.params_,...t}},e)}getParams(){return this.params_}getImageInternal(e,t,n,s){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==s)&&(this.loaderProjection_=s,this.loader=WP({crossOrigin:this.crossOrigin_,params:this.params_,projection:s,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(r,o)=>(this.image.setImage(r),this.imageLoadFunction_(this.image,o),Ry(r))})),super.getImageInternal(e,t,n,s))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}const j_=YP;var Yn,mr,Xr,Dl;class HP{constructor(e,t){re(this,Yn);re(this,Xr);v(this,"map");v(this,"srid");v(this,"messageManager");v(this,"layerManager");v(this,"layersByUniqueServerId",{});v(this,"independentLayers",{});v(this,"basemapLayers",[]);this.map=e,this.srid=t,this.messageManager=Qh.getInstance(),this.layerManager=Na.getInstance()}removeAllBasemapLayers(){this.basemapLayers.forEach(e=>{this.map.removeLayer(e)}),this.basemapLayers=[]}addLayer(e){if(e.serverUniqueQueryId in this.layersByUniqueServerId){const t=this.layersByUniqueServerId[e.serverUniqueQueryId];t.layersWms.push(e);const n=le(this,Yn,mr).call(this,t.layersWms);t.olayer.setSource(n)}else{const t=new Jc,n=le(this,Yn,mr).call(this,[e]);t.setSource(n),this.map.addLayer(t);const s={olayer:t,layersWms:[e]};this.layersByUniqueServerId[e.serverUniqueQueryId]=s}le(this,Xr,Dl).call(this,e)}addBasemapLayer(e){const t=le(this,Yn,mr).call(this,[e]),n=new Jc({source:t,opacity:e.opacity});this.basemapLayers.push(n),this.map.getLayers().insertAt(0,n)}removeLayer(e){if(this.layerExists(e))if(e.treeItemId in this.independentLayers){const t=this.independentLayers[e.treeItemId].olayer;delete this.independentLayers[e.treeItemId],this.map.removeLayer(t)}else if(e.serverUniqueQueryId in this.layersByUniqueServerId){const t=this.layersByUniqueServerId[e.serverUniqueQueryId];if(t.layersWms=t.layersWms.filter(n=>n.treeItemId!==e.treeItemId),t.layersWms.length>0){const n=le(this,Yn,mr).call(this,t.layersWms);t.olayer.setSource(n)}else delete this.layersByUniqueServerId[e.serverUniqueQueryId],this.map.removeLayer(t.olayer)}else console.warn("Nothing to remove !");else console.error(`Cannot remove WMS-Layer ${e.name} from the map: it does not exist!`)}layerExists(e){return e.treeItemId in this.independentLayers?!0:e.serverUniqueQueryId in this.layersByUniqueServerId?this.layersByUniqueServerId[e.serverUniqueQueryId].layersWms.find(s=>s.treeItemId===e.treeItemId)!==void 0:!1}getOLayer(e){return e.treeItemId in this.independentLayers?this.independentLayers[e.treeItemId].olayer:e.serverUniqueQueryId in this.layersByUniqueServerId?this.layersByUniqueServerId[e.serverUniqueQueryId].olayer:null}changeOpacity(e){le(this,Xr,Dl).call(this,e)}changeFilter(e){le(this,Xr,Dl).call(this,e)}makeLayerIndependent(e){if(!(e.treeItemId in this.independentLayers))if(e.serverUniqueQueryId in this.layersByUniqueServerId){this.removeLayer(e);const t=le(this,Yn,mr).call(this,[e]),n=new Jc({source:t,opacity:e.opacity});e.hasFilter&&t.updateParams({FILTER:e.filter}),this.independentLayers[e.treeItemId]={layerWms:e,olayer:n},this.map.addLayer(n)}else throw new Error("A layer can be made independent only if it has already been added to the map.")}selectFeatures(e){const t=[];for(const n in this.layersByUniqueServerId){const s=this.layersByUniqueServerId[n];t.push({layers:s.layersWms,selectionBox:e,srid:this.srid})}for(const n in this.independentLayers){const s=this.independentLayers[n];t.push({layers:[s.layerWms],selectionBox:e,srid:this.srid})}Xi.getInstance().state.selection.selectionParameters=t}}Yn=new WeakSet,mr=function(e){const t=e[0].url;if(!e.every(h=>h.url===t))throw new Error("Not all layers of this list have the same server URL. We should not be in this function.");const s=e[0].imageType;if(!e.every(h=>h.url===t))throw new Error("Not all layers of this list have the same image type. We should not be in this function.");const a=e.slice().sort((h,c)=>c.order-h.order).map(h=>h.layers),l=new j_({url:t,params:{LAYERS:a,FORMAT:s}});return l.on("imageloaderror",()=>{for(const h of e)this.layerManager.setError(h,"Image cannot be loaded from WMS Server")}),l.on("imageloadend",()=>{for(const h of e)this.layerManager.unsetError(h)}),l},Xr=new WeakSet,Dl=function(e){if(!this.layerExists(e))throw new Error("Cannot change filter for this layer: it does not exist");if(!e.hasFilter&&!e.isTransparent){if(e.treeItemId in this.independentLayers){const t=this.independentLayers[e.treeItemId].olayer;delete this.independentLayers[e.treeItemId],this.map.removeLayer(t),this.addLayer(e)}}else if(e.treeItemId in this.independentLayers){const t=this.independentLayers[e.treeItemId].olayer;e.isTransparent&&t.setOpacity(e.opacity),e.hasFilter&&t.getSource().updateParams({FILTER:e.filter})}else e.serverUniqueQueryId in this.layersByUniqueServerId&&this.makeLayerIndependent(e)};class ZP extends xP{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(e){for(;this.canExpireCache()&&!(this.peekLast().getKey()in e);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const e=this.peekFirstKey(),n=D_(e)[0];this.forEach(s=>{s.tileCoord[0]!==n&&(this.remove(N_(s.tileCoord)),s.release())})}}const qf=ZP,eu={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},lr=[0,0,0],qn=5;class KP{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,_e(SM(this.resolutions_,(s,r)=>r-s,!0),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let s=0,r=this.resolutions_.length-1;s<r;++s)if(!t)t=this.resolutions_[s]/this.resolutions_[s+1];else if(this.resolutions_[s]/this.resolutions_[s+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,_e(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const n=e.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=yn(n)),_e(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,_e(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:Rf,_e(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((s,r)=>{const o=new O_(Math.min(0,s[0]),Math.max(s[0]-1,-1),Math.min(0,s[1]),Math.max(s[1]-1,-1));if(n){const a=this.getTileRangeForExtentAndZ(n,r);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):n&&this.calculateTileRanges_(n)}forEachTileCoord(e,t,n){const s=this.getTileRangeForExtentAndZ(e,t);for(let r=s.minX,o=s.maxX;r<=o;++r)for(let a=s.minY,l=s.maxY;a<=l;++a)n([t,r,a])}forEachTileCoordParentTileRange(e,t,n,s){let r,o,a,l=null,h=e[0]-1;for(this.zoomFactor_===2?(o=e[1],a=e[2]):l=this.getTileCoordExtent(e,s);h>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),r=ar(o,o,a,a,n)):r=this.getTileRangeForExtentAndZ(l,h,n),t(h,r))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,n){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const r=e[1]*2,o=e[2]*2;return ar(r,r+1,o,o+1,t)}const s=this.getTileCoordExtent(e,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,n){if(t>this.maxZoom||t<this.minZoom)return null;const s=e[0],r=e[1],o=e[2];if(t===s)return ar(r,o,r,o,n);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,t-s),h=Math.floor(r*l),c=Math.floor(o*l);if(t<s)return ar(h,h,c,c,n);const u=Math.floor(l*(r+1))-1,d=Math.floor(l*(o+1))-1;return ar(h,u,c,d,n)}const a=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,t,n)}getTileRangeForExtentAndZ(e,t,n){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,lr);const s=lr[1],r=lr[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,lr);const o=lr[1],a=lr[2];return ar(s,o,r,a,n)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),n=this.getResolution(e[0]),s=Vt(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*s[0]*n,t[1]-(e[2]+.5)*s[1]*n]}getTileCoordExtent(e,t){const n=this.getOrigin(e[0]),s=this.getResolution(e[0]),r=Vt(this.getTileSize(e[0]),this.tmpSize_),o=n[0]+e[1]*r[0]*s,a=n[1]-(e[2]+1)*r[1]*s,l=o+r[0]*s,h=a+r[1]*s;return Fi(o,a,l,h,t)}getTileCoordForCoordAndResolution(e,t,n){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,n)}getTileCoordForXYAndResolution_(e,t,n,s,r){const o=this.getZForResolution(n),a=n/this.getResolution(o),l=this.getOrigin(o),h=Vt(this.getTileSize(o),this.tmpSize_);let c=a*(e-l[0])/n/h[0],u=a*(l[1]-t)/n/h[1];return s?(c=Hn(c,qn)-1,u=Hn(u,qn)-1):(c=Er(c,qn),u=Er(u,qn)),xm(o,c,u,r)}getTileCoordForXYAndZ_(e,t,n,s,r){const o=this.getOrigin(n),a=this.getResolution(n),l=Vt(this.getTileSize(n),this.tmpSize_);let h=(e-o[0])/a/l[0],c=(o[1]-t)/a/l[1];return s?(h=Hn(h,qn)-1,c=Hn(c,qn)-1):(h=Er(h,qn),c=Er(c,qn)),xm(n,h,c,r)}getTileCoordForCoordAndZ(e,t,n){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,n)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const n=ec(this.resolutions_,e,t||0);return et(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return oy(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,n=new Array(t);for(let s=this.minZoom;s<t;++s)n[s]=this.getTileRangeForExtentAndZ(e,s);this.fullTileRanges_=n}}const Va=KP;class JP extends Va{constructor(e){super({extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes}),this.matrixIds_=e.matrixIds}getMatrixId(e){return this.matrixIds_[e]}getMatrixIds(){return this.matrixIds_}}function QP(i,e,t){const n=[],s=[],r=[],o=[],a=[];t=t!==void 0?t:[];const l="SupportedCRS",h="TileMatrix",c="Identifier",u="ScaleDenominator",d="TopLeftCorner",f="TileWidth",g="TileHeight",p=i[l],m=K(p),_=m.getMetersPerUnit(),y=m.getAxisOrientation().substr(0,2)=="ne";return i[h].sort(function(x,w){return w[u]-x[u]}),i[h].forEach(function(x){let w;if(t.length>0?w=t.find(function(b){return x[c]==b[h]?!0:x[c].includes(":")?!1:i[c]+":"+x[c]===b[h]}):w=!0,w){s.push(x[c]);const b=x[u]*28e-5/_,E=x[f],M=x[g];y?r.push([x[d][1],x[d][0]]):r.push(x[d]),n.push(b),o.push(E==M?E:[E,M]),a.push([x.MatrixWidth,x.MatrixHeight])}}),new JP({extent:e,origins:r,resolutions:n,matrixIds:s,tileSizes:o,sizes:a})}function W_(i){let e=i.getDefaultTileGrid();return e||(e=iA(i),i.setDefaultTileGrid(e)),e}function eA(i,e,t){const n=e[0],s=i.getTileCoordCenter(e),r=Xa(t);if(!Aa(r,s)){const o=Re(r),a=Math.ceil((r[0]-s[0])/o);return s[0]+=o*a,i.getTileCoordForCoordAndZ(s,n)}return e}function tA(i,e,t,n){n=n!==void 0?n:"top-left";const s=V_(i,e,t);return new Va({extent:i,origin:NE(i,n),resolutions:s,tileSize:t})}function pc(i){const e=i||{},t=e.extent||K("EPSG:3857").getExtent(),n={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:V_(t,e.maxZoom,e.tileSize,e.maxResolution)};return new Va(n)}function V_(i,e,t,n){e=e!==void 0?e:Zy,t=Vt(t!==void 0?t:Rf);const s=_t(i),r=Re(i);n=n>0?n:Math.max(r/t[0],s/t[1]);const o=e+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=n/Math.pow(2,l);return a}function iA(i,e,t,n){const s=Xa(i);return tA(s,e,t,n)}function Xa(i){i=K(i);let e=i.getExtent();if(!e){const t=180*Bs.degrees/i.getMetersPerUnit();e=Fi(-t,-t,t,t)}return e}class nA extends Gf{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.opaque_=e.opaque!==void 0?e.opaque:!1,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&Vt(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tileCache=new qf(e.cacheSize||0),this.tmpSize=[0,0],this.key_=e.key||"",this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(e,t){const n=this.getTileCacheForProjection(e);n&&n.expireCache(t)}forEachLoadedTile(e,t,n,s){const r=this.getTileCacheForProjection(e);if(!r)return!1;let o=!0,a,l,h;for(let c=n.minX;c<=n.maxX;++c)for(let u=n.minY;u<=n.maxY;++u)l=bo(t,c,u),h=!1,r.containsKey(l)&&(a=r.get(l),h=a.getState()===$.LOADED,h&&(h=s(a)!==!1)),h||(o=!1);return o}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getOpaque(e){return this.opaque_}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,n,s,r){return ie()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:W_(e)}getTileCacheForProjection(e){const t=this.getProjection();return _e(t===null||ui(t,e),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,n){const s=this.getTileGridForProjection(n),r=this.getTilePixelRatio(t),o=Vt(s.getTileSize(e),this.tmpSize);return r==1?o:FC(o,r,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){t=t!==void 0?t:this.getProjection();const n=this.getTileGridForProjection(t);return this.getWrapX()&&t.isGlobal()&&(e=eA(n,e,t)),EP(e,n)?e:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(e,t){const n=this.getTileCacheForProjection(t);e>n.highWaterMark&&(n.highWaterMark=e)}useTile(e,t,n,s){}}class sA extends xi{constructor(e,t){super(e),this.tile=t}}const rA=nA;function oA(i,e){const t=/\{z\}/g,n=/\{x\}/g,s=/\{y\}/g,r=/\{-y\}/g;return function(o,a,l){if(o)return i.replace(t,o[0].toString()).replace(n,o[1].toString()).replace(s,o[2].toString()).replace(r,function(){const h=o[0],c=e.getFullTileRange(h);if(!c)throw new Error("The {-y} placeholder requires a tile grid with extent");return(c.getHeight()-o[2]-1).toString()})}}function X_(i,e){const t=i.length,n=new Array(t);for(let s=0;s<t;++s)n[s]=oA(i[s],e);return sd(n)}function sd(i){return i.length===1?i[0]:function(e,t,n){if(!e)return;const s=bP(e),r=Os(s,i.length);return i[r](e,t,n)}}function jf(i){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(i);if(t){const n=t[1].charCodeAt(0),s=t[2].charCodeAt(0);let r;for(r=n;r<=s;++r)e.push(i.replace(t[0],String.fromCharCode(r)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(i),t){const n=parseInt(t[2],10);for(let s=parseInt(t[1],10);s<=n;s++)e.push(i.replace(t[0],s.toString()));return e}return e.push(i),e}class Wf extends rA{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Wf.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,n=H(t),s=t.getState();let r;s==$.LOADING?(this.tileLoadingKeys_[n]=!0,r=eu.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],r=s==$.ERROR?eu.TILELOADERROR:s==$.LOADED?eu.TILELOADEND:void 0),r!=null&&this.dispatchEvent(new sA(r,t))}setTileLoadFunction(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=jf(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(X_(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,n){}useTile(e,t,n){const s=bo(e,t,n);this.tileCache.containsKey(s)&&this.tileCache.get(s)}}const Y_=Wf;class aA extends Y_{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:lA,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:F_,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1}expireCache(e,t){const n=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==n?t:{});for(const s in this.tileCacheForProjection){const r=this.tileCacheForProjection[s];r.expireCache(r==n?t:{})}}getGutterForProjection(e){return this.getProjection()&&e&&!ui(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getOpaque(e){return this.getProjection()&&e&&!ui(this.getProjection(),e)?!1:super.getOpaque(e)}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||ui(t,e)))return this.tileGrid;const n=H(e);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=W_(e)),this.tileGridForProjection[n]}getTileCacheForProjection(e){const t=this.getProjection();if(!t||ui(t,e))return this.tileCache;const n=H(e);return n in this.tileCacheForProjection||(this.tileCacheForProjection[n]=new qf(this.tileCache.highWaterMark)),this.tileCacheForProjection[n]}createTile_(e,t,n,s,r,o){const a=[e,t,n],l=this.getTileCoordForTileUrlFunction(a,r),h=l?this.tileUrlFunction(l,s,r):void 0,c=new this.tileClass(a,h!==void 0?$.IDLE:$.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(ee.CHANGE,this.handleTileChange.bind(this)),c}getTile(e,t,n,s,r){const o=this.getProjection();if(!o||!r||ui(o,r))return this.getTileInternal(e,t,n,s,o||r);const a=this.getTileCacheForProjection(r),l=[e,t,n];let h;const c=N_(l);a.containsKey(c)&&(h=a.get(c));const u=this.getKey();if(h&&h.key==u)return h;const d=this.getTileGridForProjection(o),f=this.getTileGridForProjection(r),g=this.getTileCoordForTileUrlFunction(l,r),p=new id(o,d,r,f,l,g,this.getTilePixelRatio(s),this.getGutter(),(m,_,y,x)=>this.getTileInternal(m,_,y,x,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return p.key=u,h?(p.interimTile=h,p.refreshInterimChain(),a.replace(c,p)):a.set(c,p),p}getTileInternal(e,t,n,s,r){let o=null;const a=bo(e,t,n),l=this.getKey();if(!this.tileCache.containsKey(a))o=this.createTile_(e,t,n,s,r,l),this.tileCache.set(a,o);else if(o=this.tileCache.get(a),o.key!=l){const h=o;o=this.createTile_(e,t,n,s,r,l),h.getState()==$.IDLE?o.interimTile=h.interimTile:o.interimTile=h,o.refreshInterimChain(),this.tileCache.replace(a,o)}return o}setRenderReprojectionEdges(e){if(this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(e,t){const n=K(e);if(n){const s=H(n);s in this.tileGridForProjection||(this.tileGridForProjection[s]=t)}}clear(){super.clear();for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear()}}function lA(i,e){i.getImage().src=e}const Vf=aA;class hA extends Vf{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",n=e.tileGrid!==void 0?e.tileGrid:pc({extent:Xa(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:e.opaque,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}const cA=hA,uA='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class dA extends cA{constructor(e){e=e||{};let t;e.attributions!==void 0?t=e.attributions:t=[uA];const n=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",s=e.url!==void 0?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:n,interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:19,opaque:e.opaque!==void 0?e.opaque:!0,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:s,wrapX:e.wrapX,zDirection:e.zDirection})}}const fA=dA;class gA{constructor(e,t){v(this,"map");v(this,"srid");v(this,"basemapLayers",[]);this.map=e,this.srid=t}removeAllBasemapLayers(){this.basemapLayers.forEach(e=>{this.map.removeLayer(e)}),this.basemapLayers=[]}addBasemapLayer(){const e=new z_({source:new fA});this.basemapLayers.push(e),this.map.getLayers().insertAt(0,e)}}const bm=[];class pA extends gc{constructor(e,t,n,s){super(e,t,{transition:0}),this.context_={},this.executorGroups={},this.declutterExecutorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=s.bind(void 0,this),this.wrappedTileCoord=n}getContext(e){const t=H(e);return t in this.context_||(this.context_[t]=Lt(1,1,bm)),this.context_[t]}hasContext(e){return H(e)in this.context_}getImage(e){return this.hasContext(e)?this.getContext(e).canvas:null}getReplayState(e){const t=H(e);return t in this.replayState_||(this.replayState_[t]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[t]}load(){this.getSourceTiles()}release(){for(const e in this.context_){const t=this.context_[e];$a(t),bm.push(t.canvas),delete this.context_[e]}super.release()}}const mA=pA;let yA=class extends gc{constructor(e,t,n,s,r,o){super(e,t,o),this.extent=null,this.format_=s,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=r,this.url_=n,this.key=n}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==$.IDLE&&(this.setState($.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(e,t){this.setFeatures(e)}onError(){this.setState($.ERROR)}setFeatures(e){this.features_=e,this.setState($.LOADED)}setLoader(e){this.loader_=e}};const H_=yA;function _A(i,e,t,n){const s=document.createElement("script"),r="olc_"+H(e);function o(){delete window[r],s.parentNode.removeChild(s)}s.async=!0,s.src=i+(i.includes("?")?"&":"?")+(n||"callback")+"="+r;const a=setTimeout(function(){o(),t&&t()},1e4);window[r]=function(l){clearTimeout(a),o(),e(l)},document.head.appendChild(s)}class vA extends Vf{constructor(e){if(super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:K("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.tileJSON_=null,this.tileSize_=e.tileSize,e.url)if(e.jsonp)_A(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let n;try{n=JSON.parse(t.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(n)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(e){const t=K("EPSG:4326"),n=this.getProjection();let s;if(e.bounds!==void 0){const h=Kh(t,n);s=w0(e.bounds,h)}const r=Xa(n),o=e.minzoom||0,a=e.maxzoom||22,l=pc({extent:r,maxZoom:a,minZoom:o,tileSize:this.tileSize_});if(this.tileGrid=l,this.tileUrlFunction=X_(e.tiles,l),e.attribution&&!this.getAttributions()){const h=s!==void 0?s:r;this.setAttributions(function(c){return Qe(h,c.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState("ready")}handleTileJSONError(){this.setState("error")}}const xA=vA;class wA extends Y_{constructor(e){const t=e.projection||"EPSG:3857",n=e.extent||Xa(t),s=e.tileGrid||pc({extent:n,maxResolution:e.maxResolution,maxZoom:e.maxZoom!==void 0?e.maxZoom:22,minZoom:e.minZoom,tileSize:e.tileSize||512});super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,interpolate:!0,opaque:!1,projection:t,state:e.state,tileGrid:s,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:Z_,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX===void 0?!0:e.wrapX,transition:e.transition,zDirection:e.zDirection===void 0?1:e.zDirection}),this.format_=e.format?e.format:null,this.sourceTileCache=new qf(this.tileCache.highWaterMark),this.overlaps_=e.overlaps==null?!0:e.overlaps,this.tileClass=e.tileClass?e.tileClass:H_,this.tileGrids_={}}getFeaturesInExtent(e){const t=[],n=this.tileCache;if(n.getCount()===0)return t;const s=D_(n.peekFirstKey())[0],r=this.tileGrid;return n.forEach(function(o){if(o.tileCoord[0]!==s||o.getState()!==$.LOADED)return;const a=o.getSourceTiles();for(let l=0,h=a.length;l<h;++l){const c=a[l],u=c.tileCoord;if(Qe(e,r.getTileCoordExtent(u))){const d=c.getFeatures();if(d)for(let f=0,g=d.length;f<g;++f){const p=d[f],m=p.getGeometry();Qe(e,m.getExtent())&&t.push(p)}}}}),t}getOverlaps(){return this.overlaps_}clear(){this.tileCache.clear(),this.sourceTileCache.clear()}expireCache(e,t){const n=this.getTileCacheForProjection(e),s=Object.keys(t).reduce((r,o)=>{const a=wP(o),l=n.peek(a);if(l){const h=l.sourceTiles;for(let c=0,u=h.length;c<u;++c)r[h[c].getKey()]=!0}return r},{});super.expireCache(e,t),this.sourceTileCache.expireCache(s)}getSourceTiles(e,t,n){if(n.getState()===$.IDLE){n.setState($.LOADING);const s=n.wrappedTileCoord,r=this.getTileGridForProjection(t),o=r.getTileCoordExtent(s),a=s[0],l=r.getResolution(a);Vi(o,-l,o);const h=this.tileGrid,c=h.getExtent();c&&Tn(o,c,o);const u=h.getZForResolution(l,this.zDirection);h.forEachTileCoord(o,u,d=>{const f=this.tileUrlFunction(d,e,t),g=this.sourceTileCache.containsKey(f)?this.sourceTileCache.get(f):new this.tileClass(d,f?$.IDLE:$.EMPTY,f,this.format_,this.tileLoadFunction);n.sourceTiles.push(g);const p=g.getState();if(p<$.LOADED){const m=_=>{this.handleTileChange(_);const y=g.getState();if(y===$.LOADED||y===$.ERROR){const x=g.getKey();x in n.errorTileKeys?g.getState()===$.LOADED&&delete n.errorTileKeys[x]:n.loadingSourceTiles--,y===$.ERROR?n.errorTileKeys[x]=!0:g.removeEventListener(ee.CHANGE,m),n.loadingSourceTiles===0&&n.setState(hs(n.errorTileKeys)?$.LOADED:$.ERROR)}};g.addEventListener(ee.CHANGE,m),n.loadingSourceTiles++}p===$.IDLE&&(g.extent=h.getTileCoordExtent(d),g.projection=t,g.resolution=h.getResolution(d[0]),this.sourceTileCache.set(f,g),g.load())}),n.loadingSourceTiles||n.setState(n.sourceTiles.some(d=>d.getState()===$.ERROR)?$.ERROR:$.LOADED)}return n.sourceTiles}getTile(e,t,n,s,r){const o=bo(e,t,n),a=this.getKey();let l;if(this.tileCache.containsKey(o)&&(l=this.tileCache.get(o),l.key===a))return l;const h=[e,t,n];let c=this.getTileCoordForTileUrlFunction(h,r);const u=this.getTileGrid().getExtent(),d=this.getTileGridForProjection(r);if(c&&u){const p=d.getTileCoordExtent(c);Vi(p,-d.getResolution(e),p),Qe(u,p)||(c=null)}let f=!0;if(c!==null){const p=this.tileGrid,m=d.getResolution(e),_=p.getZForResolution(m,1),y=d.getTileCoordExtent(c);Vi(y,-m,y),p.forEachTileCoord(y,_,x=>{f=f&&!this.tileUrlFunction(x,s,r)})}const g=new mA(h,f?$.EMPTY:$.IDLE,c,this.getSourceTiles.bind(this,s,r));return g.key=a,l?(g.interimTile=l,g.refreshInterimChain(),this.tileCache.replace(o,g)):this.tileCache.set(o,g),g}getTileGridForProjection(e){const t=e.getCode();let n=this.tileGrids_[t];if(!n){const s=this.tileGrid,r=s.getResolutions().slice(),o=r.map(function(h,c){return s.getOrigin(c)}),a=r.map(function(h,c){return s.getTileSize(c)}),l=Zy+1;for(let h=r.length;h<l;++h)r.push(r[h-1]/2),o.push(o[h-1]),a.push(a[h-1]);n=new Va({extent:s.getExtent(),origins:o,resolutions:r,tileSizes:a}),this.tileGrids_[t]=n}return n}getTilePixelRatio(e){return e}getTilePixelSize(e,t,n){const s=this.getTileGridForProjection(n),r=Vt(s.getTileSize(e),this.tmpSize);return[Math.round(r[0]*t),Math.round(r[1]*t)]}updateCacheSize(e,t){super.updateCacheSize(e*2,t),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(t).highWaterMark}}const bA=wA;function Z_(i,e){i.setLoader(function(t,n,s){h_(e,i.getFormat(),t,n,s,i.onLoad.bind(i),i.onError.bind(i))})}function K_(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var EA={},J_,Em={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Wo(i){return i=Math.round(i),i<0?0:i>255?255:i}function Mm(i){return i<0?0:i>1?1:i}function tu(i){return i[i.length-1]==="%"?Wo(parseFloat(i)/100*255):Wo(parseInt(i))}function Ml(i){return i[i.length-1]==="%"?Mm(parseFloat(i)/100):Mm(parseFloat(i))}function iu(i,e,t){return t<0?t+=1:t>1&&(t-=1),t*6<1?i+(e-i)*t*6:t*2<1?e:t*3<2?i+(e-i)*(2/3-t)*6:i}function MA(i){var e=i.replace(/ /g,"").toLowerCase();if(e in Em)return Em[e].slice();if(e[0]==="#"){if(e.length===4){var t=parseInt(e.substr(1),16);return t>=0&&t<=4095?[(t&3840)>>4|(t&3840)>>8,t&240|(t&240)>>4,t&15|(t&15)<<4,1]:null}else if(e.length===7){var t=parseInt(e.substr(1),16);return t>=0&&t<=16777215?[(t&16711680)>>16,(t&65280)>>8,t&255,1]:null}return null}var n=e.indexOf("("),s=e.indexOf(")");if(n!==-1&&s+1===e.length){var r=e.substr(0,n),o=e.substr(n+1,s-(n+1)).split(","),a=1;switch(r){case"rgba":if(o.length!==4)return null;a=Ml(o.pop());case"rgb":return o.length!==3?null:[tu(o[0]),tu(o[1]),tu(o[2]),a];case"hsla":if(o.length!==4)return null;a=Ml(o.pop());case"hsl":if(o.length!==3)return null;var l=(parseFloat(o[0])%360+360)%360/360,h=Ml(o[1]),c=Ml(o[2]),u=c<=.5?c*(h+1):c+h-c*h,d=c*2-u;return[Wo(iu(d,u,l+1/3)*255),Wo(iu(d,u,l)*255),Wo(iu(d,u,l-1/3)*255),a];default:return null}}return null}try{J_=EA.parseCSSColor=MA}catch{}let Ki=class rd{constructor(e,t,n,s=1){this.r=e,this.g=t,this.b=n,this.a=s}static parse(e){if(!e)return;if(e instanceof rd)return e;if(typeof e!="string")return;const t=J_(e);if(t)return new rd(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3])}toString(){const[e,t,n,s]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(n)},${s})`}toArray(){const{r:e,g:t,b:n,a:s}=this;return s===0?[0,0,0,0]:[e*255/s,t*255/s,n*255/s,s]}toArray01(){const{r:e,g:t,b:n,a:s}=this;return s===0?[0,0,0,0]:[e/s,t/s,n/s,s]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:n,a:s}=this;return[e,t,n,s]}};Ki.black=new Ki(0,0,0,1);Ki.white=new Ki(1,1,1,1);Ki.transparent=new Ki(0,0,0,0);Ki.red=new Ki(1,0,0,1);Ki.blue=new Ki(0,0,1,1);var vi=Ki;function ca(i){return typeof i=="object"?["literal",i]:i}function CA(i,e){let t=i.stops;if(!t)return SA(i,e);const n=t&&typeof t[0][0]=="object",s=n||i.property!==void 0,r=n||!s;return t=t.map(o=>!s&&e.tokens&&typeof o[1]=="string"?[o[0],LA(o[1])]:[o[0],ca(o[1])]),n?TA(i,e,t):r?IA(i,e,t):od(i,e,t)}function SA(i,e){const t=["get",i.property];if(i.default===void 0)return e.type==="string"?["string",t]:t;if(e.type==="enum")return["match",t,Object.keys(e.values),t,i.default];{const n=[e.type==="color"?"to-color":e.type,t,ca(i.default)];return e.type==="array"&&n.splice(1,0,e.value,e.length||null),n}}function Xf(i){switch(i.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function TA(i,e,t){const n={},s={},r=[];for(let a=0;a<t.length;a++){const l=t[a],h=l[0].zoom;n[h]===void 0&&(n[h]={zoom:h,type:i.type,property:i.property,default:i.default},s[h]=[],r.push(h)),s[h].push([l[0].value,l[1]])}if(Hf({},e)==="exponential"){const a=[Xf(i),["linear"],["zoom"]];for(const l of r){const h=od(n[l],e,s[l]);Dr(a,l,h,!1)}return a}else{const a=["step",["zoom"]];for(const l of r){const h=od(n[l],e,s[l]);Dr(a,l,h,!0)}return Yf(a),a}}function RA(i,e){if(i!==void 0)return i;if(e!==void 0)return e}function Cm(i,e){const t=ca(RA(i.default,e.default));return t===void 0&&e.type==="resolvedImage"?"":t}function od(i,e,t){const n=Hf(i,e),s=["get",i.property];if(n==="categorical"&&typeof t[0][0]=="boolean"){const r=["case"];for(const o of t)r.push(["==",s,o[0]],o[1]);return r.push(Cm(i,e)),r}else if(n==="categorical"){const r=["match",s];for(const o of t)Dr(r,o[0],o[1],!1);return r.push(Cm(i,e)),r}else if(n==="interval"){const r=["step",["number",s]];for(const o of t)Dr(r,o[0],o[1],!0);return Yf(r),i.default===void 0?r:["case",["==",["typeof",s],"number"],r,ca(i.default)]}else if(n==="exponential"){const r=i.base!==void 0?i.base:1,o=[Xf(i),r===1?["linear"]:["exponential",r],["number",s]];for(const a of t)Dr(o,a[0],a[1],!1);return i.default===void 0?o:["case",["==",["typeof",s],"number"],o,ca(i.default)]}else throw new Error(`Unknown property function type ${n}`)}function IA(i,e,t,n=["zoom"]){const s=Hf(i,e);let r,o=!1;if(s==="interval")r=["step",n],o=!0;else if(s==="exponential"){const a=i.base!==void 0?i.base:1;r=[Xf(i),a===1?["linear"]:["exponential",a],n]}else throw new Error(`Unknown zoom function type "${s}"`);for(const a of t)Dr(r,a[0],a[1],o);return Yf(r),r}function Yf(i){i[0]==="step"&&i.length===3&&(i.push(0),i.push(i[3]))}function Dr(i,e,t,n){i.length>3&&e===i[i.length-2]||(n&&i.length===2||i.push(e),i.push(t))}function Hf(i,e){return i.type?i.type:e.expression.interpolated?"exponential":"interval"}function LA(i){const e=["concat"],t=/{([^{}]+)}/g;let n=0;for(let s=t.exec(i);s!==null;s=t.exec(i)){const r=i.slice(n,t.lastIndex-s[0].length);n=t.lastIndex,r.length>0&&e.push(r),e.push(["get",s[1]])}if(e.length===1)return i;if(n<i.length)e.push(i.slice(n));else if(e.length===2)return["to-string",e[1]];return e}class PA extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var on=PA;class Zf{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[n,s]of t)this.bindings[n]=s}concat(e){return new Zf(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return this.bindings[e]?!0:this.parent?this.parent.has(e):!1}}var AA=Zf;const mc={kind:"null"},G={kind:"number"},pe={kind:"string"},ce={kind:"boolean"},Fn={kind:"color"},Gr={kind:"object"},ue={kind:"value"},FA={kind:"error"},yc={kind:"collator"},_c={kind:"formatted"},Ya={kind:"resolvedImage"};function Pi(i,e){return{kind:"array",itemType:i,N:e}}function He(i){if(i.kind==="array"){const e=He(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}else return i.kind}const kA=[mc,G,pe,ce,Fn,_c,Gr,Pi(ue),Ya];function ua(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ua(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const t of kA)if(!ua(t,e))return null}}return`Expected ${He(i)} but found ${He(e)} instead.`}function Kf(i,e){return e.some(t=>t.kind===i.kind)}function da(i,e){return e.some(t=>t==="null"?i===null:t==="array"?Array.isArray(i):t==="object"?i&&!Array.isArray(i)&&typeof i=="object":t===typeof i)}class Jf{constructor(e,t,n){e?this.sensitivity=t?"variant":"case":this.sensitivity=t?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ad{constructor(e,t,n,s,r){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=n,this.fontStack=s,this.textColor=r}}class gn{constructor(e){this.sections=e}static fromString(e){return new gn([new ad(e,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof gn?e:gn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const n={};t.fontStack&&(n["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(n["font-scale"]=t.scale),t.textColor&&(n["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(n)}return e}}class _s{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new _s({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Q_(i,e,t,n){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255?typeof n>"u"||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[i,e,t,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[i,e,t,n]:[i,e,t]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Eh(i){if(i===null)return!0;if(typeof i=="string")return!0;if(typeof i=="boolean")return!0;if(typeof i=="number")return!0;if(i instanceof vi)return!0;if(i instanceof Jf)return!0;if(i instanceof gn)return!0;if(i instanceof _s)return!0;if(Array.isArray(i)){for(const e of i)if(!Eh(e))return!1;return!0}else if(typeof i=="object"){for(const e in i)if(!Eh(i[e]))return!1;return!0}else return!1}function yt(i){if(i===null)return mc;if(typeof i=="string")return pe;if(typeof i=="boolean")return ce;if(typeof i=="number")return G;if(i instanceof vi)return Fn;if(i instanceof Jf)return yc;if(i instanceof gn)return _c;if(i instanceof _s)return Ya;if(Array.isArray(i)){const e=i.length;let t;for(const n of i){const s=yt(n);if(!t)t=s;else{if(t===s)continue;t=ue;break}}return Pi(t||ue,e)}else return Gr}function Vo(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof vi||i instanceof gn||i instanceof _s?i.toString():JSON.stringify(i)}class Qf{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(e.length!==2)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Eh(e[1]))return t.error("invalid value");const n=e[1];let s=yt(n);const r=t.expectedType;return s.kind==="array"&&s.N===0&&r&&r.kind==="array"&&(typeof r.N!="number"||r.N===0)&&(s=r),new Qf(s,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof vi?["rgba"].concat(this.value.toArray()):this.value instanceof gn?this.value.serialize():this.value}}var Mh=Qf;class OA{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}var It=OA;const nu={string:pe,number:G,boolean:ce,object:Gr};class eg{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n=1,s;const r=e[0];if(r==="array"){let a;if(e.length>2){const h=e[1];if(typeof h!="string"||!(h in nu)||h==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);a=nu[h],n++}else a=ue;let l;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);l=e[2],n++}s=Pi(a,l)}else s=nu[r];const o=[];for(;n<e.length;n++){const a=t.parse(e[n],n,ue);if(!a)return null;o.push(a)}return new eg(s,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const n=this.args[t].evaluate(e);if(ua(this.type,yt(n))){if(t===this.args.length-1)throw new It(`Expected value to be of type ${He(this.type)}, but found ${He(yt(n))} instead.`)}else return n}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,t=[e.kind];if(e.kind==="array"){const n=e.itemType;if(n.kind==="string"||n.kind==="number"||n.kind==="boolean"){t.push(n.kind);const s=e.N;(typeof s=="number"||this.args.length>1)&&t.push(s)}}return t.concat(this.args.map(n=>n.serialize()))}}var Sn=eg;class vc{constructor(e){this.type=_c,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&typeof n=="object")return t.error("First argument must be an image or text section.");const s=[];let r=!1;for(let o=1;o<=e.length-1;++o){const a=e[o];if(r&&typeof a=="object"&&!Array.isArray(a)){r=!1;let l=null;if(a["font-scale"]&&(l=t.parse(a["font-scale"],1,G),!l))return null;let h=null;if(a["text-font"]&&(h=t.parse(a["text-font"],1,Pi(pe)),!h))return null;let c=null;if(a["text-color"]&&(c=t.parse(a["text-color"],1,Fn),!c))return null;const u=s[s.length-1];u.scale=l,u.font=h,u.textColor=c}else{const l=t.parse(e[o],1,ue);if(!l)return null;const h=l.type.kind;if(h!=="string"&&h!=="value"&&h!=="null"&&h!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,s.push({content:l,scale:null,font:null,textColor:null})}}return new vc(s)}evaluate(e){const t=n=>{const s=n.content.evaluate(e);return yt(s)===Ya?new ad("",s,null,null,null):new ad(Vo(s),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)};return new gn(this.sections.map(t))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const n={};t.scale&&(n["font-scale"]=t.scale.serialize()),t.font&&(n["text-font"]=t.font.serialize()),t.textColor&&(n["text-color"]=t.textColor.serialize()),e.push(n)}return e}}class xc{constructor(e){this.type=Ya,this.input=e}static parse(e,t){if(e.length!==2)return t.error("Expected two arguments.");const n=t.parse(e[1],1,pe);return n?new xc(n):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),n=_s.fromString(t);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(t)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const NA={"to-boolean":ce,"to-color":Fn,"to-number":G,"to-string":pe};class tg{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[0];if((n==="to-boolean"||n==="to-string")&&e.length!==2)return t.error("Expected one argument.");const s=NA[n],r=[];for(let o=1;o<e.length;o++){const a=t.parse(e[o],o,ue);if(!a)return null;r.push(a)}return new tg(s,r)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let t,n;for(const s of this.args){if(t=s.evaluate(e),n=null,t instanceof vi)return t;if(typeof t=="string"){const r=e.parseColor(t);if(r)return r}else if(Array.isArray(t)&&(t.length<3||t.length>4?n=`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:n=Q_(t[0],t[1],t[2],t[3]),!n))return new vi(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new It(n||`Could not parse color from value '${typeof t=="string"?t:String(JSON.stringify(t))}'`)}else if(this.type.kind==="number"){let t=null;for(const n of this.args){if(t=n.evaluate(e),t===null)return 0;const s=Number(t);if(!isNaN(s))return s}throw new It(`Could not convert ${JSON.stringify(t)} to number.`)}else return this.type.kind==="formatted"?gn.fromString(Vo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?_s.fromString(Vo(this.args[0].evaluate(e))):Vo(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new vc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new xc(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(t=>{e.push(t.serialize())}),e}}var Rr=tg;const DA=["Unknown","Point","LineString","Polygon"];class GA{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?DA[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:n,y:s}=this.featureTileCoord,r=n*t-e[0],o=s*t-e[1],a=this.featureDistanceData.bearing[0],l=this.featureDistanceData.bearing[1];return a*r+l*o}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=vi.parse(e)),t}}var e1=GA;class Ir{constructor(e,t,n,s){this.name=e,this.type=t,this._evaluate=n,this.args=s}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,t){const n=e[0],s=Ir.definitions[n];if(!s)return t.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const r=Array.isArray(s)?s[0]:s.type,o=Array.isArray(s)?[[s[1],s[2]]]:s.overloads,a=o.filter(([h])=>!Array.isArray(h)||h.length===e.length-1);let l=null;for(const[h,c]of a){l=new r1(t.registry,t.path,null,t.scope);const u=[];let d=!1;for(let f=1;f<e.length;f++){const g=e[f],p=Array.isArray(h)?h[f-1]:h.type,m=l.parse(g,1+u.length,p);if(!m){d=!0;break}u.push(m)}if(!d){if(Array.isArray(h)&&h.length!==u.length){l.error(`Expected ${h.length} arguments, but found ${u.length} instead.`);continue}for(let f=0;f<u.length;f++){const g=Array.isArray(h)?h[f]:h.type,p=u[f];l.concat(f+1).checkSubtype(g,p.type)}if(l.errors.length===0)return new Ir(n,r,c,u)}}if(a.length===1)t.errors.push(...l.errors);else{const c=(a.length?a:o).map(([d])=>zA(d)).join(" | "),u=[];for(let d=1;d<e.length;d++){const f=t.parse(e[d],1+u.length);if(!f)return null;u.push(He(f.type))}t.error(`Expected arguments of type ${c}, but found (${u.join(", ")}) instead.`)}return null}static register(e,t){Ir.definitions=t;for(const n in t)e[n]=Ir}}function zA(i){return Array.isArray(i)?`(${i.map(He).join(", ")})`:`(${He(i.type)}...)`}var Eo=Ir;class wc{constructor(e,t,n){this.type=yc,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(e.length!==2)return t.error("Expected one argument.");const n=e[1];if(typeof n!="object"||Array.isArray(n))return t.error("Collator options argument must be an object.");const s=t.parse(n["case-sensitive"]===void 0?!1:n["case-sensitive"],1,ce);if(!s)return null;const r=t.parse(n["diacritic-sensitive"]===void 0?!1:n["diacritic-sensitive"],1,ce);if(!r)return null;let o=null;return n.locale&&(o=t.parse(n.locale,1,pe),!o)?null:new wc(s,r,o)}evaluate(e){return new Jf(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const os=8192;function ig(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function BA(i){return(180+i)/360}function $A(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Ch(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function UA(i,e){const t=BA(i[0]),n=$A(i[1]),s=Math.pow(2,e.z);return[Math.round(t*s*os),Math.round(n*s*os)]}function qA(i,e,t){const n=i[0]-e[0],s=i[1]-e[1],r=i[0]-t[0],o=i[1]-t[1];return n*o-r*s===0&&n*r<=0&&s*o<=0}function jA(i,e,t){return e[1]>i[1]!=t[1]>i[1]&&i[0]<(t[0]-e[0])*(i[1]-e[1])/(t[1]-e[1])+e[0]}function ng(i,e){let t=!1;for(let n=0,s=e.length;n<s;n++){const r=e[n];for(let o=0,a=r.length;o<a-1;o++){if(qA(i,r[o],r[o+1]))return!1;jA(i,r[o],r[o+1])&&(t=!t)}}return t}function WA(i,e){for(let t=0;t<e.length;t++)if(ng(i,e[t]))return!0;return!1}function VA(i,e){return i[0]*e[1]-i[1]*e[0]}function Sm(i,e,t,n){const s=i[0]-t[0],r=i[1]-t[1],o=e[0]-t[0],a=e[1]-t[1],l=n[0]-t[0],h=n[1]-t[1],c=s*h-l*r,u=o*h-l*a;return c>0&&u<0||c<0&&u>0}function XA(i,e,t,n){const s=[e[0]-i[0],e[1]-i[1]],r=[n[0]-t[0],n[1]-t[1]];return VA(r,s)===0?!1:!!(Sm(i,e,t,n)&&Sm(t,n,i,e))}function YA(i,e,t){for(const n of t)for(let s=0;s<n.length-1;++s)if(XA(i,e,n[s],n[s+1]))return!0;return!1}function t1(i,e){for(let t=0;t<i.length;++t)if(!ng(i[t],e))return!1;for(let t=0;t<i.length-1;++t)if(YA(i[t],i[t+1],e))return!1;return!0}function HA(i,e){for(let t=0;t<e.length;t++)if(t1(i,e[t]))return!0;return!1}function sg(i,e,t){const n=[];for(let s=0;s<i.length;s++){const r=[];for(let o=0;o<i[s].length;o++){const a=UA(i[s][o],t);ig(e,a),r.push(a)}n.push(r)}return n}function i1(i,e,t){const n=[];for(let s=0;s<i.length;s++){const r=sg(i[s],e,t);n.push(r)}return n}function n1(i,e,t,n){if(i[0]<t[0]||i[0]>t[2]){const s=n*.5;let r=i[0]-t[0]>s?-n:t[0]-i[0]>s?n:0;r===0&&(r=i[0]-t[2]>s?-n:t[2]-i[0]>s?n:0),i[0]+=r}ig(e,i)}function ZA(i){i[0]=i[1]=1/0,i[2]=i[3]=-1/0}function Tm(i,e,t,n){const s=Math.pow(2,n.z)*os,r=[n.x*os,n.y*os],o=[];if(!i)return o;for(const a of i)for(const l of a){const h=[l.x+r[0],l.y+r[1]];n1(h,e,t,s),o.push(h)}return o}function Rm(i,e,t,n){const s=Math.pow(2,n.z)*os,r=[n.x*os,n.y*os],o=[];if(!i)return o;for(const a of i){const l=[];for(const h of a){const c=[h.x+r[0],h.y+r[1]];ig(e,c),l.push(c)}o.push(l)}if(e[2]-e[0]<=s/2){ZA(e);for(const a of o)for(const l of a)n1(l,e,t,s)}return o}function KA(i,e){const t=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],s=i.canonicalID();if(!s)return!1;if(e.type==="Polygon"){const r=sg(e.coordinates,n,s),o=Tm(i.geometry(),t,n,s);if(!Ch(t,n))return!1;for(const a of o)if(!ng(a,r))return!1}if(e.type==="MultiPolygon"){const r=i1(e.coordinates,n,s),o=Tm(i.geometry(),t,n,s);if(!Ch(t,n))return!1;for(const a of o)if(!WA(a,r))return!1}return!0}function JA(i,e){const t=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],s=i.canonicalID();if(!s)return!1;if(e.type==="Polygon"){const r=sg(e.coordinates,n,s),o=Rm(i.geometry(),t,n,s);if(!Ch(t,n))return!1;for(const a of o)if(!t1(a,r))return!1}if(e.type==="MultiPolygon"){const r=i1(e.coordinates,n,s),o=Rm(i.geometry(),t,n,s);if(!Ch(t,n))return!1;for(const a of o)if(!HA(a,r))return!1}return!0}class Xo{constructor(e,t){this.type=ce,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Eh(e[1])){const n=e[1];if(n.type==="FeatureCollection")for(let s=0;s<n.features.length;++s){const r=n.features[s].geometry.type;if(r==="Polygon"||r==="MultiPolygon")return new Xo(n,n.features[s].geometry)}else if(n.type==="Feature"){const s=n.geometry.type;if(s==="Polygon"||s==="MultiPolygon")return new Xo(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new Xo(n,n)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return KA(e,this.geometries);if(e.geometryType()==="LineString")return JA(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var rg=Xo;function bc(i){if(i instanceof Eo){if(i.name==="get"&&i.args.length===1)return!1;if(i.name==="feature-state")return!1;if(i.name==="has"&&i.args.length===1)return!1;if(i.name==="properties"||i.name==="geometry-type"||i.name==="id")return!1;if(/^filter-/.test(i.name))return!1}if(i instanceof rg)return!1;let e=!0;return i.eachChild(t=>{e&&!bc(t)&&(e=!1)}),e}function og(i){if(i instanceof Eo&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(t=>{e&&!og(t)&&(e=!1)}),e}function ag(i,e){if(i instanceof Eo&&e.indexOf(i.name)>=0)return!1;let t=!0;return i.eachChild(n=>{t&&!ag(n,e)&&(t=!1)}),t}class lg{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");const n=e[1];return t.scope.has(n)?new lg(n,t.scope.get(n)):t.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var s1=lg;class hg{constructor(e,t=[],n,s=new AA,r=[]){this.registry=e,this.path=t,this.key=t.map(o=>`[${o}]`).join(""),this.scope=s,this.errors=r,this.expectedType=n}parse(e,t,n,s,r={}){return t?this.concat(t,n,s)._parse(e,r):this._parse(e,r)}_parse(e,t){(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number")&&(e=["literal",e]);function n(s,r,o){return o==="assert"?new Sn(r,[s]):o==="coerce"?new Rr(r,[s]):s}if(Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const s=e[0];if(typeof s!="string")return this.error(`Expression name must be a string, but found ${typeof s} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const r=this.registry[s];if(r){let o=r.parse(e,this);if(!o)return null;if(this.expectedType){const a=this.expectedType,l=o.type;if((a.kind==="string"||a.kind==="number"||a.kind==="boolean"||a.kind==="object"||a.kind==="array")&&l.kind==="value")o=n(o,a,t.typeAnnotation||"assert");else if((a.kind==="color"||a.kind==="formatted"||a.kind==="resolvedImage")&&(l.kind==="value"||l.kind==="string"))o=n(o,a,t.typeAnnotation||"coerce");else if(this.checkSubtype(a,l))return null}if(!(o instanceof Mh)&&o.type.kind!=="resolvedImage"&&ld(o)){const a=new e1;try{o=new Mh(o.type,o.evaluate(a))}catch(l){return this.error(l.message),null}}return o}return this.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof e>"u"?this.error("'undefined' value invalid. Use null instead."):typeof e=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof e} instead.`)}concat(e,t,n){const s=typeof e=="number"?this.path.concat(e):this.path,r=n?this.scope.concat(n):this.scope;return new hg(this.registry,s,t||null,r,this.errors)}error(e,...t){const n=`${this.key}${t.map(s=>`[${s}]`).join("")}`;this.errors.push(new on(n,e))}checkSubtype(e,t){const n=ua(e,t);return n&&this.error(n),n}}var r1=hg;function ld(i){if(i instanceof s1)return ld(i.boundExpression);if(i instanceof Eo&&i.name==="error")return!1;if(i instanceof wc)return!1;if(i instanceof rg)return!1;const e=i instanceof Rr||i instanceof Sn;let t=!0;return i.eachChild(n=>{e?t=t&&ld(n):t=t&&n instanceof Mh}),t?bc(i)&&ag(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"]):!1}function o1(i,e){const t=i.length-1;let n=0,s=t,r=0,o,a;for(;n<=s;)if(r=Math.floor((n+s)/2),o=i[r],a=i[r+1],o<=e){if(r===t||e<a)return r;n=r+1}else if(o>e)s=r-1;else throw new It("Input is not a number.");return 0}class cg{constructor(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[s,r]of n)this.labels.push(s),this.outputs.push(r)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return t.error("Expected an even number of arguments.");const n=t.parse(e[1],1,G);if(!n)return null;const s=[];let r=null;t.expectedType&&t.expectedType.kind!=="value"&&(r=t.expectedType);for(let o=1;o<e.length;o+=2){const a=o===1?-1/0:e[o],l=e[o+1],h=o,c=o+1;if(typeof a!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',h);if(s.length&&s[s.length-1][0]>=a)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',h);const u=t.parse(l,c,r);if(!u)return null;r=r||u.type,s.push([a,u])}return new cg(r,n,s)}evaluate(e){const t=this.labels,n=this.outputs;if(t.length===1)return n[0].evaluate(e);const s=this.input.evaluate(e);if(s<=t[0])return n[0].evaluate(e);const r=t.length;if(s>=t[r-1])return n[r-1].evaluate(e);const o=o1(t,s);return n[o].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var a1=cg,QA=Mo;function Mo(i,e,t,n){this.cx=3*i,this.bx=3*(t-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=n,this.p2x=t,this.p2y=n}Mo.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i};Mo.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i};Mo.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx};Mo.prototype.solveCurveX=function(i,e){typeof e>"u"&&(e=1e-6);var t,n,s,r,o;for(s=i,o=0;o<8;o++){if(r=this.sampleCurveX(s)-i,Math.abs(r)<e)return s;var a=this.sampleCurveDerivativeX(s);if(Math.abs(a)<1e-6)break;s=s-r/a}if(t=0,n=1,s=i,s<t)return t;if(s>n)return n;for(;t<n;){if(r=this.sampleCurveX(s),Math.abs(r-i)<e)return s;i>r?t=s:n=s,s=(n-t)*.5+t}return s};Mo.prototype.solve=function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))};var eF=K_(QA);function gi(i,e,t){return i*(1-t)+e*t}function tF(i,e,t){return new vi(gi(i.r,e.r,t),gi(i.g,e.g,t),gi(i.b,e.b,t),gi(i.a,e.a,t))}function iF(i,e,t){return i.map((n,s)=>gi(n,e[s],t))}var nF=Object.freeze({__proto__:null,number:gi,color:tF,array:iF});const l1=.95047,h1=1,c1=1.08883,u1=4/29,zr=6/29,d1=3*zr*zr,sF=zr*zr*zr,rF=Math.PI/180,oF=180/Math.PI;function su(i){return i>sF?Math.pow(i,1/3):i/d1+u1}function ru(i){return i>zr?i*i*i:d1*(i-u1)}function ou(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function au(i){return i/=255,i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function f1(i){const e=au(i.r),t=au(i.g),n=au(i.b),s=su((.4124564*e+.3575761*t+.1804375*n)/l1),r=su((.2126729*e+.7151522*t+.072175*n)/h1),o=su((.0193339*e+.119192*t+.9503041*n)/c1);return{l:116*r-16,a:500*(s-r),b:200*(r-o),alpha:i.a}}function g1(i){let e=(i.l+16)/116,t=isNaN(i.a)?e:e+i.a/500,n=isNaN(i.b)?e:e-i.b/200;return e=h1*ru(e),t=l1*ru(t),n=c1*ru(n),new vi(ou(3.2404542*t-1.5371385*e-.4985314*n),ou(-.969266*t+1.8760108*e+.041556*n),ou(.0556434*t-.2040259*e+1.0572252*n),i.alpha)}function aF(i,e,t){return{l:gi(i.l,e.l,t),a:gi(i.a,e.a,t),b:gi(i.b,e.b,t),alpha:gi(i.alpha,e.alpha,t)}}function lF(i){const{l:e,a:t,b:n}=f1(i),s=Math.atan2(n,t)*oF;return{h:s<0?s+360:s,c:Math.sqrt(t*t+n*n),l:e,alpha:i.a}}function hF(i){const e=i.h*rF,t=i.c,n=i.l;return g1({l:n,a:Math.cos(e)*t,b:Math.sin(e)*t,alpha:i.alpha})}function cF(i,e,t){const n=e-i;return i+t*(n>180||n<-180?n-360*Math.round(n/360):n)}function uF(i,e,t){return{h:cF(i.h,e.h,t),c:gi(i.c,e.c,t),l:gi(i.l,e.l,t),alpha:gi(i.alpha,e.alpha,t)}}const Cl={forward:f1,reverse:g1,interpolate:aF},Sl={forward:lF,reverse:hF,interpolate:uF};class Sh{constructor(e,t,n,s,r){this.type=e,this.operator=t,this.interpolation=n,this.input=s,this.labels=[],this.outputs=[];for(const[o,a]of r)this.labels.push(o),this.outputs.push(a)}static interpolationFactor(e,t,n,s){let r=0;if(e.name==="exponential")r=lu(t,e.base,n,s);else if(e.name==="linear")r=lu(t,1,n,s);else if(e.name==="cubic-bezier"){const o=e.controlPoints;r=new eF(o[0],o[1],o[2],o[3]).solve(lu(t,1,n,s))}return r}static parse(e,t){let[n,s,r,...o]=e;if(!Array.isArray(s)||s.length===0)return t.error("Expected an interpolation type expression.",1);if(s[0]==="linear")s={name:"linear"};else if(s[0]==="exponential"){const h=s[1];if(typeof h!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);s={name:"exponential",base:h}}else if(s[0]==="cubic-bezier"){const h=s.slice(1);if(h.length!==4||h.some(c=>typeof c!="number"||c<0||c>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);s={name:"cubic-bezier",controlPoints:h}}else return t.error(`Unknown interpolation type ${String(s[0])}`,1,0);if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return t.error("Expected an even number of arguments.");if(r=t.parse(r,2,G),!r)return null;const a=[];let l=null;n==="interpolate-hcl"||n==="interpolate-lab"?l=Fn:t.expectedType&&t.expectedType.kind!=="value"&&(l=t.expectedType);for(let h=0;h<o.length;h+=2){const c=o[h],u=o[h+1],d=h+3,f=h+4;if(typeof c!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',d);if(a.length&&a[a.length-1][0]>=c)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',d);const g=t.parse(u,f,l);if(!g)return null;l=l||g.type,a.push([c,g])}return l.kind!=="number"&&l.kind!=="color"&&!(l.kind==="array"&&l.itemType.kind==="number"&&typeof l.N=="number")?t.error(`Type ${He(l)} is not interpolatable.`):new Sh(l,n,s,r,a)}evaluate(e){const t=this.labels,n=this.outputs;if(t.length===1)return n[0].evaluate(e);const s=this.input.evaluate(e);if(s<=t[0])return n[0].evaluate(e);const r=t.length;if(s>=t[r-1])return n[r-1].evaluate(e);const o=o1(t,s),a=t[o],l=t[o+1],h=Sh.interpolationFactor(this.interpolation,s,a,l),c=n[o].evaluate(e),u=n[o+1].evaluate(e);return this.operator==="interpolate"?nF[this.type.kind.toLowerCase()](c,u,h):this.operator==="interpolate-hcl"?Sl.reverse(Sl.interpolate(Sl.forward(c),Sl.forward(u),h)):Cl.reverse(Cl.interpolate(Cl.forward(c),Cl.forward(u),h))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;this.interpolation.name==="linear"?e=["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?e=["linear"]:e=["exponential",this.interpolation.base]:e=["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)t.push(this.labels[n],this.outputs[n].serialize());return t}}function lu(i,e,t,n){const s=n-t,r=i-t;return s===0?0:e===1?r/s:(Math.pow(e,r)-1)/(Math.pow(e,s)-1)}var Ds=Sh;class Th{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let n=null;const s=t.expectedType;s&&s.kind!=="value"&&(n=s);const r=[];for(const a of e.slice(1)){const l=t.parse(a,1+r.length,n,void 0,{typeAnnotation:"omit"});if(!l)return null;n=n||l.type,r.push(l)}return s&&r.some(a=>ua(s,a.type))?new Th(ue,r):new Th(n,r)}evaluate(e){let t=null,n=0,s;for(const r of this.args){if(n++,t=r.evaluate(e),t&&t instanceof _s&&!t.available&&(s||(s=t),t=null,n===this.args.length))return s;if(t!==null)break}return t}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var p1=Th;class ug{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let r=1;r<e.length-1;r+=2){const o=e[r];if(typeof o!="string")return t.error(`Expected string, but found ${typeof o} instead.`,r);if(/[^a-zA-Z0-9_]/.test(o))return t.error("Variable names must contain only alphanumeric characters or '_'.",r);const a=t.parse(e[r+1],r+1);if(!a)return null;n.push([o,a])}const s=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return s?new ug(n,s):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,n]of this.bindings)e.push(t,n.serialize());return e.push(this.result.serialize()),e}}var m1=ug;class dg{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,G),s=t.parse(e[2],2,Pi(t.expectedType||ue));if(!n||!s)return null;const r=s.type;return new dg(r.itemType,n,s)}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new It(`Array index out of bounds: ${t} < 0.`);if(t>=n.length)throw new It(`Array index out of bounds: ${t} > ${n.length-1}.`);if(t!==Math.floor(t))throw new It(`Array index must be an integer, but found ${t} instead.`);return n[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var dF=dg;class fg{constructor(e,t){this.type=ce,this.needle=e,this.haystack=t}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,ue),s=t.parse(e[2],2,ue);return!n||!s?null:Kf(n.type,[ce,pe,G,mc,ue])?new fg(n,s):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${He(n.type)} instead`)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(n==null)return!1;if(!da(t,["boolean","string","number","null"]))throw new It(`Expected first argument to be of type boolean, string, number or null, but found ${He(yt(t))} instead.`);if(!da(n,["string","array"]))throw new It(`Expected second argument to be of type array or string, but found ${He(yt(n))} instead.`);return n.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var fF=fg;class Rh{constructor(e,t,n){this.type=G,this.needle=e,this.haystack=t,this.fromIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,ue),s=t.parse(e[2],2,ue);if(!n||!s)return null;if(!Kf(n.type,[ce,pe,G,mc,ue]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${He(n.type)} instead`);if(e.length===4){const r=t.parse(e[3],3,G);return r?new Rh(n,s,r):null}else return new Rh(n,s)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!da(t,["boolean","string","number","null"]))throw new It(`Expected first argument to be of type boolean, string, number or null, but found ${He(yt(t))} instead.`);if(!da(n,["string","array"]))throw new It(`Expected second argument to be of type array or string, but found ${He(yt(n))} instead.`);if(this.fromIndex){const s=this.fromIndex.evaluate(e);return n.indexOf(t,s)}return n.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var gF=Rh;class gg{constructor(e,t,n,s,r,o){this.inputType=e,this.type=t,this.input=n,this.cases=s,this.outputs=r,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!==1)return t.error("Expected an even number of arguments.");let n,s;t.expectedType&&t.expectedType.kind!=="value"&&(s=t.expectedType);const r={},o=[];for(let h=2;h<e.length-1;h+=2){let c=e[h];const u=e[h+1];Array.isArray(c)||(c=[c]);const d=t.concat(h);if(c.length===0)return d.error("Expected at least one branch label.");for(const g of c){if(typeof g!="number"&&typeof g!="string")return d.error("Branch labels must be numbers or strings.");if(typeof g=="number"&&Math.abs(g)>Number.MAX_SAFE_INTEGER)return d.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof g=="number"&&Math.floor(g)!==g)return d.error("Numeric branch labels must be integer values.");if(!n)n=yt(g);else if(d.checkSubtype(n,yt(g)))return null;if(typeof r[String(g)]<"u")return d.error("Branch labels must be unique.");r[String(g)]=o.length}const f=t.parse(u,h,s);if(!f)return null;s=s||f.type,o.push(f)}const a=t.parse(e[1],1,ue);if(!a)return null;const l=t.parse(e[e.length-1],e.length-1,s);return!l||a.type.kind!=="value"&&t.concat(1).checkSubtype(n,a.type)?null:new gg(n,s,a,r,o,l)}evaluate(e){const t=this.input.evaluate(e);return(yt(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),n=[],s={};for(const o of t){const a=s[this.cases[o]];a===void 0?(s[this.cases[o]]=n.length,n.push([this.cases[o],[o]])):n[a][1].push(o)}const r=o=>this.inputType.kind==="number"?Number(o):o;for(const[o,a]of n)a.length===1?e.push(r(a[0])):e.push(a.map(r)),e.push(this.outputs[o].serialize());return e.push(this.otherwise.serialize()),e}}var pF=gg;class pg{constructor(e,t,n){this.type=e,this.branches=t,this.otherwise=n}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!==0)return t.error("Expected an odd number of arguments.");let n;t.expectedType&&t.expectedType.kind!=="value"&&(n=t.expectedType);const s=[];for(let o=1;o<e.length-1;o+=2){const a=t.parse(e[o],o,ce);if(!a)return null;const l=t.parse(e[o+1],o+1,n);if(!l)return null;s.push([a,l]),n=n||l.type}const r=t.parse(e[e.length-1],e.length-1,n);return r?new pg(n,s,r):null}evaluate(e){for(const[t,n]of this.branches)if(t.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,n]of this.branches)e(t),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var mF=pg;class Ih{constructor(e,t,n,s){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=s}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,ue),s=t.parse(e[2],2,G);if(!n||!s)return null;if(!Kf(n.type,[Pi(ue),pe,ue]))return t.error(`Expected first argument to be of type array or string, but found ${He(n.type)} instead`);if(e.length===4){const r=t.parse(e[3],3,G);return r?new Ih(n.type,n,s,r):null}else return new Ih(n.type,n,s)}evaluate(e){const t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!da(t,["string","array"]))throw new It(`Expected first argument to be of type array or string, but found ${He(yt(t))} instead.`);if(this.endIndex){const s=this.endIndex.evaluate(e);return t.slice(n,s)}return t.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var yF=Ih;function Im(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function _F(i,e,t){return e===t}function vF(i,e,t){return e!==t}function xF(i,e,t){return e<t}function wF(i,e,t){return e>t}function bF(i,e,t){return e<=t}function EF(i,e,t){return e>=t}function y1(i,e,t,n){return n.compare(e,t)===0}function MF(i,e,t,n){return!y1(i,e,t,n)}function CF(i,e,t,n){return n.compare(e,t)<0}function SF(i,e,t,n){return n.compare(e,t)>0}function TF(i,e,t,n){return n.compare(e,t)<=0}function RF(i,e,t,n){return n.compare(e,t)>=0}function Co(i,e,t){const n=i!=="=="&&i!=="!=";return class _1{constructor(r,o,a){this.type=ce,this.lhs=r,this.rhs=o,this.collator=a,this.hasUntypedArgument=r.type.kind==="value"||o.type.kind==="value"}static parse(r,o){if(r.length!==3&&r.length!==4)return o.error("Expected two or three arguments.");const a=r[0];let l=o.parse(r[1],1,ue);if(!l)return null;if(!Im(a,l.type))return o.concat(1).error(`"${a}" comparisons are not supported for type '${He(l.type)}'.`);let h=o.parse(r[2],2,ue);if(!h)return null;if(!Im(a,h.type))return o.concat(2).error(`"${a}" comparisons are not supported for type '${He(h.type)}'.`);if(l.type.kind!==h.type.kind&&l.type.kind!=="value"&&h.type.kind!=="value")return o.error(`Cannot compare types '${He(l.type)}' and '${He(h.type)}'.`);n&&(l.type.kind==="value"&&h.type.kind!=="value"?l=new Sn(h.type,[l]):l.type.kind!=="value"&&h.type.kind==="value"&&(h=new Sn(l.type,[h])));let c=null;if(r.length===4){if(l.type.kind!=="string"&&h.type.kind!=="string"&&l.type.kind!=="value"&&h.type.kind!=="value")return o.error("Cannot use collator to compare non-string types.");if(c=o.parse(r[3],3,yc),!c)return null}return new _1(l,h,c)}evaluate(r){const o=this.lhs.evaluate(r),a=this.rhs.evaluate(r);if(n&&this.hasUntypedArgument){const l=yt(o),h=yt(a);if(l.kind!==h.kind||!(l.kind==="string"||l.kind==="number"))throw new It(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${l.kind}, ${h.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const l=yt(o),h=yt(a);if(l.kind!=="string"||h.kind!=="string")return e(r,o,a)}return this.collator?t(r,o,a,this.collator.evaluate(r)):e(r,o,a)}eachChild(r){r(this.lhs),r(this.rhs),this.collator&&r(this.collator)}outputDefined(){return!0}serialize(){const r=[i];return this.eachChild(o=>{r.push(o.serialize())}),r}}}const IF=Co("==",_F,y1),LF=Co("!=",vF,MF),PF=Co("<",xF,CF),AF=Co(">",wF,SF),FF=Co("<=",bF,TF),kF=Co(">=",EF,RF);class mg{constructor(e,t,n,s,r,o){this.type=pe,this.number=e,this.locale=t,this.currency=n,this.unit=s,this.minFractionDigits=r,this.maxFractionDigits=o}static parse(e,t){if(e.length!==3)return t.error("Expected two arguments.");const n=t.parse(e[1],1,G);if(!n)return null;const s=e[2];if(typeof s!="object"||Array.isArray(s))return t.error("NumberFormat options argument must be an object.");let r=null;if(s.locale&&(r=t.parse(s.locale,1,pe),!r))return null;let o=null;if(s.currency&&(o=t.parse(s.currency,1,pe),!o))return null;let a=null;if(s.unit&&(a=t.parse(s.unit,1,pe),!a))return null;let l=null;if(s["min-fraction-digits"]&&(l=t.parse(s["min-fraction-digits"],1,G),!l))return null;let h=null;return s["max-fraction-digits"]&&(h=t.parse(s["max-fraction-digits"],1,G),!h)?null:new mg(n,r,o,a,l,h)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency&&"currency"||this.unit&&"unit"||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class yg{constructor(e){this.type=G,this.input=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=t.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?t.error(`Expected argument of type string or array, but found ${He(n.type)} instead.`):new yg(n):null}evaluate(e){const t=this.input.evaluate(e);if(typeof t=="string")return t.length;if(Array.isArray(t))return t.length;throw new It(`Expected value to be of type string or array, but found ${He(yt(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var OF=yg;const v1={"==":IF,"!=":LF,">":AF,"<":PF,">=":kF,"<=":FF,array:Sn,at:dF,boolean:Sn,case:mF,coalesce:p1,collator:wc,format:vc,image:xc,in:fF,"index-of":gF,interpolate:Ds,"interpolate-hcl":Ds,"interpolate-lab":Ds,length:OF,let:m1,literal:Mh,match:pF,number:Sn,"number-format":mg,object:Sn,slice:yF,step:a1,string:Sn,"to-boolean":Rr,"to-color":Rr,"to-number":Rr,"to-string":Rr,var:s1,within:rg};function Lm(i,[e,t,n,s]){e=e.evaluate(i),t=t.evaluate(i),n=n.evaluate(i);const r=s?s.evaluate(i):1,o=Q_(e,t,n,r);if(o)throw new It(o);return new vi(e/255*r,t/255*r,n/255*r,r)}function Pm(i,e){return i in e}function hu(i,e){const t=e[i];return typeof t>"u"?null:t}function NF(i,e,t,n){for(;t<=n;){const s=t+n>>1;if(e[s]===i)return!0;e[s]>i?n=s-1:t=s+1}return!1}function Ms(i){return{type:i}}Eo.register(v1,{error:[FA,[pe],(i,[e])=>{throw new It(e.evaluate(i))}],typeof:[pe,[ue],(i,[e])=>He(yt(e.evaluate(i)))],"to-rgba":[Pi(G,4),[Fn],(i,[e])=>e.evaluate(i).toArray()],rgb:[Fn,[G,G,G],Lm],rgba:[Fn,[G,G,G,G],Lm],has:{type:ce,overloads:[[[pe],(i,[e])=>Pm(e.evaluate(i),i.properties())],[[pe,Gr],(i,[e,t])=>Pm(e.evaluate(i),t.evaluate(i))]]},get:{type:ue,overloads:[[[pe],(i,[e])=>hu(e.evaluate(i),i.properties())],[[pe,Gr],(i,[e,t])=>hu(e.evaluate(i),t.evaluate(i))]]},"feature-state":[ue,[pe],(i,[e])=>hu(e.evaluate(i),i.featureState||{})],properties:[Gr,[],i=>i.properties()],"geometry-type":[pe,[],i=>i.geometryType()],id:[ue,[],i=>i.id()],zoom:[G,[],i=>i.globals.zoom],pitch:[G,[],i=>i.globals.pitch||0],"distance-from-center":[G,[],i=>i.distanceFromCenter()],"heatmap-density":[G,[],i=>i.globals.heatmapDensity||0],"line-progress":[G,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[G,[],i=>i.globals.skyRadialProgress||0],accumulated:[ue,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[G,Ms(G),(i,e)=>{let t=0;for(const n of e)t+=n.evaluate(i);return t}],"*":[G,Ms(G),(i,e)=>{let t=1;for(const n of e)t*=n.evaluate(i);return t}],"-":{type:G,overloads:[[[G,G],(i,[e,t])=>e.evaluate(i)-t.evaluate(i)],[[G],(i,[e])=>-e.evaluate(i)]]},"/":[G,[G,G],(i,[e,t])=>e.evaluate(i)/t.evaluate(i)],"%":[G,[G,G],(i,[e,t])=>e.evaluate(i)%t.evaluate(i)],ln2:[G,[],()=>Math.LN2],pi:[G,[],()=>Math.PI],e:[G,[],()=>Math.E],"^":[G,[G,G],(i,[e,t])=>Math.pow(e.evaluate(i),t.evaluate(i))],sqrt:[G,[G],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[G,[G],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[G,[G],(i,[e])=>Math.log(e.evaluate(i))],log2:[G,[G],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[G,[G],(i,[e])=>Math.sin(e.evaluate(i))],cos:[G,[G],(i,[e])=>Math.cos(e.evaluate(i))],tan:[G,[G],(i,[e])=>Math.tan(e.evaluate(i))],asin:[G,[G],(i,[e])=>Math.asin(e.evaluate(i))],acos:[G,[G],(i,[e])=>Math.acos(e.evaluate(i))],atan:[G,[G],(i,[e])=>Math.atan(e.evaluate(i))],min:[G,Ms(G),(i,e)=>Math.min(...e.map(t=>t.evaluate(i)))],max:[G,Ms(G),(i,e)=>Math.max(...e.map(t=>t.evaluate(i)))],abs:[G,[G],(i,[e])=>Math.abs(e.evaluate(i))],round:[G,[G],(i,[e])=>{const t=e.evaluate(i);return t<0?-Math.round(-t):Math.round(t)}],floor:[G,[G],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[G,[G],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[ce,[pe,ue],(i,[e,t])=>i.properties()[e.value]===t.value],"filter-id-==":[ce,[ue],(i,[e])=>i.id()===e.value],"filter-type-==":[ce,[pe],(i,[e])=>i.geometryType()===e.value],"filter-<":[ce,[pe,ue],(i,[e,t])=>{const n=i.properties()[e.value],s=t.value;return typeof n==typeof s&&n<s}],"filter-id-<":[ce,[ue],(i,[e])=>{const t=i.id(),n=e.value;return typeof t==typeof n&&t<n}],"filter->":[ce,[pe,ue],(i,[e,t])=>{const n=i.properties()[e.value],s=t.value;return typeof n==typeof s&&n>s}],"filter-id->":[ce,[ue],(i,[e])=>{const t=i.id(),n=e.value;return typeof t==typeof n&&t>n}],"filter-<=":[ce,[pe,ue],(i,[e,t])=>{const n=i.properties()[e.value],s=t.value;return typeof n==typeof s&&n<=s}],"filter-id-<=":[ce,[ue],(i,[e])=>{const t=i.id(),n=e.value;return typeof t==typeof n&&t<=n}],"filter->=":[ce,[pe,ue],(i,[e,t])=>{const n=i.properties()[e.value],s=t.value;return typeof n==typeof s&&n>=s}],"filter-id->=":[ce,[ue],(i,[e])=>{const t=i.id(),n=e.value;return typeof t==typeof n&&t>=n}],"filter-has":[ce,[ue],(i,[e])=>e.value in i.properties()],"filter-has-id":[ce,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[ce,[Pi(pe)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[ce,[Pi(ue)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[ce,[pe,Pi(ue)],(i,[e,t])=>t.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[ce,[pe,Pi(ue)],(i,[e,t])=>NF(i.properties()[e.value],t.value,0,t.value.length-1)],all:{type:ce,overloads:[[[ce,ce],(i,[e,t])=>e.evaluate(i)&&t.evaluate(i)],[Ms(ce),(i,e)=>{for(const t of e)if(!t.evaluate(i))return!1;return!0}]]},any:{type:ce,overloads:[[[ce,ce],(i,[e,t])=>e.evaluate(i)||t.evaluate(i)],[Ms(ce),(i,e)=>{for(const t of e)if(t.evaluate(i))return!0;return!1}]]},"!":[ce,[ce],(i,[e])=>!e.evaluate(i)],"is-supported-script":[ce,[pe],(i,[e])=>{const t=i.globals&&i.globals.isSupportedScript;return t?t(e.evaluate(i)):!0}],upcase:[pe,[pe],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[pe,[pe],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[pe,Ms(ue),(i,e)=>e.map(t=>Vo(t.evaluate(i))).join("")],"resolved-locale":[pe,[yc],(i,[e])=>e.evaluate(i).resolvedLocale()]});var x1=v1;function hd(i){return{result:"success",value:i}}function yr(i){return{result:"error",value:i}}function DF(i){return i["property-type"]==="data-driven"}function GF(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function zF(i){return!!i.expression&&i.expression.interpolated}function w1(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}class BF{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new e1,this._defaultValue=t?jF(t):null,this._enumValues=t&&t.type==="enum"?t.values:null}evaluateWithoutErrorHandling(e,t,n,s,r,o,a,l){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=s||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=l||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,n,s,r,o,a,l){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=s||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=l||null;try{const h=this.expression.evaluate(this._evaluator);if(h==null||typeof h=="number"&&h!==h)return this._defaultValue;if(this._enumValues&&!(h in this._enumValues))throw new It(`Expected value to be one of ${Object.keys(this._enumValues).map(c=>JSON.stringify(c)).join(", ")}, but found ${JSON.stringify(h)} instead.`);return h}catch(h){return this._warningHistory[h.message]||(this._warningHistory[h.message]=!0,typeof console<"u"&&console.warn(h.message)),this._defaultValue}}}function $F(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in x1}function cd(i,e){const t=new r1(x1,[],e?qF(e):void 0),n=t.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?hd(new BF(n,e)):yr(t.errors)}class Am{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!og(t.expression)}evaluateWithoutErrorHandling(e,t,n,s,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,s,r,o)}evaluate(e,t,n,s,r,o){return this._styleExpression.evaluate(e,t,n,s,r,o)}}class Fm{constructor(e,t,n,s){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!og(t.expression),this.interpolationType=s}evaluateWithoutErrorHandling(e,t,n,s,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,s,r,o)}evaluate(e,t,n,s,r,o){return this._styleExpression.evaluate(e,t,n,s,r,o)}interpolationFactor(e,t,n){return this.interpolationType?Ds.interpolationFactor(this.interpolationType,e,t,n):0}}function UF(i,e){if(i=cd(i,e),i.result==="error")return i;const t=i.value.expression,n=bc(t);if(!n&&!DF(e))return yr([new on("","data expressions not supported")]);const s=ag(t,["zoom","pitch","distance-from-center"]);if(!s&&!GF(e))return yr([new on("","zoom expressions not supported")]);const r=Gl(t);if(!r&&!s)return yr([new on("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(r instanceof on)return yr([r]);if(r instanceof Ds&&!zF(e))return yr([new on("",'"interpolate" expressions cannot be used with this property')]);if(!r)return hd(n?new Am("constant",i.value):new Am("source",i.value));const o=r instanceof Ds?r.interpolation:void 0;return hd(n?new Fm("camera",i.value,r.labels,o):new Fm("composite",i.value,r.labels,o))}function Gl(i){let e=null;if(i instanceof m1)e=Gl(i.result);else if(i instanceof p1){for(const t of i.args)if(e=Gl(t),e)break}else(i instanceof a1||i instanceof Ds)&&i.input instanceof Eo&&i.input.name==="zoom"&&(e=i);return e instanceof on||i.eachChild(t=>{const n=Gl(t);n instanceof on?e=n:!e&&n?e=new on("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new on("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function qF(i){const e={color:Fn,string:pe,number:G,enum:pe,boolean:ce,formatted:_c,resolvedImage:Ya};return i.type==="array"?Pi(e[i.value]||ue,i.length):e[i.type]}function jF(i){return i.type==="color"&&(w1(i.default)||Array.isArray(i.default))?new vi(0,0,0,0):i.type==="color"?vi.parse(i.default)||null:i.default===void 0?null:i.default}function WF(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function ud(i){if(Array.isArray(i))return i.map(ud);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const t in i)e[t]=ud(i[t]);return e}return WF(i)}var b1={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},fog:{type:"fog"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},projection:{type:"projection"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"},"fill-extrusion-edge-radius":{type:"number",private:!0,default:0,minimum:0,maximum:1,"property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_symbol:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature","pitch","distance-from-center"]}},filter_fill:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_line:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_circle:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},"filter_fill-extrusion":{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_heatmap:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},expression_name:{type:"enum",values:{let:{group:"Variable binding"},var:{group:"Variable binding"},literal:{group:"Types"},array:{group:"Types"},at:{group:"Lookup"},in:{group:"Lookup"},"index-of":{group:"Lookup"},slice:{group:"Lookup"},case:{group:"Decision"},match:{group:"Decision"},coalesce:{group:"Decision"},step:{group:"Ramps, scales, curves"},interpolate:{group:"Ramps, scales, curves"},"interpolate-hcl":{group:"Ramps, scales, curves"},"interpolate-lab":{group:"Ramps, scales, curves"},ln2:{group:"Math"},pi:{group:"Math"},e:{group:"Math"},typeof:{group:"Types"},string:{group:"Types"},number:{group:"Types"},boolean:{group:"Types"},object:{group:"Types"},collator:{group:"Types"},format:{group:"Types"},image:{group:"Types"},"number-format":{group:"Types"},"to-string":{group:"Types"},"to-number":{group:"Types"},"to-boolean":{group:"Types"},"to-rgba":{group:"Color"},"to-color":{group:"Types"},rgb:{group:"Color"},rgba:{group:"Color"},get:{group:"Lookup"},has:{group:"Lookup"},length:{group:"Lookup"},properties:{group:"Feature data"},"feature-state":{group:"Feature data"},"geometry-type":{group:"Feature data"},id:{group:"Feature data"},zoom:{group:"Camera"},pitch:{group:"Camera"},"distance-from-center":{group:"Camera"},"heatmap-density":{group:"Heatmap"},"line-progress":{group:"Feature data"},"sky-radial-progress":{group:"sky"},accumulated:{group:"Feature data"},"+":{group:"Math"},"*":{group:"Math"},"-":{group:"Math"},"/":{group:"Math"},"%":{group:"Math"},"^":{group:"Math"},sqrt:{group:"Math"},log10:{group:"Math"},ln:{group:"Math"},log2:{group:"Math"},sin:{group:"Math"},cos:{group:"Math"},tan:{group:"Math"},asin:{group:"Math"},acos:{group:"Math"},atan:{group:"Math"},min:{group:"Math"},max:{group:"Math"},round:{group:"Math"},abs:{group:"Math"},ceil:{group:"Math"},floor:{group:"Math"},distance:{group:"Math"},"==":{group:"Decision"},"!=":{group:"Decision"},">":{group:"Decision"},"<":{group:"Decision"},">=":{group:"Decision"},"<=":{group:"Decision"},all:{group:"Decision"},any:{group:"Decision"},"!":{group:"Decision"},within:{group:"Decision"},"is-supported-script":{group:"String"},upcase:{group:"String"},downcase:{group:"String"},concat:{group:"String"},"resolved-locale":{group:"String"}}},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"high-color":{type:"color","property-type":"data-constant",default:"#245cdf",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"space-color":{type:"color","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],4,.2,7,.1],minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"star-intensity":{type:"number","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],5,.35,6,0],minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},projection:{name:{type:"enum",values:{albers:{},equalEarth:{},equirectangular:{},lambertConformalConic:{},mercator:{},naturalEarth:{},winkelTripel:{},globe:{}},default:"mercator",required:!0},center:{type:"array",length:2,value:"number","property-type":"data-constant",minimum:[-180,-90],maximum:[180,90],transition:!1,requires:[{name:["albers","lambertConformalConic"]}]},parallels:{type:"array",length:2,value:"number","property-type":"data-constant",minimum:[-90,-90],maximum:[90,90],transition:!1,requires:[{name:["albers","lambertConformalConic"]}]}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,requires:["source"]}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant",type:"number",private:!0,default:0,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant",type:"number",private:!0,default:3,minimum:0,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,requires:["fill-extrusion-edge-radius"]}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!1,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{type:"array",value:"number",length:2,default:[0,0],minimum:[0,0],maximum:[1,1],transition:!1,requires:[{source:"geojson",has:{lineMetrics:!0}}],"property-type":"constant"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};function E1(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!E1(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function VF(i,e="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};E1(i)||(i=Lh(i));const t=i;let n=!0;try{n=XF(t)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(t,null,2)}
        `)}const s=b1[`filter_${e}`],r=cd(n,s);let o=null;if(r.result==="error")throw new Error(r.value.map(c=>`${c.key}: ${c.message}`).join(", "));o=(c,u,d)=>r.value.evaluate(c,u,{},d);let a=null,l=null;if(n!==t){const c=cd(t,s);if(c.result==="error")throw new Error(c.value.map(u=>`${u.key}: ${u.message}`).join(", "));a=(u,d,f,g,p)=>c.value.evaluate(u,d,{},f,void 0,void 0,g,p),l=!bc(c.value.expression)}o=o;const h=S1(n);return{filter:o,dynamicFilter:a||void 0,needGeometry:h,needFeature:!!l}}function XF(i){if(!Br(i))return i;let e=ud(i);return C1(e),e=M1(e),e}function M1(i){if(!Array.isArray(i))return i;const e=ZF(i);return e===!0?e:e.map(t=>M1(t))}function C1(i){let e=!1;const t=[];if(i[0]==="case"){for(let n=1;n<i.length-1;n+=2)e=e||Br(i[n]),t.push(i[n+1]);t.push(i[i.length-1])}else if(i[0]==="match"){e=e||Br(i[1]);for(let n=2;n<i.length-1;n+=2)t.push(i[n+1]);t.push(i[i.length-1])}else if(i[0]==="step"){e=e||Br(i[1]);for(let n=1;n<i.length-1;n+=2)t.push(i[n+1])}e&&(i.length=0,i.push("any",...t));for(let n=1;n<i.length;n++)C1(i[n])}function Br(i){if(!Array.isArray(i))return!1;if(YF(i[0]))return!0;for(let e=1;e<i.length;e++){const t=i[e];if(Br(t))return!0}return!1}function YF(i){return i==="pitch"||i==="distance-from-center"}const HF=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ZF(i){if(HF.has(i[0]))for(let e=1;e<i.length;e++){const t=i[e];if(Br(t))return!0}return i}function KF(i,e){return i<e?-1:i>e?1:0}function S1(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(S1(i[e]))return!0;return!1}function Lh(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?cu(i[1],i[2],"=="):e==="!="?Tl(cu(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?cu(i[1],i[2],e):e==="any"?JF(i.slice(1)):e==="all"?["all"].concat(i.slice(1).map(Lh)):e==="none"?["all"].concat(i.slice(1).map(Lh).map(Tl)):e==="in"?km(i[1],i.slice(2)):e==="!in"?Tl(km(i[1],i.slice(2))):e==="has"?Om(i[1]):e==="!has"?Tl(Om(i[1])):e==="within"?i:!0}function cu(i,e,t){switch(i){case"$type":return[`filter-type-${t}`,e];case"$id":return[`filter-id-${t}`,e];default:return[`filter-${t}`,i,e]}}function JF(i){return["any"].concat(i.map(Lh))}function km(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",i,["literal",e.sort(KF)]]:["filter-in-small",i,["literal",e]]}}function Om(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Tl(i){return["!",i]}var QF=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ek(i,e){const t={};for(const n in i)n!=="ref"&&(t[n]=i[n]);return QF.forEach(n=>{n in e&&(t[n]=e[n])}),t}function tk(i){i=i.slice();const e=Object.create(null);for(let t=0;t<i.length;t++)e[i[t].id]=i[t];for(let t=0;t<i.length;t++)"ref"in i[t]&&(i[t]=ek(i[t],e[i[t].ref]));return i}var Nm={thin:100,hairline:100,"ultra-light":100,"extra-light":100,light:200,book:300,regular:400,normal:400,plain:400,roman:400,standard:400,medium:500,"semi-bold":600,"demi-bold":600,bold:700,heavy:800,black:800,"extra-bold":800,"ultra-black":900,"extra-black":900,"ultra-bold":900,"heavy-black":900,fat:900,poster:900},ko=" ",Dm=/(italic|oblique)$/i,Gm={},ik=function(i,e,t){var n=Gm[i];if(!n){Array.isArray(i)||(i=[i]);for(var s=400,r="normal",o=[],a,l,h=0,c=i.length;h<c;++h){var u=i[h],d=u.split(" "),f=d[d.length-1].toLowerCase();f=="normal"||f=="italic"||f=="oblique"?(r=l?r:f,d.pop(),f=d[d.length-1].toLowerCase()):Dm.test(f)&&(f=f.replace(Dm,""),r=l?r:d[d.length-1].replace(f,""));for(var g in Nm){var p=d.length>1?d[d.length-2].toLowerCase():"";if(f==g||f==g.replace("-","")||p+"-"+f==g){s=a?s:Nm[g],d.pop(),p&&g.startsWith(p)&&d.pop();break}}!a&&typeof f=="number"&&(s=f);var m=d.join(ko).replace("Klokantech Noto Sans","Noto Sans");m.indexOf(ko)!==-1&&(m='"'+m+'"'),o.push(m)}n=Gm[i]=[r,s,o]}return n[0]+ko+n[1]+ko+e+"px"+(t?"/"+t:"")+ko+n[2]},dd=K_(ik);const T1="https://api.mapbox.com";function _g(i){const e="mapbox://";return i.indexOf(e)!==0?"":i.slice(e.length)}function nk(i,e,t){const n=_g(i);if(!n)return decodeURI(new URL(i,t).href);const s="sprites/";if(n.indexOf(s)!==0)throw new Error(`unexpected sprites url: ${i}`);const r=n.slice(s.length);return`${T1}/styles/v1/${r}/sprite?access_token=${e}`}function R1(i,e){const t=_g(i);if(!t)return decodeURI(new URL(i,location.href).href);const n="styles/";if(t.indexOf(n)!==0)throw new Error(`unexpected style url: ${i}`);const s=t.slice(n.length);return`${T1}/styles/v1/${s}?&access_token=${e}`}function zl(i,e,t,n){const s=new URL(i,n),r=_g(i);if(!r)return e&&(s.searchParams.has(t)||s.searchParams.set(t,e)),decodeURI(s.href);if(r==="mapbox.satellite"){const o=window.devicePixelRatio>=1.5?"@2x":"";return`https://api.mapbox.com/v4/${r}/{z}/{x}/{y}${o}.webp?access_token=${e}`}return`https://{a-d}.tiles.mapbox.com/v4/${r}/{z}/{x}/{y}.vector.pbf?access_token=${e}`}const zm={},Bm={};let sk=0;function vg(i){return i.id||(i.id=sk++),i.id}function rk(i,e){return vg(i)+"."+H(e)}function ok(i){let e=zm[i.id];return e||(e={},zm[vg(i)]=e),e}function ak(i){let e=Bm[i.id];return e||(e={},Bm[vg(i)]=e),e}function uu(i){return i*Math.PI/180}const xg=function(){const i=[];for(let e=78271.51696402048;i.length<=24;e/=2)i.push(e);return i}();function I1(i,e){if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof OffscreenCanvas<"u")return new OffscreenCanvas(i,e);const t=document.createElement("canvas");return t.width=i,t.height=e,t}function lk(i,e){let t=0;const n=e.length;for(;t<n;++t)if(e[t]<i&&t+1<n){const r=e[t]/e[t+1];return t+Math.log(e[t]/i)/Math.log(r)}return n-1}const hr={};function fo(i,e,t={},n){if(e in hr)return n&&(n.request=hr[e][0]),hr[e][1];const s=t.transformRequest&&t.transformRequest(e,i)||e,r=Qo(()=>s).then(o=>(o instanceof Request||(o=new Request(o)),o.headers.get("Accept")||o.headers.set("Accept","application/json"),n&&(n.request=o),fetch(o).then(function(a){return delete hr[e],a.ok?a.json():Promise.reject(new Error("Error fetching source "+e))}).catch(function(a){return delete hr[e],Promise.reject(new Error("Error fetching source "+e))})));return hr[e]=[s,r],r}function hk(i,e){if(typeof i=="string")if(i.trim().startsWith("{"))try{const t=JSON.parse(i);return Promise.resolve(t)}catch(t){return Promise.reject(t)}else return i=R1(i,e.accessToken),fo("Style",i,e);else return Promise.resolve(i)}const $m={};function ck(i,e,t={}){const n=[e,JSON.stringify(i)].toString();let s=$m[n];if(!s||t.transformRequest){let r;t.transformRequest&&(r=(a,l)=>{const h=t.transformRequest&&t.transformRequest(l,"Tiles")||l;if(a instanceof H_)a.setLoader((c,u,d)=>{Qo(()=>h).then(f=>{fetch(f).then(g=>g.arrayBuffer()).then(g=>{const m=a.getFormat().readFeatures(g,{extent:c,featureProjection:d});a.setFeatures(m)}).catch(g=>a.setState($.ERROR))})});else{const c=a.getImage();Qo(()=>h).then(u=>{u instanceof Request?fetch(u).then(d=>d.blob()).then(d=>{const f=URL.createObjectURL(d);c.addEventListener("load",()=>URL.revokeObjectURL(f)),c.addEventListener("error",()=>URL.revokeObjectURL(f)),c.src=f}).catch(d=>a.setState($.ERROR)):c.src=u})}});const o=i.url;if(o&&!i.tiles){const a=zl(o,t.accessToken,t.accessTokenParam||"access_token",e||location.href);if(o.startsWith("mapbox://"))s=Promise.resolve({tileJson:Object.assign({},i,{url:void 0,tiles:jf(a)}),tileLoadFunction:r});else{const l={};s=fo("Source",a,t,l).then(function(h){return h.tiles=h.tiles.map(function(c){return h.scheme==="tms"&&(c=c.replace("{y}","{-y}")),zl(c,t.accessToken,t.accessTokenParam||"access_token",l.request.url)}),Promise.resolve({tileJson:h,tileLoadFunction:r})})}}else i=Object.assign({},i,{tiles:i.tiles.map(function(a){return i.scheme==="tms"&&(a=a.replace("{y}","{-y}")),zl(a,t.accessToken,t.accessTokenParam||"access_token",e||location.href)})}),s=Promise.resolve({tileJson:Object.assign({},i),tileLoadFunction:r});$m[n]=s}return s}function Um(i,e,t,n){const s=document.createElement("canvas"),r=[2*t*e.pixelRatio+e.width,2*t*e.pixelRatio+e.height];s.width=r[0],s.height=r[1];const o=s.getContext("2d");o.drawImage(i,e.x,e.y,e.width,e.height,t*e.pixelRatio,t*e.pixelRatio,e.width,e.height);const a=o.getImageData(0,0,r[0],r[1]);o.globalCompositeOperation="destination-over",o.fillStyle=`rgba(${n.r*255},${n.g*255},${n.b*255},${n.a})`;const l=a.data;for(let h=0,c=a.width;h<c;++h)for(let u=0,d=a.height;u<d;++u){const f=(u*c+h)*4;l[f+3]>0&&o.arc(h,u,t*e.pixelRatio,0,2*Math.PI)}return o.fill(),s}function uk(i,e,t){const n=Math.max(0,Math.min(1,(t-i)/(e-i)));return n*n*(3-2*n)}function qm(i,e,t){const n=document.createElement("canvas");n.width=e.width,n.height=e.height;const s=n.getContext("2d");s.drawImage(i,e.x,e.y,e.width,e.height,0,0,e.width,e.height);const r=s.getImageData(0,0,e.width,e.height),o=r.data;for(let a=0,l=r.width;a<l;++a)for(let h=0,c=r.height;h<c;++h){const u=(h*l+a)*4,d=o[u+3]/255,f=.75,g=.1,p=uk(f-g,f+g,d);p>0?(o[u+0]=Math.round(255*t.r*p),o[u+1]=Math.round(255*t.g*p),o[u+2]=Math.round(255*t.b*p),o[u+3]=Math.round(255*p)):o[u+3]=0}return s.putImageData(r,0,0),n}const dk=Array(256).join("");function fd(i,e){if(e>=.05){let t="";const n=i.split(`
`),s=dk.slice(0,Math.round(e/.1));for(let r=0,o=n.length;r<o;++r)r>0&&(t+=`
`),t+=n[r].split("").join(s);return t}return i}let du;function L1(){return du||(du=I1(1,1).getContext("2d")),du}function Cs(i,e){return L1().measureText(i).width+(i.length-1)*e}const jm={};function gd(i,e,t,n){if(i.indexOf(`
`)!==-1){const o=i.split(`
`),a=[];for(let l=0,h=o.length;l<h;++l)a.push(gd(o[l],e,t,n));return a.join(`
`)}const s=t+","+e+","+i+","+n;let r=jm[s];if(!r){const o=i.split(" ");if(o.length>1){const a=L1();a.font=e;const h=a.measureText("M").width*t;let c="";const u=[];for(let d=0,f=o.length;d<f;++d){const g=o[d],p=c+(c?" ":"")+g;Cs(p,n)<=h?c=p:(c&&u.push(c),c=g)}c&&u.push(c);for(let d=0,f=u.length;d<f&&f>1;++d){const g=u[d];if(Cs(g,n)<h*.35){const p=d>0?Cs(u[d-1],n):1/0,m=d<f-1?Cs(u[d+1],n):1/0;u.splice(d,1),f-=1,p<m?(u[d-1]+=" "+g,d-=1):u[d]=g+" "+u[d]}}for(let d=0,f=u.length-1;d<f;++d){const g=u[d],p=u[d+1];if(Cs(g,n)>h*.7&&Cs(p,n)<h*.6){const m=g.split(" "),_=m.pop();Cs(_,n)<h*.2&&(u[d]=m.join(" "),u[d+1]=_+" "+p),f-=1}}r=u.join(`
`)}else r=i;r=fd(r,n),jm[s]=r}return r}const fk=/font-family: ?([^;]*);/,gk=/("|')/g;let Rl;function pk(i){if(!Rl){Rl={};const e=document.styleSheets;for(let t=0,n=e.length;t<n;++t){const s=e[t];try{const r=s.rules||s.cssRules;if(r)for(let o=0,a=r.length;o<a;++o){const l=r[o];if(l.type==5){const h=l.cssText.match(fk);Rl[h[1].replace(gk,"")]=!0}}}catch{}}}return i in Rl}const fu={};function mk(i,e="https://cdn.jsdelivr.net/npm/@fontsource/{font-family}/{fontweight}{-fontstyle}.css"){const t=i.toString();if(t in fu)return fu[t];const n=[];for(let s=0,r=i.length;s<r;++s){i[s]=i[s].replace("Arial Unicode MS","Arial");const o=i[s],a=dd(o,1);Py(a);const l=a.split(" ");n.push([l.slice(3).join(" ").replace(/"/g,""),l[1],l[0]])}for(let s=0,r=n.length;s<r;++s){const o=n[s],a=o[0];if(!pk(a)&&tn.get(`${o[2]}
${o[1]} 
${a}`)!==100){const l=e.replace("{font-family}",a.replace(/ /g,"-").toLowerCase()).replace("{Font+Family}",a.replace(/ /g,"+")).replace("{fontweight}",o[1]).replace("{-fontstyle}",o[2].replace("normal","").replace(/(.+)/,"-$1")).replace("{fontstyle}",o[2]);if(!document.querySelector('link[href="'+l+'"]')){const h=document.createElement("link");h.href=l,h.rel="stylesheet",document.head.appendChild(h)}}}return fu[t]=i,i}const yk={Point:1,MultiPoint:1,LineString:2,MultiLineString:2,Polygon:3,MultiPolygon:3},_k={center:[.5,.5],left:[0,.5],right:[1,.5],top:[.5,0],bottom:[.5,1],"top-left":[0,0],"top-right":[1,0],"bottom-left":[0,1],"bottom-right":[1,1]},vk=function(i,e){const t=UF(i,e);if(t.result==="error")throw new Error(t.value.map(n=>`${n.key}: ${n.message}`).join(", "));return t.value},pd={},Ph={zoom:0};let Il,gu;function Q(i,e,t,n,s,r,o){const a=i.id;r||(r={},console.warn("No functionCache provided to getValue()")),r[a]||(r[a]={});const l=r[a];if(!l[t]){let h=(i[e]||pd)[t];const c=b1[`${e}_${i.type}`][t];h===void 0&&(h=c.default);let u=$F(h);if(!u&&w1(h)&&(h=CA(h,c),u=!0),u){const d=vk(h,c);l[t]=d.evaluate.bind(d)}else c.type=="color"&&(h=vi.parse(h)),l[t]=function(){return h}}return Ph.zoom=n,l[t](Ph,s,o)}function xk(i,e,t,n){return Q(i,"layout","icon-allow-overlap",e,t,n)?Q(i,"layout","icon-ignore-placement",e,t,n)?"none":"obstacle":"declutter"}function wk(i,e,t,n,s){return s||console.warn("No filterCache provided to evaluateFilter()"),i in s||(s[i]=VF(e).filter),Ph.zoom=n,s[i](Ph,t)}function Ss(i,e){if(i){if(i.a===0||e===0)return;const t=i.a;return e=e===void 0?1:e,t===0?"transparent":"rgba("+Math.round(i.r*255/t)+","+Math.round(i.g*255/t)+","+Math.round(i.b*255/t)+","+t*e+")"}return i}const bk=/\{[^{}}]*\}/g;function pu(i,e){return i.replace(bk,function(t){return e[t.slice(1,-1)]||""})}const Ek={};function Mk(i,e,t,n=xg,s=void 0,r=void 0,o=void 0,a=void 0){if(typeof e=="string"&&(e=JSON.parse(e)),e.version!=8)throw new Error("glStyle version 8 required.");Ek[rk(e,i)]=Array.from(arguments);let l,h,c;if(r){if(typeof Image<"u"){const M=new Image;let C;Qo(()=>r).then(R=>{R instanceof Request?fetch(R).then(N=>N.blob()).then(N=>{C=URL.createObjectURL(N),M.src=C}).catch(()=>{}):(M.crossOrigin="anonymous",M.src=R,C&&URL.revokeObjectURL(C))}),M.onload=function(){l=M,h=[M.width,M.height],i.changed(),M.onload=null}}else if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope){const M=self;M.postMessage({action:"loadImage",src:r}),M.addEventListener("message",function(R){R.data.action==="imageLoaded"&&R.data.src===r&&(l=R.data.image,h=[l.width,l.height])})}}const u=tk(e.layers),d={},f=[],g={},p={},m=ok(e),_=ak(e);let y;for(let M=0,C=u.length;M<C;++M){const R=u[M],N=R.id;if(typeof t=="string"&&R.source==t||t.indexOf(N)!==-1){const D=R["source-layer"];if(y){if(R.source!==y)throw new Error(`Layer "${N}" does not use source "${y}`)}else{y=R.source;const B=e.sources[y];if(!B)throw new Error(`Source "${y}" is not defined`);const k=B.type;if(k!=="vector"&&k!=="geojson")throw new Error(`Source "${y}" is not of type "vector" or "geojson", but "${k}"`)}let S=d[D];S||(S=[],d[D]=S),S.push({layer:R,index:M}),f.push(N)}}const x=new Tt,w=new jt,b=[],E=function(M,C,R){const N=M.getProperties(),D=d[N.layer];if(!D)return;let S=n.indexOf(C);S==-1&&(S=lk(C,n));const B=yk[M.getGeometry().getType()],k={id:M.getId(),properties:N,type:B},I=i.get("mapbox-featurestate")[M.getId()];let F=-1;for(let z=0,ne=D.length;z<ne;++z){const Le=D[z],P=Le.layer,gt=P.id;if(R!==void 0&&R!==gt)continue;const A=P.layout||pd,We=P.paint||pd;if(A.visibility==="none"||"minzoom"in P&&S<P.minzoom||"maxzoom"in P&&S>=P.maxzoom)continue;const we=P.filter;if(!we||wk(gt,we,k,S,_)){let ve,vt,lt,ht,pt,q;const ki=Le.index;if(B==3&&(P.type=="fill"||P.type=="fill-extrusion"))if(vt=Q(P,"paint",P.type+"-opacity",S,k,m,I),P.type+"-pattern"in We){const Ce=Q(P,"paint",P.type+"-pattern",S,k,m,I);if(Ce){const Pe=typeof Ce=="string"?pu(Ce,N):Ce.toString();if(l&&s&&s[Pe]){++F,q=b[F],(!q||!q.getFill()||q.getStroke()||q.getText())&&(q=new ii({fill:new jt}),b[F]=q),lt=q.getFill(),q.setZIndex(ki);const Ae=Pe+"."+vt;let ke=p[Ae];if(!ke){const me=s[Pe],Me=I1(me.width,me.height),ut=Me.getContext("2d");ut.globalAlpha=vt,ut.drawImage(l,me.x,me.y,me.width,me.height,0,0,me.width,me.height),ke=ut.createPattern(Me,"repeat"),p[Ae]=ke}lt.setColor(ke)}}}else ve=Ss(Q(P,"paint",P.type+"-color",S,k,m,I),vt),P.type+"-outline-color"in We&&(pt=Ss(Q(P,"paint",P.type+"-outline-color",S,k,m,I),vt)),pt||(pt=ve),(ve||pt)&&(++F,q=b[F],(!q||ve&&!q.getFill()||!ve&&q.getFill()||pt&&!q.getStroke()||!pt&&q.getStroke()||q.getText())&&(q=new ii({fill:ve?new jt:void 0,stroke:pt?new Tt:void 0}),b[F]=q),ve&&(lt=q.getFill(),lt.setColor(ve)),pt&&(ht=q.getStroke(),ht.setColor(pt),ht.setWidth(.5)),q.setZIndex(ki));if(B!=1&&P.type=="line"){ve=!("line-pattern"in We)&&"line-color"in We?Ss(Q(P,"paint","line-color",S,k,m,I),Q(P,"paint","line-opacity",S,k,m,I)):void 0;const Ce=Q(P,"paint","line-width",S,k,m,I);ve&&Ce>0&&(++F,q=b[F],(!q||!q.getStroke()||q.getFill()||q.getText())&&(q=new ii({stroke:new Tt}),b[F]=q),ht=q.getStroke(),ht.setLineCap(Q(P,"layout","line-cap",S,k,m,I)),ht.setLineJoin(Q(P,"layout","line-join",S,k,m,I)),ht.setMiterLimit(Q(P,"layout","line-miter-limit",S,k,m,I)),ht.setColor(ve),ht.setWidth(Ce),ht.setLineDash(We["line-dasharray"]?Q(P,"paint","line-dasharray",S,k,m,I).map(function(Pe){return Pe*Ce}):null),q.setZIndex(ki))}let Oi=!1,$e=null,Ni=0,Di,Xe,Gn;if((B==1||B==2)&&"icon-image"in A){const Ce=Q(P,"layout","icon-image",S,k,m,I);if(Ce){Di=typeof Ce=="string"?pu(Ce,N):Ce.toString();let Pe;const Ae=a?a(i,Di):void 0;if(l&&s&&s[Di]||Ae){const ke=Q(P,"layout","icon-rotation-alignment",S,k,m,I);if(B==2){const me=M.getGeometry();if(me.getFlatMidpoint||me.getFlatMidpoints){const Me=me.getExtent();if(Math.sqrt(Math.max(Math.pow((Me[2]-Me[0])/C,2),Math.pow((Me[3]-Me[1])/C,2)))>150){const be=me.getType()==="MultiLineString"?me.getFlatMidpoints():me.getFlatMidpoint();if(gu||(Il=[NaN,NaN],gu=new Li("Point",Il,[],{},null)),Pe=gu,Il[0]=be[0],Il[1]=be[1],Q(P,"layout","symbol-placement",S,k,m,I)==="line"&&ke==="map"){const Bt=me.getStride(),At=me.getFlatCoordinates();for(let Ft=0,Ve=At.length-Bt;Ft<Ve;Ft+=Bt){const mt=At[Ft],$t=At[Ft+1],Ze=At[Ft+Bt],ai=At[Ft+Bt+1],vs=Math.min(mt,Ze),xs=Math.min($t,ai),Ha=Math.max(mt,Ze),Za=Math.max($t,ai);if(be[0]>=vs&&be[0]<=Ha&&be[1]>=xs&&be[1]<=Za){Ni=Math.atan2($t-ai,Ze-mt);break}}}}}}if(B!==2||Pe){const me=Q(P,"layout","icon-size",S,k,m,I),Me=We["icon-color"]!==void 0?Q(P,"paint","icon-color",S,k,m,I):null;if(!Me||Me.a!==0){const ut=Q(P,"paint","icon-halo-color",S,k,m,I),be=Q(P,"paint","icon-halo-width",S,k,m,I);let Mt=`${Di}.${me}.${be}.${ut}`;if(Me!==null&&(Mt+=`.${Me}`),Xe=g[Mt],!Xe){const Bt=xk(P,S,k,m);let At;"icon-offset"in A&&(At=Q(P,"layout","icon-offset",S,k,m,I).slice(0),At[1]*=-1);let Ft=Me?[Me.r*255,Me.g*255,Me.b*255,Me.a]:void 0;if(Ae){const Ve={color:Ft,rotateWithView:ke==="map",displacement:At,declutterMode:Bt};typeof Ae=="string"?Ve.src=Ae:(Ve.img=Ae,Ve.imgSize=[Ae.width,Ae.height]),Xe=new oh(Ve)}else{const Ve=s[Di];let mt,$t,Ze;be?Ve.sdf?(mt=Um(qm(l,Ve,Me),{x:0,y:0,width:Ve.width,height:Ve.height,pixelRatio:Ve.pixelRatio},be,ut),Ft=void 0):mt=Um(l,Ve,be,ut):(Ve.sdf?(c||(c=qm(l,{x:0,y:0,width:h[0],height:h[1]},{r:1,g:1,b:1,a:1})),mt=c):mt=l,$t=[Ve.width,Ve.height],Ze=[Ve.x,Ve.y]),Xe=new oh({color:Ft,img:mt,imgSize:h,size:$t,offset:Ze,rotateWithView:ke==="map",scale:me/Ve.pixelRatio,displacement:At,declutterMode:Bt})}g[Mt]=Xe}}Xe&&(++F,q=b[F],(!q||!q.getImage()||q.getFill()||q.getStroke())&&(q=new ii,b[F]=q),q.setGeometry(Pe),Xe.setRotation(Ni+uu(Q(P,"layout","icon-rotate",S,k,m,I))),Xe.setOpacity(Q(P,"paint","icon-opacity",S,k,m,I)),Xe.setAnchor(_k[Q(P,"layout","icon-anchor",S,k,m,I)]),q.setImage(Xe),$e=q.getText(),q.setText(void 0),q.setZIndex(ki),Oi=!0,Gn=!1)}else Gn=!0}}}if(B==1&&P.type==="circle"){++F,q=b[F],(!q||!q.getImage()||q.getFill()||q.getStroke())&&(q=new ii,b[F]=q);const Ce="circle-radius"in We?Q(P,"paint","circle-radius",S,k,m,I):5,Pe=Ss(Q(P,"paint","circle-stroke-color",S,k,m,I),Q(P,"paint","circle-stroke-opacity",S,k,m,I)),Ae=Ss(Q(P,"paint","circle-color",S,k,m,I),Q(P,"paint","circle-opacity",S,k,m,I)),ke=Q(P,"paint","circle-stroke-width",S,k,m,I),me=Ce+"."+Pe+"."+Ae+"."+ke;Xe=g[me],Xe||(Xe=new Kn({radius:Ce,stroke:Pe&&ke>0?new Tt({width:ke,color:Pe}):void 0,fill:Ae?new jt({color:Ae}):void 0,declutterMode:"none"}),g[me]=Xe),q.setImage(Xe),$e=q.getText(),q.setText(void 0),q.setGeometry(void 0),q.setZIndex(ki),Oi=!0}let tt,Ji,wi,bi,ct,Pt;if("text-field"in A){bi=Math.round(Q(P,"layout","text-size",S,k,m,I));const Ce=Q(P,"layout","text-font",S,k,m,I);wi=Q(P,"layout","text-line-height",S,k,m,I),Ji=dd(o?o(Ce,e.metadata?e.metadata["ol:webfonts"]:void 0):Ce,bi,wi),Ji.includes("sans-serif")||(Ji+=",sans-serif"),ct=Q(P,"layout","text-letter-spacing",S,k,m,I),Pt=Q(P,"layout","text-max-width",S,k,m,I);const Pe=Q(P,"layout","text-field",S,k,m,I);typeof Pe=="object"&&Pe.sections?Pe.sections.length===1?tt=Pe.toString():tt=Pe.sections.reduce((Ae,ke,me)=>{const Me=ke.fontStack?ke.fontStack.split(","):Ce,ut=dd(o?o(Me):Me,bi*(ke.scale||1),wi);let be=ke.text;if(be===`
`)return Ae.push(`
`,""),Ae;if(B==2){Ae.push(fd(be,ct),ut);return}be=gd(be,ut,Pt,ct).split(`
`);for(let Mt=0,Bt=be.length;Mt<Bt;++Mt)Mt>0&&Ae.push(`
`,""),Ae.push(be[Mt],ut);return Ae},[]):tt=pu(Pe,N).trim(),vt=Q(P,"paint","text-opacity",S,k,m,I)}if(tt&&vt&&!Gn){Oi||(++F,q=b[F],(!q||!q.getText()||q.getFill()||q.getStroke())&&(q=new ii,b[F]=q),q.setImage(void 0),q.setGeometry(void 0)),q.getText()||q.setText($e||new yf({padding:[2,2,2,2]})),$e=q.getText();const Ce=A["text-transform"];Ce=="uppercase"?tt=Array.isArray(tt)?tt.map((Ze,ai)=>ai%2?Ze:Ze.toUpperCase()):tt.toUpperCase():Ce=="lowercase"&&(tt=Array.isArray(tt)?tt.map((Ze,ai)=>ai%2?Ze:Ze.toLowerCase()):tt.toLowerCase());const Pe=Array.isArray(tt)?tt:B==2?fd(tt,ct):gd(tt,Ji,Pt,ct);$e.setText(Pe),$e.setFont(Ji),$e.setRotation(uu(Q(P,"layout","text-rotate",S,k,m,I)));const Ae=Q(P,"layout","text-anchor",S,k,m,I),ke=Oi||B==1?"point":Q(P,"layout","symbol-placement",S,k,m,I);let me;if(ke==="line-center"?($e.setPlacement("line"),me="center"):$e.setPlacement(ke),ke==="line"&&typeof $e.setRepeat=="function"){const Ze=Q(P,"layout","symbol-spacing",S,k,m,I);$e.setRepeat(Ze*2)}$e.setOverflow(ke==="point");let Me=Q(P,"paint","text-halo-width",S,k,m,I);const ut=Q(P,"layout","text-offset",S,k,m,I),be=Q(P,"paint","text-translate",S,k,m,I);let Mt=0,Bt=0;if(ke=="point"){me="center",Ae.indexOf("left")!==-1?(me="left",Bt=Me):Ae.indexOf("right")!==-1&&(me="right",Bt=-Me);const Ze=Q(P,"layout","text-rotation-alignment",S,k,m,I);$e.setRotateWithView(Ze=="map")}else $e.setMaxAngle(uu(Q(P,"layout","text-max-angle",S,k,m,I))*tt.length/Pe.length),$e.setRotateWithView(!1);$e.setTextAlign(me);let At="middle";Ae.indexOf("bottom")==0?(At="bottom",Mt=-Me-.5*(wi-1)*bi):Ae.indexOf("top")==0&&(At="top",Mt=Me+.5*(wi-1)*bi),$e.setTextBaseline(At);const Ft=Q(P,"layout","text-justify",S,k,m,I);$e.setJustify(Ft==="auto"?void 0:Ft),$e.setOffsetX(ut[0]*bi+Bt+be[0]),$e.setOffsetY(ut[1]*bi+Mt+be[1]),w.setColor(Ss(Q(P,"paint","text-color",S,k,m,I),vt)),$e.setFill(w);const Ve=Ss(Q(P,"paint","text-halo-color",S,k,m,I),vt);if(Ve){x.setColor(Ve),Me*=2;const Ze=.5*bi;x.setWidth(Me<=Ze?Me:Ze),$e.setStroke(x)}else $e.setStroke(void 0);const mt=Q(P,"layout","text-padding",S,k,m,I),$t=$e.getPadding();mt!==$t[0]&&($t[0]=mt,$t[1]=mt,$t[2]=mt,$t[3]=mt),q.setZIndex(ki)}}}if(F>-1)return b.length=F+1,b};return i.setStyle(E),i.set("mapbox-source",y),i.set("mapbox-layers",f),i.set("mapbox-featurestate",i.get("mapbox-featurestate")||{}),E}function Ck(i,e=512){return i.getExtent()?pc({extent:i.getExtent(),tileSize:e,maxZoom:22}).getResolutions():xg}function Sk(i,e){return e.accessToken||(e=Object.assign({},e),new URL(i).searchParams.forEach((n,s)=>{e.accessToken=n,e.accessTokenParam=s})),e}function Tk(i,e,t="",n={},s=void 0){let r,o,a,l,h=!0;return typeof t!="string"&&!Array.isArray(t)?(a=t,l=a.source||a.layers,n=a):l=t,typeof n=="string"?(r=n,a={}):(r=n.styleUrl,a=n),a.updateSource===!1&&(h=!1),s||(s=a.resolutions),!r&&typeof e=="string"&&!e.trim().startsWith("{")&&(r=e),r&&(r=r.startsWith("data:")?location.href:R1(r,a.accessToken),a=Sk(r,a)),new Promise(function(c,u){hk(e,a).then(function(d){if(d.version!=8)return u(new Error("glStyle version 8 required."));if(!(i instanceof kr||i instanceof Nl))return u(new Error("Can only apply to VectorLayer or VectorTileLayer"));const f=i instanceof Nl?"vector":"geojson";if(l?Array.isArray(l)?o=d.layers.find(function(w){return w.id===l[0]}).source:o=l:(o=Object.keys(d.sources).find(function(w){return d.sources[w].type===f}),l=o),!o)return u(new Error(`No ${f} source found in the glStyle.`));function g(){if(!h)return Promise.resolve();if(i instanceof Nl)return Lk(d.sources[o],r,a).then(function(M){const C=i.getSource();if(C?M!==C&&(C.setTileUrlFunction(M.getTileUrlFunction()),typeof C.setUrls=="function"&&typeof M.getUrls=="function"&&C.setUrls(M.getUrls()),C.format_||(C.format_=M.format_),C.getAttributions()||C.setAttributions(M.getAttributions()),C.getTileLoadFunction()===Z_&&C.setTileLoadFunction(M.getTileLoadFunction()),ui(C.getProjection(),M.getProjection())&&(C.tileGrid=M.getTileGrid())):i.setSource(M),!isFinite(i.getMaxResolution())&&!isFinite(i.getMinZoom())){const R=i.getSource().getTileGrid();i.setMaxResolution(R.getResolution(R.getMinZoom()))}});const w=d.sources[o];let b=i.getSource();(!b||b.get("mapbox-source")!==w)&&(b=Ak(w,r,a));const E=i.getSource();return E?b!==E&&(E.getAttributions()||E.setAttributions(b.getAttributions()),E.format_||(E.format_=b.getFormat()),E.url_=b.getUrl()):i.setSource(b),Promise.resolve()}let p,m,_,y;function x(){if(!y&&(!d.sprite||m)){if(a.projection&&!s){const b=K(a.projection).getUnits();b!=="m"&&(s=xg.map(E=>E/Bs[b]))}y=Mk(i,d,l,s,m,_,mk,a.getImage),i.getStyle()?g().then(c).catch(u):u(new Error(`Nothing to show for source [${o}]`))}else y?(i.setStyle(y),g().then(c).catch(u)):u(new Error("Something went wrong trying to apply style."))}if(d.sprite){const w=new URL(nk(d.sprite,a.accessToken,r||location.href));p=window.devicePixelRatio>=1.5?.5:1;const b=p==.5?"@2x":"";let E=w.origin+w.pathname+b+".json"+w.search;new Promise(function(M,C){fo("Sprite",E,a).then(M).catch(function(R){E=w.origin+w.pathname+".json"+w.search,fo("Sprite",E,a).then(M).catch(C)})}).then(function(M){if(M===void 0&&u(new Error("No sprites found.")),m=M,_=w.origin+w.pathname+b+".png"+w.search,a.transformRequest){const C=a.transformRequest(_,"SpriteImage")||_;(C instanceof Request||C instanceof Promise)&&(_=C)}x()}).catch(function(M){u(new Error(`Sprites cannot be loaded: ${E}: ${M.message}`))})}else x()}).catch(u)})}function Rk(i,e){const t=i.bounds;if(t){const n=Hg([t[0],t[1]],e),s=Hg([t[2],t[3]],e);return[n[0],n[1],s[0],s[1]]}return K(e).getExtent()}function Ik(i,e,t){const n=new xA({tileJSON:e,tileSize:i.tileSize||e.tileSize||512}),s=n.getTileJSON(),r=n.getTileGrid(),o=K(t.projection||"EPSG:3857"),a=Rk(s,o),l=o.getExtent(),h=s.minzoom||0,c=s.maxzoom||22,u={attributions:n.getAttributions(),projection:o,tileGrid:new Va({origin:l?yn(l):r.getOrigin(0),extent:a||r.getExtent(),minZoom:h,resolutions:Ck(o,e.tileSize).slice(0,c+1),tileSize:r.getTileSize(0)})};return Array.isArray(s.tiles)?u.urls=s.tiles:u.url=s.tiles,u}function Lk(i,e,t){return new Promise(function(n,s){ck(i,e,t).then(function({tileJson:r,tileLoadFunction:o}){const a=Ik(i,r,t);a.tileLoadFunction=o,a.format=new TS,n(new bA(a))}).catch(s)})}function Pk(i){return`{bbox-${(i?i.getCode():"EPSG:3857").toLowerCase().replace(/[^a-z0-9]/g,"-")}}`}function Ak(i,e,t){const n=t.projection?new cp({dataProjection:t.projection}):new cp,s=i.data,r={};if(typeof s=="string"){const a=zl(s,t.accessToken,t.accessTokenParam||"access_token",e||location.href);if(/\{bbox-[0-9a-z-]+\}/.test(a)){const h=(u,d,f)=>{const g=Pk(f);return a.replace(g,`${u.join(",")}`)},c=new rs({attributions:i.attribution,format:n,loader:(u,d,f,g,p)=>{const m=typeof h=="function"?h(u,d,f):h;fo("GeoJSON",m,t).then(_=>{const y=c.getFormat().readFeatures(_,{featureProjection:f});c.addFeatures(y),g(y)}).catch(_=>{c.removeLoadedExtent(u),p()})},strategy:bI});return c.set("mapbox-source",i),c}const l=new rs({attributions:i.attribution,format:n,url:a,loader:(h,c,u,d,f)=>{fo("GeoJSON",a,t).then(g=>{const p=l.getFormat().readFeatures(g,{featureProjection:u});l.addFeatures(p),d(p)}).catch(g=>{l.removeLoadedExtent(h),f()})}});return l}r.features=n.readFeatures(s,{featureProjection:"EPSG:3857"});const o=new rs(Object.assign({attributions:i.attribution,format:n},r));return o.set("mapbox-source",i),o}class Fk{constructor(e,t){v(this,"map");v(this,"srid");v(this,"basemapLayers",[]);this.map=e,this.srid=t}removeAllBasemapLayers(){this.basemapLayers.forEach(e=>{this.map.removeLayer(e)}),this.basemapLayers=[]}addBasemapLayer(e){const t=new Nl({declutter:!0});Tk(t,e.style,e.source),this.basemapLayers.push(t),this.map.getLayers().insertAt(0,t)}}class kk extends Vf{constructor(e){const t=e.requestEncoding!==void 0?e.requestEncoding:"KVP",n=e.tileGrid;let s=e.urls;s===void 0&&e.url!==void 0&&(s=jf(e.url)),super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:n,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:s,wrapX:e.wrapX!==void 0?e.wrapX:!1,transition:e.transition,zDirection:e.zDirection}),this.version_=e.version!==void 0?e.version:"1.0.0",this.format_=e.format!==void 0?e.format:"image/jpeg",this.dimensions_=e.dimensions!==void 0?e.dimensions:{},this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style,this.requestEncoding_=t,this.setKey(this.getKeyForDimensions_()),s&&s.length>0&&(this.tileUrlFunction=sd(s.map(this.createFromWMTSTemplate.bind(this))))}setUrls(e){this.urls=e;const t=e.join(`
`);this.setTileUrlFunction(sd(e.map(this.createFromWMTSTemplate.bind(this))),t)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const e=this.urls?this.urls.slice(0):[];for(const t in this.dimensions_)e.push(t+"-"+this.dimensions_[t]);return e.join("/")}updateDimensions(e){Object.assign(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(e){const t=this.requestEncoding_,n={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};t=="KVP"&&Object.assign(n,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e=t=="KVP"?bh(e,n):e.replace(/\{(\w+?)\}/g,function(o,a){return a.toLowerCase()in n?n[a.toLowerCase()]:o});const s=this.tileGrid,r=this.dimensions_;return function(o,a,l){if(!o)return;const h={TileMatrix:s.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(h,r);let c=e;return t=="KVP"?c=bh(c,h):c=c.replace(/\{(\w+?)\}/g,function(u,d){return h[d]}),c}}}const Ok=kk;function Nk(i,e){const n=i.Contents.Layer.find(function(S){return S.Identifier==e.layer});if(!n)return null;const s=i.Contents.TileMatrixSet;let r;n.TileMatrixSetLink.length>1?"projection"in e?r=n.TileMatrixSetLink.findIndex(function(S){const k=s.find(function(z){return z.Identifier==S.TileMatrixSet}).SupportedCRS,I=K(k),F=K(e.projection);return I&&F?ui(I,F):k==e.projection}):r=n.TileMatrixSetLink.findIndex(function(S){return S.TileMatrixSet==e.matrixSet}):r=0,r<0&&(r=0);const o=n.TileMatrixSetLink[r].TileMatrixSet,a=n.TileMatrixSetLink[r].TileMatrixSetLimits;let l=n.Format[0];"format"in e&&(l=e.format),r=n.Style.findIndex(function(S){return"style"in e?S.Title==e.style:S.isDefault}),r<0&&(r=0);const h=n.Style[r].Identifier,c={};"Dimension"in n&&n.Dimension.forEach(function(S,B,k){const I=S.Identifier;let F=S.Default;F===void 0&&(F=S.Value[0]),c[I]=F});const d=i.Contents.TileMatrixSet.find(function(S){return S.Identifier==o});let f;const g=d.SupportedCRS;if(g&&(f=K(g)),"projection"in e){const S=K(e.projection);S&&(!f||ui(S,f))&&(f=S)}let p=!1;const m=f.getAxisOrientation().substr(0,2)=="ne";let _=d.TileMatrix[0],y={MinTileCol:0,MinTileRow:0,MaxTileCol:_.MatrixWidth-1,MaxTileRow:_.MatrixHeight-1};if(a){y=a[a.length-1];const S=d.TileMatrix.find(B=>B.Identifier===y.TileMatrix||d.Identifier+":"+B.Identifier===y.TileMatrix);S&&(_=S)}const x=_.ScaleDenominator*28e-5/f.getMetersPerUnit(),w=m?[_.TopLeftCorner[1],_.TopLeftCorner[0]]:_.TopLeftCorner,b=_.TileWidth*x,E=_.TileHeight*x;let M=d.BoundingBox;M&&m&&(M=[M[1],M[0],M[3],M[2]]);let C=[w[0]+b*y.MinTileCol,w[1]-E*(1+y.MaxTileRow),w[0]+b*(1+y.MaxTileCol),w[1]-E*y.MinTileRow];if(M!==void 0&&!qi(M,C)){const S=n.WGS84BoundingBox,B=K("EPSG:4326").getExtent();if(C=M,S)p=S[0]===B[0]&&S[2]===B[2];else{const k=P0(M,d.SupportedCRS,"EPSG:4326");p=k[0]-1e-10<=B[0]&&k[2]+1e-10>=B[2]}}const R=QP(d,C,a),N=[];let D=e.requestEncoding;if(D=D!==void 0?D:"","OperationsMetadata"in i&&"GetTile"in i.OperationsMetadata){const S=i.OperationsMetadata.GetTile.DCP.HTTP.Get;for(let B=0,k=S.length;B<k;++B)if(S[B].Constraint){const F=S[B].Constraint.find(function(z){return z.name=="GetEncoding"}).AllowedValues.Value;if(D===""&&(D=F[0]),D==="KVP")F.includes("KVP")&&N.push(S[B].href);else break}else S[B].href&&(D="KVP",N.push(S[B].href))}return N.length===0&&(D="REST",n.ResourceURL.forEach(function(S){S.resourceType==="tile"&&(l=S.format,N.push(S.template))})),{urls:N,layer:e.layer,matrixSet:o,format:l,projection:f,requestEncoding:D,tileGrid:R,style:h,dimensions:c,wrapX:p,crossOrigin:e.crossOrigin}}var xa,md,Bh,P1;class Dk{constructor(e,t){re(this,xa);re(this,Bh);v(this,"map");v(this,"srid");v(this,"wmtsCapabilitiesByServer",{});v(this,"wmtsLayers",{});v(this,"basemapLayers",[]);this.map=e,this.srid=t}removeAllBasemapLayers(){this.basemapLayers.forEach(e=>{this.map.removeLayer(e)}),this.basemapLayers=[]}addLayer(e){le(this,xa,md).call(this,e,!1)}addBasemapLayer(e){le(this,xa,md).call(this,e,!0)}removeLayer(e){if(this.layerExists(e)){const t=this.wmtsLayers[e.layerUniqueId];delete this.wmtsLayers[e.layerUniqueId],this.map.removeLayer(t)}else throw new Error("Cannot remove this layer: it does not exist")}layerExists(e){return e.layerUniqueId in this.wmtsLayers}getLayer(e){return this.layerExists(e)?this.wmtsLayers[e.layerUniqueId]:null}changeOpacity(e,t){if(this.layerExists(e))this.wmtsLayers[e.layerUniqueId].setOpacity(t);else throw new Error("Cannot change opacity for this layer: it does not exist")}}xa=new WeakSet,md=function(e,t){le(this,Bh,P1).call(this,e.url,n=>{const s=Nk(n,{layer:e.layers,projection:this.srid});if(s===null){console.log("Cannot create WMTS layer for layer "+e.layers);return}for(const o in e.dimensions)o in s.dimensions?s.dimensions[o]=e.dimensions[o]:console.warn("A dimension "+o+" was defined for the WMTS layer "+e.layers+" but the server does not seem to accept it.");const r=new z_({opacity:e.opacity,source:new Ok(s)});t?(this.basemapLayers.push(r),this.map.getLayers().insertAt(0,r)):(this.wmtsLayers[e.layerUniqueId]=r,this.map.addLayer(r))})},Bh=new WeakSet,P1=function(e,t){if(e in this.wmtsCapabilitiesByServer){const n=this.wmtsCapabilitiesByServer[e];t(n)}else fetch(e).then(n=>n.text()).then(n=>{const r=new HT().read(n);this.wmtsCapabilitiesByServer[e]=r,t(r)})};class Gk{constructor(e,t){v(this,"map");v(this,"srid");v(this,"configManager");v(this,"zoom",null);v(this,"resolution",null);v(this,"scale",null);v(this,"center");v(this,"extent");v(this,"scales");v(this,"allowedResolutions");v(this,"constraintScales");this.map=e,this.srid=t,this.configManager=kn.getInstance(),this.center=this.configManager.Config.map.startPosition.split(",").map(Number),this.zoom=Number(this.configManager.Config.map.startZoom),this.constraintScales=this.configManager.Config.map.constraintScales,this.extent=this.configManager.Config.map.maxExtent.split(",").map(Number),this.scales=this.configManager.Config.map.scales,this.allowedResolutions=this.scalesToResolutions(this.scales)}get projection(){return K(this.srid)}scalesToResolutions(e){const t=new Array;return e.forEach(n=>{const s=this.scaleToResolution(n);t.push(s)}),t}scaleToResolution(e){const t=this.projection.getUnits();return e/ni.METERS_PER_UNIT[t]/ni.INCHES_PER_METER/ni.SCREEN_DOTS_PER_INCH}getScale(){const e=this.projection.getUnits();return this.map.getView().getResolution()*ni.METERS_PER_UNIT[e]*ni.INCHES_PER_METER*ni.SCREEN_DOTS_PER_INCH}getView(){return new Ui({center:this.center,zoom:this.zoom??void 0,projection:this.srid,extent:this.extent,resolutions:this.allowedResolutions,constrainResolution:this.constraintScales})}getViewFromSrid(e){this.srid=e;const t=this.map.getView(),n=t.getProjection(),s=t.getResolution(),r=t.getCenter(),o=t.getRotation(),a=t.get("extent"),l=Fr(r,n,this.projection),h=n.getMetersPerUnit(),c=this.projection.getMetersPerUnit(),u=Vl(n,1/h,r,"m")*h,d=Vl(this.projection,1/c,l,"m")*c,f=s*u/d,g=Fr([a[0],a[1]],n,this.projection),p=Fr([a[2],a[3]],n,this.projection),m=[g[0],g[1],p[0],p[1]];return this.allowedResolutions=this.scalesToResolutions(this.scales),new Ui({center:l,resolution:f,rotation:o,projection:this.projection,resolutions:this.allowedResolutions,constrainResolution:this.constraintScales,extent:m})}setCenter(e){this.center=e,this.map.getView().setCenter(e)}setZoom(e){this.zoom=e,this.map.getView().setZoom(this.zoom),this.resolution=this.map.getView().getResolution()??null,this.scale=this.getScale()}setResolution(e){this.resolution=e,this.map.getView().setResolution(this.resolution),this.zoom=this.map.getView().getZoom()??null,this.scale=this.getScale()}setScale(e){this.scale=e,this.resolution=this.scaleToResolution(e),this.map.getView().setResolution(this.resolution),this.zoom=this.map.getView().getZoom()??null}}class zk{constructor(e){v(this,"olFeature");this.olFeature=e}get name(){return this.olFeature.get("name")}set name(e){this.olFeature.set("name",e)}get strokeColor(){return this.olFeature.get("strokeColor")}set strokeColor(e){this.olFeature.set("strokeColor",e)}get strokeWidth(){return this.olFeature.get("strokeWidth")}set strokeWidth(e){this.olFeature.set("strokeWidth",e)}get fillColor(){return this.olFeature.get("fillColor")}set fillColor(e){this.olFeature.set("fillColor",e)}get textSize(){return this.olFeature.get("textSize")}set textSize(e){this.olFeature.set("textSize",e)}get id(){return H(this.olFeature)}get geometry(){return console.warn("not implemented yet"),null}}class Bk extends at{constructor(){super("map");v(this,"template",()=>Ee`<style>
#container,
#ol-map {
  background-color: var(--bkg-color);
  position: absolute;
  height: 100%;
  width: 100%;
  overflow: hidden;
}

#cs-map {
  background-color: var(--bkg-color);
  position: absolute;
  height: 100%;
  overflow: hidden;
  left: 60%;
  width: 40%;
  display: none;
  border-left: solid 3px #444;
}

.ol-zoom {
  right: 1rem;
  top: 1rem;
  left: unset !important;
}

.ol-rotate {
  right: 1rem !important;
  top: 4rem !important;
}

#swiper {
  display: none;
  width: 99%;
  position: absolute;
  left: 0.5%;
  top: 50%;
  height: 0;
}

input[type='range'] {
  -webkit-appearance: none;
  width: 100%;
}

/* Webkit/Chrome specific */
input[type='range']::-webkit-slider-runnable-track {
  height: 0;
}

input[type='range']::-webkit-slider-thumb {
  -webkit-appearance: none;
  border: 2px solid #444;
  height: 0;
  margin-top: -1000px;
  padding-top: 1000px;
  padding-bottom: 1000px;
  width: 6px;
  background: var(--bkg-color);
  cursor: ew-resize;
}

/* Firefox specific */
input[type='range']::-moz-range-thumb {
  border: 2px solid #444;
  height: 0;
  padding-top: 1000px;
  padding-bottom: 1000px;
  width: 3px;
  background: var(--bkg-color);
  cursor: ew-resize;
}

/* TODO REG: Verify styling on Edge and Safari */
/*
input[type=range]::-ms-thumb {
  margin-top: 1px;
  box-shadow: 0px 0px 0px 50555C;
  border: 2px solid #50555C;
  height: 14px;
  width: 40px;
  border-radius: 5px;
  background: #FFFFFF;
  cursor: pointer;
}
*/

</style>
<link rel="stylesheet" href="lib/openlayers/ol.css" />

<div id="container">
  <div id="ol-map"></div>
  <div id="cs-map"></div>
  <input id="swiper" type="range" min="0" max="1000" step="1" />
</div>
`);v(this,"map");v(this,"mapTarget");v(this,"map3d");v(this,"map3dTarget");v(this,"swiper");v(this,"swipeManager");v(this,"wmtsManager");v(this,"wmsManager");v(this,"osmManager");v(this,"viewManager");v(this,"vectorTilesManager");v(this,"srid");v(this,"redliningFeaturesCollection",new Xt);v(this,"redliningSource");v(this,"redliningLayer",null);v(this,"draw",null);v(this,"snap");v(this,"selectedFeaturesCollection",new Xt);v(this,"focusedFeaturesCollection",new Xt);v(this,"selectionLayer");v(this,"focusLayer");v(this,"focusAnimation",null);v(this,"pixelTolerance",10);v(this,"dragbox");v(this,"maskLayer",new hP({name:"PrintMask"}))}get projection(){return K(this.srid)}registerEvents(){this.messageManager.register(this.onCustomGirafeEvent.bind(this)),this.swiper.addEventListener("input",()=>this.map.render()),this.stateManager.subscribe("activeBasemap",(t,n)=>this.onChangeBasemap(n)),this.stateManager.subscribe("projection",(t,n)=>this.onChangeProjection(n)),this.stateManager.subscribe("interface.darkMode",(t,n)=>this.onChangeDarkMode()),this.stateManager.subscribe("position",(t,n)=>this.onPositionChanged(n)),this.stateManager.subscribe("position.scale",(t,n)=>this.onChangeScale(n)),this.stateManager.subscribe("position.resolution",(t,n)=>this.zoomToResolution(n)),this.stateManager.subscribe("position.zoom",(t,n)=>this.zoomToZoom(n)),this.stateManager.subscribe("position.center",(t,n)=>this.panToCoordinate(n)),this.stateManager.subscribe("selection.selectedFeatures",(t,n)=>this.onFeaturesSelected(n)),this.stateManager.subscribe("selection.focusedFeature",(t,n)=>this.onFeatureFocused(n)),this.stateManager.subscribe("layers.swipedLayers",(t,n)=>this.onSwipedLayersChanged(n)),this.stateManager.subscribe("redlining.activeTool",(t,n)=>this.onRedliningToolChanged(n)),this.stateManager.subscribe("redlining.features",(t,n)=>this.onFeaturesChanged(t,n)),this.stateManager.subscribe("interface.printPanelVisible",(t,n)=>this.onPrintPanelToggled(n)),this.stateManager.subscribe("print.*",()=>this.onPrintStateChanged()),this.stateManager.subscribe("globe.display",()=>this.onGlobeToggled()),this.stateManager.subscribe("layers.layersList..*.activeState",(t,n,s)=>this.onLayerToggled(s)),this.stateManager.subscribe("layers.layersList..*.opacity",(t,n,s)=>this.onChangeOpacity(s)),this.stateManager.subscribe("layers.layersList..*.filter",(t,n,s)=>this.onChangeFilter(s)),this.stateManager.subscribe("layers.layersList..*.order",()=>this.onChangeOrder([]))}render(){super.render(),this.srid=this.configManager.Config.map.srid,this.mapTarget=this.shadow.getElementById("ol-map"),this.map3dTarget=this.shadow.getElementById("cs-map"),this.map=new uI({target:this.mapTarget,layers:[]}),this.state.olMap=this.map,this.wmsManager=new HP(this.map,this.srid),this.osmManager=new gA(this.map,this.srid),this.viewManager=new Gk(this.map,this.srid),this.vectorTilesManager=new Fk(this.map,this.srid),this.wmtsManager=new Dk(this.map,this.srid),this.swiper=this.shadow.getElementById("swiper"),this.swipeManager=new cP(this.map,this.swiper,this.wmtsManager,this.wmsManager);const t=this.viewManager.getView();this.map.setView(t),this.redliningSource=new rs({features:this.redliningFeaturesCollection}),this.redliningLayer=new kr({source:this.redliningSource}),this.map.addLayer(this.redliningLayer),this.redliningLayer.setZIndex(1001);const n=new rs({features:this.selectedFeaturesCollection});this.configManager.loadConfig().then(()=>{this.selectionLayer=new kr({source:n,style:new ii({stroke:new Tt({color:this.configManager.Config.selection.defaultStrokeColor,width:this.configManager.Config.selection.defaultStrokeWidth}),fill:new jt({color:this.configManager.Config.selection.defaultFillColor}),image:new Kn({radius:7,fill:new jt({color:this.configManager.Config.selection.defaultFillColor}),stroke:new Tt({color:this.configManager.Config.selection.defaultStrokeColor,width:this.configManager.Config.selection.defaultStrokeWidth})})})}),this.map.addLayer(this.selectionLayer),this.selectionLayer.setZIndex(1002),new rs({features:this.focusedFeaturesCollection}).on("addfeature",r=>{this.flash(r.feature)}),this.focusLayer=new kr({source:n,style:new ii({stroke:new Tt({color:this.configManager.Config.selection.defaultFocusStrokeColor,width:this.configManager.Config.selection.defaultFocusStrokeWidth}),fill:new jt({color:this.configManager.Config.selection.defaultFocusFillColor}),image:new Kn({radius:7,fill:new jt({color:this.configManager.Config.selection.defaultFocusFillColor}),stroke:new Tt({color:this.configManager.Config.selection.defaultFocusStrokeColor,width:this.configManager.Config.selection.defaultFocusStrokeWidth})})})}),this.map.addLayer(this.focusLayer),this.focusLayer.setZIndex(1003)}),this.dragbox=new s_({condition:zR}),this.map.addInteraction(this.dragbox),this.dragbox.on("boxend",s=>this.onDragSelection(s)),setTimeout(()=>{this.map.updateSize()},1e3)}getDefaultStyle(t){const n=t.get("strokeColor")?t.get("strokeColor"):this.configManager.Config.redlining.defaultStrokeColor,s=t.get("strokeWidth")?t.get("strokeWidth"):this.configManager.Config.redlining.defaultStrokeWidth,r=t.get("fillColor")?t.get("fillColor"):this.configManager.Config.redlining.defaultFillColor,o=t.get("textSize")?t.get("textSize"):this.configManager.Config.redlining.defaultTextSize;return t.set("strokeColor",n),t.set("strokeWidth",s),t.set("fillColor",r),t.set("textSize",o),new ii({stroke:new Tt({color:n,width:s}),fill:new jt({color:r}),image:new Kn({radius:7,fill:new jt({color:r}),stroke:new Tt({color:n,width:s})}),text:new yf({text:t.get("name"),font:"Bold "+o+"px/1 "+this.configManager.Config.redlining.defaultFont})})}listenOpenLayersEvents(){this.map.on("singleclick",t=>this.onClick(t)),this.map.on("loadstart",t=>this.onLoadStart(t)),this.map.on("loadend",t=>this.onLoadEnd(t)),this.map.on("moveend",t=>this.onMoveEnd(t)),this.map.on("pointermove",t=>this.onPointerMove(t)),this.redliningFeaturesCollection.on("add",t=>this.onFeatureAdded(t))}onLoadStart(t){this.state.loading=!0}onLoadEnd(t){this.state.loading=!1}onPointerMove(t){this.state.mouseCoordinates=t.coordinate}onMoveEnd(t){const n=this.map.getView(),s=new A0;s.center=n.getCenter(),s.zoom=n.getZoom(),s.resolution=n.getResolution(),s.scale=this.viewManager.getScale(),s.isValid&&(this.state.position=s)}onClick(t){const n=[t.pixel[0]-this.pixelTolerance,t.pixel[1]-this.pixelTolerance],s=this.map.getCoordinateFromPixel(n),r=[t.pixel[0]+this.pixelTolerance,t.pixel[1]+this.pixelTolerance],o=this.map.getCoordinateFromPixel(r),a=[s[0],s[1],o[0],o[1]];this.wmsManager.selectFeatures(a)}onDragSelection(t){const n=this.dragbox.getGeometry().getExtent();this.wmsManager.selectFeatures(n)}flash(t){const s=Date.now();let r=s;const o=t.getGeometry().clone();this.focusAnimation!==null&&X0(this.focusAnimation),this.focusAnimation=this.selectionLayer.on("postrender",l=>a(this,l));function a(l,h){const c=h.frameState,u=c.time-r;u>=2e3&&(r=Date.now());const d=lP(h),f=u/2e3,g=fs(f)*25+5,p=fs(1-f),m=c.time-s,_=Math.floor(m/100)%48,y=new ii({image:new Kn({radius:g,stroke:new Tt({color:"rgba(255, 0, 0, "+p+")",width:.25+p})}),stroke:new Tt({color:[255,0,0,1],width:12,lineDash:[16,32],lineDashOffset:_})});d.setStyle(y),d.drawGeometry(o),l.map.render()}}onFeatureAdded(t){const n=t.element;n.setId($0());const s=Eg[this.getRandomInt(0,Eg.length)]+" "+t.element.getGeometry().getType();n.set("name",s),n.setStyle(o=>this.getDefaultStyle(o));const r=new zk(n);this.state.redlining.features.push(r)}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.listenOpenLayersEvents(),this.registerEvents()})}onPrintStateChanged(){this.state.print.format&&this.maskLayer.updateSize(this.state.print.format),this.state.print.scale&&this.maskLayer.updateScale(this.state.print.scale),this.map.updateSize()}onPrintPanelToggled(t){t?this.maskLayer.setMap(this.map):this.maskLayer.setMap(null)}onCustomGirafeEvent(t){t.action===qs.zoomToExtent?this.zoomToExtent(t.extent):t.action===qs.undoDraw&&this.draw.removeLastPoint()}onSwipedLayersChanged(t){t.left.length===0&&t.right.length===0?this.swipeManager.deactivateSwipe():(this.swipeLayersOnSide(t.left,"left"),this.swipeLayersOnSide(t.right,"right"))}swipeLayersOnSide(t,n){for(const s of t)s instanceof dt?this.swipeManager.activateSwipeForWms(s,n):s instanceof ur&&this.swipeManager.activateSwipeForWmts(s,n)}async create3dMap(){if(!this.map3d){const t=await Hp(()=>import("./Cesium-cdbcf93c.js"),["./Cesium-cdbcf93c.js","./lazy-af36d162.js"],import.meta.url);window.Cesium=t;const s=(await Hp(()=>import("./OLCesium-8d046678.js"),["./OLCesium-8d046678.js","./lazy-af36d162.js"],import.meta.url)).default;this.map3d=new s({map:this.map,target:this.map3dTarget});const r=this.map3d.getCesiumScene(),o=await t.CesiumTerrainProvider.fromUrl(this.configManager.Config.map3d.terrainUrl);r.terrainProvider=o;const a=await t.Cesium3DTileset.fromUrl(this.configManager.Config.map3d.tilesetUrl);r.primitives.add(a)}}async onGlobeToggled(){this.state.globe.display==="full"?(await this.create3dMap(),this.mapTarget.style.display="none",this.map3dTarget.style.display="block",this.map3dTarget.style.left="0",this.map3dTarget.style.width="100%",this.map3d.setEnabled(!0)):this.state.globe.display==="side"?(await this.create3dMap(),this.mapTarget.style.display="block",this.mapTarget.style.width="55%",this.map3dTarget.style.display="block",this.map3dTarget.style.left="55%",this.map3dTarget.style.width="45%",this.map3d.setEnabled(!0)):(this.map3d&&this.map3d.setEnabled(!1),this.mapTarget.style.display="block",this.mapTarget.style.width="100%",this.map3dTarget.style.display="none")}onFeaturesSelected(t){if(this.selectedFeaturesCollection.clear(),t)for(const n of t)this.selectedFeaturesCollection.push(n)}onFeatureFocused(t){this.focusedFeaturesCollection.clear(),this.focusedFeaturesCollection.push(t)}onPositionChanged(t){this.zoomToResolution(t.resolution),t.isValid&&this.panToCoordinate(t.center)}onChangeScale(t){this.viewManager.setScale(t)}zoomToResolution(t){this.viewManager.setResolution(t)}zoomToZoom(t){this.viewManager.setZoom(t)}zoomToExtent(t){this.map.getView().fit(t)}panToCoordinate(t){this.viewManager.setCenter(t)}onChangeProjection(t){if(this.srid===t)return;this.srid=t;const n=this.viewManager.getViewFromSrid(t);this.map.setView(n)}onChangeDarkMode(){const t=this.shadow.querySelector("canvas");t&&(t.style.filter=this.state.interface.darkMode?"invert(100%) hue-rotate(180deg)":"")}onLayerToggled(t){t instanceof In&&(t.active?this.onAddLayers([t]):this.onRemoveLayers([t]))}onAddLayers(t){t.forEach(n=>{n instanceof dt?this.wmsManager.addLayer(n):n instanceof ur&&this.wmtsManager.addLayer(n)})}onRemoveLayers(t){t.forEach(n=>{n instanceof dt?this.wmsManager.removeLayer(n):n instanceof ur&&this.wmtsManager.layerExists(n)&&this.wmtsManager.removeLayer(n)})}onChangeOrder(t){alert("Not Implemented yet")}onChangeOpacity(t){t instanceof dt?this.wmsManager.changeOpacity(t):t instanceof ur&&this.wmtsManager.layerExists(t)&&this.wmtsManager.changeOpacity(t,t.opacity)}onChangeFilter(t){t instanceof dt&&this.wmsManager.changeFilter(t)}onChangeBasemap(t){this.wmtsManager.removeAllBasemapLayers(),this.wmsManager.removeAllBasemapLayers(),this.osmManager.removeAllBasemapLayers(),this.vectorTilesManager.removeAllBasemapLayers(),t.layersList.forEach(n=>{if(n instanceof Pu)this.osmManager.addBasemapLayer();else if(n instanceof Yl)this.vectorTilesManager.addBasemapLayer(n);else if(n instanceof ur)this.wmtsManager.addBasemapLayer(n);else if(n instanceof dt)this.wmsManager.addBasemapLayer(n);else throw new Error("Unknown basemap type")})}onFeaturesChanged(t,n){let s=[],r=[];Array.isArray(n)&&Array.isArray(t)?(s=t.filter(o=>!n.find(a=>a.olFeature.getId()===o.olFeature.getId())),r=n.filter(o=>!t.find(a=>a.olFeature.getId()===o.olFeature.getId()))):(this.isNullOrUndefined(t)||s.push(...t),this.isNullOrUndefined(n)||r.push(...n)),s.forEach(o=>{this.deleteFeature(o.olFeature)}),r.forEach(o=>{this.addFeature(o.olFeature)})}deleteFeature(t){const n=this.redliningFeaturesCollection.getArray().find(s=>s.getId()===t.getId());this.isNullOrUndefined(n)||this.redliningFeaturesCollection.remove(n)}addFeature(t){}onRedliningToolChanged(t){t===null?this.deactivateRedliningTool():this.activateRedliningTool(t)}activateRedliningTool(t){this.deactivateRedliningTool();let n,s=!1;t==="Square"?(t="Circle",n=ZL(4)):t==="Rectangle"?(t="Circle",n=KL()):t==="Freeline"?(t="LineString",s=!0):t==="Freepolygon"&&(t="Polygon",s=!0),this.draw=new QL({source:this.redliningSource,type:t,freehand:s,geometryFunction:n});const r=new nP({source:this.redliningSource});this.map.addInteraction(r),this.map.addInteraction(this.draw),this.snap=new aP({source:this.redliningSource}),this.map.addInteraction(this.snap)}deactivateRedliningTool(){this.draw&&this.map.removeInteraction(this.draw),this.snap&&this.map.removeInteraction(this.snap)}getRandomInt(t,n){return t=Math.ceil(t),n=Math.floor(n),Math.floor(Math.random()*(n-t)+t)}}class $k extends at{constructor(){super("menubutton");v(this,"template",()=>Ee`<style>
#container {
  position: relative;
}

#menu-content {
  display: none;
  position: absolute;
  font-size: 0;
}

#menu-content.open-bottom {
  top: 100%;
  left: 0;
  border-top: solid 1px #fff;
  height: max-content;
  width: fit-content;
}

#menu-content.open-bottom-left {
  top: 100%;
  right: 0;
  border-top: solid 1px #fff;
  height: max-content;
  width: fit-content;
}

#menu-content.open-up {
  bottom: 100%;
  right: 0;
  border-bottom: solid 1px #fff;
  height: max-content;
  width: fit-content;
}

#menu-content.open-left {
  right: 100%;
  bottom: 0;
  width: max-content;
  height: fit-content;
}

#button {
  border: none;
  border-right: solid 1px #fff;
  width: 4rem;
  height: 4.6rem;
  background-color: var(--bkg-color-grad1);
  color: var(--text-color);
  padding: 0;
  cursor: pointer;
  margin: 0;
  display: inline-block;
  line-height: 4rem;
}

#container.transparent #button {
  background-color: transparent;
  color: var(--text-color);
}

#container.transparent #button:hover {
  background-color: transparent;
  color: var(--text-color-grad1);
}

#button.small {
  width: 2.3rem;
  height: 2.3rem;
  line-height: 2.3rem;
}

span {
  font-size: 1.3rem;
}

#button.hybrid {
  display: flex;
  flex-direction: column;
}

#button.hybrid i {
  display: inline-block;
  height: 55%;
  width: 100%;
  line-height: 3.5rem;
}

#button.hybrid span {
  font-size: 0.8rem;
  height: 45%;
  width: 100%;
  line-height: 1.5rem;
}

#button:hover {
  background-color: var(--bkg-color);
}

</style>
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />

<div id="container">
  <slot name="menu-button">
    <button id="button" title="TODO: Generate this label from the button configuration"></button>
  </slot>

  <div id="menu-content" tabindex="-1">
    <slot name="menu-content"></slot>
  </div>
</div>
`);v(this,"button",null);v(this,"icon",null);v(this,"text",null);v(this,"textSpan",null);v(this,"menuContent",null);v(this,"container",null)}render(){super.render(),this.container=this.shadow.querySelector("#container"),this.button=this.shadow.querySelector("#button"),this.menuContent=this.shadow.querySelector("#menu-content");let t=this.hasAttribute("open")?this.getAttribute("open"):"bottom";if(this.setOpenDirection(t),this.hasAttribute("icon-style")&&(this.icon=document.createElement("i"),this.icon.className=this.getAttribute("icon-style"),this.button.appendChild(this.icon)),this.hasAttribute("text")&&(this.text=this.getAttribute("text"),this.textSpan=document.createElement("span"),this.textSpan.innerHTML=this.text,this.textSpan.setAttribute("i18n",this.text),this.button.appendChild(this.textSpan)),this.hasAttribute("size")){const n=this.getAttribute("size");this.button.classList.add(n)}this.container.classList=this.classList,this.setButtonStyle()}setOpenDirection(t){switch(t){case"left":this.menuContent.classList.add("open-left");break;case"up":this.menuContent.classList.add("open-up");break;case"bottom-left":this.menuContent.classList.add("open-bottom-left");break;case"bottom":default:this.menuContent.classList.add("open-bottom");break}}registerEvents(){this.button.addEventListener("click",t=>this.openMenu()),this.menuContent.addEventListener("blur",t=>this.onBlur(t))}setButtonStyle(){this.icon!==null&&this.textSpan!==null&&(this.button.className="hybrid")}setText(t){this.textSpan!==null&&this.isNullOrUndefinedOrBlank(t)?(this.text=null,this.textSpan.remove(),this.textSpan=null):this.textSpan===null&&!this.isNullOrUndefinedOrBlank(t)?(this.text=t,this.textSpan=document.createElement("span"),this.textSpan.innerHTML=this.text,this.button!==null?this.button.appendChild(this.textSpan):super.delayed(()=>this.button!==null,()=>this.button.appendChild(this.textSpan))):(this.text=t,this.textSpan.innerHTML=this.text),this.setButtonStyle()}openMenu(){this.menuContent.style.display==="block"?this.closeMenu():(this.menuContent.style.display="block",this.focusContent())}focusContent(){this.menuContent!=null&&this.menuContent.focus()}closeMenu(){this.menuContent!=null&&(this.menuContent.style.display="none");const t=super.getParentOfType(this.nodeName,this.shadow.host.parentNode);t!==null&&t.focusContent()}onBlur(t){t.relatedTarget!==this.button&&(this.contains(t.currentTarget,t.relatedTarget)||this.closeMenu())}contains(t,n){if(t.contains(n))return!0;const r=t.querySelector('slot[name="menu-content"]').assignedElements({flatten:!0});for(const o of r)if(o.contains(n))return!0;return!1}connectedCallback(){super.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}}const $h=class $h{constructor(e,t){v(this,"name");v(this,"position");if(!$h.BOOKMARKNAMEPATTERN.test(e))throw new Error("Bookmark name is not valid: it can only contain alphanumeric characters and the dash (-) underscore (_) and space characters.");this.name=e,this.position=t}};v($h,"BOOKMARKNAMEPATTERN",/^[A-Za-z0-9_ -]+$/);let yd=$h;class A1 extends at{constructor(t){super("navbookmarks");v(this,"template",()=>Ee`<style>
.content {
  display: flex;
}

input {
  border: solid 1px #ccc;
  border-radius: 0.25rem;
  background-color: #fff;
  padding-left: 1rem;
  color: #000;
  font-size: 0.9rem;
}

button {
  border: none;
  border-right: solid 1px #fff;
  width: 2.3rem;
  height: 2.3rem;
  line-height: 2.3rem;
  background-color: #444;
  color: #fff;
  padding: 0;
  cursor: pointer;
  margin: 0;
  display: inline-block;
}

button:hover {
  background-color: #000;
}

</style>
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />

<div class="content">
  <input
    id="name"
    type="text"
    placeholder="Enter name..."
    onkeypress="${t=>{t.keyCode===13?this.saveBookmark():console.log(t.keyCode)}}" />

  <button tip="Add bookmark" onclick="${()=>this.saveBookmark()}">
    <i class="fa-sm fa-solid fa-check"></i>
  </button>
</div>
`);v(this,"navHelper");v(this,"nameInput",null);this.navHelper=t}render(){super.render(),this.nameInput=this.shadow.getElementById("name"),this.nameInput.focus()}saveBookmark(){if(this.nameInput)try{const t=new yd(this.nameInput.value,this.state.position);this.navHelper.addBookmark(t),this.nameInput.value=""}catch(t){alert(t)}}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate()})}}var wa,Ri,Jt,Yr;class Uk extends at{constructor(){super("navhelper");v(this,"template",()=>Ee`<style>
.content-horizontal {
  display: flex;
  flex-direction: row;
}

.content-vertical {
  display: flex;
  flex-direction: column;
}

.menu-content {
  display: inline-flex;
  flex-direction: column;
  width: max-content;
  background-color: #fff;
}

.border-top {
  border-top: solid 1px #fff;
}

.hidden {
  display: none;
}

.grow {
  flex-grow: 1;
}

</style>
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />

<div class="content">
  <div class="content-horizontal">
    <div class="content-vertical">
      <girafe-button id="add-bookmark" size="small" icon-style="fa-sm fa-solid fa-plus"></girafe-button>
      <girafe-button
        size="small"
        icon-style="fa-sm fa-solid fa-arrow-left"
        class="border-top"
        onclick="${()=>this.navigateBack()}"></girafe-button>
    </div>
    <div class="content-vertical">
      <girafe-menu-button icon-style="fa-sm fa-solid fa-bookmark" size="small" open="bottom-left">
        <div slot="menu-content">
          <div class="${this.hasBookmark?"menu-content":"hidden"}">
            ${Object.values(this.bookmarks).map(t=>Ee.for(t)`
            <div class="content-horizontal">
              <girafe-button
                text="${t.name}"
                size="large"
                class="grow transparent border-top"
                onclick="${()=>this.navigateToPosition(t.position)}"></girafe-button>
              <girafe-button
                size="small"
                icon-style="fa-sm fa-solid fa-trash"
                class="border-top transparent"
                onclick="${()=>this.removeBookmark(t)}"></girafe-button>
            </div>
            `)}
          </div>
          <div class="${this.hasBookmark?"hidden":"menu-content"}">
            <girafe-button text="No bookmark yet..." size="large" class="transparent"></girafe-button>
          </div>
        </div>
      </girafe-menu-button>
      <girafe-button
        size="small"
        icon-style="fa-sm fa-solid fa-arrow-right"
        class="border-top"
        onclick="${()=>this.navigateForward()}"></girafe-button>
    </div>
  </div>
</div>
`);re(this,wa,void 0);re(this,Ri,[]);re(this,Jt,-1);v(this,"bookmarks",[]);re(this,Yr,!1)}get hasBookmark(){return this.bookmarks.length>0}render(){super.render(),this.createBookmarkTooltip()}createBookmarkTooltip(){const t=this.shadow.getElementById("add-bookmark");Ke(this,wa,Yo(t,{trigger:"click",arrow:!0,interactive:!0,theme:"light",placement:"bottom",appendTo:document.body,content:n=>new A1(this)}))}addBookmark(t){this.bookmarks.push(t),super.render(),super.girafeTranslate(),Z(this,wa).hide()}removeBookmark(t){const n=this.bookmarks.indexOf(t);n>=0&&this.bookmarks.splice(n,1),super.render(),super.girafeTranslate()}registerEvents(){this.stateManager.subscribe("position",(t,n)=>this.onPositionChanged(n))}onPositionChanged(t){if(!Z(this,Yr)){if(!t.isValid)return;Z(this,Jt)!==Z(this,Ri).length-1&&Z(this,Ri).splice(Z(this,Jt)+1),Z(this,Ri).push(t),Ke(this,Jt,Z(this,Ri).length-1)}}navigateBack(){let t=Z(this,Ri)[Z(this,Jt)];Z(this,Jt)>0&&(Cc(this,Jt)._--,t=Z(this,Ri)[Z(this,Jt)],console.log("Navigating back to:",t)),this.navigateToPosition(t)}navigateForward(){let t=Z(this,Ri)[Z(this,Jt)];Z(this,Jt)<Z(this,Ri).length-1&&(Cc(this,Jt)._++,t=Z(this,Ri)[Z(this,Jt)],console.log("Navigating forward to:",t)),this.navigateToPosition(t)}navigateToPosition(t){Ke(this,Yr,!0);try{this.state.position=t}finally{Ke(this,Yr,!1)}}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}}wa=new WeakMap,Ri=new WeakMap,Jt=new WeakMap,Yr=new WeakMap;var Uh,F1,ba,_d,qh,k1,jh,O1,Wh,N1,Vh,D1;class Ec extends at{constructor(t){super(t);re(this,Uh);re(this,ba);re(this,qh);re(this,jh);re(this,Wh);re(this,Vh);v(this,"panel");v(this,"panelRect");v(this,"gutter");v(this,"hideButton");v(this,"closeButton");v(this,"dock");v(this,"prevX",0);v(this,"prevY",0);v(this,"toggleWidth");v(this,"lastWidth",0);v(this,"hideWidth",0);this.dock=this.getAttribute("dock")??"right"}get host(){return this.shadow.getRootNode().host}render(){super.render(),this.makeResizable()}makeResizable(){this.panel=this.shadow.querySelector("#panel"),this.gutter=this.shadow.querySelector("#gutter"),this.gutter.onmousedown=t=>le(this,Uh,F1).call(this,t),this.gutter.ondblclick=()=>le(this,ba,_d).call(this),this.hideButton=this.shadow.getElementById("hide"),this.hideButton&&(this.hideButton.onclick=()=>le(this,ba,_d).call(this)),this.closeButton=this.shadow.getElementById("close"),this.closeButton&&(this.closeButton.onclick=()=>this.closePanel())}closePanel(){throw new Error("This function must be overriden to close the associated panel")}}Uh=new WeakSet,F1=function(t){t.preventDefault(),document.onmousemove=n=>le(this,Wh,N1).call(this,n),document.onmouseup=()=>le(this,Vh,D1).call(this),this.prevX=t.x,this.prevY=t.y,this.panelRect=this.panel.getBoundingClientRect(),this.hideButton&&(this.hideWidth=this.hideButton.getBoundingClientRect().width)},ba=new WeakSet,_d=function(){this.dock==="left"||this.dock==="right"?le(this,qh,k1).call(this):le(this,jh,O1).call(this)},qh=new WeakSet,k1=function(){if(!this.panel||!this.gutter)throw new Error("GirafeResizableElement.makeResizable() must be called before togglePanelVertically()");this.toggleWidth=this.gutter.getBoundingClientRect().width;const t=this.panel.getBoundingClientRect().width;t<=this.toggleWidth?(this.panel.style.width=this.lastWidth+"px",this.host.style.width=this.lastWidth+"px",this.panel.style.minWidth="",this.host.style.minWidth="",this.hideButton&&(this.hideButton.classList.remove("closed"),this.dock==="left"?this.hideButton.style.left=this.panel.getBoundingClientRect().width+"px":this.dock==="right"&&(this.hideButton.style.right=this.panel.getBoundingClientRect().width+"px"))):(this.lastWidth=t,this.panel.style.width=this.toggleWidth+"px",this.host.style.width=this.toggleWidth+"px",this.panel.style.minWidth="0",this.panel.style.overflow="hidden",this.host.style.minWidth="0",this.hideButton&&this.hideButton.classList.add("closed"))},jh=new WeakSet,O1=function(){if(!this.panel||!this.gutter)throw new Error("GirafeResizableElement.makeResizable() must be called before togglePanelHorizontally()");this.toggleWidth=this.gutter.getBoundingClientRect().height;const t=this.panel.getBoundingClientRect().height;t<=this.toggleWidth?(this.panel.style.height=this.lastWidth+"px",this.host.style.height=this.lastWidth+"px",this.panel.style.minHeight="",this.host.style.minHeight="",this.hideButton&&(this.hideButton.classList.remove("closed"),this.dock==="bottom"&&(this.hideButton.style.bottom=this.panel.getBoundingClientRect().height+"px"))):(this.lastWidth=t,this.panel.style.height=this.toggleWidth+"px",this.host.style.height=this.toggleWidth+"px",this.panel.style.minHeight="0",this.panel.style.overflow="hidden",this.host.style.minHeight="0",this.hideButton&&this.hideButton.classList.add("closed"))},Wh=new WeakSet,N1=function(t){if(!this.panel||!this.panelRect)throw new Error("GirafeResizableElement.makeResizable() must be called before this mousemove()");t.preventDefault();const n=this.prevX-t.x,s=this.prevY-t.y;if(this.dock==="left"){const r=this.panelRect.width-n;this.hideButton&&(this.hideButton.style.left=this.panel.getBoundingClientRect().width+"px"),this.closeButton&&(this.closeButton.style.left=this.panel.getBoundingClientRect().width+"px"),this.panel.style.width=r+"px",this.host.style.width=r+"px"}else if(this.dock==="right"){const r=this.panelRect.width+n;this.hideButton&&(this.hideButton.style.right=this.panel.getBoundingClientRect().width+"px"),this.closeButton&&(this.closeButton.style.right=this.panel.getBoundingClientRect().width+"px"),this.panel.style.width=r+"px",this.host.style.width=r+"px"}else if(this.dock==="bottom"){const r=this.panelRect.height+s;this.panel.style.height=r+"px",this.host.style.height=r+"px"}this.hideButton&&this.hideButton.classList.remove("closed")},Vh=new WeakSet,D1=function(){document.onmouseup=null,document.onmousemove=null};var Xh,G1;class qk extends Ec{constructor(){super("print");re(this,Xh);v(this,"template",()=>Ee`<style>
:host,
#panel {
  min-width: 22rem;
}

#panel {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: visible;
}

#gutter {
  border: none;
  width: 6px;
  height: 100%;
  background: var(--bkg-color);
  position: absolute;
  top: 0;
  left: 0;
  cursor: col-resize;
}

#close {
  border: solid 1px #999;
  border-right: none;
  color: #999;
  padding: 0.7rem 0 0.7rem 0.5rem;
  border-radius: 10px 0 0 10px;
  width: 0.8rem;
  height: 2rem;
  line-height: 2rem;
  position: fixed;
  top: 5.8rem;
  right: 22rem;
  background-color: var(--bkg-color);
  cursor: pointer;
}

#close i:before {
  content: '\uf00d';
}

#close:hover {
  border-color: #000;
  color: #000;
}

#content {
  position: absolute;
  top: 0;
  left: 6px;
  right: 0;
  bottom: 0;
  background: var(--bkg-color);
  padding: 1.5rem;
  margin: 0;
  overflow: visible;
}

#content div.option {
  margin-top: 0.5rem;
  display: flex;
}

#content button {
  float: right;
  margin-top: 1rem;
  height: 3rem;
  width: 8rem;
  background-color: var(--bkg-color);
  color: var(--text-color);
  border-radius: 3px;
  outline: 0;
  border: solid 1px #444;
  cursor: pointer;
}

#content button:hover {
  background-color: #000;
}

#content #printList {
  margin-top: 8rem;
}

#printList div.girafe {
  display: inline-block;
  position: relative;
  padding: 0.5rem;
  margin-top: 0.1rem;
  margin-right: 0.1rem;
  border: solid 1px #999;
  text-align: left;
  width: 100%;
  max-width: 16rem;
  min-width: 13rem;
  color: #666;
}

div.girafe i {
  margin-right: 1rem;
  float: left;
}

div.girafe span {
  display: block;
  line-height: 1.3rem;
}

div.girafe span.time {
  position: absolute;
  bottom: 0;
  right: 0;
  margin-right: 0.5rem;
}

label {
  color: var(--text-color);
  display: inline-block;
  width: 5rem;
  text-align: right;
  line-height: 2.5rem;
  margin-right: 0.5rem;
  flex-grow: 0;
}

label[for='comment'] {
  line-height: 1.5rem;
}

label:after {
  content: ' :';
}

select,
#title,
#comment {
  appearance: none;
  outline: 0;
  box-shadow: none;
  flex: 1;
  padding: 0 1rem;
  color: var(--text-color);
  background-color: var(--bkg-color);
  border: solid 1px #444;
  background-image: none;
  cursor: pointer;
  min-width: 4rem;
}

#comment {
  height: 6rem;
  padding: 0.5rem 1rem;
}

/* Custom Select wrapper */
.select {
  position: relative;
  display: flex;
  width: 13rem;
  height: 2.5rem;
  border-radius: 3px;
  overflow: hidden;
  flex-grow: 1;
}

.select::after {
  content: '\u25bc';
  position: absolute;
  top: 0;
  right: 0;
  padding: 0.7rem;
  background-color: #444;
  color: var(--text-color);
  pointer-events: none;
}

.select:hover::after {
  background-color: #000;
}

</style>
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />

<div id="panel">
  <div id="gutter"></div>
  <div id="close">
    <i class="fa-solid"></i>
  </div>
  <div id="content">
    <div class="option">
      <label for="layout">Layout</label>
      <div class="select">
        <select id="layout"></select>
      </div>
    </div>

    <div class="option">
      <label for="scale">Scale</label>
      <div class="select">
        <select id="scale"></select>
      </div>
    </div>

    <div class="option">
      <label for="format">Format</label>
      <div class="select">
        <select id="format"></select>
      </div>
    </div>

    <div class="option">
      <label for="title">Title</label>
      <input id="title" />
    </div>

    <div class="option">
      <label for="comment">Comment</label>
      <textarea id="comment"></textarea>
    </div>

    <button id="export-pdf">Print</button>

    <div id="printList"></div>
  </div>
</div>
`);v(this,"panel",null);v(this,"exportButton",null);v(this,"scaleSelect",null);v(this,"layoutSelect",null);v(this,"formatSelect",null);v(this,"titleInput",null);v(this,"commentInput",null);v(this,"downloadButton",null);v(this,"printList",null);v(this,"printUrl",null);v(this,"defaultLayout",null);v(this,"printApp",null);v(this,"printLayouts",null);v(this,"layoutsByName",{});v(this,"printFormats",null);v(this,"downloadUrl",null);v(this,"statusUrl",null);v(this,"projection",null);v(this,"centerCoords",null)}get capabilitiesUrl(){return this.printUrl+"capabilities.json"}getReportUrl(t){return this.printUrl+"report."+t}getDownloadUrl(t){return this.printUrl+t.downloadURL.substring(t.downloadURL.indexOf("/report")+1)}getStatusUrl(t){return this.printUrl+t.statusURL.substring(t.statusURL.indexOf("/status")+1)}async initializePrint(){this.printUrl=this.configManager.Config.print.url,this.defaultLayout=this.configManager.Config.print.defaultLayout,this.printUrl.endsWith("/")||(this.printUrl+="/");const n=await(await fetch(this.capabilitiesUrl,{referrer:""})).json();this.printApp=n.app,this.printLayouts=n.layouts,this.printFormats=n.formats}render(){super.render(),this.panel=this.shadow.querySelector("#panel"),this.panel.style.display="none",this.exportButton=this.shadow.querySelector("#export-pdf"),this.scaleSelect=this.shadow.querySelector("#scale"),this.layoutSelect=this.shadow.querySelector("#layout"),this.formatSelect=this.shadow.querySelector("#format"),this.titleInput=this.shadow.querySelector("#title"),this.commentInput=this.shadow.querySelector("#comment"),this.downloadButton=this.shadow.querySelector("#download"),this.printList=this.shadow.querySelector("#printList"),this.printLayouts.forEach(s=>{this.layoutsByName[s.name]=s,this.addLayoutOption(this.layoutSelect,s)}),this.defaultLayout!==null&&(this.layoutSelect.value=this.defaultLayout);const n=this.layoutsByName[this.layoutSelect.value].attributes.filter(s=>s.type==="MapAttributeValues")[0].clientInfo;this.updateScales(n),this.printFormats.forEach(s=>{this.addFormatOption(this.formatSelect,s)}),this.activateTooltips(!1,[800,0],"top-end"),super.girafeTranslate()}closePanel(){this.state.interface.printPanelVisible=!1}addFormatOption(t,n){const s=document.createElement("option");s.innerHTML=n,s.value=n,t.appendChild(s)}addLayoutOption(t,n){const s=document.createElement("option");s.setAttribute("i18n",n.name),s.innerHTML=n.name,s.value=n.name,t.appendChild(s)}addScaleOption(t,n){const s=document.createElement("option");s.innerHTML="1:"+n,s.value=n,t.appendChild(s)}registerEvents(){this.stateManager.subscribe("interface.printPanelVisible",(t,n)=>le(this,Xh,G1).call(this,n)),this.layoutSelect.addEventListener("change",t=>this.onLayoutChanged(t)),this.scaleSelect.addEventListener("change",t=>this.onScaleChanged(t)),this.exportButton.addEventListener("click",()=>this.print())}onLayoutChanged(t){const s=this.layoutsByName[t.target.value].attributes.filter(r=>r.type==="MapAttributeValues")[0].clientInfo;this.updateScales(s),this.state.print.format=[s.width,s.height]}onScaleChanged(t){this.state.print.scale=t.target.value}updateScales(t){const n=this.scaleSelect.value;this.scaleSelect.innerHTML="",t.scales.forEach(s=>{this.addScaleOption(this.scaleSelect,s)}),this.isNullOrUndefinedOrBlank(n)?this.scaleSelect.value=t.scales[0]:(this.scaleSelect.value=n,this.scaleSelect.value=n)}connectedCallback(){this.loadConfig().then(()=>this.initializePrint().then(()=>{this.render(),this.registerEvents()}))}print(){const t=this.layoutSelect.value,n=this.formatSelect.value,s=this.scaleSelect.value,r={attributes:{map:{dpi:254,rotation:0,center:[this.state.position.center[0],this.state.position.center[1]],projection:this.state.projection,scale:s,useNearestScale:!1,layers:[{baseURL:"https://map.geo.bs.ch/mapserv_proxy",imageFormat:"image/png",layers:["Stadt- und Parzellenplan farbig"],customParams:{TRANSPARENT:"true",ogcserver:"WMS BS (1)"},serverType:"mapserver",type:"wms",opacity:1,useNativeAngle:!0,styles:[""]}]},title:this.titleInput.value,comment:this.commentInput.value,maxTitleLength:"130",maxCommentLength:"190"},format:n,lang:"en",layout:t};fetch(this.getReportUrl(n),{method:"POST",headers:new Headers({"Content-Type":"application/json;charset=UTF-8"}),body:JSON.stringify(r)}).then(o=>o.json()).then(o=>this.managePrintStatus(o))}managePrintStatus(t){const n=this.getDownloadUrl(t),s=this.getStatusUrl(t),r="p-"+t.ref.substring(0,t.ref.indexOf("-"));this.addPrintToList(r),setTimeout((function(o,a,l){this.checkStatus(o,a,l)}).bind(this,r,s,n),2e3)}addPrintToList(t){const n=document.createElement("div");n.className="girafe",n.id=t;const s=document.createElement("i");s.className="fa-solid fa-circle-notch fa-spin fa-3x",n.appendChild(s);const r=document.createElement("span");r.innerHTML=this.layoutSelect.value+" ("+this.formatSelect.value+")",n.appendChild(r);const o=document.createElement("span");o.innerHTML=this.titleInput.value,n.appendChild(o);const a=new Date(Date.now()),l=document.createElement("span");l.innerHTML=a.getHours()+":"+a.getMinutes(),l.className="time",n.appendChild(l),this.printList.prepend(n)}checkStatus(t,n,s){fetch(n).then(r=>r.json()).then(r=>{if(!r.done)r.elapsedTime>3e4?alert("timeout"):setTimeout((function(o,a,l){this.checkStatus(o,a,l)}).bind(this,t,n,s),2e3);else switch(r.status){case"error":this.printError(t,r.error);break;case"finished":this.printFinished(t,s)}})}printFinished(t,n){const r=this.shadow.querySelector("#"+t).querySelectorAll("i")[0];r.className="fa-solid fa-file-arrow-down fa-3x",r.onclick=()=>window.open(n,"_blank")}printError(t,n){const r=this.shadow.querySelector("#"+t).querySelectorAll("i")[0];r.className="fa-solid fa-triangle-exclamation fa-3x",r.title=n}}Xh=new WeakSet,G1=function(t){if(t){this.panel.style.display="block",this.panel.getRootNode().host.style.display="block";const s=this.layoutsByName[this.layoutSelect.value].attributes.filter(r=>r.type==="MapAttributeValues")[0].clientInfo;this.state.print.scale=this.scaleSelect.value,this.state.print.format=[s.width,s.height]}else this.panel.style.display="none",this.panel.getRootNode().host.style.display="none"};var Hr;class jk extends at{constructor(){super("projection");v(this,"template",()=>Ee`<style>

</style>
<girafe-menu-button id="menu-button" icon-style="fa-xl fa-solid fa-earth-europe" open="left">
  <div slot="menu-content">
    ${Object.entries(this.projections).map(([t,n])=>Ee`
    <girafe-button
      text="${n}"
      icon-style="fa-xl fa-solid fa-earth-europe"
      onclick="${()=>this.changeProjection(t)}"></girafe-button
    >`)}
  </div>
</girafe-menu-button>
`);v(this,"projections",{});re(this,Hr,void 0)}get menuButton(){if(!Z(this,Hr))throw new Error("You called menuButton before render");return Z(this,Hr)}render(){this.projections=this.configManager.Config.projections;for(const t in this.projections)t.startsWith("//")&&delete this.projections[t];super.render(),Ke(this,Hr,this.shadow.querySelector("#menu-button")),Object.keys(this.projections).length==1&&this.menuButton.hide()}changeProjection(t){console.log("change projection",t),this.state.projection=t}registerEvents(){this.stateManager.subscribe("projection",(t,n)=>this.onChangeProjection(n))}onChangeProjection(t){console.log("projection changed");const n=this.projections[t];this.menuButton.setText(n),this.menuButton.closeMenu()}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}}Hr=new WeakMap;class kt{static isNumeric(e){return e.trim().length>0&&!isNaN(Number(e))}static getFilter(e,t,n,s){if(!n)throw new Error("The type of the property should never be null !");switch(e){case"eq":return n==="string"&&kt.isNumeric(s)?kt.likeFilter(t,s):kt.eqFilter(t,s);case"neq":return n==="string"&&kt.isNumeric(s)?kt.nlikeFilter(t,s):kt.neqFilter(t,s);case"gt":return kt.gtFilter(t,s);case"gte":return kt.gteFilter(t,s);case"lt":return kt.ltFilter(t,s);case"lte":return kt.lteFilter(t,s);case"like":return kt.likeFilter(t,"*"+s+"*");case"nlike":return kt.nlikeFilter(t,"*"+s+"*");case"nul":return kt.eqFilter(t,"");case"nnul":return kt.neqFilter(t,"");default:throw new Error("Unknown filter operator")}}static eqFilter(e,t){return`<Filter><PropertyIsEqualTo><PropertyName>${e}</PropertyName><Literal>${t}</Literal></PropertyIsEqualTo></Filter>`}static neqFilter(e,t){return`<Filter><Not><PropertyIsEqualTo><PropertyName>${e}</PropertyName><Literal>${t}</Literal></PropertyIsEqualTo></Not></Filter>`}static ltFilter(e,t){return`<Filter><PropertyIsLessThan><PropertyName>${e}</PropertyName><Literal>${t}</Literal></PropertyIsLessThan></Filter>`}static lteFilter(e,t){return`<Filter><PropertyIsLessThanOrEqualTo><PropertyName>${e}</PropertyName><Literal>${t}</Literal></PropertyIsLessThanOrEqualTo></Filter>`}static gtFilter(e,t){return`<Filter><PropertyIsGreaterThan><PropertyName>${e}</PropertyName><Literal>${t}</Literal></PropertyIsGreaterThan></Filter>`}static gteFilter(e,t){return`<Filter><PropertyIsGreaterThanOrEqualTo><PropertyName>${e}</PropertyName><Literal>${t}</Literal></PropertyIsGreaterThanOrEqualTo></Filter>`}static likeFilter(e,t){return`<Filter><PropertyIsLike wildcard='*' singleChar='.' escape='!'><PropertyName>${e}</PropertyName><Literal>${t}</Literal></PropertyIsLike></Filter>`}static nlikeFilter(e,t){return`<Filter><Not><PropertyIsLike wildcard='*' singleChar='.' escape='!'><PropertyName>${e}</PropertyName><Literal>${t}</Literal></PropertyIsLike></Not></Filter>`}}class z1 extends at{constructor(t){super("querybuilder");v(this,"template",()=>Ee`<style>
.content {
  display: flex;
}

.hidden {
  display: none;
}

.loading i {
  margin: 0.8rem;
}

button {
  border: none;
  border-right: solid 1px #fff;
  width: 2.3rem;
  height: 2.3rem;
  line-height: 2.3rem;
  background-color: #444;
  color: #fff;
  padding: 0;
  cursor: pointer;
  margin: 0;
  display: inline-block;
}

button:hover {
  background-color: #000;
}

/* Custom style for select */
.custom-select {
  min-width: 15rem;
  position: relative;
}

input,
select {
  border: solid 1px #ccc;
  border-radius: 0.25rem;
  background-color: #fff;
  padding-left: 1rem;
  color: #000;
  font-size: 0.9rem;
}

select {
  appearance: none;
  -webkit-appearance: none;
  width: 100%;
  height: 100%;
  cursor: pointer;
}

.custom-select::before,
.custom-select::after {
  content: '';
  position: absolute;
  right: 1rem;
  pointer-events: none;
}

.custom-select::after {
  border-left: 0.4rem solid transparent;
  border-right: 0.4rem solid transparent;
  border-top: 0.4rem solid black;
  top: 45%;
}

</style>
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />

<div>
  <div class="${this.loading?"loading":"loading hidden"}">
    <i class="fa-xl fa-solid fa-circle-notch fa-spin"></i>
    Loading server configuration...
  </div>
  <div class="${this.loading?"content hidden":"content"}">
    <div class="custom-select">
      <select id="attribute" name="attribute" onchange="${()=>this.attributeChanged()}">
        <option value="" disabled selected>Select attribute...</option>
        ${this.layerAttributes.map(t=>Ee.for(t)`
        <option i18n="${t.name}" value="${t.name}">${t.name}</option>
        `)}
      </select>
    </div>

    <div class="custom-select">
      <select id="operator" name="operator" onchange="${()=>this.operatorChanged()}">
        <option value="" disabled selected>Select operator...</option>
        <option value="eq" class="${this.isNumber||this.isString?"":"hidden"}">equals</option>
        <option value="neq" class="${this.isNumber||this.isString?"":"hidden"}">does not equal</option>
        <option value="like" class="${this.isString?"":"hidden"}">contains</option>
        <option value="nlike" class="${this.isString?"":"hidden"}">does not contain</option>
        <option value="gt" class="${this.isNumber?"":"hidden"}">greater than</option>
        <option value="gte" class="${this.isNumber?"":"hidden"}">greater than or equal to</option>
        <option value="lt" class="${this.isNumber?"":"hidden"}">less than</option>
        <option value="lte" class="${this.isNumber?"":"hidden"}">less than or equal to</option>
        <option value="nul" class="${this.isNumber||this.isString?"":"hidden"}">is blank</option>
        <option value="nnul" class="${this.isNumber||this.isString?"":"hidden"}">is not blank</option>
      </select>
    </div>

    <input id="val" type="text" class="${this.showVal?"":"hidden"}" placeholder="Enter value..." />

    <button tip="Apply filter" onclick="${()=>this.filter()}">
      <i class="fa-sm fa-solid fa-filter"></i>
    </button>

    <button tip="Remove filter" onclick="${()=>this.removeFilter()}">
      <i class="fa-sm fa-solid fa-trash"></i>
    </button>
  </div>
</div>
`);v(this,"loading",!0);v(this,"layer");v(this,"layerAttributes",[]);v(this,"currentAttributeType",null);v(this,"showVal",!1);this.layer=t}render(){if(!this.layer.urlWfs)throw new Error("No WFS URL found. Please verify the Layer type.");super.render(),Uy.getInstance().getServerWfs(this.layer.urlWfs).then(t=>{this.layerAttributes=t.layers[this.layer.name],this.loading=!1,super.render(),super.girafeTranslate(),this.activateTooltips(!1,[800,0],"top-end")})}get isString(){return this.currentAttributeType==="string"||this.currentAttributeType==="date"}get isNumber(){return this.currentAttributeType==="integer"||this.currentAttributeType==="double"||this.currentAttributeType==="long"}attributeChanged(){const t=this.shadow.getElementById("attribute"),n=this.layerAttributes.find(s=>s.name=t.value);if(!n)throw new Error("Why is this object null ? This should never happen...");this.currentAttributeType=n.type,super.render()}operatorChanged(){const t=this.shadow.getElementById("operator");this.showVal=t.value!=="nul"&&t.value!=="nnul",super.render()}filter(){const t=this.shadow.getElementById("attribute"),n=this.shadow.getElementById("operator"),s=this.shadow.getElementById("val");this.layer.filter=kt.getFilter(n.value,t.value,this.currentAttributeType,s.value),console.log(this.layer.filter)}removeFilter(){const t=this.shadow.getElementById("attribute"),n=this.shadow.getElementById("operator"),s=this.shadow.getElementById("val");this.layer.filter="",t.value="",n.value="",s.value="",this.currentAttributeType=null,this.showVal=!1,super.render()}connectedCallback(){this.loadConfig().then(()=>{this.render()})}}/*!
 * vanilla-picker v2.12.2
 * https://vanilla-picker.js.org
 *
 * Copyright 2017-2023 Andreas Borgen (https://github.com/Sphinxxxx), Adam Brooks (https://github.com/dissimulate)
 * Released under the ISC license.
 */var wg=function(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")},bg=function(){function i(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),Ll=function(){function i(e,t){var n=[],s=!0,r=!1,o=void 0;try{for(var a=e[Symbol.iterator](),l;!(s=(l=a.next()).done)&&(n.push(l.value),!(t&&n.length===t));s=!0);}catch(h){r=!0,o=h}finally{try{!s&&a.return&&a.return()}finally{if(r)throw o}}return n}return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return i(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();String.prototype.startsWith=String.prototype.startsWith||function(i){return this.indexOf(i)===0};String.prototype.padStart=String.prototype.padStart||function(i,e){for(var t=this;t.length<i;)t=e+t;return t};var Wk={cb:"0f8ff",tqw:"aebd7",q:"-ffff",qmrn:"7fffd4",zr:"0ffff",bg:"5f5dc",bsq:"e4c4",bck:"---",nch:"ebcd",b:"--ff",bvt:"8a2be2",brwn:"a52a2a",brw:"deb887",ctb:"5f9ea0",hrt:"7fff-",chcT:"d2691e",cr:"7f50",rnw:"6495ed",crns:"8dc",crms:"dc143c",cn:"-ffff",Db:"--8b",Dcn:"-8b8b",Dgnr:"b8860b",Dgr:"a9a9a9",Dgrn:"-64-",Dkhk:"bdb76b",Dmgn:"8b-8b",Dvgr:"556b2f",Drng:"8c-",Drch:"9932cc",Dr:"8b--",Dsmn:"e9967a",Dsgr:"8fbc8f",DsTb:"483d8b",DsTg:"2f4f4f",Dtrq:"-ced1",Dvt:"94-d3",ppnk:"1493",pskb:"-bfff",mgr:"696969",grb:"1e90ff",rbrc:"b22222",rwht:"af0",stg:"228b22",chs:"-ff",gnsb:"dcdcdc",st:"8f8ff",g:"d7-",gnr:"daa520",gr:"808080",grn:"-8-0",grnw:"adff2f",hnw:"0fff0",htpn:"69b4",nnr:"cd5c5c",ng:"4b-82",vr:"0",khk:"0e68c",vnr:"e6e6fa",nrb:"0f5",wngr:"7cfc-",mnch:"acd",Lb:"add8e6",Lcr:"08080",Lcn:"e0ffff",Lgnr:"afad2",Lgr:"d3d3d3",Lgrn:"90ee90",Lpnk:"b6c1",Lsmn:"a07a",Lsgr:"20b2aa",Lskb:"87cefa",LsTg:"778899",Lstb:"b0c4de",Lw:"e0",m:"-ff-",mgrn:"32cd32",nn:"af0e6",mgnt:"-ff",mrn:"8--0",mqm:"66cdaa",mmb:"--cd",mmrc:"ba55d3",mmpr:"9370db",msg:"3cb371",mmsT:"7b68ee","":"-fa9a",mtr:"48d1cc",mmvt:"c71585",mnLb:"191970",ntc:"5fffa",mstr:"e4e1",mccs:"e4b5",vjw:"dead",nv:"--80",c:"df5e6",v:"808-0",vrb:"6b8e23",rng:"a5-",rngr:"45-",rch:"da70d6",pgnr:"eee8aa",pgrn:"98fb98",ptrq:"afeeee",pvtr:"db7093",ppwh:"efd5",pchp:"dab9",pr:"cd853f",pnk:"c0cb",pm:"dda0dd",pwrb:"b0e0e6",prp:"8-080",cc:"663399",r:"--",sbr:"bc8f8f",rb:"4169e1",sbrw:"8b4513",smn:"a8072",nbr:"4a460",sgrn:"2e8b57",ssh:"5ee",snn:"a0522d",svr:"c0c0c0",skb:"87ceeb",sTb:"6a5acd",sTgr:"708090",snw:"afa",n:"-ff7f",stb:"4682b4",tn:"d2b48c",t:"-8080",thst:"d8bfd8",tmT:"6347",trqs:"40e0d0",vt:"ee82ee",whT:"5deb3",wht:"",hts:"5f5f5",w:"-",wgrn:"9acd32"};function Wm(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=e>0?i.toFixed(e).replace(/0+$/,"").replace(/\.$/,""):i.toString();return t||"0"}var Vk=function(){function i(e,t,n,s){wg(this,i);var r=this;function o(l){if(l.startsWith("hsl")){var h=l.match(/([\-\d\.e]+)/g).map(Number),c=Ll(h,4),u=c[0],d=c[1],f=c[2],g=c[3];g===void 0&&(g=1),u/=360,d/=100,f/=100,r.hsla=[u,d,f,g]}else if(l.startsWith("rgb")){var p=l.match(/([\-\d\.e]+)/g).map(Number),m=Ll(p,4),_=m[0],y=m[1],x=m[2],w=m[3];w===void 0&&(w=1),r.rgba=[_,y,x,w]}else l.startsWith("#")?r.rgba=i.hexToRgb(l):r.rgba=i.nameToRgb(l)||i.hexToRgb(l)}if(e!==void 0)if(Array.isArray(e))this.rgba=e;else if(n===void 0){var a=e&&""+e;a&&o(a.toLowerCase())}else this.rgba=[e,t,n,s===void 0?1:s]}return bg(i,[{key:"printRGB",value:function(t){var n=t?this.rgba:this.rgba.slice(0,3),s=n.map(function(r,o){return Wm(r,o===3?3:0)});return t?"rgba("+s+")":"rgb("+s+")"}},{key:"printHSL",value:function(t){var n=[360,100,100,1],s=["","%","%",""],r=t?this.hsla:this.hsla.slice(0,3),o=r.map(function(a,l){return Wm(a*n[l],l===3?3:1)+s[l]});return t?"hsla("+o+")":"hsl("+o+")"}},{key:"printHex",value:function(t){var n=this.hex;return t?n:n.substring(0,7)}},{key:"rgba",get:function(){if(this._rgba)return this._rgba;if(!this._hsla)throw new Error("No color is set");return this._rgba=i.hslToRgb(this._hsla)},set:function(t){t.length===3&&(t[3]=1),this._rgba=t,this._hsla=null}},{key:"rgbString",get:function(){return this.printRGB()}},{key:"rgbaString",get:function(){return this.printRGB(!0)}},{key:"hsla",get:function(){if(this._hsla)return this._hsla;if(!this._rgba)throw new Error("No color is set");return this._hsla=i.rgbToHsl(this._rgba)},set:function(t){t.length===3&&(t[3]=1),this._hsla=t,this._rgba=null}},{key:"hslString",get:function(){return this.printHSL()}},{key:"hslaString",get:function(){return this.printHSL(!0)}},{key:"hex",get:function(){var t=this.rgba,n=t.map(function(s,r){return r<3?s.toString(16):Math.round(s*255).toString(16)});return"#"+n.map(function(s){return s.padStart(2,"0")}).join("")},set:function(t){this.rgba=i.hexToRgb(t)}}],[{key:"hexToRgb",value:function(t){var n=(t.startsWith("#")?t.slice(1):t).replace(/^(\w{3})$/,"$1F").replace(/^(\w)(\w)(\w)(\w)$/,"$1$1$2$2$3$3$4$4").replace(/^(\w{6})$/,"$1FF");if(!n.match(/^([0-9a-fA-F]{8})$/))throw new Error("Unknown hex color; "+t);var s=n.match(/^(\w\w)(\w\w)(\w\w)(\w\w)$/).slice(1).map(function(r){return parseInt(r,16)});return s[3]=s[3]/255,s}},{key:"nameToRgb",value:function(t){var n=t.toLowerCase().replace("at","T").replace(/[aeiouyldf]/g,"").replace("ght","L").replace("rk","D").slice(-5,4),s=Wk[n];return s===void 0?s:i.hexToRgb(s.replace(/\-/g,"00").padStart(6,"f"))}},{key:"rgbToHsl",value:function(t){var n=Ll(t,4),s=n[0],r=n[1],o=n[2],a=n[3];s/=255,r/=255,o/=255;var l=Math.max(s,r,o),h=Math.min(s,r,o),c=void 0,u=void 0,d=(l+h)/2;if(l===h)c=u=0;else{var f=l-h;switch(u=d>.5?f/(2-l-h):f/(l+h),l){case s:c=(r-o)/f+(r<o?6:0);break;case r:c=(o-s)/f+2;break;case o:c=(s-r)/f+4;break}c/=6}return[c,u,d,a]}},{key:"hslToRgb",value:function(t){var n=Ll(t,4),s=n[0],r=n[1],o=n[2],a=n[3],l=void 0,h=void 0,c=void 0;if(r===0)l=h=c=o;else{var u=function(m,_,y){return y<0&&(y+=1),y>1&&(y-=1),y<.16666666666666666?m+(_-m)*6*y:y<.5?_:y<.6666666666666666?m+(_-m)*(.6666666666666666-y)*6:m},d=o<.5?o*(1+r):o+r-o*r,f=2*o-d;l=u(f,d,s+1/3),h=u(f,d,s),c=u(f,d,s-1/3)}var g=[l*255,h*255,c*255].map(Math.round);return g[3]=a,g}}]),i}(),Xk=function(){function i(){wg(this,i),this._events=[]}return bg(i,[{key:"add",value:function(t,n,s){t.addEventListener(n,s,!1),this._events.push({target:t,type:n,handler:s})}},{key:"remove",value:function(t,n,s){this._events=this._events.filter(function(r){var o=!0;return t&&t!==r.target&&(o=!1),n&&n!==r.type&&(o=!1),s&&s!==r.handler&&(o=!1),o&&i._doRemove(r.target,r.type,r.handler),!o})}},{key:"destroy",value:function(){this._events.forEach(function(t){return i._doRemove(t.target,t.type,t.handler)}),this._events=[]}}],[{key:"_doRemove",value:function(t,n,s){t.removeEventListener(n,s,!1)}}]),i}();function Yk(i){var e=document.createElement("div");return e.innerHTML=i,e.firstElementChild}function mu(i,e,t){var n=!1;function s(l,h,c){return Math.max(h,Math.min(l,c))}function r(l,h,c){if(c&&(n=!0),!!n){l.preventDefault();var u=e.getBoundingClientRect(),d=u.width,f=u.height,g=h.clientX,p=h.clientY,m=s(g-u.left,0,d),_=s(p-u.top,0,f);t(m/d,_/f)}}function o(l,h){var c=l.buttons===void 0?l.which:l.buttons;c===1?r(l,l,h):n=!1}function a(l,h){l.touches.length===1?r(l,l.touches[0],h):n=!1}i.add(e,"mousedown",function(l){o(l,!0)}),i.add(e,"touchstart",function(l){a(l,!0)}),i.add(window,"mousemove",o),i.add(e,"touchmove",a),i.add(window,"mouseup",function(l){n=!1}),i.add(e,"touchend",function(l){n=!1}),i.add(e,"touchcancel",function(l){n=!1})}var Hk=`linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%) 0 0 / 2em 2em,
                   linear-gradient(45deg, lightgrey 25%,       white 25%,       white 75%, lightgrey 75%) 1em 1em / 2em 2em`,Zk=360,B1="keydown",Pl="mousedown",yu="focusin";function en(i,e){return(e||document).querySelector(i)}function $1(i){i.preventDefault(),i.stopPropagation()}function _u(i,e,t,n,s){i.add(e,B1,function(r){t.indexOf(r.key)>=0&&(s&&$1(r),n(r))})}var Vm=function(){function i(e){wg(this,i),this.settings={popup:"right",layout:"default",alpha:!0,editor:!0,editorFormat:"hex",cancelButton:!1,defaultColor:"#0cf"},this._events=new Xk,this.onChange=null,this.onDone=null,this.onOpen=null,this.onClose=null,this.setOptions(e)}return bg(i,[{key:"setOptions",value:function(t){var n=this;if(!t)return;var s=this.settings;function r(h,c,u){for(var d in h)u&&u.indexOf(d)>=0||(c[d]=h[d])}if(t instanceof HTMLElement)s.parent=t;else{s.parent&&t.parent&&s.parent!==t.parent&&(this._events.remove(s.parent),this._popupInited=!1),r(t,s),t.onChange&&(this.onChange=t.onChange),t.onDone&&(this.onDone=t.onDone),t.onOpen&&(this.onOpen=t.onOpen),t.onClose&&(this.onClose=t.onClose);var o=t.color||t.colour;o&&this._setColor(o)}var a=s.parent;if(a&&s.popup&&!this._popupInited){var l=function(c){return n.openHandler(c)};this._events.add(a,"click",l),_u(this._events,a,[" ","Spacebar","Enter"],l),this._popupInited=!0}else t.parent&&!s.popup&&this.show()}},{key:"openHandler",value:function(t){if(this.show()){t&&t.preventDefault(),this.settings.parent.style.pointerEvents="none";var n=t&&t.type===B1?this._domEdit:this.domElement;setTimeout(function(){return n.focus()},100),this.onOpen&&this.onOpen(this.colour)}}},{key:"closeHandler",value:function(t){var n=t&&t.type,s=!1;if(!t)s=!0;else if(n===Pl||n===yu){var r=(this.__containedEvent||0)+100;t.timeStamp>r&&(s=!0)}else $1(t),s=!0;s&&this.hide()&&(this.settings.parent.style.pointerEvents="",n!==Pl&&this.settings.parent.focus(),this.onClose&&this.onClose(this.colour))}},{key:"movePopup",value:function(t,n){this.closeHandler(),this.setOptions(t),n&&this.openHandler()}},{key:"setColor",value:function(t,n){this._setColor(t,{silent:n})}},{key:"_setColor",value:function(t,n){if(typeof t=="string"&&(t=t.trim()),!!t){n=n||{};var s=void 0;try{s=new Vk(t)}catch(o){if(n.failSilently)return;throw o}if(!this.settings.alpha){var r=s.hsla;r[3]=1,s.hsla=r}this.colour=this.color=s,this._setHSLA(null,null,null,null,n)}}},{key:"setColour",value:function(t,n){this.setColor(t,n)}},{key:"show",value:function(){var t=this.settings.parent;if(!t)return!1;if(this.domElement){var n=this._toggleDOM(!0);return this._setPosition(),n}var s=this.settings.template||'<div class="picker_wrapper" tabindex="-1"><div class="picker_arrow"></div><div class="picker_hue picker_slider"><div class="picker_selector"></div></div><div class="picker_sl"><div class="picker_selector"></div></div><div class="picker_alpha picker_slider"><div class="picker_selector"></div></div><div class="picker_editor"><input aria-label="Type a color name or hex value"/></div><div class="picker_sample"></div><div class="picker_done"><button>Ok</button></div><div class="picker_cancel"><button>Cancel</button></div></div>',r=Yk(s);return this.domElement=r,this._domH=en(".picker_hue",r),this._domSL=en(".picker_sl",r),this._domA=en(".picker_alpha",r),this._domEdit=en(".picker_editor input",r),this._domSample=en(".picker_sample",r),this._domOkay=en(".picker_done button",r),this._domCancel=en(".picker_cancel button",r),r.classList.add("layout_"+this.settings.layout),this.settings.alpha||r.classList.add("no_alpha"),this.settings.editor||r.classList.add("no_editor"),this.settings.cancelButton||r.classList.add("no_cancel"),this._ifPopup(function(){return r.classList.add("popup")}),this._setPosition(),this.colour?this._updateUI():this._setColor(this.settings.defaultColor),this._bindEvents(),!0}},{key:"hide",value:function(){return this._toggleDOM(!1)}},{key:"destroy",value:function(){this._events.destroy(),this.domElement&&this.settings.parent.removeChild(this.domElement)}},{key:"_bindEvents",value:function(){var t=this,n=this,s=this.domElement,r=this._events;function o(h,c,u){r.add(h,c,u)}o(s,"click",function(h){return h.preventDefault()}),mu(r,this._domH,function(h,c){return n._setHSLA(h)}),mu(r,this._domSL,function(h,c){return n._setHSLA(null,h,1-c)}),this.settings.alpha&&mu(r,this._domA,function(h,c){return n._setHSLA(null,null,null,1-c)});var a=this._domEdit;o(a,"input",function(h){n._setColor(this.value,{fromEditor:!0,failSilently:!0})}),o(a,"focus",function(h){var c=this;c.selectionStart===c.selectionEnd&&c.select()}),this._ifPopup(function(){var h=function(d){return t.closeHandler(d)};o(window,Pl,h),o(window,yu,h),_u(r,s,["Esc","Escape"],h);var c=function(d){t.__containedEvent=d.timeStamp};o(s,Pl,c),o(s,yu,c),o(t._domCancel,"click",h)});var l=function(c){t._ifPopup(function(){return t.closeHandler(c)}),t.onDone&&t.onDone(t.colour)};o(this._domOkay,"click",l),_u(r,s,["Enter"],l)}},{key:"_setPosition",value:function(){var t=this.settings.parent,n=this.domElement;t!==n.parentNode&&t.appendChild(n),this._ifPopup(function(s){getComputedStyle(t).position==="static"&&(t.style.position="relative");var r=s===!0?"popup_right":"popup_"+s;["popup_top","popup_bottom","popup_left","popup_right"].forEach(function(o){o===r?n.classList.add(o):n.classList.remove(o)}),n.classList.add(r)})}},{key:"_setHSLA",value:function(t,n,s,r,o){o=o||{};var a=this.colour,l=a.hsla;[t,n,s,r].forEach(function(h,c){(h||h===0)&&(l[c]=h)}),a.hsla=l,this._updateUI(o),this.onChange&&!o.silent&&this.onChange(a)}},{key:"_updateUI",value:function(t){if(!this.domElement)return;t=t||{};var n=this.colour,s=n.hsla,r="hsl("+s[0]*Zk+", 100%, 50%)",o=n.hslString,a=n.hslaString,l=this._domH,h=this._domSL,c=this._domA,u=en(".picker_selector",l),d=en(".picker_selector",h),f=en(".picker_selector",c);function g(E,M,C){M.style.left=C*100+"%"}function p(E,M,C){M.style.top=C*100+"%"}g(l,u,s[0]),this._domSL.style.backgroundColor=this._domH.style.color=r,g(h,d,s[1]),p(h,d,1-s[2]),h.style.color=o,p(c,f,1-s[3]);var m=o,_=m.replace("hsl","hsla").replace(")",", 0)"),y="linear-gradient("+[m,_]+")";if(this._domA.style.background=y+", "+Hk,!t.fromEditor){var x=this.settings.editorFormat,w=this.settings.alpha,b=void 0;switch(x){case"rgb":b=n.printRGB(w);break;case"hsl":b=n.printHSL(w);break;default:b=n.printHex(w)}this._domEdit.value=b}this._domSample.style.color=a}},{key:"_ifPopup",value:function(t,n){this.settings.parent&&this.settings.popup?t&&t(this.settings.popup):n&&n()}},{key:"_toggleDOM",value:function(t){var n=this.domElement;if(!n)return!1;var s=t?"":"none",r=n.style.display!==s;return r&&(n.style.display=s),r}}]),i}();class Kk extends Ec{constructor(){super("redlining");v(this,"template",()=>Ee`<style>
:host,
#panel {
  min-width: 18rem;
}

#panel {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: visible;
}

#gutter {
  border: none;
  width: 6px;
  height: 100%;
  background: var(--bkg-color);
  position: absolute;
  top: 0;
  left: 0;
  cursor: col-resize;
}

#close {
  border: solid 1px var(--text-color-grad1);
  border-right: none;
  color: var(--text-color-grad1);
  padding: 0.7rem 0 0.7rem 0.5rem;
  border-radius: 10px 0 0 10px;
  width: 0.8rem;
  height: 2rem;
  line-height: 2rem;
  position: fixed;
  top: 5.8rem;
  right: 20rem;
  background-color: var(--bkg-color);
  cursor: pointer;
}

#close i:before {
  content: '\uf00d';
}

#close:hover {
  border-color: var(--text-color);
  color: var(--text-color);
}

#content {
  position: absolute;
  top: 0;
  left: 6px;
  right: 0;
  bottom: 0;
  background: var(--bkg-color);
  padding: 1.5rem;
  margin: 0;
  overflow: visible;
}

#content button {
  border: solid 1px var(--bkg-color);
  color: var(--text-color-grad2);
  height: 2.4rem;
  width: 2.4rem;
  text-align: left;
  padding: 0;
  padding-left: 0.5rem;
  background-color: var(--bkg-color);
  cursor: pointer;
}

#content button:hover {
  border: solid 1px var(--text-color-grad2);
}

#content button.selected {
  border: solid 1px var(--text-color-grad2);
  background-color: var(--text-color-grad2);
  color: var(--bkg-color);
}

#drawingList {
  min-height: 5rem;
  background-color: var(--bkg-color);
  padding-top: 2rem;
  margin-right: 1rem;
}

#drawingList div.girafe {
  display: inline-block;
  position: relative;
  padding: 0.5rem;
  margin-top: 0.1rem;
  margin-right: 0.1rem;
  border: solid 1px var(--text-color);
  text-align: left;
  width: 100%;
  max-width: 16rem;
  min-width: 13rem;
  color: var(--text-color-grad2);
}

#drawingList div.girafe:hover {
  color: var(--text-color);
}

#drawingList input.name {
  display: block;
  border: none;
}

#drawingList i {
  position: relative;
  cursor: pointer;
  margin-right: 1rem;
  display: inline;
}

#drawingList .text-opts {
  position: absolute;
  right: 0;
  top: 0.5rem;
}

input.slider {
  position: relative;
  width: 6rem;
  display: inline-block;
  vertical-align: middle;
  margin-right: 1rem;
}

</style>
<link rel="stylesheet" href="lib/font-gis/css/font-gis.css" />
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />
<link rel="stylesheet" href="lib/vanilla-picker/vanilla-picker.csp.css" />

<div id="panel">
  <div id="gutter"></div>
  <div id="close">
    <i class="fa-solid"></i>
  </div>
  <div id="content">
    <button id="disable" tip="Disable drawing" class="selected">
      <i class="fg-arrow-o fg-lg"></i>
    </button>
    <button id="point" tip="Point">
      <i class="fg-point fg-lg"></i>
    </button>
    <button id="line" tip="Line">
      <i class="fg-polyline-pt fg-lg"></i>
    </button>
    <button id="polygon" tip="Polygon">
      <i class="fg-polygon-pt fg-lg"></i>
    </button>
    <button id="square" tip="Square">
      <i class="fg-square-pt fg-lg"></i>
    </button>
    <button id="rectangle" tip="Rectangle">
      <i class="fg-rectangle-pt fg-lg"></i>
    </button>
    <button id="circle" tip="Circle">
      <i class="fg-circle-o fg-lg"></i>
    </button>
    <button id="freeline" tip="Freehand line">
      <i class="fg-polyline fg-lg"></i>
    </button>
    <button id="freepolygon" tip="Freehand polygon">
      <i class="fg-polygon-o fg-lg"></i>
    </button>
    <button id="undo" tip="Undo">
      <i class="fg-help-larrow fg-lg"></i>
    </button>
    <div id="drawingList"></div>
  </div>
</div>
`);v(this,"panel",null);v(this,"disableButton",null);v(this,"pointButton",null);v(this,"lineButton",null);v(this,"squareButton",null);v(this,"rectangleButton",null);v(this,"polygonButton",null);v(this,"circleButton",null);v(this,"freelineButton",null);v(this,"freepolygonButton",null);v(this,"undoButton",null);v(this,"toolSelected",null);v(this,"drawingList",null)}render(){super.render(),this.panel=this.shadow.querySelector("#panel"),this.panel.style.display="none",this.disableButton=this.shadow.querySelector("#disable"),this.pointButton=this.shadow.querySelector("#point"),this.lineButton=this.shadow.querySelector("#line"),this.squareButton=this.shadow.querySelector("#square"),this.rectangleButton=this.shadow.querySelector("#rectangle"),this.polygonButton=this.shadow.querySelector("#polygon"),this.circleButton=this.shadow.querySelector("#circle"),this.freelineButton=this.shadow.querySelector("#freeline"),this.freepolygonButton=this.shadow.querySelector("#freepolygon"),this.undoButton=this.shadow.querySelector("#undo"),this.drawingList=this.shadow.querySelector("#drawingList"),this.toolSelected=this.disableButton,this.activateTooltips(!1,[800,0],"top-end")}registerEvents(){this.stateManager.subscribe("interface.redliningPanelVisible",(t,n)=>this.togglePanel(n)),this.stateManager.subscribe("redlining.features",(t,n)=>this.onFeaturesChanged(t,n)),this.disableButton.addEventListener("click",t=>this.deactivateDraw(t)),this.pointButton.addEventListener("click",t=>this.activateDraw(t,"Point")),this.lineButton.addEventListener("click",t=>this.activateDraw(t,"LineString")),this.squareButton.addEventListener("click",t=>this.activateDraw(t,"Square")),this.rectangleButton.addEventListener("click",t=>this.activateDraw(t,"Rectangle")),this.polygonButton.addEventListener("click",t=>this.activateDraw(t,"Polygon")),this.circleButton.addEventListener("click",t=>this.activateDraw(t,"Circle")),this.freelineButton.addEventListener("click",t=>this.activateDraw(t,"Freeline")),this.freepolygonButton.addEventListener("click",t=>this.activateDraw(t,"Freepolygon")),this.undoButton.addEventListener("click",()=>this.messageManager.sendMessage({action:qs.undoDraw}))}activateDraw(t,n){this.toolSelected!==null&&(this.toolSelected.className=""),this.toolSelected=t.target.parentElement,this.toolSelected.className="selected",this.state.redlining.activeTool=n}deactivateDraw(t){this.toolSelected!==null&&(this.toolSelected.className=""),this.toolSelected=t.target.parentElement,this.toolSelected.className="selected",this.state.redlining.activeTool=null}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}closePanel(){this.state.interface.redliningPanelVisible=!1}togglePanel(t){t?(this.panel.style.display="block",this.panel.getRootNode().host.style.display="block"):(this.panel.style.display="none",this.panel.getRootNode().host.style.display="none")}onFeaturesChanged(t,n){const s=t.filter(o=>!n.find(a=>a.id===o.id)),r=n.filter(o=>!t.find(a=>a.id===o.id));s.forEach(o=>{this.removeFeatureFromList(o)}),r.forEach(o=>{this.addFeatureToList(o)})}addFeatureToList(t){const n="f-"+t.id,s=document.createElement("div");s.className="girafe",s.id=n;const r=document.createElement("input");r.type="text",r.value=t.name,r.className="name",r.oninput=_=>{const y=this.state.redlining.features.find(x=>x.id===t.id);y.name=_.target.value},s.appendChild(r);const o=document.createElement("div");o.className="text-opts";const a=document.createElement("i");a.className="fa-solid fa-minus",a.onclick=()=>{const _=this.state.redlining.features.find(y=>y.id===t.id);_.textSize=_.textSize-1},o.appendChild(a);const l=document.createElement("i");l.className="fa-solid fa-plus",l.onclick=()=>{const _=this.state.redlining.features.find(y=>y.id===t.id);_.textSize=_.textSize+1},o.appendChild(l),s.appendChild(o);const h=document.createElement("i");h.className="fa-solid fa-paint-roller",s.appendChild(h);const c=this.isNullOrUndefined(t.fillColor)?this.configManager.Config.redlining.defaultFillColor:t.fillColor,u=new Vm({parent:h,color:c,popup:"left"});u.onChange=_=>{const y=this.state.redlining.features.find(x=>x.id===t.id);y.fillColor=_.hex},u.onDone=_=>{const y=this.state.redlining.features.find(x=>x.id===t.id);y.fillColor=_.hex};const d=document.createElement("i");d.className="fa-solid fa-paintbrush",s.appendChild(d);const f=this.isNullOrUndefined(t.strokeColor)?this.configManager.Config.redlining.defaultStrokeColor:t.fillColor,g=new Vm({parent:d,color:f,popup:"left"});g.onChange=_=>{const y=this.state.redlining.features.find(x=>x.id===t.id);y.strokeColor=_.hex},g.onDone=_=>{const y=this.state.redlining.features.find(x=>x.id===t.id);y.strokeColor=_.hex};const p=document.createElement("input");p.type="range",p.className="slider",p.min=0,p.max=10,p.value=this.isNullOrUndefined(t.strokeWidth)?this.configManager.Config.redlining.defaultStrokeWidth:t.strokeWidth,p.oninput=_=>{const y=this.state.redlining.features.find(x=>x.id===t.id);y.strokeWidth=_.target.value},s.appendChild(p);const m=document.createElement("i");m.className="fa-solid fa-trash",m.onclick=_=>this.deleteFeature(t),s.appendChild(m),this.drawingList.appendChild(s)}removeFeatureFromList(t){const n="f-"+t.id;this.shadow.getElementById(n).remove()}deleteFeature(t){confirm("Do you want to delete this feature?")&&(this.state.redlining.features=this.state.redlining.features.filter(n=>n.id!=t.id))}}class Jk extends at{constructor(){super("scale");v(this,"template",()=>Ee`<style>
#content {
  background: var(--t-bkg);
  color: var(--text-color);
  width: fit-content;
  white-space: nowrap;
  padding: 0 0.5rem;
  font-size: 1rem;
}

label:after {
  content: ':';
  height: 2.3rem;
  line-height: 2.3rem;
}

span {
  font-weight: bold;
  height: 2.3rem;
  line-height: 2.3rem;
}

girafe-menu-button {
  display: inline-block;
}

#container {
  display: inline-flex;
  flex-direction: column;
  width: max-content;
}

</style>
<div id="content">
  <label for="scale" i18n="scale">Scale</label>
  <span id="scale"></span>
  <girafe-menu-button icon-style="fa-sm fa-solid fa-caret-up" size="small" open="up" class="transparent">
    <div slot="menu-content">
      <div id="container"></div>
    </div>
  </girafe-menu-button>
</div>
`);v(this,"scaleSpan",null);v(this,"locale",null);v(this,"container",null);v(this,"scales",null)}render(){super.render(),this.container=this.shadow.querySelector("#container"),this.scaleSpan=this.shadow.querySelector("#scale"),this.locale=this.configManager.Config.general.locale,this.scales=this.configManager.Config.map.scales,this.scales.forEach(t=>{const n=new Yy;n.setAttribute("text",this.formatScale(t)),n.setAttribute("size","large"),n.setAttribute("state-action","position.scale"),n.dataset.value=t,this.container.appendChild(n)})}registerEvents(){this.stateManager.subscribe("position",()=>this.onScaleChanged())}onScaleChanged(){this.state.position.scale!==null?this.scaleSpan.innerHTML=this.formatScale(this.state.position.scale):this.scaleSpan.innerHTML=""}formatScale(t){return"1:"+Math.floor(t).toLocaleString(this.locale)}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}}var Zr,Kr;class Qk extends at{constructor(){super("search");v(this,"template",()=>Ee`<style>
#searchbox {
  background-color: var(--bkg-color);
  border-right: none;
  height: 2.5rem;
  border-radius: 6px;
  border: none;
  width: 100%;
  display: flex;
  flex-direction: row;
  box-shadow: var(--bx-shdw);
}

#search {
  font-size: 1rem;
  outline: none;
  margin: 0 0 0 0.5rem;
  padding-left: 0.8rem;
  border: 0;
  height: 2.2rem;
  width: auto;
  flex: 1 1 auto;
  -ms-flex: 1 1 auto;
  -webkit-flex: 1 1 auto;
  -webkit-appearance: none;
  background: transparent;
  color: var(--text-color);
}

#searchIcon {
  display: inline-block;
  width: 20px;
  height: 25px;
  color: var(--text-color);
  background-position: -121px 1px;
  padding: 9px 10px;
  background-repeat: no-repeat;
  background-clip: content-box;
  background-origin: content-box;
  -moz-background-clip: content-box;
  -moz-background-origin: content-box;
  -webkit-background-clip: content-box;
  -webkit-background-origin: content-box;
}

#results {
  z-index: 1000;
  margin-top: 0.1rem;
  margin-bottom: 0.5rem;
  position: absolute;
  top: 3.5rem;
  width: 36rem;
  max-height: 31rem;
  background-color: var(--bkg-color);
  overflow-x: hidden;
  scrollbar-width: thin;
}

.result,
.title {
  display: inline-block;
  padding: 0.3rem 1rem;
  width: Calc(36rem - 2rem);
  border-top: solid 1px #ccc;
  line-height: 1.3rem;
}

.title {
  background-color: #555;
  color: var(--text-color);
  font-weight: 600;
  line-height: 2.5rem;
  font-size: 1.2rem;
}

.result {
  cursor: pointer;
}

.title i {
  margin-right: 1rem;
}

.result:hover {
  background-color: #aaa;
  color: var(--text-color);
}

</style>
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />

<div id="searchbox">
  <input
    id="search"
    length="20"
    maxlength="1000"
    autocomplete="off"
    autocorrect="off"
    i18n="Search"
    placeholder="Search..." />
  <a id="searchIcon" href="#" title="Geogirafe search"><i class="fa-solid fa-magnifying-glass"></i></a>
  <div id="results"></div>
</div>
`);re(this,Zr,void 0);re(this,Kr,void 0);v(this,"ignoreBlur",!1);v(this,"resultList",[]);v(this,"searchTermPlaceholder","###SEARCHTERM###");v(this,"initialSearchBoxHeight",this.convertRemToPixels(2.5))}get searchBox(){if(!Z(this,Zr))throw new Error("You called searchBox before render");return Z(this,Zr)}get resultsBox(){if(!Z(this,Kr))throw new Error("You called resultsBox before render");return Z(this,Kr)}render(){super.render(),Ke(this,Zr,this.shadow.querySelector("#searchbox")),Ke(this,Kr,this.shadow.querySelector("#results"))}registerEvents(){this.searchBox.addEventListener("input",t=>this.doSearch(t)),this.searchBox.addEventListener("focusin",t=>this.onFocusIn()),this.searchBox.addEventListener("focusout",t=>this.onFocusOut())}onFocusIn(){this.ignoreBlur=!1,this.resultsBox.style.display="block",this.setSearchBoxHeight(this.initialSearchBoxHeight+this.resultsBox.offsetHeight+20)}onFocusOut(){this.ignoreBlur||(this.resultsBox.style.display="none",this.setSearchBoxHeight(this.initialSearchBoxHeight))}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}clearSearch(){this.resultList=[],this.resultsBox.innerHTML="",this.setSearchBoxHeight(this.initialSearchBoxHeight)}doSearch(t){const n=t.target;if(n){const s=n.value;if(s.length<=0){this.clearSearch();return}const r=this.configManager.Config.search.url.replace(this.searchTermPlaceholder,s);fetch(r).then(o=>o.json()).then(o=>this.displayResults(o))}}displayResults(t){const n={};t.features.forEach(s=>{const r=s.properties?s.properties.layer_name:"ERROR: Missing type in the search result";r in n?this.resultList=n[r]:(this.resultList=[],n[r]=this.resultList),this.resultList.push(s)}),this.clearSearch();for(const s in n){const r=document.createElement("div");r.className="title";const o=document.createElement("i");o.className=this.getIconClassName(s),r.appendChild(o);const a=document.createElement("span");a.innerHTML=s,r.appendChild(a),this.resultsBox.appendChild(r),n[s].forEach(l=>{const h=document.createElement("div");h.className="result",this.resultList.push(l),h.dataset.resultId=String(this.resultList.length-1),h.onmousedown=()=>{this.ignoreBlur=!0},h.onclick=u=>{this.ignoreBlur=!1,this.onSelect(u)};const c=document.createElement("span");c.innerHTML=l.properties?l.properties.label:"ERROR: No property for thie searchresult !",h.appendChild(c),this.resultsBox.appendChild(h)})}this.setSearchBoxHeight(this.initialSearchBoxHeight+this.resultsBox.offsetHeight+20)}getIconClassName(t){switch(t){case"Adresse":return"fa-solid fa-location-dot";case"Basel Info (BI)":return"fa-solid fa-map-location-dot";case"Baumnummer ffentlicher Baumkataster":return"fa-solid fa-tree";case"Entsorgungsstellen":return"fa-solid fa-recycle";case"Haltestelle ffentlicher Verkehr":return"fa-solid fa-train-subway";case"Group":return"fa-solid fa-layer-group";case"Layer":return"fa-solid fa-map";default:return"fa-solid fa-globe"}}setSearchBoxHeight(t){this.searchBox.style.height=t+"px"}onSelect(t){const n=t.target;if(n){const s=super.getParentOfType("DIV",n),r=this.resultList[parseInt(s.dataset.resultId)];r.bbox?this.zoomTo(r.bbox):console.warn("No BBOX found for this search result"),this.onFocusOut()}}zoomTo(t){const n=Math.max(Re(t)*50/100,_t(t)*50/100),s=Vi(t,n);this.messageManager.sendMessage({action:qs.zoomToExtent,extent:s})}attributeChangedCallback(t,n,s,r){console.log("attributeChangedCallback")}convertRemToPixels(t){return t*parseFloat(getComputedStyle(document.documentElement).fontSize)}}Zr=new WeakMap,Kr=new WeakMap;class eO extends Ec{constructor(){super("selectiongrid");v(this,"template",()=>Ee`<style>
:host,
#panel {
  min-height: 10rem;
  height: 16rem;
  background: var(--bkg-color);
}

#panel {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
}

#gutter {
  border: none;
  height: 6px;
  width: 100%;
  background: var(--bkg-color);
  position: absolute;
  top: 0;
  left: 0;
  cursor: row-resize;
}

#close {
  border: none;
  color: #777;
  padding: 0;
  margin: 0.5rem;
  width: 1rem;
  height: 1rem;
  line-height: 1rem;
  position: absolute;
  top: 0;
  right: 0;
  background-color: var(--bkg-color);
  cursor: pointer;
}

#close i:before {
  content: '\uf00d';
}

#close:hover {
  border-color: #000;
  color: #000;
}

#content {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--bkg-color);
  padding: 0;
  margin: 0.5rem;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

#header {
  flex: 0;
}

.tab {
  border: solid 1px #ccc;
  display: inline-block;
  height: 2rem;
  line-height: 2rem;
  padding: 0 1rem;
  margin-right: 0.2rem;
  margin-bottom: 0.2rem;
  cursor: pointer;
  background-color: var(--bkg-color-grad2);
}

.tab.active {
  color: var(--text-color);
  background-color: var(--bkg-color);
}

#grid {
  overflow: hidden;
  flex: 1;
}

.gridjs-wrapper {
  overflow-x: hidden !important;
  height: 100% !important;
  width: 100% !important;
}

.gridjs-container {
  height: 100%;
  width: 100%;
}

.geo-type {
  margin-right: 0.5rem;
}

girafe-button {
  float: right;
  margin-left: 0.5rem;
  margin-top: 0.2rem;
}

::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-thumb {
  background: #999;
}

.gridjs-table {
  background-color: var(--bkg-color) !important;
  color: var(--text-color);
}

td.gridjs-td {
  background-color: var(--bkg-color) !important;
}

th.gridjs-th {
  color: var(--text-color-grad2);
  background-color: var(--bkg-color-grad2) !important;
}

.gridjs-th-content {
  color: var(--text-color) !important;
}

</style>
<link rel="stylesheet" href="lib/gridjs/mermaid.min.css" />
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />
<link rel="stylesheet" href="lib/font-gis/css/font-gis.css" />

<div id="panel">
  <div id="content">
    <div id="header"></div>
    <div id="grid"></div>
  </div>
  <div id="gutter"></div>
  <div id="close">
    <i class="fa-solid"></i>
  </div>
</div>
`);v(this,"locale",null);v(this,"panel",null);v(this,"content",null);v(this,"header",null);v(this,"grid",null);v(this,"activeTab",null);v(this,"typeToFeatures",{})}render(){super.render(),this.panel=this.shadow.querySelector("#panel"),this.content=this.shadow.querySelector("#content"),this.header=this.shadow.querySelector("#header"),this.grid=this.shadow.querySelector("#grid"),this.panel.style.display="none",this.locale=this.configManager.Config.general.locale,this.activateTooltips(!1,[800,0],"top-end")}registerEvents(){this.stateManager.subscribe("selection.selectedFeatures",(t,n)=>this.onFeaturesSelected(n)),this.stateManager.subscribe("interface.selectionGridVisible",(t,n)=>this.togglePanel(n))}onFeaturesSelected(t){if(this.header.innerHTML="",!(this.isNullOrUndefined(t)||t.length<=0)){this.typeToFeatures={};for(const n of t){const s=n.getId(),r=s===void 0?"UNKNOWN":s.split(".")[0];if(!(r in this.typeToFeatures)){const l=[];for(const h in n.getProperties())if(h!=="boundedBy"){const c={id:h,name:Xl.getInstance().getTranslation(h),formatter:this.formatCell.bind(this)};l.push(c)}this.typeToFeatures[r]={columns:l,data:[],features:[]}}this.typeToFeatures[r].features.push(n);const o=[],a=n.getProperties();for(const l of this.typeToFeatures[r].columns){const h=a[l.id];if(h instanceof sc){const c=this.getGeometryIcons(h);o.push(c)}else o.push(h)}this.typeToFeatures[r].data.push(o)}for(const[n,s]of Object.entries(this.typeToFeatures)){const r=document.createElement("a");r.text=Xl.getInstance().getTranslation(n),r.className="tab",r.id=n,r.onclick=()=>{this.displayGrid(n)},this.header.append(r)}this.displayGrid(Object.keys(this.typeToFeatures)[0])}}getGeometryIcons(t){let n,s;if(t instanceof Ai){n='<i class="geo-type fg-point fg-lg"></i>',s=t.getFlatCoordinates();const r=Hu(s);n+=`<span>E ${r[0]} / N ${r[1]}</span>`}else if(t instanceof mo)if(n='<i class="geo-type fg-multipoint fg-lg"></i>',t.getPoints.length===1){s=t.getPoint(0).getFlatCoordinates();const r=Hu(s);n+=`<span>E ${r[0]} / N ${r[1]}</span>`}else s=pi(t.getExtent()),n+="<span>Multipoint</span>";else if(t instanceof Yi||t instanceof Ks){n='<i class="geo-type fg-polyline-pt fg-lg"></i>';const r=(Math.round(t.getLength()*100)/100).toLocaleString(this.locale,{minimumFractionDigits:2});n+=`<span>${r}&nbsp;m</span>`,s=pi(t.getExtent())}else if(t instanceof Zi||t instanceof Js){n='<i class="geo-type fg-polygon-pt fg-lg"></i>';const r=(Math.round(t.getArea()*100)/100).toLocaleString(this.locale,{minimumFractionDigits:2});n+=`<span>${r}&nbsp;m<sup>2</sup></span>`,s=pi(t.getExtent())}else{console.error("Unknown geometry type",t.getType());return}return n+=`<girafe-button icon-style="fa-sm fa-solid fa-magnifying-glass" 
                             size="extra-small" tip="Pan to geometry" tip-placement="right" 
                             class="transparent" 
                             state-action="position.center" 
                             data-value="[${s[0]},${s[1]}]"></girafe-button>`,n}formatCell(t,n,s){if(!this.isNullOrUndefinedOrBlank(t)){const r=t.toLowerCase();if(r.includes("<a")&&r.includes("href")||r.includes("<img")&&r.includes("src")||r.includes("<girafe-button")||r.includes("<i")&&r.includes("class"))return W1(t)}return t}searchGrid(t,n,s){console.log("SEARCH")}displayGrid(t){this.grid.innerHTML="";const n=this.typeToFeatures[t];new V1({columns:n.columns,sort:!0,fixedHeader:!0,data:n.data,resizable:!0,style:{th:{padding:"6px 10px"},td:{padding:"6px 10px"}}}).render(this.grid).forceRender(),this.activateTooltips(!1,[800,0],"top-end");const s=this.shadow.getElementById(t);s.classList.add("active"),this.activeTab!==null&&this.activeTab.classList.remove("active"),this.activeTab=s}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}closePanel(){this.state.interface.selectionGridVisible=!1,this.state.selection.selectedFeatures=null}togglePanel(t){t?(this.panel.style.display="block",this.panel.getRootNode().host.style.display="block"):(this.panel.style.display="none",this.panel.getRootNode().host.style.display="none")}}class tO extends Xy{constructor(){super("selectionwindow");v(this,"template",()=>Ee`<style>
#draggable {
  border: solid 1px #666;
  border-radius: 3px;
  box-shadow:
    0 1px 2px rgba(60, 64, 67, 0.3),
    0 1px 3px 1px rgba(60, 64, 67, 0.15);
  background: var(--bkg-color);
}

#header {
  padding: 0.5rem;
  cursor: move;
  z-index: 10;
  background-color: #666;
  color: var(--text-color);
  text-align: center;
}

#content {
  padding: 1rem 2rem;
  width: 26rem;
  height: 12rem;
  overflow-y: auto;
  scrollbar-width: thin;
}

table {
  border-collapse: collapse;
  width: 100%;
}

td.label {
  text-align: right;
  padding-right: 1rem;
  color: #666;
  width: 8rem;
  vertical-align: top;
}

td.label:after {
  content: ' :';
}

#footer {
  color: #aaa;
  height: 2rem;
  border-top: solid 1px #999;
}

#previous {
  padding: 0.5rem;
  cursor: pointer;
  position: absolute;
  left: 0;
  bottom: 0;
}

#next {
  padding: 0.5rem;
  cursor: pointer;
  position: absolute;
  right: 0;
  bottom: 0;
}

#counter {
  line-height: 2rem;
  text-align: center;
  margin-top: 0;
}

</style>
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />

<div id="draggable">
  <div id="header">HEADER</div>
  <div id="content"></div>
  <div id="footer">
    <a id="previous"><i class="fa-solid fa-xl fa-circle-arrow-left"></i></a>
    <a id="next"><i class="fa-solid fa-xl fa-circle-arrow-right"></i></a>
    <p id="counter">1/5</p>
  </div>
</div>
`);v(this,"maxFeatures",200);v(this,"focusedIndex",0);v(this,"content",null);v(this,"previousButton",null);v(this,"nextButton",null);v(this,"counter",null)}render(){super.render(),this.content=this.shadow.querySelector("#content"),this.previousButton=this.shadow.querySelector("#previous"),this.nextButton=this.shadow.querySelector("#next"),this.counterText=this.shadow.querySelector("#counter")}registerEvents(){this.previousButton.addEventListener("click",()=>this.onFocusFeature(this.focusedIndex-1)),this.nextButton.addEventListener("click",()=>this.onFocusFeature(this.focusedIndex+1))}onFocusFeature(t){this.focusedIndex=t,this.state.selection.focusedFeature=this.state.selection.selectedFeatures[t];const n=this.state.selection.focusedFeature.getId(),s=n===void 0?"UNKNOWN":n.split(".")[0];this.header.setAttribute("i18n",s);const r=this.state.selection.focusedFeature.getProperties(),o=document.createElement("table");for(const a in r)if(a!=="boundedBy"&&a!=="the_geom"){const l=document.createElement("tr"),h=document.createElement("td");h.className="label",h.setAttribute("i18n",a),l.appendChild(h);const c=document.createElement("td");c.className="value",c.innerHTML=r[a],l.appendChild(c),o.appendChild(l)}this.content.innerHTML="",this.content.appendChild(o),this.enableNavigationButtons(),super.girafeTranslate()}enableNavigationButtons(){let t="block",n="block";this.focusedIndex===0&&(t="none"),this.focusedIndex===this.state.selection.selectedFeatures.length-1&&(n="none"),this.previousButton.style.display=t,this.nextButton.style.display=n,this.state.selection.selectedFeatures.length===1?this.counterText.innerHTML="":this.counterText.innerHTML=this.focusedIndex+1+"/"+this.state.selection.selectedFeatures.length}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.makeDraggable(),this.registerEvents()})}}var Jr,Qr;class iO extends at{constructor(){super("themes");v(this,"template",()=>Ee`<style>
#themes {
  display: none;
  width: 50rem;
  margin-top: 0;
  overflow-y: auto;
  max-height: 70vh;
  scrollbar-width: thin;
  background: var(--bkg-color);
}

button {
  border: none;
  width: 4rem;
  height: 4.6rem;
  background-color: #444;
  color: #fff;
  padding: 0.5rem;
  cursor: pointer;
}

div.hidden {
  display: none;
}

button:hover {
  background-color: #000;
}

ul {
  border: solid 1px #444;
  border-radius: 3px;
  padding: 1rem;
  background-color: var(--bkg-color);
}

ul div {
  display: inline-block;
  width: 9rem;
  cursor: pointer;
  margin: 0.5rem;
}

ul div img {
  width: 9rem;
}

ul div span {
  display: inline-block;
  width: 9rem;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

</style>
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />

<button title="Theme Selection" onclick="${()=>this.toggleThemesList()}" onblur="${()=>this.onBlur()}">
  <div class="${this.state.loading?"hidden":""}">
    <i class="fa-2x fa-solid fa-layer-group"></i>
  </div>
  <div class="${this.state.loading?"":"hidden"}">
    <i class="fa-2x fa-solid fa-circle-notch fa-spin"></i>
  </div>
</button>
<ul id="themes">
  ${Object.values(this.state.themes??{}).map(t=>Ee.for(t)`
  <div onmousedown="${()=>this.ignoreBlur()}" onclick="${()=>this.onThemeChanged(t)}">
    <img alt="${"Icon for "+t.name}" src="${t.icon}" />
    <span i18n="${t.name}">${t.name}</span>
  </div>
  `)}
</ul>
`);re(this,Jr,void 0);re(this,Qr,!1)}get themesList(){if(!Z(this,Jr))throw new Error("You called themesList before render");return Z(this,Jr)}render(){super.render(),Ke(this,Jr,this.shadow.querySelector("#themes")),this.toggleThemesList(!1)}registerEvents(){this.stateManager.subscribe("loading",()=>super.render()),this.stateManager.subscribe("themes",()=>{super.render(),super.girafeTranslate()})}onBlur(){Z(this,Qr)||this.toggleThemesList(!1)}toggleThemesList(t=null){t===!0?this.themesList.style.display="block":t===!1?this.themesList.style.display="none":this.themesList.style.display==="none"?this.themesList.style.display="block":this.themesList.style.display="none"}ignoreBlur(){Ke(this,Qr,!0)}onThemeChanged(t){var n,s,r;this.state.selectedTheme=t,this.toggleThemesList(!1),Ke(this,Qr,!1),(t.location!=null||t.zoom!=null)&&((r=this.state.olMap)==null||r.getView().animate({center:t.location??((n=this.state.olMap)==null?void 0:n.getView().getCenter()),zoom:t.zoom??((s=this.state.olMap)==null?void 0:s.getView().getZoom()),duration:1e3}))}connectedCallback(){this.loadConfig().then(()=>{this.render(),this.registerEvents()})}}Jr=new WeakMap,Qr=new WeakMap;var Ea,vd,Ma,xd;class nO extends Ec{constructor(){super("treeview");re(this,Ea);re(this,Ma);v(this,"template",()=>Ee`<style>
:host {
  min-width: 18rem;
}

::-webkit-scrollbar {
  width: 5px;
}

::-webkit-scrollbar-thumb {
  background: #999;
}

.hidden {
  display: none;
}

.panel {
  min-width: 18rem;
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
}

.gutter {
  border: none;
  width: 5px;
  height: 100%;
  background: var(--bkg-color);
  position: absolute;
  top: 0;
  right: 0;
  cursor: col-resize;
}

.hide {
  border: solid 1px #999;
  border-left: none;
  color: var(--text-color-grad2);
  padding: 0.7rem 0.5rem 0.7rem 0;
  border-radius: 0 10px 10px 0;
  width: 0.8rem;
  height: 2rem;
  line-height: 2rem;
  position: fixed;
  top: 5.8rem;
  left: 25rem;
  background-color: var(--bkg-color);
  cursor: pointer;
}

.hide i:before {
  content: '\uf104';
}

.hide.closed {
  left: 5px !important;
}

.hide.closed i:before {
  content: '\uf105';
}

.hide:hover {
  border-color: #000;
  color: var(--text-color);
}

.menu {
  border-top: solid 1px #bbb;
  background-color: var(--bkg-color);
  height: 2.3rem;
  position: absolute;
  bottom: 0;
  left: 0;
  right: 6px;
  z-index: 1;
  font-size: 0;
}

.treeview-list {
  position: absolute;
  top: 0;
  left: 0;
  right: 5px;
  bottom: 2.3rem;
  background: var(--bkg-color);
  padding-left: 1rem;
  padding-top: 1rem;
  padding-bottom: 1.5rem;
  padding-right: 0.7rem;
  margin: 0;
  margin-top: 0.5rem;
  overflow-y: auto;
  overflow-x: hidden;
  scrollbar-width: thin;
}

.menu i {
  margin-top: 1rem;
  color: var(--text-color-grad1);
  margin-right: 0.2rem;
  width: 3rem;
}

#menu i.selected {
  color: var(--text-color);
}

.selectable {
  cursor: pointer;
}

.selectable:hover {
  color: #000;
}

girafe-basemap {
  position: absolute;
  right: 0;
  top: 0;
}

</style>
<link rel="stylesheet" href="lib/font-gis/css/font-gis.css" />
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />
<link rel="stylesheet" href="lib/tippy.js/tippy.min.css" />

<div id="panel" class="panel">
  <div class="menu">
    <girafe-button
      icon-style="${this.state.treeview.advanced?"fa-sm fa-solid fa-gear selectable":"fa-sm fa-solid fa-gears selectable"}"
      size="small"
      tip="Advanced options"
      tip-placement="top"
      class="options transparent"
      onclick="${()=>this.state.treeview.advanced=!this.state.treeview.advanced}"></girafe-button>

    <girafe-button
      icon-style="${this.areAllLegendExpanded?"fa-sm fa-solid fa-bars selectable fa-rotate-270":"fa-sm fa-solid fa-bars selectable"}"
      size="small"
      tip="Toggle all legends"
      tip-placement="top"
      class="togglelegends transparent"
      onclick="${()=>this.toggleAllLegends()}"></girafe-button>

    <girafe-button
      icon-style="${this.isAllExpanded?"fa-sm fa-solid fa-caret-right selectable":"fa-sm fa-solid fa-caret-down selectable"}"
      size="small"
      tip="Expand / Collapse all"
      tip-placement="top"
      class="expandall transparent"
      onclick="${()=>this.expandAll()}"></girafe-button>

    <girafe-button
      icon-style="fa-sm fa-solid fa-trash selectable"
      size="small"
      tip="Remove all layers"
      tip-placement="top"
      class="delete transparent"
      onclick="${()=>this.removeAll()}"></girafe-button>

    <girafe-button
      icon-style="fa-sm fa-solid fa-left-right selectable"
      size="small"
      tip="Hide Swiper"
      tip-placement="top"
      class="${this.isSwiperVisible?"swipe transparent":"swipe hidden"}"
      onclick="${()=>this.hideSwipe()}"></girafe-button>

    <girafe-basemap tip="Select basemap"></girafe-basemap>
  </div>
  <div class="treeview-list">
    ${this.state.layers.layersList.map(t=>t instanceof Qt?Ee.for(t)`<girafe-tree-view-group
      groupid="${t.treeItemId}"></girafe-tree-view-group
    >`:Ee`<girafe-tree-view-item layerid="${t.treeItemId}"></girafe-tree-view-item>`)}
  </div>
  <div id="gutter" class="gutter"></div>
  <div id="hide" class="hide">
    <i class="fa-solid"></i>
  </div>
</div>
`);v(this,"layerManager");v(this,"isAllExpanded",!1);v(this,"areAllLegendExpanded",!0);this.layerManager=Na.getInstance()}get isSwiperVisible(){return this.state.layers.swipedLayers.left.length>0||this.state.layers.swipedLayers.right.length>0}registerEvents(){this.stateManager.subscribe("selectedTheme",()=>this.onThemeChanged()),this.stateManager.subscribe("layers.layersList",()=>super.render()),this.stateManager.subscribe("layers.swipedLayers",()=>super.render()),this.stateManager.subscribe("treeview.advanced",()=>super.render())}onThemeChanged(){this.state.selectedTheme!=null?(this.state.layers.layersList=[...this.state.selectedTheme.layersTree],this.activateDefaultLayers(this.state.layers.layersList)):this.state.layers.layersList=[]}activateDefaultLayers(t){for(const n of t)this.layerManager.activateIfDefaultChecked(n),n instanceof dt&&this.layerManager.initializeLegends(n),n instanceof Qt&&this.activateDefaultLayers(n.children)}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}render(){super.render(),this.activateTooltips(!1,[800,0],"right")}expandAll(){this.isAllExpanded=!this.isAllExpanded,le(this,Ea,vd).call(this,this.state.layers.layersList),super.render()}toggleAllLegends(){this.areAllLegendExpanded=!this.areAllLegendExpanded,le(this,Ma,xd).call(this,this.state.layers.layersList),super.render()}removeAll(){for(const t of this.stateManager.state.layers.layersList)this.layerManager.toggle(t,"off");this.hideSwipe(),this.state.layers.layersList=[],this.state.selectedTheme=null}hideSwipe(){this.state.layers.swipedLayers={left:[],right:[]},super.render()}}Ea=new WeakSet,vd=function(t){for(const n of t)n instanceof Qt&&(n.isExpanded=this.isAllExpanded,le(this,Ea,vd).call(this,n.children))},Ma=new WeakSet,xd=function(t){for(const n of t)n instanceof dt&&n.legend?n.isLegendExpanded=this.areAllLegendExpanded:n instanceof Qt&&le(this,Ma,xd).call(this,n.children)};class sO extends at{constructor(t){super("treeviewitem");v(this,"template",()=>{var t;return Ee`<style>
.item {
  color: #999;
  border-top: solid 1px #ddd;
  line-height: 1.3rem;
  display: flex;
  flex-wrap: wrap;
}

.hidden {
  display: none;
}

.invisible {
  visibility: hidden;
}

.selectable {
  cursor: pointer;
}

.selectable:hover {
  color: var(--text-color);
}

.selected {
  cursor: pointer;
  color: var(--text-color);
}

i {
  width: 0.8rem;
  text-align: center;
  min-width: 0;
  padding-top: 0.45rem;
  margin-left: 0.3rem;
}

.expand-spacer {
  order: 1;
  width: 0.5rem;
}

.circle-on,
.circle-off {
  order: 2;
  padding-top: 0.25rem;
  margin-left: 0.2rem;
  margin-right: 0.1rem;
  cursor: pointer;
}

.legend-icon {
  order: 2;
  max-height: 1rem;
  padding-top: 0.25rem;
  margin-left: 0.2rem;
  cursor: pointer;
  object-fit: none;
}

.error {
  order: 3;
  color: #b00;
}

.text {
  order: 4;
  display: inline-block;
  margin: 0.2rem;
  flex-grow: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  width: 0;
}

.text.filtered {
  background-color: var(--bkg-color-grad2);
  color: var(--text-color-grad2);
}

.resolution {
  order: 5;
}

.swipe-left {
  order: 5;
}

.swipe-right {
  order: 7;
}

.movedown {
  order: 8;
}

.moveup {
  order: 9;
}

.opacity {
  order: 10;
}

.filter {
  order: 11;
}

.legend {
  order: 12;
}

.item i.advanced {
  display: none;
}

.item.advanced i.advanced {
  display: block;
}

</style>
<link rel="stylesheet" href="lib/font-gis/css/font-gis.css" />
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />
<link rel="stylesheet" href="lib/tippy.js/tippy.min.css" />

<div class="${this.state.treeview.advanced?"item advanced":"item"}">
  <!-- spacer for alignment -->
  <div class="invisible expand-spacer"></div>

  <!-- Bullet or Checkbox or Icon -->
  <img
    class="${this.layer instanceof dt&&!this.configManager.Config.treeview.useCheckboxes&&this.configManager.Config.treeview.useLegendIcons&&this.iconUrl?"legend-icon":"legend-icon hidden"}"
    alt="${"Icon for "+this.layer.name}"
    onclick="${()=>this.toggle()}"
    src="${this.iconUrl}" />
  <div
    class="${(!this.layer instanceof dt||!this.configManager.Config.treeview.useLegendIcons||!this.iconUrl||this.configManager.Config.treeview.useCheckboxes)&&this.layer.activeState==="off"?"circle-off selectable":"circle-off hidden"}"
    onclick="${()=>this.toggle()}">
    <i
      class="${this.configManager.Config.treeview.useCheckboxes?"fa-lg fa-regular fa-square selbox":"fa-xs fa-regular fa-circle selcircle"}"></i>
  </div>
  <div
    class="${(!this.layer instanceof dt||!this.configManager.Config.treeview.useLegendIcons||!this.iconUrl||this.configManager.Config.treeview.useCheckboxes)&&this.layer.activeState==="on"?"circle-on selected":"circle-on hidden"}"
    onclick="${()=>this.toggle()}">
    <i
      class="${this.configManager.Config.treeview.useCheckboxes?"fa-lg fa-solid fa-square-check selbox":"fa-xs fa-solid fa-circle selcircle"}"></i>
  </div>

  <!-- Error icon -->
  <i
    class="${this.layer.hasError?"fa-solid fa-circle-exclamation tool error":"error hidden"}"
    tip="${this.layer.errorMessage}"></i>

  <!-- Label -->
  <span
    i18n="${this.layer.name}"
    class="${this.layer.activeState==="on"?this.layer.hasFilter?"text selected filtered":"text selected":"text selectable"}"
    tip="${this.layer.hasFilter?"This layer is filtered.":""}"
    onclick="${()=>this.toggle()}"
    >${this.layer.name}</span
  >

  <!-- zoom to resolution -->
  <i
    class="${this.layer instanceof dt&&this.layer.hasRestrictedResolution()?"fa-solid fa-magnifying-glass tool selectable resolution":"resolution hidden"}"
    tip="Zoom to visible resolution"
    onclick="${()=>this.zoomToVisibleResolution()}">
  </i>

  <!-- swipe icons -->
  <i
    class="fa-solid fa-arrow-left tool selectable swipe-left advanced"
    tip="Swipe layer on the left"
    onclick="${()=>this.swipeLayer("left")}"></i>
  <i
    class="fa-solid fa-arrow-right tool selectable swipe-right advanced"
    tip="Swipe layer on the right"
    onclick="${()=>this.swipeLayer("right")}"></i>

  <!-- move icons -->
  <i class="fa-solid fa-caret-down advanced tool movedown selectable" tip="Move this layer down"></i>
  <i class="fa-solid fa-caret-up advanced tool moveup selectable" tip="Move this layer up"></i>

  <i id="opacity" class="fa-regular fa-sun tool selectable opacity advanced" tip="Control opacity"></i>

  <!-- Filter -->
  <i
    id="filter"
    class="${this.layer instanceof dt&&this.layer.queryable?"fa-solid fa-filter tool selectable filter advanced":"filter invisible"}"
    tip="Filter layer"></i>

  <!-- Toggle legend icon -->
  <div class="${this.layer instanceof dt&&this.layer.legend?"legend selectable":"legend invisible"}">
    <i
      tip="Toggle legend"
      class="${this.layer.isLegendExpanded?"fa-solid fa-bars fa-rotate-270 tool selectable":"fa-solid fa-bars tool selectable"}"
      onclick="${()=>this.layer.isLegendExpanded=!this.layer.isLegendExpanded}"></i>
  </div>
</div>

${(t=this.layer.layers)==null?void 0:t.split(",").map(n=>Ee`<img
  class="${this.layer instanceof dt&&this.layer.legend&&this.layer.isLegendExpanded?"legend-image":"legend-image hidden"}"
  alt="${"Legend for "+n}"
  src="${this.legendUrls[n]}" />`)}
`});v(this,"layerManager");v(this,"layer");v(this,"iconUrl",null);v(this,"legendUrls",{});this.layerManager=Na.getInstance(),this.layer=t}render(){const t=this.getAttribute("layerid");t&&(this.layer=this.layerManager.getTreeItem(t),this.setLegend()),super.render(),this.createOpacityTooltip(),this.createFilterTooltip(),this.createTooltips()}setLegend(){if(!(this.layer instanceof dt)){this.layerManager.setError(this.layer,`${this.layer.name} is not a WMS layer, and should not have a legend configured in the backend.`);return}this.layer.iconUrl?this.iconUrl=this.layer.iconUrl:this.layer.legendRule?this.iconUrl=Object.values(this.getLegendImageUrlFromWms(!0))[0]:this.iconUrl=null,this.layer.legend&&(this.layer.legendImage?this.legendUrls[this.layer.layers]=this.layer.legendImage:this.legendUrls=this.getLegendImageUrlFromWms(!1))}getLegendImageUrlFromWms(t){if(!(this.layer instanceof dt))throw new Error(`${this.layer.name} is not a WMS layer, this method should not be called.`);const n={};for(const s of this.layer.layers.split(",")){let o=new j_({url:this.layer.url,params:{LAYERS:s},ratio:1}).getLegendUrl(this.state.position.resolution);if(!o){console.error(`The URL for legend of layer ${s} could not be calculated.`),n[s]="";continue}o.toLowerCase().includes("sld_version")||(o+="&SLD_Version=1.1.0"),t&&(this.isNullOrUndefined(this.layer.legendRule)||(o+="&RULE="+encodeURIComponent(this.layer.legendRule)),o+="&HEIGHT="+this.configManager.Config.treeview.defaultIconSize.height,o+="&WIDTH="+this.configManager.Config.treeview.defaultIconSize.width),n[s]=o}return n}createOpacityTooltip(){const t=this.shadow.getElementById("opacity");Yo(t,{trigger:"click",arrow:!0,interactive:!0,theme:"light",placement:"bottom-end",content:n=>{const s=document.createElement("input");return s.type="range",s.className="slider",s.min="0",s.max="20",s.value=(this.layer.opacity*20).toString(),s.oninput=r=>this.layer.opacity=parseInt(s.value)/20,s}})}createFilterTooltip(){const t=this.shadow.getElementById("filter");Yo(t,{trigger:"click",arrow:!0,interactive:!0,theme:"light",placement:"right",appendTo:document.body,content:n=>new z1(this.layer)})}registerEvents(){this.stateManager.subscribe("layers.layersList..*.isLegendExpanded",(t,n,s)=>this.refreshRender(s)),this.stateManager.subscribe("layers.layersList..*.activeState",(t,n,s)=>this.refreshRender(s)),this.stateManager.subscribe("layers.layersList..*.hasError",(t,n,s)=>this.refreshRender(s)),this.stateManager.subscribe("layers.layersList..*.errorMessage",(t,n,s)=>this.refreshRender(s)),this.stateManager.subscribe("layers.layersList..*.filter",(t,n,s)=>this.refreshRender(s)),this.stateManager.subscribe("treeview.advanced",()=>super.render()),this.stateManager.subscribe("position.resolution",()=>this.refreshLegends())}refreshLegends(){this.setLegend(),super.render()}refreshRender(t){t===this.layer&&(super.render(),this.createTooltips())}createTooltips(){super.activateTooltips(!1,[800,0],"right")}toggle(t){this.layerManager.toggleLayer(this.layer,t)}zoomToVisibleResolution(){if(!(this.layer instanceof dt))throw new Error(`${this.layer.name} is not a WMS layer, this method should not be called here.`);if(this.layer.maxResolution){const t=this.layer.maxResolution-.1*this.layer.maxResolution;this.state.position.resolution=t}}swipeLayer(t){this.layer.activeState==="off"&&this.toggle("on");const n=t==="left"?"right":"left",s={left:[],right:[]};s[n]=this.state.layers.swipedLayers[n].filter(r=>r.treeItemId!==this.layer.treeItemId),s[t]=[...this.state.layers.swipedLayers[t]],s[t].push(this.layer),this.state.layers.swipedLayers=s}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}}class rO extends at{constructor(t){super("treeviewgroup");v(this,"template",()=>Ee`<style>
.group {
  color: #999;
  border-top: solid 1px #ddd;
  line-height: 1.3rem;
  display: flex;
  flex-wrap: wrap;
}

.hidden {
  display: none;
}

.invisible {
  visibility: hidden;
}

.selectable {
  cursor: pointer;
}

.selectable:hover {
  color: var(--text-color);
}

.selected {
  cursor: pointer;
  color: var(--text-color);
}

i {
  width: 0.8rem;
  text-align: center;
  min-width: 0;
}

.expand,
.collapse {
  order: 1;
  padding-top: 0.15rem;
}

.circle-on,
.circle-off,
.circle-semi {
  order: 2;
  padding-top: 0.2rem;
  margin-left: 0.2rem;
  margin-right: 0.1rem;
  cursor: pointer;
}

.error {
  order: 3;
  color: #b00;
}

.text {
  order: 4;
  display: inline-block;
  margin: 0.2rem;
  flex-grow: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  width: 0;
}

.delete {
  order: 5;
  padding-top: 0.45rem;
}

.sublayers {
  padding-left: 1rem;
  flex-basis: 100%;
  order: 10;
}

</style>
<link rel="stylesheet" href="lib/font-gis/css/font-gis.css" />
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />
<link rel="stylesheet" href="lib/tippy.js/tippy.min.css" />

<div class="group">
  <!-- Caret -->
  <div class="${this.group.isExpanded?"expand hidden":"expand"}" onclick="${()=>this.group.isExpanded=!0}">
    <i class="fa fa-caret-right selectable expand"></i>
  </div>
  <div
    class="${this.group.isExpanded?"collapse":"collapse hidden"}"
    onclick="${()=>this.group.isExpanded=!1}">
    <i class="fa fa-caret-down selectable expand"></i>
  </div>

  <!-- Bullet or Checkbox -->
  <div
    class="${this.group.activeState==="off"?"circle-off selectable":"circle-off hidden"}"
    onclick="${()=>this.toggle()}">
    <i
      class="${this.configManager.Config.treeview.useCheckboxes?"fa-lg fa-regular fa-square selbox":"fa-xs fa-regular fa-circle selcircle"}"></i>
  </div>
  <div
    class="${this.group.activeState==="on"?"circle-on selected":"circle-on hidden"}"
    onclick="${()=>this.toggle()}">
    <i
      class="${this.configManager.Config.treeview.useCheckboxes?"fa-lg fa-solid fa-square-check selbox":"fa-xs fa-solid fa-circle selcircle"}"></i>
  </div>
  <div
    class="${this.group.activeState==="semi"?"circle-semi selected":"circle-semi hidden"}"
    onclick="${()=>this.toggle("on")}">
    <i
      class="${this.configManager.Config.treeview.useCheckboxes?"fa-lg fa-regular fa-square-check selbox":"fa-xs fa-solid fa-circle-half-stroke selcircle"}"></i>
  </div>

  <!-- Error icon -->
  <i
    class="${this.group.hasError?"fa-solid fa-circle-exclamation tool error":"error hidden"}"
    tip="${this.group.errorMessage}"></i>

  <!-- Label -->
  <span
    i18n="${this.group.name}"
    class="${this.group.activeState==="on"||this.group.activeState==="semi"?"text selected":"text selectable"}"
    onclick="${()=>this.toggle()}"
    >${this.group.name}</span
  >

  <i
    class="fa fa-solid fa-xmark tool delete selectable"
    tip="Remove this group"
    onclick="${()=>this.deleteGroup()}"></i>

  <!-- Sub layers -->
  <div class="${this.group.isExpanded?"sublayers":"sublayers hidden"}">
    ${(this.group.children??[]).map(t=>t instanceof Qt?Ee`<girafe-tree-view-group
      groupid="${t.treeItemId}"></girafe-tree-view-group
    >`:Ee`<girafe-tree-view-item layerid="${t.treeItemId}"></girafe-tree-view-item>`)}
  </div>
</div>
`);v(this,"layerManager");v(this,"group");this.layerManager=Na.getInstance(),this.group=t}render(){const t=this.getAttribute("groupid");t&&(this.group=this.layerManager.getTreeItem(t)),super.render(),this.activateTooltips(!1,[800,0],"right")}registerEvents(){this.stateManager.subscribe("layers.layersList..*.isExpanded",(t,n,s)=>this.refreshRender(s)),this.stateManager.subscribe("layers.layersList..*.activeState",(t,n,s)=>this.refreshRender(s))}refreshRender(t){t===this.group&&super.render()}toggle(t){this.layerManager.toggleGroup(this.group,t)}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}deactivateGroup(t){if(t.activeState="off",t instanceof Qt)for(const n of t.children)this.deactivateGroup(n)}deleteGroup(){this.deactivateGroup(this.group);const t=this.state.layers.layersList.findIndex(n=>n.id===this.group.id);t>=0?this.state.layers.layersList.splice(t,1):console.log("cannot delete this group. Probably a subgroup, this is not managed yet.")}}var eo,to;class oO extends at{constructor(){super("themelocationiconswitcher");v(this,"template",()=>Ee`<style>
div.hidden {
  display: none;
}

.iconBtn {
  display: flex;
  align-items: center;
  justify-content: center;
  height:4.6rem;
  width:3.2rem;
  margin-left: 0.4rem;
  margin-right: 0.4rem;
}

ul {
  list-style-type: none;
  height: 4.6rem;
  margin-top: 0;
  background-color: var(--bkg-color-grad1);
  color: #fff;
  cursor: pointer;
  border-style: none;
  border-right: solid 1px #ffffff;
  border-left: solid 1px #ffffff;
  padding-inline-start: 0px;
}


ul div {
  float: left;
  width: 3.2rem;
  height: 4.6rem;
  cursor: pointer;
  border: none;
}

ul div:hover {
  background-color: var(--bkg-color-grad1);
}

ul div.hidden {
  display: none;
}

.ticon {
  display: flex;
  align-items: center;
  justify-content: center;
  max-height: 3.8rem;
  padding: 0.4rem;
}

ul div img {
  align-items: center !important;
  width: 1.8rem;
  max-height: 2rem;
}


li {
  float: left;
}

</style>
<link rel="stylesheet" href="lib/fontawesome/css/all.min.css" />



<div class="${this.state.loading?"":"hidden"}">
  <i class="fa-2x fa-solid fa-circle-notch fa-spin"></i>
</div>


<ul id="themes">

  ${Object.values(this.favthemes??[]).map(t=>Ee.for(t)`
  <div class="iconBtn" onmousedown="${()=>this.ignoreBlur()}"
    onclick="${()=>this.onThemeChanged(t)}">
    <div class="ticon">
      <img alt="${"Icon for "+t.name+t.id}"
        src="${t.icon}" />
    </div>

  </div>
  `)}
</ul>
`);re(this,eo,void 0);re(this,to,!1);v(this,"favthemes",{})}get themesList(){if(!Z(this,eo))throw new Error("You called themesList before render");return Z(this,eo)}render(t=!1){super.render(),Ke(this,eo,this.shadow.querySelector("#themes")),this.toggleThemesList(!1),t&&this.toggleThemesList(!0)}registerEvents(){this.stateManager.subscribe("loading",t=>this.render(t)),this.stateManager.subscribe("themes",()=>{this.filterThemes(),this.render(),super.girafeTranslate()})}onBlur(){Z(this,to)||this.toggleThemesList(!1)}filterThemes(){for(const t of Object.values(this.state.themes))t.favorite==!0&&(this.favthemes[t.id]=t)}toggleThemesList(t=null){t===!0?this.themesList.style.display="block":t===!1?this.themesList.style.display="none":this.themesList.style.display==="none"?this.themesList.style.display="block":this.themesList.style.display="none"}ignoreBlur(){Ke(this,to,!0)}onThemeChanged(t){var n,s,r;this.state.selectedTheme=t,(t.location!=null||t.zoom!=null)&&((r=this.state.olMap)==null||r.getView().animate({center:t.location??((n=this.state.olMap)==null?void 0:n.getView().getCenter()),zoom:t.zoom??((s=this.state.olMap)==null?void 0:s.getView().getZoom()),duration:1e3})),this.toggleThemesList(!0),Ke(this,to,!1)}connectedCallback(){this.loadConfig().then(()=>{this.render(),this.registerEvents()})}}eo=new WeakMap,to=new WeakMap;window.CESIUM_BASE_URL="lib/cesium/";Yt.defs("EPSG:21781","+proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +k_0=1 +x_0=600000 +y_0=200000 +ellps=bessel +towgs84=660.077,13.551,369.344,2.484,1.783,2.939,5.66 +units=m +no_defs");Yt.defs("EPSG:2056","+proj=somerc +lat_0=46.9524055555556 +lon_0=7.43958333333333 +k_0=1 +x_0=2600000 +y_0=1200000 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +units=m +no_defs +type=crs");QE(Yt);Yo.setDefaultProps({maxWidth:""});kn.getInstance();Xl.getInstance();Qh.getInstance();Xi.getInstance();xM.getInstance();wM.getInstance();Uy.getInstance();document.state=Xi.getInstance().state;customElements.define("girafe-about",N2);customElements.define("girafe-basemap",D2);customElements.define("girafe-button",Yy);customElements.define("girafe-colorswitcher",G2);customElements.define("girafe-coordinate",z2);customElements.define("girafe-globe-select",B2);customElements.define("girafe-help",$2);customElements.define("girafe-language-select",U2);customElements.define("girafe-map",Bk);customElements.define("girafe-menu-button",$k);customElements.define("girafe-nav-bookmarks",A1);customElements.define("girafe-nav-history",Uk);customElements.define("girafe-print",qk);customElements.define("girafe-proj-select",jk);customElements.define("girafe-query-builder",z1);customElements.define("girafe-redlining",Kk);customElements.define("girafe-scale",Jk);customElements.define("girafe-search",Qk);customElements.define("girafe-selection-grid",eO);customElements.define("girafe-selection-window",tO);customElements.define("girafe-theme-select",iO);customElements.define("girafe-tree-view",nO);customElements.define("girafe-tree-view-group",rO);customElements.define("girafe-tree-view-item",sO);customElements.define("girafe-theme-favorites",oO);export{P0 as $,_e as A,_n as B,gO as C,$_ as D,ee as E,H as F,Uo as G,UE as H,qP as I,jE as J,pi as K,Ai as L,Wn as M,rn as N,TS as O,Tt as P,xP as Q,l_ as R,ii as S,rA as T,W_ as U,X_ as V,yO as W,z_ as X,Jc as Y,Nl as Z,Hp as _,Uu as a,j_ as a0,bA as a1,X0 as a2,oo as a3,uc as a4,__ as a5,uO as a6,wt as a7,oh as a8,ps as a9,sc as aa,kr as ab,vo as ac,fO as b,qi as c,Ry as d,_t as e,UP as f,Re as g,K as h,Sy as i,Qe as j,Vf as k,ye as l,_i as m,wh as n,dO as o,Vi as p,q_ as q,$C as r,bh as s,Fr as t,qe as u,Os as v,bP as w,jP as x,E0 as y,rs as z};
//# sourceMappingURL=index-3fb1374e.js.map
