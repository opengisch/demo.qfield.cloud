const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./raw-Dt1HMqYc.js","./basedecoder-DvumDe3Y.js","./lzw-DpvbRwG5.js","./jpeg-CdeCw_eT.js","./deflate-CUkHh1nh.js","./pako.esm-CPws4d4z.js","./packbits-DQnG8s9w.js","./lerc-BzRpccL0.js","./lazy-CXj0l6bG.js","./webimage-BcnuJlio.js","./Cesium-BhpIpNCZ.js","./exportKml-B8RxacOT.js","./olcs-0nA3eAVu.js"])))=>i.map(i=>d[i]);
var mz=Object.defineProperty;var ZA=e=>{throw TypeError(e)};var gz=(e,t,n)=>t in e?mz(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var z=(e,t,n)=>gz(e,typeof t!="symbol"?t+"":t,n),Sb=(e,t,n)=>t.has(e)||ZA("Cannot "+n);var ui=(e,t,n)=>(Sb(e,t,"read from private field"),n?n.call(e):t.get(e)),fo=(e,t,n)=>t.has(e)?ZA("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),$h=(e,t,n,i)=>(Sb(e,t,"write to private field"),i?i.call(e,n):t.set(e,n),n),ki=(e,t,n)=>(Sb(e,t,"access private method"),n);import{d as _z,b5 as yz,aW as JA,bc as bz,bd as Tz,a7 as ps,aB as vR,aR as xz,aa as Ws,ab as Pr,be as IR,bf as Ez,a6 as Th,bg as ga,bh as Cz,bi as wz,T as Az,bj as Er,bk as Sz,a3 as bm,E as $s,a4 as vz,B as Iz,bl as jE,bm as Oz,L as Rz,bn as Dz,bo as OR,p as Mz,bp as Bf,bq as Lz,br as Pz,bs as T_,bt as Ic,bu as Nz,bv as Fz,U as is,bw as Bz,bx as x_,by as RR,bz as zz,bA as Uz,bB as hx,bC as Vu,bD as vb,bE as kz,bF as gn,bG as DR,bH as MR,bI as nl,bJ as VE,bK as LR,bL as QA,aQ as jz,bM as eS,bN as df,bO as Vz,bP as tS,bQ as Gz,bR as Hz,bS as qz,bT as nS,bU as Wz,bV as $z,bW as GE,bX as Xz,bY as hp,Y as PR,bZ as Yz,b_ as iS,e as Kz,b$ as Zz,c0 as Jz,c1 as cu,c2 as Qz,c3 as NR,c4 as FR,c5 as eU,c6 as tU,c7 as nU,c8 as BR,c9 as xt,ca as iU,cb as rU,cc as sU,cd as Hg,b6 as zR,ce as oU,cf as E_,cg as aU,ch as cU,ci as lU,cj as uU,ck as HE,cl as Oy,cm as fU,aO as qE,cn as hU,co as UR,_ as Ib,cp as dU,cq as WE,cr as pU,cs as mU,ct as gU,V as du,cu as qg,cv as dp,cw as _U,cx as yU,cy as Wg,cz as bU,ag as dx,a as $a,cA as TU,cB as xU,a8 as rS,a9 as pp,ac as EU,z as CU,cC as wU,b7 as sS,cD as AU,cE as SU,cF as vU,cG as oS,cH as Vd,cI as IU,cJ as OU,cK as RU,cL as Ob,cM as aS,X as DU,b2 as MU,Z as LU,cN as cS,cO as px,A as PU,ae as NU,cP as FU,af as BU,cQ as zU,b4 as UU,cR as kU,cS as lS,cT as uS,cU as fS,cV as jU,cW as VU,cX as GU,K as hS,cY as HU,cZ as qU,h as kR,i as WU,c_ as $U,c$ as XU,d0 as YU,d1 as KU,d2 as dS,d3 as ZU}from"./lazy-CXj0l6bG.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();const JU=(e,t,n,i,r)=>{const s=n.length;let o=t.length,a=s,c=0,u=0,h=null;for(;c<o||u<a;)if(o===c){const d=a<s?u?i(n[u-1],-0).nextSibling:i(n[a-u],0):r;for(;u<a;)e.insertBefore(i(n[u++],1),d)}else if(a===u)for(;c<o;)(!h||!h.has(t[c]))&&e.removeChild(i(t[c],-1)),c++;else if(t[c]===n[u])c++,u++;else if(t[o-1]===n[a-1])o--,a--;else if(t[c]===n[a-1]&&n[u]===t[o-1]){const d=i(t[--o],-1).nextSibling;e.insertBefore(i(n[u++],1),i(t[c++],-1).nextSibling),e.insertBefore(i(n[--a],1),d),t[o]=n[a]}else{if(!h){h=new Map;let d=u;for(;d<a;)h.set(n[d],d++)}if(h.has(t[c])){const d=h.get(t[c]);if(u<d&&d<a){let p=c,g=1;for(;++p<o&&p<a&&h.get(t[p])===d+g;)g++;if(g>d-u){const _=i(t[c],0);for(;u<d;)e.insertBefore(i(n[u++],1),_)}else e.replaceChild(i(n[u++],1),i(t[c++],-1))}else c++}else e.removeChild(i(t[c++],-1))}return n},{isArray:jR}=Array,{getPrototypeOf:QU,getOwnPropertyDescriptor:ek}=Object,tk="http://www.w3.org/2000/svg",gl=[],VR=()=>document.createRange(),mp=(e,t,n)=>(e.set(t,n),n),nk=(e,t)=>{let n;do n=ek(e,t);while(!n&&(e=QU(e)));return n},ik=(e,t)=>t.reduceRight(rk,e),rk=(e,t)=>e.childNodes[t],sk=1,ok=8,ak=11;/*! (c) Andrea Giammarchi - ISC */const{setPrototypeOf:ck}=Object,lk=e=>{function t(n){return ck(n,new.target.prototype)}return t.prototype=e.prototype,t};let Gu;const GR=(e,t,n)=>(Gu||(Gu=VR()),n?Gu.setStartAfter(e):Gu.setStartBefore(e),Gu.setEndAfter(t),Gu.deleteContents(),e),mx=({firstChild:e,lastChild:t},n)=>GR(e,t,n);let HR=!1;const Rb=(e,t)=>HR&&e.nodeType===ak?1/t<0?t?mx(e,!0):e.lastChild:t?e.valueOf():e.firstChild:e,pS=e=>document.createComment(e);var Kf,Up,Yc;class uk extends lk(DocumentFragment){constructor(n){super(n);fo(this,Kf,pS("<>"));fo(this,Up,pS("</>"));fo(this,Yc,gl);this.replaceChildren(ui(this,Kf),...n.childNodes,ui(this,Up)),HR=!0}get firstChild(){return ui(this,Kf)}get lastChild(){return ui(this,Up)}get parentNode(){return ui(this,Kf).parentNode}remove(){mx(this,!1)}replaceWith(n){mx(this,!0).replaceWith(n)}valueOf(){const{parentNode:n}=this;if(n===this)ui(this,Yc)===gl&&$h(this,Yc,[...this.childNodes]);else{if(n){let{firstChild:i,lastChild:r}=this;for($h(this,Yc,[i]);i!==r;)ui(this,Yc).push(i=i.nextSibling)}this.replaceChildren(...ui(this,Yc))}return this}}Kf=new WeakMap,Up=new WeakMap,Yc=new WeakMap;const qR=(e,t,n)=>e.setAttribute(t,n),Ry=(e,t)=>e.removeAttribute(t),fk=(e,t)=>{for(const n in t){const i=t[n],r=n==="role"?n:`aria-${n}`;i==null?Ry(e,r):qR(e,r,i)}return t};let Tm;const hk=(e,t,n)=>{n=n.slice(1),Tm||(Tm=new WeakMap);const i=Tm.get(e)||mp(Tm,e,{});let r=i[n];return r&&r[0]&&e.removeEventListener(n,...r),r=jR(t)?t:[t,!1],i[n]=r,r[0]&&e.addEventListener(n,...r),t},gp=(e,t)=>{const{t:n,n:i}=e;let r=!1;switch(typeof t){case"object":if(t!==null){(i||n).replaceWith(e.n=t.valueOf());break}case"undefined":r=!0;default:n.data=r?"":t,i&&(e.n=null,i.replaceWith(n));break}return t},dk=(e,t)=>$E(e,t,t==null?"class":"className"),pk=(e,t)=>{const{dataset:n}=e;for(const i in t)t[i]==null?delete n[i]:n[i]=t[i];return t},Dy=(e,t,n)=>e[n]=t,mk=(e,t,n)=>Dy(e,t,n.slice(1)),$E=(e,t,n)=>t==null?(Ry(e,n),t):Dy(e,t,n),WR=(e,t)=>(typeof t=="function"?t(e):t.current=e,t),Db=(e,t,n)=>(t==null?Ry(e,n):qR(e,n,t),t),gk=(e,t)=>t==null?$E(e,t,"style"):Dy(e.style,t,"cssText"),_k=(e,t,n)=>(e.toggleAttribute(n.slice(1),t),t),C_=(e,t,n)=>{const{length:i}=t;if(e.data=`[${i}]`,i)return JU(e.parentNode,n,t,Rb,e);switch(n.length){case 1:n[0].remove();case 0:break;default:GR(Rb(n[0],0),Rb(n.at(-1),-0),!1);break}return gl},yk=new Map([["aria",fk],["class",dk],["data",pk],["ref",WR],["style",gk]]),bk=(e,t,n)=>{var i;switch(t[0]){case".":return mk;case"?":return _k;case"@":return hk;default:return n||"ownerSVGElement"in e?t==="ref"?WR:Db:yk.get(t)||(t in e?t.startsWith("on")?Dy:(i=nk(e,t))!=null&&i.set?$E:Db:Db)}},Tk=(e,t)=>(e.textContent=t??"",t),Rd=(e,t,n)=>({a:e,b:t,c:n}),xk=(e,t)=>({b:e,c:t}),Ek=(e,t,n,i)=>({v:gl,u:e,t,n,c:i}),xh=()=>Rd(null,null,gl),$R=e=>(t,n)=>{const{a:i,b:r,c:s}=e(t,n),o=document.importNode(i,!0);let a=gl;if(r!==gl){a=[];for(let c,u,h=0;h<r.length;h++){const{a:d,b:p,c:g}=r[h],_=d===u?c:c=ik(o,u=d);a[h]=Ek(p,_,g,p===C_?[]:p===gp?xh():null)}}return xk(s?o.firstChild:new uk(o),a)},Ck=/^(?:plaintext|script|style|textarea|title|xmp)$/i,wk=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i;/*! (c) Andrea Giammarchi - ISC */const Ak=/<([a-zA-Z0-9]+[a-zA-Z0-9:._-]*)([^>]*?)(\/?)>/g,Sk=/([^\s\\>"'=]+)\s*=\s*(['"]?)\x01/g,vk=/[\x01\x02]/g,Ik=(e,t,n)=>{let i=0;return e.join("").trim().replace(Ak,(r,s,o,a)=>`<${s}${o.replace(Sk,"=$2$1").trimEnd()}${a?n||wk.test(s)?" /":`></${s}`:""}>`).replace(vk,r=>r===""?`<!--${t+i++}-->`:t+i++)};let xm=document.createElement("template"),Mb,Lb;const Ok=(e,t)=>{if(t)return Mb||(Mb=document.createElementNS(tk,"svg"),Lb=VR(),Lb.selectNodeContents(Mb)),Lb.createContextualFragment(e);xm.innerHTML=e;const{content:n}=xm;return xm=xm.cloneNode(!1),n},Pb=e=>{const t=[];let n;for(;n=e.parentNode;)t.push(t.indexOf.call(n.childNodes,e)),e=n;return t},mS=()=>document.createTextNode(""),Rk=(e,t,n)=>{const i=Ok(Ik(e,Xh,n),n),{length:r}=e;let s=gl;if(r>1){const c=[],u=document.createTreeWalker(i,129);let h=0,d=`${Xh}${h++}`;for(s=[];h<r;){const p=u.nextNode();if(p.nodeType===ok){if(p.data===d){const g=jR(t[h-1])?C_:gp;g===gp&&c.push(p),s.push(Rd(Pb(p),g,null)),d=`${Xh}${h++}`}}else{let g;for(;p.hasAttribute(d);){g||(g=Pb(p));const _=p.getAttribute(d);s.push(Rd(g,bk(p,_,n),_)),Ry(p,d),d=`${Xh}${h++}`}!n&&Ck.test(p.localName)&&p.textContent.trim()===`<!--${d}-->`&&(s.push(Rd(g||Pb(p),Tk,null)),d=`${Xh}${h++}`)}}for(h=0;h<c.length;h++)c[h].replaceWith(mS())}const{childNodes:o}=i;let{length:a}=o;return a<1?(a=1,i.appendChild(mS())):a===1&&r!==1&&o[0].nodeType!==sk&&(a=0),mp(XR,e,Rd(i,s,a===1))},XR=new WeakMap,Xh="isÂµ",YR=e=>(t,n)=>XR.get(t)||Rk(t,n,e),Dk=$R(YR(!1)),Mk=$R(YR(!0)),XE=(e,{s:t,t:n,v:i})=>{if(e.a!==n){const{b:r,c:s}=(t?Mk:Dk)(n,i);e.a=n,e.b=r,e.c=s}for(let{c:r}=e,s=0;s<r.length;s++){const o=i[s],a=r[s];switch(a.u){case C_:a.v=C_(a.t,Lk(a.c,o),a.v);break;case gp:const c=o instanceof My?XE(a.c||(a.c=xh()),o):(a.c=null,o);c!==a.v&&(a.v=gp(a,c));break;default:o!==a.v&&(a.v=a.u(a.t,o,a.n,a.v));break}}return e.b},Lk=(e,t)=>{let n=0,{length:i}=t;for(i<e.length&&e.splice(i);n<i;n++){const r=t[n];r instanceof My?t[n]=XE(e[n]||(e[n]=xh()),r):e[n]=null}return t};class My{constructor(t,n,i){this.s=t,this.t=n,this.v=i}toDOM(t=xh()){return XE(t,this)}}const gS=new WeakMap,Nb=(e,t)=>{const n=gS.get(e)||mp(gS,e,xh()),{b:i}=n;return i!==(typeof t=="function"?t():t).toDOM(n)&&e.replaceChildren(n.b.valueOf()),e};/*! (c) Andrea Giammarchi - MIT */const Pk=e=>(t,...n)=>new My(e,t,n),gx=Pk(!1),To=class To{constructor(t){if(!(t in To.initializingSingletons)||!To.initializingSingletons[t])throw new Error("This is a singleton. Please use the getInstance() method.")}static getInstance(){const t=this.name;if(!(t in To.instances)){To.initializingSingletons[t]=!0;try{const n=new this(t);To.instances[t]=n}finally{To.initializingSingletons[t]=!1}}return To.instances[t]}isNullOrUndefined(t){return t==null}isNullOrUndefinedOrBlank(t){return t==null||t===""}};z(To,"instances",{}),z(To,"initializingSingletons",{});let ei=To;const vy=class vy{constructor(t){z(this,"general");z(this,"languages");z(this,"interface");z(this,"themes");z(this,"basemaps");z(this,"treeview");z(this,"search");z(this,"print");z(this,"selection");z(this,"drawing");z(this,"share");z(this,"projections");z(this,"map");z(this,"map3d");z(this,"lidar");z(this,"contextmenu");z(this,"crs");z(this,"csv");z(this,"metadata");z(this,"infoWindow");z(this,"offline");z(this,"query");z(this,"gmfauth");z(this,"oauth");z(this,"userdata");z(this,"extendedConfig");this.general=this.initConfigGeneral(t),this.languages=this.initConfigLanguages(t),this.interface=this.initConfigInterface(t),this.themes=this.initConfigThemes(t),this.basemaps=this.initConfigBasemaps(t),this.treeview=this.initConfigTreeview(t),this.selection=this.initConfigSelection(t),this.drawing=this.initConfigDrawing(t),this.projections=this.initConfigProjections(t),this.map=this.initConfigMap(t),this.lidar=this.initConfigLidar(t),this.csv=this.initConfigCsv(t),this.metadata=this.initConfigMetadata(t),this.infoWindow=this.initConfigInfoWindow(t),this.offline=this.initConfigOffline(t),this.query=this.initConfigQuery(t),this.oauth=this.initConfigOauth(t),this.gmfauth=this.initGmfOauth(t),this.userdata=this.initUserData(t),this.contextmenu=this.initContextMenu(t),this.crs=this.initCRS(t),this.extendedConfig=this.initExtendedConfig(t);try{this.search=this.initConfigSearch(t)}catch(n){console.warn(n),this.search={url:""}}try{this.share=this.initConfigShare(t)}catch(n){console.warn(n),this.share={service:null,createUrl:""}}try{this.print=this.initConfigPrint(t)}catch(n){console.warn(n),this.print={url:""}}try{this.map3d=this.initConfigMap3D(t)}catch(n){console.warn(n)}}initConfigProjections(t){if(!t.projections)throw new Error("Configuration for projections is required. See https://doc.geomapfish.dev/docs/configuration");return t.projections}initConfigMap3D(t){return t.map3d}initConfigMap(t){var n,i,r,s,o,a,c;if(!((n=t.map)!=null&&n.srid))throw new Error("Configuration for projections is required. See https://doc.geomapfish.dev/docs/configuration");if(!((i=t.map)!=null&&i.scales))throw new Error("Configuration for projections is required. See https://doc.geomapfish.dev/docs/configuration");if(!((r=t.map)!=null&&r.startPosition))throw new Error("Configuration for projections is required. See https://doc.geomapfish.dev/docs/configuration");if(!((s=t.map)!=null&&s.startZoom))throw new Error("Configuration for projections is required. See https://doc.geomapfish.dev/docs/configuration");return{srid:t.map.srid,startZoom:t.map.startZoom,startPosition:t.map.startPosition,maxExtent:t.map.maxExtent,scales:t.map.scales,constrainScales:((o=t.map)==null?void 0:o.constrainScales)??!0,constrainRotation:((a=t.map)==null?void 0:a.constrainRotation)??!1,showScaleLine:((c=t.map)==null?void 0:c.showScaleLine)??!0}}initConfigQuery(t){var n;return{legacy:((n=t.query)==null?void 0:n.legacy)??!1}}initConfigDrawing(t){var n,i,r,s,o,a,c,u;return{defaultFillColor:((n=t.drawing)==null?void 0:n.defaultFillColor)??"#6666ff7f",defaultStrokeColor:((i=t.drawing)==null?void 0:i.defaultStrokeColor)??"#0000ff",defaultStrokeWidth:((r=t.drawing)==null?void 0:r.defaultStrokeWidth)??2,defaultTextSize:((s=t.drawing)==null?void 0:s.defaultTextSize)??12,defaultFont:((o=t.drawing)==null?void 0:o.defaultFont)??"Arial",defaultVertexRadius:((a=t.drawing)==null?void 0:a.defaultVertexRadius)??8,defaultVertexFillColor:((c=t.drawing)==null?void 0:c.defaultVertexFillColor)??"#ffffffbf",defaultVertexStrokeWidth:((u=t.drawing)==null?void 0:u.defaultVertexStrokeWidth)??2}}initConfigShare(t){var n,i,r;if(!((n=t.share)!=null&&n.createUrl))throw new Error("Configuration for share.createUrl is required. See https://doc.geomapfish.dev/docs/configuration");return{service:((i=t.share)==null?void 0:i.service)??"gmf",createUrl:(r=t.share)==null?void 0:r.createUrl}}initConfigSelection(t){var n,i,r,s,o,a;return{maxFeature:((n=t.selection)==null?void 0:n.maxFeature)??300,defaultFillColor:((i=t.selection)==null?void 0:i.defaultFillColor)??"#ff66667f",defaultStrokeColor:((r=t.selection)==null?void 0:r.defaultStrokeColor)??"#ff3333",defaultStrokeWidth:((s=t.selection)==null?void 0:s.defaultStrokeWidth)??4,highlightFillColor:((o=t.selection)==null?void 0:o.highlightFillColor)??"#00ff227f",highlightStrokeColor:((a=t.selection)==null?void 0:a.highlightStrokeColor)??"#00ff22"}}initConfigPrint(t){var n,i,r;if(!((n=t.print)!=null&&n.url))throw new Error("Configuration for print.url is required. See https://doc.geomapfish.dev/docs/configuration");return(i=t.print)!=null&&i.attributeNames||(t.print.attributeNames=["title","comments","legend"]),(r=t.print)!=null&&r.formats||(t.print.formats=["pdf","png"]),t.print}initConfigSearch(t){var n,i,r,s,o;if(!((n=t.search)!=null&&n.url))throw new Error("Configuration for search.url is required. See https://doc.geomapfish.dev/docs/configuration");if(!t.search.url.includes("###SEARCHTERM###"))throw new Error("search.url is missing the expected pattern. See https://doc.geomapfish.dev/docs/configuration");return{url:t.search.url,objectPreview:t.search.objectPreview??!1,layerPreview:t.search.layerPreview??!1,minResolution:t.search.minResolution??.5,defaultFillColor:((i=t.search)==null?void 0:i.defaultFillColor)??"#3388ff7f",defaultStrokeColor:((r=t.search)==null?void 0:r.defaultStrokeColor)??"#3388ff",defaultStrokeWidth:((s=t.search)==null?void 0:s.defaultStrokeWidth)??2,paintSearchResults:((o=t.search)==null?void 0:o.paintSearchResults)??!0}}initConfigTreeview(t){var n,i,r,s,o;return{hideLegendWhenLayerIsDeactivated:((n=t.treeview)==null?void 0:n.hideLegendWhenLayerIsDeactivated)??!0,defaultIconSize:{height:((r=(i=t.treeview)==null?void 0:i.defaultIconSize)==null?void 0:r.height)??20,width:((o=(s=t.treeview)==null?void 0:s.defaultIconSize)==null?void 0:o.width)??20}}}initConfigBasemaps(t){var n,i,r,s,o;return{show:((n=t.basemaps)==null?void 0:n.show)??!0,defaultBasemap:((i=t.basemaps)==null?void 0:i.defaultBasemap)??"Empty",OSM:((r=t.basemaps)==null?void 0:r.OSM)??!1,SwissTopoVectorTiles:((s=t.basemaps)==null?void 0:s.SwissTopoVectorTiles)??!1,emptyBasemap:((o=t.basemaps)==null?void 0:o.emptyBasemap)??!0}}initConfigLidar(t){var n,i;return(n=t.lidar)!=null&&n.url||console.info("No LiDAR URL"),{url:((i=t.lidar)==null?void 0:i.url)??"noLidarUrlInConfig"}}initConfigCsv(t){return{...{encoding:"utf-8",extension:".csv",includeHeader:!0,quote:"'",separator:","},...t.csv}}initConfigMetadata(t){return{...{metadataUrlPrefix:""},...t.metadata}}initConfigInfoWindow(t){return{...{defaultWindowWidth:"960px",defaultWindowHeight:"460px",defaultWindowPositionTop:"1rem",defaultWindowPositionLeft:"370px"},...t.infoWindow}}initConfigOffline(t){return t.offline}initConfigThemes(t){var n;if(!((n=t.themes)!=null&&n.url))throw new Error("Configuration for themes.url is required. See https://doc.geomapfish.dev/docs/configuration.");return{url:t.themes.url,defaultTheme:t.themes.defaultTheme??"",imagesUrlPrefix:t.themes.imagesUrlPrefix??"",showErrorsOnStart:t.themes.showErrorsOnStart??!1,selectionMode:t.themes.selectionMode??"replace"}}initConfigLanguages(t){if(!t.languages)throw new Error("Configuration for languages is required. See https://doc.geomapfish.dev/docs/configuration.");return t.languages}initConfigInterface(t){return{...{defaultSelectionComponent:"window",darkFrontendMode:void 0,darkMapMode:!1},...t.interface}}initConfigGeneral(t){return{locale:t.general.locale??vy.DEFAULT_LOCALE,logLevel:t.general.logLevel??"warn"}}initGmfOauth(t){if(t.gmfauth){if(!t.gmfauth.url)throw new Error("Configuration for gmfauth.url is required. See https://doc.geomapfish.dev/docs/configuration.");if(!t.gmfauth.audience)throw new Error("Configuration for gmfauth.audience is required. See https://doc.geomapfish.dev/docs/configuration.");return{url:t.gmfauth.url,audience:t.gmfauth.audience,loginRequired:t.gmfauth.loginRequired??!1,checkSessionOnLoad:t.gmfauth.checkSessionOnLoad??!0,authMode:"cookie",refererPolicy:t.gmfauth.refererPolicy??"strict-origin-when-cross-origin",audienceExcludedPaths:t.gmfauth.audienceExcludedPaths??[]}}}initConfigOauth(t){if(!t.oauth)return;if(!t.oauth.issuer.url)throw new Error("Configuration for oauth.issuer.url is required. See https://doc.geomapfish.dev/docs/configuration.");if(!t.oauth.issuer.clientId)throw new Error("Configuration for oauth.issuer.clientId is required. See https://doc.geomapfish.dev/docs/configuration.");if(!t.oauth.issuer.audience)throw new Error("Configuration for oauth.issuer.audience is required. See https://doc.geomapfish.dev/docs/configuration.");if(!t.oauth.geomapfish.userInfoUrl)throw new Error("Configuration for oauth.geomapfish.userInfoUrl is required. See https://doc.geomapfish.dev/docs/configuration.");const n={url:t.oauth.issuer.url,algorithm:t.oauth.issuer.algorithm??"oidc",codeChallengeMethod:t.oauth.issuer.codeChallengeMethod??"S256",clientId:t.oauth.issuer.clientId,scope:t.oauth.issuer.scope??"openid",loginRequired:t.oauth.issuer.loginRequired??!1,checkSessionOnLoad:t.oauth.issuer.checkSessionOnLoad??!1,audience:t.oauth.issuer.audience,audienceExcludedPaths:t.oauth.issuer.audienceExcludedPaths??[]},i={userInfoUrl:t.oauth.geomapfish.userInfoUrl,loginUrl:t.oauth.geomapfish.loginUrl,logoutUrl:t.oauth.geomapfish.logoutUrl,anonymousUsername:t.oauth.geomapfish.anonymousUsername,authMode:t.oauth.geomapfish.authMode??"cookie",refererPolicy:t.oauth.geomapfish.refererPolicy??"strict-origin-when-cross-origin"};return{issuer:n,geomapfish:i}}initUserData(t){return{...{source:"localStorage"},...t.userdata}}initContextMenu(t){var i,r;return{crs:((i=t.contextmenu)==null?void 0:i.crs)??[{code:"EPSG:4326",translation:"EPSG:4326",format:"decimal",precision:7},{code:"EPSG:4326",translation:"EPSG:4326-DMS",format:"dms",precision:2}],sources:((r=t.contextmenu)==null?void 0:r.sources)??[]}}initCRS(t){return t.crs}initExtendedConfig(t){return t.extendedConfig??void 0}};z(vy,"DEFAULT_LOCALE","en-US");let w_=vy;const il=(e,t)=>{let n=e,i=null,r=null;if(t.trim()!==""){const s=t.split(".");for(const o of s)if(o in n)i=n,r=o,n=n[o];else return{found:!1,object:null,parentObject:i,lastKey:r}}return{found:!0,object:n,parentObject:i,lastKey:r}},Nk=(e,t,n)=>{const i=il(e,t);return i.parentObject&&i.lastKey?(i.parentObject[i.lastKey]=n,!0):!1},Fk=e=>{const t=e.split("."),n={};let i=n;return t.forEach(r=>{i=r?i[r]={}:i}),n},KR=(e,t)=>{const n=il(e,t);if(n.found&&n.parentObject&&n.lastKey)delete n.parentObject[n.lastKey];else if(!n.found&&n.parentObject&&n.lastKey)if(Object.keys(n.parentObject[n.lastKey]).length===0)delete n.parentObject[n.lastKey];else return;else return;KR(e,t)},YE=(e,t)=>{for(const n in t)Object.prototype.hasOwnProperty.call(e,n)&&typeof e[n]=="object"&&typeof t[n]=="object"?YE(e[n],t[n]):e[n]=t[n];return e};class A_ extends ei{constructor(){super(...arguments);z(this,"storageKey",window.location.origin+window.location.pathname);z(this,"source");z(this,"WARNING_UNKNOWN_SOURCE","User data source isnât set");z(this,"WARNING_NOT_IMPLEMENTED","Server-side functionality is not implemented yet")}setSource(n){n==="localStorage"||n==="server"?this.source=n:console.warn(`User data source "${n}" not known`)}getUserData(n,i=!1){const r=this.load(i),{found:s,parentObject:o,lastKey:a}=il(r,n);return s&&o&&a?o[a]:void 0}saveUserData(n,i,r=!1){let s=this.load(r);if(!il(s,n).found){const o=Fk(n);s=YE(s,o)}Nk(s,n,i)&&this.save(s,r)}deleteUserData(n,i=!1){const r=this.load(i);KR(r,n),this.save(r,i)}deleteAllUserData(n=!1){this.isInLocalStorage(n)?localStorage.removeItem(this.storageKey):this.source==="server"?console.warn(this.WARNING_NOT_IMPLEMENTED):console.warn(this.WARNING_UNKNOWN_SOURCE)}load(n){if(this.isInLocalStorage(n)){const i=localStorage.getItem(this.storageKey);return i?JSON.parse(i):{}}else this.source==="server"?console.warn(this.WARNING_NOT_IMPLEMENTED):console.warn(this.WARNING_UNKNOWN_SOURCE);return{}}save(n,i){this.isInLocalStorage(i)?localStorage.setItem(this.storageKey,JSON.stringify(n)):this.source==="server"?console.warn(this.WARNING_NOT_IMPLEMENTED):console.warn(this.WARNING_UNKNOWN_SOURCE)}isInLocalStorage(n){return this.source==="localStorage"||n}}class fn extends ei{constructor(){super(...arguments);z(this,"config",null);z(this,"defaultConfig",null);z(this,"loadingPromise",null);z(this,"storagePathForOverrides","configOverrides");z(this,"isMobile",!1)}initMobile(){this.isMobile=!0}get Config(){return this.config}async loadConfig(){return this.loadingPromise?this.loadingPromise:this.config?Promise.resolve(this.config):(this.loadingPromise=(async()=>{let i=await(await fetch("config.json")).json();if(this.isMobile)try{const o=await(await fetch("config.mobile.json")).json();i=this.mergeConfigs(i,o)}catch{console.warn("No configuration found for mobile. Defaulting to desktop configuration.")}this.defaultConfig=new w_(structuredClone(i));const r=this.getConfigOverrides(this.defaultConfig.userdata.source);return i=this.mergeConfigs(i,r),this.config=new w_(i),console.log("Application Configuration loaded."),this.config})(),this.loadingPromise)}mergeConfigs(n,i){return YE(n,i)}getConfigOverrides(n){const i=A_.getInstance();return i.setSource(n),i.getUserData(this.storagePathForOverrides)||{}}getDefaultConfigValue(n){const{found:i,parentObject:r,lastKey:s}=il(this.defaultConfig,n);return i&&r&&s?r[s]:void 0}}/*! @license DOMPurify 3.1.7 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.1.7/LICENSE */const{entries:ZR,setPrototypeOf:_S,isFrozen:Bk,getPrototypeOf:zk,getOwnPropertyDescriptor:Uk}=Object;let{freeze:Br,seal:to,create:JR}=Object,{apply:_x,construct:yx}=typeof Reflect<"u"&&Reflect;Br||(Br=function(t){return t});to||(to=function(t){return t});_x||(_x=function(t,n,i){return t.apply(n,i)});yx||(yx=function(t,n){return new t(...n)});const Em=Es(Array.prototype.forEach),yS=Es(Array.prototype.pop),Yh=Es(Array.prototype.push),$g=Es(String.prototype.toLowerCase),Fb=Es(String.prototype.toString),bS=Es(String.prototype.match),Kh=Es(String.prototype.replace),kk=Es(String.prototype.indexOf),jk=Es(String.prototype.trim),bo=Es(Object.prototype.hasOwnProperty),Dr=Es(RegExp.prototype.test),Zh=Vk(TypeError);function Es(e){return function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return _x(e,t,i)}}function Vk(e){return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return yx(e,n)}}function Nt(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:$g;_S&&_S(e,null);let i=t.length;for(;i--;){let r=t[i];if(typeof r=="string"){const s=n(r);s!==r&&(Bk(t)||(t[i]=s),r=s)}e[r]=!0}return e}function Gk(e){for(let t=0;t<e.length;t++)bo(e,t)||(e[t]=null);return e}function su(e){const t=JR(null);for(const[n,i]of ZR(e))bo(e,n)&&(Array.isArray(i)?t[n]=Gk(i):i&&typeof i=="object"&&i.constructor===Object?t[n]=su(i):t[n]=i);return t}function Jh(e,t){for(;e!==null;){const i=Uk(e,t);if(i){if(i.get)return Es(i.get);if(typeof i.value=="function")return Es(i.value)}e=zk(e)}function n(){return null}return n}const TS=Br(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Bb=Br(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),zb=Br(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Hk=Br(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Ub=Br(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),qk=Br(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),xS=Br(["#text"]),ES=Br(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),kb=Br(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),CS=Br(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Cm=Br(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Wk=to(/\{\{[\w\W]*|[\w\W]*\}\}/gm),$k=to(/<%[\w\W]*|[\w\W]*%>/gm),Xk=to(/\${[\w\W]*}/gm),Yk=to(/^data-[\-\w.\u00B7-\uFFFF]/),Kk=to(/^aria-[\-\w]+$/),QR=to(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Zk=to(/^(?:\w+script|data):/i),Jk=to(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),eD=to(/^html$/i),Qk=to(/^[a-z][.\w]*(-[.\w]+)+$/i);var wS=Object.freeze({__proto__:null,MUSTACHE_EXPR:Wk,ERB_EXPR:$k,TMPLIT_EXPR:Xk,DATA_ATTR:Yk,ARIA_ATTR:Kk,IS_ALLOWED_URI:QR,IS_SCRIPT_OR_DATA:Zk,ATTR_WHITESPACE:Jk,DOCTYPE_NAME:eD,CUSTOM_ELEMENT:Qk});const Qh={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},e4=function(){return typeof window>"u"?null:window},t4=function(t,n){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let i=null;const r="data-tt-policy-suffix";n&&n.hasAttribute(r)&&(i=n.getAttribute(r));const s="dompurify"+(i?"#"+i:"");try{return t.createPolicy(s,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+s+" could not be created."),null}};function tD(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e4();const t=qe=>tD(qe);if(t.version="3.1.7",t.removed=[],!e||!e.document||e.document.nodeType!==Qh.document)return t.isSupported=!1,t;let{document:n}=e;const i=n,r=i.currentScript,{DocumentFragment:s,HTMLTemplateElement:o,Node:a,Element:c,NodeFilter:u,NamedNodeMap:h=e.NamedNodeMap||e.MozNamedAttrMap,HTMLFormElement:d,DOMParser:p,trustedTypes:g}=e,_=c.prototype,b=Jh(_,"cloneNode"),x=Jh(_,"remove"),E=Jh(_,"nextSibling"),C=Jh(_,"childNodes"),w=Jh(_,"parentNode");if(typeof o=="function"){const qe=n.createElement("template");qe.content&&qe.content.ownerDocument&&(n=qe.content.ownerDocument)}let S,v="";const{implementation:D,createNodeIterator:L,createDocumentFragment:O,getElementsByTagName:N}=n,{importNode:B}=i;let U={};t.isSupported=typeof ZR=="function"&&typeof w=="function"&&D&&D.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:V,ERB_EXPR:f,TMPLIT_EXPR:I,DATA_ATTR:F,ARIA_ATTR:G,IS_SCRIPT_OR_DATA:W,ATTR_WHITESPACE:X,CUSTOM_ELEMENT:Z}=wS;let{IS_ALLOWED_URI:$}=wS,ne=null;const le=Nt({},[...TS,...Bb,...zb,...Ub,...xS]);let pe=null;const we=Nt({},[...ES,...kb,...CS,...Cm]);let me=Object.seal(JR(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Pe=null,ot=null,At=!0,St=!0,he=!1,hn=!0,Sn=!1,rt=!0,ci=!1,Ki=!1,Xn=!1,Go=!1,ni=!1,Ho=!1,Sc=!0,uo=!1;const Bl="user-content-";let zl=!0,cn=!1,tn={},Yt=null;const Pn=Nt({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Pt=null;const qt=Nt({},["audio","video","img","source","image","track"]);let Nn=null;const Vn=Nt({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Zi="http://www.w3.org/1998/Math/MathML",Bi="http://www.w3.org/2000/svg",Fn="http://www.w3.org/1999/xhtml";let li=Fn,vn=!1,fr=null;const qr=Nt({},[Zi,Bi,Fn],Fb);let zi=null;const Ui=["application/xhtml+xml","text/html"],Ul="text/html";let gi=null,vc=null;const wb=n.createElement("form"),FA=function(J){return J instanceof RegExp||J instanceof Function},Ab=function(){let J=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(vc&&vc===J)){if((!J||typeof J!="object")&&(J={}),J=su(J),zi=Ui.indexOf(J.PARSER_MEDIA_TYPE)===-1?Ul:J.PARSER_MEDIA_TYPE,gi=zi==="application/xhtml+xml"?Fb:$g,ne=bo(J,"ALLOWED_TAGS")?Nt({},J.ALLOWED_TAGS,gi):le,pe=bo(J,"ALLOWED_ATTR")?Nt({},J.ALLOWED_ATTR,gi):we,fr=bo(J,"ALLOWED_NAMESPACES")?Nt({},J.ALLOWED_NAMESPACES,Fb):qr,Nn=bo(J,"ADD_URI_SAFE_ATTR")?Nt(su(Vn),J.ADD_URI_SAFE_ATTR,gi):Vn,Pt=bo(J,"ADD_DATA_URI_TAGS")?Nt(su(qt),J.ADD_DATA_URI_TAGS,gi):qt,Yt=bo(J,"FORBID_CONTENTS")?Nt({},J.FORBID_CONTENTS,gi):Pn,Pe=bo(J,"FORBID_TAGS")?Nt({},J.FORBID_TAGS,gi):{},ot=bo(J,"FORBID_ATTR")?Nt({},J.FORBID_ATTR,gi):{},tn=bo(J,"USE_PROFILES")?J.USE_PROFILES:!1,At=J.ALLOW_ARIA_ATTR!==!1,St=J.ALLOW_DATA_ATTR!==!1,he=J.ALLOW_UNKNOWN_PROTOCOLS||!1,hn=J.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Sn=J.SAFE_FOR_TEMPLATES||!1,rt=J.SAFE_FOR_XML!==!1,ci=J.WHOLE_DOCUMENT||!1,Go=J.RETURN_DOM||!1,ni=J.RETURN_DOM_FRAGMENT||!1,Ho=J.RETURN_TRUSTED_TYPE||!1,Xn=J.FORCE_BODY||!1,Sc=J.SANITIZE_DOM!==!1,uo=J.SANITIZE_NAMED_PROPS||!1,zl=J.KEEP_CONTENT!==!1,cn=J.IN_PLACE||!1,$=J.ALLOWED_URI_REGEXP||QR,li=J.NAMESPACE||Fn,me=J.CUSTOM_ELEMENT_HANDLING||{},J.CUSTOM_ELEMENT_HANDLING&&FA(J.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(me.tagNameCheck=J.CUSTOM_ELEMENT_HANDLING.tagNameCheck),J.CUSTOM_ELEMENT_HANDLING&&FA(J.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(me.attributeNameCheck=J.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),J.CUSTOM_ELEMENT_HANDLING&&typeof J.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(me.allowCustomizedBuiltInElements=J.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Sn&&(St=!1),ni&&(Go=!0),tn&&(ne=Nt({},xS),pe=[],tn.html===!0&&(Nt(ne,TS),Nt(pe,ES)),tn.svg===!0&&(Nt(ne,Bb),Nt(pe,kb),Nt(pe,Cm)),tn.svgFilters===!0&&(Nt(ne,zb),Nt(pe,kb),Nt(pe,Cm)),tn.mathMl===!0&&(Nt(ne,Ub),Nt(pe,CS),Nt(pe,Cm))),J.ADD_TAGS&&(ne===le&&(ne=su(ne)),Nt(ne,J.ADD_TAGS,gi)),J.ADD_ATTR&&(pe===we&&(pe=su(pe)),Nt(pe,J.ADD_ATTR,gi)),J.ADD_URI_SAFE_ATTR&&Nt(Nn,J.ADD_URI_SAFE_ATTR,gi),J.FORBID_CONTENTS&&(Yt===Pn&&(Yt=su(Yt)),Nt(Yt,J.FORBID_CONTENTS,gi)),zl&&(ne["#text"]=!0),ci&&Nt(ne,["html","head","body"]),ne.table&&(Nt(ne,["tbody"]),delete Pe.tbody),J.TRUSTED_TYPES_POLICY){if(typeof J.TRUSTED_TYPES_POLICY.createHTML!="function")throw Zh('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof J.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Zh('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');S=J.TRUSTED_TYPES_POLICY,v=S.createHTML("")}else S===void 0&&(S=t4(g,r)),S!==null&&typeof v=="string"&&(v=S.createHTML(""));Br&&Br(J),vc=J}},BA=Nt({},["mi","mo","mn","ms","mtext"]),zA=Nt({},["annotation-xml"]),hz=Nt({},["title","style","font","a","script"]),UA=Nt({},[...Bb,...zb,...Hk]),kA=Nt({},[...Ub,...qk]),dz=function(J){let xe=w(J);(!xe||!xe.tagName)&&(xe={namespaceURI:li,tagName:"template"});const ke=$g(J.tagName),In=$g(xe.tagName);return fr[J.namespaceURI]?J.namespaceURI===Bi?xe.namespaceURI===Fn?ke==="svg":xe.namespaceURI===Zi?ke==="svg"&&(In==="annotation-xml"||BA[In]):!!UA[ke]:J.namespaceURI===Zi?xe.namespaceURI===Fn?ke==="math":xe.namespaceURI===Bi?ke==="math"&&zA[In]:!!kA[ke]:J.namespaceURI===Fn?xe.namespaceURI===Bi&&!zA[In]||xe.namespaceURI===Zi&&!BA[In]?!1:!kA[ke]&&(hz[ke]||!UA[ke]):!!(zi==="application/xhtml+xml"&&fr[J.namespaceURI]):!1},qo=function(J){Yh(t.removed,{element:J});try{w(J).removeChild(J)}catch{x(J)}},ym=function(J,xe){try{Yh(t.removed,{attribute:xe.getAttributeNode(J),from:xe})}catch{Yh(t.removed,{attribute:null,from:xe})}if(xe.removeAttribute(J),J==="is"&&!pe[J])if(Go||ni)try{qo(xe)}catch{}else try{xe.setAttribute(J,"")}catch{}},jA=function(J){let xe=null,ke=null;if(Xn)J="<remove></remove>"+J;else{const Ji=bS(J,/^[\r\n\t ]+/);ke=Ji&&Ji[0]}zi==="application/xhtml+xml"&&li===Fn&&(J='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+J+"</body></html>");const In=S?S.createHTML(J):J;if(li===Fn)try{xe=new p().parseFromString(In,zi)}catch{}if(!xe||!xe.documentElement){xe=D.createDocument(li,"template",null);try{xe.documentElement.innerHTML=vn?v:In}catch{}}const hr=xe.body||xe.documentElement;return J&&ke&&hr.insertBefore(n.createTextNode(ke),hr.childNodes[0]||null),li===Fn?N.call(xe,ci?"html":"body")[0]:ci?xe.documentElement:hr},VA=function(J){return L.call(J.ownerDocument||J,J,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null)},GA=function(J){return J instanceof d&&(typeof J.nodeName!="string"||typeof J.textContent!="string"||typeof J.removeChild!="function"||!(J.attributes instanceof h)||typeof J.removeAttribute!="function"||typeof J.setAttribute!="function"||typeof J.namespaceURI!="string"||typeof J.insertBefore!="function"||typeof J.hasChildNodes!="function")},HA=function(J){return typeof a=="function"&&J instanceof a},Ma=function(J,xe,ke){U[J]&&Em(U[J],In=>{In.call(t,xe,ke,vc)})},qA=function(J){let xe=null;if(Ma("beforeSanitizeElements",J,null),GA(J))return qo(J),!0;const ke=gi(J.nodeName);if(Ma("uponSanitizeElement",J,{tagName:ke,allowedTags:ne}),J.hasChildNodes()&&!HA(J.firstElementChild)&&Dr(/<[/\w]/g,J.innerHTML)&&Dr(/<[/\w]/g,J.textContent)||J.nodeType===Qh.progressingInstruction||rt&&J.nodeType===Qh.comment&&Dr(/<[/\w]/g,J.data))return qo(J),!0;if(!ne[ke]||Pe[ke]){if(!Pe[ke]&&$A(ke)&&(me.tagNameCheck instanceof RegExp&&Dr(me.tagNameCheck,ke)||me.tagNameCheck instanceof Function&&me.tagNameCheck(ke)))return!1;if(zl&&!Yt[ke]){const In=w(J)||J.parentNode,hr=C(J)||J.childNodes;if(hr&&In){const Ji=hr.length;for(let Wr=Ji-1;Wr>=0;--Wr){const Wo=b(hr[Wr],!0);Wo.__removalCount=(J.__removalCount||0)+1,In.insertBefore(Wo,E(J))}}}return qo(J),!0}return J instanceof c&&!dz(J)||(ke==="noscript"||ke==="noembed"||ke==="noframes")&&Dr(/<\/no(script|embed|frames)/i,J.innerHTML)?(qo(J),!0):(Sn&&J.nodeType===Qh.text&&(xe=J.textContent,Em([V,f,I],In=>{xe=Kh(xe,In," ")}),J.textContent!==xe&&(Yh(t.removed,{element:J.cloneNode()}),J.textContent=xe)),Ma("afterSanitizeElements",J,null),!1)},WA=function(J,xe,ke){if(Sc&&(xe==="id"||xe==="name")&&(ke in n||ke in wb))return!1;if(!(St&&!ot[xe]&&Dr(F,xe))){if(!(At&&Dr(G,xe))){if(!pe[xe]||ot[xe]){if(!($A(J)&&(me.tagNameCheck instanceof RegExp&&Dr(me.tagNameCheck,J)||me.tagNameCheck instanceof Function&&me.tagNameCheck(J))&&(me.attributeNameCheck instanceof RegExp&&Dr(me.attributeNameCheck,xe)||me.attributeNameCheck instanceof Function&&me.attributeNameCheck(xe))||xe==="is"&&me.allowCustomizedBuiltInElements&&(me.tagNameCheck instanceof RegExp&&Dr(me.tagNameCheck,ke)||me.tagNameCheck instanceof Function&&me.tagNameCheck(ke))))return!1}else if(!Nn[xe]){if(!Dr($,Kh(ke,X,""))){if(!((xe==="src"||xe==="xlink:href"||xe==="href")&&J!=="script"&&kk(ke,"data:")===0&&Pt[J])){if(!(he&&!Dr(W,Kh(ke,X,"")))){if(ke)return!1}}}}}}return!0},$A=function(J){return J!=="annotation-xml"&&bS(J,Z)},XA=function(J){Ma("beforeSanitizeAttributes",J,null);const{attributes:xe}=J;if(!xe)return;const ke={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:pe};let In=xe.length;for(;In--;){const hr=xe[In],{name:Ji,namespaceURI:Wr,value:Wo}=hr,Wh=gi(Ji);let Rr=Ji==="value"?Wo:jk(Wo);if(ke.attrName=Wh,ke.attrValue=Rr,ke.keepAttr=!0,ke.forceKeepAttr=void 0,Ma("uponSanitizeAttribute",J,ke),Rr=ke.attrValue,ke.forceKeepAttr||(ym(Ji,J),!ke.keepAttr))continue;if(!hn&&Dr(/\/>/i,Rr)){ym(Ji,J);continue}Sn&&Em([V,f,I],KA=>{Rr=Kh(Rr,KA," ")});const YA=gi(J.nodeName);if(WA(YA,Wh,Rr)){if(uo&&(Wh==="id"||Wh==="name")&&(ym(Ji,J),Rr=Bl+Rr),rt&&Dr(/((--!?|])>)|<\/(style|title)/i,Rr)){ym(Ji,J);continue}if(S&&typeof g=="object"&&typeof g.getAttributeType=="function"&&!Wr)switch(g.getAttributeType(YA,Wh)){case"TrustedHTML":{Rr=S.createHTML(Rr);break}case"TrustedScriptURL":{Rr=S.createScriptURL(Rr);break}}try{Wr?J.setAttributeNS(Wr,Ji,Rr):J.setAttribute(Ji,Rr),GA(J)?qo(J):yS(t.removed)}catch{}}}Ma("afterSanitizeAttributes",J,null)},pz=function qe(J){let xe=null;const ke=VA(J);for(Ma("beforeSanitizeShadowDOM",J,null);xe=ke.nextNode();)Ma("uponSanitizeShadowNode",xe,null),!qA(xe)&&(xe.content instanceof s&&qe(xe.content),XA(xe));Ma("afterSanitizeShadowDOM",J,null)};return t.sanitize=function(qe){let J=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},xe=null,ke=null,In=null,hr=null;if(vn=!qe,vn&&(qe="<!-->"),typeof qe!="string"&&!HA(qe))if(typeof qe.toString=="function"){if(qe=qe.toString(),typeof qe!="string")throw Zh("dirty is not a string, aborting")}else throw Zh("toString is not a function");if(!t.isSupported)return qe;if(Ki||Ab(J),t.removed=[],typeof qe=="string"&&(cn=!1),cn){if(qe.nodeName){const Wo=gi(qe.nodeName);if(!ne[Wo]||Pe[Wo])throw Zh("root node is forbidden and cannot be sanitized in-place")}}else if(qe instanceof a)xe=jA("<!---->"),ke=xe.ownerDocument.importNode(qe,!0),ke.nodeType===Qh.element&&ke.nodeName==="BODY"||ke.nodeName==="HTML"?xe=ke:xe.appendChild(ke);else{if(!Go&&!Sn&&!ci&&qe.indexOf("<")===-1)return S&&Ho?S.createHTML(qe):qe;if(xe=jA(qe),!xe)return Go?null:Ho?v:""}xe&&Xn&&qo(xe.firstChild);const Ji=VA(cn?qe:xe);for(;In=Ji.nextNode();)qA(In)||(In.content instanceof s&&pz(In.content),XA(In));if(cn)return qe;if(Go){if(ni)for(hr=O.call(xe.ownerDocument);xe.firstChild;)hr.appendChild(xe.firstChild);else hr=xe;return(pe.shadowroot||pe.shadowrootmode)&&(hr=B.call(i,hr,!0)),hr}let Wr=ci?xe.outerHTML:xe.innerHTML;return ci&&ne["!doctype"]&&xe.ownerDocument&&xe.ownerDocument.doctype&&xe.ownerDocument.doctype.name&&Dr(eD,xe.ownerDocument.doctype.name)&&(Wr="<!DOCTYPE "+xe.ownerDocument.doctype.name+`>
`+Wr),Sn&&Em([V,f,I],Wo=>{Wr=Kh(Wr,Wo," ")}),S&&Ho?S.createHTML(Wr):Wr},t.setConfig=function(){let qe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ab(qe),Ki=!0},t.clearConfig=function(){vc=null,Ki=!1},t.isValidAttribute=function(qe,J,xe){vc||Ab({});const ke=gi(qe),In=gi(J);return WA(ke,In,xe)},t.addHook=function(qe,J){typeof J=="function"&&(U[qe]=U[qe]||[],Yh(U[qe],J))},t.removeHook=function(qe){if(U[qe])return yS(U[qe])},t.removeHooks=function(qe){U[qe]&&(U[qe]=[])},t.removeAllHooks=function(){U={}},t}var nD=tD();class S_{constructor(){z(this,"center",[]);z(this,"zoom",0);z(this,"resolution",100);z(this,"scale",0);z(this,"crosshair",!1);z(this,"tooltip")}get isValid(){return!(Number.isNaN(this.resolution)||!this.center[0]||!this.center[1]||Number.isNaN(this.center[0])||Number.isNaN(this.center[1]))}}function n4(){const e=new URL(window.location.href),t=e.searchParams.get("map_x"),n=e.searchParams.get("map_y"),i=e.searchParams.get("map_zoom"),r=e.searchParams.get("map_crosshair"),s=e.searchParams.get("map_tooltip");if(t&&n&&i){const o=new S_;return o.center=[parseFloat(t),parseFloat(n)],o.zoom=parseFloat(i),o.crosshair=r==="true",o.tooltip=nD.sanitize(s,{ALLOWED_TAGS:["br","b","div","em","i","p","strong"],ALLOWED_ATTR:[]})??void 0,o.isValid?o:void 0}}function i4(e){const t=new URL(window.location.href);t.searchParams.set("map_x",JSON.stringify(e.center[0])),t.searchParams.set("map_y",JSON.stringify(e.center[1])),t.searchParams.set("map_zoom",JSON.stringify(e.zoom)),window.history.replaceState({},"",t.toString())}class r4{constructor(){z(this,"themes",{_allThemes:{},isLoaded:!1,lastSelectedTheme:null});z(this,"basemaps",{});z(this,"ogcServers",{});z(this,"activeBasemap",null);z(this,"projection");z(this,"mouseCoordinates",[]);z(this,"interface",{helpVisible:!1,drawingPanelVisible:!1,printPanelVisible:!1,lidarPanelVisible:!1,crossSectionPanelVisible:!1,sharePanelVisible:!1,selectionComponentVisible:!1,selectionComponent:"",layoutPanelVisible:!1,aboutPanelVisible:!1,userPreferencesPanelVisible:!1,infoWindowVisible:!1,darkMapMode:!1,darkFrontendMode:!1});z(this,"userInteractionListeners",[]);z(this,"language",null);z(this,"lidar",{line:null,drawActive:!1});z(this,"loading",!1);z(this,"sharedStateIsLoaded",!1);z(this,"position",new S_);z(this,"layers",{layersList:[]});z(this,"treeview",{advanced:!1,renderEnabled:!0});z(this,"print",{maskVisible:!1,pageSize:null,format:null,scale:null,dpi:null});z(this,"globe",{display:"2D",loaded:!1,shadows:!1,shadowsTimestamp:new Date().valueOf()});z(this,"selection",{selectionParameters:[],selectedFeatures:[],focusedFeatures:null,gridSelected:!1});z(this,"theme",null);z(this,"infobox",{elements:[]});z(this,"infoWindow",{title:null,url:null,width:null,height:null,top:null,left:null});z(this,"isOffline",!1);z(this,"oauth",{status:"loggedOut",audience:[]});z(this,"extendedState",{})}}const Gc=".",KE=Symbol("target"),iD=Symbol("unsubscribe");function bx(e){return e instanceof Date||e instanceof Set||e instanceof Map||e instanceof WeakSet||e instanceof WeakMap||ArrayBuffer.isView(e)}function s4(e){return(typeof e=="object"?e===null:typeof e!="function")||e instanceof RegExp}const Lr=Array.isArray;function v_(e){return typeof e=="symbol"}const Qr={after(e,t){return Lr(e)?e.slice(t.length):t===""?e:e.slice(t.length+1)},concat(e,t){return Lr(e)?(e=[...e],t&&e.push(t),e):t&&t.toString!==void 0?(e!==""&&(e+=Gc),v_(t)?e+t.toString():e+t):e},initial(e){if(Lr(e))return e.slice(0,-1);if(e==="")return e;const t=e.lastIndexOf(Gc);return t===-1?"":e.slice(0,t)},last(e){if(Lr(e))return e.at(-1)??"";if(e==="")return e;const t=e.lastIndexOf(Gc);return t===-1?e:e.slice(t+1)},walk(e,t){if(Lr(e))for(const n of e)t(n);else if(e!==""){let n=0,i=e.indexOf(Gc);if(i===-1)t(e);else for(;n<e.length;)i===-1&&(i=e.length),t(e.slice(n,i)),n=i+1,i=e.indexOf(Gc,n)}},get(e,t){return this.walk(t,n=>{e&&(e=e[n])}),e},isSubPath(e,t){if(Lr(e)){if(e.length<t.length)return!1;for(let n=0;n<t.length;n++)if(e[n]!==t[n])return!1;return!0}return e.length<t.length?!1:e===t?!0:e.startsWith(t)?e[t.length]===Gc:!1},isRootPath(e){return Lr(e)?e.length===0:e===""}};function o4(e){return typeof e=="object"&&typeof e.next=="function"}function a4(e,t,n,i,r){const s=e.next;if(t.name==="entries")e.next=function(){const o=s.call(this);return o.done===!1&&(o.value[0]=r(o.value[0],t,o.value[0],i),o.value[1]=r(o.value[1],t,o.value[0],i)),o};else if(t.name==="values"){const o=n[KE].keys();e.next=function(){const a=s.call(this);return a.done===!1&&(a.value=r(a.value,t,o.next().value,i)),a}}else e.next=function(){const o=s.call(this);return o.done===!1&&(o.value=r(o.value,t,o.value,i)),o};return e}function AS(e,t,n){return e.isUnsubscribed||t.ignoreSymbols&&v_(n)||t.ignoreUnderscores&&n.charAt(0)==="_"||"ignoreKeys"in t&&t.ignoreKeys.includes(n)}class c4{constructor(t){this._equals=t,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return this._descriptorCache===void 0&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(t){const n=this._getDescriptorCache();let i=n.get(t);return i===void 0&&(i={},n.set(t,i)),i}_getOwnPropertyDescriptor(t,n){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(t,n);const i=this._getProperties(t);let r=i[n];return r===void 0&&(r=Reflect.getOwnPropertyDescriptor(t,n),i[n]=r),r}getProxy(t,n,i,r){if(this.isUnsubscribed)return t;const s=t[r],o=s??t;this._pathCache.set(o,n);let a=this._proxyCache.get(o);return a===void 0&&(a=s===void 0?new Proxy(t,i):t,this._proxyCache.set(o,a)),a}getPath(t){return this.isUnsubscribed?void 0:this._pathCache.get(t)}isDetached(t,n){return!Object.is(t,Qr.get(n,this.getPath(t)))}defineProperty(t,n,i){return Reflect.defineProperty(t,n,i)?(this.isUnsubscribed||(this._getProperties(t)[n]=i),!0):!1}setProperty(t,n,i,r,s){if(!this._equals(s,i)||!(n in t)){const o=this._getOwnPropertyDescriptor(t,n);return o!==void 0&&"set"in o?Reflect.set(t,n,i,r):Reflect.set(t,n,i)}return!0}deleteProperty(t,n,i){if(Reflect.deleteProperty(t,n)){if(!this.isUnsubscribed){const r=this._getDescriptorCache().get(t);r&&(delete r[n],this._pathCache.delete(i))}return!0}return!1}isSameDescriptor(t,n,i){const r=this._getOwnPropertyDescriptor(n,i);return t!==void 0&&r!==void 0&&Object.is(t.value,r.value)&&(t.writable||!1)===(r.writable||!1)&&(t.enumerable||!1)===(r.enumerable||!1)&&(t.configurable||!1)===(r.configurable||!1)&&t.get===r.get&&t.set===r.set}isGetInvariant(t,n){const i=this._getOwnPropertyDescriptor(t,n);return i!==void 0&&i.configurable!==!0&&i.writable!==!0}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}}function Tx(e){return toString.call(e)==="[object Object]"}function wm(){return!0}function Hu(e,t){return e.length!==t.length||e.some((n,i)=>t[i]!==n)}const rD=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),l4=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),sD={push:wm,pop:wm,shift:wm,unshift:wm,copyWithin:Hu,reverse:Hu,sort:Hu,splice:Hu,flat:Hu,fill:Hu},u4=new Set([...rD,...l4,...Object.keys(sD)]);function Am(e,t){if(e.size!==t.size)return!0;for(const n of e)if(!t.has(n))return!0;return!1}const oD=["keys","values","entries"],aD=new Set(["has","toString"]),cD={add:Am,clear:Am,delete:Am,forEach:Am},f4=new Set([...aD,...Object.keys(cD),...oD]);function Sm(e,t){if(e.size!==t.size)return!0;let n;for(const[i,r]of e)if(n=t.get(i),n!==r||n===void 0&&!t.has(i))return!0;return!1}const h4=new Set([...aD,"get"]),lD={set:Sm,clear:Sm,delete:Sm,forEach:Sm},d4=new Set([...h4,...Object.keys(lD),...oD]);class _l{constructor(t,n,i,r){this._path=n,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=r,this._changes=r?[]:null,this.clone=n===void 0?t:this._shallowClone(t)}static isHandledMethod(t){return rD.has(t)}_shallowClone(t){let n=t;if(Tx(t))n={...t};else if(Lr(t)||ArrayBuffer.isView(t))n=[...t];else if(t instanceof Date)n=new Date(t);else if(t instanceof Set)n=new Set([...t].map(i=>this._shallowClone(i)));else if(t instanceof Map){n=new Map;for(const[i,r]of t.entries())n.set(i,this._shallowClone(r))}return this._clonedCache.add(n),n}preferredThisArg(t,n,i,r){return t?(Lr(r)?this._onIsChanged=sD[n]:r instanceof Set?this._onIsChanged=cD[n]:r instanceof Map&&(this._onIsChanged=lD[n]),r):i}update(t,n,i){const r=Qr.after(t,this._path);if(n!=="length"){let s=this.clone;Qr.walk(r,o=>{s!=null&&s[o]&&(this._clonedCache.has(s[o])||(s[o]=this._shallowClone(s[o])),s=s[o])}),this._hasOnValidate&&this._changes.push({path:r,property:n,previous:i}),s!=null&&s[n]&&(s[n]=i)}this._isChanged=!0}undo(t){let n;for(let i=this._changes.length-1;i!==-1;i--)n=this._changes[i],Qr.get(t,n.path)[n.property]=n.previous}isChanged(t){return this._onIsChanged===void 0?this._isChanged:this._onIsChanged(this.clone,t)}isPathApplicable(t){return Qr.isRootPath(this._path)||Qr.isSubPath(t,this._path)}}class SS extends _l{static isHandledMethod(t){return u4.has(t)}}class p4 extends _l{undo(t){t.setTime(this.clone.getTime())}isChanged(t,n){return!n(this.clone.valueOf(),t.valueOf())}}class vS extends _l{static isHandledMethod(t){return f4.has(t)}undo(t){for(const n of this.clone)t.add(n);for(const n of t)this.clone.has(n)||t.delete(n)}}class IS extends _l{static isHandledMethod(t){return d4.has(t)}undo(t){for(const[n,i]of this.clone.entries())t.set(n,i);for(const n of t.keys())this.clone.has(n)||t.delete(n)}}class m4 extends _l{constructor(t,n,i,r){super(void 0,n,i,r),this._argument1=i[0],this._weakValue=t.has(this._argument1)}isChanged(t){return this._weakValue!==t.has(this._argument1)}undo(t){this._weakValue&&!t.has(this._argument1)?t.add(this._argument1):t.delete(this._argument1)}}class g4 extends _l{constructor(t,n,i,r){super(void 0,n,i,r),this._weakKey=i[0],this._weakHas=t.has(this._weakKey),this._weakValue=t.get(this._weakKey)}isChanged(t){return this._weakValue!==t.get(this._weakKey)}undo(t){const n=t.has(this._weakKey);this._weakHas&&!n?t.set(this._weakKey,this._weakValue):!this._weakHas&&n?t.delete(this._weakKey):this._weakValue!==t.get(this._weakKey)&&t.set(this._weakKey,this._weakValue)}}class lu{constructor(t){this._stack=[],this._hasOnValidate=t}static isHandledType(t){return Tx(t)||Lr(t)||bx(t)}static isHandledMethod(t,n){return Tx(t)?_l.isHandledMethod(n):Lr(t)?SS.isHandledMethod(n):t instanceof Set?vS.isHandledMethod(n):t instanceof Map?IS.isHandledMethod(n):bx(t)}get isCloning(){return this._stack.length>0}start(t,n,i){let r=_l;Lr(t)?r=SS:t instanceof Date?r=p4:t instanceof Set?r=vS:t instanceof Map?r=IS:t instanceof WeakSet?r=m4:t instanceof WeakMap&&(r=g4),this._stack.push(new r(t,n,i,this._hasOnValidate))}update(t,n,i){this._stack.at(-1).update(t,n,i)}preferredThisArg(t,n,i){const{name:r}=t,s=lu.isHandledMethod(i,r);return this._stack.at(-1).preferredThisArg(s,r,n,i)}isChanged(t,n,i){return this._stack.at(-1).isChanged(t,n,i)}isPartOfClone(t){return this._stack.at(-1).isPathApplicable(t)}undo(t){this._previousClone!==void 0&&this._previousClone.undo(t)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}}const _4={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},ZE=(e,t,n={})=>{n={..._4,...n};const i=Symbol("ProxyTarget"),{equals:r,isShallow:s,ignoreDetached:o,details:a}=n,c=new c4(r),u=typeof n.onValidate=="function",h=new lu(u),d=(w,S,v,D,L)=>!u||h.isCloning||n.onValidate(Qr.concat(c.getPath(w),S),v,D,L)===!0,p=(w,S,v,D)=>{!AS(c,n,S)&&!(o&&c.isDetached(w,e))&&g(c.getPath(w),S,v,D)},g=(w,S,v,D,L)=>{h.isCloning&&h.isPartOfClone(w)?h.update(w,S,D):t(Qr.concat(w,S),v,D,L)},_=w=>w&&(w[i]??w),b=(w,S,v,D)=>{if(s4(w)||v==="constructor"||s&&!lu.isHandledMethod(S,v)||AS(c,n,v)||c.isGetInvariant(S,v)||o&&c.isDetached(S,e))return w;D===void 0&&(D=c.getPath(S));const L=Qr.concat(D,v),O=c.getPath(w);return O&&x(L,O)?c.getProxy(w,O,E,i):c.getProxy(w,L,E,i)},x=(w,S)=>{if(v_(w)||w.length<=S.length||Lr(S)&&S.length===0)return!1;const v=Lr(w)?w:w.split(Gc),D=Lr(S)?S:S.split(Gc);return v.length<=D.length?!1:!D.some((L,O)=>L!==v[O])},E={get(w,S,v){if(v_(S)){if(S===i||S===KE)return w;if(S===iD&&!c.isUnsubscribed&&c.getPath(w).length===0)return c.unsubscribe(),w}const D=bx(w)?Reflect.get(w,S):Reflect.get(w,S,v);return b(D,w,S)},set(w,S,v,D){v=_(v);const L=w[i]??w,O=L[S];if(r(O,v)&&S in w)return!0;const N=d(w,S,v,O);return N&&c.setProperty(L,S,v,D,O)?(p(w,S,w[S],O),!0):!N},defineProperty(w,S,v){if(!c.isSameDescriptor(v,w,S)){const D=w[S];d(w,S,v.value,D)&&c.defineProperty(w,S,v,D)&&p(w,S,v.value,D)}return!0},deleteProperty(w,S){if(!Reflect.has(w,S))return!0;const v=Reflect.get(w,S),D=d(w,S,void 0,v);return D&&c.deleteProperty(w,S,v)?(p(w,S,void 0,v),!0):!D},apply(w,S,v){const D=S[i]??S;if(c.isUnsubscribed)return Reflect.apply(w,D,v);if((a===!1||a!==!0&&!a.includes(w.name))&&lu.isHandledType(D)){let L=Qr.initial(c.getPath(w));const O=lu.isHandledMethod(D,w.name);h.start(D,L,v);let N=Reflect.apply(w,h.preferredThisArg(w,S,D),O?v.map(V=>_(V)):v);const B=h.isChanged(D,r),U=h.stop();if(lu.isHandledType(N)&&O&&(S instanceof Map&&w.name==="get"&&(L=Qr.concat(L,v[0])),N=c.getProxy(N,L,E)),B){const V={name:w.name,args:v,result:N},f=h.isCloning?Qr.initial(L):L,I=h.isCloning?Qr.last(L):"";d(Qr.get(e,f),I,D,U,V)?g(f,I,D,U,V):h.undo(D)}return(S instanceof Map||S instanceof Set)&&o4(N)?a4(N,w,S,L,b):N}return Reflect.apply(w,S,v)}},C=c.getProxy(e,n.pathAsArray?[]:"",E);return t=t.bind(C),u&&(n.onValidate=n.onValidate.bind(C)),C};ZE.target=e=>(e==null?void 0:e[KE])??e;ZE.unsubscribe=e=>(e==null?void 0:e[iD])??e;var Zf,kp,ks;class An extends ei{constructor(n){super(n);fo(this,Zf,null);fo(this,kp);fo(this,ks,{});z(this,"configManager");this.configManager=fn.getInstance(),$h(this,Zf,new r4),$h(this,kp,ZE(ui(this,Zf),(i,r,s,o)=>{this.areEqual(s,r)||(console.debug(`${i} has changed.`),this.onChange(i,s,r))},{ignoreUnderscores:!0,ignoreSymbols:!0,ignoreDetached:!0})),Object.preventExtensions(ui(this,Zf)),this.setDefaultValues()}get state(){return ui(this,kp)}setDefaultValues(){var n;(n=this.configManager)==null||n.loadConfig().then(()=>{var r;const i=(r=this.configManager)==null?void 0:r.Config;this.state&&i&&(this.state.projection=i.map.srid,this.state.language=i.languages.defaultLanguage,this.state.interface.selectionComponent=i.interface.defaultSelectionComponent)})}onChange(n,i,r){const s=n.trim();for(const o in ui(this,ks)){const a=new RegExp("^"+o+"$");if(s.match(a)){const c=s.lastIndexOf("."),u=s.substring(0,c),h=s.substring(c+1),d=il(this.state,u);d.found?r=d.object[h]:console.warn("Parent object could not be found in the state");const p=ui(this,ks)[o];for(const g of p)g(i,r,d.object)}}}subscribe(n,i){const r=typeof n=="string"?n:n.source;r in ui(this,ks)||(ui(this,ks)[r]=[]),ui(this,ks)[r].push(i),console.debug(`Subscribing to ${n}. ${ui(this,ks)[r].length} are currently subscribing ${r}.`);const s=il(this.state,r);if(s.found&&!(s.object===null||s.object===void 0||Array.isArray(s.object)&&s.object.length===0||s.object instanceof Object&&Object.keys(s.object).length===0)){const o=r.substring(0,r.lastIndexOf(".")),a=il(this.state,o);i(null,s.object,a.object)}return i}unsubscribe(n){(Array.isArray(n)?n:[n]).forEach(i=>{let r=!1;for(const s in ui(this,ks)){const o=ui(this,ks)[s],a=o.indexOf(i);a!==-1&&(r=!0,o.splice(a,1),console.debug(`Unsubscribing to ${s}. ${ui(this,ks)[s].length} subscribtions remaining.`))}if(!r)throw Error("Cannot unsubscribe this callback : it does not exist")})}areEqual(n,i,r=new WeakSet){let s;if(s=this.areNumbersEqual(n,i),s!==void 0||(s=this.areNullOrUndefinedEqual(n,i),s!==void 0)||(s=this.areSimpleValuesEqual(n,i),s!==void 0)||(s=this.areCircularReferencesEqual(n,i,r),s!==void 0)||(r.add(n),r.add(i),s=this.areArraysEqual(n,i,r),s!==void 0)||(s=this.areObjectsEqual(n,i,r),s!==void 0))return s;throw Error("Unmanaged case for equality check")}areNumbersEqual(n,i){if(typeof n=="number"&&typeof i=="number")return Number.isNaN(n)&&Number.isNaN(i)?!0:n===i}areNullOrUndefinedEqual(n,i){if(n===null||i===null||n===void 0||i===void 0)return n===i}areSimpleValuesEqual(n,i){if(typeof n!="object"||typeof i!="object")return n===i}areCircularReferencesEqual(n,i,r){if(r.has(n)||r.has(i))return n===i}areArraysEqual(n,i,r){if(Array.isArray(n)&&Array.isArray(i)){if(n.length!==i.length)return!1;for(let s=0;s<n.length;s++)if(!this.areEqual(n[s],i[s],r))return!1;return!0}}areObjectsEqual(n,i,r){if(typeof n=="object"&&typeof i=="object"){const s=Object.keys(n).filter(a=>!a.startsWith("_")),o=Object.keys(i).filter(a=>!a.startsWith("_"));if(s.length!==o.length)return!1;for(const a of s)if(!i.hasOwnProperty(a)||!this.areEqual(n[a],i[a],r))return!1;return!0}}}Zf=new WeakMap,kp=new WeakMap,ks=new WeakMap;class Jf extends ei{constructor(n){super(n);z(this,"translations",{});z(this,"loadingLanguagePromise",null);z(this,"configManager");z(this,"stateManager");this.configManager=fn.getInstance(),this.stateManager=An.getInstance(),this.stateManager.subscribe("language",()=>this.handleLanguageChange()),this.handleLanguageChange()}formatNumber(n){return parseFloat(`${n}`).toLocaleString(this.configManager.Config.general.locale)}async loadTranslations(n){return this.loadingLanguagePromise?this.loadingLanguagePromise:n in this.translations?Promise.resolve(this.translations[n]):(this.loadingLanguagePromise=this.configManager.loadConfig().then(async()=>{var i;if((i=this.configManager.Config)!=null&&i.languages.translations&&n in this.configManager.Config.languages.translations){let r={};for(const s of this.configManager.Config.languages.translations[n]){const a=await(await fetch(s)).json();r={...r,...a[n]}}return this.translations[n]=r,this.loadingLanguagePromise=null,this.translations[n]}else throw new Error("No languages found in config.json")}),this.loadingLanguagePromise)}getTranslation(n){var o,a;const i=((a=(o=this.stateManager)==null?void 0:o.state)==null?void 0:a.language)??"en",r=this.translations[i],s=r?r[n]:null;return s??n}async translate(n){var r;if(!((r=this.stateManager.state)!=null&&r.language))return;await this.loadTranslations(this.stateManager.state.language),n.querySelectorAll("[i18n]").forEach(s=>{const o=s.getAttribute("i18n");if(!o)return;let a;s.hasAttribute("i18nFn")?a=this.getFnTranslated(s,o):a=this.getTranslation(o),s.hasAttribute("placeholder")?s.setAttribute("placeholder",a):s.innerHTML=a})}handleLanguageChange(){const n=this.stateManager.state.language;if(!n)return;const i=document.querySelector("html[lang]");i==null||i.setAttribute("lang",n)}getFnTranslated(n,i){return n.getAttribute("i18nFn")==="formatNumber"?this.formatNumber(i):i}}class uD extends ei{constructor(){super(...arguments);z(this,"components",{});z(this,"registeredCallbacks",[]);z(this,"registeredCallbacksClasses",[])}registerComponent(n){this.components[n.name]==null&&(this.components[n.name]=[]),this.components[n.name].push(n);for(let i=0;i<this.registeredCallbacksClasses.length;i++)n instanceof this.registeredCallbacksClasses[i]&&this.registeredCallbacks[i].forEach(r=>r(n))}getComponents(n){return Object.values(this.components).flat().filter(i=>i instanceof n)}getComponentsByName(n){return this.components[n]}}const y4={"map.select":["map.mouseclick","map.mouseclick.ctrl","map.mouseclick.shift"],"map.draw":["map.mouseclick","map.mousedoubleclick"],"map.modify":["map.mouseclick"]},fD=(e,t)=>(e instanceof _z&&e.originalEvent&&(e=e.originalEvent),(e instanceof PointerEvent&&e.isPrimary||e instanceof MouseEvent)&&e.button===t),Rwe=e=>fD(e,0),Dwe=e=>fD(e,2);class hD extends ei{constructor(){super(...arguments);z(this,"state",An.getInstance().state)}get listenersInState(){return this.state.userInteractionListeners}registerListener(n,i,r){return this.isListenerRegistered(n,r)?!1:(i&&this.getExclusiveListenersForEvent(n,r).forEach(s=>this.unregisterListener(s.eventName,s.toolName)),this.listenersInState.push({eventName:n,isExclusive:i,toolName:r}),!0)}unregisterListener(n,i){const r=this.listenersInState.findIndex(s=>s.eventName===n&&s.toolName===i);r>-1&&this.state.userInteractionListeners.splice(r,1)}unregisterAllListenersOfTool(n){this.listenersInState.filter(i=>i.toolName===n).forEach(i=>this.unregisterListener(i.eventName,i.toolName))}canListenerExecute(n,i){return!(!this.isListenerRegistered(n,i)||this.getExclusiveListenersForEvent(n,i).length>0)}isListenerRegistered(n,i){return this.listenersInState.find(r=>r.eventName===n&&r.toolName===i)!==void 0}getDependentEvents(n){return[...y4[n]??[],n]}isEventDependentOn(n,i){return this.getDependentEvents(n).includes(i)}getExclusiveListenersForEvent(n,i){return this.listenersInState.filter(r=>this.isEventDependentOn(r.eventName,n)&&r.isExclusive&&r.toolName!==(i??void 0))}}class b4 extends HTMLElement{constructor(n){super();z(this,"templateUrl",null);z(this,"styleUrl",null);z(this,"template");z(this,"name");z(this,"shadow");z(this,"displayStyle");z(this,"timeoutId");z(this,"rendered",!1);z(this,"callbacks",[]);z(this,"activeTooltips",[]);z(this,"configManager");z(this,"stateManager");z(this,"componentManager");z(this,"userInteractionManager");z(this,"unsafeCache",new Map);this.name=n,this.configManager=fn.getInstance(),this.stateManager=An.getInstance(),this.componentManager=uD.getInstance(),this.userInteractionManager=hD.getInstance(),this.componentManager.registerComponent(this),this.shadow=this.attachShadow({mode:"open"}),this.subscribe("language",(i,r)=>this.girafeTranslate())}get state(){return this.stateManager.state}getById(n){return this.shadow.querySelector("#"+n)}async loadConfig(){await this.configManager.loadConfig()}girafeTranslate(){Jf.getInstance().translate(this.shadow).then(()=>{for(const n of this.activeTooltips)n.setContent(Jf.getInstance().getTranslation(n.props.content))})}isNullOrUndefined(n){return n==null}isNullOrUndefinedOrBlank(n){return n==null||n===""}getParentOfType(n,i,r=i){if(i===null||i!==r&&i.nodeName===n)return i;let s=null;return i instanceof ShadowRoot?s=i.host:s=i.parentNode,this.getParentOfType(n,s,i)}activateTooltips(n,i,r){for(const o of this.activeTooltips)o.destroy();this.activeTooltips=[],Array.from(this.shadow.querySelectorAll("[tip]")).forEach(o=>{const a=o.getAttribute("tip");if(a&&a!==""){const c=o.getAttribute("tip-placement")??r,u=o.getAttribute("tip-theme")??"",h=yz(o,{arrow:n,delay:i,placement:c,theme:u,content:a});this.activeTooltips.push(h)}})}render(){this.template?(this.defineDisplayStyle(),this.show(),Nb(this.shadow,this.template),this.rendered=!0):console.warn(`Cannot render: no template has been defined for component ${this.name}.`)}refreshRender(){if(!this.rendered)throw Error("Component cannot be re-rendered. Please call render() first.");this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{Nb(this.shadow,this.template),this.girafeTranslate()})}renderEmpty(){this.defineDisplayStyle(),this.hide(),Nb(this.shadow,gx`<span style="display: none">${this.name}</span>`),this.rendered=!1}htmlUnsafe(n){const i=this.getUnsafeTemplate(n);return gx(i)}getUnsafeTemplate(n){let i=this.unsafeCache.get(n);return i||(i=[n],this.unsafeCache.set(n,i)),i}defineDisplayStyle(){this.displayStyle||(this.displayStyle=getComputedStyle(this).display??"block",this.displayStyle==="none"&&(this.displayStyle="block"))}simulateClick(n){if(n.key==="Enter"||n.key===" "){n.preventDefault();const i=n.target;i&&i.click()}}hide(){this.style.display="none",this.unregisterInteractionListeners()}show(){this.displayStyle&&(this.style.display=this.displayStyle)}serialize(){return{}}deserialize(n){}subscribe(n,i){const r=this.stateManager.subscribe(n,i);return this.callbacks.push(r),r}unsubscribe(n){(Array.isArray(n)?n:[n]).forEach(i=>{const r=this.callbacks.findIndex(s=>s===i);r>=0&&(this.stateManager.unsubscribe(i),this.callbacks.splice(r,1))})}disconnectedCallback(){for(const n of this.callbacks)this.stateManager.unsubscribe(n);this.callbacks.length=0,this.unregisterInteractionListeners()}registerInteractionListener(n,i){return this.userInteractionManager.registerListener(n,i,this.name)}unregisterInteractionListeners(n){n||this.userInteractionManager.unregisterAllListenersOfTool(this.name),Array.isArray(n)||(n=[n]),n.forEach(i=>this.userInteractionManager.unregisterListener(i,this.name))}canExecute(n){return this.userInteractionManager.canListenerExecute(n,this.name)}}/*! (c) Andrea Giammarchi - MIT */const OS=new WeakMap,T4=e=>(t,n)=>{function i(s,...o){return new My(e,s,o).toDOM(this)}const r=OS.get(t)||mp(OS,t,new Map);return r.get(n)||mp(r,n,i.bind(xh()))},Mwe=T4(!1),Qi=[];for(let e=0;e<256;++e)Qi.push((e+256).toString(16).slice(1));function x4(e,t=0){return(Qi[e[t+0]]+Qi[e[t+1]]+Qi[e[t+2]]+Qi[e[t+3]]+"-"+Qi[e[t+4]]+Qi[e[t+5]]+"-"+Qi[e[t+6]]+Qi[e[t+7]]+"-"+Qi[e[t+8]]+Qi[e[t+9]]+"-"+Qi[e[t+10]]+Qi[e[t+11]]+Qi[e[t+12]]+Qi[e[t+13]]+Qi[e[t+14]]+Qi[e[t+15]]).toLowerCase()}let jb;const E4=new Uint8Array(16);function C4(){if(!jb){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");jb=crypto.getRandomValues.bind(crypto)}return jb(E4)}const w4=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),RS={randomUUID:w4};function wu(e,t,n){if(RS.randomUUID&&!t&&!e)return RS.randomUUID();e=e||{};const i=e.random||(e.rng||C4)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,x4(i)}class JE{constructor(t,n,i,r){z(this,"id");z(this,"treeItemId");z(this,"name");z(this,"order");z(this,"isDefaultChecked");z(this,"disclaimer");z(this,"metadataUrl");z(this,"isVisible",!0);z(this,"hasError",!1);z(this,"errorMessage",null);z(this,"parent");this.id=t,this.treeItemId=wu(),this.name=n,this.order=i,this.isDefaultChecked=(r==null?void 0:r.isDefaultChecked)||!1,this.disclaimer=r==null?void 0:r.disclaimer,this.metadataUrl=this.calculateMetadataUrl(r==null?void 0:r.metadataUrl)}get hasMetadata(){return this.metadataUrl!==void 0}calculateMetadataUrl(t){if(t)return!t.startsWith("http")&&fn.getInstance().Config.metadata.metadataUrlPrefix?fn.getInstance().Config.metadata.metadataUrlPrefix+t:t}get className(){return this.constructor.name}}const ed="/",A4="1900-01-01T00:00:00.000Z",S4="2100-01-01T00:00:00.000Z";class On{constructor(t){z(this,"minValue");z(this,"maxValue");z(this,"resolution");z(this,"mode");z(this,"minDefaultValue");z(this,"maxDefaultValue");this.minValue=new Date((t==null?void 0:t.minValue)??A4),this.maxValue=new Date((t==null?void 0:t.maxValue)??S4),this.resolution=(t==null?void 0:t.resolution)??"month",this.mode=(t==null?void 0:t.mode)??"range",this.minDefaultValue=t!=null&&t.minDefValue?new Date(t==null?void 0:t.minDefValue):void 0,this.maxDefaultValue=t!=null&&t.maxDefValue?new Date(t==null?void 0:t.maxDefValue):void 0}formatDateString(t){let n;return typeof t=="string"?n=this.parseDateString(t):n=t,n&&this.isWithinRange(n)?On.queryStringFromSingleValueAndResolution(n,this.resolution):""}formatTimeRange(t,n){if(this.mode==="range"){let i,r;if(typeof t=="string"?i=this.parseDateString(t):i=t,typeof n=="string"?r=this.parseDateString(n):r=n,i&&this.isWithinRange(i)&&r&&this.isWithinRange(r))return On.queryStringFromDateRangeAnResolution(i,r,this.resolution)}return""}parseDateString(t){if(this.isValidDateString(t))return new Date(t)}getFormattedDefault(){if(this.mode==="range"&&this.minDefaultValue&&this.maxDefaultValue)return this.formatTimeRange(this.minDefaultValue,this.maxDefaultValue);if(this.mode==="value"&&this.minDefaultValue)return this.formatDateString(this.minDefaultValue)}toOpenLayersWfsFilter(t,n){let i=t.split("/")[0],r=t.split("/")[1]??void 0,s;if(this.mode==="range")s=JA(n,i,r);else{const o=this.parseDateString(t);if(!o)return s;switch(this.resolution){case"day":i=o.toISOString(),o.setUTCDate(o.getUTCDay()+1),o.setUTCMilliseconds(-1),r=o.toISOString();break;case"week":i=On.getMondayOfWeek(o).toISOString(),r=On.getSundayOfWeek(o).toISOString();break;case"month":i=o.toISOString(),o.setUTCMonth(o.getUTCMonth()+1),o.setUTCMilliseconds(-1),r=o.toISOString();break;case"year":i=o.toISOString(),o.setUTCFullYear(o.getUTCFullYear()+1),o.setUTCMilliseconds(-1),r=o.toISOString();break;default:return s}s=JA(n,i,r)}return s}isValidDateString(t){return!isNaN(Date.parse(t))}isWithinRange(t){return t>=this.minValue&&t<=this.maxValue}static formatAsDate(t){return t.toISOString().split("T")[0]}static getMondayOfWeek(t){const n=t.getUTCDate()-t.getUTCDay()+(t.getUTCDay()===0?-6:1);return new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),n))}static getSundayOfWeek(t){const n=t.getUTCDate()-(t.getUTCDay()===0?7:t.getUTCDay())+7;return new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),n))}static formatAsWeekRange(t){const n=On.getMondayOfWeek(t),i=On.getSundayOfWeek(t);return`${On.formatAsDate(n)}${ed}${On.formatAsDate(i)}`}static formatAsMonth(t){return`${t.toISOString().split("T")[0].slice(0,-3)}`}static formatAsYear(t){return`${t.getUTCFullYear()}`}static queryStringFromSingleValueAndResolution(t,n){switch(n){case"day":return On.formatAsDate(t);case"week":return On.formatAsWeekRange(t);case"month":return On.formatAsMonth(t);case"year":return On.formatAsYear(t);default:return t.toISOString()}}static queryStringFromDateRangeAnResolution(t,n,i){switch(i){case"day":return`${On.formatAsDate(t)}${ed}${On.formatAsDate(n)}`;case"week":return`${On.formatAsDate(On.getMondayOfWeek(t))}/${On.formatAsDate(On.getSundayOfWeek(n))}`;case"month":return`${On.formatAsMonth(t)}${ed}${On.formatAsMonth(n)}`;case"year":return`${On.formatAsYear(t)}${ed}${On.formatAsYear(n)}`;default:return`${t.toISOString()}${ed}${n.toISOString()}`}}}class ln extends JE{constructor(n,i,r,s){super(n,i,r,s);z(this,"isExclusiveGroup");z(this,"isExpanded");z(this,"activeState","off");z(this,"timeOptions");z(this,"timeAttribute");z(this,"timeRestriction");z(this,"children",[]);this.isExpanded=(s==null?void 0:s.isDefaultExpanded)||!1,this.isExclusiveGroup=(s==null?void 0:s.isExclusiveGroup)??!1,this.timeOptions=s==null?void 0:s.time,this.timeAttribute=s==null?void 0:s.timeAttribute,this.setDefaultTimeRestriction()}clone(){const n={isDefaultChecked:this.isDefaultChecked,metadataUrl:this.metadataUrl,disclaimer:this.disclaimer,isDefaultExpanded:this.isExpanded,isExclusiveGroup:this.isExclusiveGroup,time:this.timeOptions,timeAttribute:this.timeAttribute},i=new ln(this.id,this.name,this.order,n);i.activeState=this.activeState,i.timeRestriction=this.timeRestriction;for(const r of this.children){const s=r.clone();s.parent=i,i.children.push(s)}return i}get active(){return this.activeState==="on"}get inactive(){return this.activeState==="off"}get semiActive(){return this.activeState==="semi"}get hasTimeRestriction(){return!!this.timeRestriction}setDefaultTimeRestriction(){if(this.timeOptions){const n=new On(this.timeOptions);this.timeRestriction=n.getFormattedDefault()}}}class Hi extends JE{constructor(n,i,r,s){super(n,i,r,s);z(this,"activeState","off");z(this,"opacity");z(this,"protected");z(this,"swiped","no");this.opacity=(s==null?void 0:s.opacity)??1,this.protected=(s==null?void 0:s.protected)??!1}get isTransparent(){return this.opacity!==1}get active(){return this.activeState==="on"}get inactive(){return this.activeState==="off"}}class Kn extends JE{constructor(n,i,r,s,o){super(n,i,r,o);z(this,"isExclusiveTheme");z(this,"isExpanded");z(this,"activeState","off");z(this,"icon");z(this,"location");z(this,"zoom");z(this,"children",[]);this.isExpanded=(o==null?void 0:o.isDefaultExpanded)||!0,this.isExclusiveTheme=(o==null?void 0:o.isExclusiveTheme)??!1,this.icon=s}clone(){const n={disclaimer:this.disclaimer,isDefaultExpanded:this.isExpanded},i=new Kn(this.id,this.name,this.order,this.icon,n);i.activeState=this.activeState;for(const r of this.children){const s=r.clone();s.parent=i,i.children.push(s)}return i}get active(){return this.activeState==="on"}get inactive(){return this.activeState==="off"}get semiActive(){return this.activeState==="semi"}}var Ni,dD,xx,pD,Ex,mD,gD,Cx;class Eh extends ei{constructor(n){super(n);fo(this,Ni);z(this,"configManager");z(this,"stateManager");z(this,"layerClones",[]);this.configManager=fn.getInstance(),this.stateManager=An.getInstance(),this.stateManager.subscribe(/layers\.layersList\..*\.activeState/,(i,r,s)=>this.onLayerToggled(s)),this.stateManager.subscribe("layers.layersList",(i,r)=>this.onLayersListChanged(i,r)),this.stateManager.subscribe(/layers\.layersList\..*\.children/,(i,r)=>this.onChildrenListChanged(i,r))}get state(){return this.stateManager.state}onLayersListChanged(n,i){let r=i;n&&(r=i.filter(s=>!n.find(o=>o.treeItemId===s.treeItemId))),this.layerClones.push(...r),this.activateDefaultLayers(r)}onChildrenListChanged(n,i){const r=i.filter(s=>!n.find(o=>o.treeItemId===s.treeItemId));this.activateDefaultLayers(r)}getTreeItem(n){const i=this.getLayerRecursive(this.layerClones,n);if(i)return i;throw new Error(`BaseLayer ${n} not found !`)}getLayerRecursive(n,i){for(const r of n){if(r.treeItemId===i)return r;if(r instanceof ln||r instanceof Kn){const s=this.getLayerRecursive(r.children,i);if(s)return s}}return null}getFlattenedLayerTree(n){const i=[];for(const r of n)i.push(r),(r instanceof ln||r instanceof Kn)&&i.push(...this.getFlattenedLayerTree(r.children));return i}activateIfDefaultChecked(n){n.isDefaultChecked&&this.toggle(n,"on")}toggle(n,i){n instanceof ln||n instanceof Kn?this.toggleGroupOrTheme(n,i):n instanceof Hi&&this.toggleLayer(n,i)}onLayerToggled(n){n instanceof ln||n instanceof Kn?(ki(this,Ni,Ex).call(this,n),ki(this,Ni,xx).call(this,n),n.activeState!=="semi"&&ki(this,Ni,pD).call(this,n,n.activeState)):n instanceof Hi&&(this.isLayerWithLegend(n)&&this.configManager.Config.treeview.hideLegendWhenLayerIsDeactivated&&(n.active?n.isLegendExpanded=n.wasLegendExpanded:(n.wasLegendExpanded=n.isLegendExpanded,n.isLegendExpanded=!1)),ki(this,Ni,Ex).call(this,n),ki(this,Ni,xx).call(this,n)),ki(this,Ni,dD).call(this,n)}toggleLayer(n,i){if(!(n instanceof Hi))throw new Error("This method should only be called on leafs layers, not on groups");let r;i?r=i:n.activeState==="off"?r="on":r="off",n.activeState!=r&&(console.log(`Setting Layer ${n.name} to ${r}`),this.getTreeItem(n.treeItemId).activeState=r)}toggleGroupOrTheme(n,i){let r;i?r=i:n.activeState==="off"?r="on":r="off",n.activeState!=r&&(console.log(`Setting Group ${n.name} to ${r}`),this.getTreeItem(n.treeItemId).activeState=r)}setError(n,i){n.hasError=!0,n.errorMessage=i,console.warn(n.errorMessage)}unsetError(n){n.hasError=!1,n.errorMessage=null}isLayerWithLegend(n){return n.isLegendExpanded!==void 0}isLayerWithFilter(n){return n.filter!==void 0}getSortedLayers(n){return n.slice().sort((r,s)=>r.order-s.order)??[]}activateDefaultLayers(n){for(const i of n)this.activateIfDefaultChecked(i),i instanceof Hi&&!i.active&&this.configManager.Config.treeview.hideLegendWhenLayerIsDeactivated&&this.isLayerWithLegend(i)&&(i.isLegendExpanded=!1,i.wasLegendExpanded=!0),(i instanceof ln||i instanceof Kn)&&this.activateDefaultLayers(i.children)}}Ni=new WeakSet,dD=function(n){if(n.active&&n.disclaimer&&this.state.infobox.elements.push({id:n.treeItemId,text:n.disclaimer,type:"info"}),n.inactive&&n.disclaimer){const i=this.state.infobox.elements.findIndex(r=>r.id===n.treeItemId);i>=0&&this.state.infobox.elements.splice(i,1)}},xx=function(n){n.parent&&(n.parent instanceof ln&&n.parent.isExclusiveGroup||n.parent instanceof Kn&&n.parent.isExclusiveTheme?ki(this,Ni,Cx).call(this,n.parent)?this.toggleGroupOrTheme(n.parent,"on"):this.toggleGroupOrTheme(n.parent,"off"):ki(this,Ni,mD).call(this,n.parent)?this.toggleGroupOrTheme(n.parent,"on"):ki(this,Ni,gD).call(this,n.parent)?this.toggleGroupOrTheme(n.parent,"off"):this.toggleGroupOrTheme(n.parent,"semi"))},pD=function(n,i){if(n instanceof ln&&n.active&&n.isExclusiveGroup&&n.children.length>=1)ki(this,Ni,Cx).call(this,n)||this.toggle(n.children[0],i);else for(const r of n.children)this.toggle(r,i)},Ex=function(n){if((n.active||(n instanceof ln||n instanceof Kn)&&n.semiActive)&&n.parent!=null&&(n.parent instanceof ln&&n.parent.isExclusiveGroup||n.parent instanceof Kn&&n.parent.isExclusiveTheme))for(const i of n.parent.children){const r=this.getTreeItem(i.treeItemId);r.treeItemId!==n.treeItemId&&(r.active||(r instanceof ln||r instanceof Kn)&&r.semiActive)&&this.toggle(r,"off")}},mD=function(n){let i=!0;for(const r of n.children)r.active||(i=!1);return i},gD=function(n){let i=!0;for(const r of n.children)r.inactive||(i=!1);return i},Cx=function(n){for(const i of n.children)if(i.active||i instanceof ln&&i.semiActive)return!0;return!1};class ji extends Hi{constructor(n,i,r,s,o){var c;let a=o??{};a=ji.isGMFTreeItem(a)?ji.getOptionsFromGMFTreeItem(a):a;super(n,i,r,a);z(this,"ogcServer");z(this,"minResolution");z(this,"maxResolution");z(this,"layers");z(this,"style");z(this,"legend");z(this,"iconUrl");z(this,"legendRule");z(this,"legendImage");z(this,"isLegendExpanded");z(this,"wasLegendExpanded");z(this,"hiDPILegendImages");z(this,"printNativeAngle");z(this,"queryable",!1);z(this,"queryLayers");z(this,"filter");z(this,"timeOptions");z(this,"timeRestriction");z(this,"timeAttribute");this.ogcServer=s,this.minResolution=a==null?void 0:a.minResolution,this.maxResolution=a==null?void 0:a.maxResolution,this.layers=a==null?void 0:a.layers,this.style=a==null?void 0:a.style,this.legend=(a==null?void 0:a.legend)??!1,this.iconUrl=a==null?void 0:a.iconUrl,this.legendRule=a==null?void 0:a.legendRule,this.legendImage=a==null?void 0:a.legendImage,this.isLegendExpanded=(a==null?void 0:a.isLegendExpanded)??!1,this.wasLegendExpanded=(a==null?void 0:a.wasLegendExpanded)??this.isLegendExpanded,this.hiDPILegendImages=a==null?void 0:a.hiDPILegendImages,this.printNativeAngle=a==null?void 0:a.printNativeAngle,this.queryable=(a==null?void 0:a.queryable)??!1,this.queryLayers=a==null?void 0:a.queryLayers,this.timeOptions=a==null?void 0:a.time,this.timeAttribute=a==null?void 0:a.timeAttribute,this.queryable&&(!this.ogcServer.wfsSupport||((c=this.ogcServer.urlWfs)==null?void 0:c.length)===0)&&(this.hasError=!0,this.errorMessage="This layer is defined as queryable but no Url for Wfs has been defined.",this.queryable=!1),this.setDefaultTimeRestriction()}clone(){const n={isDefaultChecked:this.isDefaultChecked,metadataUrl:this.metadataUrl,disclaimer:this.disclaimer,opacity:this.opacity,protected:this.protected,minResolution:this.minResolution,maxResolution:this.maxResolution,layers:this.layers,style:this.style,legend:this.legend,iconUrl:this.iconUrl,legendRule:this.legendRule,legendImage:this.legendImage,isLegendExpanded:this.isLegendExpanded,wasLegendExpanded:this.wasLegendExpanded,hiDPILegendImages:this.hiDPILegendImages,printNativeAngle:this.printNativeAngle,queryable:this.queryable,queryLayers:this.queryLayers,time:this.timeOptions,timeAttribute:this.timeAttribute},i=new ji(this.id,this.name,this.order,this.ogcServer,n);return i.filter=this.filter,i.activeState=this.activeState,i.timeRestriction=this.timeRestriction,i}hasRestrictedResolution(){return this.minResolution&&this.minResolution!==0||this.maxResolution&&this.maxResolution!==999999999}isVisibleAtResolution(n){return n==null||!this.hasRestrictedResolution()?!0:n>=(this.minResolution??-1)&&n<=(this.maxResolution??1/0)}get hasFilter(){return this.filter!==null&&this.filter!==void 0}get hasTimeRestriction(){return!!this.timeRestriction}setDefaultTimeRestriction(){if(this.timeOptions){const n=new On(this.timeOptions);this.timeRestriction=n.getFormattedDefault()}}get serverUniqueQueryId(){return this.ogcServer.uniqueWmsQueryId}get wfsQueryable(){var n;return this.queryable&&!!((n=this.ogcServer)!=null&&n.urlWfs&&this.queryLayers)}static isGMFTreeItem(n){return"id"in n}static getOptionsFromGMFTreeItem(n){var r,s,o,a,c,u,h,d,p,g,_,b,x;const i={isDefaultChecked:(r=n.metadata)==null?void 0:r.isChecked,metadataUrl:(s=n.metadata)==null?void 0:s.metadataUrl,disclaimer:(o=n.metadata)==null?void 0:o.disclaimer,opacity:1,protected:(a=n.metadata)==null?void 0:a.protected,minResolution:n.minResolutionHint,maxResolution:n.maxResolutionHint,layers:n.layers,style:n.style,legend:(c=n.metadata)==null?void 0:c.legend,iconUrl:(u=n.metadata)==null?void 0:u.iconUrl,legendRule:(h=n.metadata)==null?void 0:h.legendRule,legendImage:(d=n.metadata)==null?void 0:d.legendImage,isLegendExpanded:(p=n.metadata)==null?void 0:p.isLegendExpanded,wasLegendExpanded:(g=n.metadata)==null?void 0:g.wasLegendExpanded,printNativeAngle:(_=n.metadata)==null?void 0:_.printNativeAngle,hiDPILegendImages:(b=n.metadata)==null?void 0:b.hiDPILegendImages,time:n.time,timeAttribute:(x=n.metadata)==null?void 0:x.timeAttribute};return n.childLayers&&(i.queryLayers=n.childLayers.filter(E=>E.queryable).map(E=>E.name).join(","),i.queryable=i.queryLayers.length>0),i}}const v4=[ln,ji],Ly=e=>v4.some(t=>e instanceof t)&&!!e.timeOptions;class I_ extends ei{constructor(n){super(n);z(this,"configManager");z(this,"stateManager");z(this,"i18nManager");z(this,"sourceMaps",{});this.configManager=fn.getInstance(),this.stateManager=An.getInstance(),this.i18nManager=Jf.getInstance(),this.listenToAllErrors()}getErrorMessage(n,i,r){const s=`
## Debug Infos

### Context

${r}

### Callstack

\`\`\`
${i}
\`\`\`

/label ~"error report"
`;return`${n}<br/><a target="_new" href="https://gitlab.com/geogirafe/gg-viewer/-/issues/new?issue[title]=${encodeURIComponent(n)}&issuable_template=bug&issue[description]=${encodeURIComponent(s)}">Report Error</a>`}pushMessage(n,i,r){this.stateManager.state.infobox.elements.splice(this.stateManager.state.infobox.elements.findIndex(s=>s.id===n),1),this.stateManager.state.infobox.elements.push({id:n,text:i,type:r})}listenToAllErrors(){window.onerror=async(n,i,r,s,o)=>{const a=(o==null?void 0:o.message)??`Unknown error in ${i} at line ${r} and column ${s}.`,c=await this.getStackTrace(o);return this.pushErrorMessageWithStack(a,c),!1},window.addEventListener("unhandledrejection",async n=>{const i=n.reason??new Error("Unknown reason"),r=`Unhandled rejection: ${i.message}`,s=await this.getStackTrace(i);return this.pushErrorMessageWithStack(r,s),!1})}async getStackTrace(n){let i="Unknown stack";if(n!=null&&n.stack)try{i=await this.getOriginalStackTrace(n)}catch(r){console.warn(r),i=n.stack}return i}pushErrorMessageWithStack(n,i){const r=this.stateManager.state.infobox.elements.map(a=>a.text),s=this.getContextUrl(),o=this.getErrorMessage(n,i,s);r.includes(o)||this.stateManager.state.infobox.elements.push({id:wu(),text:o,type:"error"})}getContextUrl(){const n=window.location.href.split("#")[0];try{const i=Qf.getInstance().getStateToShare();return`${n}#${i}`}catch{return n}}async getOriginalStackTrace(n){return Object.keys(this.sourceMaps).length===0&&await this.loadAllSourceMaps(),bz.parse(n).map(s=>{const o=this.sourceMaps[this.getNormalizedPath(s.fileName)];if(o){const a=o.originalPositionFor({line:s.lineNumber,column:s.columnNumber});if(a.source)return{fileName:a.source,lineNumber:a.line,columnNumber:a.column,functionName:s.functionName}}return s}).map(s=>`${s.functionName||"anonymous"} (${s.fileName}:${s.lineNumber}:${s.columnNumber})`).join(`
`)}async loadAllSourceMaps(){const n=document.getElementsByTagName("script");for(const i of n)await this.loadSourceMap(this.getNormalizedPath(i.src))}async loadSourceMap(n){const r=await(await fetch(n)).text();let s=/\/\/# sourceMappingURL=([^\s]+)/,o=RegExp(s).exec(r);if(o){const c=this.getNormalizedPath(n,o[1]);if(!(n in this.sourceMaps)){const h=await(await fetch(c)).json(),d=new Tz(h);this.sourceMaps[n]=d}}else console.info("No Sourcemap found");s=/from *"([^\s]+)"/g;const a=r.matchAll(s);for(o of a)for(let c=1;c<o.length;++c){const u=this.getNormalizedPath(n,o[1]);await this.loadSourceMap(u)}}getNormalizedPath(n,i){if(!n)throw new Error("No path to normalize");const r=i?n.substring(0,n.lastIndexOf("/")+1)+i:n,s=new URL(r);return s.origin+s.pathname}}class I4{static getRandomName(t){return DS[Math.floor(Math.random()*DS.length)]+" "+t}}const DS=["aback","abaft","abandoned","abashed","aberrant","abhorrent","abiding","abject","ablaze","able","abnormal","aboriginal","abortive","abounding","abrasive","abrupt","absent","absorbed","absorbing","abstracted","absurd","abundant","abusive","acceptable","accessible","accidental","accurate","acid","acidic","acoustic","acrid","adamant","adaptable","addicted","adhesive","adjoining","adorable","adventurous","afraid","aggressive","agonizing","agreeable","ahead","ajar","alert","alike","alive","alleged","alluring","aloof","amazing","ambiguous","ambitious","amuck","amused","amusing","ancient","angry","animated","annoyed","annoying","anxious","apathetic","aquatic","aromatic","arrogant","ashamed","aspiring","assorted","astonishing","attractive","auspicious","automatic","available","average","aware","awesome","axiomatic","bad","barbarous","bashful","bawdy","beautiful","befitting","belligerent","beneficial","bent","berserk","bewildered","big","billowy","bite-sized","bitter","bizarre","black","black-and-white","bloody","blue","blue-eyed","blushing","boiling","boorish","bored","boring","bouncy","boundless","brainy","brash","brave","brawny","breakable","breezy","brief","bright","broad","broken","brown","bumpy","burly","bustling","busy","cagey","calculating","callous","calm","capable","capricious","careful","careless","caring","cautious","ceaseless","certain","changeable","charming","cheap","cheerful","chemical","chief","childlike","chilly","chivalrous","chubby","chunky","clammy","classy","clean","clear","clever","cloistered","cloudy","closed","clumsy","cluttered","coherent","cold","colorful","colossal","combative","comfortable","common","complete","complex","concerned","condemned","confused","conscious","cooing","cool","cooperative","coordinated","courageous","cowardly","crabby","craven","crazy","creepy","crooked","crowded","cruel","cuddly","cultured","cumbersome","curious","curly","curved","curvy","cut","cute","cynical","daffy","daily","damaged","damaging","damp","dangerous","dapper","dark","dashing","dazzling","dead","deadpan","deafening","dear","debonair","decisive","decorous","deep","deeply","defeated","defective","defiant","delicate","delicious","delightful","demonic","delirious","dependent","depressed","deranged","descriptive","deserted","detailed","determined","devilish","didactic","different","difficult","diligent","direful","dirty","disagreeable","disastrous","discreet","disgusted","disgusting","disillusioned","dispensable","distinct","disturbed","divergent","dizzy","domineering","doubtful","drab","draconian","dramatic","dreary","drunk","dry","dull","dusty","dynamic","dysfunctional","eager","early","earsplitting","earthy","easy","eatable","economic","educated","efficacious","efficient","elastic","elated","elderly","electric","elegant","elfin","elite","embarrassed","eminent","empty","enchanted","enchanting","encouraging","endurable","energetic","enormous","entertaining","enthusiastic","envious","equable","equal","erect","erratic","ethereal","evanescent","evasive","even","excellent","excited","exciting","exclusive","exotic","expensive","extra-large","extra-small","exuberant","exultant","fabulous","faded","faint","fair","faithful","fallacious","false","familiar","famous","fanatical","fancy","fantastic","far","far-flung","fascinated","fast","fat","faulty","fearful","fearless","feeble","feigned","female","fertile","festive","few","fierce","filthy","fine","finicky","first","fixed","flagrant","flaky","flashy","flat","flawless","flimsy","flippant","flowery","fluffy","fluttering","foamy","foolish","foregoing","forgetful","fortunate","frail","fragile","frantic","free","freezing","frequent","fresh","fretful","friendly","frightened","frightening","full","fumbling","functional","funny","furry","furtive","future","futuristic","fuzzy","gabby","gainful","gamy","gaping","garrulous","gaudy","general","gentle","giant","giddy","gifted","gigantic","glamorous","gleaming","glib","glistening","glorious","glossy","godly","good","goofy","gorgeous","graceful","grandiose","grateful","gratis","gray","greasy","great","greedy","green","grey","grieving","groovy","grotesque","grouchy","grubby","gruesome","grumpy","guarded","guiltless","gullible","gusty","guttural","habitual","half","hallowed","halting","handsome","handy","hanging","hapless","happy","hard","hard-to-find","harmonious","harsh","hateful","heady","healthy","heartbreaking","heavenly","heavy","hellish","helpful","helpless","hesitant","hideous","high","highfalutin","high-pitched","hilarious","hissing","historical","holistic","hollow","homeless","homely","honorable","horrible","hospitable","hot","huge","hulking","humdrum","humorous","hungry","hurried","hurt","hushed","husky","hypnotic","hysterical","icky","icy","idiotic","ignorant","ill","illegal","ill-fated","ill-informed","illustrious","imaginary","immense","imminent","impartial","imperfect","impolite","important","imported","impossible","incandescent","incompetent","inconclusive","industrious","incredible","inexpensive","infamous","innate","innocent","inquisitive","insidious","instinctive","intelligent","interesting","internal","invincible","irate","irritating","itchy","jaded","jagged","jazzy","jealous","jittery","jobless","jolly","joyous","judicious","juicy","jumbled","jumpy","juvenile","keen","kind","kindhearted","kindly","knotty","knowing","knowledgeable","known","labored","lackadaisical","lacking","lame","lamentable","languid","large","last","late","laughable","lavish","lazy","lean","learned","left","legal","lethal","level","lewd","light","like","likeable","limping","literate","little","lively","living","lonely","long","longing","long-term","loose","lopsided","loud","loutish","lovely","loving","low","lowly","lucky","ludicrous","lumpy","lush","luxuriant","lying","lyrical","macabre","macho","maddening","madly","magenta","magical","magnificent","majestic","makeshift","male","malicious","mammoth","maniacal","many","marked","massive","married","marvelous","material","materialistic","mature","mean","measly","meaty","medical","meek","mellow","melodic","melted","merciful","mere","messy","mighty","military","milky","mindless","miniature","minor","miscreant","misty","mixed","moaning","modern","moldy","momentous","motionless","mountainous","muddled","mundane","murky","mushy","mute","mysterious","naive","nappy","narrow","nasty","natural","naughty","nauseating","near","neat","nebulous","necessary","needless","needy","neighborly","nervous","new","next","nice","nifty","nimble","nippy","noiseless","noisy","nonchalant","nondescript","nonstop","normal","nostalgic","nosy","noxious","numberless","numerous","nutritious","nutty","oafish","obedient","obeisant","obese","obnoxious","obscene","obsequious","observant","obsolete","obtainable","oceanic","odd","offbeat","old","old-fashioned","omniscient","onerous","open","opposite","optimal","orange","ordinary","organic","ossified","outgoing","outrageous","outstanding","oval","overconfident","overjoyed","overrated","overt","overwrought","painful","painstaking","pale","paltry","panicky","panoramic","parallel","parched","parsimonious","past","pastoral","pathetic","peaceful","penitent","perfect","periodic","permissible","perpetual","petite","phobic","physical","picayune","pink","piquant","placid","plain","plant","plastic","plausible","pleasant","plucky","pointless","poised","polite","political","poor","possessive","possible","powerful","precious","premium","present","pretty","previous","pricey","prickly","private","probable","productive","profuse","protective","proud","psychedelic","psychotic","public","puffy","pumped","puny","purple","purring","pushy","puzzled","puzzling","quaint","quarrelsome","questionable","quick","quiet","quirky","quixotic","quizzical","rabid","racial","ragged","rainy","rambunctious","rampant","rapid","rare","raspy","ratty","ready","real","rebel","receptive","recondite","red","redundant","reflective","regular","relieved","remarkable","reminiscent","repulsive","resolute","resonant","responsible","rhetorical","rich","right","righteous","rightful","rigid","ripe","ritzy","roasted","robust","romantic","roomy","rotten","rough","round","royal","ruddy","rude","rural","rustic","ruthless","sable","sad","safe","salty","same","sassy","satisfying","savory","scandalous","scarce","scared","scary","scattered","scientific","scintillating","scrawny","screeching","second","second-hand","secret","secretive","sedate","seemly","selective","selfish","separate","serious","shaggy","shaky","shallow","sharp","shiny","shivering","shocking","short","shrill","shut","shy","sick","silent","silky","silly","simple","simplistic","sincere","skillful","skinny","sleepy","slim","slimy","slippery","sloppy","slow","small","smart","smelly","smiling","smoggy","smooth","sneaky","snobbish","snotty","soft","soggy","solid","somber","sophisticated","sordid","sore","sour","sparkling","special","spectacular","spicy","spiffy","spiky","spiritual","spiteful","splendid","spooky","spotless","spotted","spotty","spurious","squalid","square","squealing","squeamish","staking","stale","standing","statuesque","steadfast","steady","steep","stereotyped","sticky","stiff","stimulating","stingy","stormy","straight","strange","striped","strong","stupendous","sturdy","subdued","subsequent","substantial","successful","succinct","sudden","sulky","super","superb","superficial","supreme","swanky","sweet","sweltering","swift","symptomatic","synonymous","taboo","tacit","tacky","talented","tall","tame","tan","tangible","tangy","tart","tasteful","tasteless","tasty","tawdry","tearful","tedious","teeny","teeny-tiny","telling","temporary","ten","tender","tense","tenuous","terrific","tested","testy","thankful","therapeutic","thick","thin","thinkable","third","thirsty","thoughtful","thoughtless","threatening","thundering","tidy","tight","tightfisted","tiny","tired","tiresome","toothsome","torpid","tough","towering","tranquil","trashy","tremendous","tricky","trite","troubled","truculent","true","truthful","typical","ubiquitous","ultra","unable","unaccountable","unadvised","unarmed","unbecoming","unbiased","uncovered","understood","undesirable","unequal","unequaled","uneven","unhealthy","uninterested","unique","unkempt","unknown","unnatural","unruly","unsightly","unsuitable","untidy","unused","unusual","unwieldy","unwritten","upbeat","uppity","upset","uptight","used","useful","useless","utopian","vacuous","vagabond","vague","valuable","various","vast","vengeful","venomous","verdant","versed","victorious","vigorous","violent","violet","vivacious","voiceless","volatile","voracious","vulgar","wacky","waggish","waiting","wakeful","wandering","wanting","warlike","warm","wary","wasteful","watery","weak","wealthy","weary","well-groomed","well-made","well-off","well-to-do","wet","whimsical","whispering","white","whole","wholesale","wicked","wide","wide-eyed","wiggly","wild","willing","windy","wiry","wise","wistful","witty","woebegone","womanly","wonderful","wooden","woozy","workable","worried","worthless","wrathful","wretched","wrong","wry","yellow","yielding","young","youthful","yummy","zany","zealous","zesty","zippy","zonked"];var _D=(e=>(e[e.Point=0]="Point",e[e.Polyline=1]="Polyline",e[e.Polygon=2]="Polygon",e[e.Square=3]="Square",e[e.Rectangle=4]="Rectangle",e[e.Disk=5]="Disk",e[e.FreehandPolyline=6]="FreehandPolyline",e[e.FreehandPolygon=7]="FreehandPolygon",e))(_D||{});class O4{constructor(){z(this,"activeTool",null);z(this,"features",[])}}class QE{constructor(t,n={},i=null){z(this,"_tool");z(this,"_name");z(this,"_nameColor");z(this,"_strokeColor");z(this,"_strokeWidth");z(this,"_fillColor");z(this,"_nameFontSize");z(this,"_measureFontSize");z(this,"_measureColor");z(this,"_font");z(this,"_displayName",!0);z(this,"_displayMeasure",!0);z(this,"_selected",!1);z(this,"geojson");z(this,"id",wu());z(this,"onChange",()=>{});const r=fn.getInstance().Config.drawing;this._tool=t,this._name=i??I4.getRandomName(_D[t]),this._strokeColor=r.defaultStrokeColor,this._strokeWidth=r.defaultStrokeWidth,this._fillColor=r.defaultFillColor,this._nameFontSize=r.defaultTextSize,this._measureFontSize=r.defaultTextSize,this._font=r.defaultFont,this.geojson=n,this._nameColor="#000000",this._measureColor="#000000"}get name(){return this._name}set name(t){this._name=t,this.onChange(this)}get strokeColor(){return this._strokeColor}set strokeColor(t){this._strokeColor=t,this.onChange(this)}get strokeWidth(){return this._strokeWidth}set strokeWidth(t){this._strokeWidth=t,this.onChange(this)}get fillColor(){return this._fillColor}set fillColor(t){this._fillColor=t,this.onChange(this)}get nameFontSize(){return this._nameFontSize}set nameFontSize(t){this._nameFontSize=t,this.onChange(this)}get measureFontSize(){return this._measureFontSize}set measureFontSize(t){this._measureFontSize=t,this.onChange(this)}get font(){return this._font}set font(t){this._font=t,this.onChange(this)}get displayName(){return this._displayName}set displayName(t){this._displayName=t,this.onChange(this)}get displayMeasure(){return this._displayMeasure}set displayMeasure(t){this._displayMeasure=t,this.onChange(this)}get nameColor(){return this._nameColor}set nameColor(t){this._nameColor=t,this.onChange(this)}get measureColor(){return this._measureColor}set measureColor(t){this._measureColor=t,this.onChange(this)}get type(){return this._tool}get selected(){return this._selected}set selected(t){this._selected=t,this.onChange(this)}addToState(){An.getInstance().state.extendedState.drawing.features.push(this)}serialize(){return{n:this._name,sc:this._strokeColor,sw:this._strokeWidth,fc:this._fillColor,nfz:this._nameFontSize,mfz:this._measureFontSize,f:this._font,g:this.geojson,t:this._tool,dn:this._displayName,dm:this._displayMeasure,nc:this._nameColor,mc:this._measureColor,s:this._selected}}getLengthText(t){return this.displayMeasure?t>100?(t/1e3).toFixed(2)+" km":t.toFixed(2)+" m":""}getAreaText(t){return this.displayMeasure?t>1e4?(t/1e6).toFixed(2)+" kmÂ²":t.toFixed(2)+" mÂ²":""}getCoordText(t){return this.displayMeasure?t.length>2?"E "+t[0].toFixed(2)+`
N `+t[1].toFixed(2)+`
H `+t[2].toFixed(2):"E "+t[0].toFixed(2)+`
N `+t[1].toFixed(2):""}isPointOrPolyline(){return this.type==0||this.type==1||this.type==6}getVertexStyle(t=!1){const n=fn.getInstance().Config.drawing;return new ps({zIndex:1002,image:new vR({points:4,radius:t?n.defaultVertexRadius+2:n.defaultVertexRadius,angle:xz(45),rotateWithView:!1,fill:new Ws({color:n.defaultVertexFillColor}),stroke:new Pr({color:this.strokeColor,width:t?n.defaultVertexStrokeWidth+2:n.defaultVertexStrokeWidth})})})}static deserialize(t){const n=new QE(t.t,t.g,t.n);return n.strokeColor=t.sc,n.strokeWidth=t.sw,n.fillColor=t.fc,n.nameFontSize=t.nfz,n.measureFontSize=t.mfz,n.font=t.f,n.geojson=t.g,n.displayName=t.dn,n.displayMeasure=t.dm,n.nameColor=t.nc,n.measureColor=t.mc,n.selected=t.s,n.addToState(),n}static circleToPolygon(t,n,i=300){const r=[];for(let s=0;s<2*Math.PI;s+=2*Math.PI/i)r.push([t[0]+n*Math.cos(s),t[1]+n*Math.sin(s)]);return[...r,r[0]]}}class yD{constructor(){z(this,"stateManager");z(this,"layerManager");z(this,"componentManager");this.stateManager=An.getInstance(),this.layerManager=Eh.getInstance(),this.componentManager=uD.getInstance()}get state(){return this.stateManager.state}deserializeAndSetState(t){for(const s of this.stateManager.state.layers.layersList)this.layerManager.toggle(s,"off");this.state.layers.layersList=[];const n=IR.decompressFromBase64(t),i=JSON.parse(n);if(this.state.projection=i.m.p,this.state.position.center=i.p.c,this.state.position.resolution=i.p.r,this.state.treeview.advanced=!!i.t.a,this.state.globe.display=i.g.d,i.b){const s=Object.values(this.state.basemaps).find(o=>o.id===i.b.i);s?(s.projection&&(this.state.projection=s.projection),this.state.activeBasemap=s):console.warn(`Cannot find basemap with id ${i.b.i} in the available basemaps`)}const r=this.getDeserializedLayerTree(i.l);for(const s of r)this.state.layers.layersList.push(s);this.deserializeDrawingFeatures(i.f)}getDeserializedLayerTree(t){const n=[];for(const i of t){const r=this.findBaseLayerById(i.i);r?(this.deserializeLayer(r,i),n.push(r)):console.warn(`Cannot find layer with id ${i.i} in the available layers`)}return n}deserializeLayer(t,n){t.order=n.o,t.isDefaultChecked=!!n.c,t instanceof ln||t instanceof Kn?(t.isExpanded=!!n.e,this.removeUnnecessaryChilds(t,n),this.checkUnknownLayers(n,t)):t instanceof Hi&&this.layerManager.isLayerWithLegend(t)&&(t.isLegendExpanded=!!n.e),Ly(t)&&(t.timeRestriction=n.t)}checkUnknownLayers(t,n){for(const i of t.z)n.children.find(s=>s.id==i.i)||I_.getInstance().pushMessage("unknown-layers-cannot-be-added","Some layer could not be added to the layer-tree. This is either because you do not have the rights for it, or because this layer does not exist anymore.","warning")}removeUnnecessaryChilds(t,n){let i=!1;for(let r=t.children.length-1;r>=0;r--){const s=t.children[r],o=n.z.find(a=>a.i==s.id);o?this.deserializeLayer(s,o):n.x.find(c=>c==s.id)?(t.children.splice(r,1),console.debug(`Layer ${s.name} was removed from initial state`)):(console.debug(`Layer ${s.name} will be added to the treeview because it is new`),console.debug(`Layer ${t.name} needs a reorering of its children`),i=!0)}if(i){console.debug(`Reordering childs for layer ${t.name}`);let r=1;for(const s of t.children)s.order=r++}}findBaseLayerById(t){for(const n of Object.values(this.state.themes._allThemes)){const i=this.findLayerRecursive(n,t);if(i)return i}return null}findLayerRecursive(t,n){if(t.id===n)return t.clone();if(t instanceof ln||t instanceof Kn)for(const i of t.children){const r=this.findLayerRecursive(i,n);if(r)return r}return null}deserializeDrawingFeatures(t){if(t){if(this.state.extendedState.drawing){const n=this.state.extendedState.drawing;n.features.splice(0,n.features.length)}else this.state.extendedState.drawing=new O4;t.forEach(n=>QE.deserialize(n))}}}const R4="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20512%20512'%3e%3c!--!Font%20Awesome%20Free%206.5.2%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202024%20Fonticons,%20Inc.--%3e%3cpath%20d='M208.5%2062.3l28.1-36.9C248.8%209.4%20267.8%200%20288%200c28.5%200%2053.6%2018.7%2061.8%2046l17.8%2059.4c10.3%2034.4%2036.1%2062%2069.8%2074.6l39.8%2014.9c20.9%207.9%2034.8%2027.9%2034.8%2050.2c0%2016.9-7.9%2032.8-21.5%2042.9l-67.3%2050.5c-24.3%2018.2-37.2%2047.9-33.8%2078.1l2.5%2022.7c4.3%2038.7-26%2072.6-65%2072.6c-14.8%200-29.3-5.1-40.8-14.3l-55.4-44.3c-4.5-3.6-9.3-6.7-14.5-9.2c-15.8-7.9-33.7-10.4-51-7.3L82.4%20451.9C47.8%20458.2%2016%20431.6%2016%20396.5c0-13.2%204.7-26%2013.1-36.2l11.2-13.4c14.6-17.4%2022.6-39.4%2022.6-62.1c0-18.8-5.5-37.2-15.8-53L8.8%20173.5C3.1%20164.7%200%20154.4%200%20143.9c0-33.4%2030.1-58.8%2063-53.2l51.3%208.7c35.9%206.1%2072.2-8.2%2094.2-37.1z'/%3e%3c/svg%3e";class wx{constructor(t){z(this,"id");z(this,"layers");z(this,"name");z(this,"icon");this.id=Date.now(),this.name=t,this.layers=[],this.icon=R4}get hasThemes(){for(const t of this.layers)if(t instanceof Kn)return!0;return!1}getSerialized(){return new bD().getSerializedLayerTree(this.layers)}getThemeLayer(t=1e6){const n=new Kn(t,this.name,0);return n.children.push(...this.layers),n}}class D4 extends ei{constructor(n){super(n);z(this,"configManager");z(this,"stateManager");this.configManager=fn.getInstance(),this.stateManager=An.getInstance(),this.stateManager.subscribe("themes.lastSelectedTheme",(i,r)=>this.onSelectedThemeChanged(r))}get state(){return this.stateManager.state}findBaseLayerById(n){for(const i of Object.values(this.state.themes._allThemes)){if(i.id===n)return i;const r=this.findBaseLayerRecurviveById(i.children,n);if(r)return r}throw new Error(`No BaseLayer with ID ${n} could be found.`)}findBaseLayerRecurviveById(n,i){for(const r of n){if(r.id===i)return r;if(r instanceof ln||r instanceof Kn){const s=this.findBaseLayerRecurviveById(r.children,i);if(s)return s}}return null}findThemeByName(n){for(const i of Object.values(this.state.themes._allThemes))if(i.name===n)return i;throw new Error(`Theme ${n} was not found`)}findGroupByName(n){const i=this.findBaseLayerByName(n);if(i instanceof ln)return i;throw new Error(`Layer ${i.name} was found, but is not a group`)}findLayerByName(n){const i=this.findBaseLayerByName(n);if(i instanceof Hi)return i;throw new Error(`Layer ${i.name} was found, but is not a layer`)}findBaseLayerByName(n){for(const i of Object.values(this.state.themes._allThemes)){const r=this.findLayerRecursive(i.children,n);if(r)return r}throw new Error(`Layer ${n} not found !`)}findLayerRecursive(n,i){for(const r of n){if(r.name===i)return r;if(r instanceof ln){const s=this.findLayerRecursive(r.children,i);if(s)return s}}return null}onSelectedThemeChanged(n){if(n)if(n instanceof wx){n.layers.sort((i,r)=>i.order-r.order);for(const i of n.layers)this.onThemeChanged(i)}else this.onThemeChanged(n)}onThemeChanged(n){const i=n.clone();if(this.configManager.Config.themes.selectionMode==="replace"){for(const r of this.state.layers.layersList)r.activeState="off";setTimeout(()=>{this.state.layers.layersList=[i]})}else this.state.layers.layersList.find(r=>r.id==i.id)?console.info(`The theme ${i.name} is already present in the treeview.`):(i.order=0,this.state.layers.layersList.push(i))}}class bD{constructor(){z(this,"layerManager");z(this,"themesHelper");this.layerManager=Eh.getInstance(),this.themesHelper=D4.getInstance()}getSerializedState(t){const n=this.getSerializedLayerTree(t.layers.layersList),i={p:{c:t.position.center,r:t.position.resolution},m:{p:t.projection},t:{a:Number(t.treeview.advanced)},g:{d:t.globe.display},l:n};t.extendedState.drawing&&(i.f=t.extendedState.drawing.features.map(o=>o.serialize())),t.activeBasemap&&(i.b={i:t.activeBasemap.id});const r=JSON.stringify(i);return IR.compressToBase64(r)}getSerializedLayerTree(t){const n=[];for(const i of t){const r=this.getSerializedLayer(i);n.push(r)}return n}getSerializedLayer(t){let n=!1;t instanceof ln||t instanceof Kn?n=t.isExpanded:t instanceof Hi&&this.layerManager.isLayerWithLegend(t)&&(n=t.isLegendExpanded);const i=[],r=[];if(t instanceof ln||t instanceof Kn){const s=this.themesHelper.findBaseLayerById(t.id);for(const o of s.children){const a=t.children.findIndex(c=>c.id===o.id);if(a>=0){const c=this.getSerializedLayer(t.children[a]);i.push(c)}else r.push(o.id)}}return{i:t.id,o:t.order,c:Number(t.active),e:Number(n),t:Ly(t)?t.timeRestriction:void 0,z:i,x:r}}}class Qf extends ei{constructor(n){super(n);z(this,"stateManager");z(this,"layerManager");z(this,"serializer");z(this,"deserializer");this.stateManager=An.getInstance(),this.layerManager=Eh.getInstance(),this.serializer=new bD,this.deserializer=new yD}getStateToShare(){return this.serializer.getSerializedState(this.stateManager.state)}hasSharedState(){return this.getStateFromUrl()!==null}getStateFromUrl(){let n=window.location.hash;return n&&n.length>0&&(n.startsWith("#")&&(n=n.substring(1)),n.length>0)?n:null}setStateFromUrl(){const n=this.getStateFromUrl();n&&this.deserializer.deserializeAndSetState(n),this.stateManager.state.sharedStateIsLoaded=!0}}class eC extends ei{constructor(){super(...arguments);z(this,"map",new Ez({layers:[]}))}getMap(){return this.map}getLayersToPrint(){return this.map.getAllLayers().filter(n=>n.get("addToPrintedLayers"))}zoomToExtent(n,i){this.map.getView().fit(n,{minResolution:i})}}function lr(e){return(t,...n)=>M4(e,t,n)}function Ch(e,t){return lr(TD(e,t).get)}const{apply:M4,construct:Lwe,defineProperty:Pwe,get:Nwe,getOwnPropertyDescriptor:TD,getPrototypeOf:tC,has:Fwe,ownKeys:L4,set:Bwe,setPrototypeOf:zwe}=Reflect,{iterator:Vp,species:Uwe,toStringTag:P4,for:kwe}=Symbol,N4=Object,{create:nC,defineProperty:F4,freeze:jwe,is:Vwe}=N4,B4=Array,z4=B4.prototype,xD=z4[Vp],U4=lr(xD),ED=ArrayBuffer,k4=ED.prototype;Ch(k4,"byteLength");const MS=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;MS&&Ch(MS.prototype,"byteLength");const CD=tC(Uint8Array);CD.from;const jr=CD.prototype;jr[Vp];lr(jr.keys);lr(jr.values);lr(jr.entries);lr(jr.set);lr(jr.reverse);lr(jr.fill);lr(jr.copyWithin);lr(jr.sort);lr(jr.slice);lr(jr.subarray);Ch(jr,"buffer");Ch(jr,"byteOffset");Ch(jr,"length");Ch(jr,P4);const j4=Uint8Array,wD=Uint16Array,iC=Uint32Array,V4=Float32Array,_p=tC([][Vp]()),AD=lr(_p.next),G4=lr(function*(){}().next),H4=tC(_p),q4=DataView.prototype,W4=lr(q4.getUint16),rC=WeakMap,SD=rC.prototype,vD=lr(SD.get),$4=lr(SD.set),ID=new rC,X4=nC(null,{next:{value:function(){const t=vD(ID,this);return AD(t)}},[Vp]:{value:function(){return this}}});function Y4(e){if(e[Vp]===xD&&_p.next===AD)return e;const t=nC(X4);return $4(ID,t,U4(e)),t}const K4=new rC,Z4=nC(H4,{next:{value:function(){const t=vD(K4,this);return G4(t)},writable:!0,configurable:!0}});for(const e of L4(_p))e!=="next"&&F4(Z4,e,TD(_p,e));const OD=new ED(4),J4=new V4(OD),Q4=new iC(OD),$o=new wD(512),Xo=new j4(512);for(let e=0;e<256;++e){const t=e-127;t<-24?($o[e]=0,$o[e|256]=32768,Xo[e]=24,Xo[e|256]=24):t<-14?($o[e]=1024>>-t-14,$o[e|256]=1024>>-t-14|32768,Xo[e]=-t-1,Xo[e|256]=-t-1):t<=15?($o[e]=t+15<<10,$o[e|256]=t+15<<10|32768,Xo[e]=13,Xo[e|256]=13):t<128?($o[e]=31744,$o[e|256]=64512,Xo[e]=24,Xo[e|256]=24):($o[e]=31744,$o[e|256]=64512,Xo[e]=13,Xo[e|256]=13)}const sC=new iC(2048);for(let e=1;e<1024;++e){let t=e<<13,n=0;for(;!(t&8388608);)t<<=1,n-=8388608;t&=-8388609,n+=947912704,sC[e]=t|n}for(let e=1024;e<2048;++e)sC[e]=939524096+(e-1024<<13);const wh=new iC(64);for(let e=1;e<31;++e)wh[e]=e<<23;wh[31]=1199570944;wh[32]=2147483648;for(let e=33;e<63;++e)wh[e]=2147483648+(e-32<<23);wh[63]=3347054592;const RD=new wD(64);for(let e=1;e<64;++e)e!==32&&(RD[e]=1024);function e8(e){const t=e>>10;return Q4[0]=sC[RD[t]+(e&1023)]+wh[t],J4[0]}function DD(e,t,...n){return e8(W4(e,t,...Y4(n)))}var oC={exports:{}};function MD(e,t,n){const i=n&&n.debug||!1;i&&console.log("[xml-utils] getting "+t+" in "+e);const r=typeof e=="object"?e.outer:e,s=r.slice(0,r.indexOf(">")+1),o=['"',"'"];for(let a=0;a<o.length;a++){const c=o[a],u=t+"\\="+c+"([^"+c+"]*)"+c;i&&console.log("[xml-utils] pattern:",u);const d=new RegExp(u).exec(s);if(i&&console.log("[xml-utils] match:",d),d)return d[1]}}oC.exports=MD;oC.exports.default=MD;var t8=oC.exports;const Vb=Th(t8);var aC={exports:{}},cC={exports:{}},lC={exports:{}};function LD(e,t,n){const r=new RegExp(t).exec(e.slice(n));return r?n+r.index:-1}lC.exports=LD;lC.exports.default=LD;var n8=lC.exports,uC={exports:{}};function PD(e,t,n){const r=new RegExp(t).exec(e.slice(n));return r?n+r.index+r[0].length-1:-1}uC.exports=PD;uC.exports.default=PD;var i8=uC.exports,fC={exports:{}};function ND(e,t){const n=new RegExp(t,"g"),i=e.match(n);return i?i.length:0}fC.exports=ND;fC.exports.default=ND;var r8=fC.exports;const s8=n8,Gb=i8,LS=r8;function FD(e,t,n){const i=n&&n.debug||!1,r=!(n&&typeof n.nested===!1),s=n&&n.startIndex||0;i&&console.log("[xml-utils] starting findTagByName with",t," and ",n);const o=s8(e,`<${t}[ 
>/]`,s);if(i&&console.log("[xml-utils] start:",o),o===-1)return;const a=e.slice(o+t.length);let c=Gb(a,"^[^<]*[ /]>",0);const u=c!==-1&&a[c-1]==="/";if(i&&console.log("[xml-utils] selfClosing:",u),u===!1)if(r){let g=0,_=1,b=0;for(;(c=Gb(a,"[ /]"+t+">",g))!==-1;){const x=a.substring(g,c+1);if(_+=LS(x,"<"+t+`[ 
	>]`),b+=LS(x,"</"+t+">"),b>=_)break;g=c}}else c=Gb(a,"[ /]"+t+">",0);const h=o+t.length+c+1;if(i&&console.log("[xml-utils] end:",h),h===-1)return;const d=e.slice(o,h);let p;return u?p=null:p=d.slice(d.indexOf(">")+1,d.lastIndexOf("<")),{inner:p,outer:d,start:o,end:h}}cC.exports=FD;cC.exports.default=FD;var o8=cC.exports;const a8=o8;function BD(e,t,n){const i=[],r=n&&n.debug||!1,s=n&&typeof n.nested=="boolean"?n.nested:!0;let o=n&&n.startIndex||0,a;for(;a=a8(e,t,{debug:r,startIndex:o});)s?o=a.start+1+t.length:o=a.end,i.push(a);return r&&console.log("findTagsByName found",i.length,"tags"),i}aC.exports=BD;aC.exports.default=BD;var c8=aC.exports;const l8=Th(c8),Gd={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},ea={};for(const e in Gd)Gd.hasOwnProperty(e)&&(ea[Gd[e]]=parseInt(e,10));const u8=[ea.BitsPerSample,ea.ExtraSamples,ea.SampleFormat,ea.StripByteCounts,ea.StripOffsets,ea.StripRowCounts,ea.TileByteCounts,ea.TileOffsets,ea.SubIFDs],Hb={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},bt={};for(const e in Hb)Hb.hasOwnProperty(e)&&(bt[Hb[e]]=parseInt(e,10));const Xr={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},f8={Unspecified:0,Assocalpha:1,Unassalpha:2},Gwe={Version:0,AddCompression:1},Hwe={None:0,Deflate:1,Zstandard:2},h8={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function d8(e,t){const{width:n,height:i}=e,r=new Uint8Array(n*i*3);let s;for(let o=0,a=0;o<e.length;++o,a+=3)s=256-e[o]/t*256,r[a]=s,r[a+1]=s,r[a+2]=s;return r}function p8(e,t){const{width:n,height:i}=e,r=new Uint8Array(n*i*3);let s;for(let o=0,a=0;o<e.length;++o,a+=3)s=e[o]/t*256,r[a]=s,r[a+1]=s,r[a+2]=s;return r}function m8(e,t){const{width:n,height:i}=e,r=new Uint8Array(n*i*3),s=t.length/3,o=t.length/3*2;for(let a=0,c=0;a<e.length;++a,c+=3){const u=e[a];r[c]=t[u]/65536*256,r[c+1]=t[u+s]/65536*256,r[c+2]=t[u+o]/65536*256}return r}function g8(e){const{width:t,height:n}=e,i=new Uint8Array(t*n*3);for(let r=0,s=0;r<e.length;r+=4,s+=3){const o=e[r],a=e[r+1],c=e[r+2],u=e[r+3];i[s]=255*((255-o)/256)*((255-u)/256),i[s+1]=255*((255-a)/256)*((255-u)/256),i[s+2]=255*((255-c)/256)*((255-u)/256)}return i}function _8(e){const{width:t,height:n}=e,i=new Uint8ClampedArray(t*n*3);for(let r=0,s=0;r<e.length;r+=3,s+=3){const o=e[r],a=e[r+1],c=e[r+2];i[s]=o+1.402*(c-128),i[s+1]=o-.34414*(a-128)-.71414*(c-128),i[s+2]=o+1.772*(a-128)}return i}const y8=.95047,b8=1,T8=1.08883;function x8(e){const{width:t,height:n}=e,i=new Uint8Array(t*n*3);for(let r=0,s=0;r<e.length;r+=3,s+=3){const o=e[r+0],a=e[r+1]<<24>>24,c=e[r+2]<<24>>24;let u=(o+16)/116,h=a/500+u,d=u-c/200,p,g,_;h=y8*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),u=b8*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),d=T8*(d*d*d>.008856?d*d*d:(d-16/116)/7.787),p=h*3.2406+u*-1.5372+d*-.4986,g=h*-.9689+u*1.8758+d*.0415,_=h*.0557+u*-.204+d*1.057,p=p>.0031308?1.055*p**(1/2.4)-.055:12.92*p,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,_=_>.0031308?1.055*_**(1/2.4)-.055:12.92*_,i[s]=Math.max(0,Math.min(1,p))*255,i[s+1]=Math.max(0,Math.min(1,g))*255,i[s+2]=Math.max(0,Math.min(1,_))*255}return i}const zD=new Map;function Ol(e,t){Array.isArray(e)||(e=[e]),e.forEach(n=>zD.set(n,t))}async function UD(e){const t=zD.get(e.Compression);if(!t)throw new Error(`Unknown compression method identifier: ${e.Compression}`);const n=await t();return new n(e)}Ol([void 0,1],()=>ga(()=>import("./raw-Dt1HMqYc.js"),__vite__mapDeps([0,1]),import.meta.url).then(e=>e.default));Ol(5,()=>ga(()=>import("./lzw-DpvbRwG5.js"),__vite__mapDeps([2,1]),import.meta.url).then(e=>e.default));Ol(6,()=>{throw new Error("old style JPEG compression is not supported.")});Ol(7,()=>ga(()=>import("./jpeg-CdeCw_eT.js"),__vite__mapDeps([3,1]),import.meta.url).then(e=>e.default));Ol([8,32946],()=>ga(()=>import("./deflate-CUkHh1nh.js"),__vite__mapDeps([4,5,1]),import.meta.url).then(e=>e.default));Ol(32773,()=>ga(()=>import("./packbits-DQnG8s9w.js"),__vite__mapDeps([6,1]),import.meta.url).then(e=>e.default));Ol(34887,()=>ga(()=>import("./lerc-BzRpccL0.js"),__vite__mapDeps([7,5,8,1]),import.meta.url).then(async e=>(await e.zstd.init(),e)).then(e=>e.default));Ol(50001,()=>ga(()=>import("./webimage-BcnuJlio.js"),__vite__mapDeps([9,1]),import.meta.url).then(e=>e.default));function Py(e,t,n,i=1){return new(Object.getPrototypeOf(e)).constructor(t*n*i)}function E8(e,t,n,i,r){const s=t/i,o=n/r;return e.map(a=>{const c=Py(a,i,r);for(let u=0;u<r;++u){const h=Math.min(Math.round(o*u),n-1);for(let d=0;d<i;++d){const p=Math.min(Math.round(s*d),t-1),g=a[h*t+p];c[u*i+d]=g}}return c})}function zf(e,t,n){return(1-n)*e+n*t}function C8(e,t,n,i,r){const s=t/i,o=n/r;return e.map(a=>{const c=Py(a,i,r);for(let u=0;u<r;++u){const h=o*u,d=Math.floor(h),p=Math.min(Math.ceil(h),n-1);for(let g=0;g<i;++g){const _=s*g,b=_%1,x=Math.floor(_),E=Math.min(Math.ceil(_),t-1),C=a[d*t+x],w=a[d*t+E],S=a[p*t+x],v=a[p*t+E],D=zf(zf(C,w,b),zf(S,v,b),h%1);c[u*i+g]=D}}return c})}function w8(e,t,n,i,r,s="nearest"){switch(s.toLowerCase()){case"nearest":return E8(e,t,n,i,r);case"bilinear":case"linear":return C8(e,t,n,i,r);default:throw new Error(`Unsupported resampling method: '${s}'`)}}function A8(e,t,n,i,r,s){const o=t/i,a=n/r,c=Py(e,i,r,s);for(let u=0;u<r;++u){const h=Math.min(Math.round(a*u),n-1);for(let d=0;d<i;++d){const p=Math.min(Math.round(o*d),t-1);for(let g=0;g<s;++g){const _=e[h*t*s+p*s+g];c[u*i*s+d*s+g]=_}}}return c}function S8(e,t,n,i,r,s){const o=t/i,a=n/r,c=Py(e,i,r,s);for(let u=0;u<r;++u){const h=a*u,d=Math.floor(h),p=Math.min(Math.ceil(h),n-1);for(let g=0;g<i;++g){const _=o*g,b=_%1,x=Math.floor(_),E=Math.min(Math.ceil(_),t-1);for(let C=0;C<s;++C){const w=e[d*t*s+x*s+C],S=e[d*t*s+E*s+C],v=e[p*t*s+x*s+C],D=e[p*t*s+E*s+C],L=zf(zf(w,S,b),zf(v,D,b),h%1);c[u*i*s+g*s+C]=L}}}return c}function v8(e,t,n,i,r,s,o="nearest"){switch(o.toLowerCase()){case"nearest":return A8(e,t,n,i,r,s);case"bilinear":case"linear":return S8(e,t,n,i,r,s);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function I8(e,t,n){let i=0;for(let r=t;r<n;++r)i+=e[r];return i}function Ax(e,t,n){switch(e){case 1:if(t<=8)return new Uint8Array(n);if(t<=16)return new Uint16Array(n);if(t<=32)return new Uint32Array(n);break;case 2:if(t===8)return new Int8Array(n);if(t===16)return new Int16Array(n);if(t===32)return new Int32Array(n);break;case 3:switch(t){case 16:case 32:return new Float32Array(n);case 64:return new Float64Array(n)}break}throw Error("Unsupported data format/bitsPerSample")}function O8(e,t){return(e===1||e===2)&&t<=32&&t%8===0?!1:!(e===3&&(t===16||t===32||t===64))}function R8(e,t,n,i,r,s,o){const a=new DataView(e),c=n===2?o*s:o*s*i,u=n===2?1:i,h=Ax(t,r,c),d=parseInt("1".repeat(r),2);if(t===1){let p;n===1?p=i*r:p=r;let g=s*p;g&7&&(g=g+7&-8);for(let _=0;_<o;++_){const b=_*g;for(let x=0;x<s;++x){const E=b+x*u*r;for(let C=0;C<u;++C){const w=E+C*r,S=(_*s+x)*u+C,v=Math.floor(w/8),D=w%8;if(D+r<=8)h[S]=a.getUint8(v)>>8-r-D&d;else if(D+r<=16)h[S]=a.getUint16(v)>>16-r-D&d;else if(D+r<=24){const L=a.getUint16(v)<<8|a.getUint8(v+2);h[S]=L>>24-r-D&d}else h[S]=a.getUint32(v)>>32-r-D&d}}}}return h.buffer}class kD{constructor(t,n,i,r,s,o){this.fileDirectory=t,this.geoKeys=n,this.dataView=i,this.littleEndian=r,this.tiles=s?{}:null,this.isTiled=!t.StripOffsets;const a=t.PlanarConfiguration;if(this.planarConfiguration=typeof a>"u"?1:a,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=o}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(t){return this.isTiled||(t+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-t*this.getTileHeight()}getBytesPerPixel(){let t=0;for(let n=0;n<this.fileDirectory.BitsPerSample.length;++n)t+=this.getSampleByteSize(n);return t}getSampleByteSize(t){if(t>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${t} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[t]/8)}getReaderForSample(t){const n=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[t]:1,i=this.fileDirectory.BitsPerSample[t];switch(n){case 1:if(i<=8)return DataView.prototype.getUint8;if(i<=16)return DataView.prototype.getUint16;if(i<=32)return DataView.prototype.getUint32;break;case 2:if(i<=8)return DataView.prototype.getInt8;if(i<=16)return DataView.prototype.getInt16;if(i<=32)return DataView.prototype.getInt32;break;case 3:switch(i){case 16:return function(r,s){return DD(this,r,s)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(t=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[t]:1}getBitsPerSample(t=0){return this.fileDirectory.BitsPerSample[t]}getArrayForSample(t,n){const i=this.getSampleFormat(t),r=this.getBitsPerSample(t);return Ax(i,r,n)}async getTileOrStrip(t,n,i,r,s){const o=Math.ceil(this.getWidth()/this.getTileWidth()),a=Math.ceil(this.getHeight()/this.getTileHeight());let c;const{tiles:u}=this;this.planarConfiguration===1?c=n*o+t:this.planarConfiguration===2&&(c=i*o*a+n*o+t);let h,d;this.isTiled?(h=this.fileDirectory.TileOffsets[c],d=this.fileDirectory.TileByteCounts[c]):(h=this.fileDirectory.StripOffsets[c],d=this.fileDirectory.StripByteCounts[c]);const p=(await this.source.fetch([{offset:h,length:d}],s))[0];let g;return u===null||!u[c]?(g=(async()=>{let _=await r.decode(this.fileDirectory,p);const b=this.getSampleFormat(),x=this.getBitsPerSample();return O8(b,x)&&(_=R8(_,b,this.planarConfiguration,this.getSamplesPerPixel(),x,this.getTileWidth(),this.getBlockHeight(n))),_})(),u!==null&&(u[c]=g)):g=u[c],{x:t,y:n,sample:i,data:await g}}async _readRaster(t,n,i,r,s,o,a,c,u){const h=this.getTileWidth(),d=this.getTileHeight(),p=this.getWidth(),g=this.getHeight(),_=Math.max(Math.floor(t[0]/h),0),b=Math.min(Math.ceil(t[2]/h),Math.ceil(p/h)),x=Math.max(Math.floor(t[1]/d),0),E=Math.min(Math.ceil(t[3]/d),Math.ceil(g/d)),C=t[2]-t[0];let w=this.getBytesPerPixel();const S=[],v=[];for(let O=0;O<n.length;++O)this.planarConfiguration===1?S.push(I8(this.fileDirectory.BitsPerSample,0,n[O])/8):S.push(0),v.push(this.getReaderForSample(n[O]));const D=[],{littleEndian:L}=this;for(let O=x;O<E;++O)for(let N=_;N<b;++N){let B;this.planarConfiguration===1&&(B=this.getTileOrStrip(N,O,0,s,u));for(let U=0;U<n.length;++U){const V=U,f=n[U];this.planarConfiguration===2&&(w=this.getSampleByteSize(f),B=this.getTileOrStrip(N,O,f,s,u));const I=B.then(F=>{const G=F.data,W=new DataView(G),X=this.getBlockHeight(F.y),Z=F.y*d,$=F.x*h,ne=Z+X,le=(F.x+1)*h,pe=v[V],we=Math.min(X,X-(ne-t[3]),g-Z),me=Math.min(h,h-(le-t[2]),p-$);for(let Pe=Math.max(0,t[1]-Z);Pe<we;++Pe)for(let ot=Math.max(0,t[0]-$);ot<me;++ot){const At=(Pe*h+ot)*w,St=pe.call(W,At+S[V],L);let he;r?(he=(Pe+Z-t[1])*C*n.length+(ot+$-t[0])*n.length+V,i[he]=St):(he=(Pe+Z-t[1])*C+ot+$-t[0],i[V][he]=St)}});D.push(I)}}if(await Promise.all(D),o&&t[2]-t[0]!==o||a&&t[3]-t[1]!==a){let O;return r?O=v8(i,t[2]-t[0],t[3]-t[1],o,a,n.length,c):O=w8(i,t[2]-t[0],t[3]-t[1],o,a,c),O.width=o,O.height=a,O}return i.width=o||t[2]-t[0],i.height=a||t[3]-t[1],i}async readRasters({window:t,samples:n=[],interleave:i,pool:r=null,width:s,height:o,resampleMethod:a,fillValue:c,signal:u}={}){const h=t||[0,0,this.getWidth(),this.getHeight()];if(h[0]>h[2]||h[1]>h[3])throw new Error("Invalid subsets");const d=h[2]-h[0],p=h[3]-h[1],g=d*p,_=this.getSamplesPerPixel();if(!n||!n.length)for(let C=0;C<_;++C)n.push(C);else for(let C=0;C<n.length;++C)if(n[C]>=_)return Promise.reject(new RangeError(`Invalid sample index '${n[C]}'.`));let b;if(i){const C=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,w=Math.max.apply(null,this.fileDirectory.BitsPerSample);b=Ax(C,w,g*n.length),c&&b.fill(c)}else{b=[];for(let C=0;C<n.length;++C){const w=this.getArrayForSample(n[C],g);Array.isArray(c)&&C<c.length?w.fill(c[C]):c&&!Array.isArray(c)&&w.fill(c),b.push(w)}}const x=r||await UD(this.fileDirectory);return await this._readRaster(h,n,b,i,x,s,o,a,u)}async readRGB({window:t,interleave:n=!0,pool:i=null,width:r,height:s,resampleMethod:o,enableAlpha:a=!1,signal:c}={}){const u=t||[0,0,this.getWidth(),this.getHeight()];if(u[0]>u[2]||u[1]>u[3])throw new Error("Invalid subsets");const h=this.fileDirectory.PhotometricInterpretation;if(h===Xr.RGB){let E=[0,1,2];if(this.fileDirectory.ExtraSamples!==f8.Unspecified&&a){E=[];for(let C=0;C<this.fileDirectory.BitsPerSample.length;C+=1)E.push(C)}return this.readRasters({window:t,interleave:n,samples:E,pool:i,width:r,height:s,resampleMethod:o,signal:c})}let d;switch(h){case Xr.WhiteIsZero:case Xr.BlackIsZero:case Xr.Palette:d=[0];break;case Xr.CMYK:d=[0,1,2,3];break;case Xr.YCbCr:case Xr.CIELab:d=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const p={window:u,interleave:!0,samples:d,pool:i,width:r,height:s,resampleMethod:o,signal:c},{fileDirectory:g}=this,_=await this.readRasters(p),b=2**this.fileDirectory.BitsPerSample[0];let x;switch(h){case Xr.WhiteIsZero:x=d8(_,b);break;case Xr.BlackIsZero:x=p8(_,b);break;case Xr.Palette:x=m8(_,g.ColorMap);break;case Xr.CMYK:x=g8(_);break;case Xr.YCbCr:x=_8(_);break;case Xr.CIELab:x=x8(_);break;default:throw new Error("Unsupported photometric interpretation.")}if(!n){const E=new Uint8Array(x.length/3),C=new Uint8Array(x.length/3),w=new Uint8Array(x.length/3);for(let S=0,v=0;S<x.length;S+=3,++v)E[v]=x[S],C[v]=x[S+1],w[v]=x[S+2];x=[E,C,w]}return x.width=_.width,x.height=_.height,x}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const t=[];for(let n=0;n<this.fileDirectory.ModelTiepoint.length;n+=6)t.push({i:this.fileDirectory.ModelTiepoint[n],j:this.fileDirectory.ModelTiepoint[n+1],k:this.fileDirectory.ModelTiepoint[n+2],x:this.fileDirectory.ModelTiepoint[n+3],y:this.fileDirectory.ModelTiepoint[n+4],z:this.fileDirectory.ModelTiepoint[n+5]});return t}getGDALMetadata(t=null){const n={};if(!this.fileDirectory.GDAL_METADATA)return null;const i=this.fileDirectory.GDAL_METADATA;let r=l8(i,"Item");t===null?r=r.filter(s=>Vb(s,"sample")===void 0):r=r.filter(s=>Number(Vb(s,"sample"))===t);for(let s=0;s<r.length;++s){const o=r[s];n[Vb(o,"name")]=o.inner}return n}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const t=this.fileDirectory.GDAL_NODATA;return Number(t.substring(0,t.length-1))}getOrigin(){const t=this.fileDirectory.ModelTiepoint,n=this.fileDirectory.ModelTransformation;if(t&&t.length===6)return[t[3],t[4],t[5]];if(n)return[n[3],n[7],n[11]];throw new Error("The image does not have an affine transformation.")}getResolution(t=null){const n=this.fileDirectory.ModelPixelScale,i=this.fileDirectory.ModelTransformation;if(n)return[n[0],-n[1],n[2]];if(i)return i[1]===0&&i[4]===0?[i[0],-i[5],i[10]]:[Math.sqrt(i[0]*i[0]+i[4]*i[4]),-Math.sqrt(i[1]*i[1]+i[5]*i[5]),i[10]];if(t){const[r,s,o]=t.getResolution();return[r*t.getWidth()/this.getWidth(),s*t.getHeight()/this.getHeight(),o*t.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(t=!1){const n=this.getHeight(),i=this.getWidth();if(this.fileDirectory.ModelTransformation&&!t){const[r,s,o,a,c,u,h,d]=this.fileDirectory.ModelTransformation,g=[[0,0],[0,n],[i,0],[i,n]].map(([x,E])=>[a+r*x+s*E,d+c*x+u*E]),_=g.map(x=>x[0]),b=g.map(x=>x[1]);return[Math.min(..._),Math.min(...b),Math.max(..._),Math.max(...b)]}else{const r=this.getOrigin(),s=this.getResolution(),o=r[0],a=r[1],c=o+s[0]*i,u=a+s[1]*n;return[Math.min(o,c),Math.min(a,u),Math.max(o,c),Math.max(a,u)]}}}class D8{constructor(t){this._dataView=new DataView(t)}get buffer(){return this._dataView.buffer}getUint64(t,n){const i=this.getUint32(t,n),r=this.getUint32(t+4,n);let s;if(n){if(s=i+2**32*r,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*i+r,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}getInt64(t,n){let i=0;const r=(this._dataView.getUint8(t+(n?7:0))&128)>0;let s=!0;for(let o=0;o<8;o++){let a=this._dataView.getUint8(t+(n?o:7-o));r&&(s?a!==0&&(a=~(a-1)&255,s=!1):a=~a&255),i+=a*256**o}return r&&(i=-i),i}getUint8(t,n){return this._dataView.getUint8(t,n)}getInt8(t,n){return this._dataView.getInt8(t,n)}getUint16(t,n){return this._dataView.getUint16(t,n)}getInt16(t,n){return this._dataView.getInt16(t,n)}getUint32(t,n){return this._dataView.getUint32(t,n)}getInt32(t,n){return this._dataView.getInt32(t,n)}getFloat16(t,n){return DD(this._dataView,t,n)}getFloat32(t,n){return this._dataView.getFloat32(t,n)}getFloat64(t,n){return this._dataView.getFloat64(t,n)}}class M8{constructor(t,n,i,r){this._dataView=new DataView(t),this._sliceOffset=n,this._littleEndian=i,this._bigTiff=r}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(t,n){return this.sliceOffset<=t&&this.sliceTop>=t+n}readUint8(t){return this._dataView.getUint8(t-this._sliceOffset,this._littleEndian)}readInt8(t){return this._dataView.getInt8(t-this._sliceOffset,this._littleEndian)}readUint16(t){return this._dataView.getUint16(t-this._sliceOffset,this._littleEndian)}readInt16(t){return this._dataView.getInt16(t-this._sliceOffset,this._littleEndian)}readUint32(t){return this._dataView.getUint32(t-this._sliceOffset,this._littleEndian)}readInt32(t){return this._dataView.getInt32(t-this._sliceOffset,this._littleEndian)}readFloat32(t){return this._dataView.getFloat32(t-this._sliceOffset,this._littleEndian)}readFloat64(t){return this._dataView.getFloat64(t-this._sliceOffset,this._littleEndian)}readUint64(t){const n=this.readUint32(t),i=this.readUint32(t+4);let r;if(this._littleEndian){if(r=n+2**32*i,!Number.isSafeInteger(r))throw new Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}if(r=2**32*n+i,!Number.isSafeInteger(r))throw new Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}readInt64(t){let n=0;const i=(this._dataView.getUint8(t+(this._littleEndian?7:0))&128)>0;let r=!0;for(let s=0;s<8;s++){let o=this._dataView.getUint8(t+(this._littleEndian?s:7-s));i&&(r?o!==0&&(o=~(o-1)&255,r=!1):o=~o&255),n+=o*256**s}return i&&(n=-n),n}readOffset(t){return this._bigTiff?this.readUint64(t):this.readUint32(t)}}const L8=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class P8{constructor(t=L8,n){this.workers=null,this._awaitingDecoder=null,this.size=t,this.messageId=0,t&&(this._awaitingDecoder=n?Promise.resolve(n):new Promise(i=>{ga(()=>import("./decoder-CaSv2t6h.js"),[],import.meta.url).then(r=>{i(r.create)})}),this._awaitingDecoder.then(i=>{this._awaitingDecoder=null,this.workers=[];for(let r=0;r<t;r++)this.workers.push({worker:i(),idle:!0})}))}async decode(t,n){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?UD(t).then(i=>i.decode(t,n)):new Promise(i=>{const r=this.workers.find(a=>a.idle)||this.workers[Math.floor(Math.random()*this.size)];r.idle=!1;const s=this.messageId++,o=a=>{a.data.id===s&&(r.idle=!0,i(a.data.decoded),r.worker.removeEventListener("message",o))};r.worker.addEventListener("message",o),r.worker.postMessage({fileDirectory:t,buffer:n,id:s},[n])})}destroy(){this.workers&&(this.workers.forEach(t=>{t.worker.terminate()}),this.workers=null)}}const PS=`\r
\r
`;function jD(e){if(typeof Object.fromEntries<"u")return Object.fromEntries(e);const t={};for(const[n,i]of e)t[n.toLowerCase()]=i;return t}function N8(e){const t=e.split(`\r
`).map(n=>{const i=n.split(":").map(r=>r.trim());return i[0]=i[0].toLowerCase(),i});return jD(t)}function F8(e){const[t,...n]=e.split(";").map(r=>r.trim()),i=n.map(r=>r.split("="));return{type:t,params:jD(i)}}function Sx(e){let t,n,i;return e&&([,t,n,i]=e.match(/bytes (\d+)-(\d+)\/(\d+)/),t=parseInt(t,10),n=parseInt(n,10),i=parseInt(i,10)),{start:t,end:n,total:i}}function B8(e,t){let n=null;const i=new TextDecoder("ascii"),r=[],s=`--${t}`,o=`${s}--`;for(let a=0;a<10;++a)i.decode(new Uint8Array(e,a,s.length))===s&&(n=a);if(n===null)throw new Error("Could not find initial boundary");for(;n<e.byteLength;){const a=i.decode(new Uint8Array(e,n,Math.min(s.length+1024,e.byteLength-n)));if(a.length===0||a.startsWith(o))break;if(!a.startsWith(s))throw new Error("Part does not start with boundary");const c=a.substr(s.length+2);if(c.length===0)break;const u=c.indexOf(PS),h=N8(c.substr(0,u)),{start:d,end:p,total:g}=Sx(h["content-range"]),_=n+s.length+u+PS.length,b=parseInt(p,10)+1-parseInt(d,10);r.push({headers:h,data:e.slice(_,_+b),offset:d,length:b,fileSize:g}),n=_+b+4}return r}class hC{async fetch(t,n=void 0){return Promise.all(t.map(i=>this.fetchSlice(i,n)))}async fetchSlice(t){throw new Error(`fetching of slice ${t} not possible, not implemented`)}get fileSize(){return null}async close(){}}class z8 extends Map{constructor(t={}){if(super(),!(t.maxSize&&t.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof t.maxAge=="number"&&t.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=t.maxSize,this.maxAge=t.maxAge||Number.POSITIVE_INFINITY,this.onEviction=t.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(t){if(typeof this.onEviction=="function")for(const[n,i]of t)this.onEviction(n,i.value)}_deleteIfExpired(t,n){return typeof n.expiry=="number"&&n.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(t,n.value),this.delete(t)):!1}_getOrDeleteIfExpired(t,n){if(this._deleteIfExpired(t,n)===!1)return n.value}_getItemValue(t,n){return n.expiry?this._getOrDeleteIfExpired(t,n):n.value}_peek(t,n){const i=n.get(t);return this._getItemValue(t,i)}_set(t,n){this.cache.set(t,n),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(t,n){this.oldCache.delete(t),this._set(t,n)}*_entriesAscending(){for(const t of this.oldCache){const[n,i]=t;this.cache.has(n)||this._deleteIfExpired(n,i)===!1&&(yield t)}for(const t of this.cache){const[n,i]=t;this._deleteIfExpired(n,i)===!1&&(yield t)}}get(t){if(this.cache.has(t)){const n=this.cache.get(t);return this._getItemValue(t,n)}if(this.oldCache.has(t)){const n=this.oldCache.get(t);if(this._deleteIfExpired(t,n)===!1)return this._moveToRecent(t,n),n.value}}set(t,n,{maxAge:i=this.maxAge}={}){const r=typeof i=="number"&&i!==Number.POSITIVE_INFINITY?Date.now()+i:void 0;return this.cache.has(t)?this.cache.set(t,{value:n,expiry:r}):this._set(t,{value:n,expiry:r}),this}has(t){return this.cache.has(t)?!this._deleteIfExpired(t,this.cache.get(t)):this.oldCache.has(t)?!this._deleteIfExpired(t,this.oldCache.get(t)):!1}peek(t){if(this.cache.has(t))return this._peek(t,this.cache);if(this.oldCache.has(t))return this._peek(t,this.oldCache)}delete(t){const n=this.cache.delete(t);return n&&this._size--,this.oldCache.delete(t)||n}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(t){if(!(t&&t>0))throw new TypeError("`maxSize` must be a number greater than 0");const n=[...this._entriesAscending()],i=n.length-t;i<0?(this.cache=new Map(n),this.oldCache=new Map,this._size=n.length):(i>0&&this._emitEvictions(n.slice(0,i)),this.oldCache=new Map(n.slice(i)),this.cache=new Map,this._size=0),this.maxSize=t}*keys(){for(const[t]of this)yield t}*values(){for(const[,t]of this)yield t}*[Symbol.iterator](){for(const t of this.cache){const[n,i]=t;this._deleteIfExpired(n,i)===!1&&(yield[n,i.value])}for(const t of this.oldCache){const[n,i]=t;this.cache.has(n)||this._deleteIfExpired(n,i)===!1&&(yield[n,i.value])}}*entriesDescending(){let t=[...this.cache];for(let n=t.length-1;n>=0;--n){const i=t[n],[r,s]=i;this._deleteIfExpired(r,s)===!1&&(yield[r,s.value])}t=[...this.oldCache];for(let n=t.length-1;n>=0;--n){const i=t[n],[r,s]=i;this.cache.has(r)||this._deleteIfExpired(r,s)===!1&&(yield[r,s.value])}}*entriesAscending(){for(const[t,n]of this._entriesAscending())yield[t,n.value]}get size(){if(!this._size)return this.oldCache.size;let t=0;for(const n of this.oldCache.keys())this.cache.has(n)||t++;return Math.min(this._size+t,this.maxSize)}entries(){return this.entriesAscending()}forEach(t,n=this){for(const[i,r]of this.entriesAscending())t.call(n,r,i,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function U8(e){return new Promise(t=>setTimeout(t,e))}function k8(e,t){const n=Array.isArray(e)?e:Array.from(e),i=Array.isArray(t)?t:Array.from(t);return n.map((r,s)=>[r,i[s]])}class eh extends Error{constructor(t){super(t),Error.captureStackTrace&&Error.captureStackTrace(this,eh),this.name="AbortError"}}class j8 extends Error{constructor(t,n){super(n),this.errors=t,this.message=n,this.name="AggregateError"}}const V8=j8;class G8{constructor(t,n,i=null){this.offset=t,this.length=n,this.data=i}get top(){return this.offset+this.length}}class NS{constructor(t,n,i){this.offset=t,this.length=n,this.blockIds=i}}class H8 extends hC{constructor(t,{blockSize:n=65536,cacheSize:i=100}={}){super(),this.source=t,this.blockSize=n,this.blockCache=new z8({maxSize:i,onEviction:(r,s)=>{this.evictedBlocks.set(r,s)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(t,n){const i=[],r=[],s=[];this.evictedBlocks.clear();for(const{offset:p,length:g}of t){let _=p+g;const{fileSize:b}=this;b!==null&&(_=Math.min(_,b));const x=Math.floor(p/this.blockSize)*this.blockSize;for(let E=x;E<_;E+=this.blockSize){const C=Math.floor(E/this.blockSize);!this.blockCache.has(C)&&!this.blockRequests.has(C)&&(this.blockIdsToFetch.add(C),r.push(C)),this.blockRequests.has(C)&&i.push(this.blockRequests.get(C)),s.push(C)}}await U8(),this.fetchBlocks(n);const o=[];for(const p of r)this.blockRequests.has(p)&&o.push(this.blockRequests.get(p));await Promise.allSettled(i),await Promise.allSettled(o);const a=[],c=s.filter(p=>this.abortedBlockIds.has(p)||!this.blockCache.has(p));if(c.forEach(p=>this.blockIdsToFetch.add(p)),c.length>0&&n&&!n.aborted){this.fetchBlocks(null);for(const p of c){const g=this.blockRequests.get(p);if(!g)throw new Error(`Block ${p} is not in the block requests`);a.push(g)}await Promise.allSettled(a)}if(n&&n.aborted)throw new eh("Request was aborted");const u=s.map(p=>this.blockCache.get(p)||this.evictedBlocks.get(p)),h=u.filter(p=>!p);if(h.length)throw new V8(h,"Request failed");const d=new Map(k8(s,u));return this.readSliceData(t,d)}fetchBlocks(t){if(this.blockIdsToFetch.size>0){const n=this.groupBlocks(this.blockIdsToFetch),i=this.source.fetch(n,t);for(let r=0;r<n.length;++r){const s=n[r];for(const o of s.blockIds)this.blockRequests.set(o,(async()=>{try{const a=(await i)[r],c=o*this.blockSize,u=c-a.offset,h=Math.min(u+this.blockSize,a.data.byteLength),d=a.data.slice(u,h),p=new G8(c,d.byteLength,d,o);this.blockCache.set(o,p),this.abortedBlockIds.delete(o)}catch(a){if(a.name==="AbortError")a.signal=t,this.blockCache.delete(o),this.abortedBlockIds.add(o);else throw a}finally{this.blockRequests.delete(o)}})())}this.blockIdsToFetch.clear()}}groupBlocks(t){const n=Array.from(t).sort((o,a)=>o-a);if(n.length===0)return[];let i=[],r=null;const s=[];for(const o of n)r===null||r+1===o?(i.push(o),r=o):(s.push(new NS(i[0]*this.blockSize,i.length*this.blockSize,i)),i=[o],r=o);return s.push(new NS(i[0]*this.blockSize,i.length*this.blockSize,i)),s}readSliceData(t,n){return t.map(i=>{let r=i.offset+i.length;this.fileSize!==null&&(r=Math.min(this.fileSize,r));const s=Math.floor(i.offset/this.blockSize),o=Math.floor(r/this.blockSize),a=new ArrayBuffer(i.length),c=new Uint8Array(a);for(let u=s;u<=o;++u){const h=n.get(u),d=h.offset-i.offset,p=h.top-r;let g=0,_=0,b;d<0?g=-d:d>0&&(_=d),p<0?b=h.length-g:b=r-h.offset-g;const x=new Uint8Array(h.data,g,b);c.set(x,_)}return a})}}class dC{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(t){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class pC{constructor(t){this.url=t}async request({headers:t,signal:n}={}){throw new Error("request is not implemented")}}class q8 extends dC{constructor(t){super(),this.response=t}get status(){return this.response.status}getHeader(t){return this.response.headers.get(t)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class W8 extends pC{constructor(t,n){super(t),this.credentials=n}async request({headers:t,signal:n}={}){const i=await fetch(this.url,{headers:t,credentials:this.credentials,signal:n});return new q8(i)}}class $8 extends dC{constructor(t,n){super(),this.xhr=t,this.data=n}get status(){return this.xhr.status}getHeader(t){return this.xhr.getResponseHeader(t)}async getData(){return this.data}}class X8 extends pC{constructRequest(t,n){return new Promise((i,r)=>{const s=new XMLHttpRequest;s.open("GET",this.url),s.responseType="arraybuffer";for(const[o,a]of Object.entries(t))s.setRequestHeader(o,a);s.onload=()=>{const o=s.response;i(new $8(s,o))},s.onerror=r,s.onabort=()=>r(new eh("Request aborted")),s.send(),n&&(n.aborted&&s.abort(),n.addEventListener("abort",()=>s.abort()))})}async request({headers:t,signal:n}={}){return await this.constructRequest(t,n)}}const qb={};class Y8 extends dC{constructor(t,n){super(),this.response=t,this.dataPromise=n}get status(){return this.response.statusCode}getHeader(t){return this.response.headers[t]}async getData(){return await this.dataPromise}}class K8 extends pC{constructor(t){super(t),this.parsedUrl=qb.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",qb)}constructRequest(t,n){return new Promise((i,r)=>{const s=this.httpApi.get({...this.parsedUrl,headers:t},o=>{const a=new Promise(c=>{const u=[];o.on("data",h=>{u.push(h)}),o.on("end",()=>{const h=Buffer.concat(u).buffer;c(h)}),o.on("error",r)});i(new Y8(o,a))});s.on("error",r),n&&(n.aborted&&s.destroy(new eh("Request aborted")),n.addEventListener("abort",()=>s.destroy(new eh("Request aborted"))))})}async request({headers:t,signal:n}={}){return await this.constructRequest(t,n)}}class mC extends hC{constructor(t,n,i,r){super(),this.client=t,this.headers=n,this.maxRanges=i,this.allowFullFile=r,this._fileSize=null}async fetch(t,n){return this.maxRanges>=t.length?this.fetchSlices(t,n):(this.maxRanges>0&&t.length>1,Promise.all(t.map(i=>this.fetchSlice(i,n))))}async fetchSlices(t,n){const i=await this.client.request({headers:{...this.headers,Range:`bytes=${t.map(({offset:r,length:s})=>`${r}-${r+s}`).join(",")}`},signal:n});if(i.ok)if(i.status===206){const{type:r,params:s}=F8(i.getHeader("content-type"));if(r==="multipart/byteranges"){const d=B8(await i.getData(),s.boundary);return this._fileSize=d[0].fileSize||null,d}const o=await i.getData(),{start:a,end:c,total:u}=Sx(i.getHeader("content-range"));this._fileSize=u||null;const h=[{data:o,offset:a,length:c-a}];if(t.length>1){const d=await Promise.all(t.slice(1).map(p=>this.fetchSlice(p,n)));return h.concat(d)}return h}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const r=await i.getData();return this._fileSize=r.byteLength,[{data:r,offset:0,length:r.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(t,n){const{offset:i,length:r}=t,s=await this.client.request({headers:{...this.headers,Range:`bytes=${i}-${i+r}`},signal:n});if(s.ok)if(s.status===206){const o=await s.getData(),{total:a}=Sx(s.getHeader("content-range"));return this._fileSize=a||null,{data:o,offset:i,length:r}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const o=await s.getData();return this._fileSize=o.byteLength,{data:o,offset:0,length:o.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function gC(e,{blockSize:t,cacheSize:n}){return t===null?e:new H8(e,{blockSize:t,cacheSize:n})}function Z8(e,{headers:t={},credentials:n,maxRanges:i=0,allowFullFile:r=!1,...s}={}){const o=new W8(e,n),a=new mC(o,t,i,r);return gC(a,s)}function J8(e,{headers:t={},maxRanges:n=0,allowFullFile:i=!1,...r}={}){const s=new X8(e),o=new mC(s,t,n,i);return gC(o,r)}function Q8(e,{headers:t={},maxRanges:n=0,allowFullFile:i=!1,...r}={}){const s=new K8(e),o=new mC(s,t,n,i);return gC(o,r)}function vx(e,{forceXHR:t=!1,...n}={}){return typeof fetch=="function"&&!t?Z8(e,n):typeof XMLHttpRequest<"u"?J8(e,n):Q8(e,n)}class ej extends hC{constructor(t){super(),this.file=t}async fetchSlice(t,n){return new Promise((i,r)=>{const s=this.file.slice(t.offset,t.offset+t.length),o=new FileReader;o.onload=a=>i(a.target.result),o.onerror=r,o.onabort=r,o.readAsArrayBuffer(s),n&&n.addEventListener("abort",()=>o.abort())})}}function tj(e){return new ej(e)}function Ix(e){switch(e){case bt.BYTE:case bt.ASCII:case bt.SBYTE:case bt.UNDEFINED:return 1;case bt.SHORT:case bt.SSHORT:return 2;case bt.LONG:case bt.SLONG:case bt.FLOAT:case bt.IFD:return 4;case bt.RATIONAL:case bt.SRATIONAL:case bt.DOUBLE:case bt.LONG8:case bt.SLONG8:case bt.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${e}`)}}function nj(e){const t=e.GeoKeyDirectory;if(!t)return null;const n={};for(let i=4;i<=t[3]*4;i+=4){const r=h8[t[i]],s=t[i+1]?Gd[t[i+1]]:null,o=t[i+2],a=t[i+3];let c=null;if(!s)c=a;else{if(c=e[s],typeof c>"u"||c===null)throw new Error(`Could not get value of geoKey '${r}'.`);typeof c=="string"?c=c.substring(a,a+o-1):c.subarray&&(c=c.subarray(a,a+o),o===1&&(c=c[0]))}n[r]=c}return n}function qu(e,t,n,i){let r=null,s=null;const o=Ix(t);switch(t){case bt.BYTE:case bt.ASCII:case bt.UNDEFINED:r=new Uint8Array(n),s=e.readUint8;break;case bt.SBYTE:r=new Int8Array(n),s=e.readInt8;break;case bt.SHORT:r=new Uint16Array(n),s=e.readUint16;break;case bt.SSHORT:r=new Int16Array(n),s=e.readInt16;break;case bt.LONG:case bt.IFD:r=new Uint32Array(n),s=e.readUint32;break;case bt.SLONG:r=new Int32Array(n),s=e.readInt32;break;case bt.LONG8:case bt.IFD8:r=new Array(n),s=e.readUint64;break;case bt.SLONG8:r=new Array(n),s=e.readInt64;break;case bt.RATIONAL:r=new Uint32Array(n*2),s=e.readUint32;break;case bt.SRATIONAL:r=new Int32Array(n*2),s=e.readInt32;break;case bt.FLOAT:r=new Float32Array(n),s=e.readFloat32;break;case bt.DOUBLE:r=new Float64Array(n),s=e.readFloat64;break;default:throw new RangeError(`Invalid field type: ${t}`)}if(t===bt.RATIONAL||t===bt.SRATIONAL)for(let a=0;a<n;a+=2)r[a]=s.call(e,i+a*o),r[a+1]=s.call(e,i+(a*o+4));else for(let a=0;a<n;++a)r[a]=s.call(e,i+a*o);return t===bt.ASCII?new TextDecoder("utf-8").decode(r):r}class ij{constructor(t,n,i){this.fileDirectory=t,this.geoKeyDirectory=n,this.nextIFDByteOffset=i}}class vm extends Error{constructor(t){super(`No image at index ${t}`),this.index=t}}class VD{async readRasters(t={}){const{window:n,width:i,height:r}=t;let{resX:s,resY:o,bbox:a}=t;const c=await this.getImage();let u=c;const h=await this.getImageCount(),d=c.getBoundingBox();if(n&&a)throw new Error('Both "bbox" and "window" passed.');if(i||r){if(n){const[_,b]=c.getOrigin(),[x,E]=c.getResolution();a=[_+n[0]*x,b+n[1]*E,_+n[2]*x,b+n[3]*E]}const g=a||d;if(i){if(s)throw new Error("Both width and resX passed");s=(g[2]-g[0])/i}if(r){if(o)throw new Error("Both width and resY passed");o=(g[3]-g[1])/r}}if(s||o){const g=[];for(let _=0;_<h;++_){const b=await this.getImage(_),{SubfileType:x,NewSubfileType:E}=b.fileDirectory;(_===0||x===2||E&1)&&g.push(b)}g.sort((_,b)=>_.getWidth()-b.getWidth());for(let _=0;_<g.length;++_){const b=g[_],x=(d[2]-d[0])/b.getWidth(),E=(d[3]-d[1])/b.getHeight();if(u=b,s&&s>x||o&&o>E)break}}let p=n;if(a){const[g,_]=c.getOrigin(),[b,x]=u.getResolution(c);p=[Math.round((a[0]-g)/b),Math.round((a[1]-_)/x),Math.round((a[2]-g)/b),Math.round((a[3]-_)/x)],p=[Math.min(p[0],p[2]),Math.min(p[1],p[3]),Math.max(p[0],p[2]),Math.max(p[1],p[3])]}return u.readRasters({...t,window:p})}}class th extends VD{constructor(t,n,i,r,s={}){super(),this.source=t,this.littleEndian=n,this.bigTiff=i,this.firstIFDOffset=r,this.cache=s.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(t,n){const i=this.bigTiff?4048:1024;return new M8((await this.source.fetch([{offset:t,length:typeof n<"u"?n:i}]))[0],t,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(t){const n=this.bigTiff?20:12,i=this.bigTiff?8:2;let r=await this.getSlice(t);const s=this.bigTiff?r.readUint64(t):r.readUint16(t),o=s*n+(this.bigTiff?16:6);r.covers(t,o)||(r=await this.getSlice(t,o));const a={};let c=t+(this.bigTiff?8:2);for(let d=0;d<s;c+=n,++d){const p=r.readUint16(c),g=r.readUint16(c+2),_=this.bigTiff?r.readUint64(c+4):r.readUint32(c+4);let b,x;const E=Ix(g),C=c+(this.bigTiff?12:8);if(E*_<=(this.bigTiff?8:4))b=qu(r,g,_,C);else{const w=r.readOffset(C),S=Ix(g)*_;if(r.covers(w,S))b=qu(r,g,_,w);else{const v=await this.getSlice(w,S);b=qu(v,g,_,w)}}_===1&&u8.indexOf(p)===-1&&!(g===bt.RATIONAL||g===bt.SRATIONAL)?x=b[0]:x=b,a[Gd[p]]=x}const u=nj(a),h=r.readOffset(t+i+n*s);return new ij(a,u,h)}async requestIFD(t){if(this.ifdRequests[t])return this.ifdRequests[t];if(t===0)return this.ifdRequests[t]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[t];if(!this.ifdRequests[t-1])try{this.ifdRequests[t-1]=this.requestIFD(t-1)}catch(n){throw n instanceof vm?new vm(t):n}return this.ifdRequests[t]=(async()=>{const n=await this.ifdRequests[t-1];if(n.nextIFDByteOffset===0)throw new vm(t);return this.parseFileDirectoryAt(n.nextIFDByteOffset)})(),this.ifdRequests[t]}async getImage(t=0){const n=await this.requestIFD(t);return new kD(n.fileDirectory,n.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let t=0,n=!0;for(;n;)try{await this.requestIFD(t),++t}catch(i){if(i instanceof vm)n=!1;else throw i}return t}async getGhostValues(){const t=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const n="GDAL_STRUCTURAL_METADATA_SIZE=",i=n.length+100;let r=await this.getSlice(t,i);if(n===qu(r,bt.ASCII,n.length,t)){const o=qu(r,bt.ASCII,i,t).split(`
`)[0],a=Number(o.split("=")[1].split(" ")[0])+o.length;a>i&&(r=await this.getSlice(t,a));const c=qu(r,bt.ASCII,a,t);this.ghostValues={},c.split(`
`).filter(u=>u.length>0).map(u=>u.split("=")).forEach(([u,h])=>{this.ghostValues[u]=h})}return this.ghostValues}static async fromSource(t,n,i){const r=(await t.fetch([{offset:0,length:1024}],i))[0],s=new D8(r),o=s.getUint16(0,0);let a;if(o===18761)a=!0;else if(o===19789)a=!1;else throw new TypeError("Invalid byte order value.");const c=s.getUint16(2,a);let u;if(c===42)u=!1;else if(c===43){if(u=!0,s.getUint16(4,a)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const h=u?s.getUint64(8,a):s.getUint32(4,a);return new th(t,a,u,h,n)}close(){return typeof this.source.close=="function"?this.source.close():!1}}class rj extends VD{constructor(t,n){super(),this.mainFile=t,this.overviewFiles=n,this.imageFiles=[t].concat(n),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const t=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(n=>n.parseFileDirectoryAt(n.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(t),this.fileDirectoriesPerFile}async getImage(t=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let n=0,i=0;for(let r=0;r<this.imageFiles.length;r++){const s=this.imageFiles[r];for(let o=0;o<this.imageCounts[r];o++){if(t===n){const a=await s.requestIFD(i);return new kD(a.fileDirectory,a.geoKeyDirectory,s.dataView,s.littleEndian,s.cache,s.source)}n++,i++}i=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const t=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(n=>n.getImageCount()));return this.imageCounts=await Promise.all(t),this.imageCount=this.imageCounts.reduce((n,i)=>n+i,0),this.imageCount}}async function sj(e,t={},n){return th.fromSource(vx(e,t),n)}async function oj(e,t){return th.fromSource(tj(e),t)}async function aj(e,t=[],n={},i){const r=await th.fromSource(vx(e,n),i),s=await Promise.all(t.map(o=>th.fromSource(vx(o,n))));return new rj(r,s)}function cj(e){e("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"]}var Au=1,Su=2,Uf=3,lj=4,Ox=5,FS=6378137,uj=6356752314e-3,BS=.0066943799901413165,Hd=484813681109536e-20,ge=Math.PI/2,fj=.16666666666666666,hj=.04722222222222222,dj=.022156084656084655,ve=1e-10,er=.017453292519943295,ra=57.29577951308232,rn=Math.PI/4,yp=Math.PI*2,hi=3.14159265359,us={};us.greenwich=0;us.lisbon=-9.131906111111;us.paris=2.337229166667;us.bogota=-74.080916666667;us.madrid=-3.687938888889;us.rome=12.452333333333;us.bern=7.439583333333;us.jakarta=106.807719444444;us.ferro=-17.666666666667;us.brussels=4.367975;us.stockholm=18.058277777778;us.athens=23.7163375;us.oslo=10.722916666667;const pj={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var zS=/[\s_\-\/\(\)]/g;function yl(e,t){if(e[t])return e[t];for(var n=Object.keys(e),i=t.toLowerCase().replace(zS,""),r=-1,s,o;++r<n.length;)if(s=n[r],o=s.toLowerCase().replace(zS,""),o===i)return e[s]}function Rx(e){var t={},n=e.split("+").map(function(a){return a.trim()}).filter(function(a){return a}).reduce(function(a,c){var u=c.split("=");return u.push(!0),a[u[0].toLowerCase()]=u[1],a},{}),i,r,s,o={proj:"projName",datum:"datumCode",rf:function(a){t.rf=parseFloat(a)},lat_0:function(a){t.lat0=a*er},lat_1:function(a){t.lat1=a*er},lat_2:function(a){t.lat2=a*er},lat_ts:function(a){t.lat_ts=a*er},lon_0:function(a){t.long0=a*er},lon_1:function(a){t.long1=a*er},lon_2:function(a){t.long2=a*er},alpha:function(a){t.alpha=parseFloat(a)*er},gamma:function(a){t.rectified_grid_angle=parseFloat(a)},lonc:function(a){t.longc=a*er},x_0:function(a){t.x0=parseFloat(a)},y_0:function(a){t.y0=parseFloat(a)},k_0:function(a){t.k0=parseFloat(a)},k:function(a){t.k0=parseFloat(a)},a:function(a){t.a=parseFloat(a)},b:function(a){t.b=parseFloat(a)},r:function(a){t.a=t.b=parseFloat(a)},r_a:function(){t.R_A=!0},zone:function(a){t.zone=parseInt(a,10)},south:function(){t.utmSouth=!0},towgs84:function(a){t.datum_params=a.split(",").map(function(c){return parseFloat(c)})},to_meter:function(a){t.to_meter=parseFloat(a)},units:function(a){t.units=a;var c=yl(pj,a);c&&(t.to_meter=c.to_meter)},from_greenwich:function(a){t.from_greenwich=a*er},pm:function(a){var c=yl(us,a);t.from_greenwich=(c||parseFloat(a))*er},nadgrids:function(a){a==="@null"?t.datumCode="none":t.nadgrids=a},axis:function(a){var c="ewnsud";a.length===3&&c.indexOf(a.substr(0,1))!==-1&&c.indexOf(a.substr(1,1))!==-1&&c.indexOf(a.substr(2,1))!==-1&&(t.axis=a)},approx:function(){t.approx=!0}};for(i in n)r=n[i],i in o?(s=o[i],typeof s=="function"?s(r):t[s]=r):t[i]=r;return typeof t.datumCode=="string"&&t.datumCode!=="WGS84"&&(t.datumCode=t.datumCode.toLowerCase()),t}var bp=1,GD=2,HD=3,O_=4,qD=5,_C=-1,mj=/\s/,gj=/[A-Za-z]/,_j=/[A-Za-z84_]/,Ny=/[,\]]/,WD=/[\d\.E\-\+]/;function uc(e){if(typeof e!="string")throw new Error("not a string");this.text=e.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=bp}uc.prototype.readCharicter=function(){var e=this.text[this.place++];if(this.state!==O_)for(;mj.test(e);){if(this.place>=this.text.length)return;e=this.text[this.place++]}switch(this.state){case bp:return this.neutral(e);case GD:return this.keyword(e);case O_:return this.quoted(e);case qD:return this.afterquote(e);case HD:return this.number(e);case _C:return}};uc.prototype.afterquote=function(e){if(e==='"'){this.word+='"',this.state=O_;return}if(Ny.test(e)){this.word=this.word.trim(),this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in afterquote yet, index '+this.place)};uc.prototype.afterItem=function(e){if(e===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=bp;return}if(e==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=bp,this.currentObject=this.stack.pop(),this.currentObject||(this.state=_C);return}};uc.prototype.number=function(e){if(WD.test(e)){this.word+=e;return}if(Ny.test(e)){this.word=parseFloat(this.word),this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in number yet, index '+this.place)};uc.prototype.quoted=function(e){if(e==='"'){this.state=qD;return}this.word+=e};uc.prototype.keyword=function(e){if(_j.test(e)){this.word+=e;return}if(e==="["){var t=[];t.push(this.word),this.level++,this.root===null?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,this.state=bp;return}if(Ny.test(e)){this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in keyword yet, index '+this.place)};uc.prototype.neutral=function(e){if(gj.test(e)){this.word=e,this.state=GD;return}if(e==='"'){this.word="",this.state=O_;return}if(WD.test(e)){this.word=e,this.state=HD;return}if(Ny.test(e)){this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in neutral yet, index '+this.place)};uc.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===_C)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function yj(e){var t=new uc(e);return t.output()}function US(e,t,n){Array.isArray(t)&&(n.unshift(t),t=null);var i=t?{}:e,r=n.reduce(function(s,o){return Cf(o,s),s},i);t&&(e[t]=r)}function Cf(e,t){if(!Array.isArray(e)){t[e]=!0;return}var n=e.shift();if(n==="PARAMETER"&&(n=e.shift()),e.length===1){if(Array.isArray(e[0])){t[n]={},Cf(e[0],t[n]);return}t[n]=e[0];return}if(!e.length){t[n]=!0;return}if(n==="TOWGS84"){t[n]=e;return}if(n==="AXIS"){n in t||(t[n]=[]),t[n].push(e);return}Array.isArray(n)||(t[n]={});var i;switch(n){case"UNIT":case"PRIMEM":case"VERT_DATUM":t[n]={name:e[0].toLowerCase(),convert:e[1]},e.length===3&&Cf(e[2],t[n]);return;case"SPHEROID":case"ELLIPSOID":t[n]={name:e[0],a:e[1],rf:e[2]},e.length===4&&Cf(e[3],t[n]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":e[0]=["name",e[0]],US(t,n,e);return;default:for(i=-1;++i<e.length;)if(!Array.isArray(e[i]))return Cf(e,t[n]);return US(t,n,e)}}var bj=.017453292519943295;function Tj(e,t){var n=t[0],i=t[1];!(n in e)&&i in e&&(e[n]=e[i],t.length===3&&(e[n]=t[2](e[n])))}function Yo(e){return e*bj}function xj(e){if(e.type==="GEOGCS"?e.projName="longlat":e.type==="LOCAL_CS"?(e.projName="identity",e.local=!0):typeof e.PROJECTION=="object"?e.projName=Object.keys(e.PROJECTION)[0]:e.projName=e.PROJECTION,e.AXIS){for(var t="",n=0,i=e.AXIS.length;n<i;++n){var r=[e.AXIS[n][0].toLowerCase(),e.AXIS[n][1].toLowerCase()];r[0].indexOf("north")!==-1||(r[0]==="y"||r[0]==="lat")&&r[1]==="north"?t+="n":r[0].indexOf("south")!==-1||(r[0]==="y"||r[0]==="lat")&&r[1]==="south"?t+="s":r[0].indexOf("east")!==-1||(r[0]==="x"||r[0]==="lon")&&r[1]==="east"?t+="e":(r[0].indexOf("west")!==-1||(r[0]==="x"||r[0]==="lon")&&r[1]==="west")&&(t+="w")}t.length===2&&(t+="u"),t.length===3&&(e.axis=t)}e.UNIT&&(e.units=e.UNIT.name.toLowerCase(),e.units==="metre"&&(e.units="meter"),e.UNIT.convert&&(e.type==="GEOGCS"?e.DATUM&&e.DATUM.SPHEROID&&(e.to_meter=e.UNIT.convert*e.DATUM.SPHEROID.a):e.to_meter=e.UNIT.convert));var s=e.GEOGCS;e.type==="GEOGCS"&&(s=e),s&&(s.DATUM?e.datumCode=s.DATUM.name.toLowerCase():e.datumCode=s.name.toLowerCase(),e.datumCode.slice(0,2)==="d_"&&(e.datumCode=e.datumCode.slice(2)),(e.datumCode==="new_zealand_geodetic_datum_1949"||e.datumCode==="new_zealand_1949")&&(e.datumCode="nzgd49"),(e.datumCode==="wgs_1984"||e.datumCode==="world_geodetic_system_1984")&&(e.PROJECTION==="Mercator_Auxiliary_Sphere"&&(e.sphere=!0),e.datumCode="wgs84"),e.datumCode.slice(-6)==="_ferro"&&(e.datumCode=e.datumCode.slice(0,-6)),e.datumCode.slice(-8)==="_jakarta"&&(e.datumCode=e.datumCode.slice(0,-8)),~e.datumCode.indexOf("belge")&&(e.datumCode="rnb72"),s.DATUM&&s.DATUM.SPHEROID&&(e.ellps=s.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),e.ellps.toLowerCase().slice(0,13)==="international"&&(e.ellps="intl"),e.a=s.DATUM.SPHEROID.a,e.rf=parseFloat(s.DATUM.SPHEROID.rf,10)),s.DATUM&&s.DATUM.TOWGS84&&(e.datum_params=s.DATUM.TOWGS84),~e.datumCode.indexOf("osgb_1936")&&(e.datumCode="osgb36"),~e.datumCode.indexOf("osni_1952")&&(e.datumCode="osni52"),(~e.datumCode.indexOf("tm65")||~e.datumCode.indexOf("geodetic_datum_of_1965"))&&(e.datumCode="ire65"),e.datumCode==="ch1903+"&&(e.datumCode="ch1903"),~e.datumCode.indexOf("israel")&&(e.datumCode="isr93")),e.b&&!isFinite(e.b)&&(e.b=e.a);function o(u){var h=e.to_meter||1;return u*h}var a=function(u){return Tj(e,u)},c=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Yo],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Yo],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",Yo],["lat0","latitude_of_origin",Yo],["lat0","standard_parallel_1",Yo],["lat1","standard_parallel_1",Yo],["lat2","standard_parallel_2",Yo],["azimuth","Azimuth"],["alpha","azimuth",Yo],["srsCode","name"]];c.forEach(a),!e.long0&&e.longc&&(e.projName==="Albers_Conic_Equal_Area"||e.projName==="Lambert_Azimuthal_Equal_Area")&&(e.long0=e.longc),!e.lat_ts&&e.lat1&&(e.projName==="Stereographic_South_Pole"||e.projName==="Polar Stereographic (variant B)")?(e.lat0=Yo(e.lat1>0?90:-90),e.lat_ts=e.lat1):!e.lat_ts&&e.lat0&&e.projName==="Polar_Stereographic"&&(e.lat_ts=e.lat0,e.lat0=Yo(e.lat0>0?90:-90))}function $D(e){var t=yj(e),n=t.shift(),i=t.shift();t.unshift(["name",i]),t.unshift(["type",n]);var r={};return Cf(t,r),xj(r),r}function Mr(e){var t=this;if(arguments.length===2){var n=arguments[1];typeof n=="string"?n.charAt(0)==="+"?Mr[e]=Rx(arguments[1]):Mr[e]=$D(arguments[1]):Mr[e]=n}else if(arguments.length===1){if(Array.isArray(e))return e.map(function(i){Array.isArray(i)?Mr.apply(t,i):Mr(i)});if(typeof e=="string"){if(e in Mr)return Mr[e]}else"EPSG"in e?Mr["EPSG:"+e.EPSG]=e:"ESRI"in e?Mr["ESRI:"+e.ESRI]=e:"IAU2000"in e?Mr["IAU2000:"+e.IAU2000]=e:console.log(e);return}}cj(Mr);function Ej(e){return typeof e=="string"}function Cj(e){return e in Mr}var wj=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function Aj(e){return wj.some(function(t){return e.indexOf(t)>-1})}var Sj=["3857","900913","3785","102113"];function vj(e){var t=yl(e,"authority");if(t){var n=yl(t,"epsg");return n&&Sj.indexOf(n)>-1}}function Ij(e){var t=yl(e,"extension");if(t)return yl(t,"proj4")}function Oj(e){return e[0]==="+"}function Rj(e){if(Ej(e)){if(Cj(e))return Mr[e];if(Aj(e)){var t=$D(e);if(vj(t))return Mr["EPSG:3857"];var n=Ij(t);return n?Rx(n):t}if(Oj(e))return Rx(e)}else return e}function kS(e,t){e=e||{};var n,i;if(!t)return e;for(i in t)n=t[i],n!==void 0&&(e[i]=n);return e}function _a(e,t,n){var i=e*t;return n/Math.sqrt(1-i*i)}function Gp(e){return e<0?-1:1}function Ne(e){return Math.abs(e)<=hi?e:e-Gp(e)*yp}function vo(e,t,n){var i=e*n,r=.5*e;return i=Math.pow((1-i)/(1+i),r),Math.tan(.5*(ge-t))/i}function Tp(e,t){for(var n=.5*e,i,r,s=ge-2*Math.atan(t),o=0;o<=15;o++)if(i=e*Math.sin(s),r=ge-2*Math.atan(t*Math.pow((1-i)/(1+i),n))-s,s+=r,Math.abs(r)<=1e-10)return s;return-9999}function Dj(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=_a(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function Mj(e){var t=e.x,n=e.y;if(n*ra>90&&n*ra<-90&&t*ra>180&&t*ra<-180)return null;var i,r;if(Math.abs(Math.abs(n)-ge)<=ve)return null;if(this.sphere)i=this.x0+this.a*this.k0*Ne(t-this.long0),r=this.y0+this.a*this.k0*Math.log(Math.tan(rn+.5*n));else{var s=Math.sin(n),o=vo(this.e,n,s);i=this.x0+this.a*this.k0*Ne(t-this.long0),r=this.y0-this.a*this.k0*Math.log(o)}return e.x=i,e.y=r,e}function Lj(e){var t=e.x-this.x0,n=e.y-this.y0,i,r;if(this.sphere)r=ge-2*Math.atan(Math.exp(-n/(this.a*this.k0)));else{var s=Math.exp(-n/(this.a*this.k0));if(r=Tp(this.e,s),r===-9999)return null}return i=Ne(this.long0+t/(this.a*this.k0)),e.x=i,e.y=r,e}var Pj=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const Nj={init:Dj,forward:Mj,inverse:Lj,names:Pj};function Fj(){}function jS(e){return e}var Bj=["longlat","identity"];const zj={init:Fj,forward:jS,inverse:jS,names:Bj};var Uj=[Nj,zj],Xg={},R_=[];function XD(e,t){var n=R_.length;return e.names?(R_[n]=e,e.names.forEach(function(i){Xg[i.toLowerCase()]=n}),this):(console.log(t),!0)}function kj(e){if(!e)return!1;var t=e.toLowerCase();if(typeof Xg[t]<"u"&&R_[Xg[t]])return R_[Xg[t]]}function jj(){Uj.forEach(XD)}const Vj={start:jj,add:XD,get:kj};var ht={};ht.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};ht.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};ht.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};ht.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};ht.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};ht.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};ht.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};ht.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};ht.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};ht.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};ht.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};ht.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};ht.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};ht.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};ht.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};ht.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};ht.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};ht.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};ht.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};ht.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};ht.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};ht.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};ht.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};ht.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};ht.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};ht.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};ht.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};ht.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};ht.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};ht.hough={a:6378270,rf:297,ellipseName:"Hough"};ht.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};ht.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};ht.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};ht.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};ht.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};ht.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};ht.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};ht.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};ht.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};ht.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};ht.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};ht.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var Gj=ht.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};ht.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function Hj(e,t,n,i){var r=e*e,s=t*t,o=(r-s)/r,a=0;i?(e*=1-o*(fj+o*(hj+o*dj)),r=e*e,o=0):a=Math.sqrt(o);var c=(r-s)/s;return{es:o,e:a,ep2:c}}function qj(e,t,n,i,r){if(!e){var s=yl(ht,i);s||(s=Gj),e=s.a,t=s.b,n=s.rf}return n&&!t&&(t=(1-1/n)*e),(n===0||Math.abs(e-t)<ve)&&(r=!0,t=e),{a:e,b:t,rf:n,sphere:r}}var Fi={};Fi.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};Fi.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};Fi.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};Fi.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};Fi.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};Fi.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};Fi.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};Fi.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};Fi.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"};Fi.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};Fi.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};Fi.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};Fi.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};Fi.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};Fi.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};Fi.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};Fi.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};Fi.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function Wj(e,t,n,i,r,s,o){var a={};return e===void 0||e==="none"?a.datum_type=Ox:a.datum_type=lj,t&&(a.datum_params=t.map(parseFloat),(a.datum_params[0]!==0||a.datum_params[1]!==0||a.datum_params[2]!==0)&&(a.datum_type=Au),a.datum_params.length>3&&(a.datum_params[3]!==0||a.datum_params[4]!==0||a.datum_params[5]!==0||a.datum_params[6]!==0)&&(a.datum_type=Su,a.datum_params[3]*=Hd,a.datum_params[4]*=Hd,a.datum_params[5]*=Hd,a.datum_params[6]=a.datum_params[6]/1e6+1)),o&&(a.datum_type=Uf,a.grids=o),a.a=n,a.b=i,a.es=r,a.ep2=s,a}var YD={};function $j(e,t){var n=new DataView(t),i=Kj(n),r=Zj(n,i),s=Jj(n,r,i),o={header:r,subgrids:s};return YD[e]=o,o}function Xj(e){if(e===void 0)return null;var t=e.split(",");return t.map(Yj)}function Yj(e){if(e.length===0)return null;var t=e[0]==="@";return t&&(e=e.slice(1)),e==="null"?{name:"null",mandatory:!t,grid:null,isNull:!0}:{name:e,mandatory:!t,grid:YD[e]||null,isNull:!1}}function wf(e){return e/3600*Math.PI/180}function Kj(e){var t=e.getInt32(8,!1);return t===11?!1:(t=e.getInt32(8,!0),t!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function Zj(e,t){return{nFields:e.getInt32(8,t),nSubgridFields:e.getInt32(24,t),nSubgrids:e.getInt32(40,t),shiftType:Dx(e,56,64).trim(),fromSemiMajorAxis:e.getFloat64(120,t),fromSemiMinorAxis:e.getFloat64(136,t),toSemiMajorAxis:e.getFloat64(152,t),toSemiMinorAxis:e.getFloat64(168,t)}}function Dx(e,t,n){return String.fromCharCode.apply(null,new Uint8Array(e.buffer.slice(t,n)))}function Jj(e,t,n){for(var i=176,r=[],s=0;s<t.nSubgrids;s++){var o=eV(e,i,n),a=tV(e,i,o,n),c=Math.round(1+(o.upperLongitude-o.lowerLongitude)/o.longitudeInterval),u=Math.round(1+(o.upperLatitude-o.lowerLatitude)/o.latitudeInterval);r.push({ll:[wf(o.lowerLongitude),wf(o.lowerLatitude)],del:[wf(o.longitudeInterval),wf(o.latitudeInterval)],lim:[c,u],count:o.gridNodeCount,cvs:Qj(a)}),i+=176+o.gridNodeCount*16}return r}function Qj(e){return e.map(function(t){return[wf(t.longitudeShift),wf(t.latitudeShift)]})}function eV(e,t,n){return{name:Dx(e,t+8,t+16).trim(),parent:Dx(e,t+24,t+24+8).trim(),lowerLatitude:e.getFloat64(t+72,n),upperLatitude:e.getFloat64(t+88,n),lowerLongitude:e.getFloat64(t+104,n),upperLongitude:e.getFloat64(t+120,n),latitudeInterval:e.getFloat64(t+136,n),longitudeInterval:e.getFloat64(t+152,n),gridNodeCount:e.getInt32(t+168,n)}}function tV(e,t,n,i){for(var r=t+176,s=16,o=[],a=0;a<n.gridNodeCount;a++){var c={latitudeShift:e.getFloat32(r+a*s,i),longitudeShift:e.getFloat32(r+a*s+4,i),latitudeAccuracy:e.getFloat32(r+a*s+8,i),longitudeAccuracy:e.getFloat32(r+a*s+12,i)};o.push(c)}return o}function la(e,t){if(!(this instanceof la))return new la(e);t=t||function(u){if(u)throw u};var n=Rj(e);if(typeof n!="object"){t(e);return}var i=la.projections.get(n.projName);if(!i){t(e);return}if(n.datumCode&&n.datumCode!=="none"){var r=yl(Fi,n.datumCode);r&&(n.datum_params=n.datum_params||(r.towgs84?r.towgs84.split(","):null),n.ellps=r.ellipse,n.datumName=r.datumName?r.datumName:n.datumCode)}n.k0=n.k0||1,n.axis=n.axis||"enu",n.ellps=n.ellps||"wgs84",n.lat1=n.lat1||n.lat0;var s=qj(n.a,n.b,n.rf,n.ellps,n.sphere),o=Hj(s.a,s.b,s.rf,n.R_A),a=Xj(n.nadgrids),c=n.datum||Wj(n.datumCode,n.datum_params,s.a,s.b,o.es,o.ep2,a);kS(this,n),kS(this,i),this.a=s.a,this.b=s.b,this.rf=s.rf,this.sphere=s.sphere,this.es=o.es,this.e=o.e,this.ep2=o.ep2,this.datum=c,this.init(),t(null,this)}la.projections=Vj;la.projections.start();function nV(e,t){return e.datum_type!==t.datum_type||e.a!==t.a||Math.abs(e.es-t.es)>5e-11?!1:e.datum_type===Au?e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]:e.datum_type===Su?e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]&&e.datum_params[3]===t.datum_params[3]&&e.datum_params[4]===t.datum_params[4]&&e.datum_params[5]===t.datum_params[5]&&e.datum_params[6]===t.datum_params[6]:!0}function KD(e,t,n){var i=e.x,r=e.y,s=e.z?e.z:0,o,a,c,u;if(r<-ge&&r>-1.001*ge)r=-ge;else if(r>ge&&r<1.001*ge)r=ge;else{if(r<-ge)return{x:-1/0,y:-1/0,z:e.z};if(r>ge)return{x:1/0,y:1/0,z:e.z}}return i>Math.PI&&(i-=2*Math.PI),a=Math.sin(r),u=Math.cos(r),c=a*a,o=n/Math.sqrt(1-t*c),{x:(o+s)*u*Math.cos(i),y:(o+s)*u*Math.sin(i),z:(o*(1-t)+s)*a}}function ZD(e,t,n,i){var r=1e-12,s=r*r,o=30,a,c,u,h,d,p,g,_,b,x,E,C,w,S=e.x,v=e.y,D=e.z?e.z:0,L,O,N;if(a=Math.sqrt(S*S+v*v),c=Math.sqrt(S*S+v*v+D*D),a/n<r){if(L=0,c/n<r)return O=ge,N=-i,{x:e.x,y:e.y,z:e.z}}else L=Math.atan2(v,S);u=D/c,h=a/c,d=1/Math.sqrt(1-t*(2-t)*h*h),_=h*(1-t)*d,b=u*d,w=0;do w++,g=n/Math.sqrt(1-t*b*b),N=a*_+D*b-g*(1-t*b*b),p=t*g/(g+N),d=1/Math.sqrt(1-p*(2-p)*h*h),x=h*(1-p)*d,E=u*d,C=E*_-x*b,_=x,b=E;while(C*C>s&&w<o);return O=Math.atan(E/Math.abs(x)),{x:L,y:O,z:N}}function iV(e,t,n){if(t===Au)return{x:e.x+n[0],y:e.y+n[1],z:e.z+n[2]};if(t===Su){var i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],c=n[5],u=n[6];return{x:u*(e.x-c*e.y+a*e.z)+i,y:u*(c*e.x+e.y-o*e.z)+r,z:u*(-a*e.x+o*e.y+e.z)+s}}}function rV(e,t,n){if(t===Au)return{x:e.x-n[0],y:e.y-n[1],z:e.z-n[2]};if(t===Su){var i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],c=n[5],u=n[6],h=(e.x-i)/u,d=(e.y-r)/u,p=(e.z-s)/u;return{x:h+c*d-a*p,y:-c*h+d+o*p,z:a*h-o*d+p}}}function Im(e){return e===Au||e===Su}function sV(e,t,n){if(nV(e,t)||e.datum_type===Ox||t.datum_type===Ox)return n;var i=e.a,r=e.es;if(e.datum_type===Uf){var s=VS(e,!1,n);if(s!==0)return;i=FS,r=BS}var o=t.a,a=t.b,c=t.es;if(t.datum_type===Uf&&(o=FS,a=uj,c=BS),r===c&&i===o&&!Im(e.datum_type)&&!Im(t.datum_type))return n;if(n=KD(n,r,i),Im(e.datum_type)&&(n=iV(n,e.datum_type,e.datum_params)),Im(t.datum_type)&&(n=rV(n,t.datum_type,t.datum_params)),n=ZD(n,c,o,a),t.datum_type===Uf){var u=VS(t,!0,n);if(u!==0)return}return n}function VS(e,t,n){if(e.grids===null||e.grids.length===0)return console.log("Grid shift grids not found"),-1;var i={x:-n.x,y:n.y},r={x:Number.NaN,y:Number.NaN},s=[];e:for(var o=0;o<e.grids.length;o++){var a=e.grids[o];if(s.push(a.name),a.isNull){r=i;break}if(a.mandatory,a.grid===null){if(a.mandatory)return console.log("Unable to find mandatory grid '"+a.name+"'"),-1;continue}for(var c=a.grid.subgrids,u=0,h=c.length;u<h;u++){var d=c[u],p=(Math.abs(d.del[1])+Math.abs(d.del[0]))/1e4,g=d.ll[0]-p,_=d.ll[1]-p,b=d.ll[0]+(d.lim[0]-1)*d.del[0]+p,x=d.ll[1]+(d.lim[1]-1)*d.del[1]+p;if(!(_>i.y||g>i.x||x<i.y||b<i.x)&&(r=oV(i,t,d),!isNaN(r.x)))break e}}return isNaN(r.x)?(console.log("Failed to find a grid shift table for location '"+-i.x*ra+" "+i.y*ra+" tried: '"+s+"'"),-1):(n.x=-r.x,n.y=r.y,0)}function oV(e,t,n){var i={x:Number.NaN,y:Number.NaN};if(isNaN(e.x))return i;var r={x:e.x,y:e.y};r.x-=n.ll[0],r.y-=n.ll[1],r.x=Ne(r.x-Math.PI)+Math.PI;var s=GS(r,n);if(t){if(isNaN(s.x))return i;s.x=r.x-s.x,s.y=r.y-s.y;var o=9,a=1e-12,c,u;do{if(u=GS(s,n),isNaN(u.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}c={x:r.x-(u.x+s.x),y:r.y-(u.y+s.y)},s.x+=c.x,s.y+=c.y}while(o--&&Math.abs(c.x)>a&&Math.abs(c.y)>a);if(o<0)return console.log("Inverse grid shift iterator failed to converge."),i;i.x=Ne(s.x+n.ll[0]),i.y=s.y+n.ll[1]}else isNaN(s.x)||(i.x=e.x+s.x,i.y=e.y+s.y);return i}function GS(e,t){var n={x:e.x/t.del[0],y:e.y/t.del[1]},i={x:Math.floor(n.x),y:Math.floor(n.y)},r={x:n.x-1*i.x,y:n.y-1*i.y},s={x:Number.NaN,y:Number.NaN},o;if(i.x<0||i.x>=t.lim[0]||i.y<0||i.y>=t.lim[1])return s;o=i.y*t.lim[0]+i.x;var a={x:t.cvs[o][0],y:t.cvs[o][1]};o++;var c={x:t.cvs[o][0],y:t.cvs[o][1]};o+=t.lim[0];var u={x:t.cvs[o][0],y:t.cvs[o][1]};o--;var h={x:t.cvs[o][0],y:t.cvs[o][1]},d=r.x*r.y,p=r.x*(1-r.y),g=(1-r.x)*(1-r.y),_=(1-r.x)*r.y;return s.x=g*a.x+p*c.x+_*h.x+d*u.x,s.y=g*a.y+p*c.y+_*h.y+d*u.y,s}function HS(e,t,n){var i=n.x,r=n.y,s=n.z||0,o,a,c,u={};for(c=0;c<3;c++)if(!(t&&c===2&&n.z===void 0))switch(c===0?(o=i,"ew".indexOf(e.axis[c])!==-1?a="x":a="y"):c===1?(o=r,"ns".indexOf(e.axis[c])!==-1?a="y":a="x"):(o=s,a="z"),e.axis[c]){case"e":u[a]=o;break;case"w":u[a]=-o;break;case"n":u[a]=o;break;case"s":u[a]=-o;break;case"u":n[a]!==void 0&&(u.z=o);break;case"d":n[a]!==void 0&&(u.z=-o);break;default:return null}return u}function JD(e){var t={x:e[0],y:e[1]};return e.length>2&&(t.z=e[2]),e.length>3&&(t.m=e[3]),t}function aV(e){qS(e.x),qS(e.y)}function qS(e){if(typeof Number.isFinite=="function"){if(Number.isFinite(e))return;throw new TypeError("coordinates must be finite numbers")}if(typeof e!="number"||e!==e||!isFinite(e))throw new TypeError("coordinates must be finite numbers")}function cV(e,t){return(e.datum.datum_type===Au||e.datum.datum_type===Su||e.datum.datum_type===Uf)&&t.datumCode!=="WGS84"||(t.datum.datum_type===Au||t.datum.datum_type===Su||t.datum.datum_type===Uf)&&e.datumCode!=="WGS84"}function D_(e,t,n,i){var r;Array.isArray(n)?n=JD(n):n={x:n.x,y:n.y,z:n.z,m:n.m};var s=n.z!==void 0;if(aV(n),e.datum&&t.datum&&cV(e,t)&&(r=new la("WGS84"),n=D_(e,r,n,i),e=r),i&&e.axis!=="enu"&&(n=HS(e,!1,n)),e.projName==="longlat")n={x:n.x*er,y:n.y*er,z:n.z||0};else if(e.to_meter&&(n={x:n.x*e.to_meter,y:n.y*e.to_meter,z:n.z||0}),n=e.inverse(n),!n)return;if(e.from_greenwich&&(n.x+=e.from_greenwich),n=sV(e.datum,t.datum,n),!!n)return t.from_greenwich&&(n={x:n.x-t.from_greenwich,y:n.y,z:n.z||0}),t.projName==="longlat"?n={x:n.x*ra,y:n.y*ra,z:n.z||0}:(n=t.forward(n),t.to_meter&&(n={x:n.x/t.to_meter,y:n.y/t.to_meter,z:n.z||0})),i&&t.axis!=="enu"?HS(t,!0,n):(n&&!s&&delete n.z,n)}var WS=la("WGS84");function Wb(e,t,n,i){var r,s,o;return Array.isArray(n)?(r=D_(e,t,n,i)||{x:NaN,y:NaN},n.length>2?typeof e.name<"u"&&e.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"?typeof r.z=="number"?[r.x,r.y,r.z].concat(n.splice(3)):[r.x,r.y,n[2]].concat(n.splice(3)):[r.x,r.y].concat(n.splice(2)):[r.x,r.y]):(s=D_(e,t,n,i),o=Object.keys(n),o.length===2||o.forEach(function(a){if(typeof e.name<"u"&&e.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"){if(a==="x"||a==="y"||a==="z")return}else if(a==="x"||a==="y")return;s[a]=n[a]}),s)}function $S(e){return e instanceof la?e:e.oProj?e.oProj:la(e)}function zr(e,t,n){e=$S(e);var i=!1,r;return typeof t>"u"?(t=e,e=WS,i=!0):(typeof t.x<"u"||Array.isArray(t))&&(n=t,t=e,e=WS,i=!0),t=$S(t),n?Wb(e,t,n):(r={forward:function(s,o){return Wb(e,t,s,o)},inverse:function(s,o){return Wb(t,e,s,o)}},i&&(r.oProj=t),r)}var XS=6,QD="AJSAJS",eM="AFAFAF",Af=65,Zr=73,zs=79,Dd=86,Md=90;const lV={forward:tM,inverse:uV,toPoint:nM};function tM(e,t){return t=t||5,dV(fV({lat:e[1],lon:e[0]}),t)}function uV(e){var t=yC(rM(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]}function nM(e){var t=yC(rM(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function $b(e){return e*(Math.PI/180)}function YS(e){return 180*(e/Math.PI)}function fV(e){var t=e.lat,n=e.lon,i=6378137,r=.00669438,s=.9996,o,a,c,u,h,d,p,g=$b(t),_=$b(n),b,x;x=Math.floor((n+180)/6)+1,n===180&&(x=60),t>=56&&t<64&&n>=3&&n<12&&(x=32),t>=72&&t<84&&(n>=0&&n<9?x=31:n>=9&&n<21?x=33:n>=21&&n<33?x=35:n>=33&&n<42&&(x=37)),o=(x-1)*6-180+3,b=$b(o),a=r/(1-r),c=i/Math.sqrt(1-r*Math.sin(g)*Math.sin(g)),u=Math.tan(g)*Math.tan(g),h=a*Math.cos(g)*Math.cos(g),d=Math.cos(g)*(_-b),p=i*((1-r/4-3*r*r/64-5*r*r*r/256)*g-(3*r/8+3*r*r/32+45*r*r*r/1024)*Math.sin(2*g)+(15*r*r/256+45*r*r*r/1024)*Math.sin(4*g)-35*r*r*r/3072*Math.sin(6*g));var E=s*c*(d+(1-u+h)*d*d*d/6+(5-18*u+u*u+72*h-58*a)*d*d*d*d*d/120)+5e5,C=s*(p+c*Math.tan(g)*(d*d/2+(5-u+9*h+4*h*h)*d*d*d*d/24+(61-58*u+u*u+600*h-330*a)*d*d*d*d*d*d/720));return t<0&&(C+=1e7),{northing:Math.round(C),easting:Math.round(E),zoneNumber:x,zoneLetter:hV(t)}}function yC(e){var t=e.northing,n=e.easting,i=e.zoneLetter,r=e.zoneNumber;if(r<0||r>60)return null;var s=.9996,o=6378137,a=.00669438,c,u=(1-Math.sqrt(1-a))/(1+Math.sqrt(1-a)),h,d,p,g,_,b,x,E,C,w=n-5e5,S=t;i<"N"&&(S-=1e7),x=(r-1)*6-180+3,c=a/(1-a),b=S/s,E=b/(o*(1-a/4-3*a*a/64-5*a*a*a/256)),C=E+(3*u/2-27*u*u*u/32)*Math.sin(2*E)+(21*u*u/16-55*u*u*u*u/32)*Math.sin(4*E)+151*u*u*u/96*Math.sin(6*E),h=o/Math.sqrt(1-a*Math.sin(C)*Math.sin(C)),d=Math.tan(C)*Math.tan(C),p=c*Math.cos(C)*Math.cos(C),g=o*(1-a)/Math.pow(1-a*Math.sin(C)*Math.sin(C),1.5),_=w/(h*s);var v=C-h*Math.tan(C)/g*(_*_/2-(5+3*d+10*p-4*p*p-9*c)*_*_*_*_/24+(61+90*d+298*p+45*d*d-252*c-3*p*p)*_*_*_*_*_*_/720);v=YS(v);var D=(_-(1+2*d+p)*_*_*_/6+(5-2*p+28*d-3*p*p+8*c+24*d*d)*_*_*_*_*_/120)/Math.cos(C);D=x+YS(D);var L;if(e.accuracy){var O=yC({northing:e.northing+e.accuracy,easting:e.easting+e.accuracy,zoneLetter:e.zoneLetter,zoneNumber:e.zoneNumber});L={top:O.lat,right:O.lon,bottom:v,left:D}}else L={lat:v,lon:D};return L}function hV(e){var t="Z";return 84>=e&&e>=72?t="X":72>e&&e>=64?t="W":64>e&&e>=56?t="V":56>e&&e>=48?t="U":48>e&&e>=40?t="T":40>e&&e>=32?t="S":32>e&&e>=24?t="R":24>e&&e>=16?t="Q":16>e&&e>=8?t="P":8>e&&e>=0?t="N":0>e&&e>=-8?t="M":-8>e&&e>=-16?t="L":-16>e&&e>=-24?t="K":-24>e&&e>=-32?t="J":-32>e&&e>=-40?t="H":-40>e&&e>=-48?t="G":-48>e&&e>=-56?t="F":-56>e&&e>=-64?t="E":-64>e&&e>=-72?t="D":-72>e&&e>=-80&&(t="C"),t}function dV(e,t){var n="00000"+e.easting,i="00000"+e.northing;return e.zoneNumber+e.zoneLetter+pV(e.easting,e.northing,e.zoneNumber)+n.substr(n.length-5,t)+i.substr(i.length-5,t)}function pV(e,t,n){var i=iM(n),r=Math.floor(e/1e5),s=Math.floor(t/1e5)%20;return mV(r,s,i)}function iM(e){var t=e%XS;return t===0&&(t=XS),t}function mV(e,t,n){var i=n-1,r=QD.charCodeAt(i),s=eM.charCodeAt(i),o=r+e-1,a=s+t,c=!1;o>Md&&(o=o-Md+Af-1,c=!0),(o===Zr||r<Zr&&o>Zr||(o>Zr||r<Zr)&&c)&&o++,(o===zs||r<zs&&o>zs||(o>zs||r<zs)&&c)&&(o++,o===Zr&&o++),o>Md&&(o=o-Md+Af-1),a>Dd?(a=a-Dd+Af-1,c=!0):c=!1,(a===Zr||s<Zr&&a>Zr||(a>Zr||s<Zr)&&c)&&a++,(a===zs||s<zs&&a>zs||(a>zs||s<zs)&&c)&&(a++,a===Zr&&a++),a>Dd&&(a=a-Dd+Af-1);var u=String.fromCharCode(o)+String.fromCharCode(a);return u}function rM(e){if(e&&e.length===0)throw"MGRSPoint coverting from nothing";for(var t=e.length,n=null,i="",r,s=0;!/[A-Z]/.test(r=e.charAt(s));){if(s>=2)throw"MGRSPoint bad conversion from: "+e;i+=r,s++}var o=parseInt(i,10);if(s===0||s+3>t)throw"MGRSPoint bad conversion from: "+e;var a=e.charAt(s++);if(a<="A"||a==="B"||a==="Y"||a>="Z"||a==="I"||a==="O")throw"MGRSPoint zone letter "+a+" not handled: "+e;n=e.substring(s,s+=2);for(var c=iM(o),u=gV(n.charAt(0),c),h=_V(n.charAt(1),c);h<yV(a);)h+=2e6;var d=t-s;if(d%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+e;var p=d/2,g=0,_=0,b,x,E,C,w;return p>0&&(b=1e5/Math.pow(10,p),x=e.substring(s,s+p),g=parseFloat(x)*b,E=e.substring(s+p),_=parseFloat(E)*b),C=g+u,w=_+h,{easting:C,northing:w,zoneLetter:a,zoneNumber:o,accuracy:b}}function gV(e,t){for(var n=QD.charCodeAt(t-1),i=1e5,r=!1;n!==e.charCodeAt(0);){if(n++,n===Zr&&n++,n===zs&&n++,n>Md){if(r)throw"Bad character: "+e;n=Af,r=!0}i+=1e5}return i}function _V(e,t){if(e>"V")throw"MGRSPoint given invalid Northing "+e;for(var n=eM.charCodeAt(t-1),i=0,r=!1;n!==e.charCodeAt(0);){if(n++,n===Zr&&n++,n===zs&&n++,n>Dd){if(r)throw"Bad character: "+e;n=Af,r=!0}i+=1e5}return i}function yV(e){var t;switch(e){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+e}function nh(e,t,n){if(!(this instanceof nh))return new nh(e,t,n);if(Array.isArray(e))this.x=e[0],this.y=e[1],this.z=e[2]||0;else if(typeof e=="object")this.x=e.x,this.y=e.y,this.z=e.z||0;else if(typeof e=="string"&&typeof t>"u"){var i=e.split(",");this.x=parseFloat(i[0],10),this.y=parseFloat(i[1],10),this.z=parseFloat(i[2],10)||0}else this.x=e,this.y=t,this.z=n||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}nh.fromMGRS=function(e){return new nh(nM(e))};nh.prototype.toMGRS=function(e){return tM([this.x,this.y],e)};var bV=1,TV=.25,KS=.046875,ZS=.01953125,JS=.01068115234375,xV=.75,EV=.46875,CV=.013020833333333334,wV=.007120768229166667,AV=.3645833333333333,SV=.005696614583333333,vV=.3076171875;function sM(e){var t=[];t[0]=bV-e*(TV+e*(KS+e*(ZS+e*JS))),t[1]=e*(xV-e*(KS+e*(ZS+e*JS)));var n=e*e;return t[2]=n*(EV-e*(CV+e*wV)),n*=e,t[3]=n*(AV-e*SV),t[4]=n*e*vV,t}function Fy(e,t,n,i){return n*=t,t*=t,i[0]*e-n*(i[1]+t*(i[2]+t*(i[3]+t*i[4])))}var IV=20;function oM(e,t,n){for(var i=1/(1-t),r=e,s=IV;s;--s){var o=Math.sin(r),a=1-t*o*o;if(a=(Fy(r,o,Math.cos(r),n)-e)*(a*Math.sqrt(a))*i,r-=a,Math.abs(a)<ve)return r}return r}function OV(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=sM(this.es),this.ml0=Fy(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function RV(e){var t=e.x,n=e.y,i=Ne(t-this.long0),r,s,o,a=Math.sin(n),c=Math.cos(n);if(this.es){var h=c*i,d=Math.pow(h,2),p=this.ep2*Math.pow(c,2),g=Math.pow(p,2),_=Math.abs(c)>ve?Math.tan(n):0,b=Math.pow(_,2),x=Math.pow(b,2);r=1-this.es*Math.pow(a,2),h=h/Math.sqrt(r);var E=Fy(n,a,c,this.en);s=this.a*(this.k0*h*(1+d/6*(1-b+p+d/20*(5-18*b+x+14*p-58*b*p+d/42*(61+179*x-x*b-479*b)))))+this.x0,o=this.a*(this.k0*(E-this.ml0+a*i*h/2*(1+d/12*(5-b+9*p+4*g+d/30*(61+x-58*b+270*p-330*b*p+d/56*(1385+543*x-x*b-3111*b))))))+this.y0}else{var u=c*Math.sin(i);if(Math.abs(Math.abs(u)-1)<ve)return 93;if(s=.5*this.a*this.k0*Math.log((1+u)/(1-u))+this.x0,o=c*Math.cos(i)/Math.sqrt(1-Math.pow(u,2)),u=Math.abs(o),u>=1){if(u-1>ve)return 93;o=0}else o=Math.acos(o);n<0&&(o=-o),o=this.a*this.k0*(o-this.lat0)+this.y0}return e.x=s,e.y=o,e}function DV(e){var t,n,i,r,s=(e.x-this.x0)*(1/this.a),o=(e.y-this.y0)*(1/this.a);if(this.es)if(t=this.ml0+o/this.k0,n=oM(t,this.es,this.en),Math.abs(n)<ge){var d=Math.sin(n),p=Math.cos(n),g=Math.abs(p)>ve?Math.tan(n):0,_=this.ep2*Math.pow(p,2),b=Math.pow(_,2),x=Math.pow(g,2),E=Math.pow(x,2);t=1-this.es*Math.pow(d,2);var C=s*Math.sqrt(t)/this.k0,w=Math.pow(C,2);t=t*g,i=n-t*w/(1-this.es)*.5*(1-w/12*(5+3*x-9*_*x+_-4*b-w/30*(61+90*x-252*_*x+45*E+46*_-w/56*(1385+3633*x+4095*E+1574*E*x)))),r=Ne(this.long0+C*(1-w/6*(1+2*x+_-w/20*(5+28*x+24*E+8*_*x+6*_-w/42*(61+662*x+1320*E+720*E*x))))/p)}else i=ge*Gp(o),r=0;else{var a=Math.exp(s/this.k0),c=.5*(a-1/a),u=this.lat0+o/this.k0,h=Math.cos(u);t=Math.sqrt((1-Math.pow(h,2))/(1+Math.pow(c,2))),i=Math.asin(t),o<0&&(i=-i),c===0&&h===0?r=0:r=Ne(Math.atan2(c,h)+this.long0)}return e.x=r,e.y=i,e}var MV=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const Yg={init:OV,forward:RV,inverse:DV,names:MV};function aM(e){var t=Math.exp(e);return t=(t-1/t)/2,t}function Xs(e,t){e=Math.abs(e),t=Math.abs(t);var n=Math.max(e,t),i=Math.min(e,t)/(n||1);return n*Math.sqrt(1+Math.pow(i,2))}function LV(e){var t=1+e,n=t-1;return n===0?e:e*Math.log(t)/n}function PV(e){var t=Math.abs(e);return t=LV(t*(1+t/(Xs(1,t)+1))),e<0?-t:t}function bC(e,t){for(var n=2*Math.cos(2*t),i=e.length-1,r=e[i],s=0,o;--i>=0;)o=-s+n*r+e[i],s=r,r=o;return t+o*Math.sin(2*t)}function NV(e,t){for(var n=2*Math.cos(t),i=e.length-1,r=e[i],s=0,o;--i>=0;)o=-s+n*r+e[i],s=r,r=o;return Math.sin(t)*o}function FV(e){var t=Math.exp(e);return t=(t+1/t)/2,t}function cM(e,t,n){for(var i=Math.sin(t),r=Math.cos(t),s=aM(n),o=FV(n),a=2*r*o,c=-2*i*s,u=e.length-1,h=e[u],d=0,p=0,g=0,_,b;--u>=0;)_=p,b=d,p=h,d=g,h=-_+a*p-c*d+e[u],g=-b+c*p+a*d;return a=i*o,c=r*s,[a*h-c*g,a*g+c*h]}function BV(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Yg.init.apply(this),this.forward=Yg.forward,this.inverse=Yg.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var e=this.es/(1+Math.sqrt(1-this.es)),t=e/(2-e),n=t;this.cgb[0]=t*(2+t*(-2/3+t*(-2+t*(116/45+t*(26/45+t*(-2854/675)))))),this.cbg[0]=t*(-2+t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))),n=n*t,this.cgb[1]=n*(7/3+t*(-8/5+t*(-227/45+t*(2704/315+t*(2323/945))))),this.cbg[1]=n*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),n=n*t,this.cgb[2]=n*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=n*(-26/15+t*(34/21+t*(8/5+t*(-12686/2835)))),n=n*t,this.cgb[3]=n*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=n*(1237/630+t*(-12/5+t*(-24832/14175))),n=n*t,this.cgb[4]=n*(4174/315+t*(-144838/6237)),this.cbg[4]=n*(-734/315+t*(109598/31185)),n=n*t,this.cgb[5]=n*(601676/22275),this.cbg[5]=n*(444337/155925),n=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+n*(1/4+n*(1/64+n/256))),this.utg[0]=t*(-.5+t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=n*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=n*(13/48+t*(-3/5+t*(557/1440+t*(281/630+t*(-1983433/1935360))))),n=n*t,this.utg[2]=n*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=n*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),n=n*t,this.utg[3]=n*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=n*(49561/161280+t*(-179/168+t*(6601661/7257600))),n=n*t,this.utg[4]=n*(-4583/161280+t*(108847/3991680)),this.gtu[4]=n*(34729/80640+t*(-3418889/1995840)),n=n*t,this.utg[5]=n*(-20648693/638668800),this.gtu[5]=n*(212378941/319334400);var i=bC(this.cbg,this.lat0);this.Zb=-this.Qn*(i+NV(this.gtu,2*i))}function zV(e){var t=Ne(e.x-this.long0),n=e.y;n=bC(this.cbg,n);var i=Math.sin(n),r=Math.cos(n),s=Math.sin(t),o=Math.cos(t);n=Math.atan2(i,o*r),t=Math.atan2(s*r,Xs(i,r*o)),t=PV(Math.tan(t));var a=cM(this.gtu,2*n,2*t);n=n+a[0],t=t+a[1];var c,u;return Math.abs(t)<=2.623395162778?(c=this.a*(this.Qn*t)+this.x0,u=this.a*(this.Qn*n+this.Zb)+this.y0):(c=1/0,u=1/0),e.x=c,e.y=u,e}function UV(e){var t=(e.x-this.x0)*(1/this.a),n=(e.y-this.y0)*(1/this.a);n=(n-this.Zb)/this.Qn,t=t/this.Qn;var i,r;if(Math.abs(t)<=2.623395162778){var s=cM(this.utg,2*n,2*t);n=n+s[0],t=t+s[1],t=Math.atan(aM(t));var o=Math.sin(n),a=Math.cos(n),c=Math.sin(t),u=Math.cos(t);n=Math.atan2(o*u,Xs(c,u*a)),t=Math.atan2(c,u*a),i=Ne(t+this.long0),r=bC(this.cgb,n)}else i=1/0,r=1/0;return e.x=i,e.y=r,e}var kV=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const Kg={init:BV,forward:zV,inverse:UV,names:kV};function jV(e,t){if(e===void 0){if(e=Math.floor((Ne(t)+Math.PI)*30/Math.PI)+1,e<0)return 0;if(e>60)return 60}return e}var VV="etmerc";function GV(){var e=jV(this.zone,this.long0);if(e===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(e)-183)*er,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Kg.init.apply(this),this.forward=Kg.forward,this.inverse=Kg.inverse}var HV=["Universal Transverse Mercator System","utm"];const qV={init:GV,names:HV,dependsOn:VV};function TC(e,t){return Math.pow((1-e)/(1+e),t)}var WV=20;function $V(){var e=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(e/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+rn)/(Math.pow(Math.tan(.5*this.lat0+rn),this.C)*TC(this.e*e,this.ratexp))}function XV(e){var t=e.x,n=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*n+rn),this.C)*TC(this.e*Math.sin(n),this.ratexp))-ge,e.x=this.C*t,e}function YV(e){for(var t=1e-14,n=e.x/this.C,i=e.y,r=Math.pow(Math.tan(.5*i+rn)/this.K,1/this.C),s=WV;s>0&&(i=2*Math.atan(r*TC(this.e*Math.sin(e.y),-.5*this.e))-ge,!(Math.abs(i-e.y)<t));--s)e.y=i;return s?(e.x=n,e.y=i,e):null}var KV=["gauss"];const xC={init:$V,forward:XV,inverse:YV,names:KV};function ZV(){xC.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function JV(e){var t,n,i,r;return e.x=Ne(e.x-this.long0),xC.forward.apply(this,[e]),t=Math.sin(e.y),n=Math.cos(e.y),i=Math.cos(e.x),r=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*n*i),e.x=r*n*Math.sin(e.x),e.y=r*(this.cosc0*t-this.sinc0*n*i),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function QV(e){var t,n,i,r,s;if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,s=Xs(e.x,e.y)){var o=2*Math.atan2(s,this.R2);t=Math.sin(o),n=Math.cos(o),r=Math.asin(n*this.sinc0+e.y*t*this.cosc0/s),i=Math.atan2(e.x*t,s*this.cosc0*n-e.y*this.sinc0*t)}else r=this.phic0,i=0;return e.x=i,e.y=r,xC.inverse.apply(this,[e]),e.x=Ne(e.x+this.long0),e}var eG=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const tG={init:ZV,forward:JV,inverse:QV,names:eG};function nG(e,t,n){return t*=n,Math.tan(.5*(ge+e))*Math.pow((1-t)/(1+t),.5*n)}function iG(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=ve&&(this.k0=.5*(1+Gp(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=ve&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=ve&&Math.abs(Math.cos(this.lat_ts))>ve&&(this.k0=.5*this.cons*_a(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/vo(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=_a(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-ge,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function rG(e){var t=e.x,n=e.y,i=Math.sin(n),r=Math.cos(n),s,o,a,c,u,h,d=Ne(t-this.long0);return Math.abs(Math.abs(t-this.long0)-Math.PI)<=ve&&Math.abs(n+this.lat0)<=ve?(e.x=NaN,e.y=NaN,e):this.sphere?(s=2*this.k0/(1+this.sinlat0*i+this.coslat0*r*Math.cos(d)),e.x=this.a*s*r*Math.sin(d)+this.x0,e.y=this.a*s*(this.coslat0*i-this.sinlat0*r*Math.cos(d))+this.y0,e):(o=2*Math.atan(this.ssfn_(n,i,this.e))-ge,c=Math.cos(o),a=Math.sin(o),Math.abs(this.coslat0)<=ve?(u=vo(this.e,n*this.con,this.con*i),h=2*this.a*this.k0*u/this.cons,e.x=this.x0+h*Math.sin(t-this.long0),e.y=this.y0-this.con*h*Math.cos(t-this.long0),e):(Math.abs(this.sinlat0)<ve?(s=2*this.a*this.k0/(1+c*Math.cos(d)),e.y=s*a):(s=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*a+this.cosX0*c*Math.cos(d))),e.y=s*(this.cosX0*a-this.sinX0*c*Math.cos(d))+this.y0),e.x=s*c*Math.sin(d)+this.x0,e))}function sG(e){e.x-=this.x0,e.y-=this.y0;var t,n,i,r,s,o=Math.sqrt(e.x*e.x+e.y*e.y);if(this.sphere){var a=2*Math.atan(o/(2*this.a*this.k0));return t=this.long0,n=this.lat0,o<=ve?(e.x=t,e.y=n,e):(n=Math.asin(Math.cos(a)*this.sinlat0+e.y*Math.sin(a)*this.coslat0/o),Math.abs(this.coslat0)<ve?this.lat0>0?t=Ne(this.long0+Math.atan2(e.x,-1*e.y)):t=Ne(this.long0+Math.atan2(e.x,e.y)):t=Ne(this.long0+Math.atan2(e.x*Math.sin(a),o*this.coslat0*Math.cos(a)-e.y*this.sinlat0*Math.sin(a))),e.x=t,e.y=n,e)}else if(Math.abs(this.coslat0)<=ve){if(o<=ve)return n=this.lat0,t=this.long0,e.x=t,e.y=n,e;e.x*=this.con,e.y*=this.con,i=o*this.cons/(2*this.a*this.k0),n=this.con*Tp(this.e,i),t=this.con*Ne(this.con*this.long0+Math.atan2(e.x,-1*e.y))}else r=2*Math.atan(o*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,o<=ve?s=this.X0:(s=Math.asin(Math.cos(r)*this.sinX0+e.y*Math.sin(r)*this.cosX0/o),t=Ne(this.long0+Math.atan2(e.x*Math.sin(r),o*this.cosX0*Math.cos(r)-e.y*this.sinX0*Math.sin(r)))),n=-1*Tp(this.e,Math.tan(.5*(ge+s)));return e.x=t,e.y=n,e}var oG=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const aG={init:iG,forward:rG,inverse:sG,names:oG,ssfn_:nG};function cG(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),n=this.a,i=this.rf,r=1/i,s=2*r-Math.pow(r,2),o=this.e=Math.sqrt(s);this.R=this.k0*n*Math.sqrt(1-s)/(1-s*Math.pow(t,2)),this.alpha=Math.sqrt(1+s/(1-s)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(t/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),c=Math.log(Math.tan(Math.PI/4+e/2)),u=Math.log((1+o*t)/(1-o*t));this.K=a-this.alpha*c+this.alpha*o/2*u}function lG(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),n=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),i=-this.alpha*(t+n)+this.K,r=2*(Math.atan(Math.exp(i))-Math.PI/4),s=this.alpha*(e.x-this.lambda0),o=Math.atan(Math.sin(s)/(Math.sin(this.b0)*Math.tan(r)+Math.cos(this.b0)*Math.cos(s))),a=Math.asin(Math.cos(this.b0)*Math.sin(r)-Math.sin(this.b0)*Math.cos(r)*Math.cos(s));return e.y=this.R/2*Math.log((1+Math.sin(a))/(1-Math.sin(a)))+this.y0,e.x=this.R*o+this.x0,e}function uG(e){for(var t=e.x-this.x0,n=e.y-this.y0,i=t/this.R,r=2*(Math.atan(Math.exp(n/this.R))-Math.PI/4),s=Math.asin(Math.cos(this.b0)*Math.sin(r)+Math.sin(this.b0)*Math.cos(r)*Math.cos(i)),o=Math.atan(Math.sin(i)/(Math.cos(this.b0)*Math.cos(i)-Math.sin(this.b0)*Math.tan(r))),a=this.lambda0+o/this.alpha,c=0,u=s,h=-1e3,d=0;Math.abs(u-h)>1e-7;){if(++d>20)return;c=1/this.alpha*(Math.log(Math.tan(Math.PI/4+s/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(u))/2)),h=u,u=2*Math.atan(Math.exp(c))-Math.PI/2}return e.x=a,e.y=u,e}var fG=["somerc"];const hG={init:cG,forward:lG,inverse:uG,names:fG};var pf=1e-7;function dG(e){var t=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],n=typeof e.PROJECTION=="object"?Object.keys(e.PROJECTION)[0]:e.PROJECTION;return"no_uoff"in e||"no_off"in e||t.indexOf(n)!==-1}function pG(){var e,t,n,i,r,s,o,a,c,u,h=0,d,p=0,g=0,_=0,b=0,x=0,E=0;this.no_off=dG(this),this.no_rot="no_rot"in this;var C=!1;"alpha"in this&&(C=!0);var w=!1;if("rectified_grid_angle"in this&&(w=!0),C&&(E=this.alpha),w&&(h=this.rectified_grid_angle*er),C||w)p=this.longc;else if(g=this.long1,b=this.lat1,_=this.long2,x=this.lat2,Math.abs(b-x)<=pf||(e=Math.abs(b))<=pf||Math.abs(e-ge)<=pf||Math.abs(Math.abs(this.lat0)-ge)<=pf||Math.abs(Math.abs(x)-ge)<=pf)throw new Error;var S=1-this.es;t=Math.sqrt(S),Math.abs(this.lat0)>ve?(a=Math.sin(this.lat0),n=Math.cos(this.lat0),e=1-this.es*a*a,this.B=n*n,this.B=Math.sqrt(1+this.es*this.B*this.B/S),this.A=this.B*this.k0*t/e,i=this.B*t/(n*Math.sqrt(e)),r=i*i-1,r<=0?r=0:(r=Math.sqrt(r),this.lat0<0&&(r=-r)),this.E=r+=i,this.E*=Math.pow(vo(this.e,this.lat0,a),this.B)):(this.B=1/t,this.A=this.k0,this.E=i=r=1),C||w?(C?(d=Math.asin(Math.sin(E)/i),w||(h=E)):(d=h,E=Math.asin(i*Math.sin(d))),this.lam0=p-Math.asin(.5*(r-1/r)*Math.tan(d))/this.B):(s=Math.pow(vo(this.e,b,Math.sin(b)),this.B),o=Math.pow(vo(this.e,x,Math.sin(x)),this.B),r=this.E/s,c=(o-s)/(o+s),u=this.E*this.E,u=(u-o*s)/(u+o*s),e=g-_,e<-Math.pi?_-=yp:e>Math.pi&&(_+=yp),this.lam0=Ne(.5*(g+_)-Math.atan(u*Math.tan(.5*this.B*(g-_))/c)/this.B),d=Math.atan(2*Math.sin(this.B*Ne(g-this.lam0))/(r-1/r)),h=E=Math.asin(i*Math.sin(d))),this.singam=Math.sin(d),this.cosgam=Math.cos(d),this.sinrot=Math.sin(h),this.cosrot=Math.cos(h),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(i*i-1)/Math.cos(E))),this.lat0<0&&(this.u_0=-this.u_0)),r=.5*d,this.v_pole_n=this.ArB*Math.log(Math.tan(rn-r)),this.v_pole_s=this.ArB*Math.log(Math.tan(rn+r))}function mG(e){var t={},n,i,r,s,o,a,c,u;if(e.x=e.x-this.lam0,Math.abs(Math.abs(e.y)-ge)>ve){if(o=this.E/Math.pow(vo(this.e,e.y,Math.sin(e.y)),this.B),a=1/o,n=.5*(o-a),i=.5*(o+a),s=Math.sin(this.B*e.x),r=(n*this.singam-s*this.cosgam)/i,Math.abs(Math.abs(r)-1)<ve)throw new Error;u=.5*this.ArB*Math.log((1-r)/(1+r)),a=Math.cos(this.B*e.x),Math.abs(a)<pf?c=this.A*e.x:c=this.ArB*Math.atan2(n*this.cosgam+s*this.singam,a)}else u=e.y>0?this.v_pole_n:this.v_pole_s,c=this.ArB*e.y;return this.no_rot?(t.x=c,t.y=u):(c-=this.u_0,t.x=u*this.cosrot+c*this.sinrot,t.y=c*this.cosrot-u*this.sinrot),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function gG(e){var t,n,i,r,s,o,a,c={};if(e.x=(e.x-this.x0)*(1/this.a),e.y=(e.y-this.y0)*(1/this.a),this.no_rot?(n=e.y,t=e.x):(n=e.x*this.cosrot-e.y*this.sinrot,t=e.y*this.cosrot+e.x*this.sinrot+this.u_0),i=Math.exp(-this.BrA*n),r=.5*(i-1/i),s=.5*(i+1/i),o=Math.sin(this.BrA*t),a=(o*this.cosgam+r*this.singam)/s,Math.abs(Math.abs(a)-1)<ve)c.x=0,c.y=a<0?-ge:ge;else{if(c.y=this.E/Math.sqrt((1+a)/(1-a)),c.y=Tp(this.e,Math.pow(c.y,1/this.B)),c.y===1/0)throw new Error;c.x=-this.rB*Math.atan2(r*this.cosgam-o*this.singam,Math.cos(this.BrA*t))}return c.x+=this.lam0,c}var _G=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const yG={init:pG,forward:mG,inverse:gG,names:_G};function bG(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<ve)){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),n=Math.cos(this.lat1),i=_a(this.e,t,n),r=vo(this.e,this.lat1,t),s=Math.sin(this.lat2),o=Math.cos(this.lat2),a=_a(this.e,s,o),c=vo(this.e,this.lat2,s),u=vo(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>ve?this.ns=Math.log(i/a)/Math.log(r/c):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=i/(this.ns*Math.pow(r,this.ns)),this.rh=this.a*this.f0*Math.pow(u,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function TG(e){var t=e.x,n=e.y;Math.abs(2*Math.abs(n)-Math.PI)<=ve&&(n=Gp(n)*(ge-2*ve));var i=Math.abs(Math.abs(n)-ge),r,s;if(i>ve)r=vo(this.e,n,Math.sin(n)),s=this.a*this.f0*Math.pow(r,this.ns);else{if(i=n*this.ns,i<=0)return null;s=0}var o=this.ns*Ne(t-this.long0);return e.x=this.k0*(s*Math.sin(o))+this.x0,e.y=this.k0*(this.rh-s*Math.cos(o))+this.y0,e}function xG(e){var t,n,i,r,s,o=(e.x-this.x0)/this.k0,a=this.rh-(e.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(o*o+a*a),n=1):(t=-Math.sqrt(o*o+a*a),n=-1);var c=0;if(t!==0&&(c=Math.atan2(n*o,n*a)),t!==0||this.ns>0){if(n=1/this.ns,i=Math.pow(t/(this.a*this.f0),n),r=Tp(this.e,i),r===-9999)return null}else r=-ge;return s=Ne(c/this.ns+this.long0),e.x=s,e.y=r,e}var EG=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const CG={init:bG,forward:TG,inverse:xG,names:EG};function wG(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function AG(e){var t,n,i,r,s,o,a,c=e.x,u=e.y,h=Ne(c-this.long0);return t=Math.pow((1+this.e*Math.sin(u))/(1-this.e*Math.sin(u)),this.alfa*this.e/2),n=2*(Math.atan(this.k*Math.pow(Math.tan(u/2+this.s45),this.alfa)/t)-this.s45),i=-h*this.alfa,r=Math.asin(Math.cos(this.ad)*Math.sin(n)+Math.sin(this.ad)*Math.cos(n)*Math.cos(i)),s=Math.asin(Math.cos(n)*Math.sin(i)/Math.cos(r)),o=this.n*s,a=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(r/2+this.s45),this.n),e.y=a*Math.cos(o)/1,e.x=a*Math.sin(o)/1,this.czech||(e.y*=-1,e.x*=-1),e}function SG(e){var t,n,i,r,s,o,a,c,u=e.x;e.x=e.y,e.y=u,this.czech||(e.y*=-1,e.x*=-1),o=Math.sqrt(e.x*e.x+e.y*e.y),s=Math.atan2(e.y,e.x),r=s/Math.sin(this.s0),i=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(i)-Math.sin(this.ad)*Math.cos(i)*Math.cos(r)),n=Math.asin(Math.cos(i)*Math.sin(r)/Math.cos(t)),e.x=this.long0-n/this.alfa,a=t,c=0;var h=0;do e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-e.y)<1e-10&&(c=1),a=e.y,h+=1;while(c===0&&h<15);return h>=15?null:e}var vG=["Krovak","krovak"];const IG={init:wG,forward:AG,inverse:SG,names:vG};function Nr(e,t,n,i,r){return e*r-t*Math.sin(2*r)+n*Math.sin(4*r)-i*Math.sin(6*r)}function Hp(e){return 1-.25*e*(1+e/16*(3+1.25*e))}function qp(e){return .375*e*(1+.25*e*(1+.46875*e))}function Wp(e){return .05859375*e*e*(1+.75*e)}function $p(e){return e*e*e*(35/3072)}function ih(e,t,n){var i=t*n;return e/Math.sqrt(1-i*i)}function Ah(e){return Math.abs(e)<ge?e:e-Gp(e)*Math.PI}function M_(e,t,n,i,r){var s,o;s=e/t;for(var a=0;a<15;a++)if(o=(e-(t*s-n*Math.sin(2*s)+i*Math.sin(4*s)-r*Math.sin(6*s)))/(t-2*n*Math.cos(2*s)+4*i*Math.cos(4*s)-6*r*Math.cos(6*s)),s+=o,Math.abs(o)<=1e-10)return s;return NaN}function OG(){this.sphere||(this.e0=Hp(this.es),this.e1=qp(this.es),this.e2=Wp(this.es),this.e3=$p(this.es),this.ml0=this.a*Nr(this.e0,this.e1,this.e2,this.e3,this.lat0))}function RG(e){var t,n,i=e.x,r=e.y;if(i=Ne(i-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(r)*Math.sin(i)),n=this.a*(Math.atan2(Math.tan(r),Math.cos(i))-this.lat0);else{var s=Math.sin(r),o=Math.cos(r),a=ih(this.a,this.e,s),c=Math.tan(r)*Math.tan(r),u=i*Math.cos(r),h=u*u,d=this.es*o*o/(1-this.es),p=this.a*Nr(this.e0,this.e1,this.e2,this.e3,r);t=a*u*(1-h*c*(1/6-(8-c+8*d)*h/120)),n=p-this.ml0+a*s/o*h*(.5+(5-c+6*d)*h/24)}return e.x=t+this.x0,e.y=n+this.y0,e}function DG(e){e.x-=this.x0,e.y-=this.y0;var t=e.x/this.a,n=e.y/this.a,i,r;if(this.sphere){var s=n+this.lat0;i=Math.asin(Math.sin(s)*Math.cos(t)),r=Math.atan2(Math.tan(t),Math.cos(s))}else{var o=this.ml0/this.a+n,a=M_(o,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(a)-ge)<=ve)return e.x=this.long0,e.y=ge,n<0&&(e.y*=-1),e;var c=ih(this.a,this.e,Math.sin(a)),u=c*c*c/this.a/this.a*(1-this.es),h=Math.pow(Math.tan(a),2),d=t*this.a/c,p=d*d;i=a-c*Math.tan(a)/u*d*d*(.5-(1+3*h)*d*d/24),r=d*(1-p*(h/3+(1+3*h)*h*p/15))/Math.cos(a)}return e.x=Ne(r+this.long0),e.y=Ah(i),e}var MG=["Cassini","Cassini_Soldner","cass"];const LG={init:OG,forward:RG,inverse:DG,names:MG};function rl(e,t){var n;return e>1e-7?(n=e*t,(1-e*e)*(t/(1-n*n)-.5/e*Math.log((1-n)/(1+n)))):2*t}var PG=1,NG=2,FG=3,BG=4;function zG(){var e=Math.abs(this.lat0);if(Math.abs(e-ge)<ve?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<ve?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var t;switch(this.qp=rl(this.e,1),this.mmf=.5/(1-this.es),this.apa=$G(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=rl(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function UG(e){var t,n,i,r,s,o,a,c,u,h,d=e.x,p=e.y;if(d=Ne(d-this.long0),this.sphere){if(s=Math.sin(p),h=Math.cos(p),i=Math.cos(d),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(n=this.mode===this.EQUIT?1+h*i:1+this.sinph0*s+this.cosph0*h*i,n<=ve)return null;n=Math.sqrt(2/n),t=n*h*Math.sin(d),n*=this.mode===this.EQUIT?s:this.cosph0*s-this.sinph0*h*i}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(i=-i),Math.abs(p+this.lat0)<ve)return null;n=rn-p*.5,n=2*(this.mode===this.S_POLE?Math.cos(n):Math.sin(n)),t=n*Math.sin(d),n*=i}}else{switch(a=0,c=0,u=0,i=Math.cos(d),r=Math.sin(d),s=Math.sin(p),o=rl(this.e,s),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(a=o/this.qp,c=Math.sqrt(1-a*a)),this.mode){case this.OBLIQ:u=1+this.sinb1*a+this.cosb1*c*i;break;case this.EQUIT:u=1+c*i;break;case this.N_POLE:u=ge+p,o=this.qp-o;break;case this.S_POLE:u=p-ge,o=this.qp+o;break}if(Math.abs(u)<ve)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:u=Math.sqrt(2/u),this.mode===this.OBLIQ?n=this.ymf*u*(this.cosb1*a-this.sinb1*c*i):n=(u=Math.sqrt(2/(1+c*i)))*a*this.ymf,t=this.xmf*u*c*r;break;case this.N_POLE:case this.S_POLE:o>=0?(t=(u=Math.sqrt(o))*r,n=i*(this.mode===this.S_POLE?u:-u)):t=n=0;break}}return e.x=this.a*t+this.x0,e.y=this.a*n+this.y0,e}function kG(e){e.x-=this.x0,e.y-=this.y0;var t=e.x/this.a,n=e.y/this.a,i,r,s,o,a,c,u;if(this.sphere){var h=0,d,p=0;if(d=Math.sqrt(t*t+n*n),r=d*.5,r>1)return null;switch(r=2*Math.asin(r),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(p=Math.sin(r),h=Math.cos(r)),this.mode){case this.EQUIT:r=Math.abs(d)<=ve?0:Math.asin(n*p/d),t*=p,n=h*d;break;case this.OBLIQ:r=Math.abs(d)<=ve?this.lat0:Math.asin(h*this.sinph0+n*p*this.cosph0/d),t*=p*this.cosph0,n=(h-Math.sin(r)*this.sinph0)*d;break;case this.N_POLE:n=-n,r=ge-r;break;case this.S_POLE:r-=ge;break}i=n===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(t,n)}else{if(u=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t/=this.dd,n*=this.dd,c=Math.sqrt(t*t+n*n),c<ve)return e.x=this.long0,e.y=this.lat0,e;o=2*Math.asin(.5*c/this.rq),s=Math.cos(o),t*=o=Math.sin(o),this.mode===this.OBLIQ?(u=s*this.sinb1+n*o*this.cosb1/c,a=this.qp*u,n=c*this.cosb1*s-n*this.sinb1*o):(u=n*o/c,a=this.qp*u,n=c*s)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),a=t*t+n*n,!a)return e.x=this.long0,e.y=this.lat0,e;u=1-a/this.qp,this.mode===this.S_POLE&&(u=-u)}i=Math.atan2(t,n),r=XG(Math.asin(u),this.apa)}return e.x=Ne(this.long0+i),e.y=r,e}var jG=.3333333333333333,VG=.17222222222222222,GG=.10257936507936508,HG=.06388888888888888,qG=.0664021164021164,WG=.016415012942191543;function $G(e){var t,n=[];return n[0]=e*jG,t=e*e,n[0]+=t*VG,n[1]=t*HG,t*=e,n[0]+=t*GG,n[1]+=t*qG,n[2]=t*WG,n}function XG(e,t){var n=e+e;return e+t[0]*Math.sin(n)+t[1]*Math.sin(n+n)+t[2]*Math.sin(n+n+n)}var YG=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const KG={init:zG,forward:UG,inverse:kG,names:YG,S_POLE:PG,N_POLE:NG,EQUIT:FG,OBLIQ:BG};function bl(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)}function ZG(){Math.abs(this.lat1+this.lat2)<ve||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=_a(this.e3,this.sin_po,this.cos_po),this.qs1=rl(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=_a(this.e3,this.sin_po,this.cos_po),this.qs2=rl(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=rl(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>ve?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function JG(e){var t=e.x,n=e.y;this.sin_phi=Math.sin(n),this.cos_phi=Math.cos(n);var i=rl(this.e3,this.sin_phi),r=this.a*Math.sqrt(this.c-this.ns0*i)/this.ns0,s=this.ns0*Ne(t-this.long0),o=r*Math.sin(s)+this.x0,a=this.rh-r*Math.cos(s)+this.y0;return e.x=o,e.y=a,e}function QG(e){var t,n,i,r,s,o;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(t=Math.sqrt(e.x*e.x+e.y*e.y),i=1):(t=-Math.sqrt(e.x*e.x+e.y*e.y),i=-1),r=0,t!==0&&(r=Math.atan2(i*e.x,i*e.y)),i=t*this.ns0/this.a,this.sphere?o=Math.asin((this.c-i*i)/(2*this.ns0)):(n=(this.c-i*i)/this.ns0,o=this.phi1z(this.e3,n)),s=Ne(r/this.ns0+this.long0),e.x=s,e.y=o,e}function e9(e,t){var n,i,r,s,o,a=bl(.5*t);if(e<ve)return a;for(var c=e*e,u=1;u<=25;u++)if(n=Math.sin(a),i=Math.cos(a),r=e*n,s=1-r*r,o=.5*s*s/i*(t/(1-c)-n/s+.5/e*Math.log((1-r)/(1+r))),a=a+o,Math.abs(o)<=1e-7)return a;return null}var t9=["Albers_Conic_Equal_Area","Albers","aea"];const n9={init:ZG,forward:JG,inverse:QG,names:t9,phi1z:e9};function i9(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function r9(e){var t,n,i,r,s,o,a,c,u=e.x,h=e.y;return i=Ne(u-this.long0),t=Math.sin(h),n=Math.cos(h),r=Math.cos(i),o=this.sin_p14*t+this.cos_p14*n*r,s=1,o>0||Math.abs(o)<=ve?(a=this.x0+this.a*s*n*Math.sin(i)/o,c=this.y0+this.a*s*(this.cos_p14*t-this.sin_p14*n*r)/o):(a=this.x0+this.infinity_dist*n*Math.sin(i),c=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*n*r)),e.x=a,e.y=c,e}function s9(e){var t,n,i,r,s,o;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(t=Math.sqrt(e.x*e.x+e.y*e.y))?(r=Math.atan2(t,this.rc),n=Math.sin(r),i=Math.cos(r),o=bl(i*this.sin_p14+e.y*n*this.cos_p14/t),s=Math.atan2(e.x*n,t*this.cos_p14*i-e.y*this.sin_p14*n),s=Ne(this.long0+s)):(o=this.phic0,s=0),e.x=s,e.y=o,e}var o9=["gnom"];const a9={init:i9,forward:r9,inverse:s9,names:o9};function c9(e,t){var n=1-(1-e*e)/(2*e)*Math.log((1-e)/(1+e));if(Math.abs(Math.abs(t)-n)<1e-6)return t<0?-1*ge:ge;for(var i=Math.asin(.5*t),r,s,o,a,c=0;c<30;c++)if(s=Math.sin(i),o=Math.cos(i),a=e*s,r=Math.pow(1-a*a,2)/(2*o)*(t/(1-e*e)-s/(1-a*a)+.5/e*Math.log((1-a)/(1+a))),i+=r,Math.abs(r)<=1e-10)return i;return NaN}function l9(){this.sphere||(this.k0=_a(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function u9(e){var t=e.x,n=e.y,i,r,s=Ne(t-this.long0);if(this.sphere)i=this.x0+this.a*s*Math.cos(this.lat_ts),r=this.y0+this.a*Math.sin(n)/Math.cos(this.lat_ts);else{var o=rl(this.e,Math.sin(n));i=this.x0+this.a*this.k0*s,r=this.y0+this.a*o*.5/this.k0}return e.x=i,e.y=r,e}function f9(e){e.x-=this.x0,e.y-=this.y0;var t,n;return this.sphere?(t=Ne(this.long0+e.x/this.a/Math.cos(this.lat_ts)),n=Math.asin(e.y/this.a*Math.cos(this.lat_ts))):(n=c9(this.e,2*e.y*this.k0/this.a),t=Ne(this.long0+e.x/(this.a*this.k0))),e.x=t,e.y=n,e}var h9=["cea"];const d9={init:l9,forward:u9,inverse:f9,names:h9};function p9(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function m9(e){var t=e.x,n=e.y,i=Ne(t-this.long0),r=Ah(n-this.lat0);return e.x=this.x0+this.a*i*this.rc,e.y=this.y0+this.a*r,e}function g9(e){var t=e.x,n=e.y;return e.x=Ne(this.long0+(t-this.x0)/(this.a*this.rc)),e.y=Ah(this.lat0+(n-this.y0)/this.a),e}var _9=["Equirectangular","Equidistant_Cylindrical","eqc"];const y9={init:p9,forward:m9,inverse:g9,names:_9};var QS=20;function b9(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Hp(this.es),this.e1=qp(this.es),this.e2=Wp(this.es),this.e3=$p(this.es),this.ml0=this.a*Nr(this.e0,this.e1,this.e2,this.e3,this.lat0)}function T9(e){var t=e.x,n=e.y,i,r,s,o=Ne(t-this.long0);if(s=o*Math.sin(n),this.sphere)Math.abs(n)<=ve?(i=this.a*o,r=-1*this.a*this.lat0):(i=this.a*Math.sin(s)/Math.tan(n),r=this.a*(Ah(n-this.lat0)+(1-Math.cos(s))/Math.tan(n)));else if(Math.abs(n)<=ve)i=this.a*o,r=-1*this.ml0;else{var a=ih(this.a,this.e,Math.sin(n))/Math.tan(n);i=a*Math.sin(s),r=this.a*Nr(this.e0,this.e1,this.e2,this.e3,n)-this.ml0+a*(1-Math.cos(s))}return e.x=i+this.x0,e.y=r+this.y0,e}function x9(e){var t,n,i,r,s,o,a,c,u;if(i=e.x-this.x0,r=e.y-this.y0,this.sphere)if(Math.abs(r+this.a*this.lat0)<=ve)t=Ne(i/this.a+this.long0),n=0;else{o=this.lat0+r/this.a,a=i*i/this.a/this.a+o*o,c=o;var h;for(s=QS;s;--s)if(h=Math.tan(c),u=-1*(o*(c*h+1)-c-.5*(c*c+a)*h)/((c-o)/h-1),c+=u,Math.abs(u)<=ve){n=c;break}t=Ne(this.long0+Math.asin(i*Math.tan(c)/this.a)/Math.sin(n))}else if(Math.abs(r+this.ml0)<=ve)n=0,t=Ne(this.long0+i/this.a);else{o=(this.ml0+r)/this.a,a=i*i/this.a/this.a+o*o,c=o;var d,p,g,_,b;for(s=QS;s;--s)if(b=this.e*Math.sin(c),d=Math.sqrt(1-b*b)*Math.tan(c),p=this.a*Nr(this.e0,this.e1,this.e2,this.e3,c),g=this.e0-2*this.e1*Math.cos(2*c)+4*this.e2*Math.cos(4*c)-6*this.e3*Math.cos(6*c),_=p/this.a,u=(o*(d*_+1)-_-.5*d*(_*_+a))/(this.es*Math.sin(2*c)*(_*_+a-2*o*_)/(4*d)+(o-_)*(d*g-2/Math.sin(2*c))-g),c-=u,Math.abs(u)<=ve){n=c;break}d=Math.sqrt(1-this.es*Math.pow(Math.sin(n),2))*Math.tan(n),t=Ne(this.long0+Math.asin(i*d/this.a)/Math.sin(n))}return e.x=t,e.y=n,e}var E9=["Polyconic","poly"];const C9={init:b9,forward:T9,inverse:x9,names:E9};function w9(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function A9(e){var t,n=e.x,i=e.y,r=i-this.lat0,s=n-this.long0,o=r/Hd*1e-5,a=s,c=1,u=0;for(t=1;t<=10;t++)c=c*o,u=u+this.A[t]*c;var h=u,d=a,p=1,g=0,_,b,x=0,E=0;for(t=1;t<=6;t++)_=p*h-g*d,b=g*h+p*d,p=_,g=b,x=x+this.B_re[t]*p-this.B_im[t]*g,E=E+this.B_im[t]*p+this.B_re[t]*g;return e.x=E*this.a+this.x0,e.y=x*this.a+this.y0,e}function S9(e){var t,n=e.x,i=e.y,r=n-this.x0,s=i-this.y0,o=s/this.a,a=r/this.a,c=1,u=0,h,d,p=0,g=0;for(t=1;t<=6;t++)h=c*o-u*a,d=u*o+c*a,c=h,u=d,p=p+this.C_re[t]*c-this.C_im[t]*u,g=g+this.C_im[t]*c+this.C_re[t]*u;for(var _=0;_<this.iterations;_++){var b=p,x=g,E,C,w=o,S=a;for(t=2;t<=6;t++)E=b*p-x*g,C=x*p+b*g,b=E,x=C,w=w+(t-1)*(this.B_re[t]*b-this.B_im[t]*x),S=S+(t-1)*(this.B_im[t]*b+this.B_re[t]*x);b=1,x=0;var v=this.B_re[1],D=this.B_im[1];for(t=2;t<=6;t++)E=b*p-x*g,C=x*p+b*g,b=E,x=C,v=v+t*(this.B_re[t]*b-this.B_im[t]*x),D=D+t*(this.B_im[t]*b+this.B_re[t]*x);var L=v*v+D*D;p=(w*v+S*D)/L,g=(S*v-w*D)/L}var O=p,N=g,B=1,U=0;for(t=1;t<=9;t++)B=B*O,U=U+this.D[t]*B;var V=this.lat0+U*Hd*1e5,f=this.long0+N;return e.x=f,e.y=V,e}var v9=["New_Zealand_Map_Grid","nzmg"];const I9={init:w9,forward:A9,inverse:S9,names:v9};function O9(){}function R9(e){var t=e.x,n=e.y,i=Ne(t-this.long0),r=this.x0+this.a*i,s=this.y0+this.a*Math.log(Math.tan(Math.PI/4+n/2.5))*1.25;return e.x=r,e.y=s,e}function D9(e){e.x-=this.x0,e.y-=this.y0;var t=Ne(this.long0+e.x/this.a),n=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Math.PI/4);return e.x=t,e.y=n,e}var M9=["Miller_Cylindrical","mill"];const L9={init:O9,forward:R9,inverse:D9,names:M9};var P9=20;function N9(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=sM(this.es)}function F9(e){var t,n,i=e.x,r=e.y;if(i=Ne(i-this.long0),this.sphere){if(!this.m)r=this.n!==1?Math.asin(this.n*Math.sin(r)):r;else for(var s=this.n*Math.sin(r),o=P9;o;--o){var a=(this.m*r+Math.sin(r)-s)/(this.m+Math.cos(r));if(r-=a,Math.abs(a)<ve)break}t=this.a*this.C_x*i*(this.m+Math.cos(r)),n=this.a*this.C_y*r}else{var c=Math.sin(r),u=Math.cos(r);n=this.a*Fy(r,c,u,this.en),t=this.a*i*u/Math.sqrt(1-this.es*c*c)}return e.x=t,e.y=n,e}function B9(e){var t,n,i,r;return e.x-=this.x0,i=e.x/this.a,e.y-=this.y0,t=e.y/this.a,this.sphere?(t/=this.C_y,i=i/(this.C_x*(this.m+Math.cos(t))),this.m?t=bl((this.m*t+Math.sin(t))/this.n):this.n!==1&&(t=bl(Math.sin(t)/this.n)),i=Ne(i+this.long0),t=Ah(t)):(t=oM(e.y/this.a,this.es,this.en),r=Math.abs(t),r<ge?(r=Math.sin(t),n=this.long0+e.x*Math.sqrt(1-this.es*r*r)/(this.a*Math.cos(t)),i=Ne(n)):r-ve<ge&&(i=this.long0)),e.x=i,e.y=t,e}var z9=["Sinusoidal","sinu"];const U9={init:N9,forward:F9,inverse:B9,names:z9};function k9(){}function j9(e){for(var t=e.x,n=e.y,i=Ne(t-this.long0),r=n,s=Math.PI*Math.sin(n);;){var o=-(r+Math.sin(r)-s)/(1+Math.cos(r));if(r+=o,Math.abs(o)<ve)break}r/=2,Math.PI/2-Math.abs(n)<ve&&(i=0);var a=.900316316158*this.a*i*Math.cos(r)+this.x0,c=1.4142135623731*this.a*Math.sin(r)+this.y0;return e.x=a,e.y=c,e}function V9(e){var t,n;e.x-=this.x0,e.y-=this.y0,n=e.y/(1.4142135623731*this.a),Math.abs(n)>.999999999999&&(n=.999999999999),t=Math.asin(n);var i=Ne(this.long0+e.x/(.900316316158*this.a*Math.cos(t)));i<-Math.PI&&(i=-Math.PI),i>Math.PI&&(i=Math.PI),n=(2*t+Math.sin(2*t))/Math.PI,Math.abs(n)>1&&(n=1);var r=Math.asin(n);return e.x=i,e.y=r,e}var G9=["Mollweide","moll"];const H9={init:k9,forward:j9,inverse:V9,names:G9};function q9(){Math.abs(this.lat1+this.lat2)<ve||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Hp(this.es),this.e1=qp(this.es),this.e2=Wp(this.es),this.e3=$p(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=_a(this.e,this.sinphi,this.cosphi),this.ml1=Nr(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<ve?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=_a(this.e,this.sinphi,this.cosphi),this.ml2=Nr(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Nr(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function W9(e){var t=e.x,n=e.y,i;if(this.sphere)i=this.a*(this.g-n);else{var r=Nr(this.e0,this.e1,this.e2,this.e3,n);i=this.a*(this.g-r)}var s=this.ns*Ne(t-this.long0),o=this.x0+i*Math.sin(s),a=this.y0+this.rh-i*Math.cos(s);return e.x=o,e.y=a,e}function $9(e){e.x-=this.x0,e.y=this.rh-e.y+this.y0;var t,n,i,r;this.ns>=0?(n=Math.sqrt(e.x*e.x+e.y*e.y),t=1):(n=-Math.sqrt(e.x*e.x+e.y*e.y),t=-1);var s=0;if(n!==0&&(s=Math.atan2(t*e.x,t*e.y)),this.sphere)return r=Ne(this.long0+s/this.ns),i=Ah(this.g-n/this.a),e.x=r,e.y=i,e;var o=this.g-n/this.a;return i=M_(o,this.e0,this.e1,this.e2,this.e3),r=Ne(this.long0+s/this.ns),e.x=r,e.y=i,e}var X9=["Equidistant_Conic","eqdc"];const Y9={init:q9,forward:W9,inverse:$9,names:X9};function K9(){this.R=this.a}function Z9(e){var t=e.x,n=e.y,i=Ne(t-this.long0),r,s;Math.abs(n)<=ve&&(r=this.x0+this.R*i,s=this.y0);var o=bl(2*Math.abs(n/Math.PI));(Math.abs(i)<=ve||Math.abs(Math.abs(n)-ge)<=ve)&&(r=this.x0,n>=0?s=this.y0+Math.PI*this.R*Math.tan(.5*o):s=this.y0+Math.PI*this.R*-Math.tan(.5*o));var a=.5*Math.abs(Math.PI/i-i/Math.PI),c=a*a,u=Math.sin(o),h=Math.cos(o),d=h/(u+h-1),p=d*d,g=d*(2/u-1),_=g*g,b=Math.PI*this.R*(a*(d-_)+Math.sqrt(c*(d-_)*(d-_)-(_+c)*(p-_)))/(_+c);i<0&&(b=-b),r=this.x0+b;var x=c+d;return b=Math.PI*this.R*(g*x-a*Math.sqrt((_+c)*(c+1)-x*x))/(_+c),n>=0?s=this.y0+b:s=this.y0-b,e.x=r,e.y=s,e}function J9(e){var t,n,i,r,s,o,a,c,u,h,d,p,g;return e.x-=this.x0,e.y-=this.y0,d=Math.PI*this.R,i=e.x/d,r=e.y/d,s=i*i+r*r,o=-Math.abs(r)*(1+s),a=o-2*r*r+i*i,c=-2*o+1+2*r*r+s*s,g=r*r/c+(2*a*a*a/c/c/c-9*o*a/c/c)/27,u=(o-a*a/3/c)/c,h=2*Math.sqrt(-u/3),d=3*g/u/h,Math.abs(d)>1&&(d>=0?d=1:d=-1),p=Math.acos(d)/3,e.y>=0?n=(-h*Math.cos(p+Math.PI/3)-a/3/c)*Math.PI:n=-(-h*Math.cos(p+Math.PI/3)-a/3/c)*Math.PI,Math.abs(i)<ve?t=this.long0:t=Ne(this.long0+Math.PI*(s-1+Math.sqrt(1+2*(i*i-r*r)+s*s))/2/i),e.x=t,e.y=n,e}var Q9=["Van_der_Grinten_I","VanDerGrinten","vandg"];const e5={init:K9,forward:Z9,inverse:J9,names:Q9};function t5(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function n5(e){var t=e.x,n=e.y,i=Math.sin(e.y),r=Math.cos(e.y),s=Ne(t-this.long0),o,a,c,u,h,d,p,g,_,b,x,E,C,w,S,v,D,L,O,N,B,U,V;return this.sphere?Math.abs(this.sin_p12-1)<=ve?(e.x=this.x0+this.a*(ge-n)*Math.sin(s),e.y=this.y0-this.a*(ge-n)*Math.cos(s),e):Math.abs(this.sin_p12+1)<=ve?(e.x=this.x0+this.a*(ge+n)*Math.sin(s),e.y=this.y0+this.a*(ge+n)*Math.cos(s),e):(L=this.sin_p12*i+this.cos_p12*r*Math.cos(s),v=Math.acos(L),D=v?v/Math.sin(v):1,e.x=this.x0+this.a*D*r*Math.sin(s),e.y=this.y0+this.a*D*(this.cos_p12*i-this.sin_p12*r*Math.cos(s)),e):(o=Hp(this.es),a=qp(this.es),c=Wp(this.es),u=$p(this.es),Math.abs(this.sin_p12-1)<=ve?(h=this.a*Nr(o,a,c,u,ge),d=this.a*Nr(o,a,c,u,n),e.x=this.x0+(h-d)*Math.sin(s),e.y=this.y0-(h-d)*Math.cos(s),e):Math.abs(this.sin_p12+1)<=ve?(h=this.a*Nr(o,a,c,u,ge),d=this.a*Nr(o,a,c,u,n),e.x=this.x0+(h+d)*Math.sin(s),e.y=this.y0+(h+d)*Math.cos(s),e):(p=i/r,g=ih(this.a,this.e,this.sin_p12),_=ih(this.a,this.e,i),b=Math.atan((1-this.es)*p+this.es*g*this.sin_p12/(_*r)),x=Math.atan2(Math.sin(s),this.cos_p12*Math.tan(b)-this.sin_p12*Math.cos(s)),x===0?O=Math.asin(this.cos_p12*Math.sin(b)-this.sin_p12*Math.cos(b)):Math.abs(Math.abs(x)-Math.PI)<=ve?O=-Math.asin(this.cos_p12*Math.sin(b)-this.sin_p12*Math.cos(b)):O=Math.asin(Math.sin(s)*Math.cos(b)/Math.sin(x)),E=this.e*this.sin_p12/Math.sqrt(1-this.es),C=this.e*this.cos_p12*Math.cos(x)/Math.sqrt(1-this.es),w=E*C,S=C*C,N=O*O,B=N*O,U=B*O,V=U*O,v=g*O*(1-N*S*(1-S)/6+B/8*w*(1-2*S)+U/120*(S*(4-7*S)-3*E*E*(1-7*S))-V/48*w),e.x=this.x0+v*Math.sin(x),e.y=this.y0+v*Math.cos(x),e))}function i5(e){e.x-=this.x0,e.y-=this.y0;var t,n,i,r,s,o,a,c,u,h,d,p,g,_,b,x,E,C,w,S,v,D,L,O;return this.sphere?(t=Math.sqrt(e.x*e.x+e.y*e.y),t>2*ge*this.a?void 0:(n=t/this.a,i=Math.sin(n),r=Math.cos(n),s=this.long0,Math.abs(t)<=ve?o=this.lat0:(o=bl(r*this.sin_p12+e.y*i*this.cos_p12/t),a=Math.abs(this.lat0)-ge,Math.abs(a)<=ve?this.lat0>=0?s=Ne(this.long0+Math.atan2(e.x,-e.y)):s=Ne(this.long0-Math.atan2(-e.x,e.y)):s=Ne(this.long0+Math.atan2(e.x*i,t*this.cos_p12*r-e.y*this.sin_p12*i))),e.x=s,e.y=o,e)):(c=Hp(this.es),u=qp(this.es),h=Wp(this.es),d=$p(this.es),Math.abs(this.sin_p12-1)<=ve?(p=this.a*Nr(c,u,h,d,ge),t=Math.sqrt(e.x*e.x+e.y*e.y),g=p-t,o=M_(g/this.a,c,u,h,d),s=Ne(this.long0+Math.atan2(e.x,-1*e.y)),e.x=s,e.y=o,e):Math.abs(this.sin_p12+1)<=ve?(p=this.a*Nr(c,u,h,d,ge),t=Math.sqrt(e.x*e.x+e.y*e.y),g=t-p,o=M_(g/this.a,c,u,h,d),s=Ne(this.long0+Math.atan2(e.x,e.y)),e.x=s,e.y=o,e):(t=Math.sqrt(e.x*e.x+e.y*e.y),x=Math.atan2(e.x,e.y),_=ih(this.a,this.e,this.sin_p12),E=Math.cos(x),C=this.e*this.cos_p12*E,w=-C*C/(1-this.es),S=3*this.es*(1-w)*this.sin_p12*this.cos_p12*E/(1-this.es),v=t/_,D=v-w*(1+w)*Math.pow(v,3)/6-S*(1+3*w)*Math.pow(v,4)/24,L=1-w*D*D/2-v*D*D*D/6,b=Math.asin(this.sin_p12*Math.cos(D)+this.cos_p12*Math.sin(D)*E),s=Ne(this.long0+Math.asin(Math.sin(x)*Math.sin(D)/Math.cos(b))),O=Math.sin(b),o=Math.atan2((O-this.es*L*this.sin_p12)*Math.tan(b),O*(1-this.es)),e.x=s,e.y=o,e))}var r5=["Azimuthal_Equidistant","aeqd"];const s5={init:t5,forward:n5,inverse:i5,names:r5};function o5(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function a5(e){var t,n,i,r,s,o,a,c,u=e.x,h=e.y;return i=Ne(u-this.long0),t=Math.sin(h),n=Math.cos(h),r=Math.cos(i),o=this.sin_p14*t+this.cos_p14*n*r,s=1,(o>0||Math.abs(o)<=ve)&&(a=this.a*s*n*Math.sin(i),c=this.y0+this.a*s*(this.cos_p14*t-this.sin_p14*n*r)),e.x=a,e.y=c,e}function c5(e){var t,n,i,r,s,o,a;return e.x-=this.x0,e.y-=this.y0,t=Math.sqrt(e.x*e.x+e.y*e.y),n=bl(t/this.a),i=Math.sin(n),r=Math.cos(n),o=this.long0,Math.abs(t)<=ve?(a=this.lat0,e.x=o,e.y=a,e):(a=bl(r*this.sin_p14+e.y*i*this.cos_p14/t),s=Math.abs(this.lat0)-ge,Math.abs(s)<=ve?(this.lat0>=0?o=Ne(this.long0+Math.atan2(e.x,-e.y)):o=Ne(this.long0-Math.atan2(-e.x,e.y)),e.x=o,e.y=a,e):(o=Ne(this.long0+Math.atan2(e.x*i,t*this.cos_p14*r-e.y*this.sin_p14*i)),e.x=o,e.y=a,e))}var l5=["ortho"];const u5={init:o5,forward:a5,inverse:c5,names:l5};var Zn={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},sn={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function f5(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=ge-rn/2?this.face=Zn.TOP:this.lat0<=-(ge-rn/2)?this.face=Zn.BOTTOM:Math.abs(this.long0)<=rn?this.face=Zn.FRONT:Math.abs(this.long0)<=ge+rn?this.face=this.long0>0?Zn.RIGHT:Zn.LEFT:this.face=Zn.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function h5(e){var t={x:0,y:0},n,i,r,s,o,a,c={value:0};if(e.x-=this.long0,this.es!==0?n=Math.atan(this.one_minus_f_squared*Math.tan(e.y)):n=e.y,i=e.x,this.face===Zn.TOP)s=ge-n,i>=rn&&i<=ge+rn?(c.value=sn.AREA_0,r=i-ge):i>ge+rn||i<=-(ge+rn)?(c.value=sn.AREA_1,r=i>0?i-hi:i+hi):i>-(ge+rn)&&i<=-rn?(c.value=sn.AREA_2,r=i+ge):(c.value=sn.AREA_3,r=i);else if(this.face===Zn.BOTTOM)s=ge+n,i>=rn&&i<=ge+rn?(c.value=sn.AREA_0,r=-i+ge):i<rn&&i>=-rn?(c.value=sn.AREA_1,r=-i):i<-rn&&i>=-(ge+rn)?(c.value=sn.AREA_2,r=-i-ge):(c.value=sn.AREA_3,r=i>0?-i+hi:-i-hi);else{var u,h,d,p,g,_,b;this.face===Zn.RIGHT?i=kf(i,+ge):this.face===Zn.BACK?i=kf(i,+hi):this.face===Zn.LEFT&&(i=kf(i,-ge)),p=Math.sin(n),g=Math.cos(n),_=Math.sin(i),b=Math.cos(i),u=g*b,h=g*_,d=p,this.face===Zn.FRONT?(s=Math.acos(u),r=Om(s,d,h,c)):this.face===Zn.RIGHT?(s=Math.acos(h),r=Om(s,d,-u,c)):this.face===Zn.BACK?(s=Math.acos(-u),r=Om(s,d,-h,c)):this.face===Zn.LEFT?(s=Math.acos(-h),r=Om(s,d,u,c)):(s=r=0,c.value=sn.AREA_0)}return a=Math.atan(12/hi*(r+Math.acos(Math.sin(r)*Math.cos(rn))-ge)),o=Math.sqrt((1-Math.cos(s))/(Math.cos(a)*Math.cos(a))/(1-Math.cos(Math.atan(1/Math.cos(r))))),c.value===sn.AREA_1?a+=ge:c.value===sn.AREA_2?a+=hi:c.value===sn.AREA_3&&(a+=1.5*hi),t.x=o*Math.cos(a),t.y=o*Math.sin(a),t.x=t.x*this.a+this.x0,t.y=t.y*this.a+this.y0,e.x=t.x,e.y=t.y,e}function d5(e){var t={lam:0,phi:0},n,i,r,s,o,a,c,u,h,d={value:0};if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,i=Math.atan(Math.sqrt(e.x*e.x+e.y*e.y)),n=Math.atan2(e.y,e.x),e.x>=0&&e.x>=Math.abs(e.y)?d.value=sn.AREA_0:e.y>=0&&e.y>=Math.abs(e.x)?(d.value=sn.AREA_1,n-=ge):e.x<0&&-e.x>=Math.abs(e.y)?(d.value=sn.AREA_2,n=n<0?n+hi:n-hi):(d.value=sn.AREA_3,n+=ge),h=hi/12*Math.tan(n),o=Math.sin(h)/(Math.cos(h)-1/Math.sqrt(2)),a=Math.atan(o),r=Math.cos(n),s=Math.tan(i),c=1-r*r*s*s*(1-Math.cos(Math.atan(1/Math.cos(a)))),c<-1?c=-1:c>1&&(c=1),this.face===Zn.TOP)u=Math.acos(c),t.phi=ge-u,d.value===sn.AREA_0?t.lam=a+ge:d.value===sn.AREA_1?t.lam=a<0?a+hi:a-hi:d.value===sn.AREA_2?t.lam=a-ge:t.lam=a;else if(this.face===Zn.BOTTOM)u=Math.acos(c),t.phi=u-ge,d.value===sn.AREA_0?t.lam=-a+ge:d.value===sn.AREA_1?t.lam=-a:d.value===sn.AREA_2?t.lam=-a-ge:t.lam=a<0?-a-hi:-a+hi;else{var p,g,_;p=c,h=p*p,h>=1?_=0:_=Math.sqrt(1-h)*Math.sin(a),h+=_*_,h>=1?g=0:g=Math.sqrt(1-h),d.value===sn.AREA_1?(h=g,g=-_,_=h):d.value===sn.AREA_2?(g=-g,_=-_):d.value===sn.AREA_3&&(h=g,g=_,_=-h),this.face===Zn.RIGHT?(h=p,p=-g,g=h):this.face===Zn.BACK?(p=-p,g=-g):this.face===Zn.LEFT&&(h=p,p=g,g=-h),t.phi=Math.acos(-_)-ge,t.lam=Math.atan2(g,p),this.face===Zn.RIGHT?t.lam=kf(t.lam,-ge):this.face===Zn.BACK?t.lam=kf(t.lam,-hi):this.face===Zn.LEFT&&(t.lam=kf(t.lam,+ge))}if(this.es!==0){var b,x,E;b=t.phi<0?1:0,x=Math.tan(t.phi),E=this.b/Math.sqrt(x*x+this.one_minus_f_squared),t.phi=Math.atan(Math.sqrt(this.a*this.a-E*E)/(this.one_minus_f*E)),b&&(t.phi=-t.phi)}return t.lam+=this.long0,e.x=t.lam,e.y=t.phi,e}function Om(e,t,n,i){var r;return e<ve?(i.value=sn.AREA_0,r=0):(r=Math.atan2(t,n),Math.abs(r)<=rn?i.value=sn.AREA_0:r>rn&&r<=ge+rn?(i.value=sn.AREA_1,r-=ge):r>ge+rn||r<=-(ge+rn)?(i.value=sn.AREA_2,r=r>=0?r-hi:r+hi):(i.value=sn.AREA_3,r+=ge)),r}function kf(e,t){var n=e+t;return n<-hi?n+=yp:n>+hi&&(n-=yp),n}var p5=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const m5={init:f5,forward:h5,inverse:d5,names:p5};var Mx=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Ld=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],lM=.8487,uM=1.3523,fM=ra/5,g5=1/fM,Sf=18,L_=function(e,t){return e[0]+t*(e[1]+t*(e[2]+t*e[3]))},_5=function(e,t){return e[1]+t*(2*e[2]+t*3*e[3])};function y5(e,t,n,i){for(var r=t;i;--i){var s=e(r);if(r-=s,Math.abs(s)<n)break}return r}function b5(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function T5(e){var t=Ne(e.x-this.long0),n=Math.abs(e.y),i=Math.floor(n*fM);i<0?i=0:i>=Sf&&(i=Sf-1),n=ra*(n-g5*i);var r={x:L_(Mx[i],n)*t,y:L_(Ld[i],n)};return e.y<0&&(r.y=-r.y),r.x=r.x*this.a*lM+this.x0,r.y=r.y*this.a*uM+this.y0,r}function x5(e){var t={x:(e.x-this.x0)/(this.a*lM),y:Math.abs(e.y-this.y0)/(this.a*uM)};if(t.y>=1)t.x/=Mx[Sf][0],t.y=e.y<0?-ge:ge;else{var n=Math.floor(t.y*Sf);for(n<0?n=0:n>=Sf&&(n=Sf-1);;)if(Ld[n][0]>t.y)--n;else if(Ld[n+1][0]<=t.y)++n;else break;var i=Ld[n],r=5*(t.y-i[0])/(Ld[n+1][0]-i[0]);r=y5(function(s){return(L_(i,s)-t.y)/_5(i,s)},r,ve,100),t.x/=L_(Mx[n],r),t.y=(5*n+r)*er,e.y<0&&(t.y=-t.y)}return t.x=Ne(t.x+this.long0),t}var E5=["Robinson","robin"];const C5={init:b5,forward:T5,inverse:x5,names:E5};function w5(){this.name="geocent"}function A5(e){var t=KD(e,this.es,this.a);return t}function S5(e){var t=ZD(e,this.es,this.a,this.b);return t}var v5=["Geocentric","geocentric","geocent","Geocent"];const I5={init:w5,forward:A5,inverse:S5,names:v5};var gr={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},td={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function O5(){if(Object.keys(td).forEach((function(n){if(typeof this[n]>"u")this[n]=td[n].def;else{if(td[n].num&&isNaN(this[n]))throw new Error("Invalid parameter value, must be numeric "+n+" = "+this[n]);td[n].num&&(this[n]=parseFloat(this[n]))}td[n].degrees&&(this[n]=this[n]*er)}).bind(this)),Math.abs(Math.abs(this.lat0)-ge)<ve?this.mode=this.lat0<0?gr.S_POLE:gr.N_POLE:Math.abs(this.lat0)<ve?this.mode=gr.EQUIT:(this.mode=gr.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var e=this.tilt,t=this.azi;this.cg=Math.cos(t),this.sg=Math.sin(t),this.cw=Math.cos(e),this.sw=Math.sin(e)}function R5(e){e.x-=this.long0;var t=Math.sin(e.y),n=Math.cos(e.y),i=Math.cos(e.x),r,s;switch(this.mode){case gr.OBLIQ:s=this.sinph0*t+this.cosph0*n*i;break;case gr.EQUIT:s=n*i;break;case gr.S_POLE:s=-t;break;case gr.N_POLE:s=t;break}switch(s=this.pn1/(this.p-s),r=s*n*Math.sin(e.x),this.mode){case gr.OBLIQ:s*=this.cosph0*t-this.sinph0*n*i;break;case gr.EQUIT:s*=t;break;case gr.N_POLE:s*=-(n*i);break;case gr.S_POLE:s*=n*i;break}var o,a;return o=s*this.cg+r*this.sg,a=1/(o*this.sw*this.h1+this.cw),r=(r*this.cg-s*this.sg)*this.cw*a,s=o*a,e.x=r*this.a,e.y=s*this.a,e}function D5(e){e.x/=this.a,e.y/=this.a;var t={x:e.x,y:e.y},n,i,r;r=1/(this.pn1-e.y*this.sw),n=this.pn1*e.x*r,i=this.pn1*e.y*this.cw*r,e.x=n*this.cg+i*this.sg,e.y=i*this.cg-n*this.sg;var s=Xs(e.x,e.y);if(Math.abs(s)<ve)t.x=0,t.y=e.y;else{var o,a;switch(a=1-s*s*this.pfact,a=(this.p-Math.sqrt(a))/(this.pn1/s+s/this.pn1),o=Math.sqrt(1-a*a),this.mode){case gr.OBLIQ:t.y=Math.asin(o*this.sinph0+e.y*a*this.cosph0/s),e.y=(o-this.sinph0*Math.sin(t.y))*s,e.x*=a*this.cosph0;break;case gr.EQUIT:t.y=Math.asin(e.y*a/s),e.y=o*s,e.x*=a;break;case gr.N_POLE:t.y=Math.asin(o),e.y=-e.y;break;case gr.S_POLE:t.y=-Math.asin(o);break}t.x=Math.atan2(e.x,e.y)}return e.x=t.x+this.long0,e.y=t.y,e}var M5=["Tilted_Perspective","tpers"];const L5={init:O5,forward:R5,inverse:D5,names:M5};function P5(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var e=1-this.es,t=1/e;this.radius_p=Math.sqrt(e),this.radius_p2=e,this.radius_p_inv2=t,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function N5(e){var t=e.x,n=e.y,i,r,s,o;if(t=t-this.long0,this.shape==="ellipse"){n=Math.atan(this.radius_p2*Math.tan(n));var a=this.radius_p/Xs(this.radius_p*Math.cos(n),Math.sin(n));if(r=a*Math.cos(t)*Math.cos(n),s=a*Math.sin(t)*Math.cos(n),o=a*Math.sin(n),(this.radius_g-r)*r-s*s-o*o*this.radius_p_inv2<0)return e.x=Number.NaN,e.y=Number.NaN,e;i=this.radius_g-r,this.flip_axis?(e.x=this.radius_g_1*Math.atan(s/Xs(o,i)),e.y=this.radius_g_1*Math.atan(o/i)):(e.x=this.radius_g_1*Math.atan(s/i),e.y=this.radius_g_1*Math.atan(o/Xs(s,i)))}else this.shape==="sphere"&&(i=Math.cos(n),r=Math.cos(t)*i,s=Math.sin(t)*i,o=Math.sin(n),i=this.radius_g-r,this.flip_axis?(e.x=this.radius_g_1*Math.atan(s/Xs(o,i)),e.y=this.radius_g_1*Math.atan(o/i)):(e.x=this.radius_g_1*Math.atan(s/i),e.y=this.radius_g_1*Math.atan(o/Xs(s,i))));return e.x=e.x*this.a,e.y=e.y*this.a,e}function F5(e){var t=-1,n=0,i=0,r,s,o,a;if(e.x=e.x/this.a,e.y=e.y/this.a,this.shape==="ellipse"){this.flip_axis?(i=Math.tan(e.y/this.radius_g_1),n=Math.tan(e.x/this.radius_g_1)*Xs(1,i)):(n=Math.tan(e.x/this.radius_g_1),i=Math.tan(e.y/this.radius_g_1)*Xs(1,n));var c=i/this.radius_p;if(r=n*n+c*c+t*t,s=2*this.radius_g*t,o=s*s-4*r*this.C,o<0)return e.x=Number.NaN,e.y=Number.NaN,e;a=(-s-Math.sqrt(o))/(2*r),t=this.radius_g+a*t,n*=a,i*=a,e.x=Math.atan2(n,t),e.y=Math.atan(i*Math.cos(e.x)/t),e.y=Math.atan(this.radius_p_inv2*Math.tan(e.y))}else if(this.shape==="sphere"){if(this.flip_axis?(i=Math.tan(e.y/this.radius_g_1),n=Math.tan(e.x/this.radius_g_1)*Math.sqrt(1+i*i)):(n=Math.tan(e.x/this.radius_g_1),i=Math.tan(e.y/this.radius_g_1)*Math.sqrt(1+n*n)),r=n*n+i*i+t*t,s=2*this.radius_g*t,o=s*s-4*r*this.C,o<0)return e.x=Number.NaN,e.y=Number.NaN,e;a=(-s-Math.sqrt(o))/(2*r),t=this.radius_g+a*t,n*=a,i*=a,e.x=Math.atan2(n,t),e.y=Math.atan(i*Math.cos(e.x)/t)}return e.x=e.x+this.long0,e}var B5=["Geostationary Satellite View","Geostationary_Satellite","geos"];const z5={init:P5,forward:N5,inverse:F5,names:B5};var qd=1.340264,Wd=-.081106,$d=893e-6,Xd=.003796,P_=Math.sqrt(3)/2;function U5(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function k5(e){var t=Ne(e.x-this.long0),n=e.y,i=Math.asin(P_*Math.sin(n)),r=i*i,s=r*r*r;return e.x=t*Math.cos(i)/(P_*(qd+3*Wd*r+s*(7*$d+9*Xd*r))),e.y=i*(qd+Wd*r+s*($d+Xd*r)),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function j5(e){e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a;var t=1e-9,n=12,i=e.y,r,s,o,a,c,u;for(u=0;u<n&&(r=i*i,s=r*r*r,o=i*(qd+Wd*r+s*($d+Xd*r))-e.y,a=qd+3*Wd*r+s*(7*$d+9*Xd*r),i-=c=o/a,!(Math.abs(c)<t));++u);return r=i*i,s=r*r*r,e.x=P_*e.x*(qd+3*Wd*r+s*(7*$d+9*Xd*r))/Math.cos(i),e.y=Math.asin(Math.sin(i)/P_),e.x=Ne(e.x+this.long0),e}var V5=["eqearth","Equal Earth","Equal_Earth"];const G5={init:U5,forward:k5,inverse:j5,names:V5};function H5(e){e.Proj.projections.add(Yg),e.Proj.projections.add(Kg),e.Proj.projections.add(qV),e.Proj.projections.add(tG),e.Proj.projections.add(aG),e.Proj.projections.add(hG),e.Proj.projections.add(yG),e.Proj.projections.add(CG),e.Proj.projections.add(IG),e.Proj.projections.add(LG),e.Proj.projections.add(KG),e.Proj.projections.add(n9),e.Proj.projections.add(a9),e.Proj.projections.add(d9),e.Proj.projections.add(y9),e.Proj.projections.add(C9),e.Proj.projections.add(I9),e.Proj.projections.add(L9),e.Proj.projections.add(U9),e.Proj.projections.add(H9),e.Proj.projections.add(Y9),e.Proj.projections.add(e5),e.Proj.projections.add(s5),e.Proj.projections.add(u5),e.Proj.projections.add(m5),e.Proj.projections.add(C5),e.Proj.projections.add(I5),e.Proj.projections.add(L5),e.Proj.projections.add(z5),e.Proj.projections.add(G5)}zr.defaultDatum="WGS84";zr.Proj=la;zr.WGS84=new zr.Proj("WGS84");zr.Point=nh;zr.toPoint=JD;zr.defs=Mr;zr.nadgrid=$j;zr.transform=D_;zr.mgrs=lV;zr.version="__VERSION__";H5(zr);const q5=()=>navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome"),qwe=()=>navigator.userAgent.includes("Mozilla")&&!navigator.userAgent.includes("Chrome"),Wwe=(e,t)=>t?e<0?t:e%(t+1):0,$we=(e,t,n)=>Math.min(Math.max(e,t),n),W5=e=>{if(!e.startsWith("#")||e.length!==4&&e.length!==7&&e.length!==9)return null;let t,n,i,r=1;const s=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;return e=e.replace(s,(o,a,c,u)=>"#"+a+a+c+c+u+u),e.length>=7?(t=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),i=parseInt(e.slice(5,7),16),e.length===9&&(r=Math.round(100*(parseInt(e.slice(7,9),16)/255))/100),[t,n,i,r].includes(NaN)?null:[t,n,i,r]):null},$5=e=>{if(!e.startsWith("rgb"))return null;let t;const n=1;try{t=e.replace(/[^\d,.-]/g,"").split(",").map((i,r)=>r<3?Math.round(Number(i)):Number(i))}catch{return null}if(t.length===3)t.push(n);else if(t.length<3||t.length>4)return null;return t.includes(NaN)||t.some(i=>i<0||i>255)||t[3]>n?null:t},X5=e=>{let t=W5(e);return t||(t=$5(e)),t},Y5=(e,t,n)=>{const i=n!==void 0&&!q5()?n:"text/plain;charset=utf-8",r=new Blob([new Uint8Array([239,187,191]),e],{type:i});Cz.saveAs(r,t)},K5={ADD_FEATURES:"addfeatures"};class Z5 extends Iz{constructor(t,n,i,r){super(t),this.features=i,this.file=n,this.projection=r}}class J5 extends wz{constructor(t){t=t||{},super({handleEvent:Az}),this.on,this.once,this.un,this.readAsBuffer_=!1,this.formats_=[];const n=t.formatConstructors?t.formatConstructors:[];for(let i=0,r=n.length;i<r;++i){let s=n[i];typeof s=="function"&&(s=new s),this.formats_.push(s),this.readAsBuffer_=this.readAsBuffer_||s.getType()==="arraybuffer"}this.projection_=t.projection?Er(t.projection):null,this.dropListenKeys_=null,this.source_=t.source||null,this.target=t.target?t.target:null}handleResult_(t,n){const i=n.target.result,r=this.getMap();let s=this.projection_;s||(s=Sz(),s||(s=r.getView().getProjection()));let o;const a=this.formats_;for(let c=0,u=a.length;c<u;++c){const h=a[c];let d=i;this.readAsBuffer_&&h.getType()!=="arraybuffer"&&(o===void 0&&(o=new TextDecoder().decode(i)),d=o);const p=this.tryReadFeatures_(h,d,{featureProjection:s});if(p&&p.length>0){this.source_&&(this.source_.clear(),this.source_.addFeatures(p)),this.dispatchEvent(new Z5(K5.ADD_FEATURES,t,p,s));break}}}registerListeners_(){const t=this.getMap();if(t){const n=this.target?this.target:t.getViewport();this.dropListenKeys_=[bm(n,$s.DROP,this.handleDrop,this),bm(n,$s.DRAGENTER,this.handleStop,this),bm(n,$s.DRAGOVER,this.handleStop,this),bm(n,$s.DROP,this.handleStop,this)]}}setActive(t){!this.getActive()&&t&&this.registerListeners_(),this.getActive()&&!t&&this.unregisterListeners_(),super.setActive(t)}setMap(t){this.unregisterListeners_(),super.setMap(t),this.getActive()&&this.registerListeners_()}tryReadFeatures_(t,n,i){try{return t.readFeatures(n,i)}catch{return null}}unregisterListeners_(){this.dropListenKeys_&&(this.dropListenKeys_.forEach(vz),this.dropListenKeys_=null)}handleDrop(t){const n=t.dataTransfer.files;for(let i=0,r=n.length;i<r;++i){const s=n.item(i),o=new FileReader;o.addEventListener($s.LOAD,this.handleResult_.bind(this,s)),this.readAsBuffer_?o.readAsArrayBuffer(s):o.readAsText(s)}}handleStop(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"}}class Vs{}z(Vs,"CIRCLE_TO_POLYGON_SIDES",64),z(Vs,"INCHES_PER_METER",39.37),z(Vs,"PRINT_DOTS_PER_INCH",72),z(Vs,"SCREEN_DOTS_PER_INCH",96),z(Vs,"METERS_PER_UNIT",jE);const Xwe=e=>{e.forEach(t=>OR(t))},Ywe=(e,t)=>e.getAllLayers().find(n=>n.get("name")===t),Kwe=(e,t=!1)=>{const n={...e.getProperties()};return delete n.boundedBy,t||delete n[e.getGeometryName()],Object.keys(n).forEach(i=>{const r=n[i];typeof r=="object"&&(r["xsi:nil"]==="true"?n[i]=void 0:r._content_&&(n[i]=r._content_))}),n},Zwe=e=>Mz(e,Vs.CIRCLE_TO_POLYGON_SIDES),Jwe=e=>{if(EC()){let t=0;return e.forEach((n,i)=>{e[i+1]&&(t+=Oz(n,e[i+1]))}),t}return new Rz(e).getLength()},Qwe=e=>EC()?Dz(e,{projection:Er(An.getInstance().state.projection)}):e.getArea(),EC=()=>{const e=Er(An.getInstance().state.projection);return(e==null?void 0:e.getUnits())==="degrees"},Q5=e=>e[0]>-90&&e[0]<90&&e[1]>-180&&e[1]<180;function l(e){return e!=null}function A(e){this.name="DeveloperError",this.message=e;let t;try{throw new Error}catch(n){t=n.stack}this.stack=t}l(Object.create)&&(A.prototype=Object.create(Error.prototype),A.prototype.constructor=A);A.prototype.toString=function(){let e=`${this.name}: ${this.message}`;return l(this.stack)&&(e+=`
${this.stack.toString()}`),e};A.throwInstantiationError=function(){throw new A("This function defines an interface and should not be called directly.")};const y={};y.typeOf={};function eH(e){return`${e} is required, actual value was undefined`}function Sh(e,t,n){return`Expected ${n} to be typeof ${t}, actual typeof was ${e}`}y.defined=function(e,t){if(!l(t))throw new A(eH(e))};y.typeOf.func=function(e,t){if(typeof t!="function")throw new A(Sh(typeof t,"function",e))};y.typeOf.string=function(e,t){if(typeof t!="string")throw new A(Sh(typeof t,"string",e))};y.typeOf.number=function(e,t){if(typeof t!="number")throw new A(Sh(typeof t,"number",e))};y.typeOf.number.lessThan=function(e,t,n){if(y.typeOf.number(e,t),t>=n)throw new A(`Expected ${e} to be less than ${n}, actual value was ${t}`)};y.typeOf.number.lessThanOrEquals=function(e,t,n){if(y.typeOf.number(e,t),t>n)throw new A(`Expected ${e} to be less than or equal to ${n}, actual value was ${t}`)};y.typeOf.number.greaterThan=function(e,t,n){if(y.typeOf.number(e,t),t<=n)throw new A(`Expected ${e} to be greater than ${n}, actual value was ${t}`)};y.typeOf.number.greaterThanOrEquals=function(e,t,n){if(y.typeOf.number(e,t),t<n)throw new A(`Expected ${e} to be greater than or equal to ${n}, actual value was ${t}`)};y.typeOf.object=function(e,t){if(typeof t!="object")throw new A(Sh(typeof t,"object",e))};y.typeOf.bool=function(e,t){if(typeof t!="boolean")throw new A(Sh(typeof t,"boolean",e))};y.typeOf.bigint=function(e,t){if(typeof t!="bigint")throw new A(Sh(typeof t,"bigint",e))};y.typeOf.number.equals=function(e,t,n,i){if(y.typeOf.number(e,n),y.typeOf.number(t,i),n!==i)throw new A(`${e} must be equal to ${t}, the actual values are ${n} and ${i}`)};function T(e,t){return e??t}T.EMPTY_OBJECT=Object.freeze({});var fc=function(e){e==null&&(e=new Date().getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,e.constructor==Array?this.init_by_array(e,e.length):this.init_seed(e)};fc.prototype.init_seed=function(e){for(this.mt[0]=e>>>0,this.mti=1;this.mti<this.N;this.mti++){var e=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(((e&4294901760)>>>16)*1812433253<<16)+(e&65535)*1812433253+this.mti,this.mt[this.mti]>>>=0}};fc.prototype.init_by_array=function(e,t){var n,i,r;for(this.init_seed(19650218),n=1,i=0,r=this.N>t?this.N:t;r;r--){var s=this.mt[n-1]^this.mt[n-1]>>>30;this.mt[n]=(this.mt[n]^(((s&4294901760)>>>16)*1664525<<16)+(s&65535)*1664525)+e[i]+i,this.mt[n]>>>=0,n++,i++,n>=this.N&&(this.mt[0]=this.mt[this.N-1],n=1),i>=t&&(i=0)}for(r=this.N-1;r;r--){var s=this.mt[n-1]^this.mt[n-1]>>>30;this.mt[n]=(this.mt[n]^(((s&4294901760)>>>16)*1566083941<<16)+(s&65535)*1566083941)-n,this.mt[n]>>>=0,n++,n>=this.N&&(this.mt[0]=this.mt[this.N-1],n=1)}this.mt[0]=2147483648};fc.prototype.random_int=function(){var e,t=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var n;for(this.mti==this.N+1&&this.init_seed(5489),n=0;n<this.N-this.M;n++)e=this.mt[n]&this.UPPER_MASK|this.mt[n+1]&this.LOWER_MASK,this.mt[n]=this.mt[n+this.M]^e>>>1^t[e&1];for(;n<this.N-1;n++)e=this.mt[n]&this.UPPER_MASK|this.mt[n+1]&this.LOWER_MASK,this.mt[n]=this.mt[n+(this.M-this.N)]^e>>>1^t[e&1];e=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^e>>>1^t[e&1],this.mti=0}return e=this.mt[this.mti++],e^=e>>>11,e^=e<<7&2636928640,e^=e<<15&4022730752,e^=e>>>18,e>>>0};fc.prototype.random_int31=function(){return this.random_int()>>>1};fc.prototype.random_incl=function(){return this.random_int()*(1/4294967295)};fc.prototype.random=function(){return this.random_int()*(1/4294967296)};fc.prototype.random_excl=function(){return(this.random_int()+.5)*(1/4294967296)};fc.prototype.random_long=function(){var e=this.random_int()>>>5,t=this.random_int()>>>6;return(e*67108864+t)*(1/9007199254740992)};var tH=fc;const CC=Th(tH),R={};R.EPSILON1=.1;R.EPSILON2=.01;R.EPSILON3=.001;R.EPSILON4=1e-4;R.EPSILON5=1e-5;R.EPSILON6=1e-6;R.EPSILON7=1e-7;R.EPSILON8=1e-8;R.EPSILON9=1e-9;R.EPSILON10=1e-10;R.EPSILON11=1e-11;R.EPSILON12=1e-12;R.EPSILON13=1e-13;R.EPSILON14=1e-14;R.EPSILON15=1e-15;R.EPSILON16=1e-16;R.EPSILON17=1e-17;R.EPSILON18=1e-18;R.EPSILON19=1e-19;R.EPSILON20=1e-20;R.EPSILON21=1e-21;R.GRAVITATIONALPARAMETER=3986004418e5;R.SOLAR_RADIUS=6955e5;R.LUNAR_RADIUS=1737400;R.SIXTY_FOUR_KILOBYTES=64*1024;R.FOUR_GIGABYTES=4*1024*1024*1024;R.sign=T(Math.sign,function(t){return t=+t,t===0||t!==t?t:t>0?1:-1});R.signNotZero=function(e){return e<0?-1:1};R.toSNorm=function(e,t){return t=T(t,255),Math.round((R.clamp(e,-1,1)*.5+.5)*t)};R.fromSNorm=function(e,t){return t=T(t,255),R.clamp(e,0,t)/t*2-1};R.normalize=function(e,t,n){return n=Math.max(n-t,0),n===0?0:R.clamp((e-t)/n,0,1)};R.sinh=T(Math.sinh,function(t){return(Math.exp(t)-Math.exp(-t))/2});R.cosh=T(Math.cosh,function(t){return(Math.exp(t)+Math.exp(-t))/2});R.lerp=function(e,t,n){return(1-n)*e+n*t};R.PI=Math.PI;R.ONE_OVER_PI=1/Math.PI;R.PI_OVER_TWO=Math.PI/2;R.PI_OVER_THREE=Math.PI/3;R.PI_OVER_FOUR=Math.PI/4;R.PI_OVER_SIX=Math.PI/6;R.THREE_PI_OVER_TWO=3*Math.PI/2;R.TWO_PI=2*Math.PI;R.ONE_OVER_TWO_PI=1/(2*Math.PI);R.RADIANS_PER_DEGREE=Math.PI/180;R.DEGREES_PER_RADIAN=180/Math.PI;R.RADIANS_PER_ARCSECOND=R.RADIANS_PER_DEGREE/3600;R.toRadians=function(e){if(!l(e))throw new A("degrees is required.");return e*R.RADIANS_PER_DEGREE};R.toDegrees=function(e){if(!l(e))throw new A("radians is required.");return e*R.DEGREES_PER_RADIAN};R.convertLongitudeRange=function(e){if(!l(e))throw new A("angle is required.");const t=R.TWO_PI,n=e-Math.floor(e/t)*t;return n<-Math.PI?n+t:n>=Math.PI?n-t:n};R.clampToLatitudeRange=function(e){if(!l(e))throw new A("angle is required.");return R.clamp(e,-1*R.PI_OVER_TWO,R.PI_OVER_TWO)};R.negativePiToPi=function(e){if(!l(e))throw new A("angle is required.");return e>=-R.PI&&e<=R.PI?e:R.zeroToTwoPi(e+R.PI)-R.PI};R.zeroToTwoPi=function(e){if(!l(e))throw new A("angle is required.");if(e>=0&&e<=R.TWO_PI)return e;const t=R.mod(e,R.TWO_PI);return Math.abs(t)<R.EPSILON14&&Math.abs(e)>R.EPSILON14?R.TWO_PI:t};R.mod=function(e,t){if(!l(e))throw new A("m is required.");if(!l(t))throw new A("n is required.");if(t===0)throw new A("divisor cannot be 0.");return R.sign(e)===R.sign(t)&&Math.abs(e)<Math.abs(t)?e:(e%t+t)%t};R.equalsEpsilon=function(e,t,n,i){if(!l(e))throw new A("left is required.");if(!l(t))throw new A("right is required.");n=T(n,0),i=T(i,n);const r=Math.abs(e-t);return r<=i||r<=n*Math.max(Math.abs(e),Math.abs(t))};R.lessThan=function(e,t,n){if(!l(e))throw new A("first is required.");if(!l(t))throw new A("second is required.");if(!l(n))throw new A("absoluteEpsilon is required.");return e-t<-n};R.lessThanOrEquals=function(e,t,n){if(!l(e))throw new A("first is required.");if(!l(t))throw new A("second is required.");if(!l(n))throw new A("absoluteEpsilon is required.");return e-t<n};R.greaterThan=function(e,t,n){if(!l(e))throw new A("first is required.");if(!l(t))throw new A("second is required.");if(!l(n))throw new A("absoluteEpsilon is required.");return e-t>n};R.greaterThanOrEquals=function(e,t,n){if(!l(e))throw new A("first is required.");if(!l(t))throw new A("second is required.");if(!l(n))throw new A("absoluteEpsilon is required.");return e-t>-n};const Rm=[1];R.factorial=function(e){if(typeof e!="number"||e<0)throw new A("A number greater than or equal to 0 is required.");const t=Rm.length;if(e>=t){let n=Rm[t-1];for(let i=t;i<=e;i++){const r=n*i;Rm.push(r),n=r}}return Rm[e]};R.incrementWrap=function(e,t,n){if(n=T(n,0),!l(e))throw new A("n is required.");if(t<=n)throw new A("maximumValue must be greater than minimumValue.");return++e,e>t&&(e=n),e};R.isPowerOfTwo=function(e){if(typeof e!="number"||e<0||e>4294967295)throw new A("A number between 0 and (2^32)-1 is required.");return e!==0&&(e&e-1)===0};R.nextPowerOfTwo=function(e){if(typeof e!="number"||e<0||e>2147483648)throw new A("A number between 0 and 2^31 is required.");return--e,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e,e};R.previousPowerOfTwo=function(e){if(typeof e!="number"||e<0||e>4294967295)throw new A("A number between 0 and (2^32)-1 is required.");return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e|=e>>32,e=(e>>>0)-(e>>>1),e};R.clamp=function(e,t,n){return y.typeOf.number("value",e),y.typeOf.number("min",t),y.typeOf.number("max",n),e<t?t:e>n?n:e};let hM=new CC;R.setRandomNumberSeed=function(e){if(!l(e))throw new A("seed is required.");hM=new CC(e)};R.nextRandomNumber=function(){return hM.random()};R.randomBetween=function(e,t){return R.nextRandomNumber()*(t-e)+e};R.acosClamped=function(e){if(!l(e))throw new A("value is required.");return Math.acos(R.clamp(e,-1,1))};R.asinClamped=function(e){if(!l(e))throw new A("value is required.");return Math.asin(R.clamp(e,-1,1))};R.chordLength=function(e,t){if(!l(e))throw new A("angle is required.");if(!l(t))throw new A("radius is required.");return 2*t*Math.sin(e*.5)};R.logBase=function(e,t){if(!l(e))throw new A("number is required.");if(!l(t))throw new A("base is required.");return Math.log(e)/Math.log(t)};R.cbrt=T(Math.cbrt,function(t){const n=Math.pow(Math.abs(t),.3333333333333333);return t<0?-n:n});R.log2=T(Math.log2,function(t){return Math.log(t)*Math.LOG2E});R.fog=function(e,t){const n=e*t;return 1-Math.exp(-(n*n))};R.fastApproximateAtan=function(e){return y.typeOf.number("x",e),e*(-.1784*Math.abs(e)-.0663*e*e+1.0301)};R.fastApproximateAtan2=function(e,t){y.typeOf.number("x",e),y.typeOf.number("y",t);let n,i=Math.abs(e);n=Math.abs(t);const r=Math.max(i,n);n=Math.min(i,n);const s=n/r;if(isNaN(s))throw new A("either x or y must be nonzero");return i=R.fastApproximateAtan(s),i=Math.abs(t)>Math.abs(e)?R.PI_OVER_TWO-i:i,i=e<0?R.PI-i:i,i=t<0?-i:i,i};function m(e,t,n){this.x=T(e,0),this.y=T(t,0),this.z=T(n,0)}m.fromSpherical=function(e,t){y.typeOf.object("spherical",e),l(t)||(t=new m);const n=e.clock,i=e.cone,r=T(e.magnitude,1),s=r*Math.sin(i);return t.x=s*Math.cos(n),t.y=s*Math.sin(n),t.z=r*Math.cos(i),t};m.fromElements=function(e,t,n,i){return l(i)?(i.x=e,i.y=t,i.z=n,i):new m(e,t,n)};m.clone=function(e,t){if(l(e))return l(t)?(t.x=e.x,t.y=e.y,t.z=e.z,t):new m(e.x,e.y,e.z)};m.fromCartesian4=m.clone;m.packedLength=3;m.pack=function(e,t,n){return y.typeOf.object("value",e),y.defined("array",t),n=T(n,0),t[n++]=e.x,t[n++]=e.y,t[n]=e.z,t};m.unpack=function(e,t,n){return y.defined("array",e),t=T(t,0),l(n)||(n=new m),n.x=e[t++],n.y=e[t++],n.z=e[t],n};m.packArray=function(e,t){y.defined("array",e);const n=e.length,i=n*3;if(!l(t))t=new Array(i);else{if(!Array.isArray(t)&&t.length!==i)throw new A("If result is a typed array, it must have exactly array.length * 3 elements");t.length!==i&&(t.length=i)}for(let r=0;r<n;++r)m.pack(e[r],t,r*3);return t};m.unpackArray=function(e,t){if(y.defined("array",e),y.typeOf.number.greaterThanOrEquals("array.length",e.length,3),e.length%3!==0)throw new A("array length must be a multiple of 3.");const n=e.length;l(t)?t.length=n/3:t=new Array(n/3);for(let i=0;i<n;i+=3){const r=i/3;t[r]=m.unpack(e,i,t[r])}return t};m.fromArray=m.unpack;m.maximumComponent=function(e){return y.typeOf.object("cartesian",e),Math.max(e.x,e.y,e.z)};m.minimumComponent=function(e){return y.typeOf.object("cartesian",e),Math.min(e.x,e.y,e.z)};m.minimumByComponent=function(e,t,n){return y.typeOf.object("first",e),y.typeOf.object("second",t),y.typeOf.object("result",n),n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y),n.z=Math.min(e.z,t.z),n};m.maximumByComponent=function(e,t,n){return y.typeOf.object("first",e),y.typeOf.object("second",t),y.typeOf.object("result",n),n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y),n.z=Math.max(e.z,t.z),n};m.clamp=function(e,t,n,i){y.typeOf.object("value",e),y.typeOf.object("min",t),y.typeOf.object("max",n),y.typeOf.object("result",i);const r=R.clamp(e.x,t.x,n.x),s=R.clamp(e.y,t.y,n.y),o=R.clamp(e.z,t.z,n.z);return i.x=r,i.y=s,i.z=o,i};m.magnitudeSquared=function(e){return y.typeOf.object("cartesian",e),e.x*e.x+e.y*e.y+e.z*e.z};m.magnitude=function(e){return Math.sqrt(m.magnitudeSquared(e))};const N_=new m;m.distance=function(e,t){return y.typeOf.object("left",e),y.typeOf.object("right",t),m.subtract(e,t,N_),m.magnitude(N_)};m.distanceSquared=function(e,t){return y.typeOf.object("left",e),y.typeOf.object("right",t),m.subtract(e,t,N_),m.magnitudeSquared(N_)};m.normalize=function(e,t){y.typeOf.object("cartesian",e),y.typeOf.object("result",t);const n=m.magnitude(e);if(t.x=e.x/n,t.y=e.y/n,t.z=e.z/n,isNaN(t.x)||isNaN(t.y)||isNaN(t.z))throw new A("normalized result is not a number");return t};m.dot=function(e,t){return y.typeOf.object("left",e),y.typeOf.object("right",t),e.x*t.x+e.y*t.y+e.z*t.z};m.multiplyComponents=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n.x=e.x*t.x,n.y=e.y*t.y,n.z=e.z*t.z,n};m.divideComponents=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n.x=e.x/t.x,n.y=e.y/t.y,n.z=e.z/t.z,n};m.add=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z,n};m.subtract=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z,n};m.multiplyByScalar=function(e,t,n){return y.typeOf.object("cartesian",e),y.typeOf.number("scalar",t),y.typeOf.object("result",n),n.x=e.x*t,n.y=e.y*t,n.z=e.z*t,n};m.divideByScalar=function(e,t,n){return y.typeOf.object("cartesian",e),y.typeOf.number("scalar",t),y.typeOf.object("result",n),n.x=e.x/t,n.y=e.y/t,n.z=e.z/t,n};m.negate=function(e,t){return y.typeOf.object("cartesian",e),y.typeOf.object("result",t),t.x=-e.x,t.y=-e.y,t.z=-e.z,t};m.abs=function(e,t){return y.typeOf.object("cartesian",e),y.typeOf.object("result",t),t.x=Math.abs(e.x),t.y=Math.abs(e.y),t.z=Math.abs(e.z),t};const ev=new m;m.lerp=function(e,t,n,i){return y.typeOf.object("start",e),y.typeOf.object("end",t),y.typeOf.number("t",n),y.typeOf.object("result",i),m.multiplyByScalar(t,n,ev),i=m.multiplyByScalar(e,1-n,i),m.add(ev,i,i)};const Dm=new m,Xb=new m;m.angleBetween=function(e,t){y.typeOf.object("left",e),y.typeOf.object("right",t),m.normalize(e,Dm),m.normalize(t,Xb);const n=m.dot(Dm,Xb),i=m.magnitude(m.cross(Dm,Xb,Dm));return Math.atan2(i,n)};const nH=new m;m.mostOrthogonalAxis=function(e,t){y.typeOf.object("cartesian",e),y.typeOf.object("result",t);const n=m.normalize(e,nH);return m.abs(n,n),n.x<=n.y?n.x<=n.z?t=m.clone(m.UNIT_X,t):t=m.clone(m.UNIT_Z,t):n.y<=n.z?t=m.clone(m.UNIT_Y,t):t=m.clone(m.UNIT_Z,t),t};m.projectVector=function(e,t,n){y.defined("a",e),y.defined("b",t),y.defined("result",n);const i=m.dot(e,t)/m.dot(t,t);return m.multiplyByScalar(t,i,n)};m.equals=function(e,t){return e===t||l(e)&&l(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z};m.equalsArray=function(e,t,n){return e.x===t[n]&&e.y===t[n+1]&&e.z===t[n+2]};m.equalsEpsilon=function(e,t,n,i){return e===t||l(e)&&l(t)&&R.equalsEpsilon(e.x,t.x,n,i)&&R.equalsEpsilon(e.y,t.y,n,i)&&R.equalsEpsilon(e.z,t.z,n,i)};m.cross=function(e,t,n){y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n);const i=e.x,r=e.y,s=e.z,o=t.x,a=t.y,c=t.z,u=r*c-s*a,h=s*o-i*c,d=i*a-r*o;return n.x=u,n.y=h,n.z=d,n};m.midpoint=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n.x=(e.x+t.x)*.5,n.y=(e.y+t.y)*.5,n.z=(e.z+t.z)*.5,n};m.fromDegrees=function(e,t,n,i,r){return y.typeOf.number("longitude",e),y.typeOf.number("latitude",t),e=R.toRadians(e),t=R.toRadians(t),m.fromRadians(e,t,n,i,r)};let Os=new m,Wu=new m;m._ellipsoidRadiiSquared=new m(6378137*6378137,6378137*6378137,6356752314245179e-9*6356752314245179e-9);m.fromRadians=function(e,t,n,i,r){y.typeOf.number("longitude",e),y.typeOf.number("latitude",t),n=T(n,0);const s=l(i)?i.radiiSquared:m._ellipsoidRadiiSquared,o=Math.cos(t);Os.x=o*Math.cos(e),Os.y=o*Math.sin(e),Os.z=Math.sin(t),Os=m.normalize(Os,Os),m.multiplyComponents(s,Os,Wu);const a=Math.sqrt(m.dot(Os,Wu));return Wu=m.divideByScalar(Wu,a,Wu),Os=m.multiplyByScalar(Os,n,Os),l(r)||(r=new m),m.add(Wu,Os,r)};m.fromDegreesArray=function(e,t,n){if(y.defined("coordinates",e),e.length<2||e.length%2!==0)throw new A("the number of coordinates must be a multiple of 2 and at least 2");const i=e.length;l(n)?n.length=i/2:n=new Array(i/2);for(let r=0;r<i;r+=2){const s=e[r],o=e[r+1],a=r/2;n[a]=m.fromDegrees(s,o,0,t,n[a])}return n};m.fromRadiansArray=function(e,t,n){if(y.defined("coordinates",e),e.length<2||e.length%2!==0)throw new A("the number of coordinates must be a multiple of 2 and at least 2");const i=e.length;l(n)?n.length=i/2:n=new Array(i/2);for(let r=0;r<i;r+=2){const s=e[r],o=e[r+1],a=r/2;n[a]=m.fromRadians(s,o,0,t,n[a])}return n};m.fromDegreesArrayHeights=function(e,t,n){if(y.defined("coordinates",e),e.length<3||e.length%3!==0)throw new A("the number of coordinates must be a multiple of 3 and at least 3");const i=e.length;l(n)?n.length=i/3:n=new Array(i/3);for(let r=0;r<i;r+=3){const s=e[r],o=e[r+1],a=e[r+2],c=r/3;n[c]=m.fromDegrees(s,o,a,t,n[c])}return n};m.fromRadiansArrayHeights=function(e,t,n){if(y.defined("coordinates",e),e.length<3||e.length%3!==0)throw new A("the number of coordinates must be a multiple of 3 and at least 3");const i=e.length;l(n)?n.length=i/3:n=new Array(i/3);for(let r=0;r<i;r+=3){const s=e[r],o=e[r+1],a=e[r+2],c=r/3;n[c]=m.fromRadians(s,o,a,t,n[c])}return n};m.ZERO=Object.freeze(new m(0,0,0));m.ONE=Object.freeze(new m(1,1,1));m.UNIT_X=Object.freeze(new m(1,0,0));m.UNIT_Y=Object.freeze(new m(0,1,0));m.UNIT_Z=Object.freeze(new m(0,0,1));m.prototype.clone=function(e){return m.clone(this,e)};m.prototype.equals=function(e){return m.equals(this,e)};m.prototype.equalsEpsilon=function(e,t,n){return m.equalsEpsilon(this,e,t,n)};m.prototype.toString=function(){return`(${this.x}, ${this.y}, ${this.z})`};const iH=new m,rH=new m;function dM(e,t,n,i,r){if(!l(e))throw new A("cartesian is required.");if(!l(t))throw new A("oneOverRadii is required.");if(!l(n))throw new A("oneOverRadiiSquared is required.");if(!l(i))throw new A("centerToleranceSquared is required.");const s=e.x,o=e.y,a=e.z,c=t.x,u=t.y,h=t.z,d=s*s*c*c,p=o*o*u*u,g=a*a*h*h,_=d+p+g,b=Math.sqrt(1/_),x=m.multiplyByScalar(e,b,iH);if(_<i)return isFinite(b)?m.clone(x,r):void 0;const E=n.x,C=n.y,w=n.z,S=rH;S.x=x.x*E*2,S.y=x.y*C*2,S.z=x.z*w*2;let v=(1-b)*m.magnitude(e)/(.5*m.magnitude(S)),D=0,L,O,N,B,U,V,f,I,F,G,W;do{v-=D,N=1/(1+v*E),B=1/(1+v*C),U=1/(1+v*w),V=N*N,f=B*B,I=U*U,F=V*N,G=f*B,W=I*U,L=d*V+p*f+g*I-1,O=d*F*E+p*G*C+g*W*w;const X=-2*O;D=L/X}while(Math.abs(L)>R.EPSILON12);return l(r)?(r.x=s*N,r.y=o*B,r.z=a*U,r):new m(s*N,o*B,a*U)}function oe(e,t,n){this.longitude=T(e,0),this.latitude=T(t,0),this.height=T(n,0)}oe.fromRadians=function(e,t,n,i){return y.typeOf.number("longitude",e),y.typeOf.number("latitude",t),n=T(n,0),l(i)?(i.longitude=e,i.latitude=t,i.height=n,i):new oe(e,t,n)};oe.fromDegrees=function(e,t,n,i){return y.typeOf.number("longitude",e),y.typeOf.number("latitude",t),e=R.toRadians(e),t=R.toRadians(t),oe.fromRadians(e,t,n,i)};const sH=new m,oH=new m,aH=new m;oe._ellipsoidOneOverRadii=new m(1/6378137,1/6378137,1/6356752314245179e-9);oe._ellipsoidOneOverRadiiSquared=new m(1/(6378137*6378137),1/(6378137*6378137),1/(6356752314245179e-9*6356752314245179e-9));oe._ellipsoidCenterToleranceSquared=R.EPSILON1;oe.fromCartesian=function(e,t,n){const i=l(t)?t.oneOverRadii:oe._ellipsoidOneOverRadii,r=l(t)?t.oneOverRadiiSquared:oe._ellipsoidOneOverRadiiSquared,s=l(t)?t._centerToleranceSquared:oe._ellipsoidCenterToleranceSquared,o=dM(e,i,r,s,oH);if(!l(o))return;let a=m.multiplyComponents(o,r,sH);a=m.normalize(a,a);const c=m.subtract(e,o,aH),u=Math.atan2(a.y,a.x),h=Math.asin(a.z),d=R.sign(m.dot(c,e))*m.magnitude(c);return l(n)?(n.longitude=u,n.latitude=h,n.height=d,n):new oe(u,h,d)};oe.toCartesian=function(e,t,n){return y.defined("cartographic",e),m.fromRadians(e.longitude,e.latitude,e.height,t,n)};oe.clone=function(e,t){if(l(e))return l(t)?(t.longitude=e.longitude,t.latitude=e.latitude,t.height=e.height,t):new oe(e.longitude,e.latitude,e.height)};oe.equals=function(e,t){return e===t||l(e)&&l(t)&&e.longitude===t.longitude&&e.latitude===t.latitude&&e.height===t.height};oe.equalsEpsilon=function(e,t,n){return n=T(n,0),e===t||l(e)&&l(t)&&Math.abs(e.longitude-t.longitude)<=n&&Math.abs(e.latitude-t.latitude)<=n&&Math.abs(e.height-t.height)<=n};oe.ZERO=Object.freeze(new oe(0,0,0));oe.prototype.clone=function(e){return oe.clone(this,e)};oe.prototype.equals=function(e){return oe.equals(this,e)};oe.prototype.equalsEpsilon=function(e,t){return oe.equalsEpsilon(this,e,t)};oe.prototype.toString=function(){return`(${this.longitude}, ${this.latitude}, ${this.height})`};function k(e,t){this.x=T(e,0),this.y=T(t,0)}k.fromElements=function(e,t,n){return l(n)?(n.x=e,n.y=t,n):new k(e,t)};k.clone=function(e,t){if(l(e))return l(t)?(t.x=e.x,t.y=e.y,t):new k(e.x,e.y)};k.fromCartesian3=k.clone;k.fromCartesian4=k.clone;k.packedLength=2;k.pack=function(e,t,n){return y.typeOf.object("value",e),y.defined("array",t),n=T(n,0),t[n++]=e.x,t[n]=e.y,t};k.unpack=function(e,t,n){return y.defined("array",e),t=T(t,0),l(n)||(n=new k),n.x=e[t++],n.y=e[t],n};k.packArray=function(e,t){y.defined("array",e);const n=e.length,i=n*2;if(!l(t))t=new Array(i);else{if(!Array.isArray(t)&&t.length!==i)throw new A("If result is a typed array, it must have exactly array.length * 2 elements");t.length!==i&&(t.length=i)}for(let r=0;r<n;++r)k.pack(e[r],t,r*2);return t};k.unpackArray=function(e,t){if(y.defined("array",e),y.typeOf.number.greaterThanOrEquals("array.length",e.length,2),e.length%2!==0)throw new A("array length must be a multiple of 2.");const n=e.length;l(t)?t.length=n/2:t=new Array(n/2);for(let i=0;i<n;i+=2){const r=i/2;t[r]=k.unpack(e,i,t[r])}return t};k.fromArray=k.unpack;k.maximumComponent=function(e){return y.typeOf.object("cartesian",e),Math.max(e.x,e.y)};k.minimumComponent=function(e){return y.typeOf.object("cartesian",e),Math.min(e.x,e.y)};k.minimumByComponent=function(e,t,n){return y.typeOf.object("first",e),y.typeOf.object("second",t),y.typeOf.object("result",n),n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y),n};k.maximumByComponent=function(e,t,n){return y.typeOf.object("first",e),y.typeOf.object("second",t),y.typeOf.object("result",n),n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y),n};k.clamp=function(e,t,n,i){y.typeOf.object("value",e),y.typeOf.object("min",t),y.typeOf.object("max",n),y.typeOf.object("result",i);const r=R.clamp(e.x,t.x,n.x),s=R.clamp(e.y,t.y,n.y);return i.x=r,i.y=s,i};k.magnitudeSquared=function(e){return y.typeOf.object("cartesian",e),e.x*e.x+e.y*e.y};k.magnitude=function(e){return Math.sqrt(k.magnitudeSquared(e))};const F_=new k;k.distance=function(e,t){return y.typeOf.object("left",e),y.typeOf.object("right",t),k.subtract(e,t,F_),k.magnitude(F_)};k.distanceSquared=function(e,t){return y.typeOf.object("left",e),y.typeOf.object("right",t),k.subtract(e,t,F_),k.magnitudeSquared(F_)};k.normalize=function(e,t){y.typeOf.object("cartesian",e),y.typeOf.object("result",t);const n=k.magnitude(e);if(t.x=e.x/n,t.y=e.y/n,isNaN(t.x)||isNaN(t.y))throw new A("normalized result is not a number");return t};k.dot=function(e,t){return y.typeOf.object("left",e),y.typeOf.object("right",t),e.x*t.x+e.y*t.y};k.cross=function(e,t){return y.typeOf.object("left",e),y.typeOf.object("right",t),e.x*t.y-e.y*t.x};k.multiplyComponents=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n.x=e.x*t.x,n.y=e.y*t.y,n};k.divideComponents=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n.x=e.x/t.x,n.y=e.y/t.y,n};k.add=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n.x=e.x+t.x,n.y=e.y+t.y,n};k.subtract=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n.x=e.x-t.x,n.y=e.y-t.y,n};k.multiplyByScalar=function(e,t,n){return y.typeOf.object("cartesian",e),y.typeOf.number("scalar",t),y.typeOf.object("result",n),n.x=e.x*t,n.y=e.y*t,n};k.divideByScalar=function(e,t,n){return y.typeOf.object("cartesian",e),y.typeOf.number("scalar",t),y.typeOf.object("result",n),n.x=e.x/t,n.y=e.y/t,n};k.negate=function(e,t){return y.typeOf.object("cartesian",e),y.typeOf.object("result",t),t.x=-e.x,t.y=-e.y,t};k.abs=function(e,t){return y.typeOf.object("cartesian",e),y.typeOf.object("result",t),t.x=Math.abs(e.x),t.y=Math.abs(e.y),t};const tv=new k;k.lerp=function(e,t,n,i){return y.typeOf.object("start",e),y.typeOf.object("end",t),y.typeOf.number("t",n),y.typeOf.object("result",i),k.multiplyByScalar(t,n,tv),i=k.multiplyByScalar(e,1-n,i),k.add(tv,i,i)};const nv=new k,iv=new k;k.angleBetween=function(e,t){return y.typeOf.object("left",e),y.typeOf.object("right",t),k.normalize(e,nv),k.normalize(t,iv),R.acosClamped(k.dot(nv,iv))};const cH=new k;k.mostOrthogonalAxis=function(e,t){y.typeOf.object("cartesian",e),y.typeOf.object("result",t);const n=k.normalize(e,cH);return k.abs(n,n),n.x<=n.y?t=k.clone(k.UNIT_X,t):t=k.clone(k.UNIT_Y,t),t};k.equals=function(e,t){return e===t||l(e)&&l(t)&&e.x===t.x&&e.y===t.y};k.equalsArray=function(e,t,n){return e.x===t[n]&&e.y===t[n+1]};k.equalsEpsilon=function(e,t,n,i){return e===t||l(e)&&l(t)&&R.equalsEpsilon(e.x,t.x,n,i)&&R.equalsEpsilon(e.y,t.y,n,i)};k.ZERO=Object.freeze(new k(0,0));k.ONE=Object.freeze(new k(1,1));k.UNIT_X=Object.freeze(new k(1,0));k.UNIT_Y=Object.freeze(new k(0,1));k.prototype.clone=function(e){return k.clone(this,e)};k.prototype.equals=function(e){return k.equals(this,e)};k.prototype.equalsEpsilon=function(e,t,n){return k.equalsEpsilon(this,e,t,n)};k.prototype.toString=function(){return`(${this.x}, ${this.y})`};function pM(e,t,n,i){t=T(t,0),n=T(n,0),i=T(i,0),y.typeOf.number.greaterThanOrEquals("x",t,0),y.typeOf.number.greaterThanOrEquals("y",n,0),y.typeOf.number.greaterThanOrEquals("z",i,0),e._radii=new m(t,n,i),e._radiiSquared=new m(t*t,n*n,i*i),e._radiiToTheFourth=new m(t*t*t*t,n*n*n*n,i*i*i*i),e._oneOverRadii=new m(t===0?0:1/t,n===0?0:1/n,i===0?0:1/i),e._oneOverRadiiSquared=new m(t===0?0:1/(t*t),n===0?0:1/(n*n),i===0?0:1/(i*i)),e._minimumRadius=Math.min(t,n,i),e._maximumRadius=Math.max(t,n,i),e._centerToleranceSquared=R.EPSILON1,e._radiiSquared.z!==0&&(e._squaredXOverSquaredZ=e._radiiSquared.x/e._radiiSquared.z)}function fe(e,t,n){this._radii=void 0,this._radiiSquared=void 0,this._radiiToTheFourth=void 0,this._oneOverRadii=void 0,this._oneOverRadiiSquared=void 0,this._minimumRadius=void 0,this._maximumRadius=void 0,this._centerToleranceSquared=void 0,this._squaredXOverSquaredZ=void 0,pM(this,e,t,n)}Object.defineProperties(fe.prototype,{radii:{get:function(){return this._radii}},radiiSquared:{get:function(){return this._radiiSquared}},radiiToTheFourth:{get:function(){return this._radiiToTheFourth}},oneOverRadii:{get:function(){return this._oneOverRadii}},oneOverRadiiSquared:{get:function(){return this._oneOverRadiiSquared}},minimumRadius:{get:function(){return this._minimumRadius}},maximumRadius:{get:function(){return this._maximumRadius}}});fe.clone=function(e,t){if(!l(e))return;const n=e._radii;return l(t)?(m.clone(n,t._radii),m.clone(e._radiiSquared,t._radiiSquared),m.clone(e._radiiToTheFourth,t._radiiToTheFourth),m.clone(e._oneOverRadii,t._oneOverRadii),m.clone(e._oneOverRadiiSquared,t._oneOverRadiiSquared),t._minimumRadius=e._minimumRadius,t._maximumRadius=e._maximumRadius,t._centerToleranceSquared=e._centerToleranceSquared,t):new fe(n.x,n.y,n.z)};fe.fromCartesian3=function(e,t){return l(t)||(t=new fe),l(e)&&pM(t,e.x,e.y,e.z),t};fe.WGS84=Object.freeze(new fe(6378137,6378137,6356752314245179e-9));fe.UNIT_SPHERE=Object.freeze(new fe(1,1,1));fe.MOON=Object.freeze(new fe(R.LUNAR_RADIUS,R.LUNAR_RADIUS,R.LUNAR_RADIUS));fe._default=fe.WGS84;Object.defineProperties(fe,{default:{get:function(){return fe._default},set:function(e){y.typeOf.object("value",e),fe._default=e,m._ellipsoidRadiiSquared=e.radiiSquared,oe._ellipsoidOneOverRadii=e.oneOverRadii,oe._ellipsoidOneOverRadiiSquared=e.oneOverRadiiSquared,oe._ellipsoidCenterToleranceSquared=e._centerToleranceSquared}}});fe.prototype.clone=function(e){return fe.clone(this,e)};fe.packedLength=m.packedLength;fe.pack=function(e,t,n){return y.typeOf.object("value",e),y.defined("array",t),n=T(n,0),m.pack(e._radii,t,n),t};fe.unpack=function(e,t,n){y.defined("array",e),t=T(t,0);const i=m.unpack(e,t);return fe.fromCartesian3(i,n)};fe.prototype.geocentricSurfaceNormal=m.normalize;fe.prototype.geodeticSurfaceNormalCartographic=function(e,t){y.typeOf.object("cartographic",e);const n=e.longitude,i=e.latitude,r=Math.cos(i),s=r*Math.cos(n),o=r*Math.sin(n),a=Math.sin(i);return l(t)||(t=new m),t.x=s,t.y=o,t.z=a,m.normalize(t,t)};fe.prototype.geodeticSurfaceNormal=function(e,t){if(y.typeOf.object("cartesian",e),isNaN(e.x)||isNaN(e.y)||isNaN(e.z))throw new A("cartesian has a NaN component");if(!m.equalsEpsilon(e,m.ZERO,R.EPSILON14))return l(t)||(t=new m),t=m.multiplyComponents(e,this._oneOverRadiiSquared,t),m.normalize(t,t)};const lH=new m,uH=new m;fe.prototype.cartographicToCartesian=function(e,t){const n=lH,i=uH;this.geodeticSurfaceNormalCartographic(e,n),m.multiplyComponents(this._radiiSquared,n,i);const r=Math.sqrt(m.dot(n,i));return m.divideByScalar(i,r,i),m.multiplyByScalar(n,e.height,n),l(t)||(t=new m),m.add(i,n,t)};fe.prototype.cartographicArrayToCartesianArray=function(e,t){y.defined("cartographics",e);const n=e.length;l(t)?t.length=n:t=new Array(n);for(let i=0;i<n;i++)t[i]=this.cartographicToCartesian(e[i],t[i]);return t};const fH=new m,hH=new m,dH=new m;fe.prototype.cartesianToCartographic=function(e,t){const n=this.scaleToGeodeticSurface(e,hH);if(!l(n))return;const i=this.geodeticSurfaceNormal(n,fH),r=m.subtract(e,n,dH),s=Math.atan2(i.y,i.x),o=Math.asin(i.z),a=R.sign(m.dot(r,e))*m.magnitude(r);return l(t)?(t.longitude=s,t.latitude=o,t.height=a,t):new oe(s,o,a)};fe.prototype.cartesianArrayToCartographicArray=function(e,t){y.defined("cartesians",e);const n=e.length;l(t)?t.length=n:t=new Array(n);for(let i=0;i<n;++i)t[i]=this.cartesianToCartographic(e[i],t[i]);return t};fe.prototype.scaleToGeodeticSurface=function(e,t){return dM(e,this._oneOverRadii,this._oneOverRadiiSquared,this._centerToleranceSquared,t)};fe.prototype.scaleToGeocentricSurface=function(e,t){y.typeOf.object("cartesian",e),l(t)||(t=new m);const n=e.x,i=e.y,r=e.z,s=this._oneOverRadiiSquared,o=1/Math.sqrt(n*n*s.x+i*i*s.y+r*r*s.z);return m.multiplyByScalar(e,o,t)};fe.prototype.transformPositionToScaledSpace=function(e,t){return l(t)||(t=new m),m.multiplyComponents(e,this._oneOverRadii,t)};fe.prototype.transformPositionFromScaledSpace=function(e,t){return l(t)||(t=new m),m.multiplyComponents(e,this._radii,t)};fe.prototype.equals=function(e){return this===e||l(e)&&m.equals(this._radii,e._radii)};fe.prototype.toString=function(){return this._radii.toString()};fe.prototype.getSurfaceNormalIntersectionWithZAxis=function(e,t,n){if(y.typeOf.object("position",e),!R.equalsEpsilon(this._radii.x,this._radii.y,R.EPSILON15))throw new A("Ellipsoid must be an ellipsoid of revolution (radii.x == radii.y)");y.typeOf.number.greaterThan("Ellipsoid.radii.z",this._radii.z,0),t=T(t,0);const i=this._squaredXOverSquaredZ;if(l(n)||(n=new m),n.x=0,n.y=0,n.z=e.z*(1-i),!(Math.abs(n.z)>=this._radii.z-t))return n};const pH=new m;fe.prototype.getLocalCurvature=function(e,t){y.typeOf.object("surfacePosition",e),l(t)||(t=new k);const n=this.getSurfaceNormalIntersectionWithZAxis(e,0,pH),i=m.distance(e,n),r=this.minimumRadius*i/this.maximumRadius**2,s=i*r**2;return k.fromElements(1/i,1/s,t)};const mH=[.14887433898163,.43339539412925,.67940956829902,.86506336668898,.97390652851717,0],gH=[.29552422471475,.26926671930999,.21908636251598,.14945134915058,.066671344308684,0];function rv(e,t,n){y.typeOf.number("a",e),y.typeOf.number("b",t),y.typeOf.func("func",n);const i=.5*(t+e),r=.5*(t-e);let s=0;for(let o=0;o<5;o++){const a=r*mH[o];s+=gH[o]*(n(i+a)+n(i-a))}return s*=r,s}fe.prototype.surfaceArea=function(e){y.typeOf.object("rectangle",e);const t=e.west;let n=e.east;const i=e.south,r=e.north;for(;n<t;)n+=R.TWO_PI;const s=this._radiiSquared,o=s.x,a=s.y,c=s.z,u=o*a;return rv(i,r,function(h){const d=Math.cos(h),p=Math.sin(h);return Math.cos(h)*rv(t,n,function(g){const _=Math.cos(g),b=Math.sin(g);return Math.sqrt(u*p*p+c*(a*_*_+o*b*b)*d*d)})})};function ur(e){this._ellipsoid=T(e,fe.default),this._semimajorAxis=this._ellipsoid.maximumRadius,this._oneOverSemimajorAxis=1/this._semimajorAxis}Object.defineProperties(ur.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});ur.prototype.project=function(e,t){const n=this._semimajorAxis,i=e.longitude*n,r=e.latitude*n,s=e.height;return l(t)?(t.x=i,t.y=r,t.z=s,t):new m(i,r,s)};ur.prototype.unproject=function(e,t){if(!l(e))throw new A("cartesian is required");const n=this._oneOverSemimajorAxis,i=e.x*n,r=e.y*n,s=e.z;return l(t)?(t.longitude=i,t.latitude=r,t.height=s,t):new oe(i,r,s)};const _H={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},ut=Object.freeze(_H);function Kc(e,t){this.start=T(e,0),this.stop=T(t,0)}function H(e,t,n,i,r,s,o,a,c){this[0]=T(e,0),this[1]=T(i,0),this[2]=T(o,0),this[3]=T(t,0),this[4]=T(r,0),this[5]=T(a,0),this[6]=T(n,0),this[7]=T(s,0),this[8]=T(c,0)}H.packedLength=9;H.pack=function(e,t,n){return y.typeOf.object("value",e),y.defined("array",t),n=T(n,0),t[n++]=e[0],t[n++]=e[1],t[n++]=e[2],t[n++]=e[3],t[n++]=e[4],t[n++]=e[5],t[n++]=e[6],t[n++]=e[7],t[n++]=e[8],t};H.unpack=function(e,t,n){return y.defined("array",e),t=T(t,0),l(n)||(n=new H),n[0]=e[t++],n[1]=e[t++],n[2]=e[t++],n[3]=e[t++],n[4]=e[t++],n[5]=e[t++],n[6]=e[t++],n[7]=e[t++],n[8]=e[t++],n};H.packArray=function(e,t){y.defined("array",e);const n=e.length,i=n*9;if(!l(t))t=new Array(i);else{if(!Array.isArray(t)&&t.length!==i)throw new A("If result is a typed array, it must have exactly array.length * 9 elements");t.length!==i&&(t.length=i)}for(let r=0;r<n;++r)H.pack(e[r],t,r*9);return t};H.unpackArray=function(e,t){if(y.defined("array",e),y.typeOf.number.greaterThanOrEquals("array.length",e.length,9),e.length%9!==0)throw new A("array length must be a multiple of 9.");const n=e.length;l(t)?t.length=n/9:t=new Array(n/9);for(let i=0;i<n;i+=9){const r=i/9;t[r]=H.unpack(e,i,t[r])}return t};H.clone=function(e,t){if(l(e))return l(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t):new H(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])};H.fromArray=H.unpack;H.fromColumnMajorArray=function(e,t){return y.defined("values",e),H.clone(e,t)};H.fromRowMajorArray=function(e,t){return y.defined("values",e),l(t)?(t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t):new H(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])};H.fromQuaternion=function(e,t){y.typeOf.object("quaternion",e);const n=e.x*e.x,i=e.x*e.y,r=e.x*e.z,s=e.x*e.w,o=e.y*e.y,a=e.y*e.z,c=e.y*e.w,u=e.z*e.z,h=e.z*e.w,d=e.w*e.w,p=n-o-u+d,g=2*(i-h),_=2*(r+c),b=2*(i+h),x=-n+o-u+d,E=2*(a-s),C=2*(r-c),w=2*(a+s),S=-n-o+u+d;return l(t)?(t[0]=p,t[1]=b,t[2]=C,t[3]=g,t[4]=x,t[5]=w,t[6]=_,t[7]=E,t[8]=S,t):new H(p,g,_,b,x,E,C,w,S)};H.fromHeadingPitchRoll=function(e,t){y.typeOf.object("headingPitchRoll",e);const n=Math.cos(-e.pitch),i=Math.cos(-e.heading),r=Math.cos(e.roll),s=Math.sin(-e.pitch),o=Math.sin(-e.heading),a=Math.sin(e.roll),c=n*i,u=-r*o+a*s*i,h=a*o+r*s*i,d=n*o,p=r*i+a*s*o,g=-a*i+r*s*o,_=-s,b=a*n,x=r*n;return l(t)?(t[0]=c,t[1]=d,t[2]=_,t[3]=u,t[4]=p,t[5]=b,t[6]=h,t[7]=g,t[8]=x,t):new H(c,u,h,d,p,g,_,b,x)};H.fromScale=function(e,t){return y.typeOf.object("scale",e),l(t)?(t[0]=e.x,t[1]=0,t[2]=0,t[3]=0,t[4]=e.y,t[5]=0,t[6]=0,t[7]=0,t[8]=e.z,t):new H(e.x,0,0,0,e.y,0,0,0,e.z)};H.fromUniformScale=function(e,t){return y.typeOf.number("scale",e),l(t)?(t[0]=e,t[1]=0,t[2]=0,t[3]=0,t[4]=e,t[5]=0,t[6]=0,t[7]=0,t[8]=e,t):new H(e,0,0,0,e,0,0,0,e)};H.fromCrossProduct=function(e,t){return y.typeOf.object("vector",e),l(t)?(t[0]=0,t[1]=e.z,t[2]=-e.y,t[3]=-e.z,t[4]=0,t[5]=e.x,t[6]=e.y,t[7]=-e.x,t[8]=0,t):new H(0,-e.z,e.y,e.z,0,-e.x,-e.y,e.x,0)};H.fromRotationX=function(e,t){y.typeOf.number("angle",e);const n=Math.cos(e),i=Math.sin(e);return l(t)?(t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=n,t[5]=i,t[6]=0,t[7]=-i,t[8]=n,t):new H(1,0,0,0,n,-i,0,i,n)};H.fromRotationY=function(e,t){y.typeOf.number("angle",e);const n=Math.cos(e),i=Math.sin(e);return l(t)?(t[0]=n,t[1]=0,t[2]=-i,t[3]=0,t[4]=1,t[5]=0,t[6]=i,t[7]=0,t[8]=n,t):new H(n,0,i,0,1,0,-i,0,n)};H.fromRotationZ=function(e,t){y.typeOf.number("angle",e);const n=Math.cos(e),i=Math.sin(e);return l(t)?(t[0]=n,t[1]=i,t[2]=0,t[3]=-i,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t):new H(n,-i,0,i,n,0,0,0,1)};H.toArray=function(e,t){return y.typeOf.object("matrix",e),l(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t):[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]};H.getElementIndex=function(e,t){return y.typeOf.number.greaterThanOrEquals("row",t,0),y.typeOf.number.lessThanOrEquals("row",t,2),y.typeOf.number.greaterThanOrEquals("column",e,0),y.typeOf.number.lessThanOrEquals("column",e,2),e*3+t};H.getColumn=function(e,t,n){y.typeOf.object("matrix",e),y.typeOf.number.greaterThanOrEquals("index",t,0),y.typeOf.number.lessThanOrEquals("index",t,2),y.typeOf.object("result",n);const i=t*3,r=e[i],s=e[i+1],o=e[i+2];return n.x=r,n.y=s,n.z=o,n};H.setColumn=function(e,t,n,i){y.typeOf.object("matrix",e),y.typeOf.number.greaterThanOrEquals("index",t,0),y.typeOf.number.lessThanOrEquals("index",t,2),y.typeOf.object("cartesian",n),y.typeOf.object("result",i),i=H.clone(e,i);const r=t*3;return i[r]=n.x,i[r+1]=n.y,i[r+2]=n.z,i};H.getRow=function(e,t,n){y.typeOf.object("matrix",e),y.typeOf.number.greaterThanOrEquals("index",t,0),y.typeOf.number.lessThanOrEquals("index",t,2),y.typeOf.object("result",n);const i=e[t],r=e[t+3],s=e[t+6];return n.x=i,n.y=r,n.z=s,n};H.setRow=function(e,t,n,i){return y.typeOf.object("matrix",e),y.typeOf.number.greaterThanOrEquals("index",t,0),y.typeOf.number.lessThanOrEquals("index",t,2),y.typeOf.object("cartesian",n),y.typeOf.object("result",i),i=H.clone(e,i),i[t]=n.x,i[t+3]=n.y,i[t+6]=n.z,i};const yH=new m;H.setScale=function(e,t,n){y.typeOf.object("matrix",e),y.typeOf.object("scale",t),y.typeOf.object("result",n);const i=H.getScale(e,yH),r=t.x/i.x,s=t.y/i.y,o=t.z/i.z;return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*s,n[4]=e[4]*s,n[5]=e[5]*s,n[6]=e[6]*o,n[7]=e[7]*o,n[8]=e[8]*o,n};const bH=new m;H.setUniformScale=function(e,t,n){y.typeOf.object("matrix",e),y.typeOf.number("scale",t),y.typeOf.object("result",n);const i=H.getScale(e,bH),r=t/i.x,s=t/i.y,o=t/i.z;return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*s,n[4]=e[4]*s,n[5]=e[5]*s,n[6]=e[6]*o,n[7]=e[7]*o,n[8]=e[8]*o,n};const Yb=new m;H.getScale=function(e,t){return y.typeOf.object("matrix",e),y.typeOf.object("result",t),t.x=m.magnitude(m.fromElements(e[0],e[1],e[2],Yb)),t.y=m.magnitude(m.fromElements(e[3],e[4],e[5],Yb)),t.z=m.magnitude(m.fromElements(e[6],e[7],e[8],Yb)),t};const sv=new m;H.getMaximumScale=function(e){return H.getScale(e,sv),m.maximumComponent(sv)};const TH=new m;H.setRotation=function(e,t,n){y.typeOf.object("matrix",e),y.typeOf.object("result",n);const i=H.getScale(e,TH);return n[0]=t[0]*i.x,n[1]=t[1]*i.x,n[2]=t[2]*i.x,n[3]=t[3]*i.y,n[4]=t[4]*i.y,n[5]=t[5]*i.y,n[6]=t[6]*i.z,n[7]=t[7]*i.z,n[8]=t[8]*i.z,n};const xH=new m;H.getRotation=function(e,t){y.typeOf.object("matrix",e),y.typeOf.object("result",t);const n=H.getScale(e,xH);return t[0]=e[0]/n.x,t[1]=e[1]/n.x,t[2]=e[2]/n.x,t[3]=e[3]/n.y,t[4]=e[4]/n.y,t[5]=e[5]/n.y,t[6]=e[6]/n.z,t[7]=e[7]/n.z,t[8]=e[8]/n.z,t};H.multiply=function(e,t,n){y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n);const i=e[0]*t[0]+e[3]*t[1]+e[6]*t[2],r=e[1]*t[0]+e[4]*t[1]+e[7]*t[2],s=e[2]*t[0]+e[5]*t[1]+e[8]*t[2],o=e[0]*t[3]+e[3]*t[4]+e[6]*t[5],a=e[1]*t[3]+e[4]*t[4]+e[7]*t[5],c=e[2]*t[3]+e[5]*t[4]+e[8]*t[5],u=e[0]*t[6]+e[3]*t[7]+e[6]*t[8],h=e[1]*t[6]+e[4]*t[7]+e[7]*t[8],d=e[2]*t[6]+e[5]*t[7]+e[8]*t[8];return n[0]=i,n[1]=r,n[2]=s,n[3]=o,n[4]=a,n[5]=c,n[6]=u,n[7]=h,n[8]=d,n};H.add=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n[4]=e[4]+t[4],n[5]=e[5]+t[5],n[6]=e[6]+t[6],n[7]=e[7]+t[7],n[8]=e[8]+t[8],n};H.subtract=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n[4]=e[4]-t[4],n[5]=e[5]-t[5],n[6]=e[6]-t[6],n[7]=e[7]-t[7],n[8]=e[8]-t[8],n};H.multiplyByVector=function(e,t,n){y.typeOf.object("matrix",e),y.typeOf.object("cartesian",t),y.typeOf.object("result",n);const i=t.x,r=t.y,s=t.z,o=e[0]*i+e[3]*r+e[6]*s,a=e[1]*i+e[4]*r+e[7]*s,c=e[2]*i+e[5]*r+e[8]*s;return n.x=o,n.y=a,n.z=c,n};H.multiplyByScalar=function(e,t,n){return y.typeOf.object("matrix",e),y.typeOf.number("scalar",t),y.typeOf.object("result",n),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n[4]=e[4]*t,n[5]=e[5]*t,n[6]=e[6]*t,n[7]=e[7]*t,n[8]=e[8]*t,n};H.multiplyByScale=function(e,t,n){return y.typeOf.object("matrix",e),y.typeOf.object("scale",t),y.typeOf.object("result",n),n[0]=e[0]*t.x,n[1]=e[1]*t.x,n[2]=e[2]*t.x,n[3]=e[3]*t.y,n[4]=e[4]*t.y,n[5]=e[5]*t.y,n[6]=e[6]*t.z,n[7]=e[7]*t.z,n[8]=e[8]*t.z,n};H.multiplyByUniformScale=function(e,t,n){return y.typeOf.object("matrix",e),y.typeOf.number("scale",t),y.typeOf.object("result",n),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n[4]=e[4]*t,n[5]=e[5]*t,n[6]=e[6]*t,n[7]=e[7]*t,n[8]=e[8]*t,n};H.negate=function(e,t){return y.typeOf.object("matrix",e),y.typeOf.object("result",t),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t};H.transpose=function(e,t){y.typeOf.object("matrix",e),y.typeOf.object("result",t);const n=e[0],i=e[3],r=e[6],s=e[1],o=e[4],a=e[7],c=e[2],u=e[5],h=e[8];return t[0]=n,t[1]=i,t[2]=r,t[3]=s,t[4]=o,t[5]=a,t[6]=c,t[7]=u,t[8]=h,t};function EH(e){let t=0;for(let n=0;n<9;++n){const i=e[n];t+=i*i}return Math.sqrt(t)}const Lx=[1,0,0],Px=[2,2,1];function CH(e){let t=0;for(let n=0;n<3;++n){const i=e[H.getElementIndex(Px[n],Lx[n])];t+=2*i*i}return Math.sqrt(t)}function wH(e,t){const n=R.EPSILON15;let i=0,r=1;for(let u=0;u<3;++u){const h=Math.abs(e[H.getElementIndex(Px[u],Lx[u])]);h>i&&(r=u,i=h)}let s=1,o=0;const a=Lx[r],c=Px[r];if(Math.abs(e[H.getElementIndex(c,a)])>n){const u=e[H.getElementIndex(c,c)],h=e[H.getElementIndex(a,a)],d=e[H.getElementIndex(c,a)],p=(u-h)/2/d;let g;p<0?g=-1/(-p+Math.sqrt(1+p*p)):g=1/(p+Math.sqrt(1+p*p)),s=1/Math.sqrt(1+g*g),o=g*s}return t=H.clone(H.IDENTITY,t),t[H.getElementIndex(a,a)]=t[H.getElementIndex(c,c)]=s,t[H.getElementIndex(c,a)]=o,t[H.getElementIndex(a,c)]=-o,t}const Mm=new H,ov=new H;H.computeEigenDecomposition=function(e,t){y.typeOf.object("matrix",e);const n=R.EPSILON20,i=10;let r=0,s=0;l(t)||(t={});const o=t.unitary=H.clone(H.IDENTITY,t.unitary),a=t.diagonal=H.clone(e,t.diagonal),c=n*EH(a);for(;s<i&&CH(a)>c;)wH(a,Mm),H.transpose(Mm,ov),H.multiply(a,Mm,a),H.multiply(ov,a,a),H.multiply(o,Mm,o),++r>2&&(++s,r=0);return t};H.abs=function(e,t){return y.typeOf.object("matrix",e),y.typeOf.object("result",t),t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t[4]=Math.abs(e[4]),t[5]=Math.abs(e[5]),t[6]=Math.abs(e[6]),t[7]=Math.abs(e[7]),t[8]=Math.abs(e[8]),t};H.determinant=function(e){y.typeOf.object("matrix",e);const t=e[0],n=e[3],i=e[6],r=e[1],s=e[4],o=e[7],a=e[2],c=e[5],u=e[8];return t*(s*u-c*o)+r*(c*i-n*u)+a*(n*o-s*i)};H.inverse=function(e,t){y.typeOf.object("matrix",e),y.typeOf.object("result",t);const n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],u=e[7],h=e[8],d=H.determinant(e);if(Math.abs(d)<=R.EPSILON15)throw new A("matrix is not invertible");t[0]=o*h-u*a,t[1]=u*r-i*h,t[2]=i*a-o*r,t[3]=c*a-s*h,t[4]=n*h-c*r,t[5]=s*r-n*a,t[6]=s*u-c*o,t[7]=c*i-n*u,t[8]=n*o-s*i;const p=1/d;return H.multiplyByScalar(t,p,t)};const AH=new H;H.inverseTranspose=function(e,t){return y.typeOf.object("matrix",e),y.typeOf.object("result",t),H.inverse(H.transpose(e,AH),t)};H.equals=function(e,t){return e===t||l(e)&&l(t)&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]};H.equalsEpsilon=function(e,t,n){return n=T(n,0),e===t||l(e)&&l(t)&&Math.abs(e[0]-t[0])<=n&&Math.abs(e[1]-t[1])<=n&&Math.abs(e[2]-t[2])<=n&&Math.abs(e[3]-t[3])<=n&&Math.abs(e[4]-t[4])<=n&&Math.abs(e[5]-t[5])<=n&&Math.abs(e[6]-t[6])<=n&&Math.abs(e[7]-t[7])<=n&&Math.abs(e[8]-t[8])<=n};H.IDENTITY=Object.freeze(new H(1,0,0,0,1,0,0,0,1));H.ZERO=Object.freeze(new H(0,0,0,0,0,0,0,0,0));H.COLUMN0ROW0=0;H.COLUMN0ROW1=1;H.COLUMN0ROW2=2;H.COLUMN1ROW0=3;H.COLUMN1ROW1=4;H.COLUMN1ROW2=5;H.COLUMN2ROW0=6;H.COLUMN2ROW1=7;H.COLUMN2ROW2=8;Object.defineProperties(H.prototype,{length:{get:function(){return H.packedLength}}});H.prototype.clone=function(e){return H.clone(this,e)};H.prototype.equals=function(e){return H.equals(this,e)};H.equalsArray=function(e,t,n){return e[0]===t[n]&&e[1]===t[n+1]&&e[2]===t[n+2]&&e[3]===t[n+3]&&e[4]===t[n+4]&&e[5]===t[n+5]&&e[6]===t[n+6]&&e[7]===t[n+7]&&e[8]===t[n+8]};H.prototype.equalsEpsilon=function(e,t){return H.equalsEpsilon(this,e,t)};H.prototype.toString=function(){return`(${this[0]}, ${this[3]}, ${this[6]})
(${this[1]}, ${this[4]}, ${this[7]})
(${this[2]}, ${this[5]}, ${this[8]})`};function Y(e,t,n,i){this.x=T(e,0),this.y=T(t,0),this.z=T(n,0),this.w=T(i,0)}Y.fromElements=function(e,t,n,i,r){return l(r)?(r.x=e,r.y=t,r.z=n,r.w=i,r):new Y(e,t,n,i)};Y.fromColor=function(e,t){return y.typeOf.object("color",e),l(t)?(t.x=e.red,t.y=e.green,t.z=e.blue,t.w=e.alpha,t):new Y(e.red,e.green,e.blue,e.alpha)};Y.clone=function(e,t){if(l(e))return l(t)?(t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t):new Y(e.x,e.y,e.z,e.w)};Y.packedLength=4;Y.pack=function(e,t,n){return y.typeOf.object("value",e),y.defined("array",t),n=T(n,0),t[n++]=e.x,t[n++]=e.y,t[n++]=e.z,t[n]=e.w,t};Y.unpack=function(e,t,n){return y.defined("array",e),t=T(t,0),l(n)||(n=new Y),n.x=e[t++],n.y=e[t++],n.z=e[t++],n.w=e[t],n};Y.packArray=function(e,t){y.defined("array",e);const n=e.length,i=n*4;if(!l(t))t=new Array(i);else{if(!Array.isArray(t)&&t.length!==i)throw new A("If result is a typed array, it must have exactly array.length * 4 elements");t.length!==i&&(t.length=i)}for(let r=0;r<n;++r)Y.pack(e[r],t,r*4);return t};Y.unpackArray=function(e,t){if(y.defined("array",e),y.typeOf.number.greaterThanOrEquals("array.length",e.length,4),e.length%4!==0)throw new A("array length must be a multiple of 4.");const n=e.length;l(t)?t.length=n/4:t=new Array(n/4);for(let i=0;i<n;i+=4){const r=i/4;t[r]=Y.unpack(e,i,t[r])}return t};Y.fromArray=Y.unpack;Y.maximumComponent=function(e){return y.typeOf.object("cartesian",e),Math.max(e.x,e.y,e.z,e.w)};Y.minimumComponent=function(e){return y.typeOf.object("cartesian",e),Math.min(e.x,e.y,e.z,e.w)};Y.minimumByComponent=function(e,t,n){return y.typeOf.object("first",e),y.typeOf.object("second",t),y.typeOf.object("result",n),n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y),n.z=Math.min(e.z,t.z),n.w=Math.min(e.w,t.w),n};Y.maximumByComponent=function(e,t,n){return y.typeOf.object("first",e),y.typeOf.object("second",t),y.typeOf.object("result",n),n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y),n.z=Math.max(e.z,t.z),n.w=Math.max(e.w,t.w),n};Y.clamp=function(e,t,n,i){y.typeOf.object("value",e),y.typeOf.object("min",t),y.typeOf.object("max",n),y.typeOf.object("result",i);const r=R.clamp(e.x,t.x,n.x),s=R.clamp(e.y,t.y,n.y),o=R.clamp(e.z,t.z,n.z),a=R.clamp(e.w,t.w,n.w);return i.x=r,i.y=s,i.z=o,i.w=a,i};Y.magnitudeSquared=function(e){return y.typeOf.object("cartesian",e),e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w};Y.magnitude=function(e){return Math.sqrt(Y.magnitudeSquared(e))};const B_=new Y;Y.distance=function(e,t){return y.typeOf.object("left",e),y.typeOf.object("right",t),Y.subtract(e,t,B_),Y.magnitude(B_)};Y.distanceSquared=function(e,t){return y.typeOf.object("left",e),y.typeOf.object("right",t),Y.subtract(e,t,B_),Y.magnitudeSquared(B_)};Y.normalize=function(e,t){y.typeOf.object("cartesian",e),y.typeOf.object("result",t);const n=Y.magnitude(e);if(t.x=e.x/n,t.y=e.y/n,t.z=e.z/n,t.w=e.w/n,isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||isNaN(t.w))throw new A("normalized result is not a number");return t};Y.dot=function(e,t){return y.typeOf.object("left",e),y.typeOf.object("right",t),e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w};Y.multiplyComponents=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n.x=e.x*t.x,n.y=e.y*t.y,n.z=e.z*t.z,n.w=e.w*t.w,n};Y.divideComponents=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n.x=e.x/t.x,n.y=e.y/t.y,n.z=e.z/t.z,n.w=e.w/t.w,n};Y.add=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z,n.w=e.w+t.w,n};Y.subtract=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z,n.w=e.w-t.w,n};Y.multiplyByScalar=function(e,t,n){return y.typeOf.object("cartesian",e),y.typeOf.number("scalar",t),y.typeOf.object("result",n),n.x=e.x*t,n.y=e.y*t,n.z=e.z*t,n.w=e.w*t,n};Y.divideByScalar=function(e,t,n){return y.typeOf.object("cartesian",e),y.typeOf.number("scalar",t),y.typeOf.object("result",n),n.x=e.x/t,n.y=e.y/t,n.z=e.z/t,n.w=e.w/t,n};Y.negate=function(e,t){return y.typeOf.object("cartesian",e),y.typeOf.object("result",t),t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t};Y.abs=function(e,t){return y.typeOf.object("cartesian",e),y.typeOf.object("result",t),t.x=Math.abs(e.x),t.y=Math.abs(e.y),t.z=Math.abs(e.z),t.w=Math.abs(e.w),t};const av=new Y;Y.lerp=function(e,t,n,i){return y.typeOf.object("start",e),y.typeOf.object("end",t),y.typeOf.number("t",n),y.typeOf.object("result",i),Y.multiplyByScalar(t,n,av),i=Y.multiplyByScalar(e,1-n,i),Y.add(av,i,i)};const SH=new Y;Y.mostOrthogonalAxis=function(e,t){y.typeOf.object("cartesian",e),y.typeOf.object("result",t);const n=Y.normalize(e,SH);return Y.abs(n,n),n.x<=n.y?n.x<=n.z?n.x<=n.w?t=Y.clone(Y.UNIT_X,t):t=Y.clone(Y.UNIT_W,t):n.z<=n.w?t=Y.clone(Y.UNIT_Z,t):t=Y.clone(Y.UNIT_W,t):n.y<=n.z?n.y<=n.w?t=Y.clone(Y.UNIT_Y,t):t=Y.clone(Y.UNIT_W,t):n.z<=n.w?t=Y.clone(Y.UNIT_Z,t):t=Y.clone(Y.UNIT_W,t),t};Y.equals=function(e,t){return e===t||l(e)&&l(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w};Y.equalsArray=function(e,t,n){return e.x===t[n]&&e.y===t[n+1]&&e.z===t[n+2]&&e.w===t[n+3]};Y.equalsEpsilon=function(e,t,n,i){return e===t||l(e)&&l(t)&&R.equalsEpsilon(e.x,t.x,n,i)&&R.equalsEpsilon(e.y,t.y,n,i)&&R.equalsEpsilon(e.z,t.z,n,i)&&R.equalsEpsilon(e.w,t.w,n,i)};Y.ZERO=Object.freeze(new Y(0,0,0,0));Y.ONE=Object.freeze(new Y(1,1,1,1));Y.UNIT_X=Object.freeze(new Y(1,0,0,0));Y.UNIT_Y=Object.freeze(new Y(0,1,0,0));Y.UNIT_Z=Object.freeze(new Y(0,0,1,0));Y.UNIT_W=Object.freeze(new Y(0,0,0,1));Y.prototype.clone=function(e){return Y.clone(this,e)};Y.prototype.equals=function(e){return Y.equals(this,e)};Y.prototype.equalsEpsilon=function(e,t,n){return Y.equalsEpsilon(this,e,t,n)};Y.prototype.toString=function(){return`(${this.x}, ${this.y}, ${this.z}, ${this.w})`};const wC=new Float32Array(1),_r=new Uint8Array(wC.buffer),vH=new Uint32Array([287454020]),IH=new Uint8Array(vH.buffer),mM=IH[0]===68;Y.packFloat=function(e,t){return y.typeOf.number("value",e),l(t)||(t=new Y),wC[0]=e,mM?(t.x=_r[0],t.y=_r[1],t.z=_r[2],t.w=_r[3]):(t.x=_r[3],t.y=_r[2],t.z=_r[1],t.w=_r[0]),t};Y.unpackFloat=function(e){return y.typeOf.object("packedFloat",e),mM?(_r[0]=e.x,_r[1]=e.y,_r[2]=e.z,_r[3]=e.w):(_r[0]=e.w,_r[1]=e.z,_r[2]=e.y,_r[3]=e.x),wC[0]};function te(e){this.name="RuntimeError",this.message=e;let t;try{throw new Error}catch(n){t=n.stack}this.stack=t}l(Object.create)&&(te.prototype=Object.create(Error.prototype),te.prototype.constructor=te);te.prototype.toString=function(){let e=`${this.name}: ${this.message}`;return l(this.stack)&&(e+=`
${this.stack.toString()}`),e};function P(e,t,n,i,r,s,o,a,c,u,h,d,p,g,_,b){this[0]=T(e,0),this[1]=T(r,0),this[2]=T(c,0),this[3]=T(p,0),this[4]=T(t,0),this[5]=T(s,0),this[6]=T(u,0),this[7]=T(g,0),this[8]=T(n,0),this[9]=T(o,0),this[10]=T(h,0),this[11]=T(_,0),this[12]=T(i,0),this[13]=T(a,0),this[14]=T(d,0),this[15]=T(b,0)}P.packedLength=16;P.pack=function(e,t,n){return y.typeOf.object("value",e),y.defined("array",t),n=T(n,0),t[n++]=e[0],t[n++]=e[1],t[n++]=e[2],t[n++]=e[3],t[n++]=e[4],t[n++]=e[5],t[n++]=e[6],t[n++]=e[7],t[n++]=e[8],t[n++]=e[9],t[n++]=e[10],t[n++]=e[11],t[n++]=e[12],t[n++]=e[13],t[n++]=e[14],t[n]=e[15],t};P.unpack=function(e,t,n){return y.defined("array",e),t=T(t,0),l(n)||(n=new P),n[0]=e[t++],n[1]=e[t++],n[2]=e[t++],n[3]=e[t++],n[4]=e[t++],n[5]=e[t++],n[6]=e[t++],n[7]=e[t++],n[8]=e[t++],n[9]=e[t++],n[10]=e[t++],n[11]=e[t++],n[12]=e[t++],n[13]=e[t++],n[14]=e[t++],n[15]=e[t],n};P.packArray=function(e,t){y.defined("array",e);const n=e.length,i=n*16;if(!l(t))t=new Array(i);else{if(!Array.isArray(t)&&t.length!==i)throw new A("If result is a typed array, it must have exactly array.length * 16 elements");t.length!==i&&(t.length=i)}for(let r=0;r<n;++r)P.pack(e[r],t,r*16);return t};P.unpackArray=function(e,t){if(y.defined("array",e),y.typeOf.number.greaterThanOrEquals("array.length",e.length,16),e.length%16!==0)throw new A("array length must be a multiple of 16.");const n=e.length;l(t)?t.length=n/16:t=new Array(n/16);for(let i=0;i<n;i+=16){const r=i/16;t[r]=P.unpack(e,i,t[r])}return t};P.clone=function(e,t){if(l(e))return l(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t):new P(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])};P.fromArray=P.unpack;P.fromColumnMajorArray=function(e,t){return y.defined("values",e),P.clone(e,t)};P.fromRowMajorArray=function(e,t){return y.defined("values",e),l(t)?(t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t):new P(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])};P.fromRotationTranslation=function(e,t,n){return y.typeOf.object("rotation",e),t=T(t,m.ZERO),l(n)?(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=0,n[4]=e[3],n[5]=e[4],n[6]=e[5],n[7]=0,n[8]=e[6],n[9]=e[7],n[10]=e[8],n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,n):new P(e[0],e[3],e[6],t.x,e[1],e[4],e[7],t.y,e[2],e[5],e[8],t.z,0,0,0,1)};P.fromTranslationQuaternionRotationScale=function(e,t,n,i){y.typeOf.object("translation",e),y.typeOf.object("rotation",t),y.typeOf.object("scale",n),l(i)||(i=new P);const r=n.x,s=n.y,o=n.z,a=t.x*t.x,c=t.x*t.y,u=t.x*t.z,h=t.x*t.w,d=t.y*t.y,p=t.y*t.z,g=t.y*t.w,_=t.z*t.z,b=t.z*t.w,x=t.w*t.w,E=a-d-_+x,C=2*(c-b),w=2*(u+g),S=2*(c+b),v=-a+d-_+x,D=2*(p-h),L=2*(u-g),O=2*(p+h),N=-a-d+_+x;return i[0]=E*r,i[1]=S*r,i[2]=L*r,i[3]=0,i[4]=C*s,i[5]=v*s,i[6]=O*s,i[7]=0,i[8]=w*o,i[9]=D*o,i[10]=N*o,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,i};P.fromTranslationRotationScale=function(e,t){return y.typeOf.object("translationRotationScale",e),P.fromTranslationQuaternionRotationScale(e.translation,e.rotation,e.scale,t)};P.fromTranslation=function(e,t){return y.typeOf.object("translation",e),P.fromRotationTranslation(H.IDENTITY,e,t)};P.fromScale=function(e,t){return y.typeOf.object("scale",e),l(t)?(t[0]=e.x,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e.y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e.z,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t):new P(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1)};P.fromUniformScale=function(e,t){return y.typeOf.number("scale",e),l(t)?(t[0]=e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t):new P(e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1)};P.fromRotation=function(e,t){return y.typeOf.object("rotation",e),l(t)||(t=new P),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=0,t[4]=e[3],t[5]=e[4],t[6]=e[5],t[7]=0,t[8]=e[6],t[9]=e[7],t[10]=e[8],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t};const $u=new m,Xu=new m,nd=new m;P.fromCamera=function(e,t){y.typeOf.object("camera",e);const n=e.position,i=e.direction,r=e.up;y.typeOf.object("camera.position",n),y.typeOf.object("camera.direction",i),y.typeOf.object("camera.up",r),m.normalize(i,$u),m.normalize(m.cross($u,r,Xu),Xu),m.normalize(m.cross(Xu,$u,nd),nd);const s=Xu.x,o=Xu.y,a=Xu.z,c=$u.x,u=$u.y,h=$u.z,d=nd.x,p=nd.y,g=nd.z,_=n.x,b=n.y,x=n.z,E=s*-_+o*-b+a*-x,C=d*-_+p*-b+g*-x,w=c*_+u*b+h*x;return l(t)?(t[0]=s,t[1]=d,t[2]=-c,t[3]=0,t[4]=o,t[5]=p,t[6]=-u,t[7]=0,t[8]=a,t[9]=g,t[10]=-h,t[11]=0,t[12]=E,t[13]=C,t[14]=w,t[15]=1,t):new P(s,o,a,E,d,p,g,C,-c,-u,-h,w,0,0,0,1)};P.computePerspectiveFieldOfView=function(e,t,n,i,r){y.typeOf.number.greaterThan("fovY",e,0),y.typeOf.number.lessThan("fovY",e,Math.PI),y.typeOf.number.greaterThan("near",n,0),y.typeOf.number.greaterThan("far",i,0),y.typeOf.object("result",r);const o=1/Math.tan(e*.5),a=o/t,c=(i+n)/(n-i),u=2*i*n/(n-i);return r[0]=a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=c,r[11]=-1,r[12]=0,r[13]=0,r[14]=u,r[15]=0,r};P.computeOrthographicOffCenter=function(e,t,n,i,r,s,o){y.typeOf.number("left",e),y.typeOf.number("right",t),y.typeOf.number("bottom",n),y.typeOf.number("top",i),y.typeOf.number("near",r),y.typeOf.number("far",s),y.typeOf.object("result",o);let a=1/(t-e),c=1/(i-n),u=1/(s-r);const h=-(t+e)*a,d=-(i+n)*c,p=-(s+r)*u;return a*=2,c*=2,u*=-2,o[0]=a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=c,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=u,o[11]=0,o[12]=h,o[13]=d,o[14]=p,o[15]=1,o};P.computePerspectiveOffCenter=function(e,t,n,i,r,s,o){y.typeOf.number("left",e),y.typeOf.number("right",t),y.typeOf.number("bottom",n),y.typeOf.number("top",i),y.typeOf.number("near",r),y.typeOf.number("far",s),y.typeOf.object("result",o);const a=2*r/(t-e),c=2*r/(i-n),u=(t+e)/(t-e),h=(i+n)/(i-n),d=-(s+r)/(s-r),p=-1,g=-2*s*r/(s-r);return o[0]=a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=c,o[6]=0,o[7]=0,o[8]=u,o[9]=h,o[10]=d,o[11]=p,o[12]=0,o[13]=0,o[14]=g,o[15]=0,o};P.computeInfinitePerspectiveOffCenter=function(e,t,n,i,r,s){y.typeOf.number("left",e),y.typeOf.number("right",t),y.typeOf.number("bottom",n),y.typeOf.number("top",i),y.typeOf.number("near",r),y.typeOf.object("result",s);const o=2*r/(t-e),a=2*r/(i-n),c=(t+e)/(t-e),u=(i+n)/(i-n),h=-1,d=-1,p=-2*r;return s[0]=o,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=a,s[6]=0,s[7]=0,s[8]=c,s[9]=u,s[10]=h,s[11]=d,s[12]=0,s[13]=0,s[14]=p,s[15]=0,s};P.computeViewportTransformation=function(e,t,n,i){l(i)||(i=new P),e=T(e,T.EMPTY_OBJECT);const r=T(e.x,0),s=T(e.y,0),o=T(e.width,0),a=T(e.height,0);t=T(t,0),n=T(n,1);const c=o*.5,u=a*.5,h=(n-t)*.5,d=c,p=u,g=h,_=r+c,b=s+u,x=t+h,E=1;return i[0]=d,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=g,i[11]=0,i[12]=_,i[13]=b,i[14]=x,i[15]=E,i};P.computeView=function(e,t,n,i,r){return y.typeOf.object("position",e),y.typeOf.object("direction",t),y.typeOf.object("up",n),y.typeOf.object("right",i),y.typeOf.object("result",r),r[0]=i.x,r[1]=n.x,r[2]=-t.x,r[3]=0,r[4]=i.y,r[5]=n.y,r[6]=-t.y,r[7]=0,r[8]=i.z,r[9]=n.z,r[10]=-t.z,r[11]=0,r[12]=-m.dot(i,e),r[13]=-m.dot(n,e),r[14]=m.dot(t,e),r[15]=1,r};P.toArray=function(e,t){return y.typeOf.object("matrix",e),l(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t):[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]};P.getElementIndex=function(e,t){return y.typeOf.number.greaterThanOrEquals("row",t,0),y.typeOf.number.lessThanOrEquals("row",t,3),y.typeOf.number.greaterThanOrEquals("column",e,0),y.typeOf.number.lessThanOrEquals("column",e,3),e*4+t};P.getColumn=function(e,t,n){y.typeOf.object("matrix",e),y.typeOf.number.greaterThanOrEquals("index",t,0),y.typeOf.number.lessThanOrEquals("index",t,3),y.typeOf.object("result",n);const i=t*4,r=e[i],s=e[i+1],o=e[i+2],a=e[i+3];return n.x=r,n.y=s,n.z=o,n.w=a,n};P.setColumn=function(e,t,n,i){y.typeOf.object("matrix",e),y.typeOf.number.greaterThanOrEquals("index",t,0),y.typeOf.number.lessThanOrEquals("index",t,3),y.typeOf.object("cartesian",n),y.typeOf.object("result",i),i=P.clone(e,i);const r=t*4;return i[r]=n.x,i[r+1]=n.y,i[r+2]=n.z,i[r+3]=n.w,i};P.getRow=function(e,t,n){y.typeOf.object("matrix",e),y.typeOf.number.greaterThanOrEquals("index",t,0),y.typeOf.number.lessThanOrEquals("index",t,3),y.typeOf.object("result",n);const i=e[t],r=e[t+4],s=e[t+8],o=e[t+12];return n.x=i,n.y=r,n.z=s,n.w=o,n};P.setRow=function(e,t,n,i){return y.typeOf.object("matrix",e),y.typeOf.number.greaterThanOrEquals("index",t,0),y.typeOf.number.lessThanOrEquals("index",t,3),y.typeOf.object("cartesian",n),y.typeOf.object("result",i),i=P.clone(e,i),i[t]=n.x,i[t+4]=n.y,i[t+8]=n.z,i[t+12]=n.w,i};P.setTranslation=function(e,t,n){return y.typeOf.object("matrix",e),y.typeOf.object("translation",t),y.typeOf.object("result",n),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=e[15],n};const OH=new m;P.setScale=function(e,t,n){y.typeOf.object("matrix",e),y.typeOf.object("scale",t),y.typeOf.object("result",n);const i=P.getScale(e,OH),r=t.x/i.x,s=t.y/i.y,o=t.z/i.z;return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3],n[4]=e[4]*s,n[5]=e[5]*s,n[6]=e[6]*s,n[7]=e[7],n[8]=e[8]*o,n[9]=e[9]*o,n[10]=e[10]*o,n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n};const RH=new m;P.setUniformScale=function(e,t,n){y.typeOf.object("matrix",e),y.typeOf.number("scale",t),y.typeOf.object("result",n);const i=P.getScale(e,RH),r=t/i.x,s=t/i.y,o=t/i.z;return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3],n[4]=e[4]*s,n[5]=e[5]*s,n[6]=e[6]*s,n[7]=e[7],n[8]=e[8]*o,n[9]=e[9]*o,n[10]=e[10]*o,n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n};const Kb=new m;P.getScale=function(e,t){return y.typeOf.object("matrix",e),y.typeOf.object("result",t),t.x=m.magnitude(m.fromElements(e[0],e[1],e[2],Kb)),t.y=m.magnitude(m.fromElements(e[4],e[5],e[6],Kb)),t.z=m.magnitude(m.fromElements(e[8],e[9],e[10],Kb)),t};const cv=new m;P.getMaximumScale=function(e){return P.getScale(e,cv),m.maximumComponent(cv)};const DH=new m;P.setRotation=function(e,t,n){y.typeOf.object("matrix",e),y.typeOf.object("result",n);const i=P.getScale(e,DH);return n[0]=t[0]*i.x,n[1]=t[1]*i.x,n[2]=t[2]*i.x,n[3]=e[3],n[4]=t[3]*i.y,n[5]=t[4]*i.y,n[6]=t[5]*i.y,n[7]=e[7],n[8]=t[6]*i.z,n[9]=t[7]*i.z,n[10]=t[8]*i.z,n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n};const MH=new m;P.getRotation=function(e,t){y.typeOf.object("matrix",e),y.typeOf.object("result",t);const n=P.getScale(e,MH);return t[0]=e[0]/n.x,t[1]=e[1]/n.x,t[2]=e[2]/n.x,t[3]=e[4]/n.y,t[4]=e[5]/n.y,t[5]=e[6]/n.y,t[6]=e[8]/n.z,t[7]=e[9]/n.z,t[8]=e[10]/n.z,t};P.multiply=function(e,t,n){y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n);const i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],c=e[5],u=e[6],h=e[7],d=e[8],p=e[9],g=e[10],_=e[11],b=e[12],x=e[13],E=e[14],C=e[15],w=t[0],S=t[1],v=t[2],D=t[3],L=t[4],O=t[5],N=t[6],B=t[7],U=t[8],V=t[9],f=t[10],I=t[11],F=t[12],G=t[13],W=t[14],X=t[15],Z=i*w+a*S+d*v+b*D,$=r*w+c*S+p*v+x*D,ne=s*w+u*S+g*v+E*D,le=o*w+h*S+_*v+C*D,pe=i*L+a*O+d*N+b*B,we=r*L+c*O+p*N+x*B,me=s*L+u*O+g*N+E*B,Pe=o*L+h*O+_*N+C*B,ot=i*U+a*V+d*f+b*I,At=r*U+c*V+p*f+x*I,St=s*U+u*V+g*f+E*I,he=o*U+h*V+_*f+C*I,hn=i*F+a*G+d*W+b*X,Sn=r*F+c*G+p*W+x*X,rt=s*F+u*G+g*W+E*X,ci=o*F+h*G+_*W+C*X;return n[0]=Z,n[1]=$,n[2]=ne,n[3]=le,n[4]=pe,n[5]=we,n[6]=me,n[7]=Pe,n[8]=ot,n[9]=At,n[10]=St,n[11]=he,n[12]=hn,n[13]=Sn,n[14]=rt,n[15]=ci,n};P.add=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n[4]=e[4]+t[4],n[5]=e[5]+t[5],n[6]=e[6]+t[6],n[7]=e[7]+t[7],n[8]=e[8]+t[8],n[9]=e[9]+t[9],n[10]=e[10]+t[10],n[11]=e[11]+t[11],n[12]=e[12]+t[12],n[13]=e[13]+t[13],n[14]=e[14]+t[14],n[15]=e[15]+t[15],n};P.subtract=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n[4]=e[4]-t[4],n[5]=e[5]-t[5],n[6]=e[6]-t[6],n[7]=e[7]-t[7],n[8]=e[8]-t[8],n[9]=e[9]-t[9],n[10]=e[10]-t[10],n[11]=e[11]-t[11],n[12]=e[12]-t[12],n[13]=e[13]-t[13],n[14]=e[14]-t[14],n[15]=e[15]-t[15],n};P.multiplyTransformation=function(e,t,n){y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n);const i=e[0],r=e[1],s=e[2],o=e[4],a=e[5],c=e[6],u=e[8],h=e[9],d=e[10],p=e[12],g=e[13],_=e[14],b=t[0],x=t[1],E=t[2],C=t[4],w=t[5],S=t[6],v=t[8],D=t[9],L=t[10],O=t[12],N=t[13],B=t[14],U=i*b+o*x+u*E,V=r*b+a*x+h*E,f=s*b+c*x+d*E,I=i*C+o*w+u*S,F=r*C+a*w+h*S,G=s*C+c*w+d*S,W=i*v+o*D+u*L,X=r*v+a*D+h*L,Z=s*v+c*D+d*L,$=i*O+o*N+u*B+p,ne=r*O+a*N+h*B+g,le=s*O+c*N+d*B+_;return n[0]=U,n[1]=V,n[2]=f,n[3]=0,n[4]=I,n[5]=F,n[6]=G,n[7]=0,n[8]=W,n[9]=X,n[10]=Z,n[11]=0,n[12]=$,n[13]=ne,n[14]=le,n[15]=1,n};P.multiplyByMatrix3=function(e,t,n){y.typeOf.object("matrix",e),y.typeOf.object("rotation",t),y.typeOf.object("result",n);const i=e[0],r=e[1],s=e[2],o=e[4],a=e[5],c=e[6],u=e[8],h=e[9],d=e[10],p=t[0],g=t[1],_=t[2],b=t[3],x=t[4],E=t[5],C=t[6],w=t[7],S=t[8],v=i*p+o*g+u*_,D=r*p+a*g+h*_,L=s*p+c*g+d*_,O=i*b+o*x+u*E,N=r*b+a*x+h*E,B=s*b+c*x+d*E,U=i*C+o*w+u*S,V=r*C+a*w+h*S,f=s*C+c*w+d*S;return n[0]=v,n[1]=D,n[2]=L,n[3]=0,n[4]=O,n[5]=N,n[6]=B,n[7]=0,n[8]=U,n[9]=V,n[10]=f,n[11]=0,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n};P.multiplyByTranslation=function(e,t,n){y.typeOf.object("matrix",e),y.typeOf.object("translation",t),y.typeOf.object("result",n);const i=t.x,r=t.y,s=t.z,o=i*e[0]+r*e[4]+s*e[8]+e[12],a=i*e[1]+r*e[5]+s*e[9]+e[13],c=i*e[2]+r*e[6]+s*e[10]+e[14];return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=o,n[13]=a,n[14]=c,n[15]=e[15],n};P.multiplyByScale=function(e,t,n){y.typeOf.object("matrix",e),y.typeOf.object("scale",t),y.typeOf.object("result",n);const i=t.x,r=t.y,s=t.z;return i===1&&r===1&&s===1?P.clone(e,n):(n[0]=i*e[0],n[1]=i*e[1],n[2]=i*e[2],n[3]=e[3],n[4]=r*e[4],n[5]=r*e[5],n[6]=r*e[6],n[7]=e[7],n[8]=s*e[8],n[9]=s*e[9],n[10]=s*e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n)};P.multiplyByUniformScale=function(e,t,n){return y.typeOf.object("matrix",e),y.typeOf.number("scale",t),y.typeOf.object("result",n),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3],n[4]=e[4]*t,n[5]=e[5]*t,n[6]=e[6]*t,n[7]=e[7],n[8]=e[8]*t,n[9]=e[9]*t,n[10]=e[10]*t,n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n};P.multiplyByVector=function(e,t,n){y.typeOf.object("matrix",e),y.typeOf.object("cartesian",t),y.typeOf.object("result",n);const i=t.x,r=t.y,s=t.z,o=t.w,a=e[0]*i+e[4]*r+e[8]*s+e[12]*o,c=e[1]*i+e[5]*r+e[9]*s+e[13]*o,u=e[2]*i+e[6]*r+e[10]*s+e[14]*o,h=e[3]*i+e[7]*r+e[11]*s+e[15]*o;return n.x=a,n.y=c,n.z=u,n.w=h,n};P.multiplyByPointAsVector=function(e,t,n){y.typeOf.object("matrix",e),y.typeOf.object("cartesian",t),y.typeOf.object("result",n);const i=t.x,r=t.y,s=t.z,o=e[0]*i+e[4]*r+e[8]*s,a=e[1]*i+e[5]*r+e[9]*s,c=e[2]*i+e[6]*r+e[10]*s;return n.x=o,n.y=a,n.z=c,n};P.multiplyByPoint=function(e,t,n){y.typeOf.object("matrix",e),y.typeOf.object("cartesian",t),y.typeOf.object("result",n);const i=t.x,r=t.y,s=t.z,o=e[0]*i+e[4]*r+e[8]*s+e[12],a=e[1]*i+e[5]*r+e[9]*s+e[13],c=e[2]*i+e[6]*r+e[10]*s+e[14];return n.x=o,n.y=a,n.z=c,n};P.multiplyByScalar=function(e,t,n){return y.typeOf.object("matrix",e),y.typeOf.number("scalar",t),y.typeOf.object("result",n),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n[4]=e[4]*t,n[5]=e[5]*t,n[6]=e[6]*t,n[7]=e[7]*t,n[8]=e[8]*t,n[9]=e[9]*t,n[10]=e[10]*t,n[11]=e[11]*t,n[12]=e[12]*t,n[13]=e[13]*t,n[14]=e[14]*t,n[15]=e[15]*t,n};P.negate=function(e,t){return y.typeOf.object("matrix",e),y.typeOf.object("result",t),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t[9]=-e[9],t[10]=-e[10],t[11]=-e[11],t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=-e[15],t};P.transpose=function(e,t){y.typeOf.object("matrix",e),y.typeOf.object("result",t);const n=e[1],i=e[2],r=e[3],s=e[6],o=e[7],a=e[11];return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[10]=e[10],t[11]=e[14],t[12]=r,t[13]=o,t[14]=a,t[15]=e[15],t};P.abs=function(e,t){return y.typeOf.object("matrix",e),y.typeOf.object("result",t),t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t[4]=Math.abs(e[4]),t[5]=Math.abs(e[5]),t[6]=Math.abs(e[6]),t[7]=Math.abs(e[7]),t[8]=Math.abs(e[8]),t[9]=Math.abs(e[9]),t[10]=Math.abs(e[10]),t[11]=Math.abs(e[11]),t[12]=Math.abs(e[12]),t[13]=Math.abs(e[13]),t[14]=Math.abs(e[14]),t[15]=Math.abs(e[15]),t};P.equals=function(e,t){return e===t||l(e)&&l(t)&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[3]===t[3]&&e[7]===t[7]&&e[11]===t[11]&&e[15]===t[15]};P.equalsEpsilon=function(e,t,n){return n=T(n,0),e===t||l(e)&&l(t)&&Math.abs(e[0]-t[0])<=n&&Math.abs(e[1]-t[1])<=n&&Math.abs(e[2]-t[2])<=n&&Math.abs(e[3]-t[3])<=n&&Math.abs(e[4]-t[4])<=n&&Math.abs(e[5]-t[5])<=n&&Math.abs(e[6]-t[6])<=n&&Math.abs(e[7]-t[7])<=n&&Math.abs(e[8]-t[8])<=n&&Math.abs(e[9]-t[9])<=n&&Math.abs(e[10]-t[10])<=n&&Math.abs(e[11]-t[11])<=n&&Math.abs(e[12]-t[12])<=n&&Math.abs(e[13]-t[13])<=n&&Math.abs(e[14]-t[14])<=n&&Math.abs(e[15]-t[15])<=n};P.getTranslation=function(e,t){return y.typeOf.object("matrix",e),y.typeOf.object("result",t),t.x=e[12],t.y=e[13],t.z=e[14],t};P.getMatrix3=function(e,t){return y.typeOf.object("matrix",e),y.typeOf.object("result",t),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t};const LH=new H,PH=new H,NH=new Y,FH=new Y(0,0,0,1);P.inverse=function(e,t){y.typeOf.object("matrix",e),y.typeOf.object("result",t);const n=e[0],i=e[4],r=e[8],s=e[12],o=e[1],a=e[5],c=e[9],u=e[13],h=e[2],d=e[6],p=e[10],g=e[14],_=e[3],b=e[7],x=e[11],E=e[15];let C=p*E,w=g*x,S=d*E,v=g*b,D=d*x,L=p*b,O=h*E,N=g*_,B=h*x,U=p*_,V=h*b,f=d*_;const I=C*a+v*c+D*u-(w*a+S*c+L*u),F=w*o+O*c+U*u-(C*o+N*c+B*u),G=S*o+N*a+V*u-(v*o+O*a+f*u),W=L*o+B*a+f*c-(D*o+U*a+V*c),X=w*i+S*r+L*s-(C*i+v*r+D*s),Z=C*n+N*r+B*s-(w*n+O*r+U*s),$=v*n+O*i+f*s-(S*n+N*i+V*s),ne=D*n+U*i+V*r-(L*n+B*i+f*r);C=r*u,w=s*c,S=i*u,v=s*a,D=i*c,L=r*a,O=n*u,N=s*o,B=n*c,U=r*o,V=n*a,f=i*o;const le=C*b+v*x+D*E-(w*b+S*x+L*E),pe=w*_+O*x+U*E-(C*_+N*x+B*E),we=S*_+N*b+V*E-(v*_+O*b+f*E),me=L*_+B*b+f*x-(D*_+U*b+V*x),Pe=S*p+L*g+w*d-(D*g+C*d+v*p),ot=B*g+C*h+N*p-(O*p+U*g+w*h),At=O*d+f*g+v*h-(V*g+S*h+N*d),St=V*p+D*h+U*d-(B*d+f*p+L*h);let he=n*I+i*F+r*G+s*W;if(Math.abs(he)<R.EPSILON21){if(H.equalsEpsilon(P.getMatrix3(e,LH),PH,R.EPSILON7)&&Y.equals(P.getRow(e,3,NH),FH))return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=0,t[11]=0,t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=1,t;throw new te("matrix is not invertible because its determinate is zero.")}return he=1/he,t[0]=I*he,t[1]=F*he,t[2]=G*he,t[3]=W*he,t[4]=X*he,t[5]=Z*he,t[6]=$*he,t[7]=ne*he,t[8]=le*he,t[9]=pe*he,t[10]=we*he,t[11]=me*he,t[12]=Pe*he,t[13]=ot*he,t[14]=At*he,t[15]=St*he,t};P.inverseTransformation=function(e,t){y.typeOf.object("matrix",e),y.typeOf.object("result",t);const n=e[0],i=e[1],r=e[2],s=e[4],o=e[5],a=e[6],c=e[8],u=e[9],h=e[10],d=e[12],p=e[13],g=e[14],_=-n*d-i*p-r*g,b=-s*d-o*p-a*g,x=-c*d-u*p-h*g;return t[0]=n,t[1]=s,t[2]=c,t[3]=0,t[4]=i,t[5]=o,t[6]=u,t[7]=0,t[8]=r,t[9]=a,t[10]=h,t[11]=0,t[12]=_,t[13]=b,t[14]=x,t[15]=1,t};const BH=new P;P.inverseTranspose=function(e,t){return y.typeOf.object("matrix",e),y.typeOf.object("result",t),P.inverse(P.transpose(e,BH),t)};P.IDENTITY=Object.freeze(new P(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1));P.ZERO=Object.freeze(new P(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0));P.COLUMN0ROW0=0;P.COLUMN0ROW1=1;P.COLUMN0ROW2=2;P.COLUMN0ROW3=3;P.COLUMN1ROW0=4;P.COLUMN1ROW1=5;P.COLUMN1ROW2=6;P.COLUMN1ROW3=7;P.COLUMN2ROW0=8;P.COLUMN2ROW1=9;P.COLUMN2ROW2=10;P.COLUMN2ROW3=11;P.COLUMN3ROW0=12;P.COLUMN3ROW1=13;P.COLUMN3ROW2=14;P.COLUMN3ROW3=15;Object.defineProperties(P.prototype,{length:{get:function(){return P.packedLength}}});P.prototype.clone=function(e){return P.clone(this,e)};P.prototype.equals=function(e){return P.equals(this,e)};P.equalsArray=function(e,t,n){return e[0]===t[n]&&e[1]===t[n+1]&&e[2]===t[n+2]&&e[3]===t[n+3]&&e[4]===t[n+4]&&e[5]===t[n+5]&&e[6]===t[n+6]&&e[7]===t[n+7]&&e[8]===t[n+8]&&e[9]===t[n+9]&&e[10]===t[n+10]&&e[11]===t[n+11]&&e[12]===t[n+12]&&e[13]===t[n+13]&&e[14]===t[n+14]&&e[15]===t[n+15]};P.prototype.equalsEpsilon=function(e,t){return P.equalsEpsilon(this,e,t)};P.prototype.toString=function(){return`(${this[0]}, ${this[4]}, ${this[8]}, ${this[12]})
(${this[1]}, ${this[5]}, ${this[9]}, ${this[13]})
(${this[2]}, ${this[6]}, ${this[10]}, ${this[14]})
(${this[3]}, ${this[7]}, ${this[11]}, ${this[15]})`};function Xp(e,t,n){y.defined("array",e),y.defined("itemToFind",t),y.defined("comparator",n);let i=0,r=e.length-1,s,o;for(;i<=r;){if(s=~~((i+r)/2),o=n(e[s],t),o<0){i=s+1;continue}if(o>0){r=s-1;continue}return s}return~(r+1)}function AC(e,t,n,i,r){this.xPoleWander=e,this.yPoleWander=t,this.xPoleOffset=n,this.yPoleOffset=i,this.ut1MinusUtc=r}function Nx(e){if(e===null||isNaN(e))throw new A("year is required and must be a number.");return e%4===0&&e%100!==0||e%400===0}const lv=[31,28,31,30,31,30,31,31,30,31,30,31];function SC(e,t,n,i,r,s,o,a){e=T(e,1),t=T(t,1),n=T(n,1),i=T(i,0),r=T(r,0),s=T(s,0),o=T(o,0),a=T(a,!1),b(),x(),this.year=e,this.month=t,this.day=n,this.hour=i,this.minute=r,this.second=s,this.millisecond=o,this.isLeapSecond=a;function b(){y.typeOf.number.greaterThanOrEquals("Year",e,1),y.typeOf.number.lessThanOrEquals("Year",e,9999),y.typeOf.number.greaterThanOrEquals("Month",t,1),y.typeOf.number.lessThanOrEquals("Month",t,12),y.typeOf.number.greaterThanOrEquals("Day",n,1),y.typeOf.number.lessThanOrEquals("Day",n,31),y.typeOf.number.greaterThanOrEquals("Hour",i,0),y.typeOf.number.lessThanOrEquals("Hour",i,23),y.typeOf.number.greaterThanOrEquals("Minute",r,0),y.typeOf.number.lessThanOrEquals("Minute",r,59),y.typeOf.bool("IsLeapSecond",a),y.typeOf.number.greaterThanOrEquals("Second",s,0),y.typeOf.number.lessThanOrEquals("Second",s,a?60:59),y.typeOf.number.greaterThanOrEquals("Millisecond",o,0),y.typeOf.number.lessThan("Millisecond",o,1e3)}function x(){const E=t===2&&Nx(e)?lv[t-1]+1:lv[t-1];if(n>E)throw new A("Month and Day represents invalid date")}}function nn(e,t){this.julianDate=e,this.offset=t}const zH={SECONDS_PER_MILLISECOND:.001,SECONDS_PER_MINUTE:60,MINUTES_PER_HOUR:60,HOURS_PER_DAY:24,SECONDS_PER_HOUR:3600,MINUTES_PER_DAY:1440,SECONDS_PER_DAY:86400,DAYS_PER_JULIAN_CENTURY:36525,PICOSECOND:1e-9,MODIFIED_JULIAN_DATE_DIFFERENCE:24000005e-1},qn=Object.freeze(zH),UH={UTC:0,TAI:1},Rt=Object.freeze(UH),gM=new SC,Lm=[31,28,31,30,31,30,31,31,30,31,30,31],Pm=29;function vC(e,t){return ue.compare(e.julianDate,t.julianDate)}const rh=new nn;function By(e){rh.julianDate=e;const t=ue.leapSeconds;let n=Xp(t,rh,vC);n<0&&(n=~n),n>=t.length&&(n=t.length-1);let i=t[n].offset;n>0&&ue.secondsDifference(t[n].julianDate,e)>i&&(n--,i=t[n].offset),ue.addSeconds(e,i,e)}function uv(e,t){rh.julianDate=e;const n=ue.leapSeconds;let i=Xp(n,rh,vC);if(i<0&&(i=~i),i===0)return ue.addSeconds(e,-n[0].offset,t);if(i>=n.length)return ue.addSeconds(e,-n[i-1].offset,t);const r=ue.secondsDifference(n[i].julianDate,e);if(r===0)return ue.addSeconds(e,-n[i].offset,t);if(!(r<=1))return ue.addSeconds(e,-n[--i].offset,t)}function Rl(e,t,n){const i=t/qn.SECONDS_PER_DAY|0;return e+=i,t-=qn.SECONDS_PER_DAY*i,t<0&&(e--,t+=qn.SECONDS_PER_DAY),n.dayNumber=e,n.secondsOfDay=t,n}function IC(e,t,n,i,r,s,o){const a=(t-14)/12|0,c=e+4800+a;let u=(1461*c/4|0)+(367*(t-2-12*a)/12|0)-(3*((c+100)/100|0)/4|0)+n-32075;i=i-12,i<0&&(i+=24);const h=s+(i*qn.SECONDS_PER_HOUR+r*qn.SECONDS_PER_MINUTE+o*qn.SECONDS_PER_MILLISECOND);return h>=43200&&(u-=1),[u,h]}const kH=/^(\d{4})$/,jH=/^(\d{4})-(\d{2})$/,VH=/^(\d{4})-?(\d{3})$/,GH=/^(\d{4})-?W(\d{2})-?(\d{1})?$/,HH=/^(\d{4})-?(\d{2})-?(\d{2})$/,OC=/([Z+\-])?(\d{2})?:?(\d{2})?$/,qH=/^(\d{2})(\.\d+)?/.source+OC.source,WH=/^(\d{2}):?(\d{2})(\.\d+)?/.source+OC.source,$H=/^(\d{2}):?(\d{2}):?(\d{2})(\.\d+)?/.source+OC.source,ho="Invalid ISO 8601 date.";function ue(e,t,n){this.dayNumber=void 0,this.secondsOfDay=void 0,e=T(e,0),t=T(t,0),n=T(n,Rt.UTC);const i=e|0;t=t+(e-i)*qn.SECONDS_PER_DAY,Rl(i,t,this),n===Rt.UTC&&By(this)}ue.fromGregorianDate=function(e,t){if(!(e instanceof SC))throw new A("date must be a valid GregorianDate.");const n=IC(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond);return l(t)?(Rl(n[0],n[1],t),By(t),t):new ue(n[0],n[1],Rt.UTC)};ue.fromDate=function(e,t){if(!(e instanceof Date)||isNaN(e.getTime()))throw new A("date must be a valid JavaScript Date.");const n=IC(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds());return l(t)?(Rl(n[0],n[1],t),By(t),t):new ue(n[0],n[1],Rt.UTC)};ue.fromIso8601=function(e,t){if(typeof e!="string")throw new A(ho);e=e.replace(",",".");let n=e.split("T"),i,r=1,s=1,o=0,a=0,c=0,u=0;const h=n[0],d=n[1];let p,g;if(!l(h))throw new A(ho);let _;if(n=h.match(HH),n!==null){if(_=h.split("-").length-1,_>0&&_!==2)throw new A(ho);i=+n[1],r=+n[2],s=+n[3]}else if(n=h.match(jH),n!==null)i=+n[1],r=+n[2];else if(n=h.match(kH),n!==null)i=+n[1];else{let C;if(n=h.match(VH),n!==null){if(i=+n[1],C=+n[2],g=Nx(i),C<1||g&&C>366||!g&&C>365)throw new A(ho)}else if(n=h.match(GH),n!==null){i=+n[1];const w=+n[2],S=+n[3]||0;if(_=h.split("-").length-1,_>0&&(!l(n[3])&&_!==1||l(n[3])&&_!==2))throw new A(ho);const v=new Date(Date.UTC(i,0,4));C=w*7+S-v.getUTCDay()-3}else throw new A(ho);p=new Date(Date.UTC(i,0,1)),p.setUTCDate(C),r=p.getUTCMonth()+1,s=p.getUTCDate()}if(g=Nx(i),r<1||r>12||s<1||(r!==2||!g)&&s>Lm[r-1]||g&&r===2&&s>Pm)throw new A(ho);let b;if(l(d)){if(n=d.match($H),n!==null){if(_=d.split(":").length-1,_>0&&_!==2&&_!==3)throw new A(ho);o=+n[1],a=+n[2],c=+n[3],u=+(n[4]||0)*1e3,b=5}else if(n=d.match(WH),n!==null){if(_=d.split(":").length-1,_>2)throw new A(ho);o=+n[1],a=+n[2],c=+(n[3]||0)*60,b=4}else if(n=d.match(qH),n!==null)o=+n[1],a=+(n[2]||0)*60,b=3;else throw new A(ho);if(a>=60||c>=61||o>24||o===24&&(a>0||c>0||u>0))throw new A(ho);const C=n[b],w=+n[b+1],S=+(n[b+2]||0);switch(C){case"+":o=o-w,a=a-S;break;case"-":o=o+w,a=a+S;break;case"Z":break;default:a=a+new Date(Date.UTC(i,r-1,s,o,a)).getTimezoneOffset();break}}const x=c===60;for(x&&c--;a>=60;)a-=60,o++;for(;o>=24;)o-=24,s++;for(p=g&&r===2?Pm:Lm[r-1];s>p;)s-=p,r++,r>12&&(r-=12,i++),p=g&&r===2?Pm:Lm[r-1];for(;a<0;)a+=60,o--;for(;o<0;)o+=24,s--;for(;s<1;)r--,r<1&&(r+=12,i--),p=g&&r===2?Pm:Lm[r-1],s+=p;const E=IC(i,r,s,o,a,c,u);return l(t)?(Rl(E[0],E[1],t),By(t)):t=new ue(E[0],E[1],Rt.UTC),x&&ue.addSeconds(t,1,t),t};ue.now=function(e){return ue.fromDate(new Date,e)};const Nm=new ue(0,0,Rt.TAI);ue.toGregorianDate=function(e,t){if(!l(e))throw new A("julianDate is required.");let n=!1,i=uv(e,Nm);l(i)||(ue.addSeconds(e,-1,Nm),i=uv(Nm,Nm),n=!0);let r=i.dayNumber;const s=i.secondsOfDay;s>=43200&&(r+=1);let o=r+68569|0;const a=4*o/146097|0;o=o-((146097*a+3)/4|0)|0;const c=4e3*(o+1)/1461001|0;o=o-(1461*c/4|0)+31|0;const u=80*o/2447|0,h=o-(2447*u/80|0)|0;o=u/11|0;const d=u+2-12*o|0,p=100*(a-49)+c+o|0;let g=s/qn.SECONDS_PER_HOUR|0,_=s-g*qn.SECONDS_PER_HOUR;const b=_/qn.SECONDS_PER_MINUTE|0;_=_-b*qn.SECONDS_PER_MINUTE;let x=_|0;const E=(_-x)/qn.SECONDS_PER_MILLISECOND;return g+=12,g>23&&(g-=24),n&&(x+=1),l(t)?(t.year=p,t.month=d,t.day=h,t.hour=g,t.minute=b,t.second=x,t.millisecond=E,t.isLeapSecond=n,t):new SC(p,d,h,g,b,x,E,n)};ue.toDate=function(e){if(!l(e))throw new A("julianDate is required.");const t=ue.toGregorianDate(e,gM);let n=t.second;return t.isLeapSecond&&(n-=1),new Date(Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,n,t.millisecond))};ue.toIso8601=function(e,t){if(!l(e))throw new A("julianDate is required.");const n=ue.toGregorianDate(e,gM);let i=n.year,r=n.month,s=n.day,o=n.hour;const a=n.minute,c=n.second,u=n.millisecond;i===1e4&&r===1&&s===1&&o===0&&a===0&&c===0&&u===0&&(i=9999,r=12,s=31,o=24);let h;return!l(t)&&u!==0?(h=(u*.01).toString().replace(".",""),`${i.toString().padStart(4,"0")}-${r.toString().padStart(2,"0")}-${s.toString().padStart(2,"0")}T${o.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}.${h}Z`):!l(t)||t===0?`${i.toString().padStart(4,"0")}-${r.toString().padStart(2,"0")}-${s.toString().padStart(2,"0")}T${o.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}Z`:(h=(u*.01).toFixed(t).replace(".","").slice(0,t),`${i.toString().padStart(4,"0")}-${r.toString().padStart(2,"0")}-${s.toString().padStart(2,"0")}T${o.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}.${h}Z`)};ue.clone=function(e,t){if(l(e))return l(t)?(t.dayNumber=e.dayNumber,t.secondsOfDay=e.secondsOfDay,t):new ue(e.dayNumber,e.secondsOfDay,Rt.TAI)};ue.compare=function(e,t){if(!l(e))throw new A("left is required.");if(!l(t))throw new A("right is required.");const n=e.dayNumber-t.dayNumber;return n!==0?n:e.secondsOfDay-t.secondsOfDay};ue.equals=function(e,t){return e===t||l(e)&&l(t)&&e.dayNumber===t.dayNumber&&e.secondsOfDay===t.secondsOfDay};ue.equalsEpsilon=function(e,t,n){return n=T(n,0),e===t||l(e)&&l(t)&&Math.abs(ue.secondsDifference(e,t))<=n};ue.totalDays=function(e){if(!l(e))throw new A("julianDate is required.");return e.dayNumber+e.secondsOfDay/qn.SECONDS_PER_DAY};ue.secondsDifference=function(e,t){if(!l(e))throw new A("left is required.");if(!l(t))throw new A("right is required.");return(e.dayNumber-t.dayNumber)*qn.SECONDS_PER_DAY+(e.secondsOfDay-t.secondsOfDay)};ue.daysDifference=function(e,t){if(!l(e))throw new A("left is required.");if(!l(t))throw new A("right is required.");const n=e.dayNumber-t.dayNumber,i=(e.secondsOfDay-t.secondsOfDay)/qn.SECONDS_PER_DAY;return n+i};ue.computeTaiMinusUtc=function(e){rh.julianDate=e;const t=ue.leapSeconds;let n=Xp(t,rh,vC);return n<0&&(n=~n,--n,n<0&&(n=0)),t[n].offset};ue.addSeconds=function(e,t,n){if(!l(e))throw new A("julianDate is required.");if(!l(t))throw new A("seconds is required.");if(!l(n))throw new A("result is required.");return Rl(e.dayNumber,e.secondsOfDay+t,n)};ue.addMinutes=function(e,t,n){if(!l(e))throw new A("julianDate is required.");if(!l(t))throw new A("minutes is required.");if(!l(n))throw new A("result is required.");const i=e.secondsOfDay+t*qn.SECONDS_PER_MINUTE;return Rl(e.dayNumber,i,n)};ue.addHours=function(e,t,n){if(!l(e))throw new A("julianDate is required.");if(!l(t))throw new A("hours is required.");if(!l(n))throw new A("result is required.");const i=e.secondsOfDay+t*qn.SECONDS_PER_HOUR;return Rl(e.dayNumber,i,n)};ue.addDays=function(e,t,n){if(!l(e))throw new A("julianDate is required.");if(!l(t))throw new A("days is required.");if(!l(n))throw new A("result is required.");const i=e.dayNumber+t;return Rl(i,e.secondsOfDay,n)};ue.lessThan=function(e,t){return ue.compare(e,t)<0};ue.lessThanOrEquals=function(e,t){return ue.compare(e,t)<=0};ue.greaterThan=function(e,t){return ue.compare(e,t)>0};ue.greaterThanOrEquals=function(e,t){return ue.compare(e,t)>=0};ue.prototype.clone=function(e){return ue.clone(this,e)};ue.prototype.equals=function(e){return ue.equals(this,e)};ue.prototype.equalsEpsilon=function(e,t){return ue.equalsEpsilon(this,e,t)};ue.prototype.toString=function(){return ue.toIso8601(this)};ue.leapSeconds=[new nn(new ue(2441317,43210,Rt.TAI),10),new nn(new ue(2441499,43211,Rt.TAI),11),new nn(new ue(2441683,43212,Rt.TAI),12),new nn(new ue(2442048,43213,Rt.TAI),13),new nn(new ue(2442413,43214,Rt.TAI),14),new nn(new ue(2442778,43215,Rt.TAI),15),new nn(new ue(2443144,43216,Rt.TAI),16),new nn(new ue(2443509,43217,Rt.TAI),17),new nn(new ue(2443874,43218,Rt.TAI),18),new nn(new ue(2444239,43219,Rt.TAI),19),new nn(new ue(2444786,43220,Rt.TAI),20),new nn(new ue(2445151,43221,Rt.TAI),21),new nn(new ue(2445516,43222,Rt.TAI),22),new nn(new ue(2446247,43223,Rt.TAI),23),new nn(new ue(2447161,43224,Rt.TAI),24),new nn(new ue(2447892,43225,Rt.TAI),25),new nn(new ue(2448257,43226,Rt.TAI),26),new nn(new ue(2448804,43227,Rt.TAI),27),new nn(new ue(2449169,43228,Rt.TAI),28),new nn(new ue(2449534,43229,Rt.TAI),29),new nn(new ue(2450083,43230,Rt.TAI),30),new nn(new ue(2450630,43231,Rt.TAI),31),new nn(new ue(2451179,43232,Rt.TAI),32),new nn(new ue(2453736,43233,Rt.TAI),33),new nn(new ue(2454832,43234,Rt.TAI),34),new nn(new ue(2456109,43235,Rt.TAI),35),new nn(new ue(2457204,43236,Rt.TAI),36),new nn(new ue(2457754,43237,Rt.TAI),37)];var _M={exports:{}},Pd={exports:{}};/*! https://mths.be/punycode v1.4.0 by @mathias */Pd.exports;var fv;function XH(){return fv||(fv=1,function(e,t){(function(n){var i=t&&!t.nodeType&&t,r=e&&!e.nodeType&&e,s=typeof Bf=="object"&&Bf;(s.global===s||s.window===s||s.self===s)&&(n=s);var o,a=2147483647,c=36,u=1,h=26,d=38,p=700,g=72,_=128,b="-",x=/^xn--/,E=/[^\x20-\x7E]/,C=/[\x2E\u3002\uFF0E\uFF61]/g,w={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},S=c-u,v=Math.floor,D=String.fromCharCode,L;function O($){throw new RangeError(w[$])}function N($,ne){for(var le=$.length,pe=[];le--;)pe[le]=ne($[le]);return pe}function B($,ne){var le=$.split("@"),pe="";le.length>1&&(pe=le[0]+"@",$=le[1]),$=$.replace(C,".");var we=$.split("."),me=N(we,ne).join(".");return pe+me}function U($){for(var ne=[],le=0,pe=$.length,we,me;le<pe;)we=$.charCodeAt(le++),we>=55296&&we<=56319&&le<pe?(me=$.charCodeAt(le++),(me&64512)==56320?ne.push(((we&1023)<<10)+(me&1023)+65536):(ne.push(we),le--)):ne.push(we);return ne}function V($){return N($,function(ne){var le="";return ne>65535&&(ne-=65536,le+=D(ne>>>10&1023|55296),ne=56320|ne&1023),le+=D(ne),le}).join("")}function f($){return $-48<10?$-22:$-65<26?$-65:$-97<26?$-97:c}function I($,ne){return $+22+75*($<26)-((ne!=0)<<5)}function F($,ne,le){var pe=0;for($=le?v($/p):$>>1,$+=v($/ne);$>S*h>>1;pe+=c)$=v($/S);return v(pe+(S+1)*$/($+d))}function G($){var ne=[],le=$.length,pe,we=0,me=_,Pe=g,ot,At,St,he,hn,Sn,rt,ci,Ki;for(ot=$.lastIndexOf(b),ot<0&&(ot=0),At=0;At<ot;++At)$.charCodeAt(At)>=128&&O("not-basic"),ne.push($.charCodeAt(At));for(St=ot>0?ot+1:0;St<le;){for(he=we,hn=1,Sn=c;St>=le&&O("invalid-input"),rt=f($.charCodeAt(St++)),(rt>=c||rt>v((a-we)/hn))&&O("overflow"),we+=rt*hn,ci=Sn<=Pe?u:Sn>=Pe+h?h:Sn-Pe,!(rt<ci);Sn+=c)Ki=c-ci,hn>v(a/Ki)&&O("overflow"),hn*=Ki;pe=ne.length+1,Pe=F(we-he,pe,he==0),v(we/pe)>a-me&&O("overflow"),me+=v(we/pe),we%=pe,ne.splice(we++,0,me)}return V(ne)}function W($){var ne,le,pe,we,me,Pe,ot,At,St,he,hn,Sn=[],rt,ci,Ki,Xn;for($=U($),rt=$.length,ne=_,le=0,me=g,Pe=0;Pe<rt;++Pe)hn=$[Pe],hn<128&&Sn.push(D(hn));for(pe=we=Sn.length,we&&Sn.push(b);pe<rt;){for(ot=a,Pe=0;Pe<rt;++Pe)hn=$[Pe],hn>=ne&&hn<ot&&(ot=hn);for(ci=pe+1,ot-ne>v((a-le)/ci)&&O("overflow"),le+=(ot-ne)*ci,ne=ot,Pe=0;Pe<rt;++Pe)if(hn=$[Pe],hn<ne&&++le>a&&O("overflow"),hn==ne){for(At=le,St=c;he=St<=me?u:St>=me+h?h:St-me,!(At<he);St+=c)Xn=At-he,Ki=c-he,Sn.push(D(I(he+Xn%Ki,0))),At=v(Xn/Ki);Sn.push(D(I(At,0))),me=F(le,ci,pe==we),le=0,++pe}++le,++ne}return Sn.join("")}function X($){return B($,function(ne){return x.test(ne)?G(ne.slice(4).toLowerCase()):ne})}function Z($){return B($,function(ne){return E.test(ne)?"xn--"+W(ne):ne})}if(o={version:"1.3.2",ucs2:{decode:U,encode:V},decode:G,encode:W,toASCII:Z,toUnicode:X},i&&r)if(e.exports==i)r.exports=o;else for(L in o)o.hasOwnProperty(L)&&(i[L]=o[L]);else n.punycode=o})(Bf)}(Pd,Pd.exports)),Pd.exports}var Zb={exports:{}};/*!
 * URI.js - Mutating URLs
 * IPv6 Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var hv;function YH(){return hv||(hv=1,function(e){(function(t,n){e.exports?e.exports=n():t.IPv6=n(t)})(Bf,function(t){var n=t&&t.IPv6;function i(s){var o=s.toLowerCase(),a=o.split(":"),c=a.length,u=8;a[0]===""&&a[1]===""&&a[2]===""?(a.shift(),a.shift()):a[0]===""&&a[1]===""?a.shift():a[c-1]===""&&a[c-2]===""&&a.pop(),c=a.length,a[c-1].indexOf(".")!==-1&&(u=7);var h;for(h=0;h<c&&a[h]!=="";h++);if(h<u)for(a.splice(h,1,"0000");a.length<u;)a.splice(h,0,"0000");for(var d,p=0;p<u;p++){d=a[p].split("");for(var g=0;g<3&&(d[0]==="0"&&d.length>1);g++)d.splice(0,1);a[p]=d.join("")}var _=-1,b=0,x=0,E=-1,C=!1;for(p=0;p<u;p++)C?a[p]==="0"?x+=1:(C=!1,x>b&&(_=E,b=x)):a[p]==="0"&&(C=!0,E=p,x=1);x>b&&(_=E,b=x),b>1&&a.splice(_,b,""),c=a.length;var w="";for(a[0]===""&&(w=":"),p=0;p<c&&(w+=a[p],p!==c-1);p++)w+=":";return a[c-1]===""&&(w+=":"),w}function r(){return t.IPv6===this&&(t.IPv6=n),this}return{best:i,noConflict:r}})}(Zb)),Zb.exports}var Jb={exports:{}};/*!
 * URI.js - Mutating URLs
 * Second Level Domain (SLD) Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var dv;function KH(){return dv||(dv=1,function(e){(function(t,n){e.exports?e.exports=n():t.SecondLevelDomains=n(t)})(Bf,function(t){var n=t&&t.SecondLevelDomains,i={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(r){var s=r.lastIndexOf(".");if(s<=0||s>=r.length-1)return!1;var o=r.lastIndexOf(".",s-1);if(o<=0||o>=s-1)return!1;var a=i.list[r.slice(s+1)];return a?a.indexOf(" "+r.slice(o+1,s)+" ")>=0:!1},is:function(r){var s=r.lastIndexOf(".");if(s<=0||s>=r.length-1)return!1;var o=r.lastIndexOf(".",s-1);if(o>=0)return!1;var a=i.list[r.slice(s+1)];return a?a.indexOf(" "+r.slice(0,s)+" ")>=0:!1},get:function(r){var s=r.lastIndexOf(".");if(s<=0||s>=r.length-1)return null;var o=r.lastIndexOf(".",s-1);if(o<=0||o>=s-1)return null;var a=i.list[r.slice(s+1)];return!a||a.indexOf(" "+r.slice(o+1,s)+" ")<0?null:r.slice(o+1)},noConflict:function(){return t.SecondLevelDomains===this&&(t.SecondLevelDomains=n),this}};return i})}(Jb)),Jb.exports}/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */(function(e){(function(t,n){e.exports?e.exports=n(XH(),YH(),KH()):t.URI=n(t.punycode,t.IPv6,t.SecondLevelDomains,t)})(Bf,function(t,n,i,r){var s=r&&r.URI;function o(f,I){var F=arguments.length>=1,G=arguments.length>=2;if(!(this instanceof o))return F?G?new o(f,I):new o(f):new o;if(f===void 0){if(F)throw new TypeError("undefined is not a valid argument for URI");typeof location<"u"?f=location.href+"":f=""}if(f===null&&F)throw new TypeError("null is not a valid argument for URI");return this.href(f),I!==void 0?this.absoluteTo(I):this}function a(f){return/^[0-9]+$/.test(f)}o.version="1.19.11";var c=o.prototype,u=Object.prototype.hasOwnProperty;function h(f){return f.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function d(f){return f===void 0?"Undefined":String(Object.prototype.toString.call(f)).slice(8,-1)}function p(f){return d(f)==="Array"}function g(f,I){var F={},G,W;if(d(I)==="RegExp")F=null;else if(p(I))for(G=0,W=I.length;G<W;G++)F[I[G]]=!0;else F[I]=!0;for(G=0,W=f.length;G<W;G++){var X=F&&F[f[G]]!==void 0||!F&&I.test(f[G]);X&&(f.splice(G,1),W--,G--)}return f}function _(f,I){var F,G;if(p(I)){for(F=0,G=I.length;F<G;F++)if(!_(f,I[F]))return!1;return!0}var W=d(I);for(F=0,G=f.length;F<G;F++)if(W==="RegExp"){if(typeof f[F]=="string"&&f[F].match(I))return!0}else if(f[F]===I)return!0;return!1}function b(f,I){if(!p(f)||!p(I)||f.length!==I.length)return!1;f.sort(),I.sort();for(var F=0,G=f.length;F<G;F++)if(f[F]!==I[F])return!1;return!0}function x(f){var I=/^\/+|\/+$/g;return f.replace(I,"")}o._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:o.preventInvalidHostname,duplicateQueryParameters:o.duplicateQueryParameters,escapeQuerySpace:o.escapeQuerySpace}},o.preventInvalidHostname=!1,o.duplicateQueryParameters=!1,o.escapeQuerySpace=!0,o.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,o.idn_expression=/[^a-z0-9\._-]/i,o.punycode_expression=/(xn--)/i,o.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,o.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,o.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?Â«Â»ââââ]))/ig,o.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?Â«Â»âââââ]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},o.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,o.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g,o.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},o.hostProtocols=["http","https"],o.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,o.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},o.getDomAttribute=function(f){if(!(!f||!f.nodeName)){var I=f.nodeName.toLowerCase();if(!(I==="input"&&f.type!=="image"))return o.domAttributes[I]}};function E(f){return escape(f)}function C(f){return encodeURIComponent(f).replace(/[!'()*]/g,E).replace(/\*/g,"%2A")}o.encode=C,o.decode=decodeURIComponent,o.iso8859=function(){o.encode=escape,o.decode=unescape},o.unicode=function(){o.encode=C,o.decode=decodeURIComponent},o.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},o.encodeQuery=function(f,I){var F=o.encode(f+"");return I===void 0&&(I=o.escapeQuerySpace),I?F.replace(/%20/g,"+"):F},o.decodeQuery=function(f,I){f+="",I===void 0&&(I=o.escapeQuerySpace);try{return o.decode(I?f.replace(/\+/g,"%20"):f)}catch{return f}};var w={encode:"encode",decode:"decode"},S,v=function(f,I){return function(F){try{return o[I](F+"").replace(o.characters[f][I].expression,function(G){return o.characters[f][I].map[G]})}catch{return F}}};for(S in w)o[S+"PathSegment"]=v("pathname",w[S]),o[S+"UrnPathSegment"]=v("urnpath",w[S]);var D=function(f,I,F){return function(G){var W;F?W=function(ne){return o[I](o[F](ne))}:W=o[I];for(var X=(G+"").split(f),Z=0,$=X.length;Z<$;Z++)X[Z]=W(X[Z]);return X.join(f)}};o.decodePath=D("/","decodePathSegment"),o.decodeUrnPath=D(":","decodeUrnPathSegment"),o.recodePath=D("/","encodePathSegment","decode"),o.recodeUrnPath=D(":","encodeUrnPathSegment","decode"),o.encodeReserved=v("reserved","encode"),o.parse=function(f,I){var F;return I||(I={preventInvalidHostname:o.preventInvalidHostname}),f=f.replace(o.leading_whitespace_expression,""),f=f.replace(o.ascii_tab_whitespace,""),F=f.indexOf("#"),F>-1&&(I.fragment=f.substring(F+1)||null,f=f.substring(0,F)),F=f.indexOf("?"),F>-1&&(I.query=f.substring(F+1)||null,f=f.substring(0,F)),f=f.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://"),f=f.replace(/^[/\\]{2,}/i,"//"),f.substring(0,2)==="//"?(I.protocol=null,f=f.substring(2),f=o.parseAuthority(f,I)):(F=f.indexOf(":"),F>-1&&(I.protocol=f.substring(0,F)||null,I.protocol&&!I.protocol.match(o.protocol_expression)?I.protocol=void 0:f.substring(F+1,F+3).replace(/\\/g,"/")==="//"?(f=f.substring(F+3),f=o.parseAuthority(f,I)):(f=f.substring(F+1),I.urn=!0))),I.path=f,I},o.parseHost=function(f,I){f||(f=""),f=f.replace(/\\/g,"/");var F=f.indexOf("/"),G,W;if(F===-1&&(F=f.length),f.charAt(0)==="[")G=f.indexOf("]"),I.hostname=f.substring(1,G)||null,I.port=f.substring(G+2,F)||null,I.port==="/"&&(I.port=null);else{var X=f.indexOf(":"),Z=f.indexOf("/"),$=f.indexOf(":",X+1);$!==-1&&(Z===-1||$<Z)?(I.hostname=f.substring(0,F)||null,I.port=null):(W=f.substring(0,F).split(":"),I.hostname=W[0]||null,I.port=W[1]||null)}return I.hostname&&f.substring(F).charAt(0)!=="/"&&(F++,f="/"+f),I.preventInvalidHostname&&o.ensureValidHostname(I.hostname,I.protocol),I.port&&o.ensureValidPort(I.port),f.substring(F)||"/"},o.parseAuthority=function(f,I){return f=o.parseUserinfo(f,I),o.parseHost(f,I)},o.parseUserinfo=function(f,I){var F=f,G=f.indexOf("\\");G!==-1&&(f=f.replace(/\\/g,"/"));var W=f.indexOf("/"),X=f.lastIndexOf("@",W>-1?W:f.length-1),Z;return X>-1&&(W===-1||X<W)?(Z=f.substring(0,X).split(":"),I.username=Z[0]?o.decode(Z[0]):null,Z.shift(),I.password=Z[0]?o.decode(Z.join(":")):null,f=F.substring(X+1)):(I.username=null,I.password=null),f},o.parseQuery=function(f,I){if(!f)return{};if(f=f.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!f)return{};for(var F={},G=f.split("&"),W=G.length,X,Z,$,ne=0;ne<W;ne++)X=G[ne].split("="),Z=o.decodeQuery(X.shift(),I),$=X.length?o.decodeQuery(X.join("="),I):null,Z!=="__proto__"&&(u.call(F,Z)?((typeof F[Z]=="string"||F[Z]===null)&&(F[Z]=[F[Z]]),F[Z].push($)):F[Z]=$);return F},o.build=function(f){var I="",F=!1;return f.protocol&&(I+=f.protocol+":"),!f.urn&&(I||f.hostname)&&(I+="//",F=!0),I+=o.buildAuthority(f)||"",typeof f.path=="string"&&(f.path.charAt(0)!=="/"&&F&&(I+="/"),I+=f.path),typeof f.query=="string"&&f.query&&(I+="?"+f.query),typeof f.fragment=="string"&&f.fragment&&(I+="#"+f.fragment),I},o.buildHost=function(f){var I="";if(f.hostname)o.ip6_expression.test(f.hostname)?I+="["+f.hostname+"]":I+=f.hostname;else return"";return f.port&&(I+=":"+f.port),I},o.buildAuthority=function(f){return o.buildUserinfo(f)+o.buildHost(f)},o.buildUserinfo=function(f){var I="";return f.username&&(I+=o.encode(f.username)),f.password&&(I+=":"+o.encode(f.password)),I&&(I+="@"),I},o.buildQuery=function(f,I,F){var G="",W,X,Z,$;for(X in f)if(X!=="__proto__"&&u.call(f,X))if(p(f[X]))for(W={},Z=0,$=f[X].length;Z<$;Z++)f[X][Z]!==void 0&&W[f[X][Z]+""]===void 0&&(G+="&"+o.buildQueryParameter(X,f[X][Z],F),I!==!0&&(W[f[X][Z]+""]=!0));else f[X]!==void 0&&(G+="&"+o.buildQueryParameter(X,f[X],F));return G.substring(1)},o.buildQueryParameter=function(f,I,F){return o.encodeQuery(f,F)+(I!==null?"="+o.encodeQuery(I,F):"")},o.addQuery=function(f,I,F){if(typeof I=="object")for(var G in I)u.call(I,G)&&o.addQuery(f,G,I[G]);else if(typeof I=="string"){if(f[I]===void 0){f[I]=F;return}else typeof f[I]=="string"&&(f[I]=[f[I]]);p(F)||(F=[F]),f[I]=(f[I]||[]).concat(F)}else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")},o.setQuery=function(f,I,F){if(typeof I=="object")for(var G in I)u.call(I,G)&&o.setQuery(f,G,I[G]);else if(typeof I=="string")f[I]=F===void 0?null:F;else throw new TypeError("URI.setQuery() accepts an object, string as the name parameter")},o.removeQuery=function(f,I,F){var G,W,X;if(p(I))for(G=0,W=I.length;G<W;G++)f[I[G]]=void 0;else if(d(I)==="RegExp")for(X in f)I.test(X)&&(f[X]=void 0);else if(typeof I=="object")for(X in I)u.call(I,X)&&o.removeQuery(f,X,I[X]);else if(typeof I=="string")F!==void 0?d(F)==="RegExp"?!p(f[I])&&F.test(f[I])?f[I]=void 0:f[I]=g(f[I],F):f[I]===String(F)&&(!p(F)||F.length===1)?f[I]=void 0:p(f[I])&&(f[I]=g(f[I],F)):f[I]=void 0;else throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter")},o.hasQuery=function(f,I,F,G){switch(d(I)){case"String":break;case"RegExp":for(var W in f)if(u.call(f,W)&&I.test(W)&&(F===void 0||o.hasQuery(f,W,F)))return!0;return!1;case"Object":for(var X in I)if(u.call(I,X)&&!o.hasQuery(f,X,I[X]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(d(F)){case"Undefined":return I in f;case"Boolean":var Z=!!(p(f[I])?f[I].length:f[I]);return F===Z;case"Function":return!!F(f[I],I,f);case"Array":if(!p(f[I]))return!1;var $=G?_:b;return $(f[I],F);case"RegExp":return p(f[I])?G?_(f[I],F):!1:!!(f[I]&&f[I].match(F));case"Number":F=String(F);case"String":return p(f[I])?G?_(f[I],F):!1:f[I]===F;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},o.joinPaths=function(){for(var f=[],I=[],F=0,G=0;G<arguments.length;G++){var W=new o(arguments[G]);f.push(W);for(var X=W.segment(),Z=0;Z<X.length;Z++)typeof X[Z]=="string"&&I.push(X[Z]),X[Z]&&F++}if(!I.length||!F)return new o("");var $=new o("").segment(I);return(f[0].path()===""||f[0].path().slice(0,1)==="/")&&$.path("/"+$.path()),$.normalize()},o.commonPath=function(f,I){var F=Math.min(f.length,I.length),G;for(G=0;G<F;G++)if(f.charAt(G)!==I.charAt(G)){G--;break}return G<1?f.charAt(0)===I.charAt(0)&&f.charAt(0)==="/"?"/":"":((f.charAt(G)!=="/"||I.charAt(G)!=="/")&&(G=f.substring(0,G).lastIndexOf("/")),f.substring(0,G+1))},o.withinString=function(f,I,F){F||(F={});var G=F.start||o.findUri.start,W=F.end||o.findUri.end,X=F.trim||o.findUri.trim,Z=F.parens||o.findUri.parens,$=/[a-z0-9-]=["']?$/i;for(G.lastIndex=0;;){var ne=G.exec(f);if(!ne)break;var le=ne.index;if(F.ignoreHtml){var pe=f.slice(Math.max(le-3,0),le);if(pe&&$.test(pe))continue}for(var we=le+f.slice(le).search(W),me=f.slice(le,we),Pe=-1;;){var ot=Z.exec(me);if(!ot)break;var At=ot.index+ot[0].length;Pe=Math.max(Pe,At)}if(Pe>-1?me=me.slice(0,Pe)+me.slice(Pe).replace(X,""):me=me.replace(X,""),!(me.length<=ne[0].length)&&!(F.ignore&&F.ignore.test(me))){we=le+me.length;var St=I(me,le,we,f);if(St===void 0){G.lastIndex=we;continue}St=String(St),f=f.slice(0,le)+St+f.slice(we),G.lastIndex=le+St.length}}return G.lastIndex=0,f},o.ensureValidHostname=function(f,I){var F=!!f,G=!!I,W=!1;if(G&&(W=_(o.hostProtocols,I)),W&&!F)throw new TypeError("Hostname cannot be empty, if protocol is "+I);if(f&&f.match(o.invalid_hostname_characters)){if(!t)throw new TypeError('Hostname "'+f+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(t.toASCII(f).match(o.invalid_hostname_characters))throw new TypeError('Hostname "'+f+'" contains characters other than [A-Z0-9.-:_]')}},o.ensureValidPort=function(f){if(f){var I=Number(f);if(!(a(I)&&I>0&&I<65536))throw new TypeError('Port "'+f+'" is not a valid port')}},o.noConflict=function(f){if(f){var I={URI:this.noConflict()};return r.URITemplate&&typeof r.URITemplate.noConflict=="function"&&(I.URITemplate=r.URITemplate.noConflict()),r.IPv6&&typeof r.IPv6.noConflict=="function"&&(I.IPv6=r.IPv6.noConflict()),r.SecondLevelDomains&&typeof r.SecondLevelDomains.noConflict=="function"&&(I.SecondLevelDomains=r.SecondLevelDomains.noConflict()),I}else r.URI===this&&(r.URI=s);return this},c.build=function(f){return f===!0?this._deferred_build=!0:(f===void 0||this._deferred_build)&&(this._string=o.build(this._parts),this._deferred_build=!1),this},c.clone=function(){return new o(this)},c.valueOf=c.toString=function(){return this.build(!1)._string};function L(f){return function(I,F){return I===void 0?this._parts[f]||"":(this._parts[f]=I||null,this.build(!F),this)}}function O(f,I){return function(F,G){return F===void 0?this._parts[f]||"":(F!==null&&(F=F+"",F.charAt(0)===I&&(F=F.substring(1))),this._parts[f]=F,this.build(!G),this)}}c.protocol=L("protocol"),c.username=L("username"),c.password=L("password"),c.hostname=L("hostname"),c.port=L("port"),c.query=O("query","?"),c.fragment=O("fragment","#"),c.search=function(f,I){var F=this.query(f,I);return typeof F=="string"&&F.length?"?"+F:F},c.hash=function(f,I){var F=this.fragment(f,I);return typeof F=="string"&&F.length?"#"+F:F},c.pathname=function(f,I){if(f===void 0||f===!0){var F=this._parts.path||(this._parts.hostname?"/":"");return f?(this._parts.urn?o.decodeUrnPath:o.decodePath)(F):F}else return this._parts.urn?this._parts.path=f?o.recodeUrnPath(f):"":this._parts.path=f?o.recodePath(f):"/",this.build(!I),this},c.path=c.pathname,c.href=function(f,I){var F;if(f===void 0)return this.toString();this._string="",this._parts=o._parts();var G=f instanceof o,W=typeof f=="object"&&(f.hostname||f.path||f.pathname);if(f.nodeName){var X=o.getDomAttribute(f);f=f[X]||"",W=!1}if(!G&&W&&f.pathname!==void 0&&(f=f.toString()),typeof f=="string"||f instanceof String)this._parts=o.parse(String(f),this._parts);else if(G||W){var Z=G?f._parts:f;for(F in Z)F!=="query"&&u.call(this._parts,F)&&(this._parts[F]=Z[F]);Z.query&&this.query(Z.query,!1)}else throw new TypeError("invalid input");return this.build(!I),this},c.is=function(f){var I=!1,F=!1,G=!1,W=!1,X=!1,Z=!1,$=!1,ne=!this._parts.urn;switch(this._parts.hostname&&(ne=!1,F=o.ip4_expression.test(this._parts.hostname),G=o.ip6_expression.test(this._parts.hostname),I=F||G,W=!I,X=W&&i&&i.has(this._parts.hostname),Z=W&&o.idn_expression.test(this._parts.hostname),$=W&&o.punycode_expression.test(this._parts.hostname)),f.toLowerCase()){case"relative":return ne;case"absolute":return!ne;case"domain":case"name":return W;case"sld":return X;case"ip":return I;case"ip4":case"ipv4":case"inet4":return F;case"ip6":case"ipv6":case"inet6":return G;case"idn":return Z;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return $}return null};var N=c.protocol,B=c.port,U=c.hostname;c.protocol=function(f,I){if(f&&(f=f.replace(/:(\/\/)?$/,""),!f.match(o.protocol_expression)))throw new TypeError('Protocol "'+f+`" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]`);return N.call(this,f,I)},c.scheme=c.protocol,c.port=function(f,I){return this._parts.urn?f===void 0?"":this:(f!==void 0&&(f===0&&(f=null),f&&(f+="",f.charAt(0)===":"&&(f=f.substring(1)),o.ensureValidPort(f))),B.call(this,f,I))},c.hostname=function(f,I){if(this._parts.urn)return f===void 0?"":this;if(f!==void 0){var F={preventInvalidHostname:this._parts.preventInvalidHostname},G=o.parseHost(f,F);if(G!=="/")throw new TypeError('Hostname "'+f+'" contains characters other than [A-Z0-9.-]');f=F.hostname,this._parts.preventInvalidHostname&&o.ensureValidHostname(f,this._parts.protocol)}return U.call(this,f,I)},c.origin=function(f,I){if(this._parts.urn)return f===void 0?"":this;if(f===void 0){var F=this.protocol(),G=this.authority();return G?(F?F+"://":"")+this.authority():""}else{var W=o(f);return this.protocol(W.protocol()).authority(W.authority()).build(!I),this}},c.host=function(f,I){if(this._parts.urn)return f===void 0?"":this;if(f===void 0)return this._parts.hostname?o.buildHost(this._parts):"";var F=o.parseHost(f,this._parts);if(F!=="/")throw new TypeError('Hostname "'+f+'" contains characters other than [A-Z0-9.-]');return this.build(!I),this},c.authority=function(f,I){if(this._parts.urn)return f===void 0?"":this;if(f===void 0)return this._parts.hostname?o.buildAuthority(this._parts):"";var F=o.parseAuthority(f,this._parts);if(F!=="/")throw new TypeError('Hostname "'+f+'" contains characters other than [A-Z0-9.-]');return this.build(!I),this},c.userinfo=function(f,I){if(this._parts.urn)return f===void 0?"":this;if(f===void 0){var F=o.buildUserinfo(this._parts);return F&&F.substring(0,F.length-1)}else return f[f.length-1]!=="@"&&(f+="@"),o.parseUserinfo(f,this._parts),this.build(!I),this},c.resource=function(f,I){var F;return f===void 0?this.path()+this.search()+this.hash():(F=o.parse(f),this._parts.path=F.path,this._parts.query=F.query,this._parts.fragment=F.fragment,this.build(!I),this)},c.subdomain=function(f,I){if(this._parts.urn)return f===void 0?"":this;if(f===void 0){if(!this._parts.hostname||this.is("IP"))return"";var F=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,F)||""}else{var G=this._parts.hostname.length-this.domain().length,W=this._parts.hostname.substring(0,G),X=new RegExp("^"+h(W));if(f&&f.charAt(f.length-1)!=="."&&(f+="."),f.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");return f&&o.ensureValidHostname(f,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(X,f),this.build(!I),this}},c.domain=function(f,I){if(this._parts.urn)return f===void 0?"":this;if(typeof f=="boolean"&&(I=f,f=void 0),f===void 0){if(!this._parts.hostname||this.is("IP"))return"";var F=this._parts.hostname.match(/\./g);if(F&&F.length<2)return this._parts.hostname;var G=this._parts.hostname.length-this.tld(I).length-1;return G=this._parts.hostname.lastIndexOf(".",G-1)+1,this._parts.hostname.substring(G)||""}else{if(!f)throw new TypeError("cannot set domain empty");if(f.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");if(o.ensureValidHostname(f,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=f;else{var W=new RegExp(h(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(W,f)}return this.build(!I),this}},c.tld=function(f,I){if(this._parts.urn)return f===void 0?"":this;if(typeof f=="boolean"&&(I=f,f=void 0),f===void 0){if(!this._parts.hostname||this.is("IP"))return"";var F=this._parts.hostname.lastIndexOf("."),G=this._parts.hostname.substring(F+1);return I!==!0&&i&&i.list[G.toLowerCase()]&&i.get(this._parts.hostname)||G}else{var W;if(f)if(f.match(/[^a-zA-Z0-9-]/))if(i&&i.is(f))W=new RegExp(h(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(W,f);else throw new TypeError('TLD "'+f+'" contains characters other than [A-Z0-9]');else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");W=new RegExp(h(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(W,f)}else throw new TypeError("cannot set TLD empty");return this.build(!I),this}},c.directory=function(f,I){if(this._parts.urn)return f===void 0?"":this;if(f===void 0||f===!0){if(!this._parts.path&&!this._parts.hostname)return"";if(this._parts.path==="/")return"/";var F=this._parts.path.length-this.filename().length-1,G=this._parts.path.substring(0,F)||(this._parts.hostname?"/":"");return f?o.decodePath(G):G}else{var W=this._parts.path.length-this.filename().length,X=this._parts.path.substring(0,W),Z=new RegExp("^"+h(X));return this.is("relative")||(f||(f="/"),f.charAt(0)!=="/"&&(f="/"+f)),f&&f.charAt(f.length-1)!=="/"&&(f+="/"),f=o.recodePath(f),this._parts.path=this._parts.path.replace(Z,f),this.build(!I),this}},c.filename=function(f,I){if(this._parts.urn)return f===void 0?"":this;if(typeof f!="string"){if(!this._parts.path||this._parts.path==="/")return"";var F=this._parts.path.lastIndexOf("/"),G=this._parts.path.substring(F+1);return f?o.decodePathSegment(G):G}else{var W=!1;f.charAt(0)==="/"&&(f=f.substring(1)),f.match(/\.?\//)&&(W=!0);var X=new RegExp(h(this.filename())+"$");return f=o.recodePath(f),this._parts.path=this._parts.path.replace(X,f),W?this.normalizePath(I):this.build(!I),this}},c.suffix=function(f,I){if(this._parts.urn)return f===void 0?"":this;if(f===void 0||f===!0){if(!this._parts.path||this._parts.path==="/")return"";var F=this.filename(),G=F.lastIndexOf("."),W,X;return G===-1?"":(W=F.substring(G+1),X=/^[a-z0-9%]+$/i.test(W)?W:"",f?o.decodePathSegment(X):X)}else{f.charAt(0)==="."&&(f=f.substring(1));var Z=this.suffix(),$;if(Z)f?$=new RegExp(h(Z)+"$"):$=new RegExp(h("."+Z)+"$");else{if(!f)return this;this._parts.path+="."+o.recodePath(f)}return $&&(f=o.recodePath(f),this._parts.path=this._parts.path.replace($,f)),this.build(!I),this}},c.segment=function(f,I,F){var G=this._parts.urn?":":"/",W=this.path(),X=W.substring(0,1)==="/",Z=W.split(G);if(f!==void 0&&typeof f!="number"&&(F=I,I=f,f=void 0),f!==void 0&&typeof f!="number")throw new Error('Bad segment "'+f+'", must be 0-based integer');if(X&&Z.shift(),f<0&&(f=Math.max(Z.length+f,0)),I===void 0)return f===void 0?Z:Z[f];if(f===null||Z[f]===void 0)if(p(I)){Z=[];for(var $=0,ne=I.length;$<ne;$++)!I[$].length&&(!Z.length||!Z[Z.length-1].length)||(Z.length&&!Z[Z.length-1].length&&Z.pop(),Z.push(x(I[$])))}else(I||typeof I=="string")&&(I=x(I),Z[Z.length-1]===""?Z[Z.length-1]=I:Z.push(I));else I?Z[f]=x(I):Z.splice(f,1);return X&&Z.unshift(""),this.path(Z.join(G),F)},c.segmentCoded=function(f,I,F){var G,W,X;if(typeof f!="number"&&(F=I,I=f,f=void 0),I===void 0){if(G=this.segment(f,I,F),!p(G))G=G!==void 0?o.decode(G):void 0;else for(W=0,X=G.length;W<X;W++)G[W]=o.decode(G[W]);return G}if(!p(I))I=typeof I=="string"||I instanceof String?o.encode(I):I;else for(W=0,X=I.length;W<X;W++)I[W]=o.encode(I[W]);return this.segment(f,I,F)};var V=c.query;return c.query=function(f,I){if(f===!0)return o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof f=="function"){var F=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace),G=f.call(this,F);return this._parts.query=o.buildQuery(G||F,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!I),this}else return f!==void 0&&typeof f!="string"?(this._parts.query=o.buildQuery(f,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!I),this):V.call(this,f,I)},c.setQuery=function(f,I,F){var G=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof f=="string"||f instanceof String)G[f]=I!==void 0?I:null;else if(typeof f=="object")for(var W in f)u.call(f,W)&&(G[W]=f[W]);else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");return this._parts.query=o.buildQuery(G,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof f!="string"&&(F=I),this.build(!F),this},c.addQuery=function(f,I,F){var G=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.addQuery(G,f,I===void 0?null:I),this._parts.query=o.buildQuery(G,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof f!="string"&&(F=I),this.build(!F),this},c.removeQuery=function(f,I,F){var G=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.removeQuery(G,f,I),this._parts.query=o.buildQuery(G,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof f!="string"&&(F=I),this.build(!F),this},c.hasQuery=function(f,I,F){var G=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.hasQuery(G,f,I,F)},c.setSearch=c.setQuery,c.addSearch=c.addQuery,c.removeSearch=c.removeQuery,c.hasSearch=c.hasQuery,c.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},c.normalizeProtocol=function(f){return typeof this._parts.protocol=="string"&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!f)),this},c.normalizeHostname=function(f){return this._parts.hostname&&(this.is("IDN")&&t?this._parts.hostname=t.toASCII(this._parts.hostname):this.is("IPv6")&&n&&(this._parts.hostname=n.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!f)),this},c.normalizePort=function(f){return typeof this._parts.protocol=="string"&&this._parts.port===o.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!f)),this},c.normalizePath=function(f){var I=this._parts.path;if(!I)return this;if(this._parts.urn)return this._parts.path=o.recodeUrnPath(this._parts.path),this.build(!f),this;if(this._parts.path==="/")return this;I=o.recodePath(I);var F,G="",W,X;for(I.charAt(0)!=="/"&&(F=!0,I="/"+I),(I.slice(-3)==="/.."||I.slice(-2)==="/.")&&(I+="/"),I=I.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),F&&(G=I.substring(1).match(/^(\.\.\/)+/)||"",G&&(G=G[0]));W=I.search(/\/\.\.(\/|$)/),W!==-1;){if(W===0){I=I.substring(3);continue}X=I.substring(0,W).lastIndexOf("/"),X===-1&&(X=W),I=I.substring(0,X)+I.substring(W+3)}return F&&this.is("relative")&&(I=G+I.substring(1)),this._parts.path=I,this.build(!f),this},c.normalizePathname=c.normalizePath,c.normalizeQuery=function(f){return typeof this._parts.query=="string"&&(this._parts.query.length?this.query(o.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!f)),this},c.normalizeFragment=function(f){return this._parts.fragment||(this._parts.fragment=null,this.build(!f)),this},c.normalizeSearch=c.normalizeQuery,c.normalizeHash=c.normalizeFragment,c.iso8859=function(){var f=o.encode,I=o.decode;o.encode=escape,o.decode=decodeURIComponent;try{this.normalize()}finally{o.encode=f,o.decode=I}return this},c.unicode=function(){var f=o.encode,I=o.decode;o.encode=C,o.decode=unescape;try{this.normalize()}finally{o.encode=f,o.decode=I}return this},c.readable=function(){var f=this.clone();f.username("").password("").normalize();var I="";if(f._parts.protocol&&(I+=f._parts.protocol+"://"),f._parts.hostname&&(f.is("punycode")&&t?(I+=t.toUnicode(f._parts.hostname),f._parts.port&&(I+=":"+f._parts.port)):I+=f.host()),f._parts.hostname&&f._parts.path&&f._parts.path.charAt(0)!=="/"&&(I+="/"),I+=f.path(!0),f._parts.query){for(var F="",G=0,W=f._parts.query.split("&"),X=W.length;G<X;G++){var Z=(W[G]||"").split("=");F+="&"+o.decodeQuery(Z[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),Z[1]!==void 0&&(F+="="+o.decodeQuery(Z[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}I+="?"+F.substring(1)}return I+=o.decodeQuery(f.hash(),!0),I},c.absoluteTo=function(f){var I=this.clone(),F=["protocol","username","password","hostname","port"],G,W,X;if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(f instanceof o||(f=new o(f)),I._parts.protocol||(I._parts.protocol=f._parts.protocol,this._parts.hostname))return I;for(W=0;X=F[W];W++)I._parts[X]=f._parts[X];return I._parts.path?(I._parts.path.substring(-2)===".."&&(I._parts.path+="/"),I.path().charAt(0)!=="/"&&(G=f.directory(),G=G||(f.path().indexOf("/")===0?"/":""),I._parts.path=(G?G+"/":"")+I._parts.path,I.normalizePath())):(I._parts.path=f._parts.path,I._parts.query||(I._parts.query=f._parts.query)),I.build(),I},c.relativeTo=function(f){var I=this.clone().normalize(),F,G,W,X,Z;if(I._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(f=new o(f).normalize(),F=I._parts,G=f._parts,X=I.path(),Z=f.path(),X.charAt(0)!=="/")throw new Error("URI is already relative");if(Z.charAt(0)!=="/")throw new Error("Cannot calculate a URI relative to another relative URI");if(F.protocol===G.protocol&&(F.protocol=null),F.username!==G.username||F.password!==G.password||F.protocol!==null||F.username!==null||F.password!==null)return I.build();if(F.hostname===G.hostname&&F.port===G.port)F.hostname=null,F.port=null;else return I.build();if(X===Z)return F.path="",I.build();if(W=o.commonPath(X,Z),!W)return I.build();var $=G.path.substring(W.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return F.path=$+F.path.substring(W.length)||"./",I.build()},c.equals=function(f){var I=this.clone(),F=new o(f),G={},W={},X={},Z,$,ne;if(I.normalize(),F.normalize(),I.toString()===F.toString())return!0;if(Z=I.query(),$=F.query(),I.query(""),F.query(""),I.toString()!==F.toString()||Z.length!==$.length)return!1;G=o.parseQuery(Z,this._parts.escapeQuerySpace),W=o.parseQuery($,this._parts.escapeQuerySpace);for(ne in G)if(u.call(G,ne)){if(p(G[ne])){if(!b(G[ne],W[ne]))return!1}else if(G[ne]!==W[ne])return!1;X[ne]=!0}for(ne in W)if(u.call(W,ne)&&!X[ne])return!1;return!0},c.preventInvalidHostname=function(f){return this._parts.preventInvalidHostname=!!f,this},c.duplicateQueryParameters=function(f){return this._parts.duplicateQueryParameters=!!f,this},c.escapeQuerySpace=function(f){return this._parts.escapeQuerySpace=!!f,this},o})})(_M);var ZH=_M.exports;const Do=Th(ZH);function JH(e){return(e.length===0||e[e.length-1]!=="/")&&(e=`${e}/`),e}function Se(e,t){if(e===null||typeof e!="object")return e;t=T(t,!1);const n=new e.constructor;for(const i in e)if(e.hasOwnProperty(i)){let r=e[i];t&&(r=Se(r,t)),n[i]=r}return n}function wt(e,t,n){n=T(n,!1);const i={},r=l(e),s=l(t);let o,a,c;if(r)for(o in e)e.hasOwnProperty(o)&&(a=e[o],s&&n&&typeof a=="object"&&t.hasOwnProperty(o)?(c=t[o],typeof c=="object"?i[o]=wt(a,c,n):i[o]=a):i[o]=a);if(s)for(o in t)t.hasOwnProperty(o)&&!i.hasOwnProperty(o)&&(c=t[o],i[o]=c);return i}function Yp(){let e,t;const n=new Promise(function(i,r){e=i,t=r});return{resolve:e,reject:t,promise:n}}function zy(e,t){let n;return typeof document<"u"&&(n=document),zy._implementation(e,t,n)}zy._implementation=function(e,t,n){if(!l(e))throw new A("relative uri is required.");if(!l(t)){if(typeof n>"u")return e;t=T(n.baseURI,n.location.href)}const i=new Do(e);return i.scheme()!==""?i.toString():i.absoluteTo(t).toString()};function QH(e,t){if(!l(e))throw new A("uri is required.");let n="";const i=e.lastIndexOf("/");return i!==-1&&(n=e.substring(0,i+1)),t&&(e=new Do(e),e.query().length!==0&&(n+=`?${e.query()}`),e.fragment().length!==0&&(n+=`#${e.fragment()}`)),n}function eq(e){if(!l(e))throw new A("uri is required.");const t=new Do(e);t.normalize();let n=t.path(),i=n.lastIndexOf("/");return i!==-1&&(n=n.substr(i+1)),i=n.lastIndexOf("."),i===-1?n="":n=n.substr(i+1),n}const pv={};function z_(e,t,n){l(t)||(t=e.width),l(n)||(n=e.height);let i=pv[t];l(i)||(i={},pv[t]=i);let r=i[n];if(!l(r)){const s=document.createElement("canvas");s.width=t,s.height=n,r=s.getContext("2d",{willReadFrequently:!0}),r.globalCompositeOperation="copy",i[n]=r}return r.drawImage(e,0,0,t,n),r.getImageData(0,0,t,n).data}const tq=/^blob:/i;function yM(e){return y.typeOf.string("uri",e),tq.test(e)}let Ko;function Fx(e){l(Ko)||(Ko=document.createElement("a")),Ko.href=window.location.href;const t=Ko.host,n=Ko.protocol;return Ko.href=e,Ko.href=Ko.href,n!==Ko.protocol||t!==Ko.host}const nq=/^data:/i;function RC(e){return y.typeOf.string("uri",e),nq.test(e)}function iq(e){const t=document.createElement("script");return t.async=!0,t.src=e,new Promise((n,i)=>{window.crossOriginIsolated&&t.setAttribute("crossorigin","anonymous");const r=document.getElementsByTagName("head")[0];t.onload=function(){t.onload=void 0,r.removeChild(t),n()},t.onerror=function(s){i(s)},r.appendChild(t)})}function rq(e){if(!l(e))throw new A("obj is required.");let t="";for(const n in e)if(e.hasOwnProperty(n)){const i=e[n],r=`${encodeURIComponent(n)}=`;if(Array.isArray(i))for(let s=0,o=i.length;s<o;++s)t+=`${r+encodeURIComponent(i[s])}&`;else t+=`${r+encodeURIComponent(i)}&`}return t=t.slice(0,-1),t}function sq(e){if(!l(e))throw new A("queryString is required.");const t={};if(e==="")return t;const n=e.replace(/\+/g,"%20").split(/[&;]/);for(let i=0,r=n.length;i<r;++i){const s=n[i].split("="),o=decodeURIComponent(s[0]);let a=s[1];l(a)?a=decodeURIComponent(a):a="";const c=t[o];typeof c=="string"?t[o]=[c,a]:Array.isArray(c)?c.push(a):t[o]=a}return t}const oq={UNISSUED:0,ISSUED:1,ACTIVE:2,RECEIVED:3,CANCELLED:4,FAILED:5},En=Object.freeze(oq),aq={TERRAIN:0,IMAGERY:1,TILES3D:2,OTHER:3},Kp=Object.freeze(aq);function Tl(e){e=T(e,T.EMPTY_OBJECT);const t=T(e.throttleByServer,!1),n=T(e.throttle,!1);this.url=e.url,this.requestFunction=e.requestFunction,this.cancelFunction=e.cancelFunction,this.priorityFunction=e.priorityFunction,this.priority=T(e.priority,0),this.throttle=n,this.throttleByServer=t,this.type=T(e.type,Kp.OTHER),this.serverKey=e.serverKey,this.state=En.UNISSUED,this.deferred=void 0,this.cancelled=!1}Tl.prototype.cancel=function(){this.cancelled=!0};Tl.prototype.clone=function(e){return l(e)?(e.url=this.url,e.requestFunction=this.requestFunction,e.cancelFunction=this.cancelFunction,e.priorityFunction=this.priorityFunction,e.priority=this.priority,e.throttle=this.throttle,e.throttleByServer=this.throttleByServer,e.type=this.type,e.serverKey=this.serverKey,e.state=En.UNISSUED,e.deferred=void 0,e.cancelled=!1,e):new Tl(this)};function cq(e){const t={};if(!e)return t;const n=e.split(`\r
`);for(let i=0;i<n.length;++i){const r=n[i],s=r.indexOf(": ");if(s>0){const o=r.substring(0,s),a=r.substring(s+2);t[o]=a}}return t}function sh(e,t,n){this.statusCode=e,this.response=t,this.responseHeaders=n,typeof this.responseHeaders=="string"&&(this.responseHeaders=cq(this.responseHeaders))}sh.prototype.toString=function(){let e="Request has failed.";return l(this.statusCode)&&(e+=` Status Code: ${this.statusCode}`),e};function jt(){this._listeners=[],this._scopes=[],this._toRemove=[],this._insideRaiseEvent=!1}Object.defineProperties(jt.prototype,{numberOfListeners:{get:function(){return this._listeners.length-this._toRemove.length}}});jt.prototype.addEventListener=function(e,t){y.typeOf.func("listener",e),this._listeners.push(e),this._scopes.push(t);const n=this;return function(){n.removeEventListener(e,t)}};jt.prototype.removeEventListener=function(e,t){y.typeOf.func("listener",e);const n=this._listeners,i=this._scopes;let r=-1;for(let s=0;s<n.length;s++)if(n[s]===e&&i[s]===t){r=s;break}return r!==-1?(this._insideRaiseEvent?(this._toRemove.push(r),n[r]=void 0,i[r]=void 0):(n.splice(r,1),i.splice(r,1)),!0):!1};function lq(e,t){return t-e}jt.prototype.raiseEvent=function(){this._insideRaiseEvent=!0;let e;const t=this._listeners,n=this._scopes;let i=t.length;for(e=0;e<i;e++){const s=t[e];l(s)&&t[e].apply(n[e],arguments)}const r=this._toRemove;if(i=r.length,i>0){for(r.sort(lq),e=0;e<i;e++){const s=r[e];t.splice(s,1),n.splice(s,1)}r.length=0}this._insideRaiseEvent=!1};function Mu(e){y.typeOf.object("options",e),y.defined("options.comparator",e.comparator),this._comparator=e.comparator,this._array=[],this._length=0,this._maximumLength=void 0}Object.defineProperties(Mu.prototype,{length:{get:function(){return this._length}},internalArray:{get:function(){return this._array}},maximumLength:{get:function(){return this._maximumLength},set:function(e){y.typeOf.number.greaterThanOrEquals("maximumLength",e,0);const t=this._length;if(e<t){const n=this._array;for(let i=e;i<t;++i)n[i]=void 0;this._length=e,n.length=e}this._maximumLength=e}},comparator:{get:function(){return this._comparator}}});function DC(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}Mu.prototype.reserve=function(e){e=T(e,this._length),this._array.length=e};Mu.prototype.heapify=function(e){e=T(e,0);const t=this._length,n=this._comparator,i=this._array;let r=-1,s=!0;for(;s;){const o=2*(e+1),a=o-1;a<t&&n(i[a],i[e])<0?r=a:r=e,o<t&&n(i[o],i[r])<0&&(r=o),r!==e?(DC(i,r,e),e=r):s=!1}};Mu.prototype.resort=function(){const e=this._length;for(let t=Math.ceil(e/2);t>=0;--t)this.heapify(t)};Mu.prototype.insert=function(e){y.defined("element",e);const t=this._array,n=this._comparator,i=this._maximumLength;let r=this._length++;for(r<t.length?t[r]=e:t.push(e);r!==0;){const o=Math.floor((r-1)/2);if(n(t[r],t[o])<0)DC(t,r,o),r=o;else break}let s;return l(i)&&this._length>i&&(s=t[i],this._length=i),s};Mu.prototype.pop=function(e){if(e=T(e,0),this._length===0)return;y.typeOf.number.lessThan("index",e,this._length);const t=this._array,n=t[e];return DC(t,e,--this._length),this.heapify(e),t[this._length]=void 0,n};function uq(e,t){return e.priority-t.priority}const Wt={numberOfAttemptedRequests:0,numberOfActiveRequests:0,numberOfCancelledRequests:0,numberOfCancelledActiveRequests:0,numberOfFailedRequests:0,numberOfActiveRequestsEver:0,lastNumberOfActiveRequests:0};let jf=20;const yr=new Mu({comparator:uq});yr.maximumLength=jf;yr.reserve(jf);const na=[];let ic={};const fq=typeof document<"u"?new Do(document.location.href):new Do,Uy=new jt;function Jt(){}Jt.maximumRequests=50;Jt.maximumRequestsPerServer=18;Jt.requestsByServer={};Jt.throttleRequests=!0;Jt.debugShowStatistics=!1;Jt.requestCompletedEvent=Uy;Object.defineProperties(Jt,{statistics:{get:function(){return Wt}},priorityHeapLength:{get:function(){return jf},set:function(e){if(e<jf)for(;yr.length>e;){const t=yr.pop();pu(t)}jf=e,yr.maximumLength=e,yr.reserve(e)}}});function bM(e){l(e.priorityFunction)&&(e.priority=e.priorityFunction())}Jt.serverHasOpenSlots=function(e,t){t=T(t,1);const n=T(Jt.requestsByServer[e],Jt.maximumRequestsPerServer);return ic[e]+t<=n};Jt.heapHasOpenSlots=function(e){return yr.length+e<=jf};function TM(e){return e.state===En.UNISSUED&&(e.state=En.ISSUED,e.deferred=Yp()),e.deferred.promise}function hq(e){return function(t){if(e.state===En.CANCELLED)return;const n=e.deferred;--Wt.numberOfActiveRequests,--ic[e.serverKey],Uy.raiseEvent(),e.state=En.RECEIVED,e.deferred=void 0,n.resolve(t)}}function dq(e){return function(t){e.state!==En.CANCELLED&&(++Wt.numberOfFailedRequests,--Wt.numberOfActiveRequests,--ic[e.serverKey],Uy.raiseEvent(t),e.state=En.FAILED,e.deferred.reject(t))}}function xM(e){const t=TM(e);return e.state=En.ACTIVE,na.push(e),++Wt.numberOfActiveRequests,++Wt.numberOfActiveRequestsEver,++ic[e.serverKey],e.requestFunction().then(hq(e)).catch(dq(e)),t}function pu(e){const t=e.state===En.ACTIVE;if(e.state=En.CANCELLED,++Wt.numberOfCancelledRequests,l(e.deferred)){const n=e.deferred;e.deferred=void 0,n.reject()}t&&(--Wt.numberOfActiveRequests,--ic[e.serverKey],++Wt.numberOfCancelledActiveRequests),l(e.cancelFunction)&&e.cancelFunction()}Jt.update=function(){let e,t,n=0;const i=na.length;for(e=0;e<i;++e){if(t=na[e],t.cancelled&&pu(t),t.state!==En.ACTIVE){++n;continue}n>0&&(na[e-n]=t)}na.length-=n;const r=yr.internalArray,s=yr.length;for(e=0;e<s;++e)bM(r[e]);yr.resort();const o=Math.max(Jt.maximumRequests-na.length,0);let a=0;for(;a<o&&yr.length>0;){if(t=yr.pop(),t.cancelled){pu(t);continue}if(t.throttleByServer&&!Jt.serverHasOpenSlots(t.serverKey)){pu(t);continue}xM(t),++a}pq()};Jt.getServerKey=function(e){y.typeOf.string("url",e);let t=new Do(e);t.scheme()===""&&(t=t.absoluteTo(fq),t.normalize());let n=t.authority();/:/.test(n)||(n=`${n}:${t.scheme()==="https"?"443":"80"}`);const i=ic[n];return l(i)||(ic[n]=0),n};Jt.request=function(e){if(y.typeOf.object("request",e),y.typeOf.string("request.url",e.url),y.typeOf.func("request.requestFunction",e.requestFunction),RC(e.url)||yM(e.url))return Uy.raiseEvent(),e.state=En.RECEIVED,e.requestFunction();if(++Wt.numberOfAttemptedRequests,l(e.serverKey)||(e.serverKey=Jt.getServerKey(e.url)),Jt.throttleRequests&&e.throttleByServer&&!Jt.serverHasOpenSlots(e.serverKey))return;if(!Jt.throttleRequests||!e.throttle)return xM(e);if(na.length>=Jt.maximumRequests)return;bM(e);const t=yr.insert(e);if(l(t)){if(t===e)return;pu(t)}return TM(e)};function pq(){Jt.debugShowStatistics&&(Wt.numberOfActiveRequests===0&&Wt.lastNumberOfActiveRequests>0&&(Wt.numberOfAttemptedRequests>0&&(console.log(`Number of attempted requests: ${Wt.numberOfAttemptedRequests}`),Wt.numberOfAttemptedRequests=0),Wt.numberOfCancelledRequests>0&&(console.log(`Number of cancelled requests: ${Wt.numberOfCancelledRequests}`),Wt.numberOfCancelledRequests=0),Wt.numberOfCancelledActiveRequests>0&&(console.log(`Number of cancelled active requests: ${Wt.numberOfCancelledActiveRequests}`),Wt.numberOfCancelledActiveRequests=0),Wt.numberOfFailedRequests>0&&(console.log(`Number of failed requests: ${Wt.numberOfFailedRequests}`),Wt.numberOfFailedRequests=0)),Wt.lastNumberOfActiveRequests=Wt.numberOfActiveRequests)}Jt.clearForSpecs=function(){for(;yr.length>0;){const t=yr.pop();pu(t)}const e=na.length;for(let t=0;t<e;++t)pu(na[t]);na.length=0,ic={},Wt.numberOfAttemptedRequests=0,Wt.numberOfActiveRequests=0,Wt.numberOfCancelledRequests=0,Wt.numberOfCancelledActiveRequests=0,Wt.numberOfFailedRequests=0,Wt.numberOfActiveRequestsEver=0,Wt.lastNumberOfActiveRequests=0};Jt.numberOfActiveRequestsByServer=function(e){return ic[e]};Jt.requestHeap=yr;const vh={};let oh={};vh.add=function(e,t){if(!l(e))throw new A("host is required.");if(!l(t)||t<=0)throw new A("port is required to be greater than 0.");const n=`${e.toLowerCase()}:${t}`;l(oh[n])||(oh[n]=!0)};vh.remove=function(e,t){if(!l(e))throw new A("host is required.");if(!l(t)||t<=0)throw new A("port is required to be greater than 0.");const n=`${e.toLowerCase()}:${t}`;l(oh[n])&&delete oh[n]};function mq(e){const t=new Do(e);t.normalize();let n=t.authority();if(n.length!==0){if(t.authority(n),n.indexOf("@")!==-1&&(n=n.split("@")[1]),n.indexOf(":")===-1){let i=t.scheme();if(i.length===0&&(i=window.location.protocol,i=i.substring(0,i.length-1)),i==="http")n+=":80";else if(i==="https")n+=":443";else return}return n}}vh.contains=function(e){if(!l(e))throw new A("url is required.");const t=mq(e);return!!(l(t)&&l(oh[t]))};vh.clear=function(){oh={}};const EM=function(){try{const e=new XMLHttpRequest;return e.open("GET","#",!0),e.responseType="blob",e.responseType==="blob"}catch{return!1}}();function se(e){e=T(e,T.EMPTY_OBJECT),typeof e=="string"&&(e={url:e}),y.typeOf.string("options.url",e.url),this._url=void 0,this._templateValues=ua(e.templateValues,{}),this._queryParameters=ua(e.queryParameters,{}),this.headers=ua(e.headers,{}),this.request=T(e.request,new Tl),this.proxy=e.proxy,this.retryCallback=e.retryCallback,this.retryAttempts=T(e.retryAttempts,0),this._retryCount=0,T(e.parseUrl,!0)?this.parseUrl(e.url,!0,!0):this._url=e.url,this._credits=e.credits}function ua(e,t){return l(e)?Se(e):t}se.createIfNeeded=function(e){return e instanceof se?e.getDerivedResource({request:e.request}):typeof e!="string"?e:new se({url:e})};let Yu;se.supportsImageBitmapOptions=function(){return l(Yu)?Yu:typeof createImageBitmap!="function"?(Yu=Promise.resolve(!1),Yu):(Yu=se.fetchBlob({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAABGdBTUEAAE4g3rEiDgAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAADElEQVQI12Ng6GAAAAEUAIngE3ZiAAAAAElFTkSuQmCC"}).then(function(t){const n={imageOrientation:"flipY",premultiplyAlpha:"none",colorSpaceConversion:"none"};return Promise.all([createImageBitmap(t,n),createImageBitmap(t)])}).then(function(t){const n=z_(t[0]),i=z_(t[1]);return n[1]!==i[1]}).catch(function(){return!1}),Yu)};Object.defineProperties(se,{isBlobSupported:{get:function(){return EM}}});Object.defineProperties(se.prototype,{queryParameters:{get:function(){return this._queryParameters}},templateValues:{get:function(){return this._templateValues}},url:{get:function(){return this.getUrlComponent(!0,!0)},set:function(e){this.parseUrl(e,!1,!1)}},extension:{get:function(){return eq(this._url)}},isDataUri:{get:function(){return RC(this._url)}},isBlobUri:{get:function(){return yM(this._url)}},isCrossOriginUrl:{get:function(){return Fx(this._url)}},hasHeaders:{get:function(){return Object.keys(this.headers).length>0}},credits:{get:function(){return this._credits}}});se.prototype.toString=function(){return this.getUrlComponent(!0,!0)};se.prototype.parseUrl=function(e,t,n,i){let r=new Do(e);const s=gq(r.query());this._queryParameters=t?U_(s,this.queryParameters,n):s,r.search(""),r.fragment(""),l(i)&&r.scheme()===""&&(r=r.absoluteTo(zy(i))),this._url=r.toString()};function gq(e){return e.length===0?{}:e.indexOf("=")===-1?{[e]:void 0}:sq(e)}function U_(e,t,n){if(!n)return wt(e,t);const i=Se(e,!0);for(const r in t)if(t.hasOwnProperty(r)){let s=i[r];const o=t[r];l(s)?(Array.isArray(s)||(s=i[r]=[s]),i[r]=s.concat(o)):i[r]=Array.isArray(o)?o.slice():o}return i}se.prototype.getUrlComponent=function(e,t){if(this.isDataUri)return this._url;let n=this._url;e&&(n=`${n}${_q(this.queryParameters)}`),n=n.replace(/%7B/g,"{").replace(/%7D/g,"}");const i=this._templateValues;return Object.keys(i).length>0&&(n=n.replace(/{(.*?)}/g,function(r,s){const o=i[s];return l(o)?encodeURIComponent(o):r})),t&&l(this.proxy)&&(n=this.proxy.getURL(n)),n};function _q(e){const t=Object.keys(e);return t.length===0?"":t.length===1&&!l(e[t[0]])?`?${t[0]}`:`?${rq(e)}`}se.prototype.setQueryParameters=function(e,t){t?this._queryParameters=U_(this._queryParameters,e,!1):this._queryParameters=U_(e,this._queryParameters,!1)};se.prototype.appendQueryParameters=function(e){this._queryParameters=U_(e,this._queryParameters,!0)};se.prototype.setTemplateValues=function(e,t){t?this._templateValues=wt(this._templateValues,e):this._templateValues=wt(e,this._templateValues)};se.prototype.getDerivedResource=function(e){const t=this.clone();if(t._retryCount=0,l(e.url)){const n=T(e.preserveQueryParameters,!1);t.parseUrl(e.url,!0,n,this._url)}return l(e.queryParameters)&&(t._queryParameters=wt(e.queryParameters,t.queryParameters)),l(e.templateValues)&&(t._templateValues=wt(e.templateValues,t.templateValues)),l(e.headers)&&(t.headers=wt(e.headers,t.headers)),l(e.proxy)&&(t.proxy=e.proxy),l(e.request)&&(t.request=e.request),l(e.retryCallback)&&(t.retryCallback=e.retryCallback),l(e.retryAttempts)&&(t.retryAttempts=e.retryAttempts),t};se.prototype.retryOnError=function(e){const t=this.retryCallback;if(typeof t!="function"||this._retryCount>=this.retryAttempts)return Promise.resolve(!1);const n=this;return Promise.resolve(t(this,e)).then(function(i){return++n._retryCount,i})};se.prototype.clone=function(e){return l(e)?(e._url=this._url,e._queryParameters=Se(this._queryParameters),e._templateValues=Se(this._templateValues),e.headers=Se(this.headers),e.proxy=this.proxy,e.retryCallback=this.retryCallback,e.retryAttempts=this.retryAttempts,e._retryCount=0,e.request=this.request.clone(),e):new se({url:this._url,queryParameters:this.queryParameters,templateValues:this.templateValues,headers:this.headers,proxy:this.proxy,retryCallback:this.retryCallback,retryAttempts:this.retryAttempts,request:this.request.clone(),parseUrl:!1,credits:l(this.credits)?this.credits.slice():void 0})};se.prototype.getBaseUri=function(e){return QH(this.getUrlComponent(e),e)};se.prototype.appendForwardSlash=function(){this._url=JH(this._url)};se.prototype.fetchArrayBuffer=function(){return this.fetch({responseType:"arraybuffer"})};se.fetchArrayBuffer=function(e){return new se(e).fetchArrayBuffer()};se.prototype.fetchBlob=function(){return this.fetch({responseType:"blob"})};se.fetchBlob=function(e){return new se(e).fetchBlob()};se.prototype.fetchImage=function(e){e=T(e,T.EMPTY_OBJECT);const t=T(e.preferImageBitmap,!1),n=T(e.preferBlob,!1),i=T(e.flipY,!1),r=T(e.skipColorSpaceConversion,!1);if(MC(this.request),!EM||this.isDataUri||this.isBlobUri||!this.hasHeaders&&!n)return Bx({resource:this,flipY:i,skipColorSpaceConversion:r,preferImageBitmap:t});const s=this.fetchBlob();if(!l(s))return;let o,a,c,u;return se.supportsImageBitmapOptions().then(function(h){return o=h,a=o&&t,s}).then(function(h){if(!l(h))return;if(u=h,a)return se.createImageBitmapFromBlob(h,{flipY:i,premultiplyAlpha:!1,skipColorSpaceConversion:r});const d=window.URL.createObjectURL(h);return c=new se({url:d}),Bx({resource:c,flipY:i,skipColorSpaceConversion:r,preferImageBitmap:!1})}).then(function(h){if(l(h))return h.blob=u,a||window.URL.revokeObjectURL(c.url),h}).catch(function(h){return l(c)&&window.URL.revokeObjectURL(c.url),h.blob=u,Promise.reject(h)})};function Bx(e){const t=e.resource,n=e.flipY,i=e.skipColorSpaceConversion,r=e.preferImageBitmap,s=t.request;s.url=t.url,s.requestFunction=function(){let a=!1;!t.isDataUri&&!t.isBlobUri&&(a=t.isCrossOriginUrl);const c=Yp();return se._Implementations.createImage(s,a,c,n,i,r),c.promise};const o=Jt.request(s);if(l(o))return o.catch(function(a){return s.state!==En.FAILED?Promise.reject(a):t.retryOnError(a).then(function(c){return c?(s.state=En.UNISSUED,s.deferred=void 0,Bx({resource:t,flipY:n,skipColorSpaceConversion:i,preferImageBitmap:r})):Promise.reject(a)})})}se.fetchImage=function(e){return new se(e).fetchImage({flipY:e.flipY,skipColorSpaceConversion:e.skipColorSpaceConversion,preferBlob:e.preferBlob,preferImageBitmap:e.preferImageBitmap})};se.prototype.fetchText=function(){return this.fetch({responseType:"text"})};se.fetchText=function(e){return new se(e).fetchText()};se.prototype.fetchJson=function(){const e=this.fetch({responseType:"text",headers:{Accept:"application/json,*/*;q=0.01"}});if(l(e))return e.then(function(t){if(l(t))return JSON.parse(t)})};se.fetchJson=function(e){return new se(e).fetchJson()};se.prototype.fetchXML=function(){return this.fetch({responseType:"document",overrideMimeType:"text/xml"})};se.fetchXML=function(e){return new se(e).fetchXML()};se.prototype.fetchJsonp=function(e){e=T(e,"callback"),MC(this.request);let t;do t=`loadJsonp${R.nextRandomNumber().toString().substring(2,8)}`;while(l(window[t]));return CM(this,e,t)};function CM(e,t,n){const i={};i[t]=n,e.setQueryParameters(i);const r=e.request,s=e.url;r.url=s,r.requestFunction=function(){const a=Yp();return window[n]=function(c){a.resolve(c);try{delete window[n]}catch{window[n]=void 0}},se._Implementations.loadAndExecuteScript(s,n,a),a.promise};const o=Jt.request(r);if(l(o))return o.catch(function(a){return r.state!==En.FAILED?Promise.reject(a):e.retryOnError(a).then(function(c){return c?(r.state=En.UNISSUED,r.deferred=void 0,CM(e,t,n)):Promise.reject(a)})})}se.fetchJsonp=function(e){return new se(e).fetchJsonp(e.callbackParameterName)};se.prototype._makeRequest=function(e){const t=this;MC(t.request);const n=t.request,i=t.url;n.url=i,n.requestFunction=function(){const s=e.responseType,o=wt(e.headers,t.headers),a=e.overrideMimeType,c=e.method,u=e.data,h=Yp(),d=se._Implementations.loadWithXhr(i,s,c,u,o,h,a);return l(d)&&l(d.abort)&&(n.cancelFunction=function(){d.abort()}),h.promise};const r=Jt.request(n);if(l(r))return r.then(function(s){return n.cancelFunction=void 0,s}).catch(function(s){return n.cancelFunction=void 0,n.state!==En.FAILED?Promise.reject(s):t.retryOnError(s).then(function(o){return o?(n.state=En.UNISSUED,n.deferred=void 0,t.fetch(e)):Promise.reject(s)})})};function MC(e){if(e.state===En.ISSUED||e.state===En.ACTIVE)throw new te("The Resource is already being fetched.");e.state=En.UNISSUED,e.deferred=void 0}const yq=/^data:(.*?)(;base64)?,(.*)$/;function Zg(e,t){const n=decodeURIComponent(t);return e?atob(n):n}function mv(e,t){const n=Zg(e,t),i=new ArrayBuffer(n.length),r=new Uint8Array(i);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return i}function bq(e,t){t=T(t,"");const n=e[1],i=!!e[2],r=e[3];let s,o;switch(t){case"":case"text":return Zg(i,r);case"arraybuffer":return mv(i,r);case"blob":return s=mv(i,r),new Blob([s],{type:n});case"document":return o=new DOMParser,o.parseFromString(Zg(i,r),n);case"json":return JSON.parse(Zg(i,r));default:throw new A(`Unhandled responseType: ${t}`)}}se.prototype.fetch=function(e){return e=ua(e,{}),e.method="GET",this._makeRequest(e)};se.fetch=function(e){return new se(e).fetch({responseType:e.responseType,overrideMimeType:e.overrideMimeType})};se.prototype.delete=function(e){return e=ua(e,{}),e.method="DELETE",this._makeRequest(e)};se.delete=function(e){return new se(e).delete({responseType:e.responseType,overrideMimeType:e.overrideMimeType,data:e.data})};se.prototype.head=function(e){return e=ua(e,{}),e.method="HEAD",this._makeRequest(e)};se.head=function(e){return new se(e).head({responseType:e.responseType,overrideMimeType:e.overrideMimeType})};se.prototype.options=function(e){return e=ua(e,{}),e.method="OPTIONS",this._makeRequest(e)};se.options=function(e){return new se(e).options({responseType:e.responseType,overrideMimeType:e.overrideMimeType})};se.prototype.post=function(e,t){return y.defined("data",e),t=ua(t,{}),t.method="POST",t.data=e,this._makeRequest(t)};se.post=function(e){return new se(e).post(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})};se.prototype.put=function(e,t){return y.defined("data",e),t=ua(t,{}),t.method="PUT",t.data=e,this._makeRequest(t)};se.put=function(e){return new se(e).put(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})};se.prototype.patch=function(e,t){return y.defined("data",e),t=ua(t,{}),t.method="PATCH",t.data=e,this._makeRequest(t)};se.patch=function(e){return new se(e).patch(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})};se._Implementations={};se._Implementations.loadImageElement=function(e,t,n){const i=new Image;i.onload=function(){i.naturalWidth===0&&i.naturalHeight===0&&i.width===0&&i.height===0&&(i.width=300,i.height=150),n.resolve(i)},i.onerror=function(r){n.reject(r)},t&&(vh.contains(e)?i.crossOrigin="use-credentials":i.crossOrigin=""),i.src=e};se._Implementations.createImage=function(e,t,n,i,r,s){const o=e.url;se.supportsImageBitmapOptions().then(function(a){if(!(a&&s)){se._Implementations.loadImageElement(o,t,n);return}const c="blob",u="GET",h=Yp(),d=se._Implementations.loadWithXhr(o,c,u,void 0,void 0,h,void 0,void 0,void 0);return l(d)&&l(d.abort)&&(e.cancelFunction=function(){d.abort()}),h.promise.then(function(p){if(!l(p)){n.reject(new te(`Successfully retrieved ${o} but it contained no content.`));return}return se.createImageBitmapFromBlob(p,{flipY:i,premultiplyAlpha:!1,skipColorSpaceConversion:r})}).then(function(p){n.resolve(p)})}).catch(function(a){n.reject(a)})};se.createImageBitmapFromBlob=function(e,t){return y.defined("options",t),y.typeOf.bool("options.flipY",t.flipY),y.typeOf.bool("options.premultiplyAlpha",t.premultiplyAlpha),y.typeOf.bool("options.skipColorSpaceConversion",t.skipColorSpaceConversion),createImageBitmap(e,{imageOrientation:t.flipY?"flipY":"none",premultiplyAlpha:t.premultiplyAlpha?"premultiply":"none",colorSpaceConversion:t.skipColorSpaceConversion?"none":"default"})};function Tq(e,t,n,i,r,s,o){fetch(e,{method:n,headers:r}).then(async a=>{if(!a.ok){const c={};a.headers.forEach((u,h)=>{c[h]=u}),s.reject(new sh(a.status,a,c));return}switch(t){case"text":s.resolve(a.text());break;case"json":s.resolve(a.json());break;default:s.resolve(new Uint8Array(await a.arrayBuffer()).buffer);break}}).catch(()=>{s.reject(new sh)})}const xq=typeof XMLHttpRequest>"u";se._Implementations.loadWithXhr=function(e,t,n,i,r,s,o){const a=yq.exec(e);if(a!==null){s.resolve(bq(a,t));return}if(xq){Tq(e,t,n,i,r,s);return}const c=new XMLHttpRequest;if(vh.contains(e)&&(c.withCredentials=!0),c.open(n,e,!0),l(o)&&l(c.overrideMimeType)&&c.overrideMimeType(o),l(r))for(const h in r)r.hasOwnProperty(h)&&c.setRequestHeader(h,r[h]);l(t)&&(c.responseType=t);let u=!1;return typeof e=="string"&&(u=e.indexOf("file://")===0||typeof window<"u"&&window.location.origin==="file://"),c.onload=function(){if((c.status<200||c.status>=300)&&!(u&&c.status===0)){s.reject(new sh(c.status,c.response,c.getAllResponseHeaders()));return}const h=c.response,d=c.responseType;if(n==="HEAD"||n==="OPTIONS"){const g=c.getAllResponseHeaders().trim().split(/[\r\n]+/),_={};g.forEach(function(b){const x=b.split(": "),E=x.shift();_[E]=x.join(": ")}),s.resolve(_);return}if(c.status===204)s.resolve(void 0);else if(l(h)&&(!l(t)||d===t))s.resolve(h);else if(t==="json"&&typeof h=="string")try{s.resolve(JSON.parse(h))}catch(p){s.reject(p)}else(d===""||d==="document")&&l(c.responseXML)&&c.responseXML.hasChildNodes()?s.resolve(c.responseXML):(d===""||d==="text")&&l(c.responseText)?s.resolve(c.responseText):s.reject(new te("Invalid XMLHttpRequest response type."))},c.onerror=function(h){s.reject(new sh)},c.send(i),c};se._Implementations.loadAndExecuteScript=function(e,t,n){return iq(e).catch(function(i){n.reject(i)})};se._DefaultImplementations={};se._DefaultImplementations.createImage=se._Implementations.createImage;se._DefaultImplementations.loadWithXhr=se._Implementations.loadWithXhr;se._DefaultImplementations.loadAndExecuteScript=se._Implementations.loadAndExecuteScript;se.DEFAULT=Object.freeze(new se({url:typeof document>"u"?"":document.location.href.split("?")[0]}));function xp(e){e=T(e,T.EMPTY_OBJECT),this._dates=void 0,this._samples=void 0,this._dateColumn=-1,this._xPoleWanderRadiansColumn=-1,this._yPoleWanderRadiansColumn=-1,this._ut1MinusUtcSecondsColumn=-1,this._xCelestialPoleOffsetRadiansColumn=-1,this._yCelestialPoleOffsetRadiansColumn=-1,this._taiMinusUtcSecondsColumn=-1,this._columnCount=0,this._lastIndex=-1,this._addNewLeapSeconds=T(e.addNewLeapSeconds,!0),l(e.data)?gv(this,e.data):gv(this,{columnNames:["dateIso8601","modifiedJulianDateUtc","xPoleWanderRadians","yPoleWanderRadians","ut1MinusUtcSeconds","lengthOfDayCorrectionSeconds","xCelestialPoleOffsetRadians","yCelestialPoleOffsetRadians","taiMinusUtcSeconds"],samples:[]})}xp.fromUrl=async function(e,t){y.defined("url",e),t=T(t,T.EMPTY_OBJECT);const n=se.createIfNeeded(e);let i;try{i=await n.fetchJson()}catch{throw new te(`An error occurred while retrieving the EOP data from the URL ${n.url}.`)}return new xp({addNewLeapSeconds:t.addNewLeapSeconds,data:i})};xp.NONE=Object.freeze({compute:function(e,t){return l(t)?(t.xPoleWander=0,t.yPoleWander=0,t.xPoleOffset=0,t.yPoleOffset=0,t.ut1MinusUtc=0):t=new AC(0,0,0,0,0),t}});xp.prototype.compute=function(e,t){if(!l(this._samples))return;if(l(t)||(t=new AC(0,0,0,0,0)),this._samples.length===0)return t.xPoleWander=0,t.yPoleWander=0,t.xPoleOffset=0,t.yPoleOffset=0,t.ut1MinusUtc=0,t;const n=this._dates,i=this._lastIndex;let r=0,s=0;if(l(i)){const a=n[i],c=n[i+1],u=ue.lessThanOrEquals(a,e),h=!l(c),d=h||ue.greaterThanOrEquals(c,e);if(u&&d)return r=i,!h&&c.equals(e)&&++r,s=r+1,yv(this,n,this._samples,e,r,s,t),t}let o=Xp(n,e,ue.compare,this._dateColumn);return o>=0?(o<n.length-1&&n[o+1].equals(e)&&++o,r=o,s=o):(s=~o,r=s-1,r<0&&(r=0)),this._lastIndex=r,yv(this,n,this._samples,e,r,s,t),t};function Eq(e,t){return ue.compare(e.julianDate,t)}function gv(e,t){if(!l(t.columnNames))throw new te("Error in loaded EOP data: The columnNames property is required.");if(!l(t.samples))throw new te("Error in loaded EOP data: The samples property is required.");const n=t.columnNames.indexOf("modifiedJulianDateUtc"),i=t.columnNames.indexOf("xPoleWanderRadians"),r=t.columnNames.indexOf("yPoleWanderRadians"),s=t.columnNames.indexOf("ut1MinusUtcSeconds"),o=t.columnNames.indexOf("xCelestialPoleOffsetRadians"),a=t.columnNames.indexOf("yCelestialPoleOffsetRadians"),c=t.columnNames.indexOf("taiMinusUtcSeconds");if(n<0||i<0||r<0||s<0||o<0||a<0||c<0)throw new te("Error in loaded EOP data: The columnNames property must include modifiedJulianDateUtc, xPoleWanderRadians, yPoleWanderRadians, ut1MinusUtcSeconds, xCelestialPoleOffsetRadians, yCelestialPoleOffsetRadians, and taiMinusUtcSeconds columns");const u=e._samples=t.samples,h=e._dates=[];e._dateColumn=n,e._xPoleWanderRadiansColumn=i,e._yPoleWanderRadiansColumn=r,e._ut1MinusUtcSecondsColumn=s,e._xCelestialPoleOffsetRadiansColumn=o,e._yCelestialPoleOffsetRadiansColumn=a,e._taiMinusUtcSecondsColumn=c,e._columnCount=t.columnNames.length,e._lastIndex=void 0;let d;const p=e._addNewLeapSeconds;for(let g=0,_=u.length;g<_;g+=e._columnCount){const b=u[g+n],x=u[g+c],E=b+qn.MODIFIED_JULIAN_DATE_DIFFERENCE,C=new ue(E,x,Rt.TAI);if(h.push(C),p){if(x!==d&&l(d)){const w=ue.leapSeconds,S=Xp(w,C,Eq);if(S<0){const v=new nn(C,x);w.splice(~S,0,v)}}d=x}}}function _v(e,t,n,i,r){const s=n*i;r.xPoleWander=t[s+e._xPoleWanderRadiansColumn],r.yPoleWander=t[s+e._yPoleWanderRadiansColumn],r.xPoleOffset=t[s+e._xCelestialPoleOffsetRadiansColumn],r.yPoleOffset=t[s+e._yCelestialPoleOffsetRadiansColumn],r.ut1MinusUtc=t[s+e._ut1MinusUtcSecondsColumn]}function id(e,t,n){return t+e*(n-t)}function yv(e,t,n,i,r,s,o){const a=e._columnCount;if(s>t.length-1)return o.xPoleWander=0,o.yPoleWander=0,o.xPoleOffset=0,o.yPoleOffset=0,o.ut1MinusUtc=0,o;const c=t[r],u=t[s];if(c.equals(u)||i.equals(c))return _v(e,n,r,a,o),o;if(i.equals(u))return _v(e,n,s,a,o),o;const h=ue.secondsDifference(i,c)/ue.secondsDifference(u,c),d=r*a,p=s*a;let g=n[d+e._ut1MinusUtcSecondsColumn],_=n[p+e._ut1MinusUtcSecondsColumn];const b=_-g;if(b>.5||b<-.5){const x=n[d+e._taiMinusUtcSecondsColumn],E=n[p+e._taiMinusUtcSecondsColumn];x!==E&&(u.equals(i)?g=_:_-=E-x)}return o.xPoleWander=id(h,n[d+e._xPoleWanderRadiansColumn],n[p+e._xPoleWanderRadiansColumn]),o.yPoleWander=id(h,n[d+e._yPoleWanderRadiansColumn],n[p+e._yPoleWanderRadiansColumn]),o.xPoleOffset=id(h,n[d+e._xCelestialPoleOffsetRadiansColumn],n[p+e._xCelestialPoleOffsetRadiansColumn]),o.yPoleOffset=id(h,n[d+e._yCelestialPoleOffsetRadiansColumn],n[p+e._yCelestialPoleOffsetRadiansColumn]),o.ut1MinusUtc=id(h,g,_),o}function Wi(e,t,n){this.heading=T(e,0),this.pitch=T(t,0),this.roll=T(n,0)}Wi.fromQuaternion=function(e,t){if(!l(e))throw new A("quaternion is required");l(t)||(t=new Wi);const n=2*(e.w*e.y-e.z*e.x),i=1-2*(e.x*e.x+e.y*e.y),r=2*(e.w*e.x+e.y*e.z),s=1-2*(e.y*e.y+e.z*e.z),o=2*(e.w*e.z+e.x*e.y);return t.heading=-Math.atan2(o,s),t.roll=Math.atan2(r,i),t.pitch=-R.asinClamped(n),t};Wi.fromDegrees=function(e,t,n,i){if(!l(e))throw new A("heading is required");if(!l(t))throw new A("pitch is required");if(!l(n))throw new A("roll is required");return l(i)||(i=new Wi),i.heading=e*R.RADIANS_PER_DEGREE,i.pitch=t*R.RADIANS_PER_DEGREE,i.roll=n*R.RADIANS_PER_DEGREE,i};Wi.clone=function(e,t){if(l(e))return l(t)?(t.heading=e.heading,t.pitch=e.pitch,t.roll=e.roll,t):new Wi(e.heading,e.pitch,e.roll)};Wi.equals=function(e,t){return e===t||l(e)&&l(t)&&e.heading===t.heading&&e.pitch===t.pitch&&e.roll===t.roll};Wi.equalsEpsilon=function(e,t,n,i){return e===t||l(e)&&l(t)&&R.equalsEpsilon(e.heading,t.heading,n,i)&&R.equalsEpsilon(e.pitch,t.pitch,n,i)&&R.equalsEpsilon(e.roll,t.roll,n,i)};Wi.prototype.clone=function(e){return Wi.clone(this,e)};Wi.prototype.equals=function(e){return Wi.equals(this,e)};Wi.prototype.equalsEpsilon=function(e,t,n){return Wi.equalsEpsilon(this,e,t,n)};Wi.prototype.toString=function(){return`(${this.heading}, ${this.pitch}, ${this.roll})`};const Cq=/((?:.*\/)|^)Cesium\.js(?:\?|\#|$)/;let Fm;function wM(e){return typeof document>"u"?e:(l(Fm)||(Fm=document.createElement("a")),Fm.href=e,Fm.href)}let uu;function AM(){if(l(uu))return uu;let e;if(e="lib/cesium/",!l(e))throw new A("Unable to determine Cesium base URL automatically, try defining a global variable called CESIUM_BASE_URL.");return uu=new se({url:wM(e)}),uu.appendForwardSlash(),uu}function wq(e){return wM(require.toUrl(`../${e}`))}function SM(e){return AM().getDerivedResource({url:e}).url}let Bm;function ss(e){return l(Bm)||(typeof define=="object"&&l(define.amd)&&!define.amd.toUrlUndefined&&l(require.toUrl)?Bm=wq:Bm=SM),Bm(e)}ss._cesiumScriptRegex=Cq;ss._buildModuleUrlFromBaseUrl=SM;ss._clearBaseResource=function(){uu=void 0};ss.setBaseUrl=function(e){uu=se.DEFAULT.getDerivedResource({url:e})};ss.getCesiumBaseUrl=AM;function vM(e,t,n){this.x=e,this.y=t,this.s=n}function LC(e){e=T(e,T.EMPTY_OBJECT),this._xysFileUrlTemplate=se.createIfNeeded(e.xysFileUrlTemplate),this._interpolationOrder=T(e.interpolationOrder,9),this._sampleZeroJulianEphemerisDate=T(e.sampleZeroJulianEphemerisDate,24423965e-1),this._sampleZeroDateTT=new ue(this._sampleZeroJulianEphemerisDate,0,Rt.TAI),this._stepSizeDays=T(e.stepSizeDays,1),this._samplesPerXysFile=T(e.samplesPerXysFile,1e3),this._totalSamples=T(e.totalSamples,27426),this._samples=new Array(this._totalSamples*3),this._chunkDownloadsInProgress=[];const t=this._interpolationOrder,n=this._denominators=new Array(t+1),i=this._xTable=new Array(t+1),r=Math.pow(this._stepSizeDays,t);for(let s=0;s<=t;++s){n[s]=r,i[s]=s*this._stepSizeDays;for(let o=0;o<=t;++o)o!==s&&(n[s]*=s-o);n[s]=1/n[s]}this._work=new Array(t+1),this._coef=new Array(t+1)}const Aq=new ue(0,0,Rt.TAI);function zx(e,t,n){const i=Aq;return i.dayNumber=t,i.secondsOfDay=n,ue.daysDifference(i,e._sampleZeroDateTT)}LC.prototype.preload=function(e,t,n,i){const r=zx(this,e,t),s=zx(this,n,i);let o=r/this._stepSizeDays-this._interpolationOrder/2|0;o<0&&(o=0);let a=s/this._stepSizeDays-this._interpolationOrder/2|0+this._interpolationOrder;a>=this._totalSamples&&(a=this._totalSamples-1);const c=o/this._samplesPerXysFile|0,u=a/this._samplesPerXysFile|0,h=[];for(let d=c;d<=u;++d)h.push(Ux(this,d));return Promise.all(h)};LC.prototype.computeXysRadians=function(e,t,n){const i=zx(this,e,t);if(i<0)return;const r=i/this._stepSizeDays|0;if(r>=this._totalSamples)return;const s=this._interpolationOrder;let o=r-(s/2|0);o<0&&(o=0);let a=o+s;a>=this._totalSamples&&(a=this._totalSamples-1,o=a-s,o<0&&(o=0));let c=!1;const u=this._samples;if(l(u[o*3])||(Ux(this,o/this._samplesPerXysFile|0),c=!0),l(u[a*3])||(Ux(this,a/this._samplesPerXysFile|0),c=!0),c)return;l(n)?(n.x=0,n.y=0,n.s=0):n=new vM(0,0,0);const h=i-o*this._stepSizeDays,d=this._work,p=this._denominators,g=this._coef,_=this._xTable;let b,x;for(b=0;b<=s;++b)d[b]=h-_[b];for(b=0;b<=s;++b){for(g[b]=1,x=0;x<=s;++x)x!==b&&(g[b]*=d[x]);g[b]*=p[b];let E=(o+b)*3;n.x+=g[b]*u[E++],n.y+=g[b]*u[E++],n.s+=g[b]*u[E]}return n};function Ux(e,t){if(e._chunkDownloadsInProgress[t])return e._chunkDownloadsInProgress[t];let n;const i=e._xysFileUrlTemplate;l(i)?n=i.getDerivedResource({templateValues:{0:t}}):n=new se({url:ss(`Assets/IAU2006_XYS/IAU2006_XYS_${t}.json`)});const r=n.fetchJson().then(function(s){e._chunkDownloadsInProgress[t]=!1;const o=e._samples,a=s.samples,c=t*e._samplesPerXysFile*3;for(let u=0,h=a.length;u<h;++u)o[c+u]=a[u]});return e._chunkDownloadsInProgress[t]=r,r}let Oc;const Yn={requestFullscreen:void 0,exitFullscreen:void 0,fullscreenEnabled:void 0,fullscreenElement:void 0,fullscreenchange:void 0,fullscreenerror:void 0},es={};Object.defineProperties(es,{element:{get:function(){if(es.supportsFullscreen())return document[Yn.fullscreenElement]}},changeEventName:{get:function(){if(es.supportsFullscreen())return Yn.fullscreenchange}},errorEventName:{get:function(){if(es.supportsFullscreen())return Yn.fullscreenerror}},enabled:{get:function(){if(es.supportsFullscreen())return document[Yn.fullscreenEnabled]}},fullscreen:{get:function(){if(es.supportsFullscreen())return es.element!==null}}});es.supportsFullscreen=function(){if(l(Oc))return Oc;Oc=!1;const e=document.body;if(typeof e.requestFullscreen=="function")return Yn.requestFullscreen="requestFullscreen",Yn.exitFullscreen="exitFullscreen",Yn.fullscreenEnabled="fullscreenEnabled",Yn.fullscreenElement="fullscreenElement",Yn.fullscreenchange="fullscreenchange",Yn.fullscreenerror="fullscreenerror",Oc=!0,Oc;const t=["webkit","moz","o","ms","khtml"];let n;for(let i=0,r=t.length;i<r;++i){const s=t[i];n=`${s}RequestFullscreen`,typeof e[n]=="function"?(Yn.requestFullscreen=n,Oc=!0):(n=`${s}RequestFullScreen`,typeof e[n]=="function"&&(Yn.requestFullscreen=n,Oc=!0)),n=`${s}ExitFullscreen`,typeof document[n]=="function"?Yn.exitFullscreen=n:(n=`${s}CancelFullScreen`,typeof document[n]=="function"&&(Yn.exitFullscreen=n)),n=`${s}FullscreenEnabled`,document[n]!==void 0?Yn.fullscreenEnabled=n:(n=`${s}FullScreenEnabled`,document[n]!==void 0&&(Yn.fullscreenEnabled=n)),n=`${s}FullscreenElement`,document[n]!==void 0?Yn.fullscreenElement=n:(n=`${s}FullScreenElement`,document[n]!==void 0&&(Yn.fullscreenElement=n)),n=`${s}fullscreenchange`,document[`on${n}`]!==void 0&&(s==="ms"&&(n="MSFullscreenChange"),Yn.fullscreenchange=n),n=`${s}fullscreenerror`,document[`on${n}`]!==void 0&&(s==="ms"&&(n="MSFullscreenError"),Yn.fullscreenerror=n)}return Oc};es.requestFullscreen=function(e,t){es.supportsFullscreen()&&e[Yn.requestFullscreen]({vrDisplay:t})};es.exitFullscreen=function(){es.supportsFullscreen()&&document[Yn.exitFullscreen]()};es._names=Yn;let xr;typeof navigator<"u"?xr=navigator:xr={};function vu(e){const t=e.split(".");for(let n=0,i=t.length;n<i;++n)t[n]=parseInt(t[n],10);return t}let zm,IM;function PC(){if(!l(zm)&&(zm=!1,!ky())){const e=/ Chrome\/([\.0-9]+)/.exec(xr.userAgent);e!==null&&(zm=!0,IM=vu(e[1]))}return zm}function Sq(){return PC()&&IM}let Um,OM;function RM(){if(!l(Um)&&(Um=!1,!PC()&&!ky()&&/ Safari\/[\.0-9]+/.test(xr.userAgent))){const e=/ Version\/([\.0-9]+)/.exec(xr.userAgent);e!==null&&(Um=!0,OM=vu(e[1]))}return Um}function vq(){return RM()&&OM}let km,kx;function DM(){if(!l(km)){km=!1;const e=/ AppleWebKit\/([\.0-9]+)(\+?)/.exec(xr.userAgent);e!==null&&(km=!0,kx=vu(e[1]),kx.isNightly=!!e[2])}return km}function Iq(){return DM()&&kx}let rd,jx;function MM(){if(!l(rd)){rd=!1;let e;xr.appName==="Microsoft Internet Explorer"?(e=/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(xr.userAgent),e!==null&&(rd=!0,jx=vu(e[1]))):xr.appName==="Netscape"&&(e=/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(xr.userAgent),e!==null&&(rd=!0,jx=vu(e[1])))}return rd}function Oq(){return MM()&&jx}let jm,LM;function ky(){if(!l(jm)){jm=!1;const e=/ Edg\/([\.0-9]+)/.exec(xr.userAgent);e!==null&&(jm=!0,LM=vu(e[1]))}return jm}function Rq(){return ky()&&LM}let Vm,NC;function jy(){if(!l(Vm)){Vm=!1;const e=/Firefox\/([\.0-9]+)/.exec(xr.userAgent);e!==null&&(Vm=!0,NC=vu(e[1]))}return Vm}let Qb;function Dq(){return l(Qb)||(Qb=/Windows/i.test(xr.appVersion)),Qb}let e0;function Mq(){return l(e0)||(e0=navigator.platform==="iPhone"||navigator.platform==="iPod"||navigator.platform==="iPad"),e0}function Lq(){return jy()&&NC}let t0;function Pq(){return l(t0)||(t0=!jy()&&typeof PointerEvent<"u"&&(!l(xr.pointerEnabled)||xr.pointerEnabled)),t0}let PM,Gm;function NM(){if(!l(Gm)){const e=document.createElement("canvas");e.setAttribute("style","image-rendering: -moz-crisp-edges;image-rendering: pixelated;");const t=e.style.imageRendering;Gm=l(t)&&t!=="",Gm&&(PM=t)}return Gm}function Nq(){return NM()?PM:void 0}function mr(){if(!mr.initialized)throw new A("You must call FeatureDetection.supportsWebP.initialize and wait for the promise to resolve before calling FeatureDetection.supportsWebP");return mr._result}mr._promise=void 0;mr._result=void 0;mr.initialize=function(){return l(mr._promise)||(mr._promise=new Promise(e=>{const t=new Image;t.onload=function(){mr._result=t.width>0&&t.height>0,e(mr._result)},t.onerror=function(){mr._result=!1,e(mr._result)},t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA"})),mr._promise};Object.defineProperties(mr,{initialized:{get:function(){return l(mr._result)}}});const mf=[];typeof ArrayBuffer<"u"&&(mf.push(Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array),typeof Uint8ClampedArray<"u"&&mf.push(Uint8ClampedArray),typeof Uint8ClampedArray<"u"&&mf.push(Uint8ClampedArray),typeof BigInt64Array<"u"&&mf.push(BigInt64Array),typeof BigUint64Array<"u"&&mf.push(BigUint64Array));const It={isChrome:PC,chromeVersion:Sq,isSafari:RM,safariVersion:vq,isWebkit:DM,webkitVersion:Iq,isInternetExplorer:MM,internetExplorerVersion:Oq,isEdge:ky,edgeVersion:Rq,isFirefox:jy,firefoxVersion:Lq,isWindows:Dq,isIPadOrIOS:Mq,hardwareConcurrency:T(xr.hardwareConcurrency,3),supportsPointerEvents:Pq,supportsImageRenderingPixelated:NM,supportsWebP:mr,imageRenderingValue:Nq,typedArrayTypes:mf};It.supportsBasis=function(e){return It.supportsWebAssembly()&&e.context.supportsBasis};It.supportsFullscreen=function(){return es.supportsFullscreen()};It.supportsTypedArrays=function(){return typeof ArrayBuffer<"u"};It.supportsBigInt64Array=function(){return typeof BigInt64Array<"u"};It.supportsBigUint64Array=function(){return typeof BigUint64Array<"u"};It.supportsBigInt=function(){return typeof BigInt<"u"};It.supportsWebWorkers=function(){return typeof Worker<"u"};It.supportsWebAssembly=function(){return typeof WebAssembly<"u"};It.supportsWebgl2=function(e){return y.defined("scene",e),e.context.webgl2};It.supportsEsmWebWorkers=function(){return!jy()||parseInt(NC)>=114};function re(e,t,n,i){this.x=T(e,0),this.y=T(t,0),this.z=T(n,0),this.w=T(i,0)}let sd=new m;re.fromAxisAngle=function(e,t,n){y.typeOf.object("axis",e),y.typeOf.number("angle",t);const i=t/2,r=Math.sin(i);sd=m.normalize(e,sd);const s=sd.x*r,o=sd.y*r,a=sd.z*r,c=Math.cos(i);return l(n)?(n.x=s,n.y=o,n.z=a,n.w=c,n):new re(s,o,a,c)};const Fq=[1,2,0],Bq=new Array(3);re.fromRotationMatrix=function(e,t){y.typeOf.object("matrix",e);let n,i,r,s,o;const a=e[H.COLUMN0ROW0],c=e[H.COLUMN1ROW1],u=e[H.COLUMN2ROW2],h=a+c+u;if(h>0)n=Math.sqrt(h+1),o=.5*n,n=.5/n,i=(e[H.COLUMN1ROW2]-e[H.COLUMN2ROW1])*n,r=(e[H.COLUMN2ROW0]-e[H.COLUMN0ROW2])*n,s=(e[H.COLUMN0ROW1]-e[H.COLUMN1ROW0])*n;else{const d=Fq;let p=0;c>a&&(p=1),u>a&&u>c&&(p=2);const g=d[p],_=d[g];n=Math.sqrt(e[H.getElementIndex(p,p)]-e[H.getElementIndex(g,g)]-e[H.getElementIndex(_,_)]+1);const b=Bq;b[p]=.5*n,n=.5/n,o=(e[H.getElementIndex(_,g)]-e[H.getElementIndex(g,_)])*n,b[g]=(e[H.getElementIndex(g,p)]+e[H.getElementIndex(p,g)])*n,b[_]=(e[H.getElementIndex(_,p)]+e[H.getElementIndex(p,_)])*n,i=-b[0],r=-b[1],s=-b[2]}return l(t)?(t.x=i,t.y=r,t.z=s,t.w=o,t):new re(i,r,s,o)};const bv=new re;let Tv=new re,n0=new re,xv=new re;re.fromHeadingPitchRoll=function(e,t){return y.typeOf.object("headingPitchRoll",e),xv=re.fromAxisAngle(m.UNIT_X,e.roll,bv),n0=re.fromAxisAngle(m.UNIT_Y,-e.pitch,t),t=re.multiply(n0,xv,n0),Tv=re.fromAxisAngle(m.UNIT_Z,-e.heading,bv),re.multiply(Tv,t,t)};const Hm=new m,i0=new m,xo=new re,Ev=new re,qm=new re;re.packedLength=4;re.pack=function(e,t,n){return y.typeOf.object("value",e),y.defined("array",t),n=T(n,0),t[n++]=e.x,t[n++]=e.y,t[n++]=e.z,t[n]=e.w,t};re.unpack=function(e,t,n){return y.defined("array",e),t=T(t,0),l(n)||(n=new re),n.x=e[t],n.y=e[t+1],n.z=e[t+2],n.w=e[t+3],n};re.packedInterpolationLength=3;re.convertPackedArrayForInterpolation=function(e,t,n,i){re.unpack(e,n*4,qm),re.conjugate(qm,qm);for(let r=0,s=n-t+1;r<s;r++){const o=r*3;re.unpack(e,(t+r)*4,xo),re.multiply(xo,qm,xo),xo.w<0&&re.negate(xo,xo),re.computeAxis(xo,Hm);const a=re.computeAngle(xo);l(i)||(i=[]),i[o]=Hm.x*a,i[o+1]=Hm.y*a,i[o+2]=Hm.z*a}};re.unpackInterpolationResult=function(e,t,n,i,r){l(r)||(r=new re),m.fromArray(e,0,i0);const s=m.magnitude(i0);return re.unpack(t,i*4,Ev),s===0?re.clone(re.IDENTITY,xo):re.fromAxisAngle(i0,s,xo),re.multiply(xo,Ev,r)};re.clone=function(e,t){if(l(e))return l(t)?(t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t):new re(e.x,e.y,e.z,e.w)};re.conjugate=function(e,t){return y.typeOf.object("quaternion",e),y.typeOf.object("result",t),t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=e.w,t};re.magnitudeSquared=function(e){return y.typeOf.object("quaternion",e),e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w};re.magnitude=function(e){return Math.sqrt(re.magnitudeSquared(e))};re.normalize=function(e,t){y.typeOf.object("result",t);const n=1/re.magnitude(e),i=e.x*n,r=e.y*n,s=e.z*n,o=e.w*n;return t.x=i,t.y=r,t.z=s,t.w=o,t};re.inverse=function(e,t){y.typeOf.object("result",t);const n=re.magnitudeSquared(e);return t=re.conjugate(e,t),re.multiplyByScalar(t,1/n,t)};re.add=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z,n.w=e.w+t.w,n};re.subtract=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z,n.w=e.w-t.w,n};re.negate=function(e,t){return y.typeOf.object("quaternion",e),y.typeOf.object("result",t),t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t};re.dot=function(e,t){return y.typeOf.object("left",e),y.typeOf.object("right",t),e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w};re.multiply=function(e,t,n){y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n);const i=e.x,r=e.y,s=e.z,o=e.w,a=t.x,c=t.y,u=t.z,h=t.w,d=o*a+i*h+r*u-s*c,p=o*c-i*u+r*h+s*a,g=o*u+i*c-r*a+s*h,_=o*h-i*a-r*c-s*u;return n.x=d,n.y=p,n.z=g,n.w=_,n};re.multiplyByScalar=function(e,t,n){return y.typeOf.object("quaternion",e),y.typeOf.number("scalar",t),y.typeOf.object("result",n),n.x=e.x*t,n.y=e.y*t,n.z=e.z*t,n.w=e.w*t,n};re.divideByScalar=function(e,t,n){return y.typeOf.object("quaternion",e),y.typeOf.number("scalar",t),y.typeOf.object("result",n),n.x=e.x/t,n.y=e.y/t,n.z=e.z/t,n.w=e.w/t,n};re.computeAxis=function(e,t){y.typeOf.object("quaternion",e),y.typeOf.object("result",t);const n=e.w;if(Math.abs(n-1)<R.EPSILON6||Math.abs(n+1)<R.EPSILON6)return t.x=1,t.y=t.z=0,t;const i=1/Math.sqrt(1-n*n);return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t};re.computeAngle=function(e){return y.typeOf.object("quaternion",e),Math.abs(e.w-1)<R.EPSILON6?0:2*Math.acos(e.w)};let r0=new re;re.lerp=function(e,t,n,i){return y.typeOf.object("start",e),y.typeOf.object("end",t),y.typeOf.number("t",n),y.typeOf.object("result",i),r0=re.multiplyByScalar(t,n,r0),i=re.multiplyByScalar(e,1-n,i),re.add(r0,i,i)};let Cv=new re,s0=new re,o0=new re;re.slerp=function(e,t,n,i){y.typeOf.object("start",e),y.typeOf.object("end",t),y.typeOf.number("t",n),y.typeOf.object("result",i);let r=re.dot(e,t),s=t;if(r<0&&(r=-r,s=Cv=re.negate(t,Cv)),1-r<R.EPSILON6)return re.lerp(e,s,n,i);const o=Math.acos(r);return s0=re.multiplyByScalar(e,Math.sin((1-n)*o),s0),o0=re.multiplyByScalar(s,Math.sin(n*o),o0),i=re.add(s0,o0,i),re.multiplyByScalar(i,1/Math.sin(o),i)};re.log=function(e,t){y.typeOf.object("quaternion",e),y.typeOf.object("result",t);const n=R.acosClamped(e.w);let i=0;return n!==0&&(i=n/Math.sin(n)),m.multiplyByScalar(e,i,t)};re.exp=function(e,t){y.typeOf.object("cartesian",e),y.typeOf.object("result",t);const n=m.magnitude(e);let i=0;return n!==0&&(i=Math.sin(n)/n),t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t.w=Math.cos(n),t};const zq=new m,Uq=new m,Yd=new re,vf=new re;re.computeInnerQuadrangle=function(e,t,n,i){y.typeOf.object("q0",e),y.typeOf.object("q1",t),y.typeOf.object("q2",n),y.typeOf.object("result",i);const r=re.conjugate(t,Yd);re.multiply(r,n,vf);const s=re.log(vf,zq);re.multiply(r,e,vf);const o=re.log(vf,Uq);return m.add(s,o,s),m.multiplyByScalar(s,.25,s),m.negate(s,s),re.exp(s,Yd),re.multiply(t,Yd,i)};re.squad=function(e,t,n,i,r,s){y.typeOf.object("q0",e),y.typeOf.object("q1",t),y.typeOf.object("s0",n),y.typeOf.object("s1",i),y.typeOf.number("t",r),y.typeOf.object("result",s);const o=re.slerp(e,t,r,Yd),a=re.slerp(n,i,r,vf);return re.slerp(o,a,2*r*(1-r),s)};const kq=new re,FM=1.9011074535173003,k_=It.supportsTypedArrays()?new Float32Array(8):[],j_=It.supportsTypedArrays()?new Float32Array(8):[],La=It.supportsTypedArrays()?new Float32Array(8):[],Pa=It.supportsTypedArrays()?new Float32Array(8):[];for(let e=0;e<7;++e){const t=e+1,n=2*t+1;k_[e]=1/(t*n),j_[e]=t/n}k_[7]=FM/(8*17);j_[7]=FM*8/17;re.fastSlerp=function(e,t,n,i){y.typeOf.object("start",e),y.typeOf.object("end",t),y.typeOf.number("t",n),y.typeOf.object("result",i);let r=re.dot(e,t),s;r>=0?s=1:(s=-1,r=-r);const o=r-1,a=1-n,c=n*n,u=a*a;for(let g=7;g>=0;--g)La[g]=(k_[g]*c-j_[g])*o,Pa[g]=(k_[g]*u-j_[g])*o;const h=s*n*(1+La[0]*(1+La[1]*(1+La[2]*(1+La[3]*(1+La[4]*(1+La[5]*(1+La[6]*(1+La[7])))))))),d=a*(1+Pa[0]*(1+Pa[1]*(1+Pa[2]*(1+Pa[3]*(1+Pa[4]*(1+Pa[5]*(1+Pa[6]*(1+Pa[7])))))))),p=re.multiplyByScalar(e,d,kq);return re.multiplyByScalar(t,h,i),re.add(p,i,i)};re.fastSquad=function(e,t,n,i,r,s){y.typeOf.object("q0",e),y.typeOf.object("q1",t),y.typeOf.object("s0",n),y.typeOf.object("s1",i),y.typeOf.number("t",r),y.typeOf.object("result",s);const o=re.fastSlerp(e,t,r,Yd),a=re.fastSlerp(n,i,r,vf);return re.fastSlerp(o,a,2*r*(1-r),s)};re.equals=function(e,t){return e===t||l(e)&&l(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w};re.equalsEpsilon=function(e,t,n){return n=T(n,0),e===t||l(e)&&l(t)&&Math.abs(e.x-t.x)<=n&&Math.abs(e.y-t.y)<=n&&Math.abs(e.z-t.z)<=n&&Math.abs(e.w-t.w)<=n};re.ZERO=Object.freeze(new re(0,0,0,0));re.IDENTITY=Object.freeze(new re(0,0,0,1));re.prototype.clone=function(e){return re.clone(this,e)};re.prototype.equals=function(e){return re.equals(this,e)};re.prototype.equalsEpsilon=function(e,t){return re.equalsEpsilon(this,e,t)};re.prototype.toString=function(){return`(${this.x}, ${this.y}, ${this.z}, ${this.w})`};const et={},a0={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Ku={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},c0={},$r={east:new m,north:new m,up:new m,west:new m,south:new m,down:new m};let Rc=new m,Dc=new m,Mc=new m;et.localFrameToFixedFrameGenerator=function(e,t){if(!a0.hasOwnProperty(e)||!a0[e].hasOwnProperty(t))throw new A("firstAxis and secondAxis must be east, north, up, west, south or down.");const n=a0[e][t];let i;const r=e+t;return l(c0[r])?i=c0[r]:(i=function(s,o,a){if(!l(s))throw new A("origin is required.");if(isNaN(s.x)||isNaN(s.y)||isNaN(s.z))throw new A("origin has a NaN component");if(l(a)||(a=new P),m.equalsEpsilon(s,m.ZERO,R.EPSILON14))m.unpack(Ku[e],0,Rc),m.unpack(Ku[t],0,Dc),m.unpack(Ku[n],0,Mc);else if(R.equalsEpsilon(s.x,0,R.EPSILON14)&&R.equalsEpsilon(s.y,0,R.EPSILON14)){const c=R.sign(s.z);m.unpack(Ku[e],0,Rc),e!=="east"&&e!=="west"&&m.multiplyByScalar(Rc,c,Rc),m.unpack(Ku[t],0,Dc),t!=="east"&&t!=="west"&&m.multiplyByScalar(Dc,c,Dc),m.unpack(Ku[n],0,Mc),n!=="east"&&n!=="west"&&m.multiplyByScalar(Mc,c,Mc)}else{o=T(o,fe.default),o.geodeticSurfaceNormal(s,$r.up);const c=$r.up,u=$r.east;u.x=-s.y,u.y=s.x,u.z=0,m.normalize(u,$r.east),m.cross(c,u,$r.north),m.multiplyByScalar($r.up,-1,$r.down),m.multiplyByScalar($r.east,-1,$r.west),m.multiplyByScalar($r.north,-1,$r.south),Rc=$r[e],Dc=$r[t],Mc=$r[n]}return a[0]=Rc.x,a[1]=Rc.y,a[2]=Rc.z,a[3]=0,a[4]=Dc.x,a[5]=Dc.y,a[6]=Dc.z,a[7]=0,a[8]=Mc.x,a[9]=Mc.y,a[10]=Mc.z,a[11]=0,a[12]=s.x,a[13]=s.y,a[14]=s.z,a[15]=1,a},c0[r]=i),i};et.eastNorthUpToFixedFrame=et.localFrameToFixedFrameGenerator("east","north");et.northEastDownToFixedFrame=et.localFrameToFixedFrameGenerator("north","east");et.northUpEastToFixedFrame=et.localFrameToFixedFrameGenerator("north","up");et.northWestUpToFixedFrame=et.localFrameToFixedFrameGenerator("north","west");const jq=new re,Vq=new m(1,1,1),Gq=new P;et.headingPitchRollToFixedFrame=function(e,t,n,i,r){y.typeOf.object("HeadingPitchRoll",t),i=T(i,et.eastNorthUpToFixedFrame);const s=re.fromHeadingPitchRoll(t,jq),o=P.fromTranslationQuaternionRotationScale(m.ZERO,s,Vq,Gq);return r=i(e,n,r),P.multiply(r,o,r)};const Hq=new P,qq=new H;et.headingPitchRollQuaternion=function(e,t,n,i,r){y.typeOf.object("HeadingPitchRoll",t);const s=et.headingPitchRollToFixedFrame(e,t,n,i,Hq),o=P.getMatrix3(s,qq);return re.fromRotationMatrix(o,r)};const Wq=new m(1,1,1),$q=new m,wv=new P,Xq=new P,Yq=new H,Kq=new re;et.fixedFrameToHeadingPitchRoll=function(e,t,n,i){y.defined("transform",e),t=T(t,fe.default),n=T(n,et.eastNorthUpToFixedFrame),l(i)||(i=new Wi);const r=P.getTranslation(e,$q);if(m.equals(r,m.ZERO))return i.heading=0,i.pitch=0,i.roll=0,i;let s=P.inverseTransformation(n(r,t,wv),wv),o=P.setScale(e,Wq,Xq);o=P.setTranslation(o,m.ZERO,o),s=P.multiply(s,o,s);let a=re.fromRotationMatrix(P.getMatrix3(s,Yq),Kq);return a=re.normalize(a,a),Wi.fromQuaternion(a,i)};const Zq=6*3600+41*60+50.54841,Jq=8640184812866e-6,Qq=.093104,e6=-62e-7,t6=11772758384668e-32,n6=72921158553e-15,i6=R.TWO_PI/86400;let Wm=new ue;et.computeIcrfToCentralBodyFixedMatrix=function(e,t){let n=et.computeIcrfToFixedMatrix(e,t);return l(n)||(n=et.computeTemeToPseudoFixedMatrix(e,t)),n};et.computeTemeToPseudoFixedMatrix=function(e,t){if(!l(e))throw new A("date is required.");Wm=ue.addSeconds(e,-ue.computeTaiMinusUtc(e),Wm);const n=Wm.dayNumber,i=Wm.secondsOfDay;let r;const s=n-2451545;i>=43200?r=(s+.5)/qn.DAYS_PER_JULIAN_CENTURY:r=(s-.5)/qn.DAYS_PER_JULIAN_CENTURY;const a=(Zq+r*(Jq+r*(Qq+r*e6)))*i6%R.TWO_PI,c=n6+t6*(n-24515455e-1),u=(i+qn.SECONDS_PER_DAY*.5)%qn.SECONDS_PER_DAY,h=a+c*u,d=Math.cos(h),p=Math.sin(h);return l(t)?(t[0]=d,t[1]=-p,t[2]=0,t[3]=p,t[4]=d,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t):new H(d,p,0,-p,d,0,0,0,1)};et.iau2006XysData=new LC;et.earthOrientationParameters=xp.NONE;const Vx=32.184,r6=2451545;et.preloadIcrfFixed=function(e){const t=e.start.dayNumber,n=e.start.secondsOfDay+Vx,i=e.stop.dayNumber,r=e.stop.secondsOfDay+Vx;return et.iau2006XysData.preload(t,n,i,r)};et.computeIcrfToFixedMatrix=function(e,t){if(!l(e))throw new A("date is required.");l(t)||(t=new H);const n=et.computeFixedToIcrfMatrix(e,t);if(l(n))return H.transpose(n,t)};const s6=32.184,o6=2451545,$m=new Wi,a6=new H,c6=new ue;et.computeMoonFixedToIcrfMatrix=function(e,t){if(!l(e))throw new A("date is required.");const n=ue.addSeconds(e,s6,c6),i=ue.totalDays(n)-o6,r=R.toRadians(12.112)-R.toRadians(.052992)*i,s=R.toRadians(24.224)-R.toRadians(.105984)*i,o=R.toRadians(227.645)+R.toRadians(13.012)*i,a=R.toRadians(261.105)+R.toRadians(13.340716)*i,c=R.toRadians(358)+R.toRadians(.9856)*i;return $m.pitch=R.toRadians(180)-R.toRadians(3.878)*Math.sin(r)-R.toRadians(.12)*Math.sin(s)+R.toRadians(.07)*Math.sin(o)-R.toRadians(.017)*Math.sin(a),$m.roll=R.toRadians(66.53-90)+R.toRadians(1.543)*Math.cos(r)+R.toRadians(.24)*Math.cos(s)-R.toRadians(.028)*Math.cos(o)+R.toRadians(.007)*Math.cos(a),$m.heading=R.toRadians(244.375-90)+R.toRadians(13.17635831)*i+R.toRadians(3.558)*Math.sin(r)+R.toRadians(.121)*Math.sin(s)-R.toRadians(.064)*Math.sin(o)+R.toRadians(.016)*Math.sin(a)+R.toRadians(.025)*Math.sin(c),H.fromHeadingPitchRoll($m,a6)};et.computeIcrfToMoonFixedMatrix=function(e,t){if(!l(e))throw new A("date is required.");l(t)||(t=new H);const n=et.computeMoonFixedToIcrfMatrix(e,t);if(l(n))return H.transpose(n,t)};const l6=new vM(0,0,0),u6=new AC(0,0,0,0,0),l0=new H,u0=new H;et.computeFixedToIcrfMatrix=function(e,t){if(!l(e))throw new A("date is required.");l(t)||(t=new H);const n=et.earthOrientationParameters.compute(e,u6);if(!l(n))return;const i=e.dayNumber,r=e.secondsOfDay+Vx,s=et.iau2006XysData.computeXysRadians(i,r,l6);if(!l(s))return;const o=s.x+n.xPoleOffset,a=s.y+n.yPoleOffset,c=1/(1+Math.sqrt(1-o*o-a*a)),u=l0;u[0]=1-c*o*o,u[3]=-c*o*a,u[6]=o,u[1]=-c*o*a,u[4]=1-c*a*a,u[7]=a,u[2]=-o,u[5]=-a,u[8]=1-c*(o*o+a*a);const h=H.fromRotationZ(-s.s,u0),d=H.multiply(u,h,l0),p=e.dayNumber,g=e.secondsOfDay-ue.computeTaiMinusUtc(e)+n.ut1MinusUtc,_=p-2451545,b=g/qn.SECONDS_PER_DAY;let x=.779057273264+b+.00273781191135448*(_+b);x=x%1*R.TWO_PI;const E=H.fromRotationZ(x,u0),C=H.multiply(d,E,l0),w=Math.cos(n.xPoleWander),S=Math.cos(n.yPoleWander),v=Math.sin(n.xPoleWander),D=Math.sin(n.yPoleWander);let L=i-r6+r/qn.SECONDS_PER_DAY;L/=36525;const O=-47e-6*L*R.RADIANS_PER_DEGREE/3600,N=Math.cos(O),B=Math.sin(O),U=u0;return U[0]=w*N,U[1]=w*B,U[2]=v,U[3]=-S*B+D*v*N,U[4]=S*N+D*v*B,U[5]=-D*w,U[6]=-D*B-S*v*N,U[7]=D*N-S*v*B,U[8]=S*w,H.multiply(C,U,t)};const f6=new Y;et.pointToWindowCoordinates=function(e,t,n,i){return i=et.pointToGLWindowCoordinates(e,t,n,i),i.y=2*t[5]-i.y,i};et.pointToGLWindowCoordinates=function(e,t,n,i){if(!l(e))throw new A("modelViewProjectionMatrix is required.");if(!l(t))throw new A("viewportTransformation is required.");if(!l(n))throw new A("point is required.");l(i)||(i=new k);const r=f6;return P.multiplyByVector(e,Y.fromElements(n.x,n.y,n.z,1,r),r),Y.multiplyByScalar(r,1/r.w,r),P.multiplyByVector(t,r,r),k.fromCartesian4(r,i)};const h6=new m,d6=new m,p6=new m;et.rotationMatrixFromPositionVelocity=function(e,t,n,i){if(!l(e))throw new A("position is required.");if(!l(t))throw new A("velocity is required.");const r=T(n,fe.default).geodeticSurfaceNormal(e,h6);let s=m.cross(t,r,d6);m.equalsEpsilon(s,m.ZERO,R.EPSILON6)&&(s=m.clone(m.UNIT_X,s));const o=m.cross(s,t,p6);return m.normalize(o,o),m.cross(t,o,s),m.negate(s,s),m.normalize(s,s),l(i)||(i=new H),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=s.x,i[4]=s.y,i[5]=s.z,i[6]=o.x,i[7]=o.y,i[8]=o.z,i};const BM=new P(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1),zM=new oe,Gx=new m,m6=new m,g6=new H,Hx=new P,UM=new P;et.basisTo2D=function(e,t,n){if(!l(e))throw new A("projection is required.");if(!l(t))throw new A("matrix is required.");if(!l(n))throw new A("result is required.");const i=P.getTranslation(t,m6),r=e.ellipsoid;let s;if(m.equals(i,m.ZERO))s=m.clone(m.ZERO,Gx);else{const h=r.cartesianToCartographic(i,zM);s=e.project(h,Gx),m.fromElements(s.z,s.x,s.y,s)}const o=et.eastNorthUpToFixedFrame(i,r,Hx),a=P.inverseTransformation(o,UM),c=P.getMatrix3(t,g6),u=P.multiplyByMatrix3(a,c,n);return P.multiply(BM,u,n),P.setTranslation(n,s,n),n};et.ellipsoidTo2DModelMatrix=function(e,t,n){if(!l(e))throw new A("projection is required.");if(!l(t))throw new A("center is required.");if(!l(n))throw new A("result is required.");const i=e.ellipsoid,r=et.eastNorthUpToFixedFrame(t,i,Hx),s=P.inverseTransformation(r,UM),o=i.cartesianToCartographic(t,zM),a=e.project(o,Gx);m.fromElements(a.z,a.x,a.y,a);const c=P.fromTranslation(a,Hx);return P.multiply(BM,s,n),P.multiply(c,n,n),n};function ie(e,t,n,i){this.west=T(e,0),this.south=T(t,0),this.east=T(n,0),this.north=T(i,0)}Object.defineProperties(ie.prototype,{width:{get:function(){return ie.computeWidth(this)}},height:{get:function(){return ie.computeHeight(this)}}});ie.packedLength=4;ie.pack=function(e,t,n){return y.typeOf.object("value",e),y.defined("array",t),n=T(n,0),t[n++]=e.west,t[n++]=e.south,t[n++]=e.east,t[n]=e.north,t};ie.unpack=function(e,t,n){return y.defined("array",e),t=T(t,0),l(n)||(n=new ie),n.west=e[t++],n.south=e[t++],n.east=e[t++],n.north=e[t],n};ie.computeWidth=function(e){y.typeOf.object("rectangle",e);let t=e.east;const n=e.west;return t<n&&(t+=R.TWO_PI),t-n};ie.computeHeight=function(e){return y.typeOf.object("rectangle",e),e.north-e.south};ie.fromDegrees=function(e,t,n,i,r){return e=R.toRadians(T(e,0)),t=R.toRadians(T(t,0)),n=R.toRadians(T(n,0)),i=R.toRadians(T(i,0)),l(r)?(r.west=e,r.south=t,r.east=n,r.north=i,r):new ie(e,t,n,i)};ie.fromRadians=function(e,t,n,i,r){return l(r)?(r.west=T(e,0),r.south=T(t,0),r.east=T(n,0),r.north=T(i,0),r):new ie(e,t,n,i)};ie.fromCartographicArray=function(e,t){y.defined("cartographics",e);let n=Number.MAX_VALUE,i=-Number.MAX_VALUE,r=Number.MAX_VALUE,s=-Number.MAX_VALUE,o=Number.MAX_VALUE,a=-Number.MAX_VALUE;for(let c=0,u=e.length;c<u;c++){const h=e[c];n=Math.min(n,h.longitude),i=Math.max(i,h.longitude),o=Math.min(o,h.latitude),a=Math.max(a,h.latitude);const d=h.longitude>=0?h.longitude:h.longitude+R.TWO_PI;r=Math.min(r,d),s=Math.max(s,d)}return i-n>s-r&&(n=r,i=s,i>R.PI&&(i=i-R.TWO_PI),n>R.PI&&(n=n-R.TWO_PI)),l(t)?(t.west=n,t.south=o,t.east=i,t.north=a,t):new ie(n,o,i,a)};ie.fromCartesianArray=function(e,t,n){y.defined("cartesians",e),t=T(t,fe.default);let i=Number.MAX_VALUE,r=-Number.MAX_VALUE,s=Number.MAX_VALUE,o=-Number.MAX_VALUE,a=Number.MAX_VALUE,c=-Number.MAX_VALUE;for(let u=0,h=e.length;u<h;u++){const d=t.cartesianToCartographic(e[u]);i=Math.min(i,d.longitude),r=Math.max(r,d.longitude),a=Math.min(a,d.latitude),c=Math.max(c,d.latitude);const p=d.longitude>=0?d.longitude:d.longitude+R.TWO_PI;s=Math.min(s,p),o=Math.max(o,p)}return r-i>o-s&&(i=s,r=o,r>R.PI&&(r=r-R.TWO_PI),i>R.PI&&(i=i-R.TWO_PI)),l(n)?(n.west=i,n.south=a,n.east=r,n.north=c,n):new ie(i,a,r,c)};const _6=new m,y6=new m,b6=new m,T6=new m,x6=new m,qx=new Array(5);for(let e=0;e<qx.length;++e)qx[e]=new m;ie.fromBoundingSphere=function(e,t,n){y.typeOf.object("boundingSphere",e);const i=e.center,r=e.radius;if(l(t)||(t=fe.default),l(n)||(n=new ie),m.equals(i,m.ZERO))return ie.clone(ie.MAX_VALUE,n),n;const s=et.eastNorthUpToFixedFrame(i,t,_6),o=P.multiplyByPointAsVector(s,m.UNIT_X,y6);m.normalize(o,o);const a=P.multiplyByPointAsVector(s,m.UNIT_Y,b6);m.normalize(a,a),m.multiplyByScalar(a,r,a),m.multiplyByScalar(o,r,o);const c=m.negate(a,x6),u=m.negate(o,T6),h=qx;let d=h[0];return m.add(i,a,d),d=h[1],m.add(i,u,d),d=h[2],m.add(i,c,d),d=h[3],m.add(i,o,d),h[4]=i,ie.fromCartesianArray(h,t,n)};ie.clone=function(e,t){if(l(e))return l(t)?(t.west=e.west,t.south=e.south,t.east=e.east,t.north=e.north,t):new ie(e.west,e.south,e.east,e.north)};ie.equalsEpsilon=function(e,t,n){return n=T(n,0),e===t||l(e)&&l(t)&&Math.abs(e.west-t.west)<=n&&Math.abs(e.south-t.south)<=n&&Math.abs(e.east-t.east)<=n&&Math.abs(e.north-t.north)<=n};ie.prototype.clone=function(e){return ie.clone(this,e)};ie.prototype.equals=function(e){return ie.equals(this,e)};ie.equals=function(e,t){return e===t||l(e)&&l(t)&&e.west===t.west&&e.south===t.south&&e.east===t.east&&e.north===t.north};ie.prototype.equalsEpsilon=function(e,t){return ie.equalsEpsilon(this,e,t)};ie.validate=function(e){y.typeOf.object("rectangle",e);const t=e.north;y.typeOf.number.greaterThanOrEquals("north",t,-R.PI_OVER_TWO),y.typeOf.number.lessThanOrEquals("north",t,R.PI_OVER_TWO);const n=e.south;y.typeOf.number.greaterThanOrEquals("south",n,-R.PI_OVER_TWO),y.typeOf.number.lessThanOrEquals("south",n,R.PI_OVER_TWO);const i=e.west;y.typeOf.number.greaterThanOrEquals("west",i,-Math.PI),y.typeOf.number.lessThanOrEquals("west",i,Math.PI);const r=e.east;y.typeOf.number.greaterThanOrEquals("east",r,-Math.PI),y.typeOf.number.lessThanOrEquals("east",r,Math.PI)};ie.southwest=function(e,t){return y.typeOf.object("rectangle",e),l(t)?(t.longitude=e.west,t.latitude=e.south,t.height=0,t):new oe(e.west,e.south)};ie.northwest=function(e,t){return y.typeOf.object("rectangle",e),l(t)?(t.longitude=e.west,t.latitude=e.north,t.height=0,t):new oe(e.west,e.north)};ie.northeast=function(e,t){return y.typeOf.object("rectangle",e),l(t)?(t.longitude=e.east,t.latitude=e.north,t.height=0,t):new oe(e.east,e.north)};ie.southeast=function(e,t){return y.typeOf.object("rectangle",e),l(t)?(t.longitude=e.east,t.latitude=e.south,t.height=0,t):new oe(e.east,e.south)};ie.center=function(e,t){y.typeOf.object("rectangle",e);let n=e.east;const i=e.west;n<i&&(n+=R.TWO_PI);const r=R.negativePiToPi((i+n)*.5),s=(e.south+e.north)*.5;return l(t)?(t.longitude=r,t.latitude=s,t.height=0,t):new oe(r,s)};ie.intersection=function(e,t,n){y.typeOf.object("rectangle",e),y.typeOf.object("otherRectangle",t);let i=e.east,r=e.west,s=t.east,o=t.west;i<r&&s>0?i+=R.TWO_PI:s<o&&i>0&&(s+=R.TWO_PI),i<r&&o<0?o+=R.TWO_PI:s<o&&r<0&&(r+=R.TWO_PI);const a=R.negativePiToPi(Math.max(r,o)),c=R.negativePiToPi(Math.min(i,s));if((e.west<e.east||t.west<t.east)&&c<=a)return;const u=Math.max(e.south,t.south),h=Math.min(e.north,t.north);if(!(u>=h))return l(n)?(n.west=a,n.south=u,n.east=c,n.north=h,n):new ie(a,u,c,h)};ie.simpleIntersection=function(e,t,n){y.typeOf.object("rectangle",e),y.typeOf.object("otherRectangle",t);const i=Math.max(e.west,t.west),r=Math.max(e.south,t.south),s=Math.min(e.east,t.east),o=Math.min(e.north,t.north);if(!(r>=o||i>=s))return l(n)?(n.west=i,n.south=r,n.east=s,n.north=o,n):new ie(i,r,s,o)};ie.union=function(e,t,n){y.typeOf.object("rectangle",e),y.typeOf.object("otherRectangle",t),l(n)||(n=new ie);let i=e.east,r=e.west,s=t.east,o=t.west;i<r&&s>0?i+=R.TWO_PI:s<o&&i>0&&(s+=R.TWO_PI),i<r&&o<0?o+=R.TWO_PI:s<o&&r<0&&(r+=R.TWO_PI);const a=R.negativePiToPi(Math.min(r,o)),c=R.negativePiToPi(Math.max(i,s));return n.west=a,n.south=Math.min(e.south,t.south),n.east=c,n.north=Math.max(e.north,t.north),n};ie.expand=function(e,t,n){return y.typeOf.object("rectangle",e),y.typeOf.object("cartographic",t),l(n)||(n=new ie),n.west=Math.min(e.west,t.longitude),n.south=Math.min(e.south,t.latitude),n.east=Math.max(e.east,t.longitude),n.north=Math.max(e.north,t.latitude),n};ie.contains=function(e,t){y.typeOf.object("rectangle",e),y.typeOf.object("cartographic",t);let n=t.longitude;const i=t.latitude,r=e.west;let s=e.east;return s<r&&(s+=R.TWO_PI,n<0&&(n+=R.TWO_PI)),(n>r||R.equalsEpsilon(n,r,R.EPSILON14))&&(n<s||R.equalsEpsilon(n,s,R.EPSILON14))&&i>=e.south&&i<=e.north};const E6=new oe;ie.subsample=function(e,t,n,i){y.typeOf.object("rectangle",e),t=T(t,fe.default),n=T(n,0),l(i)||(i=[]);let r=0;const s=e.north,o=e.south,a=e.east,c=e.west,u=E6;u.height=n,u.longitude=c,u.latitude=s,i[r]=t.cartographicToCartesian(u,i[r]),r++,u.longitude=a,i[r]=t.cartographicToCartesian(u,i[r]),r++,u.latitude=o,i[r]=t.cartographicToCartesian(u,i[r]),r++,u.longitude=c,i[r]=t.cartographicToCartesian(u,i[r]),r++,s<0?u.latitude=s:o>0?u.latitude=o:u.latitude=0;for(let h=1;h<8;++h)u.longitude=-Math.PI+h*R.PI_OVER_TWO,ie.contains(e,u)&&(i[r]=t.cartographicToCartesian(u,i[r]),r++);return u.latitude===0&&(u.longitude=c,i[r]=t.cartographicToCartesian(u,i[r]),r++,u.longitude=a,i[r]=t.cartographicToCartesian(u,i[r]),r++),i.length=r,i};ie.subsection=function(e,t,n,i,r,s){if(y.typeOf.object("rectangle",e),y.typeOf.number.greaterThanOrEquals("westLerp",t,0),y.typeOf.number.lessThanOrEquals("westLerp",t,1),y.typeOf.number.greaterThanOrEquals("southLerp",n,0),y.typeOf.number.lessThanOrEquals("southLerp",n,1),y.typeOf.number.greaterThanOrEquals("eastLerp",i,0),y.typeOf.number.lessThanOrEquals("eastLerp",i,1),y.typeOf.number.greaterThanOrEquals("northLerp",r,0),y.typeOf.number.lessThanOrEquals("northLerp",r,1),y.typeOf.number.lessThanOrEquals("westLerp",t,i),y.typeOf.number.lessThanOrEquals("southLerp",n,r),l(s)||(s=new ie),e.west<=e.east){const a=e.east-e.west;s.west=e.west+t*a,s.east=e.west+i*a}else{const a=R.TWO_PI+e.east-e.west;s.west=R.negativePiToPi(e.west+t*a),s.east=R.negativePiToPi(e.west+i*a)}const o=e.north-e.south;return s.south=e.south+n*o,s.north=e.south+r*o,t===1&&(s.west=e.east),i===1&&(s.east=e.east),n===1&&(s.south=e.north),r===1&&(s.north=e.north),s};ie.MAX_VALUE=Object.freeze(new ie(-Math.PI,-R.PI_OVER_TWO,Math.PI,R.PI_OVER_TWO));function ee(e,t){this.center=m.clone(T(e,m.ZERO)),this.radius=T(t,0)}const FC=new m,BC=new m,zC=new m,UC=new m,kC=new m,jC=new m,VC=new m,Gi=new m,GC=new m,HC=new m,qC=new m,WC=new m,C6=4/3*R.PI;ee.fromPoints=function(e,t){if(l(t)||(t=new ee),!l(e)||e.length===0)return t.center=m.clone(m.ZERO,t.center),t.radius=0,t;const n=m.clone(e[0],VC),i=m.clone(n,FC),r=m.clone(n,BC),s=m.clone(n,zC),o=m.clone(n,UC),a=m.clone(n,kC),c=m.clone(n,jC),u=e.length;let h;for(h=1;h<u;h++){m.clone(e[h],n);const O=n.x,N=n.y,B=n.z;O<i.x&&m.clone(n,i),O>o.x&&m.clone(n,o),N<r.y&&m.clone(n,r),N>a.y&&m.clone(n,a),B<s.z&&m.clone(n,s),B>c.z&&m.clone(n,c)}const d=m.magnitudeSquared(m.subtract(o,i,Gi)),p=m.magnitudeSquared(m.subtract(a,r,Gi)),g=m.magnitudeSquared(m.subtract(c,s,Gi));let _=i,b=o,x=d;p>x&&(x=p,_=r,b=a),g>x&&(x=g,_=s,b=c);const E=GC;E.x=(_.x+b.x)*.5,E.y=(_.y+b.y)*.5,E.z=(_.z+b.z)*.5;let C=m.magnitudeSquared(m.subtract(b,E,Gi)),w=Math.sqrt(C);const S=HC;S.x=i.x,S.y=r.y,S.z=s.z;const v=qC;v.x=o.x,v.y=a.y,v.z=c.z;const D=m.midpoint(S,v,WC);let L=0;for(h=0;h<u;h++){m.clone(e[h],n);const O=m.magnitude(m.subtract(n,D,Gi));O>L&&(L=O);const N=m.magnitudeSquared(m.subtract(n,E,Gi));if(N>C){const B=Math.sqrt(N);w=(w+B)*.5,C=w*w;const U=B-w;E.x=(w*E.x+U*n.x)/B,E.y=(w*E.y+U*n.y)/B,E.z=(w*E.z+U*n.z)/B}}return w<L?(m.clone(E,t.center),t.radius=w):(m.clone(D,t.center),t.radius=L),t};const Av=new ur,w6=new m,A6=new m,f0=new oe,h0=new oe;ee.fromRectangle2D=function(e,t,n){return ee.fromRectangleWithHeights2D(e,t,0,0,n)};ee.fromRectangleWithHeights2D=function(e,t,n,i,r){if(l(r)||(r=new ee),!l(e))return r.center=m.clone(m.ZERO,r.center),r.radius=0,r;Av._ellipsoid=fe.default,t=T(t,Av),ie.southwest(e,f0),f0.height=n,ie.northeast(e,h0),h0.height=i;const s=t.project(f0,w6),o=t.project(h0,A6),a=o.x-s.x,c=o.y-s.y,u=o.z-s.z;r.radius=Math.sqrt(a*a+c*c+u*u)*.5;const h=r.center;return h.x=s.x+a*.5,h.y=s.y+c*.5,h.z=s.z+u*.5,r};const S6=[];ee.fromRectangle3D=function(e,t,n,i){if(t=T(t,fe.default),n=T(n,0),l(i)||(i=new ee),!l(e))return i.center=m.clone(m.ZERO,i.center),i.radius=0,i;const r=ie.subsample(e,t,n,S6);return ee.fromPoints(r,i)};ee.fromVertices=function(e,t,n,i){if(l(i)||(i=new ee),!l(e)||e.length===0)return i.center=m.clone(m.ZERO,i.center),i.radius=0,i;t=T(t,m.ZERO),n=T(n,3),y.typeOf.number.greaterThanOrEquals("stride",n,3);const r=VC;r.x=e[0]+t.x,r.y=e[1]+t.y,r.z=e[2]+t.z;const s=m.clone(r,FC),o=m.clone(r,BC),a=m.clone(r,zC),c=m.clone(r,UC),u=m.clone(r,kC),h=m.clone(r,jC),d=e.length;let p;for(p=0;p<d;p+=n){const B=e[p]+t.x,U=e[p+1]+t.y,V=e[p+2]+t.z;r.x=B,r.y=U,r.z=V,B<s.x&&m.clone(r,s),B>c.x&&m.clone(r,c),U<o.y&&m.clone(r,o),U>u.y&&m.clone(r,u),V<a.z&&m.clone(r,a),V>h.z&&m.clone(r,h)}const g=m.magnitudeSquared(m.subtract(c,s,Gi)),_=m.magnitudeSquared(m.subtract(u,o,Gi)),b=m.magnitudeSquared(m.subtract(h,a,Gi));let x=s,E=c,C=g;_>C&&(C=_,x=o,E=u),b>C&&(C=b,x=a,E=h);const w=GC;w.x=(x.x+E.x)*.5,w.y=(x.y+E.y)*.5,w.z=(x.z+E.z)*.5;let S=m.magnitudeSquared(m.subtract(E,w,Gi)),v=Math.sqrt(S);const D=HC;D.x=s.x,D.y=o.y,D.z=a.z;const L=qC;L.x=c.x,L.y=u.y,L.z=h.z;const O=m.midpoint(D,L,WC);let N=0;for(p=0;p<d;p+=n){r.x=e[p]+t.x,r.y=e[p+1]+t.y,r.z=e[p+2]+t.z;const B=m.magnitude(m.subtract(r,O,Gi));B>N&&(N=B);const U=m.magnitudeSquared(m.subtract(r,w,Gi));if(U>S){const V=Math.sqrt(U);v=(v+V)*.5,S=v*v;const f=V-v;w.x=(v*w.x+f*r.x)/V,w.y=(v*w.y+f*r.y)/V,w.z=(v*w.z+f*r.z)/V}}return v<N?(m.clone(w,i.center),i.radius=v):(m.clone(O,i.center),i.radius=N),i};ee.fromEncodedCartesianVertices=function(e,t,n){if(l(n)||(n=new ee),!l(e)||!l(t)||e.length!==t.length||e.length===0)return n.center=m.clone(m.ZERO,n.center),n.radius=0,n;const i=VC;i.x=e[0]+t[0],i.y=e[1]+t[1],i.z=e[2]+t[2];const r=m.clone(i,FC),s=m.clone(i,BC),o=m.clone(i,zC),a=m.clone(i,UC),c=m.clone(i,kC),u=m.clone(i,jC),h=e.length;let d;for(d=0;d<h;d+=3){const N=e[d]+t[d],B=e[d+1]+t[d+1],U=e[d+2]+t[d+2];i.x=N,i.y=B,i.z=U,N<r.x&&m.clone(i,r),N>a.x&&m.clone(i,a),B<s.y&&m.clone(i,s),B>c.y&&m.clone(i,c),U<o.z&&m.clone(i,o),U>u.z&&m.clone(i,u)}const p=m.magnitudeSquared(m.subtract(a,r,Gi)),g=m.magnitudeSquared(m.subtract(c,s,Gi)),_=m.magnitudeSquared(m.subtract(u,o,Gi));let b=r,x=a,E=p;g>E&&(E=g,b=s,x=c),_>E&&(E=_,b=o,x=u);const C=GC;C.x=(b.x+x.x)*.5,C.y=(b.y+x.y)*.5,C.z=(b.z+x.z)*.5;let w=m.magnitudeSquared(m.subtract(x,C,Gi)),S=Math.sqrt(w);const v=HC;v.x=r.x,v.y=s.y,v.z=o.z;const D=qC;D.x=a.x,D.y=c.y,D.z=u.z;const L=m.midpoint(v,D,WC);let O=0;for(d=0;d<h;d+=3){i.x=e[d]+t[d],i.y=e[d+1]+t[d+1],i.z=e[d+2]+t[d+2];const N=m.magnitude(m.subtract(i,L,Gi));N>O&&(O=N);const B=m.magnitudeSquared(m.subtract(i,C,Gi));if(B>w){const U=Math.sqrt(B);S=(S+U)*.5,w=S*S;const V=U-S;C.x=(S*C.x+V*i.x)/U,C.y=(S*C.y+V*i.y)/U,C.z=(S*C.z+V*i.z)/U}}return S<O?(m.clone(C,n.center),n.radius=S):(m.clone(L,n.center),n.radius=O),n};ee.fromCornerPoints=function(e,t,n){y.typeOf.object("corner",e),y.typeOf.object("oppositeCorner",t),l(n)||(n=new ee);const i=m.midpoint(e,t,n.center);return n.radius=m.distance(i,t),n};ee.fromEllipsoid=function(e,t){return y.typeOf.object("ellipsoid",e),l(t)||(t=new ee),m.clone(m.ZERO,t.center),t.radius=e.maximumRadius,t};const v6=new m;ee.fromBoundingSpheres=function(e,t){if(l(t)||(t=new ee),!l(e)||e.length===0)return t.center=m.clone(m.ZERO,t.center),t.radius=0,t;const n=e.length;if(n===1)return ee.clone(e[0],t);if(n===2)return ee.union(e[0],e[1],t);const i=[];let r;for(r=0;r<n;r++)i.push(e[r].center);t=ee.fromPoints(i,t);const s=t.center;let o=t.radius;for(r=0;r<n;r++){const a=e[r];o=Math.max(o,m.distance(s,a.center,v6)+a.radius)}return t.radius=o,t};const I6=new m,O6=new m,R6=new m;ee.fromOrientedBoundingBox=function(e,t){y.defined("orientedBoundingBox",e),l(t)||(t=new ee);const n=e.halfAxes,i=H.getColumn(n,0,I6),r=H.getColumn(n,1,O6),s=H.getColumn(n,2,R6);return m.add(i,r,i),m.add(i,s,i),t.center=m.clone(e.center,t.center),t.radius=m.magnitude(i),t};const D6=new m,M6=new m;ee.fromTransformation=function(e,t){y.typeOf.object("transformation",e),l(t)||(t=new ee);const n=P.getTranslation(e,D6),i=P.getScale(e,M6),r=.5*m.magnitude(i);return t.center=m.clone(n,t.center),t.radius=r,t};ee.clone=function(e,t){if(l(e))return l(t)?(t.center=m.clone(e.center,t.center),t.radius=e.radius,t):new ee(e.center,e.radius)};ee.packedLength=4;ee.pack=function(e,t,n){y.typeOf.object("value",e),y.defined("array",t),n=T(n,0);const i=e.center;return t[n++]=i.x,t[n++]=i.y,t[n++]=i.z,t[n]=e.radius,t};ee.unpack=function(e,t,n){y.defined("array",e),t=T(t,0),l(n)||(n=new ee);const i=n.center;return i.x=e[t++],i.y=e[t++],i.z=e[t++],n.radius=e[t],n};const L6=new m,P6=new m;ee.union=function(e,t,n){y.typeOf.object("left",e),y.typeOf.object("right",t),l(n)||(n=new ee);const i=e.center,r=e.radius,s=t.center,o=t.radius,a=m.subtract(s,i,L6),c=m.magnitude(a);if(r>=c+o)return e.clone(n),n;if(o>=c+r)return t.clone(n),n;const u=(r+c+o)*.5,h=m.multiplyByScalar(a,(-r+u)/c,P6);return m.add(h,i,h),m.clone(h,n.center),n.radius=u,n};const N6=new m;ee.expand=function(e,t,n){y.typeOf.object("sphere",e),y.typeOf.object("point",t),n=ee.clone(e,n);const i=m.magnitude(m.subtract(t,n.center,N6));return i>n.radius&&(n.radius=i),n};ee.intersectPlane=function(e,t){y.typeOf.object("sphere",e),y.typeOf.object("plane",t);const n=e.center,i=e.radius,r=t.normal,s=m.dot(r,n)+t.distance;return s<-i?ut.OUTSIDE:s<i?ut.INTERSECTING:ut.INSIDE};ee.transform=function(e,t,n){return y.typeOf.object("sphere",e),y.typeOf.object("transform",t),l(n)||(n=new ee),n.center=P.multiplyByPoint(t,e.center,n.center),n.radius=P.getMaximumScale(t)*e.radius,n};const F6=new m;ee.distanceSquaredTo=function(e,t){y.typeOf.object("sphere",e),y.typeOf.object("cartesian",t);const n=m.subtract(e.center,t,F6),i=m.magnitude(n)-e.radius;return i<=0?0:i*i};ee.transformWithoutScale=function(e,t,n){return y.typeOf.object("sphere",e),y.typeOf.object("transform",t),l(n)||(n=new ee),n.center=P.multiplyByPoint(t,e.center,n.center),n.radius=e.radius,n};const B6=new m;ee.computePlaneDistances=function(e,t,n,i){y.typeOf.object("sphere",e),y.typeOf.object("position",t),y.typeOf.object("direction",n),l(i)||(i=new Kc);const r=m.subtract(e.center,t,B6),s=m.dot(n,r);return i.start=s-e.radius,i.stop=s+e.radius,i};const Sv=new m,z6=new m,U6=new m,k6=new m,j6=new m,V6=new oe,kM=new Array(8);for(let e=0;e<8;++e)kM[e]=new m;const vv=new ur;ee.projectTo2D=function(e,t,n){y.typeOf.object("sphere",e),vv._ellipsoid=fe.default,t=T(t,vv);const i=t.ellipsoid;let r=e.center;const s=e.radius;let o;m.equals(r,m.ZERO)?o=m.clone(m.UNIT_X,Sv):o=i.geodeticSurfaceNormal(r,Sv);const a=m.cross(m.UNIT_Z,o,z6);m.normalize(a,a);const c=m.cross(o,a,U6);m.normalize(c,c),m.multiplyByScalar(o,s,o),m.multiplyByScalar(c,s,c),m.multiplyByScalar(a,s,a);const u=m.negate(c,j6),h=m.negate(a,k6),d=kM;let p=d[0];m.add(o,c,p),m.add(p,a,p),p=d[1],m.add(o,c,p),m.add(p,h,p),p=d[2],m.add(o,u,p),m.add(p,h,p),p=d[3],m.add(o,u,p),m.add(p,a,p),m.negate(o,o),p=d[4],m.add(o,c,p),m.add(p,a,p),p=d[5],m.add(o,c,p),m.add(p,h,p),p=d[6],m.add(o,u,p),m.add(p,h,p),p=d[7],m.add(o,u,p),m.add(p,a,p);const g=d.length;for(let E=0;E<g;++E){const C=d[E];m.add(r,C,C);const w=i.cartesianToCartographic(C,V6);t.project(w,C)}n=ee.fromPoints(d,n),r=n.center;const _=r.x,b=r.y,x=r.z;return r.x=x,r.y=_,r.z=b,n};ee.isOccluded=function(e,t){return y.typeOf.object("sphere",e),y.typeOf.object("occluder",t),!t.isBoundingSphereVisible(e)};ee.equals=function(e,t){return e===t||l(e)&&l(t)&&m.equals(e.center,t.center)&&e.radius===t.radius};ee.prototype.intersectPlane=function(e){return ee.intersectPlane(this,e)};ee.prototype.distanceSquaredTo=function(e){return ee.distanceSquaredTo(this,e)};ee.prototype.computePlaneDistances=function(e,t,n){return ee.computePlaneDistances(this,e,t,n)};ee.prototype.isOccluded=function(e){return ee.isOccluded(this,e)};ee.prototype.equals=function(e){return ee.equals(this,e)};ee.prototype.clone=function(e){return ee.clone(this,e)};ee.prototype.volume=function(){const e=this.radius;return C6*e*e*e};function Vr(e){e=T(e,T.EMPTY_OBJECT),this._ellipsoid=T(e.ellipsoid,fe.default),this._rectangle=T(e.rectangle,ie.MAX_VALUE),this._projection=new ur(this._ellipsoid),this._numberOfLevelZeroTilesX=T(e.numberOfLevelZeroTilesX,2),this._numberOfLevelZeroTilesY=T(e.numberOfLevelZeroTilesY,1)}Object.defineProperties(Vr.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}});Vr.prototype.getNumberOfXTilesAtLevel=function(e){return this._numberOfLevelZeroTilesX<<e};Vr.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY<<e};Vr.prototype.rectangleToNativeRectangle=function(e,t){y.defined("rectangle",e);const n=R.toDegrees(e.west),i=R.toDegrees(e.south),r=R.toDegrees(e.east),s=R.toDegrees(e.north);return l(t)?(t.west=n,t.south=i,t.east=r,t.north=s,t):new ie(n,i,r,s)};Vr.prototype.tileXYToNativeRectangle=function(e,t,n,i){const r=this.tileXYToRectangle(e,t,n,i);return r.west=R.toDegrees(r.west),r.south=R.toDegrees(r.south),r.east=R.toDegrees(r.east),r.north=R.toDegrees(r.north),r};Vr.prototype.tileXYToRectangle=function(e,t,n,i){const r=this._rectangle,s=this.getNumberOfXTilesAtLevel(n),o=this.getNumberOfYTilesAtLevel(n),a=r.width/s,c=e*a+r.west,u=(e+1)*a+r.west,h=r.height/o,d=r.north-t*h,p=r.north-(t+1)*h;return l(i)||(i=new ie(c,p,u,d)),i.west=c,i.south=p,i.east=u,i.north=d,i};Vr.prototype.positionToTileXY=function(e,t,n){const i=this._rectangle;if(!ie.contains(i,e))return;const r=this.getNumberOfXTilesAtLevel(t),s=this.getNumberOfYTilesAtLevel(t),o=i.width/r,a=i.height/s;let c=e.longitude;i.east<i.west&&(c+=R.TWO_PI);let u=(c-i.west)/o|0;u>=r&&(u=r-1);let h=(i.north-e.latitude)/a|0;return h>=s&&(h=s-1),l(n)?(n.x=u,n.y=h,n):new k(u,h)};const Iv=new m,Ov=new m,Rv=new oe,d0=new m,G6=new m,Dv=new ee,H6=new Vr,od=[new oe,new oe,new oe,new oe],ad=new k,on={};on.initialize=function(){let e=on._initPromise;return l(e)||(e=se.fetchJson(ss("Assets/approximateTerrainHeights.json")).then(function(t){on._terrainHeights=t}),on._initPromise=e),e};on.getMinimumMaximumHeights=function(e,t){if(y.defined("rectangle",e),!l(on._terrainHeights))throw new A("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");t=T(t,fe.default);const n=jM(e);let i=on._defaultMinTerrainHeight,r=on._defaultMaxTerrainHeight;if(l(n)){const s=`${n.level}-${n.x}-${n.y}`,o=on._terrainHeights[s];l(o)&&(i=o[0],r=o[1]),t.cartographicToCartesian(ie.northeast(e,Rv),Iv),t.cartographicToCartesian(ie.southwest(e,Rv),Ov),m.midpoint(Ov,Iv,d0);const a=t.scaleToGeodeticSurface(d0,G6);if(l(a)){const c=m.distance(d0,a);i=Math.min(i,-c)}else i=on._defaultMinTerrainHeight}return i=Math.max(on._defaultMinTerrainHeight,i),{minimumTerrainHeight:i,maximumTerrainHeight:r}};on.getBoundingSphere=function(e,t){if(y.defined("rectangle",e),!l(on._terrainHeights))throw new A("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");t=T(t,fe.default);const n=jM(e);let i=on._defaultMaxTerrainHeight;if(l(n)){const s=`${n.level}-${n.x}-${n.y}`,o=on._terrainHeights[s];l(o)&&(i=o[1])}const r=ee.fromRectangle3D(e,t,0);return ee.fromRectangle3D(e,t,i,Dv),ee.union(r,Dv,r)};function jM(e){oe.fromRadians(e.east,e.north,0,od[0]),oe.fromRadians(e.west,e.north,0,od[1]),oe.fromRadians(e.east,e.south,0,od[2]),oe.fromRadians(e.west,e.south,0,od[3]);let t=0,n=0,i=0,r=0;const s=on._terrainHeightsMaxLevel;let o;for(o=0;o<=s;++o){let a=!1;for(let c=0;c<4;++c){const u=od[c];if(H6.positionToTileXY(u,o,ad),c===0)i=ad.x,r=ad.y;else if(i!==ad.x||r!==ad.y){a=!0;break}}if(a)break;t=i,n=r}if(o!==0)return{x:t,y:n,level:o>s?s:o-1}}on._terrainHeightsMaxLevel=6;on._defaultMaxTerrainHeight=9e3;on._defaultMinTerrainHeight=-1e5;on._terrainHeights=void 0;on._initPromise=void 0;Object.defineProperties(on,{initialized:{get:function(){return l(on._terrainHeights)}}});let q6=0;const p0={};function zt(e,t){y.typeOf.string("html",e);let n;const i=e;l(p0[i])?n=p0[i]:(n=q6++,p0[i]=n),t=T(t,!1),this._id=n,this._html=e,this._showOnScreen=t,this._element=void 0}Object.defineProperties(zt.prototype,{html:{get:function(){return this._html}},id:{get:function(){return this._id}},showOnScreen:{get:function(){return this._showOnScreen},set:function(e){this._showOnScreen=e}},element:{get:function(){if(!l(this._element)){const e=nD.sanitize(this._html),t=document.createElement("div");t.className="cesium-credit-wrapper",t._creditId=this._id,t.style.display="inline",t.innerHTML=e;const n=t.querySelectorAll("a");for(let i=0;i<n.length;i++)n[i].setAttribute("target","_blank");this._element=t}return this._element}}});zt.equals=function(e,t){return e===t||l(e)&&l(t)&&e._id===t._id&&e._showOnScreen===t._showOnScreen};zt.prototype.equals=function(e){return zt.equals(this,e)};zt.prototype.isIon=function(){return this.html.indexOf("ion-credit.png")!==-1};zt.getIonCredit=function(e){const t=l(e.collapsible)&&!e.collapsible;return new zt(e.html,t)};zt.clone=function(e){if(l(e))return new zt(e.html,e.showOnScreen)};function wr(e,t,n){this.minimum=m.clone(T(e,m.ZERO)),this.maximum=m.clone(T(t,m.ZERO)),l(n)?n=m.clone(n):n=m.midpoint(this.minimum,this.maximum,new m),this.center=n}wr.fromCorners=function(e,t,n){return y.defined("minimum",e),y.defined("maximum",t),l(n)||(n=new wr),n.minimum=m.clone(e,n.minimum),n.maximum=m.clone(t,n.maximum),n.center=m.midpoint(e,t,n.center),n};wr.fromPoints=function(e,t){if(l(t)||(t=new wr),!l(e)||e.length===0)return t.minimum=m.clone(m.ZERO,t.minimum),t.maximum=m.clone(m.ZERO,t.maximum),t.center=m.clone(m.ZERO,t.center),t;let n=e[0].x,i=e[0].y,r=e[0].z,s=e[0].x,o=e[0].y,a=e[0].z;const c=e.length;for(let d=1;d<c;d++){const p=e[d],g=p.x,_=p.y,b=p.z;n=Math.min(g,n),s=Math.max(g,s),i=Math.min(_,i),o=Math.max(_,o),r=Math.min(b,r),a=Math.max(b,a)}const u=t.minimum;u.x=n,u.y=i,u.z=r;const h=t.maximum;return h.x=s,h.y=o,h.z=a,t.center=m.midpoint(u,h,t.center),t};wr.clone=function(e,t){if(l(e))return l(t)?(t.minimum=m.clone(e.minimum,t.minimum),t.maximum=m.clone(e.maximum,t.maximum),t.center=m.clone(e.center,t.center),t):new wr(e.minimum,e.maximum,e.center)};wr.equals=function(e,t){return e===t||l(e)&&l(t)&&m.equals(e.center,t.center)&&m.equals(e.minimum,t.minimum)&&m.equals(e.maximum,t.maximum)};let Xm=new m;wr.intersectPlane=function(e,t){y.defined("box",e),y.defined("plane",t),Xm=m.subtract(e.maximum,e.minimum,Xm);const n=m.multiplyByScalar(Xm,.5,Xm),i=t.normal,r=n.x*Math.abs(i.x)+n.y*Math.abs(i.y)+n.z*Math.abs(i.z),s=m.dot(e.center,i)+t.distance;return s-r>0?ut.INSIDE:s+r<0?ut.OUTSIDE:ut.INTERSECTING};wr.prototype.clone=function(e){return wr.clone(this,e)};wr.prototype.intersectPlane=function(e){return wr.intersectPlane(this,e)};wr.prototype.equals=function(e){return wr.equals(this,e)};const Io={};Io.computeDiscriminant=function(e,t,n){if(typeof e!="number")throw new A("a is a required number.");if(typeof t!="number")throw new A("b is a required number.");if(typeof n!="number")throw new A("c is a required number.");return t*t-4*e*n};function Mv(e,t,n){const i=e+t;return R.sign(e)!==R.sign(t)&&Math.abs(i/Math.max(Math.abs(e),Math.abs(t)))<n?0:i}Io.computeRealRoots=function(e,t,n){if(typeof e!="number")throw new A("a is a required number.");if(typeof t!="number")throw new A("b is a required number.");if(typeof n!="number")throw new A("c is a required number.");let i;if(e===0)return t===0?[]:[-n/t];if(t===0){if(n===0)return[0,0];const c=Math.abs(n),u=Math.abs(e);if(c<u&&c/u<R.EPSILON14)return[0,0];if(c>u&&u/c<R.EPSILON14)return[];if(i=-n/e,i<0)return[];const h=Math.sqrt(i);return[-h,h]}else if(n===0)return i=-t/e,i<0?[i,0]:[0,i];const r=t*t,s=4*e*n,o=Mv(r,-s,R.EPSILON14);if(o<0)return[];const a=-.5*Mv(t,R.sign(t)*Math.sqrt(o),R.EPSILON14);return t>0?[a/e,n/a]:[n/a,a/e]};const Zp={};Zp.computeDiscriminant=function(e,t,n,i){if(typeof e!="number")throw new A("a is a required number.");if(typeof t!="number")throw new A("b is a required number.");if(typeof n!="number")throw new A("c is a required number.");if(typeof i!="number")throw new A("d is a required number.");const r=e*e,s=t*t,o=n*n,a=i*i;return 18*e*t*n*i+s*o-27*r*a-4*(e*o*n+s*t*i)};function m0(e,t,n,i){const r=e,s=t/3,o=n/3,a=i,c=r*o,u=s*a,h=s*s,d=o*o,p=r*o-h,g=r*a-s*o,_=s*a-d,b=4*p*_-g*g;let x,E;if(b<0){let ne,le,pe;h*u>=c*d?(ne=r,le=p,pe=-2*s*p+r*g):(ne=a,le=_,pe=-a*g+2*o*_);const me=-(pe<0?-1:1)*Math.abs(ne)*Math.sqrt(-b);E=-pe+me;const Pe=E/2,ot=Pe<0?-Math.pow(-Pe,1/3):Math.pow(Pe,1/3),At=E===me?-ot:-le/ot;return x=le<=0?ot+At:-pe/(ot*ot+At*At+le),h*u>=c*d?[(x-s)/r]:[-a/(x+o)]}const C=p,w=-2*s*p+r*g,S=_,v=-a*g+2*o*_,D=Math.sqrt(b),L=Math.sqrt(3)/2;let O=Math.abs(Math.atan2(r*D,-w)/3);x=2*Math.sqrt(-C);let N=Math.cos(O);E=x*N;let B=x*(-N/2-L*Math.sin(O));const U=E+B>2*s?E-s:B-s,V=r,f=U/V;O=Math.abs(Math.atan2(a*D,-v)/3),x=2*Math.sqrt(-S),N=Math.cos(O),E=x*N,B=x*(-N/2-L*Math.sin(O));const I=-a,F=E+B<2*o?E+o:B+o,G=I/F,W=V*F,X=-U*F-V*I,Z=U*I,$=(o*X-s*Z)/(-s*X+o*W);return f<=$?f<=G?$<=G?[f,$,G]:[f,G,$]:[G,f,$]:f<=G?[$,f,G]:$<=G?[$,G,f]:[G,$,f]}Zp.computeRealRoots=function(e,t,n,i){if(typeof e!="number")throw new A("a is a required number.");if(typeof t!="number")throw new A("b is a required number.");if(typeof n!="number")throw new A("c is a required number.");if(typeof i!="number")throw new A("d is a required number.");let r,s;if(e===0)return Io.computeRealRoots(t,n,i);if(t===0){if(n===0){if(i===0)return[0,0,0];s=-i/e;const o=s<0?-Math.pow(-s,1/3):Math.pow(s,1/3);return[o,o,o]}else if(i===0)return r=Io.computeRealRoots(e,0,n),r.Length===0?[0]:[r[0],0,r[1]];return m0(e,0,n,i)}else{if(n===0)return i===0?(s=-t/e,s<0?[s,0,0]:[0,0,s]):m0(e,t,0,i);if(i===0)return r=Io.computeRealRoots(e,t,n),r.length===0?[0]:r[1]<=0?[r[0],r[1],0]:r[0]>=0?[0,r[0],r[1]]:[r[0],0,r[1]]}return m0(e,t,n,i)};const $C={};$C.computeDiscriminant=function(e,t,n,i,r){if(typeof e!="number")throw new A("a is a required number.");if(typeof t!="number")throw new A("b is a required number.");if(typeof n!="number")throw new A("c is a required number.");if(typeof i!="number")throw new A("d is a required number.");if(typeof r!="number")throw new A("e is a required number.");const s=e*e,o=s*e,a=t*t,c=a*t,u=n*n,h=u*n,d=i*i,p=d*i,g=r*r,_=g*r;return a*u*d-4*c*p-4*e*h*d+18*e*t*n*p-27*s*d*d+256*o*_+r*(18*c*n*i-4*a*h+16*e*u*u-80*e*t*u*i-6*e*a*d+144*s*n*d)+g*(144*e*a*n-27*a*a-128*s*u-192*s*t*i)};function po(e,t,n,i){const r=e*e,s=t-3*r/8,o=n-t*e/2+r*e/8,a=i-n*e/4+t*r/16-3*r*r/256,c=Zp.computeRealRoots(1,2*s,s*s-4*a,-o*o);if(c.length>0){const u=-e/4,h=c[c.length-1];if(Math.abs(h)<R.EPSILON14){const d=Io.computeRealRoots(1,s,a);if(d.length===2){const p=d[0],g=d[1];let _;if(p>=0&&g>=0){const b=Math.sqrt(p),x=Math.sqrt(g);return[u-x,u-b,u+b,u+x]}else{if(p>=0&&g<0)return _=Math.sqrt(p),[u-_,u+_];if(p<0&&g>=0)return _=Math.sqrt(g),[u-_,u+_]}}return[]}else if(h>0){const d=Math.sqrt(h),p=(s+h-o/d)/2,g=(s+h+o/d)/2,_=Io.computeRealRoots(1,d,p),b=Io.computeRealRoots(1,-d,g);return _.length!==0?(_[0]+=u,_[1]+=u,b.length!==0?(b[0]+=u,b[1]+=u,_[1]<=b[0]?[_[0],_[1],b[0],b[1]]:b[1]<=_[0]?[b[0],b[1],_[0],_[1]]:_[0]>=b[0]&&_[1]<=b[1]?[b[0],_[0],_[1],b[1]]:b[0]>=_[0]&&b[1]<=_[1]?[_[0],b[0],b[1],_[1]]:_[0]>b[0]&&_[0]<b[1]?[b[0],_[0],b[1],_[1]]:[_[0],b[0],_[1],b[1]]):_):b.length!==0?(b[0]+=u,b[1]+=u,b):[]}}return[]}function cd(e,t,n,i){const r=n*n,s=t*t,o=e*e,a=-2*t,c=n*e+s-4*i,u=o*i-n*t*e+r,h=Zp.computeRealRoots(1,a,c,u);if(h.length>0){const d=h[0],p=t-d,g=p*p,_=e/2,b=p/2,x=g-4*i,E=g+4*Math.abs(i),C=o-4*d,w=o+4*Math.abs(d);let S,v;if(d<0||x*w<C*E){const V=Math.sqrt(C);S=V/2,v=V===0?0:(e*b-n)/V}else{const V=Math.sqrt(x);S=V===0?0:(e*b-n)/V,v=V/2}let D,L;_===0&&S===0?(D=0,L=0):R.sign(_)===R.sign(S)?(D=_+S,L=d/D):(L=_-S,D=d/L);let O,N;b===0&&v===0?(O=0,N=0):R.sign(b)===R.sign(v)?(O=b+v,N=i/O):(N=b-v,O=i/N);const B=Io.computeRealRoots(1,D,O),U=Io.computeRealRoots(1,L,N);if(B.length!==0)return U.length!==0?B[1]<=U[0]?[B[0],B[1],U[0],U[1]]:U[1]<=B[0]?[U[0],U[1],B[0],B[1]]:B[0]>=U[0]&&B[1]<=U[1]?[U[0],B[0],B[1],U[1]]:U[0]>=B[0]&&U[1]<=B[1]?[B[0],U[0],U[1],B[1]]:B[0]>U[0]&&B[0]<U[1]?[U[0],B[0],U[1],B[1]]:[B[0],U[0],B[1],U[1]]:B;if(U.length!==0)return U}return[]}$C.computeRealRoots=function(e,t,n,i,r){if(typeof e!="number")throw new A("a is a required number.");if(typeof t!="number")throw new A("b is a required number.");if(typeof n!="number")throw new A("c is a required number.");if(typeof i!="number")throw new A("d is a required number.");if(typeof r!="number")throw new A("e is a required number.");if(Math.abs(e)<R.EPSILON15)return Zp.computeRealRoots(t,n,i,r);const s=t/e,o=n/e,a=i/e,c=r/e;let u=s<0?1:0;switch(u+=o<0?u+1:u,u+=a<0?u+1:u,u+=c<0?u+1:u,u){case 0:return po(s,o,a,c);case 1:return cd(s,o,a,c);case 2:return cd(s,o,a,c);case 3:return po(s,o,a,c);case 4:return po(s,o,a,c);case 5:return cd(s,o,a,c);case 6:return po(s,o,a,c);case 7:return po(s,o,a,c);case 8:return cd(s,o,a,c);case 9:return po(s,o,a,c);case 10:return po(s,o,a,c);case 11:return cd(s,o,a,c);case 12:return po(s,o,a,c);case 13:return po(s,o,a,c);case 14:return po(s,o,a,c);case 15:return po(s,o,a,c);default:return}};function ya(e,t){t=m.clone(T(t,m.ZERO)),m.equals(t,m.ZERO)||m.normalize(t,t),this.origin=m.clone(T(e,m.ZERO)),this.direction=t}ya.clone=function(e,t){if(l(e))return l(t)?(t.origin=m.clone(e.origin),t.direction=m.clone(e.direction),t):new ya(e.origin,e.direction)};ya.getPoint=function(e,t,n){return y.typeOf.object("ray",e),y.typeOf.number("t",t),l(n)||(n=new m),n=m.multiplyByScalar(e.direction,t,n),m.add(e.origin,n,n)};const Ct={};Ct.rayPlane=function(e,t,n){if(!l(e))throw new A("ray is required.");if(!l(t))throw new A("plane is required.");l(n)||(n=new m);const i=e.origin,r=e.direction,s=t.normal,o=m.dot(s,r);if(Math.abs(o)<R.EPSILON15)return;const a=(-t.distance-m.dot(s,i))/o;if(!(a<0))return n=m.multiplyByScalar(r,a,n),m.add(i,n,n)};const W6=new m,$6=new m,VM=new m,Lv=new m,Pv=new m;Ct.rayTriangleParametric=function(e,t,n,i,r){if(!l(e))throw new A("ray is required.");if(!l(t))throw new A("p0 is required.");if(!l(n))throw new A("p1 is required.");if(!l(i))throw new A("p2 is required.");r=T(r,!1);const s=e.origin,o=e.direction,a=m.subtract(n,t,W6),c=m.subtract(i,t,$6),u=m.cross(o,c,VM),h=m.dot(a,u);let d,p,g,_,b;if(r){if(h<R.EPSILON6||(d=m.subtract(s,t,Lv),g=m.dot(d,u),g<0||g>h)||(p=m.cross(d,a,Pv),_=m.dot(o,p),_<0||g+_>h))return;b=m.dot(c,p)/h}else{if(Math.abs(h)<R.EPSILON6)return;const x=1/h;if(d=m.subtract(s,t,Lv),g=m.dot(d,u)*x,g<0||g>1||(p=m.cross(d,a,Pv),_=m.dot(o,p)*x,_<0||g+_>1))return;b=m.dot(c,p)*x}return b};Ct.rayTriangle=function(e,t,n,i,r,s){const o=Ct.rayTriangleParametric(e,t,n,i,r);if(!(!l(o)||o<0))return l(s)||(s=new m),m.multiplyByScalar(e.direction,o,s),m.add(e.origin,s,s)};const X6=new ya;Ct.lineSegmentTriangle=function(e,t,n,i,r,s,o){if(!l(e))throw new A("v0 is required.");if(!l(t))throw new A("v1 is required.");if(!l(n))throw new A("p0 is required.");if(!l(i))throw new A("p1 is required.");if(!l(r))throw new A("p2 is required.");const a=X6;m.clone(e,a.origin),m.subtract(t,e,a.direction),m.normalize(a.direction,a.direction);const c=Ct.rayTriangleParametric(a,n,i,r,s);if(!(!l(c)||c<0||c>m.distance(e,t)))return l(o)||(o=new m),m.multiplyByScalar(a.direction,c,o),m.add(a.origin,o,o)};function Y6(e,t,n,i){const r=t*t-4*e*n;if(r<0)return;if(r>0){const o=1/(2*e),a=Math.sqrt(r),c=(-t+a)*o,u=(-t-a)*o;return c<u?(i.root0=c,i.root1=u):(i.root0=u,i.root1=c),i}const s=-t/(2*e);if(s!==0)return i.root0=i.root1=s,i}const K6={root0:0,root1:0};function GM(e,t,n){l(n)||(n=new Kc);const i=e.origin,r=e.direction,s=t.center,o=t.radius*t.radius,a=m.subtract(i,s,VM),c=m.dot(r,r),u=2*m.dot(r,a),h=m.magnitudeSquared(a)-o,d=Y6(c,u,h,K6);if(l(d))return n.start=d.root0,n.stop=d.root1,n}Ct.raySphere=function(e,t,n){if(!l(e))throw new A("ray is required.");if(!l(t))throw new A("sphere is required.");if(n=GM(e,t,n),!(!l(n)||n.stop<0))return n.start=Math.max(n.start,0),n};const Z6=new ya;Ct.lineSegmentSphere=function(e,t,n,i){if(!l(e))throw new A("p0 is required.");if(!l(t))throw new A("p1 is required.");if(!l(n))throw new A("sphere is required.");const r=Z6;m.clone(e,r.origin);const s=m.subtract(t,e,r.direction),o=m.magnitude(s);if(m.normalize(s,s),i=GM(r,n,i),!(!l(i)||i.stop<0||i.start>o))return i.start=Math.max(i.start,0),i.stop=Math.min(i.stop,o),i};const J6=new m,Q6=new m;Ct.rayEllipsoid=function(e,t){if(!l(e))throw new A("ray is required.");if(!l(t))throw new A("ellipsoid is required.");const n=t.oneOverRadii,i=m.multiplyComponents(n,e.origin,J6),r=m.multiplyComponents(n,e.direction,Q6),s=m.magnitudeSquared(i),o=m.dot(i,r);let a,c,u,h,d;if(s>1){if(o>=0)return;const p=o*o;if(a=s-1,c=m.magnitudeSquared(r),u=c*a,p<u)return;if(p>u){h=o*o-u,d=-o+Math.sqrt(h);const _=d/c,b=a/d;return _<b?new Kc(_,b):{start:b,stop:_}}const g=Math.sqrt(a/c);return new Kc(g,g)}else if(s<1)return a=s-1,c=m.magnitudeSquared(r),u=c*a,h=o*o-u,d=-o+Math.sqrt(h),new Kc(0,d/c);if(o<0)return c=m.magnitudeSquared(r),new Kc(0,-o/c)};function kl(e,t,n){const i=e+t;return R.sign(e)!==R.sign(t)&&Math.abs(i/Math.max(Math.abs(e),Math.abs(t)))<n?0:i}Ct.quadraticVectorExpression=function(e,t,n,i,r){const s=i*i,o=r*r,a=(e[H.COLUMN1ROW1]-e[H.COLUMN2ROW2])*o,c=r*(i*kl(e[H.COLUMN1ROW0],e[H.COLUMN0ROW1],R.EPSILON15)+t.y),u=e[H.COLUMN0ROW0]*s+e[H.COLUMN2ROW2]*o+i*t.x+n,h=o*kl(e[H.COLUMN2ROW1],e[H.COLUMN1ROW2],R.EPSILON15),d=r*(i*kl(e[H.COLUMN2ROW0],e[H.COLUMN0ROW2])+t.z);let p;const g=[];if(d===0&&h===0){if(p=Io.computeRealRoots(a,c,u),p.length===0)return g;const O=p[0],N=Math.sqrt(Math.max(1-O*O,0));if(g.push(new m(i,r*O,r*-N)),g.push(new m(i,r*O,r*N)),p.length===2){const B=p[1],U=Math.sqrt(Math.max(1-B*B,0));g.push(new m(i,r*B,r*-U)),g.push(new m(i,r*B,r*U))}return g}const _=d*d,b=h*h,x=a*a,E=d*h,C=x+b,w=2*(c*a+E),S=2*u*a+c*c-b+_,v=2*(u*c-E),D=u*u-_;if(C===0&&w===0&&S===0&&v===0)return g;p=$C.computeRealRoots(C,w,S,v,D);const L=p.length;if(L===0)return g;for(let O=0;O<L;++O){const N=p[O],B=N*N,U=Math.max(1-B,0),V=Math.sqrt(U);let f;R.sign(a)===R.sign(u)?f=kl(a*B+u,c*N,R.EPSILON12):R.sign(u)===R.sign(c*N)?f=kl(a*B,c*N+u,R.EPSILON12):f=kl(a*B+c*N,u,R.EPSILON12);const I=kl(h*N,d,R.EPSILON15),F=f*I;F<0?g.push(new m(i,r*N,r*V)):F>0?g.push(new m(i,r*N,r*-V)):V!==0?(g.push(new m(i,r*N,r*-V)),g.push(new m(i,r*N,r*V)),++O):g.push(new m(i,r*N,r*V))}return g};const g0=new m,Nv=new m,Fv=new m,Ym=new m,eW=new m,tW=new H,nW=new H,iW=new H,rW=new H,sW=new H,Bv=new H,zv=new H,Uv=new m,oW=new m,aW=new oe;Ct.grazingAltitudeLocation=function(e,t){if(!l(e))throw new A("ray is required.");if(!l(t))throw new A("ellipsoid is required.");const n=e.origin,i=e.direction;if(!m.equals(n,m.ZERO)){const D=t.geodeticSurfaceNormal(n,g0);if(m.dot(i,D)>=0)return n}const r=l(this.rayEllipsoid(e,t)),s=t.transformPositionToScaledSpace(i,g0),o=m.normalize(s,s),a=m.mostOrthogonalAxis(s,Ym),c=m.normalize(m.cross(a,o,Nv),Nv),u=m.normalize(m.cross(o,c,Fv),Fv),h=tW;h[0]=o.x,h[1]=o.y,h[2]=o.z,h[3]=c.x,h[4]=c.y,h[5]=c.z,h[6]=u.x,h[7]=u.y,h[8]=u.z;const d=H.transpose(h,nW),p=H.fromScale(t.radii,iW),g=H.fromScale(t.oneOverRadii,rW),_=sW;_[0]=0,_[1]=-i.z,_[2]=i.y,_[3]=i.z,_[4]=0,_[5]=-i.x,_[6]=-i.y,_[7]=i.x,_[8]=0;const b=H.multiply(H.multiply(d,g,Bv),_,Bv),x=H.multiply(H.multiply(b,p,zv),h,zv),E=H.multiplyByVector(b,n,eW),C=Ct.quadraticVectorExpression(x,m.negate(E,g0),0,0,1);let w,S;const v=C.length;if(v>0){let D=m.clone(m.ZERO,oW),L=Number.NEGATIVE_INFINITY;for(let N=0;N<v;++N){w=H.multiplyByVector(p,H.multiplyByVector(h,C[N],Uv),Uv);const B=m.normalize(m.subtract(w,n,Ym),Ym),U=m.dot(B,i);U>L&&(L=U,D=m.clone(w,D))}const O=t.cartesianToCartographic(D,aW);return L=R.clamp(L,0,1),S=m.magnitude(m.subtract(D,n,Ym))*Math.sqrt(1-L*L),S=r?-S:S,O.height=S,t.cartographicToCartesian(O,new m)}};const cW=new m;Ct.lineSegmentPlane=function(e,t,n,i){if(!l(e))throw new A("endPoint0 is required.");if(!l(t))throw new A("endPoint1 is required.");if(!l(n))throw new A("plane is required.");l(i)||(i=new m);const r=m.subtract(t,e,cW),s=n.normal,o=m.dot(s,r);if(Math.abs(o)<R.EPSILON6)return;const a=m.dot(s,e),c=-(n.distance+a)/o;if(!(c<0||c>1))return m.multiplyByScalar(r,c,i),m.add(e,i,i),i};Ct.trianglePlaneIntersection=function(e,t,n,i){if(!l(e)||!l(t)||!l(n)||!l(i))throw new A("p0, p1, p2, and plane are required.");const r=i.normal,s=i.distance,o=m.dot(r,e)+s<0,a=m.dot(r,t)+s<0,c=m.dot(r,n)+s<0;let u=0;u+=o?1:0,u+=a?1:0,u+=c?1:0;let h,d;if((u===1||u===2)&&(h=new m,d=new m),u===1){if(o)return Ct.lineSegmentPlane(e,t,i,h),Ct.lineSegmentPlane(e,n,i,d),{positions:[e,t,n,h,d],indices:[0,3,4,1,2,4,1,4,3]};if(a)return Ct.lineSegmentPlane(t,n,i,h),Ct.lineSegmentPlane(t,e,i,d),{positions:[e,t,n,h,d],indices:[1,3,4,2,0,4,2,4,3]};if(c)return Ct.lineSegmentPlane(n,e,i,h),Ct.lineSegmentPlane(n,t,i,d),{positions:[e,t,n,h,d],indices:[2,3,4,0,1,4,0,4,3]}}else if(u===2)if(o)if(a){if(!c)return Ct.lineSegmentPlane(e,n,i,h),Ct.lineSegmentPlane(t,n,i,d),{positions:[e,t,n,h,d],indices:[0,1,4,0,4,3,2,3,4]}}else return Ct.lineSegmentPlane(n,t,i,h),Ct.lineSegmentPlane(e,t,i,d),{positions:[e,t,n,h,d],indices:[2,0,4,2,4,3,1,3,4]};else return Ct.lineSegmentPlane(t,e,i,h),Ct.lineSegmentPlane(n,e,i,d),{positions:[e,t,n,h,d],indices:[1,2,4,1,4,3,0,3,4]}};function Ve(e,t){if(y.typeOf.object("normal",e),!R.equalsEpsilon(m.magnitude(e),1,R.EPSILON6))throw new A("normal must be normalized.");y.typeOf.number("distance",t),this.normal=m.clone(e),this.distance=t}Ve.fromPointNormal=function(e,t,n){if(y.typeOf.object("point",e),y.typeOf.object("normal",t),!R.equalsEpsilon(m.magnitude(t),1,R.EPSILON6))throw new A("normal must be normalized.");const i=-m.dot(t,e);return l(n)?(m.clone(t,n.normal),n.distance=i,n):new Ve(t,i)};const lW=new m;Ve.fromCartesian4=function(e,t){y.typeOf.object("coefficients",e);const n=m.fromCartesian4(e,lW),i=e.w;if(!R.equalsEpsilon(m.magnitude(n),1,R.EPSILON6))throw new A("normal must be normalized.");return l(t)?(m.clone(n,t.normal),t.distance=i,t):new Ve(n,i)};Ve.getPointDistance=function(e,t){return y.typeOf.object("plane",e),y.typeOf.object("point",t),m.dot(e.normal,t)+e.distance};const uW=new m;Ve.projectPointOntoPlane=function(e,t,n){y.typeOf.object("plane",e),y.typeOf.object("point",t),l(n)||(n=new m);const i=Ve.getPointDistance(e,t),r=m.multiplyByScalar(e.normal,i,uW);return m.subtract(t,r,n)};const fW=new P,hW=new Y,dW=new m;Ve.transform=function(e,t,n){y.typeOf.object("plane",e),y.typeOf.object("transform",t);const i=e.normal,r=e.distance,s=P.inverseTranspose(t,fW);let o=Y.fromElements(i.x,i.y,i.z,r,hW);o=P.multiplyByVector(s,o,o);const a=m.fromCartesian4(o,dW);return o=Y.divideByScalar(o,m.magnitude(a),o),Ve.fromCartesian4(o,n)};Ve.clone=function(e,t){return y.typeOf.object("plane",e),l(t)?(m.clone(e.normal,t.normal),t.distance=e.distance,t):new Ve(e.normal,e.distance)};Ve.equals=function(e,t){return y.typeOf.object("left",e),y.typeOf.object("right",t),e.distance===t.distance&&m.equals(e.normal,t.normal)};Ve.ORIGIN_XY_PLANE=Object.freeze(new Ve(m.UNIT_Z,0));Ve.ORIGIN_YZ_PLANE=Object.freeze(new Ve(m.UNIT_X,0));Ve.ORIGIN_ZX_PLANE=Object.freeze(new Ve(m.UNIT_Y,0));const _0=new Y;function ar(e,t){if(y.defined("origin",e),t=T(t,fe.default),e=t.scaleToGeodeticSurface(e),!l(e))throw new A("origin must not be at the center of the ellipsoid.");const n=et.eastNorthUpToFixedFrame(e,t);this._ellipsoid=t,this._origin=e,this._xAxis=m.fromCartesian4(P.getColumn(n,0,_0)),this._yAxis=m.fromCartesian4(P.getColumn(n,1,_0));const i=m.fromCartesian4(P.getColumn(n,2,_0));this._plane=Ve.fromPointNormal(e,i)}Object.defineProperties(ar.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},origin:{get:function(){return this._origin}},plane:{get:function(){return this._plane}},xAxis:{get:function(){return this._xAxis}},yAxis:{get:function(){return this._yAxis}},zAxis:{get:function(){return this._plane.normal}}});const pW=new wr;ar.fromPoints=function(e,t){y.defined("cartesians",e);const n=wr.fromPoints(e,pW);return new ar(n.center,t)};const HM=new ya,V_=new m;ar.prototype.projectPointOntoPlane=function(e,t){y.defined("cartesian",e);const n=HM;n.origin=e,m.normalize(e,n.direction);let i=Ct.rayPlane(n,this._plane,V_);if(l(i)||(m.negate(n.direction,n.direction),i=Ct.rayPlane(n,this._plane,V_)),l(i)){const r=m.subtract(i,this._origin,i),s=m.dot(this._xAxis,r),o=m.dot(this._yAxis,r);return l(t)?(t.x=s,t.y=o,t):new k(s,o)}};ar.prototype.projectPointsOntoPlane=function(e,t){y.defined("cartesians",e),l(t)||(t=[]);let n=0;const i=e.length;for(let r=0;r<i;r++){const s=this.projectPointOntoPlane(e[r],t[n]);l(s)&&(t[n]=s,n++)}return t.length=n,t};ar.prototype.projectPointToNearestOnPlane=function(e,t){y.defined("cartesian",e),l(t)||(t=new k);const n=HM;n.origin=e,m.clone(this._plane.normal,n.direction);let i=Ct.rayPlane(n,this._plane,V_);l(i)||(m.negate(n.direction,n.direction),i=Ct.rayPlane(n,this._plane,V_));const r=m.subtract(i,this._origin,i),s=m.dot(this._xAxis,r),o=m.dot(this._yAxis,r);return t.x=s,t.y=o,t};ar.prototype.projectPointsToNearestOnPlane=function(e,t){y.defined("cartesians",e),l(t)||(t=[]);const n=e.length;t.length=n;for(let i=0;i<n;i++)t[i]=this.projectPointToNearestOnPlane(e[i],t[i]);return t};const mW=new m;ar.prototype.projectPointOntoEllipsoid=function(e,t){y.defined("cartesian",e),l(t)||(t=new m);const n=this._ellipsoid,i=this._origin,r=this._xAxis,s=this._yAxis,o=mW;return m.multiplyByScalar(r,e.x,o),t=m.add(i,o,t),m.multiplyByScalar(s,e.y,o),m.add(t,o,t),n.scaleToGeocentricSurface(t,t),t};ar.prototype.projectPointsOntoEllipsoid=function(e,t){y.defined("cartesians",e);const n=e.length;l(t)?t.length=n:t=new Array(n);for(let i=0;i<n;++i)t[i]=this.projectPointOntoEllipsoid(e[i],t[i]);return t};function st(e,t){this.center=m.clone(T(e,m.ZERO)),this.halfAxes=H.clone(T(t,H.ZERO))}st.packedLength=m.packedLength+H.packedLength;st.pack=function(e,t,n){return y.typeOf.object("value",e),y.defined("array",t),n=T(n,0),m.pack(e.center,t,n),H.pack(e.halfAxes,t,n+m.packedLength),t};st.unpack=function(e,t,n){return y.defined("array",e),t=T(t,0),l(n)||(n=new st),m.unpack(e,t,n.center),H.unpack(e,t+m.packedLength,n.halfAxes),n};const gW=new m,_W=new m,yW=new m,bW=new m,TW=new m,xW=new m,EW=new H,CW={unitary:new H,diagonal:new H};st.fromPoints=function(e,t){if(l(t)||(t=new st),!l(e)||e.length===0)return t.halfAxes=H.ZERO,t.center=m.ZERO,t;let n;const i=e.length,r=m.clone(e[0],gW);for(n=1;n<i;n++)m.add(r,e[n],r);const s=1/i;m.multiplyByScalar(r,s,r);let o=0,a=0,c=0,u=0,h=0,d=0,p;for(n=0;n<i;n++)p=m.subtract(e[n],r,_W),o+=p.x*p.x,a+=p.x*p.y,c+=p.x*p.z,u+=p.y*p.y,h+=p.y*p.z,d+=p.z*p.z;o*=s,a*=s,c*=s,u*=s,h*=s,d*=s;const g=EW;g[0]=o,g[1]=a,g[2]=c,g[3]=a,g[4]=u,g[5]=h,g[6]=c,g[7]=h,g[8]=d;const _=H.computeEigenDecomposition(g,CW),b=H.clone(_.unitary,t.halfAxes);let x=H.getColumn(b,0,bW),E=H.getColumn(b,1,TW),C=H.getColumn(b,2,xW),w=-Number.MAX_VALUE,S=-Number.MAX_VALUE,v=-Number.MAX_VALUE,D=Number.MAX_VALUE,L=Number.MAX_VALUE,O=Number.MAX_VALUE;for(n=0;n<i;n++)p=e[n],w=Math.max(m.dot(x,p),w),S=Math.max(m.dot(E,p),S),v=Math.max(m.dot(C,p),v),D=Math.min(m.dot(x,p),D),L=Math.min(m.dot(E,p),L),O=Math.min(m.dot(C,p),O);x=m.multiplyByScalar(x,.5*(D+w),x),E=m.multiplyByScalar(E,.5*(L+S),E),C=m.multiplyByScalar(C,.5*(O+v),C);const N=m.add(x,E,t.center);m.add(N,C,N);const B=yW;return B.x=w-D,B.y=S-L,B.z=v-O,m.multiplyByScalar(B,.5,B),H.multiplyByScale(t.halfAxes,B,t.halfAxes),t};const qM=new m,wW=new m;function kv(e,t,n,i,r,s,o,a,c,u,h){if(!l(r)||!l(s)||!l(o)||!l(a)||!l(c)||!l(u))throw new A("all extents (minimum/maximum X/Y/Z) are required.");l(h)||(h=new st);const d=h.halfAxes;H.setColumn(d,0,t,d),H.setColumn(d,1,n,d),H.setColumn(d,2,i,d);let p=qM;p.x=(r+s)/2,p.y=(o+a)/2,p.z=(c+u)/2;const g=wW;g.x=(s-r)/2,g.y=(a-o)/2,g.z=(u-c)/2;const _=h.center;return p=H.multiplyByVector(d,p,p),m.add(e,p,_),H.multiplyByScale(d,g,d),h}const jv=new oe,AW=new m,SW=new oe,vW=new oe,IW=new oe,OW=new oe,RW=new oe,DW=new m,Vv=new m,MW=new m,Gv=new m,LW=new m,PW=new k,NW=new k,FW=new k,BW=new k,zW=new k,UW=new m,kW=new m,jW=new m,VW=new m,GW=new k,HW=new m,qW=new m,WW=new m,$W=new Ve(m.UNIT_X,0);st.fromRectangle=function(e,t,n,i,r){if(!l(e))throw new A("rectangle is required");if(e.width<0||e.width>R.TWO_PI)throw new A("Rectangle width must be between 0 and 2 * pi");if(e.height<0||e.height>R.PI)throw new A("Rectangle height must be between 0 and pi");if(l(i)&&!R.equalsEpsilon(i.radii.x,i.radii.y,R.EPSILON15))throw new A("Ellipsoid must be an ellipsoid of revolution (radii.x == radii.y)");t=T(t,0),n=T(n,0),i=T(i,fe.default);let s,o,a,c,u,h,d;if(e.width<=R.PI){const L=ie.center(e,jv),O=i.cartographicToCartesian(L,AW),N=new ar(O,i);d=N.plane;const B=L.longitude,U=e.south<0&&e.north>0?0:L.latitude,V=oe.fromRadians(B,e.north,n,SW),f=oe.fromRadians(e.west,e.north,n,vW),I=oe.fromRadians(e.west,U,n,IW),F=oe.fromRadians(e.west,e.south,n,OW),G=oe.fromRadians(B,e.south,n,RW),W=i.cartographicToCartesian(V,DW);let X=i.cartographicToCartesian(f,Vv);const Z=i.cartographicToCartesian(I,MW);let $=i.cartographicToCartesian(F,Gv);const ne=i.cartographicToCartesian(G,LW),le=N.projectPointToNearestOnPlane(W,PW),pe=N.projectPointToNearestOnPlane(X,NW),we=N.projectPointToNearestOnPlane(Z,FW),me=N.projectPointToNearestOnPlane($,BW),Pe=N.projectPointToNearestOnPlane(ne,zW);return s=Math.min(pe.x,we.x,me.x),o=-s,c=Math.max(pe.y,le.y),a=Math.min(me.y,Pe.y),f.height=F.height=t,X=i.cartographicToCartesian(f,Vv),$=i.cartographicToCartesian(F,Gv),u=Math.min(Ve.getPointDistance(d,X),Ve.getPointDistance(d,$)),h=n,kv(N.origin,N.xAxis,N.yAxis,N.zAxis,s,o,a,c,u,h,r)}const p=e.south>0,g=e.north<0,_=p?e.south:g?e.north:0,b=ie.center(e,jv).longitude,x=m.fromRadians(b,_,n,i,UW);x.z=0;const C=Math.abs(x.x)<R.EPSILON10&&Math.abs(x.y)<R.EPSILON10?m.UNIT_X:m.normalize(x,kW),w=m.UNIT_Z,S=m.cross(C,w,jW);d=Ve.fromPointNormal(x,C,$W);const v=m.fromRadians(b+R.PI_OVER_TWO,_,n,i,VW);o=m.dot(Ve.projectPointOntoPlane(d,v,GW),S),s=-o,c=m.fromRadians(0,e.north,g?t:n,i,HW).z,a=m.fromRadians(0,e.south,p?t:n,i,qW).z;const D=m.fromRadians(e.east,_,n,i,WW);return u=Ve.getPointDistance(d,D),h=0,kv(x,S,w,C,s,o,a,c,u,h,r)};st.fromTransformation=function(e,t){return y.typeOf.object("transformation",e),l(t)||(t=new st),t.center=P.getTranslation(e,t.center),t.halfAxes=P.getMatrix3(e,t.halfAxes),t.halfAxes=H.multiplyByScalar(t.halfAxes,.5,t.halfAxes),t};st.clone=function(e,t){if(l(e))return l(t)?(m.clone(e.center,t.center),H.clone(e.halfAxes,t.halfAxes),t):new st(e.center,e.halfAxes)};st.intersectPlane=function(e,t){if(!l(e))throw new A("box is required.");if(!l(t))throw new A("plane is required.");const n=e.center,i=t.normal,r=e.halfAxes,s=i.x,o=i.y,a=i.z,c=Math.abs(s*r[H.COLUMN0ROW0]+o*r[H.COLUMN0ROW1]+a*r[H.COLUMN0ROW2])+Math.abs(s*r[H.COLUMN1ROW0]+o*r[H.COLUMN1ROW1]+a*r[H.COLUMN1ROW2])+Math.abs(s*r[H.COLUMN2ROW0]+o*r[H.COLUMN2ROW1]+a*r[H.COLUMN2ROW2]),u=m.dot(i,n)+t.distance;return u<=-c?ut.OUTSIDE:u>=c?ut.INSIDE:ut.INTERSECTING};const WM=new m,$M=new m,XM=new m,XW=new m,Hv=new m,YW=new m;st.distanceSquaredTo=function(e,t){if(!l(e))throw new A("box is required.");if(!l(t))throw new A("cartesian is required.");const n=m.subtract(t,e.center,qM),i=e.halfAxes;let r=H.getColumn(i,0,WM),s=H.getColumn(i,1,$M),o=H.getColumn(i,2,XM);const a=m.magnitude(r),c=m.magnitude(s),u=m.magnitude(o);let h=!0,d=!0,p=!0;a>0?m.divideByScalar(r,a,r):h=!1,c>0?m.divideByScalar(s,c,s):d=!1,u>0?m.divideByScalar(o,u,o):p=!1;const g=!h+!d+!p;let _,b,x;if(g===1){let S=r;_=s,b=o,d?p||(S=o,b=r):(S=s,_=r),x=m.cross(_,b,Hv),S===r?r=x:S===s?s=x:S===o&&(o=x)}else if(g===2){_=r,d?_=s:p&&(_=o);let S=m.UNIT_Y;S.equalsEpsilon(_,R.EPSILON3)&&(S=m.UNIT_X),b=m.cross(_,S,XW),m.normalize(b,b),x=m.cross(_,b,Hv),m.normalize(x,x),_===r?(s=b,o=x):_===s?(o=b,r=x):_===o&&(r=b,s=x)}else g===3&&(r=m.UNIT_X,s=m.UNIT_Y,o=m.UNIT_Z);const E=YW;E.x=m.dot(n,r),E.y=m.dot(n,s),E.z=m.dot(n,o);let C=0,w;return E.x<-a?(w=E.x+a,C+=w*w):E.x>a&&(w=E.x-a,C+=w*w),E.y<-c?(w=E.y+c,C+=w*w):E.y>c&&(w=E.y-c,C+=w*w),E.z<-u?(w=E.z+u,C+=w*w):E.z>u&&(w=E.z-u,C+=w*w),C};const KW=new m,ZW=new m;st.computePlaneDistances=function(e,t,n,i){if(!l(e))throw new A("box is required.");if(!l(t))throw new A("position is required.");if(!l(n))throw new A("direction is required.");l(i)||(i=new Kc);let r=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const o=e.center,a=e.halfAxes,c=H.getColumn(a,0,WM),u=H.getColumn(a,1,$M),h=H.getColumn(a,2,XM),d=m.add(c,u,KW);m.add(d,h,d),m.add(d,o,d);const p=m.subtract(d,t,ZW);let g=m.dot(n,p);return r=Math.min(g,r),s=Math.max(g,s),m.add(o,c,d),m.add(d,u,d),m.subtract(d,h,d),m.subtract(d,t,p),g=m.dot(n,p),r=Math.min(g,r),s=Math.max(g,s),m.add(o,c,d),m.subtract(d,u,d),m.add(d,h,d),m.subtract(d,t,p),g=m.dot(n,p),r=Math.min(g,r),s=Math.max(g,s),m.add(o,c,d),m.subtract(d,u,d),m.subtract(d,h,d),m.subtract(d,t,p),g=m.dot(n,p),r=Math.min(g,r),s=Math.max(g,s),m.subtract(o,c,d),m.add(d,u,d),m.add(d,h,d),m.subtract(d,t,p),g=m.dot(n,p),r=Math.min(g,r),s=Math.max(g,s),m.subtract(o,c,d),m.add(d,u,d),m.subtract(d,h,d),m.subtract(d,t,p),g=m.dot(n,p),r=Math.min(g,r),s=Math.max(g,s),m.subtract(o,c,d),m.subtract(d,u,d),m.add(d,h,d),m.subtract(d,t,p),g=m.dot(n,p),r=Math.min(g,r),s=Math.max(g,s),m.subtract(o,c,d),m.subtract(d,u,d),m.subtract(d,h,d),m.subtract(d,t,p),g=m.dot(n,p),r=Math.min(g,r),s=Math.max(g,s),i.start=r,i.stop=s,i};const JW=new m,QW=new m,e$=new m;st.computeCorners=function(e,t){y.typeOf.object("box",e),l(t)||(t=[new m,new m,new m,new m,new m,new m,new m,new m]);const n=e.center,i=e.halfAxes,r=H.getColumn(i,0,JW),s=H.getColumn(i,1,QW),o=H.getColumn(i,2,e$);return m.clone(n,t[0]),m.subtract(t[0],r,t[0]),m.subtract(t[0],s,t[0]),m.subtract(t[0],o,t[0]),m.clone(n,t[1]),m.subtract(t[1],r,t[1]),m.subtract(t[1],s,t[1]),m.add(t[1],o,t[1]),m.clone(n,t[2]),m.subtract(t[2],r,t[2]),m.add(t[2],s,t[2]),m.subtract(t[2],o,t[2]),m.clone(n,t[3]),m.subtract(t[3],r,t[3]),m.add(t[3],s,t[3]),m.add(t[3],o,t[3]),m.clone(n,t[4]),m.add(t[4],r,t[4]),m.subtract(t[4],s,t[4]),m.subtract(t[4],o,t[4]),m.clone(n,t[5]),m.add(t[5],r,t[5]),m.subtract(t[5],s,t[5]),m.add(t[5],o,t[5]),m.clone(n,t[6]),m.add(t[6],r,t[6]),m.add(t[6],s,t[6]),m.subtract(t[6],o,t[6]),m.clone(n,t[7]),m.add(t[7],r,t[7]),m.add(t[7],s,t[7]),m.add(t[7],o,t[7]),t};const t$=new H;st.computeTransformation=function(e,t){y.typeOf.object("box",e),l(t)||(t=new P);const n=e.center,i=H.multiplyByUniformScale(e.halfAxes,2,t$);return P.fromRotationTranslation(i,n,t)};const n$=new ee;st.isOccluded=function(e,t){if(!l(e))throw new A("box is required.");if(!l(t))throw new A("occluder is required.");const n=ee.fromOrientedBoundingBox(e,n$);return!t.isBoundingSphereVisible(n)};st.prototype.intersectPlane=function(e){return st.intersectPlane(this,e)};st.prototype.distanceSquaredTo=function(e){return st.distanceSquaredTo(this,e)};st.prototype.computePlaneDistances=function(e,t,n){return st.computePlaneDistances(this,e,t,n)};st.prototype.computeCorners=function(e){return st.computeCorners(this,e)};st.prototype.computeTransformation=function(e){return st.computeTransformation(this,e)};st.prototype.isOccluded=function(e){return st.isOccluded(this,e)};st.equals=function(e,t){return e===t||l(e)&&l(t)&&m.equals(e.center,t.center)&&H.equals(e.halfAxes,t.halfAxes)};st.prototype.clone=function(e){return st.clone(this,e)};st.prototype.equals=function(e){return st.equals(this,e)};const i$={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_ASTC_4x4_WEBGL:37808,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_BPTC_UNORM:36492,HALF_FLOAT_OES:36193,DOUBLE:5130,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047},j=Object.freeze(i$),$e={BYTE:j.BYTE,UNSIGNED_BYTE:j.UNSIGNED_BYTE,SHORT:j.SHORT,UNSIGNED_SHORT:j.UNSIGNED_SHORT,INT:j.INT,UNSIGNED_INT:j.UNSIGNED_INT,FLOAT:j.FLOAT,DOUBLE:j.DOUBLE};$e.getSizeInBytes=function(e){if(!l(e))throw new A("value is required.");switch(e){case $e.BYTE:return Int8Array.BYTES_PER_ELEMENT;case $e.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case $e.SHORT:return Int16Array.BYTES_PER_ELEMENT;case $e.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case $e.INT:return Int32Array.BYTES_PER_ELEMENT;case $e.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case $e.FLOAT:return Float32Array.BYTES_PER_ELEMENT;case $e.DOUBLE:return Float64Array.BYTES_PER_ELEMENT;default:throw new A("componentDatatype is not a valid value.")}};$e.fromTypedArray=function(e){if(e instanceof Int8Array)return $e.BYTE;if(e instanceof Uint8Array)return $e.UNSIGNED_BYTE;if(e instanceof Int16Array)return $e.SHORT;if(e instanceof Uint16Array)return $e.UNSIGNED_SHORT;if(e instanceof Int32Array)return $e.INT;if(e instanceof Uint32Array)return $e.UNSIGNED_INT;if(e instanceof Float32Array)return $e.FLOAT;if(e instanceof Float64Array)return $e.DOUBLE;throw new A("array must be an Int8Array, Uint8Array, Int16Array, Uint16Array, Int32Array, Uint32Array, Float32Array, or Float64Array.")};$e.validate=function(e){return l(e)&&(e===$e.BYTE||e===$e.UNSIGNED_BYTE||e===$e.SHORT||e===$e.UNSIGNED_SHORT||e===$e.INT||e===$e.UNSIGNED_INT||e===$e.FLOAT||e===$e.DOUBLE)};$e.createTypedArray=function(e,t){if(!l(e))throw new A("componentDatatype is required.");if(!l(t))throw new A("valuesOrLength is required.");switch(e){case $e.BYTE:return new Int8Array(t);case $e.UNSIGNED_BYTE:return new Uint8Array(t);case $e.SHORT:return new Int16Array(t);case $e.UNSIGNED_SHORT:return new Uint16Array(t);case $e.INT:return new Int32Array(t);case $e.UNSIGNED_INT:return new Uint32Array(t);case $e.FLOAT:return new Float32Array(t);case $e.DOUBLE:return new Float64Array(t);default:throw new A("componentDatatype is not a valid value.")}};$e.createArrayBufferView=function(e,t,n,i){if(!l(e))throw new A("componentDatatype is required.");if(!l(t))throw new A("buffer is required.");switch(n=T(n,0),i=T(i,(t.byteLength-n)/$e.getSizeInBytes(e)),e){case $e.BYTE:return new Int8Array(t,n,i);case $e.UNSIGNED_BYTE:return new Uint8Array(t,n,i);case $e.SHORT:return new Int16Array(t,n,i);case $e.UNSIGNED_SHORT:return new Uint16Array(t,n,i);case $e.INT:return new Int32Array(t,n,i);case $e.UNSIGNED_INT:return new Uint32Array(t,n,i);case $e.FLOAT:return new Float32Array(t,n,i);case $e.DOUBLE:return new Float64Array(t,n,i);default:throw new A("componentDatatype is not a valid value.")}};$e.fromName=function(e){switch(e){case"BYTE":return $e.BYTE;case"UNSIGNED_BYTE":return $e.UNSIGNED_BYTE;case"SHORT":return $e.SHORT;case"UNSIGNED_SHORT":return $e.UNSIGNED_SHORT;case"INT":return $e.INT;case"UNSIGNED_INT":return $e.UNSIGNED_INT;case"FLOAT":return $e.FLOAT;case"DOUBLE":return $e.DOUBLE;default:throw new A("name is not a valid value.")}};const q=Object.freeze($e);function Te(e,t,n,i){this[0]=T(e,0),this[1]=T(n,0),this[2]=T(t,0),this[3]=T(i,0)}Te.packedLength=4;Te.pack=function(e,t,n){return y.typeOf.object("value",e),y.defined("array",t),n=T(n,0),t[n++]=e[0],t[n++]=e[1],t[n++]=e[2],t[n++]=e[3],t};Te.unpack=function(e,t,n){return y.defined("array",e),t=T(t,0),l(n)||(n=new Te),n[0]=e[t++],n[1]=e[t++],n[2]=e[t++],n[3]=e[t++],n};Te.packArray=function(e,t){y.defined("array",e);const n=e.length,i=n*4;if(!l(t))t=new Array(i);else{if(!Array.isArray(t)&&t.length!==i)throw new A("If result is a typed array, it must have exactly array.length * 4 elements");t.length!==i&&(t.length=i)}for(let r=0;r<n;++r)Te.pack(e[r],t,r*4);return t};Te.unpackArray=function(e,t){if(y.defined("array",e),y.typeOf.number.greaterThanOrEquals("array.length",e.length,4),e.length%4!==0)throw new A("array length must be a multiple of 4.");const n=e.length;l(t)?t.length=n/4:t=new Array(n/4);for(let i=0;i<n;i+=4){const r=i/4;t[r]=Te.unpack(e,i,t[r])}return t};Te.clone=function(e,t){if(l(e))return l(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):new Te(e[0],e[2],e[1],e[3])};Te.fromArray=Te.unpack;Te.fromColumnMajorArray=function(e,t){return y.defined("values",e),Te.clone(e,t)};Te.fromRowMajorArray=function(e,t){return y.defined("values",e),l(t)?(t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3],t):new Te(e[0],e[1],e[2],e[3])};Te.fromScale=function(e,t){return y.typeOf.object("scale",e),l(t)?(t[0]=e.x,t[1]=0,t[2]=0,t[3]=e.y,t):new Te(e.x,0,0,e.y)};Te.fromUniformScale=function(e,t){return y.typeOf.number("scale",e),l(t)?(t[0]=e,t[1]=0,t[2]=0,t[3]=e,t):new Te(e,0,0,e)};Te.fromRotation=function(e,t){y.typeOf.number("angle",e);const n=Math.cos(e),i=Math.sin(e);return l(t)?(t[0]=n,t[1]=i,t[2]=-i,t[3]=n,t):new Te(n,-i,i,n)};Te.toArray=function(e,t){return y.typeOf.object("matrix",e),l(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):[e[0],e[1],e[2],e[3]]};Te.getElementIndex=function(e,t){return y.typeOf.number.greaterThanOrEquals("row",t,0),y.typeOf.number.lessThanOrEquals("row",t,1),y.typeOf.number.greaterThanOrEquals("column",e,0),y.typeOf.number.lessThanOrEquals("column",e,1),e*2+t};Te.getColumn=function(e,t,n){y.typeOf.object("matrix",e),y.typeOf.number.greaterThanOrEquals("index",t,0),y.typeOf.number.lessThanOrEquals("index",t,1),y.typeOf.object("result",n);const i=t*2,r=e[i],s=e[i+1];return n.x=r,n.y=s,n};Te.setColumn=function(e,t,n,i){y.typeOf.object("matrix",e),y.typeOf.number.greaterThanOrEquals("index",t,0),y.typeOf.number.lessThanOrEquals("index",t,1),y.typeOf.object("cartesian",n),y.typeOf.object("result",i),i=Te.clone(e,i);const r=t*2;return i[r]=n.x,i[r+1]=n.y,i};Te.getRow=function(e,t,n){y.typeOf.object("matrix",e),y.typeOf.number.greaterThanOrEquals("index",t,0),y.typeOf.number.lessThanOrEquals("index",t,1),y.typeOf.object("result",n);const i=e[t],r=e[t+2];return n.x=i,n.y=r,n};Te.setRow=function(e,t,n,i){return y.typeOf.object("matrix",e),y.typeOf.number.greaterThanOrEquals("index",t,0),y.typeOf.number.lessThanOrEquals("index",t,1),y.typeOf.object("cartesian",n),y.typeOf.object("result",i),i=Te.clone(e,i),i[t]=n.x,i[t+2]=n.y,i};const r$=new k;Te.setScale=function(e,t,n){y.typeOf.object("matrix",e),y.typeOf.object("scale",t),y.typeOf.object("result",n);const i=Te.getScale(e,r$),r=t.x/i.x,s=t.y/i.y;return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*s,n[3]=e[3]*s,n};const s$=new k;Te.setUniformScale=function(e,t,n){y.typeOf.object("matrix",e),y.typeOf.number("scale",t),y.typeOf.object("result",n);const i=Te.getScale(e,s$),r=t/i.x,s=t/i.y;return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*s,n[3]=e[3]*s,n};const qv=new k;Te.getScale=function(e,t){return y.typeOf.object("matrix",e),y.typeOf.object("result",t),t.x=k.magnitude(k.fromElements(e[0],e[1],qv)),t.y=k.magnitude(k.fromElements(e[2],e[3],qv)),t};const Wv=new k;Te.getMaximumScale=function(e){return Te.getScale(e,Wv),k.maximumComponent(Wv)};const o$=new k;Te.setRotation=function(e,t,n){y.typeOf.object("matrix",e),y.typeOf.object("result",n);const i=Te.getScale(e,o$);return n[0]=t[0]*i.x,n[1]=t[1]*i.x,n[2]=t[2]*i.y,n[3]=t[3]*i.y,n};const a$=new k;Te.getRotation=function(e,t){y.typeOf.object("matrix",e),y.typeOf.object("result",t);const n=Te.getScale(e,a$);return t[0]=e[0]/n.x,t[1]=e[1]/n.x,t[2]=e[2]/n.y,t[3]=e[3]/n.y,t};Te.multiply=function(e,t,n){y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n);const i=e[0]*t[0]+e[2]*t[1],r=e[0]*t[2]+e[2]*t[3],s=e[1]*t[0]+e[3]*t[1],o=e[1]*t[2]+e[3]*t[3];return n[0]=i,n[1]=s,n[2]=r,n[3]=o,n};Te.add=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n};Te.subtract=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n};Te.multiplyByVector=function(e,t,n){y.typeOf.object("matrix",e),y.typeOf.object("cartesian",t),y.typeOf.object("result",n);const i=e[0]*t.x+e[2]*t.y,r=e[1]*t.x+e[3]*t.y;return n.x=i,n.y=r,n};Te.multiplyByScalar=function(e,t,n){return y.typeOf.object("matrix",e),y.typeOf.number("scalar",t),y.typeOf.object("result",n),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n};Te.multiplyByScale=function(e,t,n){return y.typeOf.object("matrix",e),y.typeOf.object("scale",t),y.typeOf.object("result",n),n[0]=e[0]*t.x,n[1]=e[1]*t.x,n[2]=e[2]*t.y,n[3]=e[3]*t.y,n};Te.multiplyByUniformScale=function(e,t,n){return y.typeOf.object("matrix",e),y.typeOf.number("scale",t),y.typeOf.object("result",n),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n};Te.negate=function(e,t){return y.typeOf.object("matrix",e),y.typeOf.object("result",t),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t};Te.transpose=function(e,t){y.typeOf.object("matrix",e),y.typeOf.object("result",t);const n=e[0],i=e[2],r=e[1],s=e[3];return t[0]=n,t[1]=i,t[2]=r,t[3]=s,t};Te.abs=function(e,t){return y.typeOf.object("matrix",e),y.typeOf.object("result",t),t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t};Te.equals=function(e,t){return e===t||l(e)&&l(t)&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]};Te.equalsArray=function(e,t,n){return e[0]===t[n]&&e[1]===t[n+1]&&e[2]===t[n+2]&&e[3]===t[n+3]};Te.equalsEpsilon=function(e,t,n){return n=T(n,0),e===t||l(e)&&l(t)&&Math.abs(e[0]-t[0])<=n&&Math.abs(e[1]-t[1])<=n&&Math.abs(e[2]-t[2])<=n&&Math.abs(e[3]-t[3])<=n};Te.IDENTITY=Object.freeze(new Te(1,0,0,1));Te.ZERO=Object.freeze(new Te(0,0,0,0));Te.COLUMN0ROW0=0;Te.COLUMN0ROW1=1;Te.COLUMN1ROW0=2;Te.COLUMN1ROW1=3;Object.defineProperties(Te.prototype,{length:{get:function(){return Te.packedLength}}});Te.prototype.clone=function(e){return Te.clone(this,e)};Te.prototype.equals=function(e){return Te.equals(this,e)};Te.prototype.equalsEpsilon=function(e,t){return Te.equalsEpsilon(this,e,t)};Te.prototype.toString=function(){return`(${this[0]}, ${this[2]})
(${this[1]}, ${this[3]})`};const Xt={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"};Xt.getMathType=function(e){switch(e){case Xt.SCALAR:return Number;case Xt.VEC2:return k;case Xt.VEC3:return m;case Xt.VEC4:return Y;case Xt.MAT2:return Te;case Xt.MAT3:return H;case Xt.MAT4:return P;default:throw new A("attributeType is not a valid value.")}};Xt.getNumberOfComponents=function(e){switch(e){case Xt.SCALAR:return 1;case Xt.VEC2:return 2;case Xt.VEC3:return 3;case Xt.VEC4:case Xt.MAT2:return 4;case Xt.MAT3:return 9;case Xt.MAT4:return 16;default:throw new A("attributeType is not a valid value.")}};Xt.getAttributeLocationCount=function(e){switch(e){case Xt.SCALAR:case Xt.VEC2:case Xt.VEC3:case Xt.VEC4:return 1;case Xt.MAT2:return 2;case Xt.MAT3:return 3;case Xt.MAT4:return 4;default:throw new A("attributeType is not a valid value.")}};Xt.getGlslType=function(e){switch(y.typeOf.string("attributeType",e),e){case Xt.SCALAR:return"float";case Xt.VEC2:return"vec2";case Xt.VEC3:return"vec3";case Xt.VEC4:return"vec4";case Xt.MAT2:return"mat2";case Xt.MAT3:return"mat3";case Xt.MAT4:return"mat4";default:throw new A("attributeType is not a valid value.")}};const tt=Object.freeze(Xt),$v=1/256,Xv=256,nt={};nt.octEncodeInRange=function(e,t,n){y.defined("vector",e),y.defined("result",n);const i=m.magnitudeSquared(e);if(Math.abs(i-1)>R.EPSILON6)throw new A("vector must be normalized.");if(n.x=e.x/(Math.abs(e.x)+Math.abs(e.y)+Math.abs(e.z)),n.y=e.y/(Math.abs(e.x)+Math.abs(e.y)+Math.abs(e.z)),e.z<0){const r=n.x,s=n.y;n.x=(1-Math.abs(s))*R.signNotZero(r),n.y=(1-Math.abs(r))*R.signNotZero(s)}return n.x=R.toSNorm(n.x,t),n.y=R.toSNorm(n.y,t),n};nt.octEncode=function(e,t){return nt.octEncodeInRange(e,255,t)};const ld=new k,Yv=new Uint8Array(1);function Km(e){return Yv[0]=e,Yv[0]}nt.octEncodeToCartesian4=function(e,t){return nt.octEncodeInRange(e,65535,ld),t.x=Km(ld.x*$v),t.y=Km(ld.x),t.z=Km(ld.y*$v),t.w=Km(ld.y),t};nt.octDecodeInRange=function(e,t,n,i){if(y.defined("result",i),e<0||e>n||t<0||t>n)throw new A(`x and y must be unsigned normalized integers between 0 and ${n}`);if(i.x=R.fromSNorm(e,n),i.y=R.fromSNorm(t,n),i.z=1-(Math.abs(i.x)+Math.abs(i.y)),i.z<0){const r=i.x;i.x=(1-Math.abs(i.y))*R.signNotZero(r),i.y=(1-Math.abs(r))*R.signNotZero(i.y)}return m.normalize(i,i)};nt.octDecode=function(e,t,n){return nt.octDecodeInRange(e,t,255,n)};nt.octDecodeFromCartesian4=function(e,t){y.typeOf.object("encoded",e),y.typeOf.object("result",t);const n=e.x,i=e.y,r=e.z,s=e.w;if(n<0||n>255||i<0||i>255||r<0||r>255||s<0||s>255)throw new A("x, y, z, and w must be unsigned normalized integers between 0 and 255");const o=n*Xv+i,a=r*Xv+s;return nt.octDecodeInRange(o,a,65535,t)};nt.octPackFloat=function(e){return y.defined("encoded",e),256*e.x+e.y};const Wx=new k;nt.octEncodeFloat=function(e){return nt.octEncode(e,Wx),nt.octPackFloat(Wx)};nt.octDecodeFloat=function(e,t){y.defined("value",e);const n=e/256,i=Math.floor(n),r=(n-i)*256;return nt.octDecode(i,r,t)};nt.octPack=function(e,t,n,i){y.defined("v1",e),y.defined("v2",t),y.defined("v3",n),y.defined("result",i);const r=nt.octEncodeFloat(e),s=nt.octEncodeFloat(t),o=nt.octEncode(n,Wx);return i.x=65536*o.x+r,i.y=65536*o.y+s,i};nt.octUnpack=function(e,t,n,i){y.defined("packed",e),y.defined("v1",t),y.defined("v2",n),y.defined("v3",i);let r=e.x/65536;const s=Math.floor(r),o=(r-s)*65536;r=e.y/65536;const a=Math.floor(r),c=(r-a)*65536;nt.octDecodeFloat(o,t),nt.octDecodeFloat(c,n),nt.octDecode(s,a,i)};nt.compressTextureCoordinates=function(e){y.defined("textureCoordinates",e);const t=e.x*4095|0,n=e.y*4095|0;return 4096*t+n};nt.decompressTextureCoordinates=function(e,t){y.defined("compressed",e),y.defined("result",t);const n=e/4096,i=Math.floor(n);return t.x=i/4095,t.y=(e-i*4096)/4095,t};function y0(e){return e>>1^-(e&1)}nt.zigZagDeltaDecode=function(e,t,n){y.defined("uBuffer",e),y.defined("vBuffer",t),y.typeOf.number.equals("uBuffer.length","vBuffer.length",e.length,t.length),l(n)&&y.typeOf.number.equals("uBuffer.length","heightBuffer.length",e.length,n.length);const i=e.length;let r=0,s=0,o=0;for(let a=0;a<i;++a)r+=y0(e[a]),s+=y0(t[a]),e[a]=r,t[a]=s,l(n)&&(o+=y0(n[a]),n[a]=o)};nt.dequantize=function(e,t,n,i){y.defined("typedArray",e),y.defined("componentDatatype",t),y.defined("type",n),y.defined("count",i);const r=tt.getNumberOfComponents(n);let s;switch(t){case q.BYTE:s=127;break;case q.UNSIGNED_BYTE:s=255;break;case q.SHORT:s=32767;break;case q.UNSIGNED_SHORT:s=65535;break;case q.INT:s=2147483647;break;case q.UNSIGNED_INT:s=4294967295;break;default:throw new A(`Cannot dequantize component datatype: ${t}`)}const o=new Float32Array(i*r);for(let a=0;a<i;a++)for(let c=0;c<r;c++){const u=a*r+c;o[u]=Math.max(e[u]/s,-1)}return o};nt.decodeRGB565=function(e,t){y.defined("typedArray",e);const n=e.length*3;l(t)&&y.typeOf.number.equals("result.length","typedArray.length * 3",t.length,n);const i=e.length;l(t)||(t=new Float32Array(i*3));const r=31,s=63,o=1/31,a=1/63;for(let c=0;c<i;c++){const u=e[c],h=u>>11,d=u>>5&s,p=u&r,g=3*c;t[g]=h*o,t[g+1]=d*a,t[g+2]=p*o}return t};const sl={};sl.getHeight=function(e,t,n){if(!Number.isFinite(t))throw new A("scale must be a finite number.");if(!Number.isFinite(n))throw new A("relativeHeight must be a finite number.");return(e-n)*t+n};const c$=new oe;sl.getPosition=function(e,t,n,i,r){const s=t.cartesianToCartographic(e,c$);if(!l(s))return m.clone(e,r);const o=sl.getHeight(s.height,n,i);return m.fromRadians(s.longitude,s.latitude,o,t,r)};function Jn(e){this._ellipsoid=T(e,fe.WGS84),this._semimajorAxis=this._ellipsoid.maximumRadius,this._oneOverSemimajorAxis=1/this._semimajorAxis}Object.defineProperties(Jn.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});Jn.mercatorAngleToGeodeticLatitude=function(e){return R.PI_OVER_TWO-2*Math.atan(Math.exp(-e))};Jn.geodeticLatitudeToMercatorAngle=function(e){e>Jn.MaximumLatitude?e=Jn.MaximumLatitude:e<-Jn.MaximumLatitude&&(e=-Jn.MaximumLatitude);const t=Math.sin(e);return .5*Math.log((1+t)/(1-t))};Jn.MaximumLatitude=Jn.mercatorAngleToGeodeticLatitude(Math.PI);Jn.prototype.project=function(e,t){const n=this._semimajorAxis,i=e.longitude*n,r=Jn.geodeticLatitudeToMercatorAngle(e.latitude)*n,s=e.height;return l(t)?(t.x=i,t.y=r,t.z=s,t):new m(i,r,s)};Jn.prototype.unproject=function(e,t){if(!l(e))throw new A("cartesian is required");const n=this._oneOverSemimajorAxis,i=e.x*n,r=Jn.mercatorAngleToGeodeticLatitude(e.y*n),s=e.z;return l(t)?(t.longitude=i,t.latitude=r,t.height=s,t):new oe(i,r,s)};function l$(){return!0}function Ye(e,t){t=T(t,"This object was destroyed, i.e., destroy() was called.");function n(){throw new A(t)}for(const i in e)typeof e[i]=="function"&&(e[i]=n);e.isDestroyed=l$}function YM(){if(!l(Dn._canTransferArrayBuffer)){const e=XC("transferTypedArrayTest");e.postMessage=T(e.webkitPostMessage,e.postMessage);const t=99,n=new Int8Array([t]);try{e.postMessage({array:n},[n.buffer])}catch{return Dn._canTransferArrayBuffer=!1,Dn._canTransferArrayBuffer}Dn._canTransferArrayBuffer=new Promise(i=>{e.onmessage=function(r){const s=r.data.array,o=l(s)&&s[0]===t;i(o),e.terminate(),Dn._canTransferArrayBuffer=o}})}return Dn._canTransferArrayBuffer}const $x=new jt;function b0(e){let t;try{t=new Blob([e],{type:"application/javascript"})}catch{const r=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,s=new r;s.append(e),t=s.getBlob("application/javascript")}return(window.URL||window.webkitURL).createObjectURL(t)}function XC(e){const t=new Do(e),n=t.scheme().length!==0&&t.fragment().length===0,i=e.replace(/\.js$/,""),r={};let s,o;if(Fx(e))o=e;else if(!n){const a=ss(`${Dn._workerModulePrefix}/${i}.js`);Fx(a)&&(o=a)}if(o){const a=`import "${o}";`;return s=b0(a),r.type="module",new Worker(s,r)}if(!n&&typeof CESIUM_WORKERS<"u"){const a=`
      importScripts("${b0(CESIUM_WORKERS)}");
      CesiumWorkers["${i}"]();
    `;return s=b0(a),new Worker(s,r)}if(s=e,n||(s=ss(`${Dn._workerModulePrefix+i}.js`)),!It.supportsEsmWebWorkers())throw new te("This browser is not supported. Please update your browser to continue.");return r.type="module",new Worker(s,r)}async function u$(e,t){const n={modulePath:void 0,wasmBinaryFile:void 0,wasmBinary:void 0};if(!It.supportsWebAssembly()){if(!l(t.fallbackModulePath))throw new te(`This browser does not support Web Assembly, and no backup module was provided for ${e._workerPath}`);return n.modulePath=ss(t.fallbackModulePath),n}n.wasmBinaryFile=ss(t.wasmBinaryFile);const i=await se.fetchArrayBuffer({url:n.wasmBinaryFile});return n.wasmBinary=i,n}function Dn(e,t){this._workerPath=e,this._maximumActiveTasks=T(t,Number.POSITIVE_INFINITY),this._activeTasks=0,this._nextID=0,this._webAssemblyPromise=void 0}const f$=(e,t,n,i)=>{const r=({data:s})=>{if(s.id===t){if(l(s.error)){let o=s.error;o.name==="RuntimeError"?(o=new te(s.error.message),o.stack=s.error.stack):o.name==="DeveloperError"?(o=new A(s.error.message),o.stack=s.error.stack):o.name==="Error"&&(o=new Error(s.error.message),o.stack=s.error.stack),$x.raiseEvent(o),i(o)}else $x.raiseEvent(),n(s.result);e.removeEventListener("message",r)}};return r},h$=[];async function d$(e,t,n){const i=await Promise.resolve(YM());l(n)?i||(n.length=0):n=h$;const r=e._nextID++,s=new Promise((o,a)=>{e._worker.addEventListener("message",f$(e._worker,r,o,a))});return e._worker.postMessage({id:r,baseUrl:ss.getCesiumBaseUrl().url,parameters:t,canTransferArrayBuffer:i},n),s}async function p$(e,t,n){++e._activeTasks;try{const i=await d$(e,t,n);return--e._activeTasks,i}catch(i){throw--e._activeTasks,i}}Dn.prototype.scheduleTask=function(e,t){if(l(this._worker)||(this._worker=XC(this._workerPath)),!(this._activeTasks>=this._maximumActiveTasks))return p$(this,e,t)};Dn.prototype.initWebAssemblyModule=async function(e){if(l(this._webAssemblyPromise))return this._webAssemblyPromise;const t=async()=>{const n=this._worker=XC(this._workerPath),i=await u$(this,e),r=await Promise.resolve(YM());let s;const o=i.wasmBinary;l(o)&&r&&(s=[o]);const a=new Promise((c,u)=>{n.onmessage=function({data:h}){l(h)?c(h.result):u(new te("Could not configure wasm module"))}});return n.postMessage({canTransferArrayBuffer:r,parameters:{webAssemblyConfig:i}},s),a};return this._webAssemblyPromise=t(),this._webAssemblyPromise};Dn.prototype.isDestroyed=function(){return!1};Dn.prototype.destroy=function(){return l(this._worker)&&this._worker.terminate(),Ye(this)};Dn.taskCompletedEvent=$x;Dn._defaultWorkerModulePrefix="Workers/";Dn._workerModulePrefix=Dn._defaultWorkerModulePrefix;Dn._canTransferArrayBuffer=void 0;const Oi={UNSIGNED_BYTE:j.UNSIGNED_BYTE,UNSIGNED_SHORT:j.UNSIGNED_SHORT,UNSIGNED_INT:j.UNSIGNED_INT};Oi.getSizeInBytes=function(e){switch(e){case Oi.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case Oi.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case Oi.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT}throw new A("indexDatatype is required and must be a valid IndexDatatype constant.")};Oi.fromSizeInBytes=function(e){switch(e){case 2:return Oi.UNSIGNED_SHORT;case 4:return Oi.UNSIGNED_INT;case 1:return Oi.UNSIGNED_BYTE;default:throw new A("Size in bytes cannot be mapped to an IndexDatatype")}};Oi.validate=function(e){return l(e)&&(e===Oi.UNSIGNED_BYTE||e===Oi.UNSIGNED_SHORT||e===Oi.UNSIGNED_INT)};Oi.createTypedArray=function(e,t){if(!l(e))throw new A("numberOfVertices is required.");return e>=R.SIXTY_FOUR_KILOBYTES?new Uint32Array(t):new Uint16Array(t)};Oi.createTypedArrayFromArrayBuffer=function(e,t,n,i){if(!l(e))throw new A("numberOfVertices is required.");if(!l(t))throw new A("sourceArray is required.");if(!l(n))throw new A("byteOffset is required.");return e>=R.SIXTY_FOUR_KILOBYTES?new Uint32Array(t,n,i):new Uint16Array(t,n,i)};Oi.fromTypedArray=function(e){if(e instanceof Uint8Array)return Oi.UNSIGNED_BYTE;if(e instanceof Uint16Array)return Oi.UNSIGNED_SHORT;if(e instanceof Uint32Array)return Oi.UNSIGNED_INT;throw new A("array must be a Uint8Array, Uint16Array, or Uint32Array.")};const Ge=Object.freeze(Oi);function Ur(){A.throwInstantiationError()}Object.defineProperties(Ur.prototype,{errorEvent:{get:A.throwInstantiationError},credit:{get:A.throwInstantiationError},tilingScheme:{get:A.throwInstantiationError},hasWaterMask:{get:A.throwInstantiationError},hasVertexNormals:{get:A.throwInstantiationError},availability:{get:A.throwInstantiationError}});const Kv=[];Ur.getRegularGridIndices=function(e,t){if(e*t>=R.FOUR_GIGABYTES)throw new A("The total number of vertices (width * height) must be less than 4,294,967,296.");let n=Kv[e];l(n)||(Kv[e]=n=[]);let i=n[t];return l(i)||(e*t<R.SIXTY_FOUR_KILOBYTES?i=n[t]=new Uint16Array((e-1)*(t-1)*6):i=n[t]=new Uint32Array((e-1)*(t-1)*6),ZM(e,t,i,0)),i};const Zv=[];Ur.getRegularGridIndicesAndEdgeIndices=function(e,t){if(e*t>=R.FOUR_GIGABYTES)throw new A("The total number of vertices (width * height) must be less than 4,294,967,296.");let n=Zv[e];l(n)||(Zv[e]=n=[]);let i=n[t];if(!l(i)){const r=Ur.getRegularGridIndices(e,t),s=KM(e,t),o=s.westIndicesSouthToNorth,a=s.southIndicesEastToWest,c=s.eastIndicesNorthToSouth,u=s.northIndicesWestToEast;i=n[t]={indices:r,westIndicesSouthToNorth:o,southIndicesEastToWest:a,eastIndicesNorthToSouth:c,northIndicesWestToEast:u}}return i};const Jv=[];Ur.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){if(e*t>=R.FOUR_GIGABYTES)throw new A("The total number of vertices (width * height) must be less than 4,294,967,296.");let n=Jv[e];l(n)||(Jv[e]=n=[]);let i=n[t];if(!l(i)){const r=e*t,s=(e-1)*(t-1)*6,o=e*2+t*2,a=Math.max(0,o-4)*6,c=r+o,u=s+a,h=KM(e,t),d=h.westIndicesSouthToNorth,p=h.southIndicesEastToWest,g=h.eastIndicesNorthToSouth,_=h.northIndicesWestToEast,b=Ge.createTypedArray(c,u);ZM(e,t,b,0),Ur.addSkirtIndices(d,p,g,_,r,b,s),i=n[t]={indices:b,westIndicesSouthToNorth:d,southIndicesEastToWest:p,eastIndicesNorthToSouth:g,northIndicesWestToEast:_,indexCountWithoutSkirts:s}}return i};Ur.addSkirtIndices=function(e,t,n,i,r,s,o){let a=r;o=Zm(e,a,s,o),a+=e.length,o=Zm(t,a,s,o),a+=t.length,o=Zm(n,a,s,o),a+=n.length,Zm(i,a,s,o)};function KM(e,t){const n=new Array(t),i=new Array(e),r=new Array(t),s=new Array(e);let o;for(o=0;o<e;++o)s[o]=o,i[o]=e*t-1-o;for(o=0;o<t;++o)r[o]=(o+1)*e-1,n[o]=(t-o-1)*e;return{westIndicesSouthToNorth:n,southIndicesEastToWest:i,eastIndicesNorthToSouth:r,northIndicesWestToEast:s}}function ZM(e,t,n,i){let r=0;for(let s=0;s<t-1;++s){for(let o=0;o<e-1;++o){const a=r,c=a+e,u=c+1,h=a+1;n[i++]=a,n[i++]=c,n[i++]=h,n[i++]=h,n[i++]=c,n[i++]=u,++r}++r}}function Zm(e,t,n,i){let r=e[0];const s=e.length;for(let o=1;o<s;++o){const a=e[o];n[i++]=r,n[i++]=a,n[i++]=t,n[i++]=t,n[i++]=a,n[i++]=t+1,r=a,++t}return i}Ur.heightmapTerrainQuality=.25;Ur.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,n){return e.maximumRadius*2*Math.PI*Ur.heightmapTerrainQuality/(t*n)};Ur.prototype.requestTileGeometry=A.throwInstantiationError;Ur.prototype.getLevelMaximumGeometricError=A.throwInstantiationError;Ur.prototype.getTileDataAvailable=A.throwInstantiationError;Ur.prototype.loadTileDataAvailability=A.throwInstantiationError;function m$(e){let t;const n=e.name,i=e.message;l(n)&&l(i)?t=`${n}: ${i}`:t=e.toString();const r=e.stack;return l(r)&&(t+=`
${r}`),t}function Mo(e,t,n,i,r,s,o){this.provider=e,this.message=t,this.x=n,this.y=i,this.level=r,this.timesRetried=T(s,0),this.retry=!1,this.error=o}Mo.reportError=function(e,t,n,i,r,s,o,a){let c=e;return l(e)?(c.provider=t,c.message=i,c.x=r,c.y=s,c.level=o,c.retry=!1,c.error=a,++c.timesRetried):c=new Mo(t,i,r,s,o,0,a),l(n)&&n.numberOfListeners>0?n.raiseEvent(c):l(t)&&console.log(`An error occurred in "${t.constructor.name}": ${m$(i)}`),c};Mo.reportSuccess=function(e){l(e)&&(e.timesRetried=-1)};function fs(e){if(e=T(e,T.EMPTY_OBJECT),this._ellipsoid=T(e.ellipsoid,fe.default),this._numberOfLevelZeroTilesX=T(e.numberOfLevelZeroTilesX,1),this._numberOfLevelZeroTilesY=T(e.numberOfLevelZeroTilesY,1),this._projection=new Jn(this._ellipsoid),l(e.rectangleSouthwestInMeters)&&l(e.rectangleNortheastInMeters))this._rectangleSouthwestInMeters=e.rectangleSouthwestInMeters,this._rectangleNortheastInMeters=e.rectangleNortheastInMeters;else{const i=this._ellipsoid.maximumRadius*Math.PI;this._rectangleSouthwestInMeters=new k(-i,-i),this._rectangleNortheastInMeters=new k(i,i)}const t=this._projection.unproject(this._rectangleSouthwestInMeters),n=this._projection.unproject(this._rectangleNortheastInMeters);this._rectangle=new ie(t.longitude,t.latitude,n.longitude,n.latitude)}Object.defineProperties(fs.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}});fs.prototype.getNumberOfXTilesAtLevel=function(e){return this._numberOfLevelZeroTilesX<<e};fs.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY<<e};fs.prototype.rectangleToNativeRectangle=function(e,t){const n=this._projection,i=n.project(ie.southwest(e)),r=n.project(ie.northeast(e));return l(t)?(t.west=i.x,t.south=i.y,t.east=r.x,t.north=r.y,t):new ie(i.x,i.y,r.x,r.y)};fs.prototype.tileXYToNativeRectangle=function(e,t,n,i){const r=this.getNumberOfXTilesAtLevel(n),s=this.getNumberOfYTilesAtLevel(n),o=(this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x)/r,a=this._rectangleSouthwestInMeters.x+e*o,c=this._rectangleSouthwestInMeters.x+(e+1)*o,u=(this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y)/s,h=this._rectangleNortheastInMeters.y-t*u,d=this._rectangleNortheastInMeters.y-(t+1)*u;return l(i)?(i.west=a,i.south=d,i.east=c,i.north=h,i):new ie(a,d,c,h)};fs.prototype.tileXYToRectangle=function(e,t,n,i){const r=this.tileXYToNativeRectangle(e,t,n,i),s=this._projection,o=s.unproject(new k(r.west,r.south)),a=s.unproject(new k(r.east,r.north));return r.west=o.longitude,r.south=o.latitude,r.east=a.longitude,r.north=a.latitude,r};fs.prototype.positionToTileXY=function(e,t,n){const i=this._rectangle;if(!ie.contains(i,e))return;const r=this.getNumberOfXTilesAtLevel(t),s=this.getNumberOfYTilesAtLevel(t),a=(this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x)/r,u=(this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y)/s,d=this._projection.project(e),p=d.x-this._rectangleSouthwestInMeters.x,g=this._rectangleNortheastInMeters.y-d.y;let _=p/a|0;_>=r&&(_=r-1);let b=g/u|0;return b>=s&&(b=s-1),l(n)?(n.x=_,n.y=b,n):new k(_,b)};const g$={NONE:0,GEODESIC:1,RHUMB:2},Co=Object.freeze(g$),_$={XTRANSLATE:"xTranslate",YTRANSLATE:"yTranslate",ZTRANSLATE:"zTranslate",XROTATE:"xRotate",YROTATE:"yRotate",ZROTATE:"zRotate",XSCALE:"xScale",YSCALE:"yScale",ZSCALE:"zScale",UNIFORMSCALE:"uniformScale"},_o=Object.freeze(_$);function Lu(){this._array=[],this._hash={}}Object.defineProperties(Lu.prototype,{length:{get:function(){return this._array.length}},values:{get:function(){return this._array}}});Lu.prototype.contains=function(e){if(typeof e!="string"&&typeof e!="number")throw new A("key is required to be a string or number.");return l(this._hash[e])};Lu.prototype.set=function(e,t){if(typeof e!="string"&&typeof e!="number")throw new A("key is required to be a string or number.");const n=this._hash[e];t!==n&&(this.remove(e),this._hash[e]=t,this._array.push(t))};Lu.prototype.get=function(e){if(typeof e!="string"&&typeof e!="number")throw new A("key is required to be a string or number.");return this._hash[e]};Lu.prototype.remove=function(e){if(l(e)&&typeof e!="string"&&typeof e!="number")throw new A("key is required to be a string or number.");const t=this._hash[e],n=l(t);if(n){const i=this._array;i.splice(i.indexOf(t),1),delete this._hash[e]}return n};Lu.prototype.removeAll=function(){const e=this._array;e.length>0&&(this._hash={},e.length=0)};function Ot(e,t,n,i){this.x=T(e,0),this.y=T(t,0),this.width=T(n,0),this.height=T(i,0)}Ot.packedLength=4;Ot.pack=function(e,t,n){return y.typeOf.object("value",e),y.defined("array",t),n=T(n,0),t[n++]=e.x,t[n++]=e.y,t[n++]=e.width,t[n]=e.height,t};Ot.unpack=function(e,t,n){return y.defined("array",e),t=T(t,0),l(n)||(n=new Ot),n.x=e[t++],n.y=e[t++],n.width=e[t++],n.height=e[t],n};Ot.fromPoints=function(e,t){if(l(t)||(t=new Ot),!l(e)||e.length===0)return t.x=0,t.y=0,t.width=0,t.height=0,t;const n=e.length;let i=e[0].x,r=e[0].y,s=e[0].x,o=e[0].y;for(let a=1;a<n;a++){const c=e[a],u=c.x,h=c.y;i=Math.min(u,i),s=Math.max(u,s),r=Math.min(h,r),o=Math.max(h,o)}return t.x=i,t.y=r,t.width=s-i,t.height=o-r,t};const Qv=new ur,y$=new oe,b$=new oe;Ot.fromRectangle=function(e,t,n){if(l(n)||(n=new Ot),!l(e))return n.x=0,n.y=0,n.width=0,n.height=0,n;Qv._ellipsoid=fe.default,t=T(t,Qv);const i=t.project(ie.southwest(e,y$)),r=t.project(ie.northeast(e,b$));return k.subtract(r,i,r),n.x=i.x,n.y=i.y,n.width=r.x,n.height=r.y,n};Ot.clone=function(e,t){if(l(e))return l(t)?(t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,t):new Ot(e.x,e.y,e.width,e.height)};Ot.union=function(e,t,n){y.typeOf.object("left",e),y.typeOf.object("right",t),l(n)||(n=new Ot);const i=Math.min(e.x,t.x),r=Math.min(e.y,t.y),s=Math.max(e.x+e.width,t.x+t.width),o=Math.max(e.y+e.height,t.y+t.height);return n.x=i,n.y=r,n.width=s-i,n.height=o-r,n};Ot.expand=function(e,t,n){y.typeOf.object("rectangle",e),y.typeOf.object("point",t),n=Ot.clone(e,n);const i=t.x-n.x,r=t.y-n.y;return i>n.width?n.width=i:i<0&&(n.width-=i,n.x=t.x),r>n.height?n.height=r:r<0&&(n.height-=r,n.y=t.y),n};Ot.intersect=function(e,t){y.typeOf.object("left",e),y.typeOf.object("right",t);const n=e.x,i=e.y,r=t.x,s=t.y;return n>r+t.width||n+e.width<r||i+e.height<s||i>s+t.height?ut.OUTSIDE:ut.INTERSECTING};Ot.equals=function(e,t){return e===t||l(e)&&l(t)&&e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height};Ot.prototype.clone=function(e){return Ot.clone(this,e)};Ot.prototype.intersect=function(e){return Ot.intersect(this,e)};Ot.prototype.equals=function(e){return Ot.equals(this,e)};const T$={NONE:0,TRIANGLES:1,LINES:2,POLYLINES:3},Nd=Object.freeze(T$),nr={POINTS:j.POINTS,LINES:j.LINES,LINE_LOOP:j.LINE_LOOP,LINE_STRIP:j.LINE_STRIP,TRIANGLES:j.TRIANGLES,TRIANGLE_STRIP:j.TRIANGLE_STRIP,TRIANGLE_FAN:j.TRIANGLE_FAN};nr.isLines=function(e){return e===nr.LINES||e===nr.LINE_LOOP||e===nr.LINE_STRIP};nr.isTriangles=function(e){return e===nr.TRIANGLES||e===nr.TRIANGLE_STRIP||e===nr.TRIANGLE_FAN};nr.validate=function(e){return e===nr.POINTS||e===nr.LINES||e===nr.LINE_LOOP||e===nr.LINE_STRIP||e===nr.TRIANGLES||e===nr.TRIANGLE_STRIP||e===nr.TRIANGLE_FAN};const Fe=Object.freeze(nr);function Ht(e){e=T(e,T.EMPTY_OBJECT),y.typeOf.object("options.attributes",e.attributes),this.attributes=e.attributes,this.indices=e.indices,this.primitiveType=T(e.primitiveType,Fe.TRIANGLES),this.boundingSphere=e.boundingSphere,this.geometryType=T(e.geometryType,Nd.NONE),this.boundingSphereCV=e.boundingSphereCV,this.offsetAttribute=e.offsetAttribute}Ht.computeNumberOfVertices=function(e){y.typeOf.object("geometry",e);let t=-1;for(const n in e.attributes)if(e.attributes.hasOwnProperty(n)&&l(e.attributes[n])&&l(e.attributes[n].values)){const i=e.attributes[n],r=i.values.length/i.componentsPerAttribute;if(t!==r&&t!==-1)throw new A("All attribute lists must have the same number of attributes.");t=r}return t};const x$=new oe,E$=new m,eI=new P,C$=[new oe,new oe,new oe],w$=[new k,new k,new k],A$=[new k,new k,new k],S$=new m,v$=new re,I$=new P,O$=new Te;Ht._textureCoordinateRotationPoints=function(e,t,n,i){let r;const s=ie.center(i,x$),o=oe.toCartesian(s,n,E$),a=et.eastNorthUpToFixedFrame(o,n,eI),c=P.inverse(a,eI),u=w$,h=C$;h[0].longitude=i.west,h[0].latitude=i.south,h[1].longitude=i.west,h[1].latitude=i.north,h[2].longitude=i.east,h[2].latitude=i.south;let d=S$;for(r=0;r<3;r++)oe.toCartesian(h[r],n,d),d=P.multiplyByPointAsVector(c,d,d),u[r].x=d.x,u[r].y=d.y;const p=re.fromAxisAngle(m.UNIT_Z,-t,v$),g=H.fromQuaternion(p,I$),_=e.length;let b=Number.POSITIVE_INFINITY,x=Number.POSITIVE_INFINITY,E=Number.NEGATIVE_INFINITY,C=Number.NEGATIVE_INFINITY;for(r=0;r<_;r++)d=P.multiplyByPointAsVector(c,e[r],d),d=H.multiplyByVector(g,d,d),b=Math.min(b,d.x),x=Math.min(x,d.y),E=Math.max(E,d.x),C=Math.max(C,d.y);const w=Te.fromRotation(t,O$),S=A$;S[0].x=b,S[0].y=x,S[1].x=b,S[1].y=C,S[2].x=E,S[2].y=x;const v=u[0],D=u[2].x-v.x,L=u[1].y-v.y;for(r=0;r<3;r++){const V=S[r];Te.multiplyByVector(w,V,V),V.x=(V.x-v.x)/D,V.y=(V.y-v.y)/L}const O=S[0],N=S[1],B=S[2],U=new Array(6);return k.pack(O,U),k.pack(N,U,2),k.pack(B,U,4),U};function Lt(e){if(e=T(e,T.EMPTY_OBJECT),!l(e.componentDatatype))throw new A("options.componentDatatype is required.");if(!l(e.componentsPerAttribute))throw new A("options.componentsPerAttribute is required.");if(e.componentsPerAttribute<1||e.componentsPerAttribute>4)throw new A("options.componentsPerAttribute must be between 1 and 4.");if(!l(e.values))throw new A("options.values is required.");this.componentDatatype=e.componentDatatype,this.componentsPerAttribute=e.componentsPerAttribute,this.normalize=T(e.normalize,!1),this.values=e.values}function Pu(e){e=T(e,T.EMPTY_OBJECT),this.position=e.position,this.normal=e.normal,this.st=e.st,this.bitangent=e.bitangent,this.tangent=e.tangent,this.color=e.color}const R$={NONE:0,TOP:1,ALL:2},Js=Object.freeze(R$);function Qt(e){e=T(e,T.EMPTY_OBJECT),this.position=T(e.position,!1),this.normal=T(e.normal,!1),this.st=T(e.st,!1),this.bitangent=T(e.bitangent,!1),this.tangent=T(e.tangent,!1),this.color=T(e.color,!1)}Qt.POSITION_ONLY=Object.freeze(new Qt({position:!0}));Qt.POSITION_AND_NORMAL=Object.freeze(new Qt({position:!0,normal:!0}));Qt.POSITION_NORMAL_AND_ST=Object.freeze(new Qt({position:!0,normal:!0,st:!0}));Qt.POSITION_AND_ST=Object.freeze(new Qt({position:!0,st:!0}));Qt.POSITION_AND_COLOR=Object.freeze(new Qt({position:!0,color:!0}));Qt.ALL=Object.freeze(new Qt({position:!0,normal:!0,st:!0,tangent:!0,bitangent:!0}));Qt.DEFAULT=Qt.POSITION_NORMAL_AND_ST;Qt.packedLength=6;Qt.pack=function(e,t,n){if(!l(e))throw new A("value is required");if(!l(t))throw new A("array is required");return n=T(n,0),t[n++]=e.position?1:0,t[n++]=e.normal?1:0,t[n++]=e.st?1:0,t[n++]=e.tangent?1:0,t[n++]=e.bitangent?1:0,t[n]=e.color?1:0,t};Qt.unpack=function(e,t,n){if(!l(e))throw new A("array is required");return t=T(t,0),l(n)||(n=new Qt),n.position=e[t++]===1,n.normal=e[t++]===1,n.st=e[t++]===1,n.tangent=e[t++]===1,n.bitangent=e[t++]===1,n.color=e[t]===1,n};Qt.clone=function(e,t){if(l(e))return l(t)||(t=new Qt),t.position=e.position,t.normal=e.normal,t.st=e.st,t.tangent=e.tangent,t.bitangent=e.bitangent,t.color=e.color,t};const D$=new m;function ba(e){e=T(e,T.EMPTY_OBJECT);const t=e.minimum,n=e.maximum;if(y.typeOf.object("min",t),y.typeOf.object("max",n),l(e.offsetAttribute)&&e.offsetAttribute===Js.TOP)throw new A("GeometryOffsetAttribute.TOP is not a supported options.offsetAttribute for this geometry.");this._min=m.clone(t),this._max=m.clone(n),this._offsetAttribute=e.offsetAttribute,this._workerName="createBoxOutlineGeometry"}ba.fromDimensions=function(e){e=T(e,T.EMPTY_OBJECT);const t=e.dimensions;y.typeOf.object("dimensions",t),y.typeOf.number.greaterThanOrEquals("dimensions.x",t.x,0),y.typeOf.number.greaterThanOrEquals("dimensions.y",t.y,0),y.typeOf.number.greaterThanOrEquals("dimensions.z",t.z,0);const n=m.multiplyByScalar(t,.5,new m);return new ba({minimum:m.negate(n,new m),maximum:n,offsetAttribute:e.offsetAttribute})};ba.fromAxisAlignedBoundingBox=function(e){return y.typeOf.object("boundindBox",e),new ba({minimum:e.minimum,maximum:e.maximum})};ba.packedLength=2*m.packedLength+1;ba.pack=function(e,t,n){return y.typeOf.object("value",e),y.defined("array",t),n=T(n,0),m.pack(e._min,t,n),m.pack(e._max,t,n+m.packedLength),t[n+m.packedLength*2]=T(e._offsetAttribute,-1),t};const JM=new m,QM=new m,tI={minimum:JM,maximum:QM,offsetAttribute:void 0};ba.unpack=function(e,t,n){y.defined("array",e),t=T(t,0);const i=m.unpack(e,t,JM),r=m.unpack(e,t+m.packedLength,QM),s=e[t+m.packedLength*2];return l(n)?(n._min=m.clone(i,n._min),n._max=m.clone(r,n._max),n._offsetAttribute=s===-1?void 0:s,n):(tI.offsetAttribute=s===-1?void 0:s,new ba(tI))};ba.createGeometry=function(e){const t=e._min,n=e._max;if(m.equals(t,n))return;const i=new Pu,r=new Uint16Array(12*2),s=new Float64Array(8*3);s[0]=t.x,s[1]=t.y,s[2]=t.z,s[3]=n.x,s[4]=t.y,s[5]=t.z,s[6]=n.x,s[7]=n.y,s[8]=t.z,s[9]=t.x,s[10]=n.y,s[11]=t.z,s[12]=t.x,s[13]=t.y,s[14]=n.z,s[15]=n.x,s[16]=t.y,s[17]=n.z,s[18]=n.x,s[19]=n.y,s[20]=n.z,s[21]=t.x,s[22]=n.y,s[23]=n.z,i.position=new Lt({componentDatatype:q.DOUBLE,componentsPerAttribute:3,values:s}),r[0]=4,r[1]=5,r[2]=5,r[3]=6,r[4]=6,r[5]=7,r[6]=7,r[7]=4,r[8]=0,r[9]=1,r[10]=1,r[11]=2,r[12]=2,r[13]=3,r[14]=3,r[15]=0,r[16]=0,r[17]=4,r[18]=1,r[19]=5,r[20]=2,r[21]=6,r[22]=3,r[23]=7;const o=m.subtract(n,t,D$),a=m.magnitude(o)*.5;if(l(e._offsetAttribute)){const c=s.length,u=e._offsetAttribute===Js.NONE?0:1,h=new Uint8Array(c/3).fill(u);i.applyOffset=new Lt({componentDatatype:q.UNSIGNED_BYTE,componentsPerAttribute:1,values:h})}return new Ht({attributes:i,indices:r,primitiveType:Fe.LINES,boundingSphere:new ee(m.ZERO,a),offsetAttribute:e._offsetAttribute})};function Mn(){this.times=void 0,this.points=void 0,A.throwInstantiationError()}Mn.getPointType=function(e){if(typeof e=="number")return Number;if(e instanceof m)return m;if(e instanceof re)return re;throw new A("point must be a Cartesian3, Quaternion, or number.")};Mn.prototype.evaluate=A.throwInstantiationError;Mn.prototype.findTimeInterval=function(e,t){const n=this.times,i=n.length;if(y.typeOf.number("time",e),e<n[0]||e>n[i-1])throw new A("time is out of range.");if(t=T(t,0),e>=n[t]){if(t+1<i&&e<n[t+1])return t;if(t+2<i&&e<n[t+2])return t+1}else if(t-1>=0&&e>=n[t-1])return t-1;let r;if(e>n[t])for(r=t;r<i-1&&!(e>=n[r]&&e<n[r+1]);++r);else for(r=t-1;r>=0&&!(e>=n[r]&&e<n[r+1]);--r);return r===i-1&&(r=i-2),r};Mn.prototype.wrapTime=function(e){y.typeOf.number("time",e);const t=this.times,n=t[t.length-1],i=t[0],r=n-i;let s;return e<i&&(s=Math.floor((i-e)/r)+1,e+=s*r),e>n&&(s=Math.floor((e-n)/r)+1,e-=s*r),e};Mn.prototype.clampTime=function(e){y.typeOf.number("time",e);const t=this.times;return R.clamp(e,t[0],t[t.length-1])};function Dl(e){e=T(e,T.EMPTY_OBJECT);const t=e.points,n=e.times;if(!l(t)||!l(n))throw new A("points and times are required.");if(t.length<2)throw new A("points.length must be greater than or equal to 2.");if(n.length!==t.length)throw new A("times.length must be equal to points.length.");this._times=n,this._points=t,this._pointType=Mn.getPointType(t[0]),this._lastTimeIndex=0}Object.defineProperties(Dl.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}}});Dl.prototype.findTimeInterval=Mn.prototype.findTimeInterval;Dl.prototype.wrapTime=Mn.prototype.wrapTime;Dl.prototype.clampTime=Mn.prototype.clampTime;Dl.prototype.evaluate=function(e,t){const n=this.points,i=this.times,r=this._lastTimeIndex=this.findTimeInterval(e,this._lastTimeIndex),s=(e-i[r])/(i[r+1]-i[r]);return this._pointType===Number?(1-s)*n[r]+s*n[r+1]:(l(t)||(t=new m),m.lerp(n[r],n[r+1],s,t))};const YC={};YC.solve=function(e,t,n,i){if(!l(e)||!(e instanceof Array))throw new A("The array lower is required.");if(!l(t)||!(t instanceof Array))throw new A("The array diagonal is required.");if(!l(n)||!(n instanceof Array))throw new A("The array upper is required.");if(!l(i)||!(i instanceof Array))throw new A("The array right is required.");if(t.length!==i.length)throw new A("diagonal and right must have the same lengths.");if(e.length!==n.length)throw new A("lower and upper must have the same lengths.");if(e.length!==t.length-1)throw new A("lower and upper must be one less than the length of diagonal.");const r=new Array(n.length),s=new Array(i.length),o=new Array(i.length);let a;for(a=0;a<s.length;a++)s[a]=new m,o[a]=new m;r[0]=n[0]/t[0],s[0]=m.multiplyByScalar(i[0],1/t[0],s[0]);let c;for(a=1;a<r.length;++a)c=1/(t[a]-r[a-1]*e[a-1]),r[a]=n[a]*c,s[a]=m.subtract(i[a],m.multiplyByScalar(s[a-1],e[a-1],s[a]),s[a]),s[a]=m.multiplyByScalar(s[a],c,s[a]);for(c=1/(t[a]-r[a-1]*e[a-1]),s[a]=m.subtract(i[a],m.multiplyByScalar(s[a-1],e[a-1],s[a]),s[a]),s[a]=m.multiplyByScalar(s[a],c,s[a]),o[o.length-1]=s[s.length-1],a=o.length-2;a>=0;--a)o[a]=m.subtract(s[a],m.multiplyByScalar(o[a+1],r[a],o[a]),o[a]);return o};const eL=[],tL=[],nL=[],iL=[];function M$(e,t,n){const i=eL,r=nL,s=tL,o=iL;i.length=r.length=e.length-1,s.length=o.length=e.length;let a;i[0]=s[0]=1,r[0]=0;let c=o[0];for(l(c)||(c=o[0]=new m),m.clone(t,c),a=1;a<i.length-1;++a)i[a]=r[a]=1,s[a]=4,c=o[a],l(c)||(c=o[a]=new m),m.subtract(e[a+1],e[a-1],c),m.multiplyByScalar(c,3,c);return i[a]=0,r[a]=1,s[a]=4,c=o[a],l(c)||(c=o[a]=new m),m.subtract(e[a+1],e[a-1],c),m.multiplyByScalar(c,3,c),s[a+1]=1,c=o[a+1],l(c)||(c=o[a+1]=new m),m.clone(n,c),YC.solve(i,s,r,o)}function L$(e){const t=eL,n=nL,i=tL,r=iL;t.length=n.length=e.length-1,i.length=r.length=e.length;let s;t[0]=n[0]=1,i[0]=2;let o=r[0];for(l(o)||(o=r[0]=new m),m.subtract(e[1],e[0],o),m.multiplyByScalar(o,3,o),s=1;s<t.length;++s)t[s]=n[s]=1,i[s]=4,o=r[s],l(o)||(o=r[s]=new m),m.subtract(e[s+1],e[s-1],o),m.multiplyByScalar(o,3,o);return i[s]=2,o=r[s],l(o)||(o=r[s]=new m),m.subtract(e[s],e[s-1],o),m.multiplyByScalar(o,3,o),YC.solve(t,i,n,r)}function os(e){e=T(e,T.EMPTY_OBJECT);const t=e.points,n=e.times,i=e.inTangents,r=e.outTangents;if(!l(t)||!l(n)||!l(i)||!l(r))throw new A("times, points, inTangents, and outTangents are required.");if(t.length<2)throw new A("points.length must be greater than or equal to 2.");if(n.length!==t.length)throw new A("times.length must be equal to points.length.");if(i.length!==r.length||i.length!==t.length-1)throw new A("inTangents and outTangents must have a length equal to points.length - 1.");if(this._times=n,this._points=t,this._pointType=Mn.getPointType(t[0]),this._pointType!==Mn.getPointType(i[0])||this._pointType!==Mn.getPointType(r[0]))throw new A("inTangents and outTangents must be of the same type as points.");this._inTangents=i,this._outTangents=r,this._lastTimeIndex=0}Object.defineProperties(os.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}},inTangents:{get:function(){return this._inTangents}},outTangents:{get:function(){return this._outTangents}}});os.createC1=function(e){e=T(e,T.EMPTY_OBJECT);const t=e.times,n=e.points,i=e.tangents;if(!l(n)||!l(t)||!l(i))throw new A("points, times and tangents are required.");if(n.length<2)throw new A("points.length must be greater than or equal to 2.");if(t.length!==n.length||t.length!==i.length)throw new A("times, points and tangents must have the same length.");const r=i.slice(0,i.length-1),s=i.slice(1,i.length);return new os({times:t,points:n,inTangents:s,outTangents:r})};os.createNaturalCubic=function(e){e=T(e,T.EMPTY_OBJECT);const t=e.times,n=e.points;if(!l(n)||!l(t))throw new A("points and times are required.");if(n.length<2)throw new A("points.length must be greater than or equal to 2.");if(t.length!==n.length)throw new A("times.length must be equal to points.length.");if(n.length<3)return new Dl({points:n,times:t});const i=L$(n),r=i.slice(0,i.length-1),s=i.slice(1,i.length);return new os({times:t,points:n,inTangents:s,outTangents:r})};os.createClampedCubic=function(e){e=T(e,T.EMPTY_OBJECT);const t=e.times,n=e.points,i=e.firstTangent,r=e.lastTangent;if(!l(n)||!l(t)||!l(i)||!l(r))throw new A("points, times, firstTangent and lastTangent are required.");if(n.length<2)throw new A("points.length must be greater than or equal to 2.");if(t.length!==n.length)throw new A("times.length must be equal to points.length.");const s=Mn.getPointType(n[0]);if(s!==Mn.getPointType(i)||s!==Mn.getPointType(r))throw new A("firstTangent and lastTangent must be of the same type as points.");if(n.length<3)return new Dl({points:n,times:t});const o=M$(n,i,r),a=o.slice(0,o.length-1),c=o.slice(1,o.length);return new os({times:t,points:n,inTangents:c,outTangents:a})};os.hermiteCoefficientMatrix=new P(2,-3,0,1,-2,3,0,0,1,-2,1,0,1,-1,0,0);os.prototype.findTimeInterval=Mn.prototype.findTimeInterval;const P$=new Y,Zu=new m;os.prototype.wrapTime=Mn.prototype.wrapTime;os.prototype.clampTime=Mn.prototype.clampTime;os.prototype.evaluate=function(e,t){const n=this.points,i=this.times,r=this.inTangents,s=this.outTangents;this._lastTimeIndex=this.findTimeInterval(e,this._lastTimeIndex);const o=this._lastTimeIndex,a=i[o+1]-i[o],c=(e-i[o])/a,u=P$;u.z=c,u.y=c*c,u.x=u.y*c,u.w=1;const h=P.multiplyByVector(os.hermiteCoefficientMatrix,u,u);h.z*=a,h.w*=a;const d=this._pointType;return d===Number?n[o]*h.x+n[o+1]*h.y+s[o]*h.z+r[o]*h.w:(l(t)||(t=new d),t=d.multiplyByScalar(n[o],h.x,t),d.multiplyByScalar(n[o+1],h.y,Zu),d.add(t,Zu,t),d.multiplyByScalar(s[o],h.z,Zu),d.add(t,Zu,t),d.multiplyByScalar(r[o],h.w,Zu),d.add(t,Zu,t))};function gs(e,t,n){if(!l(e))throw new A("uint8Array is required.");if(t<0)throw new A("byteOffset cannot be negative.");if(n<0)throw new A("byteLength cannot be negative.");if(t+n>e.byteLength)throw new A("sub-region exceeds array bounds.");return t=T(t,0),n=T(n,e.byteLength-t),e=e.subarray(t,t+n),gs.decode(e)}gs.decodeWithTextDecoder=function(e){return new TextDecoder("utf-8").decode(e)};gs.decodeWithFromCharCode=function(e){let t="";const n=N$(e),i=n.length;for(let r=0;r<i;++r){let s=n[r];s<=65535?t+=String.fromCharCode(s):(s-=65536,t+=String.fromCharCode((s>>10)+55296,(s&1023)+56320))}return t};function ud(e,t,n){return t<=e&&e<=n}function N$(e){let t=0,n=0,i=0,r=128,s=191;const o=[],a=e.length;for(let c=0;c<a;++c){const u=e[c];if(i===0){if(ud(u,0,127)){o.push(u);continue}if(ud(u,194,223)){i=1,t=u&31;continue}if(ud(u,224,239)){u===224&&(r=160),u===237&&(s=159),i=2,t=u&15;continue}if(ud(u,240,244)){u===240&&(r=144),u===244&&(s=143),i=3,t=u&7;continue}throw new te("String decoding failed.")}if(!ud(u,r,s)){t=i=n=0,r=128,s=191,--c;continue}r=128,s=191,t=t<<6|u&63,++n,n===i&&(o.push(t),t=i=n=0)}return o}typeof TextDecoder<"u"?gs.decode=gs.decodeWithTextDecoder:gs.decode=gs.decodeWithFromCharCode;function Cs(e,t,n){return JSON.parse(gs(e,t,n))}let T0;const rL="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIxY2UxZDdkOS02YTJkLTQ2Y2EtYmMxNS03ZDI2NWQ1NzUzMjAiLCJpZCI6MjU5LCJpYXQiOjE3MjI1Mjg0MTl9.IMe1VGs-5blTCJJA1y76M8WNixMgms2C87kIkXQVcww",ah={};ah.defaultAccessToken=rL;ah.defaultServer=new se({url:"https://api.cesium.com/"});ah.getDefaultTokenCredit=function(e){if(e===rL){if(!l(T0)){const t=`<b>             This application is using Cesium's default ion access token. Please assign <i>Cesium.Ion.defaultAccessToken</i>             with an access token from your ion account before making any Cesium API calls.             You can sign up for a free ion account at <a href="https://cesium.com">https://cesium.com</a>.</b>`;T0=new zt(t,!0)}return T0}};function qi(e,t){y.defined("endpoint",e),y.defined("endpointResource",t);let n;const i=e.externalType,r=l(i);if(!r)n={url:e.url,retryAttempts:1,retryCallback:F$};else if(i==="3DTILES"||i==="STK_TERRAIN_SERVER")n={url:e.options.url};else throw new te("Ion.createResource does not support external imagery assets; use IonImageryProvider instead.");se.call(this,n),this._ionEndpoint=e,this._ionEndpointDomain=r?void 0:new Do(e.url).authority(),this._ionEndpointResource=t,this._ionRoot=void 0,this._pendingPromise=void 0,this._credits=void 0,this._isExternal=r}l(Object.create)&&(qi.prototype=Object.create(se.prototype),qi.prototype.constructor=qi);qi.fromAssetId=function(e,t){const n=qi._createEndpointResource(e,t);return n.fetchJson().then(function(i){return new qi(i,n)})};Object.defineProperties(qi.prototype,{credits:{get:function(){return l(this._ionRoot)?this._ionRoot.credits:l(this._credits)?this._credits:(this._credits=qi.getCreditsFromEndpoint(this._ionEndpoint,this._ionEndpointResource),this._credits)}}});qi.getCreditsFromEndpoint=function(e,t){const n=e.attributions.map(zt.getIonCredit),i=ah.getDefaultTokenCredit(t.queryParameters.access_token);return l(i)&&n.push(zt.clone(i)),n};qi.prototype.clone=function(e){const t=T(this._ionRoot,this);return l(e)||(e=new qi(t._ionEndpoint,t._ionEndpointResource)),e=se.prototype.clone.call(this,e),e._ionRoot=t,e._isExternal=this._isExternal,e};qi.prototype.fetchImage=function(e){if(!this._isExternal){const t=e;e={preferBlob:!0},l(t)&&(e.flipY=t.flipY,e.preferImageBitmap=t.preferImageBitmap)}return se.prototype.fetchImage.call(this,e)};qi.prototype._makeRequest=function(e){return this._isExternal||new Do(this.url).authority()!==this._ionEndpointDomain?se.prototype._makeRequest.call(this,e):(l(e.headers)||(e.headers={}),e.headers.Authorization=`Bearer ${this._ionEndpoint.accessToken}`,e.headers["X-Cesium-Client"]="CesiumJS",typeof CESIUM_VERSION<"u"&&(e.headers["X-Cesium-Client-Version"]=CESIUM_VERSION),se.prototype._makeRequest.call(this,e))};qi._createEndpointResource=function(e,t){y.defined("assetId",e),t=T(t,T.EMPTY_OBJECT);let n=T(t.server,ah.defaultServer);const i=T(t.accessToken,ah.defaultAccessToken);n=se.createIfNeeded(n);const r={url:`v1/assets/${e}/endpoint`};return l(i)&&(r.queryParameters={access_token:i}),n.getDerivedResource(r)};function F$(e,t){const n=T(e._ionRoot,e),i=n._ionEndpointResource,r=typeof Image<"u";return!l(t)||t.statusCode!==401&&!(r&&t.target instanceof Image)?Promise.resolve(!1):(l(n._pendingPromise)||(n._pendingPromise=i.fetchJson().then(function(s){return n._ionEndpoint=s,s}).finally(function(s){return n._pendingPromise=void 0,s})),n._pendingPromise.then(function(s){return e._ionEndpoint=s,!0}))}function Oo(e){if(e=T(e,T.EMPTY_OBJECT),!l(e.geometry))throw new A("options.geometry is required.");this.geometry=e.geometry,this.modelMatrix=P.clone(T(e.modelMatrix,P.IDENTITY)),this.id=e.id,this.pickPrimitive=e.pickPrimitive,this.attributes=T(e.attributes,{}),this.westHemisphereGeometry=void 0,this.eastHemisphereGeometry=void 0}const nI=new m,iI=new m,rI=new m;function B$(e,t,n,i,r){y.defined("point",e),y.defined("p0",t),y.defined("p1",n),y.defined("p2",i),l(r)||(r=new m);let s,o,a,c,u,h,d,p;if(l(t.z)){if(m.equalsEpsilon(e,t,R.EPSILON14))return m.clone(m.UNIT_X,r);if(m.equalsEpsilon(e,n,R.EPSILON14))return m.clone(m.UNIT_Y,r);if(m.equalsEpsilon(e,i,R.EPSILON14))return m.clone(m.UNIT_Z,r);s=m.subtract(n,t,nI),o=m.subtract(i,t,iI),a=m.subtract(e,t,rI),c=m.dot(s,s),u=m.dot(s,o),h=m.dot(s,a),d=m.dot(o,o),p=m.dot(o,a)}else{if(k.equalsEpsilon(e,t,R.EPSILON14))return m.clone(m.UNIT_X,r);if(k.equalsEpsilon(e,n,R.EPSILON14))return m.clone(m.UNIT_Y,r);if(k.equalsEpsilon(e,i,R.EPSILON14))return m.clone(m.UNIT_Z,r);s=k.subtract(n,t,nI),o=k.subtract(i,t,iI),a=k.subtract(e,t,rI),c=k.dot(s,s),u=k.dot(s,o),h=k.dot(s,a),d=k.dot(o,o),p=k.dot(o,a)}r.y=d*h-u*p,r.z=c*p-u*h;const g=c*d-u*u;if(g!==0)return r.y/=g,r.z/=g,r.x=1-r.y-r.z,r}function Tn(){this.high=m.clone(m.ZERO),this.low=m.clone(m.ZERO)}Tn.encode=function(e,t){y.typeOf.number("value",e),l(t)||(t={high:0,low:0});let n;return e>=0?(n=Math.floor(e/65536)*65536,t.high=n,t.low=e-n):(n=Math.floor(-e/65536)*65536,t.high=-n,t.low=e+n),t};const Na={high:0,low:0};Tn.fromCartesian=function(e,t){y.typeOf.object("cartesian",e),l(t)||(t=new Tn);const n=t.high,i=t.low;return Tn.encode(e.x,Na),n.x=Na.high,i.x=Na.low,Tn.encode(e.y,Na),n.y=Na.high,i.y=Na.low,Tn.encode(e.z,Na),n.z=Na.high,i.z=Na.low,t};const x0=new Tn;Tn.writeElements=function(e,t,n){y.defined("cartesianArray",t),y.typeOf.number("index",n),y.typeOf.number.greaterThanOrEquals("index",n,0),Tn.fromCartesian(e,x0);const i=x0.high,r=x0.low;t[n]=i.x,t[n+1]=i.y,t[n+2]=i.z,t[n+3]=r.x,t[n+4]=r.y,t[n+5]=r.z};const KC={};KC.calculateACMR=function(e){e=T(e,T.EMPTY_OBJECT);const t=e.indices;let n=e.maximumIndex;const i=T(e.cacheSize,24);if(!l(t))throw new A("indices is required.");const r=t.length;if(r<3||r%3!==0)throw new A("indices length must be a multiple of three.");if(n<=0)throw new A("maximumIndex must be greater than zero.");if(i<3)throw new A("cacheSize must be greater than two.");if(!l(n)){n=0;let a=0,c=t[a];for(;a<r;)c>n&&(n=c),++a,c=t[a]}const s=[];for(let a=0;a<n+1;a++)s[a]=0;let o=i+1;for(let a=0;a<r;++a)o-s[t[a]]>i&&(s[t[a]]=o,++o);return(o-i+1)/(r/3)};KC.tipsify=function(e){e=T(e,T.EMPTY_OBJECT);const t=e.indices,n=e.maximumIndex,i=T(e.cacheSize,24);let r;function s(U,V,f,I){for(;V.length>=1;){const F=V[V.length-1];if(V.splice(V.length-1,1),U[F].numLiveTriangles>0)return F}for(;r<I;){if(U[r].numLiveTriangles>0)return++r,r-1;++r}return-1}function o(U,V,f,I,F,G,W){let X=-1,Z,$=-1,ne=0;for(;ne<f.length;){const le=f[ne];I[le].numLiveTriangles&&(Z=0,F-I[le].timeStamp+2*I[le].numLiveTriangles<=V&&(Z=F-I[le].timeStamp),(Z>$||$===-1)&&($=Z,X=le)),++ne}return X===-1?s(I,G,U,W):X}if(!l(t))throw new A("indices is required.");const a=t.length;if(a<3||a%3!==0)throw new A("indices length must be a multiple of three.");if(n<=0)throw new A("maximumIndex must be greater than zero.");if(i<3)throw new A("cacheSize must be greater than two.");let c=0,u=0,h=t[u];const d=a;if(l(n))c=n+1;else{for(;u<d;)h>c&&(c=h),++u,h=t[u];if(c===-1)return 0;++c}const p=[];let g;for(g=0;g<c;g++)p[g]={numLiveTriangles:0,timeStamp:0,vertexTriangles:[]};u=0;let _=0;for(;u<d;)p[t[u]].vertexTriangles.push(_),++p[t[u]].numLiveTriangles,p[t[u+1]].vertexTriangles.push(_),++p[t[u+1]].numLiveTriangles,p[t[u+2]].vertexTriangles.push(_),++p[t[u+2]].numLiveTriangles,++_,u+=3;let b=0,x=i+1;r=1;let E=[];const C=[];let w,S,v=0;const D=[],L=a/3,O=[];for(g=0;g<L;g++)O[g]=!1;let N,B;for(;b!==-1;){E=[],S=p[b],B=S.vertexTriangles.length;for(let U=0;U<B;++U)if(_=S.vertexTriangles[U],!O[_]){O[_]=!0,u=_+_+_;for(let V=0;V<3;++V)N=t[u],E.push(N),C.push(N),D[v]=N,++v,w=p[N],--w.numLiveTriangles,x-w.timeStamp>i&&(w.timeStamp=x,++x),++u}b=o(t,i,E,p,x,C,c)}return D};const $t={};function G_(e,t,n,i,r){e[t++]=n,e[t++]=i,e[t++]=i,e[t++]=r,e[t++]=r,e[t]=n}function z$(e){const t=e.length,n=t/3*6,i=Ge.createTypedArray(t,n);let r=0;for(let s=0;s<t;s+=3,r+=6)G_(i,r,e[s],e[s+1],e[s+2]);return i}function U$(e){const t=e.length;if(t>=3){const n=(t-2)*6,i=Ge.createTypedArray(t,n);G_(i,0,e[0],e[1],e[2]);let r=6;for(let s=3;s<t;++s,r+=6)G_(i,r,e[s-1],e[s],e[s-2]);return i}return new Uint16Array}function k$(e){if(e.length>0){const t=e.length-1,n=(t-1)*6,i=Ge.createTypedArray(t,n),r=e[0];let s=0;for(let o=1;o<t;++o,s+=6)G_(i,s,r,e[o],e[o+1]);return i}return new Uint16Array}$t.toWireframe=function(e){if(!l(e))throw new A("geometry is required.");const t=e.indices;if(l(t)){switch(e.primitiveType){case Fe.TRIANGLES:e.indices=z$(t);break;case Fe.TRIANGLE_STRIP:e.indices=U$(t);break;case Fe.TRIANGLE_FAN:e.indices=k$(t);break;default:throw new A("geometry.primitiveType must be TRIANGLES, TRIANGLE_STRIP, or TRIANGLE_FAN.")}e.primitiveType=Fe.LINES}return e};$t.createLineSegmentsForVectors=function(e,t,n){if(t=T(t,"normal"),!l(e))throw new A("geometry is required.");if(!l(e.attributes.position))throw new A("geometry.attributes.position is required.");if(!l(e.attributes[t]))throw new A(`geometry.attributes must have an attribute with the same name as the attributeName parameter, ${t}.`);n=T(n,1e4);const i=e.attributes.position.values,r=e.attributes[t].values,s=i.length,o=new Float64Array(2*s);let a=0;for(let h=0;h<s;h+=3)o[a++]=i[h],o[a++]=i[h+1],o[a++]=i[h+2],o[a++]=i[h]+r[h]*n,o[a++]=i[h+1]+r[h+1]*n,o[a++]=i[h+2]+r[h+2]*n;let c;const u=e.boundingSphere;return l(u)&&(c=new ee(u.center,u.radius+n)),new Ht({attributes:{position:new Lt({componentDatatype:q.DOUBLE,componentsPerAttribute:3,values:o})},primitiveType:Fe.LINES,boundingSphere:c})};$t.createAttributeLocations=function(e){if(!l(e))throw new A("geometry is required.");const t=["position","positionHigh","positionLow","position3DHigh","position3DLow","position2DHigh","position2DLow","pickColor","normal","st","tangent","bitangent","extrudeDirection","compressedAttributes"],n=e.attributes,i={};let r=0,s;const o=t.length;for(s=0;s<o;++s){const a=t[s];l(n[a])&&(i[a]=r++)}for(const a in n)n.hasOwnProperty(a)&&!l(i[a])&&(i[a]=r++);return i};$t.reorderForPreVertexCache=function(e){if(!l(e))throw new A("geometry is required.");const t=Ht.computeNumberOfVertices(e),n=e.indices;if(l(n)){const i=new Int32Array(t);for(let p=0;p<t;p++)i[p]=-1;const r=n,s=r.length,o=Ge.createTypedArray(t,s);let a=0,c=0,u=0,h;for(;a<s;)h=i[r[a]],h!==-1?o[c]=h:(h=r[a],i[h]=u,o[c]=u,++u),++a,++c;e.indices=o;const d=e.attributes;for(const p in d)if(d.hasOwnProperty(p)&&l(d[p])&&l(d[p].values)){const g=d[p],_=g.values;let b=0;const x=g.componentsPerAttribute,E=q.createTypedArray(g.componentDatatype,u*x);for(;b<t;){const C=i[b];if(C!==-1)for(let w=0;w<x;w++)E[x*C+w]=_[x*b+w];++b}g.values=E}}return e};$t.reorderForPostVertexCache=function(e,t){if(!l(e))throw new A("geometry is required.");const n=e.indices;if(e.primitiveType===Fe.TRIANGLES&&l(n)){const i=n.length;let r=0;for(let s=0;s<i;s++)n[s]>r&&(r=n[s]);e.indices=KC.tipsify({indices:n,maximumIndex:r,cacheSize:t})}return e};function sI(e){const t={};for(const n in e)if(e.hasOwnProperty(n)&&l(e[n])&&l(e[n].values)){const i=e[n];t[n]=new Lt({componentDatatype:i.componentDatatype,componentsPerAttribute:i.componentsPerAttribute,normalize:i.normalize,values:[]})}return t}function j$(e,t,n){for(const i in t)if(t.hasOwnProperty(i)&&l(t[i])&&l(t[i].values)){const r=t[i];for(let s=0;s<r.componentsPerAttribute;++s)e[i].values.push(r.values[n*r.componentsPerAttribute+s])}}$t.fitToUnsignedShortIndices=function(e){if(!l(e))throw new A("geometry is required.");if(l(e.indices)&&e.primitiveType!==Fe.TRIANGLES&&e.primitiveType!==Fe.LINES&&e.primitiveType!==Fe.POINTS)throw new A("geometry.primitiveType must equal to PrimitiveType.TRIANGLES, PrimitiveType.LINES, or PrimitiveType.POINTS.");const t=[],n=Ht.computeNumberOfVertices(e);if(l(e.indices)&&n>=R.SIXTY_FOUR_KILOBYTES){let i=[],r=[],s=0,o=sI(e.attributes);const a=e.indices,c=a.length;let u;e.primitiveType===Fe.TRIANGLES?u=3:e.primitiveType===Fe.LINES?u=2:e.primitiveType===Fe.POINTS&&(u=1);for(let h=0;h<c;h+=u){for(let d=0;d<u;++d){const p=a[h+d];let g=i[p];l(g)||(g=s++,i[p]=g,j$(o,e.attributes,p)),r.push(g)}s+u>=R.SIXTY_FOUR_KILOBYTES&&(t.push(new Ht({attributes:o,indices:r,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV})),i=[],r=[],s=0,o=sI(e.attributes))}r.length!==0&&t.push(new Ht({attributes:o,indices:r,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV}))}else t.push(e);return t};const oI=new m,V$=new oe;$t.projectTo2D=function(e,t,n,i,r){if(!l(e))throw new A("geometry is required.");if(!l(t))throw new A("attributeName is required.");if(!l(n))throw new A("attributeName3D is required.");if(!l(i))throw new A("attributeName2D is required.");if(!l(e.attributes[t]))throw new A(`geometry must have attribute matching the attributeName argument: ${t}.`);if(e.attributes[t].componentDatatype!==q.DOUBLE)throw new A("The attribute componentDatatype must be ComponentDatatype.DOUBLE.");const s=e.attributes[t];r=l(r)?r:new ur;const o=r.ellipsoid,a=s.values,c=new Float64Array(a.length);let u=0;for(let h=0;h<a.length;h+=3){const d=m.fromArray(a,h,oI),p=o.cartesianToCartographic(d,V$);if(!l(p))throw new A(`Could not project point (${d.x}, ${d.y}, ${d.z}) to 2D.`);const g=r.project(p,oI);c[u++]=g.x,c[u++]=g.y,c[u++]=g.z}return e.attributes[n]=s,e.attributes[i]=new Lt({componentDatatype:q.DOUBLE,componentsPerAttribute:3,values:c}),delete e.attributes[t],e};const E0={high:0,low:0};$t.encodeAttribute=function(e,t,n,i){if(!l(e))throw new A("geometry is required.");if(!l(t))throw new A("attributeName is required.");if(!l(n))throw new A("attributeHighName is required.");if(!l(i))throw new A("attributeLowName is required.");if(!l(e.attributes[t]))throw new A(`geometry must have attribute matching the attributeName argument: ${t}.`);if(e.attributes[t].componentDatatype!==q.DOUBLE)throw new A("The attribute componentDatatype must be ComponentDatatype.DOUBLE.");const r=e.attributes[t],s=r.values,o=s.length,a=new Float32Array(o),c=new Float32Array(o);for(let h=0;h<o;++h)Tn.encode(s[h],E0),a[h]=E0.high,c[h]=E0.low;const u=r.componentsPerAttribute;return e.attributes[n]=new Lt({componentDatatype:q.FLOAT,componentsPerAttribute:u,values:a}),e.attributes[i]=new Lt({componentDatatype:q.FLOAT,componentsPerAttribute:u,values:c}),delete e.attributes[t],e};let Eo=new m;function C0(e,t){if(l(t)){const n=t.values,i=n.length;for(let r=0;r<i;r+=3)m.unpack(n,r,Eo),P.multiplyByPoint(e,Eo,Eo),m.pack(Eo,n,r)}}function w0(e,t){if(l(t)){const n=t.values,i=n.length;for(let r=0;r<i;r+=3)m.unpack(n,r,Eo),H.multiplyByVector(e,Eo,Eo),Eo=m.normalize(Eo,Eo),m.pack(Eo,n,r)}}const Jm=new P,Qm=new H;$t.transformToWorldCoordinates=function(e){if(!l(e))throw new A("instance is required.");const t=e.modelMatrix;if(P.equals(t,P.IDENTITY))return e;const n=e.geometry.attributes;C0(t,n.position),C0(t,n.prevPosition),C0(t,n.nextPosition),(l(n.normal)||l(n.tangent)||l(n.bitangent))&&(P.inverse(t,Jm),P.transpose(Jm,Jm),P.getMatrix3(Jm,Qm),w0(Qm,n.normal),w0(Qm,n.tangent),w0(Qm,n.bitangent));const i=e.geometry.boundingSphere;return l(i)&&(e.geometry.boundingSphere=ee.transform(i,t,i)),e.modelMatrix=P.clone(P.IDENTITY),e};function G$(e,t){const n=e.length,i={},r=e[0][t].attributes;let s;for(s in r)if(r.hasOwnProperty(s)&&l(r[s])&&l(r[s].values)){const o=r[s];let a=o.values.length,c=!0;for(let u=1;u<n;++u){const h=e[u][t].attributes[s];if(!l(h)||o.componentDatatype!==h.componentDatatype||o.componentsPerAttribute!==h.componentsPerAttribute||o.normalize!==h.normalize){c=!1;break}a+=h.values.length}c&&(i[s]=new Lt({componentDatatype:o.componentDatatype,componentsPerAttribute:o.componentsPerAttribute,normalize:o.normalize,values:q.createTypedArray(o.componentDatatype,a)}))}return i}const H$=new m;function A0(e,t){const n=e.length;let i,r,s,o;const a=e[0].modelMatrix,c=l(e[0][t].indices),u=e[0][t].primitiveType;for(r=1;r<n;++r){if(!P.equals(e[r].modelMatrix,a))throw new A("All instances must have the same modelMatrix.");if(l(e[r][t].indices)!==c)throw new A("All instance geometries must have an indices or not have one.");if(e[r][t].primitiveType!==u)throw new A("All instance geometries must have the same primitiveType.")}const h=G$(e,t);let d,p,g;for(i in h)if(h.hasOwnProperty(i))for(d=h[i].values,o=0,r=0;r<n;++r)for(p=e[r][t].attributes[i].values,g=p.length,s=0;s<g;++s)d[o++]=p[s];let _;if(c){let C=0;for(r=0;r<n;++r)C+=e[r][t].indices.length;const w=Ht.computeNumberOfVertices(new Ht({attributes:h,primitiveType:Fe.POINTS})),S=Ge.createTypedArray(w,C);let v=0,D=0;for(r=0;r<n;++r){const L=e[r][t].indices,O=L.length;for(o=0;o<O;++o)S[v++]=D+L[o];D+=Ht.computeNumberOfVertices(e[r][t])}_=S}let b=new m,x=0,E;for(r=0;r<n;++r){if(E=e[r][t].boundingSphere,!l(E)){b=void 0;break}m.add(E.center,b,b)}if(l(b))for(m.divideByScalar(b,n,b),r=0;r<n;++r){E=e[r][t].boundingSphere;const C=m.magnitude(m.subtract(E.center,b,H$))+E.radius;C>x&&(x=C)}return new Ht({attributes:h,indices:_,primitiveType:u,boundingSphere:l(b)?new ee(b,x):void 0})}$t.combineInstances=function(e){if(!l(e)||e.length<1)throw new A("instances is required and must have length greater than zero.");const t=[],n=[],i=e.length;for(let s=0;s<i;++s){const o=e[s];l(o.geometry)?t.push(o):l(o.westHemisphereGeometry)&&l(o.eastHemisphereGeometry)&&n.push(o)}const r=[];return t.length>0&&r.push(A0(t,"geometry")),n.length>0&&(r.push(A0(n,"westHemisphereGeometry")),r.push(A0(n,"eastHemisphereGeometry"))),r};const Rs=new m,fd=new m,Ju=new m,Qu=new m;$t.computeNormal=function(e){if(!l(e))throw new A("geometry is required.");if(!l(e.attributes.position)||!l(e.attributes.position.values))throw new A("geometry.attributes.position.values is required.");if(!l(e.indices))throw new A("geometry.indices is required.");if(e.indices.length<2||e.indices.length%3!==0)throw new A("geometry.indices length must be greater than 0 and be a multiple of 3.");if(e.primitiveType!==Fe.TRIANGLES)throw new A("geometry.primitiveType must be PrimitiveType.TRIANGLES.");const t=e.indices,n=e.attributes,i=n.position.values,r=n.position.values.length/3,s=t.length,o=new Array(r),a=new Array(s/3),c=new Array(s);let u;for(u=0;u<r;u++)o[u]={indexOffset:0,count:0,currentCount:0};let h=0;for(u=0;u<s;u+=3){const _=t[u],b=t[u+1],x=t[u+2],E=_*3,C=b*3,w=x*3;fd.x=i[E],fd.y=i[E+1],fd.z=i[E+2],Ju.x=i[C],Ju.y=i[C+1],Ju.z=i[C+2],Qu.x=i[w],Qu.y=i[w+1],Qu.z=i[w+2],o[_].count++,o[b].count++,o[x].count++,m.subtract(Ju,fd,Ju),m.subtract(Qu,fd,Qu),a[h]=m.cross(Ju,Qu,new m),h++}let d=0;for(u=0;u<r;u++)o[u].indexOffset+=d,d+=o[u].count;h=0;let p;for(u=0;u<s;u+=3){p=o[t[u]];let _=p.indexOffset+p.currentCount;c[_]=h,p.currentCount++,p=o[t[u+1]],_=p.indexOffset+p.currentCount,c[_]=h,p.currentCount++,p=o[t[u+2]],_=p.indexOffset+p.currentCount,c[_]=h,p.currentCount++,h++}const g=new Float32Array(r*3);for(u=0;u<r;u++){const _=u*3;if(p=o[u],m.clone(m.ZERO,Rs),p.count>0){for(h=0;h<p.count;h++)m.add(Rs,a[c[p.indexOffset+h]],Rs);m.equalsEpsilon(m.ZERO,Rs,R.EPSILON10)&&m.clone(a[c[p.indexOffset]],Rs)}m.equalsEpsilon(m.ZERO,Rs,R.EPSILON10)&&(Rs.z=1),m.normalize(Rs,Rs),g[_]=Rs.x,g[_+1]=Rs.y,g[_+2]=Rs.z}return e.attributes.normal=new Lt({componentDatatype:q.FLOAT,componentsPerAttribute:3,values:g}),e};const q$=new m,aI=new m,W$=new m;$t.computeTangentAndBitangent=function(e){if(!l(e))throw new A("geometry is required.");const t=e.attributes,n=e.indices;if(!l(t.position)||!l(t.position.values))throw new A("geometry.attributes.position.values is required.");if(!l(t.normal)||!l(t.normal.values))throw new A("geometry.attributes.normal.values is required.");if(!l(t.st)||!l(t.st.values))throw new A("geometry.attributes.st.values is required.");if(!l(n))throw new A("geometry.indices is required.");if(n.length<2||n.length%3!==0)throw new A("geometry.indices length must be greater than 0 and be a multiple of 3.");if(e.primitiveType!==Fe.TRIANGLES)throw new A("geometry.primitiveType must be PrimitiveType.TRIANGLES.");const i=e.attributes.position.values,r=e.attributes.normal.values,s=e.attributes.st.values,o=e.attributes.position.values.length/3,a=n.length,c=new Array(o*3);let u;for(u=0;u<c.length;u++)c[u]=0;let h,d,p;for(u=0;u<a;u+=3){const b=n[u],x=n[u+1],E=n[u+2];h=b*3,d=x*3,p=E*3;const C=b*2,w=x*2,S=E*2,v=i[h],D=i[h+1],L=i[h+2],O=s[C],N=s[C+1],B=s[w+1]-N,U=s[S+1]-N,V=1/((s[w]-O)*U-(s[S]-O)*B),f=(U*(i[d]-v)-B*(i[p]-v))*V,I=(U*(i[d+1]-D)-B*(i[p+1]-D))*V,F=(U*(i[d+2]-L)-B*(i[p+2]-L))*V;c[h]+=f,c[h+1]+=I,c[h+2]+=F,c[d]+=f,c[d+1]+=I,c[d+2]+=F,c[p]+=f,c[p+1]+=I,c[p+2]+=F}const g=new Float32Array(o*3),_=new Float32Array(o*3);for(u=0;u<o;u++){h=u*3,d=h+1,p=h+2;const b=m.fromArray(r,h,q$),x=m.fromArray(c,h,W$),E=m.dot(b,x);m.multiplyByScalar(b,E,aI),m.normalize(m.subtract(x,aI,x),x),g[h]=x.x,g[d]=x.y,g[p]=x.z,m.normalize(m.cross(b,x,x),x),_[h]=x.x,_[d]=x.y,_[p]=x.z}return e.attributes.tangent=new Lt({componentDatatype:q.FLOAT,componentsPerAttribute:3,values:g}),e.attributes.bitangent=new Lt({componentDatatype:q.FLOAT,componentsPerAttribute:3,values:_}),e};const hd=new k,mo=new m,cI=new m,lI=new m;let eg=new k;$t.compressVertices=function(e){if(!l(e))throw new A("geometry is required.");const t=e.attributes.extrudeDirection;let n,i;if(l(t)){const D=t.values;i=D.length/3;const L=new Float32Array(i*2);let O=0;for(n=0;n<i;++n){if(m.fromArray(D,n*3,mo),m.equals(mo,m.ZERO)){O+=2;continue}eg=nt.octEncodeInRange(mo,65535,eg),L[O++]=eg.x,L[O++]=eg.y}return e.attributes.compressedAttributes=new Lt({componentDatatype:q.FLOAT,componentsPerAttribute:2,values:L}),delete e.attributes.extrudeDirection,e}const r=e.attributes.normal,s=e.attributes.st,o=l(r),a=l(s);if(!o&&!a)return e;const c=e.attributes.tangent,u=e.attributes.bitangent,h=l(c),d=l(u);let p,g,_,b;o&&(p=r.values),a&&(g=s.values),h&&(_=c.values),d&&(b=u.values),i=(o?p.length:g.length)/(o?3:2);let C=i,w=a&&o?2:1;w+=h||d?1:0,C*=w;const S=new Float32Array(C);let v=0;for(n=0;n<i;++n){a&&(k.fromArray(g,n*2,hd),S[v++]=nt.compressTextureCoordinates(hd));const D=n*3;o&&l(_)&&l(b)?(m.fromArray(p,D,mo),m.fromArray(_,D,cI),m.fromArray(b,D,lI),nt.octPack(mo,cI,lI,hd),S[v++]=hd.x,S[v++]=hd.y):(o&&(m.fromArray(p,D,mo),S[v++]=nt.octEncodeFloat(mo)),h&&(m.fromArray(_,D,mo),S[v++]=nt.octEncodeFloat(mo)),d&&(m.fromArray(b,D,mo),S[v++]=nt.octEncodeFloat(mo)))}return e.attributes.compressedAttributes=new Lt({componentDatatype:q.FLOAT,componentsPerAttribute:w,values:S}),o&&delete e.attributes.normal,a&&delete e.attributes.st,d&&delete e.attributes.bitangent,h&&delete e.attributes.tangent,e};function $$(e){if(l(e.indices))return e;const t=Ht.computeNumberOfVertices(e);if(t<3)throw new A("The number of vertices must be at least three.");if(t%3!==0)throw new A("The number of vertices must be a multiple of three.");const n=Ge.createTypedArray(t,t);for(let i=0;i<t;++i)n[i]=i;return e.indices=n,e}function X$(e){const t=Ht.computeNumberOfVertices(e);if(t<3)throw new A("The number of vertices must be at least three.");const n=Ge.createTypedArray(t,(t-2)*3);n[0]=1,n[1]=0,n[2]=2;let i=3;for(let r=3;r<t;++r)n[i++]=r-1,n[i++]=0,n[i++]=r;return e.indices=n,e.primitiveType=Fe.TRIANGLES,e}function Y$(e){const t=Ht.computeNumberOfVertices(e);if(t<3)throw new A("The number of vertices must be at least 3.");const n=Ge.createTypedArray(t,(t-2)*3);n[0]=0,n[1]=1,n[2]=2,t>3&&(n[3]=0,n[4]=2,n[5]=3);let i=6;for(let r=3;r<t-1;r+=2)n[i++]=r,n[i++]=r-1,n[i++]=r+1,r+2<t&&(n[i++]=r,n[i++]=r+1,n[i++]=r+2);return e.indices=n,e.primitiveType=Fe.TRIANGLES,e}function K$(e){if(l(e.indices))return e;const t=Ht.computeNumberOfVertices(e);if(t<2)throw new A("The number of vertices must be at least two.");if(t%2!==0)throw new A("The number of vertices must be a multiple of 2.");const n=Ge.createTypedArray(t,t);for(let i=0;i<t;++i)n[i]=i;return e.indices=n,e}function Z$(e){const t=Ht.computeNumberOfVertices(e);if(t<2)throw new A("The number of vertices must be at least two.");const n=Ge.createTypedArray(t,(t-1)*2);n[0]=0,n[1]=1;let i=2;for(let r=2;r<t;++r)n[i++]=r-1,n[i++]=r;return e.indices=n,e.primitiveType=Fe.LINES,e}function J$(e){const t=Ht.computeNumberOfVertices(e);if(t<2)throw new A("The number of vertices must be at least two.");const n=Ge.createTypedArray(t,t*2);n[0]=0,n[1]=1;let i=2;for(let r=2;r<t;++r)n[i++]=r-1,n[i++]=r;return n[i++]=t-1,n[i]=0,e.indices=n,e.primitiveType=Fe.LINES,e}function Q$(e){switch(e.primitiveType){case Fe.TRIANGLE_FAN:return X$(e);case Fe.TRIANGLE_STRIP:return Y$(e);case Fe.TRIANGLES:return $$(e);case Fe.LINE_STRIP:return Z$(e);case Fe.LINE_LOOP:return J$(e);case Fe.LINES:return K$(e)}return e}function Hc(e,t){Math.abs(e.y)<R.EPSILON6&&(t?e.y=-R.EPSILON6:e.y=R.EPSILON6)}function e7(e,t,n){if(e.y!==0&&t.y!==0&&n.y!==0){Hc(e,e.y<0),Hc(t,t.y<0),Hc(n,n.y<0);return}const i=Math.abs(e.y),r=Math.abs(t.y),s=Math.abs(n.y);let o;i>r?i>s?o=R.sign(e.y):o=R.sign(n.y):r>s?o=R.sign(t.y):o=R.sign(n.y);const a=o<0;Hc(e,a),Hc(t,a),Hc(n,a)}const uI=new m;function Ds(e,t,n,i){m.add(e,m.multiplyByScalar(m.subtract(t,e,uI),e.y/(e.y-t.y),uI),n),m.clone(n,i),Hc(n,!0),Hc(i,!1)}const jl=new m,Vl=new m,Gl=new m,Hl=new m,S0={positions:new Array(7),indices:new Array(3*3)};function t7(e,t,n){if(e.x>=0||t.x>=0||n.x>=0)return;e7(e,t,n);const i=e.y<0,r=t.y<0,s=n.y<0;let o=0;o+=i?1:0,o+=r?1:0,o+=s?1:0;const a=S0.indices;o===1?(a[1]=3,a[2]=4,a[5]=6,a[7]=6,a[8]=5,i?(Ds(e,t,jl,Gl),Ds(e,n,Vl,Hl),a[0]=0,a[3]=1,a[4]=2,a[6]=1):r?(Ds(t,n,jl,Gl),Ds(t,e,Vl,Hl),a[0]=1,a[3]=2,a[4]=0,a[6]=2):s&&(Ds(n,e,jl,Gl),Ds(n,t,Vl,Hl),a[0]=2,a[3]=0,a[4]=1,a[6]=0)):o===2&&(a[2]=4,a[4]=4,a[5]=3,a[7]=5,a[8]=6,i?r?s||(Ds(n,e,jl,Gl),Ds(n,t,Vl,Hl),a[0]=0,a[1]=1,a[3]=0,a[6]=2):(Ds(t,n,jl,Gl),Ds(t,e,Vl,Hl),a[0]=2,a[1]=0,a[3]=2,a[6]=1):(Ds(e,t,jl,Gl),Ds(e,n,Vl,Hl),a[0]=1,a[1]=2,a[3]=1,a[6]=0));const c=S0.positions;return c[0]=e,c[1]=t,c[2]=n,c.length=3,(o===1||o===2)&&(c[3]=jl,c[4]=Vl,c[5]=Gl,c[6]=Hl,c.length=7),S0}function fI(e,t){const n=e.attributes;if(n.position.values.length===0)return;for(const r in n)if(n.hasOwnProperty(r)&&l(n[r])&&l(n[r].values)){const s=n[r];s.values=q.createTypedArray(s.componentDatatype,s.values)}const i=Ht.computeNumberOfVertices(e);return e.indices=Ge.createTypedArray(i,e.indices),t&&(e.boundingSphere=ee.fromVertices(n.position.values)),e}function ch(e){const t=e.attributes,n={};for(const i in t)if(t.hasOwnProperty(i)&&l(t[i])&&l(t[i].values)){const r=t[i];n[i]=new Lt({componentDatatype:r.componentDatatype,componentsPerAttribute:r.componentsPerAttribute,normalize:r.normalize,values:[]})}return new Ht({attributes:n,indices:[],primitiveType:e.primitiveType})}function ZC(e,t,n){const i=l(e.geometry.boundingSphere);t=fI(t,i),n=fI(n,i),l(n)&&!l(t)?e.geometry=n:!l(n)&&l(t)?e.geometry=t:(e.westHemisphereGeometry=t,e.eastHemisphereGeometry=n,e.geometry=void 0)}function JC(e,t){const n=new e,i=new e,r=new e;return function(s,o,a,c,u,h,d,p){const g=e.fromArray(u,s*t,n),_=e.fromArray(u,o*t,i),b=e.fromArray(u,a*t,r);e.multiplyByScalar(g,c.x,g),e.multiplyByScalar(_,c.y,_),e.multiplyByScalar(b,c.z,b);const x=e.add(g,_,g);e.add(x,b,x),p&&e.normalize(x,x),e.pack(x,h,d*t)}}const n7=JC(Y,4),Jg=JC(m,3),sL=JC(k,2),i7=function(e,t,n,i,r,s,o){const a=r[e]*i.x,c=r[t]*i.y,u=r[n]*i.z;s[o]=a+c+u>R.EPSILON6?1:0},Kd=new m,Xx=new m,Yx=new m,r7=new m;function tg(e,t,n,i,r,s,o,a,c,u,h,d,p,g,_,b){if(!l(s)&&!l(o)&&!l(a)&&!l(c)&&!l(u)&&g===0)return;const x=m.fromArray(r,e*3,Kd),E=m.fromArray(r,t*3,Xx),C=m.fromArray(r,n*3,Yx),w=B$(i,x,E,C,r7);if(l(w)){if(l(s)&&Jg(e,t,n,w,s,d.normal.values,b,!0),l(u)){const S=m.fromArray(u,e*3,Kd),v=m.fromArray(u,t*3,Xx),D=m.fromArray(u,n*3,Yx);m.multiplyByScalar(S,w.x,S),m.multiplyByScalar(v,w.y,v),m.multiplyByScalar(D,w.z,D);let L;!m.equals(S,m.ZERO)||!m.equals(v,m.ZERO)||!m.equals(D,m.ZERO)?(L=m.add(S,v,S),m.add(L,D,L),m.normalize(L,L)):(L=Kd,L.x=0,L.y=0,L.z=0),m.pack(L,d.extrudeDirection.values,b*3)}if(l(h)&&i7(e,t,n,w,h,d.applyOffset.values,b),l(o)&&Jg(e,t,n,w,o,d.tangent.values,b,!0),l(a)&&Jg(e,t,n,w,a,d.bitangent.values,b,!0),l(c)&&sL(e,t,n,w,c,d.st.values,b),g>0)for(let S=0;S<g;S++){const v=p[S];s7(e,t,n,w,b,_[v],d[v])}}}function s7(e,t,n,i,r,s,o){const a=s.componentsPerAttribute,c=s.values,u=o.values;switch(a){case 4:n7(e,t,n,i,c,u,r,!1);break;case 3:Jg(e,t,n,i,c,u,r,!1);break;case 2:sL(e,t,n,i,c,u,r,!1);break;default:u[r]=c[e]*i.x+c[t]*i.y+c[n]*i.z}}function ta(e,t,n,i,r,s){const o=e.position.values.length/3;if(r!==-1){const a=i[r],c=n[a];return c===-1?(n[a]=o,e.position.values.push(s.x,s.y,s.z),t.push(o),o):(t.push(c),c)}return e.position.values.push(s.x,s.y,s.z),t.push(o),o}const o7={position:!0,normal:!0,bitangent:!0,tangent:!0,st:!0,extrudeDirection:!0,applyOffset:!0};function hI(e){const t=e.geometry,n=t.attributes,i=n.position.values,r=l(n.normal)?n.normal.values:void 0,s=l(n.bitangent)?n.bitangent.values:void 0,o=l(n.tangent)?n.tangent.values:void 0,a=l(n.st)?n.st.values:void 0,c=l(n.extrudeDirection)?n.extrudeDirection.values:void 0,u=l(n.applyOffset)?n.applyOffset.values:void 0,h=t.indices,d=[];for(const L in n)n.hasOwnProperty(L)&&!o7[L]&&l(n[L])&&d.push(L);const p=d.length,g=ch(t),_=ch(t);let b,x,E,C,w;const S=[];S.length=i.length/3;const v=[];for(v.length=i.length/3,w=0;w<S.length;++w)S[w]=-1,v[w]=-1;const D=h.length;for(w=0;w<D;w+=3){const L=h[w],O=h[w+1],N=h[w+2];let B=m.fromArray(i,L*3),U=m.fromArray(i,O*3),V=m.fromArray(i,N*3);const f=t7(B,U,V);if(l(f)&&f.positions.length>3){const I=f.positions,F=f.indices,G=F.length;for(let W=0;W<G;++W){const X=F[W],Z=I[X];Z.y<0?(b=_.attributes,x=_.indices,E=S):(b=g.attributes,x=g.indices,E=v),C=ta(b,x,E,h,X<3?w+X:-1,Z),tg(L,O,N,Z,i,r,o,s,a,c,u,b,d,p,n,C)}}else l(f)&&(B=f.positions[0],U=f.positions[1],V=f.positions[2]),B.y<0?(b=_.attributes,x=_.indices,E=S):(b=g.attributes,x=g.indices,E=v),C=ta(b,x,E,h,w,B),tg(L,O,N,B,i,r,o,s,a,c,u,b,d,p,n,C),C=ta(b,x,E,h,w+1,U),tg(L,O,N,U,i,r,o,s,a,c,u,b,d,p,n,C),C=ta(b,x,E,h,w+2,V),tg(L,O,N,V,i,r,o,s,a,c,u,b,d,p,n,C)}ZC(e,_,g)}const oL=Ve.fromPointNormal(m.ZERO,m.UNIT_Y),a7=new m,c7=new m;function ef(e,t,n,i,r,s,o){if(!l(o))return;const a=m.fromArray(i,e*3,Kd);m.equalsEpsilon(a,n,R.EPSILON10)?s.applyOffset.values[r]=o[e]:s.applyOffset.values[r]=o[t]}function dI(e){const t=e.geometry,n=t.attributes,i=n.position.values,r=l(n.applyOffset)?n.applyOffset.values:void 0,s=t.indices,o=ch(t),a=ch(t);let c;const u=s.length,h=[];h.length=i.length/3;const d=[];for(d.length=i.length/3,c=0;c<h.length;++c)h[c]=-1,d[c]=-1;for(c=0;c<u;c+=2){const p=s[c],g=s[c+1],_=m.fromArray(i,p*3,Kd),b=m.fromArray(i,g*3,Xx);let x;Math.abs(_.y)<R.EPSILON6&&(_.y<0?_.y=-R.EPSILON6:_.y=R.EPSILON6),Math.abs(b.y)<R.EPSILON6&&(b.y<0?b.y=-R.EPSILON6:b.y=R.EPSILON6);let E=o.attributes,C=o.indices,w=d,S=a.attributes,v=a.indices,D=h;const L=Ct.lineSegmentPlane(_,b,oL,Yx);if(l(L)){const O=m.multiplyByScalar(m.UNIT_Y,5*R.EPSILON9,a7);_.y<0&&(m.negate(O,O),E=a.attributes,C=a.indices,w=h,S=o.attributes,v=o.indices,D=d);const N=m.add(L,O,c7);x=ta(E,C,w,s,c,_),ef(p,g,_,i,x,E,r),x=ta(E,C,w,s,-1,N),ef(p,g,N,i,x,E,r),m.negate(O,O),m.add(L,O,N),x=ta(S,v,D,s,-1,N),ef(p,g,N,i,x,S,r),x=ta(S,v,D,s,c+1,b),ef(p,g,b,i,x,S,r)}else{let O,N,B;_.y<0?(O=a.attributes,N=a.indices,B=h):(O=o.attributes,N=o.indices,B=d),x=ta(O,N,B,s,c,_),ef(p,g,_,i,x,O,r),x=ta(O,N,B,s,c+1,b),ef(p,g,b,i,x,O,r)}}ZC(e,a,o)}const pI=new k,l7=new k,aL=new m,cL=new m,Kx=new m,u7=new m,f7=new m,h7=new m,mI=new Y;function gI(e){const t=e.attributes,n=t.position.values,i=t.prevPosition.values,r=t.nextPosition.values,s=n.length;for(let o=0;o<s;o+=3){const a=m.unpack(n,o,aL);if(a.x>0)continue;const c=m.unpack(i,o,cL);(a.y<0&&c.y>0||a.y>0&&c.y<0)&&(o-3>0?(i[o]=n[o-3],i[o+1]=n[o-2],i[o+2]=n[o-1]):m.pack(a,i,o));const u=m.unpack(r,o,Kx);(a.y<0&&u.y>0||a.y>0&&u.y<0)&&(o+3<s?(r[o]=n[o+3],r[o+1]=n[o+4],r[o+2]=n[o+5]):m.pack(a,r,o))}}const d7=5*R.EPSILON9,ng=R.EPSILON6;function p7(e){const t=e.geometry,n=t.attributes,i=n.position.values,r=n.prevPosition.values,s=n.nextPosition.values,o=n.expandAndWidth.values,a=l(n.st)?n.st.values:void 0,c=l(n.color)?n.color.values:void 0,u=ch(t),h=ch(t);let d,p,g,_=!1;const b=i.length/3;for(d=0;d<b;d+=4){const x=d,E=d+2,C=m.fromArray(i,x*3,aL),w=m.fromArray(i,E*3,cL);if(Math.abs(C.y)<ng)for(C.y=ng*(w.y<0?-1:1),i[d*3+1]=C.y,i[(d+1)*3+1]=C.y,p=x*3;p<x*3+4*3;p+=3)r[p]=i[d*3],r[p+1]=i[d*3+1],r[p+2]=i[d*3+2];if(Math.abs(w.y)<ng)for(w.y=ng*(C.y<0?-1:1),i[(d+2)*3+1]=w.y,i[(d+3)*3+1]=w.y,p=x*3;p<x*3+4*3;p+=3)s[p]=i[(d+2)*3],s[p+1]=i[(d+2)*3+1],s[p+2]=i[(d+2)*3+2];let S=u.attributes,v=u.indices,D=h.attributes,L=h.indices;const O=Ct.lineSegmentPlane(C,w,oL,u7);if(l(O)){_=!0;const N=m.multiplyByScalar(m.UNIT_Y,d7,f7);C.y<0&&(m.negate(N,N),S=h.attributes,v=h.indices,D=u.attributes,L=u.indices);const B=m.add(O,N,h7);S.position.values.push(C.x,C.y,C.z,C.x,C.y,C.z),S.position.values.push(B.x,B.y,B.z),S.position.values.push(B.x,B.y,B.z),S.prevPosition.values.push(r[x*3],r[x*3+1],r[x*3+2]),S.prevPosition.values.push(r[x*3+3],r[x*3+4],r[x*3+5]),S.prevPosition.values.push(C.x,C.y,C.z,C.x,C.y,C.z),S.nextPosition.values.push(B.x,B.y,B.z),S.nextPosition.values.push(B.x,B.y,B.z),S.nextPosition.values.push(B.x,B.y,B.z),S.nextPosition.values.push(B.x,B.y,B.z),m.negate(N,N),m.add(O,N,B),D.position.values.push(B.x,B.y,B.z),D.position.values.push(B.x,B.y,B.z),D.position.values.push(w.x,w.y,w.z,w.x,w.y,w.z),D.prevPosition.values.push(B.x,B.y,B.z),D.prevPosition.values.push(B.x,B.y,B.z),D.prevPosition.values.push(B.x,B.y,B.z),D.prevPosition.values.push(B.x,B.y,B.z),D.nextPosition.values.push(w.x,w.y,w.z,w.x,w.y,w.z),D.nextPosition.values.push(s[E*3],s[E*3+1],s[E*3+2]),D.nextPosition.values.push(s[E*3+3],s[E*3+4],s[E*3+5]);const U=k.fromArray(o,x*2,pI),V=Math.abs(U.y);S.expandAndWidth.values.push(-1,V,1,V),S.expandAndWidth.values.push(-1,-V,1,-V),D.expandAndWidth.values.push(-1,V,1,V),D.expandAndWidth.values.push(-1,-V,1,-V);let f=m.magnitudeSquared(m.subtract(O,C,Kx));if(f/=m.magnitudeSquared(m.subtract(w,C,Kx)),l(c)){const I=Y.fromArray(c,x*4,mI),F=Y.fromArray(c,E*4,mI),G=R.lerp(I.x,F.x,f),W=R.lerp(I.y,F.y,f),X=R.lerp(I.z,F.z,f),Z=R.lerp(I.w,F.w,f);for(p=x*4;p<x*4+2*4;++p)S.color.values.push(c[p]);for(S.color.values.push(G,W,X,Z),S.color.values.push(G,W,X,Z),D.color.values.push(G,W,X,Z),D.color.values.push(G,W,X,Z),p=E*4;p<E*4+2*4;++p)D.color.values.push(c[p])}if(l(a)){const I=k.fromArray(a,x*2,pI),F=k.fromArray(a,(d+3)*2,l7),G=R.lerp(I.x,F.x,f);for(p=x*2;p<x*2+2*2;++p)S.st.values.push(a[p]);for(S.st.values.push(G,I.y),S.st.values.push(G,F.y),D.st.values.push(G,I.y),D.st.values.push(G,F.y),p=E*2;p<E*2+2*2;++p)D.st.values.push(a[p])}g=S.position.values.length/3-4,v.push(g,g+2,g+1),v.push(g+1,g+2,g+3),g=D.position.values.length/3-4,L.push(g,g+2,g+1),L.push(g+1,g+2,g+3)}else{let N,B;for(C.y<0?(N=h.attributes,B=h.indices):(N=u.attributes,B=u.indices),N.position.values.push(C.x,C.y,C.z),N.position.values.push(C.x,C.y,C.z),N.position.values.push(w.x,w.y,w.z),N.position.values.push(w.x,w.y,w.z),p=d*3;p<d*3+4*3;++p)N.prevPosition.values.push(r[p]),N.nextPosition.values.push(s[p]);for(p=d*2;p<d*2+4*2;++p)N.expandAndWidth.values.push(o[p]),l(a)&&N.st.values.push(a[p]);if(l(c))for(p=d*4;p<d*4+4*4;++p)N.color.values.push(c[p]);g=N.position.values.length/3-4,B.push(g,g+2,g+1),B.push(g+1,g+2,g+3)}}_&&(gI(h),gI(u)),ZC(e,h,u)}$t.splitLongitude=function(e){if(!l(e))throw new A("instance is required.");const t=e.geometry,n=t.boundingSphere;if(l(n)&&(n.center.x-n.radius>0||ee.intersectPlane(n,Ve.ORIGIN_ZX_PLANE)!==ut.INTERSECTING))return e;if(t.geometryType!==Nd.NONE)switch(t.geometryType){case Nd.POLYLINES:p7(e);break;case Nd.TRIANGLES:hI(e);break;case Nd.LINES:dI(e);break}else Q$(t),t.primitiveType===Fe.TRIANGLES?hI(e):t.primitiveType===Fe.LINES&&dI(e);return e};function v0(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n*6<1?e+(t-e)*6*n:n*2<1?t:n*3<2?e+(t-e)*(2/3-n)*6:e}function M(e,t,n,i){this.red=T(e,1),this.green=T(t,1),this.blue=T(n,1),this.alpha=T(i,1)}M.fromCartesian4=function(e,t){return y.typeOf.object("cartesian",e),l(t)?(t.red=e.x,t.green=e.y,t.blue=e.z,t.alpha=e.w,t):new M(e.x,e.y,e.z,e.w)};M.fromBytes=function(e,t,n,i,r){return e=M.byteToFloat(T(e,255)),t=M.byteToFloat(T(t,255)),n=M.byteToFloat(T(n,255)),i=M.byteToFloat(T(i,255)),l(r)?(r.red=e,r.green=t,r.blue=n,r.alpha=i,r):new M(e,t,n,i)};M.fromAlpha=function(e,t,n){return y.typeOf.object("color",e),y.typeOf.number("alpha",t),l(n)?(n.red=e.red,n.green=e.green,n.blue=e.blue,n.alpha=t,n):new M(e.red,e.green,e.blue,t)};let I0,QC,Wa;It.supportsTypedArrays()&&(I0=new ArrayBuffer(4),QC=new Uint32Array(I0),Wa=new Uint8Array(I0));M.fromRgba=function(e,t){return QC[0]=e,M.fromBytes(Wa[0],Wa[1],Wa[2],Wa[3],t)};M.fromHsl=function(e,t,n,i,r){e=T(e,0)%1,t=T(t,0),n=T(n,0),i=T(i,1);let s=n,o=n,a=n;if(t!==0){let c;n<.5?c=n*(1+t):c=n+t-n*t;const u=2*n-c;s=v0(u,c,e+1/3),o=v0(u,c,e),a=v0(u,c,e-1/3)}return l(r)?(r.red=s,r.green=o,r.blue=a,r.alpha=i,r):new M(s,o,a,i)};M.fromRandom=function(e,t){e=T(e,T.EMPTY_OBJECT);let n=e.red;if(!l(n)){const o=T(e.minimumRed,0),a=T(e.maximumRed,1);y.typeOf.number.lessThanOrEquals("minimumRed",o,a),n=o+R.nextRandomNumber()*(a-o)}let i=e.green;if(!l(i)){const o=T(e.minimumGreen,0),a=T(e.maximumGreen,1);y.typeOf.number.lessThanOrEquals("minimumGreen",o,a),i=o+R.nextRandomNumber()*(a-o)}let r=e.blue;if(!l(r)){const o=T(e.minimumBlue,0),a=T(e.maximumBlue,1);y.typeOf.number.lessThanOrEquals("minimumBlue",o,a),r=o+R.nextRandomNumber()*(a-o)}let s=e.alpha;if(!l(s)){const o=T(e.minimumAlpha,0),a=T(e.maximumAlpha,1);y.typeOf.number.lessThanOrEquals("minumumAlpha",o,a),s=o+R.nextRandomNumber()*(a-o)}return l(t)?(t.red=n,t.green=i,t.blue=r,t.alpha=s,t):new M(n,i,r,s)};const m7=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,g7=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,_7=/^rgba?\s*\(\s*([0-9.]+%?)\s*[,\s]+\s*([0-9.]+%?)\s*[,\s]+\s*([0-9.]+%?)(?:\s*[,\s/]+\s*([0-9.]+))?\s*\)$/i,y7=/^hsla?\s*\(\s*([0-9.]+)\s*[,\s]+\s*([0-9.]+%)\s*[,\s]+\s*([0-9.]+%)(?:\s*[,\s/]+\s*([0-9.]+))?\s*\)$/i;M.fromCssColorString=function(e,t){y.typeOf.string("color",e),l(t)||(t=new M),e=e.trim();const n=M[e.toUpperCase()];if(l(n))return M.clone(n,t),t;let i=m7.exec(e);return i!==null?(t.red=parseInt(i[1],16)/15,t.green=parseInt(i[2],16)/15,t.blue=parseInt(i[3],16)/15,t.alpha=parseInt(T(i[4],"f"),16)/15,t):(i=g7.exec(e),i!==null?(t.red=parseInt(i[1],16)/255,t.green=parseInt(i[2],16)/255,t.blue=parseInt(i[3],16)/255,t.alpha=parseInt(T(i[4],"ff"),16)/255,t):(i=_7.exec(e),i!==null?(t.red=parseFloat(i[1])/(i[1].substr(-1)==="%"?100:255),t.green=parseFloat(i[2])/(i[2].substr(-1)==="%"?100:255),t.blue=parseFloat(i[3])/(i[3].substr(-1)==="%"?100:255),t.alpha=parseFloat(T(i[4],"1.0")),t):(i=y7.exec(e),i!==null?M.fromHsl(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,parseFloat(T(i[4],"1.0")),t):(t=void 0,t))))};M.packedLength=4;M.pack=function(e,t,n){return y.typeOf.object("value",e),y.defined("array",t),n=T(n,0),t[n++]=e.red,t[n++]=e.green,t[n++]=e.blue,t[n]=e.alpha,t};M.unpack=function(e,t,n){return y.defined("array",e),t=T(t,0),l(n)||(n=new M),n.red=e[t++],n.green=e[t++],n.blue=e[t++],n.alpha=e[t],n};M.byteToFloat=function(e){return e/255};M.floatToByte=function(e){return e===1?255:e*256|0};M.clone=function(e,t){if(l(e))return l(t)?(t.red=e.red,t.green=e.green,t.blue=e.blue,t.alpha=e.alpha,t):new M(e.red,e.green,e.blue,e.alpha)};M.equals=function(e,t){return e===t||l(e)&&l(t)&&e.red===t.red&&e.green===t.green&&e.blue===t.blue&&e.alpha===t.alpha};M.equalsArray=function(e,t,n){return e.red===t[n]&&e.green===t[n+1]&&e.blue===t[n+2]&&e.alpha===t[n+3]};M.prototype.clone=function(e){return M.clone(this,e)};M.prototype.equals=function(e){return M.equals(this,e)};M.prototype.equalsEpsilon=function(e,t){return this===e||l(e)&&Math.abs(this.red-e.red)<=t&&Math.abs(this.green-e.green)<=t&&Math.abs(this.blue-e.blue)<=t&&Math.abs(this.alpha-e.alpha)<=t};M.prototype.toString=function(){return`(${this.red}, ${this.green}, ${this.blue}, ${this.alpha})`};M.prototype.toCssColorString=function(){const e=M.floatToByte(this.red),t=M.floatToByte(this.green),n=M.floatToByte(this.blue);return this.alpha===1?`rgb(${e},${t},${n})`:`rgba(${e},${t},${n},${this.alpha})`};M.prototype.toCssHexString=function(){let e=M.floatToByte(this.red).toString(16);e.length<2&&(e=`0${e}`);let t=M.floatToByte(this.green).toString(16);t.length<2&&(t=`0${t}`);let n=M.floatToByte(this.blue).toString(16);if(n.length<2&&(n=`0${n}`),this.alpha<1){let i=M.floatToByte(this.alpha).toString(16);return i.length<2&&(i=`0${i}`),`#${e}${t}${n}${i}`}return`#${e}${t}${n}`};M.prototype.toBytes=function(e){const t=M.floatToByte(this.red),n=M.floatToByte(this.green),i=M.floatToByte(this.blue),r=M.floatToByte(this.alpha);return l(e)?(e[0]=t,e[1]=n,e[2]=i,e[3]=r,e):[t,n,i,r]};M.prototype.toRgba=function(){return Wa[0]=M.floatToByte(this.red),Wa[1]=M.floatToByte(this.green),Wa[2]=M.floatToByte(this.blue),Wa[3]=M.floatToByte(this.alpha),QC[0]};M.prototype.brighten=function(e,t){return y.typeOf.number("magnitude",e),y.typeOf.number.greaterThanOrEquals("magnitude",e,0),y.typeOf.object("result",t),e=1-e,t.red=1-(1-this.red)*e,t.green=1-(1-this.green)*e,t.blue=1-(1-this.blue)*e,t.alpha=this.alpha,t};M.prototype.darken=function(e,t){return y.typeOf.number("magnitude",e),y.typeOf.number.greaterThanOrEquals("magnitude",e,0),y.typeOf.object("result",t),e=1-e,t.red=this.red*e,t.green=this.green*e,t.blue=this.blue*e,t.alpha=this.alpha,t};M.prototype.withAlpha=function(e,t){return M.fromAlpha(this,e,t)};M.add=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n.red=e.red+t.red,n.green=e.green+t.green,n.blue=e.blue+t.blue,n.alpha=e.alpha+t.alpha,n};M.subtract=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n.red=e.red-t.red,n.green=e.green-t.green,n.blue=e.blue-t.blue,n.alpha=e.alpha-t.alpha,n};M.multiply=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n.red=e.red*t.red,n.green=e.green*t.green,n.blue=e.blue*t.blue,n.alpha=e.alpha*t.alpha,n};M.divide=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n.red=e.red/t.red,n.green=e.green/t.green,n.blue=e.blue/t.blue,n.alpha=e.alpha/t.alpha,n};M.mod=function(e,t,n){return y.typeOf.object("left",e),y.typeOf.object("right",t),y.typeOf.object("result",n),n.red=e.red%t.red,n.green=e.green%t.green,n.blue=e.blue%t.blue,n.alpha=e.alpha%t.alpha,n};M.lerp=function(e,t,n,i){return y.typeOf.object("start",e),y.typeOf.object("end",t),y.typeOf.number("t",n),y.typeOf.object("result",i),i.red=R.lerp(e.red,t.red,n),i.green=R.lerp(e.green,t.green,n),i.blue=R.lerp(e.blue,t.blue,n),i.alpha=R.lerp(e.alpha,t.alpha,n),i};M.multiplyByScalar=function(e,t,n){return y.typeOf.object("color",e),y.typeOf.number("scalar",t),y.typeOf.object("result",n),n.red=e.red*t,n.green=e.green*t,n.blue=e.blue*t,n.alpha=e.alpha*t,n};M.divideByScalar=function(e,t,n){return y.typeOf.object("color",e),y.typeOf.number("scalar",t),y.typeOf.object("result",n),n.red=e.red/t,n.green=e.green/t,n.blue=e.blue/t,n.alpha=e.alpha/t,n};M.ALICEBLUE=Object.freeze(M.fromCssColorString("#F0F8FF"));M.ANTIQUEWHITE=Object.freeze(M.fromCssColorString("#FAEBD7"));M.AQUA=Object.freeze(M.fromCssColorString("#00FFFF"));M.AQUAMARINE=Object.freeze(M.fromCssColorString("#7FFFD4"));M.AZURE=Object.freeze(M.fromCssColorString("#F0FFFF"));M.BEIGE=Object.freeze(M.fromCssColorString("#F5F5DC"));M.BISQUE=Object.freeze(M.fromCssColorString("#FFE4C4"));M.BLACK=Object.freeze(M.fromCssColorString("#000000"));M.BLANCHEDALMOND=Object.freeze(M.fromCssColorString("#FFEBCD"));M.BLUE=Object.freeze(M.fromCssColorString("#0000FF"));M.BLUEVIOLET=Object.freeze(M.fromCssColorString("#8A2BE2"));M.BROWN=Object.freeze(M.fromCssColorString("#A52A2A"));M.BURLYWOOD=Object.freeze(M.fromCssColorString("#DEB887"));M.CADETBLUE=Object.freeze(M.fromCssColorString("#5F9EA0"));M.CHARTREUSE=Object.freeze(M.fromCssColorString("#7FFF00"));M.CHOCOLATE=Object.freeze(M.fromCssColorString("#D2691E"));M.CORAL=Object.freeze(M.fromCssColorString("#FF7F50"));M.CORNFLOWERBLUE=Object.freeze(M.fromCssColorString("#6495ED"));M.CORNSILK=Object.freeze(M.fromCssColorString("#FFF8DC"));M.CRIMSON=Object.freeze(M.fromCssColorString("#DC143C"));M.CYAN=Object.freeze(M.fromCssColorString("#00FFFF"));M.DARKBLUE=Object.freeze(M.fromCssColorString("#00008B"));M.DARKCYAN=Object.freeze(M.fromCssColorString("#008B8B"));M.DARKGOLDENROD=Object.freeze(M.fromCssColorString("#B8860B"));M.DARKGRAY=Object.freeze(M.fromCssColorString("#A9A9A9"));M.DARKGREEN=Object.freeze(M.fromCssColorString("#006400"));M.DARKGREY=M.DARKGRAY;M.DARKKHAKI=Object.freeze(M.fromCssColorString("#BDB76B"));M.DARKMAGENTA=Object.freeze(M.fromCssColorString("#8B008B"));M.DARKOLIVEGREEN=Object.freeze(M.fromCssColorString("#556B2F"));M.DARKORANGE=Object.freeze(M.fromCssColorString("#FF8C00"));M.DARKORCHID=Object.freeze(M.fromCssColorString("#9932CC"));M.DARKRED=Object.freeze(M.fromCssColorString("#8B0000"));M.DARKSALMON=Object.freeze(M.fromCssColorString("#E9967A"));M.DARKSEAGREEN=Object.freeze(M.fromCssColorString("#8FBC8F"));M.DARKSLATEBLUE=Object.freeze(M.fromCssColorString("#483D8B"));M.DARKSLATEGRAY=Object.freeze(M.fromCssColorString("#2F4F4F"));M.DARKSLATEGREY=M.DARKSLATEGRAY;M.DARKTURQUOISE=Object.freeze(M.fromCssColorString("#00CED1"));M.DARKVIOLET=Object.freeze(M.fromCssColorString("#9400D3"));M.DEEPPINK=Object.freeze(M.fromCssColorString("#FF1493"));M.DEEPSKYBLUE=Object.freeze(M.fromCssColorString("#00BFFF"));M.DIMGRAY=Object.freeze(M.fromCssColorString("#696969"));M.DIMGREY=M.DIMGRAY;M.DODGERBLUE=Object.freeze(M.fromCssColorString("#1E90FF"));M.FIREBRICK=Object.freeze(M.fromCssColorString("#B22222"));M.FLORALWHITE=Object.freeze(M.fromCssColorString("#FFFAF0"));M.FORESTGREEN=Object.freeze(M.fromCssColorString("#228B22"));M.FUCHSIA=Object.freeze(M.fromCssColorString("#FF00FF"));M.GAINSBORO=Object.freeze(M.fromCssColorString("#DCDCDC"));M.GHOSTWHITE=Object.freeze(M.fromCssColorString("#F8F8FF"));M.GOLD=Object.freeze(M.fromCssColorString("#FFD700"));M.GOLDENROD=Object.freeze(M.fromCssColorString("#DAA520"));M.GRAY=Object.freeze(M.fromCssColorString("#808080"));M.GREEN=Object.freeze(M.fromCssColorString("#008000"));M.GREENYELLOW=Object.freeze(M.fromCssColorString("#ADFF2F"));M.GREY=M.GRAY;M.HONEYDEW=Object.freeze(M.fromCssColorString("#F0FFF0"));M.HOTPINK=Object.freeze(M.fromCssColorString("#FF69B4"));M.INDIANRED=Object.freeze(M.fromCssColorString("#CD5C5C"));M.INDIGO=Object.freeze(M.fromCssColorString("#4B0082"));M.IVORY=Object.freeze(M.fromCssColorString("#FFFFF0"));M.KHAKI=Object.freeze(M.fromCssColorString("#F0E68C"));M.LAVENDER=Object.freeze(M.fromCssColorString("#E6E6FA"));M.LAVENDAR_BLUSH=Object.freeze(M.fromCssColorString("#FFF0F5"));M.LAWNGREEN=Object.freeze(M.fromCssColorString("#7CFC00"));M.LEMONCHIFFON=Object.freeze(M.fromCssColorString("#FFFACD"));M.LIGHTBLUE=Object.freeze(M.fromCssColorString("#ADD8E6"));M.LIGHTCORAL=Object.freeze(M.fromCssColorString("#F08080"));M.LIGHTCYAN=Object.freeze(M.fromCssColorString("#E0FFFF"));M.LIGHTGOLDENRODYELLOW=Object.freeze(M.fromCssColorString("#FAFAD2"));M.LIGHTGRAY=Object.freeze(M.fromCssColorString("#D3D3D3"));M.LIGHTGREEN=Object.freeze(M.fromCssColorString("#90EE90"));M.LIGHTGREY=M.LIGHTGRAY;M.LIGHTPINK=Object.freeze(M.fromCssColorString("#FFB6C1"));M.LIGHTSEAGREEN=Object.freeze(M.fromCssColorString("#20B2AA"));M.LIGHTSKYBLUE=Object.freeze(M.fromCssColorString("#87CEFA"));M.LIGHTSLATEGRAY=Object.freeze(M.fromCssColorString("#778899"));M.LIGHTSLATEGREY=M.LIGHTSLATEGRAY;M.LIGHTSTEELBLUE=Object.freeze(M.fromCssColorString("#B0C4DE"));M.LIGHTYELLOW=Object.freeze(M.fromCssColorString("#FFFFE0"));M.LIME=Object.freeze(M.fromCssColorString("#00FF00"));M.LIMEGREEN=Object.freeze(M.fromCssColorString("#32CD32"));M.LINEN=Object.freeze(M.fromCssColorString("#FAF0E6"));M.MAGENTA=Object.freeze(M.fromCssColorString("#FF00FF"));M.MAROON=Object.freeze(M.fromCssColorString("#800000"));M.MEDIUMAQUAMARINE=Object.freeze(M.fromCssColorString("#66CDAA"));M.MEDIUMBLUE=Object.freeze(M.fromCssColorString("#0000CD"));M.MEDIUMORCHID=Object.freeze(M.fromCssColorString("#BA55D3"));M.MEDIUMPURPLE=Object.freeze(M.fromCssColorString("#9370DB"));M.MEDIUMSEAGREEN=Object.freeze(M.fromCssColorString("#3CB371"));M.MEDIUMSLATEBLUE=Object.freeze(M.fromCssColorString("#7B68EE"));M.MEDIUMSPRINGGREEN=Object.freeze(M.fromCssColorString("#00FA9A"));M.MEDIUMTURQUOISE=Object.freeze(M.fromCssColorString("#48D1CC"));M.MEDIUMVIOLETRED=Object.freeze(M.fromCssColorString("#C71585"));M.MIDNIGHTBLUE=Object.freeze(M.fromCssColorString("#191970"));M.MINTCREAM=Object.freeze(M.fromCssColorString("#F5FFFA"));M.MISTYROSE=Object.freeze(M.fromCssColorString("#FFE4E1"));M.MOCCASIN=Object.freeze(M.fromCssColorString("#FFE4B5"));M.NAVAJOWHITE=Object.freeze(M.fromCssColorString("#FFDEAD"));M.NAVY=Object.freeze(M.fromCssColorString("#000080"));M.OLDLACE=Object.freeze(M.fromCssColorString("#FDF5E6"));M.OLIVE=Object.freeze(M.fromCssColorString("#808000"));M.OLIVEDRAB=Object.freeze(M.fromCssColorString("#6B8E23"));M.ORANGE=Object.freeze(M.fromCssColorString("#FFA500"));M.ORANGERED=Object.freeze(M.fromCssColorString("#FF4500"));M.ORCHID=Object.freeze(M.fromCssColorString("#DA70D6"));M.PALEGOLDENROD=Object.freeze(M.fromCssColorString("#EEE8AA"));M.PALEGREEN=Object.freeze(M.fromCssColorString("#98FB98"));M.PALETURQUOISE=Object.freeze(M.fromCssColorString("#AFEEEE"));M.PALEVIOLETRED=Object.freeze(M.fromCssColorString("#DB7093"));M.PAPAYAWHIP=Object.freeze(M.fromCssColorString("#FFEFD5"));M.PEACHPUFF=Object.freeze(M.fromCssColorString("#FFDAB9"));M.PERU=Object.freeze(M.fromCssColorString("#CD853F"));M.PINK=Object.freeze(M.fromCssColorString("#FFC0CB"));M.PLUM=Object.freeze(M.fromCssColorString("#DDA0DD"));M.POWDERBLUE=Object.freeze(M.fromCssColorString("#B0E0E6"));M.PURPLE=Object.freeze(M.fromCssColorString("#800080"));M.RED=Object.freeze(M.fromCssColorString("#FF0000"));M.ROSYBROWN=Object.freeze(M.fromCssColorString("#BC8F8F"));M.ROYALBLUE=Object.freeze(M.fromCssColorString("#4169E1"));M.SADDLEBROWN=Object.freeze(M.fromCssColorString("#8B4513"));M.SALMON=Object.freeze(M.fromCssColorString("#FA8072"));M.SANDYBROWN=Object.freeze(M.fromCssColorString("#F4A460"));M.SEAGREEN=Object.freeze(M.fromCssColorString("#2E8B57"));M.SEASHELL=Object.freeze(M.fromCssColorString("#FFF5EE"));M.SIENNA=Object.freeze(M.fromCssColorString("#A0522D"));M.SILVER=Object.freeze(M.fromCssColorString("#C0C0C0"));M.SKYBLUE=Object.freeze(M.fromCssColorString("#87CEEB"));M.SLATEBLUE=Object.freeze(M.fromCssColorString("#6A5ACD"));M.SLATEGRAY=Object.freeze(M.fromCssColorString("#708090"));M.SLATEGREY=M.SLATEGRAY;M.SNOW=Object.freeze(M.fromCssColorString("#FFFAFA"));M.SPRINGGREEN=Object.freeze(M.fromCssColorString("#00FF7F"));M.STEELBLUE=Object.freeze(M.fromCssColorString("#4682B4"));M.TAN=Object.freeze(M.fromCssColorString("#D2B48C"));M.TEAL=Object.freeze(M.fromCssColorString("#008080"));M.THISTLE=Object.freeze(M.fromCssColorString("#D8BFD8"));M.TOMATO=Object.freeze(M.fromCssColorString("#FF6347"));M.TURQUOISE=Object.freeze(M.fromCssColorString("#40E0D0"));M.VIOLET=Object.freeze(M.fromCssColorString("#EE82EE"));M.WHEAT=Object.freeze(M.fromCssColorString("#F5DEB3"));M.WHITE=Object.freeze(M.fromCssColorString("#FFFFFF"));M.WHITESMOKE=Object.freeze(M.fromCssColorString("#F5F5F5"));M.YELLOW=Object.freeze(M.fromCssColorString("#FFFF00"));M.YELLOWGREEN=Object.freeze(M.fromCssColorString("#9ACD32"));M.TRANSPARENT=Object.freeze(new M(0,0,0,0));function Qs(e,t,n,i){e=T(e,1),t=T(t,1),n=T(n,1),i=T(i,1),this.value=new Uint8Array([M.floatToByte(e),M.floatToByte(t),M.floatToByte(n),M.floatToByte(i)])}Object.defineProperties(Qs.prototype,{componentDatatype:{get:function(){return q.UNSIGNED_BYTE}},componentsPerAttribute:{get:function(){return 4}},normalize:{get:function(){return!0}}});Qs.fromColor=function(e){if(!l(e))throw new A("color is required.");return new Qs(e.red,e.green,e.blue,e.alpha)};Qs.toValue=function(e,t){if(!l(e))throw new A("color is required.");return l(t)?e.toBytes(t):new Uint8Array(e.toBytes())};Qs.equals=function(e,t){return e===t||l(e)&&l(t)&&e.value[0]===t.value[0]&&e.value[1]===t.value[1]&&e.value[2]===t.value[2]&&e.value[3]===t.value[3]};function lh(e,t,n,i,r){this._format=e,this._datatype=t,this._width=n,this._height=i,this._buffer=r}Object.defineProperties(lh.prototype,{internalFormat:{get:function(){return this._format}},pixelDatatype:{get:function(){return this._datatype}},width:{get:function(){return this._width}},height:{get:function(){return this._height}},bufferView:{get:function(){return this._buffer}}});lh.clone=function(e){if(l(e))return new lh(e._format,e._datatype,e._width,e._height,e._buffer)};lh.prototype.clone=function(){return lh.clone(this)};function Ih(e){this._value=e,this._valueType=Mn.getPointType(e)}Object.defineProperties(Ih.prototype,{value:{get:function(){return this._value}}});Ih.prototype.findTimeInterval=function(e){throw new A("findTimeInterval cannot be called on a ConstantSpline.")};Ih.prototype.wrapTime=function(e){return y.typeOf.number("time",e),0};Ih.prototype.clampTime=function(e){return y.typeOf.number("time",e),0};Ih.prototype.evaluate=function(e,t){y.typeOf.number("time",e);const n=this._value,i=this._valueType;return i===Number?n:i.clone(n,t)};const _I=R.EPSILON10;function Iu(e,t,n,i){if(y.defined("equalsEpsilon",t),!l(e))return;n=T(n,!1);const r=l(i),s=e.length;if(s<2)return e;let o,a=e[0],c,u,h=0,d=-1;for(o=1;o<s;++o)c=e[o],t(a,c,_I)?(l(u)||(u=e.slice(0,o),h=o-1,d=0),r&&i.push(o)):(l(u)&&(u.push(c),h=o,r&&(d=i.length)),a=c);return n&&t(e[0],e[s-1],_I)&&(r&&(l(u)?i.splice(d,0,h):i.push(s-1)),l(u)?u.length-=1:u=e.slice(0,-1)),l(u)?u:e}const Jp={},b7=new m,lL=new m,uL=new m,fL=new m,hL=new st;Jp.validOutline=function(e){y.defined("positions",e);const n=st.fromPoints(e,hL).halfAxes,i=H.getColumn(n,0,lL),r=H.getColumn(n,1,uL),s=H.getColumn(n,2,fL),o=m.magnitude(i),a=m.magnitude(r),c=m.magnitude(s);return!(o===0&&(a===0||c===0)||a===0&&c===0)};Jp.computeProjectTo2DArguments=function(e,t,n,i){y.defined("positions",e),y.defined("centerResult",t),y.defined("planeAxis1Result",n),y.defined("planeAxis2Result",i);const r=st.fromPoints(e,hL),s=r.halfAxes,o=H.getColumn(s,0,lL),a=H.getColumn(s,1,uL),c=H.getColumn(s,2,fL),u=m.magnitude(o),h=m.magnitude(a),d=m.magnitude(c),p=Math.min(u,h,d);if(u===0&&(h===0||d===0)||h===0&&d===0)return!1;let g,_;return(p===h||p===d)&&(g=o),p===u?g=a:p===d&&(_=a),(p===u||p===h)&&(_=c),m.normalize(g,n),m.normalize(_,i),m.clone(r.center,t),!0};function dL(e,t,n,i,r){const s=m.subtract(e,t,b7),o=m.dot(n,s),a=m.dot(i,s);return k.fromElements(o,a,r)}Jp.createProjectPointsTo2DFunction=function(e,t,n){return function(i){const r=new Array(i.length);for(let s=0;s<i.length;s++)r[s]=dL(i[s],e,t,n);return r}};Jp.createProjectPointTo2DFunction=function(e,t,n){return function(i,r){return dL(i,e,t,n,r)}};function Zx(e,t,n){if(e===0)return t*n;const i=e*e,r=i*i,s=r*i,o=s*i,a=o*i,c=a*i,u=n,h=Math.sin(2*u),d=Math.sin(4*u),p=Math.sin(6*u),g=Math.sin(8*u),_=Math.sin(10*u),b=Math.sin(12*u);return t*((1-i/4-3*r/64-5*s/256-175*o/16384-441*a/65536-4851*c/1048576)*u-(3*i/8+3*r/32+45*s/1024+105*o/4096+2205*a/131072+6237*c/524288)*h+(15*r/256+45*s/1024+525*o/16384+1575*a/65536+155925*c/8388608)*d-(35*s/3072+175*o/12288+3675*a/262144+13475*c/1048576)*p+(315*o/131072+2205*a/524288+43659*c/8388608)*g-(693*a/1310720+6237*c/5242880)*_+1001*c/8388608*b)}function T7(e,t,n){const i=e/n;if(t===0)return i;const r=i*i,s=r*i,o=s*i,a=t,c=a*a,u=c*c,h=u*c,d=h*c,p=d*c,g=p*c,_=Math.sin(2*i),b=Math.cos(2*i),x=Math.sin(4*i),E=Math.cos(4*i),C=Math.sin(6*i),w=Math.cos(6*i),S=Math.sin(8*i),v=Math.cos(8*i),D=Math.sin(10*i),L=Math.cos(10*i),O=Math.sin(12*i);return i+i*c/4+7*i*u/64+15*i*h/256+579*i*d/16384+1515*i*p/65536+16837*i*g/1048576+(3*i*u/16+45*i*h/256-i*(32*r-561)*d/4096-i*(232*r-1677)*p/16384+i*(399985-90560*r+512*o)*g/5242880)*b+(21*i*h/256+483*i*d/4096-i*(224*r-1969)*p/16384-i*(33152*r-112599)*g/1048576)*E+(151*i*d/4096+4681*i*p/65536+1479*i*g/16384-453*s*g/32768)*w+(1097*i*p/65536+42783*i*g/1048576)*v+8011*i*g/1048576*L+(3*c/8+3*u/16+213*h/2048-3*r*h/64+255*d/4096-33*r*d/512+20861*p/524288-33*r*p/512+o*p/1024+28273*g/1048576-471*r*g/8192+9*o*g/4096)*_+(21*u/256+21*h/256+533*d/8192-21*r*d/512+197*p/4096-315*r*p/4096+584039*g/16777216-12517*r*g/131072+7*o*g/2048)*x+(151*h/6144+151*d/4096+5019*p/131072-453*r*p/16384+26965*g/786432-8607*r*g/131072)*C+(1097*d/131072+1097*p/65536+225797*g/10485760-1097*r*g/65536)*S+(8011*p/2621440+8011*g/1048576)*D+293393*g/251658240*O}function uh(e,t){if(e===0)return Math.log(Math.tan(.5*(R.PI_OVER_TWO+t)));const n=e*Math.sin(t);return Math.log(Math.tan(.5*(R.PI_OVER_TWO+t)))-e/2*Math.log((1+n)/(1-n))}function x7(e,t,n,i,r){const s=uh(e._ellipticity,n),o=uh(e._ellipticity,r);return Math.atan2(R.negativePiToPi(i-t),o-s)}function E7(e,t,n,i,r,s,o){const a=e._heading,c=s-i;let u=0;if(R.equalsEpsilon(Math.abs(a),R.PI_OVER_TWO,R.EPSILON8))if(t===n)u=t*Math.cos(r)*R.negativePiToPi(c);else{const h=Math.sin(r);u=t*Math.cos(r)*R.negativePiToPi(c)/Math.sqrt(1-e._ellipticitySquared*h*h)}else{const h=Zx(e._ellipticity,t,r);u=(Zx(e._ellipticity,t,o)-h)/Math.cos(a)}return Math.abs(u)}const C7=new m,O0=new m;function pL(e,t,n,i){const r=m.normalize(i.cartographicToCartesian(t,O0),C7),s=m.normalize(i.cartographicToCartesian(n,O0),O0);y.typeOf.number.greaterThanOrEquals("value",Math.abs(Math.abs(m.angleBetween(r,s))-Math.PI),.0125);const o=i.maximumRadius,a=i.minimumRadius,c=o*o,u=a*a;e._ellipticitySquared=(c-u)/c,e._ellipticity=Math.sqrt(e._ellipticitySquared),e._start=oe.clone(t,e._start),e._start.height=0,e._end=oe.clone(n,e._end),e._end.height=0,e._heading=x7(e,t.longitude,t.latitude,n.longitude,n.latitude),e._distance=E7(e,i.maximumRadius,i.minimumRadius,t.longitude,t.latitude,n.longitude,n.latitude)}function mL(e,t,n,i,r,s){if(n===0)return oe.clone(e,s);const o=r*r;let a,c,u;if(Math.abs(R.PI_OVER_TWO-Math.abs(t))>R.EPSILON8){const h=Zx(r,i,e.latitude),d=n*Math.cos(t),p=h+d;if(c=T7(p,r,i),Math.abs(t)<R.EPSILON10)a=R.negativePiToPi(e.longitude);else{const g=uh(r,e.latitude),_=uh(r,c);u=Math.tan(t)*(_-g),a=R.negativePiToPi(e.longitude+u)}}else{c=e.latitude;let h;if(r===0)h=i*Math.cos(e.latitude);else{const d=Math.sin(e.latitude);h=i*Math.cos(e.latitude)/Math.sqrt(1-o*d*d)}u=n/h,t>0?a=R.negativePiToPi(e.longitude+u):a=R.negativePiToPi(e.longitude-u)}return l(s)?(s.longitude=a,s.latitude=c,s.height=0,s):new oe(a,c,0)}function Cr(e,t,n){const i=T(n,fe.default);this._ellipsoid=i,this._start=new oe,this._end=new oe,this._heading=void 0,this._distance=void 0,this._ellipticity=void 0,this._ellipticitySquared=void 0,l(e)&&l(t)&&pL(this,e,t,i)}Object.defineProperties(Cr.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},surfaceDistance:{get:function(){return y.defined("distance",this._distance),this._distance}},start:{get:function(){return this._start}},end:{get:function(){return this._end}},heading:{get:function(){return y.defined("distance",this._distance),this._heading}}});Cr.fromStartHeadingDistance=function(e,t,n,i,r){y.defined("start",e),y.defined("heading",t),y.defined("distance",n),y.typeOf.number.greaterThan("distance",n,0);const s=T(i,fe.default),o=s.maximumRadius,a=s.minimumRadius,c=o*o,u=a*a,h=Math.sqrt((c-u)/c);t=R.negativePiToPi(t);const d=mL(e,t,n,s.maximumRadius,h);return!l(r)||l(i)&&!i.equals(r.ellipsoid)?new Cr(e,d,s):(r.setEndPoints(e,d),r)};Cr.prototype.setEndPoints=function(e,t){y.defined("start",e),y.defined("end",t),pL(this,e,t,this._ellipsoid)};Cr.prototype.interpolateUsingFraction=function(e,t){return this.interpolateUsingSurfaceDistance(e*this._distance,t)};Cr.prototype.interpolateUsingSurfaceDistance=function(e,t){if(y.typeOf.number("distance",e),!l(this._distance)||this._distance===0)throw new A("EllipsoidRhumbLine must have distinct start and end set.");return mL(this._start,this._heading,e,this._ellipsoid.maximumRadius,this._ellipticity,t)};Cr.prototype.findIntersectionWithLongitude=function(e,t){if(y.typeOf.number("intersectionLongitude",e),!l(this._distance)||this._distance===0)throw new A("EllipsoidRhumbLine must have distinct start and end set.");const n=this._ellipticity,i=this._heading,r=Math.abs(i),s=this._start;if(e=R.negativePiToPi(e),R.equalsEpsilon(Math.abs(e),Math.PI,R.EPSILON14)&&(e=R.sign(s.longitude)*Math.PI),l(t)||(t=new oe),Math.abs(R.PI_OVER_TWO-r)<=R.EPSILON8)return t.longitude=e,t.latitude=s.latitude,t.height=0,t;if(R.equalsEpsilon(Math.abs(R.PI_OVER_TWO-r),R.PI_OVER_TWO,R.EPSILON8))return R.equalsEpsilon(e,s.longitude,R.EPSILON12)?void 0:(t.longitude=e,t.latitude=R.PI_OVER_TWO*R.sign(R.PI_OVER_TWO-i),t.height=0,t);const o=s.latitude,a=n*Math.sin(o),c=Math.tan(.5*(R.PI_OVER_TWO+o))*Math.exp((e-s.longitude)/Math.tan(i)),u=(1+a)/(1-a);let h=s.latitude,d;do{d=h;const p=n*Math.sin(d),g=(1+p)/(1-p);h=2*Math.atan(c*Math.pow(g/u,n/2))-R.PI_OVER_TWO}while(!R.equalsEpsilon(h,d,R.EPSILON12));return t.longitude=e,t.latitude=h,t.height=0,t};Cr.prototype.findIntersectionWithLatitude=function(e,t){if(y.typeOf.number("intersectionLatitude",e),!l(this._distance)||this._distance===0)throw new A("EllipsoidRhumbLine must have distinct start and end set.");const n=this._ellipticity,i=this._heading,r=this._start;if(R.equalsEpsilon(Math.abs(i),R.PI_OVER_TWO,R.EPSILON8))return;const s=uh(n,r.latitude),o=uh(n,e),a=Math.tan(i)*(o-s),c=R.negativePiToPi(r.longitude+a);return l(t)?(t.longitude=c,t.latitude=e,t.height=0,t):new oe(c,e,0)};function w7(e,t){this.positions=l(e)?e:[],this.holes=l(t)?t:[]}function A7(e,t,n=2){const i=t&&t.length,r=i?t[0]*n:e.length;let s=gL(e,0,r,n,!0);const o=[];if(!s||s.next===s.prev)return o;let a,c,u;if(i&&(s=R7(e,t,s,n)),e.length>80*n){a=1/0,c=1/0;let h=-1/0,d=-1/0;for(let p=n;p<r;p+=n){const g=e[p],_=e[p+1];g<a&&(a=g),_<c&&(c=_),g>h&&(h=g),_>d&&(d=_)}u=Math.max(h-a,d-c),u=u!==0?32767/u:0}return Ep(s,o,n,a,c,u,0),o}function gL(e,t,n,i,r){let s;if(r===j7(e,t,n,i)>0)for(let o=t;o<n;o+=i)s=yI(o/i|0,e[o],e[o+1],s);else for(let o=n-i;o>=t;o-=i)s=yI(o/i|0,e[o],e[o+1],s);return s&&Vy(s,s.next)&&(wp(s),s=s.next),s}function Ou(e,t){if(!e)return e;t||(t=e);let n=e,i;do if(i=!1,!n.steiner&&(Vy(n,n.next)||Qn(n.prev,n,n.next)===0)){if(wp(n),n=t=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==t);return t}function Ep(e,t,n,i,r,s,o){if(!e)return;!o&&s&&N7(e,i,r,s);let a=e;for(;e.prev!==e.next;){const c=e.prev,u=e.next;if(s?v7(e,i,r,s):S7(e)){t.push(c.i,e.i,u.i),wp(e),e=u.next,a=u.next;continue}if(e=u,e===a){o?o===1?(e=I7(Ou(e),t),Ep(e,t,n,i,r,s,2)):o===2&&O7(e,t,n,i,r,s):Ep(Ou(e),t,n,i,r,s,1);break}}}function S7(e){const t=e.prev,n=e,i=e.next;if(Qn(t,n,i)>=0)return!1;const r=t.x,s=n.x,o=i.x,a=t.y,c=n.y,u=i.y,h=r<s?r<o?r:o:s<o?s:o,d=a<c?a<u?a:u:c<u?c:u,p=r>s?r>o?r:o:s>o?s:o,g=a>c?a>u?a:u:c>u?c:u;let _=i.next;for(;_!==t;){if(_.x>=h&&_.x<=p&&_.y>=d&&_.y<=g&&If(r,a,s,c,o,u,_.x,_.y)&&Qn(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function v7(e,t,n,i){const r=e.prev,s=e,o=e.next;if(Qn(r,s,o)>=0)return!1;const a=r.x,c=s.x,u=o.x,h=r.y,d=s.y,p=o.y,g=a<c?a<u?a:u:c<u?c:u,_=h<d?h<p?h:p:d<p?d:p,b=a>c?a>u?a:u:c>u?c:u,x=h>d?h>p?h:p:d>p?d:p,E=Jx(g,_,t,n,i),C=Jx(b,x,t,n,i);let w=e.prevZ,S=e.nextZ;for(;w&&w.z>=E&&S&&S.z<=C;){if(w.x>=g&&w.x<=b&&w.y>=_&&w.y<=x&&w!==r&&w!==o&&If(a,h,c,d,u,p,w.x,w.y)&&Qn(w.prev,w,w.next)>=0||(w=w.prevZ,S.x>=g&&S.x<=b&&S.y>=_&&S.y<=x&&S!==r&&S!==o&&If(a,h,c,d,u,p,S.x,S.y)&&Qn(S.prev,S,S.next)>=0))return!1;S=S.nextZ}for(;w&&w.z>=E;){if(w.x>=g&&w.x<=b&&w.y>=_&&w.y<=x&&w!==r&&w!==o&&If(a,h,c,d,u,p,w.x,w.y)&&Qn(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;S&&S.z<=C;){if(S.x>=g&&S.x<=b&&S.y>=_&&S.y<=x&&S!==r&&S!==o&&If(a,h,c,d,u,p,S.x,S.y)&&Qn(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function I7(e,t){let n=e;do{const i=n.prev,r=n.next.next;!Vy(i,r)&&_L(i,n,n.next,r)&&Cp(i,r)&&Cp(r,i)&&(t.push(i.i,n.i,r.i),wp(n),wp(n.next),n=e=r),n=n.next}while(n!==e);return Ou(n)}function O7(e,t,n,i,r,s){let o=e;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&z7(o,a)){let c=yL(o,a);o=Ou(o,o.next),c=Ou(c,c.next),Ep(o,t,n,i,r,s,0),Ep(c,t,n,i,r,s,0);return}a=a.next}o=o.next}while(o!==e)}function R7(e,t,n,i){const r=[];for(let s=0,o=t.length;s<o;s++){const a=t[s]*i,c=s<o-1?t[s+1]*i:e.length,u=gL(e,a,c,i,!1);u===u.next&&(u.steiner=!0),r.push(B7(u))}r.sort(D7);for(let s=0;s<r.length;s++)n=M7(r[s],n);return n}function D7(e,t){return e.x-t.x}function M7(e,t){const n=L7(e,t);if(!n)return t;const i=yL(n,e);return Ou(i,i.next),Ou(n,n.next)}function L7(e,t){let n=t;const i=e.x,r=e.y;let s=-1/0,o;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const d=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(d<=i&&d>s&&(s=d,o=n.x<n.next.x?n:n.next,d===i))return o}n=n.next}while(n!==t);if(!o)return null;const a=o,c=o.x,u=o.y;let h=1/0;n=o;do{if(i>=n.x&&n.x>=c&&i!==n.x&&If(r<u?i:s,r,c,u,r<u?s:i,r,n.x,n.y)){const d=Math.abs(r-n.y)/(i-n.x);Cp(n,e)&&(d<h||d===h&&(n.x>o.x||n.x===o.x&&P7(o,n)))&&(o=n,h=d)}n=n.next}while(n!==a);return o}function P7(e,t){return Qn(e.prev,e,t.prev)<0&&Qn(t.next,e,e.next)<0}function N7(e,t,n,i){let r=e;do r.z===0&&(r.z=Jx(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,F7(r)}function F7(e){let t,n=1;do{let i=e,r;e=null;let s=null;for(t=0;i;){t++;let o=i,a=0;for(let u=0;u<n&&(a++,o=o.nextZ,!!o);u++);let c=n;for(;a>0||c>0&&o;)a!==0&&(c===0||!o||i.z<=o.z)?(r=i,i=i.nextZ,a--):(r=o,o=o.nextZ,c--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;i=o}s.nextZ=null,n*=2}while(t>1);return e}function Jx(e,t,n,i,r){return e=(e-n)*r|0,t=(t-i)*r|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function B7(e){let t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e);return n}function If(e,t,n,i,r,s,o,a){return(r-o)*(t-a)>=(e-o)*(s-a)&&(e-o)*(i-a)>=(n-o)*(t-a)&&(n-o)*(s-a)>=(r-o)*(i-a)}function z7(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!U7(e,t)&&(Cp(e,t)&&Cp(t,e)&&k7(e,t)&&(Qn(e.prev,e,t.prev)||Qn(e,t.prev,t))||Vy(e,t)&&Qn(e.prev,e,e.next)>0&&Qn(t.prev,t,t.next)>0)}function Qn(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Vy(e,t){return e.x===t.x&&e.y===t.y}function _L(e,t,n,i){const r=rg(Qn(e,t,n)),s=rg(Qn(e,t,i)),o=rg(Qn(n,i,e)),a=rg(Qn(n,i,t));return!!(r!==s&&o!==a||r===0&&ig(e,n,t)||s===0&&ig(e,i,t)||o===0&&ig(n,e,i)||a===0&&ig(n,t,i))}function ig(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function rg(e){return e>0?1:e<0?-1:0}function U7(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&_L(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}function Cp(e,t){return Qn(e.prev,e,e.next)<0?Qn(e,t,e.next)>=0&&Qn(e,e.prev,t)>=0:Qn(e,t,e.prev)<0||Qn(e,e.next,t)<0}function k7(e,t){let n=e,i=!1;const r=(e.x+t.x)/2,s=(e.y+t.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==e);return i}function yL(e,t){const n=Qx(e.i,e.x,e.y),i=Qx(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function yI(e,t,n,i){const r=Qx(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function wp(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Qx(e,t,n){return{i:e,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function j7(e,t,n,i){let r=0;for(let s=t,o=n-i;s<n;s+=i)r+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return r}const Qg={CLOCKWISE:j.CW,COUNTER_CLOCKWISE:j.CCW};Qg.validate=function(e){return e===Qg.CLOCKWISE||e===Qg.COUNTER_CLOCKWISE};const xl=Object.freeze(Qg),V7=new m,G7=new m,xi={};xi.computeArea2D=function(e){y.defined("positions",e),y.typeOf.number.greaterThanOrEquals("positions.length",e.length,3);const t=e.length;let n=0;for(let i=t-1,r=0;r<t;i=r++){const s=e[i],o=e[r];n+=s.x*o.y-o.x*s.y}return n*.5};xi.computeWindingOrder2D=function(e){return xi.computeArea2D(e)>0?xl.COUNTER_CLOCKWISE:xl.CLOCKWISE};xi.triangulate=function(e,t){y.defined("positions",e);const n=k.packArray(e);return A7(n,t,2)};const bL=new m,TL=new m,xL=new m,bI=new m,TI=new m,xI=new m,ka=new m,EL=new k,CL=new k,wL=new k,Vf=new k;xi.computeSubdivision=function(e,t,n,i,r){r=T(r,R.RADIANS_PER_DEGREE);const s=l(i);y.typeOf.object("ellipsoid",e),y.defined("positions",t),y.defined("indices",n),y.typeOf.number.greaterThanOrEquals("indices.length",n.length,3),y.typeOf.number.equals("indices.length % 3","0",n.length%3,0),y.typeOf.number.greaterThan("granularity",r,0);const o=n.slice(0);let a;const c=t.length,u=new Array(c*3),h=new Array(c*2);let d=0,p=0;for(a=0;a<c;a++){const w=t[a];if(u[d++]=w.x,u[d++]=w.y,u[d++]=w.z,s){const S=i[a];h[p++]=S.x,h[p++]=S.y}}const g=[],_={},b=e.maximumRadius,x=R.chordLength(r,b),E=x*x;for(;o.length>0;){const w=o.pop(),S=o.pop(),v=o.pop(),D=m.fromArray(u,v*3,bL),L=m.fromArray(u,S*3,TL),O=m.fromArray(u,w*3,xL);let N,B,U;s&&(N=k.fromArray(h,v*2,EL),B=k.fromArray(h,S*2,CL),U=k.fromArray(h,w*2,wL));const V=m.multiplyByScalar(m.normalize(D,bI),b,bI),f=m.multiplyByScalar(m.normalize(L,TI),b,TI),I=m.multiplyByScalar(m.normalize(O,xI),b,xI),F=m.magnitudeSquared(m.subtract(V,f,ka)),G=m.magnitudeSquared(m.subtract(f,I,ka)),W=m.magnitudeSquared(m.subtract(I,V,ka)),X=Math.max(F,G,W);let Z,$,ne;X>E?F===X?(Z=`${Math.min(v,S)} ${Math.max(v,S)}`,a=_[Z],l(a)||($=m.add(D,L,ka),m.multiplyByScalar($,.5,$),u.push($.x,$.y,$.z),a=u.length/3-1,_[Z]=a,s&&(ne=k.add(N,B,Vf),k.multiplyByScalar(ne,.5,ne),h.push(ne.x,ne.y))),o.push(v,a,w),o.push(a,S,w)):G===X?(Z=`${Math.min(S,w)} ${Math.max(S,w)}`,a=_[Z],l(a)||($=m.add(L,O,ka),m.multiplyByScalar($,.5,$),u.push($.x,$.y,$.z),a=u.length/3-1,_[Z]=a,s&&(ne=k.add(B,U,Vf),k.multiplyByScalar(ne,.5,ne),h.push(ne.x,ne.y))),o.push(S,a,v),o.push(a,w,v)):W===X&&(Z=`${Math.min(w,v)} ${Math.max(w,v)}`,a=_[Z],l(a)||($=m.add(O,D,ka),m.multiplyByScalar($,.5,$),u.push($.x,$.y,$.z),a=u.length/3-1,_[Z]=a,s&&(ne=k.add(U,N,Vf),k.multiplyByScalar(ne,.5,ne),h.push(ne.x,ne.y))),o.push(w,a,S),o.push(a,v,S)):(g.push(v),g.push(S),g.push(w))}const C={attributes:{position:new Lt({componentDatatype:q.DOUBLE,componentsPerAttribute:3,values:u})},indices:g,primitiveType:Fe.TRIANGLES};return s&&(C.attributes.st=new Lt({componentDatatype:q.FLOAT,componentsPerAttribute:2,values:h})),new Ht(C)};const H7=new oe,q7=new oe,W7=new oe,R0=new oe;xi.computeRhumbLineSubdivision=function(e,t,n,i,r){r=T(r,R.RADIANS_PER_DEGREE);const s=l(i);y.typeOf.object("ellipsoid",e),y.defined("positions",t),y.defined("indices",n),y.typeOf.number.greaterThanOrEquals("indices.length",n.length,3),y.typeOf.number.equals("indices.length % 3","0",n.length%3,0),y.typeOf.number.greaterThan("granularity",r,0);const o=n.slice(0);let a;const c=t.length,u=new Array(c*3),h=new Array(c*2);let d=0,p=0;for(a=0;a<c;a++){const v=t[a];if(u[d++]=v.x,u[d++]=v.y,u[d++]=v.z,s){const D=i[a];h[p++]=D.x,h[p++]=D.y}}const g=[],_={},b=e.maximumRadius,x=R.chordLength(r,b),E=new Cr(void 0,void 0,e),C=new Cr(void 0,void 0,e),w=new Cr(void 0,void 0,e);for(;o.length>0;){const v=o.pop(),D=o.pop(),L=o.pop(),O=m.fromArray(u,L*3,bL),N=m.fromArray(u,D*3,TL),B=m.fromArray(u,v*3,xL);let U,V,f;s&&(U=k.fromArray(h,L*2,EL),V=k.fromArray(h,D*2,CL),f=k.fromArray(h,v*2,wL));const I=e.cartesianToCartographic(O,H7),F=e.cartesianToCartographic(N,q7),G=e.cartesianToCartographic(B,W7);E.setEndPoints(I,F);const W=E.surfaceDistance;C.setEndPoints(F,G);const X=C.surfaceDistance;w.setEndPoints(G,I);const Z=w.surfaceDistance,$=Math.max(W,X,Z);let ne,le,pe,we,me;$>x?W===$?(ne=`${Math.min(L,D)} ${Math.max(L,D)}`,a=_[ne],l(a)||(le=E.interpolateUsingFraction(.5,R0),pe=(I.height+F.height)*.5,we=m.fromRadians(le.longitude,le.latitude,pe,e,ka),u.push(we.x,we.y,we.z),a=u.length/3-1,_[ne]=a,s&&(me=k.add(U,V,Vf),k.multiplyByScalar(me,.5,me),h.push(me.x,me.y))),o.push(L,a,v),o.push(a,D,v)):X===$?(ne=`${Math.min(D,v)} ${Math.max(D,v)}`,a=_[ne],l(a)||(le=C.interpolateUsingFraction(.5,R0),pe=(F.height+G.height)*.5,we=m.fromRadians(le.longitude,le.latitude,pe,e,ka),u.push(we.x,we.y,we.z),a=u.length/3-1,_[ne]=a,s&&(me=k.add(V,f,Vf),k.multiplyByScalar(me,.5,me),h.push(me.x,me.y))),o.push(D,a,L),o.push(a,v,L)):Z===$&&(ne=`${Math.min(v,L)} ${Math.max(v,L)}`,a=_[ne],l(a)||(le=w.interpolateUsingFraction(.5,R0),pe=(G.height+I.height)*.5,we=m.fromRadians(le.longitude,le.latitude,pe,e,ka),u.push(we.x,we.y,we.z),a=u.length/3-1,_[ne]=a,s&&(me=k.add(f,U,Vf),k.multiplyByScalar(me,.5,me),h.push(me.x,me.y))),o.push(v,a,D),o.push(a,L,D)):(g.push(L),g.push(D),g.push(v))}const S={attributes:{position:new Lt({componentDatatype:q.DOUBLE,componentsPerAttribute:3,values:u})},indices:g,primitiveType:Fe.TRIANGLES};return s&&(S.attributes.st=new Lt({componentDatatype:q.FLOAT,componentsPerAttribute:2,values:h})),new Ht(S)};xi.scaleToGeodeticHeight=function(e,t,n,i){n=T(n,fe.default);let r=V7,s=G7;if(t=T(t,0),i=T(i,!0),l(e)){const o=e.length;for(let a=0;a<o;a+=3)m.fromArray(e,a,s),i&&(s=n.scaleToGeodeticSurface(s,s)),t!==0&&(r=n.geodeticSurfaceNormal(s,r),m.multiplyByScalar(r,t,r),m.add(s,r,s)),e[a]=s.x,e[a+1]=s.y,e[a+2]=s.z}return e};function hc(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(hc.prototype,{length:{get:function(){return this._length}}});hc.prototype.enqueue=function(e){this._array.push(e),this._length++};hc.prototype.dequeue=function(){if(this._length===0)return;const e=this._array;let t=this._offset;const n=e[t];return e[t]=void 0,t++,t>10&&t*2>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,n};hc.prototype.peek=function(){if(this._length!==0)return this._array[this._offset]};hc.prototype.contains=function(e){return this._array.indexOf(e)!==-1};hc.prototype.clear=function(){this._array.length=this._offset=this._length=0};hc.prototype.sort=function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};const ft={};ft.computeHierarchyPackedLength=function(e,t){let n=0;const i=[e];for(;i.length>0;){const r=i.pop();if(!l(r))continue;n+=2;const s=r.positions,o=r.holes;if(l(s)&&s.length>0&&(n+=s.length*t.packedLength),l(o)){const a=o.length;for(let c=0;c<a;++c)i.push(o[c])}}return n};ft.packPolygonHierarchy=function(e,t,n,i){const r=[e];for(;r.length>0;){const s=r.pop();if(!l(s))continue;const o=s.positions,a=s.holes;if(t[n++]=l(o)?o.length:0,t[n++]=l(a)?a.length:0,l(o)){const c=o.length;for(let u=0;u<c;++u,n+=i.packedLength)i.pack(o[u],t,n)}if(l(a)){const c=a.length;for(let u=0;u<c;++u)r.push(a[u])}}return n};ft.unpackPolygonHierarchy=function(e,t,n){const i=e[t++],r=e[t++],s=new Array(i),o=r>0?new Array(r):void 0;for(let a=0;a<i;++a,t+=n.packedLength)s[a]=n.unpack(e,t);for(let a=0;a<r;++a)o[a]=ft.unpackPolygonHierarchy(e,t,n),t=o[a].startingIndex,delete o[a].startingIndex;return{positions:s,holes:o,startingIndex:t}};const ql=new k;function AL(e,t,n,i){return k.subtract(t,e,ql),k.multiplyByScalar(ql,n/i,ql),k.add(e,ql,ql),[ql.x,ql.y]}const Lc=new m;function $7(e,t,n,i){return m.subtract(t,e,Lc),m.multiplyByScalar(Lc,n/i,Lc),m.add(e,Lc,Lc),[Lc.x,Lc.y,Lc.z]}ft.subdivideLineCount=function(e,t,n){const r=m.distance(e,t)/n,s=Math.max(0,Math.ceil(R.log2(r)));return Math.pow(2,s)};const Gy=new oe,Hy=new oe,X7=new oe,Y7=new m,H_=new Cr;ft.subdivideRhumbLineCount=function(e,t,n,i){const r=e.cartesianToCartographic(t,Gy),s=e.cartesianToCartographic(n,Hy),a=new Cr(r,s,e).surfaceDistance/i,c=Math.max(0,Math.ceil(R.log2(a)));return Math.pow(2,c)};ft.subdivideTexcoordLine=function(e,t,n,i,r,s){const o=ft.subdivideLineCount(n,i,r),a=k.distance(e,t),c=a/o,u=s;u.length=o*2;let h=0;for(let d=0;d<o;d++){const p=AL(e,t,d*c,a);u[h++]=p[0],u[h++]=p[1]}return u};ft.subdivideLine=function(e,t,n,i){const r=ft.subdivideLineCount(e,t,n),s=m.distance(e,t),o=s/r;l(i)||(i=[]);const a=i;a.length=r*3;let c=0;for(let u=0;u<r;u++){const h=$7(e,t,u*o,s);a[c++]=h[0],a[c++]=h[1],a[c++]=h[2]}return a};ft.subdivideTexcoordRhumbLine=function(e,t,n,i,r,s,o){const a=n.cartesianToCartographic(i,Gy),c=n.cartesianToCartographic(r,Hy);H_.setEndPoints(a,c);const u=H_.surfaceDistance/s,h=Math.max(0,Math.ceil(R.log2(u))),d=Math.pow(2,h),p=k.distance(e,t),g=p/d,_=o;_.length=d*2;let b=0;for(let x=0;x<d;x++){const E=AL(e,t,x*g,p);_[b++]=E[0],_[b++]=E[1]}return _};ft.subdivideRhumbLine=function(e,t,n,i,r){const s=e.cartesianToCartographic(t,Gy),o=e.cartesianToCartographic(n,Hy),a=new Cr(s,o,e),c=a.surfaceDistance/i,u=Math.max(0,Math.ceil(R.log2(c))),h=Math.pow(2,u),d=a.surfaceDistance/h;l(r)||(r=[]);const p=r;p.length=h*3;let g=0;for(let _=0;_<h;_++){const b=a.interpolateUsingSurfaceDistance(_*d,X7),x=e.cartographicToCartesian(b,Y7);p[g++]=x.x,p[g++]=x.y,p[g++]=x.z}return p};const K7=new m,Z7=new m,J7=new m,Q7=new m;ft.scaleToGeodeticHeightExtruded=function(e,t,n,i,r){i=T(i,fe.default);const s=K7;let o=Z7;const a=J7;let c=Q7;if(l(e)&&l(e.attributes)&&l(e.attributes.position)){const u=e.attributes.position.values,h=u.length/2;for(let d=0;d<h;d+=3)m.fromArray(u,d,a),i.geodeticSurfaceNormal(a,s),c=i.scaleToGeodeticSurface(a,c),o=m.multiplyByScalar(s,n,o),o=m.add(c,o,o),u[d+h]=o.x,u[d+1+h]=o.y,u[d+2+h]=o.z,r&&(c=m.clone(a,c)),o=m.multiplyByScalar(s,t,o),o=m.add(c,o,o),u[d]=o.x,u[d+1]=o.y,u[d+2]=o.z}return e};ft.polygonOutlinesFromHierarchy=function(e,t,n){const i=[],r=new hc;r.enqueue(e);let s,o,a;for(;r.length!==0;){const c=r.dequeue();let u=c.positions;if(t)for(a=u.length,s=0;s<a;s++)n.scaleToGeodeticSurface(u[s],u[s]);if(u=Iu(u,m.equalsEpsilon,!0),u.length<3)continue;const h=c.holes?c.holes.length:0;for(s=0;s<h;s++){const d=c.holes[s];let p=d.positions;if(t)for(a=p.length,o=0;o<a;++o)n.scaleToGeodeticSurface(p[o],p[o]);if(p=Iu(p,m.equalsEpsilon,!0),p.length<3)continue;i.push(p);let g=0;for(l(d.holes)&&(g=d.holes.length),o=0;o<g;o++)r.enqueue(d.holes[o])}i.push(u)}return i};const eX=new oe;function tX(e,t,n){const i=n.cartesianToCartographic(e,Gy),r=n.cartesianToCartographic(t,Hy);if(Math.sign(i.latitude)===Math.sign(r.latitude))return;H_.setEndPoints(i,r);const s=H_.findIntersectionWithLatitude(0,eX);if(!l(s))return;let o=Math.min(i.longitude,r.longitude),a=Math.max(i.longitude,r.longitude);if(Math.abs(a-o)>R.PI){const c=o;o=a,a=c}if(!(s.longitude<o||s.longitude>a))return n.cartographicToCartesian(s)}function nX(e,t,n,i){if(i===Co.RHUMB)return tX(e,t,n);const r=Ct.lineSegmentPlane(e,t,Ve.ORIGIN_XY_PLANE);if(l(r))return n.scaleToGeodeticSurface(r,r)}const iX=new oe;function rX(e,t,n){const i=[];let r,s,o,a,c,u=0;for(;u<e.length;){r=e[u],s=e[(u+1)%e.length],o=R.sign(r.z),a=R.sign(s.z);const h=d=>t.cartesianToCartographic(d,iX).longitude;if(o===0)i.push({position:u,type:o,visited:!1,next:a,theta:h(r)});else if(a!==0){if(c=nX(r,s,t,n),++u,!l(c))continue;e.splice(u,0,c),i.push({position:u,type:o,visited:!1,next:a,theta:h(c)})}++u}return i}function SL(e,t,n,i,r,s,o){const a=[];let c=s;const u=d=>p=>p.position===d,h=[];do{const d=n[c];a.push(d);const p=i.findIndex(u(c)),g=i[p];if(!l(g)){++c;continue}const{visited:_,type:b,next:x}=g;if(g.visited=!0,b===0){if(x===0){const S=i[p-(o?1:-1)];if((S==null?void 0:S.position)===c+1)S.visited=!0;else{++c;continue}}if(!_&&o&&x>0||s===c&&!o&&x<0){++c;continue}}if(!(o?b>=0:b<=0)){++c;continue}_||h.push(c);const C=p+(o?1:-1),w=i[C];if(!l(w)){++c;continue}c=w.position}while(c<n.length&&c>=0&&c!==s&&a.length<n.length);e.splice(t,r,a);for(const d of h)t=SL(e,++t,n,i,0,d,!o);return t}ft.splitPolygonsOnEquator=function(e,t,n,i){l(i)||(i=[]),i.splice(0,0,...e),i.length=e.length;let r=0;for(;r<i.length;){const s=i[r],o=s.slice();if(s.length<3){i[r]=o,++r;continue}const a=rX(o,t,n);if(o.length===s.length||a.length<=1){i[r]=o,++r;continue}a.sort((u,h)=>u.theta-h.theta);const c=o[0].z>=0;r=SL(i,r,o,a,1,0,c)}return i};ft.polygonsFromHierarchy=function(e,t,n,i,r,s){const o=[],a=[],c=new hc;c.enqueue(e);let u=l(s);for(;c.length!==0;){const h=c.dequeue();let d=h.positions;const p=h.holes;let g,_;if(i)for(_=d.length,g=0;g<_;g++)r.scaleToGeodeticSurface(d[g],d[g]);if(t||(d=Iu(d,m.equalsEpsilon,!0)),d.length<3)continue;let b=n(d);if(!l(b))continue;const x=[];let E=xi.computeWindingOrder2D(b);if(E===xl.CLOCKWISE&&(b.reverse(),d=d.slice().reverse()),u){u=!1;let D=[d];if(D=s(D,D),D.length>1){for(const L of D)c.enqueue(new w7(L,p));continue}}let C=d.slice();const w=l(p)?p.length:0,S=[];let v;for(g=0;g<w;g++){const D=p[g];let L=D.positions;if(i)for(_=L.length,v=0;v<_;++v)r.scaleToGeodeticSurface(L[v],L[v]);if(t||(L=Iu(L,m.equalsEpsilon,!0)),L.length<3)continue;const O=n(L);if(!l(O))continue;E=xi.computeWindingOrder2D(O),E===xl.CLOCKWISE&&(O.reverse(),L=L.slice().reverse()),S.push(L),x.push(C.length),C=C.concat(L),b=b.concat(O);let N=0;for(l(D.holes)&&(N=D.holes.length),v=0;v<N;v++)c.enqueue(D.holes[v])}o.push({outerRing:d,holes:S}),a.push({positions:C,positions2D:b,holes:x})}return{hierarchy:o,polygons:a}};const sX=new k,oX=new m,aX=new re,cX=new H;ft.computeBoundingRectangle=function(e,t,n,i,r){const s=re.fromAxisAngle(e,i,aX),o=H.fromQuaternion(s,cX);let a=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,u=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY;const d=n.length;for(let p=0;p<d;++p){const g=m.clone(n[p],oX);H.multiplyByVector(o,g,g);const _=t(g,sX);l(_)&&(a=Math.min(a,_.x),c=Math.max(c,_.x),u=Math.min(u,_.y),h=Math.max(h,_.y))}return r.x=a,r.y=u,r.width=c-a,r.height=h-u,r};ft.createGeometryFromPositions=function(e,t,n,i,r,s,o){let a=xi.triangulate(t.positions2D,t.holes);a.length<3&&(a=[0,1,2]);const c=t.positions,u=l(n),h=u?n.positions:void 0;if(r){const d=c.length,p=new Array(d*3);let g=0;for(let x=0;x<d;x++){const E=c[x];p[g++]=E.x,p[g++]=E.y,p[g++]=E.z}const _={attributes:{position:new Lt({componentDatatype:q.DOUBLE,componentsPerAttribute:3,values:p})},indices:a,primitiveType:Fe.TRIANGLES};u&&(_.attributes.st=new Lt({componentDatatype:q.FLOAT,componentsPerAttribute:2,values:k.packArray(h)}));const b=new Ht(_);return s.normal?$t.computeNormal(b):b}if(o===Co.GEODESIC)return xi.computeSubdivision(e,c,a,h,i);if(o===Co.RHUMB)return xi.computeRhumbLineSubdivision(e,c,a,h,i)};const EI=[],CI=[],lX=new m,uX=new m;ft.computeWallGeometry=function(e,t,n,i,r,s){let o,a,c,u,h,d,p,g,_,b=e.length,x=0,E=0;const C=l(t),w=C?t.positions:void 0;if(r)for(a=b*3*2,o=new Array(a*2),C&&(_=b*2*2,g=new Array(_*2)),c=0;c<b;c++)u=e[c],h=e[(c+1)%b],o[x]=o[x+a]=u.x,++x,o[x]=o[x+a]=u.y,++x,o[x]=o[x+a]=u.z,++x,o[x]=o[x+a]=h.x,++x,o[x]=o[x+a]=h.y,++x,o[x]=o[x+a]=h.z,++x,C&&(d=w[c],p=w[(c+1)%b],g[E]=g[E+_]=d.x,++E,g[E]=g[E+_]=d.y,++E,g[E]=g[E+_]=p.x,++E,g[E]=g[E+_]=p.y,++E);else{const O=R.chordLength(i,n.maximumRadius);let N=0;if(s===Co.GEODESIC)for(c=0;c<b;c++)N+=ft.subdivideLineCount(e[c],e[(c+1)%b],O);else if(s===Co.RHUMB)for(c=0;c<b;c++)N+=ft.subdivideRhumbLineCount(n,e[c],e[(c+1)%b],O);for(a=(N+b)*3,o=new Array(a*2),C&&(_=(N+b)*2,g=new Array(_*2)),c=0;c<b;c++){u=e[c],h=e[(c+1)%b];let B,U;C&&(d=w[c],p=w[(c+1)%b]),s===Co.GEODESIC?(B=ft.subdivideLine(u,h,O,CI),C&&(U=ft.subdivideTexcoordLine(d,p,u,h,O,EI))):s===Co.RHUMB&&(B=ft.subdivideRhumbLine(n,u,h,O,CI),C&&(U=ft.subdivideTexcoordRhumbLine(d,p,n,u,h,O,EI)));const V=B.length;for(let f=0;f<V;++f,++x)o[x]=B[f],o[x+a]=B[f];if(o[x]=h.x,o[x+a]=h.x,++x,o[x]=h.y,o[x+a]=h.y,++x,o[x]=h.z,o[x+a]=h.z,++x,C){const f=U.length;for(let I=0;I<f;++I,++E)g[E]=U[I],g[E+_]=U[I];g[E]=p.x,g[E+_]=p.x,++E,g[E]=p.y,g[E+_]=p.y,++E}}}b=o.length;const S=Ge.createTypedArray(b/3,b-e.length*6);let v=0;for(b/=6,c=0;c<b;c++){const O=c,N=O+1,B=O+b,U=B+1;u=m.fromArray(o,O*3,lX),h=m.fromArray(o,N*3,uX),!m.equalsEpsilon(u,h,R.EPSILON10,R.EPSILON10)&&(S[v++]=O,S[v++]=B,S[v++]=N,S[v++]=N,S[v++]=B,S[v++]=U)}const D={attributes:new Pu({position:new Lt({componentDatatype:q.DOUBLE,componentsPerAttribute:3,values:o})}),indices:S,primitiveType:Fe.TRIANGLES};return C&&(D.attributes.st=new Lt({componentDatatype:q.FLOAT,componentsPerAttribute:2,values:g})),new Ht(D)};function fX(e){const t=e.length,n=new Float64Array(t*3),i=Ge.createTypedArray(t,t*2);let r=0,s=0;for(let a=0;a<t;a++){const c=e[a];n[r++]=c.x,n[r++]=c.y,n[r++]=c.z,i[s++]=a,i[s++]=(a+1)%t}const o=new Pu({position:new Lt({componentDatatype:q.DOUBLE,componentsPerAttribute:3,values:n})});return new Ht({attributes:o,indices:i,primitiveType:Fe.LINES})}function Gs(e){e=T(e,T.EMPTY_OBJECT);const t=e.polygonHierarchy;y.defined("options.polygonHierarchy",t),this._polygonHierarchy=t,this._workerName="createCoplanarPolygonOutlineGeometry",this.packedLength=ft.computeHierarchyPackedLength(t,m)+1}Gs.fromPositions=function(e){e=T(e,T.EMPTY_OBJECT),y.defined("options.positions",e.positions);const t={polygonHierarchy:{positions:e.positions}};return new Gs(t)};Gs.pack=function(e,t,n){return y.typeOf.object("value",e),y.defined("array",t),n=T(n,0),n=ft.packPolygonHierarchy(e._polygonHierarchy,t,n,m),t[n]=e.packedLength,t};const hX={polygonHierarchy:{}};Gs.unpack=function(e,t,n){y.defined("array",e),t=T(t,0);const i=ft.unpackPolygonHierarchy(e,t,m);t=i.startingIndex,delete i.startingIndex;const r=e[t];return l(n)||(n=new Gs(hX)),n._polygonHierarchy=i,n.packedLength=r,n};Gs.createGeometry=function(e){const t=e._polygonHierarchy;let n=t.positions;if(n=Iu(n,m.equalsEpsilon,!0),n.length<3||!Jp.validOutline(n))return;const r=ft.polygonOutlinesFromHierarchy(t,!1);if(r.length===0)return;const s=[];for(let c=0;c<r.length;c++){const u=new Oo({geometry:fX(r[c])});s.push(u)}const o=$t.combineInstances(s)[0],a=ee.fromPoints(t.positions);return new Ht({attributes:o.attributes,indices:o.indices,primitiveType:o.primitiveType,boundingSphere:a})};function dX(e){const t=e._uSquared,n=e._ellipsoid.maximumRadius,i=e._ellipsoid.minimumRadius,r=(n-i)/n,s=Math.cos(e._startHeading),o=Math.sin(e._startHeading),a=(1-r)*Math.tan(e._start.latitude),c=1/Math.sqrt(1+a*a),u=c*a,h=Math.atan2(a,s),d=c*o,p=d*d,g=1-p,_=Math.sqrt(g),b=t/4,x=b*b,E=x*b,C=x*x,w=1+b-3*x/4+5*E/4-175*C/64,S=1-b+15*x/8-35*E/8,v=1-3*b+35*x/4,D=1-5*b,L=w*h-S*Math.sin(2*h)*b/2-v*Math.sin(4*h)*x/16-D*Math.sin(6*h)*E/48-Math.sin(8*h)*5*C/512,O=e._constants;O.a=n,O.b=i,O.f=r,O.cosineHeading=s,O.sineHeading=o,O.tanU=a,O.cosineU=c,O.sineU=u,O.sigma=h,O.sineAlpha=d,O.sineSquaredAlpha=p,O.cosineSquaredAlpha=g,O.cosineAlpha=_,O.u2Over4=b,O.u4Over16=x,O.u6Over64=E,O.u8Over256=C,O.a0=w,O.a1=S,O.a2=v,O.a3=D,O.distanceRatio=L}function pX(e,t){return e*t*(4+e*(4-3*t))/16}function vL(e,t,n,i,r,s,o){const a=pX(e,n);return(1-a)*e*t*(i+a*r*(o+a*s*(2*o*o-1)))}function mX(e,t,n,i,r,s,o){const a=(t-n)/t,c=s-i,u=Math.atan((1-a)*Math.tan(r)),h=Math.atan((1-a)*Math.tan(o)),d=Math.cos(u),p=Math.sin(u),g=Math.cos(h),_=Math.sin(h),b=d*g,x=d*_,E=p*_,C=p*g;let w=c,S=R.TWO_PI,v=Math.cos(w),D=Math.sin(w),L,O,N,B,U;do{v=Math.cos(w),D=Math.sin(w);const $=x-C*v;N=Math.sqrt(g*g*D*D+$*$),O=E+b*v,L=Math.atan2(N,O);let ne;N===0?(ne=0,B=1):(ne=b*D/N,B=1-ne*ne),S=w,U=O-2*E/B,isFinite(U)||(U=0),w=c+vL(a,ne,B,L,N,O,U)}while(Math.abs(w-S)>R.EPSILON12);const V=B*(t*t-n*n)/(n*n),f=1+V*(4096+V*(V*(320-175*V)-768))/16384,I=V*(256+V*(V*(74-47*V)-128))/1024,F=U*U,G=I*N*(U+I*(O*(2*F-1)-I*U*(4*N*N-3)*(4*F-3)/6)/4),W=n*f*(L-G),X=Math.atan2(g*D,x-C*v),Z=Math.atan2(d*D,x*v-C);e._distance=W,e._startHeading=X,e._endHeading=Z,e._uSquared=V}const gX=new m,D0=new m;function IL(e,t,n,i){const r=m.normalize(i.cartographicToCartesian(t,D0),gX),s=m.normalize(i.cartographicToCartesian(n,D0),D0);y.typeOf.number.greaterThanOrEquals("value",Math.abs(Math.abs(m.angleBetween(r,s))-Math.PI),.0125),mX(e,i.maximumRadius,i.minimumRadius,t.longitude,t.latitude,n.longitude,n.latitude),e._start=oe.clone(t,e._start),e._end=oe.clone(n,e._end),e._start.height=0,e._end.height=0,dX(e)}function Qp(e,t,n){const i=T(n,fe.default);this._ellipsoid=i,this._start=new oe,this._end=new oe,this._constants={},this._startHeading=void 0,this._endHeading=void 0,this._distance=void 0,this._uSquared=void 0,l(e)&&l(t)&&IL(this,e,t,i)}Object.defineProperties(Qp.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},surfaceDistance:{get:function(){return y.defined("distance",this._distance),this._distance}},start:{get:function(){return this._start}},end:{get:function(){return this._end}},startHeading:{get:function(){return y.defined("distance",this._distance),this._startHeading}},endHeading:{get:function(){return y.defined("distance",this._distance),this._endHeading}}});Qp.prototype.setEndPoints=function(e,t){y.defined("start",e),y.defined("end",t),IL(this,e,t,this._ellipsoid)};Qp.prototype.interpolateUsingFraction=function(e,t){return this.interpolateUsingSurfaceDistance(this._distance*e,t)};Qp.prototype.interpolateUsingSurfaceDistance=function(e,t){y.defined("distance",this._distance);const n=this._constants,i=n.distanceRatio+e/n.b,r=Math.cos(2*i),s=Math.cos(4*i),o=Math.cos(6*i),a=Math.sin(2*i),c=Math.sin(4*i),u=Math.sin(6*i),h=Math.sin(8*i),d=i*i,p=i*d,g=n.u8Over256,_=n.u2Over4,b=n.u6Over64,x=n.u4Over16;let E=2*p*g*r/3+i*(1-_+7*x/4-15*b/4+579*g/64-(x-15*b/4+187*g/16)*r-(5*b/4-115*g/16)*s-29*g*o/16)+(_/2-x+71*b/32-85*g/16)*a+(5*x/16-5*b/4+383*g/96)*c-d*((b-11*g/2)*a+5*g*c/2)+(29*b/96-29*g/16)*u+539*g*h/1536;const C=Math.asin(Math.sin(E)*n.cosineAlpha),w=Math.atan(n.a/n.b*Math.tan(C));E=E-n.sigma;const S=Math.cos(2*n.sigma+E),v=Math.sin(E),D=Math.cos(E),L=n.cosineU*D,O=n.sineU*v,B=Math.atan2(v*n.sineHeading,L-O*n.cosineHeading)-vL(n.f,n.sineAlpha,n.cosineSquaredAlpha,E,v,D,S);return l(t)?(t.longitude=this._start.longitude+B,t.latitude=w,t.height=0,t):new oe(this._start.longitude+B,w,0)};const Ar={};Ar.numberOfPoints=function(e,t,n){const i=m.distance(e,t);return Math.ceil(i/n)};Ar.numberOfPointsRhumbLine=function(e,t,n){const i=Math.pow(e.longitude-t.longitude,2)+Math.pow(e.latitude-t.latitude,2);return Math.max(1,Math.ceil(Math.sqrt(i/(n*n))))};const _X=new oe;Ar.extractHeights=function(e,t){const n=e.length,i=new Array(n);for(let r=0;r<n;r++){const s=e[r];i[r]=t.cartesianToCartographic(s,_X).height}return i};const yX=new P,bX=new m,wI=new m,TX=new Ve(m.UNIT_X,0),AI=new m,xX=new Ve(m.UNIT_X,0),EX=new m,CX=new m,ew=[];function OL(e,t,n){const i=ew;i.length=e;let r;if(t===n){for(r=0;r<e;r++)i[r]=t;return i}const o=(n-t)/e;for(r=0;r<e;r++){const a=t+r*o;i[r]=a}return i}const qy=new oe,q_=new oe,El=new m,tw=new m,wX=new m,M0=new Qp;let dd=new Cr;function AX(e,t,n,i,r,s,o,a){const c=i.scaleToGeodeticSurface(e,tw),u=i.scaleToGeodeticSurface(t,wX),h=Ar.numberOfPoints(e,t,n),d=i.cartesianToCartographic(c,qy),p=i.cartesianToCartographic(u,q_),g=OL(h,r,s);M0.setEndPoints(d,p);const _=M0.surfaceDistance/h;let b=a;d.height=r;let x=i.cartographicToCartesian(d,El);m.pack(x,o,b),b+=3;for(let E=1;E<h;E++){const C=M0.interpolateUsingSurfaceDistance(E*_,q_);C.height=g[E],x=i.cartographicToCartesian(C,El),m.pack(x,o,b),b+=3}return b}function SX(e,t,n,i,r,s,o,a){const c=i.cartesianToCartographic(e,qy),u=i.cartesianToCartographic(t,q_),h=Ar.numberOfPointsRhumbLine(c,u,n);c.height=0,u.height=0;const d=OL(h,r,s);dd.ellipsoid.equals(i)||(dd=new Cr(void 0,void 0,i)),dd.setEndPoints(c,u);const p=dd.surfaceDistance/h;let g=a;c.height=r;let _=i.cartographicToCartesian(c,El);m.pack(_,o,g),g+=3;for(let b=1;b<h;b++){const x=dd.interpolateUsingSurfaceDistance(b*p,q_);x.height=d[b],_=i.cartographicToCartesian(x,El),m.pack(_,o,g),g+=3}return g}Ar.wrapLongitude=function(e,t){const n=[],i=[];if(l(e)&&e.length>0){t=T(t,P.IDENTITY);const r=P.inverseTransformation(t,yX),s=P.multiplyByPoint(r,m.ZERO,bX),o=m.normalize(P.multiplyByPointAsVector(r,m.UNIT_Y,wI),wI),a=Ve.fromPointNormal(s,o,TX),c=m.normalize(P.multiplyByPointAsVector(r,m.UNIT_X,AI),AI),u=Ve.fromPointNormal(s,c,xX);let h=1;n.push(m.clone(e[0]));let d=n[0];const p=e.length;for(let g=1;g<p;++g){const _=e[g];if(Ve.getPointDistance(u,d)<0||Ve.getPointDistance(u,_)<0){const b=Ct.lineSegmentPlane(d,_,a,EX);if(l(b)){const x=m.multiplyByScalar(o,5e-9,CX);Ve.getPointDistance(a,d)<0&&m.negate(x,x),n.push(m.add(b,x,new m)),i.push(h+1),m.negate(x,x),n.push(m.add(b,x,new m)),h=1}}n.push(m.clone(e[g])),h++,d=_}i.push(h)}return{positions:n,lengths:i}};Ar.generateArc=function(e){l(e)||(e={});const t=e.positions;if(!l(t))throw new A("options.positions is required.");const n=t.length,i=T(e.ellipsoid,fe.default);let r=T(e.height,0);const s=Array.isArray(r);if(n<1)return[];if(n===1){const b=i.scaleToGeodeticSurface(t[0],tw);if(r=s?r[0]:r,r!==0){const x=i.geodeticSurfaceNormal(b,El);m.multiplyByScalar(x,r,x),m.add(b,x,b)}return[b.x,b.y,b.z]}let o=e.minDistance;if(!l(o)){const b=T(e.granularity,R.RADIANS_PER_DEGREE);o=R.chordLength(b,i.maximumRadius)}let a=0,c;for(c=0;c<n-1;c++)a+=Ar.numberOfPoints(t[c],t[c+1],o);const u=(a+1)*3,h=new Array(u);let d=0;for(c=0;c<n-1;c++){const b=t[c],x=t[c+1],E=s?r[c]:r,C=s?r[c+1]:r;d=AX(b,x,o,i,E,C,h,d)}ew.length=0;const p=t[n-1],g=i.cartesianToCartographic(p,qy);g.height=s?r[n-1]:r;const _=i.cartographicToCartesian(g,El);return m.pack(_,h,u-3),h};const SI=new oe,vX=new oe;Ar.generateRhumbArc=function(e){l(e)||(e={});const t=e.positions;if(!l(t))throw new A("options.positions is required.");const n=t.length,i=T(e.ellipsoid,fe.default);let r=T(e.height,0);const s=Array.isArray(r);if(n<1)return[];if(n===1){const E=i.scaleToGeodeticSurface(t[0],tw);if(r=s?r[0]:r,r!==0){const C=i.geodeticSurfaceNormal(E,El);m.multiplyByScalar(C,r,C),m.add(E,C,E)}return[E.x,E.y,E.z]}const o=T(e.granularity,R.RADIANS_PER_DEGREE);let a=0,c,u=i.cartesianToCartographic(t[0],SI),h;for(c=0;c<n-1;c++)h=i.cartesianToCartographic(t[c+1],vX),a+=Ar.numberOfPointsRhumbLine(u,h,o),u=oe.clone(h,SI);const d=(a+1)*3,p=new Array(d);let g=0;for(c=0;c<n-1;c++){const E=t[c],C=t[c+1],w=s?r[c]:r,S=s?r[c+1]:r;g=SX(E,C,o,i,w,S,p,g)}ew.length=0;const _=t[n-1],b=i.cartesianToCartographic(_,qy);b.height=s?r[n-1]:r;const x=i.cartographicToCartesian(b,El);return m.pack(x,p,d-3),p};Ar.generateCartesianArc=function(e){const t=Ar.generateArc(e),n=t.length/3,i=new Array(n);for(let r=0;r<n;r++)i[r]=m.unpack(t,r*3);return i};Ar.generateCartesianRhumbArc=function(e){const t=Ar.generateRhumbArc(e),n=t.length/3,i=new Array(n);for(let r=0;r<n;r++)i[r]=m.unpack(t,r*3);return i};const vI={};function kr(e,t){if(!l(e))throw new A("identifier is required.");l(vI[e])||(vI[e]=!0,console.warn(T(t,e)))}kr.geometryOutlines="Entity geometry outlines are unsupported on terrain. Outlines will be disabled. To enable outlines, disable geometry terrain clamping by explicitly setting height to 0.";kr.geometryZIndex="Entity geometry with zIndex are unsupported when height or extrudedHeight are defined.  zIndex will be ignored";kr.geometryHeightReference="Entity corridor, ellipse, polygon or rectangle with heightReference must also have a defined height.  heightReference will be ignored";kr.geometryExtrudedHeightReference="Entity corridor, ellipse, polygon or rectangle with extrudedHeightReference must also have a defined extrudedHeight.  extrudedHeightReference will be ignored";function br(e){this.planes=T(e,[])}const Ap=[new m,new m,new m];m.clone(m.UNIT_X,Ap[0]);m.clone(m.UNIT_Y,Ap[1]);m.clone(m.UNIT_Z,Ap[2]);const Pc=new m,IX=new m,RL=new Ve(new m(1,0,0),0);br.fromBoundingSphere=function(e,t){if(!l(e))throw new A("boundingSphere is required.");l(t)||(t=new br);const n=Ap.length,i=t.planes;i.length=2*n;const r=e.center,s=e.radius;let o=0;for(let a=0;a<n;++a){const c=Ap[a];let u=i[o],h=i[o+1];l(u)||(u=i[o]=new Y),l(h)||(h=i[o+1]=new Y),m.multiplyByScalar(c,-s,Pc),m.add(r,Pc,Pc),u.x=c.x,u.y=c.y,u.z=c.z,u.w=-m.dot(c,Pc),m.multiplyByScalar(c,s,Pc),m.add(r,Pc,Pc),h.x=-c.x,h.y=-c.y,h.z=-c.z,h.w=-m.dot(m.negate(c,IX),Pc),o+=2}return t};br.prototype.computeVisibility=function(e){if(!l(e))throw new A("boundingVolume is required.");const t=this.planes;let n=!1;for(let i=0,r=t.length;i<r;++i){const s=e.intersectPlane(Ve.fromCartesian4(t[i],RL));if(s===ut.OUTSIDE)return ut.OUTSIDE;s===ut.INTERSECTING&&(n=!0)}return n?ut.INTERSECTING:ut.INSIDE};br.prototype.computeVisibilityWithPlaneMask=function(e,t){if(!l(e))throw new A("boundingVolume is required.");if(!l(t))throw new A("parentPlaneMask is required.");if(t===br.MASK_OUTSIDE||t===br.MASK_INSIDE)return t;let n=br.MASK_INSIDE;const i=this.planes;for(let r=0,s=i.length;r<s;++r){const o=r<31?1<<r:0;if(r<31&&!(t&o))continue;const a=e.intersectPlane(Ve.fromCartesian4(i[r],RL));if(a===ut.OUTSIDE)return br.MASK_OUTSIDE;a===ut.INTERSECTING&&(n|=o)}return n};br.MASK_OUTSIDE=4294967295;br.MASK_INSIDE=0;br.MASK_INDETERMINATE=2147483647;function $n(e,t){e=T(e,0),this._near=e,t=T(t,Number.MAX_VALUE),this._far=t}Object.defineProperties($n.prototype,{near:{get:function(){return this._near},set:function(e){this._near=e}},far:{get:function(){return this._far},set:function(e){this._far=e}}});$n.packedLength=2;$n.pack=function(e,t,n){if(!l(e))throw new A("value is required");if(!l(t))throw new A("array is required");return n=T(n,0),t[n++]=e.near,t[n]=e.far,t};$n.unpack=function(e,t,n){if(!l(e))throw new A("array is required");return t=T(t,0),l(n)||(n=new $n),n.near=e[t++],n.far=e[t],n};$n.equals=function(e,t){return e===t||l(e)&&l(t)&&e.near===t.near&&e.far===t.far};$n.clone=function(e,t){if(l(e))return l(t)||(t=new $n),t.near=e.near,t.far=e.far,t};$n.prototype.clone=function(e){return $n.clone(this,e)};$n.prototype.equals=function(e){return $n.equals(this,e)};function em(){this.head=void 0,this.tail=void 0,this._length=0}Object.defineProperties(em.prototype,{length:{get:function(){return this._length}}});function OX(e,t,n){this.item=e,this.previous=t,this.next=n}em.prototype.add=function(e){const t=new OX(e,this.tail,void 0);return l(this.tail)?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t};function DL(e,t){l(t.previous)&&l(t.next)?(t.previous.next=t.next,t.next.previous=t.previous):l(t.previous)?(t.previous.next=void 0,e.tail=t.previous):l(t.next)?(t.next.previous=void 0,e.head=t.next):(e.head=void 0,e.tail=void 0),t.next=void 0,t.previous=void 0}em.prototype.remove=function(e){l(e)&&(DL(this,e),--this._length)};em.prototype.splice=function(e,t){if(e===t)return;DL(this,t);const n=e.next;e.next=t,this.tail===e?this.tail=t:n.previous=t,t.next=n,t.previous=e};const RX=new m(1,1,1),sg=Math.cos,og=Math.sin;function no(e){e=T(e,T.EMPTY_OBJECT);const t=T(e.radii,RX),n=T(e.innerRadii,t),i=T(e.minimumClock,0),r=T(e.maximumClock,R.TWO_PI),s=T(e.minimumCone,0),o=T(e.maximumCone,R.PI),a=Math.round(T(e.stackPartitions,10)),c=Math.round(T(e.slicePartitions,8)),u=Math.round(T(e.subdivisions,128));if(a<1)throw new A("options.stackPartitions cannot be less than 1");if(c<0)throw new A("options.slicePartitions cannot be less than 0");if(u<0)throw new A("options.subdivisions must be greater than or equal to zero.");if(l(e.offsetAttribute)&&e.offsetAttribute===Js.TOP)throw new A("GeometryOffsetAttribute.TOP is not a supported options.offsetAttribute for this geometry.");this._radii=m.clone(t),this._innerRadii=m.clone(n),this._minimumClock=i,this._maximumClock=r,this._minimumCone=s,this._maximumCone=o,this._stackPartitions=a,this._slicePartitions=c,this._subdivisions=u,this._offsetAttribute=e.offsetAttribute,this._workerName="createEllipsoidOutlineGeometry"}no.packedLength=2*m.packedLength+8;no.pack=function(e,t,n){if(!l(e))throw new A("value is required");if(!l(t))throw new A("array is required");return n=T(n,0),m.pack(e._radii,t,n),n+=m.packedLength,m.pack(e._innerRadii,t,n),n+=m.packedLength,t[n++]=e._minimumClock,t[n++]=e._maximumClock,t[n++]=e._minimumCone,t[n++]=e._maximumCone,t[n++]=e._stackPartitions,t[n++]=e._slicePartitions,t[n++]=e._subdivisions,t[n]=T(e._offsetAttribute,-1),t};const ML=new m,LL=new m,Fa={radii:ML,innerRadii:LL,minimumClock:void 0,maximumClock:void 0,minimumCone:void 0,maximumCone:void 0,stackPartitions:void 0,slicePartitions:void 0,subdivisions:void 0,offsetAttribute:void 0};no.unpack=function(e,t,n){if(!l(e))throw new A("array is required");t=T(t,0);const i=m.unpack(e,t,ML);t+=m.packedLength;const r=m.unpack(e,t,LL);t+=m.packedLength;const s=e[t++],o=e[t++],a=e[t++],c=e[t++],u=e[t++],h=e[t++],d=e[t++],p=e[t];return l(n)?(n._radii=m.clone(i,n._radii),n._innerRadii=m.clone(r,n._innerRadii),n._minimumClock=s,n._maximumClock=o,n._minimumCone=a,n._maximumCone=c,n._stackPartitions=u,n._slicePartitions=h,n._subdivisions=d,n._offsetAttribute=p===-1?void 0:p,n):(Fa.minimumClock=s,Fa.maximumClock=o,Fa.minimumCone=a,Fa.maximumCone=c,Fa.stackPartitions=u,Fa.slicePartitions=h,Fa.subdivisions=d,Fa.offsetAttribute=p===-1?void 0:p,new no(Fa))};no.createGeometry=function(e){const t=e._radii;if(t.x<=0||t.y<=0||t.z<=0)return;const n=e._innerRadii;if(n.x<=0||n.y<=0||n.z<=0)return;const i=e._minimumClock,r=e._maximumClock,s=e._minimumCone,o=e._maximumCone,a=e._subdivisions,c=fe.fromCartesian3(t);let u=e._slicePartitions+1,h=e._stackPartitions+1;u=Math.round(u*Math.abs(r-i)/R.TWO_PI),h=Math.round(h*Math.abs(o-s)/R.PI),u<2&&(u=2),h<2&&(h=2);let d=0,p=1;const g=n.x!==t.x||n.y!==t.y||n.z!==t.z;let _=!1,b=!1;g&&(p=2,s>0&&(_=!0,d+=u),o<Math.PI&&(b=!0,d+=u));const x=a*p*(h+u),E=new Float64Array(x*3),C=2*(x+d-(u+h)*p),w=Ge.createTypedArray(x,C);let S,v,D,L,O=0;const N=new Array(h),B=new Array(h);for(S=0;S<h;S++)L=s+S*(o-s)/(h-1),N[S]=og(L),B[S]=sg(L);const U=new Array(a),V=new Array(a);for(S=0;S<a;S++)D=i+S*(r-i)/(a-1),U[S]=og(D),V[S]=sg(D);for(S=0;S<h;S++)for(v=0;v<a;v++)E[O++]=t.x*N[S]*V[v],E[O++]=t.y*N[S]*U[v],E[O++]=t.z*B[S];if(g)for(S=0;S<h;S++)for(v=0;v<a;v++)E[O++]=n.x*N[S]*V[v],E[O++]=n.y*N[S]*U[v],E[O++]=n.z*B[S];for(N.length=a,B.length=a,S=0;S<a;S++)L=s+S*(o-s)/(a-1),N[S]=og(L),B[S]=sg(L);for(U.length=u,V.length=u,S=0;S<u;S++)D=i+S*(r-i)/(u-1),U[S]=og(D),V[S]=sg(D);for(S=0;S<a;S++)for(v=0;v<u;v++)E[O++]=t.x*N[S]*V[v],E[O++]=t.y*N[S]*U[v],E[O++]=t.z*B[S];if(g)for(S=0;S<a;S++)for(v=0;v<u;v++)E[O++]=n.x*N[S]*V[v],E[O++]=n.y*N[S]*U[v],E[O++]=n.z*B[S];for(O=0,S=0;S<h*p;S++){const F=S*a;for(v=0;v<a-1;v++)w[O++]=F+v,w[O++]=F+v+1}let f=h*a*p;for(S=0;S<u;S++)for(v=0;v<a-1;v++)w[O++]=f+S+v*u,w[O++]=f+S+(v+1)*u;if(g)for(f=h*a*p+u*a,S=0;S<u;S++)for(v=0;v<a-1;v++)w[O++]=f+S+v*u,w[O++]=f+S+(v+1)*u;if(g){let F=h*a*p,G=F+a*u;if(_)for(S=0;S<u;S++)w[O++]=F+S,w[O++]=G+S;if(b)for(F+=a*u-u,G+=a*u-u,S=0;S<u;S++)w[O++]=F+S,w[O++]=G+S}const I=new Pu({position:new Lt({componentDatatype:q.DOUBLE,componentsPerAttribute:3,values:E})});if(l(e._offsetAttribute)){const F=E.length,G=e._offsetAttribute===Js.NONE?0:1,W=new Uint8Array(F/3).fill(G);I.applyOffset=new Lt({componentDatatype:q.UNSIGNED_BYTE,componentsPerAttribute:1,values:W})}return new Ht({attributes:I,indices:w,primitiveType:Fe.LINES,boundingSphere:ee.fromEllipsoid(c),offsetAttribute:e._offsetAttribute})};function Lo(e){e=T(e,T.EMPTY_OBJECT),this.left=e.left,this._left=void 0,this.right=e.right,this._right=void 0,this.top=e.top,this._top=void 0,this.bottom=e.bottom,this._bottom=void 0,this.near=T(e.near,1),this._near=this.near,this.far=T(e.far,5e8),this._far=this.far,this._cullingVolume=new br,this._orthographicMatrix=new P}function PL(e){if(!l(e.right)||!l(e.left)||!l(e.top)||!l(e.bottom)||!l(e.near)||!l(e.far))throw new A("right, left, top, bottom, near, or far parameters are not set.");if(e.top!==e._top||e.bottom!==e._bottom||e.left!==e._left||e.right!==e._right||e.near!==e._near||e.far!==e._far){if(e.left>e.right)throw new A("right must be greater than left.");if(e.bottom>e.top)throw new A("top must be greater than bottom.");if(e.near<=0||e.near>e.far)throw new A("near must be greater than zero and less than far.");e._left=e.left,e._right=e.right,e._top=e.top,e._bottom=e.bottom,e._near=e.near,e._far=e.far,e._orthographicMatrix=P.computeOrthographicOffCenter(e.left,e.right,e.bottom,e.top,e.near,e.far,e._orthographicMatrix)}}Object.defineProperties(Lo.prototype,{projectionMatrix:{get:function(){return PL(this),this._orthographicMatrix}}});const DX=new m,MX=new m,LX=new m,L0=new m;Lo.prototype.computeCullingVolume=function(e,t,n){if(!l(e))throw new A("position is required.");if(!l(t))throw new A("direction is required.");if(!l(n))throw new A("up is required.");const i=this._cullingVolume.planes,r=this.top,s=this.bottom,o=this.right,a=this.left,c=this.near,u=this.far,h=m.cross(t,n,DX);m.normalize(h,h);const d=MX;m.multiplyByScalar(t,c,d),m.add(e,d,d);const p=LX;m.multiplyByScalar(h,a,p),m.add(d,p,p);let g=i[0];return l(g)||(g=i[0]=new Y),g.x=h.x,g.y=h.y,g.z=h.z,g.w=-m.dot(h,p),m.multiplyByScalar(h,o,p),m.add(d,p,p),g=i[1],l(g)||(g=i[1]=new Y),g.x=-h.x,g.y=-h.y,g.z=-h.z,g.w=-m.dot(m.negate(h,L0),p),m.multiplyByScalar(n,s,p),m.add(d,p,p),g=i[2],l(g)||(g=i[2]=new Y),g.x=n.x,g.y=n.y,g.z=n.z,g.w=-m.dot(n,p),m.multiplyByScalar(n,r,p),m.add(d,p,p),g=i[3],l(g)||(g=i[3]=new Y),g.x=-n.x,g.y=-n.y,g.z=-n.z,g.w=-m.dot(m.negate(n,L0),p),g=i[4],l(g)||(g=i[4]=new Y),g.x=t.x,g.y=t.y,g.z=t.z,g.w=-m.dot(t,d),m.multiplyByScalar(t,u,p),m.add(e,p,p),g=i[5],l(g)||(g=i[5]=new Y),g.x=-t.x,g.y=-t.y,g.z=-t.z,g.w=-m.dot(m.negate(t,L0),p),this._cullingVolume};Lo.prototype.getPixelDimensions=function(e,t,n,i,r){if(PL(this),!l(e)||!l(t))throw new A("Both drawingBufferWidth and drawingBufferHeight are required.");if(e<=0)throw new A("drawingBufferWidth must be greater than zero.");if(t<=0)throw new A("drawingBufferHeight must be greater than zero.");if(!l(n))throw new A("distance is required.");if(!l(i))throw new A("pixelRatio is required.");if(i<=0)throw new A("pixelRatio must be greater than zero.");if(!l(r))throw new A("A result object is required.");const s=this.right-this.left,o=this.top-this.bottom,a=i*s/e,c=i*o/t;return r.x=a,r.y=c,r};Lo.prototype.clone=function(e){return l(e)||(e=new Lo),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e._left=void 0,e._right=void 0,e._top=void 0,e._bottom=void 0,e._near=void 0,e._far=void 0,e};Lo.prototype.equals=function(e){return l(e)&&e instanceof Lo&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far};Lo.prototype.equalsEpsilon=function(e,t,n){return e===this||l(e)&&e instanceof Lo&&R.equalsEpsilon(this.right,e.right,t,n)&&R.equalsEpsilon(this.left,e.left,t,n)&&R.equalsEpsilon(this.top,e.top,t,n)&&R.equalsEpsilon(this.bottom,e.bottom,t,n)&&R.equalsEpsilon(this.near,e.near,t,n)&&R.equalsEpsilon(this.far,e.far,t,n)};function Sr(e){e=T(e,T.EMPTY_OBJECT),this._offCenterFrustum=new Lo,this.width=e.width,this._width=void 0,this.aspectRatio=e.aspectRatio,this._aspectRatio=void 0,this.near=T(e.near,1),this._near=this.near,this.far=T(e.far,5e8),this._far=this.far}Sr.packedLength=4;Sr.pack=function(e,t,n){return y.typeOf.object("value",e),y.defined("array",t),n=T(n,0),t[n++]=e.width,t[n++]=e.aspectRatio,t[n++]=e.near,t[n]=e.far,t};Sr.unpack=function(e,t,n){return y.defined("array",e),t=T(t,0),l(n)||(n=new Sr),n.width=e[t++],n.aspectRatio=e[t++],n.near=e[t++],n.far=e[t],n};function Cl(e){if(!l(e.width)||!l(e.aspectRatio)||!l(e.near)||!l(e.far))throw new A("width, aspectRatio, near, or far parameters are not set.");const t=e._offCenterFrustum;if(e.width!==e._width||e.aspectRatio!==e._aspectRatio||e.near!==e._near||e.far!==e._far){if(e.aspectRatio<0)throw new A("aspectRatio must be positive.");if(e.near<0||e.near>e.far)throw new A("near must be greater than zero and less than far.");e._aspectRatio=e.aspectRatio,e._width=e.width,e._near=e.near,e._far=e.far;const n=1/e.aspectRatio;t.right=e.width*.5,t.left=-t.right,t.top=n*t.right,t.bottom=-t.top,t.near=e.near,t.far=e.far}}Object.defineProperties(Sr.prototype,{projectionMatrix:{get:function(){return Cl(this),this._offCenterFrustum.projectionMatrix}},offCenterFrustum:{get:function(){return Cl(this),this._offCenterFrustum}}});Sr.prototype.computeCullingVolume=function(e,t,n){return Cl(this),this._offCenterFrustum.computeCullingVolume(e,t,n)};Sr.prototype.getPixelDimensions=function(e,t,n,i,r){return Cl(this),this._offCenterFrustum.getPixelDimensions(e,t,n,i,r)};Sr.prototype.clone=function(e){return l(e)||(e=new Sr),e.aspectRatio=this.aspectRatio,e.width=this.width,e.near=this.near,e.far=this.far,e._aspectRatio=void 0,e._width=void 0,e._near=void 0,e._far=void 0,this._offCenterFrustum.clone(e._offCenterFrustum),e};Sr.prototype.equals=function(e){return!l(e)||!(e instanceof Sr)?!1:(Cl(this),Cl(e),this.width===e.width&&this.aspectRatio===e.aspectRatio&&this._offCenterFrustum.equals(e._offCenterFrustum))};Sr.prototype.equalsEpsilon=function(e,t,n){return!l(e)||!(e instanceof Sr)?!1:(Cl(this),Cl(e),R.equalsEpsilon(this.width,e.width,t,n)&&R.equalsEpsilon(this.aspectRatio,e.aspectRatio,t,n)&&this._offCenterFrustum.equalsEpsilon(e._offCenterFrustum,t,n))};const W_={};W_.encode2D=function(e,t,n){const i=Math.pow(2,e);if(y.typeOf.number("level",e),y.typeOf.number("x",t),y.typeOf.number("y",n),e<1)throw new A("Hilbert level cannot be less than 1.");if(t<0||t>=i||n<0||n>=i)throw new A("Invalid coordinates for given level.");const r={x:t,y:n};let s,o,a,c=BigInt(0);for(a=i/2;a>0;a/=2)s=(r.x&a)>0?1:0,o=(r.y&a)>0?1:0,c+=BigInt((3*s^o)*a*a),NL(i,r,s,o);return c};W_.decode2D=function(e,t){if(y.typeOf.number("level",e),y.typeOf.bigint("index",t),e<1)throw new A("Hilbert level cannot be less than 1.");if(t<BigInt(0)||t>=BigInt(Math.pow(4,e)))throw new A("Hilbert index exceeds valid maximum for given level.");const n=Math.pow(2,e),i={x:0,y:0};let r,s,o,a;for(o=1,a=t;o<n;o*=2)r=1&Number(a/BigInt(2)),s=1&Number(a^BigInt(r)),NL(o,i,r,s),i.x+=o*r,i.y+=o*s,a/=BigInt(4);return[i.x,i.y]};function NL(e,t,n,i){if(i!==0)return;n===1&&(t.x=e-1-t.x,t.y=e-1-t.y);const r=t.x;t.x=t.y,t.y=r}const PX={STEP:0,LINEAR:1,CUBICSPLINE:2},Gf=Object.freeze(PX);function Xa(){}Xa._transcodeTaskProcessor=new Dn("transcodeKTX2",Number.POSITIVE_INFINITY);Xa._readyPromise=void 0;function NX(){const e=Xa._transcodeTaskProcessor.initWebAssemblyModule({wasmBinaryFile:"ThirdParty/basis_transcoder.wasm"}).then(function(t){if(t)return Xa._transcodeTaskProcessor;throw new te("KTX2 transcoder could not be initialized.")});Xa._readyPromise=e}Xa.transcode=function(e,t){return y.defined("supportedTargetFormats",t),l(Xa._readyPromise)||NX(),Xa._readyPromise.then(function(n){let i;if(e instanceof ArrayBuffer){const r=new Uint8Array(e);return i={supportedTargetFormats:t,ktx2Buffer:r},n.scheduleTask(i,[e])}return i={supportedTargetFormats:t,ktx2Buffer:e},n.scheduleTask(i,[e.buffer])}).then(function(n){const i=n.length,r=Object.keys(n[0]),s=r.length;let o;for(o=0;o<i;o++){const a=n[o];for(let c=0;c<s;c++){const u=a[r[c]];a[r[c]]=new lh(u.internalFormat,u.datatype,u.width,u.height,u.levelBuffer)}}if(s===1){for(o=0;o<i;++o)n[o]=n[o][r[0]];i===1&&(n=n[0])}return n}).catch(function(n){throw n})};function cr(e){e=T(e,0),this._array=new Array(e),this._length=e}Object.defineProperties(cr.prototype,{length:{get:function(){return this._length},set:function(e){y.typeOf.number.greaterThanOrEquals("length",e,0);const t=this._array,n=this._length;if(e<n)for(let i=e;i<n;++i)t[i]=void 0;else e>t.length&&(t.length=e);this._length=e}},values:{get:function(){return this._array}}});cr.prototype.get=function(e){return y.typeOf.number.lessThan("index",e,this._array.length),this._array[e]};cr.prototype.set=function(e,t){y.typeOf.number("index",e),e>=this._length&&(this.length=e+1),this._array[e]=t};cr.prototype.peek=function(){return this._array[this._length-1]};cr.prototype.push=function(e){const t=this.length++;this._array[t]=e};cr.prototype.pop=function(){if(this._length===0)return;const e=this._array[this._length-1];return--this.length,e};cr.prototype.reserve=function(e){y.typeOf.number.greaterThanOrEquals("length",e,0),e>this._array.length&&(this._array.length=e)};cr.prototype.resize=function(e){y.typeOf.number.greaterThanOrEquals("length",e,0),this.length=e};cr.prototype.trim=function(e){e=T(e,this._length),this._array.length=e};const wl={};function II(e){return e=(e^e<<8)&16711935,e=(e^e<<4)&252645135,e=(e^e<<2)&858993459,e=(e^e<<1)&1431655765,e}function P0(e){return e=(e^e<<16)&50331903,e=(e^e<<8)&50393103,e=(e^e<<4)&51130563,e=(e^e<<2)&153391689,e}function OI(e){return e&=1431655765,e=(e^e>>1)&858993459,e=(e^e>>2)&252645135,e=(e^e>>4)&16711935,e=(e^e>>8)&65535,e}function N0(e){return e&=153391689,e=(e^e>>2)&51130563,e=(e^e>>4)&50393103,e=(e^e>>8)&4278190335,e=(e^e>>16)&1023,e}wl.encode2D=function(e,t){if(y.typeOf.number("x",e),y.typeOf.number("y",t),e<0||e>65535||t<0||t>65535)throw new A("inputs must be 16-bit unsigned integers");return(II(e)|II(t)<<1)>>>0};wl.decode2D=function(e,t){if(y.typeOf.number("mortonIndex",e),e<0||e>4294967295)throw new A("input must be a 32-bit unsigned integer");return l(t)||(t=new Array(2)),t[0]=OI(e),t[1]=OI(e>>1),t};wl.encode3D=function(e,t,n){if(y.typeOf.number("x",e),y.typeOf.number("y",t),y.typeOf.number("z",n),e<0||e>1023||t<0||t>1023||n<0||n>1023)throw new A("inputs must be 10-bit unsigned integers");return P0(e)|P0(t)<<1|P0(n)<<2};wl.decode3D=function(e,t){if(y.typeOf.number("mortonIndex",e),e<0||e>1073741823)throw new A("input must be a 30-bit unsigned integer");return l(t)||(t=new Array(3)),t[0]=N0(e),t[1]=N0(e>>1),t[2]=N0(e>>2),t};function Bt(e,t,n,i){this.near=T(e,0),this.nearValue=T(t,0),this.far=T(n,1),this.farValue=T(i,0)}Bt.clone=function(e,t){if(l(e))return l(t)?(t.near=e.near,t.nearValue=e.nearValue,t.far=e.far,t.farValue=e.farValue,t):new Bt(e.near,e.nearValue,e.far,e.farValue)};Bt.packedLength=4;Bt.pack=function(e,t,n){if(!l(e))throw new A("value is required");if(!l(t))throw new A("array is required");return n=T(n,0),t[n++]=e.near,t[n++]=e.nearValue,t[n++]=e.far,t[n]=e.farValue,t};Bt.unpack=function(e,t,n){if(!l(e))throw new A("array is required");return t=T(t,0),l(n)||(n=new Bt),n.near=e[t++],n.nearValue=e[t++],n.far=e[t++],n.farValue=e[t],n};Bt.equals=function(e,t){return e===t||l(e)&&l(t)&&e.near===t.near&&e.nearValue===t.nearValue&&e.far===t.far&&e.farValue===t.farValue};Bt.prototype.clone=function(e){return Bt.clone(this,e)};Bt.prototype.equals=function(e){return Bt.equals(this,e)};function Sp(e,t,n){e=T(e,0),t=T(t,0),n=T(n,0),this.value=new Float32Array([e,t,n])}Object.defineProperties(Sp.prototype,{componentDatatype:{get:function(){return q.FLOAT}},componentsPerAttribute:{get:function(){return 3}},normalize:{get:function(){return!1}}});Sp.fromCartesian3=function(e){return y.defined("offset",e),new Sp(e.x,e.y,e.z)};Sp.toValue=function(e,t){return y.defined("offset",e),l(t)||(t=new Float32Array([e.x,e.y,e.z])),t[0]=e.x,t[1]=e.y,t[2]=e.z,t};function FX(e,t,n,i,r){const s=e.measureText(t);if(!!/\S/.test(t)){const a=document.defaultView.getComputedStyle(e.canvas).getPropertyValue("font-size").replace("px",""),c=document.createElement("canvas"),u=100,h=s.width+u|0,d=3*a,p=d/2;c.width=h,c.height=d;const g=c.getContext("2d");g.font=n,g.fillStyle="white",g.fillRect(0,0,c.width+1,c.height+1),i&&(g.strokeStyle="black",g.lineWidth=e.lineWidth,g.strokeText(t,u/2,p)),r&&(g.fillStyle="black",g.fillText(t,u/2,p));const _=g.getImageData(0,0,h,d).data,b=_.length,x=h*4;let E,C,w,S;for(E=0;E<b;++E)if(_[E]!==255){w=E/x|0;break}for(E=b-1;E>=0;--E)if(_[E]!==255){S=E/x|0;break}let v=-1;for(E=0;E<h&&v===-1;++E)for(C=0;C<d;++C){const D=E*4+C*x;if(_[D]!==255||_[D+1]!==255||_[D+2]!==255||_[D+3]!==255){v=E;break}}return{width:s.width,height:S-w,ascent:p-w,descent:S-p,minx:v-u/2}}return{width:s.width,height:0,ascent:0,descent:0,minx:0}}let Wl;function BX(e,t){if(!l(e))throw new A("text is required.");if(e==="")return;t=T(t,T.EMPTY_OBJECT);const n=T(t.font,"10px sans-serif"),i=T(t.stroke,!1),r=T(t.fill,!0),s=T(t.strokeWidth,1),o=T(t.backgroundColor,M.TRANSPARENT),a=T(t.padding,0),c=a*2,u=document.createElement("canvas");u.width=1,u.height=1,u.style.font=n;const h=u.getContext("2d",{willReadFrequently:!0});l(Wl)||(l(h.imageSmoothingEnabled)?Wl="imageSmoothingEnabled":l(h.mozImageSmoothingEnabled)?Wl="mozImageSmoothingEnabled":l(h.webkitImageSmoothingEnabled)?Wl="webkitImageSmoothingEnabled":l(h.msImageSmoothingEnabled)&&(Wl="msImageSmoothingEnabled")),h.font=n,h.lineJoin="round",h.lineWidth=s,h[Wl]=!1,u.style.visibility="hidden",document.body.appendChild(u);const d=FX(h,e,n,i,r);u.dimensions=d,document.body.removeChild(u),u.style.visibility="";const p=-d.minx,g=Math.ceil(d.width)+p+c,_=d.height+c,b=_-d.ascent+a,x=_-b+c;if(u.width=g,u.height=_,h.font=n,h.lineJoin="round",h.lineWidth=s,h[Wl]=!1,o!==M.TRANSPARENT&&(h.fillStyle=o.toCssColorString(),h.fillRect(0,0,u.width,u.height)),i){const E=T(t.strokeColor,M.BLACK);h.strokeStyle=E.toCssColorString(),h.strokeText(e,p+a,x)}if(r){const E=T(t.fillColor,M.WHITE);h.fillStyle=E.toCssColorString(),h.fillText(e,p+a,x)}return u}const Ft={UNSIGNED_BYTE:j.UNSIGNED_BYTE,UNSIGNED_SHORT:j.UNSIGNED_SHORT,UNSIGNED_INT:j.UNSIGNED_INT,FLOAT:j.FLOAT,HALF_FLOAT:j.HALF_FLOAT_OES,UNSIGNED_INT_24_8:j.UNSIGNED_INT_24_8,UNSIGNED_SHORT_4_4_4_4:j.UNSIGNED_SHORT_4_4_4_4,UNSIGNED_SHORT_5_5_5_1:j.UNSIGNED_SHORT_5_5_5_1,UNSIGNED_SHORT_5_6_5:j.UNSIGNED_SHORT_5_6_5};Ft.toWebGLConstant=function(e,t){switch(e){case Ft.UNSIGNED_BYTE:return j.UNSIGNED_BYTE;case Ft.UNSIGNED_SHORT:return j.UNSIGNED_SHORT;case Ft.UNSIGNED_INT:return j.UNSIGNED_INT;case Ft.FLOAT:return j.FLOAT;case Ft.HALF_FLOAT:return t.webgl2?j.HALF_FLOAT:j.HALF_FLOAT_OES;case Ft.UNSIGNED_INT_24_8:return j.UNSIGNED_INT_24_8;case Ft.UNSIGNED_SHORT_4_4_4_4:return j.UNSIGNED_SHORT_4_4_4_4;case Ft.UNSIGNED_SHORT_5_5_5_1:return j.UNSIGNED_SHORT_5_5_5_1;case Ft.UNSIGNED_SHORT_5_6_5:return Ft.UNSIGNED_SHORT_5_6_5}};Ft.isPacked=function(e){return e===Ft.UNSIGNED_INT_24_8||e===Ft.UNSIGNED_SHORT_4_4_4_4||e===Ft.UNSIGNED_SHORT_5_5_5_1||e===Ft.UNSIGNED_SHORT_5_6_5};Ft.sizeInBytes=function(e){switch(e){case Ft.UNSIGNED_BYTE:return 1;case Ft.UNSIGNED_SHORT:case Ft.UNSIGNED_SHORT_4_4_4_4:case Ft.UNSIGNED_SHORT_5_5_5_1:case Ft.UNSIGNED_SHORT_5_6_5:case Ft.HALF_FLOAT:return 2;case Ft.UNSIGNED_INT:case Ft.FLOAT:case Ft.UNSIGNED_INT_24_8:return 4}};Ft.validate=function(e){return e===Ft.UNSIGNED_BYTE||e===Ft.UNSIGNED_SHORT||e===Ft.UNSIGNED_INT||e===Ft.FLOAT||e===Ft.HALF_FLOAT||e===Ft.UNSIGNED_INT_24_8||e===Ft.UNSIGNED_SHORT_4_4_4_4||e===Ft.UNSIGNED_SHORT_5_5_5_1||e===Ft.UNSIGNED_SHORT_5_6_5};const De=Object.freeze(Ft),de={DEPTH_COMPONENT:j.DEPTH_COMPONENT,DEPTH_STENCIL:j.DEPTH_STENCIL,ALPHA:j.ALPHA,RED:j.RED,RG:j.RG,RGB:j.RGB,RGBA:j.RGBA,LUMINANCE:j.LUMINANCE,LUMINANCE_ALPHA:j.LUMINANCE_ALPHA,RGB_DXT1:j.COMPRESSED_RGB_S3TC_DXT1_EXT,RGBA_DXT1:j.COMPRESSED_RGBA_S3TC_DXT1_EXT,RGBA_DXT3:j.COMPRESSED_RGBA_S3TC_DXT3_EXT,RGBA_DXT5:j.COMPRESSED_RGBA_S3TC_DXT5_EXT,RGB_PVRTC_4BPPV1:j.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,RGB_PVRTC_2BPPV1:j.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,RGBA_PVRTC_4BPPV1:j.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,RGBA_PVRTC_2BPPV1:j.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,RGBA_ASTC:j.COMPRESSED_RGBA_ASTC_4x4_WEBGL,RGB_ETC1:j.COMPRESSED_RGB_ETC1_WEBGL,RGB8_ETC2:j.COMPRESSED_RGB8_ETC2,RGBA8_ETC2_EAC:j.COMPRESSED_RGBA8_ETC2_EAC,RGBA_BC7:j.COMPRESSED_RGBA_BPTC_UNORM};de.componentsLength=function(e){switch(e){case de.RGB:return 3;case de.RGBA:return 4;case de.LUMINANCE_ALPHA:case de.RG:return 2;case de.ALPHA:case de.RED:case de.LUMINANCE:return 1;default:return 1}};de.validate=function(e){return e===de.DEPTH_COMPONENT||e===de.DEPTH_STENCIL||e===de.ALPHA||e===de.RED||e===de.RG||e===de.RGB||e===de.RGBA||e===de.LUMINANCE||e===de.LUMINANCE_ALPHA||e===de.RGB_DXT1||e===de.RGBA_DXT1||e===de.RGBA_DXT3||e===de.RGBA_DXT5||e===de.RGB_PVRTC_4BPPV1||e===de.RGB_PVRTC_2BPPV1||e===de.RGBA_PVRTC_4BPPV1||e===de.RGBA_PVRTC_2BPPV1||e===de.RGBA_ASTC||e===de.RGB_ETC1||e===de.RGB8_ETC2||e===de.RGBA8_ETC2_EAC||e===de.RGBA_BC7};de.isColorFormat=function(e){return e===de.RED||e===de.ALPHA||e===de.RGB||e===de.RGBA||e===de.LUMINANCE||e===de.LUMINANCE_ALPHA};de.isDepthFormat=function(e){return e===de.DEPTH_COMPONENT||e===de.DEPTH_STENCIL};de.isCompressedFormat=function(e){return e===de.RGB_DXT1||e===de.RGBA_DXT1||e===de.RGBA_DXT3||e===de.RGBA_DXT5||e===de.RGB_PVRTC_4BPPV1||e===de.RGB_PVRTC_2BPPV1||e===de.RGBA_PVRTC_4BPPV1||e===de.RGBA_PVRTC_2BPPV1||e===de.RGBA_ASTC||e===de.RGB_ETC1||e===de.RGB8_ETC2||e===de.RGBA8_ETC2_EAC||e===de.RGBA_BC7};de.isDXTFormat=function(e){return e===de.RGB_DXT1||e===de.RGBA_DXT1||e===de.RGBA_DXT3||e===de.RGBA_DXT5};de.isPVRTCFormat=function(e){return e===de.RGB_PVRTC_4BPPV1||e===de.RGB_PVRTC_2BPPV1||e===de.RGBA_PVRTC_4BPPV1||e===de.RGBA_PVRTC_2BPPV1};de.isASTCFormat=function(e){return e===de.RGBA_ASTC};de.isETC1Format=function(e){return e===de.RGB_ETC1};de.isETC2Format=function(e){return e===de.RGB8_ETC2||e===de.RGBA8_ETC2_EAC};de.isBC7Format=function(e){return e===de.RGBA_BC7};de.compressedTextureSizeInBytes=function(e,t,n){switch(e){case de.RGB_DXT1:case de.RGBA_DXT1:case de.RGB_ETC1:case de.RGB8_ETC2:return Math.floor((t+3)/4)*Math.floor((n+3)/4)*8;case de.RGBA_DXT3:case de.RGBA_DXT5:case de.RGBA_ASTC:case de.RGBA8_ETC2_EAC:return Math.floor((t+3)/4)*Math.floor((n+3)/4)*16;case de.RGB_PVRTC_4BPPV1:case de.RGBA_PVRTC_4BPPV1:return Math.floor((Math.max(t,8)*Math.max(n,8)*4+7)/8);case de.RGB_PVRTC_2BPPV1:case de.RGBA_PVRTC_2BPPV1:return Math.floor((Math.max(t,16)*Math.max(n,8)*2+7)/8);case de.RGBA_BC7:return Math.ceil(t/4)*Math.ceil(n/4)*16;default:return 0}};de.textureSizeInBytes=function(e,t,n,i){let r=de.componentsLength(e);return De.isPacked(t)&&(r=1),r*De.sizeInBytes(t)*n*i};de.alignmentInBytes=function(e,t,n){const i=de.textureSizeInBytes(e,t,n,1)%4;return i===0?4:i===2?2:1};de.createTypedArray=function(e,t,n,i){let r;const s=De.sizeInBytes(t);s===Uint8Array.BYTES_PER_ELEMENT?r=Uint8Array:s===Uint16Array.BYTES_PER_ELEMENT?r=Uint16Array:s===Float32Array.BYTES_PER_ELEMENT&&t===De.FLOAT?r=Float32Array:r=Uint32Array;const o=de.componentsLength(e)*n*i;return new r(o)};de.flipY=function(e,t,n,i,r){if(r===1)return e;const s=de.createTypedArray(t,n,i,r),o=de.componentsLength(t),a=i*o;for(let c=0;c<r;++c){const u=c*i*o,h=(r-c-1)*i*o;for(let d=0;d<a;++d)s[h+d]=e[u+d]}return s};de.toInternalFormat=function(e,t,n){if(!n.webgl2)return e;if(e===de.DEPTH_STENCIL)return j.DEPTH24_STENCIL8;if(e===de.DEPTH_COMPONENT){if(t===De.UNSIGNED_SHORT)return j.DEPTH_COMPONENT16;if(t===De.UNSIGNED_INT)return j.DEPTH_COMPONENT24}if(t===De.FLOAT)switch(e){case de.RGBA:return j.RGBA32F;case de.RGB:return j.RGB32F;case de.RG:return j.RG32F;case de.RED:return j.R32F}if(t===De.HALF_FLOAT)switch(e){case de.RGBA:return j.RGBA16F;case de.RGB:return j.RGB16F;case de.RG:return j.RG16F;case de.RED:return j.R16F}return e};const Le=Object.freeze(de);function Gt(e,t){this.position=e,l(this.position)||(this.position=new k),this.tangentPlane=t,l(this.tangentPlane)||(this.tangentPlane=Gt.NORTH_POLE_TANGENT_PLANE)}Object.defineProperties(Gt.prototype,{ellipsoid:{get:function(){return this.tangentPlane.ellipsoid}},x:{get:function(){return this.position.x}},y:{get:function(){return this.position.y}},conformalLatitude:{get:function(){const e=k.magnitude(this.position),t=2*this.ellipsoid.maximumRadius;return this.tangentPlane.plane.normal.z*(R.PI_OVER_TWO-2*Math.atan2(e,t))}},longitude:{get:function(){let e=R.PI_OVER_TWO+Math.atan2(this.y,this.x);return e>Math.PI&&(e-=R.TWO_PI),e}}});const tf=new oe,zX=new m;Gt.prototype.getLatitude=function(e){l(e)||(e=fe.default),tf.latitude=this.conformalLatitude,tf.longitude=this.longitude,tf.height=0;const t=this.ellipsoid.cartographicToCartesian(tf,zX);return e.cartesianToCartographic(t,tf),tf.latitude};const UX=new ya,kX=new m,jX=new m;Gt.fromCartesian=function(e,t){y.defined("cartesian",e);const n=R.signNotZero(e.z);let i=Gt.NORTH_POLE_TANGENT_PLANE,r=Gt.SOUTH_POLE;n<0&&(i=Gt.SOUTH_POLE_TANGENT_PLANE,r=Gt.NORTH_POLE);const s=UX;s.origin=i.ellipsoid.scaleToGeocentricSurface(e,s.origin),s.direction=m.subtract(s.origin,r,kX),m.normalize(s.direction,s.direction);const o=Ct.rayPlane(s,i.plane,jX),a=m.subtract(o,r,o),c=m.dot(i.xAxis,a),u=n*m.dot(i.yAxis,a);return l(t)?(t.position=new k(c,u),t.tangentPlane=i,t):new Gt(new k(c,u),i)};Gt.fromCartesianArray=function(e,t){y.defined("cartesians",e);const n=e.length;l(t)?t.length=n:t=new Array(n);for(let i=0;i<n;i++)t[i]=Gt.fromCartesian(e[i],t[i]);return t};Gt.clone=function(e,t){if(l(e))return l(t)?(t.position=e.position,t.tangentPlane=e.tangentPlane,t):new Gt(e.position,e.tangentPlane)};Gt.HALF_UNIT_SPHERE=Object.freeze(new fe(.5,.5,.5));Gt.NORTH_POLE=Object.freeze(new m(0,0,.5));Gt.SOUTH_POLE=Object.freeze(new m(0,0,-.5));Gt.NORTH_POLE_TANGENT_PLANE=Object.freeze(new ar(Gt.NORTH_POLE,Gt.HALF_UNIT_SPHERE));Gt.SOUTH_POLE_TANGENT_PLANE=Object.freeze(new ar(Gt.SOUTH_POLE,Gt.HALF_UNIT_SPHERE));const VX=new oe,RI=new oe;function GX(e,t,n,i){const s=i.cartesianToCartographic(e,VX).height,o=i.cartesianToCartographic(t,RI);o.height=s,i.cartographicToCartesian(o,t);const a=i.cartesianToCartographic(n,RI);a.height=s-100,i.cartographicToCartesian(a,n)}const DI=new Ot,HX=new m,qX=new m,WX=new m,$X=new m,XX=new m,YX=new m;let ag=new m,Zo=new m,nf=new m;const KX=new k,ZX=new k,JX=new m,MI=new re,QX=new H,eY=new H;function F0(e){const t=e.vertexFormat,n=e.geometry,i=e.shadowVolume,r=n.attributes.position.values,s=l(n.attributes.st)?n.attributes.st.values:void 0;let o=r.length;const a=e.wall,c=e.top||a,u=e.bottom||a;if(t.st||t.normal||t.tangent||t.bitangent||i){const h=e.boundingRectangle,d=e.rotationAxis,p=e.projectTo2d,g=e.ellipsoid,_=e.stRotation,b=e.perPositionHeight,x=KX;x.x=h.x,x.y=h.y;const E=t.st?new Float32Array(2*(o/3)):void 0;let C;t.normal&&(b&&c&&!a?C=n.attributes.normal.values:C=new Float32Array(o));const w=t.tangent?new Float32Array(o):void 0,S=t.bitangent?new Float32Array(o):void 0,v=i?new Float32Array(o):void 0;let D=0,L=0,O=qX,N=WX,B=$X,U=!0,V=QX,f=eY;if(_!==0){let G=re.fromAxisAngle(d,_,MI);V=H.fromQuaternion(G,V),G=re.fromAxisAngle(d,-_,MI),f=H.fromQuaternion(G,f)}else V=H.clone(H.IDENTITY,V),f=H.clone(H.IDENTITY,f);let I=0,F=0;c&&u&&(I=o/2,F=o/3,o/=2);for(let G=0;G<o;G+=3){const W=m.fromArray(r,G,JX);if(t.st&&!l(s)){let X=H.multiplyByVector(V,W,HX);X=g.scaleToGeodeticSurface(X,X);const Z=p([X],ZX)[0];k.subtract(Z,x,Z);const $=R.clamp(Z.x/h.width,0,1),ne=R.clamp(Z.y/h.height,0,1);u&&(E[D+F]=$,E[D+1+F]=ne),c&&(E[D]=$,E[D+1]=ne),D+=2}if(t.normal||t.tangent||t.bitangent||i){const X=L+1,Z=L+2;if(a){if(G+3<o){const $=m.fromArray(r,G+3,XX);if(U){const ne=m.fromArray(r,G+o,YX);b&&GX(W,$,ne,g),m.subtract($,W,$),m.subtract(ne,W,ne),O=m.normalize(m.cross(ne,$,O),O),U=!1}m.equalsEpsilon($,W,R.EPSILON10)&&(U=!0)}(t.tangent||t.bitangent)&&(B=g.geodeticSurfaceNormal(W,B),t.tangent&&(N=m.normalize(m.cross(B,O,N),N)))}else O=g.geodeticSurfaceNormal(W,O),(t.tangent||t.bitangent)&&(b&&(ag=m.fromArray(C,L,ag),Zo=m.cross(m.UNIT_Z,ag,Zo),Zo=m.normalize(H.multiplyByVector(f,Zo,Zo),Zo),t.bitangent&&(nf=m.normalize(m.cross(ag,Zo,nf),nf))),N=m.cross(m.UNIT_Z,O,N),N=m.normalize(H.multiplyByVector(f,N,N),N),t.bitangent&&(B=m.normalize(m.cross(O,N,B),B)));t.normal&&(e.wall?(C[L+I]=O.x,C[X+I]=O.y,C[Z+I]=O.z):u&&(C[L+I]=-O.x,C[X+I]=-O.y,C[Z+I]=-O.z),(c&&!b||a)&&(C[L]=O.x,C[X]=O.y,C[Z]=O.z)),i&&(a&&(O=g.geodeticSurfaceNormal(W,O)),v[L+I]=-O.x,v[X+I]=-O.y,v[Z+I]=-O.z),t.tangent&&(e.wall?(w[L+I]=N.x,w[X+I]=N.y,w[Z+I]=N.z):u&&(w[L+I]=-N.x,w[X+I]=-N.y,w[Z+I]=-N.z),c&&(b?(w[L]=Zo.x,w[X]=Zo.y,w[Z]=Zo.z):(w[L]=N.x,w[X]=N.y,w[Z]=N.z))),t.bitangent&&(u&&(S[L+I]=B.x,S[X+I]=B.y,S[Z+I]=B.z),c&&(b?(S[L]=nf.x,S[X]=nf.y,S[Z]=nf.z):(S[L]=B.x,S[X]=B.y,S[Z]=B.z))),L+=3}}t.st&&!l(s)&&(n.attributes.st=new Lt({componentDatatype:q.FLOAT,componentsPerAttribute:2,values:E})),t.normal&&(n.attributes.normal=new Lt({componentDatatype:q.FLOAT,componentsPerAttribute:3,values:C})),t.tangent&&(n.attributes.tangent=new Lt({componentDatatype:q.FLOAT,componentsPerAttribute:3,values:w})),t.bitangent&&(n.attributes.bitangent=new Lt({componentDatatype:q.FLOAT,componentsPerAttribute:3,values:S})),i&&(n.attributes.extrudeDirection=new Lt({componentDatatype:q.FLOAT,componentsPerAttribute:3,values:v}))}if(e.extrude&&l(e.offsetAttribute)){const h=r.length/3;let d=new Uint8Array(h);if(e.offsetAttribute===Js.TOP)c&&u||a?d=d.fill(1,0,h/2):c&&(d=d.fill(1));else{const p=e.offsetAttribute===Js.NONE?0:1;d=d.fill(p)}n.attributes.applyOffset=new Lt({componentDatatype:q.UNSIGNED_BYTE,componentsPerAttribute:1,values:d})}return n}const LI=[];function tY(e,t,n,i,r,s,o,a,c,u){const h={walls:[]};let d;if(o||a){const C=ft.createGeometryFromPositions(e,t,n,i,s,c,u),w=C.attributes.position.values,S=C.indices;let v,D;if(o&&a){const L=w.concat(w);v=L.length/3,D=Ge.createTypedArray(v,S.length*2),D.set(S);const O=S.length,N=v/2;for(d=0;d<O;d+=3){const B=D[d]+N,U=D[d+1]+N,V=D[d+2]+N;D[d+O]=V,D[d+1+O]=U,D[d+2+O]=B}if(C.attributes.position.values=L,s&&c.normal){const B=C.attributes.normal.values;C.attributes.normal.values=new Float32Array(L.length),C.attributes.normal.values.set(B)}if(c.st&&l(n)){const B=C.attributes.st.values;C.attributes.st.values=new Float32Array(v*2),C.attributes.st.values=B.concat(B)}C.indices=D}else if(a){for(v=w.length/3,D=Ge.createTypedArray(v,S.length),d=0;d<S.length;d+=3)D[d]=S[d+2],D[d+1]=S[d+1],D[d+2]=S[d];C.indices=D}h.topAndBottom=new Oo({geometry:C})}let p=r.outerRing;const g=ar.fromPoints(p,e);let _=g.projectPointsOntoPlane(p,LI),b=xi.computeWindingOrder2D(_);b===xl.CLOCKWISE&&(p=p.slice().reverse());let x=ft.computeWallGeometry(p,n,e,i,s,u);h.walls.push(new Oo({geometry:x}));const E=r.holes;for(d=0;d<E.length;d++){let C=E[d];_=g.projectPointsOntoPlane(C,LI),b=xi.computeWindingOrder2D(_),b===xl.COUNTER_CLOCKWISE&&(C=C.slice().reverse()),x=ft.computeWallGeometry(C,n,e,i,s,u),h.walls.push(new Oo({geometry:x}))}return h}function io(e){if(y.typeOf.object("options",e),y.typeOf.object("options.polygonHierarchy",e.polygonHierarchy),l(e.perPositionHeight)&&e.perPositionHeight&&l(e.height))throw new A("Cannot use both options.perPositionHeight and options.height");if(l(e.arcType)&&e.arcType!==Co.GEODESIC&&e.arcType!==Co.RHUMB)throw new A("Invalid arcType. Valid options are ArcType.GEODESIC and ArcType.RHUMB.");const t=e.polygonHierarchy,n=T(e.vertexFormat,Qt.DEFAULT),i=T(e.ellipsoid,fe.default),r=T(e.granularity,R.RADIANS_PER_DEGREE),s=T(e.stRotation,0),o=e.textureCoordinates,a=T(e.perPositionHeight,!1),c=a&&l(e.extrudedHeight);let u=T(e.height,0),h=T(e.extrudedHeight,u);if(!c){const d=Math.max(u,h);h=Math.min(u,h),u=d}this._vertexFormat=Qt.clone(n),this._ellipsoid=fe.clone(i),this._granularity=r,this._stRotation=s,this._height=u,this._extrudedHeight=h,this._closeTop=T(e.closeTop,!0),this._closeBottom=T(e.closeBottom,!0),this._polygonHierarchy=t,this._perPositionHeight=a,this._perPositionHeightExtrude=c,this._shadowVolume=T(e.shadowVolume,!1),this._workerName="createPolygonGeometry",this._offsetAttribute=e.offsetAttribute,this._arcType=T(e.arcType,Co.GEODESIC),this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0,this._textureCoordinates=o,this.packedLength=ft.computeHierarchyPackedLength(t,m)+fe.packedLength+Qt.packedLength+(o?ft.computeHierarchyPackedLength(o,k):1)+12}io.fromPositions=function(e){e=T(e,T.EMPTY_OBJECT),y.defined("options.positions",e.positions);const t={polygonHierarchy:{positions:e.positions},height:e.height,extrudedHeight:e.extrudedHeight,vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,closeTop:e.closeTop,closeBottom:e.closeBottom,offsetAttribute:e.offsetAttribute,arcType:e.arcType,textureCoordinates:e.textureCoordinates};return new io(t)};io.pack=function(e,t,n){return y.typeOf.object("value",e),y.defined("array",t),n=T(n,0),n=ft.packPolygonHierarchy(e._polygonHierarchy,t,n,m),fe.pack(e._ellipsoid,t,n),n+=fe.packedLength,Qt.pack(e._vertexFormat,t,n),n+=Qt.packedLength,t[n++]=e._height,t[n++]=e._extrudedHeight,t[n++]=e._granularity,t[n++]=e._stRotation,t[n++]=e._perPositionHeightExtrude?1:0,t[n++]=e._perPositionHeight?1:0,t[n++]=e._closeTop?1:0,t[n++]=e._closeBottom?1:0,t[n++]=e._shadowVolume?1:0,t[n++]=T(e._offsetAttribute,-1),t[n++]=e._arcType,l(e._textureCoordinates)?n=ft.packPolygonHierarchy(e._textureCoordinates,t,n,k):t[n++]=-1,t[n++]=e.packedLength,t};const nY=fe.clone(fe.UNIT_SPHERE),iY=new Qt,rY={polygonHierarchy:{}};io.unpack=function(e,t,n){y.defined("array",e),t=T(t,0);const i=ft.unpackPolygonHierarchy(e,t,m);t=i.startingIndex,delete i.startingIndex;const r=fe.unpack(e,t,nY);t+=fe.packedLength;const s=Qt.unpack(e,t,iY);t+=Qt.packedLength;const o=e[t++],a=e[t++],c=e[t++],u=e[t++],h=e[t++]===1,d=e[t++]===1,p=e[t++]===1,g=e[t++]===1,_=e[t++]===1,b=e[t++],x=e[t++],E=e[t]===-1?void 0:ft.unpackPolygonHierarchy(e,t,k);l(E)?(t=E.startingIndex,delete E.startingIndex):t++;const C=e[t++];return l(n)||(n=new io(rY)),n._polygonHierarchy=i,n._ellipsoid=fe.clone(r,n._ellipsoid),n._vertexFormat=Qt.clone(s,n._vertexFormat),n._height=o,n._extrudedHeight=a,n._granularity=c,n._stRotation=u,n._perPositionHeightExtrude=h,n._perPositionHeight=d,n._closeTop=p,n._closeBottom=g,n._shadowVolume=_,n._offsetAttribute=b===-1?void 0:b,n._arcType=x,n._textureCoordinates=E,n.packedLength=C,n};const sY=new k,oY=new k,aY=new Gt;function PI(e,t,n,i,r,s){const o=e.longitude,a=o>=0?o:o+R.TWO_PI;r.westOverIdl=Math.min(r.westOverIdl,a),r.eastOverIdl=Math.max(r.eastOverIdl,a),s.west=Math.min(s.west,o),s.east=Math.max(s.east,o);const c=e.getLatitude(n);let u=c;if(s.south=Math.min(s.south,c),s.north=Math.max(s.north,c),i!==Co.RHUMB){const p=k.subtract(t.position,e.position,sY),g=k.dot(t.position,p)/k.dot(p,p);if(g>0&&g<1){const _=k.add(t.position,k.multiplyByScalar(p,-g,p),oY),b=Gt.clone(t,aY);b.position=_;const x=b.getLatitude(n);s.south=Math.min(s.south,x),s.north=Math.max(s.north,x),Math.abs(c)>Math.abs(x)&&(u=x)}}const h=t.x*e.y-e.x*t.y;let d=Math.sign(h);d!==0&&(d*=k.angleBetween(t.position,e.position)),u>=0&&(r.northAngle+=d),u<=0&&(r.southAngle+=d)}const NI=new Gt,cY=new Gt,Ms={northAngle:0,southAngle:0,westOverIdl:0,eastOverIdl:0};io.computeRectangleFromPositions=function(e,t,n,i){if(y.defined("positions",e),l(i)||(i=new ie),e.length<3)return i;i.west=Number.POSITIVE_INFINITY,i.east=Number.NEGATIVE_INFINITY,i.south=Number.POSITIVE_INFINITY,i.north=Number.NEGATIVE_INFINITY,Ms.northAngle=0,Ms.southAngle=0,Ms.westOverIdl=Number.POSITIVE_INFINITY,Ms.eastOverIdl=Number.NEGATIVE_INFINITY;const r=e.length;let s=Gt.fromCartesian(e[0],cY);for(let o=1;o<r;o++){const a=Gt.fromCartesian(e[o],NI);PI(a,s,t,n,Ms,i),s=Gt.clone(a,s)}return PI(Gt.fromCartesian(e[0],NI),s,t,n,Ms,i),i.east-i.west>Ms.eastOverIdl-Ms.westOverIdl&&(i.west=Ms.westOverIdl,i.east=Ms.eastOverIdl,i.east>R.PI&&(i.east=i.east-R.TWO_PI),i.west>R.PI&&(i.west=i.west-R.TWO_PI)),R.equalsEpsilon(Math.abs(Ms.northAngle),R.TWO_PI,R.EPSILON10)&&(i.north=R.PI_OVER_TWO,i.east=R.PI,i.west=-R.PI),R.equalsEpsilon(Math.abs(Ms.southAngle),R.TWO_PI,R.EPSILON10)&&(i.south=-R.PI_OVER_TWO,i.east=R.PI,i.west=-R.PI),i};const lY=new Gt;function uY(e,t,n){return e.height>=R.PI||e.width>=R.PI?Gt.fromCartesian(t[0],lY).tangentPlane:ar.fromPoints(t,n)}const FL=new oe;function fY(e,t,n){return(i,r)=>{if(e.height>=R.PI||e.width>=R.PI){if(e.south<0&&e.north>0){l(r)||(r=[]);for(let o=0;o<i.length;++o){const a=n.cartesianToCartographic(i[o],FL);r[o]=new k(a.longitude/R.PI,a.latitude/R.PI_OVER_TWO)}return r.length=i.length,r}return Gt.fromCartesianArray(i,r)}return ar.fromPoints(t,n).projectPointsOntoPlane(i,r)}}function hY(e,t,n){if(e.height>=R.PI||e.width>=R.PI)return(r,s)=>{if(e.south<0&&e.north>0){const o=n.cartesianToCartographic(r,FL);return l(s)||(s=new k),s.x=o.longitude/R.PI,s.y=o.latitude/R.PI_OVER_TWO,s}return Gt.fromCartesian(r,s)};const i=ar.fromPoints(t,n);return(r,s)=>i.projectPointsOntoPlane(r,s)}function dY(e,t,n,i){return(r,s)=>!i&&(e.height>=R.PI_OVER_TWO||e.width>=2*R.PI_OVER_THREE)?ft.splitPolygonsOnEquator(r,t,n,s):r}function pY(e,t,n,i){if(t.height>=R.PI||t.width>=R.PI)return Ot.fromRectangle(t,void 0,DI);const r=e,s=ar.fromPoints(r,n);return ft.computeBoundingRectangle(s.plane.normal,s.projectPointOntoPlane.bind(s),r,i,DI)}io.createGeometry=function(e){const t=e._vertexFormat,n=e._ellipsoid,i=e._granularity,r=e._stRotation,s=e._polygonHierarchy,o=e._perPositionHeight,a=e._closeTop,c=e._closeBottom,u=e._arcType,h=e._textureCoordinates,d=l(h),p=s.positions;if(p.length<3)return;const g=e.rectangle,_=ft.polygonsFromHierarchy(s,d,fY(g,p,n),!o,n,dY(g,n,u,o)),b=_.hierarchy,x=_.polygons,E=function(I){return I},C=d?ft.polygonsFromHierarchy(h,!0,E,!1,n).polygons:void 0;if(b.length===0)return;const w=b[0].outerRing,S=pY(w,g,n,r),v=[],D=e._height,L=e._extrudedHeight,O=e._perPositionHeightExtrude||!R.equalsEpsilon(D,L,0,R.EPSILON2),N={perPositionHeight:o,vertexFormat:t,geometry:void 0,rotationAxis:uY(g,w,n).plane.normal,projectTo2d:hY(g,w,n),boundingRectangle:S,ellipsoid:n,stRotation:r,textureCoordinates:void 0,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:u};let B;if(O)for(N.extrude=!0,N.top=a,N.bottom=c,N.shadowVolume=e._shadowVolume,N.offsetAttribute=e._offsetAttribute,B=0;B<x.length;B++){const I=tY(n,x[B],d?C[B]:void 0,i,b[B],o,a,c,t,u);let F;a&&c?(F=I.topAndBottom,N.geometry=ft.scaleToGeodeticHeightExtruded(F.geometry,D,L,n,o)):a?(F=I.topAndBottom,F.geometry.attributes.position.values=xi.scaleToGeodeticHeight(F.geometry.attributes.position.values,D,n,!o),N.geometry=F.geometry):c&&(F=I.topAndBottom,F.geometry.attributes.position.values=xi.scaleToGeodeticHeight(F.geometry.attributes.position.values,L,n,!0),N.geometry=F.geometry),(a||c)&&(N.wall=!1,F.geometry=F0(N),v.push(F));const G=I.walls;N.wall=!0;for(let W=0;W<G.length;W++){const X=G[W];N.geometry=ft.scaleToGeodeticHeightExtruded(X.geometry,D,L,n,o),X.geometry=F0(N),v.push(X)}}else for(B=0;B<x.length;B++){const I=new Oo({geometry:ft.createGeometryFromPositions(n,x[B],d?C[B]:void 0,i,o,t,u)});if(I.geometry.attributes.position.values=xi.scaleToGeodeticHeight(I.geometry.attributes.position.values,D,n,!o),N.geometry=I.geometry,I.geometry=F0(N),l(e._offsetAttribute)){const F=I.geometry.attributes.position.values.length,G=e._offsetAttribute===Js.NONE?0:1,W=new Uint8Array(F/3).fill(G);I.geometry.attributes.applyOffset=new Lt({componentDatatype:q.UNSIGNED_BYTE,componentsPerAttribute:1,values:W})}v.push(I)}const U=$t.combineInstances(v)[0];U.attributes.position.values=new Float64Array(U.attributes.position.values),U.indices=Ge.createTypedArray(U.attributes.position.values.length/3,U.indices);const V=U.attributes,f=ee.fromVertices(V.position.values);return t.position||delete V.position,new Ht({attributes:V,indices:U.indices,primitiveType:U.primitiveType,boundingSphere:f,offsetAttribute:e._offsetAttribute})};io.createShadowVolume=function(e,t,n){const i=e._granularity,r=e._ellipsoid,s=t(i,r),o=n(i,r);return new io({polygonHierarchy:e._polygonHierarchy,ellipsoid:r,stRotation:e._stRotation,granularity:i,perPositionHeight:!1,extrudedHeight:s,height:o,vertexFormat:Qt.POSITION_ONLY,shadowVolume:!0,arcType:e._arcType})};function mY(e){const t=-e._stRotation;if(t===0)return[0,0,0,1,1,0];const n=e._ellipsoid,i=e._polygonHierarchy.positions,r=e.rectangle;return Ht._textureCoordinateRotationPoints(i,t,n,r)}Object.defineProperties(io.prototype,{rectangle:{get:function(){if(!l(this._rectangle)){const e=this._polygonHierarchy.positions;this._rectangle=io.computeRectangleFromPositions(e,this._ellipsoid,this._arcType)}return this._rectangle}},textureCoordinateRotationPoints:{get:function(){return l(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=mY(this)),this._textureCoordinateRotationPoints}}});function gY(e){const t=e.points,n=e.times;return function(i,r){l(r)||(r=new re);const s=e._lastTimeIndex=e.findTimeInterval(i,e._lastTimeIndex),o=(i-n[s])/(n[s+1]-n[s]),a=t[s],c=t[s+1];return re.fastSlerp(a,c,o,r)}}function Oh(e){e=T(e,T.EMPTY_OBJECT);const t=e.points,n=e.times;if(!l(t)||!l(n))throw new A("points and times are required.");if(t.length<2)throw new A("points.length must be greater than or equal to 2.");if(n.length!==t.length)throw new A("times.length must be equal to points.length.");this._times=n,this._points=t,this._evaluateFunction=gY(this),this._lastTimeIndex=0}Object.defineProperties(Oh.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}}});Oh.prototype.findTimeInterval=Mn.prototype.findTimeInterval;Oh.prototype.wrapTime=Mn.prototype.wrapTime;Oh.prototype.clampTime=Mn.prototype.clampTime;Oh.prototype.evaluate=function(e,t){return this._evaluateFunction(e,t)};const FI=Math.cos,BI=Math.sin,_Y=Math.sqrt,Wc={};Wc.computePosition=function(e,t,n,i,r,s,o){const a=t.radiiSquared,c=e.nwCorner,u=e.boundingRectangle;let h=c.latitude-e.granYCos*i+r*e.granXSin;const d=FI(h),p=BI(h),g=a.z*p;let _=c.longitude+i*e.granYSin+r*e.granXCos;const b=d*FI(_),x=d*BI(_),E=a.x*b,C=a.y*x,w=_Y(E*b+C*x+g*p);if(s.x=E/w,s.y=C/w,s.z=g/w,n){const S=e.stNwCorner;l(S)?(h=S.latitude-e.stGranYCos*i+r*e.stGranXSin,_=S.longitude+i*e.stGranYSin+r*e.stGranXCos,o.x=(_-e.stWest)*e.lonScalar,o.y=(h-e.stSouth)*e.latScalar):(o.x=(_-u.west)*e.lonScalar,o.y=(h-u.south)*e.latScalar)}};const yY=new Te;let Ls=new m;const bY=new oe;let $_=new m;const Zd=new ur;function zI(e,t,n,i,r,s,o){const a=Math.cos(t),c=i*a,u=n*a,h=Math.sin(t),d=i*h,p=n*h;Zd._ellipsoid=fe.default,Ls=Zd.project(e,Ls),Ls=m.subtract(Ls,$_,Ls);const g=Te.fromRotation(t,yY);Ls=Te.multiplyByVector(g,Ls,Ls),Ls=m.add(Ls,$_,Ls),e=Zd.unproject(Ls,e),s-=1,o-=1;const _=e.latitude,b=_+s*p,x=_-c*o,E=_-c*o+s*p,C=Math.max(_,b,x,E),w=Math.min(_,b,x,E),S=e.longitude,v=S+s*u,D=S+o*d,L=S+o*d+s*u,O=Math.max(S,v,D,L),N=Math.min(S,v,D,L);return{north:C,south:w,east:O,west:N,granYCos:c,granYSin:d,granXCos:u,granXSin:p,nwCorner:e}}Wc.computeOptions=function(e,t,n,i,r,s,o){let a=e.east,c=e.west,u=e.north,h=e.south,d=!1,p=!1;u===R.PI_OVER_TWO&&(d=!0),h===-R.PI_OVER_TWO&&(p=!0);let g;const _=u-h;c>a?g=R.TWO_PI-c+a:g=a-c;const b=Math.ceil(g/t)+1,x=Math.ceil(_/t)+1,E=g/(b-1),C=_/(x-1),w=ie.northwest(e,s),S=ie.center(e,bY);(n!==0||i!==0)&&(S.longitude<w.longitude&&(S.longitude+=R.TWO_PI),Zd._ellipsoid=fe.default,$_=Zd.project(S,$_));const v=C,D=E,L=0,O=0,N=ie.clone(e,r),B={granYCos:v,granYSin:L,granXCos:D,granXSin:O,nwCorner:w,boundingRectangle:N,width:b,height:x,northCap:d,southCap:p};if(n!==0){const U=zI(w,n,E,C,S,b,x);if(u=U.north,h=U.south,a=U.east,c=U.west,u<-R.PI_OVER_TWO||u>R.PI_OVER_TWO||h<-R.PI_OVER_TWO||h>R.PI_OVER_TWO)throw new A("Rotated rectangle is invalid.  It crosses over either the north or south pole.");B.granYCos=U.granYCos,B.granYSin=U.granYSin,B.granXCos=U.granXCos,B.granXSin=U.granXSin,N.north=u,N.south=h,N.east=a,N.west=c}if(i!==0){n=n-i;const U=ie.northwest(N,o),V=zI(U,n,E,C,S,b,x);B.stGranYCos=V.granYCos,B.stGranXCos=V.granXCos,B.stGranYSin=V.granYSin,B.stGranXSin=V.granXSin,B.stNwCorner=U,B.stWest=V.west,B.stSouth=V.south}return B};const TY=new ee,xY=new ee,EY=new m,CY=new ie;function BL(e,t){const n=e._ellipsoid,i=t.height,r=t.width,s=t.northCap,o=t.southCap;let a=i,c=2,u=0,h=4;s&&(c-=1,a-=1,u+=1,h-=2),o&&(c-=1,a-=1,u+=1,h-=2),u+=c*r+2*a-h;const d=new Float64Array(u*3);let p=0,g=0,_;const b=EY;if(s)Wc.computePosition(t,n,!1,g,0,b),d[p++]=b.x,d[p++]=b.y,d[p++]=b.z;else for(_=0;_<r;_++)Wc.computePosition(t,n,!1,g,_,b),d[p++]=b.x,d[p++]=b.y,d[p++]=b.z;for(_=r-1,g=1;g<i;g++)Wc.computePosition(t,n,!1,g,_,b),d[p++]=b.x,d[p++]=b.y,d[p++]=b.z;if(g=i-1,!o)for(_=r-2;_>=0;_--)Wc.computePosition(t,n,!1,g,_,b),d[p++]=b.x,d[p++]=b.y,d[p++]=b.z;for(_=0,g=i-2;g>0;g--)Wc.computePosition(t,n,!1,g,_,b),d[p++]=b.x,d[p++]=b.y,d[p++]=b.z;const x=d.length/3*2,E=Ge.createTypedArray(d.length/3,x);let C=0;for(let S=0;S<d.length/3-1;S++)E[C++]=S,E[C++]=S+1;E[C++]=d.length/3-1,E[C++]=0;const w=new Ht({attributes:new Pu,primitiveType:Fe.LINES});return w.attributes.position=new Lt({componentDatatype:q.DOUBLE,componentsPerAttribute:3,values:d}),w.indices=E,w}function wY(e,t){const n=e._surfaceHeight,i=e._extrudedHeight,r=e._ellipsoid,s=BL(e,t),o=t.height,a=t.width,c=xi.scaleToGeodeticHeight(s.attributes.position.values,n,r,!1);let u=c.length;const h=new Float64Array(u*2);h.set(c);const d=xi.scaleToGeodeticHeight(s.attributes.position.values,i,r);h.set(d,u),s.attributes.position.values=h;const p=t.northCap,g=t.southCap;let _=4;p&&(_-=1),g&&(_-=1);const b=(h.length/3+_)*2,x=Ge.createTypedArray(h.length/3,b);u=h.length/6;let E=0;for(let w=0;w<u-1;w++)x[E++]=w,x[E++]=w+1,x[E++]=w+u,x[E++]=w+u+1;x[E++]=u-1,x[E++]=0,x[E++]=u+u-1,x[E++]=u,x[E++]=0,x[E++]=u;let C;if(p)C=o-1;else{const w=a-1;x[E++]=w,x[E++]=w+u,C=a+o-2}if(x[E++]=C,x[E++]=C+u,!g){const w=a+C-1;x[E++]=w,x[E]=w+u}return s.indices=x,s}function fh(e){e=T(e,T.EMPTY_OBJECT);const t=e.rectangle,n=T(e.granularity,R.RADIANS_PER_DEGREE),i=T(e.ellipsoid,fe.default),r=T(e.rotation,0);if(!l(t))throw new A("rectangle is required.");if(ie.validate(t),t.north<t.south)throw new A("options.rectangle.north must be greater than options.rectangle.south");const s=T(e.height,0),o=T(e.extrudedHeight,s);this._rectangle=ie.clone(t),this._granularity=n,this._ellipsoid=i,this._surfaceHeight=Math.max(s,o),this._rotation=r,this._extrudedHeight=Math.min(s,o),this._offsetAttribute=e.offsetAttribute,this._workerName="createRectangleOutlineGeometry"}fh.packedLength=ie.packedLength+fe.packedLength+5;fh.pack=function(e,t,n){if(!l(e))throw new A("value is required");if(!l(t))throw new A("array is required");return n=T(n,0),ie.pack(e._rectangle,t,n),n+=ie.packedLength,fe.pack(e._ellipsoid,t,n),n+=fe.packedLength,t[n++]=e._granularity,t[n++]=e._surfaceHeight,t[n++]=e._rotation,t[n++]=e._extrudedHeight,t[n]=T(e._offsetAttribute,-1),t};const zL=new ie,UL=fe.clone(fe.UNIT_SPHERE),rf={rectangle:zL,ellipsoid:UL,granularity:void 0,height:void 0,rotation:void 0,extrudedHeight:void 0,offsetAttribute:void 0};fh.unpack=function(e,t,n){if(!l(e))throw new A("array is required");t=T(t,0);const i=ie.unpack(e,t,zL);t+=ie.packedLength;const r=fe.unpack(e,t,UL);t+=fe.packedLength;const s=e[t++],o=e[t++],a=e[t++],c=e[t++],u=e[t];return l(n)?(n._rectangle=ie.clone(i,n._rectangle),n._ellipsoid=fe.clone(r,n._ellipsoid),n._surfaceHeight=o,n._rotation=a,n._extrudedHeight=c,n._offsetAttribute=u===-1?void 0:u,n):(rf.granularity=s,rf.height=o,rf.rotation=a,rf.extrudedHeight=c,rf.offsetAttribute=u===-1?void 0:u,new fh(rf))};const AY=new oe;fh.createGeometry=function(e){const t=e._rectangle,n=e._ellipsoid,i=Wc.computeOptions(t,e._granularity,e._rotation,0,CY,AY);let r,s;if(R.equalsEpsilon(t.north,t.south,R.EPSILON10)||R.equalsEpsilon(t.east,t.west,R.EPSILON10))return;const o=e._surfaceHeight,a=e._extrudedHeight,c=!R.equalsEpsilon(o,a,0,R.EPSILON2);let u;if(c){if(r=wY(e,i),l(e._offsetAttribute)){const p=r.attributes.position.values.length/3;let g=new Uint8Array(p);e._offsetAttribute===Js.TOP?g=g.fill(1,0,p/2):(u=e._offsetAttribute===Js.NONE?0:1,g=g.fill(u)),r.attributes.applyOffset=new Lt({componentDatatype:q.UNSIGNED_BYTE,componentsPerAttribute:1,values:g})}const h=ee.fromRectangle3D(t,n,o,xY),d=ee.fromRectangle3D(t,n,a,TY);s=ee.union(h,d)}else{if(r=BL(e,i),r.attributes.position.values=xi.scaleToGeodeticHeight(r.attributes.position.values,o,n,!1),l(e._offsetAttribute)){const h=r.attributes.position.values.length;u=e._offsetAttribute===Js.NONE?0:1;const d=new Uint8Array(h/3).fill(u);r.attributes.applyOffset=new Lt({componentDatatype:q.UNSIGNED_BYTE,componentsPerAttribute:1,values:d})}s=ee.fromRectangle3D(t,n,o)}return new Ht({attributes:r.attributes,indices:r.indices,primitiveType:Fe.LINES,boundingSphere:s,offsetAttribute:e._offsetAttribute})};const Ml=30,SY=1<<Ml,vY=1<<Ml+1>>>0,nw=2*Ml+1,qc=4,kL=[],jL=[],IY=[[0,1,3,2],[0,2,3,1],[3,2,0,1],[3,1,0,2]],Zc=1,Of=2,cg=[Zc,0,0,Zc|Of];function mn(e){if(!It.supportsBigInt())throw new te("S2 required BigInt support");if(!l(e))throw new A("cell ID is required.");if(!mn.isValidId(e))throw new A("cell ID is invalid.");this._cellId=e,this._level=mn.getLevel(e)}mn.fromToken=function(e){if(y.typeOf.string("token",e),!mn.isValidToken(e))throw new A("token is invalid.");return new mn(mn.getIdFromToken(e))};mn.isValidId=function(e){return y.typeOf.bigint("cellId",e),!(e<=0||e>>BigInt(nw)>5||!(e&~e+BigInt(1)&BigInt("0x1555555555555555")))};mn.isValidToken=function(e){return y.typeOf.string("token",e),/^[0-9a-fA-F]{1,16}$/.test(e)?mn.isValidId(mn.getIdFromToken(e)):!1};mn.getIdFromToken=function(e){return y.typeOf.string("token",e),BigInt("0x"+e+"0".repeat(16-e.length))};mn.getTokenFromId=function(e){y.typeOf.bigint("cellId",e);const t=Math.floor(zY(e)/4),n=e.toString(16).replace(/0*$/,"");return Array(17-t-n.length).join("0")+n};mn.getLevel=function(e){if(y.typeOf.bigint("cellId",e),!mn.isValidId(e))throw new A;let t=0;for(;e!==BigInt(0)&&!(e&BigInt(1));)t++,e=e>>BigInt(1);return Ml-(t>>1)};mn.prototype.getChild=function(e){if(y.typeOf.number("index",e),e<0||e>3)throw new A("child index must be in the range [0-3].");if(this._level===30)throw new A("cannot get child of leaf cell.");const t=HL(this._cellId)>>BigInt(2),n=this._cellId+BigInt(2*e+1-4)*t;return new mn(n)};mn.prototype.getParent=function(){if(this._level===0)throw new A("cannot get parent of root cell.");const e=HL(this._cellId)<<BigInt(2);return new mn(this._cellId&~e+BigInt(1)|e)};mn.prototype.getParentAtLevel=function(e){if(this._level===0||e<0||this._level<e)throw new A("cannot get parent at invalid level.");const t=FY(e);return new mn(this._cellId&-t|t)};mn.prototype.getCenter=function(e){e=T(e,fe.WGS84);let t=OY(this._cellId,this._level);t=m.normalize(t,t);const n=new oe.fromCartesian(t,fe.UNIT_SPHERE);return oe.toCartesian(n,e,new m)};mn.prototype.getVertex=function(e,t){if(y.typeOf.number("index",e),e<0||e>3)throw new A("vertex index must be in the range [0-3].");t=T(t,fe.WGS84);let n=RY(this._cellId,this._level,e);n=m.normalize(n,n);const i=new oe.fromCartesian(n,fe.UNIT_SPHERE);return oe.toCartesian(i,t,new m)};mn.fromFacePositionLevel=function(e,t,n){if(y.typeOf.bigint("position",t),e<0||e>5)throw new A("Invalid S2 Face (must be within 0-5)");if(n<0||n>Ml)throw new A("Invalid level (must be within 0-30)");if(t<0||t>=Math.pow(4,n))throw new A("Invalid Hilbert position for level");const i=(e<4?"0":"")+(e<2?"0":"")+e.toString(2),r=t.toString(2),s=Array(2*n-r.length+1).join("0"),o=Array(nw-2*n).join("0"),a=BigInt(`0b${i}${s}${r}1${o}`);return new mn(a)};function OY(e,t){const n=DY(e,t);return MY(n[0],n[1],n[2])}function RY(e,t,n){const i=VL(e),r=LY([i[1],i[2]],t),s=n>>1&1;return GL(i[0],r[0][s^n&1],r[1][s])}function DY(e,t){const n=VL(e),i=n[0],r=n[1],s=n[2],o=t===30,a=!o&&(BigInt(r)^e>>BigInt(2))&BigInt(1),c=o?1:a?2:0,u=(r<<1)+c,h=(s<<1)+c;return[i,u,h]}function VL(e){kL.length===0&&NY();const t=Number(e>>BigInt(nw));let n=t&Zc;const i=(1<<qc)-1;let r=0,s=0;for(let o=7;o>=0;o--){const c=(1<<2*(o===7?Ml-7*qc:qc))-1;n+=Number(e>>BigInt(o*2*qc+1)&BigInt(c))<<2,n=jL[n];const u=o*qc;r+=n>>qc+2<<u,s+=(n>>2&i)<<u,n&=Zc|Of}return[t,r,s]}function MY(e,t,n){const i=UI(t),r=UI(n),s=X_(i),o=X_(r);return GL(e,s,o)}function GL(e,t,n){switch(e){case 0:return new m(1,t,n);case 1:return new m(-t,1,n);case 2:return new m(-t,-n,1);case 3:return new m(-1,-n,-t);case 4:return new m(n,-1,-t);default:return new m(n,t,-1)}}function X_(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function UI(e){return 1/vY*e}function LY(e,t){const n=[[],[]],i=PY(t);for(let r=0;r<2;++r){const s=e[r]&-i,o=s+i;n[r][0]=X_(kI(s)),n[r][1]=X_(kI(o))}return n}function PY(e){return 1<<Ml-e>>>0}function kI(e){return 1/SY*e}function Jc(e,t,n,i,r,s){if(e===qc){const o=(t<<qc)+n;kL[(o<<2)+i]=(r<<2)+s,jL[(r<<2)+i]=(o<<2)+s}else{e++,t<<=1,n<<=1,r<<=2;const o=IY[s];Jc(e,t+(o[0]>>1),n+(o[0]&1),i,r,s^cg[0]),Jc(e,t+(o[1]>>1),n+(o[1]&1),i,r+1,s^cg[1]),Jc(e,t+(o[2]>>1),n+(o[2]&1),i,r+2,s^cg[2]),Jc(e,t+(o[3]>>1),n+(o[3]&1),i,r+3,s^cg[3])}}function NY(){Jc(0,0,0,0,0,0),Jc(0,0,0,Zc,0,Zc),Jc(0,0,0,Of,0,Of),Jc(0,0,0,Zc|Of,0,Zc|Of)}function HL(e){return e&~e+BigInt(1)}function FY(e){return BigInt(1)<<BigInt(2*(Ml-e))}const BY=[64,0,1,39,2,15,40,23,3,12,16,59,41,19,24,54,4,64,13,10,17,62,60,28,42,30,20,51,25,44,55,47,5,32,65,38,14,22,11,58,18,53,63,9,61,27,29,50,43,46,31,37,21,57,52,8,26,49,45,36,56,7,48,35,6,34,33,0];function zY(e){return BY[(-e&e)%BigInt(67)]}function hh(e){const t=T(e.radius,1),i={radii:new m(t,t,t),stackPartitions:e.stackPartitions,slicePartitions:e.slicePartitions,subdivisions:e.subdivisions};this._ellipsoidGeometry=new no(i),this._workerName="createSphereOutlineGeometry"}hh.packedLength=no.packedLength;hh.pack=function(e,t,n){return y.typeOf.object("value",e),no.pack(e._ellipsoidGeometry,t,n)};const UY=new no,$l={radius:void 0,radii:new m,stackPartitions:void 0,slicePartitions:void 0,subdivisions:void 0};hh.unpack=function(e,t,n){const i=no.unpack(e,t,UY);return $l.stackPartitions=i._stackPartitions,$l.slicePartitions=i._slicePartitions,$l.subdivisions=i._subdivisions,l(n)?(m.clone(i._radii,$l.radii),n._ellipsoidGeometry=new no($l),n):($l.radius=i._radii.x,new hh($l))};hh.createGeometry=function(e){return no.createGeometry(e._ellipsoidGeometry)};function Rh(e){e=T(e,T.EMPTY_OBJECT);const t=e.points,n=e.times;if(!l(t)||!l(n))throw new A("points and times are required.");if(t.length<2)throw new A("points.length must be greater than or equal to 2.");if(n.length!==t.length)throw new A("times.length must be equal to points.length.");this._times=n,this._points=t,this._pointType=Mn.getPointType(t[0]),this._lastTimeIndex=0}Object.defineProperties(Rh.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}}});Rh.prototype.findTimeInterval=Mn.prototype.findTimeInterval;Rh.prototype.wrapTime=Mn.prototype.wrapTime;Rh.prototype.clampTime=Mn.prototype.clampTime;Rh.prototype.evaluate=function(e,t){const n=this.points;this._lastTimeIndex=this.findTimeInterval(e,this._lastTimeIndex);const i=this._lastTimeIndex,r=this._pointType;return r===Number?n[i]:(l(t)||(t=new r),r.clone(n[i],t))};const kY=new m(1,1,1),jY=m.ZERO,VY=re.IDENTITY;function qL(e,t,n){this.translation=m.clone(T(e,jY)),this.rotation=re.clone(T(t,VY)),this.scale=m.clone(T(n,kY))}qL.prototype.equals=function(e){return this===e||l(e)&&m.equals(this.translation,e.translation)&&re.equals(this.rotation,e.rotation)&&m.equals(this.scale,e.scale)};const Wy={};function GY(e){const t=Ge.createTypedArray(e,e*2),n=e;let i=0;for(let r=0;r<n;r+=3)t[i++]=r,t[i++]=r+1,t[i++]=r+1,t[i++]=r+2,t[i++]=r+2,t[i++]=r;return t}function HY(e,t){const n=t.length,i=Ge.createTypedArray(e,n*2);let r=0;for(let s=0;s<n;s+=3){const o=t[s],a=t[s+1],c=t[s+2];i[r++]=o,i[r++]=a,i[r++]=a,i[r++]=c,i[r++]=c,i[r++]=o}return i}function qY(e){const t=e-2,n=2+t*4,i=Ge.createTypedArray(e,n);let r=0;i[r++]=0,i[r++]=1;for(let s=0;s<t;s++)i[r++]=s+1,i[r++]=s+2,i[r++]=s+2,i[r++]=s;return i}function WY(e,t){const i=t.length-2,r=2+i*4,s=Ge.createTypedArray(e,r);let o=0;s[o++]=t[0],s[o++]=t[1];for(let a=0;a<i;a++){const c=t[a],u=t[a+1],h=t[a+2];s[o++]=u,s[o++]=h,s[o++]=h,s[o++]=c}return s}function $Y(e){const t=e-2,n=2+t*4,i=Ge.createTypedArray(e,n);let r=0;i[r++]=0,i[r++]=1;for(let s=0;s<t;s++)i[r++]=s+1,i[r++]=s+2,i[r++]=s+2,i[r++]=0;return i}function XY(e,t){const i=t.length-2,r=2+i*4,s=Ge.createTypedArray(e,r);let o=0;const a=t[0];s[o++]=a,s[o++]=t[1];for(let c=0;c<i;c++){const u=t[c+1],h=t[c+2];s[o++]=u,s[o++]=h,s[o++]=h,s[o++]=a}return s}Wy.createWireframeIndices=function(e,t,n){const i=l(n);if(e===Fe.TRIANGLES)return i?HY(t,n):GY(t);if(e===Fe.TRIANGLE_STRIP)return i?WY(t,n):qY(t);if(e===Fe.TRIANGLE_FAN)return i?XY(t,n):$Y(t)};Wy.getWireframeIndicesCount=function(e,t){return e===Fe.TRIANGLES?t*2:e===Fe.TRIANGLE_STRIP||e===Fe.TRIANGLE_FAN?2+(t-2)*4:t};function dc(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}const B0=32767,YY=new oe,KY=new m;function ZY(e,t,n,i,r){const s=e.length/3,o=e.subarray(0,s),a=e.subarray(s,2*s),c=e.subarray(2*s,3*s);nt.zigZagDeltaDecode(o,a,c);const u=new Float64Array(e.length);for(let h=0;h<s;++h){const d=o[h],p=a[h],g=c[h],_=R.lerp(t.west,t.east,d/B0),b=R.lerp(t.south,t.north,p/B0),x=R.lerp(n,i,g/B0),E=oe.fromRadians(_,b,x,YY),C=r.cartographicToCartesian(E,KY);m.pack(C,u,h*3)}return u}function pc(e,t){if(!l(e)||!l(t))throw new A("identifier and message are required.");kr(e,t)}function $y(e,t){return t=T(t,0),gs(e,t,Math.min(4,e.length))}function JY(e){const t=e.uint8Array,n=e.format,i=e.request,r=T(e.flipY,!1),s=T(e.skipColorSpaceConversion,!1);y.typeOf.object("uint8Array",t),y.typeOf.string("format",n);const o=new Blob([t],{type:n});let a;return se.supportsImageBitmapOptions().then(function(c){return c?Promise.resolve(se.createImageBitmapFromBlob(o,{flipY:r,premultiplyAlpha:!1,skipColorSpaceConversion:s})):(a=window.URL.createObjectURL(o),new se({url:a,request:i}).fetchImage({flipY:r,skipColorSpaceConversion:s}))}).then(function(c){return l(a)&&window.URL.revokeObjectURL(a),c}).catch(function(c){return l(a)&&window.URL.revokeObjectURL(a),Promise.reject(c)})}let WL;Dh.setKTX2SupportedFormats=function(e,t,n,i,r,s){WL={s3tc:e,pvrtc:t,astc:n,etc:i,etc1:r,bc7:s}};function Dh(e){y.defined("resourceOrUrlOrBuffer",e);let t;return e instanceof ArrayBuffer||ArrayBuffer.isView(e)?t=Promise.resolve(e):t=se.createIfNeeded(e).fetchArrayBuffer(),t.then(function(n){return Xa.transcode(n,WL)})}function QY(e){const t=document.createElement("canvas");return t.width=R.nextPowerOfTwo(e.width),t.height=R.nextPowerOfTwo(e.height),t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),t}function eK(e,t){if(!l(e))throw new A("array is required.");if(!l(t)||t<1)throw new A("numberOfArrays must be greater than 0.");const n=[],i=e.length;let r=0;for(;r<i;){const s=Math.ceil((i-r)/t--);n.push(e.slice(r,r+s)),r+=s}return n}const tK=new m;function be(e){this._size=e.size,this._datatype=e.datatype,this.getValue=e.getValue}const Yi={};Yi[j.FLOAT]="float";Yi[j.FLOAT_VEC2]="vec2";Yi[j.FLOAT_VEC3]="vec3";Yi[j.FLOAT_VEC4]="vec4";Yi[j.INT]="int";Yi[j.INT_VEC2]="ivec2";Yi[j.INT_VEC3]="ivec3";Yi[j.INT_VEC4]="ivec4";Yi[j.BOOL]="bool";Yi[j.BOOL_VEC2]="bvec2";Yi[j.BOOL_VEC3]="bvec3";Yi[j.BOOL_VEC4]="bvec4";Yi[j.FLOAT_MAT2]="mat2";Yi[j.FLOAT_MAT3]="mat3";Yi[j.FLOAT_MAT4]="mat4";Yi[j.SAMPLER_2D]="sampler2D";Yi[j.SAMPLER_CUBE]="samplerCube";be.prototype.getDeclaration=function(e){let t=`uniform ${Yi[this._datatype]} ${e}`;const n=this._size;return n===1?t+=";":t+=`[${n.toString()}];`,t};const e_={czm_viewport:new be({size:1,datatype:j.FLOAT_VEC4,getValue:function(e){return e.viewportCartesian4}}),czm_viewportOrthographic:new be({size:1,datatype:j.FLOAT_MAT4,getValue:function(e){return e.viewportOrthographic}}),czm_viewportTransformation:new be({size:1,datatype:j.FLOAT_MAT4,getValue:function(e){return e.viewportTransformation}}),czm_globeDepthTexture:new be({size:1,datatype:j.SAMPLER_2D,getValue:function(e){return e.globeDepthTexture}}),czm_model:new be({size:1,datatype:j.FLOAT_MAT4,getValue:function(e){return e.model}}),czm_inverseModel:new be({size:1,datatype:j.FLOAT_MAT4,getValue:function(e){return e.inverseModel}}),czm_view:new be({size:1,datatype:j.FLOAT_MAT4,getValue:function(e){return e.view}}),czm_view3D:new be({size:1,datatype:j.FLOAT_MAT4,getValue:function(e){return e.view3D}}),czm_viewRotation:new be({size:1,datatype:j.FLOAT_MAT3,getValue:function(e){return e.viewRotation}}),czm_viewRotation3D:new be({size:1,datatype:j.FLOAT_MAT3,getValue:function(e){return e.viewRotation3D}}),czm_inverseView:new be({size:1,datatype:j.FLOAT_MAT4,getValue:function(e){return e.inverseView}}),czm_inverseView3D:new be({size:1,datatype:j.FLOAT_MAT4,getValue:function(e){return e.inverseView3D}}),czm_inverseViewRotation:new be({size:1,datatype:j.FLOAT_MAT3,getValue:function(e){return e.inverseViewRotation}}),czm_inverseViewRotation3D:new be({size:1,datatype:j.FLOAT_MAT3,getValue:function(e){return e.inverseViewRotation3D}}),czm_projection:new be({size:1,datatype:j.FLOAT_MAT4,getValue:function(e){return e.projection}}),czm_inverseProjection:new be({size:1,datatype:j.FLOAT_MAT4,getValue:function(e){return e.inverseProjection}}),czm_infiniteProjection:new be({size:1,datatype:j.FLOAT_MAT4,getValue:function(e){return e.infiniteProjection}}),czm_modelView:new be({size:1,datatype:j.FLOAT_MAT4,getValue:function(e){return e.modelView}}),czm_modelView3D:new be({size:1,datatype:j.FLOAT_MAT4,getValue:function(e){return e.modelView3D}}),czm_modelViewRelativeToEye:new be({size:1,datatype:j.FLOAT_MAT4,getValue:function(e){return e.modelViewRelativeToEye}}),czm_inverseModelView:new be({size:1,datatype:j.FLOAT_MAT4,getValue:function(e){return e.inverseModelView}}),czm_inverseModelView3D:new be({size:1,datatype:j.FLOAT_MAT4,getValue:function(e){return e.inverseModelView3D}}),czm_viewProjection:new be({size:1,datatype:j.FLOAT_MAT4,getValue:function(e){return e.viewProjection}}),czm_inverseViewProjection:new be({size:1,datatype:j.FLOAT_MAT4,getValue:function(e){return e.inverseViewProjection}}),czm_modelViewProjection:new be({size:1,datatype:j.FLOAT_MAT4,getValue:function(e){return e.modelViewProjection}}),czm_inverseModelViewProjection:new be({size:1,datatype:j.FLOAT_MAT4,getValue:function(e){return e.inverseModelViewProjection}}),czm_modelViewProjectionRelativeToEye:new be({size:1,datatype:j.FLOAT_MAT4,getValue:function(e){return e.modelViewProjectionRelativeToEye}}),czm_modelViewInfiniteProjection:new be({size:1,datatype:j.FLOAT_MAT4,getValue:function(e){return e.modelViewInfiniteProjection}}),czm_orthographicIn3D:new be({size:1,datatype:j.FLOAT,getValue:function(e){return e.orthographicIn3D?1:0}}),czm_normal:new be({size:1,datatype:j.FLOAT_MAT3,getValue:function(e){return e.normal}}),czm_normal3D:new be({size:1,datatype:j.FLOAT_MAT3,getValue:function(e){return e.normal3D}}),czm_inverseNormal:new be({size:1,datatype:j.FLOAT_MAT3,getValue:function(e){return e.inverseNormal}}),czm_inverseNormal3D:new be({size:1,datatype:j.FLOAT_MAT3,getValue:function(e){return e.inverseNormal3D}}),czm_eyeHeight:new be({size:1,datatype:j.FLOAT,getValue:function(e){return e.eyeHeight}}),czm_eyeHeight2D:new be({size:1,datatype:j.FLOAT_VEC2,getValue:function(e){return e.eyeHeight2D}}),czm_eyeEllipsoidNormalEC:new be({size:1,datatype:j.FLOAT_VEC3,getValue:function(e){return e.eyeEllipsoidNormalEC}}),czm_eyeEllipsoidCurvature:new be({size:1,datatype:j.FLOAT_VEC2,getValue:function(e){return e.eyeEllipsoidCurvature}}),czm_modelToEnu:new be({size:1,datatype:j.FLOAT_MAT4,getValue:function(e){return e.modelToEnu}}),czm_enuToModel:new be({size:1,datatype:j.FLOAT_MAT4,getValue:function(e){return e.enuToModel}}),czm_entireFrustum:new be({size:1,datatype:j.FLOAT_VEC2,getValue:function(e){return e.entireFrustum}}),czm_currentFrustum:new be({size:1,datatype:j.FLOAT_VEC2,getValue:function(e){return e.currentFrustum}}),czm_frustumPlanes:new be({size:1,datatype:j.FLOAT_VEC4,getValue:function(e){return e.frustumPlanes}}),czm_farDepthFromNearPlusOne:new be({size:1,datatype:j.FLOAT,getValue:function(e){return e.farDepthFromNearPlusOne}}),czm_log2FarDepthFromNearPlusOne:new be({size:1,datatype:j.FLOAT,getValue:function(e){return e.log2FarDepthFromNearPlusOne}}),czm_oneOverLog2FarDepthFromNearPlusOne:new be({size:1,datatype:j.FLOAT,getValue:function(e){return e.oneOverLog2FarDepthFromNearPlusOne}}),czm_sunPositionWC:new be({size:1,datatype:j.FLOAT_VEC3,getValue:function(e){return e.sunPositionWC}}),czm_sunPositionColumbusView:new be({size:1,datatype:j.FLOAT_VEC3,getValue:function(e){return e.sunPositionColumbusView}}),czm_sunDirectionEC:new be({size:1,datatype:j.FLOAT_VEC3,getValue:function(e){return e.sunDirectionEC}}),czm_sunDirectionWC:new be({size:1,datatype:j.FLOAT_VEC3,getValue:function(e){return e.sunDirectionWC}}),czm_moonDirectionEC:new be({size:1,datatype:j.FLOAT_VEC3,getValue:function(e){return e.moonDirectionEC}}),czm_lightDirectionEC:new be({size:1,datatype:j.FLOAT_VEC3,getValue:function(e){return e.lightDirectionEC}}),czm_lightDirectionWC:new be({size:1,datatype:j.FLOAT_VEC3,getValue:function(e){return e.lightDirectionWC}}),czm_lightColor:new be({size:1,datatype:j.FLOAT_VEC3,getValue:function(e){return e.lightColor}}),czm_lightColorHdr:new be({size:1,datatype:j.FLOAT_VEC3,getValue:function(e){return e.lightColorHdr}}),czm_encodedCameraPositionMCHigh:new be({size:1,datatype:j.FLOAT_VEC3,getValue:function(e){return e.encodedCameraPositionMCHigh}}),czm_encodedCameraPositionMCLow:new be({size:1,datatype:j.FLOAT_VEC3,getValue:function(e){return e.encodedCameraPositionMCLow}}),czm_viewerPositionWC:new be({size:1,datatype:j.FLOAT_VEC3,getValue:function(e){return P.getTranslation(e.inverseView,tK)}}),czm_frameNumber:new be({size:1,datatype:j.FLOAT,getValue:function(e){return e.frameState.frameNumber}}),czm_morphTime:new be({size:1,datatype:j.FLOAT,getValue:function(e){return e.frameState.morphTime}}),czm_sceneMode:new be({size:1,datatype:j.FLOAT,getValue:function(e){return e.frameState.mode}}),czm_pass:new be({size:1,datatype:j.FLOAT,getValue:function(e){return e.pass}}),czm_backgroundColor:new be({size:1,datatype:j.FLOAT_VEC4,getValue:function(e){return e.backgroundColor}}),czm_brdfLut:new be({size:1,datatype:j.SAMPLER_2D,getValue:function(e){return e.brdfLut}}),czm_environmentMap:new be({size:1,datatype:j.SAMPLER_CUBE,getValue:function(e){return e.environmentMap}}),czm_specularEnvironmentMaps:new be({size:1,datatype:j.SAMPLER_2D,getValue:function(e){return e.specularEnvironmentMaps}}),czm_specularEnvironmentMapSize:new be({size:1,datatype:j.FLOAT_VEC2,getValue:function(e){return e.specularEnvironmentMapsDimensions}}),czm_specularEnvironmentMapsMaximumLOD:new be({size:1,datatype:j.FLOAT,getValue:function(e){return e.specularEnvironmentMapsMaximumLOD}}),czm_sphericalHarmonicCoefficients:new be({size:9,datatype:j.FLOAT_VEC3,getValue:function(e){return e.sphericalHarmonicCoefficients}}),czm_temeToPseudoFixed:new be({size:1,datatype:j.FLOAT_MAT3,getValue:function(e){return e.temeToPseudoFixedMatrix}}),czm_pixelRatio:new be({size:1,datatype:j.FLOAT,getValue:function(e){return e.pixelRatio}}),czm_fogDensity:new be({size:1,datatype:j.FLOAT,getValue:function(e){return e.fogDensity}}),czm_fogMinimumBrightness:new be({size:1,datatype:j.FLOAT,getValue:function(e){return e.fogMinimumBrightness}}),czm_atmosphereHsbShift:new be({size:1,datatype:j.FLOAT_VEC3,getValue:function(e){return e.atmosphereHsbShift}}),czm_atmosphereLightIntensity:new be({size:1,datatype:j.FLOAT,getValue:function(e){return e.atmosphereLightIntensity}}),czm_atmosphereRayleighCoefficient:new be({size:1,datatype:j.FLOAT_VEC3,getValue:function(e){return e.atmosphereRayleighCoefficient}}),czm_atmosphereRayleighScaleHeight:new be({size:1,datatype:j.FLOAT,getValue:function(e){return e.atmosphereRayleighScaleHeight}}),czm_atmosphereMieCoefficient:new be({size:1,datatype:j.FLOAT_VEC3,getValue:function(e){return e.atmosphereMieCoefficient}}),czm_atmosphereMieScaleHeight:new be({size:1,datatype:j.FLOAT,getValue:function(e){return e.atmosphereMieScaleHeight}}),czm_atmosphereMieAnisotropy:new be({size:1,datatype:j.FLOAT,getValue:function(e){return e.atmosphereMieAnisotropy}}),czm_atmosphereDynamicLighting:new be({size:1,datatype:j.FLOAT,getValue:function(e){return e.atmosphereDynamicLighting}}),czm_splitPosition:new be({size:1,datatype:j.FLOAT,getValue:function(e){return e.splitPosition}}),czm_geometricToleranceOverMeter:new be({size:1,datatype:j.FLOAT,getValue:function(e){return e.geometricToleranceOverMeter}}),czm_minimumDisableDepthTestDistance:new be({size:1,datatype:j.FLOAT,getValue:function(e){return e.minimumDisableDepthTestDistance}}),czm_invertClassificationColor:new be({size:1,datatype:j.FLOAT_VEC4,getValue:function(e){return e.invertClassificationColor}}),czm_gamma:new be({size:1,datatype:j.FLOAT,getValue:function(e){return e.gamma}}),czm_ellipsoidRadii:new be({size:1,datatype:j.FLOAT_VEC3,getValue:function(e){return e.ellipsoid.radii}}),czm_ellipsoidInverseRadii:new be({size:1,datatype:j.FLOAT_VEC3,getValue:function(e){return e.ellipsoid.oneOverRadii}})},t_={STREAM_DRAW:j.STREAM_DRAW,STATIC_DRAW:j.STATIC_DRAW,DYNAMIC_DRAW:j.DYNAMIC_DRAW,validate:function(e){return e===t_.STREAM_DRAW||e===t_.STATIC_DRAW||e===t_.DYNAMIC_DRAW}},Ae=Object.freeze(t_);function ze(e){if(e=T(e,T.EMPTY_OBJECT),y.defined("options.context",e.context),!l(e.typedArray)&&!l(e.sizeInBytes))throw new A("Either options.sizeInBytes or options.typedArray is required.");if(l(e.typedArray)&&l(e.sizeInBytes))throw new A("Cannot pass in both options.sizeInBytes and options.typedArray.");if(l(e.typedArray)&&(y.typeOf.object("options.typedArray",e.typedArray),y.typeOf.number("options.typedArray.byteLength",e.typedArray.byteLength)),!Ae.validate(e.usage))throw new A("usage is invalid.");const t=e.context._gl,n=e.bufferTarget,i=e.typedArray;let r=e.sizeInBytes;const s=e.usage,o=l(i);o&&(r=i.byteLength),y.typeOf.number.greaterThan("sizeInBytes",r,0);const a=t.createBuffer();t.bindBuffer(n,a),t.bufferData(n,o?i:r,s),t.bindBuffer(n,null),this._id=dc(),this._gl=t,this._webgl2=e.context._webgl2,this._bufferTarget=n,this._sizeInBytes=r,this._usage=s,this._buffer=a,this.vertexArrayDestroyable=!0}ze.createVertexBuffer=function(e){return y.defined("options.context",e.context),new ze({context:e.context,bufferTarget:j.ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage})};ze.createIndexBuffer=function(e){if(y.defined("options.context",e.context),!Ge.validate(e.indexDatatype))throw new A("Invalid indexDatatype.");if(e.indexDatatype===Ge.UNSIGNED_INT&&!e.context.elementIndexUint)throw new A("IndexDatatype.UNSIGNED_INT requires OES_element_index_uint, which is not supported on this system.  Check context.elementIndexUint.");const t=e.context,n=e.indexDatatype,i=Ge.getSizeInBytes(n),r=new ze({context:t,bufferTarget:j.ELEMENT_ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage}),s=r.sizeInBytes/i;return Object.defineProperties(r,{indexDatatype:{get:function(){return n}},bytesPerIndex:{get:function(){return i}},numberOfIndices:{get:function(){return s}}}),r};Object.defineProperties(ze.prototype,{sizeInBytes:{get:function(){return this._sizeInBytes}},usage:{get:function(){return this._usage}}});ze.prototype._getBuffer=function(){return this._buffer};ze.prototype.copyFromArrayView=function(e,t){t=T(t,0),y.defined("arrayView",e),y.typeOf.number.lessThanOrEquals("offsetInBytes + arrayView.byteLength",t+e.byteLength,this._sizeInBytes);const n=this._gl,i=this._bufferTarget;n.bindBuffer(i,this._buffer),n.bufferSubData(i,t,e),n.bindBuffer(i,null)};ze.prototype.copyFromBuffer=function(e,t,n,i){if(!this._webgl2)throw new A("A WebGL 2 context is required.");if(!l(e))throw new A("readBuffer must be defined.");if(!l(i)||i<=0)throw new A("sizeInBytes must be defined and be greater than zero.");if(!l(t)||t<0||t+i>e._sizeInBytes)throw new A("readOffset must be greater than or equal to zero and readOffset + sizeInBytes must be less than of equal to readBuffer.sizeInBytes.");if(!l(n)||n<0||n+i>this._sizeInBytes)throw new A("writeOffset must be greater than or equal to zero and writeOffset + sizeInBytes must be less than of equal to this.sizeInBytes.");if(this._buffer===e._buffer&&(n>=t&&n<t+i||t>n&&t<n+i))throw new A("When readBuffer is equal to this, the ranges [readOffset + sizeInBytes) and [writeOffset, writeOffset + sizeInBytes) must not overlap.");if(this._bufferTarget===j.ELEMENT_ARRAY_BUFFER&&e._bufferTarget!==j.ELEMENT_ARRAY_BUFFER||this._bufferTarget!==j.ELEMENT_ARRAY_BUFFER&&e._bufferTarget===j.ELEMENT_ARRAY_BUFFER)throw new A("Can not copy an index buffer into another buffer type.");const r=j.COPY_READ_BUFFER,s=j.COPY_WRITE_BUFFER,o=this._gl;o.bindBuffer(s,this._buffer),o.bindBuffer(r,e._buffer),o.copyBufferSubData(r,s,t,n,i),o.bindBuffer(s,null),o.bindBuffer(r,null)};ze.prototype.getBufferData=function(e,t,n,i){if(t=T(t,0),n=T(n,0),!this._webgl2)throw new A("A WebGL 2 context is required.");if(!l(e))throw new A("arrayView is required.");let r,s,o=e.byteLength;if(l(i)?(r=i,l(o)?s=1:(o=e.length,s=e.BYTES_PER_ELEMENT)):l(o)?(r=o-n,s=1):(o=e.length,r=o-n,s=e.BYTES_PER_ELEMENT),n<0||n>o)throw new A("destinationOffset must be greater than zero and less than the arrayView length.");if(n+r>o)throw new A("destinationOffset + length must be less than or equal to the arrayViewLength.");if(t<0||t>this._sizeInBytes)throw new A("sourceOffset must be greater than zero and less than the buffers size.");if(t+r*s>this._sizeInBytes)throw new A("sourceOffset + length must be less than the buffers size.");const a=this._gl,c=j.COPY_READ_BUFFER;a.bindBuffer(c,this._buffer),a.getBufferSubData(c,t,e,n,i),a.bindBuffer(c,null)};ze.prototype.isDestroyed=function(){return!1};ze.prototype.destroy=function(){return this._gl.deleteBuffer(this._buffer),Ye(this)};function vp(e){e=T(e,T.EMPTY_OBJECT),this.color=e.color,this.depth=e.depth,this.stencil=e.stencil,this.renderState=e.renderState,this.framebuffer=e.framebuffer,this.owner=e.owner,this.pass=e.pass}vp.ALL=Object.freeze(new vp({color:new M(0,0,0,0),depth:1,stencil:0}));vp.prototype.execute=function(e,t){e.clear(this,t)};const nK={ENVIRONMENT:0,COMPUTE:1,GLOBE:2,TERRAIN_CLASSIFICATION:3,CESIUM_3D_TILE:4,CESIUM_3D_TILE_CLASSIFICATION:5,CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW:6,OPAQUE:7,TRANSLUCENT:8,VOXELS:9,OVERLAY:10,NUMBER_OF_PASSES:11},Ke=Object.freeze(nK);function Ip(e){e=T(e,T.EMPTY_OBJECT),this.vertexArray=e.vertexArray,this.fragmentShaderSource=e.fragmentShaderSource,this.shaderProgram=e.shaderProgram,this.uniformMap=e.uniformMap,this.outputTexture=e.outputTexture,this.preExecute=e.preExecute,this.postExecute=e.postExecute,this.canceled=e.canceled,this.persists=T(e.persists,!1),this.pass=Ke.COMPUTE,this.owner=e.owner}Ip.prototype.execute=function(e){e.execute(this)};const Gn={CULL:1,OCCLUDE:2,EXECUTE_IN_CLOSEST_FRUSTUM:4,DEBUG_SHOW_BOUNDING_VOLUME:8,CAST_SHADOWS:16,RECEIVE_SHADOWS:32,PICK_ONLY:64,DEPTH_FOR_TRANSLUCENT_CLASSIFICATION:128};function Tt(e){e=T(e,T.EMPTY_OBJECT),this._boundingVolume=e.boundingVolume,this._orientedBoundingBox=e.orientedBoundingBox,this._modelMatrix=e.modelMatrix,this._primitiveType=T(e.primitiveType,Fe.TRIANGLES),this._vertexArray=e.vertexArray,this._count=e.count,this._offset=T(e.offset,0),this._instanceCount=T(e.instanceCount,0),this._shaderProgram=e.shaderProgram,this._uniformMap=e.uniformMap,this._renderState=e.renderState,this._framebuffer=e.framebuffer,this._pass=e.pass,this._owner=e.owner,this._debugOverlappingFrustums=0,this._pickId=e.pickId,this._flags=0,this.cull=T(e.cull,!0),this.occlude=T(e.occlude,!0),this.executeInClosestFrustum=T(e.executeInClosestFrustum,!1),this.debugShowBoundingVolume=T(e.debugShowBoundingVolume,!1),this.castShadows=T(e.castShadows,!1),this.receiveShadows=T(e.receiveShadows,!1),this.pickOnly=T(e.pickOnly,!1),this.depthForTranslucentClassification=T(e.depthForTranslucentClassification,!1),this.dirty=!0,this.lastDirtyTime=0,this.derivedCommands={}}function dr(e,t){return(e._flags&t)===t}function Nc(e,t,n){n?e._flags|=t:e._flags&=~t}Object.defineProperties(Tt.prototype,{boundingVolume:{get:function(){return this._boundingVolume},set:function(e){this._boundingVolume!==e&&(this._boundingVolume=e,this.dirty=!0)}},orientedBoundingBox:{get:function(){return this._orientedBoundingBox},set:function(e){this._orientedBoundingBox!==e&&(this._orientedBoundingBox=e,this.dirty=!0)}},cull:{get:function(){return dr(this,Gn.CULL)},set:function(e){dr(this,Gn.CULL)!==e&&(Nc(this,Gn.CULL,e),this.dirty=!0)}},occlude:{get:function(){return dr(this,Gn.OCCLUDE)},set:function(e){dr(this,Gn.OCCLUDE)!==e&&(Nc(this,Gn.OCCLUDE,e),this.dirty=!0)}},modelMatrix:{get:function(){return this._modelMatrix},set:function(e){this._modelMatrix!==e&&(this._modelMatrix=e,this.dirty=!0)}},primitiveType:{get:function(){return this._primitiveType},set:function(e){this._primitiveType!==e&&(this._primitiveType=e,this.dirty=!0)}},vertexArray:{get:function(){return this._vertexArray},set:function(e){this._vertexArray!==e&&(this._vertexArray=e,this.dirty=!0)}},count:{get:function(){return this._count},set:function(e){this._count!==e&&(this._count=e,this.dirty=!0)}},offset:{get:function(){return this._offset},set:function(e){this._offset!==e&&(this._offset=e,this.dirty=!0)}},instanceCount:{get:function(){return this._instanceCount},set:function(e){this._instanceCount!==e&&(this._instanceCount=e,this.dirty=!0)}},shaderProgram:{get:function(){return this._shaderProgram},set:function(e){this._shaderProgram!==e&&(this._shaderProgram=e,this.dirty=!0)}},castShadows:{get:function(){return dr(this,Gn.CAST_SHADOWS)},set:function(e){dr(this,Gn.CAST_SHADOWS)!==e&&(Nc(this,Gn.CAST_SHADOWS,e),this.dirty=!0)}},receiveShadows:{get:function(){return dr(this,Gn.RECEIVE_SHADOWS)},set:function(e){dr(this,Gn.RECEIVE_SHADOWS)!==e&&(Nc(this,Gn.RECEIVE_SHADOWS,e),this.dirty=!0)}},uniformMap:{get:function(){return this._uniformMap},set:function(e){this._uniformMap!==e&&(this._uniformMap=e,this.dirty=!0)}},renderState:{get:function(){return this._renderState},set:function(e){this._renderState!==e&&(this._renderState=e,this.dirty=!0)}},framebuffer:{get:function(){return this._framebuffer},set:function(e){this._framebuffer!==e&&(this._framebuffer=e,this.dirty=!0)}},pass:{get:function(){return this._pass},set:function(e){this._pass!==e&&(this._pass=e,this.dirty=!0)}},executeInClosestFrustum:{get:function(){return dr(this,Gn.EXECUTE_IN_CLOSEST_FRUSTUM)},set:function(e){dr(this,Gn.EXECUTE_IN_CLOSEST_FRUSTUM)!==e&&(Nc(this,Gn.EXECUTE_IN_CLOSEST_FRUSTUM,e),this.dirty=!0)}},owner:{get:function(){return this._owner},set:function(e){this._owner!==e&&(this._owner=e,this.dirty=!0)}},debugShowBoundingVolume:{get:function(){return dr(this,Gn.DEBUG_SHOW_BOUNDING_VOLUME)},set:function(e){dr(this,Gn.DEBUG_SHOW_BOUNDING_VOLUME)!==e&&(Nc(this,Gn.DEBUG_SHOW_BOUNDING_VOLUME,e),this.dirty=!0)}},debugOverlappingFrustums:{get:function(){return this._debugOverlappingFrustums},set:function(e){this._debugOverlappingFrustums!==e&&(this._debugOverlappingFrustums=e,this.dirty=!0)}},pickId:{get:function(){return this._pickId},set:function(e){this._pickId!==e&&(this._pickId=e,this.dirty=!0)}},pickOnly:{get:function(){return dr(this,Gn.PICK_ONLY)},set:function(e){dr(this,Gn.PICK_ONLY)!==e&&(Nc(this,Gn.PICK_ONLY,e),this.dirty=!0)}},depthForTranslucentClassification:{get:function(){return dr(this,Gn.DEPTH_FOR_TRANSLUCENT_CLASSIFICATION)},set:function(e){dr(this,Gn.DEPTH_FOR_TRANSLUCENT_CLASSIFICATION)!==e&&(Nc(this,Gn.DEPTH_FOR_TRANSLUCENT_CLASSIFICATION,e),this.dirty=!0)}}});Tt.shallowClone=function(e,t){if(l(e))return l(t)||(t=new Tt),t._boundingVolume=e._boundingVolume,t._orientedBoundingBox=e._orientedBoundingBox,t._modelMatrix=e._modelMatrix,t._primitiveType=e._primitiveType,t._vertexArray=e._vertexArray,t._count=e._count,t._offset=e._offset,t._instanceCount=e._instanceCount,t._shaderProgram=e._shaderProgram,t._uniformMap=e._uniformMap,t._renderState=e._renderState,t._framebuffer=e._framebuffer,t._pass=e._pass,t._owner=e._owner,t._debugOverlappingFrustums=e._debugOverlappingFrustums,t._pickId=e._pickId,t._flags=e._flags,t.dirty=!0,t.lastDirtyTime=0,t};Tt.prototype.execute=function(e,t){e.draw(this,t)};const We={_maximumCombinedTextureImageUnits:0,_maximumCubeMapSize:0,_maximumFragmentUniformVectors:0,_maximumTextureImageUnits:0,_maximumRenderbufferSize:0,_maximumTextureSize:0,_maximumVaryingVectors:0,_maximumVertexAttributes:0,_maximumVertexTextureImageUnits:0,_maximumVertexUniformVectors:0,_minimumAliasedLineWidth:0,_maximumAliasedLineWidth:0,_minimumAliasedPointSize:0,_maximumAliasedPointSize:0,_maximumViewportWidth:0,_maximumViewportHeight:0,_maximumTextureFilterAnisotropy:0,_maximumDrawBuffers:0,_maximumColorAttachments:0,_maximumSamples:0,_highpFloatSupported:!1,_highpIntSupported:!1};Object.defineProperties(We,{maximumCombinedTextureImageUnits:{get:function(){return We._maximumCombinedTextureImageUnits}},maximumCubeMapSize:{get:function(){return We._maximumCubeMapSize}},maximumFragmentUniformVectors:{get:function(){return We._maximumFragmentUniformVectors}},maximumTextureImageUnits:{get:function(){return We._maximumTextureImageUnits}},maximumRenderbufferSize:{get:function(){return We._maximumRenderbufferSize}},maximumTextureSize:{get:function(){return We._maximumTextureSize}},maximumVaryingVectors:{get:function(){return We._maximumVaryingVectors}},maximumVertexAttributes:{get:function(){return We._maximumVertexAttributes}},maximumVertexTextureImageUnits:{get:function(){return We._maximumVertexTextureImageUnits}},maximumVertexUniformVectors:{get:function(){return We._maximumVertexUniformVectors}},minimumAliasedLineWidth:{get:function(){return We._minimumAliasedLineWidth}},maximumAliasedLineWidth:{get:function(){return We._maximumAliasedLineWidth}},minimumAliasedPointSize:{get:function(){return We._minimumAliasedPointSize}},maximumAliasedPointSize:{get:function(){return We._maximumAliasedPointSize}},maximumViewportWidth:{get:function(){return We._maximumViewportWidth}},maximumViewportHeight:{get:function(){return We._maximumViewportHeight}},maximumTextureFilterAnisotropy:{get:function(){return We._maximumTextureFilterAnisotropy}},maximumDrawBuffers:{get:function(){return We._maximumDrawBuffers}},maximumColorAttachments:{get:function(){return We._maximumColorAttachments}},maximumSamples:{get:function(){return We._maximumSamples}},highpFloatSupported:{get:function(){return We._highpFloatSupported}},highpIntSupported:{get:function(){return We._highpIntSupported}}});function z0(e,t,n){const i=e._gl;i.framebufferTexture2D(i.FRAMEBUFFER,t,n._target,n._texture,0)}function lg(e,t,n){const i=e._gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,t,i.RENDERBUFFER,n._getRenderbuffer())}function as(e){e=T(e,T.EMPTY_OBJECT);const t=e.context;y.defined("options.context",t);const n=t._gl,i=We.maximumColorAttachments;if(this._gl=n,this._framebuffer=n.createFramebuffer(),this._colorTextures=[],this._colorRenderbuffers=[],this._activeColorAttachments=[],this._depthTexture=void 0,this._depthRenderbuffer=void 0,this._stencilRenderbuffer=void 0,this._depthStencilTexture=void 0,this._depthStencilRenderbuffer=void 0,this.destroyAttachments=T(e.destroyAttachments,!0),l(e.colorTextures)&&l(e.colorRenderbuffers))throw new A("Cannot have both color texture and color renderbuffer attachments.");if(l(e.depthTexture)&&l(e.depthRenderbuffer))throw new A("Cannot have both a depth texture and depth renderbuffer attachment.");if(l(e.depthStencilTexture)&&l(e.depthStencilRenderbuffer))throw new A("Cannot have both a depth-stencil texture and depth-stencil renderbuffer attachment.");const r=l(e.depthTexture)||l(e.depthRenderbuffer),s=l(e.depthStencilTexture)||l(e.depthStencilRenderbuffer);if(r&&s)throw new A("Cannot have both a depth and depth-stencil attachment.");if(l(e.stencilRenderbuffer)&&s)throw new A("Cannot have both a stencil and depth-stencil attachment.");if(r&&l(e.stencilRenderbuffer))throw new A("Cannot have both a depth and stencil attachment.");this._bind();let o,a,c,u,h;if(l(e.colorTextures)){const d=e.colorTextures;if(u=this._colorTextures.length=this._activeColorAttachments.length=d.length,u>i)throw new A("The number of color attachments exceeds the number supported.");for(c=0;c<u;++c){if(o=d[c],!Le.isColorFormat(o.pixelFormat))throw new A("The color-texture pixel-format must be a color format.");if(o.pixelDatatype===De.FLOAT&&!t.colorBufferFloat)throw new A("The color texture pixel datatype is FLOAT and the WebGL implementation does not support the EXT_color_buffer_float or WEBGL_color_buffer_float extensions. See Context.colorBufferFloat.");if(o.pixelDatatype===De.HALF_FLOAT&&!t.colorBufferHalfFloat)throw new A("The color texture pixel datatype is HALF_FLOAT and the WebGL implementation does not support the EXT_color_buffer_half_float extension. See Context.colorBufferHalfFloat.");h=this._gl.COLOR_ATTACHMENT0+c,z0(this,h,o),this._activeColorAttachments[c]=h,this._colorTextures[c]=o}}if(l(e.colorRenderbuffers)){const d=e.colorRenderbuffers;if(u=this._colorRenderbuffers.length=this._activeColorAttachments.length=d.length,u>i)throw new A("The number of color attachments exceeds the number supported.");for(c=0;c<u;++c)a=d[c],h=this._gl.COLOR_ATTACHMENT0+c,lg(this,h,a),this._activeColorAttachments[c]=h,this._colorRenderbuffers[c]=a}if(l(e.depthTexture)){if(o=e.depthTexture,o.pixelFormat!==Le.DEPTH_COMPONENT)throw new A("The depth-texture pixel-format must be DEPTH_COMPONENT.");z0(this,this._gl.DEPTH_ATTACHMENT,o),this._depthTexture=o}if(l(e.depthRenderbuffer)&&(a=e.depthRenderbuffer,lg(this,this._gl.DEPTH_ATTACHMENT,a),this._depthRenderbuffer=a),l(e.stencilRenderbuffer)&&(a=e.stencilRenderbuffer,lg(this,this._gl.STENCIL_ATTACHMENT,a),this._stencilRenderbuffer=a),l(e.depthStencilTexture)){if(o=e.depthStencilTexture,o.pixelFormat!==Le.DEPTH_STENCIL)throw new A("The depth-stencil pixel-format must be DEPTH_STENCIL.");z0(this,this._gl.DEPTH_STENCIL_ATTACHMENT,o),this._depthStencilTexture=o}l(e.depthStencilRenderbuffer)&&(a=e.depthStencilRenderbuffer,lg(this,this._gl.DEPTH_STENCIL_ATTACHMENT,a),this._depthStencilRenderbuffer=a),this._unBind()}Object.defineProperties(as.prototype,{status:{get:function(){this._bind();const e=this._gl.checkFramebufferStatus(this._gl.FRAMEBUFFER);return this._unBind(),e}},numberOfColorAttachments:{get:function(){return this._activeColorAttachments.length}},depthTexture:{get:function(){return this._depthTexture}},depthRenderbuffer:{get:function(){return this._depthRenderbuffer}},stencilRenderbuffer:{get:function(){return this._stencilRenderbuffer}},depthStencilTexture:{get:function(){return this._depthStencilTexture}},depthStencilRenderbuffer:{get:function(){return this._depthStencilRenderbuffer}},hasDepthAttachment:{get:function(){return!!(this.depthTexture||this.depthRenderbuffer||this.depthStencilTexture||this.depthStencilRenderbuffer)}}});as.prototype._bind=function(){const e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,this._framebuffer)};as.prototype._unBind=function(){const e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,null)};as.prototype.bindDraw=function(){const e=this._gl;e.bindFramebuffer(e.DRAW_FRAMEBUFFER,this._framebuffer)};as.prototype.bindRead=function(){const e=this._gl;e.bindFramebuffer(e.READ_FRAMEBUFFER,this._framebuffer)};as.prototype._getActiveColorAttachments=function(){return this._activeColorAttachments};as.prototype.getColorTexture=function(e){if(!l(e)||e<0||e>=this._colorTextures.length)throw new A("index is required, must be greater than or equal to zero and must be less than the number of color attachments.");return this._colorTextures[e]};as.prototype.getColorRenderbuffer=function(e){if(!l(e)||e<0||e>=this._colorRenderbuffers.length)throw new A("index is required, must be greater than or equal to zero and must be less than the number of color attachments.");return this._colorRenderbuffers[e]};as.prototype.isDestroyed=function(){return!1};as.prototype.destroy=function(){if(this.destroyAttachments){let e=0;const t=this._colorTextures;let n=t.length;for(;e<n;++e){const r=t[e];l(r)&&r.destroy()}const i=this._colorRenderbuffers;for(n=i.length,e=0;e<n;++e){const r=i[e];l(r)&&r.destroy()}this._depthTexture=this._depthTexture&&this._depthTexture.destroy(),this._depthRenderbuffer=this._depthRenderbuffer&&this._depthRenderbuffer.destroy(),this._stencilRenderbuffer=this._stencilRenderbuffer&&this._stencilRenderbuffer.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy()}return this._gl.deleteFramebuffer(this._framebuffer),Ye(this)};function $L(e){if(typeof e!="object"||e===null)return e;let t;const n=Object.keys(e);for(let i=0;i<n.length;i++)t=n[i],e.hasOwnProperty(t)&&t!=="_applyFunctions"&&(e[t]=$L(e[t]));return Object.freeze(e)}function jI(e){return e===j.FUNC_ADD||e===j.FUNC_SUBTRACT||e===j.FUNC_REVERSE_SUBTRACT||e===j.MIN||e===j.MAX}function ug(e){return e===j.ZERO||e===j.ONE||e===j.SRC_COLOR||e===j.ONE_MINUS_SRC_COLOR||e===j.DST_COLOR||e===j.ONE_MINUS_DST_COLOR||e===j.SRC_ALPHA||e===j.ONE_MINUS_SRC_ALPHA||e===j.DST_ALPHA||e===j.ONE_MINUS_DST_ALPHA||e===j.CONSTANT_COLOR||e===j.ONE_MINUS_CONSTANT_COLOR||e===j.CONSTANT_ALPHA||e===j.ONE_MINUS_CONSTANT_ALPHA||e===j.SRC_ALPHA_SATURATE}function iK(e){return e===j.FRONT||e===j.BACK||e===j.FRONT_AND_BACK}function rK(e){return e===j.NEVER||e===j.LESS||e===j.EQUAL||e===j.LEQUAL||e===j.GREATER||e===j.NOTEQUAL||e===j.GEQUAL||e===j.ALWAYS}function VI(e){return e===j.NEVER||e===j.LESS||e===j.EQUAL||e===j.LEQUAL||e===j.GREATER||e===j.NOTEQUAL||e===j.GEQUAL||e===j.ALWAYS}function sf(e){return e===j.ZERO||e===j.KEEP||e===j.REPLACE||e===j.INCR||e===j.DECR||e===j.INVERT||e===j.INCR_WRAP||e===j.DECR_WRAP}function it(e){const t=T(e,T.EMPTY_OBJECT),n=T(t.cull,T.EMPTY_OBJECT),i=T(t.polygonOffset,T.EMPTY_OBJECT),r=T(t.scissorTest,T.EMPTY_OBJECT),s=T(r.rectangle,T.EMPTY_OBJECT),o=T(t.depthRange,T.EMPTY_OBJECT),a=T(t.depthTest,T.EMPTY_OBJECT),c=T(t.colorMask,T.EMPTY_OBJECT),u=T(t.blending,T.EMPTY_OBJECT),h=T(u.color,T.EMPTY_OBJECT),d=T(t.stencilTest,T.EMPTY_OBJECT),p=T(d.frontOperation,T.EMPTY_OBJECT),g=T(d.backOperation,T.EMPTY_OBJECT),_=T(t.sampleCoverage,T.EMPTY_OBJECT),b=t.viewport;if(this.frontFace=T(t.frontFace,xl.COUNTER_CLOCKWISE),this.cull={enabled:T(n.enabled,!1),face:T(n.face,j.BACK)},this.lineWidth=T(t.lineWidth,1),this.polygonOffset={enabled:T(i.enabled,!1),factor:T(i.factor,0),units:T(i.units,0)},this.scissorTest={enabled:T(r.enabled,!1),rectangle:Ot.clone(s)},this.depthRange={near:T(o.near,0),far:T(o.far,1)},this.depthTest={enabled:T(a.enabled,!1),func:T(a.func,j.LESS)},this.colorMask={red:T(c.red,!0),green:T(c.green,!0),blue:T(c.blue,!0),alpha:T(c.alpha,!0)},this.depthMask=T(t.depthMask,!0),this.stencilMask=T(t.stencilMask,-1),this.blending={enabled:T(u.enabled,!1),color:new M(T(h.red,0),T(h.green,0),T(h.blue,0),T(h.alpha,0)),equationRgb:T(u.equationRgb,j.FUNC_ADD),equationAlpha:T(u.equationAlpha,j.FUNC_ADD),functionSourceRgb:T(u.functionSourceRgb,j.ONE),functionSourceAlpha:T(u.functionSourceAlpha,j.ONE),functionDestinationRgb:T(u.functionDestinationRgb,j.ZERO),functionDestinationAlpha:T(u.functionDestinationAlpha,j.ZERO)},this.stencilTest={enabled:T(d.enabled,!1),frontFunction:T(d.frontFunction,j.ALWAYS),backFunction:T(d.backFunction,j.ALWAYS),reference:T(d.reference,0),mask:T(d.mask,-1),frontOperation:{fail:T(p.fail,j.KEEP),zFail:T(p.zFail,j.KEEP),zPass:T(p.zPass,j.KEEP)},backOperation:{fail:T(g.fail,j.KEEP),zFail:T(g.zFail,j.KEEP),zPass:T(g.zPass,j.KEEP)}},this.sampleCoverage={enabled:T(_.enabled,!1),value:T(_.value,1),invert:T(_.invert,!1)},this.viewport=l(b)?new Ot(b.x,b.y,b.width,b.height):void 0,this.lineWidth<We.minimumAliasedLineWidth||this.lineWidth>We.maximumAliasedLineWidth)throw new A("renderState.lineWidth is out of range.  Check minimumAliasedLineWidth and maximumAliasedLineWidth.");if(!xl.validate(this.frontFace))throw new A("Invalid renderState.frontFace.");if(!iK(this.cull.face))throw new A("Invalid renderState.cull.face.");if(this.scissorTest.rectangle.width<0||this.scissorTest.rectangle.height<0)throw new A("renderState.scissorTest.rectangle.width and renderState.scissorTest.rectangle.height must be greater than or equal to zero.");if(this.depthRange.near>this.depthRange.far)throw new A("renderState.depthRange.near can not be greater than renderState.depthRange.far.");if(this.depthRange.near<0)throw new A("renderState.depthRange.near must be greater than or equal to zero.");if(this.depthRange.far>1)throw new A("renderState.depthRange.far must be less than or equal to one.");if(!rK(this.depthTest.func))throw new A("Invalid renderState.depthTest.func.");if(this.blending.color.red<0||this.blending.color.red>1||this.blending.color.green<0||this.blending.color.green>1||this.blending.color.blue<0||this.blending.color.blue>1||this.blending.color.alpha<0||this.blending.color.alpha>1)throw new A("renderState.blending.color components must be greater than or equal to zero and less than or equal to one.");if(!jI(this.blending.equationRgb))throw new A("Invalid renderState.blending.equationRgb.");if(!jI(this.blending.equationAlpha))throw new A("Invalid renderState.blending.equationAlpha.");if(!ug(this.blending.functionSourceRgb))throw new A("Invalid renderState.blending.functionSourceRgb.");if(!ug(this.blending.functionSourceAlpha))throw new A("Invalid renderState.blending.functionSourceAlpha.");if(!ug(this.blending.functionDestinationRgb))throw new A("Invalid renderState.blending.functionDestinationRgb.");if(!ug(this.blending.functionDestinationAlpha))throw new A("Invalid renderState.blending.functionDestinationAlpha.");if(!VI(this.stencilTest.frontFunction))throw new A("Invalid renderState.stencilTest.frontFunction.");if(!VI(this.stencilTest.backFunction))throw new A("Invalid renderState.stencilTest.backFunction.");if(!sf(this.stencilTest.frontOperation.fail))throw new A("Invalid renderState.stencilTest.frontOperation.fail.");if(!sf(this.stencilTest.frontOperation.zFail))throw new A("Invalid renderState.stencilTest.frontOperation.zFail.");if(!sf(this.stencilTest.frontOperation.zPass))throw new A("Invalid renderState.stencilTest.frontOperation.zPass.");if(!sf(this.stencilTest.backOperation.fail))throw new A("Invalid renderState.stencilTest.backOperation.fail.");if(!sf(this.stencilTest.backOperation.zFail))throw new A("Invalid renderState.stencilTest.backOperation.zFail.");if(!sf(this.stencilTest.backOperation.zPass))throw new A("Invalid renderState.stencilTest.backOperation.zPass.");if(l(this.viewport)){if(this.viewport.width<0)throw new A("renderState.viewport.width must be greater than or equal to zero.");if(this.viewport.height<0)throw new A("renderState.viewport.height must be greater than or equal to zero.");if(this.viewport.width>We.maximumViewportWidth)throw new A(`renderState.viewport.width must be less than or equal to the maximum viewport width (${We.maximumViewportWidth.toString()}).  Check maximumViewportWidth.`);if(this.viewport.height>We.maximumViewportHeight)throw new A(`renderState.viewport.height must be less than or equal to the maximum viewport height (${We.maximumViewportHeight.toString()}).  Check maximumViewportHeight.`)}this.id=0,this._applyFunctions=[]}let sK=0,sa={};it.fromCache=function(e){const t=JSON.stringify(e);let n=sa[t];if(l(n))return++n.referenceCount,n.state;let i=new it(e);const r=JSON.stringify(i);return n=sa[r],l(n)||(i.id=sK++,i=$L(i),n={referenceCount:0,state:i},sa[r]=n),++n.referenceCount,sa[t]={referenceCount:1,state:n.state},n.state};it.removeFromCache=function(e){const t=new it(e),n=JSON.stringify(t),i=sa[n],r=JSON.stringify(e),s=sa[r];l(s)&&(--s.referenceCount,s.referenceCount===0&&(delete sa[r],l(i)&&--i.referenceCount)),l(i)&&i.referenceCount===0&&delete sa[n]};it.getCache=function(){return sa};it.clearCache=function(){sa={}};function Nu(e,t,n){n?e.enable(t):e.disable(t)}function XL(e,t){e.frontFace(t.frontFace)}function YL(e,t){const n=t.cull,i=n.enabled;Nu(e,e.CULL_FACE,i),i&&e.cullFace(n.face)}function KL(e,t){e.lineWidth(t.lineWidth)}function ZL(e,t){const n=t.polygonOffset,i=n.enabled;Nu(e,e.POLYGON_OFFSET_FILL,i),i&&e.polygonOffset(n.factor,n.units)}function JL(e,t,n){const i=t.scissorTest,r=l(n.scissorTest)?n.scissorTest.enabled:i.enabled;if(Nu(e,e.SCISSOR_TEST,r),r){const s=l(n.scissorTest)?n.scissorTest.rectangle:i.rectangle;e.scissor(s.x,s.y,s.width,s.height)}}function QL(e,t){const n=t.depthRange;e.depthRange(n.near,n.far)}function eP(e,t){const n=t.depthTest,i=n.enabled;Nu(e,e.DEPTH_TEST,i),i&&e.depthFunc(n.func)}function tP(e,t){const n=t.colorMask;e.colorMask(n.red,n.green,n.blue,n.alpha)}function nP(e,t){e.depthMask(t.depthMask)}function iP(e,t){e.stencilMask(t.stencilMask)}function oK(e,t){e.blendColor(t.red,t.green,t.blue,t.alpha)}function rP(e,t,n){const i=t.blending,r=l(n.blendingEnabled)?n.blendingEnabled:i.enabled;Nu(e,e.BLEND,r),r&&(oK(e,i.color),e.blendEquationSeparate(i.equationRgb,i.equationAlpha),e.blendFuncSeparate(i.functionSourceRgb,i.functionDestinationRgb,i.functionSourceAlpha,i.functionDestinationAlpha))}function sP(e,t){const n=t.stencilTest,i=n.enabled;if(Nu(e,e.STENCIL_TEST,i),i){const r=n.frontFunction,s=n.backFunction,o=n.reference,a=n.mask;e.stencilFunc(r,o,a),e.stencilFuncSeparate(e.BACK,s,o,a),e.stencilFuncSeparate(e.FRONT,r,o,a);const c=n.frontOperation,u=c.fail,h=c.zFail,d=c.zPass;e.stencilOpSeparate(e.FRONT,u,h,d);const p=n.backOperation,g=p.fail,_=p.zFail,b=p.zPass;e.stencilOpSeparate(e.BACK,g,_,b)}}function oP(e,t){const n=t.sampleCoverage,i=n.enabled;Nu(e,e.SAMPLE_COVERAGE,i),i&&e.sampleCoverage(n.value,n.invert)}const aK=new Ot;function aP(e,t,n){let i=T(t.viewport,n.viewport);l(i)||(i=aK,i.width=n.context.drawingBufferWidth,i.height=n.context.drawingBufferHeight),n.context.uniformState.viewport=i,e.viewport(i.x,i.y,i.width,i.height)}it.apply=function(e,t,n){XL(e,t),YL(e,t),KL(e,t),ZL(e,t),QL(e,t),eP(e,t),tP(e,t),nP(e,t),iP(e,t),sP(e,t),oP(e,t),JL(e,t,n),rP(e,t,n),aP(e,t,n)};function cK(e,t){const n=[];return e.frontFace!==t.frontFace&&n.push(XL),(e.cull.enabled!==t.cull.enabled||e.cull.face!==t.cull.face)&&n.push(YL),e.lineWidth!==t.lineWidth&&n.push(KL),(e.polygonOffset.enabled!==t.polygonOffset.enabled||e.polygonOffset.factor!==t.polygonOffset.factor||e.polygonOffset.units!==t.polygonOffset.units)&&n.push(ZL),(e.depthRange.near!==t.depthRange.near||e.depthRange.far!==t.depthRange.far)&&n.push(QL),(e.depthTest.enabled!==t.depthTest.enabled||e.depthTest.func!==t.depthTest.func)&&n.push(eP),(e.colorMask.red!==t.colorMask.red||e.colorMask.green!==t.colorMask.green||e.colorMask.blue!==t.colorMask.blue||e.colorMask.alpha!==t.colorMask.alpha)&&n.push(tP),e.depthMask!==t.depthMask&&n.push(nP),e.stencilMask!==t.stencilMask&&n.push(iP),(e.stencilTest.enabled!==t.stencilTest.enabled||e.stencilTest.frontFunction!==t.stencilTest.frontFunction||e.stencilTest.backFunction!==t.stencilTest.backFunction||e.stencilTest.reference!==t.stencilTest.reference||e.stencilTest.mask!==t.stencilTest.mask||e.stencilTest.frontOperation.fail!==t.stencilTest.frontOperation.fail||e.stencilTest.frontOperation.zFail!==t.stencilTest.frontOperation.zFail||e.stencilTest.backOperation.fail!==t.stencilTest.backOperation.fail||e.stencilTest.backOperation.zFail!==t.stencilTest.backOperation.zFail||e.stencilTest.backOperation.zPass!==t.stencilTest.backOperation.zPass)&&n.push(sP),(e.sampleCoverage.enabled!==t.sampleCoverage.enabled||e.sampleCoverage.value!==t.sampleCoverage.value||e.sampleCoverage.invert!==t.sampleCoverage.invert)&&n.push(oP),n}it.partialApply=function(e,t,n,i,r,s){if(t!==n){let h=n._applyFunctions[t.id];l(h)||(h=cK(t,n),n._applyFunctions[t.id]=h);const d=h.length;for(let p=0;p<d;++p)h[p](e,n)}const o=l(i.scissorTest)?i.scissorTest:t.scissorTest,a=l(r.scissorTest)?r.scissorTest:n.scissorTest;(o!==a||s)&&JL(e,n,r);const c=l(i.blendingEnabled)?i.blendingEnabled:t.blending.enabled,u=l(r.blendingEnabled)?r.blendingEnabled:n.blending.enabled;(c!==u||u&&t.blending!==n.blending)&&rP(e,n,r),(t!==n||i!==r||i.context!==r.context)&&aP(e,n,r)};it.getState=function(e){if(!l(e))throw new A("renderState is required.");return{frontFace:e.frontFace,cull:{enabled:e.cull.enabled,face:e.cull.face},lineWidth:e.lineWidth,polygonOffset:{enabled:e.polygonOffset.enabled,factor:e.polygonOffset.factor,units:e.polygonOffset.units},scissorTest:{enabled:e.scissorTest.enabled,rectangle:Ot.clone(e.scissorTest.rectangle)},depthRange:{near:e.depthRange.near,far:e.depthRange.far},depthTest:{enabled:e.depthTest.enabled,func:e.depthTest.func},colorMask:{red:e.colorMask.red,green:e.colorMask.green,blue:e.colorMask.blue,alpha:e.colorMask.alpha},depthMask:e.depthMask,stencilMask:e.stencilMask,blending:{enabled:e.blending.enabled,color:M.clone(e.blending.color),equationRgb:e.blending.equationRgb,equationAlpha:e.blending.equationAlpha,functionSourceRgb:e.blending.functionSourceRgb,functionSourceAlpha:e.blending.functionSourceAlpha,functionDestinationRgb:e.blending.functionDestinationRgb,functionDestinationAlpha:e.blending.functionDestinationAlpha},stencilTest:{enabled:e.stencilTest.enabled,frontFunction:e.stencilTest.frontFunction,backFunction:e.stencilTest.backFunction,reference:e.stencilTest.reference,mask:e.stencilTest.mask,frontOperation:{fail:e.stencilTest.frontOperation.fail,zFail:e.stencilTest.frontOperation.zFail,zPass:e.stencilTest.frontOperation.zPass},backOperation:{fail:e.stencilTest.backOperation.fail,zFail:e.stencilTest.backOperation.zFail,zPass:e.stencilTest.backOperation.zPass}},sampleCoverage:{enabled:e.sampleCoverage.enabled,value:e.sampleCoverage.value,invert:e.sampleCoverage.invert},viewport:l(e.viewport)?Ot.clone(e.viewport):void 0}};function lK(e,t,n,i){switch(t.type){case e.FLOAT:return new cP(e,t,n,i);case e.FLOAT_VEC2:return new lP(e,t,n,i);case e.FLOAT_VEC3:return new uP(e,t,n,i);case e.FLOAT_VEC4:return new fP(e,t,n,i);case e.SAMPLER_2D:case e.SAMPLER_CUBE:return new iw(e,t,n,i);case e.INT:case e.BOOL:return new hP(e,t,n,i);case e.INT_VEC2:case e.BOOL_VEC2:return new dP(e,t,n,i);case e.INT_VEC3:case e.BOOL_VEC3:return new pP(e,t,n,i);case e.INT_VEC4:case e.BOOL_VEC4:return new mP(e,t,n,i);case e.FLOAT_MAT2:return new gP(e,t,n,i);case e.FLOAT_MAT3:return new _P(e,t,n,i);case e.FLOAT_MAT4:return new yP(e,t,n,i);default:throw new te(`Unrecognized uniform type: ${t.type} for uniform "${n}".`)}}function cP(e,t,n,i){this.name=n,this.value=void 0,this._value=0,this._gl=e,this._location=i}cP.prototype.set=function(){this.value!==this._value&&(this._value=this.value,this._gl.uniform1f(this._location,this.value))};function lP(e,t,n,i){this.name=n,this.value=void 0,this._value=new k,this._gl=e,this._location=i}lP.prototype.set=function(){const e=this.value;k.equals(e,this._value)||(k.clone(e,this._value),this._gl.uniform2f(this._location,e.x,e.y))};function uP(e,t,n,i){this.name=n,this.value=void 0,this._value=void 0,this._gl=e,this._location=i}uP.prototype.set=function(){const e=this.value;if(l(e.red))M.equals(e,this._value)||(this._value=M.clone(e,this._value),this._gl.uniform3f(this._location,e.red,e.green,e.blue));else if(l(e.x))m.equals(e,this._value)||(this._value=m.clone(e,this._value),this._gl.uniform3f(this._location,e.x,e.y,e.z));else throw new A(`Invalid vec3 value for uniform "${this.name}".`)};function fP(e,t,n,i){this.name=n,this.value=void 0,this._value=void 0,this._gl=e,this._location=i}fP.prototype.set=function(){const e=this.value;if(l(e.red))M.equals(e,this._value)||(this._value=M.clone(e,this._value),this._gl.uniform4f(this._location,e.red,e.green,e.blue,e.alpha));else if(l(e.x))Y.equals(e,this._value)||(this._value=Y.clone(e,this._value),this._gl.uniform4f(this._location,e.x,e.y,e.z,e.w));else throw new A(`Invalid vec4 value for uniform "${this.name}".`)};function iw(e,t,n,i){this.name=n,this.value=void 0,this._gl=e,this._location=i,this.textureUnitIndex=void 0}iw.prototype.set=function(){const e=this._gl;e.activeTexture(e.TEXTURE0+this.textureUnitIndex);const t=this.value;e.bindTexture(t._target,t._texture)};iw.prototype._setSampler=function(e){return this.textureUnitIndex=e,this._gl.uniform1i(this._location,e),e+1};function hP(e,t,n,i){this.name=n,this.value=void 0,this._value=0,this._gl=e,this._location=i}hP.prototype.set=function(){this.value!==this._value&&(this._value=this.value,this._gl.uniform1i(this._location,this.value))};function dP(e,t,n,i){this.name=n,this.value=void 0,this._value=new k,this._gl=e,this._location=i}dP.prototype.set=function(){const e=this.value;k.equals(e,this._value)||(k.clone(e,this._value),this._gl.uniform2i(this._location,e.x,e.y))};function pP(e,t,n,i){this.name=n,this.value=void 0,this._value=new m,this._gl=e,this._location=i}pP.prototype.set=function(){const e=this.value;m.equals(e,this._value)||(m.clone(e,this._value),this._gl.uniform3i(this._location,e.x,e.y,e.z))};function mP(e,t,n,i){this.name=n,this.value=void 0,this._value=new Y,this._gl=e,this._location=i}mP.prototype.set=function(){const e=this.value;Y.equals(e,this._value)||(Y.clone(e,this._value),this._gl.uniform4i(this._location,e.x,e.y,e.z,e.w))};const uK=new Float32Array(4);function gP(e,t,n,i){this.name=n,this.value=void 0,this._value=new Te,this._gl=e,this._location=i}gP.prototype.set=function(){if(!Te.equalsArray(this.value,this._value,0)){Te.clone(this.value,this._value);const e=Te.toArray(this.value,uK);this._gl.uniformMatrix2fv(this._location,!1,e)}};const fK=new Float32Array(9);function _P(e,t,n,i){this.name=n,this.value=void 0,this._value=new H,this._gl=e,this._location=i}_P.prototype.set=function(){if(!H.equalsArray(this.value,this._value,0)){H.clone(this.value,this._value);const e=H.toArray(this.value,fK);this._gl.uniformMatrix3fv(this._location,!1,e)}};const hK=new Float32Array(16);function yP(e,t,n,i){this.name=n,this.value=void 0,this._value=new P,this._gl=e,this._location=i}yP.prototype.set=function(){if(!P.equalsArray(this.value,this._value,0)){P.clone(this.value,this._value);const e=P.toArray(this.value,hK);this._gl.uniformMatrix4fv(this._location,!1,e)}};function dK(e,t,n,i){switch(t.type){case e.FLOAT:return new bP(e,t,n,i);case e.FLOAT_VEC2:return new TP(e,t,n,i);case e.FLOAT_VEC3:return new xP(e,t,n,i);case e.FLOAT_VEC4:return new EP(e,t,n,i);case e.SAMPLER_2D:case e.SAMPLER_CUBE:return new rw(e,t,n,i);case e.INT:case e.BOOL:return new CP(e,t,n,i);case e.INT_VEC2:case e.BOOL_VEC2:return new wP(e,t,n,i);case e.INT_VEC3:case e.BOOL_VEC3:return new AP(e,t,n,i);case e.INT_VEC4:case e.BOOL_VEC4:return new SP(e,t,n,i);case e.FLOAT_MAT2:return new vP(e,t,n,i);case e.FLOAT_MAT3:return new IP(e,t,n,i);case e.FLOAT_MAT4:return new OP(e,t,n,i);default:throw new te(`Unrecognized uniform type: ${t.type} for uniform "${n}".`)}}function bP(e,t,n,i){const r=i.length;this.name=n,this.value=new Array(r),this._value=new Float32Array(r),this._gl=e,this._location=i[0]}bP.prototype.set=function(){const e=this.value,t=e.length,n=this._value;let i=!1;for(let r=0;r<t;++r){const s=e[r];s!==n[r]&&(n[r]=s,i=!0)}i&&this._gl.uniform1fv(this._location,n)};function TP(e,t,n,i){const r=i.length;this.name=n,this.value=new Array(r),this._value=new Float32Array(r*2),this._gl=e,this._location=i[0]}TP.prototype.set=function(){const e=this.value,t=e.length,n=this._value;let i=!1,r=0;for(let s=0;s<t;++s){const o=e[s];k.equalsArray(o,n,r)||(k.pack(o,n,r),i=!0),r+=2}i&&this._gl.uniform2fv(this._location,n)};function xP(e,t,n,i){const r=i.length;this.name=n,this.value=new Array(r),this._value=new Float32Array(r*3),this._gl=e,this._location=i[0]}xP.prototype.set=function(){const e=this.value,t=e.length,n=this._value;let i=!1,r=0;for(let s=0;s<t;++s){const o=e[s];if(l(o.red))(o.red!==n[r]||o.green!==n[r+1]||o.blue!==n[r+2])&&(n[r]=o.red,n[r+1]=o.green,n[r+2]=o.blue,i=!0);else if(l(o.x))m.equalsArray(o,n,r)||(m.pack(o,n,r),i=!0);else throw new A("Invalid vec3 value.");r+=3}i&&this._gl.uniform3fv(this._location,n)};function EP(e,t,n,i){const r=i.length;this.name=n,this.value=new Array(r),this._value=new Float32Array(r*4),this._gl=e,this._location=i[0]}EP.prototype.set=function(){const e=this.value,t=e.length,n=this._value;let i=!1,r=0;for(let s=0;s<t;++s){const o=e[s];if(l(o.red))M.equalsArray(o,n,r)||(M.pack(o,n,r),i=!0);else if(l(o.x))Y.equalsArray(o,n,r)||(Y.pack(o,n,r),i=!0);else throw new A("Invalid vec4 value.");r+=4}i&&this._gl.uniform4fv(this._location,n)};function rw(e,t,n,i){const r=i.length;this.name=n,this.value=new Array(r),this._value=new Float32Array(r),this._gl=e,this._locations=i,this.textureUnitIndex=void 0}rw.prototype.set=function(){const e=this._gl,t=e.TEXTURE0+this.textureUnitIndex,n=this.value,i=n.length;for(let r=0;r<i;++r){const s=n[r];e.activeTexture(t+r),e.bindTexture(s._target,s._texture)}};rw.prototype._setSampler=function(e){this.textureUnitIndex=e;const t=this._locations,n=t.length;for(let i=0;i<n;++i){const r=e+i;this._gl.uniform1i(t[i],r)}return e+n};function CP(e,t,n,i){const r=i.length;this.name=n,this.value=new Array(r),this._value=new Int32Array(r),this._gl=e,this._location=i[0]}CP.prototype.set=function(){const e=this.value,t=e.length,n=this._value;let i=!1;for(let r=0;r<t;++r){const s=e[r];s!==n[r]&&(n[r]=s,i=!0)}i&&this._gl.uniform1iv(this._location,n)};function wP(e,t,n,i){const r=i.length;this.name=n,this.value=new Array(r),this._value=new Int32Array(r*2),this._gl=e,this._location=i[0]}wP.prototype.set=function(){const e=this.value,t=e.length,n=this._value;let i=!1,r=0;for(let s=0;s<t;++s){const o=e[s];k.equalsArray(o,n,r)||(k.pack(o,n,r),i=!0),r+=2}i&&this._gl.uniform2iv(this._location,n)};function AP(e,t,n,i){const r=i.length;this.name=n,this.value=new Array(r),this._value=new Int32Array(r*3),this._gl=e,this._location=i[0]}AP.prototype.set=function(){const e=this.value,t=e.length,n=this._value;let i=!1,r=0;for(let s=0;s<t;++s){const o=e[s];m.equalsArray(o,n,r)||(m.pack(o,n,r),i=!0),r+=3}i&&this._gl.uniform3iv(this._location,n)};function SP(e,t,n,i){const r=i.length;this.name=n,this.value=new Array(r),this._value=new Int32Array(r*4),this._gl=e,this._location=i[0]}SP.prototype.set=function(){const e=this.value,t=e.length,n=this._value;let i=!1,r=0;for(let s=0;s<t;++s){const o=e[s];Y.equalsArray(o,n,r)||(Y.pack(o,n,r),i=!0),r+=4}i&&this._gl.uniform4iv(this._location,n)};function vP(e,t,n,i){const r=i.length;this.name=n,this.value=new Array(r),this._value=new Float32Array(r*4),this._gl=e,this._location=i[0]}vP.prototype.set=function(){const e=this.value,t=e.length,n=this._value;let i=!1,r=0;for(let s=0;s<t;++s){const o=e[s];Te.equalsArray(o,n,r)||(Te.pack(o,n,r),i=!0),r+=4}i&&this._gl.uniformMatrix2fv(this._location,!1,n)};function IP(e,t,n,i){const r=i.length;this.name=n,this.value=new Array(r),this._value=new Float32Array(r*9),this._gl=e,this._location=i[0]}IP.prototype.set=function(){const e=this.value,t=e.length,n=this._value;let i=!1,r=0;for(let s=0;s<t;++s){const o=e[s];H.equalsArray(o,n,r)||(H.pack(o,n,r),i=!0),r+=9}i&&this._gl.uniformMatrix3fv(this._location,!1,n)};function OP(e,t,n,i){const r=i.length;this.name=n,this.value=new Array(r),this._value=new Float32Array(r*16),this._gl=e,this._location=i[0]}OP.prototype.set=function(){const e=this.value,t=e.length,n=this._value;let i=!1,r=0;for(let s=0;s<t;++s){const o=e[s];P.equalsArray(o,n,r)||(P.pack(o,n,r),i=!0),r+=16}i&&this._gl.uniformMatrix4fv(this._location,!1,n)};let pK=0;function kn(e){let t=e.vertexShaderText,n=e.fragmentShaderText;typeof spector<"u"&&(t=t.replace(/^#line/gm,"//#line"),n=n.replace(/^#line/gm,"//#line"));const i=mK(t,n);this._gl=e.gl,this._logShaderCompilation=e.logShaderCompilation,this._debugShaders=e.debugShaders,this._attributeLocations=e.attributeLocations,this._program=void 0,this._numberOfVertexAttributes=void 0,this._vertexAttributes=void 0,this._uniformsByName=void 0,this._uniforms=void 0,this._automaticUniforms=void 0,this._manualUniforms=void 0,this._duplicateUniformNames=i.duplicateUniformNames,this._cachedShader=void 0,this.maximumTextureUnitIndex=void 0,this._vertexShaderSource=e.vertexShaderSource,this._vertexShaderText=e.vertexShaderText,this._fragmentShaderSource=e.fragmentShaderSource,this._fragmentShaderText=i.fragmentShaderText,this.id=pK++}kn.fromCache=function(e){return e=T(e,T.EMPTY_OBJECT),y.defined("options.context",e.context),e.context.shaderCache.getShaderProgram(e)};kn.replaceCache=function(e){return e=T(e,T.EMPTY_OBJECT),y.defined("options.context",e.context),e.context.shaderCache.replaceShaderProgram(e)};Object.defineProperties(kn.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},vertexAttributes:{get:function(){return n_(this),this._vertexAttributes}},numberOfVertexAttributes:{get:function(){return n_(this),this._numberOfVertexAttributes}},allUniforms:{get:function(){return n_(this),this._uniformsByName}}});function GI(e){const t=[],n=e.match(/uniform.*?(?![^{]*})(?=[=\[;])/g);if(l(n)){const i=n.length;for(let r=0;r<i;r++){const s=n[r].trim(),o=s.slice(s.lastIndexOf(" ")+1);t.push(o)}}return t}function mK(e,t){const n={};if(!We.highpFloatSupported||!We.highpIntSupported){let i,r,s,o;const a=GI(e),c=GI(t),u=a.length,h=c.length;for(i=0;i<u;i++)for(r=0;r<h;r++)if(a[i]===c[r]){s=a[i],o=`czm_mediump_${s}`;const d=new RegExp(`${s}\\b`,"g");t=t.replace(d,o),n[o]=s}}return{fragmentShaderText:t,duplicateUniformNames:n}}const Jo="[Cesium WebGL] ";function gK(e,t){const n=t._vertexShaderText,i=t._fragmentShaderText,r=e.createShader(e.VERTEX_SHADER);e.shaderSource(r,n),e.compileShader(r);const s=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(s,i),e.compileShader(s);const o=e.createProgram();e.attachShader(o,r),e.attachShader(o,s);const a=t._attributeLocations;if(l(a))for(const p in a)a.hasOwnProperty(p)&&e.bindAttribLocation(o,a[p],p);e.linkProgram(o);let c;if(e.getProgramParameter(o,e.LINK_STATUS))return t._logShaderCompilation&&(c=e.getShaderInfoLog(r),l(c)&&c.length>0&&console.log(`${Jo}Vertex shader compile log: ${c}`),c=e.getShaderInfoLog(s),l(c)&&c.length>0&&console.log(`${Jo}Fragment shader compile log: ${c}`),c=e.getProgramInfoLog(o),l(c)&&c.length>0&&console.log(`${Jo}Shader program link log: ${c}`)),e.deleteShader(r),e.deleteShader(s),o;let u;const h=t._debugShaders;throw e.getShaderParameter(s,e.COMPILE_STATUS)?e.getShaderParameter(r,e.COMPILE_STATUS)?(c=e.getProgramInfoLog(o),console.error(`${Jo}Shader program link log: ${c}`),d(r,"vertex"),d(s,"fragment"),u=`Program failed to link.  Link log: ${c}`):(c=e.getShaderInfoLog(r),console.error(`${Jo}Vertex shader compile log: ${c}`),console.error(`${Jo} Vertex shader source:
${n}`),u=`Vertex shader failed to compile.  Compile log: ${c}`):(c=e.getShaderInfoLog(s),console.error(`${Jo}Fragment shader compile log: ${c}`),console.error(`${Jo} Fragment shader source:
${i}`),u=`Fragment shader failed to compile.  Compile log: ${c}`),e.deleteShader(r),e.deleteShader(s),e.deleteProgram(o),new te(u);function d(p,g){if(!l(h))return;const _=h.getTranslatedShaderSource(p);if(_===""){console.error(`${Jo}${g} shader translation failed.`);return}console.error(`${Jo}Translated ${g} shaderSource:
${_}`)}}function _K(e,t,n){const i={};for(let r=0;r<n;++r){const s=e.getActiveAttrib(t,r),o=e.getAttribLocation(t,s.name);i[s.name]={name:s.name,type:s.type,index:o}}return i}function yK(e,t){const n={},i=[],r=[],s=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let o=0;o<s;++o){const a=e.getActiveUniform(t,o),c="[0]",u=a.name.indexOf(c,a.name.length-c.length)!==-1?a.name.slice(0,a.name.length-3):a.name;if(u.indexOf("gl_")!==0)if(a.name.indexOf("[")<0){const h=e.getUniformLocation(t,u);if(h!==null){const d=lK(e,a,u,h);n[u]=d,i.push(d),d._setSampler&&r.push(d)}}else{let h,d,p,g;const _=u.indexOf("[");if(_>=0){if(h=n[u.slice(0,_)],!l(h))continue;d=h._locations,d.length<=1&&(p=h.value,g=e.getUniformLocation(t,u),g!==null&&(d.push(g),p.push(e.getUniform(t,g))))}else{d=[];for(let b=0;b<a.size;++b)g=e.getUniformLocation(t,`${u}[${b}]`),g!==null&&d.push(g);h=dK(e,a,u,d),n[u]=h,i.push(h),h._setSampler&&r.push(h)}}}return{uniformsByName:n,uniforms:i,samplerUniforms:r}}function bK(e,t){const n=[],i=[];for(const r in t)if(t.hasOwnProperty(r)){const s=t[r];let o=r;const a=e._duplicateUniformNames[o];l(a)&&(s.name=a,o=a);const c=e_[o];l(c)?n.push({uniform:s,automaticUniform:c}):i.push(s)}return{automaticUniforms:n,manualUniforms:i}}function TK(e,t,n){e.useProgram(t);let i=0;const r=n.length;for(let s=0;s<r;++s)i=n[s]._setSampler(i);return e.useProgram(null),i}function n_(e){l(e._program)||RP(e)}function RP(e){const t=e._program,n=e._gl,i=gK(n,e,e._debugShaders),r=n.getProgramParameter(i,n.ACTIVE_ATTRIBUTES),s=yK(n,i),o=bK(e,s.uniformsByName);e._program=i,e._numberOfVertexAttributes=r,e._vertexAttributes=_K(n,i,r),e._uniformsByName=s.uniformsByName,e._uniforms=s.uniforms,e._automaticUniforms=o.automaticUniforms,e._manualUniforms=o.manualUniforms,e.maximumTextureUnitIndex=TK(n,i,s.samplerUniforms),t&&e._gl.deleteProgram(t),typeof spector<"u"&&(e._program.__SPECTOR_rebuildProgram=function(a,c,u,h){const d=e._vertexShaderText,p=e._fragmentShaderText,g=/ ! = /g;e._vertexShaderText=a.replace(g," != "),e._fragmentShaderText=c.replace(g," != ");try{RP(e),u(e._program)}catch(_){e._vertexShaderText=d,e._fragmentShaderText=p;const x=/(?:Compile|Link) error: ([^]*)/.exec(_.message);h(x?x[1]:_.message)}})}kn.prototype._bind=function(){n_(this),this._gl.useProgram(this._program)};kn.prototype._setUniforms=function(e,t,n){let i,r;if(l(e)){const a=this._manualUniforms;for(i=a.length,r=0;r<i;++r){const c=a[r];c.value=e[c.name]()}}const s=this._automaticUniforms;for(i=s.length,r=0;r<i;++r){const a=s[r];a.uniform.value=a.automaticUniform.getValue(t)}const o=this._uniforms;for(i=o.length,r=0;r<i;++r)o[r].set();if(n){const a=this._gl,c=this._program;if(a.validateProgram(c),!a.getProgramParameter(c,a.VALIDATE_STATUS))throw new A(`Program validation failed.  Program info log: ${a.getProgramInfoLog(c)}`)}};kn.prototype.isDestroyed=function(){return!1};kn.prototype.destroy=function(){this._cachedShader.cache.releaseShaderProgram(this)};kn.prototype.finalDestroy=function(){return this._gl.deleteProgram(this._program),Ye(this)};function ja(e,t,n,i,r,s,o,a,c,u,h){this._context=e,this._texture=t,this._textureTarget=n,this._targetFace=i,this._pixelDatatype=o,this._internalFormat=r,this._pixelFormat=s,this._size=a,this._preMultiplyAlpha=c,this._flipY=u,this._initialized=h}Object.defineProperties(ja.prototype,{pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},_target:{get:function(){return this._targetFace}}});ja.prototype.copyFrom=function(e){y.defined("options",e);const t=T(e.xOffset,0),n=T(e.yOffset,0);if(y.defined("options.source",e.source),y.typeOf.number.greaterThanOrEquals("xOffset",t,0),y.typeOf.number.greaterThanOrEquals("yOffset",n,0),t+e.source.width>this._size)throw new A("xOffset + options.source.width must be less than or equal to width.");if(n+e.source.height>this._size)throw new A("yOffset + options.source.height must be less than or equal to height.");const i=e.source,r=this._context._gl,s=this._textureTarget,o=this._targetFace;r.activeTexture(r.TEXTURE0),r.bindTexture(s,this._texture);const a=i.width,c=i.height;let u=i.arrayBufferView;const h=this._size,d=this._pixelFormat,p=this._internalFormat,g=this._pixelDatatype,_=this._preMultiplyAlpha,b=this._flipY,x=T(e.skipColorSpaceConversion,!1);let E=4;l(u)&&(E=Le.alignmentInBytes(d,g,a)),r.pixelStorei(r.UNPACK_ALIGNMENT,E),x?r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE):r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.BROWSER_DEFAULT_WEBGL);let C=!1;if(!this._initialized){if(t===0&&n===0&&a===h&&c===h)l(u)?(r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),b&&(u=Le.flipY(u,d,g,h,h)),r.texImage2D(o,0,p,h,h,0,d,De.toWebGLConstant(g,this._context),u)):(r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,_),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,b),r.texImage2D(o,0,p,d,De.toWebGLConstant(g,this._context),i)),C=!0;else{r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1);const w=Le.createTypedArray(d,g,h,h);r.texImage2D(o,0,p,h,h,0,d,De.toWebGLConstant(g,this._context),w)}this._initialized=!0}C||(l(u)?(r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),b&&(u=Le.flipY(u,d,g,a,c)),r.texSubImage2D(o,0,t,n,a,c,d,De.toWebGLConstant(g,this._context),u)):(r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,_),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,b),r.texSubImage2D(o,0,t,n,d,De.toWebGLConstant(g,this._context),i))),r.bindTexture(s,null)};ja.prototype.copyFromFramebuffer=function(e,t,n,i,r,s){if(e=T(e,0),t=T(t,0),n=T(n,0),i=T(i,0),r=T(r,this._size),s=T(s,this._size),y.typeOf.number.greaterThanOrEquals("xOffset",e,0),y.typeOf.number.greaterThanOrEquals("yOffset",t,0),y.typeOf.number.greaterThanOrEquals("framebufferXOffset",n,0),y.typeOf.number.greaterThanOrEquals("framebufferYOffset",i,0),e+r>this._size)throw new A("xOffset + source.width must be less than or equal to width.");if(t+s>this._size)throw new A("yOffset + source.height must be less than or equal to height.");if(this._pixelDatatype===De.FLOAT)throw new A("Cannot call copyFromFramebuffer when the texture pixel data type is FLOAT.");if(this._pixelDatatype===De.HALF_FLOAT)throw new A("Cannot call copyFromFramebuffer when the texture pixel data type is HALF_FLOAT.");const o=this._context._gl,a=this._textureTarget;o.activeTexture(o.TEXTURE0),o.bindTexture(a,this._texture),o.copyTexSubImage2D(this._targetFace,0,e,t,n,i,r,s),o.bindTexture(a,null),this._initialized=!0};const i_={DONT_CARE:j.DONT_CARE,FASTEST:j.FASTEST,NICEST:j.NICEST,validate:function(e){return e===i_.DONT_CARE||e===i_.FASTEST||e===i_.NICEST}},dh=Object.freeze(i_),r_={NEAREST:j.NEAREST,LINEAR:j.LINEAR};r_.validate=function(e){return e===r_.NEAREST||e===r_.LINEAR};const ws=Object.freeze(r_),kc={NEAREST:j.NEAREST,LINEAR:j.LINEAR,NEAREST_MIPMAP_NEAREST:j.NEAREST_MIPMAP_NEAREST,LINEAR_MIPMAP_NEAREST:j.LINEAR_MIPMAP_NEAREST,NEAREST_MIPMAP_LINEAR:j.NEAREST_MIPMAP_LINEAR,LINEAR_MIPMAP_LINEAR:j.LINEAR_MIPMAP_LINEAR};kc.validate=function(e){return e===kc.NEAREST||e===kc.LINEAR||e===kc.NEAREST_MIPMAP_NEAREST||e===kc.LINEAR_MIPMAP_NEAREST||e===kc.NEAREST_MIPMAP_LINEAR||e===kc.LINEAR_MIPMAP_LINEAR};const Ut=Object.freeze(kc),s_={CLAMP_TO_EDGE:j.CLAMP_TO_EDGE,REPEAT:j.REPEAT,MIRRORED_REPEAT:j.MIRRORED_REPEAT,validate:function(e){return e===s_.CLAMP_TO_EDGE||e===s_.REPEAT||e===s_.MIRRORED_REPEAT}},ii=Object.freeze(s_);function Cn(e){e=T(e,T.EMPTY_OBJECT);const t=T(e.wrapS,ii.CLAMP_TO_EDGE),n=T(e.wrapT,ii.CLAMP_TO_EDGE),i=T(e.minificationFilter,Ut.LINEAR),r=T(e.magnificationFilter,ws.LINEAR),s=l(e.maximumAnisotropy)?e.maximumAnisotropy:1;if(!ii.validate(t))throw new A("Invalid sampler.wrapS.");if(!ii.validate(n))throw new A("Invalid sampler.wrapT.");if(!Ut.validate(i))throw new A("Invalid sampler.minificationFilter.");if(!ws.validate(r))throw new A("Invalid sampler.magnificationFilter.");y.typeOf.number.greaterThanOrEquals("maximumAnisotropy",s,1),this._wrapS=t,this._wrapT=n,this._minificationFilter=i,this._magnificationFilter=r,this._maximumAnisotropy=s}Object.defineProperties(Cn.prototype,{wrapS:{get:function(){return this._wrapS}},wrapT:{get:function(){return this._wrapT}},minificationFilter:{get:function(){return this._minificationFilter}},magnificationFilter:{get:function(){return this._magnificationFilter}},maximumAnisotropy:{get:function(){return this._maximumAnisotropy}}});Cn.equals=function(e,t){return e===t||l(e)&&l(t)&&e._wrapS===t._wrapS&&e._wrapT===t._wrapT&&e._minificationFilter===t._minificationFilter&&e._magnificationFilter===t._magnificationFilter&&e._maximumAnisotropy===t._maximumAnisotropy};Cn.NEAREST=Object.freeze(new Cn({wrapS:ii.CLAMP_TO_EDGE,wrapT:ii.CLAMP_TO_EDGE,minificationFilter:Ut.NEAREST,magnificationFilter:ws.NEAREST}));function Fu(e){e=T(e,T.EMPTY_OBJECT),y.defined("options.context",e.context);const t=e.context,n=e.source;let i,r;if(l(n)){const C=[n.positiveX,n.negativeX,n.positiveY,n.negativeY,n.positiveZ,n.negativeZ];if(!C[0]||!C[1]||!C[2]||!C[3]||!C[4]||!C[5])throw new A("options.source requires positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ faces.");i=C[0].width,r=C[0].height;for(let w=1;w<6;++w)if(Number(C[w].width)!==i||Number(C[w].height)!==r)throw new A("Each face in options.source must have the same width and height.")}else i=e.width,r=e.height;const s=i,o=T(e.pixelDatatype,De.UNSIGNED_BYTE),a=T(e.pixelFormat,Le.RGBA),c=Le.toInternalFormat(a,o,t);if(!l(i)||!l(r))throw new A("options requires a source field to create an initialized cube map or width and height fields to create a blank cube map.");if(i!==r)throw new A("Width must equal height.");if(s<=0)throw new A("Width and height must be greater than zero.");if(s>We.maximumCubeMapSize)throw new A(`Width and height must be less than or equal to the maximum cube map size (${We.maximumCubeMapSize}).  Check maximumCubeMapSize.`);if(!Le.validate(a))throw new A("Invalid options.pixelFormat.");if(Le.isDepthFormat(a))throw new A("options.pixelFormat cannot be DEPTH_COMPONENT or DEPTH_STENCIL.");if(!De.validate(o))throw new A("Invalid options.pixelDatatype.");if(o===De.FLOAT&&!t.floatingPointTexture)throw new A("When options.pixelDatatype is FLOAT, this WebGL implementation must support the OES_texture_float extension.");if(o===De.HALF_FLOAT&&!t.halfFloatingPointTexture)throw new A("When options.pixelDatatype is HALF_FLOAT, this WebGL implementation must support the OES_texture_half_float extension.");const u=Le.textureSizeInBytes(a,o,s,s)*6,h=e.preMultiplyAlpha||a===Le.RGB||a===Le.LUMINANCE,d=T(e.flipY,!0),p=T(e.skipColorSpaceConversion,!1),g=t._gl,_=g.TEXTURE_CUBE_MAP,b=g.createTexture();g.activeTexture(g.TEXTURE0),g.bindTexture(_,b);function x(C,w,S,v,D){let L=w.arrayBufferView;l(L)||(L=w.bufferView);let O=4;l(L)&&(O=Le.alignmentInBytes(a,o,i)),g.pixelStorei(g.UNPACK_ALIGNMENT,O),D?g.pixelStorei(g.UNPACK_COLORSPACE_CONVERSION_WEBGL,g.NONE):g.pixelStorei(g.UNPACK_COLORSPACE_CONVERSION_WEBGL,g.BROWSER_DEFAULT_WEBGL),l(L)?(g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!1),v&&(L=Le.flipY(L,a,o,s,s)),g.texImage2D(C,0,c,s,s,0,a,De.toWebGLConstant(o,t),L)):(g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,S),g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,v),g.texImage2D(C,0,c,a,De.toWebGLConstant(o,t),w))}l(n)?(x(g.TEXTURE_CUBE_MAP_POSITIVE_X,n.positiveX,h,d,p),x(g.TEXTURE_CUBE_MAP_NEGATIVE_X,n.negativeX,h,d,p),x(g.TEXTURE_CUBE_MAP_POSITIVE_Y,n.positiveY,h,d,p),x(g.TEXTURE_CUBE_MAP_NEGATIVE_Y,n.negativeY,h,d,p),x(g.TEXTURE_CUBE_MAP_POSITIVE_Z,n.positiveZ,h,d,p),x(g.TEXTURE_CUBE_MAP_NEGATIVE_Z,n.negativeZ,h,d,p)):(g.texImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_X,0,c,s,s,0,a,De.toWebGLConstant(o,t),null),g.texImage2D(g.TEXTURE_CUBE_MAP_NEGATIVE_X,0,c,s,s,0,a,De.toWebGLConstant(o,t),null),g.texImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_Y,0,c,s,s,0,a,De.toWebGLConstant(o,t),null),g.texImage2D(g.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,c,s,s,0,a,De.toWebGLConstant(o,t),null),g.texImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_Z,0,c,s,s,0,a,De.toWebGLConstant(o,t),null),g.texImage2D(g.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,c,s,s,0,a,De.toWebGLConstant(o,t),null)),g.bindTexture(_,null),this._context=t,this._textureFilterAnisotropic=t._textureFilterAnisotropic,this._textureTarget=_,this._texture=b,this._pixelFormat=a,this._pixelDatatype=o,this._size=s,this._hasMipmap=!1,this._sizeInBytes=u,this._preMultiplyAlpha=h,this._flipY=d,this._sampler=void 0;const E=l(n);this._positiveX=new ja(t,b,_,g.TEXTURE_CUBE_MAP_POSITIVE_X,c,a,o,s,h,d,E),this._negativeX=new ja(t,b,_,g.TEXTURE_CUBE_MAP_NEGATIVE_X,c,a,o,s,h,d,E),this._positiveY=new ja(t,b,_,g.TEXTURE_CUBE_MAP_POSITIVE_Y,c,a,o,s,h,d,E),this._negativeY=new ja(t,b,_,g.TEXTURE_CUBE_MAP_NEGATIVE_Y,c,a,o,s,h,d,E),this._positiveZ=new ja(t,b,_,g.TEXTURE_CUBE_MAP_POSITIVE_Z,c,a,o,s,h,d,E),this._negativeZ=new ja(t,b,_,g.TEXTURE_CUBE_MAP_NEGATIVE_Z,c,a,o,s,h,d,E),this.sampler=l(e.sampler)?e.sampler:new Cn}Object.defineProperties(Fu.prototype,{positiveX:{get:function(){return this._positiveX}},negativeX:{get:function(){return this._negativeX}},positiveY:{get:function(){return this._positiveY}},negativeY:{get:function(){return this._negativeY}},positiveZ:{get:function(){return this._positiveZ}},negativeZ:{get:function(){return this._negativeZ}},sampler:{get:function(){return this._sampler},set:function(e){let t=e.minificationFilter,n=e.magnificationFilter;const i=t===Ut.NEAREST_MIPMAP_NEAREST||t===Ut.NEAREST_MIPMAP_LINEAR||t===Ut.LINEAR_MIPMAP_NEAREST||t===Ut.LINEAR_MIPMAP_LINEAR,r=this._context,s=this._pixelDatatype;(s===De.FLOAT&&!r.textureFloatLinear||s===De.HALF_FLOAT&&!r.textureHalfFloatLinear)&&(t=i?Ut.NEAREST_MIPMAP_NEAREST:Ut.NEAREST,n=ws.NEAREST);const o=r._gl,a=this._textureTarget;o.activeTexture(o.TEXTURE0),o.bindTexture(a,this._texture),o.texParameteri(a,o.TEXTURE_MIN_FILTER,t),o.texParameteri(a,o.TEXTURE_MAG_FILTER,n),o.texParameteri(a,o.TEXTURE_WRAP_S,e.wrapS),o.texParameteri(a,o.TEXTURE_WRAP_T,e.wrapT),l(this._textureFilterAnisotropic)&&o.texParameteri(a,this._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.maximumAnisotropy),o.bindTexture(a,null),this._sampler=e}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},width:{get:function(){return this._size}},height:{get:function(){return this._size}},sizeInBytes:{get:function(){return this._hasMipmap?Math.floor(this._sizeInBytes*4/3):this._sizeInBytes}},preMultiplyAlpha:{get:function(){return this._preMultiplyAlpha}},flipY:{get:function(){return this._flipY}},_target:{get:function(){return this._textureTarget}}});Fu.prototype.generateMipmap=function(e){if(e=T(e,dh.DONT_CARE),this._size>1&&!R.isPowerOfTwo(this._size))throw new A("width and height must be a power of two to call generateMipmap().");if(!dh.validate(e))throw new A("hint is invalid.");this._hasMipmap=!0;const t=this._context._gl,n=this._textureTarget;t.hint(t.GENERATE_MIPMAP_HINT,e),t.activeTexture(t.TEXTURE0),t.bindTexture(n,this._texture),t.generateMipmap(n),t.bindTexture(n,null)};Fu.prototype.isDestroyed=function(){return!1};Fu.prototype.destroy=function(){return this._context._gl.deleteTexture(this._texture),this._positiveX=Ye(this._positiveX),this._negativeX=Ye(this._negativeX),this._positiveY=Ye(this._positiveY),this._negativeY=Ye(this._negativeY),this._positiveZ=Ye(this._positiveZ),this._negativeZ=Ye(this._negativeZ),Ye(this)};const xK=`/**
 * A built-in GLSL floating-point constant for converting radians to degrees.
 *
 * @alias czm_degreesPerRadian
 * @glslConstant
 *
 * @see CesiumMath.DEGREES_PER_RADIAN
 *
 * @example
 * // GLSL declaration
 * const float czm_degreesPerRadian = ...;
 *
 * // Example
 * float deg = czm_degreesPerRadian * rad;
 */
const float czm_degreesPerRadian = 57.29577951308232;
`,EK=`/**
 * A built-in GLSL vec2 constant for defining the depth range.
 * This is a workaround to a bug where IE11 does not implement gl_DepthRange.
 *
 * @alias czm_depthRange
 * @glslConstant
 *
 * @example
 * // GLSL declaration
 * float depthRangeNear = czm_depthRange.near;
 * float depthRangeFar = czm_depthRange.far;
 *
 */
const czm_depthRangeStruct czm_depthRange = czm_depthRangeStruct(0.0, 1.0);
`,CK=`/**
 * 0.1
 *
 * @name czm_epsilon1
 * @glslConstant
 */
const float czm_epsilon1 = 0.1;
`,wK=`/**
 * 0.01
 *
 * @name czm_epsilon2
 * @glslConstant
 */
const float czm_epsilon2 = 0.01;
`,AK=`/**
 * 0.001
 *
 * @name czm_epsilon3
 * @glslConstant
 */
const float czm_epsilon3 = 0.001;
`,SK=`/**
 * 0.0001
 *
 * @name czm_epsilon4
 * @glslConstant
 */
const float czm_epsilon4 = 0.0001;
`,vK=`/**
 * 0.00001
 *
 * @name czm_epsilon5
 * @glslConstant
 */
const float czm_epsilon5 = 0.00001;
`,IK=`/**
 * 0.000001
 *
 * @name czm_epsilon6
 * @glslConstant
 */
const float czm_epsilon6 = 0.000001;
`,OK=`/**
 * 0.0000001
 *
 * @name czm_epsilon7
 * @glslConstant
 */
const float czm_epsilon7 = 0.0000001;
`,RK=`/**
 * DOC_TBA
 *
 * @name czm_infinity
 * @glslConstant
 */
const float czm_infinity = 5906376272000.0;  // Distance from the Sun to Pluto in meters.  TODO: What is best given lowp, mediump, and highp?
`,DK=`/**
 * A built-in GLSL floating-point constant for <code>1/pi</code>.
 *
 * @alias czm_oneOverPi
 * @glslConstant
 *
 * @see CesiumMath.ONE_OVER_PI
 *
 * @example
 * // GLSL declaration
 * const float czm_oneOverPi = ...;
 *
 * // Example
 * float pi = 1.0 / czm_oneOverPi;
 */
const float czm_oneOverPi = 0.3183098861837907;
`,MK=`/**
 * A built-in GLSL floating-point constant for <code>1/2pi</code>.
 *
 * @alias czm_oneOverTwoPi
 * @glslConstant
 *
 * @see CesiumMath.ONE_OVER_TWO_PI
 *
 * @example
 * // GLSL declaration
 * const float czm_oneOverTwoPi = ...;
 *
 * // Example
 * float pi = 2.0 * czm_oneOverTwoPi;
 */
const float czm_oneOverTwoPi = 0.15915494309189535;
`,LK=`/**
 * The automatic GLSL constant for {@link Pass#CESIUM_3D_TILE}
 *
 * @name czm_passCesium3DTile
 * @glslConstant
 *
 * @see czm_pass
 */
const float czm_passCesium3DTile = 4.0;
`,PK=`/**
 * The automatic GLSL constant for {@link Pass#CESIUM_3D_TILE_CLASSIFICATION}
 *
 * @name czm_passCesium3DTileClassification
 * @glslConstant
 *
 * @see czm_pass
 */
const float czm_passCesium3DTileClassification = 5.0;
`,NK=`/**
 * The automatic GLSL constant for {@link Pass#CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW}
 *
 * @name czm_passCesium3DTileClassificationIgnoreShow
 * @glslConstant
 *
 * @see czm_pass
 */
const float czm_passCesium3DTileClassificationIgnoreShow = 6.0;
`,FK=`/**
 * The automatic GLSL constant for {@link Pass#CLASSIFICATION}
 *
 * @name czm_passClassification
 * @glslConstant
 *
 * @see czm_pass
 */
const float czm_passClassification = 7.0;
`,BK=`/**
 * The automatic GLSL constant for {@link Pass#COMPUTE}
 *
 * @name czm_passCompute
 * @glslConstant
 *
 * @see czm_pass
 */
const float czm_passCompute = 1.0;
`,zK=`/**
 * The automatic GLSL constant for {@link Pass#ENVIRONMENT}
 *
 * @name czm_passEnvironment
 * @glslConstant
 *
 * @see czm_pass
 */
const float czm_passEnvironment = 0.0;
`,UK=`/**
 * The automatic GLSL constant for {@link Pass#GLOBE}
 *
 * @name czm_passGlobe
 * @glslConstant
 *
 * @see czm_pass
 */
const float czm_passGlobe = 2.0;
`,kK=`/**
 * The automatic GLSL constant for {@link Pass#OPAQUE}
 *
 * @name czm_passOpaque
 * @glslConstant
 *
 * @see czm_pass
 */
const float czm_passOpaque = 7.0;
`,jK=`/**
 * The automatic GLSL constant for {@link Pass#OVERLAY}
 *
 * @name czm_passOverlay
 * @glslConstant
 *
 * @see czm_pass
 */
const float czm_passOverlay = 10.0;
`,VK=`/**
 * The automatic GLSL constant for {@link Pass#TERRAIN_CLASSIFICATION}
 *
 * @name czm_passTerrainClassification
 * @glslConstant
 *
 * @see czm_pass
 */
const float czm_passTerrainClassification = 3.0;
`,GK=`/**
 * The automatic GLSL constant for {@link Pass#TRANSLUCENT}
 *
 * @name czm_passTranslucent
 * @glslConstant
 *
 * @see czm_pass
 */
const float czm_passTranslucent = 8.0;
`,HK=`/**
 * The automatic GLSL constant for {@link Pass#VOXELS}
 *
 * @name czm_passVoxels
 * @glslConstant
 *
 * @see czm_pass
 */
const float czm_passVoxels = 9.0;
`,qK=`/**
 * A built-in GLSL floating-point constant for <code>Math.PI</code>.
 *
 * @alias czm_pi
 * @glslConstant
 *
 * @see CesiumMath.PI
 *
 * @example
 * // GLSL declaration
 * const float czm_pi = ...;
 *
 * // Example
 * float twoPi = 2.0 * czm_pi;
 */
const float czm_pi = 3.141592653589793;
`,WK=`/**
 * A built-in GLSL floating-point constant for <code>pi/4</code>.
 *
 * @alias czm_piOverFour
 * @glslConstant
 *
 * @see CesiumMath.PI_OVER_FOUR
 *
 * @example
 * // GLSL declaration
 * const float czm_piOverFour = ...;
 *
 * // Example
 * float pi = 4.0 * czm_piOverFour;
 */
const float czm_piOverFour = 0.7853981633974483;
`,$K=`/**
 * A built-in GLSL floating-point constant for <code>pi/6</code>.
 *
 * @alias czm_piOverSix
 * @glslConstant
 *
 * @see CesiumMath.PI_OVER_SIX
 *
 * @example
 * // GLSL declaration
 * const float czm_piOverSix = ...;
 *
 * // Example
 * float pi = 6.0 * czm_piOverSix;
 */
const float czm_piOverSix = 0.5235987755982988;
`,XK=`/**
 * A built-in GLSL floating-point constant for <code>pi/3</code>.
 *
 * @alias czm_piOverThree
 * @glslConstant
 *
 * @see CesiumMath.PI_OVER_THREE
 *
 * @example
 * // GLSL declaration
 * const float czm_piOverThree = ...;
 *
 * // Example
 * float pi = 3.0 * czm_piOverThree;
 */
const float czm_piOverThree = 1.0471975511965976;
`,YK=`/**
 * A built-in GLSL floating-point constant for <code>pi/2</code>.
 *
 * @alias czm_piOverTwo
 * @glslConstant
 *
 * @see CesiumMath.PI_OVER_TWO
 *
 * @example
 * // GLSL declaration
 * const float czm_piOverTwo = ...;
 *
 * // Example
 * float pi = 2.0 * czm_piOverTwo;
 */
const float czm_piOverTwo = 1.5707963267948966;
`,KK=`/**
 * A built-in GLSL floating-point constant for converting degrees to radians.
 *
 * @alias czm_radiansPerDegree
 * @glslConstant
 *
 * @see CesiumMath.RADIANS_PER_DEGREE
 *
 * @example
 * // GLSL declaration
 * const float czm_radiansPerDegree = ...;
 *
 * // Example
 * float rad = czm_radiansPerDegree * deg;
 */
const float czm_radiansPerDegree = 0.017453292519943295;
`,ZK=`/**
 * The constant identifier for the 2D {@link SceneMode}
 *
 * @name czm_sceneMode2D
 * @glslConstant
 * @see czm_sceneMode
 * @see czm_sceneModeColumbusView
 * @see czm_sceneMode3D
 * @see czm_sceneModeMorphing
 */
const float czm_sceneMode2D = 2.0;
`,JK=`/**
 * The constant identifier for the 3D {@link SceneMode}
 *
 * @name czm_sceneMode3D
 * @glslConstant
 * @see czm_sceneMode
 * @see czm_sceneMode2D
 * @see czm_sceneModeColumbusView
 * @see czm_sceneModeMorphing
 */
const float czm_sceneMode3D = 3.0;
`,QK=`/**
 * The constant identifier for the Columbus View {@link SceneMode}
 *
 * @name czm_sceneModeColumbusView
 * @glslConstant
 * @see czm_sceneMode
 * @see czm_sceneMode2D
 * @see czm_sceneMode3D
 * @see czm_sceneModeMorphing
 */
const float czm_sceneModeColumbusView = 1.0;
`,eZ=`/**
 * The constant identifier for the Morphing {@link SceneMode}
 *
 * @name czm_sceneModeMorphing
 * @glslConstant
 * @see czm_sceneMode
 * @see czm_sceneMode2D
 * @see czm_sceneModeColumbusView
 * @see czm_sceneMode3D
 */
const float czm_sceneModeMorphing = 0.0;
`,tZ=`/**
 * A built-in GLSL floating-point constant for one solar radius.
 *
 * @alias czm_solarRadius
 * @glslConstant
 *
 * @see CesiumMath.SOLAR_RADIUS
 *
 * @example
 * // GLSL declaration
 * const float czm_solarRadius = ...;
 */
const float czm_solarRadius = 695500000.0;
`,nZ=`/**
 * A built-in GLSL floating-point constant for <code>3pi/2</code>.
 *
 * @alias czm_threePiOver2
 * @glslConstant
 *
 * @see CesiumMath.THREE_PI_OVER_TWO
 *
 * @example
 * // GLSL declaration
 * const float czm_threePiOver2 = ...;
 *
 * // Example
 * float pi = (2.0 / 3.0) * czm_threePiOver2;
 */
const float czm_threePiOver2 = 4.71238898038469;
`,iZ=`/**
 * A built-in GLSL floating-point constant for <code>2pi</code>.
 *
 * @alias czm_twoPi
 * @glslConstant
 *
 * @see CesiumMath.TWO_PI
 *
 * @example
 * // GLSL declaration
 * const float czm_twoPi = ...;
 *
 * // Example
 * float pi = czm_twoPi / 2.0;
 */
const float czm_twoPi = 6.283185307179586;
`,rZ=`/**
 * The maximum latitude, in radians, both North and South, supported by a Web Mercator
 * (EPSG:3857) projection.  Technically, the Mercator projection is defined
 * for any latitude up to (but not including) 90 degrees, but it makes sense
 * to cut it off sooner because it grows exponentially with increasing latitude.
 * The logic behind this particular cutoff value, which is the one used by
 * Google Maps, Bing Maps, and Esri, is that it makes the projection
 * square.  That is, the rectangle is equal in the X and Y directions.
 *
 * The constant value is computed as follows:
 *   czm_pi * 0.5 - (2.0 * atan(exp(-czm_pi)))
 *
 * @name czm_webMercatorMaxLatitude
 * @glslConstant
 */
const float czm_webMercatorMaxLatitude = 1.4844222297453324;
`,sZ=`/**
 * @name czm_depthRangeStruct
 * @glslStruct
 */
struct czm_depthRangeStruct
{
    float near;
    float far;
};
`,oZ=`/**
 * Holds material information that can be used for lighting. Returned by all czm_getMaterial functions.
 *
 * @name czm_material
 * @glslStruct
 *
 * @property {vec3} diffuse Incoming light that scatters evenly in all directions.
 * @property {float} specular Intensity of incoming light reflecting in a single direction.
 * @property {float} shininess The sharpness of the specular reflection.  Higher values create a smaller, more focused specular highlight.
 * @property {vec3} normal Surface's normal in eye coordinates. It is used for effects such as normal mapping. The default is the surface's unmodified normal.
 * @property {vec3} emission Light emitted by the material equally in all directions. The default is vec3(0.0), which emits no light.
 * @property {float} alpha Alpha of this material. 0.0 is completely transparent; 1.0 is completely opaque.
 */
struct czm_material
{
    vec3 diffuse;
    float specular;
    float shininess;
    vec3 normal;
    vec3 emission;
    float alpha;
};
`,aZ=`/**
 * Used as input to every material's czm_getMaterial function.
 *
 * @name czm_materialInput
 * @glslStruct
 *
 * @property {float} s 1D texture coordinates.
 * @property {vec2} st 2D texture coordinates.
 * @property {vec3} str 3D texture coordinates.
 * @property {vec3} normalEC Unperturbed surface normal in eye coordinates.
 * @property {mat3} tangentToEyeMatrix Matrix for converting a tangent space normal to eye space.
 * @property {vec3} positionToEyeEC Vector from the fragment to the eye in eye coordinates.  The magnitude is the distance in meters from the fragment to the eye.
 * @property {float} height The height of the terrain in meters above or below the ellipsoid.  Only available for globe materials.
 * @property {float} slope The slope of the terrain in radians.  0 is flat; pi/2 is vertical.  Only available for globe materials.
 * @property {float} aspect The aspect of the terrain in radians.  0 is East, pi/2 is North, pi is West, 3pi/2 is South.  Only available for globe materials.
 */
struct czm_materialInput
{
    float s;
    vec2 st;
    vec3 str;
    vec3 normalEC;
    mat3 tangentToEyeMatrix;
    vec3 positionToEyeEC;
    float height;
    float slope;
    float aspect;
};
`,cZ=`/**
 * Struct for representing a material for a {@link Model}. The model
 * rendering pipeline will pass this struct between material, custom shaders,
 * and lighting stages. This is not to be confused with {@link czm_material}
 * which is used by the older Fabric materials system, although they are similar.
 * <p>
 * All color values (diffuse, specular, emissive) are in linear color space.
 * </p>
 *
 * @name czm_modelMaterial
 * @glslStruct
 *
 * @property {vec4} baseColor The base color of the material.
 * @property {vec3} diffuse Incoming light that scatters evenly in all directions.
 * @property {float} alpha Alpha of this material. 0.0 is completely transparent; 1.0 is completely opaque.
 * @property {vec3} specular Color of reflected light at normal incidence in PBR materials. This is sometimes referred to as f0 in the literature.
 * @property {float} roughness A number from 0.0 to 1.0 representing how rough the surface is. Values near 0.0 produce glossy surfaces, while values near 1.0 produce rough surfaces.
 * @property {vec3} normalEC Surface's normal in eye coordinates. It is used for effects such as normal mapping. The default is the surface's unmodified normal.
 * @property {float} occlusion Ambient occlusion recieved at this point on the material. 1.0 means fully lit, 0.0 means fully occluded.
 * @property {vec3} emissive Light emitted by the material equally in all directions. The default is vec3(0.0), which emits no light.
 */
struct czm_modelMaterial {
    vec4 baseColor;
    vec3 diffuse;
    float alpha;
    vec3 specular;
    float roughness;
    vec3 normalEC;
    float occlusion;
    vec3 emissive;
#ifdef USE_SPECULAR
    float specularWeight;
#endif
#ifdef USE_ANISOTROPY
    vec3 anisotropicT;
    vec3 anisotropicB;
    float anisotropyStrength;
#endif
#ifdef USE_CLEARCOAT
    float clearcoatFactor;
    float clearcoatRoughness;
    vec3 clearcoatNormal;
    // Add clearcoatF0 when KHR_materials_ior is implemented
#endif
};
`,lZ=`/**
 * Struct for representing the output of a custom vertex shader.
 * 
 * @name czm_modelVertexOutput
 * @glslStruct
 *
 * @see {@link CustomShader}
 * @see {@link Model}
 *
 * @property {vec3} positionMC The position of the vertex in model coordinates
 * @property {float} pointSize A custom value for gl_PointSize. This is only used for point primitives. 
 */
struct czm_modelVertexOutput {
  vec3 positionMC;
  float pointSize;
};
`,uZ=`/**
 * DOC_TBA
 *
 * @name czm_ray
 * @glslStruct
 */
struct czm_ray
{
    vec3 origin;
    vec3 direction;
};
`,fZ=`/**
 * DOC_TBA
 *
 * @name czm_raySegment
 * @glslStruct
 */
struct czm_raySegment
{
    float start;
    float stop;
};

/**
 * DOC_TBA
 *
 * @name czm_emptyRaySegment
 * @glslConstant 
 */
const czm_raySegment czm_emptyRaySegment = czm_raySegment(-czm_infinity, -czm_infinity);

/**
 * DOC_TBA
 *
 * @name czm_fullRaySegment
 * @glslConstant 
 */
const czm_raySegment czm_fullRaySegment = czm_raySegment(0.0, czm_infinity);
`,hZ=`struct czm_shadowParameters
{
#ifdef USE_CUBE_MAP_SHADOW
    vec3 texCoords;
#else
    vec2 texCoords;
#endif

    float depthBias;
    float depth;
    float nDotL;
    vec2 texelStepSize;
    float normalShadingSmooth;
    float darkness;
};
`,dZ=`/**
 * Converts an HSB color (hue, saturation, brightness) to RGB
 * HSB <-> RGB conversion with minimal branching: {@link http://lolengine.net/blog/2013/07/27/rgb-to-hsv-in-glsl}
 *
 * @name czm_HSBToRGB
 * @glslFunction
 * 
 * @param {vec3} hsb The color in HSB.
 *
 * @returns {vec3} The color in RGB.
 *
 * @example
 * vec3 hsb = czm_RGBToHSB(rgb);
 * hsb.z *= 0.1;
 * rgb = czm_HSBToRGB(hsb);
 */

const vec4 K_HSB2RGB = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);

vec3 czm_HSBToRGB(vec3 hsb)
{
    vec3 p = abs(fract(hsb.xxx + K_HSB2RGB.xyz) * 6.0 - K_HSB2RGB.www);
    return hsb.z * mix(K_HSB2RGB.xxx, clamp(p - K_HSB2RGB.xxx, 0.0, 1.0), hsb.y);
}
`,pZ=`/**
 * Converts an HSL color (hue, saturation, lightness) to RGB
 * HSL <-> RGB conversion: {@link http://www.chilliant.com/rgb2hsv.html}
 *
 * @name czm_HSLToRGB
 * @glslFunction
 * 
 * @param {vec3} rgb The color in HSL.
 *
 * @returns {vec3} The color in RGB.
 *
 * @example
 * vec3 hsl = czm_RGBToHSL(rgb);
 * hsl.z *= 0.1;
 * rgb = czm_HSLToRGB(hsl);
 */

vec3 hueToRGB(float hue)
{
    float r = abs(hue * 6.0 - 3.0) - 1.0;
    float g = 2.0 - abs(hue * 6.0 - 2.0);
    float b = 2.0 - abs(hue * 6.0 - 4.0);
    return clamp(vec3(r, g, b), 0.0, 1.0);
}

vec3 czm_HSLToRGB(vec3 hsl)
{
    vec3 rgb = hueToRGB(hsl.x);
    float c = (1.0 - abs(2.0 * hsl.z - 1.0)) * hsl.y;
    return (rgb - 0.5) * c + hsl.z;
}
`,mZ=`/**
 * Converts an RGB color to HSB (hue, saturation, brightness)
 * HSB <-> RGB conversion with minimal branching: {@link http://lolengine.net/blog/2013/07/27/rgb-to-hsv-in-glsl}
 *
 * @name czm_RGBToHSB
 * @glslFunction
 * 
 * @param {vec3} rgb The color in RGB.
 *
 * @returns {vec3} The color in HSB.
 *
 * @example
 * vec3 hsb = czm_RGBToHSB(rgb);
 * hsb.z *= 0.1;
 * rgb = czm_HSBToRGB(hsb);
 */

const vec4 K_RGB2HSB = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);

vec3 czm_RGBToHSB(vec3 rgb)
{
    vec4 p = mix(vec4(rgb.bg, K_RGB2HSB.wz), vec4(rgb.gb, K_RGB2HSB.xy), step(rgb.b, rgb.g));
    vec4 q = mix(vec4(p.xyw, rgb.r), vec4(rgb.r, p.yzx), step(p.x, rgb.r));

    float d = q.x - min(q.w, q.y);
    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + czm_epsilon7)), d / (q.x + czm_epsilon7), q.x);
}
`,gZ=`/**
 * Converts an RGB color to HSL (hue, saturation, lightness)
 * HSL <-> RGB conversion: {@link http://www.chilliant.com/rgb2hsv.html}
 *
 * @name czm_RGBToHSL
 * @glslFunction
 * 
 * @param {vec3} rgb The color in RGB.
 *
 * @returns {vec3} The color in HSL.
 *
 * @example
 * vec3 hsl = czm_RGBToHSL(rgb);
 * hsl.z *= 0.1;
 * rgb = czm_HSLToRGB(hsl);
 */
 
vec3 RGBtoHCV(vec3 rgb)
{
    // Based on work by Sam Hocevar and Emil Persson
    vec4 p = (rgb.g < rgb.b) ? vec4(rgb.bg, -1.0, 2.0 / 3.0) : vec4(rgb.gb, 0.0, -1.0 / 3.0);
    vec4 q = (rgb.r < p.x) ? vec4(p.xyw, rgb.r) : vec4(rgb.r, p.yzx);
    float c = q.x - min(q.w, q.y);
    float h = abs((q.w - q.y) / (6.0 * c + czm_epsilon7) + q.z);
    return vec3(h, c, q.x);
}

vec3 czm_RGBToHSL(vec3 rgb)
{
    vec3 hcv = RGBtoHCV(rgb);
    float l = hcv.z - hcv.y * 0.5;
    float s = hcv.y / (1.0 - abs(l * 2.0 - 1.0) + czm_epsilon7);
    return vec3(hcv.x, s, l);
}
`,_Z=`/**
 * Converts an RGB color to CIE Yxy.
 * <p>The conversion is described in
 * {@link http://content.gpwiki.org/index.php/D3DBook:High-Dynamic_Range_Rendering#Luminance_Transform|Luminance Transform}
 * </p>
 * 
 * @name czm_RGBToXYZ
 * @glslFunction
 * 
 * @param {vec3} rgb The color in RGB.
 *
 * @returns {vec3} The color in CIE Yxy.
 *
 * @example
 * vec3 xyz = czm_RGBToXYZ(rgb);
 * xyz.x = max(xyz.x - luminanceThreshold, 0.0);
 * rgb = czm_XYZToRGB(xyz);
 */
vec3 czm_RGBToXYZ(vec3 rgb)
{
    const mat3 RGB2XYZ = mat3(0.4124, 0.2126, 0.0193,
                              0.3576, 0.7152, 0.1192,
                              0.1805, 0.0722, 0.9505);
    vec3 xyz = RGB2XYZ * rgb;
    vec3 Yxy;
    Yxy.r = xyz.g;
    float temp = dot(vec3(1.0), xyz);
    Yxy.gb = xyz.rg / temp;
    return Yxy;
}
`,yZ=`/**
 * Converts a CIE Yxy color to RGB.
 * <p>The conversion is described in
 * {@link http://content.gpwiki.org/index.php/D3DBook:High-Dynamic_Range_Rendering#Luminance_Transform|Luminance Transform}
 * </p>
 * 
 * @name czm_XYZToRGB
 * @glslFunction
 * 
 * @param {vec3} Yxy The color in CIE Yxy.
 *
 * @returns {vec3} The color in RGB.
 *
 * @example
 * vec3 xyz = czm_RGBToXYZ(rgb);
 * xyz.x = max(xyz.x - luminanceThreshold, 0.0);
 * rgb = czm_XYZToRGB(xyz);
 */
vec3 czm_XYZToRGB(vec3 Yxy)
{
    const mat3 XYZ2RGB = mat3( 3.2405, -0.9693,  0.0556,
                              -1.5371,  1.8760, -0.2040,
                              -0.4985,  0.0416,  1.0572);
    vec3 xyz;
    xyz.r = Yxy.r * Yxy.g / Yxy.b;
    xyz.g = Yxy.r;
    xyz.b = Yxy.r * (1.0 - Yxy.g - Yxy.b) / Yxy.b;
    
    return XYZ2RGB * xyz;
}
`,bZ=`// See:
//    https://knarkowicz.wordpress.com/2016/01/06/aces-filmic-tone-mapping-curve/

vec3 czm_acesTonemapping(vec3 color) {
    float g = 0.985;
    float a = 0.065;
    float b = 0.0001;
    float c = 0.433;
    float d = 0.238;

    color = (color * (color + a) - b) / (color * (g * color + c) + d);

    color = clamp(color, 0.0, 1.0);

    return color;
}
`,TZ=`/**
 * @private
 */
float czm_alphaWeight(float a)
{
    float z = (gl_FragCoord.z - czm_viewportTransformation[3][2]) / czm_viewportTransformation[2][2];

    // See Weighted Blended Order-Independent Transparency for examples of different weighting functions:
    // http://jcgt.org/published/0002/02/09/
    return pow(a + 0.01, 4.0) + max(1e-2, min(3.0 * 1e3, 0.003 / (1e-5 + pow(abs(z) / 200.0, 4.0))));
}
`,xZ=`/**
 * Procedural anti-aliasing by blurring two colors that meet at a sharp edge.
 *
 * @name czm_antialias
 * @glslFunction
 *
 * @param {vec4} color1 The color on one side of the edge.
 * @param {vec4} color2 The color on the other side of the edge.
 * @param {vec4} currentcolor The current color, either <code>color1</code> or <code>color2</code>.
 * @param {float} dist The distance to the edge in texture coordinates.
 * @param {float} [fuzzFactor=0.1] Controls the blurriness between the two colors.
 * @returns {vec4} The anti-aliased color.
 *
 * @example
 * // GLSL declarations
 * vec4 czm_antialias(vec4 color1, vec4 color2, vec4 currentColor, float dist, float fuzzFactor);
 * vec4 czm_antialias(vec4 color1, vec4 color2, vec4 currentColor, float dist);
 *
 * // get the color for a material that has a sharp edge at the line y = 0.5 in texture space
 * float dist = abs(textureCoordinates.t - 0.5);
 * vec4 currentColor = mix(bottomColor, topColor, step(0.5, textureCoordinates.t));
 * vec4 color = czm_antialias(bottomColor, topColor, currentColor, dist, 0.1);
 */
vec4 czm_antialias(vec4 color1, vec4 color2, vec4 currentColor, float dist, float fuzzFactor)
{
    float val1 = clamp(dist / fuzzFactor, 0.0, 1.0);
    float val2 = clamp((dist - 0.5) / fuzzFactor, 0.0, 1.0);
    val1 = val1 * (1.0 - val2);
    val1 = val1 * val1 * (3.0 - (2.0 * val1));
    val1 = pow(val1, 0.5); //makes the transition nicer
    
    vec4 midColor = (color1 + color2) * 0.5;
    return mix(midColor, currentColor, val1);
}

vec4 czm_antialias(vec4 color1, vec4 color2, vec4 currentColor, float dist)
{
    return czm_antialias(color1, color2, currentColor, dist, 0.1);
}
`,EZ=`/**
 * Apply a HSB color shift to an RGB color.
 *
 * @param {vec3} rgb The color in RGB space.
 * @param {vec3} hsbShift The amount to shift each component. The xyz components correspond to hue, saturation, and brightness. Shifting the hue by +/- 1.0 corresponds to shifting the hue by a full cycle. Saturation and brightness are clamped between 0 and 1 after the adjustment
 * @param {bool} ignoreBlackPixels If true, black pixels will be unchanged. This is necessary in some shaders such as atmosphere-related effects.
 *
 * @return {vec3} The RGB color after shifting in HSB space and clamping saturation and brightness to a valid range.
 */
vec3 czm_applyHSBShift(vec3 rgb, vec3 hsbShift, bool ignoreBlackPixels) {
    // Convert rgb color to hsb
    vec3 hsb = czm_RGBToHSB(rgb);

    // Perform hsb shift
    // Hue cycles around so no clamp is needed.
    hsb.x += hsbShift.x; // hue
    hsb.y = clamp(hsb.y + hsbShift.y, 0.0, 1.0); // saturation

    // brightness
    //
    // Some shaders such as atmosphere-related effects need to leave black
    // pixels unchanged
    if (ignoreBlackPixels) {
        hsb.z = hsb.z > czm_epsilon7 ? hsb.z + hsbShift.z : 0.0;
    } else {
        hsb.z = hsb.z + hsbShift.z;
    }
    hsb.z = clamp(hsb.z, 0.0, 1.0);

    // Convert shifted hsb back to rgb
    return czm_HSBToRGB(hsb);
}
`,CZ=`/**
 * Approximately computes spherical coordinates given a normal.
 * Uses approximate inverse trigonometry for speed and consistency,
 * since inverse trigonometry can differ from vendor-to-vendor and when compared with the CPU.
 *
 * @name czm_approximateSphericalCoordinates
 * @glslFunction
 *
 * @param {vec3} normal arbitrary-length normal.
 *
 * @returns {vec2} Approximate latitude and longitude spherical coordinates.
 */
vec2 czm_approximateSphericalCoordinates(vec3 normal) {
    // Project into plane with vertical for latitude
    float latitudeApproximation = czm_fastApproximateAtan(sqrt(normal.x * normal.x + normal.y * normal.y), normal.z);
    float longitudeApproximation = czm_fastApproximateAtan(normal.x, normal.y);
    return vec2(latitudeApproximation, longitudeApproximation);
}
`,wZ=`/**
 * Compute a rational approximation to tanh(x)
 *
 * @param {float} x A real number input
 * @returns {float} An approximation for tanh(x)
*/
float czm_approximateTanh(float x) {
    float x2 = x * x;
    return max(-1.0, min(1.0, x * (27.0 + x2) / (27.0 + 9.0 * x2)));
}
`,AZ=`/**
 * Determines if the fragment is back facing
 *
 * @name czm_backFacing
 * @glslFunction 
 * 
 * @returns {bool} <code>true</code> if the fragment is back facing; otherwise, <code>false</code>.
 */
bool czm_backFacing()
{
    // !gl_FrontFacing doesn't work as expected on Mac/Intel so use the more verbose form instead. See https://github.com/CesiumGS/cesium/pull/8494.
    return gl_FrontFacing == false;
}
`,SZ=`/**
 * Branchless ternary operator to be used when it's inexpensive to explicitly
 * evaluate both possibilities for a float expression.
 *
 * @name czm_branchFreeTernary
 * @glslFunction
 *
 * @param {bool} comparison A comparison statement
 * @param {float} a Value to return if the comparison is true.
 * @param {float} b Value to return if the comparison is false.
 *
 * @returns {float} equivalent of comparison ? a : b
 */
float czm_branchFreeTernary(bool comparison, float a, float b) {
    float useA = float(comparison);
    return a * useA + b * (1.0 - useA);
}

/**
 * Branchless ternary operator to be used when it's inexpensive to explicitly
 * evaluate both possibilities for a vec2 expression.
 *
 * @name czm_branchFreeTernary
 * @glslFunction
 *
 * @param {bool} comparison A comparison statement
 * @param {vec2} a Value to return if the comparison is true.
 * @param {vec2} b Value to return if the comparison is false.
 *
 * @returns {vec2} equivalent of comparison ? a : b
 */
vec2 czm_branchFreeTernary(bool comparison, vec2 a, vec2 b) {
    float useA = float(comparison);
    return a * useA + b * (1.0 - useA);
}

/**
 * Branchless ternary operator to be used when it's inexpensive to explicitly
 * evaluate both possibilities for a vec3 expression.
 *
 * @name czm_branchFreeTernary
 * @glslFunction
 *
 * @param {bool} comparison A comparison statement
 * @param {vec3} a Value to return if the comparison is true.
 * @param {vec3} b Value to return if the comparison is false.
 *
 * @returns {vec3} equivalent of comparison ? a : b
 */
vec3 czm_branchFreeTernary(bool comparison, vec3 a, vec3 b) {
    float useA = float(comparison);
    return a * useA + b * (1.0 - useA);
}

/**
 * Branchless ternary operator to be used when it's inexpensive to explicitly
 * evaluate both possibilities for a vec4 expression.
 *
 * @name czm_branchFreeTernary
 * @glslFunction
 *
 * @param {bool} comparison A comparison statement
 * @param {vec3} a Value to return if the comparison is true.
 * @param {vec3} b Value to return if the comparison is false.
 *
 * @returns {vec3} equivalent of comparison ? a : b
 */
vec4 czm_branchFreeTernary(bool comparison, vec4 a, vec4 b) {
    float useA = float(comparison);
    return a * useA + b * (1.0 - useA);
}
`,vZ=`
vec4 czm_cascadeColor(vec4 weights)
{
    return vec4(1.0, 0.0, 0.0, 1.0) * weights.x +
           vec4(0.0, 1.0, 0.0, 1.0) * weights.y +
           vec4(0.0, 0.0, 1.0, 1.0) * weights.z +
           vec4(1.0, 0.0, 1.0, 1.0) * weights.w;
}
`,IZ=`
uniform vec4 shadowMap_cascadeDistances;

float czm_cascadeDistance(vec4 weights)
{
    return dot(shadowMap_cascadeDistances, weights);
}
`,OZ=`
uniform mat4 shadowMap_cascadeMatrices[4];

mat4 czm_cascadeMatrix(vec4 weights)
{
    return shadowMap_cascadeMatrices[0] * weights.x +
           shadowMap_cascadeMatrices[1] * weights.y +
           shadowMap_cascadeMatrices[2] * weights.z +
           shadowMap_cascadeMatrices[3] * weights.w;
}
`,RZ=`
uniform vec4 shadowMap_cascadeSplits[2];

vec4 czm_cascadeWeights(float depthEye)
{
    // One component is set to 1.0 and all others set to 0.0.
    vec4 near = step(shadowMap_cascadeSplits[0], vec4(depthEye));
    vec4 far = step(depthEye, shadowMap_cascadeSplits[1]);
    return near * far;
}
`,DZ=`float getSignedDistance(vec2 uv, highp sampler2D clippingDistance) {
    float signedDistance = texture(clippingDistance, uv).r;
    return (signedDistance - 0.5) * 2.0;
}

void czm_clipPolygons(highp sampler2D clippingDistance, int extentsLength, vec2 clippingPosition, int regionIndex) {
    // Position is completely outside of polygons bounds
    vec2 rectUv = clippingPosition;
    if (regionIndex < 0 || rectUv.x <= 0.0 || rectUv.y <= 0.0 || rectUv.x >= 1.0 || rectUv.y >= 1.0) {
        #ifdef CLIPPING_INVERSE 
            discard;
        #endif
        return;
    }

    vec2 clippingDistanceTextureDimensions = vec2(textureSize(clippingDistance, 0));
    vec2 sampleOffset = max(1.0 / clippingDistanceTextureDimensions, vec2(0.005));
    float dimension = float(extentsLength);
    if (extentsLength > 2) {
       dimension = ceil(log2(float(extentsLength)));
    }

    vec2 textureOffset = vec2(mod(float(regionIndex), dimension), floor(float(regionIndex) / dimension)) / dimension;
    vec2 uv = textureOffset + rectUv / dimension;

    float signedDistance = getSignedDistance(uv, clippingDistance);

    #ifdef CLIPPING_INVERSE
    if (signedDistance > 0.0)  {
        discard;
    }
    #else
    if (signedDistance < 0.0)  {
        discard;
    }
    #endif
}
`,MZ=`/**
 * DOC_TBA
 *
 * @name czm_columbusViewMorph
 * @glslFunction
 */
vec4 czm_columbusViewMorph(vec4 position2D, vec4 position3D, float time)
{
    // Just linear for now.
    vec3 p = mix(position2D.xyz, position3D.xyz, time);
    return vec4(p, 1.0);
}
`,LZ=`/**
 * Compute the atmosphere color, applying Rayleigh and Mie scattering. This
 * builtin uses automatic uniforms so the atmophere settings are synced with the
 * state of the Scene, even in other contexts like Model.
 *
 * @name czm_computeAtmosphereColor
 * @glslFunction
 *
 * @param {vec3} positionWC Position of the fragment in world coords (low precision)
 * @param {vec3} lightDirection Light direction from the sun or other light source.
 * @param {vec3} rayleighColor The Rayleigh scattering color computed by a scattering function
 * @param {vec3} mieColor The Mie scattering color computed by a scattering function
 * @param {float} opacity The opacity computed by a scattering function.
 */
vec4 czm_computeAtmosphereColor(
    vec3 positionWC,
    vec3 lightDirection,
    vec3 rayleighColor,
    vec3 mieColor,
    float opacity
) {
    // Setup the primary ray: from the camera position to the vertex position.
    vec3 cameraToPositionWC = positionWC - czm_viewerPositionWC;
    vec3 cameraToPositionWCDirection = normalize(cameraToPositionWC);

    float cosAngle = dot(cameraToPositionWCDirection, lightDirection);
    float cosAngleSq = cosAngle * cosAngle;

    float G = czm_atmosphereMieAnisotropy;
    float GSq = G * G;

    // The Rayleigh phase function.
    float rayleighPhase = 3.0 / (50.2654824574) * (1.0 + cosAngleSq);
    // The Mie phase function.
    float miePhase = 3.0 / (25.1327412287) * ((1.0 - GSq) * (cosAngleSq + 1.0)) / (pow(1.0 + GSq - 2.0 * cosAngle * G, 1.5) * (2.0 + GSq));

    // The final color is generated by combining the effects of the Rayleigh and Mie scattering.
    vec3 rayleigh = rayleighPhase * rayleighColor;
    vec3 mie = miePhase * mieColor;

    vec3 color = (rayleigh + mie) * czm_atmosphereLightIntensity;

    return vec4(color, opacity);
}
`,PZ=`/**
 * Compute atmosphere scattering for the ground atmosphere and fog. This method
 * uses automatic uniforms so it is always synced with the scene settings.
 *
 * @name czm_computeGroundAtmosphereScattering
 * @glslfunction
 *
 * @param {vec3} positionWC The position of the fragment in world coordinates.
 * @param {vec3} lightDirection The direction of the light to calculate the scattering from.
 * @param {vec3} rayleighColor The variable the Rayleigh scattering will be written to.
 * @param {vec3} mieColor The variable the Mie scattering will be written to.
 * @param {float} opacity The variable the transmittance will be written to.
 */
void czm_computeGroundAtmosphereScattering(vec3 positionWC, vec3 lightDirection, out vec3 rayleighColor, out vec3 mieColor, out float opacity) {
    vec3 cameraToPositionWC = positionWC - czm_viewerPositionWC;
    vec3 cameraToPositionWCDirection = normalize(cameraToPositionWC);
    czm_ray primaryRay = czm_ray(czm_viewerPositionWC, cameraToPositionWCDirection);

    float atmosphereInnerRadius = length(positionWC);

    czm_computeScattering(
        primaryRay,
        length(cameraToPositionWC),
        lightDirection,
        atmosphereInnerRadius,
        rayleighColor,
        mieColor,
        opacity
    );
}
`,NZ=`/**
 * Returns a position in model coordinates relative to eye taking into
 * account the current scene mode: 3D, 2D, or Columbus view.
 * <p>
 * This uses standard position attributes, <code>position3DHigh</code>, 
 * <code>position3DLow</code>, <code>position2DHigh</code>, and <code>position2DLow</code>, 
 * and should be used when writing a vertex shader for an {@link Appearance}.
 * </p>
 *
 * @name czm_computePosition
 * @glslFunction
 *
 * @returns {vec4} The position relative to eye.
 *
 * @example
 * vec4 p = czm_computePosition();
 * v_positionEC = (czm_modelViewRelativeToEye * p).xyz;
 * gl_Position = czm_modelViewProjectionRelativeToEye * p;
 *
 * @see czm_translateRelativeToEye
 */
vec4 czm_computePosition();
`,FZ=`/**
 * This function computes the colors contributed by Rayliegh and Mie scattering on a given ray, as well as
 * the transmittance value for the ray. This function uses automatic uniforms
 * so the atmosphere settings are always synced with the current scene.
 *
 * @name czm_computeScattering
 * @glslfunction
 *
 * @param {czm_ray} primaryRay The ray from the camera to the position.
 * @param {float} primaryRayLength The length of the primary ray.
 * @param {vec3} lightDirection The direction of the light to calculate the scattering from.
 * @param {vec3} rayleighColor The variable the Rayleigh scattering will be written to.
 * @param {vec3} mieColor The variable the Mie scattering will be written to.
 * @param {float} opacity The variable the transmittance will be written to.
 */
void czm_computeScattering(
    czm_ray primaryRay,
    float primaryRayLength,
    vec3 lightDirection,
    float atmosphereInnerRadius,
    out vec3 rayleighColor,
    out vec3 mieColor,
    out float opacity
) {
    const float ATMOSPHERE_THICKNESS = 111e3; // The thickness of the atmosphere in meters.
    const int PRIMARY_STEPS_MAX = 16; // Maximum number of times the ray from the camera to the world position (primary ray) is sampled.
    const int LIGHT_STEPS_MAX = 4; // Maximum number of times the light is sampled from the light source's intersection with the atmosphere to a sample position on the primary ray.

    // Initialize the default scattering amounts to 0.
    rayleighColor = vec3(0.0);
    mieColor = vec3(0.0);
    opacity = 0.0;

    float atmosphereOuterRadius = atmosphereInnerRadius + ATMOSPHERE_THICKNESS;

    vec3 origin = vec3(0.0);

    // Calculate intersection from the camera to the outer ring of the atmosphere.
    czm_raySegment primaryRayAtmosphereIntersect = czm_raySphereIntersectionInterval(primaryRay, origin, atmosphereOuterRadius);

    // Return empty colors if no intersection with the atmosphere geometry.
    if (primaryRayAtmosphereIntersect == czm_emptyRaySegment) {
        rayleighColor = vec3(1.0, 0.0, 1.0);
        return;
    }

    // To deal with smaller values of PRIMARY_STEPS (e.g. 4)
    // we implement a split strategy: sky or horizon.
    // For performance reasons, instead of a if/else branch
    // a soft choice is implemented through a weight 0.0 <= w_stop_gt_lprl <= 1.0
    float x = 1e-7 * primaryRayAtmosphereIntersect.stop / length(primaryRayLength);
    // Value close to 0.0: close to the horizon
    // Value close to 1.0: above in the sky
    float w_stop_gt_lprl = 0.5 * (1.0 + czm_approximateTanh(x));

    // The ray should start from the first intersection with the outer atmopshere, or from the camera position, if it is inside the atmosphere.
    float start_0 = primaryRayAtmosphereIntersect.start;
    primaryRayAtmosphereIntersect.start = max(primaryRayAtmosphereIntersect.start, 0.0);
    // The ray should end at the exit from the atmosphere or at the distance to the vertex, whichever is smaller.
    primaryRayAtmosphereIntersect.stop = min(primaryRayAtmosphereIntersect.stop, length(primaryRayLength));

    // For the number of ray steps, distinguish inside or outside atmosphere (outer space)
    // (1) from outer space we have to use more ray steps to get a realistic rendering
    // (2) within atmosphere we need fewer steps for faster rendering
    float x_o_a = start_0 - ATMOSPHERE_THICKNESS; // ATMOSPHERE_THICKNESS used as an ad-hoc constant, no precise meaning here, only the order of magnitude matters
    float w_inside_atmosphere = 1.0 - 0.5 * (1.0 + czm_approximateTanh(x_o_a));
    int PRIMARY_STEPS = PRIMARY_STEPS_MAX - int(w_inside_atmosphere * 12.0); // Number of times the ray from the camera to the world position (primary ray) is sampled.
    int LIGHT_STEPS = LIGHT_STEPS_MAX - int(w_inside_atmosphere * 2.0); // Number of times the light is sampled from the light source's intersection with the atmosphere to a sample position on the primary ray.

    // Setup for sampling positions along the ray - starting from the intersection with the outer ring of the atmosphere.
    float rayPositionLength = primaryRayAtmosphereIntersect.start;
    // (1) Outside the atmosphere: constant rayStepLength
    // (2) Inside atmosphere: variable rayStepLength to compensate the rough rendering of the smaller number of ray steps
    float totalRayLength = primaryRayAtmosphereIntersect.stop - rayPositionLength;
    float rayStepLengthIncrease = w_inside_atmosphere * ((1.0 - w_stop_gt_lprl) * totalRayLength / (float(PRIMARY_STEPS * (PRIMARY_STEPS + 1)) / 2.0));
    float rayStepLength = max(1.0 - w_inside_atmosphere, w_stop_gt_lprl) * totalRayLength / max(7.0 * w_inside_atmosphere, float(PRIMARY_STEPS));

    vec3 rayleighAccumulation = vec3(0.0);
    vec3 mieAccumulation = vec3(0.0);
    vec2 opticalDepth = vec2(0.0);
    vec2 heightScale = vec2(czm_atmosphereRayleighScaleHeight, czm_atmosphereMieScaleHeight);

    // Sample positions on the primary ray.
    for (int i = 0; i < PRIMARY_STEPS_MAX; ++i) {

        // The loop should be: for (int i = 0; i < PRIMARY_STEPS; ++i) {...} but WebGL1 cannot
        // loop with non-constant condition, so it has to break early instead
        if (i >= PRIMARY_STEPS) {
            break;
        }

        // Calculate sample position along viewpoint ray.
        vec3 samplePosition = primaryRay.origin + primaryRay.direction * (rayPositionLength + rayStepLength);

        // Calculate height of sample position above ellipsoid.
        float sampleHeight = length(samplePosition) - atmosphereInnerRadius;

        // Calculate and accumulate density of particles at the sample position.
        vec2 sampleDensity = exp(-sampleHeight / heightScale) * rayStepLength;
        opticalDepth += sampleDensity;

        // Generate ray from the sample position segment to the light source, up to the outer ring of the atmosphere.
        czm_ray lightRay = czm_ray(samplePosition, lightDirection);
        czm_raySegment lightRayAtmosphereIntersect = czm_raySphereIntersectionInterval(lightRay, origin, atmosphereOuterRadius);

        float lightStepLength = lightRayAtmosphereIntersect.stop / float(LIGHT_STEPS);
        float lightPositionLength = 0.0;

        vec2 lightOpticalDepth = vec2(0.0);

        // Sample positions along the light ray, to accumulate incidence of light on the latest sample segment.
        for (int j = 0; j < LIGHT_STEPS_MAX; ++j) {

            // The loop should be: for (int j = 0; i < LIGHT_STEPS; ++j) {...} but WebGL1 cannot
            // loop with non-constant condition, so it has to break early instead
            if (j >= LIGHT_STEPS) {
                break;
            }

            // Calculate sample position along light ray.
            vec3 lightPosition = samplePosition + lightDirection * (lightPositionLength + lightStepLength * 0.5);

            // Calculate height of the light sample position above ellipsoid.
            float lightHeight = length(lightPosition) - atmosphereInnerRadius;

            // Calculate density of photons at the light sample position.
            lightOpticalDepth += exp(-lightHeight / heightScale) * lightStepLength;

            // Increment distance on light ray.
            lightPositionLength += lightStepLength;
        }

        // Compute attenuation via the primary ray and the light ray.
        vec3 attenuation = exp(-((czm_atmosphereMieCoefficient * (opticalDepth.y + lightOpticalDepth.y)) + (czm_atmosphereRayleighCoefficient * (opticalDepth.x + lightOpticalDepth.x))));

        // Accumulate the scattering.
        rayleighAccumulation += sampleDensity.x * attenuation;
        mieAccumulation += sampleDensity.y * attenuation;

        // Increment distance on primary ray.
        rayPositionLength += (rayStepLength += rayStepLengthIncrease);
    }

    // Compute the scattering amount.
    rayleighColor = czm_atmosphereRayleighCoefficient * rayleighAccumulation;
    mieColor = czm_atmosphereMieCoefficient * mieAccumulation;

    // Compute the transmittance i.e. how much light is passing through the atmosphere.
    opacity = length(exp(-((czm_atmosphereMieCoefficient * opticalDepth.y) + (czm_atmosphereRayleighCoefficient * opticalDepth.x))));
}
`,BZ=`/**
 * @private
 */
vec2 cordic(float angle)
{
// Scale the vector by the appropriate factor for the 24 iterations to follow.
    vec2 vector = vec2(6.0725293500888267e-1, 0.0);
// Iteration 1
    float sense = (angle < 0.0) ? -1.0 : 1.0;
 //   float factor = sense * 1.0;  // 2^-0
    mat2 rotation = mat2(1.0, sense, -sense, 1.0);
    vector = rotation * vector;
    angle -= sense * 7.8539816339744828e-1;  // atan(2^-0)
// Iteration 2
    sense = (angle < 0.0) ? -1.0 : 1.0;
    float factor = sense * 5.0e-1;  // 2^-1
    rotation[0][1] = factor;
    rotation[1][0] = -factor;
    vector = rotation * vector;
    angle -= sense * 4.6364760900080609e-1;  // atan(2^-1)
// Iteration 3
    sense = (angle < 0.0) ? -1.0 : 1.0;
    factor = sense * 2.5e-1;  // 2^-2
    rotation[0][1] = factor;
    rotation[1][0] = -factor;
    vector = rotation * vector;
    angle -= sense * 2.4497866312686414e-1;  // atan(2^-2)
// Iteration 4
    sense = (angle < 0.0) ? -1.0 : 1.0;
    factor = sense * 1.25e-1;  // 2^-3
    rotation[0][1] = factor;
    rotation[1][0] = -factor;
    vector = rotation * vector;
    angle -= sense * 1.2435499454676144e-1;  // atan(2^-3)
// Iteration 5
    sense = (angle < 0.0) ? -1.0 : 1.0;
    factor = sense * 6.25e-2;  // 2^-4
    rotation[0][1] = factor;
    rotation[1][0] = -factor;
    vector = rotation * vector;
    angle -= sense * 6.2418809995957350e-2;  // atan(2^-4)
// Iteration 6
    sense = (angle < 0.0) ? -1.0 : 1.0;
    factor = sense * 3.125e-2;  // 2^-5
    rotation[0][1] = factor;
    rotation[1][0] = -factor;
    vector = rotation * vector;
    angle -= sense * 3.1239833430268277e-2;  // atan(2^-5)
// Iteration 7
    sense = (angle < 0.0) ? -1.0 : 1.0;
    factor = sense * 1.5625e-2;  // 2^-6
    rotation[0][1] = factor;
    rotation[1][0] = -factor;
    vector = rotation * vector;
    angle -= sense * 1.5623728620476831e-2;  // atan(2^-6)
// Iteration 8
    sense = (angle < 0.0) ? -1.0 : 1.0;
    factor = sense * 7.8125e-3;  // 2^-7
    rotation[0][1] = factor;
    rotation[1][0] = -factor;
    vector = rotation * vector;
    angle -= sense * 7.8123410601011111e-3;  // atan(2^-7)
// Iteration 9
    sense = (angle < 0.0) ? -1.0 : 1.0;
    factor = sense * 3.90625e-3;  // 2^-8
    rotation[0][1] = factor;
    rotation[1][0] = -factor;
    vector = rotation * vector;
    angle -= sense * 3.9062301319669718e-3;  // atan(2^-8)
// Iteration 10
    sense = (angle < 0.0) ? -1.0 : 1.0;
    factor = sense * 1.953125e-3;  // 2^-9
    rotation[0][1] = factor;
    rotation[1][0] = -factor;
    vector = rotation * vector;
    angle -= sense * 1.9531225164788188e-3;  // atan(2^-9)
// Iteration 11
    sense = (angle < 0.0) ? -1.0 : 1.0;
    factor = sense * 9.765625e-4;  // 2^-10
    rotation[0][1] = factor;
    rotation[1][0] = -factor;
    vector = rotation * vector;
    angle -= sense * 9.7656218955931946e-4;  // atan(2^-10)
// Iteration 12
    sense = (angle < 0.0) ? -1.0 : 1.0;
    factor = sense * 4.8828125e-4;  // 2^-11
    rotation[0][1] = factor;
    rotation[1][0] = -factor;
    vector = rotation * vector;
    angle -= sense * 4.8828121119489829e-4;  // atan(2^-11)
// Iteration 13
    sense = (angle < 0.0) ? -1.0 : 1.0;
    factor = sense * 2.44140625e-4;  // 2^-12
    rotation[0][1] = factor;
    rotation[1][0] = -factor;
    vector = rotation * vector;
    angle -= sense * 2.4414062014936177e-4;  // atan(2^-12)
// Iteration 14
    sense = (angle < 0.0) ? -1.0 : 1.0;
    factor = sense * 1.220703125e-4;  // 2^-13
    rotation[0][1] = factor;
    rotation[1][0] = -factor;
    vector = rotation * vector;
    angle -= sense * 1.2207031189367021e-4;  // atan(2^-13)
// Iteration 15
    sense = (angle < 0.0) ? -1.0 : 1.0;
    factor = sense * 6.103515625e-5;  // 2^-14
    rotation[0][1] = factor;
    rotation[1][0] = -factor;
    vector = rotation * vector;
    angle -= sense * 6.1035156174208773e-5;  // atan(2^-14)
// Iteration 16
    sense = (angle < 0.0) ? -1.0 : 1.0;
    factor = sense * 3.0517578125e-5;  // 2^-15
    rotation[0][1] = factor;
    rotation[1][0] = -factor;
    vector = rotation * vector;
    angle -= sense * 3.0517578115526096e-5;  // atan(2^-15)
// Iteration 17
    sense = (angle < 0.0) ? -1.0 : 1.0;
    factor = sense * 1.52587890625e-5;  // 2^-16
    rotation[0][1] = factor;
    rotation[1][0] = -factor;
    vector = rotation * vector;
    angle -= sense * 1.5258789061315762e-5;  // atan(2^-16)
// Iteration 18
    sense = (angle < 0.0) ? -1.0 : 1.0;
    factor = sense * 7.62939453125e-6;  // 2^-17
    rotation[0][1] = factor;
    rotation[1][0] = -factor;
    vector = rotation * vector;
    angle -= sense * 7.6293945311019700e-6;  // atan(2^-17)
// Iteration 19
    sense = (angle < 0.0) ? -1.0 : 1.0;
    factor = sense * 3.814697265625e-6;  // 2^-18
    rotation[0][1] = factor;
    rotation[1][0] = -factor;
    vector = rotation * vector;
    angle -= sense * 3.8146972656064961e-6;  // atan(2^-18)
// Iteration 20
    sense = (angle < 0.0) ? -1.0 : 1.0;
    factor = sense * 1.9073486328125e-6;  // 2^-19
    rotation[0][1] = factor;
    rotation[1][0] = -factor;
    vector = rotation * vector;
    angle -= sense * 1.9073486328101870e-6;  // atan(2^-19)
// Iteration 21
    sense = (angle < 0.0) ? -1.0 : 1.0;
    factor = sense * 9.5367431640625e-7;  // 2^-20
    rotation[0][1] = factor;
    rotation[1][0] = -factor;
    vector = rotation * vector;
    angle -= sense * 9.5367431640596084e-7;  // atan(2^-20)
// Iteration 22
    sense = (angle < 0.0) ? -1.0 : 1.0;
    factor = sense * 4.76837158203125e-7;  // 2^-21
    rotation[0][1] = factor;
    rotation[1][0] = -factor;
    vector = rotation * vector;
    angle -= sense * 4.7683715820308884e-7;  // atan(2^-21)
// Iteration 23
    sense = (angle < 0.0) ? -1.0 : 1.0;
    factor = sense * 2.384185791015625e-7;  // 2^-22
    rotation[0][1] = factor;
    rotation[1][0] = -factor;
    vector = rotation * vector;
    angle -= sense * 2.3841857910155797e-7;  // atan(2^-22)
// Iteration 24
    sense = (angle < 0.0) ? -1.0 : 1.0;
    factor = sense * 1.1920928955078125e-7;  // 2^-23
    rotation[0][1] = factor;
    rotation[1][0] = -factor;
    vector = rotation * vector;
//    angle -= sense * 1.1920928955078068e-7;  // atan(2^-23)

    return vector;
}

/**
 * Computes the cosine and sine of the provided angle using the CORDIC algorithm.
 *
 * @name czm_cosineAndSine
 * @glslFunction
 *
 * @param {float} angle The angle in radians.
 *
 * @returns {vec2} The resulting cosine of the angle (as the x coordinate) and sine of the angle (as the y coordinate).
 *
 * @example
 * vec2 v = czm_cosineAndSine(czm_piOverSix);
 * float cosine = v.x;
 * float sine = v.y;
 */
vec2 czm_cosineAndSine(float angle)
{
    if (angle < -czm_piOverTwo || angle > czm_piOverTwo)
    {
        if (angle < 0.0)
        {
            return -cordic(angle + czm_pi);
        }
        else
        {
            return -cordic(angle - czm_pi);
        }
    }
    else
    {
        return cordic(angle);
    }
}
`,zZ=`/**
 * Decompresses texture coordinates that were packed into a single float.
 *
 * @name czm_decompressTextureCoordinates
 * @glslFunction
 *
 * @param {float} encoded The compressed texture coordinates.
 * @returns {vec2} The decompressed texture coordinates.
 */
 vec2 czm_decompressTextureCoordinates(float encoded)
 {
    float temp = encoded / 4096.0;
    float xZeroTo4095 = floor(temp);
    float stx = xZeroTo4095 / 4095.0;
    float sty = (encoded - xZeroTo4095 * 4096.0) / 4095.0;
    return vec2(stx, sty);
 }
`,UZ=`// emulated noperspective
#if (__VERSION__ == 300 || defined(GL_EXT_frag_depth)) && !defined(LOG_DEPTH)
out float v_WindowZ;
#endif

/**
 * Emulates GL_DEPTH_CLAMP, which is not available in WebGL 1 or 2.
 * GL_DEPTH_CLAMP clamps geometry that is outside the near and far planes, 
 * capping the shadow volume. More information here: 
 * https://www.khronos.org/registry/OpenGL/extensions/ARB/ARB_depth_clamp.txt.
 *
 * When GL_EXT_frag_depth is available we emulate GL_DEPTH_CLAMP by ensuring 
 * no geometry gets clipped by setting the clip space z value to 0.0 and then
 * sending the unaltered screen space z value (using emulated noperspective
 * interpolation) to the frag shader where it is clamped to [0,1] and then
 * written with gl_FragDepth (see czm_writeDepthClamp). This technique is based on:
 * https://stackoverflow.com/questions/5960757/how-to-emulate-gl-depth-clamp-nv.
 *
 * When GL_EXT_frag_depth is not available, which is the case on some mobile 
 * devices, we must attempt to fix this only in the vertex shader. 
 * The approach is to clamp the z value to the far plane, which closes the 
 * shadow volume but also distorts the geometry, so there can still be artifacts
 * on frustum seams.
 *
 * @name czm_depthClamp
 * @glslFunction
 *
 * @param {vec4} coords The vertex in clip coordinates.
 * @returns {vec4} The modified vertex.
 *
 * @example
 * gl_Position = czm_depthClamp(czm_modelViewProjection * vec4(position, 1.0));
 *
 * @see czm_writeDepthClamp
 */
vec4 czm_depthClamp(vec4 coords)
{
#ifndef LOG_DEPTH
#if __VERSION__ == 300 || defined(GL_EXT_frag_depth)
    v_WindowZ = (0.5 * (coords.z / coords.w) + 0.5) * coords.w;
    coords.z = 0.0;
#else
    coords.z = min(coords.z, coords.w);
#endif
#endif
    return coords;
}
`,kZ=`/**
 * Computes a 3x3 rotation matrix that transforms vectors from an ellipsoid's east-north-up coordinate system 
 * to eye coordinates.  In east-north-up coordinates, x points east, y points north, and z points along the 
 * surface normal.  East-north-up can be used as an ellipsoid's tangent space for operations such as bump mapping.
 * <br /><br />
 * The ellipsoid is assumed to be centered at the model coordinate's origin.
 *
 * @name czm_eastNorthUpToEyeCoordinates
 * @glslFunction
 *
 * @param {vec3} positionMC The position on the ellipsoid in model coordinates.
 * @param {vec3} normalEC The normalized ellipsoid surface normal, at <code>positionMC</code>, in eye coordinates.
 *
 * @returns {mat3} A 3x3 rotation matrix that transforms vectors from the east-north-up coordinate system to eye coordinates.
 *
 * @example
 * // Transform a vector defined in the east-north-up coordinate 
 * // system, (0, 0, 1) which is the surface normal, to eye 
 * // coordinates.
 * mat3 m = czm_eastNorthUpToEyeCoordinates(positionMC, normalEC);
 * vec3 normalEC = m * vec3(0.0, 0.0, 1.0);
 */
mat3 czm_eastNorthUpToEyeCoordinates(vec3 positionMC, vec3 normalEC)
{
    vec3 tangentMC = normalize(vec3(-positionMC.y, positionMC.x, 0.0));  // normalized surface tangent in model coordinates
    vec3 tangentEC = normalize(czm_normal3D * tangentMC);                // normalized surface tangent in eye coordinates
    vec3 bitangentEC = normalize(cross(normalEC, tangentEC));            // normalized surface bitangent in eye coordinates

    return mat3(
        tangentEC.x,   tangentEC.y,   tangentEC.z,
        bitangentEC.x, bitangentEC.y, bitangentEC.z,
        normalEC.x,    normalEC.y,    normalEC.z);
}
`,jZ=`/**
 * DOC_TBA
 *
 * @name czm_ellipsoidContainsPoint
 * @glslFunction
 *
 */
bool czm_ellipsoidContainsPoint(vec3 ellipsoid_inverseRadii, vec3 point)
{
    vec3 scaled = ellipsoid_inverseRadii * (czm_inverseModelView * vec4(point, 1.0)).xyz;
    return (dot(scaled, scaled) <= 1.0);
}
`,VZ=`/**
 * Approximate uv coordinates based on the ellipsoid normal.
 *
 * @name czm_ellipsoidTextureCoordinates
 * @glslFunction
 */
vec2 czm_ellipsoidTextureCoordinates(vec3 normal)
{
    return vec2(atan(normal.y, normal.x) * czm_oneOverTwoPi + 0.5, asin(normal.z) * czm_oneOverPi + 0.5);
}
`,GZ=`/**
 * Compares <code>left</code> and <code>right</code> componentwise. Returns <code>true</code>
 * if they are within <code>epsilon</code> and <code>false</code> otherwise. The inputs
 * <code>left</code> and <code>right</code> can be <code>float</code>s, <code>vec2</code>s,
 * <code>vec3</code>s, or <code>vec4</code>s.
 *
 * @name czm_equalsEpsilon
 * @glslFunction
 *
 * @param {} left The first vector.
 * @param {} right The second vector.
 * @param {float} epsilon The epsilon to use for equality testing.
 * @returns {bool} <code>true</code> if the components are within <code>epsilon</code> and <code>false</code> otherwise.
 *
 * @example
 * // GLSL declarations
 * bool czm_equalsEpsilon(float left, float right, float epsilon);
 * bool czm_equalsEpsilon(vec2 left, vec2 right, float epsilon);
 * bool czm_equalsEpsilon(vec3 left, vec3 right, float epsilon);
 * bool czm_equalsEpsilon(vec4 left, vec4 right, float epsilon);
 */
bool czm_equalsEpsilon(vec4 left, vec4 right, float epsilon) {
    return all(lessThanEqual(abs(left - right), vec4(epsilon)));
}

bool czm_equalsEpsilon(vec3 left, vec3 right, float epsilon) {
    return all(lessThanEqual(abs(left - right), vec3(epsilon)));
}

bool czm_equalsEpsilon(vec2 left, vec2 right, float epsilon) {
    return all(lessThanEqual(abs(left - right), vec2(epsilon)));
}

bool czm_equalsEpsilon(float left, float right, float epsilon) {
    return (abs(left - right) <= epsilon);
}
`,HZ=`/**
 * DOC_TBA
 *
 * @name czm_eyeOffset
 * @glslFunction
 *
 * @param {vec4} positionEC DOC_TBA.
 * @param {vec3} eyeOffset DOC_TBA.
 *
 * @returns {vec4} DOC_TBA.
 */
vec4 czm_eyeOffset(vec4 positionEC, vec3 eyeOffset)
{
    // This equation is approximate in x and y.
    vec4 p = positionEC;
    vec4 zEyeOffset = normalize(p) * eyeOffset.z;
    p.xy += eyeOffset.xy + zEyeOffset.xy;
    p.z += zEyeOffset.z;
    return p;
}
`,qZ=`/**
 * Transforms a position from eye to window coordinates.  The transformation
 * from eye to clip coordinates is done using {@link czm_projection}.
 * The transform from normalized device coordinates to window coordinates is
 * done using {@link czm_viewportTransformation}, which assumes a depth range
 * of <code>near = 0</code> and <code>far = 1</code>.
 * <br /><br />
 * This transform is useful when there is a need to manipulate window coordinates
 * in a vertex shader as done by {@link BillboardCollection}.
 *
 * @name czm_eyeToWindowCoordinates
 * @glslFunction
 *
 * @param {vec4} position The position in eye coordinates to transform.
 *
 * @returns {vec4} The transformed position in window coordinates.
 *
 * @see czm_modelToWindowCoordinates
 * @see czm_projection
 * @see czm_viewportTransformation
 * @see BillboardCollection
 *
 * @example
 * vec4 positionWC = czm_eyeToWindowCoordinates(positionEC);
 */
vec4 czm_eyeToWindowCoordinates(vec4 positionEC)
{
    vec4 q = czm_projection * positionEC;                        // clip coordinates
    q.xyz /= q.w;                                                // normalized device coordinates
    q.xyz = (czm_viewportTransformation * vec4(q.xyz, 1.0)).xyz; // window coordinates
    return q;
}
`,WZ=`/**
 * Approxiamtes atan over the range [0, 1]. Safe to flip output for negative input.
 *
 * Based on Michal Drobot's approximation from ShaderFastLibs, which in turn is based on
 * "Efficient approximations for the arctangent function," Rajan, S. Sichun Wang Inkol, R. Joyal, A., May 2006.
 * Adapted from ShaderFastLibs under MIT License.
 *
 * Chosen for the following characteristics over range [0, 1]:
 * - basically no error at 0 and 1, important for getting around range limit (naive atan2 via atan requires infinite range atan)
 * - no visible artifacts from first-derivative discontinuities, unlike latitude via range-reduced sqrt asin approximations (at equator)
 *
 * The original code is x * (-0.1784 * abs(x) - 0.0663 * x * x + 1.0301);
 * Removed the abs() in here because it isn't needed, the input range is guaranteed as [0, 1] by how we're approximating atan2.
 *
 * @name czm_fastApproximateAtan
 * @glslFunction
 *
 * @param {float} x Value between 0 and 1 inclusive.
 *
 * @returns {float} Approximation of atan(x)
 */
float czm_fastApproximateAtan(float x) {
    return x * (-0.1784 * x - 0.0663 * x * x + 1.0301);
}

/**
 * Approximation of atan2.
 *
 * Range reduction math based on nvidia's cg reference implementation for atan2: http://developer.download.nvidia.com/cg/atan2.html
 * However, we replaced their atan curve with Michael Drobot's (see above).
 *
 * @name czm_fastApproximateAtan
 * @glslFunction
 *
 * @param {float} x Value between -1 and 1 inclusive.
 * @param {float} y Value between -1 and 1 inclusive.
 *
 * @returns {float} Approximation of atan2(x, y)
 */
float czm_fastApproximateAtan(float x, float y) {
    // atan approximations are usually only reliable over [-1, 1], or, in our case, [0, 1] due to modifications.
    // So range-reduce using abs and by flipping whether x or y is on top.
    float t = abs(x); // t used as swap and atan result.
    float opposite = abs(y);
    float adjacent = max(t, opposite);
    opposite = min(t, opposite);

    t = czm_fastApproximateAtan(opposite / adjacent);

    // Undo range reduction
    t = czm_branchFreeTernary(abs(y) > abs(x), czm_piOverTwo - t, t);
    t = czm_branchFreeTernary(x < 0.0, czm_pi - t, t);
    t = czm_branchFreeTernary(y < 0.0, -t, t);
    return t;
}
`,$Z=`/**
 * Gets the color with fog at a distance from the camera.
 *
 * @name czm_fog
 * @glslFunction
 *
 * @param {float} distanceToCamera The distance to the camera in meters.
 * @param {vec3} color The original color.
 * @param {vec3} fogColor The color of the fog.
 *
 * @returns {vec3} The color adjusted for fog at the distance from the camera.
 */
vec3 czm_fog(float distanceToCamera, vec3 color, vec3 fogColor)
{
    float scalar = distanceToCamera * czm_fogDensity;
    float fog = 1.0 - exp(-(scalar * scalar));
    return mix(color, fogColor, fog);
}

/**
 * Gets the color with fog at a distance from the camera.
 *
 * @name czm_fog
 * @glslFunction
 *
 * @param {float} distanceToCamera The distance to the camera in meters.
 * @param {vec3} color The original color.
 * @param {vec3} fogColor The color of the fog.
 * @param {float} fogModifierConstant A constant to modify the appearance of fog.
 *
 * @returns {vec3} The color adjusted for fog at the distance from the camera.
 */
vec3 czm_fog(float distanceToCamera, vec3 color, vec3 fogColor, float fogModifierConstant)
{
    float scalar = distanceToCamera * czm_fogDensity;
    float fog = 1.0 - exp(-((fogModifierConstant * scalar + fogModifierConstant) * (scalar * (1.0 + fogModifierConstant))));
    return mix(color, fogColor, fog);
}
`,XZ=`/**
 * Converts a color from RGB space to linear space.
 *
 * @name czm_gammaCorrect
 * @glslFunction
 *
 * @param {vec3} color The color in RGB space.
 * @returns {vec3} The color in linear space.
 */
vec3 czm_gammaCorrect(vec3 color) {
#ifdef HDR
    color = pow(color, vec3(czm_gamma));
#endif
    return color;
}

vec4 czm_gammaCorrect(vec4 color) {
#ifdef HDR
    color.rgb = pow(color.rgb, vec3(czm_gamma));
#endif
    return color;
}
`,YZ=`/**
 * DOC_TBA
 *
 * @name czm_geodeticSurfaceNormal
 * @glslFunction
 *
 * @param {vec3} positionOnEllipsoid DOC_TBA
 * @param {vec3} ellipsoidCenter DOC_TBA
 * @param {vec3} oneOverEllipsoidRadiiSquared DOC_TBA
 * 
 * @returns {vec3} DOC_TBA.
 */
vec3 czm_geodeticSurfaceNormal(vec3 positionOnEllipsoid, vec3 ellipsoidCenter, vec3 oneOverEllipsoidRadiiSquared)
{
    return normalize((positionOnEllipsoid - ellipsoidCenter) * oneOverEllipsoidRadiiSquared);
}
`,KZ=`/**
 * An czm_material with default values. Every material's czm_getMaterial
 * should use this default material as a base for the material it returns.
 * The default normal value is given by materialInput.normalEC.
 *
 * @name czm_getDefaultMaterial
 * @glslFunction
 *
 * @param {czm_materialInput} input The input used to construct the default material.
 *
 * @returns {czm_material} The default material.
 *
 * @see czm_materialInput
 * @see czm_material
 * @see czm_getMaterial
 */
czm_material czm_getDefaultMaterial(czm_materialInput materialInput)
{
    czm_material material;
    material.diffuse = vec3(0.0);
    material.specular = 0.0;
    material.shininess = 1.0;
    material.normal = materialInput.normalEC;
    material.emission = vec3(0.0);
    material.alpha = 1.0;
    return material;
}
`,ZZ=`/**
 * Select which direction vector to use for dynamic atmosphere lighting based on an enum value
 *
 * @name czm_getDynamicAtmosphereLightDirection
 * @glslfunction
 * @see DynamicAtmosphereLightingType.js
 *
 * @param {vec3} positionWC the position of the vertex/fragment in world coordinates. This is normalized and returned when dynamic lighting is turned off.
 * @param {float} lightEnum The enum value for selecting between light sources.
 * @return {vec3} The normalized light direction vector. Depending on the enum value, it is either positionWC, czm_lightDirectionWC or czm_sunDirectionWC
 */
vec3 czm_getDynamicAtmosphereLightDirection(vec3 positionWC, float lightEnum) {
    const float NONE = 0.0;
    const float SCENE_LIGHT = 1.0;
    const float SUNLIGHT = 2.0;

    vec3 lightDirection =
        positionWC * float(lightEnum == NONE) +
        czm_lightDirectionWC * float(lightEnum == SCENE_LIGHT) +
        czm_sunDirectionWC * float(lightEnum == SUNLIGHT);
    return normalize(lightDirection);
}
`,JZ=`/**
 * Calculates the intensity of diffusely reflected light.
 *
 * @name czm_getLambertDiffuse
 * @glslFunction
 *
 * @param {vec3} lightDirectionEC Unit vector pointing to the light source in eye coordinates.
 * @param {vec3} normalEC The surface normal in eye coordinates.
 *
 * @returns {float} The intensity of the diffuse reflection.
 *
 * @see czm_phong
 *
 * @example
 * float diffuseIntensity = czm_getLambertDiffuse(lightDirectionEC, normalEC);
 * float specularIntensity = czm_getSpecular(lightDirectionEC, toEyeEC, normalEC, 200);
 * vec3 color = (diffuseColor * diffuseIntensity) + (specularColor * specularIntensity);
 */
float czm_getLambertDiffuse(vec3 lightDirectionEC, vec3 normalEC)
{
    return max(dot(lightDirectionEC, normalEC), 0.0);
}
`,QZ=`/**
 * Calculates the specular intensity of reflected light.
 *
 * @name czm_getSpecular
 * @glslFunction
 *
 * @param {vec3} lightDirectionEC Unit vector pointing to the light source in eye coordinates.
 * @param {vec3} toEyeEC Unit vector pointing to the eye position in eye coordinates.
 * @param {vec3} normalEC The surface normal in eye coordinates.
 * @param {float} shininess The sharpness of the specular reflection.  Higher values create a smaller, more focused specular highlight.
 *
 * @returns {float} The intensity of the specular highlight.
 *
 * @see czm_phong
 *
 * @example
 * float diffuseIntensity = czm_getLambertDiffuse(lightDirectionEC, normalEC);
 * float specularIntensity = czm_getSpecular(lightDirectionEC, toEyeEC, normalEC, 200);
 * vec3 color = (diffuseColor * diffuseIntensity) + (specularColor * specularIntensity);
 */
float czm_getSpecular(vec3 lightDirectionEC, vec3 toEyeEC, vec3 normalEC, float shininess)
{
    vec3 toReflectedLight = reflect(-lightDirectionEC, normalEC);
    float specular = max(dot(toReflectedLight, toEyeEC), 0.0);

    // pow has undefined behavior if both parameters <= 0.
    // Prevent this by making sure shininess is at least czm_epsilon2.
    return pow(specular, max(shininess, czm_epsilon2));
}
`,eJ=`/**
 * @private
 */
vec4 czm_getWaterNoise(sampler2D normalMap, vec2 uv, float time, float angleInRadians)
{
    float cosAngle = cos(angleInRadians);
    float sinAngle = sin(angleInRadians);

    // time dependent sampling directions
    vec2 s0 = vec2(1.0/17.0, 0.0);
    vec2 s1 = vec2(-1.0/29.0, 0.0);
    vec2 s2 = vec2(1.0/101.0, 1.0/59.0);
    vec2 s3 = vec2(-1.0/109.0, -1.0/57.0);

    // rotate sampling direction by specified angle
    s0 = vec2((cosAngle * s0.x) - (sinAngle * s0.y), (sinAngle * s0.x) + (cosAngle * s0.y));
    s1 = vec2((cosAngle * s1.x) - (sinAngle * s1.y), (sinAngle * s1.x) + (cosAngle * s1.y));
    s2 = vec2((cosAngle * s2.x) - (sinAngle * s2.y), (sinAngle * s2.x) + (cosAngle * s2.y));
    s3 = vec2((cosAngle * s3.x) - (sinAngle * s3.y), (sinAngle * s3.x) + (cosAngle * s3.y));

    vec2 uv0 = (uv/103.0) + (time * s0);
    vec2 uv1 = uv/107.0 + (time * s1) + vec2(0.23);
    vec2 uv2 = uv/vec2(897.0, 983.0) + (time * s2) + vec2(0.51);
    vec2 uv3 = uv/vec2(991.0, 877.0) + (time * s3) + vec2(0.71);

    uv0 = fract(uv0);
    uv1 = fract(uv1);
    uv2 = fract(uv2);
    uv3 = fract(uv3);
    vec4 noise = (texture(normalMap, uv0)) +
                 (texture(normalMap, uv1)) +
                 (texture(normalMap, uv2)) +
                 (texture(normalMap, uv3));

    // average and scale to between -1 and 1
    return ((noise / 4.0) - 0.5) * 2.0;
}
`,tJ=`/**
 * Adjusts the hue of a color.
 * 
 * @name czm_hue
 * @glslFunction
 * 
 * @param {vec3} rgb The color.
 * @param {float} adjustment The amount to adjust the hue of the color in radians.
 *
 * @returns {float} The color with the hue adjusted.
 *
 * @example
 * vec3 adjustHue = czm_hue(color, czm_pi); // The same as czm_hue(color, -czm_pi)
 */
vec3 czm_hue(vec3 rgb, float adjustment)
{
    const mat3 toYIQ = mat3(0.299,     0.587,     0.114,
                            0.595716, -0.274453, -0.321263,
                            0.211456, -0.522591,  0.311135);
    const mat3 toRGB = mat3(1.0,  0.9563,  0.6210,
                            1.0, -0.2721, -0.6474,
                            1.0, -1.107,   1.7046);
    
    vec3 yiq = toYIQ * rgb;
    float hue = atan(yiq.z, yiq.y) + adjustment;
    float chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);
    
    vec3 color = vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));
    return toRGB * color;
}
`,nJ=`/**
 * Converts a color in linear space to RGB space.
 *
 * @name czm_inverseGamma
 * @glslFunction
 *
 * @param {vec3} color The color in linear space.
 * @returns {vec3} The color in RGB space.
 */
vec3 czm_inverseGamma(vec3 color) {
    return pow(color, vec3(1.0 / czm_gamma));
}
`,iJ=`/**
 * Determines if a time interval is empty.
 *
 * @name czm_isEmpty
 * @glslFunction 
 * 
 * @param {czm_raySegment} interval The interval to test.
 * 
 * @returns {bool} <code>true</code> if the time interval is empty; otherwise, <code>false</code>.
 *
 * @example
 * bool b0 = czm_isEmpty(czm_emptyRaySegment);      // true
 * bool b1 = czm_isEmpty(czm_raySegment(0.0, 1.0)); // false
 * bool b2 = czm_isEmpty(czm_raySegment(1.0, 1.0)); // false, contains 1.0.
 */
bool czm_isEmpty(czm_raySegment interval)
{
    return (interval.stop < 0.0);
}
`,rJ=`/**
 * Determines if a time interval is empty.
 *
 * @name czm_isFull
 * @glslFunction 
 * 
 * @param {czm_raySegment} interval The interval to test.
 * 
 * @returns {bool} <code>true</code> if the time interval is empty; otherwise, <code>false</code>.
 *
 * @example
 * bool b0 = czm_isEmpty(czm_emptyRaySegment);      // true
 * bool b1 = czm_isEmpty(czm_raySegment(0.0, 1.0)); // false
 * bool b2 = czm_isEmpty(czm_raySegment(1.0, 1.0)); // false, contains 1.0.
 */
bool czm_isFull(czm_raySegment interval)
{
    return (interval.start == 0.0 && interval.stop == czm_infinity);
}
`,sJ=`/**
 * Computes the fraction of a Web Wercator rectangle at which a given geodetic latitude is located.
 *
 * @name czm_latitudeToWebMercatorFraction
 * @glslFunction
 *
 * @param {float} latitude The geodetic latitude, in radians.
 * @param {float} southMercatorY The Web Mercator coordinate of the southern boundary of the rectangle.
 * @param {float} oneOverMercatorHeight The total height of the rectangle in Web Mercator coordinates.
 *
 * @returns {float} The fraction of the rectangle at which the latitude occurs.  If the latitude is the southern
 *          boundary of the rectangle, the return value will be zero.  If it is the northern boundary, the return
 *          value will be 1.0.  Latitudes in between are mapped according to the Web Mercator projection.
 */ 
float czm_latitudeToWebMercatorFraction(float latitude, float southMercatorY, float oneOverMercatorHeight)
{
    float sinLatitude = sin(latitude);
    float mercatorY = 0.5 * log((1.0 + sinLatitude) / (1.0 - sinLatitude));
    
    return (mercatorY - southMercatorY) * oneOverMercatorHeight;
}
`,oJ=`/**
 * Computes distance from an point in 2D to a line in 2D.
 *
 * @name czm_lineDistance
 * @glslFunction
 *
 * param {vec2} point1 A point along the line.
 * param {vec2} point2 A point along the line.
 * param {vec2} point A point that may or may not be on the line.
 * returns {float} The distance from the point to the line.
 */
float czm_lineDistance(vec2 point1, vec2 point2, vec2 point) {
    return abs((point2.y - point1.y) * point.x - (point2.x - point1.x) * point.y + point2.x * point1.y - point2.y * point1.x) / distance(point2, point1);
}
`,aJ=`/**
 * Converts a linear RGB color to an sRGB color.
 *
 * @param {vec3|vec4} linearIn The color in linear color space.
 * @returns {vec3|vec4} The color in sRGB color space. The vector type matches the input.
 */
vec3 czm_linearToSrgb(vec3 linearIn) 
{
    return pow(linearIn, vec3(1.0/2.2));
}

vec4 czm_linearToSrgb(vec4 linearIn) 
{
    vec3 srgbOut = pow(linearIn.rgb, vec3(1.0/2.2));
    return vec4(srgbOut, linearIn.a);
}
`,cJ=`/**
 * Computes the luminance of a color. 
 *
 * @name czm_luminance
 * @glslFunction
 *
 * @param {vec3} rgb The color.
 * 
 * @returns {float} The luminance.
 *
 * @example
 * float light = czm_luminance(vec3(0.0)); // 0.0
 * float dark = czm_luminance(vec3(1.0));  // ~1.0 
 */
float czm_luminance(vec3 rgb)
{
    // Algorithm from Chapter 10 of Graphics Shaders.
    const vec3 W = vec3(0.2125, 0.7154, 0.0721);
    return dot(rgb, W);
}
`,lJ=`/**
 * Find the maximum component of a vector.
 *
 * @name czm_maximumComponent
 * @glslFunction
 *
 * @param {vec2|vec3|vec4} v The input vector.
 * @returns {float} The value of the largest component.
 */
float czm_maximumComponent(vec2 v)
{
    return max(v.x, v.y);
}
float czm_maximumComponent(vec3 v)
{
    return max(max(v.x, v.y), v.z);
}
float czm_maximumComponent(vec4 v)
{
    return max(max(max(v.x, v.y), v.z), v.w);
}
`,uJ=`/**
 * Computes the size of a pixel in meters at a distance from the eye.
 * <p>
 * Use this version when passing in a custom pixel ratio. For example, passing in 1.0 will return meters per native device pixel.
 * </p>
 * @name czm_metersPerPixel
 * @glslFunction
 *
 * @param {vec3} positionEC The position to get the meters per pixel in eye coordinates.
 * @param {float} pixelRatio The scaling factor from pixel space to coordinate space
 *
 * @returns {float} The meters per pixel at positionEC.
 */
float czm_metersPerPixel(vec4 positionEC, float pixelRatio)
{
    float width = czm_viewport.z;
    float height = czm_viewport.w;
    float pixelWidth;
    float pixelHeight;

    float top = czm_frustumPlanes.x;
    float bottom = czm_frustumPlanes.y;
    float left = czm_frustumPlanes.z;
    float right = czm_frustumPlanes.w;

    if (czm_sceneMode == czm_sceneMode2D || czm_orthographicIn3D == 1.0)
    {
        float frustumWidth = right - left;
        float frustumHeight = top - bottom;
        pixelWidth = frustumWidth / width;
        pixelHeight = frustumHeight / height;
    }
    else
    {
        float distanceToPixel = -positionEC.z;
        float inverseNear = 1.0 / czm_currentFrustum.x;
        float tanTheta = top * inverseNear;
        pixelHeight = 2.0 * distanceToPixel * tanTheta / height;
        tanTheta = right * inverseNear;
        pixelWidth = 2.0 * distanceToPixel * tanTheta / width;
    }

    return max(pixelWidth, pixelHeight) * pixelRatio;
}

/**
 * Computes the size of a pixel in meters at a distance from the eye.
 * <p>
 * Use this version when scaling by pixel ratio.
 * </p>
 * @name czm_metersPerPixel
 * @glslFunction
 *
 * @param {vec3} positionEC The position to get the meters per pixel in eye coordinates.
 *
 * @returns {float} The meters per pixel at positionEC.
 */
float czm_metersPerPixel(vec4 positionEC)
{
    return czm_metersPerPixel(positionEC, czm_pixelRatio);
}
`,fJ=`/**
 * Transforms a position from model to window coordinates.  The transformation
 * from model to clip coordinates is done using {@link czm_modelViewProjection}.
 * The transform from normalized device coordinates to window coordinates is
 * done using {@link czm_viewportTransformation}, which assumes a depth range
 * of <code>near = 0</code> and <code>far = 1</code>.
 * <br /><br />
 * This transform is useful when there is a need to manipulate window coordinates
 * in a vertex shader as done by {@link BillboardCollection}.
 * <br /><br />
 * This function should not be confused with {@link czm_viewportOrthographic},
 * which is an orthographic projection matrix that transforms from window 
 * coordinates to clip coordinates.
 *
 * @name czm_modelToWindowCoordinates
 * @glslFunction
 *
 * @param {vec4} position The position in model coordinates to transform.
 *
 * @returns {vec4} The transformed position in window coordinates.
 *
 * @see czm_eyeToWindowCoordinates
 * @see czm_modelViewProjection
 * @see czm_viewportTransformation
 * @see czm_viewportOrthographic
 * @see BillboardCollection
 *
 * @example
 * vec4 positionWC = czm_modelToWindowCoordinates(positionMC);
 */
vec4 czm_modelToWindowCoordinates(vec4 position)
{
    vec4 q = czm_modelViewProjection * position;                // clip coordinates
    q.xyz /= q.w;                                                // normalized device coordinates
    q.xyz = (czm_viewportTransformation * vec4(q.xyz, 1.0)).xyz; // window coordinates
    return q;
}
`,hJ=`/**
 * DOC_TBA
 *
 * @name czm_multiplyWithColorBalance
 * @glslFunction
 */
vec3 czm_multiplyWithColorBalance(vec3 left, vec3 right)
{
    // Algorithm from Chapter 10 of Graphics Shaders.
    const vec3 W = vec3(0.2125, 0.7154, 0.0721);
    
    vec3 target = left * right;
    float leftLuminance = dot(left, W);
    float rightLuminance = dot(right, W);
    float targetLuminance = dot(target, W);
    
    return ((leftLuminance + rightLuminance) / (2.0 * targetLuminance)) * target;
}
`,dJ=`/**
 * Computes a value that scales with distance.  The scaling is clamped at the near and
 * far distances, and does not extrapolate.  This function works with the
 * {@link NearFarScalar} JavaScript class.
 *
 * @name czm_nearFarScalar
 * @glslFunction
 *
 * @param {vec4} nearFarScalar A vector with 4 components: Near distance (x), Near value (y), Far distance (z), Far value (w).
 * @param {float} cameraDistSq The square of the current distance from the camera.
 *
 * @returns {float} The value at this distance.
 */
float czm_nearFarScalar(vec4 nearFarScalar, float cameraDistSq)
{
    float valueAtMin = nearFarScalar.y;
    float valueAtMax = nearFarScalar.w;
    float nearDistanceSq = nearFarScalar.x * nearFarScalar.x;
    float farDistanceSq = nearFarScalar.z * nearFarScalar.z;

    float t = (cameraDistSq - nearDistanceSq) / (farDistanceSq - nearDistanceSq);

    t = pow(clamp(t, 0.0, 1.0), 0.2);

    return mix(valueAtMin, valueAtMax, t);
}
`,pJ=` /**
  * Decodes a unit-length vector in 'oct' encoding to a normalized 3-component Cartesian vector.
  * The 'oct' encoding is described in "A Survey of Efficient Representations of Independent Unit Vectors",
  * Cigolle et al 2014: http://jcgt.org/published/0003/02/01/
  *
  * @name czm_octDecode
  * @param {vec2} encoded The oct-encoded, unit-length vector
  * @param {float} range The maximum value of the SNORM range. The encoded vector is stored in log2(rangeMax+1) bits.
  * @returns {vec3} The decoded and normalized vector
  */
  vec3 czm_octDecode(vec2 encoded, float range)
  {
      if (encoded.x == 0.0 && encoded.y == 0.0) {
          return vec3(0.0, 0.0, 0.0);
      }

     encoded = encoded / range * 2.0 - 1.0;
     vec3 v = vec3(encoded.x, encoded.y, 1.0 - abs(encoded.x) - abs(encoded.y));
     if (v.z < 0.0)
     {
         v.xy = (1.0 - abs(v.yx)) * czm_signNotZero(v.xy);
     }

     return normalize(v);
  }

/**
 * Decodes a unit-length vector in 'oct' encoding to a normalized 3-component Cartesian vector.
 * The 'oct' encoding is described in "A Survey of Efficient Representations of Independent Unit Vectors",
 * Cigolle et al 2014: http://jcgt.org/published/0003/02/01/
 *
 * @name czm_octDecode
 * @param {vec2} encoded The oct-encoded, unit-length vector
 * @returns {vec3} The decoded and normalized vector
 */
 vec3 czm_octDecode(vec2 encoded)
 {
    return czm_octDecode(encoded, 255.0);
 }

 /**
 * Decodes a unit-length vector in 'oct' encoding packed into a floating-point number to a normalized 3-component Cartesian vector.
 * The 'oct' encoding is described in "A Survey of Efficient Representations of Independent Unit Vectors",
 * Cigolle et al 2014: http://jcgt.org/published/0003/02/01/
 *
 * @name czm_octDecode
 * @param {float} encoded The oct-encoded, unit-length vector
 * @returns {vec3} The decoded and normalized vector
 */
 vec3 czm_octDecode(float encoded)
 {
    float temp = encoded / 256.0;
    float x = floor(temp);
    float y = (temp - x) * 256.0;
    return czm_octDecode(vec2(x, y));
 }

/**
 * Decodes three unit-length vectors in 'oct' encoding packed into two floating-point numbers to normalized 3-component Cartesian vectors.
 * The 'oct' encoding is described in "A Survey of Efficient Representations of Independent Unit Vectors",
 * Cigolle et al 2014: http://jcgt.org/published/0003/02/01/
 *
 * @name czm_octDecode
 * @param {vec2} encoded The packed oct-encoded, unit-length vectors.
 * @param {vec3} vector1 One decoded and normalized vector.
 * @param {vec3} vector2 One decoded and normalized vector.
 * @param {vec3} vector3 One decoded and normalized vector.
 */
  void czm_octDecode(vec2 encoded, out vec3 vector1, out vec3 vector2, out vec3 vector3)
 {
    float temp = encoded.x / 65536.0;
    float x = floor(temp);
    float encodedFloat1 = (temp - x) * 65536.0;

    temp = encoded.y / 65536.0;
    float y = floor(temp);
    float encodedFloat2 = (temp - y) * 65536.0;

    vector1 = czm_octDecode(encodedFloat1);
    vector2 = czm_octDecode(encodedFloat2);
    vector3 = czm_octDecode(vec2(x, y));
 }

`,mJ=`/**
 * Packs a depth value into a vec3 that can be represented by unsigned bytes.
 *
 * @name czm_packDepth
 * @glslFunction
 *
 * @param {float} depth The floating-point depth.
 * @returns {vec3} The packed depth.
 */
vec4 czm_packDepth(float depth)
{
    // See Aras PranckeviÄius' post Encoding Floats to RGBA
    // http://aras-p.info/blog/2009/07/30/encoding-floats-to-rgba-the-final/
    vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;
    enc = fract(enc);
    enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);
    return enc;
}
`,gJ=`vec3 lambertianDiffuse(vec3 diffuseColor)
{
    return diffuseColor / czm_pi;
}

vec3 fresnelSchlick2(vec3 f0, vec3 f90, float VdotH)
{
    float versine = 1.0 - VdotH;
    // pow(versine, 5.0) is slow. See https://stackoverflow.com/a/68793086/10082269
    float versineSquared = versine * versine;
    return f0 + (f90 - f0) * versineSquared * versineSquared * versine;
}

#ifdef USE_ANISOTROPY
/**
 * @param {float} bitangentRoughness Material roughness (along the anisotropy bitangent)
 * @param {float} tangentialRoughness Anisotropic roughness (along the anisotropy tangent)
 * @param {vec3} lightDirection The direction from the fragment to the light source, transformed to tangent-bitangent-normal coordinates
 * @param {vec3} viewDirection The direction from the fragment to the camera, transformed to tangent-bitangent-normal coordinates
 */
float smithVisibilityGGX_anisotropic(float bitangentRoughness, float tangentialRoughness, vec3 lightDirection, vec3 viewDirection)
{
    vec3 roughnessScale = vec3(tangentialRoughness, bitangentRoughness, 1.0);
    float GGXV = lightDirection.z * length(roughnessScale * viewDirection);
    float GGXL = viewDirection.z * length(roughnessScale * lightDirection);
    float v = 0.5 / (GGXV + GGXL);
    return clamp(v, 0.0, 1.0);
}

/**
 * @param {float} bitangentRoughness Material roughness (along the anisotropy bitangent)
 * @param {float} tangentialRoughness Anisotropic roughness (along the anisotropy tangent)
 * @param {vec3} halfwayDirection The unit vector halfway between light and view directions, transformed to tangent-bitangent-normal coordinates
 */
float GGX_anisotropic(float bitangentRoughness, float tangentialRoughness, vec3 halfwayDirection)
{
    float roughnessSquared = bitangentRoughness * tangentialRoughness;
    vec3 f = halfwayDirection * vec3(bitangentRoughness, tangentialRoughness, roughnessSquared);
    float w2 = roughnessSquared / dot(f, f);
    return roughnessSquared * w2 * w2 / czm_pi;
}
#endif

/**
 * Estimate the geometric self-shadowing of the microfacets in a surface,
 * using the Smith Joint GGX visibility function.
 * Note: Vis = G / (4 * NdotL * NdotV)
 * see Eric Heitz. 2014. Understanding the Masking-Shadowing Function in Microfacet-Based BRDFs. Journal of Computer Graphics Techniques, 3
 * see Real-Time Rendering. Page 331 to 336.
 * see https://google.github.io/filament/Filament.md.html#materialsystem/specularbrdf/geometricshadowing(specularg)
 *
 * @param {float} alphaRoughness The roughness of the material, expressed as the square of perceptual roughness.
 * @param {float} NdotL The cosine of the angle between the surface normal and the direction to the light source.
 * @param {float} NdotV The cosine of the angle between the surface normal and the direction to the camera.
 */
float smithVisibilityGGX(float alphaRoughness, float NdotL, float NdotV)
{
    float alphaRoughnessSq = alphaRoughness * alphaRoughness;

    float GGXV = NdotL * sqrt(NdotV * NdotV * (1.0 - alphaRoughnessSq) + alphaRoughnessSq);
    float GGXL = NdotV * sqrt(NdotL * NdotL * (1.0 - alphaRoughnessSq) + alphaRoughnessSq);

    float GGX = GGXV + GGXL;
    if (GGX > 0.0)
    {
        return 0.5 / GGX;
    }
    return 0.0;
}

/**
 * Estimate the fraction of the microfacets in a surface that are aligned with 
 * the halfway vector, which is aligned halfway between the directions from
 * the fragment to the camera and from the fragment to the light source.
 *
 * @param {float} alphaRoughness The roughness of the material, expressed as the square of perceptual roughness.
 * @param {float} NdotH The cosine of the angle between the surface normal and the halfway vector.
 * @return {float} The fraction of microfacets aligned to the halfway vector.
 */
float GGX(float alphaRoughness, float NdotH)
{
    float alphaRoughnessSquared = alphaRoughness * alphaRoughness;
    float f = (NdotH * alphaRoughnessSquared - NdotH) * NdotH + 1.0;
    return alphaRoughnessSquared / (czm_pi * f * f);
}

/**
 * Compute the strength of the specular reflection due to direct lighting.
 *
 * @param {vec3} normal The surface normal.
 * @param {vec3} lightDirection The unit vector pointing from the fragment to the light source.
 * @param {vec3} viewDirection The unit vector pointing from the fragment to the camera.
 * @param {vec3} halfwayDirection The unit vector pointing from the fragment to halfway between the light source and the camera.
 * @param {float} alphaRoughness The roughness of the material, expressed as the square of perceptual roughness.
 * @return {float} The strength of the specular reflection.
 */
float computeDirectSpecularStrength(vec3 normal, vec3 lightDirection, vec3 viewDirection, vec3 halfwayDirection, float alphaRoughness)
{
    float NdotL = dot(normal, lightDirection);
    float NdotV = abs(dot(normal, viewDirection));
    float G = smithVisibilityGGX(alphaRoughness, NdotL, NdotV);
    float NdotH = clamp(dot(normal, halfwayDirection), 0.0, 1.0);
    float D = GGX(alphaRoughness, NdotH);
    return G * D;
}

/**
 * Compute the diffuse and specular contributions using physically based
 * rendering. This function only handles direct lighting.
 * <p>
 * This function only handles the lighting calculations. Metallic/roughness
 * and specular/glossy must be handled separately. See {@MaterialStageFS}
 * </p>
 *
 * @name czm_pbrLighting
 * @glslFunction
 *
 * @param {vec3} viewDirectionEC Unit vector pointing from the fragment to the eye position
 * @param {vec3} normalEC The surface normal in eye coordinates
 * @param {vec3} lightDirectionEC Unit vector pointing to the light source in eye coordinates.
 * @param {czm_modelMaterial} The material properties.
 * @return {vec3} The computed HDR color
 */
vec3 czm_pbrLighting(vec3 viewDirectionEC, vec3 normalEC, vec3 lightDirectionEC, czm_modelMaterial material)
{
    vec3 halfwayDirectionEC = normalize(viewDirectionEC + lightDirectionEC);
    float VdotH = clamp(dot(viewDirectionEC, halfwayDirectionEC), 0.0, 1.0);
    float NdotL = clamp(dot(normalEC, lightDirectionEC), 0.001, 1.0);

    vec3 f0 = material.specular;
    float reflectance = czm_maximumComponent(f0);
    // Typical dielectrics will have reflectance 0.04, so f90 will be 1.0.
    // In this case, at grazing angle, all incident energy is reflected.
    vec3 f90 = vec3(clamp(reflectance * 25.0, 0.0, 1.0));
    vec3 F = fresnelSchlick2(f0, f90, VdotH);

    #if defined(USE_SPECULAR)
        F *= material.specularWeight;
    #endif

    float alphaRoughness = material.roughness * material.roughness;
    #ifdef USE_ANISOTROPY
        mat3 tbn = mat3(material.anisotropicT, material.anisotropicB, normalEC);
        vec3 lightDirection = lightDirectionEC * tbn;
        vec3 viewDirection = viewDirectionEC * tbn;
        vec3 halfwayDirection = halfwayDirectionEC * tbn;
        float anisotropyStrength = material.anisotropyStrength;
        float tangentialRoughness = mix(alphaRoughness, 1.0, anisotropyStrength * anisotropyStrength);
        float bitangentRoughness = clamp(alphaRoughness, 0.001, 1.0);
        float G = smithVisibilityGGX_anisotropic(bitangentRoughness, tangentialRoughness, lightDirection, viewDirection);
        float D = GGX_anisotropic(bitangentRoughness, tangentialRoughness, halfwayDirection);
        vec3 specularContribution = F * G * D;
    #else
        float specularStrength = computeDirectSpecularStrength(normalEC, lightDirectionEC, viewDirectionEC, halfwayDirectionEC, alphaRoughness);
        vec3 specularContribution = F * specularStrength;
    #endif

    vec3 diffuseColor = material.diffuse;
    // F here represents the specular contribution
    vec3 diffuseContribution = (1.0 - F) * lambertianDiffuse(diffuseColor);

    // Lo = (diffuse + specular) * Li * NdotL
    return (diffuseContribution + specularContribution) * NdotL;
}
`,_J=`float czm_private_getLambertDiffuseOfMaterial(vec3 lightDirectionEC, czm_material material)
{
    return czm_getLambertDiffuse(lightDirectionEC, material.normal);
}

float czm_private_getSpecularOfMaterial(vec3 lightDirectionEC, vec3 toEyeEC, czm_material material)
{
    return czm_getSpecular(lightDirectionEC, toEyeEC, material.normal, material.shininess);
}

/**
 * Computes a color using the Phong lighting model.
 *
 * @name czm_phong
 * @glslFunction
 *
 * @param {vec3} toEye A normalized vector from the fragment to the eye in eye coordinates.
 * @param {czm_material} material The fragment's material.
 *
 * @returns {vec4} The computed color.
 *
 * @example
 * vec3 positionToEyeEC = // ...
 * czm_material material = // ...
 * vec3 lightDirectionEC = // ...
 * out_FragColor = czm_phong(normalize(positionToEyeEC), material, lightDirectionEC);
 *
 * @see czm_getMaterial
 */
vec4 czm_phong(vec3 toEye, czm_material material, vec3 lightDirectionEC)
{
    // Diffuse from directional light sources at eye (for top-down)
    float diffuse = czm_private_getLambertDiffuseOfMaterial(vec3(0.0, 0.0, 1.0), material);
    if (czm_sceneMode == czm_sceneMode3D) {
        // (and horizon views in 3D)
        diffuse += czm_private_getLambertDiffuseOfMaterial(vec3(0.0, 1.0, 0.0), material);
    }

    float specular = czm_private_getSpecularOfMaterial(lightDirectionEC, toEye, material);

    // Temporary workaround for adding ambient.
    vec3 materialDiffuse = material.diffuse * 0.5;

    vec3 ambient = materialDiffuse;
    vec3 color = ambient + material.emission;
    color += materialDiffuse * diffuse * czm_lightColor;
    color += material.specular * specular * czm_lightColor;

    return vec4(color, material.alpha);
}

vec4 czm_private_phong(vec3 toEye, czm_material material, vec3 lightDirectionEC)
{
    float diffuse = czm_private_getLambertDiffuseOfMaterial(lightDirectionEC, material);
    float specular = czm_private_getSpecularOfMaterial(lightDirectionEC, toEye, material);

    vec3 ambient = vec3(0.0);
    vec3 color = ambient + material.emission;
    color += material.diffuse * diffuse * czm_lightColor;
    color += material.specular * specular * czm_lightColor;

    return vec4(color, material.alpha);
}
`,yJ=`/**
 * Computes distance from a point to a plane.
 *
 * @name czm_planeDistance
 * @glslFunction
 *
 * param {vec4} plane A Plane in Hessian Normal Form. See Plane.js
 * param {vec3} point A point in the same space as the plane.
 * returns {float} The distance from the point to the plane.
 */
float czm_planeDistance(vec4 plane, vec3 point) {
    return (dot(plane.xyz, point) + plane.w);
}

/**
 * Computes distance from a point to a plane.
 *
 * @name czm_planeDistance
 * @glslFunction
 *
 * param {vec3} planeNormal Normal for a plane in Hessian Normal Form. See Plane.js
 * param {float} planeDistance Distance for a plane in Hessian Normal form. See Plane.js
 * param {vec3} point A point in the same space as the plane.
 * returns {float} The distance from the point to the plane.
 */
float czm_planeDistance(vec3 planeNormal, float planeDistance, vec3 point) {
    return (dot(planeNormal, point) + planeDistance);
}
`,bJ=`/**
 * Computes the point along a ray at the given time.  <code>time</code> can be positive, negative, or zero.
 *
 * @name czm_pointAlongRay
 * @glslFunction
 *
 * @param {czm_ray} ray The ray to compute the point along.
 * @param {float} time The time along the ray.
 * 
 * @returns {vec3} The point along the ray at the given time.
 * 
 * @example
 * czm_ray ray = czm_ray(vec3(0.0), vec3(1.0, 0.0, 0.0)); // origin, direction
 * vec3 v = czm_pointAlongRay(ray, 2.0); // (2.0, 0.0, 0.0)
 */
vec3 czm_pointAlongRay(czm_ray ray, float time)
{
    return ray.origin + (time * ray.direction);
}
`,TJ=`/**
 * DOC_TBA
 *
 * @name czm_rayEllipsoidIntersectionInterval
 * @glslFunction
 */
czm_raySegment czm_rayEllipsoidIntersectionInterval(czm_ray ray, vec3 ellipsoid_center, vec3 ellipsoid_inverseRadii)
{
   // ray and ellipsoid center in eye coordinates.  radii in model coordinates.
    vec3 q = ellipsoid_inverseRadii * (czm_inverseModelView * vec4(ray.origin, 1.0)).xyz;
    vec3 w = ellipsoid_inverseRadii * (czm_inverseModelView * vec4(ray.direction, 0.0)).xyz;

    q = q - ellipsoid_inverseRadii * (czm_inverseModelView * vec4(ellipsoid_center, 1.0)).xyz;

    float q2 = dot(q, q);
    float qw = dot(q, w);

    if (q2 > 1.0) // Outside ellipsoid.
    {
        if (qw >= 0.0) // Looking outward or tangent (0 intersections).
        {
            return czm_emptyRaySegment;
        }
        else // qw < 0.0.
        {
            float qw2 = qw * qw;
            float difference = q2 - 1.0; // Positively valued.
            float w2 = dot(w, w);
            float product = w2 * difference;

            if (qw2 < product) // Imaginary roots (0 intersections).
            {
                return czm_emptyRaySegment;
            }
            else if (qw2 > product) // Distinct roots (2 intersections).
            {
                float discriminant = qw * qw - product;
                float temp = -qw + sqrt(discriminant); // Avoid cancellation.
                float root0 = temp / w2;
                float root1 = difference / temp;
                if (root0 < root1)
                {
                    czm_raySegment i = czm_raySegment(root0, root1);
                    return i;
                }
                else
                {
                    czm_raySegment i = czm_raySegment(root1, root0);
                    return i;
                }
            }
            else // qw2 == product.  Repeated roots (2 intersections).
            {
                float root = sqrt(difference / w2);
                czm_raySegment i = czm_raySegment(root, root);
                return i;
            }
        }
    }
    else if (q2 < 1.0) // Inside ellipsoid (2 intersections).
    {
        float difference = q2 - 1.0; // Negatively valued.
        float w2 = dot(w, w);
        float product = w2 * difference; // Negatively valued.
        float discriminant = qw * qw - product;
        float temp = -qw + sqrt(discriminant); // Positively valued.
        czm_raySegment i = czm_raySegment(0.0, temp / w2);
        return i;
    }
    else // q2 == 1.0. On ellipsoid.
    {
        if (qw < 0.0) // Looking inward.
        {
            float w2 = dot(w, w);
            czm_raySegment i = czm_raySegment(0.0, -qw / w2);
            return i;
        }
        else // qw >= 0.0.  Looking outward or tangent.
        {
            return czm_emptyRaySegment;
        }
    }
}
`,xJ=`/**
 * Compute the intersection interval of a ray with a sphere.
 *
 * @name czm_raySphereIntersectionInterval
 * @glslFunction
 *
 * @param {czm_ray} ray The ray.
 * @param {vec3} center The center of the sphere.
 * @param {float} radius The radius of the sphere.
 * @return {czm_raySegment} The intersection interval of the ray with the sphere.
 */
czm_raySegment czm_raySphereIntersectionInterval(czm_ray ray, vec3 center, float radius)
{
    vec3 o = ray.origin;
    vec3 d = ray.direction;

    vec3 oc = o - center;

    float a = dot(d, d);
    float b = 2.0 * dot(d, oc);
    float c = dot(oc, oc) - (radius * radius);

    float det = (b * b) - (4.0 * a * c);

    if (det < 0.0) {
        return czm_emptyRaySegment;
    }

    float sqrtDet = sqrt(det);

    float t0 = (-b - sqrtDet) / (2.0 * a);
    float t1 = (-b + sqrtDet) / (2.0 * a);

    czm_raySegment result = czm_raySegment(t0, t1);
    return result;
}
`,EJ=`float czm_readDepth(sampler2D depthTexture, vec2 texCoords)
{
    return czm_reverseLogDepth(texture(depthTexture, texCoords).r);
}
`,CJ=`/**
 * Reads a value previously transformed with {@link czm_writeNonPerspective}
 * by dividing it by \`w\`, the value used in the perspective divide.
 * This function is intended to be called in a fragment shader to access a
 * \`varying\` that should not be subject to perspective interpolation.
 * For example, screen-space texture coordinates. The value should have been
 * previously written in the vertex shader with a call to
 * {@link czm_writeNonPerspective}.
 *
 * @name czm_readNonPerspective
 * @glslFunction
 *
 * @param {float|vec2|vec3|vec4} value The non-perspective value to be read.
 * @param {float} oneOverW One over the perspective divide value, \`w\`. Usually this is simply \`gl_FragCoord.w\`.
 * @returns {float|vec2|vec3|vec4} The usable value.
 */
float czm_readNonPerspective(float value, float oneOverW) {
    return value * oneOverW;
}

vec2 czm_readNonPerspective(vec2 value, float oneOverW) {
    return value * oneOverW;
}

vec3 czm_readNonPerspective(vec3 value, float oneOverW) {
    return value * oneOverW;
}

vec4 czm_readNonPerspective(vec4 value, float oneOverW) {
    return value * oneOverW;
}
`,wJ=`float czm_reverseLogDepth(float logZ)
{
#ifdef LOG_DEPTH
    float near = czm_currentFrustum.x;
    float far = czm_currentFrustum.y;
    float log2Depth = logZ * czm_log2FarDepthFromNearPlusOne;
    float depthFromNear = pow(2.0, log2Depth) - 1.0;
    return far * (1.0 - near / (depthFromNear + near)) / (far - near);
#endif
    return logZ;
}
`,AJ=`/**
 * Round a floating point value. This function exists because round() doesn't
 * exist in GLSL 1.00. 
 *
 * @param {float|vec2|vec3|vec4} value The value to round
 * @param {float|vec2|vec3|vec3} The rounded value. The type matches the input.
 */
float czm_round(float value) {
  return floor(value + 0.5);
}

vec2 czm_round(vec2 value) {
  return floor(value + 0.5);
}

vec3 czm_round(vec3 value) {
  return floor(value + 0.5);
}

vec4 czm_round(vec4 value) {
  return floor(value + 0.5);
}
`,SJ=`/**
 * Samples the 4 neighboring pixels and return the weighted average.
 *
 * @private
 */
vec3 czm_sampleOctahedralProjectionWithFiltering(sampler2D projectedMap, vec2 textureSize, vec3 direction, float lod)
{
    direction /= dot(vec3(1.0), abs(direction));
    vec2 rev = abs(direction.zx) - vec2(1.0);
    vec2 neg = vec2(direction.x < 0.0 ? rev.x : -rev.x,
                    direction.z < 0.0 ? rev.y : -rev.y);
    vec2 uv = direction.y < 0.0 ? neg : direction.xz;
    vec2 coord = 0.5 * uv + vec2(0.5);
    vec2 pixel = 1.0 / textureSize;

    if (lod > 0.0)
    {
        // Each subseqeuent mip level is half the size
        float scale = 1.0 / pow(2.0, lod);
        float offset = ((textureSize.y + 1.0) / textureSize.x);

        coord.x *= offset;
        coord *= scale;

        coord.x += offset + pixel.x;
        coord.y += (1.0 - (1.0 / pow(2.0, lod - 1.0))) + pixel.y * (lod - 1.0) * 2.0;
    }
    else
    {
        coord.x *= (textureSize.y / textureSize.x);
    }

    // Do bilinear filtering
    #ifndef OES_texture_float_linear
        vec3 color1 = texture(projectedMap, coord + vec2(0.0, pixel.y)).rgb;
        vec3 color2 = texture(projectedMap, coord + vec2(pixel.x, 0.0)).rgb;
        vec3 color3 = texture(projectedMap, coord + pixel).rgb;
        vec3 color4 = texture(projectedMap, coord).rgb;

        vec2 texturePosition = coord * textureSize;

        float fu = fract(texturePosition.x);
        float fv = fract(texturePosition.y);

        vec3 average1 = mix(color4, color2, fu);
        vec3 average2 = mix(color1, color3, fu);

        vec3 color = mix(average1, average2, fv);
    #else
        vec3 color = texture(projectedMap, coord).rgb;
    #endif

    return color;
}


/**
 * Samples from a cube map that has been projected using an octahedral projection from the given direction.
 *
 * @name czm_sampleOctahedralProjection
 * @glslFunction
 *
 * @param {sampler2D} projectedMap The texture with the octahedral projected cube map.
 * @param {vec2} textureSize The width and height dimensions in pixels of the projected map.
 * @param {vec3} direction The normalized direction used to sample the cube map.
 * @param {float} lod The level of detail to sample.
 * @param {float} maxLod The maximum level of detail.
 * @returns {vec3} The color of the cube map at the direction.
 */
vec3 czm_sampleOctahedralProjection(sampler2D projectedMap, vec2 textureSize, vec3 direction, float lod, float maxLod) {
    float currentLod = floor(lod);
    float nextLod = min(currentLod + 1.0, maxLod);

    vec3 colorCurrentLod = czm_sampleOctahedralProjectionWithFiltering(projectedMap, textureSize, direction, currentLod);
    vec3 colorNextLod = czm_sampleOctahedralProjectionWithFiltering(projectedMap, textureSize, direction, nextLod);

    return mix(colorNextLod, colorCurrentLod, nextLod - lod);
}
`,vJ=`/**
 * Adjusts the saturation of a color.
 * 
 * @name czm_saturation
 * @glslFunction
 * 
 * @param {vec3} rgb The color.
 * @param {float} adjustment The amount to adjust the saturation of the color.
 *
 * @returns {float} The color with the saturation adjusted.
 *
 * @example
 * vec3 greyScale = czm_saturation(color, 0.0);
 * vec3 doubleSaturation = czm_saturation(color, 2.0);
 */
vec3 czm_saturation(vec3 rgb, float adjustment)
{
    // Algorithm from Chapter 16 of OpenGL Shading Language
    const vec3 W = vec3(0.2125, 0.7154, 0.0721);
    vec3 intensity = vec3(dot(rgb, W));
    return mix(intensity, rgb, adjustment);
}
`,IJ=`
float czm_sampleShadowMap(highp samplerCube shadowMap, vec3 d)
{
    return czm_unpackDepth(czm_textureCube(shadowMap, d));
}

float czm_sampleShadowMap(highp sampler2D shadowMap, vec2 uv)
{
#ifdef USE_SHADOW_DEPTH_TEXTURE
    return texture(shadowMap, uv).r;
#else
    return czm_unpackDepth(texture(shadowMap, uv));
#endif
}

float czm_shadowDepthCompare(samplerCube shadowMap, vec3 uv, float depth)
{
    return step(depth, czm_sampleShadowMap(shadowMap, uv));
}

float czm_shadowDepthCompare(sampler2D shadowMap, vec2 uv, float depth)
{
    return step(depth, czm_sampleShadowMap(shadowMap, uv));
}
`,OJ=`
float czm_private_shadowVisibility(float visibility, float nDotL, float normalShadingSmooth, float darkness)
{
#ifdef USE_NORMAL_SHADING
#ifdef USE_NORMAL_SHADING_SMOOTH
    float strength = clamp(nDotL / normalShadingSmooth, 0.0, 1.0);
#else
    float strength = step(0.0, nDotL);
#endif
    visibility *= strength;
#endif

    visibility = max(visibility, darkness);
    return visibility;
}

#ifdef USE_CUBE_MAP_SHADOW
float czm_shadowVisibility(samplerCube shadowMap, czm_shadowParameters shadowParameters)
{
    float depthBias = shadowParameters.depthBias;
    float depth = shadowParameters.depth;
    float nDotL = shadowParameters.nDotL;
    float normalShadingSmooth = shadowParameters.normalShadingSmooth;
    float darkness = shadowParameters.darkness;
    vec3 uvw = shadowParameters.texCoords;

    depth -= depthBias;
    float visibility = czm_shadowDepthCompare(shadowMap, uvw, depth);
    return czm_private_shadowVisibility(visibility, nDotL, normalShadingSmooth, darkness);
}
#else
float czm_shadowVisibility(sampler2D shadowMap, czm_shadowParameters shadowParameters)
{
    float depthBias = shadowParameters.depthBias;
    float depth = shadowParameters.depth;
    float nDotL = shadowParameters.nDotL;
    float normalShadingSmooth = shadowParameters.normalShadingSmooth;
    float darkness = shadowParameters.darkness;
    vec2 uv = shadowParameters.texCoords;

    depth -= depthBias;
#ifdef USE_SOFT_SHADOWS
    vec2 texelStepSize = shadowParameters.texelStepSize;
    float radius = 1.0;
    float dx0 = -texelStepSize.x * radius;
    float dy0 = -texelStepSize.y * radius;
    float dx1 = texelStepSize.x * radius;
    float dy1 = texelStepSize.y * radius;
    float visibility = (
        czm_shadowDepthCompare(shadowMap, uv, depth) +
        czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy0), depth) +
        czm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy0), depth) +
        czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy0), depth) +
        czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, 0.0), depth) +
        czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, 0.0), depth) +
        czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy1), depth) +
        czm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy1), depth) +
        czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy1), depth)
    ) * (1.0 / 9.0);
#else
    float visibility = czm_shadowDepthCompare(shadowMap, uv, depth);
#endif

    return czm_private_shadowVisibility(visibility, nDotL, normalShadingSmooth, darkness);
}
#endif
`,RJ=`/**
 * Returns 1.0 if the given value is positive or zero, and -1.0 if it is negative.  This is similar to the GLSL
 * built-in function <code>sign</code> except that returns 1.0 instead of 0.0 when the input value is 0.0.
 * 
 * @name czm_signNotZero
 * @glslFunction
 *
 * @param {} value The value for which to determine the sign.
 * @returns {} 1.0 if the value is positive or zero, -1.0 if the value is negative.
 */
float czm_signNotZero(float value)
{
    return value >= 0.0 ? 1.0 : -1.0;
}

vec2 czm_signNotZero(vec2 value)
{
    return vec2(czm_signNotZero(value.x), czm_signNotZero(value.y));
}

vec3 czm_signNotZero(vec3 value)
{
    return vec3(czm_signNotZero(value.x), czm_signNotZero(value.y), czm_signNotZero(value.z));
}

vec4 czm_signNotZero(vec4 value)
{
    return vec4(czm_signNotZero(value.x), czm_signNotZero(value.y), czm_signNotZero(value.z), czm_signNotZero(value.w));
}
`,DJ=`/**
 * Computes a color from the third order spherical harmonic coefficients and a normalized direction vector.
 * <p>
 * The order of the coefficients is [L00, L1_1, L10, L11, L2_2, L2_1, L20, L21, L22].
 * </p>
 *
 * @name czm_sphericalHarmonics
 * @glslFunction
 *
 * @param {vec3} normal The normalized direction.
 * @param {vec3[9]} coefficients The third order spherical harmonic coefficients.
 * @returns {vec3} The color at the direction.
 *
 * @see https://graphics.stanford.edu/papers/envmap/envmap.pdf
 */
vec3 czm_sphericalHarmonics(vec3 normal, vec3 coefficients[9])
{
    vec3 L00 = coefficients[0];
    vec3 L1_1 = coefficients[1];
    vec3 L10 = coefficients[2];
    vec3 L11 = coefficients[3];
    vec3 L2_2 = coefficients[4];
    vec3 L2_1 = coefficients[5];
    vec3 L20 = coefficients[6];
    vec3 L21 = coefficients[7];
    vec3 L22 = coefficients[8];

    float x = normal.x;
    float y = normal.y;
    float z = normal.z;

    return
          L00
        + L1_1 * y
        + L10 * z
        + L11 * x
        + L2_2 * (y * x)
        + L2_1 * (y * z)
        + L20 * (3.0 * z * z - 1.0)
        + L21 * (z * x)
        + L22 * (x * x - y * y);
}
`,MJ=`/**
 * Converts an sRGB color to a linear RGB color.
 *
 * @param {vec3|vec4} srgbIn The color in sRGB space
 * @returns {vec3|vec4} The color in linear color space. The vector type matches the input.
 */
vec3 czm_srgbToLinear(vec3 srgbIn)
{
    return pow(srgbIn, vec3(2.2));
}

vec4 czm_srgbToLinear(vec4 srgbIn) 
{
    vec3 linearOut = pow(srgbIn.rgb, vec3(2.2));
    return vec4(linearOut, srgbIn.a);
}
`,LJ=`/**
 * Creates a matrix that transforms vectors from tangent space to eye space.
 *
 * @name czm_tangentToEyeSpaceMatrix
 * @glslFunction
 *
 * @param {vec3} normalEC The normal vector in eye coordinates.
 * @param {vec3} tangentEC The tangent vector in eye coordinates.
 * @param {vec3} bitangentEC The bitangent vector in eye coordinates.
 *
 * @returns {mat3} The matrix that transforms from tangent space to eye space.
 *
 * @example
 * mat3 tangentToEye = czm_tangentToEyeSpaceMatrix(normalEC, tangentEC, bitangentEC);
 * vec3 normal = tangentToEye * texture(normalMap, st).xyz;
 */
mat3 czm_tangentToEyeSpaceMatrix(vec3 normalEC, vec3 tangentEC, vec3 bitangentEC)
{
    vec3 normal = normalize(normalEC);
    vec3 tangent = normalize(tangentEC);
    vec3 bitangent = normalize(bitangentEC);
    return mat3(tangent.x  , tangent.y  , tangent.z,
                bitangent.x, bitangent.y, bitangent.z,
                normal.x   , normal.y   , normal.z);
}
`,PJ=`/**
 * A wrapper around the texture (WebGL2) / textureCube (WebGL1)
 * function to allow for WebGL 1 support.
 * 
 * @name czm_textureCube
 * @glslFunction
 *
 * @param {samplerCube} sampler The sampler.
 * @param {vec3} p The coordinates to sample the texture at.
 */
vec4 czm_textureCube(samplerCube sampler, vec3 p) {
#if __VERSION__ == 300
    return texture(sampler, p);
#else  
    return textureCube(sampler, p);
#endif
}`,NJ=`/**
 * Transforms a plane.
 * 
 * @name czm_transformPlane
 * @glslFunction
 *
 * @param {vec4} plane The plane in Hessian Normal Form.
 * @param {mat4} transform The inverse-transpose of a transformation matrix.
 */
vec4 czm_transformPlane(vec4 plane, mat4 transform) {
    vec4 transformedPlane = transform * plane;
    // Convert the transformed plane to Hessian Normal Form
    float normalMagnitude = length(transformedPlane.xyz);
    return transformedPlane / normalMagnitude;
}
`,FJ=`/**
 * Translates a position (or any <code>vec3</code>) that was encoded with {@link EncodedCartesian3},
 * and then provided to the shader as separate <code>high</code> and <code>low</code> bits to
 * be relative to the eye.  As shown in the example, the position can then be transformed in eye
 * or clip coordinates using {@link czm_modelViewRelativeToEye} or {@link czm_modelViewProjectionRelativeToEye},
 * respectively.
 * <p>
 * This technique, called GPU RTE, eliminates jittering artifacts when using large coordinates as
 * described in {@link http://help.agi.com/AGIComponents/html/BlogPrecisionsPrecisions.htm|Precisions, Precisions}.
 * </p>
 *
 * @name czm_translateRelativeToEye
 * @glslFunction
 *
 * @param {vec3} high The position's high bits.
 * @param {vec3} low The position's low bits.
 * @returns {vec3} The position translated to be relative to the camera's position.
 *
 * @example
 * in vec3 positionHigh;
 * in vec3 positionLow;
 *
 * void main()
 * {
 *   vec4 p = czm_translateRelativeToEye(positionHigh, positionLow);
 *   gl_Position = czm_modelViewProjectionRelativeToEye * p;
 * }
 *
 * @see czm_modelViewRelativeToEye
 * @see czm_modelViewProjectionRelativeToEye
 * @see czm_computePosition
 * @see EncodedCartesian3
 */
vec4 czm_translateRelativeToEye(vec3 high, vec3 low)
{
    vec3 highDifference = high - czm_encodedCameraPositionMCHigh;
    // This check handles the case when NaN values have gotten into \`highDifference\`.
    // Such a thing could happen on devices running iOS.
    if (length(highDifference) == 0.0) {  
        highDifference = vec3(0);  
    }
    vec3 lowDifference = low - czm_encodedCameraPositionMCLow;

    return vec4(highDifference + lowDifference, 1.0);
}
`,BJ=`/**
 * @private
 */
vec4 czm_translucentPhong(vec3 toEye, czm_material material, vec3 lightDirectionEC)
{
    // Diffuse from directional light sources at eye (for top-down and horizon views)
    float diffuse = czm_getLambertDiffuse(vec3(0.0, 0.0, 1.0), material.normal);

    if (czm_sceneMode == czm_sceneMode3D) {
        // (and horizon views in 3D)
        diffuse += czm_getLambertDiffuse(vec3(0.0, 1.0, 0.0), material.normal);
    }

    diffuse = clamp(diffuse, 0.0, 1.0);

    float specular = czm_getSpecular(lightDirectionEC, toEye, material.normal, material.shininess);

    // Temporary workaround for adding ambient.
    vec3 materialDiffuse = material.diffuse * 0.5;

    vec3 ambient = materialDiffuse;
    vec3 color = ambient + material.emission;
    color += materialDiffuse * diffuse * czm_lightColor;
    color += material.specular * specular * czm_lightColor;

    return vec4(color, material.alpha);
}
`,zJ=`/**
 * Returns the transpose of the matrix.  The input <code>matrix</code> can be
 * a <code>mat2</code>, <code>mat3</code>, or <code>mat4</code>.
 *
 * @name czm_transpose
 * @glslFunction
 *
 * @param {} matrix The matrix to transpose.
 *
 * @returns {} The transposed matrix.
 *
 * @example
 * // GLSL declarations
 * mat2 czm_transpose(mat2 matrix);
 * mat3 czm_transpose(mat3 matrix);
 * mat4 czm_transpose(mat4 matrix);
 *
 * // Transpose a 3x3 rotation matrix to find its inverse.
 * mat3 eastNorthUpToEye = czm_eastNorthUpToEyeCoordinates(
 *     positionMC, normalEC);
 * mat3 eyeToEastNorthUp = czm_transpose(eastNorthUpToEye);
 */
mat2 czm_transpose(mat2 matrix)
{
    return mat2(
        matrix[0][0], matrix[1][0],
        matrix[0][1], matrix[1][1]);
}

mat3 czm_transpose(mat3 matrix)
{
    return mat3(
        matrix[0][0], matrix[1][0], matrix[2][0],
        matrix[0][1], matrix[1][1], matrix[2][1],
        matrix[0][2], matrix[1][2], matrix[2][2]);
}

mat4 czm_transpose(mat4 matrix)
{
    return mat4(
        matrix[0][0], matrix[1][0], matrix[2][0], matrix[3][0],
        matrix[0][1], matrix[1][1], matrix[2][1], matrix[3][1],
        matrix[0][2], matrix[1][2], matrix[2][2], matrix[3][2],
        matrix[0][3], matrix[1][3], matrix[2][3], matrix[3][3]);
}
`,UJ=`vec2 getLookupUv(vec2 dimensions, int i) {
    int pixY = i / int(dimensions.x);
    int pixX = i - (pixY * int(dimensions.x));
    float pixelWidth = 1.0 / dimensions.x;
    float pixelHeight = 1.0 / dimensions.y;
    float u = (float(pixX) + 0.5) * pixelWidth; // sample from center of pixel
    float v = (float(pixY) + 0.5) * pixelHeight;
    return vec2(u, v);
}

vec4 czm_unpackClippingExtents(highp sampler2D extentsTexture, int index) {
    vec2 textureDimensions = vec2(textureSize(extentsTexture, 0));
    return texture(extentsTexture, getLookupUv(textureDimensions, index));
}`,kJ=`/**
 * Unpacks a vec4 depth value to a float in [0, 1) range.
 *
 * @name czm_unpackDepth
 * @glslFunction
 *
 * @param {vec4} packedDepth The packed depth.
 *
 * @returns {float} The floating-point depth in [0, 1) range.
 */
 float czm_unpackDepth(vec4 packedDepth)
 {
    // See Aras PranckeviÄius' post Encoding Floats to RGBA
    // http://aras-p.info/blog/2009/07/30/encoding-floats-to-rgba-the-final/
    return dot(packedDepth, vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));
 }
`,jJ=`/**
 * Unpack an IEEE 754 single-precision float that is packed as a little-endian unsigned normalized vec4.
 *
 * @name czm_unpackFloat
 * @glslFunction
 *
 * @param {vec4} packedFloat The packed float.
 *
 * @returns {float} The floating-point depth in arbitrary range.
 */
float czm_unpackFloat(vec4 packedFloat)
{
    // Convert to [0.0, 255.0] and round to integer
    packedFloat = floor(packedFloat * 255.0 + 0.5);
    float sign = 1.0 - step(128.0, packedFloat[3]) * 2.0;
    float exponent = 2.0 * mod(packedFloat[3], 128.0) + step(128.0, packedFloat[2]) - 127.0;    
    if (exponent == -127.0)
    {
        return 0.0;
    }
    float mantissa = mod(packedFloat[2], 128.0) * 65536.0 + packedFloat[1] * 256.0 + packedFloat[0] + float(0x800000);
    float result = sign * exp2(exponent - 23.0) * mantissa;
    return result;
}
`,VJ=`/**
 * Unpack unsigned integers of 1-4 bytes. in WebGL 1, there is no uint type,
 * so the return value is an int.
 * <p>
 * There are also precision limitations in WebGL 1. highp int is still limited
 * to 24 bits. Above the value of 2^24 = 16777216, precision loss may occur.
 * </p>
 *
 * @param {float|vec2|vec3|vec4} packed The packed value. For vectors, the components are listed in little-endian order.
 *
 * @return {int} The unpacked value.
 */
 int czm_unpackUint(float packedValue) {
   float rounded = czm_round(packedValue * 255.0);
   return int(rounded);
 }

 int czm_unpackUint(vec2 packedValue) {
   vec2 rounded = czm_round(packedValue * 255.0);
   return int(dot(rounded, vec2(1.0, 256.0)));
 }

 int czm_unpackUint(vec3 packedValue) {
   vec3 rounded = czm_round(packedValue * 255.0);
   return int(dot(rounded, vec3(1.0, 256.0, 65536.0)));
 }

 int czm_unpackUint(vec4 packedValue) {
   vec4 rounded = czm_round(packedValue * 255.0);
   return int(dot(rounded, vec4(1.0, 256.0, 65536.0, 16777216.0)));
 }
`,GJ=`/**
 * Transform metadata values following the EXT_structural_metadata spec
 * by multiplying by scale and adding the offset. Operations are always
 * performed component-wise, even for matrices.
 * 
 * @param {float|vec2|vec3|vec4|mat2|mat3|mat4} offset The offset to add
 * @param {float|vec2|vec3|vec4|mat2|mat3|mat4} scale The scale factor to multiply
 * @param {float|vec2|vec3|vec4|mat2|mat3|mat4} value The original value.
 *
 * @return {float|vec2|vec3|vec4|mat2|mat3|mat4} The transformed value of the same scalar/vector/matrix type as the input.
 */
float czm_valueTransform(float offset, float scale, float value) {
  return scale * value + offset;
}

vec2 czm_valueTransform(vec2 offset, vec2 scale, vec2 value) {
  return scale * value + offset;
}

vec3 czm_valueTransform(vec3 offset, vec3 scale, vec3 value) {
  return scale * value + offset;
}

vec4 czm_valueTransform(vec4 offset, vec4 scale, vec4 value) {
  return scale * value + offset;
}

mat2 czm_valueTransform(mat2 offset, mat2 scale, mat2 value) {
  return matrixCompMult(scale, value) + offset;
}

mat3 czm_valueTransform(mat3 offset, mat3 scale, mat3 value) {
  return matrixCompMult(scale, value) + offset;
}

mat4 czm_valueTransform(mat4 offset, mat4 scale, mat4 value) {
  return matrixCompMult(scale, value) + offset;
}
`,HJ=`#ifdef LOG_DEPTH
// 1.0 at the near plane, increasing linearly from there.
out float v_depthFromNearPlusOne;
#ifdef SHADOW_MAP
out vec3 v_logPositionEC;
#endif
#endif

vec4 czm_updatePositionDepth(vec4 coords) {
#if defined(LOG_DEPTH)

#ifdef SHADOW_MAP
    vec3 logPositionEC = (czm_inverseProjection * coords).xyz;
    v_logPositionEC = logPositionEC;
#endif

    // With the very high far/near ratios used with the logarithmic depth
    // buffer, floating point rounding errors can cause linear depth values
    // to end up on the wrong side of the far plane, even for vertices that
    // are really nowhere near it. Since we always write a correct logarithmic
    // depth value in the fragment shader anyway, we just need to make sure
    // such errors don't cause the primitive to be clipped entirely before
    // we even get to the fragment shader.
    coords.z = clamp(coords.z / coords.w, -1.0, 1.0) * coords.w;
#endif

    return coords;
}

/**
 * Writes the logarithmic depth to gl_Position using the already computed gl_Position.
 *
 * @name czm_vertexLogDepth
 * @glslFunction
 */
void czm_vertexLogDepth()
{
#ifdef LOG_DEPTH
    v_depthFromNearPlusOne = (gl_Position.w - czm_currentFrustum.x) + 1.0;
    gl_Position = czm_updatePositionDepth(gl_Position);
#endif
}

/**
 * Writes the logarithmic depth to gl_Position using the provided clip coordinates.
 * <p>
 * An example use case for this function would be moving the vertex in window coordinates
 * before converting back to clip coordinates. Use the original vertex clip coordinates.
 * </p>
 * @name czm_vertexLogDepth
 * @glslFunction
 *
 * @param {vec4} clipCoords The vertex in clip coordinates.
 *
 * @example
 * czm_vertexLogDepth(czm_projection * vec4(positionEyeCoordinates, 1.0));
 */
void czm_vertexLogDepth(vec4 clipCoords)
{
#ifdef LOG_DEPTH
    v_depthFromNearPlusOne = (clipCoords.w - czm_currentFrustum.x) + 1.0;
    czm_updatePositionDepth(clipCoords);
#endif
}
`,qJ=`vec4 czm_screenToEyeCoordinates(vec4 screenCoordinate)
{
    // Reconstruct NDC coordinates
    float x = 2.0 * screenCoordinate.x - 1.0;
    float y = 2.0 * screenCoordinate.y - 1.0;
    float z = (screenCoordinate.z - czm_viewportTransformation[3][2]) / czm_viewportTransformation[2][2];
    vec4 q = vec4(x, y, z, 1.0);

    // Reverse the perspective division to obtain clip coordinates.
    q /= screenCoordinate.w;

    // Reverse the projection transformation to obtain eye coordinates.
    if (!(czm_inverseProjection == mat4(0.0))) // IE and Edge sometimes do something weird with != between mat4s
    {
        q = czm_inverseProjection * q;
    }
    else
    {
        float top = czm_frustumPlanes.x;
        float bottom = czm_frustumPlanes.y;
        float left = czm_frustumPlanes.z;
        float right = czm_frustumPlanes.w;

        float near = czm_currentFrustum.x;
        float far = czm_currentFrustum.y;

        q.x = (q.x * (right - left) + left + right) * 0.5;
        q.y = (q.y * (top - bottom) + bottom + top) * 0.5;
        q.z = (q.z * (near - far) - near - far) * 0.5;
        q.w = 1.0;
    }

    return q;
}

/**
 * Transforms a position from window to eye coordinates.
 * The transform from window to normalized device coordinates is done using components
 * of (@link czm_viewport} and {@link czm_viewportTransformation} instead of calculating
 * the inverse of <code>czm_viewportTransformation</code>. The transformation from
 * normalized device coordinates to clip coordinates is done using <code>fragmentCoordinate.w</code>,
 * which is expected to be the scalar used in the perspective divide. The transformation
 * from clip to eye coordinates is done using {@link czm_inverseProjection}.
 *
 * @name czm_windowToEyeCoordinates
 * @glslFunction
 *
 * @param {vec4} fragmentCoordinate The position in window coordinates to transform.
 *
 * @returns {vec4} The transformed position in eye coordinates.
 *
 * @see czm_modelToWindowCoordinates
 * @see czm_eyeToWindowCoordinates
 * @see czm_inverseProjection
 * @see czm_viewport
 * @see czm_viewportTransformation
 *
 * @example
 * vec4 positionEC = czm_windowToEyeCoordinates(gl_FragCoord);
 */
vec4 czm_windowToEyeCoordinates(vec4 fragmentCoordinate)
{
    vec2 screenCoordXY = (fragmentCoordinate.xy - czm_viewport.xy) / czm_viewport.zw;
    return czm_screenToEyeCoordinates(vec4(screenCoordXY, fragmentCoordinate.zw));
}

vec4 czm_screenToEyeCoordinates(vec2 screenCoordinateXY, float depthOrLogDepth)
{
    // See reverseLogDepth.glsl. This is separate to re-use the pow.
#if defined(LOG_DEPTH) || defined(LOG_DEPTH_READ_ONLY)
    float near = czm_currentFrustum.x;
    float far = czm_currentFrustum.y;
    float log2Depth = depthOrLogDepth * czm_log2FarDepthFromNearPlusOne;
    float depthFromNear = pow(2.0, log2Depth) - 1.0;
    float depthFromCamera = depthFromNear + near;
    vec4 screenCoord = vec4(screenCoordinateXY, far * (1.0 - near / depthFromCamera) / (far - near), 1.0);
    vec4 eyeCoordinate = czm_screenToEyeCoordinates(screenCoord);
    eyeCoordinate.w = 1.0 / depthFromCamera; // Better precision
    return eyeCoordinate;
#else
    vec4 screenCoord = vec4(screenCoordinateXY, depthOrLogDepth, 1.0);
    vec4 eyeCoordinate = czm_screenToEyeCoordinates(screenCoord);
#endif
    return eyeCoordinate;
}

/**
 * Transforms a position given as window x/y and a depth or a log depth from window to eye coordinates.
 * This function produces more accurate results for window positions with log depth than
 * conventionally unpacking the log depth using czm_reverseLogDepth and using the standard version
 * of czm_windowToEyeCoordinates.
 *
 * @name czm_windowToEyeCoordinates
 * @glslFunction
 *
 * @param {vec2} fragmentCoordinateXY The XY position in window coordinates to transform.
 * @param {float} depthOrLogDepth A depth or log depth for the fragment.
 *
 * @see czm_modelToWindowCoordinates
 * @see czm_eyeToWindowCoordinates
 * @see czm_inverseProjection
 * @see czm_viewport
 * @see czm_viewportTransformation
 *
 * @returns {vec4} The transformed position in eye coordinates.
 */
vec4 czm_windowToEyeCoordinates(vec2 fragmentCoordinateXY, float depthOrLogDepth)
{
    vec2 screenCoordXY = (fragmentCoordinateXY.xy - czm_viewport.xy) / czm_viewport.zw;
    return czm_screenToEyeCoordinates(screenCoordXY, depthOrLogDepth);
}
`,WJ=`// emulated noperspective
#if !defined(LOG_DEPTH)
in float v_WindowZ;
#endif

/**
 * Emulates GL_DEPTH_CLAMP. Clamps a fragment to the near and far plane
 * by writing the fragment's depth. See czm_depthClamp for more details.
 *
 * @name czm_writeDepthClamp
 * @glslFunction
 *
 * @example
 * out_FragColor = color;
 * czm_writeDepthClamp();
 *
 * @see czm_depthClamp
 */
void czm_writeDepthClamp()
{
#if (!defined(LOG_DEPTH) && (__VERSION__ == 300 || defined(GL_EXT_frag_depth)))
    gl_FragDepth = clamp(v_WindowZ * gl_FragCoord.w, 0.0, 1.0);
#endif
}
`,$J=`#ifdef LOG_DEPTH
in float v_depthFromNearPlusOne;

#ifdef POLYGON_OFFSET
uniform vec2 u_polygonOffset;
#endif

#endif

/**
 * Writes the fragment depth to the logarithmic depth buffer.
 * <p>
 * Use this when the vertex shader does not call {@link czm_vertexlogDepth}, for example, when
 * ray-casting geometry using a full screen quad.
 * </p>
 * @name czm_writeLogDepth
 * @glslFunction
 *
 * @param {float} depth The depth coordinate, where 1.0 is on the near plane and
 *                      depth increases in eye-space units from there
 *
 * @example
 * czm_writeLogDepth((czm_projection * v_positionEyeCoordinates).w + 1.0);
 */
void czm_writeLogDepth(float depth)
{
#if (defined(LOG_DEPTH) && (__VERSION__ == 300 || defined(GL_EXT_frag_depth)))
    // Discard the vertex if it's not between the near and far planes.
    // We allow a bit of epsilon on the near plane comparison because a 1.0
    // from the vertex shader (indicating the vertex should be _on_ the near
    // plane) will not necessarily come here as exactly 1.0.
    if (depth <= 0.9999999 || depth > czm_farDepthFromNearPlusOne) {
        discard;
    }

#ifdef POLYGON_OFFSET
    // Polygon offset: m * factor + r * units
    float factor = u_polygonOffset[0];
    float units = u_polygonOffset[1];

#if (__VERSION__ == 300 || defined(GL_OES_standard_derivatives))
    // This factor doesn't work in IE 10
    if (factor != 0.0) {
        // m = sqrt(dZdX^2 + dZdY^2);
        float x = dFdx(depth);
        float y = dFdy(depth);
        float m = sqrt(x * x + y * y);

        // Apply the factor before computing the log depth.
        depth += m * factor;
    }
#endif

#endif

    gl_FragDepth = log2(depth) * czm_oneOverLog2FarDepthFromNearPlusOne;

#ifdef POLYGON_OFFSET
    // Apply the units after the log depth.
    gl_FragDepth += czm_epsilon7 * units;
#endif

#endif
}

/**
 * Writes the fragment depth to the logarithmic depth buffer.
 * <p>
 * Use this when the vertex shader calls {@link czm_vertexlogDepth}.
 * </p>
 *
 * @name czm_writeLogDepth
 * @glslFunction
 */
void czm_writeLogDepth() {
#ifdef LOG_DEPTH
    czm_writeLogDepth(v_depthFromNearPlusOne);
#endif
}
`,XJ=`/**
 * Transforms a value for non-perspective interpolation by multiplying
 * it by w, the value used in the perspective divide. This function is
 * intended to be called in a vertex shader to compute the value of a
 * \`varying\` that should not be subject to perspective interpolation.
 * For example, screen-space texture coordinates. The fragment shader
 * must call {@link czm_readNonPerspective} to retrieve the final
 * non-perspective value.
 *
 * @name czm_writeNonPerspective
 * @glslFunction
 *
 * @param {float|vec2|vec3|vec4} value The value to be interpolated without accounting for perspective.
 * @param {float} w The perspective divide value. Usually this is the computed \`gl_Position.w\`.
 * @returns {float|vec2|vec3|vec4} The transformed value, intended to be stored in a \`varying\` and read in the
 *          fragment shader with {@link czm_readNonPerspective}.
 */
float czm_writeNonPerspective(float value, float w) {
    return value * w;
}

vec2 czm_writeNonPerspective(vec2 value, float w) {
    return value * w;
}

vec3 czm_writeNonPerspective(vec3 value, float w) {
    return value * w;
}

vec4 czm_writeNonPerspective(vec4 value, float w) {
    return value * w;
}
`,U0={czm_degreesPerRadian:xK,czm_depthRange:EK,czm_epsilon1:CK,czm_epsilon2:wK,czm_epsilon3:AK,czm_epsilon4:SK,czm_epsilon5:vK,czm_epsilon6:IK,czm_epsilon7:OK,czm_infinity:RK,czm_oneOverPi:DK,czm_oneOverTwoPi:MK,czm_passCesium3DTile:LK,czm_passCesium3DTileClassification:PK,czm_passCesium3DTileClassificationIgnoreShow:NK,czm_passClassification:FK,czm_passCompute:BK,czm_passEnvironment:zK,czm_passGlobe:UK,czm_passOpaque:kK,czm_passOverlay:jK,czm_passTerrainClassification:VK,czm_passTranslucent:GK,czm_passVoxels:HK,czm_pi:qK,czm_piOverFour:WK,czm_piOverSix:$K,czm_piOverThree:XK,czm_piOverTwo:YK,czm_radiansPerDegree:KK,czm_sceneMode2D:ZK,czm_sceneMode3D:JK,czm_sceneModeColumbusView:QK,czm_sceneModeMorphing:eZ,czm_solarRadius:tZ,czm_threePiOver2:nZ,czm_twoPi:iZ,czm_webMercatorMaxLatitude:rZ,czm_depthRangeStruct:sZ,czm_material:oZ,czm_materialInput:aZ,czm_modelMaterial:cZ,czm_modelVertexOutput:lZ,czm_ray:uZ,czm_raySegment:fZ,czm_shadowParameters:hZ,czm_HSBToRGB:dZ,czm_HSLToRGB:pZ,czm_RGBToHSB:mZ,czm_RGBToHSL:gZ,czm_RGBToXYZ:_Z,czm_XYZToRGB:yZ,czm_acesTonemapping:bZ,czm_alphaWeight:TZ,czm_antialias:xZ,czm_applyHSBShift:EZ,czm_approximateSphericalCoordinates:CZ,czm_approximateTanh:wZ,czm_backFacing:AZ,czm_branchFreeTernary:SZ,czm_cascadeColor:vZ,czm_cascadeDistance:IZ,czm_cascadeMatrix:OZ,czm_cascadeWeights:RZ,czm_clipPolygons:DZ,czm_columbusViewMorph:MZ,czm_computeAtmosphereColor:LZ,czm_computeGroundAtmosphereScattering:PZ,czm_computePosition:NZ,czm_computeScattering:FZ,czm_cosineAndSine:BZ,czm_decompressTextureCoordinates:zZ,czm_depthClamp:UZ,czm_eastNorthUpToEyeCoordinates:kZ,czm_ellipsoidContainsPoint:jZ,czm_ellipsoidTextureCoordinates:VZ,czm_equalsEpsilon:GZ,czm_eyeOffset:HZ,czm_eyeToWindowCoordinates:qZ,czm_fastApproximateAtan:WZ,czm_fog:$Z,czm_gammaCorrect:XZ,czm_geodeticSurfaceNormal:YZ,czm_getDefaultMaterial:KZ,czm_getDynamicAtmosphereLightDirection:ZZ,czm_getLambertDiffuse:JZ,czm_getSpecular:QZ,czm_getWaterNoise:eJ,czm_hue:tJ,czm_inverseGamma:nJ,czm_isEmpty:iJ,czm_isFull:rJ,czm_latitudeToWebMercatorFraction:sJ,czm_lineDistance:oJ,czm_linearToSrgb:aJ,czm_luminance:cJ,czm_maximumComponent:lJ,czm_metersPerPixel:uJ,czm_modelToWindowCoordinates:fJ,czm_multiplyWithColorBalance:hJ,czm_nearFarScalar:dJ,czm_octDecode:pJ,czm_packDepth:mJ,czm_pbrLighting:gJ,czm_phong:_J,czm_planeDistance:yJ,czm_pointAlongRay:bJ,czm_rayEllipsoidIntersectionInterval:TJ,czm_raySphereIntersectionInterval:xJ,czm_readDepth:EJ,czm_readNonPerspective:CJ,czm_reverseLogDepth:wJ,czm_round:AJ,czm_sampleOctahedralProjection:SJ,czm_saturation:vJ,czm_shadowDepthCompare:IJ,czm_shadowVisibility:OJ,czm_signNotZero:RJ,czm_sphericalHarmonics:DJ,czm_srgbToLinear:MJ,czm_tangentToEyeSpaceMatrix:LJ,czm_textureCube:PJ,czm_transformPlane:NJ,czm_translateRelativeToEye:FJ,czm_translucentPhong:BJ,czm_transpose:zJ,czm_unpackClippingExtents:UJ,czm_unpackDepth:kJ,czm_unpackFloat:jJ,czm_unpackUint:VJ,czm_valueTransform:GJ,czm_vertexLogDepth:HJ,czm_windowToEyeCoordinates:qJ,czm_writeDepthClamp:WJ,czm_writeLogDepth:$J,czm_writeNonPerspective:XJ};function YJ(e,t){let n=e;return n=n.replaceAll("version 300 es",""),n=n.replaceAll(/(texture\()/g,"texture2D("),t?(n=n.replaceAll(/\n\s*(in)\s+(vec\d|mat\d|float)/g,`
varying $2`),/out_FragData_(\d+)/.test(n)&&(n=`#extension GL_EXT_draw_buffers : enable
${n}`,n=n.replaceAll(/layout\s+\(location\s*=\s*\d+\)\s*out\s+vec4\s+out_FragData_\d+;/g,""),n=n.replaceAll(/out_FragData_(\d+)/g,"gl_FragData[$1]")),n=n.replaceAll(/layout\s+\(location\s*=\s*0\)\s*out\s+vec4\s+out_FragColor;/g,""),n=n.replaceAll(/out_FragColor/g,"gl_FragColor"),n=n.replaceAll(/out_FragColor\[(\d+)\]/g,"gl_FragColor[$1]"),/gl_FragDepth/.test(n)&&(n=`#extension GL_EXT_frag_depth : enable
${n}`,n=n.replaceAll(/gl_FragDepth/g,"gl_FragDepthEXT")),n=`#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
#endif
${n}`):(n=n.replaceAll(/(in)\s+(vec\d|mat\d|float)/g,"attribute $2"),n=n.replaceAll(/(out)\s+(vec\d|mat\d|float)\s+([\w]+);/g,"varying $2 $3;")),n=`#version 100
${n}`,n}function DP(e){return e=e.replace(/\/\/.*/g,""),e.replace(/\/\*\*[\s\S]*?\*\//gm,function(t){const n=t.match(/\n/gm).length;let i="";for(let r=0;r<n;++r)i+=`
`;return i})}function MP(e,t,n){let i;for(let r=0;r<n.length;++r)n[r].name===e&&(i=n[r]);return l(i)||(t=DP(t),i={name:e,glslSource:t,dependsOn:[],requiredBy:[],evaluated:!1},n.push(i)),i}function LP(e,t){if(e.evaluated)return;e.evaluated=!0;let n=e.glslSource.match(/\bczm_[a-zA-Z0-9_]*/g);l(n)&&n!==null&&(n=n.filter(function(i,r){return n.indexOf(i)===r}),n.forEach(function(i){if(i!==e.name&&Je._czmBuiltinsAndUniforms.hasOwnProperty(i)){const r=MP(i,Je._czmBuiltinsAndUniforms[i],t);e.dependsOn.push(r),r.requiredBy.push(e),LP(r,t)}}))}function KJ(e){const t=[],n=[];for(;e.length>0;){const r=e.pop();n.push(r),r.requiredBy.length===0&&t.push(r)}for(;t.length>0;){const r=t.shift();e.push(r);for(let s=0;s<r.dependsOn.length;++s){const o=r.dependsOn[s],a=o.requiredBy.indexOf(r);o.requiredBy.splice(a,1),o.requiredBy.length===0&&t.push(o)}}const i=[];for(let r=0;r<n.length;++r)n[r].requiredBy.length!==0&&i.push(n[r]);if(i.length!==0){let r=`A circular dependency was found in the following built-in functions/structs/constants: 
`;for(let s=0;s<i.length;++s)r=`${r+i[s].name}
`;throw new A(r)}}function ZJ(e){const t=[],n=MP("main",e,t);LP(n,t),KJ(t);let i="";for(let r=t.length-1;r>=0;--r)i=`${i+t[r].glslSource}
`;return i.replace(n.glslSource,"")}function PP(e,t,n){let i,r,s="";const o=e.sources;if(l(o))for(i=0,r=o.length;i<r;++i)s+=`
#line 0
${o[i]}`;s=DP(s);let a;s=s.replace(/#version\s+(.*?)\n/gm,function(b,x){if(l(a)&&a!==x)throw new A(`inconsistent versions found: ${a} and ${x}`);return a=x,`
`});const c=[];s=s.replace(/#extension.*\n/gm,function(b){return c.push(b),`
`}),s=s.replace(/precision\s(lowp|mediump|highp)\s(float|int);/,"");const u=e.pickColorQualifier;l(u)&&(s=Je.createPickFragmentShaderSource(s,u));let h="";const d=c.length;for(i=0;i<d;i++)h+=c[i];t&&(h+=`#ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    precision highp int;
#else
    precision mediump float;
    precision mediump int;
    #define highp mediump
#endif

`);const p=e.defines;if(l(p))for(i=0,r=p.length;i<r;++i){const b=p[i];b.length!==0&&(h+=`#define ${b}
`)}n.textureFloatLinear&&(h+=`#define OES_texture_float_linear

`),n.floatingPointTexture&&(h+=`#define OES_texture_float

`);let g="";e.includeBuiltIns&&(g=ZJ(s)),h+=`
#line 0
`;const _=g+s;return n.webgl2&&t&&!/layout\s*\(location\s*=\s*0\)\s*out\s+vec4\s+out_FragColor;/g.test(_)&&!/czm_out_FragColor/g.test(_)&&/out_FragColor/g.test(_)&&(h+=`layout(location = 0) out vec4 out_FragColor;

`),h+=g,h+=s,n.webgl2?h=`#version 300 es
${h}`:h=YJ(h,t),h}function Je(e){e=T(e,T.EMPTY_OBJECT);const t=e.pickColorQualifier;if(l(t)&&t!=="uniform"&&t!=="in")throw new A("options.pickColorQualifier must be 'uniform' or 'in'.");this.defines=l(e.defines)?e.defines.slice(0):[],this.sources=l(e.sources)?e.sources.slice(0):[],this.pickColorQualifier=t,this.includeBuiltIns=T(e.includeBuiltIns,!0)}Je.prototype.clone=function(){return new Je({sources:this.sources,defines:this.defines,pickColorQualifier:this.pickColorQualifier,includeBuiltIns:this.includeBuiltIns})};Je.replaceMain=function(e,t){return t=`void ${t}()`,e.replace(/void\s+main\s*\(\s*(?:void)?\s*\)/g,t)};Je.prototype.getCacheKey=function(){const t=this.defines.slice().sort().join(","),n=this.pickColorQualifier,i=this.includeBuiltIns,r=this.sources.join(`
`);return`${t}:${n}:${i}:${r}`};Je.prototype.createCombinedVertexShader=function(e){return PP(this,!1,e)};Je.prototype.createCombinedFragmentShader=function(e){return PP(this,!0,e)};Je._czmBuiltinsAndUniforms={};for(const e in U0)U0.hasOwnProperty(e)&&(Je._czmBuiltinsAndUniforms[e]=U0[e]);for(const e in e_)if(e_.hasOwnProperty(e)){const t=e_[e];typeof t.getDeclaration=="function"&&(Je._czmBuiltinsAndUniforms[e]=t.getDeclaration(e))}Je.createPickVertexShaderSource=function(e){return`${Je.replaceMain(e,"czm_old_main")}
in vec4 pickColor; 
out vec4 czm_pickColor; 
void main() 
{ 
    czm_old_main(); 
    czm_pickColor = pickColor; 
}`};Je.createPickFragmentShaderSource=function(e,t){const n=Je.replaceMain(e,"czm_old_main"),i=`${t} vec4 czm_pickColor; 
void main() 
{ 
    czm_old_main(); 
    if (out_FragColor.a == 0.0) { 
       discard; 
    } 
    out_FragColor = czm_pickColor; 
}`;return`${n}
${i}`};function JJ(e,t){const n=e.defines,i=n.length;for(let r=0;r<i;++r)if(n[r]===t)return!0;return!1}function NP(e,t){const n=e.sources,i=n.length;for(let r=0;r<i;++r)if(n[r].indexOf(t)!==-1)return!0;return!1}function FP(e,t){const n=t.length;for(let i=0;i<n;++i){const r=t[i];if(NP(e,r))return r}}const QJ=["v_normalEC","v_normal"];Je.findNormalVarying=function(e){return NP(e,"#ifdef HAS_NORMALS")?JJ(e,"HAS_NORMALS")?"v_normalEC":void 0:FP(e,QJ)};const eQ=["v_positionEC"];Je.findPositionVarying=function(e){return FP(e,eQ)};function kt(e){e=T(e,T.EMPTY_OBJECT),y.defined("options.context",e.context);const t=e.context;let n=e.width,i=e.height;const r=e.source;l(r)&&(l(n)||(n=T(r.videoWidth,r.width)),l(i)||(i=T(r.videoHeight,r.height)));const s=T(e.pixelFormat,Le.RGBA),o=T(e.pixelDatatype,De.UNSIGNED_BYTE),a=Le.toInternalFormat(s,o,t),c=Le.isCompressedFormat(a);if(!l(n)||!l(i))throw new A("options requires a source field to create an initialized texture or width and height fields to create a blank texture.");if(y.typeOf.number.greaterThan("width",n,0),n>We.maximumTextureSize)throw new A(`Width must be less than or equal to the maximum texture size (${We.maximumTextureSize}).  Check maximumTextureSize.`);if(y.typeOf.number.greaterThan("height",i,0),i>We.maximumTextureSize)throw new A(`Height must be less than or equal to the maximum texture size (${We.maximumTextureSize}).  Check maximumTextureSize.`);if(!Le.validate(s))throw new A("Invalid options.pixelFormat.");if(!c&&!De.validate(o))throw new A("Invalid options.pixelDatatype.");if(s===Le.DEPTH_COMPONENT&&o!==De.UNSIGNED_SHORT&&o!==De.UNSIGNED_INT)throw new A("When options.pixelFormat is DEPTH_COMPONENT, options.pixelDatatype must be UNSIGNED_SHORT or UNSIGNED_INT.");if(s===Le.DEPTH_STENCIL&&o!==De.UNSIGNED_INT_24_8)throw new A("When options.pixelFormat is DEPTH_STENCIL, options.pixelDatatype must be UNSIGNED_INT_24_8.");if(o===De.FLOAT&&!t.floatingPointTexture)throw new A("When options.pixelDatatype is FLOAT, this WebGL implementation must support the OES_texture_float extension.  Check context.floatingPointTexture.");if(o===De.HALF_FLOAT&&!t.halfFloatingPointTexture)throw new A("When options.pixelDatatype is HALF_FLOAT, this WebGL implementation must support the OES_texture_half_float extension. Check context.halfFloatingPointTexture.");if(Le.isDepthFormat(s)){if(l(r))throw new A("When options.pixelFormat is DEPTH_COMPONENT or DEPTH_STENCIL, source cannot be provided.");if(!t.depthTexture)throw new A("When options.pixelFormat is DEPTH_COMPONENT or DEPTH_STENCIL, this WebGL implementation must support WEBGL_depth_texture.  Check context.depthTexture.")}if(c){if(!l(r)||!l(r.arrayBufferView))throw new A("When options.pixelFormat is compressed, options.source.arrayBufferView must be defined.");if(Le.isDXTFormat(a)&&!t.s3tc)throw new A("When options.pixelFormat is S3TC compressed, this WebGL implementation must support the WEBGL_compressed_texture_s3tc extension. Check context.s3tc.");if(Le.isPVRTCFormat(a)&&!t.pvrtc)throw new A("When options.pixelFormat is PVRTC compressed, this WebGL implementation must support the WEBGL_compressed_texture_pvrtc extension. Check context.pvrtc.");if(Le.isASTCFormat(a)&&!t.astc)throw new A("When options.pixelFormat is ASTC compressed, this WebGL implementation must support the WEBGL_compressed_texture_astc extension. Check context.astc.");if(Le.isETC2Format(a)&&!t.etc)throw new A("When options.pixelFormat is ETC2 compressed, this WebGL implementation must support the WEBGL_compressed_texture_etc extension. Check context.etc.");if(Le.isETC1Format(a)&&!t.etc1)throw new A("When options.pixelFormat is ETC1 compressed, this WebGL implementation must support the WEBGL_compressed_texture_etc1 extension. Check context.etc1.");if(Le.isBC7Format(a)&&!t.bc7)throw new A("When options.pixelFormat is BC7 compressed, this WebGL implementation must support the EXT_texture_compression_bptc extension. Check context.bc7.");if(Le.compressedTextureSizeInBytes(a,n,i)!==r.arrayBufferView.byteLength)throw new A("The byte length of the array buffer is invalid for the compressed texture with the given width and height.")}const u=e.preMultiplyAlpha||s===Le.RGB||s===Le.LUMINANCE,h=T(e.flipY,!0),d=T(e.skipColorSpaceConversion,!1);let p=!0;const g=t._gl,_=g.TEXTURE_2D,b=g.createTexture();g.activeTexture(g.TEXTURE0),g.bindTexture(_,b);let x=4;if(l(r)&&l(r.arrayBufferView)&&!c&&(x=Le.alignmentInBytes(s,o,n)),g.pixelStorei(g.UNPACK_ALIGNMENT,x),d?g.pixelStorei(g.UNPACK_COLORSPACE_CONVERSION_WEBGL,g.NONE):g.pixelStorei(g.UNPACK_COLORSPACE_CONVERSION_WEBGL,g.BROWSER_DEFAULT_WEBGL),l(r))if(l(r.arrayBufferView)){g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!1);let C=r.arrayBufferView,w,S,v;if(c){if(g.compressedTexImage2D(_,0,a,n,i,0,C),l(r.mipLevels))for(S=n,v=i,w=0;w<r.mipLevels.length;++w)S=Math.floor(S/2)|0,S<1&&(S=1),v=Math.floor(v/2)|0,v<1&&(v=1),g.compressedTexImage2D(_,w+1,a,S,v,0,r.mipLevels[w])}else if(h&&(C=Le.flipY(C,s,o,n,i)),g.texImage2D(_,0,a,n,i,0,s,De.toWebGLConstant(o,t),C),l(r.mipLevels))for(S=n,v=i,w=0;w<r.mipLevels.length;++w)S=Math.floor(S/2)|0,S<1&&(S=1),v=Math.floor(v/2)|0,v<1&&(v=1),g.texImage2D(_,w+1,a,S,v,0,s,De.toWebGLConstant(o,t),r.mipLevels[w])}else l(r.framebuffer)?(g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!1),r.framebuffer!==t.defaultFramebuffer&&r.framebuffer._bind(),g.copyTexImage2D(_,0,a,r.xOffset,r.yOffset,n,i,0),r.framebuffer!==t.defaultFramebuffer&&r.framebuffer._unBind()):(g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,u),g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,h),g.texImage2D(_,0,a,s,De.toWebGLConstant(o,t),r));else g.texImage2D(_,0,a,n,i,0,s,De.toWebGLConstant(o,t),null),p=!1;g.bindTexture(_,null);let E;c?E=Le.compressedTextureSizeInBytes(s,n,i):E=Le.textureSizeInBytes(s,o,n,i),this._id=dc(),this._context=t,this._textureFilterAnisotropic=t._textureFilterAnisotropic,this._textureTarget=_,this._texture=b,this._internalFormat=a,this._pixelFormat=s,this._pixelDatatype=o,this._width=n,this._height=i,this._dimensions=new k(n,i),this._hasMipmap=!1,this._sizeInBytes=E,this._preMultiplyAlpha=u,this._flipY=h,this._initialized=p,this._sampler=void 0,this.sampler=l(e.sampler)?e.sampler:new Cn}kt.create=function(e){return new kt(e)};kt.fromFramebuffer=function(e){e=T(e,T.EMPTY_OBJECT),y.defined("options.context",e.context);const t=e.context,n=t._gl,i=T(e.pixelFormat,Le.RGB),r=T(e.framebufferXOffset,0),s=T(e.framebufferYOffset,0),o=T(e.width,n.drawingBufferWidth),a=T(e.height,n.drawingBufferHeight),c=e.framebuffer;if(!Le.validate(i))throw new A("Invalid pixelFormat.");if(Le.isDepthFormat(i)||Le.isCompressedFormat(i))throw new A("pixelFormat cannot be DEPTH_COMPONENT, DEPTH_STENCIL or a compressed format.");if(y.defined("options.context",e.context),y.typeOf.number.greaterThanOrEquals("framebufferXOffset",r,0),y.typeOf.number.greaterThanOrEquals("framebufferYOffset",s,0),r+o>n.drawingBufferWidth)throw new A("framebufferXOffset + width must be less than or equal to drawingBufferWidth");if(s+a>n.drawingBufferHeight)throw new A("framebufferYOffset + height must be less than or equal to drawingBufferHeight.");return new kt({context:t,width:o,height:a,pixelFormat:i,source:{framebuffer:l(c)?c:t.defaultFramebuffer,xOffset:r,yOffset:s,width:o,height:a}})};Object.defineProperties(kt.prototype,{id:{get:function(){return this._id}},sampler:{get:function(){return this._sampler},set:function(e){let t=e.minificationFilter,n=e.magnificationFilter;const i=this._context,r=this._pixelFormat,s=this._pixelDatatype,o=t===Ut.NEAREST_MIPMAP_NEAREST||t===Ut.NEAREST_MIPMAP_LINEAR||t===Ut.LINEAR_MIPMAP_NEAREST||t===Ut.LINEAR_MIPMAP_LINEAR;(s===De.FLOAT&&!i.textureFloatLinear||s===De.HALF_FLOAT&&!i.textureHalfFloatLinear)&&(t=o?Ut.NEAREST_MIPMAP_NEAREST:Ut.NEAREST,n=ws.NEAREST),i.webgl2&&Le.isDepthFormat(r)&&(t=Ut.NEAREST,n=ws.NEAREST);const a=i._gl,c=this._textureTarget;a.activeTexture(a.TEXTURE0),a.bindTexture(c,this._texture),a.texParameteri(c,a.TEXTURE_MIN_FILTER,t),a.texParameteri(c,a.TEXTURE_MAG_FILTER,n),a.texParameteri(c,a.TEXTURE_WRAP_S,e.wrapS),a.texParameteri(c,a.TEXTURE_WRAP_T,e.wrapT),l(this._textureFilterAnisotropic)&&a.texParameteri(c,this._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.maximumAnisotropy),a.bindTexture(c,null),this._sampler=e}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},dimensions:{get:function(){return this._dimensions}},preMultiplyAlpha:{get:function(){return this._preMultiplyAlpha}},flipY:{get:function(){return this._flipY}},width:{get:function(){return this._width}},height:{get:function(){return this._height}},sizeInBytes:{get:function(){return this._hasMipmap?Math.floor(this._sizeInBytes*4/3):this._sizeInBytes}},_target:{get:function(){return this._textureTarget}}});kt.prototype.copyFrom=function(e){y.defined("options",e);const t=T(e.xOffset,0),n=T(e.yOffset,0);if(y.defined("options.source",e.source),Le.isDepthFormat(this._pixelFormat))throw new A("Cannot call copyFrom when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(Le.isCompressedFormat(this._pixelFormat))throw new A("Cannot call copyFrom with a compressed texture pixel format.");y.typeOf.number.greaterThanOrEquals("xOffset",t,0),y.typeOf.number.greaterThanOrEquals("yOffset",n,0),y.typeOf.number.lessThanOrEquals("xOffset + options.source.width",t+e.source.width,this._width),y.typeOf.number.lessThanOrEquals("yOffset + options.source.height",n+e.source.height,this._height);const i=e.source,r=this._context,s=r._gl,o=this._textureTarget;s.activeTexture(s.TEXTURE0),s.bindTexture(o,this._texture);const a=i.width,c=i.height;let u=i.arrayBufferView;const h=this._width,d=this._height,p=this._internalFormat,g=this._pixelFormat,_=this._pixelDatatype,b=this._preMultiplyAlpha,x=this._flipY,E=T(e.skipColorSpaceConversion,!1);let C=4;l(u)&&(C=Le.alignmentInBytes(g,_,a)),s.pixelStorei(s.UNPACK_ALIGNMENT,C),E?s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.NONE):s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.BROWSER_DEFAULT_WEBGL);let w=!1;if(!this._initialized){if(t===0&&n===0&&a===h&&c===d)l(u)?(s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),x&&(u=Le.flipY(u,g,_,h,d)),s.texImage2D(o,0,p,h,d,0,g,De.toWebGLConstant(_,r),u)):(s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,x),s.texImage2D(o,0,p,g,De.toWebGLConstant(_,r),i)),w=!0;else{s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1);const S=Le.createTypedArray(g,_,h,d);s.texImage2D(o,0,p,h,d,0,g,De.toWebGLConstant(_,r),S)}this._initialized=!0}w||(l(u)?(s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),x&&(u=Le.flipY(u,g,_,a,c)),s.texSubImage2D(o,0,t,n,a,c,g,De.toWebGLConstant(_,r),u)):(s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,x),s.texSubImage2D(o,0,t,n,g,De.toWebGLConstant(_,r),i))),s.bindTexture(o,null)};kt.prototype.copyFromFramebuffer=function(e,t,n,i,r,s){if(e=T(e,0),t=T(t,0),n=T(n,0),i=T(i,0),r=T(r,this._width),s=T(s,this._height),Le.isDepthFormat(this._pixelFormat))throw new A("Cannot call copyFromFramebuffer when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(this._pixelDatatype===De.FLOAT)throw new A("Cannot call copyFromFramebuffer when the texture pixel data type is FLOAT.");if(this._pixelDatatype===De.HALF_FLOAT)throw new A("Cannot call copyFromFramebuffer when the texture pixel data type is HALF_FLOAT.");if(Le.isCompressedFormat(this._pixelFormat))throw new A("Cannot call copyFrom with a compressed texture pixel format.");y.typeOf.number.greaterThanOrEquals("xOffset",e,0),y.typeOf.number.greaterThanOrEquals("yOffset",t,0),y.typeOf.number.greaterThanOrEquals("framebufferXOffset",n,0),y.typeOf.number.greaterThanOrEquals("framebufferYOffset",i,0),y.typeOf.number.lessThanOrEquals("xOffset + width",e+r,this._width),y.typeOf.number.lessThanOrEquals("yOffset + height",t+s,this._height);const o=this._context._gl,a=this._textureTarget;o.activeTexture(o.TEXTURE0),o.bindTexture(a,this._texture),o.copyTexSubImage2D(a,0,e,t,n,i,r,s),o.bindTexture(a,null),this._initialized=!0};kt.prototype.generateMipmap=function(e){if(e=T(e,dh.DONT_CARE),Le.isDepthFormat(this._pixelFormat))throw new A("Cannot call generateMipmap when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(Le.isCompressedFormat(this._pixelFormat))throw new A("Cannot call generateMipmap with a compressed pixel format.");if(!this._context.webgl2){if(this._width>1&&!R.isPowerOfTwo(this._width))throw new A("width must be a power of two to call generateMipmap() in a WebGL1 context.");if(this._height>1&&!R.isPowerOfTwo(this._height))throw new A("height must be a power of two to call generateMipmap() in a WebGL1 context.")}if(!dh.validate(e))throw new A("hint is invalid.");this._hasMipmap=!0;const t=this._context._gl,n=this._textureTarget;t.hint(t.GENERATE_MIPMAP_HINT,e),t.activeTexture(t.TEXTURE0),t.bindTexture(n,this._texture),t.generateMipmap(n),t.bindTexture(n,null)};kt.prototype.isDestroyed=function(){return!1};kt.prototype.destroy=function(){return this._context._gl.deleteTexture(this._texture),Ye(this)};const o_={MORPHING:0,COLUMBUS_VIEW:1,SCENE2D:2,SCENE3D:3};o_.getMorphTime=function(e){return e===o_.SCENE3D?1:e===o_.MORPHING?void 0:0};const Ie=Object.freeze(o_);function tQ(e,t,n,i){const r=l(t.vertexBuffer),s=l(t.value),o=t.value?t.value.length:t.componentsPerAttribute;if(!r&&!s)throw new A("attribute must have a vertexBuffer or a value.");if(r&&s)throw new A("attribute cannot have both a vertexBuffer and a value.  It must have either a vertexBuffer property defining per-vertex data or a value property defining data for all vertices.");if(o!==1&&o!==2&&o!==3&&o!==4)throw s?new A("attribute.value.length must be in the range [1, 4]."):new A("attribute.componentsPerAttribute must be in the range [1, 4].");if(l(t.componentDatatype)&&!q.validate(t.componentDatatype))throw new A("attribute must have a valid componentDatatype or not specify it.");if(l(t.strideInBytes)&&t.strideInBytes>255)throw new A("attribute must have a strideInBytes less than or equal to 255 or not specify it.");if(l(t.instanceDivisor)&&t.instanceDivisor>0&&!i.instancedArrays)throw new A("instanced arrays is not supported");if(l(t.instanceDivisor)&&t.instanceDivisor<0)throw new A("attribute must have an instanceDivisor greater than or equal to zero");if(l(t.instanceDivisor)&&s)throw new A("attribute cannot have have an instanceDivisor if it is not backed by a buffer");if(l(t.instanceDivisor)&&t.instanceDivisor>0&&t.index===0)throw new A("attribute zero cannot have an instanceDivisor greater than 0");const a={index:T(t.index,n),enabled:T(t.enabled,!0),vertexBuffer:t.vertexBuffer,value:s?t.value.slice(0):void 0,componentsPerAttribute:o,componentDatatype:T(t.componentDatatype,q.FLOAT),normalize:T(t.normalize,!1),offsetInBytes:T(t.offsetInBytes,0),strideInBytes:T(t.strideInBytes,0),instanceDivisor:T(t.instanceDivisor,0)};if(r)a.vertexAttrib=function(c){const u=this.index;c.bindBuffer(c.ARRAY_BUFFER,this.vertexBuffer._getBuffer()),c.vertexAttribPointer(u,this.componentsPerAttribute,this.componentDatatype,this.normalize,this.strideInBytes,this.offsetInBytes),c.enableVertexAttribArray(u),this.instanceDivisor>0&&(i.glVertexAttribDivisor(u,this.instanceDivisor),i._vertexAttribDivisors[u]=this.instanceDivisor,i._previousDrawInstanced=!0)},a.disableVertexAttribArray=function(c){c.disableVertexAttribArray(this.index),this.instanceDivisor>0&&i.glVertexAttribDivisor(n,0)};else{switch(a.componentsPerAttribute){case 1:a.vertexAttrib=function(c){c.vertexAttrib1fv(this.index,this.value)};break;case 2:a.vertexAttrib=function(c){c.vertexAttrib2fv(this.index,this.value)};break;case 3:a.vertexAttrib=function(c){c.vertexAttrib3fv(this.index,this.value)};break;case 4:a.vertexAttrib=function(c){c.vertexAttrib4fv(this.index,this.value)};break}a.disableVertexAttribArray=function(c){}}e.push(a)}function BP(e,t,n){for(let i=0;i<t.length;++i){const r=t[i];r.enabled&&r.vertexAttrib(e)}l(n)&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n._getBuffer())}function $i(e){e=T(e,T.EMPTY_OBJECT),y.defined("options.context",e.context),y.defined("options.attributes",e.attributes);const t=e.context,n=t._gl,i=e.attributes,r=e.indexBuffer;let s;const o=[];let a=1,c=!1,u=!1,h=i.length;for(s=0;s<h;++s)tQ(o,i[s],s,t);for(h=o.length,s=0;s<h;++s){const g=o[s];if(l(g.vertexBuffer)&&g.instanceDivisor===0){const _=g.strideInBytes||g.componentsPerAttribute*q.getSizeInBytes(g.componentDatatype);a=g.vertexBuffer.sizeInBytes/_;break}}for(s=0;s<h;++s)o[s].instanceDivisor>0&&(c=!0),l(o[s].value)&&(u=!0);const d={};for(s=0;s<h;++s){const g=o[s].index;if(d[g])throw new A(`Index ${g} is used by more than one attribute.`);d[g]=!0}let p;t.vertexArrayObject&&(p=t.glCreateVertexArray(),t.glBindVertexArray(p),BP(n,o,r),t.glBindVertexArray(null)),this._numberOfVertices=a,this._hasInstancedAttributes=c,this._hasConstantAttributes=u,this._context=t,this._gl=n,this._vao=p,this._attributes=o,this._indexBuffer=r}function HI(e){return e.values.length/e.componentsPerAttribute}function nQ(e){return q.getSizeInBytes(e.componentDatatype)*e.componentsPerAttribute}function iQ(e){let t,n,i;const r=[];for(n in e)e.hasOwnProperty(n)&&l(e[n])&&l(e[n].values)&&(r.push(n),e[n].componentDatatype===q.DOUBLE&&(e[n].componentDatatype=q.FLOAT,e[n].values=q.createTypedArray(q.FLOAT,e[n].values)));let s;const o=r.length;if(o>0)for(s=HI(e[r[0]]),t=1;t<o;++t){const u=HI(e[r[t]]);if(u!==s)throw new te(`Each attribute list must have the same number of vertices.  Attribute ${r[t]} has a different number of vertices (${u.toString()}) than attribute ${r[0]} (${s.toString()}).`)}r.sort(function(u,h){return q.getSizeInBytes(e[h].componentDatatype)-q.getSizeInBytes(e[u].componentDatatype)});let a=0;const c={};for(t=0;t<o;++t)n=r[t],i=e[n],c[n]=a,a+=nQ(i);if(a>0){const u=q.getSizeInBytes(e[r[0]].componentDatatype),h=a%u;h!==0&&(a+=u-h);const d=s*a,p=new ArrayBuffer(d),g={};for(t=0;t<o;++t){n=r[t];const _=q.getSizeInBytes(e[n].componentDatatype);g[n]={pointer:q.createTypedArray(e[n].componentDatatype,p),index:c[n]/_,strideInComponentType:a/_}}for(t=0;t<s;++t)for(let _=0;_<o;++_){n=r[_],i=e[n];const b=i.values,x=g[n],E=x.pointer,C=i.componentsPerAttribute;for(let w=0;w<C;++w)E[x.index+w]=b[t*C+w];x.index+=x.strideInComponentType}return{buffer:p,offsetsInBytes:c,vertexSizeInBytes:a}}}$i.fromGeometry=function(e){e=T(e,T.EMPTY_OBJECT),y.defined("options.context",e.context);const t=e.context,n=T(e.geometry,T.EMPTY_OBJECT),i=T(e.bufferUsage,Ae.DYNAMIC_DRAW),r=T(e.attributeLocations,T.EMPTY_OBJECT),s=T(e.interleave,!1),o=e.vertexArrayAttributes;let a,c,u;const h=l(o)?o:[],d=n.attributes;if(s){const _=iQ(d);if(l(_)){u=ze.createVertexBuffer({context:t,typedArray:_.buffer,usage:i});const b=_.offsetsInBytes,x=_.vertexSizeInBytes;for(a in d)d.hasOwnProperty(a)&&l(d[a])&&(c=d[a],l(c.values)?h.push({index:r[a],vertexBuffer:u,componentDatatype:c.componentDatatype,componentsPerAttribute:c.componentsPerAttribute,normalize:c.normalize,offsetInBytes:b[a],strideInBytes:x}):h.push({index:r[a],value:c.value,componentDatatype:c.componentDatatype,normalize:c.normalize}))}}else for(a in d)if(d.hasOwnProperty(a)&&l(d[a])){c=d[a];let _=c.componentDatatype;_===q.DOUBLE&&(_=q.FLOAT),u=void 0,l(c.values)&&(u=ze.createVertexBuffer({context:t,typedArray:q.createTypedArray(_,c.values),usage:i})),h.push({index:r[a],vertexBuffer:u,value:c.value,componentDatatype:_,componentsPerAttribute:c.componentsPerAttribute,normalize:c.normalize})}let p;const g=n.indices;return l(g)&&(Ht.computeNumberOfVertices(n)>=R.SIXTY_FOUR_KILOBYTES&&t.elementIndexUint?p=ze.createIndexBuffer({context:t,typedArray:new Uint32Array(g),usage:i,indexDatatype:Ge.UNSIGNED_INT}):p=ze.createIndexBuffer({context:t,typedArray:new Uint16Array(g),usage:i,indexDatatype:Ge.UNSIGNED_SHORT})),new $i({context:t,attributes:h,indexBuffer:p})};Object.defineProperties($i.prototype,{numberOfAttributes:{get:function(){return this._attributes.length}},numberOfVertices:{get:function(){return this._numberOfVertices}},indexBuffer:{get:function(){return this._indexBuffer}}});$i.prototype.getAttribute=function(e){return y.defined("index",e),this._attributes[e]};function rQ(e){const t=e._context,n=e._hasInstancedAttributes;if(!n&&!t._previousDrawInstanced)return;t._previousDrawInstanced=n;const i=t._vertexAttribDivisors,r=e._attributes,s=We.maximumVertexAttributes;let o;if(n){const a=r.length;for(o=0;o<a;++o){const c=r[o];if(c.enabled){const u=c.instanceDivisor,h=c.index;u!==i[h]&&(t.glVertexAttribDivisor(h,u),i[h]=u)}}}else for(o=0;o<s;++o)i[o]>0&&(t.glVertexAttribDivisor(o,0),i[o]=0)}function sQ(e,t){const n=e._attributes,i=n.length;for(let r=0;r<i;++r){const s=n[r];s.enabled&&l(s.value)&&s.vertexAttrib(t)}}$i.prototype._bind=function(){l(this._vao)?(this._context.glBindVertexArray(this._vao),this._context.instancedArrays&&rQ(this),this._hasConstantAttributes&&sQ(this,this._gl)):BP(this._gl,this._attributes,this._indexBuffer)};$i.prototype._unBind=function(){if(l(this._vao))this._context.glBindVertexArray(null);else{const e=this._attributes,t=this._gl;for(let n=0;n<e.length;++n){const i=e[n];i.enabled&&i.disableVertexAttribArray(t)}this._indexBuffer&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}};$i.prototype.isDestroyed=function(){return!1};$i.prototype.destroy=function(){const e=this._attributes;for(let n=0;n<e.length;++n){const i=e[n].vertexBuffer;l(i)&&!i.isDestroyed()&&i.vertexArrayDestroyable&&i.destroy()}const t=this._indexBuffer;return l(t)&&!t.isDestroyed()&&t.vertexArrayDestroyable&&t.destroy(),l(this._vao)&&this._context.glDeleteVertexArray(this._vao),Ye(this)};function Mh(e){e=T(e,T.EMPTY_OBJECT);const t=e.context,n=e.width,i=e.height;y.defined("options.context",t),y.defined("options.width",n),y.defined("options.height",i),this._width=n,this._height=i;const r=e.colorRenderbuffers,s=e.colorTextures;if(l(r)!==l(s))throw new A("Both color renderbuffer and texture attachments must be provided.");const o=e.depthStencilRenderbuffer,a=e.depthStencilTexture;if(l(o)!==l(a))throw new A("Both depth-stencil renderbuffer and texture attachments must be provided.");this._renderFramebuffer=new as({context:t,colorRenderbuffers:r,depthStencilRenderbuffer:o,destroyAttachments:e.destroyAttachments}),this._colorFramebuffer=new as({context:t,colorTextures:s,depthStencilTexture:a,destroyAttachments:e.destroyAttachments})}Mh.prototype.getRenderFramebuffer=function(){return this._renderFramebuffer};Mh.prototype.getColorFramebuffer=function(){return this._colorFramebuffer};Mh.prototype.blitFramebuffers=function(e,t){this._renderFramebuffer.bindRead(),this._colorFramebuffer.bindDraw();const n=e._gl;let i=0;this._colorFramebuffer._colorTextures.length>0&&(i|=n.COLOR_BUFFER_BIT),l(this._colorFramebuffer.depthStencilTexture)&&(i|=n.DEPTH_BUFFER_BIT|(t?n.STENCIL_BUFFER_BIT:0)),n.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,i,n.NEAREST),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null)};Mh.prototype.isDestroyed=function(){return!1};Mh.prototype.destroy=function(){return this._renderFramebuffer.destroy(),this._colorFramebuffer.destroy(),Ye(this)};const Yr={RGBA4:j.RGBA4,RGBA8:j.RGBA8,RGBA16F:j.RGBA16F,RGBA32F:j.RGBA32F,RGB5_A1:j.RGB5_A1,RGB565:j.RGB565,DEPTH_COMPONENT16:j.DEPTH_COMPONENT16,STENCIL_INDEX8:j.STENCIL_INDEX8,DEPTH_STENCIL:j.DEPTH_STENCIL,DEPTH24_STENCIL8:j.DEPTH24_STENCIL8,validate:function(e){return e===Yr.RGBA4||e===Yr.RGBA8||e===Yr.RGBA16F||e===Yr.RGBA32F||e===Yr.RGB5_A1||e===Yr.RGB565||e===Yr.DEPTH_COMPONENT16||e===Yr.STENCIL_INDEX8||e===Yr.DEPTH_STENCIL||e===Yr.DEPTH24_STENCIL8},getColorFormat:function(e){return e===j.FLOAT?Yr.RGBA32F:e===j.HALF_FLOAT_OES?Yr.RGBA16F:Yr.RGBA8}},Rf=Object.freeze(Yr);function Qc(e){e=T(e,T.EMPTY_OBJECT),y.defined("options.context",e.context);const n=e.context._gl,i=We.maximumRenderbufferSize,r=T(e.format,Rf.RGBA4),s=l(e.width)?e.width:n.drawingBufferWidth,o=l(e.height)?e.height:n.drawingBufferHeight,a=T(e.numSamples,1);if(!Rf.validate(r))throw new A("Invalid format.");if(y.typeOf.number.greaterThan("width",s,0),s>i)throw new A(`Width must be less than or equal to the maximum renderbuffer size (${i}).  Check maximumRenderbufferSize.`);if(y.typeOf.number.greaterThan("height",o,0),o>i)throw new A(`Height must be less than or equal to the maximum renderbuffer size (${i}).  Check maximumRenderbufferSize.`);this._gl=n,this._format=r,this._width=s,this._height=o,this._renderbuffer=this._gl.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,this._renderbuffer),a>1?n.renderbufferStorageMultisample(n.RENDERBUFFER,a,r,s,o):n.renderbufferStorage(n.RENDERBUFFER,r,s,o),n.bindRenderbuffer(n.RENDERBUFFER,null)}Object.defineProperties(Qc.prototype,{format:{get:function(){return this._format}},width:{get:function(){return this._width}},height:{get:function(){return this._height}}});Qc.prototype._getRenderbuffer=function(){return this._renderbuffer};Qc.prototype.isDestroyed=function(){return!1};Qc.prototype.destroy=function(){return this._gl.deleteRenderbuffer(this._renderbuffer),Ye(this)};function wi(e){if(e=T(e,T.EMPTY_OBJECT),this._numSamples=T(e.numSamples,1),this._colorAttachmentsLength=T(e.colorAttachmentsLength,1),this._color=T(e.color,!0),this._depth=T(e.depth,!1),this._depthStencil=T(e.depthStencil,!1),this._supportsDepthTexture=T(e.supportsDepthTexture,!1),!this._color&&!this._depth&&!this._depthStencil)throw new A("Must enable at least one type of framebuffer attachment.");if(this._depth&&this._depthStencil)throw new A("Cannot have both a depth and depth-stencil attachment.");this._createColorAttachments=T(e.createColorAttachments,!0),this._createDepthAttachments=T(e.createDepthAttachments,!0),this._pixelDatatype=e.pixelDatatype,this._pixelFormat=e.pixelFormat,this._width=void 0,this._height=void 0,this._framebuffer=void 0,this._multisampleFramebuffer=void 0,this._colorTextures=void 0,this._color&&(this._colorTextures=new Array(this._colorAttachmentsLength),this._colorRenderbuffers=new Array(this._colorAttachmentsLength)),this._colorRenderbuffer=void 0,this._depthStencilRenderbuffer=void 0,this._depthStencilTexture=void 0,this._depthRenderbuffer=void 0,this._depthTexture=void 0,this._attachmentsDirty=!1}Object.defineProperties(wi.prototype,{framebuffer:{get:function(){return this._numSamples>1?this._multisampleFramebuffer.getRenderFramebuffer():this._framebuffer}},numSamples:{get:function(){return this._numSamples}},status:{get:function(){return this.framebuffer.status}}});wi.prototype.isDirty=function(e,t,n,i,r){n=T(n,1);const s=this._width!==e||this._height!==t,o=this._numSamples!==n,a=l(i)&&this._pixelDatatype!==i||l(r)&&this._pixelFormat!==r,c=l(n===1?this._framebuffer:this._multisampleFramebuffer);return this._attachmentsDirty||s||o||a||!c||this._color&&!l(this._colorTextures[0])};wi.prototype.update=function(e,t,n,i,r,s){if(!l(t)||!l(n))throw new A("width and height must be defined.");if(i=e.msaa?T(i,1):1,r=T(r,this._color?T(this._pixelDatatype,De.UNSIGNED_BYTE):void 0),s=T(s,this._color?T(this._pixelFormat,Le.RGBA):void 0),this.isDirty(t,n,i,r,s)){if(this.destroy(),this._width=t,this._height=n,this._numSamples=i,this._pixelDatatype=r,this._pixelFormat=s,this._attachmentsDirty=!1,this._color&&this._createColorAttachments){for(let o=0;o<this._colorAttachmentsLength;++o)if(this._colorTextures[o]=new kt({context:e,width:t,height:n,pixelFormat:s,pixelDatatype:r,sampler:Cn.NEAREST}),this._numSamples>1){const a=Rf.getColorFormat(r);this._colorRenderbuffers[o]=new Qc({context:e,width:t,height:n,format:a,numSamples:this._numSamples})}}this._depthStencil&&this._createDepthAttachments&&(this._supportsDepthTexture&&e.depthTexture?(this._depthStencilTexture=new kt({context:e,width:t,height:n,pixelFormat:Le.DEPTH_STENCIL,pixelDatatype:De.UNSIGNED_INT_24_8,sampler:Cn.NEAREST}),this._numSamples>1&&(this._depthStencilRenderbuffer=new Qc({context:e,width:t,height:n,format:Rf.DEPTH24_STENCIL8,numSamples:this._numSamples}))):this._depthStencilRenderbuffer=new Qc({context:e,width:t,height:n,format:Rf.DEPTH_STENCIL})),this._depth&&this._createDepthAttachments&&(this._supportsDepthTexture&&e.depthTexture?this._depthTexture=new kt({context:e,width:t,height:n,pixelFormat:Le.DEPTH_COMPONENT,pixelDatatype:De.UNSIGNED_INT,sampler:Cn.NEAREST}):this._depthRenderbuffer=new Qc({context:e,width:t,height:n,format:Rf.DEPTH_COMPONENT16})),this._numSamples>1?this._multisampleFramebuffer=new Mh({context:e,width:this._width,height:this._height,colorTextures:this._colorTextures,colorRenderbuffers:this._colorRenderbuffers,depthStencilTexture:this._depthStencilTexture,depthStencilRenderbuffer:this._depthStencilRenderbuffer,destroyAttachments:!1}):this._framebuffer=new as({context:e,colorTextures:this._colorTextures,depthTexture:this._depthTexture,depthRenderbuffer:this._depthRenderbuffer,depthStencilTexture:this._depthStencilTexture,depthStencilRenderbuffer:this._depthStencilRenderbuffer,destroyAttachments:!1})}};wi.prototype.getColorTexture=function(e){if(e=T(e,0),e>=this._colorAttachmentsLength)throw new A("index must be smaller than total number of color attachments.");return this._colorTextures[e]};wi.prototype.setColorTexture=function(e,t){if(t=T(t,0),this._createColorAttachments)throw new A("createColorAttachments must be false if setColorTexture is called.");if(t>=this._colorAttachmentsLength)throw new A("index must be smaller than total number of color attachments.");this._attachmentsDirty=e!==this._colorTextures[t],this._colorTextures[t]=e};wi.prototype.getColorRenderbuffer=function(e){if(e=T(e,0),e>=this._colorAttachmentsLength)throw new A("index must be smaller than total number of color attachments.");return this._colorRenderbuffers[e]};wi.prototype.setColorRenderbuffer=function(e,t){if(t=T(t,0),this._createColorAttachments)throw new A("createColorAttachments must be false if setColorRenderbuffer is called.");if(t>=this._colorAttachmentsLength)throw new A("index must be smaller than total number of color attachments.");this._attachmentsDirty=e!==this._colorRenderbuffers[t],this._colorRenderbuffers[t]=e};wi.prototype.getDepthRenderbuffer=function(){return this._depthRenderbuffer};wi.prototype.setDepthRenderbuffer=function(e){if(this._createDepthAttachments)throw new A("createDepthAttachments must be false if setDepthRenderbuffer is called.");this._attachmentsDirty=e!==this._depthRenderbuffer,this._depthRenderbuffer=e};wi.prototype.getDepthTexture=function(){return this._depthTexture};wi.prototype.setDepthTexture=function(e){if(this._createDepthAttachments)throw new A("createDepthAttachments must be false if setDepthTexture is called.");this._attachmentsDirty=e!==this._depthTexture,this._depthTexture=e};wi.prototype.getDepthStencilRenderbuffer=function(){return this._depthStencilRenderbuffer};wi.prototype.setDepthStencilRenderbuffer=function(e){if(this._createDepthAttachments)throw new A("createDepthAttachments must be false if setDepthStencilRenderbuffer is called.");this._attachmentsDirty=e!==this._depthStencilRenderbuffer,this._depthStencilRenderbuffer=e};wi.prototype.getDepthStencilTexture=function(){return this._depthStencilTexture};wi.prototype.setDepthStencilTexture=function(e){if(this._createDepthAttachments)throw new A("createDepthAttachments must be false if setDepthStencilTexture is called.");this._attachmentsDirty=e!==this._depthStencilTexture,this._depthStencilTexture=e};wi.prototype.prepareTextures=function(e,t){this._numSamples>1&&this._multisampleFramebuffer.blitFramebuffers(e,t)};wi.prototype.clear=function(e,t,n){const i=t.framebuffer;t.framebuffer=this.framebuffer,t.execute(e,n),t.framebuffer=i};wi.prototype.destroyFramebuffer=function(){this._framebuffer=this._framebuffer&&this._framebuffer.destroy(),this._multisampleFramebuffer=this._multisampleFramebuffer&&this._multisampleFramebuffer.destroy()};wi.prototype.destroy=function(){if(this._color){let e;const t=this._colorTextures.length;for(e=0;e<t;++e){const n=this._colorTextures[e];this._createColorAttachments&&l(n)&&!n.isDestroyed()&&(this._colorTextures[e].destroy(),this._colorTextures[e]=void 0),l(n)&&n.isDestroyed()&&(this._colorTextures[e]=void 0);const i=this._colorRenderbuffers[e];this._createColorAttachments&&l(i)&&!i.isDestroyed()&&(this._colorRenderbuffers[e].destroy(),this._colorRenderbuffers[e]=void 0),l(i)&&i.isDestroyed()&&(this._colorRenderbuffers[e]=void 0)}}this._depthStencil&&(this._createDepthAttachments&&(this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy()),l(this._depthStencilTexture)&&this._depthStencilTexture.isDestroyed()&&(this._depthStencilTexture=void 0),l(this._depthStencilRenderbuffer)&&this._depthStencilRenderbuffer.isDestroyed()&&(this._depthStencilRenderbuffer=void 0)),this._depth&&(this._createDepthAttachments&&(this._depthTexture=this._depthTexture&&this._depthTexture.destroy(),this._depthRenderbuffer=this._depthRenderbuffer&&this._depthRenderbuffer.destroy()),l(this._depthTexture)&&this._depthTexture.isDestroyed()&&(this._depthTexture=void 0),l(this._depthRenderbuffer)&&this._depthRenderbuffer.isDestroyed()&&(this._depthRenderbuffer=void 0)),this.destroyFramebuffer()};const mu={VERTEX:0,FRAGMENT:1,BOTH:2};mu.includesVertexShader=function(e){return y.typeOf.number("destination",e),e===mu.VERTEX||e===mu.BOTH};mu.includesFragmentShader=function(e){return y.typeOf.number("destination",e),e===mu.FRAGMENT||e===mu.BOTH};const Q=Object.freeze(mu);function sw(e){this.name=e,this.fields=[]}sw.prototype.addField=function(e,t){const n=`    ${e} ${t};`;this.fields.push(n)};sw.prototype.generateGlslLines=function(){let e=this.fields;return e.length===0&&(e=["    float _empty;"]),[].concat(`struct ${this.name}`,"{",e,"};")};function ow(e){this.signature=e,this.body=[]}ow.prototype.addLines=function(e){if(typeof e!="string"&&!Array.isArray(e))throw new A(`Expected lines to be a string or an array of strings, actual value was ${e}`);const t=this.body;if(Array.isArray(e)){const n=e.length;for(let i=0;i<n;i++)t.push(`    ${e[i]}`)}else t.push(`    ${e}`)};ow.prototype.generateGlslLines=function(){return[].concat(this.signature,"{",this.body,"}")};function Gr(){this._positionAttributeLine=void 0,this._nextAttributeLocation=1,this._attributeLocations={},this._attributeLines=[],this._structs={},this._functions={},this._vertexShaderParts={defineLines:[],uniformLines:[],shaderLines:[],varyingLines:[],structIds:[],functionIds:[]},this._fragmentShaderParts={defineLines:[],uniformLines:[],shaderLines:[],varyingLines:[],structIds:[],functionIds:[]}}Object.defineProperties(Gr.prototype,{attributeLocations:{get:function(){return this._attributeLocations}}});Gr.prototype.addDefine=function(e,t,n){y.typeOf.string("identifier",e),n=T(n,Q.BOTH);let i=e;l(t)&&(i+=` ${t.toString()}`),Q.includesVertexShader(n)&&this._vertexShaderParts.defineLines.push(i),Q.includesFragmentShader(n)&&this._fragmentShaderParts.defineLines.push(i)};Gr.prototype.addStruct=function(e,t,n){y.typeOf.string("structId",e),y.typeOf.string("structName",t),y.typeOf.number("destination",n),this._structs[e]=new sw(t),Q.includesVertexShader(n)&&this._vertexShaderParts.structIds.push(e),Q.includesFragmentShader(n)&&this._fragmentShaderParts.structIds.push(e)};Gr.prototype.addStructField=function(e,t,n){y.typeOf.string("structId",e),y.typeOf.string("type",t),y.typeOf.string("identifier",n),this._structs[e].addField(t,n)};Gr.prototype.addFunction=function(e,t,n){y.typeOf.string("functionName",e),y.typeOf.string("signature",t),y.typeOf.number("destination",n),this._functions[e]=new ow(t),Q.includesVertexShader(n)&&this._vertexShaderParts.functionIds.push(e),Q.includesFragmentShader(n)&&this._fragmentShaderParts.functionIds.push(e)};Gr.prototype.addFunctionLines=function(e,t){if(y.typeOf.string("functionName",e),typeof t!="string"&&!Array.isArray(t))throw new A(`Expected lines to be a string or an array of strings, actual value was ${t}`);this._functions[e].addLines(t)};Gr.prototype.addUniform=function(e,t,n){y.typeOf.string("type",e),y.typeOf.string("identifier",t),n=T(n,Q.BOTH);const i=`uniform ${e} ${t};`;Q.includesVertexShader(n)&&this._vertexShaderParts.uniformLines.push(i),Q.includesFragmentShader(n)&&this._fragmentShaderParts.uniformLines.push(i)};Gr.prototype.setPositionAttribute=function(e,t){if(y.typeOf.string("type",e),y.typeOf.string("identifier",t),l(this._positionAttributeLine))throw new A("setPositionAttribute() must be called exactly once for the attribute used for gl_Position. For other attributes, use addAttribute()");return this._positionAttributeLine=`in ${e} ${t};`,this._attributeLocations[t]=0,0};Gr.prototype.addAttribute=function(e,t){y.typeOf.string("type",e),y.typeOf.string("identifier",t);const n=`in ${e} ${t};`;this._attributeLines.push(n);const i=this._nextAttributeLocation;return this._attributeLocations[t]=i,this._nextAttributeLocation+=aQ(e),i};Gr.prototype.addVarying=function(e,t,n){y.typeOf.string("type",e),y.typeOf.string("identifier",t),n=l(n)?`${n} `:"";const i=`${e} ${t};`;this._vertexShaderParts.varyingLines.push(`${n}out ${i}`),this._fragmentShaderParts.varyingLines.push(`${n}in ${i}`)};Gr.prototype.addVertexLines=function(e){if(typeof e!="string"&&!Array.isArray(e))throw new A(`Expected lines to be a string or an array of strings, actual value was ${e}`);const t=this._vertexShaderParts.shaderLines;Array.isArray(e)?t.push.apply(t,e):t.push(e)};Gr.prototype.addFragmentLines=function(e){if(typeof e!="string"&&!Array.isArray(e))throw new A(`Expected lines to be a string or an array of strings, actual value was ${e}`);const t=this._fragmentShaderParts.shaderLines;Array.isArray(e)?t.push.apply(t,e):t.push(e)};Gr.prototype.buildShaderProgram=function(e){y.typeOf.object("context",e);const t=l(this._positionAttributeLine)?[this._positionAttributeLine]:[],n=oQ(this),i=cQ(this),r=t.concat(this._attributeLines,this._vertexShaderParts.uniformLines,this._vertexShaderParts.varyingLines,n.vertexLines,i.vertexLines,this._vertexShaderParts.shaderLines).join(`
`),s=new Je({defines:this._vertexShaderParts.defineLines,sources:[r]}),o=this._fragmentShaderParts.uniformLines.concat(this._fragmentShaderParts.varyingLines,n.fragmentLines,i.fragmentLines,this._fragmentShaderParts.shaderLines).join(`
`),a=new Je({defines:this._fragmentShaderParts.defineLines,sources:[o]});return kn.fromCache({context:e,vertexShaderSource:s,fragmentShaderSource:a,attributeLocations:this._attributeLocations})};Gr.prototype.clone=function(){return Se(this,!0)};function oQ(e){const t=[],n=[];let i,r=e._vertexShaderParts.structIds,s,o,a;for(i=0;i<r.length;i++)s=r[i],o=e._structs[s],a=o.generateGlslLines(),t.push.apply(t,a);for(r=e._fragmentShaderParts.structIds,i=0;i<r.length;i++)s=r[i],o=e._structs[s],a=o.generateGlslLines(),n.push.apply(n,a);return{vertexLines:t,fragmentLines:n}}function aQ(e){switch(e){case"mat2":return 2;case"mat3":return 3;case"mat4":return 4;default:return 1}}function cQ(e){const t=[],n=[];let i,r=e._vertexShaderParts.functionIds,s,o,a;for(i=0;i<r.length;i++)s=r[i],o=e._functions[s],a=o.generateGlslLines(),t.push.apply(t,a);for(r=e._fragmentShaderParts.functionIds,i=0;i<r.length;i++)s=r[i],o=e._functions[s],a=o.generateGlslLines(),n.push.apply(n,a);return{vertexLines:t,fragmentLines:n}}function Di(e,t,n,i){if(y.defined("context",e),!t||t.length===0)throw new A("At least one attribute is required.");const r=Di._verifyAttributes(t);n=T(n,0);const s=[],o={};let a,c;const u=r.length;for(let d=0;d<u;++d){const p=r[d];if(p.vertexBuffer){s.push(p);continue}c=p.usage,a=o[c],l(a)||(a=o[c]=[]),a.push(p)}function h(d,p){return q.getSizeInBytes(p.componentDatatype)-q.getSizeInBytes(d.componentDatatype)}this._allBuffers=[];for(c in o)if(o.hasOwnProperty(c)){a=o[c],a.sort(h);const d=Di._vertexSizeInBytes(a),p=a[0].usage,g={vertexSizeInBytes:d,vertexBuffer:void 0,usage:p,needsCommit:!1,arrayBuffer:void 0,arrayViews:Di._createArrayViews(a,d)};this._allBuffers.push(g)}this._size=0,this._instanced=T(i,!1),this._precreated=s,this._context=e,this.writers=void 0,this.va=void 0,this.resize(n)}Di._verifyAttributes=function(e){const t=[];for(let i=0;i<e.length;++i){const r=e[i],s={index:T(r.index,i),enabled:T(r.enabled,!0),componentsPerAttribute:r.componentsPerAttribute,componentDatatype:T(r.componentDatatype,q.FLOAT),normalize:T(r.normalize,!1),vertexBuffer:r.vertexBuffer,usage:T(r.usage,Ae.STATIC_DRAW)};if(t.push(s),s.componentsPerAttribute!==1&&s.componentsPerAttribute!==2&&s.componentsPerAttribute!==3&&s.componentsPerAttribute!==4)throw new A("attribute.componentsPerAttribute must be in the range [1, 4].");const o=s.componentDatatype;if(!q.validate(o))throw new A("Attribute must have a valid componentDatatype or not specify it.");if(!Ae.validate(s.usage))throw new A("Attribute must have a valid usage or not specify it.")}const n=new Array(t.length);for(let i=0;i<t.length;++i){const s=t[i].index;if(n[s])throw new A(`Index ${s} is used by more than one attribute.`);n[s]=!0}return t};Di._vertexSizeInBytes=function(e){let t=0;const n=e.length;for(let o=0;o<n;++o){const a=e[o];t+=a.componentsPerAttribute*q.getSizeInBytes(a.componentDatatype)}const i=n>0?q.getSizeInBytes(e[0].componentDatatype):0,r=i>0?t%i:0,s=r===0?0:i-r;return t+=s,t};Di._createArrayViews=function(e,t){const n=[];let i=0;const r=e.length;for(let s=0;s<r;++s){const o=e[s],a=o.componentDatatype;n.push({index:o.index,enabled:o.enabled,componentsPerAttribute:o.componentsPerAttribute,componentDatatype:a,normalize:o.normalize,offsetInBytes:i,vertexSizeInComponentType:t/q.getSizeInBytes(a),view:void 0}),i+=o.componentsPerAttribute*q.getSizeInBytes(a)}return n};Di.prototype.resize=function(e){this._size=e;const t=this._allBuffers;this.writers=[];for(let n=0,i=t.length;n<i;++n){const r=t[n];Di._resize(r,this._size),Di._appendWriters(this.writers,r)}aw(this)};Di._resize=function(e,t){if(e.vertexSizeInBytes>0){const n=new ArrayBuffer(t*e.vertexSizeInBytes);if(l(e.arrayBuffer)){const s=new Uint8Array(n),o=new Uint8Array(e.arrayBuffer),a=o.length;for(let c=0;c<a;++c)s[c]=o[c]}const i=e.arrayViews,r=i.length;for(let s=0;s<r;++s){const o=i[s];o.view=q.createArrayBufferView(o.componentDatatype,n,o.offsetInBytes)}e.arrayBuffer=n}};const lQ=[function(e,t,n){return function(i,r){t[i*n]=r,e.needsCommit=!0}},function(e,t,n){return function(i,r,s){const o=i*n;t[o]=r,t[o+1]=s,e.needsCommit=!0}},function(e,t,n){return function(i,r,s,o){const a=i*n;t[a]=r,t[a+1]=s,t[a+2]=o,e.needsCommit=!0}},function(e,t,n){return function(i,r,s,o,a){const c=i*n;t[c]=r,t[c+1]=s,t[c+2]=o,t[c+3]=a,e.needsCommit=!0}}];Di._appendWriters=function(e,t){const n=t.arrayViews,i=n.length;for(let r=0;r<i;++r){const s=n[r];e[s.index]=lQ[s.componentsPerAttribute-1](t,s.view,s.vertexSizeInComponentType)}};Di.prototype.commit=function(e){let t=!1;const n=this._allBuffers;let i,r,s;for(r=0,s=n.length;r<s;++r)i=n[r],t=uQ(this,i)||t;if(t||!l(this.va)){aw(this);const o=this.va=[],a=R.SIXTY_FOUR_KILOBYTES-4,c=l(e)&&!this._instanced?Math.ceil(this._size/a):1;for(let u=0;u<c;++u){let h=[];for(r=0,s=n.length;r<s;++r){i=n[r];const d=u*(i.vertexSizeInBytes*a);Di._appendAttributes(h,i,d,this._instanced)}h=h.concat(this._precreated),o.push({va:new $i({context:this._context,attributes:h,indexBuffer:e}),indicesCount:1.5*(u!==c-1?a:this._size%a)})}}};function uQ(e,t){if(t.needsCommit&&t.vertexSizeInBytes>0){t.needsCommit=!1;const n=t.vertexBuffer,i=e._size*t.vertexSizeInBytes,r=l(n);if(!r||n.sizeInBytes<i)return r&&n.destroy(),t.vertexBuffer=ze.createVertexBuffer({context:e._context,typedArray:t.arrayBuffer,usage:t.usage}),t.vertexBuffer.vertexArrayDestroyable=!1,!0;t.vertexBuffer.copyFromArrayView(t.arrayBuffer)}return!1}Di._appendAttributes=function(e,t,n,i){const r=t.arrayViews,s=r.length;for(let o=0;o<s;++o){const a=r[o];e.push({index:a.index,enabled:a.enabled,componentsPerAttribute:a.componentsPerAttribute,componentDatatype:a.componentDatatype,normalize:a.normalize,vertexBuffer:t.vertexBuffer,offsetInBytes:n+a.offsetInBytes,strideInBytes:t.vertexSizeInBytes,instanceDivisor:i?1:0})}};Di.prototype.subCommit=function(e,t){if(e<0||e>=this._size)throw new A("offsetInVertices must be greater than or equal to zero and less than the vertex array size.");if(e+t>this._size)throw new A("offsetInVertices + lengthInVertices cannot exceed the vertex array size.");const n=this._allBuffers;for(let i=0,r=n.length;i<r;++i)fQ(n[i],e,t)};function fQ(e,t,n){if(e.needsCommit&&e.vertexSizeInBytes>0){const i=e.vertexSizeInBytes*t,r=e.vertexSizeInBytes*n;e.vertexBuffer.copyFromArrayView(new Uint8Array(e.arrayBuffer,i,r),i)}}Di.prototype.endSubCommits=function(){const e=this._allBuffers;for(let t=0,n=e.length;t<n;++t)e[t].needsCommit=!1};function aw(e){const t=e.va;if(!l(t))return;const n=t.length;for(let i=0;i<n;++i)t[i].va.destroy();e.va=void 0}Di.prototype.isDestroyed=function(){return!1};Di.prototype.destroy=function(){const e=this._allBuffers;for(let t=0,n=e.length;t<n;++t){const i=e[t];i.vertexBuffer=i.vertexBuffer&&i.vertexBuffer.destroy()}return aw(this),Ye(this)};const gu={NONE:0,CLAMP_TO_GROUND:1,RELATIVE_TO_GROUND:2,CLAMP_TO_TERRAIN:3,RELATIVE_TO_TERRAIN:4,CLAMP_TO_3D_TILE:5,RELATIVE_TO_3D_TILE:6},fa=Object.freeze(gu);function cw(e){return e===gu.CLAMP_TO_GROUND||e===gu.CLAMP_TO_3D_TILE||e===gu.CLAMP_TO_TERRAIN}function zP(e){return e===gu.RELATIVE_TO_GROUND||e===gu.RELATIVE_TO_3D_TILE||e===gu.RELATIVE_TO_TERRAIN}const hQ={CENTER:0,LEFT:1,RIGHT:-1},As=Object.freeze(hQ),dQ={CENTER:0,BOTTOM:1,BASELINE:2,TOP:-1},yn=Object.freeze(dQ),pQ={LEFT:-1,NONE:0,RIGHT:1},tm=Object.freeze(pQ),mQ={ADD:j.FUNC_ADD,SUBTRACT:j.FUNC_SUBTRACT,REVERSE_SUBTRACT:j.FUNC_REVERSE_SUBTRACT,MIN:j.MIN,MAX:j.MAX},of=Object.freeze(mQ),gQ={ZERO:j.ZERO,ONE:j.ONE,SOURCE_COLOR:j.SRC_COLOR,ONE_MINUS_SOURCE_COLOR:j.ONE_MINUS_SRC_COLOR,DESTINATION_COLOR:j.DST_COLOR,ONE_MINUS_DESTINATION_COLOR:j.ONE_MINUS_DST_COLOR,SOURCE_ALPHA:j.SRC_ALPHA,ONE_MINUS_SOURCE_ALPHA:j.ONE_MINUS_SRC_ALPHA,DESTINATION_ALPHA:j.DST_ALPHA,ONE_MINUS_DESTINATION_ALPHA:j.ONE_MINUS_DST_ALPHA,CONSTANT_COLOR:j.CONSTANT_COLOR,ONE_MINUS_CONSTANT_COLOR:j.ONE_MINUS_CONSTANT_COLOR,CONSTANT_ALPHA:j.CONSTANT_ALPHA,ONE_MINUS_CONSTANT_ALPHA:j.ONE_MINUS_CONSTANT_ALPHA,SOURCE_ALPHA_SATURATE:j.SRC_ALPHA_SATURATE},Ps=Object.freeze(gQ),_Q={DISABLED:Object.freeze({enabled:!1}),ALPHA_BLEND:Object.freeze({enabled:!0,equationRgb:of.ADD,equationAlpha:of.ADD,functionSourceRgb:Ps.SOURCE_ALPHA,functionSourceAlpha:Ps.ONE,functionDestinationRgb:Ps.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:Ps.ONE_MINUS_SOURCE_ALPHA}),PRE_MULTIPLIED_ALPHA_BLEND:Object.freeze({enabled:!0,equationRgb:of.ADD,equationAlpha:of.ADD,functionSourceRgb:Ps.ONE,functionSourceAlpha:Ps.ONE,functionDestinationRgb:Ps.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:Ps.ONE_MINUS_SOURCE_ALPHA}),ADDITIVE_BLEND:Object.freeze({enabled:!0,equationRgb:of.ADD,equationAlpha:of.ADD,functionSourceRgb:Ps.SOURCE_ALPHA,functionSourceAlpha:Ps.ONE,functionDestinationRgb:Ps.ONE,functionDestinationAlpha:Ps.ONE})},vs=Object.freeze(_Q),yQ={FRONT:j.FRONT,BACK:j.BACK,FRONT_AND_BACK:j.FRONT_AND_BACK},wo=Object.freeze(yQ);function mc(e){e=T(e,T.EMPTY_OBJECT),this.material=e.material,this.translucent=T(e.translucent,!0),this._vertexShaderSource=e.vertexShaderSource,this._fragmentShaderSource=e.fragmentShaderSource,this._renderState=e.renderState,this._closed=T(e.closed,!1)}Object.defineProperties(mc.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}}});mc.prototype.getFragmentShaderSource=function(){const e=[];return this.flat&&e.push("#define FLAT"),this.faceForward&&e.push("#define FACE_FORWARD"),l(this.material)&&e.push(this.material.shaderSource),e.push(this.fragmentShaderSource),e.join(`
`)};mc.prototype.isTranslucent=function(){return l(this.material)&&this.material.isTranslucent()||!l(this.material)&&this.translucent};mc.prototype.getRenderState=function(){const e=this.isTranslucent(),t=Se(this.renderState,!1);return e?(t.depthMask=!1,t.blending=vs.ALPHA_BLEND):t.depthMask=!0,t};mc.getDefaultRenderState=function(e,t,n){let i={depthTest:{enabled:!0}};return e&&(i.depthMask=!1,i.blending=vs.ALPHA_BLEND),t&&(i.cull={enabled:!0,face:wo.BACK}),l(n)&&(i=wt(n,i,!0)),i};const bQ=`uniform sampler2D image;

czm_material czm_getMaterial(czm_materialInput materialInput)
{
    czm_material material = czm_getDefaultMaterial(materialInput);
    vec4 rampColor = texture(image, vec2(materialInput.aspect / (2.0 * czm_pi), 0.5));
    rampColor = czm_gammaCorrect(rampColor);
    material.diffuse = rampColor.rgb;
    material.alpha = rampColor.a;
    return material;
}
`,TQ=`uniform sampler2D image;
uniform float strength;
uniform vec2 repeat;

czm_material czm_getMaterial(czm_materialInput materialInput)
{
    czm_material material = czm_getDefaultMaterial(materialInput);

    vec2 st = materialInput.st;

    vec2 centerPixel = fract(repeat * st);
    float centerBump = texture(image, centerPixel).channel;

    float imageWidth = float(imageDimensions.x);
    vec2 rightPixel = fract(repeat * (st + vec2(1.0 / imageWidth, 0.0)));
    float rightBump = texture(image, rightPixel).channel;

    float imageHeight = float(imageDimensions.y);
    vec2 leftPixel = fract(repeat * (st + vec2(0.0, 1.0 / imageHeight)));
    float topBump = texture(image, leftPixel).channel;

    vec3 normalTangentSpace = normalize(vec3(centerBump - rightBump, centerBump - topBump, clamp(1.0 - strength, 0.1, 1.0)));
    vec3 normalEC = materialInput.tangentToEyeMatrix * normalTangentSpace;

    material.normal = normalEC;
    material.diffuse = vec3(0.01);

    return material;
}
`,xQ=`uniform vec4 lightColor;
uniform vec4 darkColor;
uniform vec2 repeat;

czm_material czm_getMaterial(czm_materialInput materialInput)
{
    czm_material material = czm_getDefaultMaterial(materialInput);

    vec2 st = materialInput.st;

    // From Stefan Gustavson's Procedural Textures in GLSL in OpenGL Insights
    float b = mod(floor(repeat.s * st.s) + floor(repeat.t * st.t), 2.0);  // 0.0 or 1.0

    // Find the distance from the closest separator (region between two colors)
    float scaledWidth = fract(repeat.s * st.s);
    scaledWidth = abs(scaledWidth - floor(scaledWidth + 0.5));
    float scaledHeight = fract(repeat.t * st.t);
    scaledHeight = abs(scaledHeight - floor(scaledHeight + 0.5));
    float value = min(scaledWidth, scaledHeight);

    vec4 currentColor = mix(lightColor, darkColor, b);
    vec4 color = czm_antialias(lightColor, darkColor, currentColor, value, 0.03);

    color = czm_gammaCorrect(color);
    material.diffuse = color.rgb;
    material.alpha = color.a;

    return material;
}
`,EQ=`uniform vec4 lightColor;
uniform vec4 darkColor;
uniform vec2 repeat;

czm_material czm_getMaterial(czm_materialInput materialInput)
{
    czm_material material = czm_getDefaultMaterial(materialInput);

    // From Stefan Gustavson's Procedural Textures in GLSL in OpenGL Insights
    float b = smoothstep(0.3, 0.32, length(fract(repeat * materialInput.st) - 0.5));  // 0.0 or 1.0

    vec4 color = mix(lightColor, darkColor, b);
    color = czm_gammaCorrect(color);
    material.diffuse = color.rgb;
    material.alpha = color.a;

    return material;
}
`,CQ=`uniform sampler2D heights;
uniform sampler2D colors;

// This material expects heights to be sorted from lowest to highest.

float getHeight(int idx, float invTexSize)
{
    vec2 uv = vec2((float(idx) + 0.5) * invTexSize, 0.5);
#ifdef OES_texture_float
    return texture(heights, uv).x;
#else
    return czm_unpackFloat(texture(heights, uv));
#endif
}

czm_material czm_getMaterial(czm_materialInput materialInput)
{
    czm_material material = czm_getDefaultMaterial(materialInput);

    float height = materialInput.height;
    float invTexSize = 1.0 / float(heightsDimensions.x);

    float minHeight = getHeight(0, invTexSize);
    float maxHeight = getHeight(heightsDimensions.x - 1, invTexSize);

    // early-out when outside the height range
    if (height < minHeight || height > maxHeight) {
        material.diffuse = vec3(0.0);
        material.alpha = 0.0;
        return material;
    }

    // Binary search to find heights above and below.
    int idxBelow = 0;
    int idxAbove = heightsDimensions.x;
    float heightBelow = minHeight;
    float heightAbove = maxHeight;

    // while loop not allowed, so use for loop with max iterations.
    // maxIterations of 16 supports a texture size up to 65536 (2^16).
    const int maxIterations = 16;
    for (int i = 0; i < maxIterations; i++) {
        if (idxBelow >= idxAbove - 1) {
            break;
        }

        int idxMid = (idxBelow + idxAbove) / 2;
        float heightTex = getHeight(idxMid, invTexSize);

        if (height > heightTex) {
            idxBelow = idxMid;
            heightBelow = heightTex;
        } else {
            idxAbove = idxMid;
            heightAbove = heightTex;
        }
    }

    float lerper = heightBelow == heightAbove ? 1.0 : (height - heightBelow) / (heightAbove - heightBelow);
    vec2 colorUv = vec2(invTexSize * (float(idxBelow) + 0.5 + lerper), 0.5);
    vec4 color = texture(colors, colorUv);

    // undo preumultiplied alpha
    if (color.a > 0.0) 
    {
        color.rgb /= color.a;
    }
    
    color.rgb = czm_gammaCorrect(color.rgb);

    material.diffuse = color.rgb;
    material.alpha = color.a;
    return material;
}
`,wQ=`uniform vec4 color;
uniform float spacing;
uniform float width;

czm_material czm_getMaterial(czm_materialInput materialInput)
{
    czm_material material = czm_getDefaultMaterial(materialInput);

    float distanceToContour = mod(materialInput.height, spacing);

#if (__VERSION__ == 300 || defined(GL_OES_standard_derivatives))
    float dxc = abs(dFdx(materialInput.height));
    float dyc = abs(dFdy(materialInput.height));
    float dF = max(dxc, dyc) * czm_pixelRatio * width;
    float alpha = (distanceToContour < dF) ? 1.0 : 0.0;
#else
    // If no derivatives available (IE 10?), use pixel ratio
    float alpha = (distanceToContour < (czm_pixelRatio * width)) ? 1.0 : 0.0;
#endif

    vec4 outColor = czm_gammaCorrect(vec4(color.rgb, alpha * color.a));
    material.diffuse = outColor.rgb;
    material.alpha = outColor.a;

    return material;
}
`,AQ=`uniform sampler2D image;
uniform float minimumHeight;
uniform float maximumHeight;

czm_material czm_getMaterial(czm_materialInput materialInput)
{
    czm_material material = czm_getDefaultMaterial(materialInput);
    float scaledHeight = clamp((materialInput.height - minimumHeight) / (maximumHeight - minimumHeight), 0.0, 1.0);
    vec4 rampColor = texture(image, vec2(scaledHeight, 0.5));
    rampColor = czm_gammaCorrect(rampColor);
    material.diffuse = rampColor.rgb;
    material.alpha = rampColor.a;
    return material;
}
`,SQ=`uniform vec4 fadeInColor;
uniform vec4 fadeOutColor;
uniform float maximumDistance;
uniform bool repeat;
uniform vec2 fadeDirection;
uniform vec2 time;

float getTime(float t, float coord)
{
    float scalar = 1.0 / maximumDistance;
    float q  = distance(t, coord) * scalar;
    if (repeat)
    {
        float r = distance(t, coord + 1.0) * scalar;
        float s = distance(t, coord - 1.0) * scalar;
        q = min(min(r, s), q);
    }
    return clamp(q, 0.0, 1.0);
}

czm_material czm_getMaterial(czm_materialInput materialInput)
{
    czm_material material = czm_getDefaultMaterial(materialInput);

    vec2 st = materialInput.st;
    float s = getTime(time.x, st.s) * fadeDirection.s;
    float t = getTime(time.y, st.t) * fadeDirection.t;

    float u = length(vec2(s, t));
    vec4 color = mix(fadeInColor, fadeOutColor, u);

    color = czm_gammaCorrect(color);
    material.emission = color.rgb;
    material.alpha = color.a;

    return material;
}
`,vQ=`uniform vec4 color;
uniform float cellAlpha;
uniform vec2 lineCount;
uniform vec2 lineThickness;
uniform vec2 lineOffset;

czm_material czm_getMaterial(czm_materialInput materialInput)
{
    czm_material material = czm_getDefaultMaterial(materialInput);

    vec2 st = materialInput.st;

    float scaledWidth = fract(lineCount.s * st.s - lineOffset.s);
    scaledWidth = abs(scaledWidth - floor(scaledWidth + 0.5));
    float scaledHeight = fract(lineCount.t * st.t - lineOffset.t);
    scaledHeight = abs(scaledHeight - floor(scaledHeight + 0.5));

    float value;

    // Fuzz Factor - Controls blurriness of lines
#if (__VERSION__ == 300 || defined(GL_OES_standard_derivatives))
    const float fuzz = 1.2;
    vec2 thickness = (lineThickness * czm_pixelRatio) - 1.0;

    // From "3D Engine Design for Virtual Globes" by Cozzi and Ring, Listing 4.13.
    vec2 dx = abs(dFdx(st));
    vec2 dy = abs(dFdy(st));
    vec2 dF = vec2(max(dx.s, dy.s), max(dx.t, dy.t)) * lineCount;
    value = min(
        smoothstep(dF.s * thickness.s, dF.s * (fuzz + thickness.s), scaledWidth),
        smoothstep(dF.t * thickness.t, dF.t * (fuzz + thickness.t), scaledHeight));
#else
    // If no derivatives available (IE 10?), revert to view-dependent fuzz
    const float fuzz = 0.05;

    vec2 range = 0.5 - (lineThickness * 0.05);
    value = min(
        1.0 - smoothstep(range.s, range.s + fuzz, scaledWidth),
        1.0 - smoothstep(range.t, range.t + fuzz, scaledHeight));
#endif

    // Edges taken from RimLightingMaterial.glsl
    // See http://www.fundza.com/rman_shaders/surface/fake_rim/fake_rim1.html
    float dRim = 1.0 - abs(dot(materialInput.normalEC, normalize(materialInput.positionToEyeEC)));
    float sRim = smoothstep(0.8, 1.0, dRim);
    value *= (1.0 - sRim);

    vec4 halfColor;
    halfColor.rgb = color.rgb * 0.5;
    halfColor.a = color.a * (1.0 - ((1.0 - cellAlpha) * value));
    halfColor = czm_gammaCorrect(halfColor);
    material.diffuse = halfColor.rgb;
    material.emission = halfColor.rgb;
    material.alpha = halfColor.a;

    return material;
}
`,IQ=`uniform sampler2D image;
uniform float strength;
uniform vec2 repeat;

czm_material czm_getMaterial(czm_materialInput materialInput)
{
    czm_material material = czm_getDefaultMaterial(materialInput);
    
    vec4 textureValue = texture(image, fract(repeat * materialInput.st));
    vec3 normalTangentSpace = textureValue.channels;
    normalTangentSpace.xy = normalTangentSpace.xy * 2.0 - 1.0;
    normalTangentSpace.z = clamp(1.0 - strength, 0.1, 1.0);
    normalTangentSpace = normalize(normalTangentSpace);
    vec3 normalEC = materialInput.tangentToEyeMatrix * normalTangentSpace;
    
    material.normal = normalEC;
    
    return material;
}
`,OQ=`uniform vec4 color;

float getPointOnLine(vec2 p0, vec2 p1, float x)
{
    float slope = (p0.y - p1.y) / (p0.x - p1.x);
    return slope * (x - p0.x) + p0.y;
}

czm_material czm_getMaterial(czm_materialInput materialInput)
{
    czm_material material = czm_getDefaultMaterial(materialInput);

    vec2 st = materialInput.st;

#if (__VERSION__ == 300 || defined(GL_OES_standard_derivatives))
    float base = 1.0 - abs(fwidth(st.s)) * 10.0 * czm_pixelRatio;
#else
     // If no derivatives available (IE 10?), 2.5% of the line will be the arrow head
    float base = 0.975;
#endif

    vec2 center = vec2(1.0, 0.5);
    float ptOnUpperLine = getPointOnLine(vec2(base, 1.0), center, st.s);
    float ptOnLowerLine = getPointOnLine(vec2(base, 0.0), center, st.s);

    float halfWidth = 0.15;
    float s = step(0.5 - halfWidth, st.t);
    s *= 1.0 - step(0.5 + halfWidth, st.t);
    s *= 1.0 - step(base, st.s);

    float t = step(base, materialInput.st.s);
    t *= 1.0 - step(ptOnUpperLine, st.t);
    t *= step(ptOnLowerLine, st.t);

    // Find the distance from the closest separator (region between two colors)
    float dist;
    if (st.s < base)
    {
        float d1 = abs(st.t - (0.5 - halfWidth));
        float d2 = abs(st.t - (0.5 + halfWidth));
        dist = min(d1, d2);
    }
    else
    {
        float d1 = czm_infinity;
        if (st.t < 0.5 - halfWidth && st.t > 0.5 + halfWidth)
        {
            d1 = abs(st.s - base);
        }
        float d2 = abs(st.t - ptOnUpperLine);
        float d3 = abs(st.t - ptOnLowerLine);
        dist = min(min(d1, d2), d3);
    }

    vec4 outsideColor = vec4(0.0);
    vec4 currentColor = mix(outsideColor, color, clamp(s + t, 0.0, 1.0));
    vec4 outColor = czm_antialias(outsideColor, color, currentColor, dist);

    outColor = czm_gammaCorrect(outColor);
    material.diffuse = outColor.rgb;
    material.alpha = outColor.a;
    return material;
}
`,RQ=`uniform vec4 color;
uniform vec4 gapColor;
uniform float dashLength;
uniform float dashPattern;
in float v_polylineAngle;

const float maskLength = 16.0;

mat2 rotate(float rad) {
    float c = cos(rad);
    float s = sin(rad);
    return mat2(
        c, s,
        -s, c
    );
}

czm_material czm_getMaterial(czm_materialInput materialInput)
{
    czm_material material = czm_getDefaultMaterial(materialInput);

    vec2 pos = rotate(v_polylineAngle) * gl_FragCoord.xy;

    // Get the relative position within the dash from 0 to 1
    float dashPosition = fract(pos.x / (dashLength * czm_pixelRatio));
    // Figure out the mask index.
    float maskIndex = floor(dashPosition * maskLength);
    // Test the bit mask.
    float maskTest = floor(dashPattern / pow(2.0, maskIndex));
    vec4 fragColor = (mod(maskTest, 2.0) < 1.0) ? gapColor : color;
    if (fragColor.a < 0.005) {   // matches 0/255 and 1/255
        discard;
    }

    fragColor = czm_gammaCorrect(fragColor);
    material.emission = fragColor.rgb;
    material.alpha = fragColor.a;
    return material;
}
`,DQ=`uniform vec4 color;
uniform float glowPower;
uniform float taperPower;

czm_material czm_getMaterial(czm_materialInput materialInput)
{
    czm_material material = czm_getDefaultMaterial(materialInput);

    vec2 st = materialInput.st;
    float glow = glowPower / abs(st.t - 0.5) - (glowPower / 0.5);

    if (taperPower <= 0.99999) {
        glow *= min(1.0, taperPower / (0.5 - st.s * 0.5) - (taperPower / 0.5));
    }

    vec4 fragColor;
    fragColor.rgb = max(vec3(glow - 1.0 + color.rgb), color.rgb);
    fragColor.a = clamp(0.0, 1.0, glow) * color.a;
    fragColor = czm_gammaCorrect(fragColor);

    material.emission = fragColor.rgb;
    material.alpha = fragColor.a;

    return material;
}
`,MQ=`uniform vec4 color;
uniform vec4 outlineColor;
uniform float outlineWidth;

in float v_width;

czm_material czm_getMaterial(czm_materialInput materialInput)
{
    czm_material material = czm_getDefaultMaterial(materialInput);

    vec2 st = materialInput.st;
    float halfInteriorWidth =  0.5 * (v_width - outlineWidth) / v_width;
    float b = step(0.5 - halfInteriorWidth, st.t);
    b *= 1.0 - step(0.5 + halfInteriorWidth, st.t);

    // Find the distance from the closest separator (region between two colors)
    float d1 = abs(st.t - (0.5 - halfInteriorWidth));
    float d2 = abs(st.t - (0.5 + halfInteriorWidth));
    float dist = min(d1, d2);

    vec4 currentColor = mix(outlineColor, color, b);
    vec4 outColor = czm_antialias(outlineColor, color, currentColor, dist);
    outColor = czm_gammaCorrect(outColor);

    material.diffuse = outColor.rgb;
    material.alpha = outColor.a;

    return material;
}
`,LQ=`uniform vec4 color;
uniform vec4 rimColor;
uniform float width;

czm_material czm_getMaterial(czm_materialInput materialInput)
{
    czm_material material = czm_getDefaultMaterial(materialInput);

    // See http://www.fundza.com/rman_shaders/surface/fake_rim/fake_rim1.html
    float d = 1.0 - dot(materialInput.normalEC, normalize(materialInput.positionToEyeEC));
    float s = smoothstep(1.0 - width, 1.0, d);

    vec4 outColor = czm_gammaCorrect(color);
    vec4 outRimColor = czm_gammaCorrect(rimColor);

    material.diffuse = outColor.rgb;
    material.emission = outRimColor.rgb * s;
    material.alpha = mix(outColor.a, outRimColor.a, s);

    return material;
}
`,PQ=`uniform sampler2D image;

czm_material czm_getMaterial(czm_materialInput materialInput)
{
    czm_material material = czm_getDefaultMaterial(materialInput);
    vec4 rampColor = texture(image, vec2(materialInput.slope / (czm_pi / 2.0), 0.5));
    rampColor = czm_gammaCorrect(rampColor);
    material.diffuse = rampColor.rgb;
    material.alpha = rampColor.a;
    return material;
}
`,NQ=`uniform vec4 evenColor;
uniform vec4 oddColor;
uniform float offset;
uniform float repeat;
uniform bool horizontal;

czm_material czm_getMaterial(czm_materialInput materialInput)
{
    czm_material material = czm_getDefaultMaterial(materialInput);

    // Based on the Stripes Fragment Shader in the Orange Book (11.1.2)
    float coord = mix(materialInput.st.s, materialInput.st.t, float(horizontal));
    float value = fract((coord - offset) * (repeat * 0.5));
    float dist = min(value, min(abs(value - 0.5), 1.0 - value));

    vec4 currentColor = mix(evenColor, oddColor, step(0.5, value));
    vec4 color = czm_antialias(evenColor, oddColor, currentColor, dist);
    color = czm_gammaCorrect(color);

    material.diffuse = color.rgb;
    material.alpha = color.a;

    return material;
}
`,FQ=`// Thanks for the contribution Jonas
// http://29a.ch/2012/7/19/webgl-terrain-rendering-water-fog

uniform sampler2D specularMap;
uniform sampler2D normalMap;
uniform vec4 baseWaterColor;
uniform vec4 blendColor;
uniform float frequency;
uniform float animationSpeed;
uniform float amplitude;
uniform float specularIntensity;
uniform float fadeFactor;

czm_material czm_getMaterial(czm_materialInput materialInput)
{
    czm_material material = czm_getDefaultMaterial(materialInput);

    float time = czm_frameNumber * animationSpeed;

    // fade is a function of the distance from the fragment and the frequency of the waves
    float fade = max(1.0, (length(materialInput.positionToEyeEC) / 10000000000.0) * frequency * fadeFactor);

    float specularMapValue = texture(specularMap, materialInput.st).r;

    // note: not using directional motion at this time, just set the angle to 0.0;
    vec4 noise = czm_getWaterNoise(normalMap, materialInput.st * frequency, time, 0.0);
    vec3 normalTangentSpace = noise.xyz * vec3(1.0, 1.0, (1.0 / amplitude));

    // fade out the normal perturbation as we move further from the water surface
    normalTangentSpace.xy /= fade;

    // attempt to fade out the normal perturbation as we approach non water areas (low specular map value)
    normalTangentSpace = mix(vec3(0.0, 0.0, 50.0), normalTangentSpace, specularMapValue);

    normalTangentSpace = normalize(normalTangentSpace);

    // get ratios for alignment of the new normal vector with a vector perpendicular to the tangent plane
    float tsPerturbationRatio = clamp(dot(normalTangentSpace, vec3(0.0, 0.0, 1.0)), 0.0, 1.0);

    // fade out water effect as specular map value decreases
    material.alpha = mix(blendColor.a, baseWaterColor.a, specularMapValue) * specularMapValue;

    // base color is a blend of the water and non-water color based on the value from the specular map
    // may need a uniform blend factor to better control this
    material.diffuse = mix(blendColor.rgb, baseWaterColor.rgb, specularMapValue);

    // diffuse highlights are based on how perturbed the normal is
    material.diffuse += (0.1 * tsPerturbationRatio);

    material.diffuse = material.diffuse;

    material.normal = normalize(materialInput.tangentToEyeMatrix * normalTangentSpace);

    material.specular = specularIntensity;
    material.shininess = 10.0;

    return material;
}
`;function ce(e){this.type=void 0,this.shaderSource=void 0,this.materials=void 0,this.uniforms=void 0,this._uniforms=void 0,this.translucent=void 0,this._minificationFilter=T(e.minificationFilter,Ut.LINEAR),this._magnificationFilter=T(e.magnificationFilter,ws.LINEAR),this._strict=void 0,this._template=void 0,this._count=void 0,this._texturePaths={},this._loadedImages=[],this._loadedCubeMaps=[],this._textures={},this._updateFunctions=[],this._defaultTexture=void 0,BQ(e,this),Object.defineProperties(this,{type:{value:this.type,writable:!1}}),l(ce._uniformList[this.type])||(ce._uniformList[this.type]=Object.keys(this._uniforms))}ce._uniformList={};ce.fromType=function(e,t){if(!l(ce._materialCache.getMaterial(e)))throw new A(`material with type '${e}' does not exist.`);const n=new ce({fabric:{type:e}});if(l(t))for(const i in t)t.hasOwnProperty(i)&&(n.uniforms[i]=t[i]);return n};ce.prototype.isTranslucent=function(){if(l(this.translucent))return typeof this.translucent=="function"?this.translucent():this.translucent;let e=!0;const t=this._translucentFunctions,n=t.length;for(let i=0;i<n;++i){const r=t[i];if(typeof r=="function"?e=e&&r():e=e&&r,!e)break}return e};ce.prototype.update=function(e){this._defaultTexture=e.defaultTexture;let t,n;const i=this._loadedImages;let r=i.length;for(t=0;t<r;++t){const c=i[t];n=c.id;let u=c.image,h;Array.isArray(u)&&(h=u.slice(1,u.length).map(function(b){return b.bufferView}),u=u[0]);const d=new Cn({minificationFilter:this._minificationFilter,magnificationFilter:this._magnificationFilter});let p;l(u.internalFormat)?p=new kt({context:e,pixelFormat:u.internalFormat,width:u.width,height:u.height,source:{arrayBufferView:u.bufferView,mipLevels:h},sampler:d}):p=new kt({context:e,source:u,sampler:d});const g=this._textures[n];l(g)&&g!==this._defaultTexture&&g.destroy(),this._textures[n]=p;const _=`${n}Dimensions`;if(this.uniforms.hasOwnProperty(_)){const b=this.uniforms[_];b.x=p._width,b.y=p._height}}i.length=0;const s=this._loadedCubeMaps;for(r=s.length,t=0;t<r;++t){const c=s[t];n=c.id;const u=c.images,h=new Fu({context:e,source:{positiveX:u[0],negativeX:u[1],positiveY:u[2],negativeY:u[3],positiveZ:u[4],negativeZ:u[5]},sampler:new Cn({minificationFilter:this._minificationFilter,magnificationFilter:this._magnificationFilter})});this._textures[n]=h}s.length=0;const o=this._updateFunctions;for(r=o.length,t=0;t<r;++t)o[t](this,e);const a=this.materials;for(const c in a)a.hasOwnProperty(c)&&a[c].update(e)};ce.prototype.isDestroyed=function(){return!1};ce.prototype.destroy=function(){const e=this._textures;for(const n in e)if(e.hasOwnProperty(n)){const i=e[n];i!==this._defaultTexture&&i.destroy()}const t=this.materials;for(const n in t)t.hasOwnProperty(n)&&t[n].destroy();return Ye(this)};function BQ(e,t){e=T(e,T.EMPTY_OBJECT),t._strict=T(e.strict,!1),t._count=T(e.count,0),t._template=Se(T(e.fabric,T.EMPTY_OBJECT)),t._template.uniforms=Se(T(t._template.uniforms,T.EMPTY_OBJECT)),t._template.materials=Se(T(t._template.materials,T.EMPTY_OBJECT)),t.type=l(t._template.type)?t._template.type:dc(),t.shaderSource="",t.materials={},t.uniforms={},t._uniforms={},t._translucentFunctions=[];let n;const i=ce._materialCache.getMaterial(t.type);if(l(i)){const s=Se(i.fabric,!0);t._template=wt(t._template,s,!0),n=i.translucent}jQ(t),l(i)||ce._materialCache.addMaterial(t.type,t),GQ(t),$Q(t),YQ(t);const r=t._translucentFunctions.length===0?!0:void 0;if(n=T(n,r),n=T(e.translucent,n),l(n))if(typeof n=="function"){const s=function(){return n(t)};t._translucentFunctions.push(s)}else t._translucentFunctions.push(n)}function k0(e,t,n,i){if(l(e)){for(const r in e)if(e.hasOwnProperty(r)){const s=t.indexOf(r)!==-1;(i&&!s||!i&&s)&&n(r,t)}}}function qI(e,t){let n=`fabric: property name '${e}' is not valid. It should be `;for(let i=0;i<t.length;i++){const r=`'${t[i]}'`;n+=i===t.length-1?`or ${r}.`:`${r}, `}throw new A(n)}function zQ(e,t){const n=`fabric: uniforms and materials cannot share the same property '${e}'`;throw new A(n)}const UQ=["type","materials","uniforms","components","source"],kQ=["diffuse","specular","shininess","normal","emission","alpha"];function jQ(e){const t=e._template,n=t.uniforms,i=t.materials,r=t.components;if(l(r)&&l(t.source))throw new A("fabric: cannot have source and components in the same template.");k0(t,UQ,qI,!0),k0(r,kQ,qI,!0);const s=[];for(const o in i)i.hasOwnProperty(o)&&s.push(o);k0(n,s,zQ,!1)}function VQ(e,t){const n=t._template.materials;for(const i in n)if(n.hasOwnProperty(i)&&e.indexOf(i)>-1)return!0;return!1}function GQ(e){const t=e._template.components,n=e._template.source;if(l(n))e.shaderSource+=`${n}
`;else{if(e.shaderSource+=`czm_material czm_getMaterial(czm_materialInput materialInput)
{
`,e.shaderSource+=`czm_material material = czm_getDefaultMaterial(materialInput);
`,l(t)){const i=Object.keys(e._template.materials).length>0;for(const r in t)if(t.hasOwnProperty(r))if(r==="diffuse"||r==="emission"){const o=i&&VQ(t[r],e)?t[r]:`czm_gammaCorrect(${t[r]})`;e.shaderSource+=`material.${r} = ${o}; 
`}else r==="alpha"?e.shaderSource+=`material.alpha = ${t.alpha}; 
`:e.shaderSource+=`material.${r} = ${t[r]};
`}e.shaderSource+=`return material;
}
`}}const WI={mat2:Te,mat3:H,mat4:P},HQ=/\.ktx2$/i;function qQ(e){let t;return function(n,i){const r=n.uniforms,s=r[e],o=t!==s,a=!l(s)||s===ce.DefaultImageId;t=s;let c=n._textures[e],u,h;if(s instanceof HTMLVideoElement){if(s.readyState>=2){if(o&&l(c)&&(c!==i.defaultTexture&&c.destroy(),c=void 0),!l(c)||c===i.defaultTexture){const p=new Cn({minificationFilter:n._minificationFilter,magnificationFilter:n._magnificationFilter});c=new kt({context:i,source:s,sampler:p}),n._textures[e]=c;return}c.copyFrom({source:s})}else l(c)||(n._textures[e]=i.defaultTexture);return}if(s instanceof kt&&s!==c){n._texturePaths[e]=void 0;const p=n._textures[e];l(p)&&p!==n._defaultTexture&&p.destroy(),n._textures[e]=s,u=`${e}Dimensions`,r.hasOwnProperty(u)&&(h=r[u],h.x=s._width,h.y=s._height);return}if(o&&l(c)&&a&&(c!==n._defaultTexture&&c.destroy(),c=void 0),l(c)||(n._texturePaths[e]=void 0,c=n._textures[e]=n._defaultTexture,u=`${e}Dimensions`,r.hasOwnProperty(u)&&(h=r[u],h.x=c._width,h.y=c._height)),a)return;const d=s instanceof se;if(!l(n._texturePaths[e])||d&&s.url!==n._texturePaths[e].url||!d&&s!==n._texturePaths[e]){if(typeof s=="string"||d){const p=d?s:se.createIfNeeded(s);let g;HQ.test(p.url)?g=Dh(p.url):g=p.fetchImage(),Promise.resolve(g).then(function(_){n._loadedImages.push({id:e,image:_})}).catch(function(){l(c)&&c!==n._defaultTexture&&c.destroy(),n._textures[e]=n._defaultTexture})}else(s instanceof HTMLCanvasElement||s instanceof HTMLImageElement)&&n._loadedImages.push({id:e,image:s});n._texturePaths[e]=s}}}function WQ(e){return function(t,n){const i=t.uniforms[e];if(i instanceof Fu){const s=t._textures[e];s!==t._defaultTexture&&s.destroy(),t._texturePaths[e]=void 0,t._textures[e]=i;return}if(l(t._textures[e])||(t._texturePaths[e]=void 0,t._textures[e]=n.defaultCubeMap),i===ce.DefaultCubeMapId)return;const r=i.positiveX+i.negativeX+i.positiveY+i.negativeY+i.positiveZ+i.negativeZ;if(r!==t._texturePaths[e]){const s=[se.createIfNeeded(i.positiveX).fetchImage(),se.createIfNeeded(i.negativeX).fetchImage(),se.createIfNeeded(i.positiveY).fetchImage(),se.createIfNeeded(i.negativeY).fetchImage(),se.createIfNeeded(i.positiveZ).fetchImage(),se.createIfNeeded(i.negativeZ).fetchImage()];Promise.all(s).then(function(o){t._loadedCubeMaps.push({id:e,images:o})}),t._texturePaths[e]=r}}}function $Q(e){const t=e._template.uniforms;for(const n in t)t.hasOwnProperty(n)&&UP(e,n)}function UP(e,t){const n=e._strict,i=e._template.uniforms,r=i[t],s=XQ(r);if(!l(s))throw new A(`fabric: uniform '${t}' has invalid type.`);let o;if(s==="channels"){if(o=Op(e,t,r,!1),o===0&&n)throw new A(`strict: shader source does not use channels '${t}'.`)}else{if(s==="sampler2D"){const u=`${t}Dimensions`;KQ(e,u)>0&&(i[u]={type:"ivec3",x:1,y:1},UP(e,u))}if(!new RegExp(`uniform\\s+${s}\\s+${t}\\s*;`).test(e.shaderSource)){const u=`uniform ${s} ${t};`;e.shaderSource=u+e.shaderSource}const c=`${t}_${e._count++}`;if(o=Op(e,t,c),o===1&&n)throw new A(`strict: shader source does not use uniform '${t}'.`);if(e.uniforms[t]=r,s==="sampler2D")e._uniforms[c]=function(){return e._textures[t]},e._updateFunctions.push(qQ(t));else if(s==="samplerCube")e._uniforms[c]=function(){return e._textures[t]},e._updateFunctions.push(WQ(t));else if(s.indexOf("mat")!==-1){const u=new WI[s];e._uniforms[c]=function(){return WI[s].fromColumnMajorArray(e.uniforms[t],u)}}else e._uniforms[c]=function(){return e.uniforms[t]}}}function XQ(e){let t=e.type;if(!l(t)){const n=typeof e;if(n==="number")t="float";else if(n==="boolean")t="bool";else if(n==="string"||e instanceof se||e instanceof HTMLCanvasElement||e instanceof HTMLImageElement)/^([rgba]){1,4}$/i.test(e)?t="channels":e===ce.DefaultCubeMapId?t="samplerCube":t="sampler2D";else if(n==="object")if(Array.isArray(e))(e.length===4||e.length===9||e.length===16)&&(t=`mat${Math.sqrt(e.length)}`);else{let i=0;for(const r in e)e.hasOwnProperty(r)&&(i+=1);i>=2&&i<=4?t=`vec${i}`:i===6&&(t="samplerCube")}}return t}function YQ(e){const t=e._strict,n=e._template.materials;for(const i in n)if(n.hasOwnProperty(i)){const r=new ce({strict:t,fabric:n[i],count:e._count});e._count=r._count,e._uniforms=wt(e._uniforms,r._uniforms,!0),e.materials[i]=r,e._translucentFunctions=e._translucentFunctions.concat(r._translucentFunctions);const s="czm_getMaterial",o=`${s}_${e._count++}`;Op(r,s,o),e.shaderSource=r.shaderSource+e.shaderSource;const a=`${o}(materialInput)`;if(Op(e,i,a)===0&&t)throw new A(`strict: shader source does not use material '${i}'.`)}}function Op(e,t,n,i){i=T(i,!0);let r=0;const s="([\\w])?",o=`([\\w${i?".":""}])?`,a=new RegExp(o+t+s,"g");return e.shaderSource=e.shaderSource.replace(a,function(c,u,h){return u||h?c:(r+=1,n)}),r}function KQ(e,t,n){return Op(e,t,t,n)}ce._materialCache={_materials:{},addMaterial:function(e,t){this._materials[e]=t},getMaterial:function(e){return this._materials[e]}};ce.DefaultImageId="czm_defaultImage";ce.DefaultCubeMapId="czm_defaultCubeMap";ce.ColorType="Color";ce._materialCache.addMaterial(ce.ColorType,{fabric:{type:ce.ColorType,uniforms:{color:new M(1,0,0,.5)},components:{diffuse:"color.rgb",alpha:"color.a"}},translucent:function(e){return e.uniforms.color.alpha<1}});ce.ImageType="Image";ce._materialCache.addMaterial(ce.ImageType,{fabric:{type:ce.ImageType,uniforms:{image:ce.DefaultImageId,repeat:new k(1,1),color:new M(1,1,1,1)},components:{diffuse:"texture(image, fract(repeat * materialInput.st)).rgb * color.rgb",alpha:"texture(image, fract(repeat * materialInput.st)).a * color.a"}},translucent:function(e){return e.uniforms.color.alpha<1}});ce.DiffuseMapType="DiffuseMap";ce._materialCache.addMaterial(ce.DiffuseMapType,{fabric:{type:ce.DiffuseMapType,uniforms:{image:ce.DefaultImageId,channels:"rgb",repeat:new k(1,1)},components:{diffuse:"texture(image, fract(repeat * materialInput.st)).channels"}},translucent:!1});ce.AlphaMapType="AlphaMap";ce._materialCache.addMaterial(ce.AlphaMapType,{fabric:{type:ce.AlphaMapType,uniforms:{image:ce.DefaultImageId,channel:"a",repeat:new k(1,1)},components:{alpha:"texture(image, fract(repeat * materialInput.st)).channel"}},translucent:!0});ce.SpecularMapType="SpecularMap";ce._materialCache.addMaterial(ce.SpecularMapType,{fabric:{type:ce.SpecularMapType,uniforms:{image:ce.DefaultImageId,channel:"r",repeat:new k(1,1)},components:{specular:"texture(image, fract(repeat * materialInput.st)).channel"}},translucent:!1});ce.EmissionMapType="EmissionMap";ce._materialCache.addMaterial(ce.EmissionMapType,{fabric:{type:ce.EmissionMapType,uniforms:{image:ce.DefaultImageId,channels:"rgb",repeat:new k(1,1)},components:{emission:"texture(image, fract(repeat * materialInput.st)).channels"}},translucent:!1});ce.BumpMapType="BumpMap";ce._materialCache.addMaterial(ce.BumpMapType,{fabric:{type:ce.BumpMapType,uniforms:{image:ce.DefaultImageId,channel:"r",strength:.8,repeat:new k(1,1)},source:TQ},translucent:!1});ce.NormalMapType="NormalMap";ce._materialCache.addMaterial(ce.NormalMapType,{fabric:{type:ce.NormalMapType,uniforms:{image:ce.DefaultImageId,channels:"rgb",strength:.8,repeat:new k(1,1)},source:IQ},translucent:!1});ce.GridType="Grid";ce._materialCache.addMaterial(ce.GridType,{fabric:{type:ce.GridType,uniforms:{color:new M(0,1,0,1),cellAlpha:.1,lineCount:new k(8,8),lineThickness:new k(1,1),lineOffset:new k(0,0)},source:vQ},translucent:function(e){const t=e.uniforms;return t.color.alpha<1||t.cellAlpha<1}});ce.StripeType="Stripe";ce._materialCache.addMaterial(ce.StripeType,{fabric:{type:ce.StripeType,uniforms:{horizontal:!0,evenColor:new M(1,1,1,.5),oddColor:new M(0,0,1,.5),offset:0,repeat:5},source:NQ},translucent:function(e){const t=e.uniforms;return t.evenColor.alpha<1||t.oddColor.alpha<1}});ce.CheckerboardType="Checkerboard";ce._materialCache.addMaterial(ce.CheckerboardType,{fabric:{type:ce.CheckerboardType,uniforms:{lightColor:new M(1,1,1,.5),darkColor:new M(0,0,0,.5),repeat:new k(5,5)},source:xQ},translucent:function(e){const t=e.uniforms;return t.lightColor.alpha<1||t.darkColor.alpha<1}});ce.DotType="Dot";ce._materialCache.addMaterial(ce.DotType,{fabric:{type:ce.DotType,uniforms:{lightColor:new M(1,1,0,.75),darkColor:new M(0,1,1,.75),repeat:new k(5,5)},source:EQ},translucent:function(e){const t=e.uniforms;return t.lightColor.alpha<1||t.darkColor.alpha<1}});ce.WaterType="Water";ce._materialCache.addMaterial(ce.WaterType,{fabric:{type:ce.WaterType,uniforms:{baseWaterColor:new M(.2,.3,.6,1),blendColor:new M(0,1,.699,1),specularMap:ce.DefaultImageId,normalMap:ce.DefaultImageId,frequency:10,animationSpeed:.01,amplitude:1,specularIntensity:.5,fadeFactor:1},source:FQ},translucent:function(e){const t=e.uniforms;return t.baseWaterColor.alpha<1||t.blendColor.alpha<1}});ce.RimLightingType="RimLighting";ce._materialCache.addMaterial(ce.RimLightingType,{fabric:{type:ce.RimLightingType,uniforms:{color:new M(1,0,0,.7),rimColor:new M(1,1,1,.4),width:.3},source:LQ},translucent:function(e){const t=e.uniforms;return t.color.alpha<1||t.rimColor.alpha<1}});ce.FadeType="Fade";ce._materialCache.addMaterial(ce.FadeType,{fabric:{type:ce.FadeType,uniforms:{fadeInColor:new M(1,0,0,1),fadeOutColor:new M(0,0,0,0),maximumDistance:.5,repeat:!0,fadeDirection:{x:!0,y:!0},time:new k(.5,.5)},source:SQ},translucent:function(e){const t=e.uniforms;return t.fadeInColor.alpha<1||t.fadeOutColor.alpha<1}});ce.PolylineArrowType="PolylineArrow";ce._materialCache.addMaterial(ce.PolylineArrowType,{fabric:{type:ce.PolylineArrowType,uniforms:{color:new M(1,1,1,1)},source:OQ},translucent:!0});ce.PolylineDashType="PolylineDash";ce._materialCache.addMaterial(ce.PolylineDashType,{fabric:{type:ce.PolylineDashType,uniforms:{color:new M(1,0,1,1),gapColor:new M(0,0,0,0),dashLength:16,dashPattern:255},source:RQ},translucent:!0});ce.PolylineGlowType="PolylineGlow";ce._materialCache.addMaterial(ce.PolylineGlowType,{fabric:{type:ce.PolylineGlowType,uniforms:{color:new M(0,.5,1,1),glowPower:.25,taperPower:1},source:DQ},translucent:!0});ce.PolylineOutlineType="PolylineOutline";ce._materialCache.addMaterial(ce.PolylineOutlineType,{fabric:{type:ce.PolylineOutlineType,uniforms:{color:new M(1,1,1,1),outlineColor:new M(1,0,0,1),outlineWidth:1},source:MQ},translucent:function(e){const t=e.uniforms;return t.color.alpha<1||t.outlineColor.alpha<1}});ce.ElevationContourType="ElevationContour";ce._materialCache.addMaterial(ce.ElevationContourType,{fabric:{type:ce.ElevationContourType,uniforms:{spacing:100,color:new M(1,0,0,1),width:1},source:wQ},translucent:!1});ce.ElevationRampType="ElevationRamp";ce._materialCache.addMaterial(ce.ElevationRampType,{fabric:{type:ce.ElevationRampType,uniforms:{image:ce.DefaultImageId,minimumHeight:0,maximumHeight:1e4},source:AQ},translucent:!1});ce.SlopeRampMaterialType="SlopeRamp";ce._materialCache.addMaterial(ce.SlopeRampMaterialType,{fabric:{type:ce.SlopeRampMaterialType,uniforms:{image:ce.DefaultImageId},source:PQ},translucent:!1});ce.AspectRampMaterialType="AspectRamp";ce._materialCache.addMaterial(ce.AspectRampMaterialType,{fabric:{type:ce.AspectRampMaterialType,uniforms:{image:ce.DefaultImageId},source:bQ},translucent:!1});ce.ElevationBandType="ElevationBand";ce._materialCache.addMaterial(ce.ElevationBandType,{fabric:{type:ce.ElevationBandType,uniforms:{heights:ce.DefaultImageId,colors:ce.DefaultImageId},source:CQ},translucent:!0});const ZQ=`in vec3 v_positionEC;
in vec3 v_normalEC;
in vec4 v_color;

void main()
{
    vec3 positionToEyeEC = -v_positionEC;

    vec3 normalEC = normalize(v_normalEC);
#ifdef FACE_FORWARD
    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);
#endif

    vec4 color = czm_gammaCorrect(v_color);

    czm_materialInput materialInput;
    materialInput.normalEC = normalEC;
    materialInput.positionToEyeEC = positionToEyeEC;
    czm_material material = czm_getDefaultMaterial(materialInput);
    material.diffuse = color.rgb;
    material.alpha = color.a;

    out_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);
}
`,JQ=`in vec3 position3DHigh;
in vec3 position3DLow;
in vec3 normal;
in vec4 color;
in float batchId;

out vec3 v_positionEC;
out vec3 v_normalEC;
out vec4 v_color;

void main()
{
    vec4 p = czm_computePosition();

    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates
    v_normalEC = czm_normal * normal;                         // normal in eye coordinates
    v_color = color;

    gl_Position = czm_modelViewProjectionRelativeToEye * p;
}
`,QQ=`in vec4 v_color;

void main()
{
    out_FragColor = czm_gammaCorrect(v_color);
}
`,eee=`in vec3 position3DHigh;
in vec3 position3DLow;
in vec4 color;
in float batchId;

out vec4 v_color;

void main()
{
    vec4 p = czm_computePosition();

    v_color = color;

    gl_Position = czm_modelViewProjectionRelativeToEye * p;
}
`;function ro(e){e=T(e,T.EMPTY_OBJECT);const t=T(e.translucent,!0),n=T(e.closed,!1),i=T(e.flat,!1),r=i?eee:JQ,s=i?QQ:ZQ,o=i?ro.FLAT_VERTEX_FORMAT:ro.VERTEX_FORMAT;this.material=void 0,this.translucent=t,this._vertexShaderSource=T(e.vertexShaderSource,r),this._fragmentShaderSource=T(e.fragmentShaderSource,s),this._renderState=mc.getDefaultRenderState(t,n,e.renderState),this._closed=n,this._vertexFormat=o,this._flat=i,this._faceForward=T(e.faceForward,!n)}Object.defineProperties(ro.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return this._vertexFormat}},flat:{get:function(){return this._flat}},faceForward:{get:function(){return this._faceForward}}});ro.VERTEX_FORMAT=Qt.POSITION_AND_NORMAL;ro.FLAT_VERTEX_FORMAT=Qt.POSITION_ONLY;ro.prototype.getFragmentShaderSource=mc.prototype.getFragmentShaderSource;ro.prototype.isTranslucent=mc.prototype.isTranslucent;ro.prototype.getRenderState=mc.prototype.getRenderState;const $I=`#ifdef VECTOR_TILE
uniform vec4 u_highlightColor;
#endif

void main(void)
{
#ifdef VECTOR_TILE
    out_FragColor = czm_gammaCorrect(u_highlightColor);
#else
    out_FragColor = vec4(1.0);
#endif
    czm_writeDepthClamp();
}
`,kP={TERRAIN:0,CESIUM_3D_TILE:1,BOTH:2};kP.NUMBER_OF_CLASSIFICATION_TYPES=3;const Ks=Object.freeze(kP),tee={NEVER:j.NEVER,LESS:j.LESS,EQUAL:j.EQUAL,LESS_OR_EQUAL:j.LEQUAL,GREATER:j.GREATER,NOT_EQUAL:j.NOTEQUAL,GREATER_OR_EQUAL:j.GEQUAL,ALWAYS:j.ALWAYS},Xy=Object.freeze(tee);function wa(e,t,n){if(!l(e))throw new A("context is required");if(!l(t))throw new A("attributes is required");if(!l(n))throw new A("numberOfInstances is required");if(this._attributes=t,this._numberOfInstances=n,t.length===0)return;const i=nee(t),r=e.floatingPointTexture,s=i===De.FLOAT&&!r,o=iee(t,s),a=ree(o,t,s),c=Math.floor(We.maximumTextureSize/a),u=Math.min(n,c),h=a*u,d=Math.ceil(n/u),p=1/h,g=p*.5,_=1/d,b=_*.5;this._textureDimensions=new k(h,d),this._textureStep=new Y(p,g,_,b),this._pixelDatatype=s?De.UNSIGNED_BYTE:i,this._packFloats=s,this._offsets=o,this._stride=a,this._texture=void 0;const x=4*h*d;this._batchValues=i===De.FLOAT&&!s?new Float32Array(x):new Uint8Array(x),this._batchValuesDirty=!1}Object.defineProperties(wa.prototype,{attributes:{get:function(){return this._attributes}},numberOfInstances:{get:function(){return this._numberOfInstances}}});function nee(e){let t=!1;const n=e.length;for(let i=0;i<n;++i)if(e[i].componentDatatype!==q.UNSIGNED_BYTE){t=!0;break}return t?De.FLOAT:De.UNSIGNED_BYTE}function jP(e,t){const n=e[t].componentsPerAttribute;return n===2?k:n===3?m:n===4?Y:Number}function iee(e,t){const n=new Array(e.length);let i=0;const r=e.length;for(let s=0;s<r;++s){const a=e[s].componentDatatype;n[s]=i,a!==q.UNSIGNED_BYTE&&t?i+=4:++i}return n}function ree(e,t,n){const i=e.length,r=e[i-1];return t[i-1].componentDatatype!==q.UNSIGNED_BYTE&&n?r+4:r+1}const Fd=new Y;function see(e,t,n){let i=Y.unpack(e,t,Fd);const r=Y.unpackFloat(i);i=Y.unpack(e,t+4,Fd);const s=Y.unpackFloat(i);i=Y.unpack(e,t+8,Fd);const o=Y.unpackFloat(i);i=Y.unpack(e,t+12,Fd);const a=Y.unpackFloat(i);return Y.fromElements(r,s,o,a,n)}function oee(e,t,n){let i=Y.packFloat(e.x,Fd);Y.pack(i,t,n),i=Y.packFloat(e.y,i),Y.pack(i,t,n+4),i=Y.packFloat(e.z,i),Y.pack(i,t,n+8),i=Y.packFloat(e.w,i),Y.pack(i,t,n+12)}const XI=new Y;wa.prototype.getBatchedAttribute=function(e,t,n){if(e<0||e>=this._numberOfInstances)throw new A("instanceIndex is out of range.");if(t<0||t>=this._attributes.length)throw new A("attributeIndex is out of range");const i=this._attributes,r=this._offsets[t],o=4*this._stride*e+4*r;let a;this._packFloats&&i[t].componentDatatype!==De.UNSIGNED_BYTE?a=see(this._batchValues,o,XI):a=Y.unpack(this._batchValues,o,XI);const c=jP(i,t);return l(c.fromCartesian4)?c.fromCartesian4(a,n):l(c.clone)?c.clone(a,n):a.x};const aee=[void 0,void 0,new k,new m,new Y],cee=new Y;wa.prototype.setBatchedAttribute=function(e,t,n){if(e<0||e>=this._numberOfInstances)throw new A("instanceIndex is out of range.");if(t<0||t>=this._attributes.length)throw new A("attributeIndex is out of range");if(!l(n))throw new A("value is required.");const i=this._attributes,r=aee[i[t].componentsPerAttribute],s=this.getBatchedAttribute(e,t,r),o=jP(this._attributes,t);if(l(o.equals)?o.equals(s,n):s===n)return;const c=cee;c.x=l(n.x)?n.x:n,c.y=l(n.y)?n.y:0,c.z=l(n.z)?n.z:0,c.w=l(n.w)?n.w:0;const u=this._offsets[t],d=4*this._stride*e+4*u;this._packFloats&&i[t].componentDatatype!==De.UNSIGNED_BYTE?oee(c,this._batchValues,d):Y.pack(c,this._batchValues,d),this._batchValuesDirty=!0};function lee(e,t){const n=e._textureDimensions;e._texture=new kt({context:t,pixelFormat:Le.RGBA,pixelDatatype:e._pixelDatatype,width:n.x,height:n.y,sampler:Cn.NEAREST,flipY:!1})}function uee(e){const t=e._textureDimensions;e._texture.copyFrom({source:{width:t.x,height:t.y,arrayBufferView:e._batchValues}})}wa.prototype.update=function(e){l(this._texture)&&!this._batchValuesDirty||this._attributes.length===0||(this._batchValuesDirty=!1,l(this._texture)||lee(this,e.context),uee(this))};wa.prototype.getUniformMapCallback=function(){const e=this;return function(t){return e._attributes.length===0?t:wt(t,{batchTexture:function(){return e._texture},batchTextureDimensions:function(){return e._textureDimensions},batchTextureStep:function(){return e._textureStep}})}};function fee(e){const t=e._stride;return e._textureDimensions.y===1?`uniform vec4 batchTextureStep; 
vec2 computeSt(float batchId) 
{ 
    float stepX = batchTextureStep.x; 
    float centerX = batchTextureStep.y; 
    float numberOfAttributes = float(${t}); 
    return vec2(centerX + (batchId * numberOfAttributes * stepX), 0.5); 
} 
`:`uniform vec4 batchTextureStep; 
uniform vec2 batchTextureDimensions; 
vec2 computeSt(float batchId) 
{ 
    float stepX = batchTextureStep.x; 
    float centerX = batchTextureStep.y; 
    float stepY = batchTextureStep.z; 
    float centerY = batchTextureStep.w; 
    float numberOfAttributes = float(${t}); 
    float xId = mod(batchId * numberOfAttributes, batchTextureDimensions.x); 
    float yId = floor(batchId * numberOfAttributes / batchTextureDimensions.x); 
    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); 
} 
`}function hee(e){return e===1?"float":`vec${e}`}function dee(e){return e===1?".x":e===2?".xy":e===3?".xyz":""}function pee(e,t){const i=e._attributes[t],r=i.componentsPerAttribute,s=i.functionName,o=hee(r),a=dee(r),c=e._offsets[t];let u=`${o} ${s}(float batchId) 
{ 
    vec2 st = computeSt(batchId); 
    st.x += batchTextureStep.x * float(${c}); 
`;return e._packFloats&&i.componentDatatype!==De.UNSIGNED_BYTE?u+=`vec4 textureValue; 
textureValue.x = czm_unpackFloat(texture(batchTexture, st)); 
textureValue.y = czm_unpackFloat(texture(batchTexture, st + vec2(batchTextureStep.x, 0.0))); 
textureValue.z = czm_unpackFloat(texture(batchTexture, st + vec2(batchTextureStep.x * 2.0, 0.0))); 
textureValue.w = czm_unpackFloat(texture(batchTexture, st + vec2(batchTextureStep.x * 3.0, 0.0))); 
`:u+=`    vec4 textureValue = texture(batchTexture, st); 
`,u+=`    ${o} value = textureValue${a}; 
`,e._pixelDatatype===De.UNSIGNED_BYTE&&i.componentDatatype===q.UNSIGNED_BYTE&&!i.normalize?u+=`value *= 255.0; 
`:e._pixelDatatype===De.FLOAT&&i.componentDatatype===q.UNSIGNED_BYTE&&i.normalize&&(u+=`value /= 255.0; 
`),u+=`    return value; 
} 
`,u}wa.prototype.getVertexShaderCallback=function(){const e=this._attributes;if(e.length===0)return function(i){return i};let t=`uniform highp sampler2D batchTexture; 
`;t+=`${fee(this)}
`;const n=e.length;for(let i=0;i<n;++i)t+=pee(this,i);return function(i){const r=i.indexOf("void main"),s=i.substring(0,r),o=i.substring(r);return`${s}
${t}
${o}`}};wa.prototype.isDestroyed=function(){return!1};wa.prototype.destroy=function(){return this._texture=this._texture&&this._texture.destroy(),Ye(this)};function mee(e,t,n){let i=!n;const r=e.length;let s;if(!i&&r>1){const o=e[0].modelMatrix;for(s=1;s<r;++s)if(!P.equals(o,e[s].modelMatrix)){i=!0;break}}if(i)for(s=0;s<r;++s)l(e[s].geometry)&&$t.transformToWorldCoordinates(e[s]);else P.multiplyTransformation(t,e[0].modelMatrix,t)}function j0(e,t){const n=e.attributes,i=n.position,r=i.values.length/i.componentsPerAttribute;n.batchId=new Lt({componentDatatype:q.FLOAT,componentsPerAttribute:1,values:new Float32Array(r)});const s=n.batchId.values;for(let o=0;o<r;++o)s[o]=t}function gee(e){const t=e.length;for(let n=0;n<t;++n){const i=e[n];l(i.geometry)?j0(i.geometry,n):l(i.westHemisphereGeometry)&&l(i.eastHemisphereGeometry)&&(j0(i.westHemisphereGeometry,n),j0(i.eastHemisphereGeometry,n))}}function _ee(e){const t=e.instances,n=e.projection,i=e.elementIndexUintSupported,r=e.scene3DOnly,s=e.vertexCacheOptimize,o=e.compressVertices,a=e.modelMatrix;let c,u,h,d=t.length;for(c=0;c<d;++c)if(l(t[c].geometry)){h=t[c].geometry.primitiveType;break}for(c=1;c<d;++c)if(l(t[c].geometry)&&t[c].geometry.primitiveType!==h)throw new A("All instance geometries must have the same primitiveType.");if(mee(t,a,r),!r)for(c=0;c<d;++c)l(t[c].geometry)&&$t.splitLongitude(t[c]);if(gee(t),s)for(c=0;c<d;++c){const g=t[c];l(g.geometry)?($t.reorderForPostVertexCache(g.geometry),$t.reorderForPreVertexCache(g.geometry)):l(g.westHemisphereGeometry)&&l(g.eastHemisphereGeometry)&&($t.reorderForPostVertexCache(g.westHemisphereGeometry),$t.reorderForPreVertexCache(g.westHemisphereGeometry),$t.reorderForPostVertexCache(g.eastHemisphereGeometry),$t.reorderForPreVertexCache(g.eastHemisphereGeometry))}let p=$t.combineInstances(t);for(d=p.length,c=0;c<d;++c){u=p[c];const g=u.attributes;if(r)for(const _ in g)g.hasOwnProperty(_)&&g[_].componentDatatype===q.DOUBLE&&$t.encodeAttribute(u,_,`${_}3DHigh`,`${_}3DLow`);else for(const _ in g)if(g.hasOwnProperty(_)&&g[_].componentDatatype===q.DOUBLE){const b=`${_}3D`,x=`${_}2D`;$t.projectTo2D(u,_,b,x,n),l(u.boundingSphere)&&_==="position"&&(u.boundingSphereCV=ee.fromVertices(u.attributes.position2D.values)),$t.encodeAttribute(u,b,`${b}High`,`${b}Low`),$t.encodeAttribute(u,x,`${x}High`,`${x}Low`)}o&&$t.compressVertices(u)}if(!i){let g=[];for(d=p.length,c=0;c<d;++c)u=p[c],g=g.concat($t.fitToUnsignedShortIndices(u));p=g}return p}function V0(e,t,n,i){let r,s,o;const a=i.length-1;if(a>=0){const u=i[a];r=u.offset+u.count,o=u.index,s=n[o].indices.length}else r=0,o=0,s=n[o].indices.length;const c=e.length;for(let u=0;u<c;++u){const d=e[u][t];if(!l(d))continue;const p=d.indices.length;r+p>s&&(r=0,s=n[++o].indices.length),i.push({index:o,offset:r,count:p}),r+=p}}function yee(e,t){const n=[];return V0(e,"geometry",t,n),V0(e,"westHemisphereGeometry",t,n),V0(e,"eastHemisphereGeometry",t,n),n}const Po={};Po.combineGeometry=function(e){let t,n;const i=e.instances,r=i.length;let s,o,a=!1;r>0&&(t=_ee(e),t.length>0&&(n=$t.createAttributeLocations(t[0]),e.createPickOffsets&&(s=yee(i,t))),l(i[0].attributes)&&l(i[0].attributes.offset)&&(o=new Array(r),a=!0));const c=new Array(r),u=new Array(r);for(let h=0;h<r;++h){const d=i[h],p=d.geometry;l(p)&&(c[h]=p.boundingSphere,u[h]=p.boundingSphereCV,a&&(o[h]=d.geometry.offsetAttribute));const g=d.eastHemisphereGeometry,_=d.westHemisphereGeometry;l(g)&&l(_)&&(l(g.boundingSphere)&&l(_.boundingSphere)&&(c[h]=ee.union(g.boundingSphere,_.boundingSphere)),l(g.boundingSphereCV)&&l(_.boundingSphereCV)&&(u[h]=ee.union(g.boundingSphereCV,_.boundingSphereCV)))}return{geometries:t,modelMatrix:e.modelMatrix,attributeLocations:n,pickOffsets:s,offsetInstanceExtend:o,boundingSpheres:c,boundingSpheresCV:u}};function bee(e,t){const n=e.attributes;for(const i in n)if(n.hasOwnProperty(i)){const r=n[i];l(r)&&l(r.values)&&t.push(r.values.buffer)}l(e.indices)&&t.push(e.indices.buffer)}function Tee(e,t){const n=e.length;for(let i=0;i<n;++i)bee(e[i],t)}function xee(e){let t=1;const n=e.length;for(let i=0;i<n;i++){const r=e[i];if(++t,!l(r))continue;const s=r.attributes;t+=7+2*ee.packedLength+(l(r.indices)?r.indices.length:0);for(const o in s)if(s.hasOwnProperty(o)&&l(s[o])){const a=s[o];t+=5+a.values.length}}return t}Po.packCreateGeometryResults=function(e,t){const n=new Float64Array(xee(e)),i=[],r={},s=e.length;let o=0;n[o++]=s;for(let a=0;a<s;a++){const c=e[a],u=l(c);if(n[o++]=u?1:0,!u)continue;n[o++]=c.primitiveType,n[o++]=c.geometryType,n[o++]=T(c.offsetAttribute,-1);const h=l(c.boundingSphere)?1:0;n[o++]=h,h&&ee.pack(c.boundingSphere,n,o),o+=ee.packedLength;const d=l(c.boundingSphereCV)?1:0;n[o++]=d,d&&ee.pack(c.boundingSphereCV,n,o),o+=ee.packedLength;const p=c.attributes,g=[];for(const b in p)p.hasOwnProperty(b)&&l(p[b])&&(g.push(b),l(r[b])||(r[b]=i.length,i.push(b)));n[o++]=g.length;for(let b=0;b<g.length;b++){const x=g[b],E=p[x];n[o++]=r[x],n[o++]=E.componentDatatype,n[o++]=E.componentsPerAttribute,n[o++]=E.normalize?1:0,n[o++]=E.values.length,n.set(E.values,o),o+=E.values.length}const _=l(c.indices)?c.indices.length:0;n[o++]=_,_>0&&(n.set(c.indices,o),o+=_)}return t.push(n.buffer),{stringTable:i,packedData:n}};Po.unpackCreateGeometryResults=function(e){const t=e.stringTable,n=e.packedData;let i;const r=new Array(n[0]);let s=0,o=1;for(;o<n.length;){if(!(n[o++]===1)){r[s++]=void 0;continue}const c=n[o++],u=n[o++];let h=n[o++];h===-1&&(h=void 0);let d,p;n[o++]===1&&(d=ee.unpack(n,o)),o+=ee.packedLength,n[o++]===1&&(p=ee.unpack(n,o)),o+=ee.packedLength;let b,x,E;const C=new Pu,w=n[o++];for(i=0;i<w;i++){const v=t[n[o++]],D=n[o++];E=n[o++];const L=n[o++]!==0;b=n[o++],x=q.createTypedArray(D,b);for(let O=0;O<b;O++)x[O]=n[o++];C[v]=new Lt({componentDatatype:D,componentsPerAttribute:E,normalize:L,values:x})}let S;if(b=n[o++],b>0){const v=x.length/E;for(S=Ge.createTypedArray(v,b),i=0;i<b;i++)S[i]=n[o++]}r[s++]=new Ht({primitiveType:c,geometryType:u,boundingSphere:d,boundingSphereCV:p,indices:S,attributes:C,offsetAttribute:h})}return r};function Eee(e,t){const n=e.length,i=new Float64Array(1+n*19);let r=0;i[r++]=n;for(let s=0;s<n;s++){const o=e[s];if(P.pack(o.modelMatrix,i,r),r+=P.packedLength,l(o.attributes)&&l(o.attributes.offset)){const a=o.attributes.offset.value;i[r]=a[0],i[r+1]=a[1],i[r+2]=a[2]}r+=3}return t.push(i.buffer),i}function Cee(e){const t=e,n=new Array(t[0]);let i=0,r=1;for(;r<t.length;){const s=P.unpack(t,r);let o;r+=P.packedLength,l(t[r])&&(o={offset:new Sp(t[r],t[r+1],t[r+2])}),r+=3,n[i++]={modelMatrix:s,attributes:o}}return n}Po.packCombineGeometryParameters=function(e,t){const n=e.createGeometryResults,i=n.length;for(let r=0;r<i;r++)t.push(n[r].packedData.buffer);return{createGeometryResults:e.createGeometryResults,packedInstances:Eee(e.instances,t),ellipsoid:e.ellipsoid,isGeographic:e.projection instanceof ur,elementIndexUintSupported:e.elementIndexUintSupported,scene3DOnly:e.scene3DOnly,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:e.modelMatrix,createPickOffsets:e.createPickOffsets}};Po.unpackCombineGeometryParameters=function(e){const t=Cee(e.packedInstances),n=e.createGeometryResults,i=n.length;let r=0;for(let a=0;a<i;a++){const c=Po.unpackCreateGeometryResults(n[a]),u=c.length;for(let h=0;h<u;h++){const d=c[h],p=t[r];p.geometry=d,++r}}const s=fe.clone(e.ellipsoid),o=e.isGeographic?new ur(s):new Jn(s);return{instances:t,ellipsoid:s,projection:o,elementIndexUintSupported:e.elementIndexUintSupported,scene3DOnly:e.scene3DOnly,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:P.clone(e.modelMatrix),createPickOffsets:e.createPickOffsets}};function YI(e){const t=e.length,n=1+(ee.packedLength+1)*t,i=new Float32Array(n);let r=0;i[r++]=t;for(let s=0;s<t;++s){const o=e[s];l(o)?(i[r++]=1,ee.pack(e[s],i,r)):i[r++]=0,r+=ee.packedLength}return i}function KI(e){const t=new Array(e[0]);let n=0,i=1;for(;i<e.length;)e[i++]===1&&(t[n]=ee.unpack(e,i)),++n,i+=ee.packedLength;return t}Po.packCombineGeometryResults=function(e,t){l(e.geometries)&&Tee(e.geometries,t);const n=YI(e.boundingSpheres),i=YI(e.boundingSpheresCV);return t.push(n.buffer,i.buffer),{geometries:e.geometries,attributeLocations:e.attributeLocations,modelMatrix:e.modelMatrix,pickOffsets:e.pickOffsets,offsetInstanceExtend:e.offsetInstanceExtend,boundingSpheres:n,boundingSpheresCV:i}};Po.unpackCombineGeometryResults=function(e){return{geometries:e.geometries,attributeLocations:e.attributeLocations,modelMatrix:e.modelMatrix,pickOffsets:e.pickOffsets,offsetInstanceExtend:e.offsetInstanceExtend,boundingSpheres:KI(e.boundingSpheres),boundingSpheresCV:KI(e.boundingSpheresCV)}};const wee={READY:0,CREATING:1,CREATED:2,COMBINING:3,COMBINED:4,COMPLETE:5,FAILED:6},yi=Object.freeze(wee),ms={DISABLED:0,ENABLED:1,CAST_ONLY:2,RECEIVE_ONLY:3};ms.NUMBER_OF_SHADOW_MODES=4;ms.castShadows=function(e){return e===ms.ENABLED||e===ms.CAST_ONLY};ms.receiveShadows=function(e){return e===ms.ENABLED||e===ms.RECEIVE_ONLY};ms.fromCastReceive=function(e,t){return e&&t?ms.ENABLED:e?ms.CAST_ONLY:t?ms.RECEIVE_ONLY:ms.DISABLED};const rc=Object.freeze(ms);function bn(e){if(e=T(e,T.EMPTY_OBJECT),this.geometryInstances=e.geometryInstances,this.appearance=e.appearance,this._appearance=void 0,this._material=void 0,this.depthFailAppearance=e.depthFailAppearance,this._depthFailAppearance=void 0,this._depthFailMaterial=void 0,this.modelMatrix=P.clone(T(e.modelMatrix,P.IDENTITY)),this._modelMatrix=new P,this.show=T(e.show,!0),this._vertexCacheOptimize=T(e.vertexCacheOptimize,!1),this._interleave=T(e.interleave,!1),this._releaseGeometryInstances=T(e.releaseGeometryInstances,!0),this._allowPicking=T(e.allowPicking,!0),this._asynchronous=T(e.asynchronous,!0),this._compressVertices=T(e.compressVertices,!0),this.cull=T(e.cull,!0),this.debugShowBoundingVolume=T(e.debugShowBoundingVolume,!1),this.rtcCenter=e.rtcCenter,l(this.rtcCenter)&&(!l(this.geometryInstances)||Array.isArray(this.geometryInstances)&&this.geometryInstances.length!==1))throw new A("Relative-to-center rendering only supports one geometry instance.");this.shadows=T(e.shadows,rc.DISABLED),this._translucent=void 0,this._state=yi.READY,this._geometries=[],this._error=void 0,this._numberOfInstances=0,this._boundingSpheres=[],this._boundingSphereWC=[],this._boundingSphereCV=[],this._boundingSphere2D=[],this._boundingSphereMorph=[],this._perInstanceAttributeCache=new Map,this._instanceIds=[],this._lastPerInstanceAttributeIndex=0,this._va=[],this._attributeLocations=void 0,this._primitiveType=void 0,this._frontFaceRS=void 0,this._backFaceRS=void 0,this._sp=void 0,this._depthFailAppearance=void 0,this._spDepthFail=void 0,this._frontFaceDepthFailRS=void 0,this._backFaceDepthFailRS=void 0,this._pickIds=[],this._colorCommands=[],this._pickCommands=[],this._createBoundingVolumeFunction=e._createBoundingVolumeFunction,this._createRenderStatesFunction=e._createRenderStatesFunction,this._createShaderProgramFunction=e._createShaderProgramFunction,this._createCommandsFunction=e._createCommandsFunction,this._updateAndQueueCommandsFunction=e._updateAndQueueCommandsFunction,this._createPickOffsets=e._createPickOffsets,this._pickOffsets=void 0,this._createGeometryResults=void 0,this._ready=!1,this._batchTable=void 0,this._batchTableAttributeIndices=void 0,this._offsetInstanceExtend=void 0,this._batchTableOffsetAttribute2DIndex=void 0,this._batchTableOffsetsUpdated=!1,this._instanceBoundingSpheres=void 0,this._instanceBoundingSpheresCV=void 0,this._tempBoundingSpheres=void 0,this._recomputeBoundingSpheres=!1,this._batchTableBoundingSpheresUpdated=!1,this._batchTableBoundingSphereAttributeIndices=void 0}Object.defineProperties(bn.prototype,{vertexCacheOptimize:{get:function(){return this._vertexCacheOptimize}},interleave:{get:function(){return this._interleave}},releaseGeometryInstances:{get:function(){return this._releaseGeometryInstances}},allowPicking:{get:function(){return this._allowPicking}},asynchronous:{get:function(){return this._asynchronous}},compressVertices:{get:function(){return this._compressVertices}},ready:{get:function(){return this._ready}}});function Aee(e){const t=e.length,n=[],i=e[0].attributes;let r;for(r in i)if(i.hasOwnProperty(r)&&l(i[r])){const s=i[r];let o=!0;for(let a=1;a<t;++a){const c=e[a].attributes[r];if(!l(c)||s.componentDatatype!==c.componentDatatype||s.componentsPerAttribute!==c.componentsPerAttribute||s.normalize!==c.normalize){o=!1;break}}o&&n.push(r)}return n}const See=new k,vee=new m,VP=new Y;function GP(e){const t=e.length;if(t===1)return e[0];if(t===2)return k.unpack(e,0,See);if(t===3)return m.unpack(e,0,vee);if(t===4)return Y.unpack(e,0,VP)}function Iee(e,t){const n=e.geometryInstances,i=Array.isArray(n)?n:[n],r=i.length;if(r===0)return;const s=Aee(i),o=s.length,a=[],c={},u={};let h,p=i[0].attributes,g,_,b;for(g=0;g<o;++g)_=s[g],b=p[_],c[_]=g,a.push({functionName:`czm_batchTable_${_}`,componentDatatype:b.componentDatatype,componentsPerAttribute:b.componentsPerAttribute,normalize:b.normalize});s.indexOf("distanceDisplayCondition")!==-1&&(a.push({functionName:"czm_batchTable_boundingSphereCenter3DHigh",componentDatatype:q.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter3DLow",componentDatatype:q.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter2DHigh",componentDatatype:q.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter2DLow",componentDatatype:q.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereRadius",componentDatatype:q.FLOAT,componentsPerAttribute:1}),u.center3DHigh=a.length-5,u.center3DLow=a.length-4,u.center2DHigh=a.length-3,u.center2DLow=a.length-2,u.radius=a.length-1),s.indexOf("offset")!==-1&&(a.push({functionName:"czm_batchTable_offset2D",componentDatatype:q.FLOAT,componentsPerAttribute:3}),h=a.length-1),a.push({functionName:"czm_batchTable_pickColor",componentDatatype:q.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0});const x=a.length,E=new wa(t,a,r);for(g=0;g<r;++g){const C=i[g];p=C.attributes;for(let L=0;L<o;++L){_=s[L],b=p[_];const O=GP(b.value),N=c[_];E.setBatchedAttribute(g,N,O)}const w={primitive:T(C.pickPrimitive,e)};l(C.id)&&(w.id=C.id);const S=t.createPickId(w);e._pickIds.push(S);const v=S.color,D=VP;D.x=M.floatToByte(v.red),D.y=M.floatToByte(v.green),D.z=M.floatToByte(v.blue),D.w=M.floatToByte(v.alpha),E.setBatchedAttribute(g,x-1,D)}e._batchTable=E,e._batchTableAttributeIndices=c,e._batchTableBoundingSphereAttributeIndices=u,e._batchTableOffsetAttribute2DIndex=h}function Oee(e){let t;return Array.isArray(e.values)?t=e.values.slice(0):t=new e.values.constructor(e.values),new Lt({componentDatatype:e.componentDatatype,componentsPerAttribute:e.componentsPerAttribute,normalize:e.normalize,values:t})}function Ree(e){const t=e.attributes,n=new Pu;for(const r in t)t.hasOwnProperty(r)&&l(t[r])&&(n[r]=Oee(t[r]));let i;if(l(e.indices)){const r=e.indices;Array.isArray(r)?i=r.slice(0):i=new r.constructor(r)}return new Ht({attributes:n,indices:i,primitiveType:e.primitiveType,boundingSphere:ee.clone(e.boundingSphere)})}function Dee(e,t){return{geometry:t,attributes:e.attributes,modelMatrix:P.clone(e.modelMatrix),pickPrimitive:e.pickPrimitive,id:e.id}}const Mee=/in\s+vec(?:3|4)\s+(.*)3DHigh;/g;bn._modifyShaderPosition=function(e,t,n){let i,r="",s="",o="";for(;(i=Mee.exec(t))!==null;){const a=i[1],c=`vec4 czm_compute${a[0].toUpperCase()}${a.substr(1)}()`;c!=="vec4 czm_computePosition()"&&(r+=`${c};
`),l(e.rtcCenter)?(t=t.replace(/in\s+vec(?:3|4)\s+position3DHigh;/g,""),t=t.replace(/in\s+vec(?:3|4)\s+position3DLow;/g,""),r+=`uniform mat4 u_modifiedModelView;
`,s+=`in vec4 position;
`,o+=`${c}
{
    return u_modifiedModelView * position;
}

`,t=t.replace(/czm_modelViewRelativeToEye\s+\*\s+/g,""),t=t.replace(/czm_modelViewProjectionRelativeToEye/g,"czm_projection")):n?o+=`${c}
{
    return czm_translateRelativeToEye(${a}3DHigh, ${a}3DLow);
}

`:(s+=`in vec3 ${a}2DHigh;
in vec3 ${a}2DLow;
`,o+=`${c}
{
    vec4 p;
    if (czm_morphTime == 1.0)
    {
        p = czm_translateRelativeToEye(${a}3DHigh, ${a}3DLow);
    }
    else if (czm_morphTime == 0.0)
    {
        p = czm_translateRelativeToEye(${a}2DHigh.zxy, ${a}2DLow.zxy);
    }
    else
    {
        p = czm_columbusViewMorph(
                czm_translateRelativeToEye(${a}2DHigh.zxy, ${a}2DLow.zxy),
                czm_translateRelativeToEye(${a}3DHigh, ${a}3DLow),
                czm_morphTime);
    }
    return p;
}

`)}return[r,s,t,o].join(`
`)};bn._appendShowToShader=function(e,t){return l(e._batchTableAttributeIndices.show)?`${Je.replaceMain(t,"czm_non_show_main")}
void main() 
{ 
    czm_non_show_main(); 
    gl_Position *= czm_batchTable_show(batchId); 
}`:t};bn._updateColorAttribute=function(e,t,n){if(!l(e._batchTableAttributeIndices.color)&&!l(e._batchTableAttributeIndices.depthFailColor)||t.search(/in\s+vec4\s+color;/g)===-1)return t;if(n&&!l(e._batchTableAttributeIndices.depthFailColor))throw new A("A depthFailColor per-instance attribute is required when using a depth fail appearance that uses a color attribute.");let i=t;return i=i.replace(/in\s+vec4\s+color;/g,""),n?i=i.replace(/(\b)color(\b)/g,"$1czm_batchTable_depthFailColor(batchId)$2"):i=i.replace(/(\b)color(\b)/g,"$1czm_batchTable_color(batchId)$2"),i};function ZI(e){return`${Je.replaceMain(e,"czm_non_pick_main")}
out vec4 v_pickColor; 
void main() 
{ 
    czm_non_pick_main(); 
    v_pickColor = czm_batchTable_pickColor(batchId); 
}`}function JI(e){return`in vec4 v_pickColor;
${e}`}bn._updatePickColorAttribute=function(e){let t=e.replace(/in\s+vec4\s+pickColor;/g,"");return t=t.replace(/(\b)pickColor(\b)/g,"$1czm_batchTable_pickColor(batchId)$2"),t};bn._appendOffsetToShader=function(e,t){if(!l(e._batchTableAttributeIndices.offset))return t;let n=`in float batchId;
`;n+="in float applyOffset;";let i=t.replace(/in\s+float\s+batchId;/g,n),r=`vec4 $1 = czm_computePosition();
`;return r+=`    if (czm_sceneMode == czm_sceneMode3D)
`,r+=`    {
`,r+="        $1 = $1 + vec4(czm_batchTable_offset(batchId) * applyOffset, 0.0);",r+=`    }
`,r+=`    else
`,r+=`    {
`,r+="        $1 = $1 + vec4(czm_batchTable_offset2D(batchId) * applyOffset, 0.0);",r+=`    }
`,i=i.replace(/vec4\s+([A-Za-z0-9_]+)\s+=\s+czm_computePosition\(\);/g,r),i};bn._appendDistanceDisplayConditionToShader=function(e,t,n){if(!l(e._batchTableAttributeIndices.distanceDisplayCondition))return t;const i=Je.replaceMain(t,"czm_non_distanceDisplayCondition_main");let r=`void main() 
{ 
    czm_non_distanceDisplayCondition_main(); 
    vec2 distanceDisplayCondition = czm_batchTable_distanceDisplayCondition(batchId);
    vec3 boundingSphereCenter3DHigh = czm_batchTable_boundingSphereCenter3DHigh(batchId);
    vec3 boundingSphereCenter3DLow = czm_batchTable_boundingSphereCenter3DLow(batchId);
    float boundingSphereRadius = czm_batchTable_boundingSphereRadius(batchId);
`;return n?r+=`    vec4 centerRTE = czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow);
`:r+=`    vec3 boundingSphereCenter2DHigh = czm_batchTable_boundingSphereCenter2DHigh(batchId);
    vec3 boundingSphereCenter2DLow = czm_batchTable_boundingSphereCenter2DLow(batchId);
    vec4 centerRTE;
    if (czm_morphTime == 1.0)
    {
        centerRTE = czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow);
    }
    else if (czm_morphTime == 0.0)
    {
        centerRTE = czm_translateRelativeToEye(boundingSphereCenter2DHigh.zxy, boundingSphereCenter2DLow.zxy);
    }
    else
    {
        centerRTE = czm_columbusViewMorph(
                czm_translateRelativeToEye(boundingSphereCenter2DHigh.zxy, boundingSphereCenter2DLow.zxy),
                czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow),
                czm_morphTime);
    }
`,r+=`    float radiusSq = boundingSphereRadius * boundingSphereRadius; 
    float distanceSq; 
    if (czm_sceneMode == czm_sceneMode2D) 
    { 
        distanceSq = czm_eyeHeight2D.y - radiusSq; 
    } 
    else 
    { 
        distanceSq = dot(centerRTE.xyz, centerRTE.xyz) - radiusSq; 
    } 
    distanceSq = max(distanceSq, 0.0); 
    float nearSq = distanceDisplayCondition.x * distanceDisplayCondition.x; 
    float farSq = distanceDisplayCondition.y * distanceDisplayCondition.y; 
    float show = (distanceSq >= nearSq && distanceSq <= farSq) ? 1.0 : 0.0; 
    gl_Position *= show; 
}`,`${i}
${r}`};function QI(e,t){if(!e.compressVertices)return t;const n=t.search(/in\s+vec3\s+normal;/g)!==-1,i=t.search(/in\s+vec2\s+st;/g)!==-1;if(!n&&!i)return t;const r=t.search(/in\s+vec3\s+tangent;/g)!==-1,s=t.search(/in\s+vec3\s+bitangent;/g)!==-1;let o=i&&n?2:1;o+=r||s?1:0;const a=o>1?`vec${o}`:"float",c="compressedAttributes",u=`in ${a} ${c};`;let h="",d="";if(i){h+=`vec2 st;
`;const _=o>1?`${c}.x`:c;d+=`    st = czm_decompressTextureCoordinates(${_});
`}n&&r&&s?(h+=`vec3 normal;
vec3 tangent;
vec3 bitangent;
`,d+=`    czm_octDecode(${c}.${i?"yz":"xy"}, normal, tangent, bitangent);
`):(n&&(h+=`vec3 normal;
`,d+=`    normal = czm_octDecode(${c}${o>1?`.${i?"y":"x"}`:""});
`),r&&(h+=`vec3 tangent;
`,d+=`    tangent = czm_octDecode(${c}.${i&&n?"z":"y"});
`),s&&(h+=`vec3 bitangent;
`,d+=`    bitangent = czm_octDecode(${c}.${i&&n?"z":"y"});
`));let p=t;p=p.replace(/in\s+vec3\s+normal;/g,""),p=p.replace(/in\s+vec2\s+st;/g,""),p=p.replace(/in\s+vec3\s+tangent;/g,""),p=p.replace(/in\s+vec3\s+bitangent;/g,""),p=Je.replaceMain(p,"czm_non_compressed_main");const g=`void main() 
{ 
${d}    czm_non_compressed_main(); 
}`;return[u,h,p,g].join(`
`)}function Lee(e){let t=Je.replaceMain(e,"czm_non_depth_clamp_main");return t+=`void main() {
    czm_non_depth_clamp_main();
    gl_Position = czm_depthClamp(gl_Position);}
`,t}function Pee(e){let t=Je.replaceMain(e,"czm_non_depth_clamp_main");return t+=`void main() {
    czm_non_depth_clamp_main();
    #if defined(LOG_DEPTH)
        czm_writeLogDepth();
    #else
        czm_writeDepthClamp();
    #endif
}
`,t}function e1(e,t){const n=e.vertexAttributes;for(const i in n)if(n.hasOwnProperty(i)&&!l(t[i]))throw new A(`Appearance/Geometry mismatch.  The appearance requires vertex shader attribute input '${i}', which was not computed as part of the Geometry.  Use the appearance's vertexFormat property when constructing the geometry.`)}function Nee(e,t){return function(){return e[t]}}const G0=Math.max(It.hardwareConcurrency-1,1);let fg;const Fee=new Dn("combineGeometry");function Bee(e,t){let n,i,r,s;const o=e._instanceIds;if(e._state===yi.READY){n=Array.isArray(e.geometryInstances)?e.geometryInstances:[e.geometryInstances];const a=e._numberOfInstances=n.length,c=[];let u=[];for(r=0;r<a;++r){if(i=n[r].geometry,o.push(n[r].id),l(i._workerName)&&l(i._workerPath)||!l(i._workerName)&&!l(i._workerPath))throw new A("Must define either _workerName or _workerPath for asynchronous geometry.");u.push({moduleName:i._workerName,modulePath:i._workerPath,geometry:i})}if(!l(fg))for(fg=new Array(G0),r=0;r<G0;r++)fg[r]=new Dn("createGeometry");let h;for(u=eK(u,G0),r=0;r<u.length;r++){let d=0;const p=u[r],g=p.length;for(s=0;s<g;++s)h=p[s],i=h.geometry,l(i.constructor.pack)&&(h.offset=d,d+=T(i.constructor.packedLength,i.packedLength));let _;if(d>0){const b=new Float64Array(d);for(_=[b.buffer],s=0;s<g;++s)h=p[s],i=h.geometry,l(i.constructor.pack)&&(i.constructor.pack(i,b,h.offset),h.geometry=b)}c.push(fg[r].scheduleTask({subTasks:u[r]},_))}e._state=yi.CREATING,Promise.all(c).then(function(d){e._createGeometryResults=d,e._state=yi.CREATED}).catch(function(d){Jd(e,t,yi.FAILED,d)})}else if(e._state===yi.CREATED){const a=[];n=Array.isArray(e.geometryInstances)?e.geometryInstances:[e.geometryInstances];const c=t.scene3DOnly,u=t.mapProjection,h=Fee.scheduleTask(Po.packCombineGeometryParameters({createGeometryResults:e._createGeometryResults,instances:n,ellipsoid:u.ellipsoid,projection:u,elementIndexUintSupported:t.context.elementIndexUint,scene3DOnly:c,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:e.modelMatrix,createPickOffsets:e._createPickOffsets},a),a);e._createGeometryResults=void 0,e._state=yi.COMBINING,Promise.resolve(h).then(function(d){const p=Po.unpackCombineGeometryResults(d);e._geometries=p.geometries,e._attributeLocations=p.attributeLocations,e.modelMatrix=P.clone(p.modelMatrix,e.modelMatrix),e._pickOffsets=p.pickOffsets,e._offsetInstanceExtend=p.offsetInstanceExtend,e._instanceBoundingSpheres=p.boundingSpheres,e._instanceBoundingSpheresCV=p.boundingSpheresCV,l(e._geometries)&&e._geometries.length>0?(e._recomputeBoundingSpheres=!0,e._state=yi.COMBINED):Jd(e,t,yi.FAILED,void 0)}).catch(function(d){Jd(e,t,yi.FAILED,d)})}}function zee(e,t){const n=Array.isArray(e.geometryInstances)?e.geometryInstances:[e.geometryInstances],i=e._numberOfInstances=n.length,r=new Array(i),s=e._instanceIds;let o,a,c=0;for(a=0;a<i;a++){o=n[a];const p=o.geometry;let g;l(p.attributes)&&l(p.primitiveType)?g=Ree(p):g=p.constructor.createGeometry(p),r[c++]=Dee(o,g),s.push(o.id)}r.length=c;const u=t.scene3DOnly,h=t.mapProjection,d=Po.combineGeometry({instances:r,ellipsoid:h.ellipsoid,projection:h,elementIndexUintSupported:t.context.elementIndexUint,scene3DOnly:u,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:e.modelMatrix,createPickOffsets:e._createPickOffsets});e._geometries=d.geometries,e._attributeLocations=d.attributeLocations,e.modelMatrix=P.clone(d.modelMatrix,e.modelMatrix),e._pickOffsets=d.pickOffsets,e._offsetInstanceExtend=d.offsetInstanceExtend,e._instanceBoundingSpheres=d.boundingSpheres,e._instanceBoundingSpheresCV=d.boundingSpheresCV,l(e._geometries)&&e._geometries.length>0?(e._recomputeBoundingSpheres=!0,e._state=yi.COMBINED):Jd(e,t,yi.FAILED,void 0)}function Uee(e,t){const n=e._batchTableAttributeIndices.offset;if(!e._recomputeBoundingSpheres||!l(n)){e._recomputeBoundingSpheres=!1;return}let i;const r=e._offsetInstanceExtend,s=e._instanceBoundingSpheres,o=s.length;let a=e._tempBoundingSpheres;if(!l(a)){for(a=new Array(o),i=0;i<o;i++)a[i]=new ee;e._tempBoundingSpheres=a}for(i=0;i<o;++i){let b=a[i];const x=e._batchTable.getBatchedAttribute(i,n,new m);b=s[i].clone(b),$P(b,x,r[i])}const c=[],u=[],h=[];for(i=0;i<o;++i){const b=a[i];b.center.x-b.radius>0||ee.intersectPlane(b,Ve.ORIGIN_ZX_PLANE)!==ut.INTERSECTING?c.push(b):(u.push(b),h.push(b))}let d=c[0],p=h[0],g=u[0];for(i=1;i<c.length;i++)d=ee.union(d,c[i]);for(i=1;i<h.length;i++)p=ee.union(p,h[i]);for(i=1;i<u.length;i++)g=ee.union(g,u[i]);const _=[];for(l(d)&&_.push(d),l(p)&&_.push(p),l(g)&&_.push(g),i=0;i<_.length;i++){const b=_[i].clone(e._boundingSpheres[i]);e._boundingSpheres[i]=b,e._boundingSphereCV[i]=ee.projectTo2D(b,t.mapProjection,e._boundingSphereCV[i])}bn._updateBoundingVolumes(e,t,e.modelMatrix,!0),e._recomputeBoundingSpheres=!1}const t1=new Tn,HP=new oe,qP=new m,WP=new ee;function kee(e,t){if(!l(e._batchTableAttributeIndices.distanceDisplayCondition)||e._batchTableBoundingSpheresUpdated)return;const i=e._batchTableBoundingSphereAttributeIndices,r=i.center3DHigh,s=i.center3DLow,o=i.center2DHigh,a=i.center2DLow,c=i.radius,u=t.mapProjection,h=u.ellipsoid,d=e._batchTable,p=e._instanceBoundingSpheres,g=p.length;for(let _=0;_<g;++_){let b=p[_];if(!l(b))continue;const x=e.modelMatrix;l(x)&&(b=ee.transform(b,x,WP));const E=b.center,C=b.radius;let w=Tn.fromCartesian(E,t1);if(d.setBatchedAttribute(_,r,w.high),d.setBatchedAttribute(_,s,w.low),!t.scene3DOnly){const S=h.cartesianToCartographic(E,HP),v=u.project(S,qP);w=Tn.fromCartesian(v,t1),d.setBatchedAttribute(_,o,w.high),d.setBatchedAttribute(_,a,w.low)}d.setBatchedAttribute(_,c,C)}e._batchTableBoundingSpheresUpdated=!0}const H0=new m,jee=new m;function n1(e,t){if(!l(e._batchTableAttributeIndices.offset)||e._batchTableOffsetsUpdated||t.scene3DOnly)return;const i=e._batchTableOffsetAttribute2DIndex,r=t.mapProjection,s=r.ellipsoid,o=e._batchTable,a=e._instanceBoundingSpheres,c=a.length;for(let u=0;u<c;++u){let h=a[u];if(!l(h))continue;const d=o.getBatchedAttribute(u,e._batchTableAttributeIndices.offset);if(m.equals(d,m.ZERO)){o.setBatchedAttribute(u,i,m.ZERO);continue}const p=e.modelMatrix;l(p)&&(h=ee.transform(h,p,WP));let g=h.center;g=s.scaleToGeodeticSurface(g,jee);let _=s.cartesianToCartographic(g,HP);const b=r.project(_,qP),x=m.add(d,g,H0);_=s.cartesianToCartographic(x,_);const E=r.project(_,H0),C=m.subtract(E,b,H0),w=C.x;C.x=C.z,C.z=C.y,C.y=w,o.setBatchedAttribute(u,i,C)}e._batchTableOffsetsUpdated=!0}function Vee(e,t){const n=e._attributeLocations,i=e._geometries,r=t.scene3DOnly,s=t.context,o=[],a=i.length;for(let c=0;c<a;++c){const u=i[c];if(o.push($i.fromGeometry({context:s,geometry:u,attributeLocations:n,bufferUsage:Ae.STATIC_DRAW,interleave:e._interleave})),l(e._createBoundingVolumeFunction))e._createBoundingVolumeFunction(t,u);else if(e._boundingSpheres.push(ee.clone(u.boundingSphere)),e._boundingSphereWC.push(new ee),!r){const h=u.boundingSphereCV.center,d=h.x,p=h.y,g=h.z;h.x=g,h.y=d,h.z=p,e._boundingSphereCV.push(ee.clone(u.boundingSphereCV)),e._boundingSphere2D.push(new ee),e._boundingSphereMorph.push(new ee)}}e._va=o,e._primitiveType=i[0].primitiveType,e.releaseGeometryInstances&&(e.geometryInstances=void 0),e._geometries=void 0,Jd(e,t,yi.COMPLETE,void 0)}function Gee(e,t,n,i){let r=n.getRenderState(),s;i?(s=Se(r,!1),s.cull={enabled:!0,face:wo.BACK},e._frontFaceRS=it.fromCache(s),s.cull.face=wo.FRONT,e._backFaceRS=it.fromCache(s)):(e._frontFaceRS=it.fromCache(r),e._backFaceRS=e._frontFaceRS),s=Se(r,!1),l(e._depthFailAppearance)&&(s.depthTest.enabled=!1),l(e._depthFailAppearance)&&(r=e._depthFailAppearance.getRenderState(),s=Se(r,!1),s.depthTest.func=Xy.GREATER,i?(s.cull={enabled:!0,face:wo.BACK},e._frontFaceDepthFailRS=it.fromCache(s),s.cull.face=wo.FRONT,e._backFaceDepthFailRS=it.fromCache(s)):(e._frontFaceDepthFailRS=it.fromCache(s),e._backFaceDepthFailRS=e._frontFaceRS))}function Hee(e,t,n){const i=t.context,r=e._attributeLocations;let s=e._batchTable.getVertexShaderCallback()(n.vertexShaderSource);s=bn._appendOffsetToShader(e,s),s=bn._appendShowToShader(e,s),s=bn._appendDistanceDisplayConditionToShader(e,s,t.scene3DOnly),s=ZI(s),s=bn._updateColorAttribute(e,s,!1),s=QI(e,s),s=bn._modifyShaderPosition(e,s,t.scene3DOnly);let o=n.getFragmentShaderSource();o=JI(o),e._sp=kn.replaceCache({context:i,shaderProgram:e._sp,vertexShaderSource:s,fragmentShaderSource:o,attributeLocations:r}),e1(e._sp,r),l(e._depthFailAppearance)&&(s=e._batchTable.getVertexShaderCallback()(e._depthFailAppearance.vertexShaderSource),s=bn._appendShowToShader(e,s),s=bn._appendDistanceDisplayConditionToShader(e,s,t.scene3DOnly),s=ZI(s),s=bn._updateColorAttribute(e,s,!0),s=QI(e,s),s=bn._modifyShaderPosition(e,s,t.scene3DOnly),s=Lee(s),o=e._depthFailAppearance.getFragmentShaderSource(),o=JI(o),o=Pee(o),e._spDepthFail=kn.replaceCache({context:i,shaderProgram:e._spDepthFail,vertexShaderSource:s,fragmentShaderSource:o,attributeLocations:r}),e1(e._spDepthFail,r))}const pd=new P,i1=new m;function r1(e,t,n,i){const r=l(n)?n._uniforms:void 0,s={},o=t.uniforms;if(l(o)){for(const c in o)if(o.hasOwnProperty(c)){if(l(r)&&l(r[c]))throw new A(`Appearance and material have a uniform with the same name: ${c}`);s[c]=Nee(o,c)}}let a=wt(s,r);return a=e._batchTable.getUniformMapCallback()(a),l(e.rtcCenter)&&(a.u_modifiedModelView=function(){const c=i.context.uniformState.view;return P.multiply(c,e._modelMatrix,pd),P.multiplyByPoint(pd,e.rtcCenter,i1),P.setTranslation(pd,i1,pd),pd}),a}function qee(e,t,n,i,r,s,o,a){const c=r1(e,t,n,a);let u;l(e._depthFailAppearance)&&(u=r1(e,e._depthFailAppearance,e._depthFailAppearance.material,a));const h=i?Ke.TRANSLUCENT:Ke.OPAQUE;let d=r?2:1;d*=l(e._depthFailAppearance)?2:1,s.length=e._va.length*d;const p=s.length;let g=0;for(let _=0;_<p;++_){let b;r&&(b=s[_],l(b)||(b=s[_]=new Tt({owner:e,primitiveType:e._primitiveType})),b.vertexArray=e._va[g],b.renderState=e._backFaceRS,b.shaderProgram=e._sp,b.uniformMap=c,b.pass=h,++_),b=s[_],l(b)||(b=s[_]=new Tt({owner:e,primitiveType:e._primitiveType})),b.vertexArray=e._va[g],b.renderState=e._frontFaceRS,b.shaderProgram=e._sp,b.uniformMap=c,b.pass=h,l(e._depthFailAppearance)&&(r&&(++_,b=s[_],l(b)||(b=s[_]=new Tt({owner:e,primitiveType:e._primitiveType})),b.vertexArray=e._va[g],b.renderState=e._backFaceDepthFailRS,b.shaderProgram=e._spDepthFail,b.uniformMap=u,b.pass=h),++_,b=s[_],l(b)||(b=s[_]=new Tt({owner:e,primitiveType:e._primitiveType})),b.vertexArray=e._va[g],b.renderState=e._frontFaceDepthFailRS,b.shaderProgram=e._spDepthFail,b.uniformMap=u,b.pass=h),++g}}bn._updateBoundingVolumes=function(e,t,n,i){let r,s,o;if(i||!P.equals(n,e._modelMatrix))for(P.clone(n,e._modelMatrix),s=e._boundingSpheres.length,r=0;r<s;++r)o=e._boundingSpheres[r],l(o)&&(e._boundingSphereWC[r]=ee.transform(o,n,e._boundingSphereWC[r]),t.scene3DOnly||(e._boundingSphere2D[r]=ee.clone(e._boundingSphereCV[r],e._boundingSphere2D[r]),e._boundingSphere2D[r].center.x=0,e._boundingSphereMorph[r]=ee.union(e._boundingSphereWC[r],e._boundingSphereCV[r])));const a=e.appearance.pixelSize;if(l(a))for(s=e._boundingSpheres.length,r=0;r<s;++r){o=e._boundingSpheres[r];const c=e._boundingSphereWC[r],h=t.camera.getPixelSize(o,t.context.drawingBufferWidth,t.context.drawingBufferHeight)*a;c.radius=o.radius+h}};function Wee(e,t,n,i,r,s,o,a){if(t.mode!==Ie.SCENE3D&&!P.equals(r,P.IDENTITY))throw new A("Primitive.modelMatrix is only supported in 3D mode.");bn._updateBoundingVolumes(e,t,r);let c;t.mode===Ie.SCENE3D?c=e._boundingSphereWC:t.mode===Ie.COLUMBUS_VIEW?c=e._boundingSphereCV:t.mode===Ie.SCENE2D&&l(e._boundingSphere2D)?c=e._boundingSphere2D:l(e._boundingSphereMorph)&&(c=e._boundingSphereMorph);const u=t.commandList,h=t.passes;if(h.render||h.pick){const d=e.allowPicking,p=rc.castShadows(e.shadows),g=rc.receiveShadows(e.shadows),_=n.length;let b=a?2:1;b*=l(e._depthFailAppearance)?2:1;for(let x=0;x<_;++x){const E=Math.floor(x/b),C=n[x];C.modelMatrix=r,C.boundingVolume=c[E],C.cull=s,C.debugShowBoundingVolume=o,C.castShadows=p,C.receiveShadows=g,d?C.pickId="v_pickColor":C.pickId=void 0,u.push(C)}}}bn.prototype.update=function(e){if(!l(this.geometryInstances)&&this._va.length===0||l(this.geometryInstances)&&Array.isArray(this.geometryInstances)&&this.geometryInstances.length===0||!l(this.appearance)||e.mode!==Ie.SCENE3D&&e.scene3DOnly||!e.passes.render&&!e.passes.pick)return;if(l(this._error))throw this._error;if(l(this.rtcCenter)&&!e.scene3DOnly)throw new A("RTC rendering is only available for 3D only scenes.");if(this._state===yi.FAILED)return;const t=e.context;if(l(this._batchTable)||Iee(this,t),this._batchTable.attributes.length>0){if(We.maximumVertexTextureImageUnits===0)throw new te("Vertex texture fetch support is required to render primitives with per-instance attributes. The maximum number of vertex texture image units must be greater than zero.");this._batchTable.update(e)}if(this._state!==yi.COMPLETE&&this._state!==yi.COMBINED&&(this.asynchronous?Bee(this,e):zee(this,e)),this._state===yi.COMBINED&&(kee(this,e),n1(this,e),Vee(this,e)),!this.show||this._state!==yi.COMPLETE)return;this._batchTableOffsetsUpdated||n1(this,e),this._recomputeBoundingSpheres&&Uee(this,e);const n=this.appearance,i=n.material;let r=!1,s=!1;this._appearance!==n?(this._appearance=n,this._material=i,r=!0,s=!0):this._material!==i&&(this._material=i,s=!0);const o=this.depthFailAppearance,a=l(o)?o.material:void 0;this._depthFailAppearance!==o?(this._depthFailAppearance=o,this._depthFailMaterial=a,r=!0,s=!0):this._depthFailMaterial!==a&&(this._depthFailMaterial=a,s=!0);const c=this._appearance.isTranslucent();this._translucent!==c&&(this._translucent=c,r=!0),l(this._material)&&this._material.update(t);const u=n.closed&&c;r&&T(this._createRenderStatesFunction,Gee)(this,t,n,u),s&&T(this._createShaderProgramFunction,Hee)(this,e,n),(r||s)&&T(this._createCommandsFunction,qee)(this,n,i,c,u,this._colorCommands,this._pickCommands,e),T(this._updateAndQueueCommandsFunction,Wee)(this,e,this._colorCommands,this._pickCommands,this.modelMatrix,this.cull,this.debugShowBoundingVolume,u)};const $ee=new ee,Xee=new ee;function $P(e,t,n){if(n===Js.TOP){const i=ee.clone(e,$ee),r=ee.clone(e,Xee);r.center=m.add(r.center,t,r.center),e=ee.union(i,r,e)}else n===Js.ALL&&(e.center=m.add(e.center,t,e.center));return e}function Yee(e,t,n){return function(){const i=e.getBatchedAttribute(t,n),r=e.attributes[n],s=r.componentsPerAttribute,o=q.createTypedArray(r.componentDatatype,s);return l(i.constructor.pack)?i.constructor.pack(i,o,0):o[0]=i,o}}function Kee(e,t,n,i,r){return function(s){if(!l(s)||!l(s.length)||s.length<1||s.length>4)throw new A("value must be and array with length between 1 and 4.");const o=GP(s);e.setBatchedAttribute(t,n,o),r==="offset"&&(i._recomputeBoundingSpheres=!0,i._batchTableOffsetsUpdated=!1)}}const Zee=new m;function Jee(e,t,n){t.boundingSphere={get:function(){let i=e._instanceBoundingSpheres[n];if(l(i)){i=i.clone();const r=e.modelMatrix,s=t.offset;l(s)&&$P(i,m.fromArray(s.get(),0,Zee),e._offsetInstanceExtend[n]),l(r)&&(i=ee.transform(i,r))}return i}},t.boundingSphereCV={get:function(){return e._instanceBoundingSpheresCV[n]}}}function Qee(e,t,n){t.pickId={get:function(){return e._pickIds[n]}}}bn.prototype.getGeometryInstanceAttributes=function(e){if(!l(e))throw new A("id is required");if(!l(this._batchTable))throw new A("must call update before calling getGeometryInstanceAttributes");let t=this._perInstanceAttributeCache.get(e);if(l(t))return t;let n=-1;const i=this._lastPerInstanceAttributeIndex,r=this._instanceIds,s=r.length;for(let u=0;u<s;++u){const h=(i+u)%s;if(e===r[h]){n=h;break}}if(n===-1)return;const o=this._batchTable,a=this._batchTableAttributeIndices;t={};const c={};for(const u in a)if(a.hasOwnProperty(u)){const h=a[u];c[u]={get:Yee(o,n,h),set:Kee(o,n,h,this,u)}}return Jee(this,c,n),Qee(this,c,n),Object.defineProperties(t,c),this._lastPerInstanceAttributeIndex=n,this._perInstanceAttributeCache.set(e,t),t};bn.prototype.isDestroyed=function(){return!1};bn.prototype.destroy=function(){let e,t;this._sp=this._sp&&this._sp.destroy(),this._spDepthFail=this._spDepthFail&&this._spDepthFail.destroy();const n=this._va;for(e=n.length,t=0;t<e;++t)n[t].destroy();this._va=void 0;const i=this._pickIds;for(e=i.length,t=0;t<e;++t)i[t].destroy();return this._pickIds=void 0,this._batchTable=this._batchTable&&this._batchTable.destroy(),this._instanceIds=void 0,this._perInstanceAttributeCache=void 0,this._attributeLocations=void 0,Ye(this)};function Jd(e,t,n,i){e._error=i,e._state=n,t.afterRender.push(function(){e._ready=e._state===yi.COMPLETE||e._state===yi.FAILED})}const ete={NEVER:j.NEVER,LESS:j.LESS,EQUAL:j.EQUAL,LESS_OR_EQUAL:j.LEQUAL,GREATER:j.GREATER,NOT_EQUAL:j.NOTEQUAL,GREATER_OR_EQUAL:j.GEQUAL,ALWAYS:j.ALWAYS},Ei=Object.freeze(ete),tte={ZERO:j.ZERO,KEEP:j.KEEP,REPLACE:j.REPLACE,INCREMENT:j.INCR,DECREMENT:j.DECR,INVERT:j.INVERT,INCREMENT_WRAP:j.INCR_WRAP,DECREMENT_WRAP:j.DECR_WRAP},Qe=Object.freeze(tte),a_={CESIUM_3D_TILE_MASK:128,SKIP_LOD_MASK:112,SKIP_LOD_BIT_SHIFT:4,CLASSIFICATION_MASK:15};a_.setCesium3DTileBit=function(){return{enabled:!0,frontFunction:Ei.ALWAYS,frontOperation:{fail:Qe.KEEP,zFail:Qe.KEEP,zPass:Qe.REPLACE},backFunction:Ei.ALWAYS,backOperation:{fail:Qe.KEEP,zFail:Qe.KEEP,zPass:Qe.REPLACE},reference:a_.CESIUM_3D_TILE_MASK,mask:a_.CESIUM_3D_TILE_MASK}};const yt=Object.freeze(a_),lw=`void clipLineSegmentToNearPlane(
    vec3 p0,
    vec3 p1,
    out vec4 positionWC,
    out bool clipped,
    out bool culledByNearPlane,
    out vec4 clippedPositionEC)
{
    culledByNearPlane = false;
    clipped = false;

    vec3 p0ToP1 = p1 - p0;
    float magnitude = length(p0ToP1);
    vec3 direction = normalize(p0ToP1);

    // Distance that p0 is behind the near plane. Negative means p0 is
    // in front of the near plane.
    float endPoint0Distance =  czm_currentFrustum.x + p0.z;

    // Camera looks down -Z.
    // When moving a point along +Z: LESS VISIBLE
    //   * Points in front of the camera move closer to the camera.
    //   * Points behind the camrea move farther away from the camera.
    // When moving a point along -Z: MORE VISIBLE
    //   * Points in front of the camera move farther away from the camera.
    //   * Points behind the camera move closer to the camera.

    // Positive denominator: -Z, becoming more visible
    // Negative denominator: +Z, becoming less visible
    // Nearly zero: parallel to near plane
    float denominator = -direction.z;

    if (endPoint0Distance > 0.0 && abs(denominator) < czm_epsilon7)
    {
        // p0 is behind the near plane and the line to p1 is nearly parallel to
        // the near plane, so cull the segment completely.
        culledByNearPlane = true;
    }
    else if (endPoint0Distance > 0.0)
    {
        // p0 is behind the near plane, and the line to p1 is moving distinctly
        // toward or away from it.

        // t = (-plane distance - dot(plane normal, ray origin)) / dot(plane normal, ray direction)
        float t = endPoint0Distance / denominator;
        if (t < 0.0 || t > magnitude)
        {
            // Near plane intersection is not between the two points.
            // We already confirmed p0 is behind the naer plane, so now
            // we know the entire segment is behind it.
            culledByNearPlane = true;
        }
        else
        {
            // Segment crosses the near plane, update p0 to lie exactly on it.
            p0 = p0 + t * direction;

            // Numerical noise might put us a bit on the wrong side of the near plane.
            // Don't let that happen.
            p0.z = min(p0.z, -czm_currentFrustum.x);

            clipped = true;
        }
    }

    clippedPositionEC = vec4(p0, 1.0);
    positionWC = czm_eyeToWindowCoordinates(clippedPositionEC);
}

vec4 getPolylineWindowCoordinatesEC(vec4 positionEC, vec4 prevEC, vec4 nextEC, float expandDirection, float width, bool usePrevious, out float angle)
{
    // expandDirection +1 is to the _left_ when looking from positionEC toward nextEC.

#ifdef POLYLINE_DASH
    // Compute the window coordinates of the points.
    vec4 positionWindow = czm_eyeToWindowCoordinates(positionEC);
    vec4 previousWindow = czm_eyeToWindowCoordinates(prevEC);
    vec4 nextWindow = czm_eyeToWindowCoordinates(nextEC);

    // Determine the relative screen space direction of the line.
    vec2 lineDir;
    if (usePrevious) {
        lineDir = normalize(positionWindow.xy - previousWindow.xy);
    }
    else {
        lineDir = normalize(nextWindow.xy - positionWindow.xy);
    }
    angle = atan(lineDir.x, lineDir.y) - 1.570796327; // precomputed atan(1,0)

    // Quantize the angle so it doesn't change rapidly between segments.
    angle = floor(angle / czm_piOverFour + 0.5) * czm_piOverFour;
#endif

    vec4 clippedPrevWC, clippedPrevEC;
    bool prevSegmentClipped, prevSegmentCulled;
    clipLineSegmentToNearPlane(prevEC.xyz, positionEC.xyz, clippedPrevWC, prevSegmentClipped, prevSegmentCulled, clippedPrevEC);

    vec4 clippedNextWC, clippedNextEC;
    bool nextSegmentClipped, nextSegmentCulled;
    clipLineSegmentToNearPlane(nextEC.xyz, positionEC.xyz, clippedNextWC, nextSegmentClipped, nextSegmentCulled, clippedNextEC);

    bool segmentClipped, segmentCulled;
    vec4 clippedPositionWC, clippedPositionEC;
    clipLineSegmentToNearPlane(positionEC.xyz, usePrevious ? prevEC.xyz : nextEC.xyz, clippedPositionWC, segmentClipped, segmentCulled, clippedPositionEC);

    if (segmentCulled)
    {
        return vec4(0.0, 0.0, 0.0, 1.0);
    }

    vec2 directionToPrevWC = normalize(clippedPrevWC.xy - clippedPositionWC.xy);
    vec2 directionToNextWC = normalize(clippedNextWC.xy - clippedPositionWC.xy);

    // If a segment was culled, we can't use the corresponding direction
    // computed above. We should never see both of these be true without
    // \`segmentCulled\` above also being true.
    if (prevSegmentCulled)
    {
        directionToPrevWC = -directionToNextWC;
    }
    else if (nextSegmentCulled)
    {
        directionToNextWC = -directionToPrevWC;
    }

    vec2 thisSegmentForwardWC, otherSegmentForwardWC;
    if (usePrevious)
    {
        thisSegmentForwardWC = -directionToPrevWC;
        otherSegmentForwardWC = directionToNextWC;
    }
    else
    {
        thisSegmentForwardWC = directionToNextWC;
        otherSegmentForwardWC =  -directionToPrevWC;
    }

    vec2 thisSegmentLeftWC = vec2(-thisSegmentForwardWC.y, thisSegmentForwardWC.x);

    vec2 leftWC = thisSegmentLeftWC;
    float expandWidth = width * 0.5;

    // When lines are split at the anti-meridian, the position may be at the
    // same location as the next or previous position, and we need to handle
    // that to avoid producing NaNs.
    if (!czm_equalsEpsilon(prevEC.xyz - positionEC.xyz, vec3(0.0), czm_epsilon1) && !czm_equalsEpsilon(nextEC.xyz - positionEC.xyz, vec3(0.0), czm_epsilon1))
    {
        vec2 otherSegmentLeftWC = vec2(-otherSegmentForwardWC.y, otherSegmentForwardWC.x);

        vec2 leftSumWC = thisSegmentLeftWC + otherSegmentLeftWC;
        float leftSumLength = length(leftSumWC);
        leftWC = leftSumLength < czm_epsilon6 ? thisSegmentLeftWC : (leftSumWC / leftSumLength);

        // The sine of the angle between the two vectors is given by the formula
        //         |a x b| = |a||b|sin(theta)
        // which is
        //     float sinAngle = length(cross(vec3(leftWC, 0.0), vec3(-thisSegmentForwardWC, 0.0)));
        // Because the z components of both vectors are zero, the x and y coordinate will be zero.
        // Therefore, the sine of the angle is just the z component of the cross product.
        vec2 u = -thisSegmentForwardWC;
        vec2 v = leftWC;
        float sinAngle = abs(u.x * v.y - u.y * v.x);
        expandWidth = clamp(expandWidth / sinAngle, 0.0, width * 2.0);
    }

    vec2 offset = leftWC * expandDirection * expandWidth * czm_pixelRatio;
    return vec4(clippedPositionWC.xy + offset, -clippedPositionWC.z, 1.0) * (czm_projection * clippedPositionEC).w;
}

vec4 getPolylineWindowCoordinates(vec4 position, vec4 previous, vec4 next, float expandDirection, float width, bool usePrevious, out float angle)
{
    vec4 positionEC = czm_modelViewRelativeToEye * position;
    vec4 prevEC = czm_modelViewRelativeToEye * previous;
    vec4 nextEC = czm_modelViewRelativeToEye * next;
    return getPolylineWindowCoordinatesEC(positionEC, prevEC, nextEC, expandDirection, width, usePrevious, angle);
}
`,nte=`#ifdef VECTOR_TILE
uniform vec4 u_highlightColor;
#endif

in vec2 v_st;

void main()
{
    czm_materialInput materialInput;

    vec2 st = v_st;
    st.t = czm_readNonPerspective(st.t, gl_FragCoord.w);

    materialInput.s = st.s;
    materialInput.st = st;
    materialInput.str = vec3(st, 0.0);

    czm_material material = czm_getMaterial(materialInput);
    out_FragColor = vec4(material.diffuse + material.emission, material.alpha);
#ifdef VECTOR_TILE
    out_FragColor *= u_highlightColor;
#endif

    czm_writeLogDepth();
}
`,ite=`in vec2 v_textureCoordinates;

uniform float originalSize;
uniform sampler2D texture0;
uniform sampler2D texture1;
uniform sampler2D texture2;
uniform sampler2D texture3;
uniform sampler2D texture4;
uniform sampler2D texture5;

const float yMipLevel1 = 1.0 - (1.0 / pow(2.0, 1.0));
const float yMipLevel2 = 1.0 - (1.0 / pow(2.0, 2.0));
const float yMipLevel3 = 1.0 - (1.0 / pow(2.0, 3.0));
const float yMipLevel4 = 1.0 - (1.0 / pow(2.0, 4.0));

void main()
{
    vec2 uv = v_textureCoordinates;
    vec2 textureSize = vec2(originalSize * 1.5 + 2.0, originalSize);
    vec2 pixel = 1.0 / textureSize;

    float mipLevel = 0.0;

    if (uv.x - pixel.x > (textureSize.y / textureSize.x))
    {
        mipLevel = 1.0;
        if (uv.y - pixel.y > yMipLevel1)
        {
            mipLevel = 2.0;
            if (uv.y - pixel.y * 3.0 > yMipLevel2)
            {
                mipLevel = 3.0;
                if (uv.y - pixel.y * 5.0 > yMipLevel3)
                {
                    mipLevel = 4.0;
                    if (uv.y - pixel.y * 7.0 > yMipLevel4)
                    {
                        mipLevel = 5.0;
                    }
                }
            }
        }
    }

    if (mipLevel > 0.0)
    {
        float scale = pow(2.0, mipLevel);

        uv.y -= (pixel.y * (mipLevel - 1.0) * 2.0);
        uv.x *= ((textureSize.x - 2.0) / textureSize.y);

        uv.x -= 1.0 + pixel.x;
        uv.y -= (1.0 - (1.0 / pow(2.0, mipLevel - 1.0)));
        uv *= scale;
    }
    else
    {
        uv.x *= (textureSize.x / textureSize.y);
    }

    if(mipLevel == 0.0)
    {
        out_FragColor = texture(texture0, uv);
    }
    else if(mipLevel == 1.0)
    {
        out_FragColor = texture(texture1, uv);
    }
    else if(mipLevel == 2.0)
    {
        out_FragColor = texture(texture2, uv);
    }
    else if(mipLevel == 3.0)
    {
        out_FragColor = texture(texture3, uv);
    }
    else if(mipLevel == 4.0)
    {
        out_FragColor = texture(texture4, uv);
    }
    else if(mipLevel == 5.0)
    {
        out_FragColor = texture(texture5, uv);
    }
    else
    {
        out_FragColor = vec4(0.0);
    }
}
`,rte=`in vec3 v_cubeMapCoordinates;
uniform samplerCube cubeMap;

void main()
{
    vec4 rgba = czm_textureCube(cubeMap, v_cubeMapCoordinates);
    #ifdef RGBA_NORMALIZED
        out_FragColor = vec4(rgba.rgb, 1.0);
    #else
        float m = rgba.a * 16.0;
        vec3 r = rgba.rgb * m;
        out_FragColor = vec4(r * r, 1.0);
    #endif
}
`,ste=`in vec4 position;
in vec3 cubeMapCoordinates;

out vec3 v_cubeMapCoordinates;

void main()
{
    gl_Position = position;
    v_cubeMapCoordinates = cubeMapCoordinates;
}
`;function sc(e){this._url=e,this._cubeMapBuffers=void 0,this._cubeMaps=void 0,this._texture=void 0,this._mipTextures=void 0,this._va=void 0,this._sp=void 0,this._maximumMipmapLevel=void 0,this._loading=!1,this._ready=!1,this._errorEvent=new jt}Object.defineProperties(sc.prototype,{url:{get:function(){return this._url}},errorEvent:{get:function(){return this._errorEvent}},texture:{get:function(){return this._texture}},maximumMipmapLevel:{get:function(){return this._maximumMipmapLevel}},ready:{get:function(){return this._ready}}});sc.isSupported=function(e){return e.colorBufferHalfFloat&&e.halfFloatingPointTexture||e.floatingPointTexture&&e.colorBufferFloat};const ote=new m(1,0,0),ate=new m(0,0,1),cte=new m(-1,0,0),lte=new m(0,0,-1),hg=new m(0,1,0),ute=new m(0,-1,0),XP=[hg,cte,ate,ute,ote,hg,lte,hg,hg],YP=XP.length,KP=new Float32Array(YP*3);let s1=0;for(let e=0;e<YP;++e,s1+=3)m.pack(XP[e],KP,s1);const fte=new Float32Array([-1,1,-1,0,0,1,0,0,1,0,1,1,0,-1,-1,-1,1,-1]),hte=new Uint16Array([0,1,2,2,3,1,7,6,1,3,6,1,2,5,4,3,4,2,4,8,6,3,4,6]);function dte(e){const t=ze.createVertexBuffer({context:e,typedArray:fte,usage:Ae.STATIC_DRAW}),n=ze.createVertexBuffer({context:e,typedArray:KP,usage:Ae.STATIC_DRAW}),i=ze.createIndexBuffer({context:e,typedArray:hte,usage:Ae.STATIC_DRAW,indexDatatype:Ge.UNSIGNED_SHORT}),r=[{index:0,vertexBuffer:t,componentsPerAttribute:2,componentDatatype:q.FLOAT},{index:1,vertexBuffer:n,componentsPerAttribute:3,componentDatatype:q.FLOAT}];return new $i({context:e,attributes:r,indexBuffer:i})}function o1(e){return function(){return e}}function eE(e){e._va=e._va&&e._va.destroy(),e._sp=e._sp&&e._sp.destroy();let t,n;const i=e._cubeMaps;if(l(i))for(n=i.length,t=0;t<n;++t)i[t].destroy();const r=e._mipTextures;if(l(r))for(n=r.length,t=0;t<n;++t)r[t].destroy();e._va=void 0,e._sp=void 0,e._cubeMaps=void 0,e._cubeMapBuffers=void 0,e._mipTextures=void 0}sc.prototype.update=function(e){const t=e.context;if(!sc.isSupported(t)||(l(this._texture)&&l(this._va)&&eE(this),l(this._texture)))return;if(!l(this._texture)&&!this._loading){const g=e.context.textureCache.getTexture(this._url);l(g)&&(eE(this),this._texture=g,this._maximumMipmapLevel=this._texture.maximumMipmapLevel,this._ready=!0)}const n=this._cubeMapBuffers;if(!l(n)&&!this._loading){const g=this;Dh(this._url).then(function(_){g._cubeMapBuffers=_,g._loading=!1}).catch(function(_){g.isDestroyed()||g._errorEvent.raiseEvent(_)}),this._loading=!0}if(!l(this._cubeMapBuffers))return;const i=[];let r=n[0].positiveX.pixelDatatype;l(r)?i.push("RGBA_NORMALIZED"):r=t.halfFloatingPointTexture?De.HALF_FLOAT:De.FLOAT;const s=Le.RGBA,o=new Je({defines:i,sources:[rte]});this._va=dte(t),this._sp=kn.fromCache({context:t,vertexShaderSource:ste,fragmentShaderSource:o,attributeLocations:{position:0,cubeMapCoordinates:1}});const a=n.length;this._maximumMipmapLevel=a-1;const c=this._cubeMaps=new Array(a),u=this._mipTextures=new Array(a),h=n[0].positiveX.width*2,d={originalSize:function(){return h}};for(let g=0;g<a;++g){const _=n[g].positiveY;n[g].positiveY=n[g].negativeY,n[g].negativeY=_;const b=c[g]=new Fu({context:t,source:n[g],pixelDatatype:r}),x=c[g].width*2,E=u[g]=new kt({context:t,width:x,height:x,pixelDatatype:r,pixelFormat:s}),C=new Ip({vertexArray:this._va,shaderProgram:this._sp,uniformMap:{cubeMap:o1(b)},outputTexture:E,persists:!0,owner:this});e.commandList.push(C),d[`texture${g}`]=o1(E)}this._texture=new kt({context:t,width:h*1.5+2,height:h,pixelDatatype:r,pixelFormat:s}),this._texture.maximumMipmapLevel=this._maximumMipmapLevel,t.textureCache.addTexture(this._url,this._texture);const p=new Ip({fragmentShaderSource:ite,uniformMap:d,outputTexture:this._texture,persists:!1,owner:this});e.commandList.push(p),this._ready=!0};sc.prototype.isDestroyed=function(){return!1};sc.prototype.destroy=function(){return eE(this),this._texture=this._texture&&this._texture.destroy(),Ye(this)};function Lh(e){e=T(e,T.EMPTY_OBJECT);const t=l(e.imageBasedLightingFactor)?k.clone(e.imageBasedLightingFactor):new k(1,1);y.typeOf.object("options.imageBasedLightingFactor",t),y.typeOf.number.greaterThanOrEquals("options.imageBasedLightingFactor.x",t.x,0),y.typeOf.number.lessThanOrEquals("options.imageBasedLightingFactor.x",t.x,1),y.typeOf.number.greaterThanOrEquals("options.imageBasedLightingFactor.y",t.y,0),y.typeOf.number.lessThanOrEquals("options.imageBasedLightingFactor.y",t.y,1),this._imageBasedLightingFactor=t;const n=T(e.luminanceAtZenith,.2);y.typeOf.number("options.luminanceAtZenith",n),this._luminanceAtZenith=n;const i=e.sphericalHarmonicCoefficients;if(l(i)&&(!Array.isArray(i)||i.length!==9))throw new A("options.sphericalHarmonicCoefficients must be an array of 9 Cartesian3 values.");this._sphericalHarmonicCoefficients=i,this._specularEnvironmentMaps=e.specularEnvironmentMaps,this._specularEnvironmentMapAtlas=void 0,this._specularEnvironmentMapAtlasDirty=!0,this._specularEnvironmentMapLoaded=!1,this._previousSpecularEnvironmentMapLoaded=!1,this._useDefaultSpecularMaps=!1,this._useDefaultSphericalHarmonics=!1,this._shouldRegenerateShaders=!1,this._previousFrameNumber=void 0,this._previousImageBasedLightingFactor=k.clone(t),this._previousLuminanceAtZenith=n,this._previousSphericalHarmonicCoefficients=i,this._removeErrorListener=void 0}Object.defineProperties(Lh.prototype,{imageBasedLightingFactor:{get:function(){return this._imageBasedLightingFactor},set:function(e){y.typeOf.object("imageBasedLightingFactor",e),y.typeOf.number.greaterThanOrEquals("imageBasedLightingFactor.x",e.x,0),y.typeOf.number.lessThanOrEquals("imageBasedLightingFactor.x",e.x,1),y.typeOf.number.greaterThanOrEquals("imageBasedLightingFactor.y",e.y,0),y.typeOf.number.lessThanOrEquals("imageBasedLightingFactor.y",e.y,1),this._previousImageBasedLightingFactor=k.clone(this._imageBasedLightingFactor,this._previousImageBasedLightingFactor),this._imageBasedLightingFactor=k.clone(e,this._imageBasedLightingFactor)}},luminanceAtZenith:{get:function(){return this._luminanceAtZenith},set:function(e){this._previousLuminanceAtZenith=this._luminanceAtZenith,this._luminanceAtZenith=e}},sphericalHarmonicCoefficients:{get:function(){return this._sphericalHarmonicCoefficients},set:function(e){if(l(e)&&(!Array.isArray(e)||e.length!==9))throw new A("sphericalHarmonicCoefficients must be an array of 9 Cartesian3 values.");this._previousSphericalHarmonicCoefficients=this._sphericalHarmonicCoefficients,this._sphericalHarmonicCoefficients=e}},specularEnvironmentMaps:{get:function(){return this._specularEnvironmentMaps},set:function(e){e!==this._specularEnvironmentMaps&&(this._specularEnvironmentMapAtlasDirty=this._specularEnvironmentMapAtlasDirty||e!==this._specularEnvironmentMaps,this._specularEnvironmentMapLoaded=!1),this._specularEnvironmentMaps=e}},enabled:{get:function(){return this._imageBasedLightingFactor.x>0||this._imageBasedLightingFactor.y>0}},shouldRegenerateShaders:{get:function(){return this._shouldRegenerateShaders}},useDefaultSphericalHarmonics:{get:function(){return this._useDefaultSphericalHarmonics}},useSphericalHarmonicCoefficients:{get:function(){return l(this._sphericalHarmonicCoefficients)||this._useDefaultSphericalHarmonics}},specularEnvironmentMapAtlas:{get:function(){return this._specularEnvironmentMapAtlas}},useDefaultSpecularMaps:{get:function(){return this._useDefaultSpecularMaps}},useSpecularEnvironmentMaps:{get:function(){return l(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.ready||this._useDefaultSpecularMaps}}});function pte(e,t){if(sc.isSupported(t)){if(e._specularEnvironmentMapAtlas=e._specularEnvironmentMapAtlas&&e._specularEnvironmentMapAtlas.destroy(),l(e._specularEnvironmentMaps)){const n=new sc(e._specularEnvironmentMaps);e._specularEnvironmentMapAtlas=n,e._removeErrorListener=n.errorEvent.addEventListener(i=>{console.error(`Error loading specularEnvironmentMaps: ${i}`)})}e._shouldRegenerateShaders=!0}}Lh.prototype.update=function(e){if(e.frameNumber===this._previousFrameNumber)return;this._previousFrameNumber=e.frameNumber;const t=e.context;e.brdfLutGenerator.update(e),this._shouldRegenerateShaders=!1;const n=this._imageBasedLightingFactor,i=this._previousImageBasedLightingFactor;k.equals(n,i)||(this._shouldRegenerateShaders=n.x>0&&i.x===0||n.x===0&&i.x>0,this._shouldRegenerateShaders=this._shouldRegenerateShaders||n.y>0&&i.y===0||n.y===0&&i.y>0,this._previousImageBasedLightingFactor=k.clone(this._imageBasedLightingFactor,this._previousImageBasedLightingFactor)),this._luminanceAtZenith!==this._previousLuminanceAtZenith&&(this._shouldRegenerateShaders=this._shouldRegenerateShaders||l(this._luminanceAtZenith)!==l(this._previousLuminanceAtZenith),this._previousLuminanceAtZenith=this._luminanceAtZenith),this._previousSphericalHarmonicCoefficients!==this._sphericalHarmonicCoefficients&&(this._shouldRegenerateShaders=this._shouldRegenerateShaders||l(this._previousSphericalHarmonicCoefficients)!==l(this._sphericalHarmonicCoefficients),this._previousSphericalHarmonicCoefficients=this._sphericalHarmonicCoefficients),this._shouldRegenerateShaders=this._shouldRegenerateShaders||this._previousSpecularEnvironmentMapLoaded!==this._specularEnvironmentMapLoaded,this._previousSpecularEnvironmentMapLoaded=this._specularEnvironmentMapLoaded,this._specularEnvironmentMapAtlasDirty&&(pte(this,t),this._specularEnvironmentMapAtlasDirty=!1),l(this._specularEnvironmentMapAtlas)&&(this._specularEnvironmentMapAtlas.update(e),this._specularEnvironmentMapAtlas.ready&&(this._specularEnvironmentMapLoaded=!0));const r=!l(this._specularEnvironmentMapAtlas)&&l(e.specularEnvironmentMaps)&&!this._useDefaultSpecularMaps,s=!l(e.specularEnvironmentMaps)&&this._useDefaultSpecularMaps,o=!l(this._sphericalHarmonicCoefficients)&&l(e.sphericalHarmonicCoefficients)&&!this._useDefaultSphericalHarmonics,a=!l(e.sphericalHarmonicCoefficients)&&this._useDefaultSphericalHarmonics;this._shouldRegenerateShaders=this._shouldRegenerateShaders||r||s||o||a,this._useDefaultSpecularMaps=!l(this._specularEnvironmentMapAtlas)&&l(e.specularEnvironmentMaps),this._useDefaultSphericalHarmonics=!l(this._sphericalHarmonicCoefficients)&&l(e.sphericalHarmonicCoefficients)};Lh.prototype.isDestroyed=function(){return!1};Lh.prototype.destroy=function(){return this._specularEnvironmentMapAtlas=this._specularEnvironmentMapAtlas&&this._specularEnvironmentMapAtlas.destroy(),this._removeErrorListener=this._removeErrorListener&&this._removeErrorListener(),Ye(this)};const oc={X:0,Y:1,Z:2};oc.Y_UP_TO_Z_UP=P.fromRotationTranslation(H.fromArray([1,0,0,0,0,1,0,-1,0]));oc.Z_UP_TO_Y_UP=P.fromRotationTranslation(H.fromArray([1,0,0,0,0,-1,0,1,0]));oc.X_UP_TO_Z_UP=P.fromRotationTranslation(H.fromArray([0,0,1,0,1,0,-1,0,0]));oc.Z_UP_TO_X_UP=P.fromRotationTranslation(H.fromArray([0,0,-1,0,1,0,1,0,0]));oc.X_UP_TO_Y_UP=P.fromRotationTranslation(H.fromArray([0,1,0,-1,0,0,0,0,1]));oc.Y_UP_TO_X_UP=P.fromRotationTranslation(H.fromArray([0,-1,0,1,0,0,0,0,1]));oc.fromName=function(e){return y.typeOf.string("name",e),oc[e]};const ir=Object.freeze(oc);function uw(e){e=T(e,T.EMPTY_OBJECT),y.typeOf.object("options.metadata",e.metadata),this._metadata=e.metadata}Object.defineProperties(uw.prototype,{metadata:{get:function(){return this._metadata}}});function so(e,t,n,i){this._tileset=e,this._tile=t,this._resource=n,l(i)||(i=[]),this._contents=i,this._metadata=void 0,this._group=void 0,this._ready=!1}Object.defineProperties(so.prototype,{featurePropertiesDirty:{get:function(){const e=this._contents,t=e.length;for(let n=0;n<t;++n)if(e[n].featurePropertiesDirty)return!0;return!1},set:function(e){const t=this._contents,n=t.length;for(let i=0;i<n;++i)t[i].featurePropertiesDirty=e}},featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){return this._contents}},ready:{get:function(){return this._ready}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},metadata:{get:function(){return this._metadata},set:function(e){this._metadata=e;const t=this._contents,n=t.length;for(let i=0;i<n;++i)t[i].metadata=e}},batchTable:{get:function(){}},group:{get:function(){return this._group},set:function(e){this._group=e;const t=this._contents,n=t.length;for(let i=0;i<n;++i)t[i].group=e}}});const md=Uint32Array.BYTES_PER_ELEMENT;so.fromTileType=async function(e,t,n,i,r,s){r=T(r,0);const o=new Uint8Array(i),a=new DataView(i);r+=md;const c=a.getUint32(r,!0);if(c!==1)throw new te(`Only Composite Tile version 1 is supported. Version ${c} is not.`);r+=md,r+=md;const u=a.getUint32(r,!0);r+=md;let h=n.queryParameters.compositeIndex;l(h)?h=`${h}_`:h="";const d=[];d.length=u;for(let _=0;_<u;++_){const b=$y(o,r),x=a.getUint32(r+md*2,!0),E=s[b],C=`${h}${_}`,w=n.getDerivedResource({queryParameters:{compositeIndex:C}});if(l(E))d[_]=Promise.resolve(E(e,t,w,i,r));else throw new te(`Unknown tile content type, ${b}, inside Composite tile`);r+=x}const p=await Promise.all(d);return new so(e,t,n,p)};so.prototype.hasProperty=function(e,t){return!1};so.prototype.getFeature=function(e){};so.prototype.applyDebugSettings=function(e,t){const n=this._contents,i=n.length;for(let r=0;r<i;++r)n[r].applyDebugSettings(e,t)};so.prototype.applyStyle=function(e){const t=this._contents,n=t.length;for(let i=0;i<n;++i)t[i].applyStyle(e)};so.prototype.update=function(e,t){const n=this._contents,i=n.length;let r=!0;for(let s=0;s<i;++s)n[s].update(e,t),r=r&&n[s].ready;!this._ready&&r&&(this._ready=!0)};so.prototype.pick=function(e,t,n){if(!this._ready)return;let i,r=Number.POSITIVE_INFINITY;const s=this._contents,o=s.length;for(let a=0;a<o;++a){const c=s[a].pick(e,t,n);if(!l(c))continue;const u=m.distance(e.origin,c);u<r&&(i=c,r=u)}if(l(i))return n};so.prototype.isDestroyed=function(){return!1};so.prototype.destroy=function(){const e=this._contents,t=e.length;for(let n=0;n<t;++n)e[n].destroy();return Ye(this)};function zn(e){y.typeOf.number("options.featuresLength",e.featuresLength),y.typeOf.object("options.owner",e.owner),this._id=dc();const t=e.featuresLength;this._showAlphaProperties=void 0,this._batchValues=void 0,this._batchValuesDirty=!1,this._batchTexture=void 0,this._defaultTexture=void 0,this._pickTexture=void 0,this._pickIds=[];let n,i;if(t>0){const r=Math.min(t,We.maximumTextureSize),s=Math.ceil(t/We.maximumTextureSize),o=1/r,a=o*.5,c=1/s,u=c*.5;n=new k(r,s),i=new Y(o,a,c,u)}this._translucentFeaturesLength=0,this._featuresLength=t,this._textureDimensions=n,this._textureStep=i,this._owner=e.owner,this._statistics=e.statistics,this._colorChangedCallback=e.colorChangedCallback}Object.defineProperties(zn.prototype,{translucentFeaturesLength:{get:function(){return this._translucentFeaturesLength}},byteLength:{get:function(){let e=0;return l(this._pickTexture)&&(e+=this._pickTexture.sizeInBytes),l(this._batchTexture)&&(e+=this._batchTexture.sizeInBytes),e}},textureDimensions:{get:function(){return this._textureDimensions}},textureStep:{get:function(){return this._textureStep}},batchTexture:{get:function(){return this._batchTexture}},defaultTexture:{get:function(){return this._defaultTexture}},pickTexture:{get:function(){return this._pickTexture}}});zn.DEFAULT_COLOR_VALUE=M.WHITE;zn.DEFAULT_SHOW_VALUE=!0;function ZP(e){const t=e._textureDimensions;return t.x*t.y*4}function JP(e){if(!l(e._batchValues)){const t=ZP(e),n=new Uint8Array(t).fill(255);e._batchValues=n}return e._batchValues}function QP(e){if(!l(e._showAlphaProperties)){const t=2*e._featuresLength,n=new Uint8Array(t).fill(255);e._showAlphaProperties=n}return e._showAlphaProperties}function nm(e,t){if(!l(e)||e<0||e>=t)throw new A(`batchId is required and between zero and featuresLength - 1 (${t}`-+").")}zn.prototype.setShow=function(e,t){if(nm(e,this._featuresLength),y.typeOf.bool("show",t),t&&!l(this._showAlphaProperties))return;const n=QP(this),i=e*2,r=t?255:0;if(n[i]!==r){n[i]=r;const s=JP(this),o=e*4+3;s[o]=t?n[i+1]:0,this._batchValuesDirty=!0}};zn.prototype.setAllShow=function(e){y.typeOf.bool("show",e);const t=this._featuresLength;for(let n=0;n<t;++n)this.setShow(n,e)};zn.prototype.getShow=function(e){if(nm(e,this._featuresLength),!l(this._showAlphaProperties))return!0;const t=e*2;return this._showAlphaProperties[t]===255};const mte=new Array(4);zn.prototype.setColor=function(e,t){if(nm(e,this._featuresLength),y.typeOf.object("color",t),M.equals(t,zn.DEFAULT_COLOR_VALUE)&&!l(this._batchValues))return;const n=t.toBytes(mte),i=n[3],r=JP(this),s=e*4,o=QP(this),a=e*2;if(r[s]!==n[0]||r[s+1]!==n[1]||r[s+2]!==n[2]||o[a+1]!==i){r[s]=n[0],r[s+1]=n[1],r[s+2]=n[2];const c=o[a+1]!==255,u=o[a]!==0;r[s+3]=u?i:0,o[a+1]=i;const h=i!==255;h&&!c?++this._translucentFeaturesLength:!h&&c&&--this._translucentFeaturesLength,this._batchValuesDirty=!0,l(this._colorChangedCallback)&&this._colorChangedCallback(e,t)}};zn.prototype.setAllColor=function(e){y.typeOf.object("color",e);const t=this._featuresLength;for(let n=0;n<t;++n)this.setColor(n,e)};zn.prototype.getColor=function(e,t){if(nm(e,this._featuresLength),y.typeOf.object("result",t),!l(this._batchValues))return M.clone(zn.DEFAULT_COLOR_VALUE,t);const n=this._batchValues,i=e*4,r=this._showAlphaProperties,s=e*2;return M.fromBytes(n[i],n[i+1],n[i+2],r[s+1],t)};zn.prototype.getPickColor=function(e){return nm(e,this._featuresLength),this._pickIds[e]};function eN(e,t,n){const i=e._textureDimensions;return new kt({context:t,pixelFormat:Le.RGBA,pixelDatatype:De.UNSIGNED_BYTE,source:{width:i.x,height:i.y,arrayBufferView:n},flipY:!1,sampler:Cn.NEAREST})}function gte(e,t){const n=e._featuresLength;if(!l(e._pickTexture)&&n>0){const i=e._pickIds,r=ZP(e),s=new Uint8Array(r),o=e._owner,a=e._statistics;for(let c=0;c<n;++c){const u=t.createPickId(o.getFeature(c));i.push(u);const h=u.color,d=c*4;s[d]=M.floatToByte(h.red),s[d+1]=M.floatToByte(h.green),s[d+2]=M.floatToByte(h.blue),s[d+3]=M.floatToByte(h.alpha)}e._pickTexture=eN(e,t,s),l(a)&&(a.batchTableByteLength+=e._pickTexture.sizeInBytes)}}function _te(e){const t=e._textureDimensions;e._batchTexture.copyFrom({source:{width:t.x,height:t.y,arrayBufferView:e._batchValues}})}zn.prototype.update=function(e,t){const n=t.context;this._defaultTexture=n.defaultTexture;const i=t.passes;(i.pick||i.postProcess)&&gte(this,n),this._batchValuesDirty&&(this._batchValuesDirty=!1,l(this._batchTexture)||(this._batchTexture=eN(this,n,this._batchValues),l(this._statistics)&&(this._statistics.batchTableByteLength+=this._batchTexture.sizeInBytes)),_te(this))};zn.prototype.isDestroyed=function(){return!1};zn.prototype.destroy=function(){this._batchTexture=this._batchTexture&&this._batchTexture.destroy(),this._pickTexture=this._pickTexture&&this._pickTexture.destroy();const e=this._pickIds,t=e.length;for(let n=0;n<t;++n)e[n].destroy();return Ye(this)};const yte={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},bte={SCALAR:void 0,VEC2:k,VEC3:m,VEC4:Y,MAT2:Te,MAT3:H,MAT4:P};function _u(e){const t=e.componentType;let n;typeof t=="string"?n=q.fromName(t):n=t;const i=yte[e.type],r=bte[e.type];return{componentsPerAttribute:i,classType:r,createArrayBufferView:function(s,o,a){return q.createArrayBufferView(n,s,o,i*a)}}}function Aa(e){this._classes=void 0,this._classIds=void 0,this._classIndexes=void 0,this._parentCounts=void 0,this._parentIndexes=void 0,this._parentIds=void 0,this._byteLength=0,y.typeOf.object("options.extension",e.extension),Tte(this,e.extension,e.binaryBody),wte(this)}Object.defineProperties(Aa.prototype,{byteLength:{get:function(){return this._byteLength}}});function Tte(e,t,n){let i,r,s;const o=t.instancesLength,a=t.classes;let c=t.classIds,u=t.parentCounts,h=t.parentIds,d=o,p=0;l(c.byteOffset)&&(c.componentType=T(c.componentType,q.UNSIGNED_SHORT),c.type=tt.SCALAR,s=_u(c),c=s.createArrayBufferView(n.buffer,n.byteOffset+c.byteOffset,o),p+=c.byteLength);let g;if(l(u)){for(l(u.byteOffset)&&(u.componentType=T(u.componentType,q.UNSIGNED_SHORT),u.type=tt.SCALAR,s=_u(u),u=s.createArrayBufferView(n.buffer,n.byteOffset+u.byteOffset,o),p+=u.byteLength),g=new Uint16Array(o),d=0,i=0;i<o;++i)g[i]=d,d+=u[i];p+=g.byteLength}l(h)&&l(h.byteOffset)&&(h.componentType=T(h.componentType,q.UNSIGNED_SHORT),h.type=tt.SCALAR,s=_u(h),h=s.createArrayBufferView(n.buffer,n.byteOffset+h.byteOffset,d),p+=h.byteLength);const _=a.length;for(i=0;i<_;++i){const E=a[i].length,C=a[i].instances,w=xte(E,C,n);p+=Ete(w),a[i].instances=wt(w,C)}const b=new Array(_).fill(0),x=new Uint16Array(o);for(i=0;i<o;++i)r=c[i],x[i]=b[r],++b[r];p+=x.byteLength,e._classes=a,e._classIds=c,e._classIndexes=x,e._parentCounts=u,e._parentIndexes=g,e._parentIds=h,e._byteLength=p}function xte(e,t,n){let i;for(const r in t)if(t.hasOwnProperty(r)){const s=t[r],o=s.byteOffset;if(l(o)){const a=s.componentType,c=s.type;if(!l(a))throw new te("componentType is required.");if(!l(c))throw new te("type is required.");if(!l(n))throw new te(`Property ${r} requires a batch table binary.`);const u=_u(s),h=u.componentsPerAttribute,d=u.classType,p=u.createArrayBufferView(n.buffer,n.byteOffset+o,e);l(i)||(i={}),i[r]={typedArray:p,componentCount:h,type:d}}}return i}function Ete(e){let t=0;for(const n in e)e.hasOwnProperty(n)&&(t+=e[n].typedArray.byteLength);return t}const Cte=[];function wte(e){const t=Cte;t.length=0;const i=e._classIds.length;for(let r=0;r<i;++r)tN(e,r,t)}function tN(e,t,n){const i=e._parentCounts,r=e._parentIds,s=e._parentIndexes,a=e._classIds.length;if(!l(r))return;if(t>=a)throw new A(`Parent index ${t} exceeds the total number of instances: ${a}`);if(n.indexOf(t)>-1)throw new A("Circular dependency detected in the batch table hierarchy.");n.push(t);const c=l(i)?i[t]:1,u=l(i)?s[t]:t;for(let h=0;h<c;++h){const d=r[u+h];d!==t&&tN(e,d,n)}n.pop(t)}const Ate=[],Ste=[];let vte=0;function Ite(e,t,n){const i=e._classIds,r=e._parentCounts,s=e._parentIds,o=e._parentIndexes,a=i.length,c=Ate;c.length=Math.max(c.length,a);const u=++vte,h=Ste;for(h.length=0,h.push(t);h.length>0;){if(t=h.pop(),c[t]===u)continue;c[t]=u;const d=n(e,t);if(l(d))return d;const p=r[t],g=o[t];for(let _=0;_<p;++_){const b=s[g+_];b!==t&&h.push(b)}}}function Ote(e,t,n){let i=!0;for(;i;){const r=n(e,t);if(l(r))return r;const s=e._parentIds[t];i=s!==t,t=s}}function im(e,t,n){const i=e._parentCounts,r=e._parentIds;if(l(r)){if(l(i))return Ite(e,t,n)}else return n(e,t);return Ote(e,t,n)}Aa.prototype.hasProperty=function(e,t){const n=im(this,e,function(i,r){const s=i._classIds[r],o=i._classes[s].instances;if(l(o[t]))return!0});return l(n)};Aa.prototype.propertyExists=function(e){const t=this._classes,n=t.length;for(let i=0;i<n;++i){const r=t[i].instances;if(l(r[e]))return!0}return!1};Aa.prototype.getPropertyIds=function(e,t){return t=l(t)?t:[],t.length=0,im(this,e,function(n,i){const r=n._classIds[i],s=n._classes[r].instances;for(const o in s)s.hasOwnProperty(o)&&t.indexOf(o)===-1&&t.push(o)}),t};Aa.prototype.getProperty=function(e,t){return im(this,e,function(n,i){const r=n._classIds[i],s=n._classes[r],o=n._classIndexes[i],a=s.instances[t];if(l(a))return l(a.typedArray)?Rte(a,o):Se(a[o],!0)})};function Rte(e,t){const n=e.typedArray,i=e.componentCount;return i===1?n[t]:e.type.unpack(n,t*i)}Aa.prototype.setProperty=function(e,t,n){const i=im(this,e,function(r,s){const o=r._classIds[s],a=r._classes[o],c=r._classIndexes[s],u=a.instances[t];if(l(u)){if(s!==e)throw new A(`Inherited property "${t}" is read-only.`);return l(u.typedArray)?Dte(u,c,n):u[c]=Se(n,!0),!0}});return l(i)};function Dte(e,t,n){const i=e.typedArray,r=e.componentCount;r===1?i[t]=n:e.type.pack(n,i,t*r)}Aa.prototype.isClass=function(e,t){const n=im(this,e,function(i,r){const s=i._classIds[r];if(i._classes[s].name===t)return!0});return l(n)};Aa.prototype.getClassName=function(e){const t=this._classIds[e];return this._classes[t].name};const Mte={HIGHLIGHT:0,REPLACE:1,MIX:2},c_=Object.freeze(Mte),q0=zn.DEFAULT_COLOR_VALUE,W0=zn.DEFAULT_SHOW_VALUE;function en(e,t,n,i,r){this.featuresLength=t;let s;l(n)&&(s=n.extensions),this._extensions=T(s,{});const o=Lte(n);this._properties=o,this._batchTableHierarchy=Pte(this,n,i);const a=nN(t,o,i);this._binaryPropertiesByteLength=Nte(a),this._batchTableBinaryProperties=a,this._content=e,this._batchTexture=new zn({featuresLength:t,colorChangedCallback:r,owner:e,statistics:e.tileset.statistics})}en._deprecationWarning=pc;Object.defineProperties(en.prototype,{batchTableByteLength:{get:function(){let e=this._binaryPropertiesByteLength;return l(this._batchTableHierarchy)&&(e+=this._batchTableHierarchy.byteLength),e+=this._batchTexture.byteLength,e}}});function Lte(e){const t={};if(!l(e))return t;for(const n in e)e.hasOwnProperty(n)&&n!=="HIERARCHY"&&n!=="extensions"&&n!=="extras"&&(t[n]=Se(e[n],!0));return t}function Pte(e,t,n){if(!l(t))return;let i=e._extensions["3DTILES_batch_table_hierarchy"];const r=t.HIERARCHY;if(l(r)&&(en._deprecationWarning("batchTableHierarchyExtension","The batch table HIERARCHY property has been moved to an extension. Use extensions.3DTILES_batch_table_hierarchy instead."),e._extensions["3DTILES_batch_table_hierarchy"]=r,i=r),!!l(i))return new Aa({extension:i,binaryBody:n})}function nN(e,t,n){let i;for(const r in t)if(t.hasOwnProperty(r)){const s=t[r],o=s.byteOffset;if(l(o)){const a=s.componentType,c=s.type;if(!l(a))throw new te("componentType is required.");if(!l(c))throw new te("type is required.");if(!l(n))throw new te(`Property ${r} requires a batch table binary.`);const u=_u(s),h=u.componentsPerAttribute,d=u.classType,p=u.createArrayBufferView(n.buffer,n.byteOffset+o,e);l(i)||(i={}),i[r]={typedArray:p,componentCount:h,type:d}}}return i}function Nte(e){if(!l(e))return 0;let t=0;for(const n in e)e.hasOwnProperty(n)&&(t+=e[n].typedArray.byteLength);return t}en.getBinaryProperties=function(e,t,n){return nN(e,t,n)};en.prototype.setShow=function(e,t){this._batchTexture.setShow(e,t)};en.prototype.setAllShow=function(e){this._batchTexture.setAllShow(e)};en.prototype.getShow=function(e){return this._batchTexture.getShow(e)};en.prototype.setColor=function(e,t){this._batchTexture.setColor(e,t)};en.prototype.setAllColor=function(e){this._batchTexture.setAllColor(e)};en.prototype.getColor=function(e,t){return this._batchTexture.getColor(e,t)};en.prototype.getPickColor=function(e){return this._batchTexture.getPickColor(e)};const Fte=new M;en.prototype.applyStyle=function(e){if(!l(e)){this.setAllColor(q0),this.setAllShow(W0);return}const t=this._content,n=this.featuresLength;for(let i=0;i<n;++i){const r=t.getFeature(i),s=l(e.color)?T(e.color.evaluateColor(r,Fte),q0):q0,o=l(e.show)?T(e.show.evaluate(r),W0):W0;this.setColor(i,s),this.setShow(i,o)}};function Bte(e,t){const n=e.typedArray,i=e.componentCount;return i===1?n[t]:e.type.unpack(n,t*i)}function zte(e,t,n){const i=e.typedArray,r=e.componentCount;r===1?i[t]=n:e.type.pack(n,i,t*r)}function Ph(e,t){if(!l(e)||e<0||e>=t)throw new A(`batchId is required and must be between zero and featuresLength - 1 (${t}`-+").")}en.prototype.isClass=function(e,t){Ph(e,this.featuresLength),y.typeOf.string("className",t);const n=this._batchTableHierarchy;return l(n)?n.isClass(e,t):!1};en.prototype.isExactClass=function(e,t){return y.typeOf.string("className",t),this.getExactClassName(e)===t};en.prototype.getExactClassName=function(e){Ph(e,this.featuresLength);const t=this._batchTableHierarchy;if(l(t))return t.getClassName(e)};en.prototype.hasProperty=function(e,t){return Ph(e,this.featuresLength),y.typeOf.string("name",t),l(this._properties[t])||l(this._batchTableHierarchy)&&this._batchTableHierarchy.hasProperty(e,t)};en.prototype.hasPropertyBySemantic=function(){return!1};en.prototype.getPropertyIds=function(e,t){Ph(e,this.featuresLength),t=l(t)?t:[],t.length=0;const n=Object.keys(this._properties);return t.push.apply(t,n),l(this._batchTableHierarchy)&&t.push.apply(t,this._batchTableHierarchy.getPropertyIds(e,n)),t};en.prototype.getPropertyBySemantic=function(e,t){};en.prototype.getProperty=function(e,t){if(Ph(e,this.featuresLength),y.typeOf.string("name",t),l(this._batchTableBinaryProperties)){const i=this._batchTableBinaryProperties[t];if(l(i))return Bte(i,e)}const n=this._properties[t];if(l(n))return Se(n[e],!0);if(l(this._batchTableHierarchy)){const i=this._batchTableHierarchy.getProperty(e,t);if(l(i))return i}};en.prototype.setProperty=function(e,t,n){const i=this.featuresLength;if(Ph(e,i),y.typeOf.string("name",t),l(this._batchTableBinaryProperties)){const s=this._batchTableBinaryProperties[t];if(l(s)){zte(s,e,n);return}}if(l(this._batchTableHierarchy)&&this._batchTableHierarchy.setProperty(e,t,n))return;let r=this._properties[t];l(r)||(this._properties[t]=new Array(i),r=this._properties[t]),r[e]=Se(n,!0)};function Ute(e){return e._batchTexture.textureDimensions.y===1?`uniform vec4 tile_textureStep; 
vec2 computeSt(float batchId) 
{ 
    float stepX = tile_textureStep.x; 
    float centerX = tile_textureStep.y; 
    return vec2(centerX + (batchId * stepX), 0.5); 
} 
`:`uniform vec4 tile_textureStep; 
uniform vec2 tile_textureDimensions; 
vec2 computeSt(float batchId) 
{ 
    float stepX = tile_textureStep.x; 
    float centerX = tile_textureStep.y; 
    float stepY = tile_textureStep.z; 
    float centerY = tile_textureStep.w; 
    float xId = mod(batchId, tile_textureDimensions.x); 
    float yId = floor(batchId / tile_textureDimensions.x); 
    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); 
} 
`}en.prototype.getVertexShaderCallback=function(e,t,n){if(this.featuresLength===0)return;const i=this;return function(r){const s=iN(r,n,!1);let o;return We.maximumVertexTextureImageUnits>0?(o="",e&&(o+=`uniform bool tile_translucentCommand; 
`),o+=`uniform sampler2D tile_batchTexture; 
out vec4 tile_featureColor; 
out vec2 tile_featureSt; 
void main() 
{ 
    vec2 st = computeSt(${t}); 
    vec4 featureProperties = texture(tile_batchTexture, st); 
    tile_color(featureProperties); 
    float show = ceil(featureProperties.a); 
    gl_Position *= show; 
`,e&&(o+=`    bool isStyleTranslucent = (featureProperties.a != 1.0); 
    if (czm_pass == czm_passTranslucent) 
    { 
        if (!isStyleTranslucent && !tile_translucentCommand) 
        { 
            gl_Position *= 0.0; 
        } 
    } 
    else 
    { 
        if (isStyleTranslucent) 
        { 
            gl_Position *= 0.0; 
        } 
    } 
`),o+=`    tile_featureColor = featureProperties; 
    tile_featureSt = st; 
}`):o=`out vec2 tile_featureSt; 
void main() 
{ 
    tile_color(vec4(1.0)); 
    tile_featureSt = computeSt(${t}); 
}`,`${s}
${Ute(i)}${o}`}};function a1(e,t){return e=Je.replaceMain(e,"tile_main"),t?`${e}uniform float tile_colorBlend; 
void tile_color(vec4 tile_featureColor) 
{ 
    tile_main(); 
    tile_featureColor = czm_gammaCorrect(tile_featureColor); 
    out_FragColor.a *= tile_featureColor.a; 
    float highlight = ceil(tile_colorBlend); 
    out_FragColor.rgb *= mix(tile_featureColor.rgb, vec3(1.0), highlight); 
} 
`:`${e}void tile_color(vec4 tile_featureColor) 
{ 
    tile_main(); 
} 
`}function kte(e,t){const n=`texture(${t}`;let i=0,r=e.indexOf(n,i),s;for(;r>-1;){let o=0;for(let u=r;u<e.length;++u){const h=e.charAt(u);if(h==="(")++o;else if(h===")"&&(--o,o===0)){s=u+1;break}}const c=`tile_diffuse_final(${e.slice(r,s)}, tile_diffuse)`;e=e.slice(0,r)+c+e.slice(s),i=r+c.length,r=e.indexOf(n,i)}return e}function iN(e,t,n){if(!l(t))return a1(e,n);let i=new RegExp(`(uniform|attribute|in)\\s+(vec[34]|sampler2D)\\s+${t};`);const r=e.match(i);if(!l(r))return a1(e,n);const s=r[0],o=r[2];e=Je.replaceMain(e,"tile_main"),e=e.replace(s,"");const a=`bool isWhite(vec3 color) 
{ 
    return all(greaterThan(color, vec3(1.0 - czm_epsilon3))); 
} 
vec4 tile_diffuse_final(vec4 sourceDiffuse, vec4 tileDiffuse) 
{ 
    vec4 blendDiffuse = mix(sourceDiffuse, tileDiffuse, tile_colorBlend); 
    vec4 diffuse = isWhite(tileDiffuse.rgb) ? sourceDiffuse : blendDiffuse; 
    return vec4(diffuse.rgb, sourceDiffuse.a); 
} 
`,c=`    tile_featureColor = czm_gammaCorrect(tile_featureColor); 
    out_FragColor.a *= tile_featureColor.a; 
    float highlight = ceil(tile_colorBlend); 
    out_FragColor.rgb *= mix(tile_featureColor.rgb, vec3(1.0), highlight); 
`;let u;if(o==="vec3"||o==="vec4"){const h=o==="vec3"?`vec4(${t}, 1.0)`:t,d=o==="vec3"?"tile_diffuse.xyz":"tile_diffuse";i=new RegExp(t,"g"),e=e.replace(i,d),u=`    vec4 source = ${h}; 
    tile_diffuse = tile_diffuse_final(source, tile_featureColor); 
    tile_main(); 
`}else o==="sampler2D"&&(e=kte(e,t),u=`    tile_diffuse = tile_featureColor; 
    tile_main(); 
`);return e=`uniform float tile_colorBlend; 
vec4 tile_diffuse = vec4(1.0); 
${a}${s}
${e}
void tile_color(vec4 tile_featureColor) 
{ 
${u}`,n&&(e+=c),e+=`} 
`,e}en.prototype.getFragmentShaderCallback=function(e,t,n){if(this.featuresLength!==0)return function(i){return i=iN(i,t,!0),We.maximumVertexTextureImageUnits>0?(i+=`uniform sampler2D tile_pickTexture; 
in vec2 tile_featureSt; 
in vec4 tile_featureColor; 
void main() 
{ 
    tile_color(tile_featureColor); 
`,n&&(i+=`    out_FragColor.rgb *= out_FragColor.a; 
`),i+="}"):(e&&(i+=`uniform bool tile_translucentCommand; 
`),i+=`uniform sampler2D tile_pickTexture; 
uniform sampler2D tile_batchTexture; 
in vec2 tile_featureSt; 
void main() 
{ 
    vec4 featureProperties = texture(tile_batchTexture, tile_featureSt); 
    if (featureProperties.a == 0.0) { 
        discard; 
    } 
`,e&&(i+=`    bool isStyleTranslucent = (featureProperties.a != 1.0); 
    if (czm_pass == czm_passTranslucent) 
    { 
        if (!isStyleTranslucent && !tile_translucentCommand) 
        { 
            discard; 
        } 
    } 
    else 
    { 
        if (isStyleTranslucent) 
        { 
            discard; 
        } 
    } 
`),i+=`    tile_color(featureProperties); 
`,n&&(i+=`    out_FragColor.rgb *= out_FragColor.a; 
`),i+=`} 
`),i}};en.prototype.getClassificationFragmentShaderCallback=function(){if(this.featuresLength!==0)return function(e){return e=Je.replaceMain(e,"tile_main"),We.maximumVertexTextureImageUnits>0?e+=`uniform sampler2D tile_pickTexture;
in vec2 tile_featureSt; 
in vec4 tile_featureColor; 
void main() 
{ 
    tile_main(); 
    out_FragColor = tile_featureColor; 
    out_FragColor.rgb *= out_FragColor.a; 
}`:e+=`uniform sampler2D tile_batchTexture; 
uniform sampler2D tile_pickTexture;
in vec2 tile_featureSt; 
void main() 
{ 
    tile_main(); 
    vec4 featureProperties = texture(tile_batchTexture, tile_featureSt); 
    if (featureProperties.a == 0.0) { 
        discard; 
    } 
    out_FragColor = featureProperties; 
    out_FragColor.rgb *= out_FragColor.a; 
} 
`,e}};function jte(e){const t=e._content.tileset,n=t.colorBlendMode,i=t.colorBlendAmount;if(n===c_.HIGHLIGHT)return 0;if(n===c_.REPLACE)return 1;if(n===c_.MIX)return R.clamp(i,R.EPSILON4,1);throw new A(`Invalid color blend mode "${n}".`)}en.prototype.getUniformMapCallback=function(){if(this.featuresLength===0)return;const e=this;return function(t){return wt(t,{tile_batchTexture:function(){return T(e._batchTexture.batchTexture,e._batchTexture.defaultTexture)},tile_textureDimensions:function(){return e._batchTexture.textureDimensions},tile_textureStep:function(){return e._batchTexture.textureStep},tile_colorBlend:function(){return jte(e)},tile_pickTexture:function(){return e._batchTexture.pickTexture}})}};en.prototype.getPickId=function(){return"texture(tile_pickTexture, tile_featureSt)"};const $c={ALL_OPAQUE:0,ALL_TRANSLUCENT:1,OPAQUE_AND_TRANSLUCENT:2};en.prototype.addDerivedCommands=function(e,t){const n=e.commandList,i=n.length,r=this._content._tile,s=r._finalResolution,o=r.tileset,a=o.isSkippingLevelOfDetail&&o.hasMixedContent&&e.context.stencilBuffer,c=Vte(this);for(let u=t;u<i;++u){const h=n[u];if(h.pass===Ke.COMPUTE)continue;let d=h.derivedCommands.tileset;(!l(d)||h.dirty)&&(d={},h.derivedCommands.tileset=d,d.originalCommand=Gte(h),h.dirty=!1);const p=d.originalCommand;c!==$c.ALL_OPAQUE&&h.pass!==Ke.TRANSLUCENT&&(l(d.translucent)||(d.translucent=Hte(p))),c!==$c.ALL_TRANSLUCENT&&h.pass!==Ke.TRANSLUCENT&&(l(d.opaque)||(d.opaque=qte(p)),a&&(s||(l(d.zback)||(d.zback=$te(e.context,p)),o._backfaceCommands.push(d.zback)),(!l(d.stencil)||r._selectionDepth!==Yte(d.stencil))&&(h.renderState.depthMask?d.stencil=Xte(p,r._selectionDepth):d.stencil=d.opaque)));const g=a?d.stencil:d.opaque,_=d.translucent;h.pass!==Ke.TRANSLUCENT?(c===$c.ALL_OPAQUE&&(n[u]=g),c===$c.ALL_TRANSLUCENT&&(n[u]=_),c===$c.OPAQUE_AND_TRANSLUCENT&&(n[u]=g,n.push(_))):n[u]=p}};function Vte(e){const t=e._batchTexture.translucentFeaturesLength;return t===0?$c.ALL_OPAQUE:t===e.featuresLength?$c.ALL_TRANSLUCENT:$c.OPAQUE_AND_TRANSLUCENT}function Gte(e){const t=Tt.shallowClone(e),n=t.pass===Ke.TRANSLUCENT;return t.uniformMap=l(t.uniformMap)?t.uniformMap:{},t.uniformMap.tile_translucentCommand=function(){return n},t}function Hte(e){const t=Tt.shallowClone(e);return t.pass=Ke.TRANSLUCENT,t.renderState=Kte(e.renderState),t}function qte(e){const t=Tt.shallowClone(e);return t.renderState=Zte(e.renderState),t}function Wte(e,t){let n=e.shaderCache.getDerivedShaderProgram(t,"zBackfaceLogDepth");if(!l(n)){const i=t.fragmentShaderSource.clone();i.defines=l(i.defines)?i.defines.slice(0):[],i.defines.push("POLYGON_OFFSET"),n=e.shaderCache.createDerivedShaderProgram(t,"zBackfaceLogDepth",{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:i,attributeLocations:t._attributeLocations})}return n}function $te(e,t){const n=Tt.shallowClone(t),i=Se(n.renderState,!0);i.cull.enabled=!0,i.cull.face=wo.FRONT,i.colorMask={red:!1,green:!1,blue:!1,alpha:!1},i.polygonOffset={enabled:!0,factor:5,units:5},i.stencilTest=yt.setCesium3DTileBit(),i.stencilMask=yt.CESIUM_3D_TILE_MASK,n.renderState=it.fromCache(i),n.castShadows=!1,n.receiveShadows=!1,n.uniformMap=Se(t.uniformMap);const r=new k(5,5);return n.uniformMap.u_polygonOffset=function(){return r},n.shaderProgram=Wte(e,t.shaderProgram),n}function Xte(e,t){const n=Tt.shallowClone(e),i=Se(n.renderState,!0);return i.stencilTest.enabled=!0,i.stencilTest.mask=yt.SKIP_LOD_MASK,i.stencilTest.reference=yt.CESIUM_3D_TILE_MASK|t<<yt.SKIP_LOD_BIT_SHIFT,i.stencilTest.frontFunction=Ei.GREATER_OR_EQUAL,i.stencilTest.frontOperation.zPass=Qe.REPLACE,i.stencilTest.backFunction=Ei.GREATER_OR_EQUAL,i.stencilTest.backOperation.zPass=Qe.REPLACE,i.stencilMask=yt.CESIUM_3D_TILE_MASK|yt.SKIP_LOD_MASK,n.renderState=it.fromCache(i),n}function Yte(e){return(e.renderState.stencilTest.reference&yt.SKIP_LOD_MASK)>>>yt.SKIP_LOD_BIT_SHIFT}function Kte(e){const t=Se(e,!0);return t.cull.enabled=!1,t.depthTest.enabled=!0,t.depthMask=!1,t.blending=vs.ALPHA_BLEND,t.stencilTest=yt.setCesium3DTileBit(),t.stencilMask=yt.CESIUM_3D_TILE_MASK,it.fromCache(t)}function Zte(e){const t=Se(e,!0);return t.stencilTest=yt.setCesium3DTileBit(),t.stencilMask=yt.CESIUM_3D_TILE_MASK,it.fromCache(t)}en.prototype.update=function(e,t){this._batchTexture.update(e,t)};en.prototype.isDestroyed=function(){return!1};en.prototype.destroy=function(){return this._batchTexture=this._batchTexture&&this._batchTexture.destroy(),Ye(this)};function Y_(e){this.offset=e.offset,this.count=e.count,this.color=e.color,this.batchIds=e.batchIds}const c1=`in vec3 position;
in float a_batchId;

uniform mat4 u_modifiedModelViewProjection;

void main()
{
    gl_Position = czm_depthClamp(u_modifiedModelViewProjection * vec4(position, 1.0));
}
`;function vr(e,t){this._content=e,this._batchId=t,this._color=void 0}Object.defineProperties(vr.prototype,{show:{get:function(){return this._content.batchTable.getShow(this._batchId)},set:function(e){this._content.batchTable.setShow(this._batchId,e)}},color:{get:function(){return l(this._color)||(this._color=new M),this._content.batchTable.getColor(this._batchId,this._color)},set:function(e){this._content.batchTable.setColor(this._batchId,e)}},polylinePositions:{get:function(){if(l(this._content.getPolylinePositions))return this._content.getPolylinePositions(this._batchId)}},content:{get:function(){return this._content}},tileset:{get:function(){return this._content.tileset}},primitive:{get:function(){return this._content.tileset}},featureId:{get:function(){return this._batchId}},pickId:{get:function(){return this._content.batchTable.getPickColor(this._batchId)}}});vr.prototype.hasProperty=function(e){return this._content.batchTable.hasProperty(this._batchId,e)};vr.prototype.getPropertyIds=function(e){return this._content.batchTable.getPropertyIds(this._batchId,e)};vr.prototype.getProperty=function(e){return this._content.batchTable.getProperty(this._batchId,e)};vr.getPropertyInherited=function(e,t,n){const i=e.batchTable;if(l(i)){if(i.hasPropertyBySemantic(t,n))return i.getPropertyBySemantic(t,n);if(i.hasProperty(t,n))return i.getProperty(t,n)}const r=e.metadata;if(l(r)){if(r.hasPropertyBySemantic(n))return r.getPropertyBySemantic(n);if(r.hasProperty(n))return r.getProperty(n)}const s=e.tile,o=s.metadata;if(l(o)){if(o.hasPropertyBySemantic(n))return o.getPropertyBySemantic(n);if(o.hasProperty(n))return o.getProperty(n)}let a;if(l(s.implicitSubtree)&&(a=s.implicitSubtree.metadata),l(a)){if(a.hasPropertyBySemantic(n))return a.getPropertyBySemantic(n);if(a.hasProperty(n))return a.getProperty(n)}const c=l(e.group)?e.group.metadata:void 0;if(l(c)){if(c.hasPropertyBySemantic(n))return c.getPropertyBySemantic(n);if(c.hasProperty(n))return c.getProperty(n)}const u=e.tileset.metadata;if(l(u)){if(u.hasPropertyBySemantic(n))return u.getPropertyBySemantic(n);if(u.hasProperty(n))return u.getProperty(n)}};vr.prototype.getPropertyInherited=function(e){return vr.getPropertyInherited(this._content,this._batchId,e)};vr.prototype.setProperty=function(e,t){this._content.batchTable.setProperty(this._batchId,e,t),this._content.featurePropertiesDirty=!0};vr.prototype.isExactClass=function(e){return this._content.batchTable.isExactClass(this._batchId,e)};vr.prototype.isClass=function(e){return this._content.batchTable.isClass(this._batchId,e)};vr.prototype.getExactClassName=function(){return this._content.batchTable.getExactClassName(this._batchId)};class Jte{add(t,n,i){if(typeof arguments[0]!="string")for(let r in arguments[0])this.add(r,arguments[0][r],arguments[1]);else(Array.isArray(t)?t:[t]).forEach(function(r){this[r]=this[r]||[],n&&this[r][i?"unshift":"push"](n)},this)}run(t,n){this[t]=this[t]||[],this[t].forEach(function(i){i.call(n&&n.context?n.context:n,n)})}}class Qte{constructor(t){this.jsep=t,this.registered={}}register(...t){t.forEach(n=>{if(typeof n!="object"||!n.name||!n.init)throw new Error("Invalid JSEP plugin format");this.registered[n.name]||(n.init(this.jsep),this.registered[n.name]=n)})}}class ae{static get version(){return"1.3.9"}static toString(){return"JavaScript Expression Parser (JSEP) v"+ae.version}static addUnaryOp(t){return ae.max_unop_len=Math.max(t.length,ae.max_unop_len),ae.unary_ops[t]=1,ae}static addBinaryOp(t,n,i){return ae.max_binop_len=Math.max(t.length,ae.max_binop_len),ae.binary_ops[t]=n,i?ae.right_associative.add(t):ae.right_associative.delete(t),ae}static addIdentifierChar(t){return ae.additional_identifier_chars.add(t),ae}static addLiteral(t,n){return ae.literals[t]=n,ae}static removeUnaryOp(t){return delete ae.unary_ops[t],t.length===ae.max_unop_len&&(ae.max_unop_len=ae.getMaxKeyLen(ae.unary_ops)),ae}static removeAllUnaryOps(){return ae.unary_ops={},ae.max_unop_len=0,ae}static removeIdentifierChar(t){return ae.additional_identifier_chars.delete(t),ae}static removeBinaryOp(t){return delete ae.binary_ops[t],t.length===ae.max_binop_len&&(ae.max_binop_len=ae.getMaxKeyLen(ae.binary_ops)),ae.right_associative.delete(t),ae}static removeAllBinaryOps(){return ae.binary_ops={},ae.max_binop_len=0,ae}static removeLiteral(t){return delete ae.literals[t],ae}static removeAllLiterals(){return ae.literals={},ae}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(t){this.expr=t,this.index=0}static parse(t){return new ae(t).parse()}static getMaxKeyLen(t){return Math.max(0,...Object.keys(t).map(n=>n.length))}static isDecimalDigit(t){return t>=48&&t<=57}static binaryPrecedence(t){return ae.binary_ops[t]||0}static isIdentifierStart(t){return t>=65&&t<=90||t>=97&&t<=122||t>=128&&!ae.binary_ops[String.fromCharCode(t)]||ae.additional_identifier_chars.has(String.fromCharCode(t))}static isIdentifierPart(t){return ae.isIdentifierStart(t)||ae.isDecimalDigit(t)}throwError(t){const n=new Error(t+" at character "+this.index);throw n.index=this.index,n.description=t,n}runHook(t,n){if(ae.hooks[t]){const i={context:this,node:n};return ae.hooks.run(t,i),i.node}return n}searchHook(t){if(ae.hooks[t]){const n={context:this};return ae.hooks[t].find(function(i){return i.call(n.context,n),n.node}),n.node}}gobbleSpaces(){let t=this.code;for(;t===ae.SPACE_CODE||t===ae.TAB_CODE||t===ae.LF_CODE||t===ae.CR_CODE;)t=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");const t=this.gobbleExpressions(),n=t.length===1?t[0]:{type:ae.COMPOUND,body:t};return this.runHook("after-all",n)}gobbleExpressions(t){let n=[],i,r;for(;this.index<this.expr.length;)if(i=this.code,i===ae.SEMCOL_CODE||i===ae.COMMA_CODE)this.index++;else if(r=this.gobbleExpression())n.push(r);else if(this.index<this.expr.length){if(i===t)break;this.throwError('Unexpected "'+this.char+'"')}return n}gobbleExpression(){const t=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",t)}gobbleBinaryOp(){this.gobbleSpaces();let t=this.expr.substr(this.index,ae.max_binop_len),n=t.length;for(;n>0;){if(ae.binary_ops.hasOwnProperty(t)&&(!ae.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!ae.isIdentifierPart(this.expr.charCodeAt(this.index+t.length))))return this.index+=n,t;t=t.substr(0,--n)}return!1}gobbleBinaryExpression(){let t,n,i,r,s,o,a,c,u;if(o=this.gobbleToken(),!o||(n=this.gobbleBinaryOp(),!n))return o;for(s={value:n,prec:ae.binaryPrecedence(n),right_a:ae.right_associative.has(n)},a=this.gobbleToken(),a||this.throwError("Expected expression after "+n),r=[o,s,a];n=this.gobbleBinaryOp();){if(i=ae.binaryPrecedence(n),i===0){this.index-=n.length;break}s={value:n,prec:i,right_a:ae.right_associative.has(n)},u=n;const h=d=>s.right_a&&d.right_a?i>d.prec:i<=d.prec;for(;r.length>2&&h(r[r.length-2]);)a=r.pop(),n=r.pop().value,o=r.pop(),t={type:ae.BINARY_EXP,operator:n,left:o,right:a},r.push(t);t=this.gobbleToken(),t||this.throwError("Expected expression after "+u),r.push(s,t)}for(c=r.length-1,t=r[c];c>1;)t={type:ae.BINARY_EXP,operator:r[c-1].value,left:r[c-2],right:t},c-=2;return t}gobbleToken(){let t,n,i,r;if(this.gobbleSpaces(),r=this.searchHook("gobble-token"),r)return this.runHook("after-token",r);if(t=this.code,ae.isDecimalDigit(t)||t===ae.PERIOD_CODE)return this.gobbleNumericLiteral();if(t===ae.SQUOTE_CODE||t===ae.DQUOTE_CODE)r=this.gobbleStringLiteral();else if(t===ae.OBRACK_CODE)r=this.gobbleArray();else{for(n=this.expr.substr(this.index,ae.max_unop_len),i=n.length;i>0;){if(ae.unary_ops.hasOwnProperty(n)&&(!ae.isIdentifierStart(this.code)||this.index+n.length<this.expr.length&&!ae.isIdentifierPart(this.expr.charCodeAt(this.index+n.length)))){this.index+=i;const s=this.gobbleToken();return s||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:ae.UNARY_EXP,operator:n,argument:s,prefix:!0})}n=n.substr(0,--i)}ae.isIdentifierStart(t)?(r=this.gobbleIdentifier(),ae.literals.hasOwnProperty(r.name)?r={type:ae.LITERAL,value:ae.literals[r.name],raw:r.name}:r.name===ae.this_str&&(r={type:ae.THIS_EXP})):t===ae.OPAREN_CODE&&(r=this.gobbleGroup())}return r?(r=this.gobbleTokenProperty(r),this.runHook("after-token",r)):this.runHook("after-token",!1)}gobbleTokenProperty(t){this.gobbleSpaces();let n=this.code;for(;n===ae.PERIOD_CODE||n===ae.OBRACK_CODE||n===ae.OPAREN_CODE||n===ae.QUMARK_CODE;){let i;if(n===ae.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==ae.PERIOD_CODE)break;i=!0,this.index+=2,this.gobbleSpaces(),n=this.code}this.index++,n===ae.OBRACK_CODE?(t={type:ae.MEMBER_EXP,computed:!0,object:t,property:this.gobbleExpression()},t.property||this.throwError('Unexpected "'+this.char+'"'),this.gobbleSpaces(),n=this.code,n!==ae.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):n===ae.OPAREN_CODE?t={type:ae.CALL_EXP,arguments:this.gobbleArguments(ae.CPAREN_CODE),callee:t}:(n===ae.PERIOD_CODE||i)&&(i&&this.index--,this.gobbleSpaces(),t={type:ae.MEMBER_EXP,computed:!1,object:t,property:this.gobbleIdentifier()}),i&&(t.optional=!0),this.gobbleSpaces(),n=this.code}return t}gobbleNumericLiteral(){let t="",n,i;for(;ae.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);if(this.code===ae.PERIOD_CODE)for(t+=this.expr.charAt(this.index++);ae.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);if(n=this.char,n==="e"||n==="E"){for(t+=this.expr.charAt(this.index++),n=this.char,(n==="+"||n==="-")&&(t+=this.expr.charAt(this.index++));ae.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);ae.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+t+this.char+")")}return i=this.code,ae.isIdentifierStart(i)?this.throwError("Variable names cannot start with a number ("+t+this.char+")"):(i===ae.PERIOD_CODE||t.length===1&&t.charCodeAt(0)===ae.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:ae.LITERAL,value:parseFloat(t),raw:t}}gobbleStringLiteral(){let t="";const n=this.index,i=this.expr.charAt(this.index++);let r=!1;for(;this.index<this.expr.length;){let s=this.expr.charAt(this.index++);if(s===i){r=!0;break}else if(s==="\\")switch(s=this.expr.charAt(this.index++),s){case"n":t+=`
`;break;case"r":t+="\r";break;case"t":t+="	";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=s}else t+=s}return r||this.throwError('Unclosed quote after "'+t+'"'),{type:ae.LITERAL,value:t,raw:this.expr.substring(n,this.index)}}gobbleIdentifier(){let t=this.code,n=this.index;for(ae.isIdentifierStart(t)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(t=this.code,ae.isIdentifierPart(t));)this.index++;return{type:ae.IDENTIFIER,name:this.expr.slice(n,this.index)}}gobbleArguments(t){const n=[];let i=!1,r=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let s=this.code;if(s===t){i=!0,this.index++,t===ae.CPAREN_CODE&&r&&r>=n.length&&this.throwError("Unexpected token "+String.fromCharCode(t));break}else if(s===ae.COMMA_CODE){if(this.index++,r++,r!==n.length){if(t===ae.CPAREN_CODE)this.throwError("Unexpected token ,");else if(t===ae.CBRACK_CODE)for(let o=n.length;o<r;o++)n.push(null)}}else if(n.length!==r&&r!==0)this.throwError("Expected comma");else{const o=this.gobbleExpression();(!o||o.type===ae.COMPOUND)&&this.throwError("Expected comma"),n.push(o)}}return i||this.throwError("Expected "+String.fromCharCode(t)),n}gobbleGroup(){this.index++;let t=this.gobbleExpressions(ae.CPAREN_CODE);if(this.code===ae.CPAREN_CODE)return this.index++,t.length===1?t[0]:t.length?{type:ae.SEQUENCE_EXP,expressions:t}:!1;this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:ae.ARRAY_EXP,elements:this.gobbleArguments(ae.CBRACK_CODE)}}}const ene=new Jte;Object.assign(ae,{hooks:ene,plugins:new Qte(ae),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"});ae.max_unop_len=ae.getMaxKeyLen(ae.unary_ops);ae.max_binop_len=ae.getMaxKeyLen(ae.binary_ops);const yu=e=>new ae(e).parse(),tne=Object.getOwnPropertyNames(class{});Object.getOwnPropertyNames(ae).filter(e=>!tne.includes(e)&&yu[e]===void 0).forEach(e=>{yu[e]=ae[e]});yu.Jsep=ae;const nne="ConditionalExpression";var ine={name:"ternary",init(e){e.hooks.add("after-expression",function(n){if(n.node&&this.code===e.QUMARK_CODE){this.index++;const i=n.node,r=this.gobbleExpression();if(r||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===e.COLON_CODE){this.index++;const s=this.gobbleExpression();if(s||this.throwError("Expected expression"),n.node={type:nne,test:i,consequent:r,alternate:s},i.operator&&e.binary_ops[i.operator]<=.9){let o=i;for(;o.right.operator&&e.binary_ops[o.right.operator]<=.9;)o=o.right;n.node.test=o.right,o.right=n.node,n.node=i}}else this.throwError("Expected :")}})}};yu.plugins.register(ine);const rne={VARIABLE:0,UNARY:1,BINARY:2,TERNARY:3,CONDITIONAL:4,MEMBER:5,FUNCTION_CALL:6,ARRAY:7,REGEX:8,VARIABLE_IN_STRING:9,LITERAL_NULL:10,LITERAL_BOOLEAN:11,LITERAL_NUMBER:12,LITERAL_STRING:13,LITERAL_COLOR:14,LITERAL_VECTOR:15,LITERAL_REGEX:16,LITERAL_UNDEFINED:17,BUILTIN_VARIABLE:18},ye=Object.freeze(rne);function No(e,t){y.typeOf.string("expression",e),this._expression=e,e=_ne(e,t),e=bne(yne(e)),yu.addBinaryOp("=~",0),yu.addBinaryOp("!~",0);let n;try{n=yu(e)}catch(i){throw new te(i)}this._runtimeAst=Dt(this,n)}Object.defineProperties(No.prototype,{expression:{get:function(){return this._expression}}});const Xe={arrayIndex:0,arrayArray:[[]],cartesian2Index:0,cartesian3Index:0,cartesian4Index:0,cartesian2Array:[new k],cartesian3Array:[new m],cartesian4Array:[new Y],reset:function(){this.arrayIndex=0,this.cartesian2Index=0,this.cartesian3Index=0,this.cartesian4Index=0},getArray:function(){this.arrayIndex>=this.arrayArray.length&&this.arrayArray.push([]);const e=this.arrayArray[this.arrayIndex++];return e.length=0,e},getCartesian2:function(){return this.cartesian2Index>=this.cartesian2Array.length&&this.cartesian2Array.push(new k),this.cartesian2Array[this.cartesian2Index++]},getCartesian3:function(){return this.cartesian3Index>=this.cartesian3Array.length&&this.cartesian3Array.push(new m),this.cartesian3Array[this.cartesian3Index++]},getCartesian4:function(){return this.cartesian4Index>=this.cartesian4Array.length&&this.cartesian4Array.push(new Y),this.cartesian4Array[this.cartesian4Index++]}};No.prototype.evaluate=function(e,t){Xe.reset();const n=this._runtimeAst.evaluate(e);return t instanceof M&&n instanceof Y?M.fromCartesian4(n,t):n instanceof k||n instanceof m||n instanceof Y?n.clone(t):n};No.prototype.evaluateColor=function(e,t){Xe.reset();const n=this._runtimeAst.evaluate(e);return M.fromCartesian4(n,t)};No.prototype.getShaderFunction=function(e,t,n,i){let r=this.getShaderExpression(t,n);return r=`${i} ${e}
{
    return ${r};
}
`,r};No.prototype.getShaderExpression=function(e,t){return this._runtimeAst.getShaderExpression(e,t)};No.prototype.getVariables=function(){let e=[];return this._runtimeAst.getVariables(e),e=e.filter(function(t,n,i){return i.indexOf(t)===n}),e};const sne=["!","-","+"],l1=["+","-","*","/","%","===","!==",">",">=","<","<=","&&","||","!~","=~"],K_=/\${(.*?)}/g,one=/\\/g,ane="@#%",cne=/@#%/g,Yy=new M,Ky={abs:vi(Math.abs),sqrt:vi(Math.sqrt),cos:vi(Math.cos),sin:vi(Math.sin),tan:vi(Math.tan),acos:vi(Math.acos),asin:vi(Math.asin),atan:vi(Math.atan),radians:vi(R.toRadians),degrees:vi(R.toDegrees),sign:vi(R.sign),floor:vi(Math.floor),ceil:vi(Math.ceil),round:vi(Math.round),exp:vi(Math.exp),exp2:vi(une),log:vi(Math.log),log2:vi(fne),fract:vi(lne),length:hne,normalize:dne},Zy={atan2:dg(Math.atan2,!1),pow:dg(Math.pow,!1),min:dg(Math.min,!0),max:dg(Math.max,!0),distance:pne,dot:mne,cross:gne},fw={clamp:u1(R.clamp),mix:u1(R.lerp)};function lne(e){return e-Math.floor(e)}function une(e){return Math.pow(2,e)}function fne(e){return R.log2(e)}function vi(e){return function(t,n){if(typeof n=="number")return e(n);if(n instanceof k)return k.fromElements(e(n.x),e(n.y),Xe.getCartesian2());if(n instanceof m)return m.fromElements(e(n.x),e(n.y),e(n.z),Xe.getCartesian3());if(n instanceof Y)return Y.fromElements(e(n.x),e(n.y),e(n.z),e(n.w),Xe.getCartesian4());throw new te(`Function "${t}" requires a vector or number argument. Argument is ${n}.`)}}function dg(e,t){return function(n,i,r){if(t&&typeof r=="number"){if(typeof i=="number")return e(i,r);if(i instanceof k)return k.fromElements(e(i.x,r),e(i.y,r),Xe.getCartesian2());if(i instanceof m)return m.fromElements(e(i.x,r),e(i.y,r),e(i.z,r),Xe.getCartesian3());if(i instanceof Y)return Y.fromElements(e(i.x,r),e(i.y,r),e(i.z,r),e(i.w,r),Xe.getCartesian4())}if(typeof i=="number"&&typeof r=="number")return e(i,r);if(i instanceof k&&r instanceof k)return k.fromElements(e(i.x,r.x),e(i.y,r.y),Xe.getCartesian2());if(i instanceof m&&r instanceof m)return m.fromElements(e(i.x,r.x),e(i.y,r.y),e(i.z,r.z),Xe.getCartesian3());if(i instanceof Y&&r instanceof Y)return Y.fromElements(e(i.x,r.x),e(i.y,r.y),e(i.z,r.z),e(i.w,r.w),Xe.getCartesian4());throw new te(`Function "${n}" requires vector or number arguments of matching types. Arguments are ${i} and ${r}.`)}}function u1(e,t){return function(n,i,r,s){if(typeof s=="number"){if(typeof i=="number"&&typeof r=="number")return e(i,r,s);if(i instanceof k&&r instanceof k)return k.fromElements(e(i.x,r.x,s),e(i.y,r.y,s),Xe.getCartesian2());if(i instanceof m&&r instanceof m)return m.fromElements(e(i.x,r.x,s),e(i.y,r.y,s),e(i.z,r.z,s),Xe.getCartesian3());if(i instanceof Y&&r instanceof Y)return Y.fromElements(e(i.x,r.x,s),e(i.y,r.y,s),e(i.z,r.z,s),e(i.w,r.w,s),Xe.getCartesian4())}if(typeof i=="number"&&typeof r=="number"&&typeof s=="number")return e(i,r,s);if(i instanceof k&&r instanceof k&&s instanceof k)return k.fromElements(e(i.x,r.x,s.x),e(i.y,r.y,s.y),Xe.getCartesian2());if(i instanceof m&&r instanceof m&&s instanceof m)return m.fromElements(e(i.x,r.x,s.x),e(i.y,r.y,s.y),e(i.z,r.z,s.z),Xe.getCartesian3());if(i instanceof Y&&r instanceof Y&&s instanceof Y)return Y.fromElements(e(i.x,r.x,s.x),e(i.y,r.y,s.y),e(i.z,r.z,s.z),e(i.w,r.w,s.w),Xe.getCartesian4());throw new te(`Function "${n}" requires vector or number arguments of matching types. Arguments are ${i}, ${r}, and ${s}.`)}}function hne(e,t){if(typeof t=="number")return Math.abs(t);if(t instanceof k)return k.magnitude(t);if(t instanceof m)return m.magnitude(t);if(t instanceof Y)return Y.magnitude(t);throw new te(`Function "${e}" requires a vector or number argument. Argument is ${t}.`)}function dne(e,t){if(typeof t=="number")return 1;if(t instanceof k)return k.normalize(t,Xe.getCartesian2());if(t instanceof m)return m.normalize(t,Xe.getCartesian3());if(t instanceof Y)return Y.normalize(t,Xe.getCartesian4());throw new te(`Function "${e}" requires a vector or number argument. Argument is ${t}.`)}function pne(e,t,n){if(typeof t=="number"&&typeof n=="number")return Math.abs(t-n);if(t instanceof k&&n instanceof k)return k.distance(t,n);if(t instanceof m&&n instanceof m)return m.distance(t,n);if(t instanceof Y&&n instanceof Y)return Y.distance(t,n);throw new te(`Function "${e}" requires vector or number arguments of matching types. Arguments are ${t} and ${n}.`)}function mne(e,t,n){if(typeof t=="number"&&typeof n=="number")return t*n;if(t instanceof k&&n instanceof k)return k.dot(t,n);if(t instanceof m&&n instanceof m)return m.dot(t,n);if(t instanceof Y&&n instanceof Y)return Y.dot(t,n);throw new te(`Function "${e}" requires vector or number arguments of matching types. Arguments are ${t} and ${n}.`)}function gne(e,t,n){if(t instanceof m&&n instanceof m)return m.cross(t,n,Xe.getCartesian3());throw new te(`Function "${e}" requires vec3 arguments. Arguments are ${t} and ${n}.`)}function _e(e,t,n,i,r){this._type=e,this._value=t,this._left=n,this._right=i,this._test=r,this.evaluate=void 0,One(this)}function _ne(e,t){if(!l(t))return e;for(const n in t)if(t.hasOwnProperty(n)){const i=new RegExp(`\\$\\{${n}\\}`,"g"),r=`(${t[n]})`;l(r)&&(e=e.replace(i,r))}return e}function yne(e){return e.replace(one,ane)}function tE(e){return e.replace(cne,"\\")}function bne(e){let t=e,n="",i=t.indexOf("${");for(;i>=0;){const r=t.indexOf("'"),s=t.indexOf('"');let o;if(r>=0&&r<i)o=t.indexOf("'",r+1),n+=t.substr(0,o+1),t=t.substr(o+1),i=t.indexOf("${");else if(s>=0&&s<i)o=t.indexOf('"',s+1),n+=t.substr(0,o+1),t=t.substr(o+1),i=t.indexOf("${");else{n+=t.substr(0,i);const a=t.indexOf("}");if(a<0)throw new te("Unmatched {.");n+=`czm_${t.substr(i+2,a-(i+2))}`,t=t.substr(a+1),i=t.indexOf("${")}}return n+=t,n}function Tne(e){const t=typeof e.value;if(e.value===null)return new _e(ye.LITERAL_NULL,null);if(t==="boolean")return new _e(ye.LITERAL_BOOLEAN,e.value);if(t==="number")return new _e(ye.LITERAL_NUMBER,e.value);if(t==="string")return e.value.indexOf("${")>=0?new _e(ye.VARIABLE_IN_STRING,e.value):new _e(ye.LITERAL_STRING,tE(e.value))}function xne(e,t){const n=t.arguments,i=n.length;let r,s,o,a;if(t.callee.type==="MemberExpression"){r=t.callee.property.name;const c=t.callee.object;if(r==="test"||r==="exec"){if(!l(c.callee)||c.callee.name!=="regExp")throw new te(`${r} is not a function.`);return i===0?r==="test"?new _e(ye.LITERAL_BOOLEAN,!1):new _e(ye.LITERAL_NULL,null):(o=Dt(e,c),a=Dt(e,n[0]),new _e(ye.FUNCTION_CALL,r,o,a))}else if(r==="toString")return s=Dt(e,c),new _e(ye.FUNCTION_CALL,r,s);throw new te(`Unexpected function call "${r}".`)}if(r=t.callee.name,r==="color"){if(i===0)return new _e(ye.LITERAL_COLOR,r);if(s=Dt(e,n[0]),l(n[1])){const c=Dt(e,n[1]);return new _e(ye.LITERAL_COLOR,r,[s,c])}return new _e(ye.LITERAL_COLOR,r,[s])}else if(r==="rgb"||r==="hsl"){if(i<3)throw new te(`${r} requires three arguments.`);return s=[Dt(e,n[0]),Dt(e,n[1]),Dt(e,n[2])],new _e(ye.LITERAL_COLOR,r,s)}else if(r==="rgba"||r==="hsla"){if(i<4)throw new te(`${r} requires four arguments.`);return s=[Dt(e,n[0]),Dt(e,n[1]),Dt(e,n[2]),Dt(e,n[3])],new _e(ye.LITERAL_COLOR,r,s)}else if(r==="vec2"||r==="vec3"||r==="vec4"){s=new Array(i);for(let c=0;c<i;++c)s[c]=Dt(e,n[c]);return new _e(ye.LITERAL_VECTOR,r,s)}else{if(r==="isNaN"||r==="isFinite")return i===0?r==="isNaN"?new _e(ye.LITERAL_BOOLEAN,!0):new _e(ye.LITERAL_BOOLEAN,!1):(s=Dt(e,n[0]),new _e(ye.UNARY,r,s));if(r==="isExactClass"||r==="isClass"){if(i<1||i>1)throw new te(`${r} requires exactly one argument.`);return s=Dt(e,n[0]),new _e(ye.UNARY,r,s)}else if(r==="getExactClassName"){if(i>0)throw new te(`${r} does not take any argument.`);return new _e(ye.UNARY,r)}else if(l(Ky[r])){if(i!==1)throw new te(`${r} requires exactly one argument.`);return s=Dt(e,n[0]),new _e(ye.UNARY,r,s)}else if(l(Zy[r])){if(i!==2)throw new te(`${r} requires exactly two arguments.`);return o=Dt(e,n[0]),a=Dt(e,n[1]),new _e(ye.BINARY,r,o,a)}else if(l(fw[r])){if(i!==3)throw new te(`${r} requires exactly three arguments.`);o=Dt(e,n[0]),a=Dt(e,n[1]);const c=Dt(e,n[2]);return new _e(ye.TERNARY,r,o,a,c)}else{if(r==="Boolean")return i===0?new _e(ye.LITERAL_BOOLEAN,!1):(s=Dt(e,n[0]),new _e(ye.UNARY,r,s));if(r==="Number")return i===0?new _e(ye.LITERAL_NUMBER,0):(s=Dt(e,n[0]),new _e(ye.UNARY,r,s));if(r==="String")return i===0?new _e(ye.LITERAL_STRING,""):(s=Dt(e,n[0]),new _e(ye.UNARY,r,s));if(r==="regExp")return Ene(e,t)}}throw new te(`Unexpected function call "${r}".`)}function Ene(e,t){const n=t.arguments;if(n.length===0)return new _e(ye.LITERAL_REGEX,new RegExp);const i=Dt(e,n[0]);let r;if(n.length>1){const s=Dt(e,n[1]);if($0(i)&&$0(s)){try{r=new RegExp(tE(String(i._value)),s._value)}catch(o){throw new te(o)}return new _e(ye.LITERAL_REGEX,r)}return new _e(ye.REGEX,i,s)}if($0(i)){try{r=new RegExp(tE(String(i._value)))}catch(s){throw new te(s)}return new _e(ye.LITERAL_REGEX,r)}return new _e(ye.REGEX,i)}function Cne(e){if(vne(e.name)){const t=Ine(e.name);return t.substr(0,8)==="tiles3d_"?new _e(ye.BUILTIN_VARIABLE,t):new _e(ye.VARIABLE,t)}else{if(e.name==="NaN")return new _e(ye.LITERAL_NUMBER,NaN);if(e.name==="Infinity")return new _e(ye.LITERAL_NUMBER,1/0);if(e.name==="undefined")return new _e(ye.LITERAL_UNDEFINED,void 0)}throw new te(`${e.name} is not defined.`)}function wne(e){const t=e.property.name;if(t==="PI")return new _e(ye.LITERAL_NUMBER,Math.PI);if(t==="E")return new _e(ye.LITERAL_NUMBER,Math.E)}function Ane(e){if(e.property.name==="POSITIVE_INFINITY")return new _e(ye.LITERAL_NUMBER,Number.POSITIVE_INFINITY)}function Sne(e,t){if(t.object.name==="Math")return wne(t);if(t.object.name==="Number")return Ane(t);let n;const i=Dt(e,t.object);return t.computed?(n=Dt(e,t.property),new _e(ye.MEMBER,"brackets",i,n)):(n=new _e(ye.LITERAL_STRING,t.property.name),new _e(ye.MEMBER,"dot",i,n))}function $0(e){return e._type>=ye.LITERAL_NULL}function vne(e){return e.substr(0,4)==="czm_"}function Ine(e){return e.substr(4)}function Dt(e,t){let n,i,r,s;if(t.type==="Literal")n=Tne(t);else if(t.type==="CallExpression")n=xne(e,t);else if(t.type==="Identifier")n=Cne(t);else if(t.type==="UnaryExpression"){i=t.operator;const o=Dt(e,t.argument);if(sne.indexOf(i)>-1)n=new _e(ye.UNARY,i,o);else throw new te(`Unexpected operator "${i}".`)}else if(t.type==="BinaryExpression")if(i=t.operator,r=Dt(e,t.left),s=Dt(e,t.right),l1.indexOf(i)>-1)n=new _e(ye.BINARY,i,r,s);else throw new te(`Unexpected operator "${i}".`);else if(t.type==="LogicalExpression")i=t.operator,r=Dt(e,t.left),s=Dt(e,t.right),l1.indexOf(i)>-1&&(n=new _e(ye.BINARY,i,r,s));else if(t.type==="ConditionalExpression"){const o=Dt(e,t.test);r=Dt(e,t.consequent),s=Dt(e,t.alternate),n=new _e(ye.CONDITIONAL,"?",r,s,o)}else if(t.type==="MemberExpression")n=Sne(e,t);else if(t.type==="ArrayExpression"){const o=[];for(let a=0;a<t.elements.length;a++)o[a]=Dt(e,t.elements[a]);n=new _e(ye.ARRAY,o)}else throw t.type==="Compound"?new te("Provide exactly one expression."):new te("Cannot parse expression.");return n}function One(e){e._type===ye.CONDITIONAL?e.evaluate=e._evaluateConditional:e._type===ye.FUNCTION_CALL?e._value==="test"?e.evaluate=e._evaluateRegExpTest:e._value==="exec"?e.evaluate=e._evaluateRegExpExec:e._value==="toString"&&(e.evaluate=e._evaluateToString):e._type===ye.UNARY?e._value==="!"?e.evaluate=e._evaluateNot:e._value==="-"?e.evaluate=e._evaluateNegative:e._value==="+"?e.evaluate=e._evaluatePositive:e._value==="isNaN"?e.evaluate=e._evaluateNaN:e._value==="isFinite"?e.evaluate=e._evaluateIsFinite:e._value==="isExactClass"?e.evaluate=e._evaluateIsExactClass:e._value==="isClass"?e.evaluate=e._evaluateIsClass:e._value==="getExactClassName"?e.evaluate=e._evaluateGetExactClassName:e._value==="Boolean"?e.evaluate=e._evaluateBooleanConversion:e._value==="Number"?e.evaluate=e._evaluateNumberConversion:e._value==="String"?e.evaluate=e._evaluateStringConversion:l(Ky[e._value])&&(e.evaluate=Dne(e._value)):e._type===ye.BINARY?e._value==="+"?e.evaluate=e._evaluatePlus:e._value==="-"?e.evaluate=e._evaluateMinus:e._value==="*"?e.evaluate=e._evaluateTimes:e._value==="/"?e.evaluate=e._evaluateDivide:e._value==="%"?e.evaluate=e._evaluateMod:e._value==="==="?e.evaluate=e._evaluateEqualsStrict:e._value==="!=="?e.evaluate=e._evaluateNotEqualsStrict:e._value==="<"?e.evaluate=e._evaluateLessThan:e._value==="<="?e.evaluate=e._evaluateLessThanOrEquals:e._value===">"?e.evaluate=e._evaluateGreaterThan:e._value===">="?e.evaluate=e._evaluateGreaterThanOrEquals:e._value==="&&"?e.evaluate=e._evaluateAnd:e._value==="||"?e.evaluate=e._evaluateOr:e._value==="=~"?e.evaluate=e._evaluateRegExpMatch:e._value==="!~"?e.evaluate=e._evaluateRegExpNotMatch:l(Zy[e._value])&&(e.evaluate=Mne(e._value)):e._type===ye.TERNARY?e.evaluate=Lne(e._value):e._type===ye.MEMBER?e._value==="brackets"?e.evaluate=e._evaluateMemberBrackets:e.evaluate=e._evaluateMemberDot:e._type===ye.ARRAY?e.evaluate=e._evaluateArray:e._type===ye.VARIABLE?e.evaluate=e._evaluateVariable:e._type===ye.VARIABLE_IN_STRING?e.evaluate=e._evaluateVariableString:e._type===ye.LITERAL_COLOR?e.evaluate=e._evaluateLiteralColor:e._type===ye.LITERAL_VECTOR?e.evaluate=e._evaluateLiteralVector:e._type===ye.LITERAL_STRING?e.evaluate=e._evaluateLiteralString:e._type===ye.REGEX?e.evaluate=e._evaluateRegExp:e._type===ye.BUILTIN_VARIABLE?e._value==="tiles3d_tileset_time"&&(e.evaluate=Rne):e.evaluate=e._evaluateLiteral}function Rne(e){return l(e)?e.content.tileset.timeSinceLoad:0}function Dne(e){const t=Ky[e];return function(n){const i=this._left.evaluate(n);return t(e,i)}}function Mne(e){const t=Zy[e];return function(n){const i=this._left.evaluate(n),r=this._right.evaluate(n);return t(e,i,r)}}function Lne(e){const t=fw[e];return function(n){const i=this._left.evaluate(n),r=this._right.evaluate(n),s=this._test.evaluate(n);return t(e,i,r,s)}}function Jy(e,t){if(l(e))return e.getPropertyInherited(t)}_e.prototype._evaluateLiteral=function(){return this._value};_e.prototype._evaluateLiteralColor=function(e){const t=Yy,n=this._left;if(this._value==="color")l(n)?n.length>1?(M.fromCssColorString(n[0].evaluate(e),t),t.alpha=n[1].evaluate(e)):M.fromCssColorString(n[0].evaluate(e),t):M.fromBytes(255,255,255,255,t);else if(this._value==="rgb")M.fromBytes(n[0].evaluate(e),n[1].evaluate(e),n[2].evaluate(e),255,t);else if(this._value==="rgba"){const i=n[3].evaluate(e)*255;M.fromBytes(n[0].evaluate(e),n[1].evaluate(e),n[2].evaluate(e),i,t)}else this._value==="hsl"?M.fromHsl(n[0].evaluate(e),n[1].evaluate(e),n[2].evaluate(e),1,t):this._value==="hsla"&&M.fromHsl(n[0].evaluate(e),n[1].evaluate(e),n[2].evaluate(e),n[3].evaluate(e),t);return Y.fromColor(t,Xe.getCartesian4())};_e.prototype._evaluateLiteralVector=function(e){const t=Xe.getArray(),n=this._value,i=this._left,r=i.length;for(let a=0;a<r;++a){const c=i[a].evaluate(e);if(typeof c=="number")t.push(c);else if(c instanceof k)t.push(c.x,c.y);else if(c instanceof m)t.push(c.x,c.y,c.z);else if(c instanceof Y)t.push(c.x,c.y,c.z,c.w);else throw new te(`${n} argument must be a vector or number. Argument is ${c}.`)}const s=t.length,o=parseInt(n.charAt(3));if(s===0)throw new te(`Invalid ${n} constructor. No valid arguments.`);if(s<o&&s>1)throw new te(`Invalid ${n} constructor. Not enough arguments.`);if(s>o&&r>1)throw new te(`Invalid ${n} constructor. Too many arguments.`);if(s===1){const a=t[0];t.push(a,a,a)}if(n==="vec2")return k.fromArray(t,0,Xe.getCartesian2());if(n==="vec3")return m.fromArray(t,0,Xe.getCartesian3());if(n==="vec4")return Y.fromArray(t,0,Xe.getCartesian4())};_e.prototype._evaluateLiteralString=function(){return this._value};_e.prototype._evaluateVariableString=function(e){let t=this._value,n=K_.exec(t);for(;n!==null;){const i=n[0],r=n[1];let s=Jy(e,r);l(s)||(s=""),t=t.replace(i,s),n=K_.exec(t)}return t};_e.prototype._evaluateVariable=function(e){return Jy(e,this._value)};function bu(e){return e._value==="feature"}_e.prototype._evaluateMemberDot=function(e){if(bu(this._left))return Jy(e,this._right.evaluate(e));const t=this._left.evaluate(e);if(!l(t))return;const n=this._right.evaluate(e);if(t instanceof k||t instanceof m||t instanceof Y){if(n==="r")return t.x;if(n==="g")return t.y;if(n==="b")return t.z;if(n==="a")return t.w}return t[n]};_e.prototype._evaluateMemberBrackets=function(e){if(bu(this._left))return Jy(e,this._right.evaluate(e));const t=this._left.evaluate(e);if(!l(t))return;const n=this._right.evaluate(e);if(t instanceof k||t instanceof m||t instanceof Y){if(n===0||n==="r")return t.x;if(n===1||n==="g")return t.y;if(n===2||n==="b")return t.z;if(n===3||n==="a")return t.w}return t[n]};_e.prototype._evaluateArray=function(e){const t=[];for(let n=0;n<this._value.length;n++)t[n]=this._value[n].evaluate(e);return t};_e.prototype._evaluateNot=function(e){const t=this._left.evaluate(e);if(typeof t!="boolean")throw new te(`Operator "!" requires a boolean argument. Argument is ${t}.`);return!t};_e.prototype._evaluateNegative=function(e){const t=this._left.evaluate(e);if(t instanceof k)return k.negate(t,Xe.getCartesian2());if(t instanceof m)return m.negate(t,Xe.getCartesian3());if(t instanceof Y)return Y.negate(t,Xe.getCartesian4());if(typeof t=="number")return-t;throw new te(`Operator "-" requires a vector or number argument. Argument is ${t}.`)};_e.prototype._evaluatePositive=function(e){const t=this._left.evaluate(e);if(!(t instanceof k||t instanceof m||t instanceof Y||typeof t=="number"))throw new te(`Operator "+" requires a vector or number argument. Argument is ${t}.`);return t};_e.prototype._evaluateLessThan=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if(typeof t!="number"||typeof n!="number")throw new te(`Operator "<" requires number arguments. Arguments are ${t} and ${n}.`);return t<n};_e.prototype._evaluateLessThanOrEquals=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if(typeof t!="number"||typeof n!="number")throw new te(`Operator "<=" requires number arguments. Arguments are ${t} and ${n}.`);return t<=n};_e.prototype._evaluateGreaterThan=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if(typeof t!="number"||typeof n!="number")throw new te(`Operator ">" requires number arguments. Arguments are ${t} and ${n}.`);return t>n};_e.prototype._evaluateGreaterThanOrEquals=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if(typeof t!="number"||typeof n!="number")throw new te(`Operator ">=" requires number arguments. Arguments are ${t} and ${n}.`);return t>=n};_e.prototype._evaluateOr=function(e){const t=this._left.evaluate(e);if(typeof t!="boolean")throw new te(`Operator "||" requires boolean arguments. First argument is ${t}.`);if(t)return!0;const n=this._right.evaluate(e);if(typeof n!="boolean")throw new te(`Operator "||" requires boolean arguments. Second argument is ${n}.`);return t||n};_e.prototype._evaluateAnd=function(e){const t=this._left.evaluate(e);if(typeof t!="boolean")throw new te(`Operator "&&" requires boolean arguments. First argument is ${t}.`);if(!t)return!1;const n=this._right.evaluate(e);if(typeof n!="boolean")throw new te(`Operator "&&" requires boolean arguments. Second argument is ${n}.`);return t&&n};_e.prototype._evaluatePlus=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if(n instanceof k&&t instanceof k)return k.add(t,n,Xe.getCartesian2());if(n instanceof m&&t instanceof m)return m.add(t,n,Xe.getCartesian3());if(n instanceof Y&&t instanceof Y)return Y.add(t,n,Xe.getCartesian4());if(typeof t=="string"||typeof n=="string")return t+n;if(typeof t=="number"&&typeof n=="number")return t+n;throw new te(`Operator "+" requires vector or number arguments of matching types, or at least one string argument. Arguments are ${t} and ${n}.`)};_e.prototype._evaluateMinus=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if(n instanceof k&&t instanceof k)return k.subtract(t,n,Xe.getCartesian2());if(n instanceof m&&t instanceof m)return m.subtract(t,n,Xe.getCartesian3());if(n instanceof Y&&t instanceof Y)return Y.subtract(t,n,Xe.getCartesian4());if(typeof t=="number"&&typeof n=="number")return t-n;throw new te(`Operator "-" requires vector or number arguments of matching types. Arguments are ${t} and ${n}.`)};_e.prototype._evaluateTimes=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if(n instanceof k&&t instanceof k)return k.multiplyComponents(t,n,Xe.getCartesian2());if(n instanceof k&&typeof t=="number")return k.multiplyByScalar(n,t,Xe.getCartesian2());if(t instanceof k&&typeof n=="number")return k.multiplyByScalar(t,n,Xe.getCartesian2());if(n instanceof m&&t instanceof m)return m.multiplyComponents(t,n,Xe.getCartesian3());if(n instanceof m&&typeof t=="number")return m.multiplyByScalar(n,t,Xe.getCartesian3());if(t instanceof m&&typeof n=="number")return m.multiplyByScalar(t,n,Xe.getCartesian3());if(n instanceof Y&&t instanceof Y)return Y.multiplyComponents(t,n,Xe.getCartesian4());if(n instanceof Y&&typeof t=="number")return Y.multiplyByScalar(n,t,Xe.getCartesian4());if(t instanceof Y&&typeof n=="number")return Y.multiplyByScalar(t,n,Xe.getCartesian4());if(typeof t=="number"&&typeof n=="number")return t*n;throw new te(`Operator "*" requires vector or number arguments. If both arguments are vectors they must be matching types. Arguments are ${t} and ${n}.`)};_e.prototype._evaluateDivide=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if(n instanceof k&&t instanceof k)return k.divideComponents(t,n,Xe.getCartesian2());if(t instanceof k&&typeof n=="number")return k.divideByScalar(t,n,Xe.getCartesian2());if(n instanceof m&&t instanceof m)return m.divideComponents(t,n,Xe.getCartesian3());if(t instanceof m&&typeof n=="number")return m.divideByScalar(t,n,Xe.getCartesian3());if(n instanceof Y&&t instanceof Y)return Y.divideComponents(t,n,Xe.getCartesian4());if(t instanceof Y&&typeof n=="number")return Y.divideByScalar(t,n,Xe.getCartesian4());if(typeof t=="number"&&typeof n=="number")return t/n;throw new te(`Operator "/" requires vector or number arguments of matching types, or a number as the second argument. Arguments are ${t} and ${n}.`)};_e.prototype._evaluateMod=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if(n instanceof k&&t instanceof k)return k.fromElements(t.x%n.x,t.y%n.y,Xe.getCartesian2());if(n instanceof m&&t instanceof m)return m.fromElements(t.x%n.x,t.y%n.y,t.z%n.z,Xe.getCartesian3());if(n instanceof Y&&t instanceof Y)return Y.fromElements(t.x%n.x,t.y%n.y,t.z%n.z,t.w%n.w,Xe.getCartesian4());if(typeof t=="number"&&typeof n=="number")return t%n;throw new te(`Operator "%" requires vector or number arguments of matching types. Arguments are ${t} and ${n}.`)};_e.prototype._evaluateEqualsStrict=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);return n instanceof k&&t instanceof k||n instanceof m&&t instanceof m||n instanceof Y&&t instanceof Y?t.equals(n):t===n};_e.prototype._evaluateNotEqualsStrict=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);return n instanceof k&&t instanceof k||n instanceof m&&t instanceof m||n instanceof Y&&t instanceof Y?!t.equals(n):t!==n};_e.prototype._evaluateConditional=function(e){const t=this._test.evaluate(e);if(typeof t!="boolean")throw new te(`Conditional argument of conditional expression must be a boolean. Argument is ${t}.`);return t?this._left.evaluate(e):this._right.evaluate(e)};_e.prototype._evaluateNaN=function(e){return isNaN(this._left.evaluate(e))};_e.prototype._evaluateIsFinite=function(e){return isFinite(this._left.evaluate(e))};_e.prototype._evaluateIsExactClass=function(e){return l(e)?e.isExactClass(this._left.evaluate(e)):!1};_e.prototype._evaluateIsClass=function(e){return l(e)?e.isClass(this._left.evaluate(e)):!1};_e.prototype._evaluateGetExactClassName=function(e){if(l(e))return e.getExactClassName()};_e.prototype._evaluateBooleanConversion=function(e){return!!this._left.evaluate(e)};_e.prototype._evaluateNumberConversion=function(e){return Number(this._left.evaluate(e))};_e.prototype._evaluateStringConversion=function(e){return String(this._left.evaluate(e))};_e.prototype._evaluateRegExp=function(e){const t=this._value.evaluate(e);let n="";l(this._left)&&(n=this._left.evaluate(e));let i;try{i=new RegExp(t,n)}catch(r){throw new te(r)}return i};_e.prototype._evaluateRegExpTest=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if(!(t instanceof RegExp&&typeof n=="string"))throw new te(`RegExp.test requires the first argument to be a RegExp and the second argument to be a string. Arguments are ${t} and ${n}.`);return t.test(n)};_e.prototype._evaluateRegExpMatch=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if(t instanceof RegExp&&typeof n=="string")return t.test(n);if(n instanceof RegExp&&typeof t=="string")return n.test(t);throw new te(`Operator "=~" requires one RegExp argument and one string argument. Arguments are ${t} and ${n}.`)};_e.prototype._evaluateRegExpNotMatch=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if(t instanceof RegExp&&typeof n=="string")return!t.test(n);if(n instanceof RegExp&&typeof t=="string")return!n.test(t);throw new te(`Operator "!~" requires one RegExp argument and one string argument. Arguments are ${t} and ${n}.`)};_e.prototype._evaluateRegExpExec=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if(!(t instanceof RegExp&&typeof n=="string"))throw new te(`RegExp.exec requires the first argument to be a RegExp and the second argument to be a string. Arguments are ${t} and ${n}.`);const i=t.exec(n);return l(i)?i[1]:null};_e.prototype._evaluateToString=function(e){const t=this._left.evaluate(e);if(t instanceof RegExp||t instanceof k||t instanceof m||t instanceof Y)return String(t);throw new te(`Unexpected function call "${this._value}".`)};function f1(e){const t=e._left,n=t.length;for(let a=0;a<n;++a)if(t[a]._type!==ye.LITERAL_NUMBER)return;const i=t[0]._value,r=t[1]._value,s=t[2]._value,o=n===4?t[3]._value:1;return M.fromHsl(i,r,s,o,Yy)}function h1(e){const t=e._left,n=t.length;for(let r=0;r<n;++r)if(t[r]._type!==ye.LITERAL_NUMBER)return;const i=Yy;return i.red=t[0]._value/255,i.green=t[1]._value/255,i.blue=t[2]._value/255,i.alpha=n===4?t[3]._value:1,i}function el(e){return e%1===0?e.toFixed(1):e.toString()}function Pne(e){const t=el(e.red),n=el(e.green),i=el(e.blue);return`vec3(${t}, ${n}, ${i})`}function pg(e){const t=el(e.red),n=el(e.green),i=el(e.blue),r=el(e.alpha);return`vec4(${t}, ${n}, ${i}, ${r})`}function d1(e,t,n,i){const r=e.length,s=new Array(r);for(let o=0;o<r;++o)s[o]=e[o].getShaderExpression(t,n,i);return s}function p1(e,t){return l(t[e])?t[e]:No.NULL_SENTINEL}No.NULL_SENTINEL="czm_infinity";_e.prototype.getShaderExpression=function(e,t,n){let i,r,s,o;const a=this._type;let c=this._value;l(this._left)&&(Array.isArray(this._left)?r=d1(this._left,e,t,this):r=this._left.getShaderExpression(e,t,this)),l(this._right)&&(s=this._right.getShaderExpression(e,t,this)),l(this._test)&&(o=this._test.getShaderExpression(e,t,this)),Array.isArray(this._value)&&(c=d1(this._value,e,t,this));let u,h,d;switch(a){case ye.VARIABLE:return bu(this)?void 0:p1(c,e);case ye.UNARY:if(c==="Boolean")return`bool(${r})`;if(c==="Number")return`float(${r})`;if(c==="round")return`floor(${r} + 0.5)`;if(l(Ky[c]))return`${c}(${r})`;if(c==="isNaN")return`(${r} != ${r})`;if(c==="isFinite")return`(abs(${r}) < czm_infinity)`;if(c==="String"||c==="isExactClass"||c==="isClass"||c==="getExactClassName")throw new te(`Error generating style shader: "${c}" is not supported.`);return c+r;case ye.BINARY:return c==="%"?`mod(${r}, ${s})`:c==="==="?`(${r} == ${s})`:c==="!=="?`(${r} != ${s})`:c==="atan2"?`atan(${r}, ${s})`:l(Zy[c])?`${c}(${r}, ${s})`:`(${r} ${c} ${s})`;case ye.TERNARY:if(l(fw[c]))return`${c}(${r}, ${s}, ${o})`;break;case ye.CONDITIONAL:return`(${o} ? ${r} : ${s})`;case ye.MEMBER:return bu(this._left)?p1(s,e):s==="r"||s==="x"||s==="0.0"?`${r}[0]`:s==="g"||s==="y"||s==="1.0"?`${r}[1]`:s==="b"||s==="z"||s==="2.0"?`${r}[2]`:s==="a"||s==="w"||s==="3.0"?`${r}[3]`:`${r}[int(${s})]`;case ye.FUNCTION_CALL:throw new te(`Error generating style shader: "${c}" is not supported.`);case ye.ARRAY:if(c.length===4)return`vec4(${c[0]}, ${c[1]}, ${c[2]}, ${c[3]})`;if(c.length===3)return`vec3(${c[0]}, ${c[1]}, ${c[2]})`;if(c.length===2)return`vec2(${c[0]}, ${c[1]})`;throw new te("Error generating style shader: Invalid array length. Array length should be 2, 3, or 4.");case ye.REGEX:throw new te("Error generating style shader: Regular expressions are not supported.");case ye.VARIABLE_IN_STRING:throw new te("Error generating style shader: Converting a variable to a string is not supported.");case ye.LITERAL_NULL:return No.NULL_SENTINEL;case ye.LITERAL_BOOLEAN:return c?"true":"false";case ye.LITERAL_NUMBER:return el(c);case ye.LITERAL_STRING:if(l(n)&&n._type===ye.MEMBER&&(c==="r"||c==="g"||c==="b"||c==="a"||c==="x"||c==="y"||c==="z"||c==="w"||bu(n._left)))return c;if(i=M.fromCssColorString(c,Yy),l(i))return Pne(i);throw new te("Error generating style shader: String literals are not supported.");case ye.LITERAL_COLOR:if(u=r,c==="color"){if(l(u)){if(u.length>1){const p=u[0],g=u[1];return g!=="1.0"&&(t.translucent=!0),`vec4(${p}, ${g})`}}else return"vec4(1.0)";return`vec4(${u[0]}, 1.0)`}else{if(c==="rgb")return i=h1(this),l(i)?pg(i):`vec4(${u[0]} / 255.0, ${u[1]} / 255.0, ${u[2]} / 255.0, 1.0)`;if(c==="rgba")return u[3]!=="1.0"&&(t.translucent=!0),i=h1(this),l(i)?pg(i):`vec4(${u[0]} / 255.0, ${u[1]} / 255.0, ${u[2]} / 255.0, ${u[3]})`;if(c==="hsl")return i=f1(this),l(i)?pg(i):`vec4(czm_HSLToRGB(vec3(${u[0]}, ${u[1]}, ${u[2]})), 1.0)`;if(c==="hsla")return i=f1(this),l(i)?(i.alpha!==1&&(t.translucent=!0),pg(i)):(u[3]!=="1.0"&&(t.translucent=!0),`vec4(czm_HSLToRGB(vec3(${u[0]}, ${u[1]}, ${u[2]})), ${u[3]})`)}break;case ye.LITERAL_VECTOR:if(!l(r))throw new A("left should always be defined for type ExpressionNodeType.LITERAL_VECTOR");h=r.length,d=`${c}(`;for(let p=0;p<h;++p)d+=r[p],p<h-1&&(d+=", ");return d+=")",d;case ye.LITERAL_REGEX:throw new te("Error generating style shader: Regular expressions are not supported.");case ye.LITERAL_UNDEFINED:return No.NULL_SENTINEL;case ye.BUILTIN_VARIABLE:if(c==="tiles3d_tileset_time")return c}};_e.prototype.getVariables=function(e,t){let n,i,r;const s=this._type,o=this._value;if(l(this._left))if(Array.isArray(this._left))for(n=this._left,i=n.length,r=0;r<i;++r)n[r].getVariables(e,this);else this._left.getVariables(e,this);if(l(this._right)&&this._right.getVariables(e,this),l(this._test)&&this._test.getVariables(e,this),Array.isArray(this._value))for(n=this._value,i=n.length,r=0;r<i;++r)n[r].getVariables(e,this);let a;switch(s){case ye.VARIABLE:bu(this)||e.push(o);break;case ye.VARIABLE_IN_STRING:for(a=K_.exec(o);a!==null;)e.push(a[1]),a=K_.exec(o);break;case ye.LITERAL_STRING:l(t)&&t._type===ye.MEMBER&&bu(t._left)&&e.push(o);break}};function Sa(e){e=T(e,T.EMPTY_OBJECT),this._batchTable=e.batchTable,this._batchIds=e.batchIds,this._positions=e.positions,this._vertexBatchIds=e.vertexBatchIds,this._indices=e.indices,this._indexCounts=e.indexCounts,this._indexOffsets=e.indexOffsets,this._batchedIndices=e.batchedIndices,this._boundingVolume=e.boundingVolume,this._boundingVolumes=e.boundingVolumes,this._center=T(e.center,m.ZERO),this._va=void 0,this._sp=void 0,this._spStencil=void 0,this._spPick=void 0,this._uniformMap=void 0,this._vaSwap=void 0,this._rsStencilDepthPass=void 0,this._rsStencilDepthPass3DTiles=void 0,this._rsColorPass=void 0,this._rsPickPass=void 0,this._rsWireframe=void 0,this._commands=[],this._commandsIgnoreShow=[],this._pickCommands=[],this._constantColor=M.clone(M.WHITE),this._highlightColor=this._constantColor,this._batchDirty=!0,this._pickCommandsDirty=!0,this._framesSinceLastRebatch=0,this._updatingAllCommands=!1,this._trianglesLength=this._indices.length/3,this._geometryByteLength=this._indices.byteLength+this._positions.byteLength+this._vertexBatchIds.byteLength,this.debugWireframe=!1,this._debugWireframe=this.debugWireframe,this._wireframeDirty=!1,this.forceRebatch=!1,this.classificationType=T(e.classificationType,Ks.BOTH),this._vertexShaderSource=e._vertexShaderSource,this._fragmentShaderSource=e._fragmentShaderSource,this._attributeLocations=e._attributeLocations,this._uniformMap=e._uniformMap,this._pickId=e._pickId,this._modelMatrix=e._modelMatrix,this._boundingSphere=e._boundingSphere,this._batchIdLookUp={};const t=this._batchIds.length;for(let n=0;n<t;++n){const i=this._batchIds[n];this._batchIdLookUp[i]=n}}Object.defineProperties(Sa.prototype,{trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}}});const Nne={position:0,a_batchId:1};function Fne(e,t){if(l(e._va))return;const n=ze.createVertexBuffer({context:t,typedArray:e._positions,usage:Ae.STATIC_DRAW}),i=ze.createVertexBuffer({context:t,typedArray:e._vertexBatchIds,usage:Ae.STATIC_DRAW}),r=ze.createIndexBuffer({context:t,typedArray:e._indices,usage:Ae.DYNAMIC_DRAW,indexDatatype:e._indices.BYTES_PER_ELEMENT===2?Ge.UNSIGNED_SHORT:Ge.UNSIGNED_INT}),s=[{index:0,vertexBuffer:n,componentDatatype:q.fromTypedArray(e._positions),componentsPerAttribute:3},{index:1,vertexBuffer:i,componentDatatype:q.fromTypedArray(e._vertexBatchIds),componentsPerAttribute:1}];e._va=new $i({context:t,attributes:s,indexBuffer:r}),t.webgl2&&(e._vaSwap=new $i({context:t,attributes:s,indexBuffer:ze.createIndexBuffer({context:t,sizeInBytes:r.sizeInBytes,usage:Ae.DYNAMIC_DRAW,indexDatatype:r.indexDatatype})})),e._batchedPositions=void 0,e._transferrableBatchIds=void 0,e._vertexBatchIds=void 0}function Bne(e,t){if(l(e._sp))return;const n=e._batchTable,i=T(e._attributeLocations,Nne);let r=e._pickId;const s=e._vertexShaderSource;let o=e._fragmentShaderSource;if(l(s)){e._sp=kn.fromCache({context:t,vertexShaderSource:s,fragmentShaderSource:o,attributeLocations:i}),e._spStencil=e._sp,o=Je.replaceMain(o,"czm_non_pick_main"),o=`${o}void main() 
{ 
    czm_non_pick_main(); 
    out_FragColor = ${r}; 
} 
`,e._spPick=kn.fromCache({context:t,vertexShaderSource:s,fragmentShaderSource:o,attributeLocations:i});return}const a=n.getVertexShaderCallback(!1,"a_batchId",void 0)(c1);let c=n.getFragmentShaderCallback(!1,void 0,!0)($I);r=n.getPickId();let u=new Je({sources:[a]}),h=new Je({defines:["VECTOR_TILE"],sources:[c]});e._sp=kn.fromCache({context:t,vertexShaderSource:u,fragmentShaderSource:h,attributeLocations:i}),u=new Je({sources:[c1]}),h=new Je({defines:["VECTOR_TILE"],sources:[$I]}),e._spStencil=kn.fromCache({context:t,vertexShaderSource:u,fragmentShaderSource:h,attributeLocations:i}),c=Je.replaceMain(c,"czm_non_pick_main"),c=`${c}
void main() 
{ 
    czm_non_pick_main(); 
    out_FragColor = ${r}; 
} 
`;const d=new Je({sources:[a]}),p=new Je({defines:["VECTOR_TILE"],sources:[c]});e._spPick=kn.fromCache({context:t,vertexShaderSource:d,fragmentShaderSource:p,attributeLocations:i})}function m1(e){const t=e?Ei.EQUAL:Ei.ALWAYS;return{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},stencilTest:{enabled:!0,frontFunction:t,frontOperation:{fail:Qe.KEEP,zFail:Qe.DECREMENT_WRAP,zPass:Qe.KEEP},backFunction:t,backOperation:{fail:Qe.KEEP,zFail:Qe.INCREMENT_WRAP,zPass:Qe.KEEP},reference:yt.CESIUM_3D_TILE_MASK,mask:yt.CESIUM_3D_TILE_MASK},stencilMask:yt.CLASSIFICATION_MASK,depthTest:{enabled:!0,func:Xy.LESS_OR_EQUAL},depthMask:!1}}const zne={stencilTest:{enabled:!0,frontFunction:Ei.NOT_EQUAL,frontOperation:{fail:Qe.ZERO,zFail:Qe.ZERO,zPass:Qe.ZERO},backFunction:Ei.NOT_EQUAL,backOperation:{fail:Qe.ZERO,zFail:Qe.ZERO,zPass:Qe.ZERO},reference:0,mask:yt.CLASSIFICATION_MASK},stencilMask:yt.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1,blending:vs.PRE_MULTIPLIED_ALPHA_BLEND},Une={stencilTest:{enabled:!0,frontFunction:Ei.NOT_EQUAL,frontOperation:{fail:Qe.ZERO,zFail:Qe.ZERO,zPass:Qe.ZERO},backFunction:Ei.NOT_EQUAL,backOperation:{fail:Qe.ZERO,zFail:Qe.ZERO,zPass:Qe.ZERO},reference:0,mask:yt.CLASSIFICATION_MASK},stencilMask:yt.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1};function kne(e){l(e._rsStencilDepthPass)||(e._rsStencilDepthPass=it.fromCache(m1(!1)),e._rsStencilDepthPass3DTiles=it.fromCache(m1(!0)),e._rsColorPass=it.fromCache(zne),e._rsPickPass=it.fromCache(Une))}const Xl=new P,g1=new m;function jne(e,t){if(l(e._uniformMap))return;const n={u_modifiedModelViewProjection:function(){const i=t.uniformState.view,r=t.uniformState.projection;return P.clone(i,Xl),P.multiplyByPoint(Xl,e._center,g1),P.setTranslation(Xl,g1,Xl),P.multiply(r,Xl,Xl),Xl},u_highlightColor:function(){return e._highlightColor}};e._uniformMap=e._batchTable.getUniformMapCallback()(n)}function X0(e,t,n,i,r,s,o){const a=e.constructor.BYTES_PER_ELEMENT,c=s.length;for(let u=0;u<c;++u){const h=s[u],d=o[h],p=i[d],g=r[d],_=new e.constructor(e.buffer,a*p,g);t.set(_,n),i[d]=n,n+=g}return n}function Vne(e,t){const n=e._indices,i=e._indexOffsets,r=e._indexCounts,s=e._batchIdLookUp,o=new n.constructor(n.length);let a=t.pop();const c=[a];let u=X0(n,o,0,i,r,a.batchIds,s);for(a.offset=0,a.count=u;t.length>0;){const h=t.pop();if(M.equals(h.color,a.color))u=X0(n,o,u,i,r,h.batchIds,s),a.batchIds=a.batchIds.concat(h.batchIds),a.count=u-a.offset;else{const d=u;u=X0(n,o,u,i,r,h.batchIds,s),h.offset=d,h.count=u-d,c.push(h),a=h}}e._va.indexBuffer.copyFromArrayView(o),e._indices=o,e._batchedIndices=c}function Y0(e,t,n,i,r,s,o){const a=e.bytesPerIndex,c=s.length;for(let u=0;u<c;++u){const h=s[u],d=o[h],p=i[d],g=r[d];t.copyFromBuffer(e,p*a,n*a,g*a),i[d]=n,n+=g}return n}function Gne(e,t){const n=e._indexOffsets,i=e._indexCounts,r=e._batchIdLookUp;let s=t.pop();const o=[s],a=e._va.indexBuffer,c=e._vaSwap.indexBuffer;let u=Y0(a,c,0,n,i,s.batchIds,r);for(s.offset=0,s.count=u;t.length>0;){const d=t.pop();if(M.equals(d.color,s.color))u=Y0(a,c,u,n,i,d.batchIds,r),s.batchIds=s.batchIds.concat(d.batchIds),s.count=u-s.offset;else{const p=u;u=Y0(a,c,u,n,i,d.batchIds,r),d.offset=p,d.count=u-p,o.push(d),s=d}}const h=e._va;e._va=e._vaSwap,e._vaSwap=h,e._batchedIndices=o}function Hne(e,t){return t.color.toRgba()-e.color.toRgba()}function qne(e,t){if(!e._batchDirty)return!1;const n=e._batchedIndices,i=n.length;let r=!1;const s={};for(let o=0;o<i;++o){const c=n[o].color.toRgba();if(l(s[c])){r=!0;break}else s[c]=!0}if(!r)return e._batchDirty=!1,!1;if(r&&!e.forceRebatch&&e._framesSinceLastRebatch<120){++e._framesSinceLastRebatch;return}return n.sort(Hne),t.webgl2?Gne(e,n):Vne(e,n),e._framesSinceLastRebatch=0,e._batchDirty=!1,e._pickCommandsDirty=!0,e._wireframeDirty=!0,!0}function Wne(e,t){const n=qne(e,t),i=e._commands,r=e._batchedIndices,s=r.length,o=s*2;if(l(i)&&!n&&i.length===o)return;i.length=o;const a=e._va,c=e._sp,u=T(e._modelMatrix,P.IDENTITY),h=e._uniformMap,d=e._boundingVolume;for(let p=0;p<s;++p){const g=r[p].offset,_=r[p].count;let b=i[p*2];l(b)||(b=i[p*2]=new Tt({owner:e})),b.vertexArray=a,b.modelMatrix=u,b.offset=g,b.count=_,b.renderState=e._rsStencilDepthPass,b.shaderProgram=c,b.uniformMap=h,b.boundingVolume=d,b.cull=!1,b.pass=Ke.TERRAIN_CLASSIFICATION;const x=Tt.shallowClone(b,b.derivedCommands.tileset);x.renderState=e._rsStencilDepthPass3DTiles,x.pass=Ke.CESIUM_3D_TILE_CLASSIFICATION,b.derivedCommands.tileset=x;let E=i[p*2+1];l(E)||(E=i[p*2+1]=new Tt({owner:e})),E.vertexArray=a,E.modelMatrix=u,E.offset=g,E.count=_,E.renderState=e._rsColorPass,E.shaderProgram=c,E.uniformMap=h,E.boundingVolume=d,E.cull=!1,E.pass=Ke.TERRAIN_CLASSIFICATION;const C=Tt.shallowClone(E,E.derivedCommands.tileset);C.pass=Ke.CESIUM_3D_TILE_CLASSIFICATION,E.derivedCommands.tileset=C}e._commandsDirty=!0}function $ne(e,t){if(e.classificationType===Ks.TERRAIN||!t.invertClassification||l(e._commandsIgnoreShow)&&!e._commandsDirty)return;const n=e._commands,i=e._commandsIgnoreShow,r=e._spStencil,s=n.length,o=i.length=s/2;let a=0;for(let c=0;c<o;++c){const u=i[c]=Tt.shallowClone(n[a],i[c]);u.shaderProgram=r,u.pass=Ke.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW,a+=2}e._commandsDirty=!1}function Xne(e){if(!e._pickCommandsDirty)return;const t=e._indexOffsets.length,n=e._pickCommands;n.length=t*2;const i=e._va,r=e._spStencil,s=e._spPick,o=T(e._modelMatrix,P.IDENTITY),a=e._uniformMap;for(let c=0;c<t;++c){const u=e._indexOffsets[c],h=e._indexCounts[c],d=l(e._boundingVolumes)?e._boundingVolumes[c]:e.boundingVolume;let p=n[c*2];l(p)||(p=n[c*2]=new Tt({owner:e,pickOnly:!0})),p.vertexArray=i,p.modelMatrix=o,p.offset=u,p.count=h,p.renderState=e._rsStencilDepthPass,p.shaderProgram=r,p.uniformMap=a,p.boundingVolume=d,p.pass=Ke.TERRAIN_CLASSIFICATION;const g=Tt.shallowClone(p,p.derivedCommands.tileset);g.renderState=e._rsStencilDepthPass3DTiles,g.pass=Ke.CESIUM_3D_TILE_CLASSIFICATION,p.derivedCommands.tileset=g;let _=n[c*2+1];l(_)||(_=n[c*2+1]=new Tt({owner:e,pickOnly:!0})),_.vertexArray=i,_.modelMatrix=o,_.offset=u,_.count=h,_.renderState=e._rsPickPass,_.shaderProgram=s,_.uniformMap=a,_.boundingVolume=d,_.pass=Ke.TERRAIN_CLASSIFICATION;const b=Tt.shallowClone(_,_.derivedCommands.tileset);b.pass=Ke.CESIUM_3D_TILE_CLASSIFICATION,_.derivedCommands.tileset=b}e._pickCommandsDirty=!1}Sa.prototype.createFeatures=function(e,t){const n=this._batchIds,i=n.length;for(let r=0;r<i;++r){const s=n[r];t[s]=new vr(e,s)}};Sa.prototype.applyDebugSettings=function(e,t){this._highlightColor=e?t:this._constantColor};function Yne(e,t){e._updatingAllCommands=!0;const n=e._batchIds;let i=n.length,r;for(r=0;r<i;++r){const o=n[r],a=t[o];a.show=!0,a.color=M.WHITE}const s=e._batchedIndices;for(i=s.length,r=0;r<i;++r)s[r].color=M.clone(M.WHITE);e._updatingAllCommands=!1,e._batchDirty=!0}const Kne=new M,Zne=M.WHITE,Jne=!0,Qne=/\$/;Sa.prototype.applyStyle=function(e,t){if(!l(e)){Yne(this,t);return}const n=e.color,i=n instanceof No&&!Qne.test(n.expression);this._updatingAllCommands=i;const r=this._batchIds;let s=r.length,o;for(o=0;o<s;++o){const a=r[o],c=t[a];c.color=l(e.color)?e.color.evaluateColor(c,Kne):Zne,c.show=l(e.show)?e.show.evaluate(c):Jne}if(i){const a=this._batchedIndices;for(s=a.length,o=0;o<s;++o)a[o].color=M.clone(M.WHITE);this._updatingAllCommands=!1,this._batchDirty=!0}};Sa.prototype.updateCommands=function(e,t){if(this._updatingAllCommands)return;const n=this._batchIdLookUp,i=n[e];if(!l(i))return;const r=this._indexOffsets,s=this._indexCounts,o=r[i],a=s[i],c=this._batchedIndices,u=c.length;let h;for(h=0;h<u;++h){const b=c[h].offset,x=c[h].count;if(o>=b&&o<b+x)break}c.push(new Y_({color:M.clone(t),offset:o,count:a,batchIds:[e]}));const d=[],p=[],g=c[h].batchIds,_=g.length;for(let b=0;b<_;++b){const x=g[b];if(x===e)continue;const E=n[x];r[E]<o?d.push(x):p.push(x)}p.length!==0&&c.push(new Y_({color:M.clone(c[h].color),offset:o+a,count:c[h].offset+c[h].count-(o+a),batchIds:p})),d.length!==0?(c[h].count=o-c[h].offset,c[h].batchIds=d):c.splice(h,1),this._batchDirty=!0};function _1(e,t,n,i){const r=e.classificationType,s=r!==Ks.CESIUM_3D_TILE,o=r!==Ks.TERRAIN,a=t.commandList;let c=n.length,u,h;for(h=0;h<c;++h)s&&(u=n[h],u.pass=Ke.TERRAIN_CLASSIFICATION,a.push(u)),o&&(u=n[h].derivedCommands.tileset,u.pass=Ke.CESIUM_3D_TILE_CLASSIFICATION,a.push(u));if(!(!t.invertClassification||!l(i)))for(c=i.length,h=0;h<c;++h)a.push(i[h])}function eie(e,t){const n=e.commandList,i=t.length;for(let r=0;r<i;r+=2){const s=t[r+1];s.pass=Ke.OPAQUE,n.push(s)}}function tie(e){let t=e.debugWireframe===e._debugWireframe;if(t=t&&!(e.debugWireframe&&e._wireframeDirty),t)return;l(e._rsWireframe)||(e._rsWireframe=it.fromCache({}));let n,i;e.debugWireframe?(n=e._rsWireframe,i=Fe.LINES):(n=e._rsColorPass,i=Fe.TRIANGLES);const r=e._commands,s=r.length;for(let o=0;o<s;o+=2){const a=r[o+1];a.renderState=n,a.primitiveType=i}e._debugWireframe=e.debugWireframe,e._wireframeDirty=!1}Sa.prototype.update=function(e){const t=e.context;Fne(this,t),Bne(this,t),kne(this),jne(this,t);const n=e.passes;n.render&&(Wne(this,t),$ne(this,e),tie(this),this._debugWireframe?eie(e,this._commands):_1(this,e,this._commands,this._commandsIgnoreShow)),n.pick&&(Xne(this),_1(this,e,this._pickCommands))};Sa.prototype.isDestroyed=function(){return!1};Sa.prototype.destroy=function(){return this._va=this._va&&this._va.destroy(),this._sp=this._sp&&this._sp.destroy(),this._spPick=this._spPick&&this._spPick.destroy(),this._vaSwap=this._vaSwap&&this._vaSwap.destroy(),Ye(this)};function rr(e){this._boxes=e.boxes,this._boxBatchIds=e.boxBatchIds,this._cylinders=e.cylinders,this._cylinderBatchIds=e.cylinderBatchIds,this._ellipsoids=e.ellipsoids,this._ellipsoidBatchIds=e.ellipsoidBatchIds,this._spheres=e.spheres,this._sphereBatchIds=e.sphereBatchIds,this._modelMatrix=e.modelMatrix,this._batchTable=e.batchTable,this._boundingVolume=e.boundingVolume,this._center=e.center,l(this._center)||(l(this._boundingVolume)?this._center=m.clone(this._boundingVolume.center):this._center=m.clone(m.ZERO)),this._boundingVolumes=void 0,this._batchedIndices=void 0,this._indices=void 0,this._indexOffsets=void 0,this._indexCounts=void 0,this._positions=void 0,this._vertexBatchIds=void 0,this._batchIds=void 0,this._batchTableColors=void 0,this._packedBuffer=void 0,this._ready=!1,this._promise=void 0,this._error=void 0,this._verticesPromise=void 0,this._primitive=void 0,this.debugWireframe=!1,this.forceRebatch=!1,this.classificationType=Ks.BOTH}Object.defineProperties(rr.prototype,{trianglesLength:{get:function(){return l(this._primitive)?this._primitive.trianglesLength:0}},geometryByteLength:{get:function(){return l(this._primitive)?this._primitive.geometryByteLength:0}},ready:{get:function(){return this._ready}}});rr.packedBoxLength=P.packedLength+m.packedLength;rr.packedCylinderLength=P.packedLength+2;rr.packedEllipsoidLength=P.packedLength+m.packedLength;rr.packedSphereLength=m.packedLength+1;function nie(e){const t=new Float64Array(P.packedLength+m.packedLength);let n=0;return m.pack(e._center,t,n),n+=m.packedLength,P.pack(e._modelMatrix,t,n),t}function iie(e,t){let n=0;const i=t[n++],r=t[n++],s=e._boundingVolumes=new Array(r);for(let c=0;c<r;++c)s[c]=ee.unpack(t,n),n+=ee.packedLength;const o=t[n++],a=e._batchedIndices=new Array(o);for(let c=0;c<o;++c){const u=M.unpack(t,n);n+=M.packedLength;const h=t[n++],d=t[n++],p=t[n++],g=new Array(p);for(let _=0;_<p;++_)g[_]=t[n++];a[c]=new Y_({color:u,offset:h,count:d,batchIds:g})}return i}const rie=new Dn("createVectorTileGeometries",5),sie=new M;function oie(e){if(!l(e._primitive)&&!l(e._verticesPromise)){let t=e._boxes,n=e._boxBatchIds,i=e._cylinders,r=e._cylinderBatchIds,s=e._ellipsoids,o=e._ellipsoidBatchIds,a=e._spheres,c=e._sphereBatchIds,u=e._batchTableColors,h=e._packedBuffer;if(!l(u)){let _=0;l(e._boxes)&&(t=e._boxes=t.slice(),n=e._boxBatchIds=n.slice(),_+=n.length),l(e._cylinders)&&(i=e._cylinders=i.slice(),r=e._cylinderBatchIds=r.slice(),_+=r.length),l(e._ellipsoids)&&(s=e._ellipsoids=s.slice(),o=e._ellipsoidBatchIds=o.slice(),_+=o.length),l(e._spheres)&&(a=e._sphere=a.slice(),c=e._sphereBatchIds=c.slice(),_+=c.length),u=e._batchTableColors=new Uint32Array(_);const b=e._batchTable;for(let x=0;x<_;++x){const E=b.getColor(x,sie);u[x]=E.toRgba()}h=e._packedBuffer=nie(e)}const d=[];l(t)&&d.push(t.buffer,n.buffer),l(i)&&d.push(i.buffer,r.buffer),l(s)&&d.push(s.buffer,o.buffer),l(a)&&d.push(a.buffer,c.buffer),d.push(u.buffer,h.buffer);const p={boxes:l(t)?t.buffer:void 0,boxBatchIds:l(t)?n.buffer:void 0,cylinders:l(i)?i.buffer:void 0,cylinderBatchIds:l(i)?r.buffer:void 0,ellipsoids:l(s)?s.buffer:void 0,ellipsoidBatchIds:l(s)?o.buffer:void 0,spheres:l(a)?a.buffer:void 0,sphereBatchIds:l(a)?c.buffer:void 0,batchTableColors:u.buffer,packedBuffer:h.buffer},g=e._verticesPromise=rie.scheduleTask(p,d);return l(g)?g.then(function(_){if(e.isDestroyed())return;const b=new Float64Array(_.packedBuffer);iie(e,b)===2?e._indices=new Uint16Array(_.indices):e._indices=new Uint32Array(_.indices),e._indexOffsets=new Uint32Array(_.indexOffsets),e._indexCounts=new Uint32Array(_.indexCounts),e._positions=new Float32Array(_.positions),e._vertexBatchIds=new Uint16Array(_.vertexBatchIds),e._batchIds=new Uint16Array(_.batchIds),aie(e),e._ready=!0}).catch(_=>{e.isDestroyed()||(e._error=_)}):void 0}}function aie(e){l(e._primitive)||(e._primitive=new Sa({batchTable:e._batchTable,positions:e._positions,batchIds:e._batchIds,vertexBatchIds:e._vertexBatchIds,indices:e._indices,indexOffsets:e._indexOffsets,indexCounts:e._indexCounts,batchedIndices:e._batchedIndices,boundingVolume:e._boundingVolume,boundingVolumes:e._boundingVolumes,center:e._center,pickObject:T(e._pickObject,e)}),e._boxes=void 0,e._boxBatchIds=void 0,e._cylinders=void 0,e._cylinderBatchIds=void 0,e._ellipsoids=void 0,e._ellipsoidBatchIds=void 0,e._spheres=void 0,e._sphereBatchIds=void 0,e._center=void 0,e._modelMatrix=void 0,e._batchTable=void 0,e._boundingVolume=void 0,e._boundingVolumes=void 0,e._batchedIndices=void 0,e._indices=void 0,e._indexOffsets=void 0,e._indexCounts=void 0,e._positions=void 0,e._vertexBatchIds=void 0,e._batchIds=void 0,e._batchTableColors=void 0,e._packedBuffer=void 0,e._verticesPromise=void 0)}rr.prototype.createFeatures=function(e,t){this._primitive.createFeatures(e,t)};rr.prototype.applyDebugSettings=function(e,t){this._primitive.applyDebugSettings(e,t)};rr.prototype.applyStyle=function(e,t){this._primitive.applyStyle(e,t)};rr.prototype.updateCommands=function(e,t){this._primitive.updateCommands(e,t)};rr.prototype.update=function(e){if(!this._ready){if(l(this._promise)||(this._promise=oie(this)),l(this._error)){const t=this._error;throw this._error=void 0,t}return}this._primitive.debugWireframe=this.debugWireframe,this._primitive.forceRebatch=this.forceRebatch,this._primitive.classificationType=this.classificationType,this._primitive.update(e)};rr.prototype.isDestroyed=function(){return!1};rr.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),Ye(this)};function va(e,t,n,i,r){this._tileset=e,this._tile=t,this._resource=n,this._geometries=void 0,this._metadata=void 0,this._batchTable=void 0,this._features=void 0,this.featurePropertiesDirty=!1,this._group=void 0,this._ready=!1,uie(this,i,r)}Object.defineProperties(va.prototype,{featuresLength:{get:function(){return l(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return l(this._geometries)?this._geometries.trianglesLength:0}},geometryByteLength:{get:function(){return l(this._geometries)?this._geometries.geometryByteLength:0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return l(this._batchTable)?this._batchTable.batchTableByteLength:0}},innerContents:{get:function(){}},ready:{get:function(){return this._ready}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},metadata:{get:function(){return this._metadata},set:function(e){this._metadata=e}},batchTable:{get:function(){return this._batchTable}},group:{get:function(){return this._group},set:function(e){this._group=e}}});function cie(e){return function(t,n){l(e._geometries)&&e._geometries.updateCommands(t,n)}}function lie(e,t){let n,i,r,s,o;const a=T(e.BOXES_LENGTH,0),c=T(e.CYLINDERS_LENGTH,0),u=T(e.ELLIPSOIDS_LENGTH,0),h=T(e.SPHERES_LENGTH,0);if(a>0&&l(e.BOX_BATCH_IDS)){const _=t.byteOffset+e.BOX_BATCH_IDS.byteOffset;n=new Uint16Array(t.buffer,_,a)}if(c>0&&l(e.CYLINDER_BATCH_IDS)){const _=t.byteOffset+e.CYLINDER_BATCH_IDS.byteOffset;i=new Uint16Array(t.buffer,_,c)}if(u>0&&l(e.ELLIPSOID_BATCH_IDS)){const _=t.byteOffset+e.ELLIPSOID_BATCH_IDS.byteOffset;r=new Uint16Array(t.buffer,_,u)}if(h>0&&l(e.SPHERE_BATCH_IDS)){const _=t.byteOffset+e.SPHERE_BATCH_IDS.byteOffset;s=new Uint16Array(t.buffer,_,h)}const d=l(n)||l(i)||l(r)||l(s),p=a>0&&!l(n)||c>0&&!l(i)||u>0&&!l(r)||h>0&&!l(s);if(d&&p)throw new te("If one group of batch ids is defined, then all batch ids must be defined");if(!l(n)&&!l(i)&&!l(r)&&!l(s)){let _=0;if(!l(n)&&a>0)for(n=new Uint16Array(a),o=0;o<a;++o)n[o]=_++;if(!l(i)&&c>0)for(i=new Uint16Array(c),o=0;o<c;++o)i[o]=_++;if(!l(r)&&u>0)for(r=new Uint16Array(u),o=0;o<u;++o)r[o]=_++;if(!l(s)&&h>0)for(s=new Uint16Array(h),o=0;o<h;++o)s[o]=_++}return{boxes:n,cylinders:i,ellipsoids:r,spheres:s}}const Yl=Uint32Array.BYTES_PER_ELEMENT;function uie(e,t,n){n=T(n,0);const i=new Uint8Array(t),r=new DataView(t);n+=Yl;const s=r.getUint32(n,!0);if(s!==1)throw new te(`Only Geometry tile version 1 is supported.  Version ${s} is not.`);n+=Yl;const o=r.getUint32(n,!0);if(n+=Yl,o===0){e._ready=!0;return}const a=r.getUint32(n,!0);if(n+=Yl,a===0)throw new te("Feature table must have a byte length greater than zero");const c=r.getUint32(n,!0);n+=Yl;const u=r.getUint32(n,!0);n+=Yl;const h=r.getUint32(n,!0);n+=Yl;const d=Cs(i,n,a);n+=a;const p=new Uint8Array(t,n,c);n+=c;let g,_;u>0&&(g=Cs(i,n,u),n+=u,h>0&&(_=new Uint8Array(t,n,h),_=new Uint8Array(_)));const b=T(d.BOXES_LENGTH,0),x=T(d.CYLINDERS_LENGTH,0),E=T(d.ELLIPSOIDS_LENGTH,0),C=T(d.SPHERES_LENGTH,0),w=b+x+E+C,S=new en(e,w,g,_,cie(e));if(e._batchTable=S,w===0)return;const v=e.tile.computedTransform;let D;l(d.RTC_CENTER)&&(D=m.unpack(d.RTC_CENTER),P.multiplyByPoint(v,D,D));const L=lie(d,p);if(b>0||x>0||E>0||C>0){let O,N,B,U;if(b>0){const V=p.byteOffset+d.BOXES.byteOffset;O=new Float32Array(p.buffer,V,rr.packedBoxLength*b)}if(x>0){const V=p.byteOffset+d.CYLINDERS.byteOffset;N=new Float32Array(p.buffer,V,rr.packedCylinderLength*x)}if(E>0){const V=p.byteOffset+d.ELLIPSOIDS.byteOffset;B=new Float32Array(p.buffer,V,rr.packedEllipsoidLength*E)}if(C>0){const V=p.byteOffset+d.SPHERES.byteOffset;U=new Float32Array(p.buffer,V,rr.packedSphereLength*C)}return e._geometries=new rr({boxes:O,boxBatchIds:L.boxes,cylinders:N,cylinderBatchIds:L.cylinders,ellipsoids:B,ellipsoidBatchIds:L.ellipsoids,spheres:U,sphereBatchIds:L.spheres,center:D,modelMatrix:v,batchTable:S,boundingVolume:e.tile.boundingVolume.boundingVolume}),e}return Promise.resolve(e)}function rN(e){const t=e.featuresLength;if(!l(e._features)&&t>0){const n=new Array(t);l(e._geometries)&&e._geometries.createFeatures(e,n),e._features=n}}va.prototype.hasProperty=function(e,t){return this._batchTable.hasProperty(e,t)};va.prototype.getFeature=function(e){const t=this.featuresLength;if(!l(e)||e<0||e>=t)throw new A(`batchId is required and between zero and featuresLength - 1 (${t-1}).`);return rN(this),this._features[e]};va.prototype.applyDebugSettings=function(e,t){l(this._geometries)&&this._geometries.applyDebugSettings(e,t)};va.prototype.applyStyle=function(e){rN(this),l(this._geometries)&&this._geometries.applyStyle(e,this._features)};va.prototype.update=function(e,t){l(this._geometries)&&(this._geometries.classificationType=this._tileset.classificationType,this._geometries.debugWireframe=this._tileset.debugWireframe,this._geometries.update(t)),l(this._batchTable)&&this._geometries.ready&&(this._batchTable.update(e,t),this._ready=!0)};va.prototype.pick=function(e,t,n){};va.prototype.isDestroyed=function(){return!1};va.prototype.destroy=function(){return this._geometries=this._geometries&&this._geometries.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Ye(this)};function oi(e,t){return l(e)&&l(e.extensions)&&l(e.extensions[t])}function Z_(e){const t=e.lengthBits;let n=e.availableCount;y.typeOf.number("options.lengthBits",t);const i=e.constant,r=e.bitstream;if(l(i))n=t;else{const s=Math.ceil(t/8);if(r.length!==s)throw new te(`Availability bitstream must be exactly ${s} bytes long to store ${t} bits. Actual bitstream was ${r.length} bytes long.`);const o=T(e.computeAvailableCountEnabled,!1);!l(n)&&o&&(n=fie(r,t))}this._lengthBits=t,this._availableCount=n,this._constant=i,this._bitstream=r}function fie(e,t){let n=0;for(let i=0;i<t;i++){const r=i>>3,s=i%8;n+=e[r]>>s&1}return n}Object.defineProperties(Z_.prototype,{lengthBits:{get:function(){return this._lengthBits}},availableCount:{get:function(){return this._availableCount}}});Z_.prototype.getBit=function(e){if(e<0||e>=this._lengthBits)throw new A("Bit index out of bounds.");if(l(this._constant))return this._constant;const t=e>>3,n=e%8;return(this._bitstream[t]>>n&1)===1};function Ia(e){e=T(e,T.EMPTY_OBJECT);const t=e.metadataTable,n=e.class,i=e.entityId,r=e.propertyTableJson;y.typeOf.object("options.metadataTable",t),y.typeOf.object("options.class",n),y.typeOf.number("options.entityId",i),y.typeOf.object("options.propertyTableJson",r),this._class=n,this._metadataTable=t,this._entityId=i,this._extensions=r.extensions,this._extras=r.extras}Object.defineProperties(Ia.prototype,{class:{get:function(){return this._class}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});Ia.prototype.hasProperty=function(e){return this._metadataTable.hasProperty(e)};Ia.prototype.hasPropertyBySemantic=function(e){return this._metadataTable.hasPropertyBySemantic(e)};Ia.prototype.getPropertyIds=function(e){return this._metadataTable.getPropertyIds(e)};Ia.prototype.getProperty=function(e){return this._metadataTable.getProperty(this._entityId,e)};Ia.prototype.setProperty=function(e,t){return this._metadataTable.setProperty(this._entityId,e,t)};Ia.prototype.getPropertyBySemantic=function(e){return this._metadataTable.getPropertyBySemantic(this._entityId,e)};Ia.prototype.setPropertyBySemantic=function(e,t){return this._metadataTable.setPropertyBySemantic(this._entityId,e,t)};const l_={QUADTREE:"QUADTREE",OCTREE:"OCTREE"};l_.getBranchingFactor=function(e){switch(e){case l_.OCTREE:return 8;case l_.QUADTREE:return 4;default:throw new A("subdivisionScheme is not a valid value.")}};const Ti=Object.freeze(l_);function He(){}Object.defineProperties(He.prototype,{class:{get:function(){A.throwInstantiationError()}}});He.prototype.hasProperty=function(e){A.throwInstantiationError()};He.prototype.hasPropertyBySemantic=function(e){A.throwInstantiationError()};He.prototype.getPropertyIds=function(e){A.throwInstantiationError()};He.prototype.getProperty=function(e){A.throwInstantiationError()};He.prototype.setProperty=function(e,t){A.throwInstantiationError()};He.prototype.getPropertyBySemantic=function(e){A.throwInstantiationError()};He.prototype.setPropertyBySemantic=function(e,t){A.throwInstantiationError()};He.hasProperty=function(e,t,n){if(y.typeOf.string("propertyId",e),y.typeOf.object("properties",t),y.typeOf.object("classDefinition",n),l(t[e]))return!0;const i=n.properties;if(!l(i))return!1;const r=i[e];return!!(l(r)&&l(r.default))};He.hasPropertyBySemantic=function(e,t,n){y.typeOf.string("semantic",e),y.typeOf.object("properties",t),y.typeOf.object("classDefinition",n);const i=n.propertiesBySemantic;if(!l(i))return!1;const r=i[e];return l(r)};He.getPropertyIds=function(e,t,n){y.typeOf.object("properties",e),y.typeOf.object("classDefinition",t),n=l(n)?n:[],n.length=0;for(const r in e)e.hasOwnProperty(r)&&l(e[r])&&n.push(r);const i=t.properties;if(l(i))for(const r in i)i.hasOwnProperty(r)&&!l(e[r])&&l(i[r].default)&&n.push(r);return n};He.getProperty=function(e,t,n){if(y.typeOf.string("propertyId",e),y.typeOf.object("properties",t),y.typeOf.object("classDefinition",n),!l(n.properties[e]))throw new A(`Class definition missing property ${e}`);const i=n.properties[e];let r=t[e];Array.isArray(r)&&(r=r.slice());const s=!0;if(r=i.handleNoData(r),!l(r)&&l(i.default))return r=Se(i.default,!0),i.unpackVectorAndMatrixTypes(r,s);if(l(r))return r=i.normalize(r),r=i.applyValueTransform(r),i.unpackVectorAndMatrixTypes(r,s)};He.setProperty=function(e,t,n,i){if(y.typeOf.string("propertyId",e),y.defined("value",t),y.typeOf.object("properties",n),y.typeOf.object("classDefinition",i),!l(n[e]))return!1;Array.isArray(t)&&(t=t.slice());let r;const s=i.properties;return l(s)&&(r=s[e]),l(r)&&(t=r.packVectorAndMatrixTypes(t,!0),t=r.unapplyValueTransform(t),t=r.unnormalize(t)),n[e]=t,!0};He.getPropertyBySemantic=function(e,t,n){y.typeOf.string("semantic",e),y.typeOf.object("properties",t),y.typeOf.object("classDefinition",n);const i=n.propertiesBySemantic;if(!l(i))return;const r=i[e];if(l(r))return He.getProperty(r.id,t,n)};He.setPropertyBySemantic=function(e,t,n,i){y.typeOf.string("semantic",e),y.defined("value",t),y.typeOf.object("properties",n),y.typeOf.object("classDefinition",i);const r=i.propertiesBySemantic;if(!l(r))return!1;const s=i.propertiesBySemantic[e];return l(s)?He.setProperty(s.id,t,n,i):!1};function gc(e){e=T(e,T.EMPTY_OBJECT);const t=e.subtreeMetadata,n=e.class;y.typeOf.object("options.subtreeMetadata",t),y.typeOf.object("options.class",n);const i=l(t.properties)?t.properties:{};this._class=n,this._properties=i,this._extras=t.extras,this._extensions=t.extensions}Object.defineProperties(gc.prototype,{class:{get:function(){return this._class}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});gc.prototype.hasProperty=function(e){return He.hasProperty(e,this._properties,this._class)};gc.prototype.hasPropertyBySemantic=function(e){return He.hasPropertyBySemantic(e,this._properties,this._class)};gc.prototype.getPropertyIds=function(e){return He.getPropertyIds(this._properties,this._class,e)};gc.prototype.getProperty=function(e){return He.getProperty(e,this._properties,this._class)};gc.prototype.setProperty=function(e,t){return He.setProperty(e,t,this._properties,this._class)};gc.prototype.getPropertyBySemantic=function(e){return He.getPropertyBySemantic(e,this._properties,this._class)};gc.prototype.setPropertyBySemantic=function(e,t){return He.setPropertyBySemantic(e,t,this._properties,this._class)};const Ee={INT8:"INT8",UINT8:"UINT8",INT16:"INT16",UINT16:"UINT16",INT32:"INT32",UINT32:"UINT32",INT64:"INT64",UINT64:"UINT64",FLOAT32:"FLOAT32",FLOAT64:"FLOAT64"};Ee.getMinimum=function(e){switch(y.typeOf.string("type",e),e){case Ee.INT8:return-128;case Ee.UINT8:return 0;case Ee.INT16:return-32768;case Ee.UINT16:return 0;case Ee.INT32:return-2147483648;case Ee.UINT32:return 0;case Ee.INT64:return It.supportsBigInt()?BigInt("-9223372036854775808"):-Math.pow(2,63);case Ee.UINT64:return It.supportsBigInt()?BigInt(0):0;case Ee.FLOAT32:return-34028234663852886e22;case Ee.FLOAT64:return-Number.MAX_VALUE}};Ee.getMaximum=function(e){switch(y.typeOf.string("type",e),e){case Ee.INT8:return 127;case Ee.UINT8:return 255;case Ee.INT16:return 32767;case Ee.UINT16:return 65535;case Ee.INT32:return 2147483647;case Ee.UINT32:return 4294967295;case Ee.INT64:return It.supportsBigInt()?BigInt("9223372036854775807"):Math.pow(2,63)-1;case Ee.UINT64:return It.supportsBigInt()?BigInt("18446744073709551615"):Math.pow(2,64)-1;case Ee.FLOAT32:return 34028234663852886e22;case Ee.FLOAT64:return Number.MAX_VALUE}};Ee.isIntegerType=function(e){switch(y.typeOf.string("type",e),e){case Ee.INT8:case Ee.UINT8:case Ee.INT16:case Ee.UINT16:case Ee.INT32:case Ee.UINT32:case Ee.INT64:case Ee.UINT64:return!0;default:return!1}};Ee.isUnsignedIntegerType=function(e){switch(y.typeOf.string("type",e),e){case Ee.UINT8:case Ee.UINT16:case Ee.UINT32:case Ee.UINT64:return!0;default:return!1}};Ee.isVectorCompatible=function(e){switch(y.typeOf.string("type",e),e){case Ee.INT8:case Ee.UINT8:case Ee.INT16:case Ee.UINT16:case Ee.INT32:case Ee.UINT32:case Ee.FLOAT32:case Ee.FLOAT64:return!0;default:return!1}};Ee.normalize=function(e,t){if(typeof e!="number"&&typeof e!="bigint")throw new A("value must be a number or a BigInt");if(!Ee.isIntegerType(t))throw new A("type must be an integer type");return Math.max(Number(e)/Number(Ee.getMaximum(t)),-1)};Ee.unnormalize=function(e,t){if(y.typeOf.number("value",e),!Ee.isIntegerType(t))throw new A("type must be an integer type");const n=Ee.getMaximum(t),i=Ee.isUnsignedIntegerType(t)?0:-n;return e=R.sign(e)*Math.round(Math.abs(e)*Number(n)),(t===Ee.INT64||t===Ee.UINT64)&&It.supportsBigInt()&&(e=BigInt(e)),e>n?n:e<i?i:e};Ee.applyValueTransform=function(e,t,n){return n*e+t};Ee.unapplyValueTransform=function(e,t,n){return n===0?0:(e-t)/n};Ee.getSizeInBytes=function(e){switch(y.typeOf.string("type",e),e){case Ee.INT8:case Ee.UINT8:return 1;case Ee.INT16:case Ee.UINT16:return 2;case Ee.INT32:case Ee.UINT32:return 4;case Ee.INT64:case Ee.UINT64:return 8;case Ee.FLOAT32:return 4;case Ee.FLOAT64:return 8}};Ee.fromComponentDatatype=function(e){switch(y.typeOf.number("componentDatatype",e),e){case q.BYTE:return Ee.INT8;case q.UNSIGNED_BYTE:return Ee.UINT8;case q.SHORT:return Ee.INT16;case q.UNSIGNED_SHORT:return Ee.UINT16;case q.INT:return Ee.INT32;case q.UNSIGNED_INT:return Ee.UINT32;case q.FLOAT:return Ee.FLOAT32;case q.DOUBLE:return Ee.FLOAT64}};Ee.toComponentDatatype=function(e){switch(y.typeOf.string("type",e),e){case Ee.INT8:return q.BYTE;case Ee.UINT8:return q.UNSIGNED_BYTE;case Ee.INT16:return q.SHORT;case Ee.UINT16:return q.UNSIGNED_SHORT;case Ee.INT32:return q.INT;case Ee.UINT32:return q.UNSIGNED_INT;case Ee.FLOAT32:return q.FLOAT;case Ee.FLOAT64:return q.DOUBLE}};const ct=Object.freeze(Ee),_n={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4",BOOLEAN:"BOOLEAN",STRING:"STRING",ENUM:"ENUM"};_n.isVectorType=function(e){switch(y.typeOf.string("type",e),e){case _n.VEC2:case _n.VEC3:case _n.VEC4:return!0;default:return!1}};_n.isMatrixType=function(e){switch(y.typeOf.string("type",e),e){case _n.MAT2:case _n.MAT3:case _n.MAT4:return!0;default:return!1}};_n.getComponentCount=function(e){switch(y.typeOf.string("type",e),e){case _n.SCALAR:case _n.STRING:case _n.ENUM:case _n.BOOLEAN:return 1;case _n.VEC2:return 2;case _n.VEC3:return 3;case _n.VEC4:return 4;case _n.MAT2:return 4;case _n.MAT3:return 9;case _n.MAT4:return 16;default:throw new A(`Invalid metadata type ${e}`)}};_n.getMathType=function(e){switch(e){case _n.VEC2:return k;case _n.VEC3:return m;case _n.VEC4:return Y;case _n.MAT2:return Te;case _n.MAT3:return H;case _n.MAT4:return P;default:return}};const at=Object.freeze(_n);function Li(e){e=T(e,T.EMPTY_OBJECT);const t=e.id,n=e.type;y.typeOf.string("options.id",t),y.typeOf.string("options.type",n);const i=e.componentType,r=e.enumType,s=l(i)&&ct.isIntegerType(i)&&T(e.normalized,!1);this._id=t,this._name=e.name,this._description=e.description,this._semantic=e.semantic,this._isLegacyExtension=e.isLegacyExtension,this._type=n,this._componentType=i,this._enumType=r,this._valueType=l(r)?r.valueType:i,this._isArray=T(e.isArray,!1),this._isVariableLengthArray=T(e.isVariableLengthArray,!1),this._arrayLength=e.arrayLength,this._min=Se(e.min,!0),this._max=Se(e.max,!0),this._normalized=s;let o=Se(e.offset,!0),a=Se(e.scale,!0);const c=l(o)||l(a),u=!0;l(o)||(o=this.expandConstant(0,u)),l(a)||(a=this.expandConstant(1,u)),this._offset=o,this._scale=a,this._hasValueTransform=c,this._noData=Se(e.noData,!0),this._default=Se(e.default,!0),this._required=T(e.required,!0),this._extras=Se(e.extras,!0),this._extensions=Se(e.extensions,!0)}Li.fromJson=function(e){e=T(e,T.EMPTY_OBJECT);const t=e.id,n=e.property;y.typeOf.string("options.id",t),y.typeOf.object("options.property",n),y.typeOf.string("options.property.type",n.type);const i=hie(n),r=die(n,e.enums);let s;return l(i)?i?s=l(n.optional)?!n.optional:!0:s=T(n.required,!1):s=!1,new Li({id:t,type:r.type,componentType:r.componentType,enumType:r.enumType,isArray:r.isArray,isVariableLengthArray:r.isVariableLengthArray,arrayLength:r.arrayLength,normalized:n.normalized,min:n.min,max:n.max,offset:n.offset,scale:n.scale,noData:n.noData,default:n.default,required:s,name:n.name,description:n.description,semantic:n.semantic,extras:n.extras,extensions:n.extensions,isLegacyExtension:i})};Object.defineProperties(Li.prototype,{id:{get:function(){return this._id}},name:{get:function(){return this._name}},description:{get:function(){return this._description}},type:{get:function(){return this._type}},enumType:{get:function(){return this._enumType}},componentType:{get:function(){return this._componentType}},valueType:{get:function(){return this._valueType}},isArray:{get:function(){return this._isArray}},isVariableLengthArray:{get:function(){return this._isVariableLengthArray}},arrayLength:{get:function(){return this._arrayLength}},normalized:{get:function(){return this._normalized}},max:{get:function(){return this._max}},min:{get:function(){return this._min}},noData:{get:function(){return this._noData}},default:{get:function(){return this._default}},required:{get:function(){return this._required}},semantic:{get:function(){return this._semantic}},hasValueTransform:{get:function(){return this._hasValueTransform}},offset:{get:function(){return this._offset}},scale:{get:function(){return this._scale}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});function hie(e){if(e.type==="ARRAY")return!0;const t=e.type;if(t===at.SCALAR||at.isMatrixType(t)||at.isVectorType(t))return!1;if(l(ct[t]))return!0;if(l(e.noData)||l(e.scale)||l(e.offset)||l(e.required)||l(e.count)||l(e.array)||l(e.optional))return!1}function die(e,t){const n=e.type,i=e.componentType,r=n==="ARRAY";let s,o,a;r?(s=!0,o=e.componentCount,a=!l(o)):e.array?(s=!0,o=e.count,a=!l(e.count)):(s=!1,o=void 0,a=!1);let c;if(l(e.enumType)&&(c=t[e.enumType]),n===at.ENUM)return{type:n,componentType:void 0,enumType:c,valueType:c.valueType,isArray:s,isVariableLengthArray:a,arrayLength:o};if(r&&i===at.ENUM)return{type:i,componentType:void 0,enumType:c,valueType:c.valueType,isArray:s,isVariableLengthArray:a,arrayLength:o};if(n===at.SCALAR||at.isMatrixType(n)||at.isVectorType(n))return{type:n,componentType:i,enumType:void 0,valueType:i,isArray:s,isVariableLengthArray:a,arrayLength:o};if(n===at.BOOLEAN||n===at.STRING)return{type:n,componentType:void 0,enumType:void 0,valueType:void 0,isArray:s,isVariableLengthArray:a,arrayLength:o};if(r&&(i===at.BOOLEAN||i===at.STRING))return{type:i,componentType:void 0,enumType:void 0,valueType:void 0,isArray:s,isVariableLengthArray:a,arrayLength:o};if(l(i)&&l(ct[i]))return{type:at.SCALAR,componentType:i,enumType:void 0,valueType:i,isArray:s,isVariableLengthArray:a,arrayLength:o};if(l(ct[n]))return{type:at.SCALAR,componentType:n,enumType:void 0,valueType:n,isArray:s,isVariableLengthArray:a,arrayLength:o};throw new A(`unknown metadata type {type: ${n}, componentType: ${i})`)}Li.prototype.normalize=function(e){return this._normalized?hw(e,this._valueType,ct.normalize):e};Li.prototype.unnormalize=function(e){return this._normalized?hw(e,this._valueType,ct.unnormalize):e};Li.prototype.applyValueTransform=function(e){return!this._hasValueTransform||this._isVariableLengthArray?e:Li.valueTransformInPlace(e,this._offset,this._scale,ct.applyValueTransform)};Li.prototype.unapplyValueTransform=function(e){return!this._hasValueTransform||this._isVariableLengthArray?e:Li.valueTransformInPlace(e,this._offset,this._scale,ct.unapplyValueTransform)};Li.prototype.expandConstant=function(e,t){t=T(t,!1);const n=this._isArray,i=this._arrayLength,r=at.getComponentCount(this._type),s=n&&r>1;if(!n&&r===1)return e;if(!n)return new Array(r).fill(e);if(!s)return new Array(i).fill(e);if(!t)return new Array(this._arrayLength*r).fill(e);const o=new Array(r).fill(e);return new Array(this._arrayLength).fill(o)};Li.prototype.handleNoData=function(e){const t=this._noData;if(!l(t))return e;if(!sN(e,t))return e};function sN(e,t){if(!Array.isArray(e))return e===t;if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!sN(e[n],t[n]))return!1;return!0}Li.prototype.unpackVectorAndMatrixTypes=function(e,t){t=T(t,!1);const n=at.getMathType(this._type),i=this._isArray,r=at.getComponentCount(this._type),s=i&&r>1;return l(n)?t&&s?e.map(function(o){return n.unpack(o)}):i?n.unpackArray(e):n.unpack(e):e};Li.prototype.packVectorAndMatrixTypes=function(e,t){t=T(t,!1);const n=at.getMathType(this._type),i=this._isArray,r=at.getComponentCount(this._type),s=i&&r>1;return l(n)?t&&s?e.map(function(o){return n.pack(o,[])}):i?n.packArray(e,[]):n.pack(e,[]):e};Li.prototype.validate=function(e){if(!(!l(e)&&l(this._default)))return this._required&&!l(e)?"required property must have a value":this._isArray?pie(this,e):oN(this,e)};function pie(e,t){if(!Array.isArray(t))return`value ${t} must be an array`;const n=t.length;if(!e._isVariableLengthArray&&n!==e._arrayLength)return"Array length does not match property.arrayLength";for(let i=0;i<n;i++){const r=oN(e,t[i]);if(l(r))return r}}function oN(e,t){const n=e._type,i=e._componentType,r=e._enumType,s=e._normalized;return at.isVectorType(n)?mie(t,n,i):at.isMatrixType(n)?gie(t,n,i):n===at.STRING?_ie(t):n===at.BOOLEAN?yie(t):n===at.ENUM?bie(t,r):Tie(t,i,s)}function mie(e,t,n){if(!ct.isVectorCompatible(n))return`componentType ${n} is incompatible with vector type ${t}`;if(t===at.VEC2&&!(e instanceof k))return`vector value ${e} must be a Cartesian2`;if(t===at.VEC3&&!(e instanceof m))return`vector value ${e} must be a Cartesian3`;if(t===at.VEC4&&!(e instanceof Y))return`vector value ${e} must be a Cartesian4`}function gie(e,t,n){if(!ct.isVectorCompatible(n))return`componentType ${n} is incompatible with matrix type ${t}`;if(t===at.MAT2&&!(e instanceof Te))return`matrix value ${e} must be a Matrix2`;if(t===at.MAT3&&!(e instanceof H))return`matrix value ${e} must be a Matrix3`;if(t===at.MAT4&&!(e instanceof P))return`matrix value ${e} must be a Matrix4`}function _ie(e){if(typeof e!="string")return J_(e,at.STRING)}function yie(e){if(typeof e!="boolean")return J_(e,at.BOOLEAN)}function bie(e,t){const n=typeof e;if(l(t))return n!=="string"||!l(t.valuesByName[e])?`value ${e} is not a valid enum name for ${t.id}`:void 0}function Tie(e,t,n){const i=typeof e;switch(t){case ct.INT8:case ct.UINT8:case ct.INT16:case ct.UINT16:case ct.INT32:case ct.UINT32:case ct.FLOAT32:case ct.FLOAT64:return i!=="number"?J_(e,t):isFinite(e)?b1(e,t,n):T1(e,t);case ct.INT64:case ct.UINT64:return i!=="number"&&i!=="bigint"?J_(e,t):i==="number"&&!isFinite(e)?T1(e,t):b1(e,t,n)}}function J_(e,t){return`value ${e} does not match type ${t}`}function y1(e,t,n){let i=`value ${e} is out of range for type ${t}`;return n&&(i+=" (normalized)"),i}function b1(e,t,n){if(n){const i=ct.isUnsignedIntegerType(t)?0:-1;return e<i||e>1?y1(e,t,n):void 0}if(e<ct.getMinimum(t)||e>ct.getMaximum(t))return y1(e,t,n)}function T1(e,t){return`value ${e} of type ${t} must be finite`}function hw(e,t,n){if(!Array.isArray(e))return n(e,t);for(let i=0;i<e.length;i++)e[i]=hw(e[i],t,n);return e}Li.valueTransformInPlace=function(e,t,n,i){if(!Array.isArray(e))return i(e,t,n);for(let r=0;r<e.length;r++)e[r]=Li.valueTransformInPlace(e[r],t[r],n[r],i);return e};function rm(e){e=T(e,T.EMPTY_OBJECT);const t=e.count,n=e.property,i=e.classProperty,r=e.bufferViews;y.typeOf.number.greaterThan("options.count",t,0),y.typeOf.object("options.property",n),y.typeOf.object("options.classProperty",i),y.typeOf.object("options.bufferViews",r);const s=i.type,o=i.isArray,a=i.isVariableLengthArray;let c=i.valueType;const u=i.enumType,h=s===at.STRING,d=s===at.BOOLEAN;let p=0,g;if(a){let U=T(n.arrayOffsetType,n.offsetType);U=T(ct[U],ct.UINT32);const V=T(n.arrayOffsets,n.arrayOffsetBufferView);g=new K0(r[V],U,t+1),p+=g.typedArray.byteLength}const _=at.getComponentCount(s);let b;a?b=g.get(t)-g.get(0):o?b=t*i.arrayLength:b=t;const x=_*b;let E;if(h){let U=T(n.stringOffsetType,n.offsetType);U=T(ct[U],ct.UINT32);const V=T(n.stringOffsets,n.stringOffsetBufferView);E=new K0(r[V],U,x+1),p+=E.typedArray.byteLength}(h||d)&&(c=ct.UINT8);let C;h?C=E.get(x)-E.get(0):d?C=Math.ceil(x/8):C=x;const w=T(n.values,n.bufferView),S=new K0(r[w],c,C);p+=S.typedArray.byteLength;let v=n.offset,D=n.scale;const L=i.hasValueTransform||l(v)||l(D);v=T(v,i.offset),D=T(D,i.scale),v=x1(v),D=x1(D);let O,N;const B=this;h?O=function(U){return Cie(U,B._values,B._stringOffsets)}:d?(O=function(U){return wie(U,B._values)},N=function(U,V){Aie(U,B._values,V)}):l(u)?(O=function(U){const V=B._values.get(U);return u.namesByValue[V]},N=function(U,V){const f=u.valuesByName[V];B._values.set(U,f)}):(O=function(U){return B._values.get(U)},N=function(U,V){B._values.set(U,V)}),this._arrayOffsets=g,this._stringOffsets=E,this._values=S,this._classProperty=i,this._count=t,this._vectorComponentCount=_,this._min=n.min,this._max=n.max,this._offset=v,this._scale=D,this._hasValueTransform=L,this._getValue=O,this._setValue=N,this._unpackedValues=void 0,this._extras=n.extras,this._extensions=n.extensions,this._byteLength=p}Object.defineProperties(rm.prototype,{hasValueTransform:{get:function(){return this._hasValueTransform}},offset:{get:function(){return this._offset}},scale:{get:function(){return this._scale}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}},byteLength:{get:function(){return this._byteLength}}});rm.prototype.get=function(e){aN(this,e);let t=xie(this,e);return t=this._classProperty.handleNoData(t),l(t)?(t=this._classProperty.normalize(t),t=Lie(this,t),this._classProperty.unpackVectorAndMatrixTypes(t)):(t=this._classProperty.default,this._classProperty.unpackVectorAndMatrixTypes(t))};rm.prototype.set=function(e,t){const n=this._classProperty;y.defined("value",t),aN(this,e);const i=n.validate(t);if(l(i))throw new A(i);t=n.packVectorAndMatrixTypes(t),t=Pie(this,t),t=n.unnormalize(t),Eie(this,e,t)};rm.prototype.getTypedArray=function(){if(l(this._values))return this._values.typedArray};function x1(e){if(!Array.isArray(e))return e;const t=[];for(let n=0;n<e.length;n++){const i=e[n];Array.isArray(i)?t.push.apply(t,i):t.push(i)}return t}function aN(e,t){const n=e._count;if(!l(t)||t<0||t>=n){const i=n-1;throw new A(`index is required and between zero and count - 1. Actual value: ${i}`)}}function xie(e,t){lN(e)&&uN(e);const n=e._classProperty,i=n.isArray,r=n.type,s=at.getComponentCount(r);if(l(e._unpackedValues)){const o=e._unpackedValues[t];return i?Se(o,!0):o}return!i&&s===1?e._getValue(t):cN(e,n,t)}function cN(e,t,n){let i,r;if(t.isVariableLengthArray){i=e._arrayOffsets.get(n),r=e._arrayOffsets.get(n+1)-i;const o=at.getComponentCount(t.type);i*=o,r*=o}else{const a=T(t.arrayLength,1)*e._vectorComponentCount;i=n*a,r=a}const s=new Array(r);for(let o=0;o<r;o++)s[o]=e._getValue(i+o);return s}function Eie(e,t,n){Die(e,t,n)&&uN(e);const i=e._classProperty,r=i.isArray,s=i.type,o=at.getComponentCount(s);if(l(e._unpackedValues)){i.isArray&&(n=Se(n,!0)),e._unpackedValues[t]=n;return}if(!r&&o===1){e._setValue(t,n);return}let a,c;if(i.isVariableLengthArray)a=e._arrayOffsets.get(t),c=e._arrayOffsets.get(t+1)-a;else{const h=T(i.arrayLength,1)*e._vectorComponentCount;a=t*h,c=h}for(let u=0;u<c;++u)e._setValue(a+u,n[u])}function Cie(e,t,n){const i=n.get(e),r=n.get(e+1)-i;return gs(t.typedArray,i,r)}function wie(e,t){const n=e>>3,i=e%8;return(t.typedArray[n]>>i&1)===1}function Aie(e,t,n){const i=e>>3,r=e%8;n?t.typedArray[i]|=1<<r:t.typedArray[i]&=~(1<<r)}function Sie(e,t){const n=t.dataView,i=e*8;let r=0;const s=(n.getUint8(i+7)&128)>0;let o=!0;for(let a=0;a<8;++a){let c=n.getUint8(i+a);s&&(o?c!==0&&(c=~(c-1)&255,o=!1):c=~c&255),r+=c*Math.pow(256,a)}return s&&(r=-r),r}function vie(e,t){const n=t.dataView,i=e*8;let r=BigInt(0);const s=(n.getUint8(i+7)&128)>0;let o=!0;for(let a=0;a<8;++a){let c=n.getUint8(i+a);s&&(o?c!==0&&(c=~(c-1)&255,o=!1):c=~c&255),r+=BigInt(c)*(BigInt(1)<<BigInt(a*8))}return s&&(r=-r),r}function Iie(e,t){const n=t.dataView,i=e*8,r=n.getUint32(i,!0),s=n.getUint32(i+4,!0);return r+4294967296*s}function Oie(e,t){const n=t.dataView,i=e*8,r=BigInt(n.getUint32(i,!0)),s=BigInt(n.getUint32(i+4,!0));return r+BigInt(4294967296)*s}function Rie(e){switch(e){case ct.INT8:return q.BYTE;case ct.UINT8:return q.UNSIGNED_BYTE;case ct.INT16:return q.SHORT;case ct.UINT16:return q.UNSIGNED_SHORT;case ct.INT32:return q.INT;case ct.UINT32:return q.UNSIGNED_INT;case ct.FLOAT32:return q.FLOAT;case ct.FLOAT64:return q.DOUBLE}}function lN(e){if(l(e._unpackedValues))return!1;const t=e._classProperty,n=t.type,i=t.valueType;return n===at.STRING||i===ct.INT64&&!It.supportsBigInt64Array()||i===ct.UINT64&&!It.supportsBigUint64Array()}function Die(e,t,n){if(lN(e))return!0;const i=e._arrayOffsets;if(l(i)){const r=i.get(t+1)-i.get(t),s=n.length;if(r!==s)return!0}return!1}function uN(e){e._unpackedValues=Mie(e),e._arrayOffsets=void 0,e._stringOffsets=void 0,e._values=void 0}function Mie(e){const t=e._count,n=new Array(t),i=e._classProperty,r=i.isArray,s=i.type,o=at.getComponentCount(s);if(!r&&o===1){for(let a=0;a<t;++a)n[a]=e._getValue(a);return n}for(let a=0;a<t;a++)n[a]=cN(e,i,a);return n}function Lie(e,t){const i=e._classProperty.isVariableLengthArray;return!e._hasValueTransform||i?t:Li.valueTransformInPlace(t,e._offset,e._scale,ct.applyValueTransform)}function Pie(e,t){const i=e._classProperty.isVariableLengthArray;return!e._hasValueTransform||i?t:Li.valueTransformInPlace(t,e._offset,e._scale,ct.unapplyValueTransform)}function K0(e,t,n){const i=this;let r,s,o;if(t===ct.INT64)It.supportsBigInt()?It.supportsBigInt64Array()?(r=new BigInt64Array(e.buffer,e.byteOffset,n),o=function(a,c){i.typedArray[a]=BigInt(c)}):(r=new Uint8Array(e.buffer,e.byteOffset,n*8),s=function(a){return vie(a,i)}):(kr("INT64 type is not fully supported on this platform. Values greater than 2^53 - 1 or less than -(2^53 - 1) may lose precision when read."),r=new Uint8Array(e.buffer,e.byteOffset,n*8),s=function(a){return Sie(a,i)});else if(t===ct.UINT64)It.supportsBigInt()?It.supportsBigUint64Array()?(r=new BigUint64Array(e.buffer,e.byteOffset,n),o=function(a,c){i.typedArray[a]=BigInt(c)}):(r=new Uint8Array(e.buffer,e.byteOffset,n*8),s=function(a){return Oie(a,i)}):(kr("UINT64 type is not fully supported on this platform. Values greater than 2^53 - 1 may lose precision when read."),r=new Uint8Array(e.buffer,e.byteOffset,n*8),s=function(a){return Iie(a,i)});else{const a=Rie(t);r=q.createArrayBufferView(a,e.buffer,e.byteOffset,n),o=function(c,u){i.typedArray[c]=u}}l(s)||(s=function(a){return i.typedArray[a]}),this.typedArray=r,this.dataView=new DataView(r.buffer,r.byteOffset),this.get=s,this.set=o,this._componentType=t}function Hr(e){e=T(e,T.EMPTY_OBJECT);const t=e.count,n=e.class;y.typeOf.number.greaterThan("options.count",t,0),y.typeOf.object("options.class",n);let i=0;const r={};if(l(e.properties)){for(const s in e.properties)if(e.properties.hasOwnProperty(s)){const o=new rm({count:t,property:e.properties[s],classProperty:n.properties[s],bufferViews:e.bufferViews});r[s]=o,i+=o.byteLength}}this._count=t,this._class=n,this._properties=r,this._byteLength=i}Object.defineProperties(Hr.prototype,{count:{get:function(){return this._count}},class:{get:function(){return this._class}},byteLength:{get:function(){return this._byteLength}}});Hr.prototype.hasProperty=function(e){return He.hasProperty(e,this._properties,this._class)};Hr.prototype.hasPropertyBySemantic=function(e){return He.hasPropertyBySemantic(e,this._properties,this._class)};Hr.prototype.getPropertyIds=function(e){return He.getPropertyIds(this._properties,this._class,e)};Hr.prototype.getProperty=function(e,t){y.typeOf.string("propertyId",t);const n=this._properties[t];let i;return l(n)?i=n.get(e):i=Nie(this._class,t),i};Hr.prototype.setProperty=function(e,t,n){y.typeOf.string("propertyId",t);const i=this._properties[t];return l(i)?(i.set(e,n),!0):!1};Hr.prototype.getPropertyBySemantic=function(e,t){y.typeOf.string("semantic",t);let n;const i=this._class.propertiesBySemantic;if(l(i)&&(n=i[t]),l(n))return this.getProperty(e,n.id)};Hr.prototype.setPropertyBySemantic=function(e,t,n){y.typeOf.string("semantic",t);let i;const r=this._class.propertiesBySemantic;return l(r)&&(i=r[t]),l(i)?this.setProperty(e,i.id,n):!1};Hr.prototype.getPropertyTypedArray=function(e){y.typeOf.string("propertyId",e);const t=this._properties[e];if(l(t))return t.getTypedArray()};Hr.prototype.getPropertyTypedArrayBySemantic=function(e){y.typeOf.string("semantic",e);let t;const n=this._class.propertiesBySemantic;if(l(n)&&(t=n[e]),l(t))return this.getPropertyTypedArray(t.id)};function Nie(e,t){const n=e.properties;if(!l(n))return;const i=n[t];if(l(i)&&l(i.default)){let r=i.default;return i.isArray&&(r=Se(r,!0)),r=i.normalize(r),i.unpackVectorAndMatrixTypes(r)}}function ai(){}Object.defineProperties(ai.prototype,{cacheKey:{get:function(){A.throwInstantiationError()}}});ai.prototype.load=function(){A.throwInstantiationError()};ai.prototype.unload=function(){};ai.prototype.process=function(e){return!1};ai.prototype.getError=function(e,t){y.typeOf.string("errorMessage",e),l(t)&&l(t.message)&&(e+=`
${t.message}`);const n=new te(e);return l(t)&&(n.stack=`Original stack:
${t.stack}
Handler stack:
${n.stack}`),n};ai.prototype.isDestroyed=function(){return!1};ai.prototype.destroy=function(){return this.unload(),Ye(this)};const Fie={UNLOADED:0,LOADING:1,LOADED:2,PROCESSING:3,READY:4,FAILED:5},Oe=Object.freeze(Fie);function Ro(e){e=T(e,T.EMPTY_OBJECT);const t=e.typedArray,n=e.resource,i=e.cacheKey;if(l(t)===l(n))throw new A("One of options.typedArray and options.resource must be defined.");this._typedArray=t,this._resource=n,this._cacheKey=i,this._state=Oe.UNLOADED,this._promise=void 0}l(Object.create)&&(Ro.prototype=Object.create(ai.prototype),Ro.prototype.constructor=Ro);Object.defineProperties(Ro.prototype,{cacheKey:{get:function(){return this._cacheKey}},typedArray:{get:function(){return this._typedArray}}});Ro.prototype.load=async function(){return l(this._promise)?this._promise:l(this._typedArray)?(this._promise=Promise.resolve(this),this._promise):(this._promise=Bie(this),this._promise)};async function Bie(e){const t=e._resource;e._state=Oe.LOADING;try{const n=await Ro._fetchArrayBuffer(t);return e.isDestroyed()?void 0:(e._typedArray=new Uint8Array(n),e._state=Oe.READY,e)}catch(n){if(e.isDestroyed())return;e._state=Oe.FAILED;const i=`Failed to load external buffer: ${t.url}`;throw e.getError(i,n)}}Ro._fetchArrayBuffer=function(e){return e.fetchArrayBuffer()};Ro.prototype.unload=function(){this._typedArray=void 0};(function(){var e="b9H79TebbbeJq9Geueu9Geub9Gbb9Gvuuuuueu9Gduueu9Gluuuueu9Gvuuuuub9Gouuuuuub9Gluuuub9GiuuueuiKLdilevlevlooroowwvwbDDbelve9Weiiviebeoweuec:G;kekr;RiOo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9FW9U9J9V9KW9wWVtW949c919M9MWVbe8F9TW79O9V9Wt9FW9U9J9V9KW9wWVtW949c919M9MWV9c9V919U9KbdE9TW79O9V9Wt9FW9U9J9V9KW9wWVtW949wWV79P9V9UbiY9TW79O9V9Wt9FW9U9J9V9KW69U9KW949c919M9MWVbl8E9TW79O9V9Wt9FW9U9J9V9KW69U9KW949c919M9MWV9c9V919U9Kbv8A9TW79O9V9Wt9FW9U9J9V9KW69U9KW949wWV79P9V9UboE9TW79O9V9Wt9FW9U9J9V9KW69U9KW949tWG91W9U9JWbra9TW79O9V9Wt9FW9U9J9V9KW69U9KW949tWG91W9U9JW9c9V919U9KbwL9TW79O9V9Wt9FW9U9J9V9KWS9P2tWV9p9JtbDK9TW79O9V9Wt9FW9U9J9V9KWS9P2tWV9r919HtbqL9TW79O9V9Wt9FW9U9J9V9KWS9P2tWVT949WbkE9TW79O9V9Wt9F9V9Wt9P9T9P96W9wWVtW94J9H9J9OWbPa9TW79O9V9Wt9F9V9Wt9P9T9P96W9wWVtW94J9H9J9OW9ttV9P9Wbsa9TW79O9V9Wt9F9V9Wt9P9T9P96W9wWVtW94SWt9J9O9sW9T9H9WbzK9TW79O9V9Wt9F79W9Ht9P9H29t9VVt9sW9T9H9WbHl79IV9RbODwebcekdQXq;C9oLdbk;GqeKu8Jjjjjbcjo9Rgv8Kjjjjbcbhodnalcefae0mbabcbRbN:kjjbc:GeV86bbavcjdfcbcjdzNjjjb8AdnaiTmbavcjdfadalz:tjjjb8Akabaefhrabcefhwavalfcbcbcjdal9RalcFe0EzNjjjb8Aavavcjdfalz:tjjjbhDcj;abal9Uc;WFbGgecjdaecjd6Ehqcbhkindndnaiak9nmbaDcjlfcbcjdzNjjjb8Aaqaiak9Rakaqfai6Egxcsfgecl4cifcd4hmadakal2fhPdndndnaec9WGgsTmbcbhzaPhHawhOxekdnaxmbalheinaraw9Ram6miawcbamzNjjjbamfhwaecufgembxvkkcbhAaPhOinaDaAfRbbhCaDcjlfheaOhoaxhXinaeaoRbbgQaC9RgCcetaC;acr4786bbaoalfhoaecefheaQhCaXcufgXmbkaraw9Ram6mdaOcefhOawcbamzNjjjbamfhwaAcefgAal9hmbxlkkindnaxTmbaDazfRbbhCaDcjlfheaHhoaxhXinaeaoRbbgQaC9RgCcetaC;acr4786bbaoalfhoaecefheaQhCaXcufgXmbkkaraO9Ram6mearaOcbamzNjjjbgLamfgw9RcK6mecbhKaDcjlfhOinaDcjlfaKfhYcwhAczhQceheindndnaegXce9hmbcuhoaYRbbmecbhodninaogecsSmeaecefhoaOaefcefRbbTmbkkcucbaecs6EhoxekaXcethocuaXtc;:bGcFb7hCcbheinaoaCaOaefRbb9nfhoaecefgecz9hmbkkaoaQaoaQ6geEhQaXaAaeEhAaXcetheaXcl6mbkdndndndnaAcufPdiebkaLaKco4fgeaeRbbcdciaAclSEaKci4coGtV86bbaAcw9hmeawaY8Pbb83bbawcwfaYcwf8Pbb83bbawczfhwxdkaLaKco4fgeaeRbbceaKci4coGtV86bbkdncwaA9Tg8Ambinawcb86bbawcefhwxbkkcuaAtcu7hYcbhEaOh3ina3hea8AhCcbhoinaeRbbgQaYcFeGgXaQaX6EaoaAtVhoaecefheaCcufgCmbkawao86bba3a8Afh3awcefhwaEa8AfgEcz6mbkcbheindnaOaefRbbgoaX6mbawao86bbawcefhwkaecefgecz9hmbkkdnaKczfgKas9pmbaOczfhOaraw9RcL0mekkaKas6meawTmeaHcefhHawhOazcefgzalSmixbkkcbhoxikcbhoaraw9Ralcaalca0E6mddnalc8F0mbawcbcaal9RgezNjjjbaefhwkawaDcjdfalz:tjjjbalfab9RhoxdkaDaPaxcufal2falz:tjjjb8Aaxakfhkawmbkcbhokavcjof8Kjjjjbaok9heeuaecaaeca0Eabcj;abae9Uc;WFbGgdcjdadcjd6Egdfcufad9Uae2adcl4cifcd4adV2fcefkmbcbabBdN:kjjbk:zse5u8Jjjjjbc;ae9Rgl8Kjjjjbcbhvdnaici9UgocHfae0mbabcbyd:e:kjjbgrc;GeV86bbalc;abfcFecjezNjjjb8AalcUfgw9cu83ibalc8WfgD9cu83ibalcyfgq9cu83ibalcafgk9cu83ibalcKfgx9cu83ibalczfgm9cu83ibal9cu83iwal9cu83ibabaefc9WfhPabcefgsaofhednaiTmbcmcsarcb9kgzEhHcbhOcbhAcbhCcbhXcbhQindnaeaP9nmbcbhvxikaQcufhvadaCcdtfgLydbhKaLcwfydbhYaLclfydbh8AcbhEdndndninalc;abfavcsGcitfgoydlh3dndndnaoydbgoaK9hmba3a8ASmekdnaoa8A9hmba3aY9hmbaEcefhExekaoaY9hmea3aK9hmeaEcdfhEkaEc870mdaXcufhvaLaEciGcx2goc:y1jjbfydbcdtfydbh3aLaocN1jjbfydbcdtfydbh8AaLaoc:q1jjbfydbcdtfydbhKcbhodnindnalavcsGcdtfydba39hmbaohYxdkcuhYavcufhvaocefgocz9hmbkkaOa3aOSgvaYce9iaYaH9oVgoGfhOdndndncbcsavEaYaoEgvcs9hmbarce9imba3a3aAa3cefaASgvEgAcefSmecmcsavEhvkasavaEcdtc;WeGV86bbavcs9hmea3aA9Rgvcetavc8F917hvinaeavcFb0crtavcFbGV86bbaecefheavcje6hoavcr4hvaoTmbka3hAxvkcPhvasaEcdtcPV86bba3hAkavTmiavaH9omicdhocehEaQhYxlkavcufhvaEclfgEc;ab9hmbkkdnaLceaYaOSceta8AaOSEcx2gvc:q1jjbfydbcdtfydbgKTaLavcN1jjbfydbcdtfydbg8AceSGaLavc:y1jjbfydbcdtfydbg3cdSGaOcb9hGazGg5ce9hmbaw9cu83ibaD9cu83ibaq9cu83ibak9cu83ibax9cu83ibam9cu83ibal9cu83iwal9cu83ibcbhOkcbhEaXcufgvhodnindnalaocsGcdtfydba8A9hmbaEhYxdkcuhYaocufhoaEcefgEcz9hmbkkcbhodnindnalavcsGcdtfydba39hmbaohExdkcuhEavcufhvaocefgocz9hmbkkaOaKaOSg8EfhLdndnaYcm0mbaYcefhYxekcbcsa8AaLSgvEhYaLavfhLkdndnaEcm0mbaEcefhExekcbcsa3aLSgvEhEaLavfhLkc9:cua8EEh8FcbhvaEaYcltVgacFeGhodndndninavcj1jjbfRbbaoSmeavcefgvcz9hmbxdkka5aKaO9havcm0VVmbasavc;WeV86bbxekasa8F86bbaeaa86bbaecefhekdna8EmbaKaA9Rgvcetavc8F917hvinaeavcFb0gocrtavcFbGV86bbavcr4hvaecefheaombkaKhAkdnaYcs9hmba8AaA9Rgvcetavc8F917hvinaeavcFb0gocrtavcFbGV86bbavcr4hvaecefheaombka8AhAkdnaEcs9hmba3aA9Rgvcetavc8F917hvinaeavcFb0gocrtavcFbGV86bbavcr4hvaecefheaombka3hAkalaXcdtfaKBdbaXcefcsGhvdndnaYPzbeeeeeeeeeeeeeebekalavcdtfa8ABdbaXcdfcsGhvkdndnaEPzbeeeeeeeeeeeeeebekalavcdtfa3BdbavcefcsGhvkcihoalc;abfaQcitfgEaKBdlaEa8ABdbaQcefcsGhYcdhEavhXaLhOxekcdhoalaXcdtfa3BdbcehEaXcefcsGhXaQhYkalc;abfaYcitfgva8ABdlava3Bdbalc;abfaQaEfcsGcitfgva3BdlavaKBdbascefhsaQaofcsGhQaCcifgCai6mbkkcbhvaeaP0mbcbhvinaeavfavcj1jjbfRbb86bbavcefgvcz9hmbkaeab9Ravfhvkalc;aef8KjjjjbavkZeeucbhddninadcefgdc8F0meceadtae6mbkkadcrfcFeGcr9Uci2cdfabci9U2cHfkmbcbabBd:e:kjjbk:ydewu8Jjjjjbcz9Rhlcbhvdnaicvfae0mbcbhvabcbRb:e:kjjbc;qeV86bbal9cb83iwabcefhoabaefc98fhrdnaiTmbcbhwcbhDindnaoar6mbcbskadaDcdtfydbgqalcwfawaqav9Rgvavc8F91gv7av9Rc507gwcdtfgkydb9Rgvc8E91c9:Gavcdt7awVhvinaoavcFb0gecrtavcFbGV86bbavcr4hvaocefhoaembkakaqBdbaqhvaDcefgDai9hmbkkcbhvaoar0mbaocbBbbaoab9RclfhvkavkBeeucbhddninadcefgdc8F0meceadtae6mbkkadcwfcFeGcr9Uab2cvfk:bvli99dui99ludnaeTmbcuadcetcuftcu7:Yhvdndncuaicuftcu7:YgoJbbbZMgr:lJbbb9p9DTmbar:Ohwxekcjjjj94hwkcbhicbhDinalclfIdbgrJbbbbJbbjZalIdbgq:lar:lMalcwfIdbgk:lMgr:varJbbbb9BEgrNhxaqarNhrdndnakJbbbb9GTmbaxhqxekJbbjZar:l:tgqaq:maxJbbbb9GEhqJbbjZax:l:tgxax:marJbbbb9GEhrkdndnalcxfIdbgxJbbj:;axJbbj:;9GEgkJbbjZakJbbjZ9FEavNJbbbZJbbb:;axJbbbb9GEMgx:lJbbb9p9DTmbax:Ohmxekcjjjj94hmkdndnaqJbbj:;aqJbbj:;9GEgxJbbjZaxJbbjZ9FEaoNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:OhPxekcjjjj94hPkdndnarJbbj:;arJbbj:;9GEgqJbbjZaqJbbjZ9FEaoNJbbbZJbbb:;arJbbbb9GEMgr:lJbbb9p9DTmbar:Ohsxekcjjjj94hskdndnadcl9hmbabaifgzas86bbazcifam86bbazcdfaw86bbazcefaP86bbxekabaDfgzas87ebazcofam87ebazclfaw87ebazcdfaP87ebkalczfhlaiclfhiaDcwfhDaecufgembkkk;hlld99eud99eudnaeTmbdndncuaicuftcu7:YgvJbbbZMgo:lJbbb9p9DTmbao:Ohixekcjjjj94hikaic;8FiGhrinabcofcicdalclfIdb:lalIdb:l9EgialcwfIdb:lalaicdtfIdb:l9EEgialcxfIdb:lalaicdtfIdb:l9EEgiarV87ebdndnJbbj:;JbbjZalaicdtfIdbJbbbb9DEgoalaicd7cdtfIdbJ;Zl:1ZNNgwJbbj:;awJbbj:;9GEgDJbbjZaDJbbjZ9FEavNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohqxekcjjjj94hqkabcdfaq87ebdndnalaicefciGcdtfIdbJ;Zl:1ZNaoNgwJbbj:;awJbbj:;9GEgDJbbjZaDJbbjZ9FEavNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohqxekcjjjj94hqkabaq87ebdndnaoalaicufciGcdtfIdbJ;Zl:1ZNNgoJbbj:;aoJbbj:;9GEgwJbbjZawJbbjZ9FEavNJbbbZJbbb:;aoJbbbb9GEMgo:lJbbb9p9DTmbao:Ohixekcjjjj94hikabclfai87ebabcwfhbalczfhlaecufgembkkk:dvdxue998Jjjjjbcjd9Rgo8Kjjjjbadcd4hrdndndndnavcd9hmbadcl6meaohwarhDinawc:CuBdbawclfhwaDcufgDmbkaeTmiadcl6mdarcdthqalhkcbhxinaohwakhDarhminawawydbgPaDydbgscL4cFeGc:cufcbasEgsaPas9kEBdbaDclfhDawclfhwamcufgmmbkakaqfhkaxcefgxaeSmixbkkaeTmdxekaeTmekavcb9hadcl6gqVhzarcdthxavce9hhHcbhdindndndnaHmbaqmdc:CuhDalhwarhminaDawydbgPcL4cFeGc:cufcbaPEgPaDaP9kEhDawclfhwamcufgmmbxdkkc:CuhDazmbaohwalhmarhPinawamydbgscL4cFeGgkc8Aakc8A9kEc:cufcbasEBdbamclfhmawclfhwaPcufgPmbkkaqmbcbhwarhPinaDhmdnavceSmbaoawfydbhmkdndnalawfIdbgOcjjj;8iamai9RcefgmcLt9R::NJbbbZJbbb:;aOJbbbb9GEMgO:lJbbb9p9DTmbaO:Ohsxekcjjjj94hskabawfascFFFrGamcKtVBdbawclfhwaPcufgPmbkkabaxfhbalaxfhladcefgdae9hmbkkaocjdf8Kjjjjbk;HqdCui998Jjjjjbc:qd9Rgv8Kjjjjbavc:Sefcbc;KbzNjjjb8AcbhodnadTmbcbhoaiTmbdnabae9hmbavcuadcdtgradcFFFFi0Ecbyd:m:kjjbHjjjjbbgeBd:SeavceBd:mdaeabarz:tjjjb8Akavc:GefcwfcbBdbav9cb83i:Geavc:Gefaeadaiavc:Sefz:njjjbavyd:Gehwadci9UgDcbyd:m:kjjbHjjjjbbhravc:Sefavyd:mdgqcdtfarBdbavaqcefgkBd:mdarcbaDzNjjjbhxavc:SefakcdtfcuaicdtaicFFFFi0Ecbyd:m:kjjbHjjjjbbgmBdbavaqcdfgPBd:mdawhramhkinakalIdbalarydbgscwascw6Ecdtfc;ebfIdbMUdbarclfhrakclfhkaicufgimbkavc:SefaPcdtfcuaDcdtadcFFFF970Ecbyd:m:kjjbHjjjjbbgPBdbdnadci6mbaehraPhkaDhiinakamarydbcdtfIdbamarclfydbcdtfIdbMamarcwfydbcdtfIdbMUdbarcxfhrakclfhkaicufgimbkkaqcifhoavc;qbfhzavhravyd:KehHavyd:OehOcbhscbhkcbhAcehCinarhXcihQaeakci2gLcdtfgrydbhdarclfydbhqabaAcx2fgicwfarcwfydbgKBdbaiclfaqBdbaiadBdbaxakfce86bbazaKBdwazaqBdlazadBdbaPakcdtfcbBdbdnasTmbcihQaXhiinazaQcdtfaiydbgrBdbaQaraK9harad9haraq9hGGfhQaiclfhiascufgsmbkkaAcefhAcbhsinaOaHaeasaLfcdtfydbcdtgifydbcdtfgKhrawaifgqydbgdhidnadTmbdninarydbakSmearclfhraicufgiTmdxbkkaraKadcdtfc98fydbBdbaqaqydbcufBdbkascefgsci9hmbkdndnaQTmbcuhkJbbbbhYcbhqavyd:KehKavyd:OehLindndnawazaqcdtfydbcdtgsfydbgrmbaqcefhqxekaqcs0hiamasfgdIdbh8AadalcbaqcefgqaiEcdtfIdbalarcwarcw6Ecdtfc;ebfIdbMgEUdbaEa8A:thEarcdthiaLaKasfydbcdtfhrinaParydbgscdtfgdaEadIdbMg8AUdba8AaYaYa8A9DgdEhYasakadEhkarclfhraic98fgimbkkaqaQ9hmbkakcu9hmekaCaD9pmdindnaxaCfRbbmbaChkxdkaDaCcefgC9hmbxikkaQczaQcz6EhsazhraXhzakcu9hmbkkaocdtavc:Seffc98fhrdninaoTmearydbcbyd1:kjjbH:bjjjbbarc98fhraocufhoxbkkavc:qdf8Kjjjjbk;IlevucuaicdtgvaicFFFFi0Egocbyd:m:kjjbHjjjjbbhralalyd9GgwcdtfarBdbalawcefBd9GabarBdbaocbyd:m:kjjbHjjjjbbhralalyd9GgocdtfarBdbalaocefBd9GabarBdlcuadcdtadcFFFFi0Ecbyd:m:kjjbHjjjjbbhralalyd9GgocdtfarBdbalaocefBd9GabarBdwabydbcbavzNjjjb8Aadci9UhDdnadTmbabydbhoaehladhrinaoalydbcdtfgvavydbcefBdbalclfhlarcufgrmbkkdnaiTmbabydbhlabydlhrcbhvaihoinaravBdbarclfhralydbavfhvalclfhlaocufgombkkdnadci6mbabydlhrabydwhvcbhlinaecwfydbhoaeclfydbhdaraeydbcdtfgwawydbgwcefBdbavawcdtfalBdbaradcdtfgdadydbgdcefBdbavadcdtfalBdbaraocdtfgoaoydbgocefBdbavaocdtfalBdbaecxfheaDalcefgl9hmbkkdnaiTmbabydlheabydbhlinaeaeydbalydb9RBdbalclfhlaeclfheaicufgimbkkkQbabaeadaic:01jjbz:mjjjbkQbabaeadaic:C:jjjbz:mjjjbk9DeeuabcFeaicdtzNjjjbhlcbhbdnadTmbindnalaeydbcdtfgiydbcu9hmbaiabBdbabcefhbkaeclfheadcufgdmbkkabk;Wkivuo99lu8Jjjjjbc;W;Gb9Rgl8Kjjjjbcbhvalcj;Gbfcbc;KbzNjjjb8AalcuadcdtadcFFFFi0Egocbyd:m:kjjbHjjjjbbgrBdj9GalceBd;G9GalcFFF;7rBdwal9cFFF;7;3FF:;Fb83dbalcFFF97Bd;S9Gal9cFFF;7FFF:;u83d;K9Gaicd4hwdndnadmbJFFuFhDJFFuuhqJFFuuhkJFFuFhxJFFuuhmJFFuFhPxekawcdthsaehzincbhiinalaifgHazaifIdbgDaHIdbgxaxaD9EEUdbalc;K;GbfaifgHaDaHIdbgxaxaD9DEUdbaiclfgicx9hmbkazasfhzavcefgvad9hmbkalIdwhqalId;S9GhDalIdlhkalId;O9GhxalIdbhmalId;K9GhPkdndnadTmbJbbbbJbbjZJbbbbaPam:tgPaPJbbbb9DEgPaxak:tgxaxaP9DEgxaDaq:tgDaDax9DEgD:vaDJbbbb9BEhDawcdthsarhHadhzindndnaDaeIdbam:tNJb;au9eNJbbbZMgx:lJbbb9p9DTmbax:Ohixekcjjjj94hikaicztaicwtcj;GiGVaicsGVc:p;G:dKGcH2c;d;H:WKGcv2c;j:KM;jbGhvdndnaDaeclfIdbak:tNJb;au9eNJbbbZMgx:lJbbb9p9DTmbax:Ohixekcjjjj94hikaicztaicwtcj;GiGVaicsGVc:p;G:dKGcH2c;d;H:WKGcq2cM;j:KMeGavVhvdndnaDaecwfIdbaq:tNJb;au9eNJbbbZMgx:lJbbb9p9DTmbax:Ohixekcjjjj94hikaHavaicztaicwtcj;GiGVaicsGVc:p;G:dKGcH2c;d;H:WKGcC2c:KM;j:KdGVBdbaeasfheaHclfhHazcufgzmbkalcbcj;GbzNjjjbhiarhHadheinaiaHydbgzcFrGcx2fgvavydbcefBdbaiazcq4cFrGcx2fgvavydlcefBdlaiazcC4cFrGcx2fgzazydwcefBdwaHclfhHaecufgembxdkkalcbcj;GbzNjjjb8AkcbhHcbhzcbhecbhvinalaHfgiydbhsaiazBdbaicwfgwydbhOawavBdbaiclfgiydbhwaiaeBdbasazfhzaOavfhvawaefheaHcxfgHcj;Gb9hmbkcbhHalaocbyd:m:kjjbHjjjjbbgiBd:e9GdnadTmbabhzinazaHBdbazclfhzadaHcefgH9hmbkabhHadhzinalaraHydbgecdtfydbcFrGcx2fgvavydbgvcefBdbaiavcdtfaeBdbaHclfhHazcufgzmbkaihHadhzinalaraHydbgecdtfydbcq4cFrGcx2fgvavydlgvcefBdlabavcdtfaeBdbaHclfhHazcufgzmbkabhHadhzinalaraHydbgecdtfydbcC4cFrGcx2fgvavydwgvcefBdwaiavcdtfaeBdbaHclfhHazcufgzmbkcbhHinabaiydbcdtfaHBdbaiclfhiadaHcefgH9hmbkkclhidninaic98Smealcj;Gbfaifydbcbyd1:kjjbH:bjjjbbaic98fhixbkkalc;W;Gbf8Kjjjjbk9teiucbcbyd:q:kjjbgeabcifc98GfgbBd:q:kjjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaeczfheaiczfhiadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabk9teiucbcbyd:q:kjjbgeabcrfc94GfgbBd:q:kjjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik9:eiuZbhedndncbyd:q:kjjbgdaecztgi9nmbcuheadai9RcFFifcz4nbcuSmekadhekcbabae9Rcifc98Gcbyd:q:kjjbfgdBd:q:kjjbdnadZbcztge9nmbadae9RcFFifcz4nb8Akkk:Iddbcjwk:edb4:h9w9N94:P:gW:j9O:ye9Pbbbbbbebbbdbbbebbbdbbbbbbbdbbbbbbbebbbbbbb:l29hZ;69:9kZ;N;76Z;rg97Z;z;o9xZ8J;B85Z;:;u9yZ;b;k9HZ:2;Z9DZ9e:l9mZ59A8KZ:r;T3Z:A:zYZ79OHZ;j4::8::Y:D9V8:bbbb9s:49:Z8R:hBZ9M9M;M8:L;z;o8:;8:PG89q;x:J878R:hQ8::M:B;e87bbbbbbjZbbjZbbjZ:E;V;N8::Y:DsZ9i;H;68:xd;R8:;h0838:;W:NoZbbbb:WV9O8:uf888:9i;H;68:9c9G;L89;n;m9m89;D8Ko8:bbbbf:8tZ9m836ZS:2AZL;zPZZ818EZ9e:lxZ;U98F8:819E;68:bc:eqkzebbbebbbdbbbaWbb",t=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if(typeof WebAssembly!="object")return{supported:!1};var n,i=WebAssembly.instantiate(r(e),{}).then(function(g){n=g.instance,n.exports.__wasm_call_ctors(),n.exports.meshopt_encodeVertexVersion(0),n.exports.meshopt_encodeIndexVersion(1)});function r(g){for(var _=new Uint8Array(g.length),b=0;b<g.length;++b){var x=g.charCodeAt(b);_[b]=x>96?x-97:x>64?x-39:x+4}for(var E=0,b=0;b<g.length;++b)_[E++]=_[b]<60?t[_[b]]:(_[b]-60)*64+_[++b];return _.buffer.slice(0,E)}function s(g){if(!g)throw new Error("Assertion failed")}function o(g){return new Uint8Array(g.buffer,g.byteOffset,g.byteLength)}function a(g,_,b,x){var E=n.exports.sbrk,C=E(_.length*4),w=E(b*4),S=new Uint8Array(n.exports.memory.buffer),v=o(_);S.set(v,C),x&&x(C,C,_.length,b);var D=g(w,C,_.length,b);S=new Uint8Array(n.exports.memory.buffer);var L=new Uint32Array(b);new Uint8Array(L.buffer).set(S.subarray(w,w+b*4)),v.set(S.subarray(C,C+_.length*4)),E(C-E(0));for(var O=0;O<_.length;++O)_[O]=L[_[O]];return[L,D]}function c(g,_,b,x){var E=n.exports.sbrk,C=E(b*4),w=E(b*x),S=new Uint8Array(n.exports.memory.buffer);S.set(o(_),w),g(C,w,b,x),S=new Uint8Array(n.exports.memory.buffer);var v=new Uint32Array(b);return new Uint8Array(v.buffer).set(S.subarray(C,C+b*4)),E(C-E(0)),v}function u(g,_,b,x,E){var C=n.exports.sbrk,w=C(_),S=C(x*E),v=new Uint8Array(n.exports.memory.buffer);v.set(o(b),S);var D=g(w,_,S,x,E),L=new Uint8Array(D);return L.set(v.subarray(w,w+D)),C(w-C(0)),L}function h(g){for(var _=0,b=0;b<g.length;++b){var x=g[b];_=_<x?x:_}return _}function d(g,_){if(s(_==2||_==4),_==4)return new Uint32Array(g.buffer,g.byteOffset,g.byteLength/4);var b=new Uint16Array(g.buffer,g.byteOffset,g.byteLength/2);return new Uint32Array(b)}function p(g,_,b,x,E,C,w){var S=n.exports.sbrk,v=S(b*x),D=S(b*C),L=new Uint8Array(n.exports.memory.buffer);L.set(o(_),D),g(v,b,x,E,D,w);var O=new Uint8Array(b*x);return O.set(L.subarray(v,v+b*x)),S(v-S(0)),O}return{ready:i,supported:!0,reorderMesh:function(g,_,b){var x=_?b?n.exports.meshopt_optimizeVertexCacheStrip:n.exports.meshopt_optimizeVertexCache:void 0;return a(n.exports.meshopt_optimizeVertexFetchRemap,g,h(g)+1,x)},reorderPoints:function(g,_){return s(g instanceof Float32Array),s(g.length%_==0),s(_>=3),c(n.exports.meshopt_spatialSortRemap,g,g.length/_,_*4)},encodeVertexBuffer:function(g,_,b){s(b>0&&b<=256),s(b%4==0);var x=n.exports.meshopt_encodeVertexBufferBound(_,b);return u(n.exports.meshopt_encodeVertexBuffer,x,g,_,b)},encodeIndexBuffer:function(g,_,b){s(b==2||b==4),s(_%3==0);var x=d(g,b),E=n.exports.meshopt_encodeIndexBufferBound(_,h(x)+1);return u(n.exports.meshopt_encodeIndexBuffer,E,x,_,4)},encodeIndexSequence:function(g,_,b){s(b==2||b==4);var x=d(g,b),E=n.exports.meshopt_encodeIndexSequenceBound(_,h(x)+1);return u(n.exports.meshopt_encodeIndexSequence,E,x,_,4)},encodeGltfBuffer:function(g,_,b,x){var E={ATTRIBUTES:this.encodeVertexBuffer,TRIANGLES:this.encodeIndexBuffer,INDICES:this.encodeIndexSequence};return s(E[x]),E[x](g,_,b)},encodeFilterOct:function(g,_,b,x){return s(b==4||b==8),s(x>=1&&x<=16),p(n.exports.meshopt_encodeFilterOct,g,_,b,x,16)},encodeFilterQuat:function(g,_,b,x){return s(b==8),s(x>=4&&x<=16),p(n.exports.meshopt_encodeFilterQuat,g,_,b,x,16)},encodeFilterExp:function(g,_,b,x,E){s(b>0&&b%4==0),s(x>=1&&x<=24);var C={Separate:0,SharedVector:1,SharedComponent:2};return p(n.exports.meshopt_encodeFilterExp,g,_,b,x,b,E?C[E]:1)}}})();var zie=function(){var e="b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq;w8Wqdbk;esezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9Uc;WFbGgocjdaocjd6EhDaicefhocbhqdnindndndnaeaq9nmbaDaeaq9RaqaDfae6Egkcsfglcl4cifcd4hxalc9WGgmTmecbhPawcjdfhsaohzinaraz9Rax6mvarazaxfgo9RcK6mvczhlcbhHinalgic9WfgOawcj;cbffhldndndndndnazaOco4fRbbaHcoG4ciGPlbedibkal9cb83ibalcwf9cb83ibxikalaoRblaoRbbgOco4gAaAciSgAE86bbawcj;cbfaifglcGfaoclfaAfgARbbaOcl4ciGgCaCciSgCE86bbalcVfaAaCfgARbbaOcd4ciGgCaCciSgCE86bbalc7faAaCfgARbbaOciGgOaOciSgOE86bbalctfaAaOfgARbbaoRbegOco4gCaCciSgCE86bbalc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbalc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbalc93faAaCfgARbbaOciGgOaOciSgOE86bbalc94faAaOfgARbbaoRbdgOco4gCaCciSgCE86bbalc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbalc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbalc97faAaCfgARbbaOciGgOaOciSgOE86bbalc98faAaOfgORbbaoRbigoco4gAaAciSgAE86bbalc99faOaAfgORbbaocl4ciGgAaAciSgAE86bbalc9:faOaAfgORbbaocd4ciGgAaAciSgAE86bbalcufaOaAfglRbbaociGgoaociSgoE86bbalaofhoxdkalaoRbwaoRbbgOcl4gAaAcsSgAE86bbawcj;cbfaifglcGfaocwfaAfgARbbaOcsGgOaOcsSgOE86bbalcVfaAaOfgORbbaoRbegAcl4gCaCcsSgCE86bbalc7faOaCfgORbbaAcsGgAaAcsSgAE86bbalctfaOaAfgORbbaoRbdgAcl4gCaCcsSgCE86bbalc91faOaCfgORbbaAcsGgAaAcsSgAE86bbalc4faOaAfgORbbaoRbigAcl4gCaCcsSgCE86bbalc93faOaCfgORbbaAcsGgAaAcsSgAE86bbalc94faOaAfgORbbaoRblgAcl4gCaCcsSgCE86bbalc95faOaCfgORbbaAcsGgAaAcsSgAE86bbalc96faOaAfgORbbaoRbvgAcl4gCaCcsSgCE86bbalc97faOaCfgORbbaAcsGgAaAcsSgAE86bbalc98faOaAfgORbbaoRbogAcl4gCaCcsSgCE86bbalc99faOaCfgORbbaAcsGgAaAcsSgAE86bbalc9:faOaAfgORbbaoRbrgocl4gAaAcsSgAE86bbalcufaOaAfglRbbaocsGgoaocsSgoE86bbalaofhoxekalao8Pbb83bbalcwfaocwf8Pbb83bbaoczfhokdnaiam9pmbaHcdfhHaiczfhlarao9RcL0mekkaiam6mvaoTmvdnakTmbawaPfRbbhHawcj;cbfhlashiakhOinaialRbbgzce4cbazceG9R7aHfgH86bbaiadfhialcefhlaOcufgOmbkkascefhsaohzaPcefgPad9hmbxikkcbc99arao9Radcaadca0ESEhoxlkaoaxad2fhCdnakmbadhlinaoTmlarao9Rax6mlaoaxfhoalcufglmbkaChoxekcbhmawcjdfhAinarao9Rax6miawamfRbbhHawcj;cbfhlaAhiakhOinaialRbbgzce4cbazceG9R7aHfgH86bbaiadfhialcefhlaOcufgOmbkaAcefhAaoaxfhoamcefgmad9hmbkaChokabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqaombkc9:hoxekc9:hokavcj;ebf8Kjjjjbaok;cseHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgwce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhDaicefgqarfhidnaeTmbcmcsawceSEhkcbhxcbhmcbhPcbhwcbhlindnaiaD9nmbc9:hoxikdndnaqRbbgoc;Ve0mbavc;abfalaocu7gscl4fcsGcitfgzydlhrazydbhzdnaocsGgHak9pmbavawasfcsGcdtfydbaxaHEhoaHThsdndnadcd9hmbabaPcetfgHaz87ebaHclfao87ebaHcdfar87ebxekabaPcdtfgHazBdbaHcwfaoBdbaHclfarBdbkaxasfhxcdhHavawcdtfaoBdbawasfhwcehsalhOxdkdndnaHcsSmbaHc987aHamffcefhoxekaicefhoai8SbbgHcFeGhsdndnaHcu9mmbaohixekaicvfhiascFbGhscrhHdninao8SbbgOcFbGaHtasVhsaOcu9kmeaocefhoaHcrfgHc8J9hmbxdkkaocefhikasce4cbasceG9R7amfhokdndnadcd9hmbabaPcetfgHaz87ebaHclfao87ebaHcdfar87ebxekabaPcdtfgHazBdbaHcwfaoBdbaHclfarBdbkcdhHavawcdtfaoBdbcehsawcefhwalhOaohmxekdnaocpe0mbaxcefgHavawaDaocsGfRbbgocl49RcsGcdtfydbaocz6gzEhravawao9RcsGcdtfydbaHazfgAaocsGgHEhoaHThCdndnadcd9hmbabaPcetfgHax87ebaHclfao87ebaHcdfar87ebxekabaPcdtfgHaxBdbaHcwfaoBdbaHclfarBdbkcdhsavawcdtfaxBdbavawcefgwcsGcdtfarBdbcihHavc;abfalcitfgOaxBdlaOarBdbavawazfgwcsGcdtfaoBdbalcefcsGhOawaCfhwaxhzaAaCfhxxekaxcbaiRbbgOEgzaoc;:eSgHfhraOcsGhCaOcl4hAdndnaOcs0mbarcefhoxekarhoavawaA9RcsGcdtfydbhrkdndnaCmbaocefhxxekaohxavawaO9RcsGcdtfydbhokdndnaHTmbaicefhHxekaicdfhHai8SbegscFeGhzdnascu9kmbaicofhXazcFbGhzcrhidninaH8SbbgscFbGaitazVhzascu9kmeaHcefhHaicrfgic8J9hmbkaXhHxekaHcefhHkazce4cbazceG9R7amfgmhzkdndnaAcsSmbaHhsxekaHcefhsaH8SbbgicFeGhrdnaicu9kmbaHcvfhXarcFbGhrcrhidninas8SbbgHcFbGaitarVhraHcu9kmeascefhsaicrfgic8J9hmbkaXhsxekascefhskarce4cbarceG9R7amfgmhrkdndnaCcsSmbashixekascefhias8SbbgocFeGhHdnaocu9kmbascvfhXaHcFbGhHcrhodninai8SbbgscFbGaotaHVhHascu9kmeaicefhiaocrfgoc8J9hmbkaXhixekaicefhikaHce4cbaHceG9R7amfgmhokdndnadcd9hmbabaPcetfgHaz87ebaHclfao87ebaHcdfar87ebxekabaPcdtfgHazBdbaHcwfaoBdbaHclfarBdbkcdhsavawcdtfazBdbavawcefgwcsGcdtfarBdbcihHavc;abfalcitfgXazBdlaXarBdbavawaOcz6aAcsSVfgwcsGcdtfaoBdbawaCTaCcsSVfhwalcefcsGhOkaqcefhqavc;abfaOcitfgOarBdlaOaoBdbavc;abfalasfcsGcitfgraoBdlarazBdbawcsGhwalaHfcsGhlaPcifgPae6mbkkcbc99aiaDSEhokavc;aef8Kjjjjbaok:flevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaic8Etc8F91aicd47avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaic8Etc8F91aicd47avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;oiliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabaiavcefciGfcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:OhDxekcjjjj94hDkabaiavciGfgkcd7cetfaD87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:OhDxekcjjjj94hDkabaiavcufciGfcetfaD87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohvxekcjjjj94hvkabakcetfav87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2gdTmbinababydbgecwtcw91:Yaece91cjjj98Gcjjj;8if::NUdbabclfhbadcufgdmbkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaeczfheaiczfhiadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",t="b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq:p9sqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk:N8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhlaicefhodnaeTmbadTmbalc;WFbGglcjdalcjd6EhwcbhDinawaeaD9RaDawfae6Egqcsfglc9WGgkci2hxakcethmalcl4cifcd4hPabaDad2fhsakc;ab6hzcbhHincbhOaohAdndninaraA9RaP6meavcj;cbfaOak2fhCaAaPfhocbhidnazmbarao9Rc;Gb6mbcbhlinaCalfhidndndndndnaAalco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaiaopbblaopbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbaoclfaYpQbfaKc:q:yjjbfRbbfhoxdkaiaopbbwaopbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbaocwfaYpQbfaKc:q:yjjbfRbbfhoxekaiaopbbbpklbaoczfhokdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaiaopbblaopbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzaoclfaYpQbfaKc:q:yjjbfRbbfhoxdkaiaopbbwaopbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzaocwfaYpQbfaKc:q:yjjbfRbbfhoxekaiaopbbbpklzaoczfhokdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaiaopbblaopbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaaoclfaYpQbfaKc:q:yjjbfRbbfhoxdkaiaopbbwaopbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaaocwfaYpQbfaKc:q:yjjbfRbbfhoxekaiaopbbbpklaaoczfhokdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaiaopbblaopbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WaoclfaYpQbfaXc:q:yjjbfRbbfhoxdkaiaopbbwaopbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WaocwfaYpQbfaXc:q:yjjbfRbbfhoxekaiaopbbbpkl8Waoczfhokalc;abfhialcjefak0meaihlarao9Rc;Fb0mbkkdnaiak9pmbaici4hlinarao9RcK6miaCaifhXdndndndndnaAaico4fRbbalcoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpkbbxikaXaopbblaopbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkbbaoclfaYpQbfaKc:q:yjjbfRbbfhoxdkaXaopbbwaopbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkbbaocwfaYpQbfaKc:q:yjjbfRbbfhoxekaXaopbbbpkbbaoczfhokalcdfhlaiczfgiak6mbkkaoTmeaohAaOcefgOclSmdxbkkc9:hoxlkdnakTmbavcjdfaHfhiavaHfpbdbhYcbhXinaiavcj;cbfaXfglpblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLalakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEalamfpblbg3cep9Ta3aQp9op9Hp9rg3alaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfglaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaladfglaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaladfglaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaladfglaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaladfglaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaladfglaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaladfglaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaladfglaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaladfglaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaladfglaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaladfglaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaladfglaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaladfglaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaladfglaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaladfglaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaladfhiaXczfgXak6mbkkaHclfgHad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfgDae6mbkkcbc99arao9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk::seHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgwce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhDaicefgqarfhidnaeTmbcmcsawceSEhkcbhxcbhmcbhPcbhwcbhlindnaiaD9nmbc9:hoxikdndnaqRbbgoc;Ve0mbavc;abfalaocu7gscl4fcsGcitfgzydlhrazydbhzdnaocsGgHak9pmbavawasfcsGcdtfydbaxaHEhoaHThsdndnadcd9hmbabaPcetfgHaz87ebaHclfao87ebaHcdfar87ebxekabaPcdtfgHazBdbaHcwfaoBdbaHclfarBdbkaxasfhxcdhHavawcdtfaoBdbawasfhwcehsalhOxdkdndnaHcsSmbaHc987aHamffcefhoxekaicefhoai8SbbgHcFeGhsdndnaHcu9mmbaohixekaicvfhiascFbGhscrhHdninao8SbbgOcFbGaHtasVhsaOcu9kmeaocefhoaHcrfgHc8J9hmbxdkkaocefhikasce4cbasceG9R7amfhokdndnadcd9hmbabaPcetfgHaz87ebaHclfao87ebaHcdfar87ebxekabaPcdtfgHazBdbaHcwfaoBdbaHclfarBdbkcdhHavawcdtfaoBdbcehsawcefhwalhOaohmxekdnaocpe0mbaxcefgHavawaDaocsGfRbbgocl49RcsGcdtfydbaocz6gzEhravawao9RcsGcdtfydbaHazfgAaocsGgHEhoaHThCdndnadcd9hmbabaPcetfgHax87ebaHclfao87ebaHcdfar87ebxekabaPcdtfgHaxBdbaHcwfaoBdbaHclfarBdbkcdhsavawcdtfaxBdbavawcefgwcsGcdtfarBdbcihHavc;abfalcitfgOaxBdlaOarBdbavawazfgwcsGcdtfaoBdbalcefcsGhOawaCfhwaxhzaAaCfhxxekaxcbaiRbbgOEgzaoc;:eSgHfhraOcsGhCaOcl4hAdndnaOcs0mbarcefhoxekarhoavawaA9RcsGcdtfydbhrkdndnaCmbaocefhxxekaohxavawaO9RcsGcdtfydbhokdndnaHTmbaicefhHxekaicdfhHai8SbegscFeGhzdnascu9kmbaicofhXazcFbGhzcrhidninaH8SbbgscFbGaitazVhzascu9kmeaHcefhHaicrfgic8J9hmbkaXhHxekaHcefhHkazce4cbazceG9R7amfgmhzkdndnaAcsSmbaHhsxekaHcefhsaH8SbbgicFeGhrdnaicu9kmbaHcvfhXarcFbGhrcrhidninas8SbbgHcFbGaitarVhraHcu9kmeascefhsaicrfgic8J9hmbkaXhsxekascefhskarce4cbarceG9R7amfgmhrkdndnaCcsSmbashixekascefhias8SbbgocFeGhHdnaocu9kmbascvfhXaHcFbGhHcrhodninai8SbbgscFbGaotaHVhHascu9kmeaicefhiaocrfgoc8J9hmbkaXhixekaicefhikaHce4cbaHceG9R7amfgmhokdndnadcd9hmbabaPcetfgHaz87ebaHclfao87ebaHcdfar87ebxekabaPcdtfgHazBdbaHcwfaoBdbaHclfarBdbkcdhsavawcdtfazBdbavawcefgwcsGcdtfarBdbcihHavc;abfalcitfgXazBdlaXarBdbavawaOcz6aAcsSVfgwcsGcdtfaoBdbawaCTaCcsSVfhwalcefcsGhOkaqcefhqavc;abfaOcitfgOarBdlaOaoBdbavc;abfalasfcsGcitfgraoBdlarazBdbawcsGhwalaHfcsGhlaPcifgPae6mbkkcbc99aiaDSEhokavc;aef8Kjjjjbaok:flevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaic8Etc8F91aicd47avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaic8Etc8F91aicd47avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:wPliuo97eue978Jjjjjbca9Rhiaec98Ghldndnadcl9hmbdnalTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalaeSmeaipxbbbbbbbbbbbbbbbbgqpklbaiabalcdtfgdaeciGglcdtgv;8qbbdnalTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDaqp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkadaiav;8qbbskdnalTmbcbhvabhdinadczfgxaxpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmbediwDqkzHOAKY8AEgwczp:Reczp:Sep;6egraDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eawczp:Sep;6egwp;Gearp;Gep;Kep;Legopxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegrpxb;:FSb;:FSb;:FSb;:FSararp;Meaoaop;Meawaqawamp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFFbbFFbbFFbbFFbbp9oaoawp;Meaqp;Keczp:Rep9qgoarawp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogrpmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oaoarpmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgval6mbkkalaeSmbaiaeciGgvcitgdfcbcaad9R;8kbaiabalcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmbediwDqkzHOAKY8AEgwczp:Reczp:Sep;6egraDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eawczp:Sep;6egwp;Gearp;Gep;Kep;Legopxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegrpxb;:FSb;:FSb;:FSb;:FSararp;Meaoaop;Meawaqawamp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFFbbFFbbFFbbFFbbp9oaoawp;Meaqp;Keczp:Rep9qgoarawp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogrpmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oaoarpmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaDakp;Mearp;Keamp9oaqakp;Mearp;Keczp:Rep9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalaeSmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaDakp;Mearp;Keamp9oaqakp;Mearp;Keczp:Rep9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbheabhdinadadpbbbgocwp:Recwp:Sep;6eaocep:SepxbbjFbbjFbbjFbbjFp9opxbbjZbbjZbbjZbbjZp:Uep;Mepkbbadczfhdaeclfgeav6mbkkdnavalSmbaialciGgecdtgdVcbc;abad9R;8kbaiabavcdtfgvad;8qbbdnaeTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjFbbjFbbjFbbjFp9opxbbjZbbjZbbjZbbjZp:Uep;Mepklbkavaiad;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb",n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),i=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if(typeof WebAssembly!="object")return{supported:!1};var r=WebAssembly.validate(n)?a(t):a(e),s,o=WebAssembly.instantiate(r,{}).then(function(E){s=E.instance,s.exports.__wasm_call_ctors()});function a(E){for(var C=new Uint8Array(E.length),w=0;w<E.length;++w){var S=E.charCodeAt(w);C[w]=S>96?S-97:S>64?S-39:S+4}for(var v=0,w=0;w<E.length;++w)C[v++]=C[w]<60?i[C[w]]:(C[w]-60)*64+C[++w];return C.buffer.slice(0,v)}function c(E,C,w,S,v,D,L){var O=E.exports.sbrk,N=S+3&-4,B=O(N*v),U=O(D.length),V=new Uint8Array(E.exports.memory.buffer);V.set(D,U);var f=C(B,S,v,U,D.length);if(f==0&&L&&L(B,N,v),w.set(V.subarray(B,B+S*v)),O(B-O(0)),f!=0)throw new Error("Malformed buffer data: "+f)}var u={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},h={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},d=[],p=0;function g(E){var C={object:new Worker(E),pending:0,requests:{}};return C.object.onmessage=function(w){var S=w.data;C.pending-=S.count,C.requests[S.id][S.action](S.value),delete C.requests[S.id]},C}function _(E){for(var C="self.ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(r)+"]), {}).then(function(result) { result.instance.exports.__wasm_call_ctors(); return result.instance; });self.onmessage = "+x.name+";"+c.toString()+x.toString(),w=new Blob([C],{type:"text/javascript"}),S=URL.createObjectURL(w),v=d.length;v<E;++v)d[v]=g(S);for(var v=E;v<d.length;++v)d[v].object.postMessage({});d.length=E,URL.revokeObjectURL(S)}function b(E,C,w,S,v){for(var D=d[0],L=1;L<d.length;++L)d[L].pending<D.pending&&(D=d[L]);return new Promise(function(O,N){var B=new Uint8Array(w),U=++p;D.pending+=E,D.requests[U]={resolve:O,reject:N},D.object.postMessage({id:U,count:E,size:C,source:B,mode:S,filter:v},[B.buffer])})}function x(E){var C=E.data;if(!C.id)return self.close();self.ready.then(function(w){try{var S=new Uint8Array(C.count*C.size);c(w,w.exports[C.mode],S,C.count,C.size,C.source,w.exports[C.filter]),self.postMessage({id:C.id,count:C.count,action:"resolve",value:S},[S.buffer])}catch(v){self.postMessage({id:C.id,count:C.count,action:"reject",value:v})}})}return{ready:o,supported:!0,useWorkers:function(E){_(E)},decodeVertexBuffer:function(E,C,w,S,v){c(s,s.exports.meshopt_decodeVertexBuffer,E,C,w,S,s.exports[u[v]])},decodeIndexBuffer:function(E,C,w,S){c(s,s.exports.meshopt_decodeIndexBuffer,E,C,w,S)},decodeIndexSequence:function(E,C,w,S){c(s,s.exports.meshopt_decodeIndexSequence,E,C,w,S)},decodeGltfBuffer:function(E,C,w,S,v,D){c(s,s.exports[h[v]],E,C,w,S,s.exports[u[D]])},decodeGltfBufferAsync:function(E,C,w,S,v){return d.length>0?b(E,C,w,h[S],u[v]):o.then(function(){var D=new Uint8Array(E*C);return c(s,s.exports[h[S]],D,E,C,w,s.exports[u[v]]),D})}}}();(function(){var e="b9H79Tebbbe9Hk9Geueu9Geub9Gbb9Gsuuuuuuuuuuuu99uueu9Gvuuuuub9Gvuuuuue999Gquuuuuuu99uueu9Gwuuuuuu99ueu9Giuuue999Gluuuueu9GiuuueuizsdilvoirwDbqqbeqlve9Weiiviebeoweuecj;jekr:Tewo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bbz9TW79O9V9Wt9F79P9T9W29P9M95bl8E9TW79O9V9Wt9F79P9T9W29P9M959x9Pt9OcttV9P9I91tW7bvQ9TW79O9V9Wt9F79P9T9W29P9M959q9V9P9Ut7boX9TW79O9V9Wt9F79P9T9W29P9M959t9J9H2Wbra9TW79O9V9Wt9F9V9Wt9P9T9P96W9wWVtW94SWt9J9O9sW9T9H9Wbwl79IV9RbDDwebcekdmxq:f97sdbk:39si8Au8A99zu8Jjjjjbc;W;ab9Rgs8Kjjjjbcbhzascxfcbc;Kbz:ljjjb8AdnabaeSmbabaeadcdtz:kjjjb8AkdndnamcdGmbcbhHxekasalcrfci4gecbyd;S1jjbHjjjjbbgOBdxasceBd2aOcbaez:ljjjbhAcbhlcbhednadTmbcbhlabheadhOinaAaeydbgCci4fgXaXRbbgXceaCcrGgCtV86bbaXcu7aC4ceGalfhlaeclfheaOcufgOmbkcualcdtalcFFFFi0Ehekasaecbyd;S1jjbHjjjjbbgHBdzascdBd2alcd4alfhCcehOinaOgecethOaeaC6mbkcdhzcbhQascuaecdtgOaecFFFFi0Ecbyd;S1jjbHjjjjbbgCBdCasciBd2aCcFeaOz:ljjjbhLdnadTmbaecufhXcbhKinabaQcdtfgYydbgAc:v;t;h;Ev2hCcbhedndninaLaCaXGgCcdtfg8AydbgOcuSmeaHaOcdtfydbaASmdaecefgeaCfhCaeaX9nmbxdkkaHaKcdtfaABdba8AaKBdbaKhOaKcefhKkaYaOBdbaQcefgQad9hmbkkaLcbyd;O1jjbH:bjjjbbascdBd2kascxfazcdtfcualcefgecdtaecFFFFi0Ecbyd;S1jjbHjjjjbbgEBdbasaEBdlasazceVgeBd2ascxfaecdtfcuadcitadcFFFFe0Ecbyd;S1jjbHjjjjbbg3Bdbasa3BdwasazcdfgeBd2asclfabadalcbz:cjjjbascxfaecdtfcualcdtg5alcFFFFi0Eg8Ecbyd;S1jjbHjjjjbbgOBdbasazcifgeBd2ascxfaecdtfa8Ecbyd;S1jjbHjjjjbbg8FBdbasazclVgaBd2alcd4alfhXcehCinaCgecethCaeaX6mbkcbhKascxfaacdtfghcuaecdtgCaecFFFFi0Ecbyd;S1jjbHjjjjbbgXBdbasazcvVggBd2aXcFeaCz:ljjjbhQdnalTmbavcd4hAaecufhCinaKhednaHTmbaHaKcdtfydbhekaiaeaA2cdtfgeydlgXcH4aX7c:F:b:DD2aeydbgXcH4aX7c;D;O:B8J27aeydwgecH4ae7c:3F;N8N27aCGheaKcdth8JdndndndndnaHTmbaHa8JfhYcbhXinaQaecdtfgLydbg8AcuSmlaiaHa8AcdtfydbaA2cdtfaiaYydbaA2cdtfcxz:ojjjbTmiaXcefgXaefaCGheaXaC9nmbxdkkaiaKaA2cdtfhYcbhXinaQaecdtfgLydbg8AcuSmiaia8AaA2cdtfaYcxz:ojjjbTmdaXcefgXaefaCGheaXaC9nmbkkcbhLkaLydbgecu9hmekaLaKBdbaKhekaOa8JfaeBdbaKcefgKal9hmbkcbhea8FhCinaCaeBdbaCclfhCalaecefge9hmbkcbheaOhCa8FhXindnaeaCydbgASmbaXa8FaAcdtfgAydbBdbaAaeBdbkaCclfhCaXclfhXalaecefge9hmbkkcbh8KaQcbyd;O1jjbH:bjjjbbasaaBd2ahalcbyd;S1jjbHjjjjbbgABdbasagBd2ascxfagcdtfa8Ecbyd;S1jjbHjjjjbbgeBdbasazcofgCBd2ascxfaCcdtfa8Ecbyd;S1jjbHjjjjbbgCBdbasazcrfg8LBd2aecFea5z:ljjjbh8MaCcFea5z:ljjjbh8NdnalTmba3cwfhyindnaEa8KgXcefg8Kcdtfydbg8AaEaXcdtgefydbgCSmba8AaC9Rh8Ja3aCcitfh5a8Naefhga8MaefhKcbhLindndna5aLcitfydbgQaX9hmbaKaXBdbagaXBdbxekdnaEaQcdtgafgeclfydbgCaeydbgeSmba3aecitg8AfydbaXSmeaCae9Rhhaecu7aCfhYaya8AfhCcbheinaYaeSmeaecefheaCydbh8AaCcwfhCa8AaX9hmbkaeah6meka8NaafgeaXaQaeydbcuSEBdbaKaQaXaKydbcuSEBdbkaLcefgLa8J9hmbkka8Kal9hmbkaOhCaHhLa8FhXa8Nh8Aa8MhQcbheindndnaeaCydbgY9hmbdnaqTmbaehYdnaHTmbaLydbhYkaqaYfRbbTmbaAaefcl86bbxdkdnaeaXydbgY9hmbaQydbhYdna8AydbgKcu9hmbaYcu9hmbaAaefcb86bbxikaAaefh8JdnaeaKSmbaeaYSmba8Jce86bbxika8Jcl86bbxdkdnaea8FaYcdtgKfydb9hmbdna8Aydbg8JcuSmbaea8JSmbaQydbg5cuSmbaea5Smba8NaKfydbgacuSmbaaaYSmba8MaKfydbgKcuSmbaKaYSmbdnaOa8JcdtfydbaOaKcdtfydb9hmbaOa5cdtfydbaOaacdtfydb9hmbaAaefcd86bbxlkaAaefcl86bbxikaAaefcl86bbxdkaAaefcl86bbxekaAaefaAaYfRbb86bbkaCclfhCaLclfhLaXclfhXa8Aclfh8AaQclfhQalaecefge9hmbkamceGTmbaAhealhCindnaeRbbce9hmbaecl86bbkaecefheaCcufgCmbkkascxfa8Lcdtfcualcx2alc;v:Q;v:Qe0Ecbyd;S1jjbHjjjjbbggBdbasazcwVg8JBd2agaialavaHz:djjjbh8PdndnaDmbcbhvxekascxfa8JcdtfcualaD2gecdtaecFFFFi0Ecbyd;S1jjbHjjjjbbgvBdbasazcDVg8JBd2alTmbarcd4hYdnaHTmbaDcdthKcbhLavhQinaoaHaLcdtfydbaY2cdtfheawhCaQhXaDh8AinaXaeIdbaCIdbNUdbaeclfheaCclfhCaXclfhXa8Acufg8AmbkaQaKfhQaLcefgLal9hmbxdkkaYcdthYaDcdthKcbhQavhLinaoheawhCaLhXaDh8AinaXaeIdbaCIdbNUdbaeclfheaCclfhCaXclfhXa8Acufg8AmbkaoaYfhoaLaKfhLaQcefgQal9hmbkkascxfa8Jcdtfcualc8S2gealc;D;O;f8U0EgXcbyd;S1jjbHjjjjbbgCBdbasa8Jcefg8ABd2aCcbaez:ljjjbh8KdndndnaDTmbascxfa8AcdtfaXcbyd;S1jjbHjjjjbbgqBdbasa8JcdfgCBd2aqcbaez:ljjjb8AascxfaCcdtfcualaD2gecltgCaecFFFFb0Ecbyd;S1jjbHjjjjbbgwBdbasa8JcifBd2awcbaCz:ljjjb8AadmexdkcbhqcbhwadTmekcbhLabhCindnagaCclfydbgQcx2fgeIdbagaCydbgYcx2fgXIdbgI:tg8RagaCcwfydbgKcx2fg8AIdlaXIdlg8S:tgRNa8AIdbaI:tg8UaeIdla8S:tg8VN:tg8Wa8WNa8Va8AIdwaXIdwg8X:tg8YNaRaeIdwa8X:tg8VN:tgRaRNa8Va8UNa8Ya8RN:tg8Ra8RNMM:rg8UJbbbb9ETmba8Wa8U:vh8Wa8Ra8U:vh8RaRa8U:vhRka8KaOaYcdtfydbc8S2fgeaRa8U:rg8UaRNNg8VaeIdbMUdbaea8Ra8Ua8RNg8ZNg8YaeIdlMUdlaea8Wa8Ua8WNg80Ng81aeIdwMUdwaea8ZaRNg8ZaeIdxMUdxaea80aRNgBaeIdzMUdzaea80a8RNg80aeIdCMUdCaeaRa8Ua8Wa8XNaRaINa8Sa8RNMM:mg8SNgINgRaeIdKMUdKaea8RaINg8RaeId3MUd3aea8WaINg8WaeIdaMUdaaeaIa8SNgIaeId8KMUd8Kaea8UaeIdyMUdya8KaOaQcdtfydbc8S2fgea8VaeIdbMUdbaea8YaeIdlMUdlaea81aeIdwMUdwaea8ZaeIdxMUdxaeaBaeIdzMUdzaea80aeIdCMUdCaeaRaeIdKMUdKaea8RaeId3MUd3aea8WaeIdaMUdaaeaIaeId8KMUd8Kaea8UaeIdyMUdya8KaOaKcdtfydbc8S2fgea8VaeIdbMUdbaea8YaeIdlMUdlaea81aeIdwMUdwaea8ZaeIdxMUdxaeaBaeIdzMUdzaea80aeIdCMUdCaeaRaeIdKMUdKaea8RaeId3MUd3aea8WaeIdaMUdaaeaIaeId8KMUd8Kaea8UaeIdyMUdyaCcxfhCaLcifgLad6mbkcbh8JabhYinaba8JcdtfhQcbhCinaAaQaCcj1jjbfydbcdtfydbgXfRbbhedndnaAaYaCfydbg8AfRbbgLc99fcFeGcpe0mbaeceSmbaecd9hmekdnaLcufcFeGce0mba8Ma8AcdtfydbaX9hmekdnaecufcFeGce0mba8NaXcdtfydba8A9hmekdnaLcv2aefc:q1jjbfRbbTmbaOaXcdtfydbaOa8Acdtfydb0mekdnagaXcx2fgKIdwaga8Acx2fgiIdwg8S:tgRaRNaKIdbaiIdbg8X:tg8Ra8RNaKIdlaiIdlg8V:tg8Ua8UNMM:rgIJbbbb9ETmbaRaI:vhRa8UaI:vh8Ua8RaI:vh8RkJbbacJbbacJbbjZaeceSEaLceSEh80dnagaQaCc:e1jjbfydbcdtfydbcx2fgeIdwa8S:tg8WaRa8WaRNaeIdba8X:tg81a8RNa8UaeIdla8V:tg8ZNMMg8YN:tg8Wa8WNa81a8Ra8YN:tgRaRNa8Za8Ua8YN:tg8Ra8RNMM:rg8UJbbbb9ETmba8Wa8U:vh8Wa8Ra8U:vh8RaRa8U:vhRka8KaOa8Acdtfydbc8S2fgeaRa80aINg8UaRNNg8YaeIdbMUdbaea8Ra8Ua8RNg80Ng81aeIdlMUdlaea8Wa8Ua8WNgINg8ZaeIdwMUdwaea80aRNg80aeIdxMUdxaeaIaRNgBaeIdzMUdzaeaIa8RNg83aeIdCMUdCaeaRa8Ua8Wa8SNaRa8XNa8Va8RNMM:mg8SNgINgRaeIdKMUdKaea8RaINg8RaeId3MUd3aea8WaINg8WaeIdaMUdaaeaIa8SNgIaeId8KMUd8Kaea8UaeIdyMUdya8KaOaXcdtfydbc8S2fgea8YaeIdbMUdbaea81aeIdlMUdlaea8ZaeIdwMUdwaea80aeIdxMUdxaeaBaeIdzMUdzaea83aeIdCMUdCaeaRaeIdKMUdKaea8RaeId3MUd3aea8WaeIdaMUdaaeaIaeId8KMUd8Kaea8UaeIdyMUdykaCclfgCcx9hmbkaYcxfhYa8Jcifg8Jad6mbkaDTmbcbhYinJbbbbh8XagabaYcdtfgeclfydbgKcx2fgCIdwagaeydbgicx2fgXIdwg8Z:tg8Ra8RNaCIdbaXIdbgB:tg8Wa8WNaCIdlaXIdlg83:tg8Ua8UNMMg80agaecwfydbg8Jcx2fgeIdwa8Z:tgINa8Ra8RaINa8WaeIdbaB:tg8SNa8UaeIdla83:tg8VNMMgRN:tJbbbbJbbjZa80aIaINa8Sa8SNa8Va8VNMMg81NaRaRN:tg8Y:va8YJbbbb9BEg8YNhUa81a8RNaIaRN:ta8YNh85a80a8VNa8UaRN:ta8YNh86a81a8UNa8VaRN:ta8YNh87a80a8SNa8WaRN:ta8YNh88a81a8WNa8SaRN:ta8YNh89a8Wa8VNa8Sa8UN:tgRaRNa8UaINa8Va8RN:tgRaRNa8Ra8SNaIa8WN:tgRaRNMM:r:rhRavaiaD2cdtfhCava8JaD2cdtfhXavaKaD2cdtfh8Aa8Z:mh8:a83:mhZaB:mhncbhLaDhQJbbbbh8VJbbbbh8YJbbbbh80Jbbbbh81Jbbbbh8ZJbbbbhBJbbbbh83JbbbbhcJbbbbh9cinasc;WbfaLfgecwfaRa85a8AIdbaCIdbgI:tg8UNaUaXIdbaI:tg8SNMg8RNUdbaeclfaRa87a8UNa86a8SNMg8WNUdbaeaRa89a8UNa88a8SNMg8UNUdbaecxfaRa8:a8RNaZa8WNaIana8UNMMMgINUdbaRa8Ra8WNNa81Mh81aRa8Ra8UNNa8ZMh8ZaRa8Wa8UNNaBMhBaRaIaINNa8XMh8XaRa8RaINNa8VMh8VaRa8WaINNa8YMh8YaRa8UaINNa80Mh80aRa8Ra8RNNa83Mh83aRa8Wa8WNNacMhcaRa8Ua8UNNa9cMh9caCclfhCa8Aclfh8AaXclfhXaLczfhLaQcufgQmbkaqaOaicdtfydbgCc8S2fgea9caeIdbMUdbaeacaeIdlMUdlaea83aeIdwMUdwaeaBaeIdxMUdxaea8ZaeIdzMUdzaea81aeIdCMUdCaea80aeIdKMUdKaea8YaeId3MUd3aea8VaeIdaMUdaaea8XaeId8KMUd8KaeaRaeIdyMUdyaqaOaKcdtfydbgKc8S2fgea9caeIdbMUdbaeacaeIdlMUdlaea83aeIdwMUdwaeaBaeIdxMUdxaea8ZaeIdzMUdzaea81aeIdCMUdCaea80aeIdKMUdKaea8YaeId3MUd3aea8VaeIdaMUdaaea8XaeId8KMUd8KaeaRaeIdyMUdyaqaOa8Jcdtfydbgic8S2fgea9caeIdbMUdbaeacaeIdlMUdlaea83aeIdwMUdwaeaBaeIdxMUdxaea8ZaeIdzMUdzaea81aeIdCMUdCaea80aeIdKMUdKaea8YaeId3MUd3aea8VaeIdaMUdaaea8XaeId8KMUd8KaeaRaeIdyMUdyawaCaD2cltfhQcbhCaDh8AinaQaCfgeasc;WbfaCfgXIdbaeIdbMUdbaeclfgLaXclfIdbaLIdbMUdbaecwfgLaXcwfIdbaLIdbMUdbaecxfgeaXcxfIdbaeIdbMUdbaCczfhCa8Acufg8AmbkawaKaD2cltfhQcbhCaDh8AinaQaCfgeasc;WbfaCfgXIdbaeIdbMUdbaeclfgLaXclfIdbaLIdbMUdbaecwfgLaXcwfIdbaLIdbMUdbaecxfgeaXcxfIdbaeIdbMUdbaCczfhCa8Acufg8AmbkawaiaD2cltfhQcbhCaDh8AinaQaCfgeasc;WbfaCfgXIdbaeIdbMUdbaeclfgLaXclfIdbaLIdbMUdbaecwfgLaXcwfIdbaLIdbMUdbaecxfgeaXcxfIdbaeIdbMUdbaCczfhCa8Acufg8AmbkaYcifgYad6mbkkasydlhJcbhednalTmbaJclfheaJydbh8AaAhCalhLcbhXincbaeydbgQa8A9RaCRbbcpeGEaXfhXaCcefhCaeclfheaQh8AaLcufgLmbkaXce4hekcuadae9Rcifg8Lcx2a8Lc;v:Q;v:Qe0Ecbyd;S1jjbHjjjjbbhhascxfasyd2gecdtfahBdbasaecefgCBd2ascxfaCcdtfcua8Lcdta8LcFFFFi0Ecbyd;S1jjbHjjjjbbgzBdbasaecdfgCBd2ascxfaCcdtfa8Ecbyd;S1jjbHjjjjbbg3BdbasaecifgCBd2ascxfaCcdtfalcbyd;S1jjbHjjjjbbg9eBdbasaeclfBd2a8PJbbjZamclGEhcJbbbbh83dnadak9nmbdna8Lci6mbaxaxNacacN:vhBaDclthTahcwfhSJbbbbh83inasclfabadgoalaOz:cjjjbabhicbhEcbhyinabaycdtfh8JcbheindnaOaiaefydbgXcdtgKfydbg8AaOa8Jaec:S1jjbfydbcdtfydbgCcdtfydbgLSmbaAaCfRbbgYcv2aAaXfRbbgQfc;a1jjbfRbbgaaQcv2aYfg5c;a1jjbfRbbgdVcFeGTmbdnaLa8A9nmba5c:q1jjbfRbbcFeGmekdnaQaY9hmbaQcufcFeGce0mba8MaKfydbaC9hmekahaEcx2fg8AaCaXadcFeGgLEBdla8AaXaCaLEBdba8AaLaaGcb9hBdwaEcefhEkaeclfgecx9hmbkdnaycifgyao9pmbaicxfhiaEcifa8L9nmekkdnaEmbaohdxikcbhYinJbbbbJbbjZa8KaOahaYcx2fg8AydlgLa8AydbgQa8AydwgCEgicdtfydbgac8S2gdfgeIdygR:vaRJbbbb9BEaeIdwagaQaLaCEgKcx2fgCIdwg8UNaeIdzaCIdbgINaeIdaMgRaRMMa8UNaeIdlaCIdlg8SNaeIdCa8UNaeId3MgRaRMMa8SNaeIdbaINaeIdxa8SNaeIdKMgRaRMMaINaeId8KMMM:lNh80JbbbbJbbjZa8KaOaQcdtfydbgyc8S2gXfgeIdygR:vaRJbbbb9BEaeIdwagaLcx2fgCIdwg8WNaeIdzaCIdbg8XNaeIdaMgRaRMMa8WNaeIdlaCIdlg8VNaeIdCa8WNaeId3MgRaRMMa8VNaeIdba8XNaeIdxa8VNaeIdKMgRaRMMa8XNaeId8KMMM:lNh81a8Acwfh8Ja8Aclfh5dnaDTmbaqaXfgXIdwa8WNaXIdza8XNaXIdaMgRaRMMa8WNaXIdla8VNaXIdCa8WNaXId3MgRaRMMa8VNaXIdba8XNaXIdxa8VNaXIdKMgRaRMMa8XNaXId8KMMMh8RavaLaD2cdtfhCawayaD2cltfheaXIdyh8YaDhXinaCIdbgRJbbb;aNaecxfIdba8WaecwfIdbNa8XaeIdbNa8VaeclfIdbNMMMNaRaRNa8YNa8RMMh8RaCclfhCaeczfheaXcufgXmbkaqadfgXIdwa8UNaXIdzaINaXIdaMgRaRMMa8UNaXIdla8SNaXIdCa8UNaXId3MgRaRMMa8SNaXIdbaINaXIdxa8SNaXIdKMgRaRMMaINaXId8KMMMh8WavaKaD2cdtfhCawaaaD2cltfheaXIdyh8XaDhXinaCIdbgRJbbb;aNaecxfIdba8UaecwfIdbNaIaeIdbNa8SaeclfIdbNMMMNaRaRNa8XNa8WMMh8WaCclfhCaeczfheaXcufgXmbka80a8W:lMh80a81a8R:lMh81ka5aLaKa81a809FgeEBdba8AaQaiaeEBdba8Ja81a80aeEUdbaYcefgYaE9hmbkasc;Wbfcbcj;abz:ljjjb8AaSheaEhCinasc;WbfaeydbcO4c;8ZGfgXaXydbcefBdbaecxfheaCcufgCmbkcbhecbhCinasc;WbfaefgXydbh8AaXaCBdba8AaCfhCaeclfgecj;ab9hmbkcbheaShCinasc;WbfaCydbcO4c;8ZGfgXaXydbgXcefBdbazaXcdtfaeBdbaCcxfhCaEaecefge9hmbkaoak9RgXci9Uh9hdnalTmbcbhea3hCinaCaeBdbaCclfhCalaecefge9hmbkkcbh9ia9ecbalz:ljjjbh6aXcO9Uh9ka9hce4h0asydwh9mcbhdcbh5dninahaza5cdtfydbcx2fg8JIdwg8RaB9Emeada9h9pmeJFFuuhRdna0aE9pmbahaza0cdtfydbcx2fIdwJbb;aZNhRkdna8RaR9ETmbada9k0mdkdna6aOa8Jydlg9ncdtg9ofydbg8Afg9pRbba6aOa8Jydbgicdtg9qfydbg9rfg9sRbbVmbdnaJa9rcdtfgeclfydbgCaeydbgeSmbaCae9RhQa9maecitfheaga8Acx2fgKcwfhyaKclfh8Eaga9rcx2fgacwfhmaaclfhrcbhCcehYdnindna3aeydbcdtfydbgXa8ASmba3aeclfydbcdtfydbgLa8ASmbaXaLSmbagaLcx2fgLIdbagaXcx2fgXIdbg8W:tgRarIdbaXIdlg8U:tg8XNaaIdba8W:tg8VaLIdla8U:tg8RN:tgIaRa8EIdba8U:tg8YNaKIdba8W:tg80a8RN:tg8UNa8RamIdbaXIdwg8S:tg81Na8XaLIdwa8S:tg8WN:tg8Xa8RayIdba8S:tg8ZNa8Ya8WN:tg8RNa8Wa8VNa81aRN:tg8Sa8Wa80Na8ZaRN:tgRNMMaIaINa8Xa8XNa8Sa8SNMMa8Ua8UNa8Ra8RNaRaRNMMN:rJbbj8:N9FmdkaecwfheaCcefgCaQ6hYaQaC9hmbkkaYceGTmba0cefh0xeka8Ka8Ac8S2gXfgea8Ka9rc8S2gLfgCIdbaeIdbMUdbaeaCIdlaeIdlMUdlaeaCIdwaeIdwMUdwaeaCIdxaeIdxMUdxaeaCIdzaeIdzMUdzaeaCIdCaeIdCMUdCaeaCIdKaeIdKMUdKaeaCId3aeId3MUd3aeaCIdaaeIdaMUdaaeaCId8KaeId8KMUd8KaeaCIdyaeIdyMUdydnaDTmbaqaXfgeaqaLfgCIdbaeIdbMUdbaeaCIdlaeIdlMUdlaeaCIdwaeIdwMUdwaeaCIdxaeIdxMUdxaeaCIdzaeIdzMUdzaeaCIdCaeIdCMUdCaeaCIdKaeIdKMUdKaeaCId3aeId3MUd3aeaCIdaaeIdaMUdaaeaCId8KaeId8KMUd8KaeaCIdyaeIdyMUdyaTa9r2hYaTa8A2hKawhCaDhLinaCaKfgeaCaYfgXIdbaeIdbMUdbaeclfgQaXclfIdbaQIdbMUdbaecwfgQaXcwfIdbaQIdbMUdbaecxfgeaXcxfIdbaeIdbMUdbaCczfhCaLcufgLmbkka8JcwfhCdndndndnaAaifgXRbbc9:fPdebdkaiheina3aecdtgefa8ABdba8Faefydbgeai9hmbxikka8Fa9ofydbhea8Fa9qfydbhia3a9qfa9nBdbaeh9nka3aicdtfa9nBdbka9sce86bba9pce86bbaCIdbgRa83a83aR9DEh83a9icefh9icecdaXRbbceSEadfhdka5cefg5aE9hmbkkdna9imbaohdxikdnalTmbcbhCa8MheindnaeydbgXcuSmbdnaCa3aXcdtg8AfydbgX9hmba8Ma8AfydbhXkaeaXBdbkaeclfhealaCcefgC9hmbkcbhCa8NheindnaeydbgXcuSmbdnaCa3aXcdtg8AfydbgX9hmba8Na8AfydbhXkaeaXBdbkaeclfhealaCcefgC9hmbkkcbhdabhecbhLindna3aeydbcdtfydbgCa3aeclfydbcdtfydbgXSmbaCa3aecwfydbcdtfydbg8ASmbaXa8ASmbabadcdtfgQaCBdbaQcwfa8ABdbaQclfaXBdbadcifhdkaecxfheaLcifgLao6mbkadak9nmdxbkkasclfabadalaOz:cjjjbkdnaHTmbadTmbadheinabaHabydbcdtfydbBdbabclfhbaecufgembkkdnaPTmbaPaca83:rNUdbkasyd2gecdtascxffc98fhOdninaeTmeaOydbcbyd;O1jjbH:bjjjbbaOc98fhOaecufhexbkkasc;W;abf8Kjjjjbadk;Yieouabydlhvabydbclfcbaicdtz:ljjjbhoadci9UhrdnadTmbdnalTmbaehwadhDinaoalawydbcdtfydbcdtfgqaqydbcefBdbawclfhwaDcufgDmbxdkkaehwadhDinaoawydbcdtfgqaqydbcefBdbawclfhwaDcufgDmbkkdnaiTmbcbhDaohwinawydbhqawaDBdbawclfhwaqaDfhDaicufgimbkkdnadci6mbinaecwfydbhwaeclfydbhDaeydbhidnalTmbalawcdtfydbhwalaDcdtfydbhDalaicdtfydbhikavaoaicdtfgqydbcitfaDBdbavaqydbcitfawBdlaqaqydbcefBdbavaoaDcdtfgqydbcitfawBdbavaqydbcitfaiBdlaqaqydbcefBdbavaoawcdtfgwydbcitfaiBdbavawydbcitfaDBdlawawydbcefBdbaecxfhearcufgrmbkkabydbcbBdbk;Podvuv998Jjjjjbca9RgvcFFF;7rBd3av9cFFF;7;3FF:;Fb83dCavcFFF97Bdzav9cFFF;7FFF:;u83dwdnadTmbaicd4hodnabmbdnalTmbcbhrinaealarcdtfydbao2cdtfhwcbhiinavcCfaifgDawaifIdbgqaDIdbgkakaq9EEUdbavcwfaifgDaqaDIdbgkakaq9DEUdbaiclfgicx9hmbkarcefgrad9hmbxikkaocdthrcbhwincbhiinavcCfaifgDaeaifIdbgqaDIdbgkakaq9EEUdbavcwfaifgDaqaDIdbgkakaq9DEUdbaiclfgicx9hmbkaearfheawcefgwad9hmbxdkkdnalTmbcbhrinabarcx2fgiaealarcdtfydbao2cdtfgwIdbUdbaiawIdlUdlaiawIdwUdwcbhiinavcCfaifgDawaifIdbgqaDIdbgkakaq9EEUdbavcwfaifgDaqaDIdbgkakaq9DEUdbaiclfgicx9hmbkarcefgrad9hmbxdkkaocdthlcbhraehwinabarcx2fgiaearao2cdtfgDIdbUdbaiaDIdlUdlaiaDIdwUdwcbhiinavcCfaifgDawaifIdbgqaDIdbgkakaq9EEUdbavcwfaifgDaqaDIdbgkakaq9DEUdbaiclfgicx9hmbkawalfhwarcefgrad9hmbkkJbbbbavIdwavIdCgk:tgqaqJbbbb9DEgqavIdxavIdKgx:tgmamaq9DEgqavIdzavId3gm:tgPaPaq9DEhPdnabTmbadTmbJbbbbJbbjZaP:vaPJbbbb9BEhqinabaqabIdbak:tNUdbabclfgvaqavIdbax:tNUdbabcwfgvaqavIdbam:tNUdbabcxfhbadcufgdmbkkaPk8MbabaeadaialavcbcbcbcbcbaoarawaDz:bjjjbk8MbabaeadaialavaoarawaDaqakaxamaPz:bjjjbk;3Aowud99wue99iul998Jjjjjbc;Wb9Rgw8KjjjjbdndnarmbcbhDxekawcxfcbc;Kbz:ljjjb8Aawcuadcx2adc;v:Q;v:Qe0Ecbyd;S1jjbHjjjjbbgqBdxawceBd2aqaeadaicbz:djjjb8AawcuadcdtadcFFFFi0Egkcbyd;S1jjbHjjjjbbgxBdzawcdBd2adcd4adfhmceheinaegicetheaiam6mbkcbhmawcuaicdtgPaicFFFFi0Ecbyd;S1jjbHjjjjbbgsBdCawciBd2dndnar:Zgz:rJbbbZMgH:lJbbb9p9DTmbaH:Ohexekcjjjj94hekaicufhOc:bwhAcbhCcbhXadhQinaChLaeaAgKcufaeaK9iEamgDcefaeaD9kEhYdndnadTmbaYcuf:YhHaqhiaxheadhmindndnaiIdbaHNJbbbZMg8A:lJbbb9p9DTmba8A:OhAxekcjjjj94hAkaAcCthAdndnaiclfIdbaHNJbbbZMg8A:lJbbb9p9DTmba8A:OhCxekcjjjj94hCkaCcqtaAVhAdndnaicwfIdbaHNJbbbZMg8A:lJbbb9p9DTmba8A:OhCxekcjjjj94hCkaeaAaCVBdbaicxfhiaeclfheamcufgmmbkascFeaPz:ljjjbhEcbh3cbh5indnaEaxa5cdtfydbgAcm4aA7c:v;t;h;Ev2gics4ai7aOGgmcdtfgCydbgecuSmbaeaASmbcehiinaEamaifaOGgmcdtfgCydbgecuSmeaicefhiaeaA9hmbkkaCaABdba3aecuSfh3a5cefg5ad9hmbxdkkascFeaPz:ljjjb8Acbh3kaDaYa3ar0giEhmaLa3aiEhCdna3arSmbaYaKaiEgAam9Rcd9imbdndnaXcl0mbdnaQ:ZgHaL:Zg8A:taY:Yg8EaD:Y:tg8Fa8EaK:Y:tgaa3:Zghaz:tNNNaHaz:taaNa8Aah:tNa8Aaz:ta8FNahaH:tNM:va8EMJbbbZMgH:lJbbb9p9DTmbaH:Ohexdkcjjjj94hexekamaAfcd9Theka3aQaiEhQaXcefgXcs9hmekkdndnaCmbcihicbhDxekcbhiawakcbyd;S1jjbHjjjjbbg5BdKawclBd2dndnadTmbamcuf:YhHaqhiaxheadhmindndnaiIdbaHNJbbbZMg8A:lJbbb9p9DTmba8A:OhAxekcjjjj94hAkaAcCthAdndnaiclfIdbaHNJbbbZMg8A:lJbbb9p9DTmba8A:OhCxekcjjjj94hCkaCcqtaAVhAdndnaicwfIdbaHNJbbbZMg8A:lJbbb9p9DTmba8A:OhCxekcjjjj94hCkaeaAaCVBdbaicxfhiaeclfheamcufgmmbkascFeaPz:ljjjbhEcbhDcbh3inaxa3cdtgYfydbgAcm4aA7c:v;t;h;Ev2gics4ai7hecbhidndninaEaeaOGgmcdtfgCydbgecuSmednaxaecdtgCfydbaASmbaicefgiamfheaiaO9nmekka5aCfydbhixekaCa3BdbaDhiaDcefhDka5aYfaiBdba3cefg3ad9hmbkcuaDc32giaDc;j:KM;jb0EhexekascFeaPz:ljjjb8AcbhDcbhekawaecbyd;S1jjbHjjjjbbgeBd3awcvBd2aecbaiz:ljjjbhCavcd4hxdnadTmbdnalTmbaxcdthEa5hAalheaqhmadhOinaCaAydbc32fgiamIdbaiIdbMUdbaiamclfIdbaiIdlMUdlaiamcwfIdbaiIdwMUdwaiaeIdbaiIdxMUdxaiaeclfIdbaiIdzMUdzaiaecwfIdbaiIdCMUdCaiaiIdKJbbjZMUdKaAclfhAaeaEfheamcxfhmaOcufgOmbxdkka5hmaqheadhAinaCamydbc32fgiaeIdbaiIdbMUdbaiaeclfIdbaiIdlMUdlaiaecwfIdbaiIdwMUdwaiaiIdxJbbbbMUdxaiaiIdzJbbbbMUdzaiaiIdCJbbbbMUdCaiaiIdKJbbjZMUdKamclfhmaecxfheaAcufgAmbkkdnaDTmbaChiaDheinaiaiIdbJbbbbJbbjZaicKfIdbgH:vaHJbbbb9BEgHNUdbaiclfgmaHamIdbNUdbaicwfgmaHamIdbNUdbaicxfgmaHamIdbNUdbaiczfgmaHamIdbNUdbaicCfgmaHamIdbNUdbaic3fhiaecufgembkkcbhAawcuaDcdtgYaDcFFFFi0Egicbyd;S1jjbHjjjjbbgeBdaawcoBd2awaicbyd;S1jjbHjjjjbbgEBd8KaecFeaYz:ljjjbh3dnadTmbaoaoNh8Aaxcdthxalheina8Aaec;C1jjbalEgmIdwaCa5ydbgOc32fgiIdC:tgHaHNamIdbaiIdx:tgHaHNamIdlaiIdz:tgHaHNMMNaqcwfIdbaiIdw:tgHaHNaqIdbaiIdb:tgHaHNaqclfIdbaiIdl:tgHaHNMMMhHdndna3aOcdtgifgmydbcuSmbaEaifIdbaH9ETmekamaABdbaEaifaHUdbka5clfh5aeaxfheaqcxfhqadaAcefgA9hmbkkaba3aYz:kjjjb8AcrhikaicdthiinaiTmeaic98fgiawcxffydbcbyd;O1jjbH:bjjjbbxbkkawc;Wbf8KjjjjbaDk:Odieui99iu8Jjjjjbca9RgicFFF;7rBd3ai9cFFF;7;3FF:;Fb83dCaicFFF97Bdzai9cFFF;7FFF:;u83dwdndnaembJbbjFhlJbbjFhvJbbjFhoxekadcd4cdthrcbhwincbhdinaicCfadfgDabadfIdbglaDIdbgvaval9EEUdbaicwfadfgDalaDIdbgvaval9DEUdbadclfgdcx9hmbkabarfhbawcefgwae9hmbkaiIdzaiId3:thoaiIdxaiIdK:thvaiIdwaiIdC:thlkJbbbbalalJbbbb9DEglavaval9DEglaoaoal9DEk9DeeuabcFeaicdtz:ljjjbhlcbhbdnadTmbindnalaeydbcdtfgiydbcu9hmbaiabBdbabcefhbkaeclfheadcufgdmbkkabk9teiucbcbyd;W1jjbgeabcifc98GfgbBd;W1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaeczfheaiczfhiadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabk9teiucbcbyd;W1jjbgeabcrfc94GfgbBd;W1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik9:eiuZbhedndncbyd;W1jjbgdaecztgi9nmbcuheadai9RcFFifcz4nbcuSmekadhekcbabae9Rcifc98Gcbyd;W1jjbfgdBd;W1jjbdnadZbcztge9nmbadae9RcFFifcz4nb8Akk6eiucbhidnadTmbdninabRbbglaeRbbgv9hmeaecefheabcefhbadcufgdmbxdkkalav9Rhikaikk:bedbcjwk9Oebbbdbbbbbbbebbbeeebeebebbeeebebbbbbebebbbbbebbbdbbbbbbbbbbbbbbbeeeeebebbbbbebbbbbeebbbbbbbbbbbbbbbbbbbbbc;Owkxebbbdbbbj9Kbb",t=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if(typeof WebAssembly!="object")return{supported:!1};var n,i=WebAssembly.instantiate(r(e),{}).then(function(_){n=_.instance,n.exports.__wasm_call_ctors()});function r(_){for(var b=new Uint8Array(_.length),x=0;x<_.length;++x){var E=_.charCodeAt(x);b[x]=E>96?E-97:E>64?E-39:E+4}for(var C=0,x=0;x<_.length;++x)b[C++]=b[x]<60?t[b[x]]:(b[x]-60)*64+b[++x];return b.buffer.slice(0,C)}function s(_){if(!_)throw new Error("Assertion failed")}function o(_){return new Uint8Array(_.buffer,_.byteOffset,_.byteLength)}function a(_,b,x){var E=n.exports.sbrk,C=E(b.length*4),w=E(x*4),S=new Uint8Array(n.exports.memory.buffer),v=o(b);S.set(v,C);var D=_(w,C,b.length,x);S=new Uint8Array(n.exports.memory.buffer);var L=new Uint32Array(x);new Uint8Array(L.buffer).set(S.subarray(w,w+x*4)),v.set(S.subarray(C,C+b.length*4)),E(C-E(0));for(var O=0;O<b.length;++O)b[O]=L[b[O]];return[L,D]}function c(_){for(var b=0,x=0;x<_.length;++x){var E=_[x];b=b<E?E:b}return b}function u(_,b,x,E,C,w,S,v,D){var L=n.exports.sbrk,O=L(4),N=L(x*4),B=L(C*w),U=L(x*4),V=new Uint8Array(n.exports.memory.buffer);V.set(o(E),B),V.set(o(b),U);var f=_(N,U,x,B,C,w,S,v,D,O);V=new Uint8Array(n.exports.memory.buffer);var I=new Uint32Array(f);o(I).set(V.subarray(N,N+f*4));var F=new Float32Array(1);return o(F).set(V.subarray(O,O+4)),L(O-L(0)),[I,F[0]]}function h(_,b,x,E,C,w,S,v,D,L,O,N,B){var U=n.exports.sbrk,V=U(4),f=U(x*4),I=U(C*w),F=U(C*v),G=U(D.length*4),W=U(x*4),X=L?U(C):0,Z=new Uint8Array(n.exports.memory.buffer);Z.set(o(E),I),Z.set(o(S),F),Z.set(o(D),G),Z.set(o(b),W),L&&Z.set(o(L),X);var $=_(f,W,x,I,C,w,F,v,G,D.length,X,O,N,B,V);Z=new Uint8Array(n.exports.memory.buffer);var ne=new Uint32Array($);o(ne).set(Z.subarray(f,f+$*4));var le=new Float32Array(1);return o(le).set(Z.subarray(V,V+4)),U(V-U(0)),[ne,le[0]]}function d(_,b,x,E){var C=n.exports.sbrk,w=C(x*E),S=new Uint8Array(n.exports.memory.buffer);S.set(o(b),w);var v=_(w,x,E);return C(w-C(0)),v}function p(_,b,x,E,C,w,S,v){var D=n.exports.sbrk,L=D(v*4),O=D(x*E),N=D(x*w),B=new Uint8Array(n.exports.memory.buffer);B.set(o(b),O),C&&B.set(o(C),N);var U=_(L,O,x,E,N,w,S,v);B=new Uint8Array(n.exports.memory.buffer);var V=new Uint32Array(U);return o(V).set(B.subarray(L,L+U*4)),D(L-D(0)),V}var g={LockBorder:1,Sparse:2,ErrorAbsolute:4};return{ready:i,supported:!0,useExperimentalFeatures:!1,compactMesh:function(_){s(_ instanceof Uint32Array||_ instanceof Int32Array||_ instanceof Uint16Array||_ instanceof Int16Array),s(_.length%3==0);var b=_.BYTES_PER_ELEMENT==4?_:new Uint32Array(_);return a(n.exports.meshopt_optimizeVertexFetchRemap,b,c(_)+1)},simplify:function(_,b,x,E,C,w){s(_ instanceof Uint32Array||_ instanceof Int32Array||_ instanceof Uint16Array||_ instanceof Int16Array),s(_.length%3==0),s(b instanceof Float32Array),s(b.length%x==0),s(x>=3),s(E>=0&&E<=_.length),s(E%3==0),s(C>=0);for(var S=0,v=0;v<(w?w.length:0);++v)s(w[v]in g),S|=g[w[v]];var D=_.BYTES_PER_ELEMENT==4?_:new Uint32Array(_),L=u(n.exports.meshopt_simplify,D,_.length,b,b.length/x,x*4,E,C,S);return L[0]=_ instanceof Uint32Array?L[0]:new _.constructor(L[0]),L},simplifyWithAttributes:function(_,b,x,E,C,w,S,v,D,L){s(this.useExperimentalFeatures),s(_ instanceof Uint32Array||_ instanceof Int32Array||_ instanceof Uint16Array||_ instanceof Int16Array),s(_.length%3==0),s(b instanceof Float32Array),s(b.length%x==0),s(x>=3),s(E instanceof Float32Array),s(E.length%C==0),s(C>=0),s(S==null||S.length==b.length),s(v>=0&&v<=_.length),s(v%3==0),s(D>=0),s(Array.isArray(w)),s(C>=w.length),s(w.length<=16);for(var O=0,N=0;N<(L?L.length:0);++N)s(L[N]in g),O|=g[L[N]];var B=_.BYTES_PER_ELEMENT==4?_:new Uint32Array(_),U=h(n.exports.meshopt_simplifyWithAttributes,B,_.length,b,b.length/x,x*4,E,C*4,new Float32Array(w),S?new Uint8Array(S):null,v,D,O);return U[0]=_ instanceof Uint32Array?U[0]:new _.constructor(U[0]),U},getScale:function(_,b){return s(_ instanceof Float32Array),s(_.length%b==0),s(b>=3),d(n.exports.meshopt_simplifyScale,_,_.length/b,b*4)},simplifyPoints:function(_,b,x,E,C,w){return s(this.useExperimentalFeatures),s(_ instanceof Float32Array),s(_.length%b==0),s(b>=3),s(x>=0&&x<=_.length/b),E?(s(E instanceof Float32Array),s(E.length%C==0),s(C>=3),s(_.length/b==E.length/C),p(n.exports.meshopt_simplifyPoints,_,_.length/b,b*4,E,C*4,w,x)):p(n.exports.meshopt_simplifyPoints,_,_.length/b,b*4,void 0,0,0,x)}}})();function ol(e){e=T(e,T.EMPTY_OBJECT);const t=e.resourceCache,n=e.gltf,i=e.bufferViewId,r=e.gltfResource,s=e.baseResource,o=e.cacheKey;y.typeOf.func("options.resourceCache",t),y.typeOf.object("options.gltf",n),y.typeOf.number("options.bufferViewId",i),y.typeOf.object("options.gltfResource",r),y.typeOf.object("options.baseResource",s);const a=n.bufferViews[i];let c=a.buffer,u=a.byteOffset,h=a.byteLength,d=!1,p,g,_,b;if(oi(a,"EXT_meshopt_compression")){const E=a.extensions.EXT_meshopt_compression;c=E.buffer,u=T(E.byteOffset,0),h=E.byteLength,d=!0,p=E.byteStride,g=E.count,_=E.mode,b=T(E.filter,"NONE")}const x=n.buffers[c];this._hasMeshopt=d,this._meshoptByteStride=p,this._meshoptCount=g,this._meshoptMode=_,this._meshoptFilter=b,this._resourceCache=t,this._gltfResource=r,this._baseResource=s,this._buffer=x,this._bufferId=c,this._byteOffset=u,this._byteLength=h,this._cacheKey=o,this._bufferLoader=void 0,this._typedArray=void 0,this._state=Oe.UNLOADED,this._promise=void 0}l(Object.create)&&(ol.prototype=Object.create(ai.prototype),ol.prototype.constructor=ol);Object.defineProperties(ol.prototype,{cacheKey:{get:function(){return this._cacheKey}},typedArray:{get:function(){return this._typedArray}}});async function Uie(e){try{const t=kie(e);if(e._bufferLoader=t,await t.load(),e.isDestroyed())return;const n=t.typedArray,i=new Uint8Array(n.buffer,n.byteOffset+e._byteOffset,e._byteLength);if(e.unload(),e._typedArray=i,e._hasMeshopt){const r=e._meshoptCount,s=e._meshoptByteStride,o=new Uint8Array(r*s);zie.decodeGltfBuffer(o,r,s,e._typedArray,e._meshoptMode,e._meshoptFilter),e._typedArray=o}return e._state=Oe.READY,e}catch(t){if(e.isDestroyed())return;throw e.unload(),e._state=Oe.FAILED,e.getError("Failed to load buffer view",t)}}ol.prototype.load=async function(){return l(this._promise)?this._promise:(this._state=Oe.LOADING,this._promise=Uie(this),this._promise)};function kie(e){const t=e._resourceCache,n=e._buffer;if(l(n.uri)){const r=e._baseResource.getDerivedResource({url:n.uri});return t.getExternalBufferLoader({resource:r})}return t.getEmbeddedBufferLoader({parentResource:e._gltfResource,bufferId:e._bufferId})}ol.prototype.unload=function(){l(this._bufferLoader)&&!this._bufferLoader.isDestroyed()&&this._resourceCache.unload(this._bufferLoader),this._bufferLoader=void 0,this._typedArray=void 0};function Hn(){}Hn._maxDecodingConcurrency=Math.max(It.hardwareConcurrency-1,1);Hn._decoderTaskProcessor=void 0;Hn._taskProcessorReady=!1;Hn._error=void 0;Hn._getDecoderTaskProcessor=function(){if(!l(Hn._decoderTaskProcessor)){const e=new Dn("decodeDraco",Hn._maxDecodingConcurrency);e.initWebAssemblyModule({wasmBinaryFile:"ThirdParty/draco_decoder.wasm"}).then(function(t){t?Hn._taskProcessorReady=!0:Hn._error=new te("Draco decoder could not be initialized.")}).catch(t=>{Hn._error=t}),Hn._decoderTaskProcessor=e}return Hn._decoderTaskProcessor};Hn.decodePointCloud=function(e){const t=Hn._getDecoderTaskProcessor();if(l(Hn._error))throw Hn._error;if(Hn._taskProcessorReady)return t.scheduleTask(e,[e.buffer.buffer])};Hn.decodeBufferView=function(e){const t=Hn._getDecoderTaskProcessor();if(l(Hn._error))throw Hn._error;if(Hn._taskProcessorReady)return t.scheduleTask(e,[e.array.buffer])};function Ya(e){e=T(e,T.EMPTY_OBJECT);const t=e.resourceCache,n=e.gltf,i=e.draco,r=e.gltfResource,s=e.baseResource,o=e.cacheKey;y.typeOf.func("options.resourceCache",t),y.typeOf.object("options.gltf",n),y.typeOf.object("options.draco",i),y.typeOf.object("options.gltfResource",r),y.typeOf.object("options.baseResource",s),this._resourceCache=t,this._gltfResource=r,this._baseResource=s,this._gltf=n,this._draco=i,this._cacheKey=o,this._bufferViewLoader=void 0,this._bufferViewTypedArray=void 0,this._decodePromise=void 0,this._decodedData=void 0,this._state=Oe.UNLOADED,this._promise=void 0,this._dracoError=void 0}l(Object.create)&&(Ya.prototype=Object.create(ai.prototype),Ya.prototype.constructor=Ya);Object.defineProperties(Ya.prototype,{cacheKey:{get:function(){return this._cacheKey}},decodedData:{get:function(){return this._decodedData}}});async function jie(e){const t=e._resourceCache;try{const n=t.getBufferViewLoader({gltf:e._gltf,bufferViewId:e._draco.bufferView,gltfResource:e._gltfResource,baseResource:e._baseResource});return e._bufferViewLoader=n,await n.load(),e.isDestroyed()?void 0:(e._bufferViewTypedArray=n.typedArray,e._state=Oe.PROCESSING,e)}catch(n){if(e.isDestroyed())return;fN(e,n)}}Ya.prototype.load=async function(){return l(this._promise)?this._promise:(this._state=Oe.LOADING,this._promise=jie(this),this._promise)};function fN(e,t){throw e.unload(),e._state=Oe.FAILED,e.getError("Failed to load Draco",t)}async function Vie(e,t){try{const n=await t;return e.isDestroyed()?void 0:(e.unload(),e._decodedData={indices:n.indexArray,vertexAttributes:n.attributeData},e._state=Oe.READY,e._baseResource)}catch(n){if(e.isDestroyed())return;e._dracoError=n}}Ya.prototype.process=function(e){if(y.typeOf.object("frameState",e),this._state===Oe.READY)return!0;if(this._state!==Oe.PROCESSING||(l(this._dracoError)&&fN(this,this._dracoError),!l(this._bufferViewTypedArray))||l(this._decodePromise))return!1;const t=this._draco,i=this._gltf.bufferViews,r=t.bufferView,s=i[r],o=t.attributes,a={array:new Uint8Array(this._bufferViewTypedArray),bufferView:s,compressedAttributes:o,dequantizeInShader:!0},c=Hn.decodeBufferView(a);if(!l(c))return!1;this._decodePromise=Vie(this,c)};Ya.prototype.unload=function(){l(this._bufferViewLoader)&&this._resourceCache.unload(this._bufferViewLoader),this._bufferViewLoader=void 0,this._bufferViewTypedArray=void 0,this._decodedData=void 0,this._gltf=void 0};function ha(e){e=T(e,T.EMPTY_OBJECT);const t=e.resourceCache,n=e.gltf,i=e.imageId,r=e.gltfResource,s=e.baseResource,o=e.cacheKey;y.typeOf.func("options.resourceCache",t),y.typeOf.object("options.gltf",n),y.typeOf.number("options.imageId",i),y.typeOf.object("options.gltfResource",r),y.typeOf.object("options.baseResource",s);const a=n.images[i],c=a.bufferView,u=a.uri;this._resourceCache=t,this._gltfResource=r,this._baseResource=s,this._gltf=n,this._bufferViewId=c,this._uri=u,this._cacheKey=o,this._bufferViewLoader=void 0,this._image=void 0,this._mipLevels=void 0,this._state=Oe.UNLOADED,this._promise=void 0}l(Object.create)&&(ha.prototype=Object.create(ai.prototype),ha.prototype.constructor=ha);Object.defineProperties(ha.prototype,{cacheKey:{get:function(){return this._cacheKey}},image:{get:function(){return this._image}},mipLevels:{get:function(){return this._mipLevels}}});ha.prototype.load=function(){return l(this._promise)?this._promise:l(this._bufferViewId)?(this._promise=Gie(this),this._promise):(this._promise=Hie(this),this._promise)};function hN(e){let t;return Array.isArray(e)&&(t=e.slice(1,e.length).map(function(n){return n.bufferView}),e=e[0]),{image:e,mipLevels:t}}async function Gie(e){e._state=Oe.LOADING;const t=e._resourceCache;try{const n=t.getBufferViewLoader({gltf:e._gltf,bufferViewId:e._bufferViewId,gltfResource:e._gltfResource,baseResource:e._baseResource});if(e._bufferViewLoader=n,await n.load(),e.isDestroyed())return;const i=n.typedArray,r=await Wie(i);if(e.isDestroyed())return;const s=hN(r);return e.unload(),e._image=s.image,e._mipLevels=s.mipLevels,e._state=Oe.READY,e}catch(n){return e.isDestroyed()?void 0:dN(e,n,"Failed to load embedded image")}}async function Hie(e){e._state=Oe.LOADING;const t=e._baseResource,n=e._uri,i=t.getDerivedResource({url:n});try{const r=await Xie(i);if(e.isDestroyed())return;const s=hN(r);return e.unload(),e._image=s.image,e._mipLevels=s.mipLevels,e._state=Oe.READY,e}catch(r){return e.isDestroyed()?void 0:dN(e,r,`Failed to load image: ${n}`)}}function dN(e,t,n){return e.unload(),e._state=Oe.FAILED,Promise.reject(e.getError(n,t))}function qie(e){const t=e.subarray(0,2),n=e.subarray(0,4),i=e.subarray(8,12);if(t[0]===255&&t[1]===216)return"image/jpeg";if(t[0]===137&&t[1]===80)return"image/png";if(t[0]===171&&t[1]===75)return"image/ktx2";if(n[0]===82&&n[1]===73&&n[2]===70&&n[3]===70&&i[0]===87&&i[1]===69&&i[2]===66&&i[3]===80)return"image/webp";throw new te("Image format is not recognized")}async function Wie(e){const t=qie(e);if(t==="image/ktx2"){const n=new Uint8Array(e);return Dh(n)}return ha._loadImageFromTypedArray({uint8Array:e,format:t,flipY:!1,skipColorSpaceConversion:!0})}const $ie=/(^data:image\/ktx2)|(\.ktx2$)/i;function Xie(e){const t=e.getUrlComponent(!1,!0);return $ie.test(t)?Dh(e):e.fetchImage({skipColorSpaceConversion:!0,preferImageBitmap:!0})}ha.prototype.unload=function(){l(this._bufferViewLoader)&&!this._bufferViewLoader.isDestroyed()&&this._resourceCache.unload(this._bufferViewLoader),this._bufferViewLoader=void 0,this._uri=void 0,this._image=void 0,this._mipLevels=void 0,this._gltf=void 0};ha._loadImageFromTypedArray=JY;const Yie={TEXTURE:0,PROGRAM:1,BUFFER:2,NUMBER_OF_JOB_TYPES:3},dw=Object.freeze(Yie);function Ka(e){e=T(e,T.EMPTY_OBJECT);const t=e.resourceCache,n=e.gltf,i=e.accessorId,r=e.gltfResource,s=e.baseResource,o=e.draco,a=e.cacheKey,c=T(e.asynchronous,!0),u=T(e.loadBuffer,!1),h=T(e.loadTypedArray,!1);if(y.typeOf.func("options.resourceCache",t),y.typeOf.object("options.gltf",n),y.typeOf.number("options.accessorId",i),y.typeOf.object("options.gltfResource",r),y.typeOf.object("options.baseResource",s),!u&&!h)throw new A("At least one of loadBuffer and loadTypedArray must be true.");const d=n.accessors[i].componentType;this._resourceCache=t,this._gltfResource=r,this._baseResource=s,this._gltf=n,this._accessorId=i,this._indexDatatype=d,this._draco=o,this._cacheKey=a,this._asynchronous=c,this._loadBuffer=u,this._loadTypedArray=h,this._bufferViewLoader=void 0,this._dracoLoader=void 0,this._typedArray=void 0,this._buffer=void 0,this._state=Oe.UNLOADED,this._promise=void 0}l(Object.create)&&(Ka.prototype=Object.create(ai.prototype),Ka.prototype.constructor=Ka);Object.defineProperties(Ka.prototype,{cacheKey:{get:function(){return this._cacheKey}},buffer:{get:function(){return this._buffer}},typedArray:{get:function(){return this._typedArray}},indexDatatype:{get:function(){return this._indexDatatype}}});const Kie=new mw;Ka.prototype.load=async function(){return l(this._promise)?this._promise:l(this._draco)?(this._promise=Zie(this),this._promise):(this._promise=Jie(this),this._promise)};async function Zie(e){e._state=Oe.LOADING;const t=e._resourceCache;try{const n=t.getDracoLoader({gltf:e._gltf,draco:e._draco,gltfResource:e._gltfResource,baseResource:e._baseResource});return e._dracoLoader=n,await n.load(),e.isDestroyed()?void 0:(e._state=Oe.LOADED,e)}catch(n){if(e.isDestroyed())return;pw(e,n)}}async function Jie(e){const t=e._gltf,n=e._accessorId,r=t.accessors[n].bufferView;e._state=Oe.LOADING;const s=e._resourceCache;try{const o=s.getBufferViewLoader({gltf:t,bufferViewId:r,gltfResource:e._gltfResource,baseResource:e._baseResource});if(e._bufferViewLoader=o,await o.load(),e.isDestroyed())return;const a=o.typedArray;return e._typedArray=Qie(e,a),e._state=Oe.PROCESSING,e}catch(o){if(e.isDestroyed())return;pw(e,o)}}function Qie(e,t){const n=e._gltf,i=e._accessorId,r=n.accessors[i],s=r.count,o=r.componentType,a=Ge.getSizeInBytes(o);let c=t.buffer,u=t.byteOffset+r.byteOffset;if(u%a!==0){const d=s*a,p=new Uint8Array(c,u,d);c=new Uint8Array(p).buffer,u=0,pc("index-buffer-unaligned",`The index array is not aligned to a ${a}-byte boundary.`)}let h;return o===Ge.UNSIGNED_BYTE?h=new Uint8Array(c,u,s):o===Ge.UNSIGNED_SHORT?h=new Uint16Array(c,u,s):o===Ge.UNSIGNED_INT&&(h=new Uint32Array(c,u,s)),h}function pw(e,t){throw e.unload(),e._state=Oe.FAILED,e.getError("Failed to load index buffer",t)}function mw(){this.typedArray=void 0,this.indexDatatype=void 0,this.context=void 0,this.buffer=void 0}mw.prototype.set=function(e,t,n){this.typedArray=e,this.indexDatatype=t,this.context=n};mw.prototype.execute=function(){this.buffer=pN(this.typedArray,this.indexDatatype,this.context)};function pN(e,t,n){const i=ze.createIndexBuffer({typedArray:e,context:n,usage:Ae.STATIC_DRAW,indexDatatype:t});return i.vertexArrayDestroyable=!1,i}Ka.prototype.process=function(e){if(y.typeOf.object("frameState",e),this._state===Oe.READY)return!0;if(this._state!==Oe.LOADED&&this._state!==Oe.PROCESSING)return!1;let t=this._typedArray,n=this._indexDatatype;if(l(this._dracoLoader))try{this._dracoLoader.process(e)&&(t=this._dracoLoader.decodedData.indices.typedArray,this._typedArray=t,n=q.fromTypedArray(t),this._indexDatatype=n)}catch(r){pw(this,r)}if(!l(t))return!1;let i;if(this._loadBuffer&&this._asynchronous){const r=Kie;if(r.set(t,n,e.context),!e.jobScheduler.execute(r,dw.BUFFER))return!1;i=r.buffer}else this._loadBuffer&&(i=pN(t,n,e.context));return this.unload(),this._buffer=i,this._typedArray=this._loadTypedArray?t:void 0,this._state=Oe.READY,this._resourceCache.statistics.addGeometryLoader(this),!0};Ka.prototype.unload=function(){l(this._buffer)&&this._buffer.destroy();const e=this._resourceCache;l(this._bufferViewLoader)&&!this._bufferViewLoader.isDestroyed()&&e.unload(this._bufferViewLoader),l(this._dracoLoader)&&e.unload(this._dracoLoader),this._bufferViewLoader=void 0,this._dracoLoader=void 0,this._typedArray=void 0,this._buffer=void 0,this._gltf=void 0};function Ao(e,t,n){if(n=T(n,!1),n){const i=e.indexOf(t);if(i>-1)return i}return e.push(t),e.length-1}function Mi(e,t){return l(e.extensionsUsed)&&e.extensionsUsed.indexOf(t)>=0}function K(){}K.objectLegacy=function(e,t){if(l(e)){for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)){const i=e[n],r=t(i,n);if(l(r))return r}}};K.object=function(e,t){if(l(e)){const n=e.length;for(let i=0;i<n;i++){const r=e[i],s=t(r,i);if(l(s))return s}}};K.topLevel=function(e,t,n){const i=e[t];return l(i)&&!Array.isArray(i)?K.objectLegacy(i,n):K.object(i,n)};K.accessor=function(e,t){return K.topLevel(e,"accessors",t)};K.accessorWithSemantic=function(e,t,n){const i={};return K.mesh(e,function(r){return K.meshPrimitive(r,function(s){const o=K.meshPrimitiveAttribute(s,function(a,c){if(c.indexOf(t)===0&&!l(i[a])){i[a]=!0;const u=n(a);if(l(u))return u}});return l(o)?o:K.meshPrimitiveTarget(s,function(a){return K.meshPrimitiveTargetAttribute(a,function(c,u){if(u.indexOf(t)===0&&!l(i[c])){i[c]=!0;const h=n(c);if(l(h))return h}})})})})};K.accessorContainingVertexAttributeData=function(e,t){const n={};return K.mesh(e,function(i){return K.meshPrimitive(i,function(r){const s=K.meshPrimitiveAttribute(r,function(o){if(!l(n[o])){n[o]=!0;const a=t(o);if(l(a))return a}});return l(s)?s:K.meshPrimitiveTarget(r,function(o){return K.meshPrimitiveTargetAttribute(o,function(a){if(!l(n[a])){n[a]=!0;const c=t(a);if(l(c))return c}})})})})};K.accessorContainingIndexData=function(e,t){const n={};return K.mesh(e,function(i){return K.meshPrimitive(i,function(r){const s=r.indices;if(l(s)&&!l(n[s])){n[s]=!0;const o=t(s);if(l(o))return o}})})};K.animation=function(e,t){return K.topLevel(e,"animations",t)};K.animationChannel=function(e,t){const n=e.channels;return K.object(n,t)};K.animationSampler=function(e,t){const n=e.samplers;return K.object(n,t)};K.buffer=function(e,t){return K.topLevel(e,"buffers",t)};K.bufferView=function(e,t){return K.topLevel(e,"bufferViews",t)};K.camera=function(e,t){return K.topLevel(e,"cameras",t)};K.image=function(e,t){return K.topLevel(e,"images",t)};K.material=function(e,t){return K.topLevel(e,"materials",t)};K.materialValue=function(e,t){let n=e.values;l(e.extensions)&&l(e.extensions.KHR_techniques_webgl)&&(n=e.extensions.KHR_techniques_webgl.values);for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)){const r=t(n[i],i);if(l(r))return r}};K.mesh=function(e,t){return K.topLevel(e,"meshes",t)};K.meshPrimitive=function(e,t){const n=e.primitives;if(l(n)){const i=n.length;for(let r=0;r<i;r++){const s=n[r],o=t(s,r);if(l(o))return o}}};K.meshPrimitiveAttribute=function(e,t){const n=e.attributes;for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)){const r=t(n[i],i);if(l(r))return r}};K.meshPrimitiveTarget=function(e,t){const n=e.targets;if(l(n)){const i=n.length;for(let r=0;r<i;++r){const s=t(n[r],r);if(l(s))return s}}};K.meshPrimitiveTargetAttribute=function(e,t){for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)){const i=e[n],r=t(i,n);if(l(r))return r}};K.node=function(e,t){return K.topLevel(e,"nodes",t)};K.nodeInTree=function(e,t,n){const i=e.nodes;if(l(i)){const r=t.length;for(let s=0;s<r;s++){const o=t[s],a=i[o];if(l(a)){let c=n(a,o);if(l(c))return c;const u=a.children;if(l(u)&&(c=K.nodeInTree(e,u,n),l(c)))return c}}}};K.nodeInScene=function(e,t,n){const i=t.nodes;if(l(i))return K.nodeInTree(e,i,n)};K.program=function(e,t){return Mi(e,"KHR_techniques_webgl")?K.object(e.extensions.KHR_techniques_webgl.programs,t):K.topLevel(e,"programs",t)};K.sampler=function(e,t){return K.topLevel(e,"samplers",t)};K.scene=function(e,t){return K.topLevel(e,"scenes",t)};K.shader=function(e,t){return Mi(e,"KHR_techniques_webgl")?K.object(e.extensions.KHR_techniques_webgl.shaders,t):K.topLevel(e,"shaders",t)};K.skin=function(e,t){return K.topLevel(e,"skins",t)};K.skinJoint=function(e,t){const n=e.joints;if(l(n)){const i=n.length;for(let r=0;r<i;r++){const s=n[r],o=t(s);if(l(o))return o}}};K.techniqueAttribute=function(e,t){const n=e.attributes;for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)){const r=t(n[i],i);if(l(r))return r}};K.techniqueUniform=function(e,t){const n=e.uniforms;for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)){const r=t(n[i],i);if(l(r))return r}};K.techniqueParameter=function(e,t){const n=e.parameters;for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)){const r=t(n[i],i);if(l(r))return r}};K.technique=function(e,t){return Mi(e,"KHR_techniques_webgl")?K.object(e.extensions.KHR_techniques_webgl.techniques,t):K.topLevel(e,"techniques",t)};K.texture=function(e,t){return K.topLevel(e,"textures",t)};function sm(e){switch(e){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}}function Nh(e,t){const n=t.bufferView;if(l(n)){const i=e.bufferViews[n];if(l(i.byteStride)&&i.byteStride>0)return i.byteStride}return q.getSizeInBytes(t.componentType)*sm(t.type)}function ere(e){K.accessor(e,function(n){l(n.bufferView)&&(n.byteOffset=T(n.byteOffset,0))}),K.bufferView(e,function(n){l(n.buffer)&&(n.byteOffset=T(n.byteOffset,0))}),K.mesh(e,function(n){K.meshPrimitive(n,function(i){if(i.mode=T(i.mode,j.TRIANGLES),!l(i.material)){l(e.materials)||(e.materials=[]);const r={name:"default"};i.material=Ao(e.materials,r)}})}),K.accessorContainingVertexAttributeData(e,function(n){const i=e.accessors[n],r=i.bufferView;if(i.normalized=T(i.normalized,!1),l(r)){const s=e.bufferViews[r];s.byteStride=Nh(e,i),s.target=j.ARRAY_BUFFER}}),K.accessorContainingIndexData(e,function(n){const r=e.accessors[n].bufferView;if(l(r)){const s=e.bufferViews[r];s.target=j.ELEMENT_ARRAY_BUFFER}}),K.material(e,function(n){const i=T(n.extensions,T.EMPTY_OBJECT),r=i.KHR_materials_common;if(l(r)){const c=r.technique,u=l(r.values)?r.values:{};r.values=u,u.ambient=l(u.ambient)?u.ambient:[0,0,0,1],u.emission=l(u.emission)?u.emission:[0,0,0,1],u.transparency=T(u.transparency,1),c!=="CONSTANT"&&(u.diffuse=l(u.diffuse)?u.diffuse:[0,0,0,1],c!=="LAMBERT"&&(u.specular=l(u.specular)?u.specular:[0,0,0,1],u.shininess=T(u.shininess,0))),r.transparent=T(r.transparent,!1),r.doubleSided=T(r.doubleSided,!1);return}n.emissiveFactor=T(n.emissiveFactor,[0,0,0]),n.alphaMode=T(n.alphaMode,"OPAQUE"),n.doubleSided=T(n.doubleSided,!1),n.alphaMode==="MASK"&&(n.alphaCutoff=T(n.alphaCutoff,.5));const s=i.KHR_techniques_webgl;l(s)&&K.materialValue(n,function(c){l(c.index)&&Kl(c)}),Kl(n.emissiveTexture),Kl(n.normalTexture),Kl(n.occlusionTexture);const o=n.pbrMetallicRoughness;l(o)&&(o.baseColorFactor=T(o.baseColorFactor,[1,1,1,1]),o.metallicFactor=T(o.metallicFactor,1),o.roughnessFactor=T(o.roughnessFactor,1),Kl(o.baseColorTexture),Kl(o.metallicRoughnessTexture));const a=i.KHR_materials_pbrSpecularGlossiness;l(a)&&(a.diffuseFactor=T(a.diffuseFactor,[1,1,1,1]),a.specularFactor=T(a.specularFactor,[1,1,1]),a.glossinessFactor=T(a.glossinessFactor,1),Kl(a.specularGlossinessTexture))}),K.animation(e,function(n){K.animationSampler(n,function(i){i.interpolation=T(i.interpolation,"LINEAR")})});const t=tre(e);return K.node(e,function(n,i){l(t[i])||l(n.translation)||l(n.rotation)||l(n.scale)?(n.translation=T(n.translation,[0,0,0]),n.rotation=T(n.rotation,[0,0,0,1]),n.scale=T(n.scale,[1,1,1])):n.matrix=T(n.matrix,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}),K.sampler(e,function(n){n.wrapS=T(n.wrapS,j.REPEAT),n.wrapT=T(n.wrapT,j.REPEAT)}),l(e.scenes)&&!l(e.scene)&&(e.scene=0),e}function tre(e){const t={};return K.animation(e,function(n){K.animationChannel(n,function(i){const r=i.target,s=r.node,o=r.path;(o==="translation"||o==="rotation"||o==="scale")&&(t[s]=!0)})}),t}function Kl(e){l(e)&&(e.texCoord=T(e.texCoord,0))}function gw(e){return K.shader(e,function(t){mg(t)}),K.buffer(e,function(t){mg(t)}),K.image(e,function(t){mg(t)}),mg(e),e}function mg(e){e.extras=l(e.extras)?e.extras:{},e.extras._pipeline=l(e.extras._pipeline)?e.extras._pipeline:{}}function nre(e,t){const n=e.extensionsRequired;if(l(n)){const i=n.indexOf(t);i>=0&&n.splice(i,1),n.length===0&&delete e.extensionsRequired}}function mN(e,t){const n=e.extensionsUsed;if(l(n)){const i=n.indexOf(t);i>=0&&n.splice(i,1),nre(e,t),n.length===0&&delete e.extensionsUsed}}const ire=4;function rre(e){if($y(e)!=="glTF")throw new te("File is not valid binary glTF");const n=gN(e,0,5),i=n[1];if(i!==1&&i!==2)throw new te("Binary glTF version is not 1 or 2");return i===1?sre(e,n):ore(e,n)}function gN(e,t,n){const i=new DataView(e.buffer),r=new Array(n);for(let s=0;s<n;++s)r[s]=i.getUint32(e.byteOffset+t+s*ire,!0);return r}function sre(e,t){const n=t[2],i=t[3];if(t[4]!==0)throw new te("Binary glTF scene format is not JSON");const s=20,o=s+i,a=gs(e,s,i),c=JSON.parse(a);gw(c);const u=e.subarray(o,n),h=c.buffers;if(l(h)&&Object.keys(h).length>0){const d=T(h.binary_glTF,h.KHR_binary_glTF);l(d)&&(d.extras._pipeline.source=u,delete d.uri)}return mN(c,"KHR_binary_glTF"),c}function ore(e,t){const n=t[2];let i=12,r,s;for(;i<n;){const o=gN(e,i,2),a=o[0],c=o[1];i+=8;const u=e.subarray(i,i+a);if(i+=a,c===1313821514){const h=gs(u);r=JSON.parse(h),gw(r)}else c===5130562&&(s=u)}if(l(r)&&l(s)){const o=r.buffers;if(l(o)&&o.length>0){const a=o[0];a.extras._pipeline.source=s}}return r}function are(e){return K.shader(e,function(t){gg(t)}),K.buffer(e,function(t){gg(t)}),K.image(e,function(t){gg(t)}),gg(e),e}function gg(e){l(e.extras)&&(l(e.extras._pipeline)&&delete e.extras._pipeline,Object.keys(e.extras).length===0&&delete e.extras)}function om(e,t){let n=e.extensionsUsed;l(n)||(n=[],e.extensionsUsed=n),Ao(n,t,!0)}function _w(e){switch(e){case q.BYTE:return function(t,n,i,r,s){for(let o=0;o<i;++o)s[o]=t.getInt8(n+o*r)};case q.UNSIGNED_BYTE:return function(t,n,i,r,s){for(let o=0;o<i;++o)s[o]=t.getUint8(n+o*r)};case q.SHORT:return function(t,n,i,r,s){for(let o=0;o<i;++o)s[o]=t.getInt16(n+o*r,!0)};case q.UNSIGNED_SHORT:return function(t,n,i,r,s){for(let o=0;o<i;++o)s[o]=t.getUint16(n+o*r,!0)};case q.INT:return function(t,n,i,r,s){for(let o=0;o<i;++o)s[o]=t.getInt32(n+o*r,!0)};case q.UNSIGNED_INT:return function(t,n,i,r,s){for(let o=0;o<i;++o)s[o]=t.getUint32(n+o*r,!0)};case q.FLOAT:return function(t,n,i,r,s){for(let o=0;o<i;++o)s[o]=t.getFloat32(n+o*r,!0)};case q.DOUBLE:return function(t,n,i,r,s){for(let o=0;o<i;++o)s[o]=t.getFloat64(n+o*r,!0)}}}function yw(e,t){const n=e.bufferViews,i=e.buffers,r=t.bufferView,s=sm(t.type);if(!l(t.bufferView))return{min:new Array(s).fill(0),max:new Array(s).fill(0)};const o=new Array(s).fill(Number.POSITIVE_INFINITY),a=new Array(s).fill(Number.NEGATIVE_INFINITY),c=n[r],u=c.buffer,d=i[u].extras._pipeline.source,p=t.count,g=Nh(e,t);let _=t.byteOffset+c.byteOffset+d.byteOffset;const b=t.componentType,x=q.getSizeInBytes(b),E=new DataView(d.buffer),C=new Array(s),w=_w(b);for(let S=0;S<p;S++){w(E,_,s,x,C);for(let v=0;v<s;v++){const D=C[v];o[v]=Math.min(o[v],D),a[v]=Math.max(a[v],D)}_+=g}return{min:o,max:a}}const cre=[j.FUNC_ADD,j.FUNC_ADD],lre=[j.ONE,j.ZERO,j.ONE,j.ZERO];function E1(e,t){const n=e.enable;return l(n)?n.indexOf(t)>-1:!1}const ure=[j.ZERO,j.ONE,j.SRC_COLOR,j.ONE_MINUS_SRC_COLOR,j.SRC_ALPHA,j.ONE_MINUS_SRC_ALPHA,j.DST_ALPHA,j.ONE_MINUS_DST_ALPHA,j.DST_COLOR,j.ONE_MINUS_DST_COLOR];function fre(e,t){if(!l(e))return t;for(let n=0;n<4;n++)if(ure.indexOf(e[n])===-1)return t;return e}function hre(e){const t={},n={},i=e.techniques;return l(i)&&(K.technique(e,function(r,s){const o=r.states;if(l(o)){const a=n[s]={};if(E1(o,j.BLEND)){a.alphaMode="BLEND";const c=o.functions;l(c)&&(l(c.blendEquationSeparate)||l(c.blendFuncSeparate))&&(t[s]={blendEquation:T(c.blendEquationSeparate,cre),blendFactors:fre(c.blendFuncSeparate,lre)})}E1(o,j.CULL_FACE)||(a.doubleSided=!0),delete r.states}}),Object.keys(t).length>0&&(l(e.extensions)||(e.extensions={}),om(e,"KHR_blend")),K.material(e,function(r){if(l(r.technique)){const s=n[r.technique];K.objectLegacy(s,function(a,c){r[c]=a});const o=t[r.technique];l(o)&&(l(r.extensions)||(r.extensions={}),r.extensions.KHR_blend=o)}})),e}function dre(e,t){let n=e.extensionsRequired;l(n)||(n=[],e.extensionsRequired=n),Ao(n,t,!0),om(e,t)}function pre(e){const t=e.techniques,n={},i={},r={};if(l(t)){const s={programs:[],shaders:[],techniques:[]},o=e.glExtensionsUsed;delete e.glExtensionsUsed,K.technique(e,function(a,c){const u={name:a.name,program:void 0,attributes:{},uniforms:{}};let h;if(K.techniqueAttribute(a,function(d,p){h=a.parameters[d],u.attributes[p]={semantic:h.semantic}}),K.techniqueUniform(a,function(d,p){h=a.parameters[d],u.uniforms[p]={count:h.count,node:h.node,type:h.type,semantic:h.semantic,value:h.value},l(n[c])||(n[c]={}),n[c][d]=p}),l(r[a.program]))u.program=r[a.program];else{const d=e.programs[a.program],p={name:d.name,fragmentShader:void 0,vertexShader:void 0,glExtensions:o},g=e.shaders[d.fragmentShader];p.fragmentShader=Ao(s.shaders,g,!0);const _=e.shaders[d.vertexShader];p.vertexShader=Ao(s.shaders,_,!0),u.program=Ao(s.programs,p),r[a.program]=u.program}i[c]=Ao(s.techniques,u)}),s.techniques.length>0&&(l(e.extensions)||(e.extensions={}),e.extensions.KHR_techniques_webgl=s,om(e,"KHR_techniques_webgl"),dre(e,"KHR_techniques_webgl"))}return K.material(e,function(s){if(l(s.technique)){const o={technique:i[s.technique]};K.objectLegacy(s.values,function(a,c){l(o.values)||(o.values={});const u=n[s.technique][c];l(u)&&(o.values[u]=a)}),l(s.extensions)||(s.extensions={}),s.extensions.KHR_techniques_webgl=o}delete s.technique,delete s.values}),delete e.techniques,delete e.programs,delete e.shaders,e}function _N(e,t){y.typeOf.object("material",e),y.defined("handler",t);const n=e.pbrMetallicRoughness;if(l(n)){if(l(n.baseColorTexture)){const s=n.baseColorTexture,o=t(s.index,s);if(l(o))return o}if(l(n.metallicRoughnessTexture)){const s=n.metallicRoughnessTexture,o=t(s.index,s);if(l(o))return o}}const{extensions:i}=e;if(l(i)){const s=i.KHR_materials_pbrSpecularGlossiness;if(l(s)){if(l(s.diffuseTexture)){const c=s.diffuseTexture,u=t(c.index,c);if(l(u))return u}if(l(s.specularGlossinessTexture)){const c=s.specularGlossinessTexture,u=t(c.index,c);if(l(u))return u}}const o=i.KHR_materials_specular;if(l(o)){const{specularTexture:c,specularColorTexture:u}=o;if(l(c)){const h=t(c.index,c);if(l(h))return h}if(l(u)){const h=t(u.index,u);if(l(h))return h}}const a=i.KHR_materials_common;if(l(a)&&l(a.values)){const{diffuse:c,ambient:u,emission:h,specular:d}=a.values;if(l(c)&&l(c.index)){const p=t(c.index,c);if(l(p))return p}if(l(u)&&l(u.index)){const p=t(u.index,u);if(l(p))return p}if(l(h)&&l(h.index)){const p=t(h.index,h);if(l(p))return p}if(l(d)&&l(d.index)){const p=t(d.index,d);if(l(p))return p}}}const r=K.materialValue(e,function(s){if(l(s.index)){const o=t(s.index,s);if(l(o))return o}});if(l(r))return r;if(l(e.emissiveTexture)){const s=e.emissiveTexture,o=t(s.index,s);if(l(o))return o}if(l(e.normalTexture)){const s=e.normalTexture,o=t(s.index,s);if(l(o))return o}if(l(e.occlusionTexture)){const s=e.occlusionTexture,o=t(s.index,s);if(l(o))return o}}const C1=["mesh","node","material","accessor","bufferView","buffer","texture","sampler","image"];function mre(e,t){return t=T(t,C1),C1.forEach(function(n){t.indexOf(n)>-1&&_re(e,n)}),e}const gre={accessor:"accessors",buffer:"buffers",bufferView:"bufferViews",image:"images",node:"nodes",material:"materials",mesh:"meshes",sampler:"samplers",texture:"textures"};function _re(e,t){const n=gre[t],i=e[n];if(l(i)){let r=0;const s=Ra[t](e),o=i.length;for(let a=0;a<o;++a)s[a]||(Oa[t](e,a-r),r++)}}function Oa(){}Oa.accessor=function(e,t){e.accessors.splice(t,1),K.mesh(e,function(i){K.meshPrimitive(i,function(r){K.meshPrimitiveAttribute(r,function(a,c){a>t&&r.attributes[c]--}),K.meshPrimitiveTarget(r,function(a){K.meshPrimitiveTargetAttribute(a,function(c,u){c>t&&a[u]--})});const s=r.indices;l(s)&&s>t&&r.indices--;const o=r.extensions;l(o)&&l(o.CESIUM_primitive_outline)&&o.CESIUM_primitive_outline.indices>t&&--o.CESIUM_primitive_outline.indices})}),K.skin(e,function(i){l(i.inverseBindMatrices)&&i.inverseBindMatrices>t&&i.inverseBindMatrices--}),K.animation(e,function(i){K.animationSampler(i,function(r){l(r.input)&&r.input>t&&r.input--,l(r.output)&&r.output>t&&r.output--})})};Oa.buffer=function(e,t){e.buffers.splice(t,1),K.bufferView(e,function(i){l(i.buffer)&&i.buffer>t&&i.buffer--,l(i.extensions)&&l(i.extensions.EXT_meshopt_compression)&&i.extensions.EXT_meshopt_compression.buffer--})};Oa.bufferView=function(e,t){if(e.bufferViews.splice(t,1),K.accessor(e,function(i){l(i.bufferView)&&i.bufferView>t&&i.bufferView--}),K.shader(e,function(i){l(i.bufferView)&&i.bufferView>t&&i.bufferView--}),K.image(e,function(i){l(i.bufferView)&&i.bufferView>t&&i.bufferView--}),Mi(e,"KHR_draco_mesh_compression")&&K.mesh(e,function(i){K.meshPrimitive(i,function(r){l(r.extensions)&&l(r.extensions.KHR_draco_mesh_compression)&&r.extensions.KHR_draco_mesh_compression.bufferView>t&&r.extensions.KHR_draco_mesh_compression.bufferView--})}),Mi(e,"EXT_feature_metadata")){const r=e.extensions.EXT_feature_metadata.featureTables;for(const s in r)if(r.hasOwnProperty(s)){const a=r[s].properties;if(l(a)){for(const c in a)if(a.hasOwnProperty(c)){const u=a[c];l(u.bufferView)&&u.bufferView>t&&u.bufferView--,l(u.arrayOffsetBufferView)&&u.arrayOffsetBufferView>t&&u.arrayOffsetBufferView--,l(u.stringOffsetBufferView)&&u.stringOffsetBufferView>t&&u.stringOffsetBufferView--}}}}if(Mi(e,"EXT_structural_metadata")){const r=e.extensions.EXT_structural_metadata.propertyTables;if(l(r)){const s=r.length;for(let o=0;o<s;++o){const c=r[o].properties;for(const u in c)if(c.hasOwnProperty(u)){const h=c[u];l(h.values)&&h.values>t&&h.values--,l(h.arrayOffsets)&&h.arrayOffsets>t&&h.arrayOffsets--,l(h.stringOffsets)&&h.stringOffsets>t&&h.stringOffsets--}}}}};Oa.image=function(e,t){e.images.splice(t,1),K.texture(e,function(i){l(i.source)&&i.source>t&&--i.source;const r=i.extensions;l(r)&&l(r.EXT_texture_webp)&&r.EXT_texture_webp.source>t?--i.extensions.EXT_texture_webp.source:l(r)&&l(r.KHR_texture_basisu)&&r.KHR_texture_basisu.source>t&&--i.extensions.KHR_texture_basisu.source})};Oa.mesh=function(e,t){e.meshes.splice(t,1),K.node(e,function(i){l(i.mesh)&&(i.mesh>t?i.mesh--:i.mesh===t&&delete i.mesh)})};Oa.node=function(e,t){e.nodes.splice(t,1),K.skin(e,function(i){l(i.skeleton)&&i.skeleton>t&&i.skeleton--,i.joints=i.joints.map(function(r){return r>t?r-1:r})}),K.animation(e,function(i){K.animationChannel(i,function(r){l(r.target)&&l(r.target.node)&&r.target.node>t&&r.target.node--})}),K.technique(e,function(i){K.techniqueUniform(i,function(r){l(r.node)&&r.node>t&&r.node--})}),K.node(e,function(i){l(i.children)&&(i.children=i.children.filter(function(r){return r!==t}).map(function(r){return r>t?r-1:r}))}),K.scene(e,function(i){i.nodes=i.nodes.filter(function(r){return r!==t}).map(function(r){return r>t?r-1:r})})};Oa.material=function(e,t){e.materials.splice(t,1),K.mesh(e,function(i){K.meshPrimitive(i,function(r){l(r.material)&&r.material>t&&r.material--})})};Oa.sampler=function(e,t){e.samplers.splice(t,1),K.texture(e,function(i){l(i.sampler)&&i.sampler>t&&--i.sampler})};Oa.texture=function(e,t){if(e.textures.splice(t,1),K.material(e,function(i){_N(i,function(r,s){s.index>t&&--s.index})}),Mi(e,"EXT_feature_metadata")){K.mesh(e,function(s){K.meshPrimitive(s,function(o){const a=o.extensions;if(l(a)&&l(a.EXT_feature_metadata)){const u=a.EXT_feature_metadata.featureIdTextures;if(l(u)){const h=u.length;for(let d=0;d<h;++d){const g=u[d].featureIds.texture;g.index>t&&--g.index}}}})});const r=e.extensions.EXT_feature_metadata.featureTextures;for(const s in r)if(r.hasOwnProperty(s)){const a=r[s].properties;if(l(a)){for(const c in a)if(a.hasOwnProperty(c)){const h=a[c].texture;h.index>t&&--h.index}}}}if(Mi(e,"EXT_mesh_features")&&K.mesh(e,function(i){K.meshPrimitive(i,function(r){const s=r.extensions;if(l(s)&&l(s.EXT_mesh_features)){const a=s.EXT_mesh_features.featureIds;if(l(a)){const c=a.length;for(let u=0;u<c;++u){const h=a[u];l(h.texture)&&h.texture.index>t&&--h.texture.index}}}})}),Mi(e,"EXT_structural_metadata")){const r=e.extensions.EXT_structural_metadata.propertyTextures;if(l(r)){const s=r.length;for(let o=0;o<s;++o){const c=r[o].properties;for(const u in c)if(c.hasOwnProperty(u)){const h=c[u];h.index>t&&--h.index}}}}};function Ra(){}Ra.accessor=function(e){const t={};return K.mesh(e,function(n){K.meshPrimitive(n,function(i){K.meshPrimitiveAttribute(i,function(s){t[s]=!0}),K.meshPrimitiveTarget(i,function(s){K.meshPrimitiveTargetAttribute(s,function(o){t[o]=!0})});const r=i.indices;l(r)&&(t[r]=!0)})}),K.skin(e,function(n){l(n.inverseBindMatrices)&&(t[n.inverseBindMatrices]=!0)}),K.animation(e,function(n){K.animationSampler(n,function(i){l(i.input)&&(t[i.input]=!0),l(i.output)&&(t[i.output]=!0)})}),Mi(e,"EXT_mesh_gpu_instancing")&&K.node(e,function(n){l(n.extensions)&&l(n.extensions.EXT_mesh_gpu_instancing)&&Object.keys(n.extensions.EXT_mesh_gpu_instancing.attributes).forEach(function(i){const r=n.extensions.EXT_mesh_gpu_instancing.attributes[i];t[r]=!0})}),Mi(e,"CESIUM_primitive_outline")&&K.mesh(e,function(n){K.meshPrimitive(n,function(i){const r=i.extensions;if(l(r)&&l(r.CESIUM_primitive_outline)){const o=r.CESIUM_primitive_outline.indices;l(o)&&(t[o]=!0)}})}),t};Ra.buffer=function(e){const t={};return K.bufferView(e,function(n){l(n.buffer)&&(t[n.buffer]=!0),l(n.extensions)&&l(n.extensions.EXT_meshopt_compression)&&(t[n.extensions.EXT_meshopt_compression.buffer]=!0)}),t};Ra.bufferView=function(e){const t={};if(K.accessor(e,function(n){l(n.bufferView)&&(t[n.bufferView]=!0)}),K.shader(e,function(n){l(n.bufferView)&&(t[n.bufferView]=!0)}),K.image(e,function(n){l(n.bufferView)&&(t[n.bufferView]=!0)}),Mi(e,"KHR_draco_mesh_compression")&&K.mesh(e,function(n){K.meshPrimitive(n,function(i){l(i.extensions)&&l(i.extensions.KHR_draco_mesh_compression)&&(t[i.extensions.KHR_draco_mesh_compression.bufferView]=!0)})}),Mi(e,"EXT_feature_metadata")){const i=e.extensions.EXT_feature_metadata.featureTables;for(const r in i)if(i.hasOwnProperty(r)){const o=i[r].properties;if(l(o)){for(const a in o)if(o.hasOwnProperty(a)){const c=o[a];l(c.bufferView)&&(t[c.bufferView]=!0),l(c.arrayOffsetBufferView)&&(t[c.arrayOffsetBufferView]=!0),l(c.stringOffsetBufferView)&&(t[c.stringOffsetBufferView]=!0)}}}}if(Mi(e,"EXT_structural_metadata")){const i=e.extensions.EXT_structural_metadata.propertyTables;if(l(i)){const r=i.length;for(let s=0;s<r;++s){const a=i[s].properties;for(const c in a)if(a.hasOwnProperty(c)){const u=a[c];l(u.values)&&(t[u.values]=!0),l(u.arrayOffsets)&&(t[u.arrayOffsets]=!0),l(u.stringOffsets)&&(t[u.stringOffsets]=!0)}}}}return t};Ra.image=function(e){const t={};return K.texture(e,function(n){l(n.source)&&(t[n.source]=!0),l(n.extensions)&&l(n.extensions.EXT_texture_webp)?t[n.extensions.EXT_texture_webp.source]=!0:l(n.extensions)&&l(n.extensions.KHR_texture_basisu)&&(t[n.extensions.KHR_texture_basisu.source]=!0)}),t};Ra.mesh=function(e){const t={};return K.node(e,function(n){if(l(n.mesh&&l(e.meshes))){const i=e.meshes[n.mesh];l(i)&&l(i.primitives)&&i.primitives.length>0&&(t[n.mesh]=!0)}}),t};function yN(e,t,n){const i=e.nodes[t];return l(i.mesh)||l(i.camera)||l(i.skin)||l(i.weights)||l(i.extras)||l(i.extensions)&&Object.keys(i.extensions).length!==0||l(n[t])?!1:!l(i.children)||i.children.filter(function(r){return!yN(e,r,n)}).length===0}Ra.node=function(e){const t={};return K.skin(e,function(n){l(n.skeleton)&&(t[n.skeleton]=!0),K.skinJoint(n,function(i){t[i]=!0})}),K.animation(e,function(n){K.animationChannel(n,function(i){l(i.target)&&l(i.target.node)&&(t[i.target.node]=!0)})}),K.technique(e,function(n){K.techniqueUniform(n,function(i){l(i.node)&&(t[i.node]=!0)})}),K.node(e,function(n,i){yN(e,i,t)||(t[i]=!0)}),t};Ra.material=function(e){const t={};return K.mesh(e,function(n){K.meshPrimitive(n,function(i){l(i.material)&&(t[i.material]=!0)})}),t};Ra.texture=function(e){const t={};if(K.material(e,function(n){_N(n,function(i){t[i]=!0})}),Mi(e,"EXT_feature_metadata")){K.mesh(e,function(r){K.meshPrimitive(r,function(s){const o=s.extensions;if(l(o)&&l(o.EXT_feature_metadata)){const c=o.EXT_feature_metadata.featureIdTextures;if(l(c)){const u=c.length;for(let h=0;h<u;++h){const p=c[h].featureIds.texture;t[p.index]=!0}}}})});const i=e.extensions.EXT_feature_metadata.featureTextures;for(const r in i)if(i.hasOwnProperty(r)){const o=i[r].properties;if(l(o)){for(const a in o)if(o.hasOwnProperty(a)){const u=o[a].texture;t[u.index]=!0}}}}if(Mi(e,"EXT_mesh_features")&&K.mesh(e,function(n){K.meshPrimitive(n,function(i){const r=i.extensions;if(l(r)&&l(r.EXT_mesh_features)){const o=r.EXT_mesh_features.featureIds;if(l(o)){const a=o.length;for(let c=0;c<a;++c){const u=o[c];l(u.texture)&&(t[u.texture.index]=!0)}}}})}),Mi(e,"EXT_structural_metadata")){const i=e.extensions.EXT_structural_metadata.propertyTextures;if(l(i)){const r=i.length;for(let s=0;s<r;++s){const a=i[s].properties;for(const c in a)if(a.hasOwnProperty(c)){const u=a[c];t[u.index]=!0}}}}return t};Ra.sampler=function(e){const t={};return K.texture(e,function(n){l(n.sampler)&&(t[n.sampler]=!0)}),t};function yre(e,t){const n={byteLength:t.length,extras:{_pipeline:{source:t}}},r={buffer:Ao(e.buffers,n),byteOffset:0,byteLength:t.length};return Ao(e.bufferViews,r)}function bre(e,t){const n=Nh(e,t),i=q.getSizeInBytes(t.componentType),r=sm(t.type),s=t.count,o=new Array(r*s);if(!l(t.bufferView))return o.fill(0);const a=e.bufferViews[t.bufferView],c=e.buffers[a.buffer].extras._pipeline.source;let u=t.byteOffset+a.byteOffset+c.byteOffset;const h=new DataView(c.buffer),d=new Array(r),p=_w(t.componentType);for(let g=0;g<s;++g){p(h,u,r,i,d);for(let _=0;_<r;++_)o[g*r+_]=d[_];u+=n}return o}function Tre(e){let t;return K.accessorWithSemantic(e,"JOINTS_0",function(n){const i=e.accessors[n];t=i.componentType,t===j.BYTE?_g(e,i,q.UNSIGNED_BYTE):t!==j.UNSIGNED_BYTE&&t!==j.UNSIGNED_SHORT&&_g(e,i,q.UNSIGNED_SHORT)}),K.accessorWithSemantic(e,"WEIGHTS_0",function(n){const i=e.accessors[n];t=i.componentType,t===j.BYTE?_g(e,i,q.UNSIGNED_BYTE):t===j.SHORT&&_g(e,i,q.UNSIGNED_SHORT)}),e}function _g(e,t,n){const i=q.createTypedArray(n,bre(e,t)),r=new Uint8Array(i.buffer);t.bufferView=yre(e,r),t.componentType=n,t.byteOffset=0}function nE(e,t){return mN(e,t),t==="CESIUM_RTC"&&xre(e),iE(e,t)}function xre(e){K.technique(e,function(t){K.techniqueUniform(t,function(n){n.semantic==="CESIUM_RTC_MODELVIEW"&&(n.semantic="MODELVIEW")})})}function iE(e,t){if(Array.isArray(e)){const n=e.length;for(let i=0;i<n;++i)iE(e[i],t)}else if(e!==null&&typeof e=="object"&&e.constructor===Object){const n=e.extensions;let i;l(n)&&(i=n[t],l(i)&&(delete n[t],Object.keys(n).length===0&&delete e.extensions));for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&iE(e[r],t);return i}}const yg={.8:vre,"1.0":Xre,"2.0":void 0};function Ere(e,t){t=T(t,T.EMPTY_OBJECT);const n=t.targetVersion;let i=e.version;e.asset=T(e.asset,{version:"1.0"}),e.asset.version=T(e.asset.version,"1.0"),i=T(i,e.asset.version).toString(),Object.prototype.hasOwnProperty.call(yg,i)||(l(i)&&(i=i.substring(0,3)),Object.prototype.hasOwnProperty.call(yg,i)||(i="1.0"));let r=yg[i];for(;l(r)&&i!==n;)r(e,t),i=e.asset.version,r=yg[i];return t.keepLegacyExtensions||(Zre(e,t),Jre(e)),e}function bN(e){const t=e.materials;for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const i=t[n],r=i.instanceTechnique;l(r)&&(i.technique=r.technique,i.values=r.values,delete i.instanceTechnique)}}function Cre(e){const t=e.meshes;for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const r=t[n].primitives;if(l(r)){const s=r.length;for(let o=0;o<s;++o){const a=r[o],c=T(a.primitive,j.TRIANGLES);a.mode=T(a.mode,c),delete a.primitive}}}}function wre(e){const t=e.nodes,n=new m,i=new re;for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){const s=t[r];if(l(s.rotation)){const a=s.rotation;m.fromArray(a,0,n),re.fromAxisAngle(n,a[3],i),s.rotation=[i.x,i.y,i.z,i.w]}const o=s.instanceSkin;l(o)&&(s.skeletons=o.skeletons,s.skin=o.skin,s.meshes=o.meshes,delete s.instanceSkin)}}function Are(e){const t=e.animations,n=e.accessors,i=e.bufferViews,r=e.buffers,s={},o=new m,a=new re;for(const c in t)if(Object.prototype.hasOwnProperty.call(t,c)){const u=t[c],h=u.channels,d=u.parameters,p=u.samplers;if(l(h)){const g=h.length;for(let _=0;_<g;++_){const b=h[_];if(b.target.path==="rotation"){const x=d[p[b.sampler].output];if(l(s[x]))continue;s[x]=!0;const E=n[x],C=i[E.bufferView],S=r[C.buffer].extras._pipeline.source,v=S.byteOffset+C.byteOffset+E.byteOffset,D=E.componentType,L=E.count,O=sm(E.type),N=E.count*O,B=q.createArrayBufferView(D,S.buffer,v,N);for(let U=0;U<L;U++){const V=U*O;m.unpack(B,V,o);const f=B[V+3];re.fromAxisAngle(o,f,a),re.pack(a,B,V)}}}}}}function Sre(e){const t=e.techniques;for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const i=t[n],r=i.passes;if(l(r)){const s=T(i.pass,"defaultPass");if(Object.prototype.hasOwnProperty.call(r,s)){const o=r[s],a=o.instanceProgram;i.attributes=T(i.attributes,a.attributes),i.program=T(i.program,a.program),i.uniforms=T(i.uniforms,a.uniforms),i.states=T(i.states,o.states)}delete i.passes,delete i.pass}}}function vre(e){l(e.asset)||(e.asset={});const t=e.asset;if(t.version="1.0",typeof t.profile=="string"){const n=t.profile.split(" ");t.profile={api:n[0],version:n[1]}}else t.profile={};if(l(e.version)&&delete e.version,bN(e),Cre(e),wre(e),Are(e),Sre(e),l(e.allExtensions)&&(e.extensionsUsed=e.allExtensions,delete e.allExtensions),l(e.lights)){const n=T(e.extensions,{});e.extensions=n;const i=T(n.KHR_materials_common,{});n.KHR_materials_common=i,i.lights=e.lights,delete e.lights,om(e,"KHR_materials_common")}}function Ire(e){const t=e.animations;for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const i=t[n],r=i.parameters;if(l(r)){const s=i.samplers;for(const o in s)if(Object.prototype.hasOwnProperty.call(s,o)){const a=s[o];a.input=r[a.input],a.output=r[a.output]}delete i.parameters}}}function w1(e,t){const n=[];for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)){const r=e[i];t[i]=n.length,n.push(r),l(r.name)||(r.name=i)}return n}function Ore(e){let t;const n={accessors:{},animations:{},buffers:{},bufferViews:{},cameras:{},images:{},materials:{},meshes:{},nodes:{},programs:{},samplers:{},scenes:{},shaders:{},skins:{},textures:{},techniques:{}};let i;const r={},s=e.nodes;for(const o in s)Object.prototype.hasOwnProperty.call(s,o)&&(i=s[o].jointName,l(i)&&(r[i]=o));for(const o in e)if(Object.prototype.hasOwnProperty.call(e,o)&&l(n[o])){const a={},c=e[o];e[o]=w1(c,a),n[o]=a}for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(r[i]=n.nodes[r[i]]);l(e.scene)&&(e.scene=n.scenes[e.scene]),K.bufferView(e,function(o){l(o.buffer)&&(o.buffer=n.buffers[o.buffer])}),K.accessor(e,function(o){l(o.bufferView)&&(o.bufferView=n.bufferViews[o.bufferView])}),K.shader(e,function(o){const a=o.extensions;if(l(a)){const c=a.KHR_binary_glTF;l(c)&&(o.bufferView=n.bufferViews[c.bufferView],delete a.KHR_binary_glTF),Object.keys(a).length===0&&delete o.extensions}}),K.program(e,function(o){l(o.vertexShader)&&(o.vertexShader=n.shaders[o.vertexShader]),l(o.fragmentShader)&&(o.fragmentShader=n.shaders[o.fragmentShader])}),K.technique(e,function(o){l(o.program)&&(o.program=n.programs[o.program]),K.techniqueParameter(o,function(a){l(a.node)&&(a.node=n.nodes[a.node]);const c=a.value;typeof c=="string"&&(a.value={index:n.textures[c]})})}),K.mesh(e,function(o){K.meshPrimitive(o,function(a){l(a.indices)&&(a.indices=n.accessors[a.indices]),K.meshPrimitiveAttribute(a,function(c,u){a.attributes[u]=n.accessors[c]}),l(a.material)&&(a.material=n.materials[a.material])})}),K.node(e,function(o){let a=o.children;if(l(a)){const c=a.length;for(t=0;t<c;++t)a[t]=n.nodes[a[t]]}if(l(o.meshes)){const c=o.meshes,u=c.length;if(u>0)for(o.mesh=n.meshes[c[0]],t=1;t<u;++t){const h={mesh:n.meshes[c[t]]},d=Ao(e.nodes,h);l(a)||(a=[],o.children=a),a.push(d)}delete o.meshes}if(l(o.camera)&&(o.camera=n.cameras[o.camera]),l(o.skin)&&(o.skin=n.skins[o.skin]),l(o.skeletons)){const c=o.skeletons;if(c.length>0&&l(o.skin)){const h=e.skins[o.skin];h.skeleton=n.nodes[c[0]]}delete o.skeletons}l(o.jointName)&&delete o.jointName}),K.skin(e,function(o){l(o.inverseBindMatrices)&&(o.inverseBindMatrices=n.accessors[o.inverseBindMatrices]);const a=o.jointNames;if(l(a)){const c=[],u=a.length;for(t=0;t<u;++t)c[t]=r[a[t]];o.joints=c,delete o.jointNames}}),K.scene(e,function(o){const a=o.nodes;if(l(a)){const c=a.length;for(t=0;t<c;++t)a[t]=n.nodes[a[t]]}}),K.animation(e,function(o){const a={};o.samplers=w1(o.samplers,a),K.animationSampler(o,function(c){c.input=n.accessors[c.input],c.output=n.accessors[c.output]}),K.animationChannel(o,function(c){c.sampler=a[c.sampler];const u=c.target;l(u)&&(u.node=n.nodes[u.id],delete u.id)})}),K.material(e,function(o){l(o.technique)&&(o.technique=n.techniques[o.technique]),K.materialValue(o,function(c,u){typeof c=="string"&&(o.values[u]={index:n.textures[c]})});const a=o.extensions;if(l(a)){const c=a.KHR_materials_common;l(c)&&l(c.values)&&K.materialValue(c,function(u,h){typeof u=="string"&&(c.values[h]={index:n.textures[u]})})}}),K.image(e,function(o){const a=o.extensions;if(l(a)){const c=a.KHR_binary_glTF;l(c)&&(o.bufferView=n.bufferViews[c.bufferView],o.mimeType=c.mimeType,delete a.KHR_binary_glTF),Object.keys(a).length===0&&delete o.extensions}}),K.texture(e,function(o){l(o.sampler)&&(o.sampler=n.samplers[o.sampler]),l(o.source)&&(o.source=n.images[o.source])})}function Rre(e){K.animation(e,function(t){K.animationSampler(t,function(n){delete n.name})})}function Dre(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const n=e[t];Array.isArray(n)&&n.length===0&&delete e[t]}K.node(e,function(t){l(t.children)&&t.children.length===0&&delete t.children})}function Mre(e){const t=e.asset;delete t.profile,delete t.premultipliedAlpha}const Lre={CESIUM_RTC:!0,KHR_materials_common:!0,WEB3D_quantized_attributes:!0};function Pre(e){const t=e.extensionsUsed;if(e.extensionsRequired=T(e.extensionsRequired,[]),l(t)){const n=t.length;for(let i=0;i<n;++i){const r=t[i];l(Lre[r])&&e.extensionsRequired.push(r)}}}function Nre(e){K.buffer(e,function(t){delete t.type})}function Fre(e){K.texture(e,function(t){delete t.format,delete t.internalFormat,delete t.target,delete t.type})}function Bre(e){K.mesh(e,function(t){K.meshPrimitive(t,function(n){K.meshPrimitiveAttribute(n,function(i,r){r==="TEXCOORD"?n.attributes.TEXCOORD_0=i:r==="COLOR"&&(n.attributes.COLOR_0=i)}),delete n.attributes.TEXCOORD,delete n.attributes.COLOR})}),K.technique(e,function(t){K.techniqueParameter(t,function(n){const i=n.semantic;l(i)&&(i==="TEXCOORD"?n.semantic="TEXCOORD_0":i==="COLOR"&&(n.semantic="COLOR_0"))})})}const zre={POSITION:!0,NORMAL:!0,TANGENT:!0},Ure={COLOR:"COLOR",JOINT:"JOINTS",JOINTS:"JOINTS",TEXCOORD:"TEXCOORD",WEIGHT:"WEIGHTS",WEIGHTS:"WEIGHTS"};function kre(e){const t={};K.mesh(e,function(n){K.meshPrimitive(n,function(i){K.meshPrimitiveAttribute(i,function(r,s){if(s.charAt(0)!=="_"){const o=s.search(/_[0-9]+/g);let a=s,c="_0";o>=0&&(a=s.substring(0,o),c=s.substring(o));let u;const h=Ure[a];l(h)?(u=h+c,t[s]=u):l(zre[a])||(u=`_${s}`,t[s]=u)}});for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){const s=t[r],o=i.attributes[r];l(o)&&(delete i.attributes[r],i.attributes[s]=o)}})}),K.technique(e,function(n){K.techniqueParameter(n,function(i){const r=t[i.semantic];l(r)&&(i.semantic=r)})})}function jre(e){K.camera(e,function(t){const n=t.perspective;if(l(n)){const i=n.aspectRatio;l(i)&&i===0&&delete n.aspectRatio;const r=n.yfov;l(r)&&r===0&&(n.yfov=1)}})}function rE(e,t){return l(t.byteStride)&&t.byteStride!==0?t.byteStride:Nh(e,t)}function Vre(e){K.buffer(e,function(t){l(t.byteLength)||(t.byteLength=t.extras._pipeline.source.length)}),K.accessor(e,function(t){const n=t.bufferView;if(l(n)){const i=e.bufferViews[n],r=rE(e,t),s=t.byteOffset+t.count*r;i.byteLength=Math.max(T(i.byteLength,0),s)}})}function Gre(e){let t,n,i;const r=e.bufferViews,s={};K.accessorContainingVertexAttributeData(e,function(a){const c=e.accessors[a];l(c.bufferView)&&(s[c.bufferView]=!0)});const o={};K.accessor(e,function(a){l(a.bufferView)&&(o[a.bufferView]=T(o[a.bufferView],[]),o[a.bufferView].push(a))});for(const a in o)if(Object.prototype.hasOwnProperty.call(o,a)){i=r[a];const c=o[a];c.sort(function(p,g){return p.byteOffset-g.byteOffset});let u=0,h=0;const d=c.length;for(t=0;t<d;++t){let p=c[t];const g=rE(e,p),_=p.byteOffset,b=p.count*g;delete p.byteStride;const x=t<d-1,E=x?rE(e,c[t+1]):void 0;if(g!==E){const C=Se(i,!0);s[a]&&(C.byteStride=g),C.byteOffset+=u,C.byteLength=_+b-u;const w=Ao(r,C);for(n=h;n<=t;++n)p=c[n],p.bufferView=w,p.byteOffset=p.byteOffset-u;u=x?c[t+1].byteOffset:void 0,h=t+1}}}mre(e,["accessor","bufferView","buffer"])}function Hre(e){K.accessorWithSemantic(e,"POSITION",function(t){const n=e.accessors[t];if(!l(n.min)||!l(n.max)){const i=yw(e,n);n.min=i.min,n.max=i.max}})}function TN(e){return(!l(e.children)||e.children.length===0)&&(!l(e.meshes)||e.meshes.length===0)&&!l(e.camera)&&!l(e.skin)&&!l(e.skeletons)&&!l(e.jointName)&&(!l(e.translation)||m.fromArray(e.translation).equals(m.ZERO))&&(!l(e.scale)||m.fromArray(e.scale).equals(new m(1,1,1)))&&(!l(e.rotation)||Y.fromArray(e.rotation).equals(new Y(0,0,0,1)))&&(!l(e.matrix)||P.fromColumnMajorArray(e.matrix).equals(P.IDENTITY))&&!l(e.extensions)&&!l(e.extras)}function xN(e,t){K.scene(e,function(n){const i=n.nodes;if(l(i)){const r=i.length;for(let s=r;s>=0;--s)if(i[s]===t){i.splice(s,1);return}}}),K.node(e,function(n,i){if(l(n.children)){const r=n.children.indexOf(t);r>-1&&(n.children.splice(r,1),TN(n)&&xN(e,i))}}),delete e.nodes[t]}function qre(e){return K.node(e,function(t,n){TN(t)&&xN(e,n)}),e}function Wre(e){K.animation(e,function(t){K.animationSampler(t,function(n){const i=e.accessors[n.input];if(!l(i.min)||!l(i.max)){const r=yw(e,i);i.min=r.min,i.max=r.max}})})}function $re(e){K.accessor(e,function(t){if(l(t.min)||l(t.max)){const n=yw(e,t);l(t.min)&&(t.min=n.min),l(t.max)&&(t.max=n.max)}})}function Xre(e){e.asset=T(e.asset,{}),e.asset.version="2.0",bN(e),Ire(e),qre(e),Ore(e),Rre(e),Mre(e),Pre(e),Vre(e),Gre(e),Hre(e),Wre(e),$re(e),Nre(e),Fre(e),Bre(e),kre(e),Tre(e),jre(e),hre(e),pre(e),Dre(e)}const Yre=["u_tex","u_diffuse","u_emission","u_diffuse_tex"],Kre=["u_diffuse","u_diffuse_mat"];function sE(e){e.pbrMetallicRoughness=l(e.pbrMetallicRoughness)?e.pbrMetallicRoughness:{},e.pbrMetallicRoughness.roughnessFactor=1,e.pbrMetallicRoughness.metallicFactor=0}function bw(e){return l(e.index)}function Tw(e){return Array.isArray(e)&&e.length===4}function EN(e){const t=new Array(4);t[3]=e[3];for(let n=0;n<3;n++){const i=e[n];i<=.04045?t[n]=e[n]*.07739938080495357:t[n]=Math.pow((i+.055)*.9478672985781991,2.4)}return t}function Zre(e,t){t=T(t,T.EMPTY_OBJECT);const n=T(t.baseColorTextureNames,Yre),i=T(t.baseColorFactorNames,Kre);K.material(e,function(r){K.materialValue(r,function(s,o){n.indexOf(o)!==-1&&bw(s)?(sE(r),r.pbrMetallicRoughness.baseColorTexture=s):i.indexOf(o)!==-1&&Tw(s)&&(sE(r),r.pbrMetallicRoughness.baseColorFactor=EN(s))})}),nE(e,"KHR_techniques_webgl"),nE(e,"KHR_blend")}function Z0(e,t){l(t)&&(Tw(t)?e.pbrMetallicRoughness.baseColorFactor=EN(t):bw(t)&&(e.pbrMetallicRoughness.baseColorTexture=t))}function A1(e,t){l(t)&&(Tw(t)?e.emissiveFactor=t.slice(0,3):bw(t)&&(e.emissiveTexture=t))}function Jre(e){K.material(e,function(t){const n=T(t.extensions,T.EMPTY_OBJECT).KHR_materials_common;if(!l(n))return;const i=T(n.values,{}),r=i.ambient,s=i.diffuse,o=i.emission,a=i.transparency,c=n.doubleSided,u=n.transparent;sE(t),n.technique==="CONSTANT"?(om(e,"KHR_materials_unlit"),t.extensions=l(t.extensions)?t.extensions:{},t.extensions.KHR_materials_unlit={},Z0(t,o),Z0(t,r)):(Z0(t,s),A1(t,r),A1(t,o)),l(c)&&(t.doubleSided=c),l(a)&&(l(t.pbrMetallicRoughness.baseColorFactor)?t.pbrMetallicRoughness.baseColorFactor[3]*=a:t.pbrMetallicRoughness.baseColorFactor=[1,1,1,a]),l(u)&&(t.alphaMode=u?"BLEND":"OPAQUE")}),nE(e,"KHR_materials_common")}const _t={POSITION:"POSITION",NORMAL:"NORMAL",TANGENT:"TANGENT",TEXCOORD:"TEXCOORD",COLOR:"COLOR",JOINTS:"JOINTS",WEIGHTS:"WEIGHTS",FEATURE_ID:"_FEATURE_ID"};function Qre(e){switch(e){case _t.POSITION:return"positionMC";case _t.NORMAL:return"normalMC";case _t.TANGENT:return"tangentMC";case _t.TEXCOORD:return"texCoord";case _t.COLOR:return"color";case _t.JOINTS:return"joints";case _t.WEIGHTS:return"weights";case _t.FEATURE_ID:return"featureId";default:throw new A("semantic is not a valid value.")}}_t.hasSetIndex=function(e){switch(y.typeOf.string("semantic",e),e){case _t.POSITION:case _t.NORMAL:case _t.TANGENT:return!1;case _t.TEXCOORD:case _t.COLOR:case _t.JOINTS:case _t.WEIGHTS:case _t.FEATURE_ID:return!0;default:throw new A("semantic is not a valid value.")}};_t.fromGltfSemantic=function(e){y.typeOf.string("gltfSemantic",e);let t=e;const i=/^(\w+)_\d+$/.exec(e);switch(i!==null&&(t=i[1]),t){case"POSITION":return _t.POSITION;case"NORMAL":return _t.NORMAL;case"TANGENT":return _t.TANGENT;case"TEXCOORD":return _t.TEXCOORD;case"COLOR":return _t.COLOR;case"JOINTS":return _t.JOINTS;case"WEIGHTS":return _t.WEIGHTS;case"_FEATURE_ID":return _t.FEATURE_ID}};_t.fromPntsSemantic=function(e){switch(y.typeOf.string("pntsSemantic",e),e){case"POSITION":case"POSITION_QUANTIZED":return _t.POSITION;case"RGBA":case"RGB":case"RGB565":return _t.COLOR;case"NORMAL":case"NORMAL_OCT16P":return _t.NORMAL;case"BATCH_ID":return _t.FEATURE_ID;default:throw new A("pntsSemantic is not a valid value.")}};_t.getGlslType=function(e){switch(y.typeOf.string("semantic",e),e){case _t.POSITION:case _t.NORMAL:case _t.TANGENT:return"vec3";case _t.TEXCOORD:return"vec2";case _t.COLOR:return"vec4";case _t.JOINTS:return"ivec4";case _t.WEIGHTS:return"vec4";case _t.FEATURE_ID:return"int";default:throw new A("semantic is not a valid value.")}};_t.getVariableName=function(e,t){y.typeOf.string("semantic",e);let n=Qre(e);return l(t)&&(n+=`_${t}`),n};const Me=Object.freeze(_t);function je(){}je.getError=function(e,t,n){let i=`Failed to load ${e}: ${t}`;l(n)&&l(n.message)&&(i+=`
${n.message}`);const r=new te(i);return l(n)&&(r.stack=`Original stack:
${n.stack}
Handler stack:
${r.stack}`),r};je.getNodeTransform=function(e){return l(e.matrix)?e.matrix:P.fromTranslationQuaternionRotationScale(l(e.translation)?e.translation:m.ZERO,l(e.rotation)?e.rotation:re.IDENTITY,l(e.scale)?e.scale:m.ONE)};je.getAttributeBySemantic=function(e,t,n){const i=e.attributes,r=i.length;for(let s=0;s<r;++s){const o=i[s],a=l(n)?o.setIndex===n:!0;if(o.semantic===t&&a)return o}};je.getAttributeByName=function(e,t){const n=e.attributes,i=n.length;for(let r=0;r<i;++r){const s=n[r];if(s.name===t)return s}};je.getFeatureIdsByLabel=function(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(i.positionalLabel===t||i.label===t)return i}};je.hasQuantizedAttributes=function(e){if(!l(e))return!1;for(let t=0;t<e.length;t++){const n=e[t];if(l(n.quantization))return!0}return!1};je.getAttributeInfo=function(e){const t=e.semantic,n=e.setIndex;let i,r=!1;l(t)?(i=Me.getVariableName(t,n),r=!0):(i=e.name,i=i.replace(/^_/,""),i=i.toLowerCase());const s=/^color_\d+$/.test(i),o=e.type;let a=tt.getGlslType(o);s&&(a="vec4");const c=l(e.quantization);let u;return c&&(u=s?"vec4":tt.getGlslType(e.quantization.type)),{attribute:e,isQuantized:c,variableName:i,hasSemantic:r,glslType:a,quantizedGlslType:u}};const ese=new m,tse=new m;je.getPositionMinMax=function(e,t,n){const i=je.getAttributeBySemantic(e,"POSITION");let r=i.max,s=i.min;return l(n)&&l(t)&&(s=m.add(s,t,tse),r=m.add(r,n,ese)),{min:s,max:r}};je.getAxisCorrectionMatrix=function(e,t,n){return n=P.clone(P.IDENTITY,n),e===ir.Y?n=P.clone(ir.Y_UP_TO_Z_UP,n):e===ir.X&&(n=P.clone(ir.X_UP_TO_Z_UP,n)),t===ir.Z&&(n=P.multiplyTransformation(n,ir.Z_UP_TO_X_UP,n)),n};const nse=new H;je.getCullFace=function(e,t){if(!Fe.isTriangles(t))return wo.BACK;const n=P.getMatrix3(e,nse);return H.determinant(n)<0?wo.FRONT:wo.BACK};je.sanitizeGlslIdentifier=function(e){let t=e.replaceAll(/[^A-Za-z0-9]+/g,"_");return t=t.replace(/^gl_/,""),/^\d/.test(t)&&(t=`_${t}`),t};je.supportedExtensions={AGI_articulations:!0,CESIUM_primitive_outline:!0,CESIUM_RTC:!0,EXT_feature_metadata:!0,EXT_instance_features:!0,EXT_mesh_features:!0,EXT_mesh_gpu_instancing:!0,EXT_meshopt_compression:!0,EXT_structural_metadata:!0,EXT_texture_webp:!0,KHR_blend:!0,KHR_draco_mesh_compression:!0,KHR_techniques_webgl:!0,KHR_materials_common:!0,KHR_materials_pbrSpecularGlossiness:!0,KHR_materials_specular:!0,KHR_materials_anisotropy:!0,KHR_materials_clearcoat:!0,KHR_materials_unlit:!0,KHR_mesh_quantization:!0,KHR_texture_basisu:!0,KHR_texture_transform:!0,WEB3D_quantized_attributes:!0};je.checkSupportedExtensions=function(e){const t=e.length;for(let n=0;n<t;n++){const i=e[n];if(!je.supportedExtensions[i])throw new te(`Unsupported glTF Extension: ${i}`)}};function Za(e){e=T(e,T.EMPTY_OBJECT);const t=e.resourceCache,n=e.gltfResource,i=e.baseResource,r=e.typedArray,s=e.gltfJson,o=e.cacheKey;y.typeOf.func("options.resourceCache",t),y.typeOf.object("options.gltfResource",n),y.typeOf.object("options.baseResource",i),this._resourceCache=t,this._gltfResource=n,this._baseResource=i,this._typedArray=r,this._gltfJson=s,this._cacheKey=o,this._gltf=void 0,this._bufferLoaders=[],this._state=Oe.UNLOADED,this._promise=void 0}l(Object.create)&&(Za.prototype=Object.create(ai.prototype),Za.prototype.constructor=Za);Object.defineProperties(Za.prototype,{cacheKey:{get:function(){return this._cacheKey}},gltf:{get:function(){return this._gltf}}});Za.prototype.load=async function(){return l(this._promise)?this._promise:(this._state=Oe.LOADING,l(this._gltfJson)?(this._promise=CN(this,this._gltfJson),this._promise):l(this._typedArray)?(this._promise=wN(this,this._typedArray),this._promise):(this._promise=ise(this),this._promise))};async function ise(e){let t;try{const n=await e._fetchGltf();if(e.isDestroyed())return;t=new Uint8Array(n)}catch(n){if(e.isDestroyed())return;xw(e,n)}return wN(e,t)}function xw(e,t){e.unload(),e._state=Oe.FAILED;const n=`Failed to load glTF: ${e._gltfResource.url}`;throw e.getError(n,t)}async function rse(e,t){if(l(t.asset)&&t.asset.version==="2.0"&&!Mi(t,"KHR_techniques_webgl")&&!Mi(t,"KHR_materials_common"))return Promise.resolve();const n=[];K.buffer(t,function(i){if(!l(i.extras._pipeline.source)&&l(i.uri)){const r=e._baseResource.getDerivedResource({url:i.uri}),o=e._resourceCache.getExternalBufferLoader({resource:r});e._bufferLoaders.push(o),n.push(o.load().then(function(){o.isDestroyed()||(i.extras._pipeline.source=o.typedArray)}))}}),await Promise.all(n),Ere(t)}function sse(e){const t=[];return K.buffer(e,function(n){const i=n.uri;!l(n.extras._pipeline.source)&&l(i)&&RC(i)&&(delete n.uri,t.push(se.fetchArrayBuffer(i).then(function(r){n.extras._pipeline.source=new Uint8Array(r)})))}),Promise.all(t)}function ose(e,t){const n=[];return K.buffer(t,function(i,r){const s=i.extras._pipeline.source;if(l(s)&&!l(i.uri)){const a=e._resourceCache.getEmbeddedBufferLoader({parentResource:e._gltfResource,bufferId:r,typedArray:s});e._bufferLoaders.push(a),n.push(a.load())}}),Promise.all(n)}async function CN(e,t){try{gw(t),await sse(t),await rse(e,t),ere(t),await ose(e,t),are(t);const n=t.asset.version;if(n!=="1.0"&&n!=="2.0")throw new te(`Unsupported glTF version: ${n}`);const i=t.extensionsRequired;return l(i)&&je.checkSupportedExtensions(i),e._gltf=t,e._state=Oe.READY,e}catch(n){if(e.isDestroyed())return;xw(e,n)}}async function wN(e,t){let n;try{$y(t)==="glTF"?n=rre(t):n=Cs(t)}catch(i){if(e.isDestroyed())return;xw(e,i)}return CN(e,n)}Za.prototype.unload=function(){const e=this._bufferLoaders,t=e.length;for(let n=0;n<t;++n)e[n]=!e[n].isDestroyed()&&this._resourceCache.unload(e[n]);this._bufferLoaders.length=0,this._gltf=void 0};Za.prototype._fetchGltf=function(){return this._gltfResource.fetchArrayBuffer()};const ase={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"},Q_=Object.freeze(ase),Be={};function cse(){this.octEncoded=!1,this.octEncodedZXY=!1,this.normalizationRange=void 0,this.quantizedVolumeOffset=void 0,this.quantizedVolumeDimensions=void 0,this.quantizedVolumeStepSize=void 0,this.componentDatatype=void 0,this.type=void 0}function lse(){this.name=void 0,this.semantic=void 0,this.setIndex=void 0,this.componentDatatype=void 0,this.type=void 0,this.normalized=!1,this.count=void 0,this.min=void 0,this.max=void 0,this.constant=void 0,this.quantization=void 0,this.typedArray=void 0,this.buffer=void 0,this.byteOffset=0,this.byteStride=void 0}function use(){this.indexDatatype=void 0,this.count=void 0,this.buffer=void 0,this.typedArray=void 0}function fse(){this.featureCount=void 0,this.nullFeatureId=void 0,this.propertyTableId=void 0,this.setIndex=void 0,this.label=void 0,this.positionalLabel=void 0}function hse(){this.featureCount=void 0,this.nullFeatureId=void 0,this.propertyTableId=void 0,this.offset=0,this.repeat=void 0,this.label=void 0,this.positionalLabel=void 0}function dse(){this.featureCount=void 0,this.nullFeatureId=void 0,this.propertyTableId=void 0,this.textureReader=void 0,this.label=void 0,this.positionalLabel=void 0}function pse(){this.attributes=[]}function mse(){this.attributes=[],this.morphTargets=[],this.indices=void 0,this.material=void 0,this.primitiveType=void 0,this.featureIds=[],this.propertyTextureIds=[],this.propertyAttributeIds=[],this.outlineCoordinates=void 0}function gse(){this.attributes=[],this.featureIds=[],this.transformInWorldSpace=!1}function _se(){this.index=void 0,this.joints=[],this.inverseBindMatrices=[]}function yse(){this.name=void 0,this.index=void 0,this.children=[],this.primitives=[],this.instances=void 0,this.skin=void 0,this.matrix=void 0,this.translation=void 0,this.rotation=void 0,this.scale=void 0,this.morphWeights=[],this.articulationName=void 0}function bse(){this.nodes=[]}const Tse={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};function xse(){this.input=[],this.interpolation=void 0,this.output=[]}function Ese(){this.node=void 0,this.path=void 0}function Cse(){this.sampler=void 0,this.target=void 0}function wse(){this.name=void 0,this.samplers=[],this.channels=[]}function Ase(){this.name=void 0,this.type=void 0,this.minimumValue=void 0,this.maximumValue=void 0,this.initialValue=void 0}function Sse(){this.name=void 0,this.stages=[]}function AN(){this.credits=[]}function vse(){this.asset=new AN,this.scene=void 0,this.nodes=[],this.skins=[],this.animations=[],this.articulations=[],this.structuralMetadata=void 0,this.upAxis=void 0,this.forwardAxis=void 0,this.transform=P.clone(P.IDENTITY)}function Ise(){this.texture=void 0,this.index=void 0,this.texCoord=0,this.transform=H.clone(H.IDENTITY),this.scale=1,this.channels=void 0}function al(){this.baseColorTexture=void 0,this.metallicRoughnessTexture=void 0,this.baseColorFactor=Y.clone(al.DEFAULT_BASE_COLOR_FACTOR),this.metallicFactor=al.DEFAULT_METALLIC_FACTOR,this.roughnessFactor=al.DEFAULT_ROUGHNESS_FACTOR}al.DEFAULT_BASE_COLOR_FACTOR=Y.ONE;al.DEFAULT_METALLIC_FACTOR=1;al.DEFAULT_ROUGHNESS_FACTOR=1;function Tu(){this.diffuseTexture=void 0,this.specularGlossinessTexture=void 0,this.diffuseFactor=Y.clone(Tu.DEFAULT_DIFFUSE_FACTOR),this.specularFactor=m.clone(Tu.DEFAULT_SPECULAR_FACTOR),this.glossinessFactor=Tu.DEFAULT_GLOSSINESS_FACTOR}Tu.DEFAULT_DIFFUSE_FACTOR=Y.ONE;Tu.DEFAULT_SPECULAR_FACTOR=m.ONE;Tu.DEFAULT_GLOSSINESS_FACTOR=1;function Rp(){this.specularFactor=Rp.DEFAULT_SPECULAR_FACTOR,this.specularTexture=void 0,this.specularColorFactor=m.clone(Rp.DEFAULT_SPECULAR_COLOR_FACTOR),this.specularColorTexture=void 0}Rp.DEFAULT_SPECULAR_FACTOR=1;Rp.DEFAULT_SPECULAR_COLOR_FACTOR=m.ONE;function Dp(){this.anisotropyStrength=Dp.DEFAULT_ANISOTROPY_STRENGTH,this.anisotropyRotation=Dp.DEFAULT_ANISOTROPY_ROTATION,this.anisotropyTexture=void 0}Dp.DEFAULT_ANISOTROPY_STRENGTH=0;Dp.DEFAULT_ANISOTROPY_ROTATION=0;function Mp(){this.clearcoatFactor=Mp.DEFAULT_CLEARCOAT_FACTOR,this.clearcoatTexture=void 0,this.clearcoatRoughnessFactor=Mp.DEFAULT_CLEARCOAT_ROUGHNESS_FACTOR,this.clearcoatRoughnessTexture=void 0,this.clearcoatNormalTexture=void 0}Mp.DEFAULT_CLEARCOAT_FACTOR=0;Mp.DEFAULT_CLEARCOAT_ROUGHNESS_FACTOR=0;function Ew(){this.metallicRoughness=new al,this.specularGlossiness=void 0,this.specular=void 0,this.anisotropy=void 0,this.clearcoat=void 0,this.emissiveTexture=void 0,this.normalTexture=void 0,this.occlusionTexture=void 0,this.emissiveFactor=m.clone(Ew.DEFAULT_EMISSIVE_FACTOR),this.alphaMode=Q_.OPAQUE,this.alphaCutoff=.5,this.doubleSided=!1,this.unlit=!1}Ew.DEFAULT_EMISSIVE_FACTOR=m.ZERO;Be.Quantization=cse;Be.Attribute=lse;Be.Indices=use;Be.FeatureIdAttribute=fse;Be.FeatureIdTexture=dse;Be.FeatureIdImplicitRange=hse;Be.MorphTarget=pse;Be.Primitive=mse;Be.Instances=gse;Be.Skin=_se;Be.Node=yse;Be.Scene=bse;Be.AnimatedPropertyType=Object.freeze(Tse);Be.AnimationSampler=xse;Be.AnimationTarget=Ese;Be.AnimationChannel=Cse;Be.Animation=wse;Be.ArticulationStage=Ase;Be.Articulation=Sse;Be.Asset=AN;Be.Components=vse;Be.TextureReader=Ise;Be.MetallicRoughness=al;Be.SpecularGlossiness=Tu;Be.Specular=Rp;Be.Anisotropy=Dp;Be.Clearcoat=Mp;Be.Material=Ew;const Ta={};Ta.getImageIdFromTexture=function(e){e=T(e,T.EMPTY_OBJECT);const{gltf:t,textureId:n,supportedImageFormats:i}=e;y.typeOf.object("options.gltf",t),y.typeOf.number("options.textureId",n),y.typeOf.object("options.supportedImageFormats",i);const r=t.textures[n],s=r.extensions;if(l(s)){if(i.webp&&l(s.EXT_texture_webp))return s.EXT_texture_webp.source;if(i.basis&&l(s.KHR_texture_basisu))return s.KHR_texture_basisu.source}return r.source};Ta.createSampler=function(e){e=T(e,T.EMPTY_OBJECT);const{gltf:t,textureInfo:n,compressedTextureNoMipmap:i=!1}=e;y.typeOf.object("options.gltf",t),y.typeOf.object("options.textureInfo",n);let r=ii.REPEAT,s=ii.REPEAT,o=Ut.LINEAR,a=ws.LINEAR;const c=n.index,h=t.textures[c].sampler;if(l(h)){const d=t.samplers[h];r=T(d.wrapS,r),s=T(d.wrapT,s),o=T(d.minFilter,o),a=T(d.magFilter,a)}return i&&o!==Ut.LINEAR&&o!==Ut.NEAREST&&(o===Ut.NEAREST_MIPMAP_NEAREST||o===Ut.NEAREST_MIPMAP_LINEAR?o=Ut.NEAREST:o=Ut.LINEAR),new Cn({wrapS:r,wrapT:s,minificationFilter:o,magnificationFilter:a})};const Ose=new k(1,1);Ta.createModelTextureReader=function(e){var c;e=T(e,T.EMPTY_OBJECT);const{textureInfo:t,channels:n,texture:i}=e;y.typeOf.object("options.textureInfo",t);let r=T(t.texCoord,0),s;const o=(c=t.extensions)==null?void 0:c.KHR_texture_transform;if(l(o)){r=T(o.texCoord,r);const u=l(o.offset)?k.unpack(o.offset):k.ZERO;let h=T(o.rotation,0);const d=l(o.scale)?k.unpack(o.scale):Ose;h=-h,s=new H(Math.cos(h)*d.x,-Math.sin(h)*d.y,u.x,Math.sin(h)*d.x,Math.cos(h)*d.y,u.y,0,0,1)}const a=new Be.TextureReader;return a.index=t.index,a.texture=i,a.texCoord=r,a.scale=t.scale,a.transform=s,a.channels=n,a};function Ja(e){e=T(e,T.EMPTY_OBJECT);const t=e.resourceCache,n=e.gltf,i=e.textureInfo,r=e.gltfResource,s=e.baseResource,o=e.supportedImageFormats,a=e.cacheKey,c=T(e.asynchronous,!0);y.typeOf.func("options.resourceCache",t),y.typeOf.object("options.gltf",n),y.typeOf.object("options.textureInfo",i),y.typeOf.object("options.gltfResource",r),y.typeOf.object("options.baseResource",s),y.typeOf.object("options.supportedImageFormats",o);const u=i.index,h=Ta.getImageIdFromTexture({gltf:n,textureId:u,supportedImageFormats:o});this._resourceCache=t,this._gltf=n,this._textureInfo=i,this._imageId=h,this._gltfResource=r,this._baseResource=s,this._cacheKey=a,this._asynchronous=c,this._imageLoader=void 0,this._image=void 0,this._mipLevels=void 0,this._texture=void 0,this._state=Oe.UNLOADED,this._promise=void 0}l(Object.create)&&(Ja.prototype=Object.create(ai.prototype),Ja.prototype.constructor=Ja);Object.defineProperties(Ja.prototype,{cacheKey:{get:function(){return this._cacheKey}},texture:{get:function(){return this._texture}}});const Rse=new Cw;async function Dse(e){const t=e._resourceCache;try{const n=t.getImageLoader({gltf:e._gltf,imageId:e._imageId,gltfResource:e._gltfResource,baseResource:e._baseResource});return e._imageLoader=n,await n.load(),e.isDestroyed()?void 0:(e._image=n.image,e._mipLevels=n.mipLevels,e._state=Oe.LOADED,e)}catch(n){if(e.isDestroyed())return;throw e.unload(),e._state=Oe.FAILED,e.getError("Failed to load texture",n)}}Ja.prototype.load=async function(){return l(this._promise)?this._promise:(this._state=Oe.LOADING,this._promise=Dse(this),this._promise)};function Cw(){this.gltf=void 0,this.textureInfo=void 0,this.image=void 0,this.context=void 0,this.texture=void 0}Cw.prototype.set=function(e,t,n,i,r){this.gltf=e,this.textureInfo=t,this.image=n,this.mipLevels=i,this.context=r};Cw.prototype.execute=function(){this.texture=SN(this.gltf,this.textureInfo,this.image,this.mipLevels,this.context)};function SN(e,t,n,i,r){const s=n.internalFormat;let o=!1;Le.isCompressedFormat(s)&&!l(i)&&(o=!0);const a=Ta.createSampler({gltf:e,textureInfo:t,compressedTextureNoMipmap:o}),c=a.minificationFilter,u=a.wrapS,h=a.wrapT,d=c===Ut.NEAREST_MIPMAP_NEAREST||c===Ut.NEAREST_MIPMAP_LINEAR||c===Ut.LINEAR_MIPMAP_NEAREST||c===Ut.LINEAR_MIPMAP_LINEAR,p=!l(s)&&d,g=p||u===ii.REPEAT||u===ii.MIRRORED_REPEAT||h===ii.REPEAT||h===ii.MIRRORED_REPEAT,_=!R.isPowerOfTwo(n.width)||!R.isPowerOfTwo(n.height),b=g&&_;let x;return l(s)?(!r.webgl2&&Le.isCompressedFormat(s)&&_&&g&&console.warn("Compressed texture uses REPEAT or MIRRORED_REPEAT texture wrap mode and dimensions are not powers of two. The texture may be rendered incorrectly."),x=kt.create({context:r,source:{arrayBufferView:n.bufferView,mipLevels:i},width:n.width,height:n.height,pixelFormat:n.internalFormat,sampler:a})):(b&&(n=QY(n)),x=kt.create({context:r,source:n,sampler:a,flipY:!1,skipColorSpaceConversion:!0})),p&&x.generateMipmap(),x}Ja.prototype.process=function(e){if(y.typeOf.object("frameState",e),this._state===Oe.READY)return!0;if(this._state!==Oe.LOADED&&this._state!==Oe.PROCESSING||l(this._texture)||!l(this._image))return!1;this._state=Oe.PROCESSING;let t;if(this._asynchronous){const n=Rse;if(n.set(this._gltf,this._textureInfo,this._image,this._mipLevels,e.context),!e.jobScheduler.execute(n,dw.TEXTURE))return;t=n.texture}else t=SN(this._gltf,this._textureInfo,this._image,this._mipLevels,e.context);return this.unload(),this._texture=t,this._state=Oe.READY,this._resourceCache.statistics.addTextureLoader(this),!0};Ja.prototype.unload=function(){l(this._texture)&&this._texture.destroy(),l(this._imageLoader)&&!this._imageLoader.isDestroyed()&&this._resourceCache.unload(this._imageLoader),this._imageLoader=void 0,this._image=void 0,this._mipLevels=void 0,this._texture=void 0,this._gltf=void 0};function Qa(e){e=T(e,T.EMPTY_OBJECT);const t=e.resourceCache,n=e.gltf,i=e.gltfResource,r=e.baseResource,s=e.bufferViewId,o=e.draco,a=e.attributeSemantic,c=e.accessorId,u=e.cacheKey,h=T(e.asynchronous,!0),d=T(e.loadBuffer,!1),p=T(e.loadTypedArray,!1);if(y.typeOf.func("options.resourceCache",t),y.typeOf.object("options.gltf",n),y.typeOf.object("options.gltfResource",i),y.typeOf.object("options.baseResource",r),!d&&!p)throw new A("At least one of loadBuffer and loadTypedArray must be true.");const g=l(s),_=vN(o,a),b=l(a),x=l(c);if(g===_)throw new A("One of options.bufferViewId and options.draco must be defined.");if(_&&!b)throw new A("When options.draco is defined options.attributeSemantic must also be defined.");if(_&&!x)throw new A("When options.draco is defined options.accessorId must also be defined.");_&&(y.typeOf.object("options.draco",o),y.typeOf.string("options.attributeSemantic",a),y.typeOf.number("options.accessorId",c)),this._resourceCache=t,this._gltfResource=i,this._baseResource=r,this._gltf=n,this._bufferViewId=s,this._draco=o,this._attributeSemantic=a,this._accessorId=c,this._cacheKey=u,this._asynchronous=h,this._loadBuffer=d,this._loadTypedArray=p,this._bufferViewLoader=void 0,this._dracoLoader=void 0,this._quantization=void 0,this._typedArray=void 0,this._buffer=void 0,this._state=Oe.UNLOADED,this._promise=void 0}l(Object.create)&&(Qa.prototype=Object.create(ai.prototype),Qa.prototype.constructor=Qa);Object.defineProperties(Qa.prototype,{cacheKey:{get:function(){return this._cacheKey}},buffer:{get:function(){return this._buffer}},typedArray:{get:function(){return this._typedArray}},quantization:{get:function(){return this._quantization}}});function vN(e,t){return l(e)&&l(e.attributes)&&l(e.attributes[t])}Qa.prototype.load=async function(){return l(this._promise)?this._promise:vN(this._draco,this._attributeSemantic)?(this._promise=Lse(this),this._promise):(this._promise=Nse(this),this._promise)};function Mse(e,t,n,i){const s=(1<<e.quantizationBits)-1,o=1/s,a=new Be.Quantization;if(a.componentDatatype=t,a.octEncoded=e.octEncoded,a.octEncodedZXY=!0,a.type=i,a.octEncoded)a.type=tt.VEC2,a.normalizationRange=s;else{const c=tt.getMathType(i);if(c===Number){const u=e.range;a.quantizedVolumeOffset=e.minValues[0],a.quantizedVolumeDimensions=u,a.normalizationRange=s,a.quantizedVolumeStepSize=u*o}else{a.quantizedVolumeOffset=c.unpack(e.minValues),a.normalizationRange=c.unpack(new Array(n).fill(s));const u=new Array(n).fill(e.range);a.quantizedVolumeDimensions=c.unpack(u);const h=u.map(function(d){return d*o});a.quantizedVolumeStepSize=c.unpack(h)}}return a}async function Lse(e){e._state=Oe.LOADING;const t=e._resourceCache;try{const n=t.getDracoLoader({gltf:e._gltf,draco:e._draco,gltfResource:e._gltfResource,baseResource:e._baseResource});return e._dracoLoader=n,await n.load(),e.isDestroyed()?void 0:(e._state=Oe.LOADED,e)}catch{if(e.isDestroyed())return;ww(e)}}function Pse(e){e._state=Oe.PROCESSING;const n=e._dracoLoader.decodedData.vertexAttributes,i=e._attributeSemantic,r=n[i],s=e._accessorId,a=e._gltf.accessors[s].type,c=r.array,u=r.data.quantization;l(u)&&(e._quantization=Mse(u,r.data.componentDatatype,r.data.componentsPerAttribute,a)),e._typedArray=new Uint8Array(c.buffer,c.byteOffset,c.byteLength)}async function Nse(e){e._state=Oe.LOADING;const t=e._resourceCache;try{const n=t.getBufferViewLoader({gltf:e._gltf,bufferViewId:e._bufferViewId,gltfResource:e._gltfResource,baseResource:e._baseResource});return e._bufferViewLoader=n,await n.load(),e.isDestroyed()?void 0:(e._typedArray=n.typedArray,e._state=Oe.PROCESSING,e)}catch(n){if(e.isDestroyed())return;ww(e,n)}}function ww(e,t){throw e.unload(),e._state=Oe.FAILED,e.getError("Failed to load vertex buffer",t)}function Aw(){this.typedArray=void 0,this.context=void 0,this.buffer=void 0}Aw.prototype.set=function(e,t){this.typedArray=e,this.context=t};Aw.prototype.execute=function(){this.buffer=IN(this.typedArray,this.context)};function IN(e,t){const n=ze.createVertexBuffer({typedArray:e,context:t,usage:Ae.STATIC_DRAW});return n.vertexArrayDestroyable=!1,n}const Fse=new Aw;Qa.prototype.process=function(e){if(y.typeOf.object("frameState",e),this._state===Oe.READY)return!0;if(this._state!==Oe.LOADED&&this._state!==Oe.PROCESSING)return!1;if(l(this._dracoLoader)){try{if(!this._dracoLoader.process(e))return!1}catch(i){ww(this,i)}Pse(this)}let t;const n=this._typedArray;if(this._loadBuffer&&this._asynchronous){const i=Fse;if(i.set(n,e.context),!e.jobScheduler.execute(i,dw.BUFFER))return!1;t=i.buffer}else this._loadBuffer&&(t=IN(n,e.context));return this.unload(),this._buffer=t,this._typedArray=this._loadTypedArray?n:void 0,this._state=Oe.READY,this._resourceCache.statistics.addGeometryLoader(this),!0};Qa.prototype.unload=function(){l(this._buffer)&&this._buffer.destroy();const e=this._resourceCache;l(this._bufferViewLoader)&&!this._bufferViewLoader.isDestroyed()&&e.unload(this._bufferViewLoader),l(this._dracoLoader)&&e.unload(this._dracoLoader),this._bufferViewLoader=void 0,this._dracoLoader=void 0,this._typedArray=void 0,this._buffer=void 0,this._gltf=void 0};function Al(e){e=T(e,T.EMPTY_OBJECT);const t=e.id;y.typeOf.string("options.id",t);const n=T(e.properties,{}),i={};for(const r in n)if(n.hasOwnProperty(r)){const s=n[r];l(s.semantic)&&(i[s.semantic]=s)}this._id=t,this._name=e.name,this._description=e.description,this._properties=n,this._propertiesBySemantic=i,this._extras=Se(e.extras,!0),this._extensions=Se(e.extensions,!0)}Al.fromJson=function(e){e=T(e,T.EMPTY_OBJECT);const t=e.id,n=e.class;y.typeOf.string("options.id",t),y.typeOf.object("options.class",n);const i={};for(const r in n.properties)if(n.properties.hasOwnProperty(r)){const s=Li.fromJson({id:r,property:n.properties[r],enums:e.enums});i[r]=s}return new Al({id:t,name:n.name,description:n.description,properties:i,extras:n.extras,extensions:n.extensions})};Object.defineProperties(Al.prototype,{properties:{get:function(){return this._properties}},propertiesBySemantic:{get:function(){return this._propertiesBySemantic}},id:{get:function(){return this._id}},name:{get:function(){return this._name}},description:{get:function(){return this._description}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});Al.BATCH_TABLE_CLASS_NAME="_batchTable";function ey(e){e=T(e,T.EMPTY_OBJECT);const t=e.value,n=e.name;y.typeOf.number("options.value",t),y.typeOf.string("options.name",n),this._value=t,this._name=n,this._description=e.description,this._extras=Se(e.extras,!0),this._extensions=Se(e.extensions,!0)}ey.fromJson=function(e){return y.typeOf.object("value",e),new ey({value:e.value,name:e.name,description:e.description,extras:e.extras,extensions:e.extensions})};Object.defineProperties(ey.prototype,{value:{get:function(){return this._value}},name:{get:function(){return this._name}},description:{get:function(){return this._description}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});function ty(e){e=T(e,T.EMPTY_OBJECT);const t=e.id,n=e.values;y.typeOf.string("options.id",t),y.defined("options.values",n);const i={},r={},s=n.length;for(let a=0;a<s;++a){const c=n[a];i[c.value]=c.name,r[c.name]=c.value}const o=T(e.valueType,ct.UINT16);this._values=n,this._namesByValue=i,this._valuesByName=r,this._valueType=o,this._id=t,this._name=e.name,this._description=e.description,this._extras=Se(e.extras,!0),this._extensions=Se(e.extensions,!0)}ty.fromJson=function(e){e=T(e,T.EMPTY_OBJECT);const t=e.id,n=e.enum;y.typeOf.string("options.id",t),y.typeOf.object("options.enum",n);const i=n.values.map(function(r){return ey.fromJson(r)});return new ty({id:t,values:i,valueType:ct[n.valueType],name:n.name,description:n.description,extras:n.extras,extensions:n.extensions})};Object.defineProperties(ty.prototype,{values:{get:function(){return this._values}},namesByValue:{get:function(){return this._namesByValue}},valuesByName:{get:function(){return this._valuesByName}},valueType:{get:function(){return this._valueType}},id:{get:function(){return this._id}},name:{get:function(){return this._name}},description:{get:function(){return this._description}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});function Sl(e){e=T(e,T.EMPTY_OBJECT);const t=T(e.classes,{}),n=T(e.enums,{});this._classes=t,this._enums=n,this._id=e.id,this._name=e.name,this._description=e.description,this._version=e.version,this._extras=Se(e.extras,!0),this._extensions=Se(e.extensions,!0)}Sl.fromJson=function(e){y.typeOf.object("schema",e);const t={};if(l(e.enums))for(const i in e.enums)e.enums.hasOwnProperty(i)&&(t[i]=ty.fromJson({id:i,enum:e.enums[i]}));const n={};if(l(e.classes))for(const i in e.classes)e.classes.hasOwnProperty(i)&&(n[i]=Al.fromJson({id:i,class:e.classes[i],enums:t}));return new Sl({id:e.id,name:e.name,description:e.description,version:e.version,classes:n,enums:t,extras:e.extras,extensions:e.extensions})};Object.defineProperties(Sl.prototype,{classes:{get:function(){return this._classes}},enums:{get:function(){return this._enums}},id:{get:function(){return this._id}},name:{get:function(){return this._name}},description:{get:function(){return this._description}},version:{get:function(){return this._version}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});function cl(e){e=T(e,T.EMPTY_OBJECT);const t=e.schema,n=e.resource,i=e.cacheKey;if(l(t)===l(n))throw new A("One of options.schema and options.resource must be defined.");this._schema=l(t)?Sl.fromJson(t):void 0,this._resource=n,this._cacheKey=i,this._state=Oe.UNLOADED,this._promise=void 0}l(Object.create)&&(cl.prototype=Object.create(ai.prototype),cl.prototype.constructor=cl);Object.defineProperties(cl.prototype,{cacheKey:{get:function(){return this._cacheKey}},schema:{get:function(){return this._schema}}});cl.prototype.load=async function(){return l(this._promise)?this._promise:l(this._schema)?(this._promise=Promise.resolve(this),this._promise):(this._promise=Bse(this),this._promise)};async function Bse(e){const t=e._resource;e._state=Oe.LOADING;try{const n=await t.fetchJson();return e.isDestroyed()?void 0:(e._schema=Sl.fromJson(n),e._state=Oe.READY,e)}catch(n){if(e.isDestroyed())return;e._state=Oe.FAILED;const i=`Failed to load schema: ${t.url}`;throw e.getError(i,n)}}cl.prototype.unload=function(){this._schema=void 0};const Ai={};function Fh(e){return zy(e.url)}function Qy(e){let{byteOffset:t,byteLength:n}=e;if(oi(e,"EXT_meshopt_compression")){const i=e.extensions.EXT_meshopt_compression;t=T(i.byteOffset,0),n=i.byteLength}return`${t}-${t+n}`}function zse(e,t){const n=t.byteOffset+e.byteOffset,{componentType:i,type:r,count:s}=e;return`${n}-${i}-${r}-${s}`}function ON(e,t){return`${Fh(e)}-buffer-id-${t}`}function am(e,t,n,i){if(l(e.uri)){const r=i.getDerivedResource({url:e.uri});return Fh(r)}return ON(n,t)}function Sw(e,t,n,i){const r=t.bufferView,s=e.bufferViews[r],o=s.buffer,a=e.buffers[o],c=am(a,o,n,i),u=Qy(s);return`${c}-range-${u}`}function RN(e,t,n,i){const r=e.images[t],s=r.bufferView,o=r.uri;if(l(o)){const p=i.getDerivedResource({url:o});return Fh(p)}const a=e.bufferViews[s],c=a.buffer,u=e.buffers[c],h=am(u,c,n,i),d=Qy(a);return`${h}-range-${d}`}function Use(e,t){const n=Ta.createSampler({gltf:e,textureInfo:t});return`${n.wrapS}-${n.wrapT}-${n.minificationFilter}-${n.magnificationFilter}`}Ai.getSchemaCacheKey=function(e){const{schema:t,resource:n}=e;if(l(t)===l(n))throw new A("One of options.schema and options.resource must be defined.");return l(t)?`embedded-schema:${JSON.stringify(t)}`:`external-schema:${Fh(n)}`};Ai.getExternalBufferCacheKey=function(e){e=T(e,T.EMPTY_OBJECT);const{resource:t}=e;return y.typeOf.object("options.resource",t),`external-buffer:${Fh(t)}`};Ai.getEmbeddedBufferCacheKey=function(e){e=T(e,T.EMPTY_OBJECT);const{parentResource:t,bufferId:n}=e;return y.typeOf.object("options.parentResource",t),y.typeOf.number("options.bufferId",n),`embedded-buffer:${ON(t,n)}`};Ai.getGltfCacheKey=function(e){e=T(e,T.EMPTY_OBJECT);const{gltfResource:t}=e;return y.typeOf.object("options.gltfResource",t),`gltf:${Fh(t)}`};Ai.getBufferViewCacheKey=function(e){e=T(e,T.EMPTY_OBJECT);const{gltf:t,bufferViewId:n,gltfResource:i,baseResource:r}=e;y.typeOf.object("options.gltf",t),y.typeOf.number("options.bufferViewId",n),y.typeOf.object("options.gltfResource",i),y.typeOf.object("options.baseResource",r);const s=t.bufferViews[n];let o=s.buffer;const a=t.buffers[o];oi(s,"EXT_meshopt_compression")&&(o=s.extensions.EXT_meshopt_compression.buffer);const c=am(a,o,i,r),u=Qy(s);return`buffer-view:${c}-range-${u}`};Ai.getDracoCacheKey=function(e){e=T(e,T.EMPTY_OBJECT);const{gltf:t,draco:n,gltfResource:i,baseResource:r}=e;return y.typeOf.object("options.gltf",t),y.typeOf.object("options.draco",n),y.typeOf.object("options.gltfResource",i),y.typeOf.object("options.baseResource",r),`draco:${Sw(t,n,i,r)}`};Ai.getVertexBufferCacheKey=function(e){e=T(e,T.EMPTY_OBJECT);const{gltf:t,gltfResource:n,baseResource:i,frameState:r,bufferViewId:s,draco:o,attributeSemantic:a,dequantize:c=!1,loadBuffer:u=!1,loadTypedArray:h=!1}=e;y.typeOf.object("options.gltf",t),y.typeOf.object("options.gltfResource",n),y.typeOf.object("options.baseResource",i),y.typeOf.object("options.frameState",r);const d=l(s),p=kse(o,a),g=l(a);if(d===p)throw new A("One of options.bufferViewId and options.draco must be defined.");if(p&&!g)throw new A("When options.draco is defined options.attributeSemantic must also be defined.");if(p&&(y.typeOf.object("options.draco",o),y.typeOf.string("options.attributeSemantic",a)),!u&&!h)throw new A("At least one of loadBuffer and loadTypedArray must be true.");let _="";if(c&&(_+="-dequantize"),u&&(_+="-buffer",_+=`-context-${r.context.id}`),h&&(_+="-typed-array"),l(o))return`vertex-buffer:${Sw(t,o,n,i)}-draco-${a}${_}`;const b=t.bufferViews[s],x=b.buffer,E=t.buffers[x],C=am(E,x,n,i),w=Qy(b);return`vertex-buffer:${C}-range-${w}${_}`};function kse(e,t){return l(e)&&l(e.attributes)&&l(e.attributes[t])}Ai.getIndexBufferCacheKey=function(e){e=T(e,T.EMPTY_OBJECT);const{gltf:t,accessorId:n,gltfResource:i,baseResource:r,frameState:s,draco:o,loadBuffer:a=!1,loadTypedArray:c=!1}=e;if(y.typeOf.object("options.gltf",t),y.typeOf.number("options.accessorId",n),y.typeOf.object("options.gltfResource",i),y.typeOf.object("options.baseResource",r),y.typeOf.object("options.frameState",s),!a&&!c)throw new A("At least one of loadBuffer and loadTypedArray must be true.");let u="";if(a&&(u+="-buffer",u+=`-context-${s.context.id}`),c&&(u+="-typed-array"),l(o))return`index-buffer:${Sw(t,o,i,r)}-draco${u}`;const h=t.accessors[n],d=h.bufferView,p=t.bufferViews[d],g=p.buffer,_=t.buffers[g],b=am(_,g,i,r),x=zse(h,p);return`index-buffer:${b}-accessor-${x}${u}`};Ai.getImageCacheKey=function(e){e=T(e,T.EMPTY_OBJECT);const{gltf:t,imageId:n,gltfResource:i,baseResource:r}=e;return y.typeOf.object("options.gltf",t),y.typeOf.number("options.imageId",n),y.typeOf.object("options.gltfResource",i),y.typeOf.object("options.baseResource",r),`image:${RN(t,n,i,r)}`};Ai.getTextureCacheKey=function(e){e=T(e,T.EMPTY_OBJECT);const{gltf:t,textureInfo:n,gltfResource:i,baseResource:r,supportedImageFormats:s,frameState:o}=e;y.typeOf.object("options.gltf",t),y.typeOf.object("options.textureInfo",n),y.typeOf.object("options.gltfResource",i),y.typeOf.object("options.baseResource",r),y.typeOf.object("options.supportedImageFormats",s),y.typeOf.object("options.frameState",o);const a=n.index,c=Ta.getImageIdFromTexture({gltf:t,textureId:a,supportedImageFormats:s}),u=RN(t,c,i,r),h=Use(t,n);return`texture:${u}-sampler-${h}-context-${o.context.id}`};function cm(){this.geometryByteLength=0,this.texturesByteLength=0,this._geometrySizes={},this._textureSizes={}}cm.prototype.clear=function(){this.geometryByteLength=0,this.texturesByteLength=0,this._geometrySizes={},this._textureSizes={}};cm.prototype.addGeometryLoader=function(e){y.typeOf.object("loader",e);const t=e.cacheKey;if(this._geometrySizes.hasOwnProperty(t))return;this._geometrySizes[t]=0;const n=e.buffer,i=e.typedArray;let r=0;l(n)&&(r+=n.sizeInBytes),l(i)&&(r+=i.byteLength),this.geometryByteLength+=r,this._geometrySizes[t]=r};cm.prototype.addTextureLoader=function(e){y.typeOf.object("loader",e);const t=e.cacheKey;if(this._textureSizes.hasOwnProperty(t))return;this._textureSizes[t]=0;const n=e.texture.sizeInBytes;this.texturesByteLength+=e.texture.sizeInBytes,this._textureSizes[t]=n};cm.prototype.removeLoader=function(e){y.typeOf.object("loader",e);const t=e.cacheKey,n=this._geometrySizes[t];delete this._geometrySizes[t],l(n)&&(this.geometryByteLength-=n);const i=this._textureSizes[t];delete this._textureSizes[t],l(i)&&(this.texturesByteLength-=i)};function Re(){}Re.cacheEntries={};Re.statistics=new cm;function jse(e){this.referenceCount=1,this.resourceLoader=e,this._statisticsPromise=void 0}Re.get=function(e){y.typeOf.string("cacheKey",e);const t=Re.cacheEntries[e];if(l(t))return++t.referenceCount,t.resourceLoader};Re.add=function(e){y.typeOf.object("resourceLoader",e);const t=e.cacheKey;if(y.typeOf.string("options.resourceLoader.cacheKey",t),l(Re.cacheEntries[t]))throw new A(`Resource with this cacheKey is already in the cache: ${t}`);return Re.cacheEntries[t]=new jse(e),e};Re.unload=function(e){y.typeOf.object("resourceLoader",e);const t=e.cacheKey,n=Re.cacheEntries[t];if(!l(n))throw new A(`Resource is not in the cache: ${t}`);--n.referenceCount,n.referenceCount===0&&(Re.statistics.removeLoader(e),e.destroy(),delete Re.cacheEntries[t])};Re.getSchemaLoader=function(e){e=T(e,T.EMPTY_OBJECT);const{schema:t,resource:n}=e;if(l(t)===l(n))throw new A("One of options.schema and options.resource must be defined.");const i=Ai.getSchemaCacheKey({schema:t,resource:n});let r=Re.get(i);return l(r)?r:(r=new cl({schema:t,resource:n,cacheKey:i}),Re.add(r))};Re.getEmbeddedBufferLoader=function(e){e=T(e,T.EMPTY_OBJECT);const{parentResource:t,bufferId:n,typedArray:i}=e;y.typeOf.object("options.parentResource",t),y.typeOf.number("options.bufferId",n);const r=Ai.getEmbeddedBufferCacheKey({parentResource:t,bufferId:n});let s=Re.get(r);return l(s)?s:(y.typeOf.object("options.typedArray",i),s=new Ro({typedArray:i,cacheKey:r}),Re.add(s))};Re.getExternalBufferLoader=function(e){e=T(e,T.EMPTY_OBJECT);const{resource:t}=e;y.typeOf.object("options.resource",t);const n=Ai.getExternalBufferCacheKey({resource:t});let i=Re.get(n);return l(i)?i:(i=new Ro({resource:t,cacheKey:n}),Re.add(i))};Re.getGltfJsonLoader=function(e){e=T(e,T.EMPTY_OBJECT);const{gltfResource:t,baseResource:n,typedArray:i,gltfJson:r}=e;y.typeOf.object("options.gltfResource",t),y.typeOf.object("options.baseResource",n);const s=Ai.getGltfCacheKey({gltfResource:t});let o=Re.get(s);return l(o)?o:(o=new Za({resourceCache:Re,gltfResource:t,baseResource:n,typedArray:i,gltfJson:r,cacheKey:s}),Re.add(o))};Re.getBufferViewLoader=function(e){e=T(e,T.EMPTY_OBJECT);const{gltf:t,bufferViewId:n,gltfResource:i,baseResource:r}=e;y.typeOf.object("options.gltf",t),y.typeOf.number("options.bufferViewId",n),y.typeOf.object("options.gltfResource",i),y.typeOf.object("options.baseResource",r);const s=Ai.getBufferViewCacheKey({gltf:t,bufferViewId:n,gltfResource:i,baseResource:r});let o=Re.get(s);return l(o)?o:(o=new ol({resourceCache:Re,gltf:t,bufferViewId:n,gltfResource:i,baseResource:r,cacheKey:s}),Re.add(o))};Re.getDracoLoader=function(e){e=T(e,T.EMPTY_OBJECT);const{gltf:t,draco:n,gltfResource:i,baseResource:r}=e;y.typeOf.object("options.gltf",t),y.typeOf.object("options.draco",n),y.typeOf.object("options.gltfResource",i),y.typeOf.object("options.baseResource",r);const s=Ai.getDracoCacheKey({gltf:t,draco:n,gltfResource:i,baseResource:r});let o=Re.get(s);return l(o)?o:(o=new Ya({resourceCache:Re,gltf:t,draco:n,gltfResource:i,baseResource:r,cacheKey:s}),Re.add(o))};Re.getVertexBufferLoader=function(e){e=T(e,T.EMPTY_OBJECT);const{gltf:t,gltfResource:n,baseResource:i,frameState:r,bufferViewId:s,draco:o,attributeSemantic:a,accessorId:c,asynchronous:u=!0,dequantize:h=!1,loadBuffer:d=!1,loadTypedArray:p=!1}=e;if(y.typeOf.object("options.gltf",t),y.typeOf.object("options.gltfResource",n),y.typeOf.object("options.baseResource",i),y.typeOf.object("options.frameState",r),!d&&!p)throw new A("At least one of loadBuffer and loadTypedArray must be true.");const g=l(s),_=Vse(o,a),b=l(a),x=l(c);if(g===_)throw new A("One of options.bufferViewId and options.draco must be defined.");if(_&&!b)throw new A("When options.draco is defined options.attributeSemantic must also be defined.");if(_&&!x)throw new A("When options.draco is defined options.haAccessorId must also be defined.");_&&(y.typeOf.object("options.draco",o),y.typeOf.string("options.attributeSemantic",a),y.typeOf.number("options.accessorId",c));const E=Ai.getVertexBufferCacheKey({gltf:t,gltfResource:n,baseResource:i,frameState:r,bufferViewId:s,draco:o,attributeSemantic:a,dequantize:h,loadBuffer:d,loadTypedArray:p});let C=Re.get(E);return l(C)?C:(C=new Qa({resourceCache:Re,gltf:t,gltfResource:n,baseResource:i,bufferViewId:s,draco:o,attributeSemantic:a,accessorId:c,cacheKey:E,asynchronous:u,dequantize:h,loadBuffer:d,loadTypedArray:p}),Re.add(C))};function Vse(e,t){return l(e)&&l(e.attributes)&&l(e.attributes[t])}Re.getIndexBufferLoader=function(e){e=T(e,T.EMPTY_OBJECT);const{gltf:t,accessorId:n,gltfResource:i,baseResource:r,frameState:s,draco:o,asynchronous:a=!0,loadBuffer:c=!1,loadTypedArray:u=!1}=e;if(y.typeOf.object("options.gltf",t),y.typeOf.number("options.accessorId",n),y.typeOf.object("options.gltfResource",i),y.typeOf.object("options.baseResource",r),y.typeOf.object("options.frameState",s),!c&&!u)throw new A("At least one of loadBuffer and loadTypedArray must be true.");const h=Ai.getIndexBufferCacheKey({gltf:t,accessorId:n,gltfResource:i,baseResource:r,frameState:s,draco:o,loadBuffer:c,loadTypedArray:u});let d=Re.get(h);return l(d)?d:(d=new Ka({resourceCache:Re,gltf:t,accessorId:n,gltfResource:i,baseResource:r,draco:o,cacheKey:h,asynchronous:a,loadBuffer:c,loadTypedArray:u}),Re.add(d))};Re.getImageLoader=function(e){e=T(e,T.EMPTY_OBJECT);const{gltf:t,imageId:n,gltfResource:i,baseResource:r}=e;y.typeOf.object("options.gltf",t),y.typeOf.number("options.imageId",n),y.typeOf.object("options.gltfResource",i),y.typeOf.object("options.baseResource",r);const s=Ai.getImageCacheKey({gltf:t,imageId:n,gltfResource:i,baseResource:r});let o=Re.get(s);return l(o)?o:(o=new ha({resourceCache:Re,gltf:t,imageId:n,gltfResource:i,baseResource:r,cacheKey:s}),Re.add(o))};Re.getTextureLoader=function(e){e=T(e,T.EMPTY_OBJECT);const{gltf:t,textureInfo:n,gltfResource:i,baseResource:r,supportedImageFormats:s,frameState:o,asynchronous:a=!0}=e;y.typeOf.object("options.gltf",t),y.typeOf.object("options.textureInfo",n),y.typeOf.object("options.gltfResource",i),y.typeOf.object("options.baseResource",r),y.typeOf.object("options.supportedImageFormats",s),y.typeOf.object("options.frameState",o);const c=Ai.getTextureCacheKey({gltf:t,textureInfo:n,gltfResource:i,baseResource:r,supportedImageFormats:s,frameState:o});let u=Re.get(c);return l(u)?u:(u=new Ja({resourceCache:Re,gltf:t,textureInfo:n,gltfResource:i,baseResource:r,supportedImageFormats:s,cacheKey:c,asynchronous:a}),Re.add(u))};Re.clearForSpecs=function(){const e=[Qa,Ka,Ya,Ja,ha,ol,Ro,cl,Za];let t;const n=Re.cacheEntries,i=[];for(t in n)n.hasOwnProperty(t)&&i.push(n[t]);i.sort(function(s,o){const a=e.indexOf(s.resourceLoader.constructor),c=e.indexOf(o.resourceLoader.constructor);return a-c});const r=i.length;for(let s=0;s<r;++s){const o=i[s];t=o.resourceLoader.cacheKey,l(n[t])&&(o.resourceLoader.destroy(),delete n[t])}Re.statistics.clear()};function Xi(e,t,n){y.typeOf.object("resource",e),y.typeOf.object("implicitTileset",t),y.typeOf.object("implicitCoordinates",n),this._resource=e,this._subtreeJson=void 0,this._bufferLoader=void 0,this._tileAvailability=void 0,this._contentAvailabilityBitstreams=[],this._childSubtreeAvailability=void 0,this._implicitCoordinates=n,this._subtreeLevels=t.subtreeLevels,this._subdivisionScheme=t.subdivisionScheme,this._branchingFactor=t.branchingFactor,this._metadata=void 0,this._tileMetadataTable=void 0,this._tilePropertyTableJson=void 0,this._contentMetadataTables=[],this._contentPropertyTableJsons=[],this._tileJumpBuffer=void 0,this._contentJumpBuffers=[],this._ready=!1}Object.defineProperties(Xi.prototype,{ready:{get:function(){return this._ready}},metadata:{get:function(){return this._metadata}},tileMetadataTable:{get:function(){return this._tileMetadataTable}},tilePropertyTableJson:{get:function(){return this._tilePropertyTableJson}},contentMetadataTables:{get:function(){return this._contentMetadataTables}},contentPropertyTableJsons:{get:function(){return this._contentPropertyTableJsons}},implicitCoordinates:{get:function(){return this._implicitCoordinates}}});Xi.prototype.tileIsAvailableAtIndex=function(e){return this._tileAvailability.getBit(e)};Xi.prototype.tileIsAvailableAtCoordinates=function(e){const t=this.getTileIndex(e);return this.tileIsAvailableAtIndex(t)};Xi.prototype.contentIsAvailableAtIndex=function(e,t){if(t=T(t,0),t<0||t>=this._contentAvailabilityBitstreams.length)throw new A("contentIndex out of bounds.");return this._contentAvailabilityBitstreams[t].getBit(e)};Xi.prototype.contentIsAvailableAtCoordinates=function(e,t){const n=this.getTileIndex(e);return this.contentIsAvailableAtIndex(n,t)};Xi.prototype.childSubtreeIsAvailableAtIndex=function(e){return this._childSubtreeAvailability.getBit(e)};Xi.prototype.childSubtreeIsAvailableAtCoordinates=function(e){const t=this.getChildSubtreeIndex(e);return this.childSubtreeIsAvailableAtIndex(t)};Xi.prototype.getLevelOffset=function(e){const t=this._branchingFactor;return(Math.pow(t,e)-1)/(t-1)};Xi.prototype.getParentMortonIndex=function(e){let t=2;return this._subdivisionScheme===Ti.OCTREE&&(t=3),e>>t};Xi.fromSubtreeJson=async function(e,t,n,i,r){if(y.typeOf.object("resource",e),l(t)===l(n))throw new A("One of json and subtreeView must be defined.");y.typeOf.object("implicitTileset",i),y.typeOf.object("implicitCoordinates",r);const s=new Xi(e,i,r);let o;l(t)?o={json:t,binary:void 0}:o=Gse(n);const a=o.json;s._subtreeJson=a;let c;if(oi(a,"3DTILES_metadata"))c=a.extensions["3DTILES_metadata"];else if(l(a.tileMetadata)){const C=a.tileMetadata;c=a.propertyTables[C]}const u=[];if(l(a.contentMetadata)){const C=a.contentMetadata.length;for(let w=0;w<C;w++){const S=a.contentMetadata[w];u.push(a.propertyTables[S])}}let h;const d=i.metadataSchema,p=a.subtreeMetadata;if(l(p)){const C=p.class,w=d.classes[C];h=new gc({subtreeMetadata:p,class:w})}s._metadata=h,s._tilePropertyTableJson=c,s._contentPropertyTableJsons=u;const g={constant:0};a.contentAvailabilityHeaders=[],oi(a,"3DTILES_multiple_contents")?a.contentAvailabilityHeaders=a.extensions["3DTILES_multiple_contents"].contentAvailability:Array.isArray(a.contentAvailability)?a.contentAvailabilityHeaders=a.contentAvailability:a.contentAvailabilityHeaders.push(T(a.contentAvailability,g));const _=Hse(a.buffers),b=qse(a.bufferViews,_);Wse(a,b),l(c)&&S1(c,b);for(let C=0;C<u.length;C++){const w=u[C];S1(w,b)}const x=await $se(s,_,o.binary),E=Yse(b,x);return Kse(s,a,i,E),l(c)&&(Zse(s,i,E),Qse(s)),Jse(s,i,E),eoe(s),s._ready=!0,s};function Gse(e){const n=new DataView(e.buffer,e.byteOffset);let i=8;const r=n.getUint32(i,!0);i+=8;const s=n.getUint32(i,!0);i+=8;const o=Cs(e,i,r);i+=r;const a=e.subarray(i,i+s);return{json:o,binary:a}}function Hse(e){e=l(e)?e:[];for(let t=0;t<e.length;t++){const n=e[t];n.isExternal=l(n.uri),n.isActive=!1}return e}function qse(e,t){e=l(e)?e:[];for(let n=0;n<e.length;n++){const i=e[n],r=t[i.buffer];i.bufferHeader=r,i.isActive=!1}return e}function Wse(e,t){let n;const i=e.tileAvailability;l(i.bitstream)?n=t[i.bitstream]:l(i.bufferView)&&(n=t[i.bufferView]),l(n)&&(n.isActive=!0,n.bufferHeader.isActive=!0);const r=e.contentAvailabilityHeaders;for(let o=0;o<r.length;o++)n=void 0,l(r[o].bitstream)?n=t[r[o].bitstream]:l(r[o].bufferView)&&(n=t[r[o].bufferView]),l(n)&&(n.isActive=!0,n.bufferHeader.isActive=!0);n=void 0;const s=e.childSubtreeAvailability;l(s.bitstream)?n=t[s.bitstream]:l(s.bufferView)&&(n=t[s.bufferView]),l(n)&&(n.isActive=!0,n.bufferHeader.isActive=!0)}function S1(e,t){const n=e.properties;let i;for(const r in n)if(n.hasOwnProperty(r)){const s=n[r],o=T(s.values,s.bufferView);i=t[o],i.isActive=!0,i.bufferHeader.isActive=!0;const a=T(s.stringOffsets,s.stringOffsetBufferView);l(a)&&(i=t[a],i.isActive=!0,i.bufferHeader.isActive=!0);const c=T(s.arrayOffsets,s.arrayOffsetBufferView);l(c)&&(i=t[c],i.isActive=!0,i.bufferHeader.isActive=!0)}}function $se(e,t,n){const i=[];for(let r=0;r<t.length;r++){const s=t[r];if(!s.isActive)i.push(Promise.resolve(void 0));else if(s.isExternal){const o=Xse(e,s);i.push(o)}else i.push(Promise.resolve(n))}return Promise.all(i).then(function(r){const s={};for(let o=0;o<r.length;o++){const a=r[o];l(a)&&(s[o]=a)}return s})}async function Xse(e,t){const i=e._resource.getDerivedResource({url:t.uri}),r=Re.getExternalBufferLoader({resource:i});e._bufferLoader=r;try{await r.load()}catch(s){if(r.isDestroyed())return;throw s}return r.typedArray}function Yse(e,t){const n={};for(let i=0;i<e.length;i++){const r=e[i];if(!r.isActive)continue;const s=r.byteOffset,o=s+r.byteLength,c=t[r.buffer].subarray(s,o);n[i]=c}return n}function Kse(e,t,n,i){const r=n.branchingFactor,s=n.subtreeLevels,o=(Math.pow(r,s)-1)/(r-1),a=Math.pow(r,s),c=oi(t,"3DTILES_metadata"),u=l(e._tilePropertyTableJson);let h=c||u;e._tileAvailability=J0(t.tileAvailability,i,o,h);const d=e._contentPropertyTableJsons.length>0;h=h||d;for(let p=0;p<t.contentAvailabilityHeaders.length;p++){const g=J0(t.contentAvailabilityHeaders[p],i,o,h);e._contentAvailabilityBitstreams.push(g)}e._childSubtreeAvailability=J0(t.childSubtreeAvailability,i,a)}function J0(e,t,n,i){if(l(e.constant))return new Z_({constant:!!e.constant,lengthBits:n,availableCount:e.availableCount});let r;return l(e.bitstream)?r=t[e.bitstream]:l(e.bufferView)&&(r=t[e.bufferView]),new Z_({bitstream:r,lengthBits:n,availableCount:e.availableCount,computeAvailableCountEnabled:i})}function Zse(e,t,n){const i=e._tilePropertyTableJson,r=e._tileAvailability.availableCount,s=t.metadataSchema,o=i.class,a=s.classes[o];e._tileMetadataTable=new Hr({class:a,count:r,properties:i.properties,bufferViews:n})}function Jse(e,t,n){const i=e._contentPropertyTableJsons,r=e._contentAvailabilityBitstreams,s=t.metadataSchema,o=e._contentMetadataTables;for(let a=0;a<i.length;a++){const c=i[a],h=r[a].availableCount,d=c.class,p=s.classes[d],g=new Hr({class:p,count:h,properties:c.properties,bufferViews:n});o.push(g)}}function DN(e){let t=0;const n=e.lengthBits,i=e.availableCount;let r;i<256?r=new Uint8Array(n):i<65536?r=new Uint16Array(n):r=new Uint32Array(n);for(let s=0;s<e.lengthBits;s++)e.getBit(s)&&(r[s]=t,t++);return r}function Qse(e){const t=DN(e._tileAvailability);e._tileJumpBuffer=t}function eoe(e){const t=e._contentJumpBuffers,n=e._contentAvailabilityBitstreams;for(let i=0;i<n.length;i++){const r=n[i],s=DN(r);t.push(s)}}Xi.prototype.getTileIndex=function(e){const t=e.level-this._implicitCoordinates.level;if(t<0||this._subtreeLevels<=t)throw new te("level is out of bounds for this subtree");return e.getSubtreeCoordinates().getOffsetCoordinates(e).tileIndex};Xi.prototype.getChildSubtreeIndex=function(e){if(e.level-this._implicitCoordinates.level!==this._implicitCoordinates.subtreeLevels)throw new te("level is out of bounds for this subtree");return e.getParentSubtreeCoordinates().getOffsetCoordinates(e).mortonIndex};function toe(e,t){if(!l(e._tileMetadataTable))return;const n=e.getTileIndex(t);if(e._tileAvailability.getBit(n))return e._tileJumpBuffer[n]}function noe(e,t,n){const i=e._contentMetadataTables;if(!l(i))return;const r=i[n];if(!l(r))return;const s=e._contentAvailabilityBitstreams[n],o=e.getTileIndex(t);if(s.getBit(o))return e._contentJumpBuffers[n][o]}Xi.prototype.getTileMetadataView=function(e){const t=toe(this,e);if(!l(t))return;const n=this._tileMetadataTable;return new Ia({class:n.class,metadataTable:n,entityId:t,propertyTableJson:this._tilePropertyTableJson})};Xi.prototype.getContentMetadataView=function(e,t){const n=noe(this,e,t);if(!l(n))return;const i=this._contentMetadataTables[t],r=this._contentPropertyTableJsons[t];return new Ia({class:i.class,metadataTable:i,entityId:n,contentIndex:t,propertyTableJson:r})};Xi.prototype.isDestroyed=function(){return!1};Xi.prototype.destroy=function(){return l(this._bufferLoader)&&Re.unload(this._bufferLoader),Ye(this)};const ioe={ID:"ID",NAME:"NAME",DESCRIPTION:"DESCRIPTION",TILESET_TILE_COUNT:"TILESET_TILE_COUNT",TILE_BOUNDING_BOX:"TILE_BOUNDING_BOX",TILE_BOUNDING_REGION:"TILE_BOUNDING_REGION",TILE_BOUNDING_SPHERE:"TILE_BOUNDING_SPHERE",TILE_MINIMUM_HEIGHT:"TILE_MINIMUM_HEIGHT",TILE_MAXIMUM_HEIGHT:"TILE_MAXIMUM_HEIGHT",TILE_HORIZON_OCCLUSION_POINT:"TILE_HORIZON_OCCLUSION_POINT",TILE_GEOMETRIC_ERROR:"TILE_GEOMETRIC_ERROR",CONTENT_BOUNDING_BOX:"CONTENT_BOUNDING_BOX",CONTENT_BOUNDING_REGION:"CONTENT_BOUNDING_REGION",CONTENT_BOUNDING_SPHERE:"CONTENT_BOUNDING_SPHERE",CONTENT_MINIMUM_HEIGHT:"CONTENT_MINIMUM_HEIGHT",CONTENT_MAXIMUM_HEIGHT:"CONTENT_MAXIMUM_HEIGHT",CONTENT_HORIZON_OCCLUSION_POINT:"CONTENT_HORIZON_OCCLUSION_POINT"},roe=Object.freeze(ioe),js={};js.parseAllBoundingVolumeSemantics=function(e){return y.typeOf.object("tileMetadata",e),{tile:{boundingVolume:js.parseBoundingVolumeSemantic("TILE",e),minimumHeight:js._parseMinimumHeight("TILE",e),maximumHeight:js._parseMaximumHeight("TILE",e)},content:{boundingVolume:js.parseBoundingVolumeSemantic("CONTENT",e),minimumHeight:js._parseMinimumHeight("CONTENT",e),maximumHeight:js._parseMaximumHeight("CONTENT",e)}}};js.parseBoundingVolumeSemantic=function(e,t){if(y.typeOf.string("prefix",e),e!=="TILE"&&e!=="CONTENT")throw new A("prefix must be either 'TILE' or 'CONTENT'");y.typeOf.object("tileMetadata",t);const n=`${e}_BOUNDING_BOX`,i=t.getPropertyBySemantic(n);if(l(i))return{box:i};const r=`${e}_BOUNDING_REGION`,s=t.getPropertyBySemantic(r);if(l(s))return{region:s};const o=`${e}_BOUNDING_SPHERE`,a=t.getPropertyBySemantic(o);if(l(a))return{sphere:a}};js._parseMinimumHeight=function(e,t){if(y.typeOf.string("prefix",e),e!=="TILE"&&e!=="CONTENT")throw new A("prefix must be either 'TILE' or 'CONTENT'");y.typeOf.object("tileMetadata",t);const n=`${e}_MINIMUM_HEIGHT`;return t.getPropertyBySemantic(n)};js._parseMaximumHeight=function(e,t){if(y.typeOf.string("prefix",e),e!=="TILE"&&e!=="CONTENT")throw new A("prefix must be either 'TILE' or 'CONTENT'");y.typeOf.object("tileMetadata",t);const n=`${e}_MAXIMUM_HEIGHT`;return t.getPropertyBySemantic(n)};function Ir(e,t,n){y.defined("tile.implicitTileset",t.implicitTileset),y.defined("tile.implicitCoordinates",t.implicitCoordinates);const i=t.implicitTileset,r=t.implicitCoordinates;this._implicitTileset=i,this._implicitCoordinates=r,this._implicitSubtree=void 0,this._tileset=e,this._tile=t,this._resource=n,this._metadata=void 0,this.featurePropertiesDirty=!1,this._group=void 0;const s=r.getTemplateValues(),o=i.subtreeUriTemplate.getDerivedResource({templateValues:s});this._url=o.getUrlComponent(!0),this._ready=!1}Object.defineProperties(Ir.prototype,{featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){}},ready:{get:function(){return this._ready}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._url}},metadata:{get:function(){},set:function(){throw new A("Implicit3DTileContent cannot have metadata")}},batchTable:{get:function(){}},group:{get:function(){return this._group},set:function(e){this._group=e}}});Ir.fromSubtreeJson=async function(e,t,n,i,r,s){if(y.defined("tile.implicitTileset",t.implicitTileset),y.defined("tile.implicitCoordinates",t.implicitCoordinates),l(i)===l(r))throw new A("One of json and arrayBuffer must be defined.");s=T(s,0);let o;l(r)&&(o=new Uint8Array(r,s));const a=t.implicitTileset,c=t.implicitCoordinates,u=await Xi.fromSubtreeJson(n,i,o,a,c),h=new Ir(e,t,n);return h._implicitSubtree=u,soe(h,u),h._ready=!0,h};function soe(e,t){const n=e._tile,i=e._implicitCoordinates.childIndex,r=aoe(e,t,n,i),s=e._tileset.statistics;n.children.push(r.rootTile),s.numberOfTilesTotal++;const o=ooe(e,t,r.bottomRow);for(let a=0;a<o.length;a++){const c=o[a],u=c.tile,h=goe(e,u,c.childIndex);u.children.push(h),s.numberOfTilesTotal++}}function ooe(e,t,n){const i=[],r=e._implicitTileset.branchingFactor;for(let s=0;s<n.length;s++){const o=n[s];if(l(o))for(let a=0;a<r;a++){const c=s*r+a;t.childSubtreeIsAvailableAtIndex(c)&&i.push({tile:o,childIndex:a})}}return i}function aoe(e,t,n,i){const o=v1(e,t,n,i,0,!0),a=e._tileset.statistics;let c=[o],u=[];const h=e._implicitTileset;for(let d=1;d<h.subtreeLevels;d++){const p=t.getLevelOffset(d),g=h.branchingFactor*c.length;for(let _=0;_<g;_++){const b=p+_;if(!t.tileIsAvailableAtIndex(b)){u.push(void 0);continue}const x=t.getParentMortonIndex(_),E=c[x],C=_%h.branchingFactor,w=v1(e,t,E,C,b);E.children.push(w),a.numberOfTilesTotal++,u.push(w)}c=u,u=[]}return{rootTile:o,bottomRow:c}}function MN(e,t,n){const i=roe.TILE_GEOMETRIC_ERROR;return l(e)&&e.hasPropertyBySemantic(i)?e.getPropertyBySemantic(i):t.geometricError/Math.pow(2,n.level)}function v1(e,t,n,i,r,s){const o=e._implicitTileset;let a;T(s,!1)?a=n.implicitCoordinates:a=n.implicitCoordinates.getChildCoordinates(i);let c,u,h;if(l(t.tilePropertyTableJson)){c=t.getTileMetadataView(a);const D=js.parseAllBoundingVolumeSemantics(c);u=D.tile,h=D.content}const p=t.contentPropertyTableJsons.length;let g=!1;for(let D=0;D<p;D++)if(t.contentIsAvailableAtCoordinates(a,D)){g=!0;break}const _=uoe(o,a,i,s,n,u),b=[];for(let D=0;D<o.contentCount;D++){if(!t.contentIsAvailableAtIndex(r,D))continue;const N={uri:o.contentUriTemplates[D].getDerivedResource({templateValues:a.getTemplateValues()}).url},B=foe(_,h);l(B)&&(N.boundingVolume=B),b.push(wt(N,o.contentHeaders[D]))}const x=MN(c,o,a),E={boundingVolume:_,geometricError:x,refine:o.refine,contents:b},C=!0,w=Se(o.tileHeader,C);delete w.boundingVolume,delete w.transform,delete w.metadata;const S=wt(E,w,C),v=BN(e,o.baseResource,S,n);return v.implicitCoordinates=a,v.implicitSubtree=t,v.metadata=c,v.hasImplicitContentMetadata=g,v}function ny(e,t){return l(e)&&l(t)&&(l(t.minimumHeight)||l(t.maximumHeight))&&(oi(e,"3DTILES_bounding_volume_S2")||l(e.region))}function oE(e,t){l(t)&&(oi(e,"3DTILES_bounding_volume_S2")?loe(e.extensions["3DTILES_bounding_volume_S2"],t.minimumHeight,t.maximumHeight):l(e.region)&&coe(e.region,t.minimumHeight,t.maximumHeight))}function coe(e,t,n){l(t)&&(e[4]=t),l(n)&&(e[5]=n)}function loe(e,t,n){l(t)&&(e.minimumHeight=t),l(n)&&(e.maximumHeight=n)}function uoe(e,t,n,i,r,s){let o;return!l(s)||!l(s.boundingVolume)||!ny(s.boundingVolume,s)&&ny(e.boundingVolume,s)?o=LN(e,t,n,T(i,!1),r):o=s.boundingVolume,oE(o,s),o}function foe(e,t){let n;return l(t)&&(n=t.boundingVolume),ny(n,t)?oE(n,t):ny(e,t)&&(n=Se(e,!0),oE(n,t)),n}function LN(e,t,n,i,r){const s=e.boundingVolume;return oi(s,"3DTILES_bounding_volume_S2")?PN(i,r,n,t.level,t.x,t.y,t.z):l(s.region)?{region:FN(s.region,t.level,t.x,t.y,t.z)}:{box:NN(s.box,t.level,t.x,t.y,t.z)}}function PN(e,t,n,i,r,s,o){y.typeOf.bool("parentIsPlaceholderTile",e),y.typeOf.object("parentTile",t),y.typeOf.number("childIndex",n),y.typeOf.number("level",i),y.typeOf.number("x",r),y.typeOf.number("y",s),l(o)&&y.typeOf.number("z",o);const a=t._boundingVolume;if(e)return{extensions:{"3DTILES_bounding_volume_S2":{token:mn.getTokenFromId(a.s2Cell._cellId),minimumHeight:a.minimumHeight,maximumHeight:a.maximumHeight}}};const c=Number(t._boundingVolume.s2Cell._cellId>>BigInt(61)),u=c%2===0?W_.encode2D(i,r,s):W_.encode2D(i,s,r),h=mn.fromFacePositionLevel(c,BigInt(u),i);let d,p;if(l(o)){const g=(a.maximumHeight+a.minimumHeight)/2;d=n<4?a.minimumHeight:g,p=n<4?g:a.maximumHeight}else d=a.minimumHeight,p=a.maximumHeight;return{extensions:{"3DTILES_bounding_volume_S2":{token:mn.getTokenFromId(h._cellId),minimumHeight:d,maximumHeight:p}}}}const hoe=new m,doe=new m,Q0=new m,poe=new H;function NN(e,t,n,i,r){if(y.typeOf.object("rootBox",e),y.typeOf.number("level",t),y.typeOf.number("x",n),y.typeOf.number("y",i),l(r)&&y.typeOf.number("z",r),t===0)return e;const s=m.unpack(e,0,doe),o=H.unpack(e,3,poe),a=Math.pow(2,-t),c=-1+(2*n+1)*a,u=-1+(2*i+1)*a;let h=0;const d=m.fromElements(a,a,1,hoe);l(r)&&(h=-1+(2*r+1)*a,d.z=a);let p=m.fromElements(c,u,h,Q0);p=H.multiplyByVector(o,p,Q0),p=m.add(p,s,Q0);let g=H.clone(o);g=H.multiplyByScale(g,d,g);const _=new Array(12);return m.pack(p,_),H.pack(g,_,3),_}const moe=new ie;function FN(e,t,n,i,r){if(y.typeOf.object("rootRegion",e),y.typeOf.number("level",t),y.typeOf.number("x",n),y.typeOf.number("y",i),l(r)&&y.typeOf.number("z",r),t===0)return e.slice();const s=ie.unpack(e,0,moe),o=e[4],a=e[5],c=Math.pow(2,-t),u=c*s.width,h=R.negativePiToPi(s.west+n*u),d=R.negativePiToPi(h+u),p=c*s.height,g=R.negativePiToPi(s.south+i*p),_=R.negativePiToPi(g+p);let b=o,x=a;if(l(r)){const E=c*(a-o);b+=r*E,x=b+E}return[h,g,d,_,b,x]}function goe(e,t,n){const i=e._implicitTileset,r=t.implicitCoordinates.getChildCoordinates(n),s=LN(i,r,n,!1,t),o=MN(void 0,i,r),a=i.subtreeUriTemplate.getDerivedResource({templateValues:r.getTemplateValues()}).url,c={boundingVolume:s,geometricError:o,refine:i.refine,contents:[{uri:a}]},u=BN(e,i.baseResource,c,t);return u.implicitTileset=i,u.implicitCoordinates=r,u}function BN(e,t,n,i){const r=e._tile.constructor;return new r(e._tileset,t,n,i)}Ir.prototype.hasProperty=function(e,t){return!1};Ir.prototype.getFeature=function(e){};Ir.prototype.applyDebugSettings=function(e,t){};Ir.prototype.applyStyle=function(e){};Ir.prototype.update=function(e,t){};Ir.prototype.pick=function(e,t,n){};Ir.prototype.isDestroyed=function(){return!1};Ir.prototype.destroy=function(){return this._implicitSubtree=this._implicitSubtree&&this._implicitSubtree.destroy(),Ye(this)};Ir._deriveBoundingBox=NN;Ir._deriveBoundingRegion=FN;Ir._deriveBoundingVolumeS2=PN;const _oe={NONE:0,REPEAT:1,MIRRORED_REPEAT:2},Df=Object.freeze(_oe);function vl(e,t){y.typeOf.object("normal",e),y.typeOf.number("distance",t),this._distance=t,this._normal=new zN(e,this),this.onChangeCallback=void 0,this.index=-1}Object.defineProperties(vl.prototype,{distance:{get:function(){return this._distance},set:function(e){y.typeOf.number("value",e),l(this.onChangeCallback)&&e!==this._distance&&this.onChangeCallback(this.index),this._distance=e}},normal:{get:function(){return this._normal},set:function(e){y.typeOf.object("value",e),l(this.onChangeCallback)&&!m.equals(this._normal._cartesian3,e)&&this.onChangeCallback(this.index),m.clone(e,this._normal._cartesian3)}}});vl.fromPlane=function(e,t){return y.typeOf.object("plane",e),l(t)?(t.normal=e.normal,t.distance=e.distance):t=new vl(e.normal,e.distance),t};vl.clone=function(e,t){return l(t)?(t.normal=e.normal,t.distance=e.distance,t):new vl(e.normal,e.distance)};function zN(e,t){this._clippingPlane=t,this._cartesian3=m.clone(e)}Object.defineProperties(zN.prototype,{x:{get:function(){return this._cartesian3.x},set:function(e){y.typeOf.number("value",e),l(this._clippingPlane.onChangeCallback)&&e!==this._cartesian3.x&&this._clippingPlane.onChangeCallback(this._clippingPlane.index),this._cartesian3.x=e}},y:{get:function(){return this._cartesian3.y},set:function(e){y.typeOf.number("value",e),l(this._clippingPlane.onChangeCallback)&&e!==this._cartesian3.y&&this._clippingPlane.onChangeCallback(this._clippingPlane.index),this._cartesian3.y=e}},z:{get:function(){return this._cartesian3.z},set:function(e){y.typeOf.number("value",e),l(this._clippingPlane.onChangeCallback)&&e!==this._cartesian3.z&&this._clippingPlane.onChangeCallback(this._clippingPlane.index),this._cartesian3.z=e}}});function di(e){e=T(e,T.EMPTY_OBJECT),this._planes=[],this._dirtyIndex=-1,this._multipleDirtyPlanes=!1,this._enabled=T(e.enabled,!0),this.modelMatrix=P.clone(T(e.modelMatrix,P.IDENTITY)),this.edgeColor=M.clone(T(e.edgeColor,M.WHITE)),this.edgeWidth=T(e.edgeWidth,0),this.planeAdded=new jt,this.planeRemoved=new jt,this._owner=void 0;const t=T(e.unionClippingRegions,!1);this._unionClippingRegions=t,this._testIntersection=t?UN:kN,this._uint8View=void 0,this._float32View=void 0,this._clippingPlanesTexture=void 0;const n=e.planes;if(l(n)){const i=n.length;for(let r=0;r<i;++r)this.add(n[r])}}function UN(e){return e===ut.OUTSIDE}function kN(e){return e===ut.INSIDE}Object.defineProperties(di.prototype,{length:{get:function(){return this._planes.length}},unionClippingRegions:{get:function(){return this._unionClippingRegions},set:function(e){this._unionClippingRegions!==e&&(this._unionClippingRegions=e,this._testIntersection=e?UN:kN)}},enabled:{get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e)}},texture:{get:function(){return this._clippingPlanesTexture}},owner:{get:function(){return this._owner}},clippingPlanesState:{get:function(){return this._unionClippingRegions?this._planes.length:-this._planes.length}}});function I1(e,t){e._multipleDirtyPlanes=e._multipleDirtyPlanes||e._dirtyIndex!==-1&&e._dirtyIndex!==t,e._dirtyIndex=t}di.prototype.add=function(e){const t=this._planes.length,n=this;e.onChangeCallback=function(i){I1(n,i)},e.index=t,I1(this,t),this._planes.push(e),this.planeAdded.raiseEvent(e,t)};di.prototype.get=function(e){return y.typeOf.number("index",e),this._planes[e]};function jN(e,t){const n=e.length;for(let i=0;i<n;++i)if(Ve.equals(e[i],t))return i;return-1}di.prototype.contains=function(e){return jN(this._planes,e)!==-1};di.prototype.remove=function(e){const t=this._planes,n=jN(t,e);if(n===-1)return!1;e instanceof vl&&(e.onChangeCallback=void 0,e.index=-1);const i=t.length-1;for(let r=n;r<i;++r){const s=t[r+1];t[r]=s,s instanceof vl&&(s.index=r)}return this._multipleDirtyPlanes=!0,t.length=i,this.planeRemoved.raiseEvent(e,n),!0};di.prototype.removeAll=function(){const e=this._planes,t=e.length;for(let n=0;n<t;++n){const i=e[n];i instanceof vl&&(i.onChangeCallback=void 0,i.index=-1),this.planeRemoved.raiseEvent(i,n)}this._multipleDirtyPlanes=!0,this._planes=[]};const yoe=new Y,boe=new Y;function O1(e,t,n){const i=e._uint8View,r=e._planes;let s=0;for(let o=t;o<n;++o){const a=r[o],c=nt.octEncodeToCartesian4(a.normal,boe);i[s]=c.x,i[s+1]=c.y,i[s+2]=c.z,i[s+3]=c.w;const u=Y.packFloat(a.distance,yoe);i[s+4]=u.x,i[s+5]=u.y,i[s+6]=u.z,i[s+7]=u.w,s+=8}}function R1(e,t,n){const i=e._float32View,r=e._planes;let s=0;for(let o=t;o<n;++o){const a=r[o],c=a.normal;i[s]=c.x,i[s+1]=c.y,i[s+2]=c.z,i[s+3]=a.distance,s+=4}}function VN(e,t){const n=We.maximumTextureSize;return t.x=Math.min(e,n),t.y=Math.ceil(e/t.x),t}const Toe=new k;di.prototype.update=function(e){let t=this._clippingPlanesTexture;const n=e.context,i=di.useFloatTexture(n),r=i?this.length:this.length*2;if(l(t)){const o=t.width*t.height;(o<r||r<.25*o)&&(t.destroy(),t=void 0,this._clippingPlanesTexture=void 0)}if(this.length===0)return;if(!l(t)){const o=VN(r,Toe);o.y*=2,i?(t=new kt({context:n,width:o.x,height:o.y,pixelFormat:Le.RGBA,pixelDatatype:De.FLOAT,sampler:Cn.NEAREST,flipY:!1}),this._float32View=new Float32Array(o.x*o.y*4)):(t=new kt({context:n,width:o.x,height:o.y,pixelFormat:Le.RGBA,pixelDatatype:De.UNSIGNED_BYTE,sampler:Cn.NEAREST,flipY:!1}),this._uint8View=new Uint8Array(o.x*o.y*4)),this._clippingPlanesTexture=t,this._multipleDirtyPlanes=!0}const s=this._dirtyIndex;if(!(!this._multipleDirtyPlanes&&s===-1)){if(this._multipleDirtyPlanes)i?(R1(this,0,this._planes.length),t.copyFrom({source:{width:t.width,height:t.height,arrayBufferView:this._float32View}})):(O1(this,0,this._planes.length),t.copyFrom({source:{width:t.width,height:t.height,arrayBufferView:this._uint8View}}));else{let o=0,a=0;i?(a=Math.floor(s/t.width),o=Math.floor(s-a*t.width),R1(this,s,s+1),t.copyFrom({source:{width:1,height:1,arrayBufferView:this._float32View},xOffset:o,yOffset:a})):(a=Math.floor(s*2/t.width),o=Math.floor(s*2-a*t.width),O1(this,s,s+1),t.copyFrom({source:{width:2,height:1,arrayBufferView:this._uint8View},xOffset:o,yOffset:a}))}this._multipleDirtyPlanes=!1,this._dirtyIndex=-1}};const xoe=new P,D1=new Ve(m.UNIT_X,0);di.prototype.computeIntersectionWithBoundingVolume=function(e,t){const n=this._planes,i=n.length;let r=this.modelMatrix;l(t)&&(r=P.multiply(t,r,xoe));let s=ut.INSIDE;!this.unionClippingRegions&&i>0&&(s=ut.OUTSIDE);for(let o=0;o<i;++o){const a=n[o];Ve.transform(a,r,D1);const c=e.intersectPlane(D1);if(c===ut.INTERSECTING)s=c;else if(this._testIntersection(c))return c}return s};di.setOwner=function(e,t,n){if(e!==t[n]&&(t[n]=t[n]&&t[n].destroy(),l(e))){if(l(e._owner))throw new A("ClippingPlaneCollection should only be assigned to one object");e._owner=t,t[n]=e}};di.useFloatTexture=function(e){return e.floatingPointTexture};di.getTextureResolution=function(e,t,n){const i=e.texture;if(l(i))return n.x=i.width,n.y=i.height,n;const r=di.useFloatTexture(t)?e.length:e.length*2,s=VN(r,n);return s.y*=2,s};di.prototype.isDestroyed=function(){return!1};di.prototype.destroy=function(){return this._clippingPlanesTexture=this._clippingPlanesTexture&&this._clippingPlanesTexture.destroy(),Ye(this)};function Il(e){y.typeOf.object("options",e),y.typeOf.object("options.positions",e.positions),y.typeOf.number.greaterThanOrEquals("options.positions.length",e.positions.length,3),this._ellipsoid=T(e.ellipsoid,fe.default),this._positions=[...e.positions]}Object.defineProperties(Il.prototype,{length:{get:function(){return this._positions.length}},positions:{get:function(){return this._positions}},ellipsoid:{get:function(){return this._ellipsoid}}});Il.clone=function(e,t){return y.typeOf.object("polygon",e),l(t)?(t._ellipsoid=e.ellipsoid,t._positions.length=0,t._positions.push(...e.positions),t):new Il({positions:e.positions,ellipsoid:e.ellipsoid})};Il.equals=function(e,t){return y.typeOf.object("left",e),y.typeOf.object("right",t),e.ellipsoid.equals(t.ellipsoid)&&e.positions===t.positions};Il.prototype.computeRectangle=function(e){return io.computeRectangleFromPositions(this.positions,this.ellipsoid,void 0,e)};const Eoe=new ie,M1=new m;Il.prototype.computeSphericalExtents=function(e){l(e)||(e=new ie);const t=this.computeRectangle(Eoe);let n=oe.toCartesian(ie.southwest(t),this.ellipsoid,M1),i=Math.sqrt(n.x*n.x+n.y*n.y),r=R.fastApproximateAtan2(i,n.z),s=R.fastApproximateAtan2(n.x,n.y);return e.south=r,e.west=s,n=oe.toCartesian(ie.northeast(t),this.ellipsoid,M1),i=Math.sqrt(n.x*n.x+n.y*n.y),r=R.fastApproximateAtan2(i,n.z),s=R.fastApproximateAtan2(n.x,n.y),e.north=r,e.east=s,e};const Coe=`in vec2 v_textureCoordinates;

uniform int u_polygonsLength;
uniform int u_extentsLength;
uniform highp sampler2D u_polygonTexture;
uniform highp sampler2D u_extentsTexture;

int getPolygonIndex(float dimension, vec2 coord) {
   vec2 uv = coord.xy * dimension;
   return int(floor(uv.y) * dimension + floor(uv.x));
}

vec2 getLookupUv(ivec2 dimensions, int i) {
    int pixY = i / dimensions.x;
    int pixX = i - (pixY * dimensions.x);
    float pixelWidth = 1.0 / float(dimensions.x);
    float pixelHeight = 1.0 / float(dimensions.y);
    float u = (float(pixX) + 0.5) * pixelWidth; // sample from center of pixel
    float v = (float(pixY) + 0.5) * pixelHeight;
    return vec2(u, v);
}

vec4 getExtents(int i) {
    return texture(u_extentsTexture, getLookupUv(textureSize(u_extentsTexture, 0), i));
}

ivec2 getPositionsLengthAndExtentsIndex(int i) {
    vec2 uv = getLookupUv(textureSize(u_polygonTexture, 0), i);
    vec4 value = texture(u_polygonTexture, uv);
    return ivec2(int(value.x), int(value.y));
}

vec2 getPolygonPosition(int i) {
    vec2 uv = getLookupUv(textureSize(u_polygonTexture, 0), i);
    return texture(u_polygonTexture, uv).xy;
}

vec2 getCoordinates(vec2 textureCoordinates, vec4 extents) {
    float latitude = mix(extents.x, extents.x + 1.0 / extents.z, textureCoordinates.y);
    float longitude = mix(extents.y, extents.y + 1.0 / extents.w, textureCoordinates.x);
    return vec2(latitude, longitude);
}

void main() {
    int lastPolygonIndex = 0;
    out_FragColor = vec4(1.0);

    // Get the relevant region of the texture
    float dimension = float(u_extentsLength);
    if (u_extentsLength > 2) {
        dimension = ceil(log2(float(u_extentsLength)));
    }
    int regionIndex = getPolygonIndex(dimension, v_textureCoordinates);

    for (int polygonIndex = 0; polygonIndex < u_polygonsLength; polygonIndex++) {
        ivec2 positionsLengthAndExtents = getPositionsLengthAndExtentsIndex(lastPolygonIndex);
        int positionsLength = positionsLengthAndExtents.x;
        int polygonExtentsIndex = positionsLengthAndExtents.y;
        lastPolygonIndex += 1;

         // Only compute signed distance for the relevant part of the atlas
         if (polygonExtentsIndex == regionIndex) {
            float clipAmount = czm_infinity;
            vec4 extents = getExtents(polygonExtentsIndex);
            vec2 textureOffset = vec2(mod(float(polygonExtentsIndex), dimension), floor(float(polygonExtentsIndex) / dimension)) / dimension;
            vec2 p = getCoordinates((v_textureCoordinates - textureOffset) * dimension, extents);
            float s = 1.0;

            // Check each edge for absolute distance
            for (int i = 0, j = positionsLength - 1; i < positionsLength; j = i, i++) {
                vec2 a = getPolygonPosition(lastPolygonIndex + i);
                vec2 b = getPolygonPosition(lastPolygonIndex + j);
 
                vec2 ab = b - a;
                vec2 pa = p - a;
                float t = dot(pa, ab) / dot(ab, ab);
                t = clamp(t, 0.0, 1.0);

                vec2 pq = pa - t * ab;
                float d = length(pq);

                // Inside / outside computation to determine sign
                bvec3 cond = bvec3(p.y >= a.y, 
                            p.y < b.y, 
                            ab.x * pa.y > ab.y * pa.x);
                if (all(cond) || all(not(cond))) s = -s;
                if (abs(d) < abs(clipAmount)) {
                    clipAmount = d;
                }
            }

            // Normalize the range to [0,1]
            vec4 result = (s * vec4(clipAmount * length(extents.zw))) / 2.0 + 0.5;
            // In the case where we've iterated through multiple polygons, take the minimum
            out_FragColor = min(out_FragColor, result);
         }

        lastPolygonIndex += positionsLength;
    }
}`;function jn(e){e=T(e,T.EMPTY_OBJECT),this._polygons=[],this._totalPositions=0,this.enabled=T(e.enabled,!0),this.inverse=T(e.inverse,!1),this.polygonAdded=new jt,this.polygonRemoved=new jt,this._owner=void 0,this._float32View=void 0,this._extentsFloat32View=void 0,this._extentsCount=0,this._polygonsTexture=void 0,this._extentsTexture=void 0,this._signedDistanceTexture=void 0,this._signedDistanceComputeCommand=void 0;const t=e.polygons;if(l(t)){const n=t.length;for(let i=0;i<n;++i)this._polygons.push(t[i])}}Object.defineProperties(jn.prototype,{length:{get:function(){return this._polygons.length}},totalPositions:{get:function(){return this._totalPositions}},extentsTexture:{get:function(){return this._extentsTexture}},extentsCount:{get:function(){return this._extentsCount}},pixelsNeededForExtents:{get:function(){return this.length}},pixelsNeededForPolygonPositions:{get:function(){return this.totalPositions+this.length}},clippingTexture:{get:function(){return this._signedDistanceTexture}},owner:{get:function(){return this._owner}},clippingPolygonsState:{get:function(){return this.inverse?-this.extentsCount:this.extentsCount}}});jn.prototype.add=function(e){y.typeOf.object("polygon",e);const t=this._polygons.length;return this._polygons.push(e),this.polygonAdded.raiseEvent(e,t),e};jn.prototype.get=function(e){return y.typeOf.number("index",e),this._polygons[e]};jn.prototype.contains=function(e){return y.typeOf.object("polygon",e),this._polygons.some(t=>Il.equals(t,e))};jn.prototype.remove=function(e){y.typeOf.object("polygon",e);const t=this._polygons,n=t.findIndex(i=>Il.equals(i,e));return n===-1?!1:(t.splice(n,1),this.polygonRemoved.raiseEvent(e,n),!0)};const woe=new ie;function Aoe(e){const t=[],n=[],i=e.length;for(let s=0;s<i;++s){const a=e[s].computeSphericalExtents();let c=Math.max(a.height*2.5,.001),u=Math.max(a.width*2.5,.001),h=ie.clone(a);h.south-=c,h.west-=u,h.north+=c,h.east+=u,h.south=Math.max(h.south,-Math.PI),h.west=Math.max(h.west,-Math.PI),h.north=Math.min(h.north,Math.PI),h.east=Math.min(h.east,Math.PI);const d=[s];for(let p=0;p<t.length;++p){const g=t[p];if(l(g)&&l(ie.simpleIntersection(g,h))&&!ie.equals(g,h)){const _=n[p];d.push(..._),_.reduce((b,x)=>ie.union(e[x].computeSphericalExtents(woe),b,b),a),t[p]=void 0,n[p]=void 0,c=Math.max(a.height*2.5,.001),u=Math.max(a.width*2.5,.001),h=ie.clone(a,h),h.south-=c,h.west-=u,h.north+=c,h.east+=u,h.south=Math.max(h.south,-Math.PI),h.west=Math.max(h.west,-Math.PI),h.north=Math.min(h.north,Math.PI),h.east=Math.min(h.east,Math.PI),p=-1}}t.push(h),n.push(d)}const r=new Map;return n.filter(l).forEach((s,o)=>s.forEach(a=>r.set(a,o))),{extentsList:t.filter(l),extentsIndexByPolygon:r}}jn.prototype.removeAll=function(){const e=this._polygons,t=e.length;for(let n=0;n<t;++n){const i=e[n];this.polygonRemoved.raiseEvent(i,n)}this._polygons=[]};function Soe(e){const t=e._float32View,n=e._extentsFloat32View,i=e._polygons,{extentsList:r,extentsIndexByPolygon:s}=Aoe(i);let o=0;for(const[c,u]of i.entries()){const h=u.length;t[o++]=h,t[o++]=s.get(c);for(let d=0;d<h;++d){const p=u.positions[d],g=Math.hypot(p.x,p.y),_=R.fastApproximateAtan2(g,p.z),b=R.fastApproximateAtan2(p.x,p.y);t[o++]=_,t[o++]=b}}let a=0;for(const c of r){const u=1/(c.east-c.west),h=1/(c.north-c.south);n[a++]=c.south,n[a++]=c.west,n[a++]=h,n[a++]=u}e._extentsCount=r.length}const eT=new k;jn.prototype.update=function(e){const t=e.context;if(!jn.isSupported(e))throw new te("ClippingPolygonCollections are only supported for WebGL 2.");const n=this._polygons.reduce((o,a)=>o+a.length,0);if(n===this.totalPositions||(this._totalPositions=n,this.length===0))return;l(this._signedDistanceComputeCommand)&&(this._signedDistanceComputeCommand.canceled=!0,this._signedDistanceComputeCommand=void 0);let i=this._polygonsTexture,r=this._extentsTexture,s=this._signedDistanceTexture;if(l(i)){const o=i.width*i.height;(o<this.pixelsNeededForPolygonPositions||this.pixelsNeededForPolygonPositions<.25*o)&&(i.destroy(),i=void 0,this._polygonsTexture=void 0)}if(!l(i)){const o=jn.getTextureResolution(i,this.pixelsNeededForPolygonPositions,eT);i=new kt({context:t,width:o.x,height:o.y,pixelFormat:Le.RG,pixelDatatype:De.FLOAT,sampler:Cn.NEAREST,flipY:!1}),this._float32View=new Float32Array(o.x*o.y*2),this._polygonsTexture=i}if(l(r)){const o=r.width*r.height;(o<this.pixelsNeededForExtents||this.pixelsNeededForExtents<.25*o)&&(r.destroy(),r=void 0,this._extentsTexture=void 0)}if(!l(r)){const o=jn.getTextureResolution(r,this.pixelsNeededForExtents,eT);r=new kt({context:t,width:o.x,height:o.y,pixelFormat:Le.RGBA,pixelDatatype:De.FLOAT,sampler:Cn.NEAREST,flipY:!1}),this._extentsFloat32View=new Float32Array(o.x*o.y*4),this._extentsTexture=r}if(Soe(this),r.copyFrom({source:{width:r.width,height:r.height,arrayBufferView:this._extentsFloat32View}}),i.copyFrom({source:{width:i.width,height:i.height,arrayBufferView:this._float32View}}),!l(s)){const o=jn.getClippingDistanceTextureResolution(this,eT);s=new kt({context:t,width:o.x,height:o.y,pixelFormat:t.webgl2?Le.RED:Le.LUMINANCE,pixelDatatype:De.FLOAT,sampler:new Cn({wrapS:ii.CLAMP_TO_EDGE,wrapT:ii.CLAMP_TO_EDGE,minificationFilter:Ut.LINEAR,magnificationFilter:ws.LINEAR}),flipY:!1}),this._signedDistanceTexture=s}this._signedDistanceComputeCommand=voe(this)};jn.prototype.queueCommands=function(e){l(this._signedDistanceComputeCommand)&&e.commandList.push(this._signedDistanceComputeCommand)};function voe(e){const t=e._polygonsTexture,n=e._extentsTexture;return new Ip({fragmentShaderSource:Coe,outputTexture:e._signedDistanceTexture,uniformMap:{u_polygonsLength:function(){return e.length},u_extentsLength:function(){return e.extentsCount},u_extentsTexture:function(){return n},u_polygonTexture:function(){return t}},persists:!1,owner:e,postExecute:()=>{e._signedDistanceComputeCommand=void 0}})}const L1=new ie,Ioe=new ie;jn.prototype.computeIntersectionWithBoundingVolume=function(e,t){var s;const n=this._polygons,i=n.length;let r=ut.OUTSIDE;this.inverse&&(r=ut.INSIDE);for(let o=0;o<i;++o){const c=n[o].computeRectangle();let u=e.rectangle;if(!l(u)&&l((s=e.boundingVolume)==null?void 0:s.computeCorners)){const d=e.boundingVolume.computeCorners();u=ie.fromCartesianArray(d,t,L1)}l(u)||(u=ie.fromBoundingSphere(e.boundingSphere,t,L1));const h=ie.simpleIntersection(u,c,Ioe);l(h)&&(r=ut.INTERSECTING)}return r};jn.setOwner=function(e,t,n){if(e!==t[n]&&(t[n]=t[n]&&t[n].destroy(),l(e))){if(l(e._owner))throw new A("ClippingPolygonCollection should only be assigned to one object");e._owner=t,t[n]=e}};jn.isSupported=function(e){return e==null?void 0:e.context.webgl2};jn.getTextureResolution=function(e,t,n){if(l(e))return n.x=e.width,n.y=e.height,n;const i=We.maximumTextureSize;return n.x=Math.min(t,i),n.y=Math.ceil(t/n.x),n.y*=2,n};jn.getClippingDistanceTextureResolution=function(e,t){const n=e.signedDistanceTexture;return l(n)?(t.x=n.width,t.y=n.height,t):(t.x=Math.min(We.maximumTextureSize,4096),t.y=Math.min(We.maximumTextureSize,4096),t)};jn.getClippingExtentsTextureResolution=function(e,t){const n=e.extentsTexture;return l(n)?(t.x=n.width,t.y=n.height,t):jn.getTextureResolution(n,e.pixelsNeededForExtents,t)};jn.prototype.isDestroyed=function(){return!1};jn.prototype.destroy=function(){return l(this._signedDistanceComputeCommand)&&(this._signedDistanceComputeCommand.canceled=!0),this._polygonsTexture=this._polygonsTexture&&this._polygonsTexture.destroy(),this._extentsTexture=this._extentsTexture&&this._extentsTexture.destroy(),this._signedDistanceTexture=this._signedDistanceTexture&&this._signedDistanceTexture.destroy(),Ye(this)};const Bd={HIGHLIGHT:0,REPLACE:1,MIX:2};Bd.getColorBlend=function(e,t){if(e===Bd.HIGHLIGHT)return 0;if(e===Bd.REPLACE)return 1;if(e===Bd.MIX)return R.clamp(t,R.EPSILON4,1)};const vw=Object.freeze(Bd),GN={};function Bu(e){y.typeOf.number.greaterThan("options.count",e.count,0),y.typeOf.object("options.properties",e.properties),this._count=e.count,this._properties=Se(e.properties,!0)}Bu.prototype.hasProperty=function(e){return He.hasProperty(e,this._properties,GN)};Bu.prototype.getPropertyIds=function(e){return He.getPropertyIds(this._properties,GN,e)};Bu.prototype.getProperty=function(e,t){if(y.typeOf.number("index",e),y.typeOf.string("propertyId",t),e<0||e>=this._count)throw new A(`index must be in the range [0, ${this._count})`);const n=this._properties[t];if(l(n))return Se(n[e],!0)};Bu.prototype.setProperty=function(e,t,n){if(y.typeOf.number("index",e),y.typeOf.string("propertyId",t),e<0||e>=this._count)throw new A(`index must be in the range [0, ${this._count})`);let i=this._properties[t];l(i)||(i=new Array(this._count),this._properties[t]=i),i[e]=Se(n,!0)};function mi(e){e=T(e,T.EMPTY_OBJECT),y.typeOf.number("options.count",e.count),this._name=e.name,this._id=e.id,this._count=e.count,this._extras=e.extras,this._extensions=e.extensions,this._metadataTable=e.metadataTable,this._jsonMetadataTable=e.jsonMetadataTable,this._batchTableHierarchy=e.batchTableHierarchy}Object.defineProperties(mi.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},count:{get:function(){return this._count}},class:{get:function(){if(l(this._metadataTable))return this._metadataTable.class}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}},byteLength:{get:function(){let e=0;return l(this._metadataTable)&&(e+=this._metadataTable.byteLength),l(this._batchTableHierarchy)&&(e+=this._batchTableHierarchy.byteLength),e}}});mi.prototype.hasProperty=function(e,t){return y.typeOf.number("index",e),y.typeOf.string("propertyId",t),!!(l(this._metadataTable)&&this._metadataTable.hasProperty(t)||l(this._batchTableHierarchy)&&this._batchTableHierarchy.hasProperty(e,t)||l(this._jsonMetadataTable)&&this._jsonMetadataTable.hasProperty(t))};mi.prototype.hasPropertyBySemantic=function(e,t){return y.typeOf.number("index",e),y.typeOf.string("semantic",t),l(this._metadataTable)?this._metadataTable.hasPropertyBySemantic(t):!1};mi.prototype.propertyExists=function(e){return y.typeOf.string("propertyId",e),!!(l(this._metadataTable)&&this._metadataTable.hasProperty(e)||l(this._batchTableHierarchy)&&this._batchTableHierarchy.propertyExists(e)||l(this._jsonMetadataTable)&&this._jsonMetadataTable.hasProperty(e))};mi.prototype.propertyExistsBySemantic=function(e){return y.typeOf.string("semantic",e),l(this._metadataTable)?this._metadataTable.hasPropertyBySemantic(e):!1};const tT=[];mi.prototype.getPropertyIds=function(e,t){return t=l(t)?t:[],t.length=0,l(this._metadataTable)&&t.push.apply(t,this._metadataTable.getPropertyIds(tT)),l(this._batchTableHierarchy)&&t.push.apply(t,this._batchTableHierarchy.getPropertyIds(e,tT)),l(this._jsonMetadataTable)&&t.push.apply(t,this._jsonMetadataTable.getPropertyIds(tT)),t};mi.prototype.getProperty=function(e,t){let n;if(l(this._metadataTable)&&(n=this._metadataTable.getProperty(e,t),l(n))||l(this._batchTableHierarchy)&&(n=this._batchTableHierarchy.getProperty(e,t),l(n))||l(this._jsonMetadataTable)&&(n=this._jsonMetadataTable.getProperty(e,t),l(n)))return n};mi.prototype.setProperty=function(e,t,n){l(this._metadataTable)&&this._metadataTable.setProperty(e,t,n)||l(this._batchTableHierarchy)&&this._batchTableHierarchy.setProperty(e,t,n)||(l(this._jsonMetadataTable)||(this._jsonMetadataTable=new Bu({count:this._count,properties:{}})),this._jsonMetadataTable.setProperty(e,t,n))};mi.prototype.getPropertyBySemantic=function(e,t){if(l(this._metadataTable))return this._metadataTable.getPropertyBySemantic(e,t)};mi.prototype.setPropertyBySemantic=function(e,t,n){return l(this._metadataTable)?this._metadataTable.setPropertyBySemantic(e,t,n):!1};mi.prototype.getPropertyTypedArray=function(e){if(y.typeOf.string("propertyId",e),l(this._metadataTable))return this._metadataTable.getPropertyTypedArray(e)};mi.prototype.getPropertyTypedArrayBySemantic=function(e){if(y.typeOf.string("semantic",e),l(this._metadataTable))return this._metadataTable.getPropertyTypedArrayBySemantic(e)};function Iw(e,t){if(!l(e)||e<0||e>=t)throw new A(`featureId is required and must be between zero and featuresLength - 1 (${t}`-+").")}mi.prototype.isClass=function(e,t){Iw(e,this.count),y.typeOf.string("className",t);const n=this._batchTableHierarchy;return l(n)?n.isClass(e,t):!1};mi.prototype.isExactClass=function(e,t){return Iw(e,this.count),y.typeOf.string("className",t),this.getExactClassName(e)===t};mi.prototype.getExactClassName=function(e){Iw(e,this.count);const t=this._batchTableHierarchy;if(l(t))return t.getClassName(e)};function lm(e){e=T(e,T.EMPTY_OBJECT);const t=e.property,n=e.classProperty,i=e.textures;y.typeOf.object("options.property",t),y.typeOf.object("options.classProperty",n),y.typeOf.object("options.textures",i);const r=l(t.channels)?t.channels:[0],s=t,o=Ta.createModelTextureReader({textureInfo:s,channels:Doe(r),texture:i[s.index]});this._min=t.min,this._max=t.max;let a=t.offset,c=t.scale;const u=n.hasValueTransform||l(a)||l(c);a=T(a,n.offset),c=T(c,n.scale),a=n.unpackVectorAndMatrixTypes(a),c=n.unpackVectorAndMatrixTypes(c),this._offset=a,this._scale=c,this._hasValueTransform=u,this._textureReader=o,this._classProperty=n,this._extras=t.extras,this._extensions=t.extensions}Object.defineProperties(lm.prototype,{textureReader:{get:function(){return this._textureReader}},hasValueTransform:{get:function(){return this._hasValueTransform}},offset:{get:function(){return this._offset}},scale:{get:function(){return this._scale}},classProperty:{get:function(){return this._classProperty}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});lm.prototype.isGpuCompatible=function(){const e=this._classProperty,t=e.type,n=e.componentType;return e.isArray?!e.isVariableLengthArray&&e.arrayLength<=4&&t===at.SCALAR&&n===ct.UINT8:at.isVectorType(t)||t===at.SCALAR?n===ct.UINT8:!1};const Ooe=[void 0,"float","vec2","vec3","vec4"],Roe=[void 0,"int","ivec2","ivec3","ivec4"];lm.prototype.getGlslType=function(){const e=this._classProperty;let t=at.getComponentCount(e.type);return e.isArray&&(t=e.arrayLength),e.normalized?Ooe[t]:Roe[t]};lm.prototype.unpackInShader=function(e){return this._classProperty.normalized?e:`${this.getGlslType()}(255.0 * ${e})`};function Doe(e){return e.map(function(t){return"rgba".charAt(t)}).join("")}function eb(e){e=T(e,T.EMPTY_OBJECT);const t=e.propertyTexture,n=e.class,i=e.textures;y.typeOf.object("options.propertyTexture",t),y.typeOf.object("options.class",n),y.typeOf.object("options.textures",i);const r=t.extensions,s=t.extras,o={};if(l(t.properties))for(const a in t.properties)t.properties.hasOwnProperty(a)&&(o[a]=new lm({property:t.properties[a],classProperty:n.properties[a],textures:i}));this._name=e.name,this._id=e.id,this._class=n,this._properties=o,this._extras=s,this._extensions=r}Object.defineProperties(eb.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},class:{get:function(){return this._class}},properties:{get:function(){return this._properties}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});eb.prototype.getProperty=function(e){return y.typeOf.string("propertyId",e),this._properties[e]};function HN(e){e=T(e,T.EMPTY_OBJECT);const t=e.property,n=e.classProperty;y.typeOf.object("options.property",t),y.typeOf.object("options.classProperty",n),this._attribute=t.attribute,this._classProperty=n,this._min=t.min,this._max=t.max;let i=t.offset,r=t.scale;const s=n.hasValueTransform||l(i)||l(r);i=T(i,n.offset),r=T(r,n.scale),i=n.unpackVectorAndMatrixTypes(i),r=n.unpackVectorAndMatrixTypes(r),this._offset=i,this._scale=r,this._hasValueTransform=s,this._extras=t.extras,this._extensions=t.extensions}Object.defineProperties(HN.prototype,{attribute:{get:function(){return this._attribute}},hasValueTransform:{get:function(){return this._hasValueTransform}},offset:{get:function(){return this._offset}},scale:{get:function(){return this._scale}},classProperty:{get:function(){return this._classProperty}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});function tb(e){e=T(e,T.EMPTY_OBJECT);const t=e.propertyAttribute,n=e.class;y.typeOf.object("options.propertyAttribute",t),y.typeOf.object("options.class",n);const i={};if(l(t.properties))for(const r in t.properties)t.properties.hasOwnProperty(r)&&(i[r]=new HN({property:t.properties[r],classProperty:n.properties[r]}));this._name=e.name,this._id=e.id,this._class=n,this._properties=i,this._extras=t.extras,this._extensions=t.extensions}Object.defineProperties(tb.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},class:{get:function(){return this._class}},properties:{get:function(){return this._properties}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});tb.prototype.getProperty=function(e){return y.typeOf.string("propertyId",e),this._properties[e]};function zo(e){e=T(e,T.EMPTY_OBJECT),y.typeOf.object("options.schema",e.schema),this._schema=e.schema;const t=e.propertyTables;this._propertyTableCount=l(t)?t.length:0,this._propertyTables=t,this._propertyTextures=e.propertyTextures,this._propertyAttributes=e.propertyAttributes,this._statistics=e.statistics,this._extras=e.extras,this._extensions=e.extensions}Object.defineProperties(zo.prototype,{schema:{get:function(){return this._schema}},statistics:{get:function(){return this._statistics}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}},propertyTableCount:{get:function(){return this._propertyTableCount}},propertyTables:{get:function(){return this._propertyTables}},propertyTextures:{get:function(){return this._propertyTextures}},propertyAttributes:{get:function(){return this._propertyAttributes}},propertyTablesByteLength:{get:function(){if(!l(this._propertyTables))return 0;let e=0;const t=this._propertyTables.length;for(let n=0;n<t;n++)e+=this._propertyTables[n].byteLength;return e}}});zo.prototype.getPropertyTable=function(e){return y.typeOf.number("propertyTableId",e),this._propertyTables[e]};zo.prototype.getPropertyTexture=function(e){return y.typeOf.number("propertyTextureId",e),this._propertyTextures[e]};zo.prototype.getPropertyAttribute=function(e){return y.typeOf.number("propertyAttributeId",e),this._propertyAttributes[e]};function Moe(e){e=T(e,T.EMPTY_OBJECT);const t=e.extension,n=e.schema;y.typeOf.object("options.extension",t),y.typeOf.object("options.schema",n);const i=[];if(l(t.propertyTables))for(let o=0;o<t.propertyTables.length;o++){const a=t.propertyTables[o],c=n.classes[a.class],u=new Hr({count:a.count,properties:a.properties,class:c,bufferViews:e.bufferViews});i.push(new mi({id:o,name:a.name,count:a.count,metadataTable:u,extras:a.extras,extensions:a.extensions}))}const r=[];if(l(t.propertyTextures))for(let o=0;o<t.propertyTextures.length;o++){const a=t.propertyTextures[o];r.push(new eb({id:o,name:a.name,propertyTexture:a,class:n.classes[a.class],textures:e.textures}))}const s=[];if(l(t.propertyAttributes))for(let o=0;o<t.propertyAttributes.length;o++){const a=t.propertyAttributes[o];s.push(new tb({id:o,name:a.name,class:n.classes[a.class],propertyAttribute:a}))}return new zo({schema:n,propertyTables:i,propertyTextures:r,propertyAttributes:s,statistics:t.statistics,extras:t.extras,extensions:t.extensions})}function Loe(e){e=T(e,T.EMPTY_OBJECT);const t=e.extension,n=e.schema;y.typeOf.object("options.extension",t),y.typeOf.object("options.schema",n);let i;const r=[];let s;if(l(t.featureTables))for(s=Object.keys(t.featureTables).sort(),i=0;i<s.length;i++){const a=s[i],c=t.featureTables[a],u=n.classes[c.class],h=new Hr({count:c.count,properties:c.properties,class:u,bufferViews:e.bufferViews});r.push(new mi({id:a,count:c.count,metadataTable:h,extras:c.extras,extensions:c.extensions}))}const o=[];if(l(t.featureTextures))for(s=Object.keys(t.featureTextures).sort(),i=0;i<s.length;i++){const a=s[i],c=t.featureTextures[a];o.push(new eb({id:a,propertyTexture:Poe(c),class:n.classes[c.class],textures:e.textures}))}return new zo({schema:n,propertyTables:r,propertyTextures:o,statistics:t.statistics,extras:t.extras,extensions:t.extensions})}function Poe(e){const t={class:e.class,properties:{}},n=e.properties;for(const i in n)if(n.hasOwnProperty(i)){const r=n[i],s={channels:Noe(r.channels),extras:r.extras,extensions:r.extensions};t.properties[i]=wt(r.texture,s,!0)}return t}function Noe(e){const t=e.length,n=new Array(t);for(let i=0;i<t;i++)n[i]="rgba".indexOf(e[i]);return n}function ll(e){e=T(e,T.EMPTY_OBJECT);const{gltf:t,extension:n,extensionLegacy:i,gltfResource:r,baseResource:s,supportedImageFormats:o,frameState:a,cacheKey:c,asynchronous:u=!0}=e;if(y.typeOf.object("options.gltf",t),y.typeOf.object("options.gltfResource",r),y.typeOf.object("options.baseResource",s),y.typeOf.object("options.supportedImageFormats",o),y.typeOf.object("options.frameState",a),!l(e.extension)&&!l(e.extensionLegacy))throw new A("One of options.extension or options.extensionLegacy must be specified");this._gltfResource=r,this._baseResource=s,this._gltf=t,this._extension=n,this._extensionLegacy=i,this._supportedImageFormats=o,this._frameState=a,this._cacheKey=c,this._asynchronous=u,this._bufferViewLoaders=[],this._bufferViewIds=[],this._textureLoaders=[],this._textureIds=[],this._schemaLoader=void 0,this._structuralMetadata=void 0,this._state=Oe.UNLOADED,this._promise=void 0}l(Object.create)&&(ll.prototype=Object.create(ai.prototype),ll.prototype.constructor=ll);Object.defineProperties(ll.prototype,{cacheKey:{get:function(){return this._cacheKey}},structuralMetadata:{get:function(){return this._structuralMetadata}}});async function Foe(e){try{const t=joe(e),n=Woe(e),i=$oe(e);return await Promise.all([t,n,i]),e.isDestroyed()?void 0:(e._gltf=void 0,e._state=Oe.LOADED,e)}catch(t){if(e.isDestroyed())return;throw e.unload(),e._state=Oe.FAILED,e.getError("Failed to load structural metadata",t)}}ll.prototype.load=function(){return l(this._promise)?this._promise:(this._state=Oe.LOADING,this._promise=Foe(this),this._promise)};function Boe(e,t){for(const n in e)if(e.hasOwnProperty(n)){const i=e[n],r=i.values,s=i.arrayOffsets,o=i.stringOffsets;l(r)&&(t[r]=!0),l(s)&&(t[s]=!0),l(o)&&(t[o]=!0)}}function zoe(e,t){for(const n in e)if(e.hasOwnProperty(n)){const i=e[n],r=i.bufferView,s=i.arrayOffsetBufferView,o=i.stringOffsetBufferView;l(r)&&(t[r]=!0),l(s)&&(t[s]=!0),l(o)&&(t[o]=!0)}}function Uoe(e){const t=e.propertyTables,n={};if(l(t))for(let i=0;i<t.length;i++){const r=t[i];Boe(r.properties,n)}return n}function koe(e){const t=e.featureTables,n={};if(l(t)){for(const i in t)if(t.hasOwnProperty(i)){const s=t[i].properties;l(s)&&zoe(s,n)}}return n}async function joe(e){let t;l(e._extension)?t=Uoe(e._extension):t=koe(e._extensionLegacy);const n=[];for(const i in t)if(t.hasOwnProperty(i)){const r=Re.getBufferViewLoader({gltf:e._gltf,bufferViewId:parseInt(i),gltfResource:e._gltfResource,baseResource:e._baseResource});e._bufferViewLoaders.push(r),e._bufferViewIds.push(i),n.push(r.load())}return Promise.all(n)}function Voe(e){const t={},n=e.propertyTextures;if(l(n))for(let i=0;i<n.length;i++){const s=n[i].properties;l(s)&&Goe(s,t)}return t}function Goe(e,t){for(const n in e)if(e.hasOwnProperty(n)){const i=e[n];t[i.index]=i}}function Hoe(e){const t={},n=e.featureTextures;if(l(n)){for(const i in n)if(n.hasOwnProperty(i)){const s=n[i].properties;l(s)&&qoe(s,t)}}return t}function qoe(e,t){for(const n in e)if(e.hasOwnProperty(n)){const r=e[n].texture;t[r.index]=r}}function Woe(e){let t;l(e._extension)?t=Voe(e._extension):t=Hoe(e._extensionLegacy);const n=e._gltf,i=e._gltfResource,r=e._baseResource,s=e._supportedImageFormats,o=e._frameState,a=e._asynchronous,c=[];for(const u in t)if(t.hasOwnProperty(u)){const h=Re.getTextureLoader({gltf:n,textureInfo:t[u],gltfResource:i,baseResource:r,supportedImageFormats:s,frameState:o,asynchronous:a});e._textureLoaders.push(h),e._textureIds.push(u),c.push(h.load())}return Promise.all(c)}async function $oe(e){const t=T(e._extension,e._extensionLegacy);let n;if(l(t.schemaUri)){const i=e._baseResource.getDerivedResource({url:t.schemaUri});n=Re.getSchemaLoader({resource:i})}else n=Re.getSchemaLoader({schema:t.schema});if(e._schemaLoader=n,await n.load(),!n.isDestroyed())return n.schema}ll.prototype.process=function(e){if(y.typeOf.object("frameState",e),this._state===Oe.READY)return!0;if(this._state!==Oe.LOADED)return!1;const t=this._textureLoaders,n=t.length;let i=!0;for(let a=0;a<n;++a){const u=t[a].process(e);i=i&&u}if(!i)return!1;const r=this._schemaLoader.schema,s={};for(let a=0;a<this._bufferViewIds.length;++a){const c=this._bufferViewIds[a],u=this._bufferViewLoaders[a];if(!u.isDestroyed()){const h=new Uint8Array(u.typedArray);s[c]=h}}const o={};for(let a=0;a<this._textureIds.length;++a){const c=this._textureIds[a],u=t[a];u.isDestroyed()||(o[c]=u.texture)}return l(this._extension)?this._structuralMetadata=Moe({extension:this._extension,schema:r,bufferViews:s,textures:o}):this._structuralMetadata=Loe({extension:this._extensionLegacy,schema:r,bufferViews:s,textures:o}),qN(this),this._state=Oe.READY,!0};function qN(e){const t=e._bufferViewLoaders,n=t.length;for(let i=0;i<n;++i)Re.unload(t[i]);e._bufferViewLoaders.length=0,e._bufferViewIds.length=0}function Xoe(e){const t=e._textureLoaders,n=t.length;for(let i=0;i<n;++i)Re.unload(t[i]);e._textureLoaders.length=0,e._textureIds.length=0}ll.prototype.unload=function(){qN(this),Xoe(this),l(this._schemaLoader)&&Re.unload(this._schemaLoader),this._schemaLoader=void 0,this._structuralMetadata=void 0};const gf={TRANSLATION:"TRANSLATION",ROTATION:"ROTATION",SCALE:"SCALE",FEATURE_ID:"_FEATURE_ID"};gf.fromGltfSemantic=function(e){y.typeOf.string("gltfSemantic",e);let t=e;const i=/^(\w+)_\d+$/.exec(e);switch(i!==null&&(t=i[1]),t){case"TRANSLATION":return gf.TRANSLATION;case"ROTATION":return gf.ROTATION;case"SCALE":return gf.SCALE;case"_FEATURE_ID":return gf.FEATURE_ID}};const Tr=Object.freeze(gf),Yoe=65534,Koe=255;function um(e){e=T(e,T.EMPTY_OBJECT);const t=e.triangleIndices,n=e.outlineIndices,i=e.originalVertexCount;y.typeOf.object("options.triangleIndices",t),y.typeOf.object("options.outlineIndices",n),y.typeOf.number("options.originalVertexCount",i),this._triangleIndices=t,this._originalVertexCount=i,this._edges=new WN(n,i),this._outlineCoordinatesTypedArray=void 0,this._extraVertices=[],Zoe(this)}Object.defineProperties(um.prototype,{updatedTriangleIndices:{get:function(){return this._triangleIndices}},outlineCoordinates:{get:function(){return this._outlineCoordinatesTypedArray}}});function Zoe(e){let t=e._triangleIndices;const n=e._edges,i=[],r=e._extraVertices,s=e._originalVertexCount,o={};for(let a=0;a<t.length;a+=3){let c=t[a],u=t[a+1],h=t[a+2];const d=n.hasEdge(c,u),p=n.hasEdge(u,h),g=n.hasEdge(h,c);let _=P1(i,c,u,h,d,p,g);for(;l(_);){let b=o[_];if(!l(b)){b=s+r.length;let x=_;for(;x>=s;)x=r[x-s];r.push(x),o[_]=b}b>Yoe&&(t instanceof Uint16Array||t instanceof Uint8Array)?t=new Uint32Array(t):b>Koe&&t instanceof Uint8Array&&(t=new Uint16Array(t)),_===c?(c=b,t[a]=b):_===u?(u=b,t[a+1]=b):(h=b,t[a+2]=b),_=P1(i,c,u,h,d,p,g)}}e._triangleIndices=t,e._outlineCoordinatesTypedArray=new Float32Array(i)}function P1(e,t,n,i,r,s,o){const a=o?1:0,c=r?1:0,u=0,h=nT(e,t,a,c,u);if(h===0)return t;const d=0,p=r?1:0,g=s?1:0,_=nT(e,n,d,p,g);if(_===0)return n;const b=o?1:0,x=0,E=s?1:0,C=nT(e,i,b,x,E);if(C===0)return i;const w=h&_&C;let S,v,D;if(w&1)S=0,v=1,D=2;else if(w&2)S=0,D=1,v=2;else if(w&4)v=0,S=1,D=2;else if(w&8)v=0,D=1,S=2;else if(w&16)D=0,S=1,v=2;else if(w&32)D=0,v=1,S=2;else{const B=iT(h),U=iT(_),V=iT(C);return B<U&&B<V?t:U<V?n:i}const L=t*3;e[L+S]=a,e[L+v]=c,e[L+D]=u;const O=n*3;e[O+S]=d,e[O+v]=p,e[O+D]=g;const N=i*3;e[N+S]=b,e[N+v]=x,e[N+D]=E}function nT(e,t,n,i,r){const s=t*3,o=e[s],a=e[s+1],c=e[s+2];return l(o)?(o===n&&a===i&&c===r)<<0|(o===n&&a===r&&c===i)<<1|(o===i&&a===n&&c===r)<<2|(o===i&&a===r&&c===n)<<3|(o===r&&a===n&&c===i)<<4|(o===r&&a===i&&c===n)<<5:63}function iT(e){return(e&1)+(e>>1&1)+(e>>2&1)+(e>>3&1)+(e>>4&1)+(e>>5&1)}um.prototype.updateAttribute=function(e){const t=this._extraVertices,n=e.length,i=n/this._originalVertexCount,r=t.length,s=e.constructor,o=new s(e.length+r*i);o.set(e);for(let a=0;a<r;a++){const c=t[a]*i,u=n+a*i;for(let h=0;h<i;h++)o[u+h]=o[c+h]}return o};um.createTexture=function(e){let t=e.cache.modelOutliningCache;if(l(t)||(t=e.cache.modelOutliningCache={}),l(t.outlineTexture))return t.outlineTexture;const n=Math.min(4096,We.maximumTextureSize);let i=n;const r=N1(i),s=[];for(;i>1;)i>>=1,s.push(N1(i));const o=new kt({context:e,source:{arrayBufferView:r,mipLevels:s},width:n,height:1,pixelFormat:Le.LUMINANCE,sampler:new Cn({wrapS:ii.CLAMP_TO_EDGE,wrapT:ii.CLAMP_TO_EDGE,minificationFilter:Ut.LINEAR_MIPMAP_LINEAR,magnificationFilter:ws.LINEAR})});return t.outlineTexture=o,o};function N1(e){const t=new Uint8Array(e);return t[e-1]=192,e===8?t[e-1]=96:e===4?t[e-1]=48:e===2?t[e-1]=24:e===1&&(t[e-1]=12),t}function WN(e,t){this._originalVertexCount=t,this._edges=new Set;for(let n=0;n<e.length;n+=2){const i=e[n],r=e[n+1],s=Math.min(i,r),o=Math.max(i,r),a=s*this._originalVertexCount+o;this._edges.add(a)}}WN.prototype.hasEdge=function(e,t){const n=Math.min(e,t),i=Math.max(e,t),r=n*this._originalVertexCount+i;return this._edges.has(r)};function $N(e){y.typeOf.object("attribute",e),this.attribute=e,this.loadBuffer=!1,this.loadTypedArray=!1}function Joe(e){y.typeOf.object("indices",e),this.indices=e,this.loadBuffer=!1,this.loadTypedArray=!1}function Bh(e){y.typeOf.object("primitive",e),this.primitive=e,this.attributePlans=[],this.indicesPlan=void 0,this.needsOutlines=!1,this.outlineIndices=void 0}Bh.prototype.postProcess=function(e){this.needsOutlines&&(Qoe(this),tae(this,e))};function Qoe(e){const t=e.primitive,n=t.indices,i=t.attributes[0].count,r=new um({triangleIndices:n.typedArray,outlineIndices:e.outlineIndices,originalVertexCount:i});n.typedArray=r.updatedTriangleIndices,n.indexDatatype=Ge.fromTypedArray(n.typedArray);const s=eae(r.outlineCoordinates),o=new $N(s);o.loadBuffer=!0,o.loadTypedArray=!1,e.attributePlans.push(o),t.outlineCoordinates=o.attribute;const a=e.attributePlans,c=e.attributePlans.length;for(let u=0;u<c;u++){const h=a[u].attribute;h.typedArray=r.updateAttribute(h.typedArray)}}function eae(e){const t=new Be.Attribute;return t.name="_OUTLINE_COORDINATES",t.typedArray=e,t.componentDatatype=q.FLOAT,t.type=tt.VEC3,t.normalized=!1,t.count=e.length/3,t}function tae(e,t){nae(e.attributePlans,t),l(e.indicesPlan)&&iae(e.indicesPlan,t)}function nae(e,t){const n=e.length;for(let i=0;i<n;i++){const r=e[i],s=r.attribute,o=s.typedArray;if(r.loadBuffer){const a=ze.createVertexBuffer({typedArray:o,context:t,usage:Ae.STATIC_DRAW});a.vertexArrayDestroyable=!1,s.buffer=a}r.loadTypedArray||(s.typedArray=void 0)}}function iae(e,t){const n=e.indices;if(e.loadBuffer){const i=ze.createIndexBuffer({typedArray:n.typedArray,context:t,usage:Ae.STATIC_DRAW,indexDatatype:n.indexDatatype});n.buffer=i,i.vertexArrayDestroyable=!1}e.loadTypedArray||(n.typedArray=void 0)}Bh.AttributeLoadPlan=$N;Bh.IndicesLoadPlan=Joe;function rae(e){e=T(e,T.EMPTY_OBJECT),this.webp=T(e.webp,!1),this.basis=T(e.basis,!1)}const{Attribute:sae,Indices:oae,FeatureIdAttribute:XN,FeatureIdTexture:YN,FeatureIdImplicitRange:KN,MorphTarget:aae,Primitive:cae,Instances:lae,Skin:uae,Node:fae,AnimatedPropertyType:hae,AnimationSampler:dae,AnimationTarget:pae,AnimationChannel:mae,Animation:gae,ArticulationStage:_ae,Articulation:yae,Asset:bae,Scene:Tae,Components:xae,MetallicRoughness:Eae,SpecularGlossiness:Cae,Specular:wae,Anisotropy:rT,Clearcoat:sT,Material:Aae}=Be,pn={NOT_LOADED:0,LOADING:1,LOADED:2,PROCESSING:3,POST_PROCESSING:4,PROCESSED:5,READY:6,FAILED:7,UNLOADED:8};function Ts(e){e=T(e,T.EMPTY_OBJECT);const{gltfResource:t,typedArray:n,releaseGltfJson:i=!1,asynchronous:r=!0,incrementallyLoadTextures:s=!0,upAxis:o=ir.Y,forwardAxis:a=ir.Z,loadAttributesAsTypedArray:c=!1,loadAttributesFor2D:u=!1,enablePick:h=!1,loadIndicesForWireframe:d=!1,loadPrimitiveOutline:p=!0,loadForClassification:g=!1,renameBatchIdSemantic:_=!1}=e;y.typeOf.object("options.gltfResource",t);const{baseResource:b=t.clone()}=e;this._gltfJson=e.gltfJson,this._gltfResource=t,this._baseResource=b,this._typedArray=n,this._releaseGltfJson=i,this._asynchronous=r,this._incrementallyLoadTextures=s,this._upAxis=o,this._forwardAxis=a,this._loadAttributesAsTypedArray=c,this._loadAttributesFor2D=u,this._enablePick=h,this._loadIndicesForWireframe=d,this._loadPrimitiveOutline=p,this._loadForClassification=g,this._renameBatchIdSemantic=_,this._sortedPropertyTableIds=void 0,this._sortedFeatureTextureIds=void 0,this._gltfJsonLoader=void 0,this._state=pn.NOT_LOADED,this._textureState=pn.NOT_LOADED,this._promise=void 0,this._processError=void 0,this._textureErrors=[],this._primitiveLoadPlans=[],this._loaderPromises=[],this._textureLoaders=[],this._texturesPromises=[],this._textureCallbacks=[],this._bufferViewLoaders=[],this._geometryLoaders=[],this._geometryCallbacks=[],this._structuralMetadataLoader=void 0,this._loadResourcesPromise=void 0,this._resourcesLoaded=!1,this._texturesLoaded=!1,this._supportedImageFormats=void 0,this._postProcessBuffers=[],this._components=void 0}l(Object.create)&&(Ts.prototype=Object.create(ai.prototype),Ts.prototype.constructor=Ts);Object.defineProperties(Ts.prototype,{cacheKey:{get:function(){}},components:{get:function(){return this._components}},gltfJson:{get:function(){return l(this._gltfJsonLoader)?this._gltfJsonLoader.gltf:this._gltfJson}},incrementallyLoadTextures:{get:function(){return this._incrementallyLoadTextures}},texturesLoaded:{get:function(){return this._texturesLoaded}}});async function Sae(e){e._state=pn.LOADING,e._textureState=pn.LOADING;try{const t=Re.getGltfJsonLoader({gltfResource:e._gltfResource,baseResource:e._baseResource,typedArray:e._typedArray,gltfJson:e._gltfJson});return e._gltfJsonLoader=t,await t.load(),e.isDestroyed()||e.isUnloaded()||t.isDestroyed()?void 0:(e._state=pn.LOADED,e._textureState=pn.LOADED,e)}catch(t){if(e.isDestroyed())return;e._state=pn.FAILED,e._textureState=pn.FAILED,u_(e,t)}}async function vae(e,t){It.supportsWebP.initialized||await It.supportsWebP.initialize(),e._supportedImageFormats=new rae({webp:It.supportsWebP(),basis:t.context.supportsBasis});const n=Oce(e,t);return e._state=pn.PROCESSING,e._textureState=pn.PROCESSING,l(e._gltfJsonLoader)&&e._releaseGltfJson&&(Re.unload(e._gltfJsonLoader),e._gltfJsonLoader=void 0),n}Ts.prototype.load=async function(){return l(this._promise)?this._promise:(this._promise=Sae(this),this._promise)};function u_(e,t){throw e.unload(),e.getError("Failed to load glTF",t)}function Iae(e,t){let n=!0;const i=e._geometryLoaders;for(let s=0;s<i.length;++s){const o=i[s].process(t);o&&l(e._geometryCallbacks[s])&&(e._geometryCallbacks[s](),e._geometryCallbacks[s]=void 0),n=n&&o}const r=e._structuralMetadataLoader;if(l(r)){const s=r.process(t);s&&(e._components.structuralMetadata=r.structuralMetadata),n=n&&s}n&&(e._state=pn.POST_PROCESSING)}function Oae(e,t){const n=e._primitiveLoadPlans;for(let i=0;i<n.length;i++){const r=n[i];r.postProcess(t),r.needsOutlines&&Rae(e,r)}}function Rae(e,t){const n=e._postProcessBuffers,i=t.primitive,r=i.outlineCoordinates;l(r)&&n.push(r.buffer);const s=i.attributes;for(let a=0;a<s.length;a++){const c=s[a];l(c.buffer)&&n.push(c.buffer)}const o=i.indices;l(o)&&l(o.buffer)&&n.push(o.buffer)}Ts.prototype._process=function(e){return this._state===pn.READY?!0:(this._state===pn.PROCESSING&&Iae(this,e),this._resourcesLoaded&&this._state===pn.POST_PROCESSING&&(Oae(this,e.context),this._state=pn.PROCESSED),this._resourcesLoaded&&this._state===pn.PROCESSED?(s2(this),this._typedArray=void 0,this._state=pn.READY,!0):!1)};Ts.prototype._processTextures=function(e){if(this._textureState===pn.READY)return!0;if(this._textureState!==pn.PROCESSING)return!1;let t=!0;const n=this._textureLoaders;for(let i=0;i<n.length;++i){const r=n[i].process(e);r&&l(this._textureCallbacks[i])&&(this._textureCallbacks[i](),this._textureCallbacks[i]=void 0),t=t&&r}return t?(this._textureState=pn.READY,this._texturesLoaded=!0,!0):!1};Ts.prototype.process=function(e){if(y.typeOf.object("frameState",e),this._state===pn.LOADED&&!l(this._loadResourcesPromise)&&(this._loadResourcesPromise=vae(this,e).then(()=>{this._resourcesLoaded=!0}).catch(r=>{this._processError=r})),l(this._processError)){this._state=pn.FAILED;const r=this._processError;this._processError=void 0,u_(this,r)}const t=this._textureErrors.pop();if(l(t)){const r=this.getError("Failed to load glTF texture",t);throw r.name="TextureError",r}if(this._state===pn.FAILED)return!1;let n=!1;try{n=this._process(e)}catch(r){this._state=pn.FAILED,u_(this,r)}let i=!1;try{i=this._processTextures(e)}catch(r){this._textureState=pn.FAILED,u_(this,r)}return this._incrementallyLoadTextures?n:n&&i};function Dae(e,t,n,i,r,s,o){const a=e.gltfJson,u=a.accessors[t].bufferView;return Re.getVertexBufferLoader({gltf:a,gltfResource:e._gltfResource,baseResource:e._baseResource,frameState:o,bufferViewId:u,draco:i,attributeSemantic:n,accessorId:t,asynchronous:e._asynchronous,loadBuffer:r,loadTypedArray:s})}function Mae(e,t,n,i,r,s){return Re.getIndexBufferLoader({gltf:e.gltfJson,accessorId:t,gltfResource:e._gltfResource,baseResource:e._baseResource,frameState:s,draco:n,asynchronous:e._asynchronous,loadBuffer:i,loadTypedArray:r})}function Lae(e,t){const n=Re.getBufferViewLoader({gltf:e.gltfJson,bufferViewId:t,gltfResource:e._gltfResource,baseResource:e._baseResource});return e._bufferViewLoaders.push(n),n}function ZN(e,t,n){let i=t.byteOffset;const r=Nh(e,t),s=t.count,o=sm(t.type),a=t.componentType,c=q.getSizeInBytes(a),u=c*o,h=s*o;if(r===u)return n=new Uint8Array(n),q.createArrayBufferView(a,n.buffer,n.byteOffset+i,h);const d=q.createTypedArray(a,h),p=new DataView(n.buffer),g=new Array(o),_=_w(t.componentType);i=n.byteOffset+i;for(let b=0;b<s;++b){_(p,i,o,c,g);for(let x=0;x<o;++x)d[b*o+x]=g[x];i+=r}return d}function Pae(e,t){const n=e.type;if(n===tt.SCALAR)return t.fill(0);const i=tt.getMathType(n);return t.fill(i.clone(i.ZERO))}function Nae(e,t,n,i){const r=e.type,s=e.count;if(r===tt.SCALAR)for(let o=0;o<s;o++)n[o]=t[o];else if(r===tt.VEC4&&i)for(let o=0;o<s;o++)n[o]=re.unpack(t,o*4);else{const o=tt.getMathType(r),a=tt.getNumberOfComponents(r);for(let c=0;c<s;c++)n[c]=o.unpack(t,c*a)}return n}async function Fae(e,t,n,i,r){const{gltfJson:s}=e;if(await t.load(),e.isDestroyed())return;const o=ZN(s,n,t.typedArray);i=T(i,!1),Nae(n,o,r,i)}function iy(e,t,n){const i=new Array(t.count),r=t.bufferView;if(l(r)){const s=Lae(e,r),o=Fae(e,s,t,n,i);return e._loaderPromises.push(o),i}return Pae(t,i)}function _s(e,t){if(l(t))return e===Number?t[0]:e.unpack(t)}function Bae(e){return e===Number?0:new e}function zae(e){switch(e){case q.BYTE:return 127;case q.UNSIGNED_BYTE:return 255;case q.SHORT:return 32767;case q.UNSIGNED_SHORT:return 65535;default:return 1}}const Uae={VEC2:new k(-1,-1),VEC3:new m(-1,-1,-1),VEC4:new Y(-1,-1,-1,-1)};function kae(e,t){const n=zae(e.componentDatatype),i=Uae[e.type];let r=e.min;l(r)&&(r=t.divideByScalar(r,n,r),r=t.maximumByComponent(r,i,r));let s=e.max;l(s)&&(s=t.divideByScalar(s,n,s),s=t.maximumByComponent(s,i,s)),e.min=r,e.max=s}function jae(e,t,n){const i=e.decodeMatrix,r=_s(n,e.decodedMin),s=_s(n,e.decodedMax);l(r)&&l(s)&&(t.min=r,t.max=s);const o=new Be.Quantization;o.componentDatatype=t.componentDatatype,o.type=t.type,i.length===4?(o.quantizedVolumeOffset=i[2],o.quantizedVolumeStepSize=i[0]):i.length===9?(o.quantizedVolumeOffset=new k(i[6],i[7]),o.quantizedVolumeStepSize=new k(i[0],i[4])):i.length===16?(o.quantizedVolumeOffset=new m(i[12],i[13],i[14]),o.quantizedVolumeStepSize=new m(i[0],i[5],i[10])):i.length===25&&(o.quantizedVolumeOffset=new Y(i[20],i[21],i[22],i[23]),o.quantizedVolumeStepSize=new Y(i[0],i[6],i[12],i[18])),t.quantization=o}function Vae(e,t,n,i,r){var d;const s=e.accessors[t],o=tt.getMathType(s.type),a=T(s.normalized,!1),c=new sae;c.name=n,c.semantic=i,c.setIndex=r,c.constant=Bae(o),c.componentDatatype=s.componentType,c.normalized=a,c.count=s.count,c.type=s.type,c.min=_s(o,s.min),c.max=_s(o,s.max),c.byteOffset=s.byteOffset,c.byteStride=Nh(e,s),oi(s,"WEB3D_quantized_attributes")&&jae(s.extensions.WEB3D_quantized_attributes,c,o);const u=c.semantic===Me.POSITION||c.semantic===Me.NORMAL||c.semantic===Me.TANGENT||c.semantic===Me.TEXCOORD;return((d=e.extensionsRequired)==null?void 0:d.includes("KHR_mesh_quantization"))&&a&&u&&kae(c,o),c}function JN(e){const n=/^\w+_(\d+)$/.exec(e);if(n!==null)return parseInt(n[1])}const Gae={gltfSemantic:void 0,renamedSemantic:void 0,modelSemantic:void 0};function Ow(e,t,n){let i=n;e._renameBatchIdSemantic&&(n==="_BATCHID"||n==="BATCHID")&&(i="_FEATURE_ID_0");const r=t.fromGltfSemantic(i),s=Gae;return s.gltfSemantic=n,s.renamedSemantic=i,s.modelSemantic=r,s}function Hae(e){const t=e===Me.POSITION,n=e===Me.FEATURE_ID,i=e===Me.TEXCOORD;return t||n||i}function qae(e,t,n,i){if(e.byteOffset=0,e.byteStride=void 0,e.quantization=t.quantization,n&&(e.buffer=t.buffer),i){const r=l(t.quantization)?t.quantization.componentDatatype:e.componentDatatype;e.typedArray=q.createArrayBufferView(r,t.typedArray.buffer)}}function Wae(e,t,n,i,r,s){if(r&&(n.buffer=i.buffer),s){const o=i.typedArray;n.typedArray=ZN(e,t,o),r||(n.byteOffset=0,n.byteStride=void 0)}}function QN(e,t,n,i,r,s,o){const a=e.gltfJson,c=a.accessors[t],u=c.bufferView,h=n.gltfSemantic,d=n.renamedSemantic,p=n.modelSemantic,g=l(p)?JN(d):void 0,b=Vae(a,t,h,p,g);if(!l(i)&&!l(u))return b;const x=Dae(e,t,h,i,r,s,o),E=e._geometryLoaders.length;e._geometryLoaders.push(x);const C=x.load();return e._loaderPromises.push(C),e._geometryCallbacks[E]=()=>{l(i)&&l(i.attributes)&&l(i.attributes[h])?qae(b,x,r,s):Wae(a,c,b,x,r,s)},b}function e2(e,t,n,i,r,s,o){const a=n.modelSemantic,c=a===Me.POSITION,u=a===Me.FEATURE_ID,h=c&&!r&&e._loadAttributesFor2D&&!o.scene3DOnly,d=c&&e._enablePick&&!o.context.webgl2,p=e._loadForClassification&&u,g=e._loadAttributesAsTypedArray,_=!g,b=g||h||d||p,C=QN(e,t,n,i,s?!1:_,s?!0:b,o),w=new Bh.AttributeLoadPlan(C);return w.loadBuffer=_,w.loadTypedArray=b,w}function $ae(e,t,n,i,r){const s=e.gltfJson.accessors,o=l(n.ROTATION),a=l(n.TRANSLATION)&&l(s[n.TRANSLATION].min)&&l(s[n.TRANSLATION].max),c=Ow(e,Tr,i),u=c.modelSemantic,h=u===Tr.TRANSLATION||u===Tr.ROTATION||u===Tr.SCALE,d=u===Tr.TRANSLATION,p=e._loadAttributesAsTypedArray||o&&h||!r.context.instancedArrays,g=e._enablePick&&!r.context.webgl2,_=!p,b=e._loadAttributesFor2D&&!r.scene3DOnly;return QN(e,t,c,void 0,_,p||d&&(!a||b||g),r)}function Xae(e,t,n,i,r,s){const o=e.gltfJson.accessors[t],a=o.bufferView;if(!l(n)&&!l(a))return;const c=new oae;c.count=o.count;const u=e._loadAttributesAsTypedArray,h=(e._loadIndicesForWireframe||e._enablePick)&&!s.context.webgl2,d=e._loadForClassification&&i,g=!u,_=u||h||d,E=Mae(e,t,n,r?!1:g,r?!0:_,s),C=e._geometryLoaders.length;e._geometryLoaders.push(E);const w=E.load();e._loaderPromises.push(w),e._geometryCallbacks[C]=()=>{c.indexDatatype=E.indexDatatype,c.buffer=E.buffer,c.typedArray=E.typedArray};const S=new Bh.IndicesLoadPlan(c);return S.loadBuffer=g,S.loadTypedArray=_,S}function Fr(e,t,n,i){const r=e.gltfJson,s=Ta.getImageIdFromTexture({gltf:r,textureId:t.index,supportedImageFormats:e._supportedImageFormats});if(!l(s))return;const o=Re.getTextureLoader({gltf:r,textureInfo:t,gltfResource:e._gltfResource,baseResource:e._baseResource,supportedImageFormats:e._supportedImageFormats,frameState:n,asynchronous:e._asynchronous}),a=Ta.createModelTextureReader({textureInfo:t}),c=e._textureLoaders.length;e._textureLoaders.push(o);const u=o.load().catch(h=>{if(!e.isDestroyed()){if(!e._incrementallyLoadTextures)throw h;e._textureState=pn.FAILED,e._textureErrors.push(h)}});return e._texturesPromises.push(u),e._textureCallbacks[c]=()=>{a.texture=o.texture,l(i)&&(a.texture.sampler=i)},a}function Yae(e,t,n){const{diffuseTexture:i,specularGlossinessTexture:r,diffuseFactor:s,specularFactor:o,glossinessFactor:a}=t,c=new Cae;return l(i)&&(c.diffuseTexture=Fr(e,i,n)),l(r)&&(c.specularGlossinessTexture=Fr(e,r,n)),c.diffuseFactor=_s(Y,s),c.specularFactor=_s(m,o),c.glossinessFactor=a,c}function Kae(e,t,n){const{baseColorTexture:i,metallicRoughnessTexture:r,baseColorFactor:s,metallicFactor:o,roughnessFactor:a}=t,c=new Eae;return l(i)&&(c.baseColorTexture=Fr(e,i,n)),l(r)&&(c.metallicRoughnessTexture=Fr(e,r,n)),c.baseColorFactor=_s(Y,s),c.metallicFactor=o,c.roughnessFactor=a,c}function Zae(e,t,n){const{specularFactor:i,specularTexture:r,specularColorFactor:s,specularColorTexture:o}=t,a=new wae;return l(r)&&(a.specularTexture=Fr(e,r,n)),l(o)&&(a.specularColorTexture=Fr(e,o,n)),a.specularFactor=i,a.specularColorFactor=_s(m,s),a}function Jae(e,t,n){const{anisotropyStrength:i=rT.DEFAULT_ANISOTROPY_STRENGTH,anisotropyRotation:r=rT.DEFAULT_ANISOTROPY_ROTATION,anisotropyTexture:s}=t,o=new rT;return l(s)&&(o.anisotropyTexture=Fr(e,s,n)),o.anisotropyStrength=i,o.anisotropyRotation=r,o}function Qae(e,t,n){const{clearcoatFactor:i=sT.DEFAULT_CLEARCOAT_FACTOR,clearcoatTexture:r,clearcoatRoughnessFactor:s=sT.DEFAULT_CLEARCOAT_ROUGHNESS_FACTOR,clearcoatRoughnessTexture:o,clearcoatNormalTexture:a}=t,c=new sT;return l(r)&&(c.clearcoatTexture=Fr(e,r,n)),l(o)&&(c.clearcoatRoughnessTexture=Fr(e,o,n)),l(a)&&(c.clearcoatNormalTexture=Fr(e,a,n)),c.clearcoatFactor=i,c.clearcoatRoughnessFactor=s,c}function ece(e,t,n){const i=new Aae,r=T(t.extensions,T.EMPTY_OBJECT),s=r.KHR_materials_pbrSpecularGlossiness,o=r.KHR_materials_specular,a=r.KHR_materials_anisotropy,c=r.KHR_materials_clearcoat,u=t.pbrMetallicRoughness;return i.unlit=l(r.KHR_materials_unlit),l(s)?i.specularGlossiness=Yae(e,s,n):(l(u)&&(i.metallicRoughness=Kae(e,u,n)),l(o)&&!i.unlit&&(i.specular=Zae(e,o,n)),l(a)&&!i.unlit&&(i.anisotropy=Jae(e,a,n)),l(c)&&!i.unlit&&(i.clearcoat=Qae(e,c,n))),l(t.emissiveTexture)&&(i.emissiveTexture=Fr(e,t.emissiveTexture,n)),l(t.normalTexture)&&!e._loadForClassification&&(i.normalTexture=Fr(e,t.normalTexture,n)),l(t.occlusionTexture)&&(i.occlusionTexture=Fr(e,t.occlusionTexture,n)),i.emissiveFactor=_s(m,t.emissiveFactor),i.alphaMode=t.alphaMode,i.alphaCutoff=t.alphaCutoff,i.doubleSided=t.doubleSided,i}function t2(e,t){const n=new XN;return n.featureCount=e.featureCount,n.nullFeatureId=e.nullFeatureId,n.propertyTableId=e.propertyTable,n.setIndex=e.attribute,n.label=e.label,n.positionalLabel=t,n}function n2(e,t,n,i){const r=new XN,s=e.featureIds;return r.featureCount=n,r.propertyTableId=t,r.setIndex=JN(s.attribute),r.positionalLabel=i,r}function i2(e,t){const n=new KN;return n.propertyTableId=e.propertyTable,n.featureCount=e.featureCount,n.nullFeatureId=e.nullFeatureId,n.label=e.label,n.positionalLabel=t,n.offset=0,n.repeat=1,n}function r2(e,t,n,i){const r=new KN,s=e.featureIds;r.propertyTableId=t,r.featureCount=n,r.offset=T(s.constant,0);const o=T(s.divisor,0);return r.repeat=o===0?void 0:o,r.positionalLabel=i,r}function tce(e,t,n,i){const r=new YN;r.featureCount=t.featureCount,r.nullFeatureId=t.nullFeatureId,r.propertyTableId=t.propertyTable,r.label=t.label,r.positionalLabel=i;const s=t.texture;r.textureReader=Fr(e,s,n,Cn.NEAREST);const a=(l(s.channels)?s.channels:[0]).map(function(c){return"rgba".charAt(c)}).join("");return r.textureReader.channels=a,r}function nce(e,t,n,i,r,s){const o=new YN,a=t.featureIds,c=a.texture;return o.featureCount=r,o.propertyTableId=n,o.textureReader=Fr(e,c,i,Cn.NEAREST),o.textureReader.channels=a.channels,o.positionalLabel=s,o}function ice(e,t,n,i,r){const s=new aae,o=void 0,a=!1;for(const c in t){if(!t.hasOwnProperty(c))continue;const u=t[c],h=Ow(e,Me,c),d=e2(e,u,h,o,a,n,r);s.attributes.push(d.attribute),i.attributePlans.push(d)}return s}function rce(e,t,n,i){const r=new cae,s=new Bh(r);e._primitiveLoadPlans.push(s);const o=t.material;l(o)&&(r.material=ece(e,e.gltfJson.materials[o],i));const a=T(t.extensions,T.EMPTY_OBJECT);let c=!1;const u=a.CESIUM_primitive_outline;e._loadPrimitiveOutline&&l(u)&&(c=!0,s.needsOutlines=!0,s.outlineIndices=sce(e,u));const h=e._loadForClassification,d=a.KHR_draco_mesh_compression;let p=!1;const g=t.attributes;if(l(g))for(const v in g){if(!g.hasOwnProperty(v))continue;const D=g[v],L=Ow(e,Me,v),O=L.modelSemantic;if(h&&!Hae(O))continue;O===Me.FEATURE_ID&&(p=!0);const N=e2(e,D,L,d,n,c,i);s.attributePlans.push(N),r.attributes.push(N.attribute)}const _=t.targets;if(l(_)&&!h)for(let v=0;v<_.length;++v)r.morphTargets.push(ice(e,_[v],c,s,i));const b=t.indices;if(l(b)){const v=Xae(e,b,d,p,c,i);l(v)&&(s.indicesPlan=v,r.indices=v.indices)}const x=a.EXT_structural_metadata,E=a.EXT_mesh_features,C=a.EXT_feature_metadata,w=l(C);l(E)?oce(e,r,E,i):w&&ace(e,r,C,i),l(x)?cce(r,x):w&&lce(e,r,C);const S=t.mode;if(h&&S!==Fe.TRIANGLES)throw new te("Only triangle meshes can be used for classification.");return r.primitiveType=S,r}function sce(e,t){const n=t.indices,i=e.gltfJson.accessors[n];return iy(e,i,!1)}function oce(e,t,n,i){let r;l(n)&&l(n.featureIds)?r=n.featureIds:r=[];for(let s=0;s<r.length;s++){const o=r[s],a=`featureId_${s}`;let c;l(o.texture)?c=tce(e,o,i,a):l(o.attribute)?c=t2(o,a):c=i2(o,a),t.featureIds.push(c)}}function ace(e,t,n,i){const{featureTables:r}=e.gltfJson.extensions.EXT_feature_metadata;let s=0;const o=n.featureIdAttributes;if(l(o))for(let c=0;c<o.length;++c){const u=o[c],h=u.featureTable,d=e._sortedPropertyTableIds.indexOf(h),p=r[h].count,g=`featureId_${s}`;s++;let _;l(u.featureIds.attribute)?_=n2(u,d,p,g):_=r2(u,d,p,g),t.featureIds.push(_)}const a=n.featureIdTextures;if(l(a))for(let c=0;c<a.length;++c){const u=a[c],h=u.featureTable,d=e._sortedPropertyTableIds.indexOf(h),p=r[h].count,g=`featureId_${s}`;s++;const _=nce(e,u,d,i,p,g);t.featureIds.push(_)}}function cce(e,t){l(t)&&(l(t.propertyTextures)&&(e.propertyTextureIds=t.propertyTextures),l(t.propertyAttributes)&&(e.propertyAttributeIds=t.propertyAttributes))}function lce(e,t,n){l(n.featureTextures)&&(t.propertyTextureIds=n.featureTextures.map(function(i){return e._sortedFeatureTextureIds.indexOf(i)}))}function uce(e,t,n){const i=t.EXT_mesh_gpu_instancing,r=new lae,s=i.attributes;if(l(s))for(const u in s){if(!s.hasOwnProperty(u))continue;const h=s[u];r.attributes.push($ae(e,h,s,u,n))}const o=T(i.extensions,T.EMPTY_OBJECT),a=t.EXT_instance_features,c=o.EXT_feature_metadata;return l(a)?fce(r,a):l(c)&&hce(e.gltfJson,r,c,e._sortedPropertyTableIds),r}function fce(e,t){const n=t.featureIds;for(let i=0;i<n.length;i++){const r=n[i],s=`instanceFeatureId_${i}`;let o;l(r.attribute)?o=t2(r,s):o=i2(r,s),e.featureIds.push(o)}}function hce(e,t,n,i){const r=e.extensions.EXT_feature_metadata.featureTables,s=n.featureIdAttributes;if(l(s))for(let o=0;o<s.length;++o){const a=s[o],c=a.featureTable,u=i.indexOf(c),h=r[c].count,d=`instanceFeatureId_${o}`;let p;l(a.featureIds.attribute)?p=n2(a,u,h,d):p=r2(a,u,h,d),t.featureIds.push(p)}}function dce(e,t,n){const i=new fae;i.name=t.name,i.matrix=_s(P,t.matrix),i.translation=_s(m,t.translation),i.rotation=_s(re,t.rotation),i.scale=_s(m,t.scale);const r=T(t.extensions,T.EMPTY_OBJECT),s=r.EXT_mesh_gpu_instancing,o=r.AGI_articulations;if(l(s)){if(e._loadForClassification)throw new te("Models with the EXT_mesh_gpu_instancing extension cannot be used for classification.");i.instances=uce(e,r,n)}l(o)&&(i.articulationName=o.articulationName);const a=t.mesh;if(l(a)){const c=e.gltfJson.meshes[a],u=c.primitives;for(let p=0;p<u.length;++p)i.primitives.push(rce(e,u[p],l(i.instances),n));const h=T(t.weights,c.weights),d=i.primitives[0].morphTargets;i.morphWeights=l(h)?h.slice():new Array(d.length).fill(0)}return i}function pce(e,t){const n=e.gltfJson.nodes;if(!l(n))return[];const i=n.map(function(r,s){const o=dce(e,r,t);return o.index=s,o});for(let r=0;r<i.length;++r){const s=n[r].children;if(l(s))for(let o=0;o<s.length;++o)i[r].children.push(i[s[o]])}return i}function mce(e,t,n){const i=new uae,r=t.joints;i.joints=r.map(o=>n[o]);const s=t.inverseBindMatrices;if(l(s)){const o=e.gltfJson.accessors[s];i.inverseBindMatrices=iy(e,o)}else i.inverseBindMatrices=new Array(r.length).fill(P.IDENTITY);return i}function gce(e,t){const n=e.gltfJson.skins;if(e._loadForClassification||!l(n))return[];const i=n.map(function(s,o){const a=mce(e,s,t);return a.index=o,a}),r=e.gltfJson.nodes;for(let s=0;s<t.length;++s){const o=r[s].skin;l(o)&&(t[s].skin=i[o])}return i}async function _ce(e,t,n,i){const r=new ll({gltf:e.gltfJson,extension:t,extensionLegacy:n,gltfResource:e._gltfResource,baseResource:e._baseResource,supportedImageFormats:e._supportedImageFormats,frameState:i,asynchronous:e._asynchronous});return e._structuralMetadataLoader=r,r.load()}function yce(e,t){const n=new dae,i=e.gltfJson.accessors,r=i[t.input];n.input=iy(e,r);const s=t.interpolation;n.interpolation=T(Gf[s],Gf.LINEAR);const o=i[t.output];return n.output=iy(e,o,!0),n}function bce(e,t){const n=new pae,i=e.node;if(!l(i))return;n.node=t[i];const r=e.path.toUpperCase();return n.path=hae[r],n}function Tce(e,t,n){const i=new mae,r=e.sampler;return i.sampler=t[r],i.target=bce(e.target,n),i}function xce(e,t,n){const i=new gae;i.name=t.name;const r=t.samplers.map(function(o,a){const c=yce(e,o);return c.index=a,c}),s=t.channels.map(function(o){return Tce(o,r,n)});return i.samplers=r,i.channels=s,i}function Ece(e,t){const n=e.gltfJson.animations;return e._loadForClassification||!l(n)?[]:n.map(function(r,s){const o=xce(e,r,t);return o.index=s,o})}function Cce(e){const t=new _ae;t.name=e.name;const n=e.type.toUpperCase();return t.type=_o[n],t.minimumValue=e.minimumValue,t.maximumValue=e.maximumValue,t.initialValue=e.initialValue,t}function wce(e){const t=new yae;return t.name=e.name,t.stages=e.stages.map(Cce),t}function Ace(e){var i;const n=(i=T(e.extensions,T.EMPTY_OBJECT).AGI_articulations)==null?void 0:i.articulations;return l(n)?n.map(wce):[]}function Sce(e){let t;return l(e.scenes)&&l(e.scene)&&(t=e.scenes[e.scene].nodes),t=T(t,e.nodes),t=l(t)?t:[],t}function vce(e,t){const n=new Tae,i=Sce(e);return n.nodes=i.map(function(r){return t[r]}),n}const Ice=new m;function Oce(e,t){const n=e.gltfJson,i=T(n.extensions,T.EMPTY_OBJECT),r=i.EXT_structural_metadata,s=i.EXT_feature_metadata,o=i.CESIUM_RTC;if(l(s)){const x=s.featureTables,E=s.featureTextures,C=l(x)?x:[],w=l(E)?E:[];e._sortedPropertyTableIds=Object.keys(C).sort(),e._sortedFeatureTextureIds=Object.keys(w).sort()}const a=pce(e,t),c=gce(e,a),u=Ece(e,a),h=Ace(n),d=vce(n,a),p=new xae,g=new bae,_=n.asset.copyright;if(l(_)){const x=_.split(";").map(function(E){return new zt(E.trim())});g.credits=x}if(p.asset=g,p.scene=d,p.nodes=a,p.skins=c,p.animations=u,p.articulations=h,p.upAxis=e._upAxis,p.forwardAxis=e._forwardAxis,l(o)){const x=m.fromArray(o.center,0,Ice);p.transform=P.fromTranslation(x,p.transform)}if(e._components=p,l(r)||l(s)){const x=_ce(e,r,s,t);e._loaderPromises.push(x)}const b=[];return b.push.apply(b,e._loaderPromises),e._incrementallyLoadTextures||b.push.apply(b,e._texturesPromises),Promise.all(b)}function Rce(e){const t=e._textureLoaders;for(let n=0;n<t.length;++n)t[n]=!t[n].isDestroyed()&&Re.unload(t[n]);e._textureLoaders.length=0}function s2(e){const t=e._bufferViewLoaders;for(let n=0;n<t.length;++n)t[n]=!t[n].isDestroyed()&&Re.unload(t[n]);e._bufferViewLoaders.length=0}function Dce(e){const t=e._geometryLoaders;for(let n=0;n<t.length;++n)t[n]=!t[n].isDestroyed()&&Re.unload(t[n]);e._geometryLoaders.length=0}function Mce(e){const t=e._postProcessBuffers;for(let n=0;n<t.length;n++){const i=t[n];i.isDestroyed()||i.destroy()}t.length=0}function Lce(e){l(e._structuralMetadataLoader)&&!e._structuralMetadataLoader.isDestroyed()&&(e._structuralMetadataLoader.destroy(),e._structuralMetadataLoader=void 0)}Ts.prototype.isUnloaded=function(){return this._state===pn.UNLOADED};Ts.prototype.unload=function(){l(this._gltfJsonLoader)&&!this._gltfJsonLoader.isDestroyed()&&Re.unload(this._gltfJsonLoader),this._gltfJsonLoader=void 0,Rce(this),s2(this),Dce(this),Mce(this),Lce(this),this._components=void 0,this._typedArray=void 0,this._state=pn.UNLOADED};const Pce=`uniform sampler2D u_pointCloud_colorGBuffer;
uniform sampler2D u_pointCloud_depthGBuffer;
uniform vec2 u_distanceAndEdlStrength;
in vec2 v_textureCoordinates;

vec2 neighborContribution(float log2Depth, vec2 offset)
{
    float dist = u_distanceAndEdlStrength.x;
    vec2 texCoordOrig = v_textureCoordinates + offset * dist;
    vec2 texCoord0 = v_textureCoordinates + offset * floor(dist);
    vec2 texCoord1 = v_textureCoordinates + offset * ceil(dist);

    float depthOrLogDepth0 = czm_unpackDepth(texture(u_pointCloud_depthGBuffer, texCoord0));
    float depthOrLogDepth1 = czm_unpackDepth(texture(u_pointCloud_depthGBuffer, texCoord1));

    // ignore depth values that are the clear depth
    if (depthOrLogDepth0 == 0.0 || depthOrLogDepth1 == 0.0) {
        return vec2(0.0);
    }

    // interpolate the two adjacent depth values
    float depthMix = mix(depthOrLogDepth0, depthOrLogDepth1, fract(dist));
    vec4 eyeCoordinate = czm_windowToEyeCoordinates(texCoordOrig, depthMix);
    return vec2(max(0.0, log2Depth - log2(-eyeCoordinate.z / eyeCoordinate.w)), 1.0);
}

void main()
{
    float depthOrLogDepth = czm_unpackDepth(texture(u_pointCloud_depthGBuffer, v_textureCoordinates));

    vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, depthOrLogDepth);
    eyeCoordinate /= eyeCoordinate.w;

    float log2Depth = log2(-eyeCoordinate.z);

    if (depthOrLogDepth == 0.0) // 0.0 is the clear value for the gbuffer
    {
        discard;
    }

    vec4 color = texture(u_pointCloud_colorGBuffer, v_textureCoordinates);

    // sample from neighbors left, right, down, up
    vec2 texelSize = 1.0 / czm_viewport.zw;

    vec2 responseAndCount = vec2(0.0);

    responseAndCount += neighborContribution(log2Depth, vec2(-texelSize.x, 0.0));
    responseAndCount += neighborContribution(log2Depth, vec2(+texelSize.x, 0.0));
    responseAndCount += neighborContribution(log2Depth, vec2(0.0, -texelSize.y));
    responseAndCount += neighborContribution(log2Depth, vec2(0.0, +texelSize.y));

    float response = responseAndCount.x / responseAndCount.y;
    float strength = u_distanceAndEdlStrength.y;
    float shade = exp(-response * 300.0 * strength);
    color.rgb *= shade;
    out_FragColor = vec4(color);

    // Input and output depth are the same.
    gl_FragDepth = depthOrLogDepth;
}
`;function zu(){this._framebuffer=new wi({colorAttachmentsLength:2,depth:!0,supportsDepthTexture:!0}),this._drawCommand=void 0,this._clearCommand=void 0,this._strength=1,this._radius=1}Object.defineProperties(zu.prototype,{framebuffer:{get:function(){return this._framebuffer.framebuffer}},colorGBuffer:{get:function(){return this._framebuffer.getColorTexture(0)}},depthGBuffer:{get:function(){return this._framebuffer.getColorTexture(1)}}});function Nce(e){e._framebuffer.destroy(),e._drawCommand=void 0,e._clearCommand=void 0}const oT=new k;function Fce(e,t){const n=new Je({defines:["LOG_DEPTH_WRITE"],sources:[Pce]}),i={u_pointCloud_colorGBuffer:function(){return e.colorGBuffer},u_pointCloud_depthGBuffer:function(){return e.depthGBuffer},u_distanceAndEdlStrength:function(){return oT.x=e._radius,oT.y=e._strength,oT}},r=it.fromCache({blending:vs.ALPHA_BLEND,depthMask:!0,depthTest:{enabled:!0},stencilTest:yt.setCesium3DTileBit(),stencilMask:yt.CESIUM_3D_TILE_MASK});e._drawCommand=t.createViewportQuadCommand(n,{uniformMap:i,renderState:r,pass:Ke.CESIUM_3D_TILE,owner:e}),e._clearCommand=new vp({framebuffer:e.framebuffer,color:new M(0,0,0,0),depth:1,renderState:it.fromCache(),pass:Ke.CESIUM_3D_TILE,owner:e})}function Bce(e,t){const n=t.drawingBufferWidth,i=t.drawingBufferHeight;e._framebuffer.update(t,n,i),Fce(e,t)}function o2(e){return e.drawBuffers&&e.fragmentDepth}zu.isSupported=o2;function zce(e,t){let n=e.shaderCache.getDerivedShaderProgram(t,"EC");if(!l(n)){const i=t._attributeLocations,r=t.fragmentShaderSource.clone();r.sources.splice(0,0,`layout (location = 0) out vec4 out_FragData_0;
layout (location = 1) out vec4 out_FragData_1;`),r.sources=r.sources.map(function(s){return s=Je.replaceMain(s,"czm_point_cloud_post_process_main"),s=s.replaceAll(/out_FragColor/g,"out_FragData_0"),s}),r.sources.push(`void main() 
{ 
    czm_point_cloud_post_process_main(); 
#ifdef LOG_DEPTH
    czm_writeLogDepth();
    out_FragData_1 = czm_packDepth(gl_FragDepth); 
#else
    out_FragData_1 = czm_packDepth(gl_FragCoord.z);
#endif
}`),n=e.shaderCache.createDerivedShaderProgram(t,"EC",{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:r,attributeLocations:i})}return n}zu.prototype.update=function(e,t,n,i){if(!o2(e.context))return;this._strength=n.eyeDomeLightingStrength,this._radius=n.eyeDomeLightingRadius*e.pixelRatio,Bce(this,e.context);let r;const s=e.commandList,o=s.length;for(r=t;r<o;++r){const u=s[r];if(u.primitiveType!==Fe.POINTS||u.pass===Ke.TRANSLUCENT)continue;let h,d,p=u.derivedCommands.pointCloudProcessor;l(p)&&(h=p.command,d=p.originalShaderProgram),(!l(h)||u.dirty||d!==u.shaderProgram||h.framebuffer!==this.framebuffer)&&(h=Tt.shallowClone(u,h),h.framebuffer=this.framebuffer,h.shaderProgram=zce(e.context,u.shaderProgram),h.castShadows=!1,h.receiveShadows=!1,l(p)||(p={command:h,originalShaderProgram:u.shaderProgram},u.derivedCommands.pointCloudProcessor=p),p.originalShaderProgram=u.shaderProgram),s[r]=h}const a=this._clearCommand,c=this._drawCommand;c.boundingVolume=i,s.push(c),s.push(a)};zu.prototype.isDestroyed=function(){return!1};zu.prototype.destroy=function(){return Nce(this),Ye(this)};function Rw(e){const t=T(e,{});this.attenuation=T(t.attenuation,!1),this.geometricErrorScale=T(t.geometricErrorScale,1),this.maximumAttenuation=t.maximumAttenuation,this.baseResolution=t.baseResolution,this.eyeDomeLighting=T(t.eyeDomeLighting,!0),this.eyeDomeLightingStrength=T(t.eyeDomeLightingStrength,1),this.eyeDomeLightingRadius=T(t.eyeDomeLightingRadius,1),this.backFaceCulling=T(t.backFaceCulling,!1),this.normalShading=T(t.normalShading,!0)}Rw.isSupported=function(e){return zu.isSupported(e.context)};const an={},Uce=new Y(0,0,0,1);let pr=new Y;const kce=new Ot,aT=new k,cT=new k;an.worldToWindowCoordinates=function(e,t,n){return an.worldWithEyeOffsetToWindowCoordinates(e,t,m.ZERO,n)};an.wgs84ToWindowCoordinates=function(e,t,n){return pc("SceneTransforms.wgs84ToWindowCoordinates","SceneTransforms.wgs84ToWindowCoordinates has been deprecated. It will be removed in 1.21. Use SceneTransforms.worldToWindowCoordinates instead."),an.worldToWindowCoordinates(e,t,n)};const F1=new Y,B1=new m;function gd(e,t,n,i){const r=n.viewMatrix,s=P.multiplyByVector(r,Y.fromElements(e.x,e.y,e.z,1,F1),F1),o=m.multiplyComponents(t,m.normalize(s,B1),B1);return s.x+=t.x+o.x,s.y+=t.y+o.y,s.z+=o.z,P.multiplyByVector(n.frustum.projectionMatrix,s,i)}const jce=new oe(Math.PI,R.PI_OVER_TWO),Vce=new m,Gce=new m;an.worldWithEyeOffsetToWindowCoordinates=function(e,t,n,i){if(!l(e))throw new A("scene is required.");if(!l(t))throw new A("position is required.");const r=e.frameState,s=an.computeActualEllipsoidPosition(r,t,Uce);if(!l(s))return;const o=e.canvas,a=kce;a.x=0,a.y=0,a.width=o.clientWidth,a.height=o.clientHeight;const c=e.camera;let u=!1;if(r.mode===Ie.SCENE2D){const h=e.mapProjection,d=jce,p=h.project(d,Vce),g=m.clone(c.position,Gce),_=c.frustum.clone(),b=P.computeViewportTransformation(a,0,1,new P),x=c.frustum.projectionMatrix,E=c.positionWC.y,C=m.fromElements(R.sign(E)*p.x-E,0,-c.positionWC.x),w=et.pointToGLWindowCoordinates(x,b,C);if(E===0||w.x<=0||w.x>=o.clientWidth)u=!0;else{if(w.x>o.clientWidth*.5){a.width=w.x,c.frustum.right=p.x-E,pr=gd(s,n,c,pr),an.clipToGLWindowCoordinates(a,pr,aT),a.x+=w.x,c.position.x=-c.position.x;const S=c.frustum.right;c.frustum.right=-c.frustum.left,c.frustum.left=-S,pr=gd(s,n,c,pr),an.clipToGLWindowCoordinates(a,pr,cT)}else{a.x+=w.x,a.width-=w.x,c.frustum.left=-p.x-E,pr=gd(s,n,c,pr),an.clipToGLWindowCoordinates(a,pr,aT),a.x=a.x-a.width,c.position.x=-c.position.x;const S=c.frustum.left;c.frustum.left=-c.frustum.right,c.frustum.right=-S,pr=gd(s,n,c,pr),an.clipToGLWindowCoordinates(a,pr,cT)}m.clone(g,c.position),c.frustum=_.clone(),i=k.clone(aT,i),(i.x<0||i.x>o.clientWidth)&&(i.x=cT.x)}}if(r.mode!==Ie.SCENE2D||u){if(pr=gd(s,n,c,pr),pr.z<0&&!(c.frustum instanceof Sr)&&!(c.frustum instanceof Lo))return;i=an.clipToGLWindowCoordinates(a,pr,i)}return i.y=o.clientHeight-i.y,i};an.worldToDrawingBufferCoordinates=function(e,t,n){if(n=an.worldToWindowCoordinates(e,t,n),!!l(n))return an.transformWindowToDrawingBuffer(e,n,n)};an.wgs84ToDrawingBufferCoordinates=function(e,t,n){return pc("SceneTransforms.wgs84ToDrawingBufferCoordinates","SceneTransforms.wgs84ToDrawingBufferCoordinates has been deprecated. It will be removed in 1.21. Use SceneTransforms.worldToDrawingBufferCoordinates instead."),an.worldToDrawingBufferCoordinates(e,t,n)};const Ba=new m,Hce=new oe;an.computeActualEllipsoidPosition=function(e,t,n){const i=e.mode;if(i===Ie.SCENE3D)return m.clone(t,n);const r=e.mapProjection,s=r.ellipsoid.cartesianToCartographic(t,Hce);if(!l(s))return;if(r.project(s,Ba),i===Ie.COLUMBUS_VIEW)return m.fromElements(Ba.z,Ba.x,Ba.y,n);if(i===Ie.SCENE2D)return m.fromElements(0,Ba.x,Ba.y,n);const o=e.morphTime;return m.fromElements(R.lerp(Ba.z,t.x,o),R.lerp(Ba.x,t.y,o),R.lerp(Ba.y,t.z,o),n)};const z1=new m,U1=new m,k1=new P;an.clipToGLWindowCoordinates=function(e,t,n){return m.divideByScalar(t,t.w,z1),P.computeViewportTransformation(e,0,1,k1),P.multiplyByPoint(k1,z1,U1),k.fromCartesian3(U1,n)};an.transformWindowToDrawingBuffer=function(e,t,n){const i=e.canvas,r=e.drawingBufferWidth/i.clientWidth,s=e.drawingBufferHeight/i.clientHeight;return k.fromElements(t.x*r,t.y*s,n)};const qce=new Y,j1=new Y;an.drawingBufferToWorldCoordinates=function(e,t,n,i){const s=e.context.uniformState,o=s.currentFrustum,a=o.x,c=o.y;if(e.frameState.useLogDepth){const g=n*s.log2FarDepthFromNearPlusOne,_=Math.pow(2,g)-1;n=c*(1-a/(_+a))/(c-a)}const u=e.view.passState.viewport,h=Y.clone(Y.UNIT_W,qce);h.x=(t.x-u.x)/u.width*2-1,h.y=(t.y-u.y)/u.height*2-1,h.z=n*2-1,h.w=1;let d,p=e.camera.frustum;if(l(p.fovy)){d=P.multiplyByVector(s.inverseViewProjection,h,j1);const g=1/d.w;m.multiplyByScalar(d,g,d)}else{const g=p.offCenterFrustum;l(g)&&(p=g),d=j1,d.x=(h.x*(p.right-p.left)+p.left+p.right)*.5,d.y=(h.y*(p.top-p.bottom)+p.bottom+p.top)*.5,d.z=(h.z*(a-c)-a-c)*.5,d.w=1,d=P.multiplyByVector(s.inverseView,d,d)}return m.fromCartesian4(d,i)};const Mf={};Mf._deprecationWarning=pc;const za=Uint32Array.BYTES_PER_ELEMENT;Mf.parse=function(e,t){const n=T(t,0);y.defined("arrayBuffer",e),t=n;const i=new Uint8Array(e),r=new DataView(e);t+=za;const s=r.getUint32(t,!0);if(s!==1)throw new te(`Only Batched 3D Model version 1 is supported.  Version ${s} is not.`);t+=za;const o=r.getUint32(t,!0);t+=za;let a=r.getUint32(t,!0);t+=za;let c=r.getUint32(t,!0);t+=za;let u=r.getUint32(t,!0);t+=za;let h=r.getUint32(t,!0);t+=za;let d;u>=570425344?(t-=za*2,d=a,u=c,h=0,a=0,c=0,Mf._deprecationWarning("b3dm-legacy-header","This b3dm header is using the legacy format [batchLength] [batchTableByteLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/CesiumGS/3d-tiles/tree/main/specification/TileFormats/Batched3DModel.")):h>=570425344&&(t-=za,d=u,u=a,h=c,a=0,c=0,Mf._deprecationWarning("b3dm-legacy-header","This b3dm header is using the legacy format [batchTableJsonByteLength] [batchTableBinaryByteLength] [batchLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/CesiumGS/3d-tiles/tree/main/specification/TileFormats/Batched3DModel."));let p;a===0?p={BATCH_LENGTH:T(d,0)}:(p=Cs(i,t,a),t+=a);const g=new Uint8Array(e,t,c);t+=c;let _,b;u>0&&(_=Cs(i,t,u),t+=u,h>0&&(b=new Uint8Array(e,t,h),b=new Uint8Array(b),t+=h));const x=n+o-t;if(x===0)throw new te("glTF byte length must be greater than 0.");let E;return t%4===0?E=new Uint8Array(e,t,x):(Mf._deprecationWarning("b3dm-glb-unaligned","The embedded glb is not aligned to a 4-byte boundary."),E=new Uint8Array(i.subarray(t,t+x))),{batchLength:d,featureTableJson:p,featureTableBinary:g,batchTableJson:_,batchTableBinary:b,gltf:E}};function Ll(e,t){this.json=e,this.buffer=t,this._cachedTypedArrays={},this.featuresLength=0}function a2(e,t,n,i,r,s){const o=e._cachedTypedArrays;let a=o[t];return l(a)||(a=q.createArrayBufferView(n,e.buffer.buffer,e.buffer.byteOffset+s,r*i),o[t]=a),a}function Wce(e,t,n,i){const r=e._cachedTypedArrays;let s=r[t];return l(s)||(s=q.createTypedArray(n,i),r[t]=s),s}Ll.prototype.getGlobalProperty=function(e,t,n){const i=this.json[e];if(l(i))return l(i.byteOffset)?(t=T(t,q.UNSIGNED_INT),n=T(n,1),a2(this,e,t,n,1,i.byteOffset)):i};Ll.prototype.hasProperty=function(e){return l(this.json[e])};Ll.prototype.getPropertyArray=function(e,t,n){const i=this.json[e];if(l(i))return l(i.byteOffset)?(l(i.componentType)&&(t=q.fromName(i.componentType)),a2(this,e,t,n,this.featuresLength,i.byteOffset)):Wce(this,e,t,i)};Ll.prototype.getProperty=function(e,t,n,i,r){const s=this.json[e];if(!l(s))return;const o=this.getPropertyArray(e,t,n);if(n===1)return o[i];for(let a=0;a<n;++a)r[a]=o[n*i+a];return r};function Uu(e){y.typeOf.number("options.count",e.count),y.typeOf.object("options.batchTable",e.batchTable);const t=e.count,n=e.batchTable,i=e.binaryBody,r=T(e.parseAsPropertyAttributes,!1),s=e.customAttributeOutput;if(r&&!l(s))throw new A("customAttributeOutput is required when parsing batch table as property attributes");const o=$ce(n);let a;l(o.jsonProperties)&&(a=new Bu({count:t,properties:o.jsonProperties}));let c;l(o.hierarchy)&&(c=new Aa({extension:o.hierarchy,binaryBody:i}));const u=Al.BATCH_TABLE_CLASS_NAME,h=o.binaryProperties;let d,p,g;if(r){const x=Yce(t,u,h,i,s);g=x.transcodedSchema,p=[new tb({propertyAttribute:x.propertyAttributeJson,class:x.transcodedClass})]}else{const x=Xce(t,u,h,i);g=x.transcodedSchema;const E=x.featureTableJson;d=new Hr({count:E.count,properties:E.properties,class:x.transcodedClass,bufferViews:x.bufferViewsTypedArrays}),p=[]}const _=[];if(l(d)||l(a)||l(c)){const x=new mi({id:0,name:"Batch Table",count:t,metadataTable:d,jsonMetadataTable:a,batchTableHierarchy:c});_.push(x)}const b={schema:g,propertyTables:_,propertyAttributes:p,extensions:o.extensions,extras:o.extras};return new zo(b)}function $ce(e){const t=e.HIERARCHY,n=e.extras,i=e.extensions;let r;l(t)?(Uu._deprecationWarning("batchTableHierarchyExtension","The batch table HIERARCHY property has been moved to an extension. Use extensions.3DTILES_batch_table_hierarchy instead."),r=t):l(i)&&(r=i["3DTILES_batch_table_hierarchy"]);let s;const o={};for(const a in e){if(!e.hasOwnProperty(a)||a==="HIERARCHY"||a==="extensions"||a==="extras")continue;const c=e[a];Array.isArray(c)?(s=l(s)?s:{},s[a]=c):o[a]=c}return{binaryProperties:o,jsonProperties:s,hierarchy:r,extras:n,extensions:i}}function Xce(e,t,n,i){const r={},s={},o={};let a=0;for(const d in n){if(!n.hasOwnProperty(d))continue;if(!l(i))throw new te(`Property ${d} requires a batch table binary.`);const p=n[d],g=_u(p);s[d]={bufferView:a},r[d]=c2(p),o[a]=g.createArrayBufferView(i.buffer,i.byteOffset+p.byteOffset,e),a++}const c={classes:{}};c.classes[t]={properties:r};const u=Sl.fromJson(c);return{featureTableJson:{class:t,count:e,properties:s},bufferViewsTypedArrays:o,transcodedSchema:u,transcodedClass:u.classes[t]}}function Yce(e,t,n,i,r){const s={},o={};let a=0;for(const d in n){if(!n.hasOwnProperty(d))continue;const p=n[d];if(!l(i)&&!l(p.typedArray))throw new te(`Property ${d} requires a batch table binary.`);let g=je.sanitizeGlslIdentifier(d);(g===""||s.hasOwnProperty(g))&&(g=`property_${a}`,a++);const _=c2(p);_.name=d,s[g]=_;let b=g.toUpperCase();b.startsWith("_")||(b=`_${b}`);let x=p.typedArray;l(x)||(x=_u(p).createArrayBufferView(i.buffer,i.byteOffset+p.byteOffset,e));const E=new Be.Attribute;E.name=b,E.count=e,E.type=p.type;const C=q.fromTypedArray(x);(C===q.INT||C===q.UNSIGNED_INT||C===q.DOUBLE)&&(Uu._oneTimeWarning("Cast pnts property to floats",`Point cloud property "${b}" will be cast to a float array because INT, UNSIGNED_INT, and DOUBLE are not valid WebGL vertex attribute types. Some precision may be lost.`),x=new Float32Array(x)),E.componentDatatype=q.fromTypedArray(x),E.typedArray=x,r.push(E),o[g]={attribute:b}}const c={classes:{}};c.classes[t]={properties:s};const u=Sl.fromJson(c);return{class:t,propertyAttributeJson:{properties:o},transcodedSchema:u,transcodedClass:u.classes[t]}}function c2(e){const t=Kce(e.componentType);return{type:e.type,componentType:t}}function Kce(e){switch(e){case"BYTE":return"INT8";case"UNSIGNED_BYTE":return"UINT8";case"SHORT":return"INT16";case"UNSIGNED_SHORT":return"UINT16";case"INT":return"INT32";case"UNSIGNED_INT":return"UINT32";case"FLOAT":return"FLOAT32";case"DOUBLE":return"FLOAT64"}}Uu._deprecationWarning=pc;Uu._oneTimeWarning=kr;const xu={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,FAILED:4},Zce=Be.FeatureIdAttribute;function ul(e){e=T(e,T.EMPTY_OBJECT);const t=e.b3dmResource;let n=e.baseResource;const i=e.arrayBuffer,r=T(e.byteOffset,0),s=T(e.releaseGltfJson,!1),o=T(e.asynchronous,!0),a=T(e.incrementallyLoadTextures,!0),c=T(e.upAxis,ir.Y),u=T(e.forwardAxis,ir.X),h=T(e.loadAttributesAsTypedArray,!1),d=T(e.loadAttributesFor2D,!1),p=T(e.enablePick,!1),g=T(e.loadIndicesForWireframe,!1),_=T(e.loadPrimitiveOutline,!0),b=T(e.loadForClassification,!1);y.typeOf.object("options.b3dmResource",t),y.typeOf.object("options.arrayBuffer",i),n=l(n)?n:t.clone(),this._b3dmResource=t,this._baseResource=n,this._arrayBuffer=i,this._byteOffset=r,this._releaseGltfJson=s,this._asynchronous=o,this._incrementallyLoadTextures=a,this._upAxis=c,this._forwardAxis=u,this._loadAttributesAsTypedArray=h,this._loadAttributesFor2D=d,this._enablePick=p,this._loadIndicesForWireframe=g,this._loadPrimitiveOutline=_,this._loadForClassification=b,this._state=xu.UNLOADED,this._promise=void 0,this._gltfLoader=void 0,this._batchLength=0,this._propertyTable=void 0,this._batchTable=void 0,this._components=void 0,this._transform=P.IDENTITY}l(Object.create)&&(ul.prototype=Object.create(ai.prototype),ul.prototype.constructor=ul);Object.defineProperties(ul.prototype,{texturesLoaded:{get:function(){var e;return(e=this._gltfLoader)==null?void 0:e.texturesLoaded}},cacheKey:{get:function(){}},components:{get:function(){return this._components}}});ul.prototype.load=function(){if(l(this._promise))return this._promise;const e=Mf.parse(this._arrayBuffer,this._byteOffset);let t=e.batchLength;const n=e.featureTableJson,i=e.featureTableBinary,r=e.batchTableJson,s=e.batchTableBinary,o=new Ll(n,i);t=o.getGlobalProperty("BATCH_LENGTH"),this._batchLength=t;const a=o.getGlobalProperty("RTC_CENTER",q.FLOAT,3);l(a)&&(this._transform=P.fromTranslation(m.fromArray(a))),this._batchTable={json:r,binary:s};const c=new Ts({typedArray:e.gltf,upAxis:this._upAxis,forwardAxis:this._forwardAxis,gltfResource:this._b3dmResource,baseResource:this._baseResource,releaseGltfJson:this._releaseGltfJson,incrementallyLoadTextures:this._incrementallyLoadTextures,loadAttributesAsTypedArray:this._loadAttributesAsTypedArray,loadAttributesFor2D:this._loadAttributesFor2D,enablePick:this._enablePick,loadIndicesForWireframe:this._loadIndicesForWireframe,loadPrimitiveOutline:this._loadPrimitiveOutline,loadForClassification:this._loadForClassification,renameBatchIdSemantic:!0});this._gltfLoader=c,this._state=xu.LOADING;const u=this;return this._promise=c.load().then(function(){if(!u.isDestroyed())return u._state=xu.PROCESSING,u}).catch(function(h){if(!u.isDestroyed())return Jce(u,h)}),this._promise};function Jce(e,t){return e.unload(),e._state=xu.FAILED,t=e.getError("Failed to load b3dm",t),Promise.reject(t)}ul.prototype.process=function(e){if(y.typeOf.object("frameState",e),this._state===xu.READY)return!0;if(this._state!==xu.PROCESSING||!this._gltfLoader.process(e))return!1;const n=this._gltfLoader.components;return n.transform=P.multiplyTransformation(this._transform,n.transform,n.transform),Qce(this,n),this._components=n,this._arrayBuffer=void 0,this._state=xu.READY,!0};function Qce(e,t){const n=e._batchTable,i=e._batchLength;if(i===0)return;let r;if(l(n.json))r=Uu({count:i,batchTable:n.json,binaryBody:n.binary});else{const a=new mi({name:Al.BATCH_TABLE_CLASS_NAME,count:i});r=new zo({schema:{},propertyTables:[a]})}const s=t.scene.nodes,o=s.length;for(let a=0;a<o;a++)l2(s[a]);t.structuralMetadata=r}function l2(e){const t=e.children.length;for(let i=0;i<t;i++)l2(e.children[i]);const n=e.primitives.length;for(let i=0;i<n;i++){const r=e.primitives[i],s=je.getAttributeBySemantic(r,Me.FEATURE_ID);if(l(s)){s.setIndex=0;const o=new Zce;o.propertyTableId=0,o.setIndex=0,o.positionalLabel="featureId_0",r.featureIds.push(o)}}}ul.prototype.unload=function(){l(this._gltfLoader)&&!this._gltfLoader.isDestroyed()&&this._gltfLoader.unload(),this._components=void 0,this._arrayBuffer=void 0};function fl(e){e=T(e,T.EMPTY_OBJECT),y.typeOf.object("options.geoJson",e.geoJson),this._geoJson=e.geoJson,this._components=void 0}l(Object.create)&&(fl.prototype=Object.create(ai.prototype),fl.prototype.constructor=fl);Object.defineProperties(fl.prototype,{cacheKey:{get:function(){}},components:{get:function(){return this._components}}});fl.prototype.load=function(){return Promise.resolve(this)};fl.prototype.process=function(e){return y.typeOf.object("frameState",e),l(this._components)||(this._components=hle(this._geoJson,e),this._geoJson=void 0),!0};function ele(){this.lines=void 0,this.points=void 0,this.properties=void 0}function tle(){this.features=[]}function Dw(e){const t=e[0],n=e[1],i=T(e[2],0);return new m(t,n,i)}function Mw(e){const t=e.length,n=new Array(t);for(let r=0;r<t;r++)n[r]=Dw(e[r]);return[n]}function nle(e){const t=e.length,n=new Array(t);for(let i=0;i<t;i++)n[i]=Mw(e[i])[0];return n}function u2(e){const t=e.length,n=new Array(t);for(let i=0;i<t;i++)n[i]=Mw(e[i])[0];return n}function ile(e){const t=e.length,n=[];for(let i=0;i<t;i++)Array.prototype.push.apply(n,u2(e[i]));return n}function rle(e){return[Dw(e)]}function sle(e){const t=e.length,n=new Array(t);for(let i=0;i<t;i++)n[i]=Dw(e[i]);return n}const ole={LineString:Mw,MultiLineString:nle,MultiPolygon:ile,Polygon:u2,MultiPoint:sle,Point:rle},ale={LineString:Fe.LINES,MultiLineString:Fe.LINES,MultiPolygon:Fe.LINES,Polygon:Fe.LINES,MultiPoint:Fe.POINTS,Point:Fe.POINTS};function f2(e,t){if(!l(e.geometry))return;const n=e.geometry.type,i=ole[n],r=ale[n],s=e.geometry.coordinates;if(!l(i)||!l(s))return;const o=new ele;r===Fe.LINES?o.lines=i(s):r===Fe.POINTS&&(o.points=i(s)),o.properties=e.properties,t.features.push(o)}function cle(e,t){const n=e.features,i=n.length;for(let r=0;r<i;r++)f2(n[r],t)}const lle={FeatureCollection:cle,Feature:f2},ry=new m;function ule(e,t,n){let i=0,r=0;const s=e.length;for(let N=0;N<s;N++){const B=e[N];if(l(B.lines)){const U=B.lines.length;for(let V=0;V<U;V++){const f=B.lines[V];i+=f.length,r+=(f.length-1)*2}}}const o=new Float32Array(i*3),a=new Float32Array(i),c=Ge.createTypedArray(i,r),u=Ge.fromTypedArray(c),h=new m(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),d=new m(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);let p=0,g=0;for(let N=0;N<s;N++){const B=e[N];if(!l(B.lines))continue;const U=B.lines.length;for(let V=0;V<U;V++){const f=B.lines[V],I=f.length;for(let F=0;F<I;F++){const G=f[F],W=m.fromDegrees(G.x,G.y,G.z,fe.WGS84,ry),X=P.multiplyByPoint(t,W,ry);m.minimumByComponent(h,X,h),m.maximumByComponent(d,X,d),m.pack(X,o,p*3),a[p]=N,F<I-1&&(c[g*2]=p,c[g*2+1]=p+1,g++),p++}}}const _=ze.createVertexBuffer({typedArray:o,context:n.context,usage:Ae.STATIC_DRAW});_.vertexArrayDestroyable=!1;const b=ze.createVertexBuffer({typedArray:a,context:n.context,usage:Ae.STATIC_DRAW});b.vertexArrayDestroyable=!1;const x=ze.createIndexBuffer({typedArray:c,context:n.context,usage:Ae.STATIC_DRAW,indexDatatype:u});x.vertexArrayDestroyable=!1;const E=new Be.Attribute;E.semantic=Me.POSITION,E.componentDatatype=q.FLOAT,E.type=tt.VEC3,E.count=i,E.min=h,E.max=d,E.buffer=_;const C=new Be.Attribute;C.semantic=Me.FEATURE_ID,C.setIndex=0,C.componentDatatype=q.FLOAT,C.type=tt.SCALAR,C.count=i,C.buffer=b;const w=[E,C],S=new Be.Material;S.unlit=!0;const v=new Be.Indices;v.indexDatatype=u,v.count=c.length,v.buffer=x;const D=new Be.FeatureIdAttribute;D.featureCount=s,D.propertyTableId=0,D.setIndex=0,D.positionalLabel="featureId_0";const L=[D],O=new Be.Primitive;return O.attributes=w,O.indices=v,O.featureIds=L,O.primitiveType=Fe.LINES,O.material=S,O}function fle(e,t,n){let i=0;const r=e.length;for(let w=0;w<r;w++){const S=e[w];l(S.points)&&(i+=S.points.length)}const s=new Float32Array(i*3),o=new Float32Array(i),a=new m(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),c=new m(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);let u=0;for(let w=0;w<r;w++){const S=e[w];if(!l(S.points))continue;const v=S.points.length;for(let D=0;D<v;D++){const L=S.points[D],O=m.fromDegrees(L.x,L.y,L.z,fe.WGS84,ry),N=P.multiplyByPoint(t,O,ry);m.minimumByComponent(a,N,a),m.maximumByComponent(c,N,c),m.pack(N,s,u*3),o[u]=w,u++}}const h=ze.createVertexBuffer({typedArray:s,context:n.context,usage:Ae.STATIC_DRAW});h.vertexArrayDestroyable=!1;const d=ze.createVertexBuffer({typedArray:o,context:n.context,usage:Ae.STATIC_DRAW});d.vertexArrayDestroyable=!1;const p=new Be.Attribute;p.semantic=Me.POSITION,p.componentDatatype=q.FLOAT,p.type=tt.VEC3,p.count=i,p.min=a,p.max=c,p.buffer=h;const g=new Be.Attribute;g.semantic=Me.FEATURE_ID,g.setIndex=0,g.componentDatatype=q.FLOAT,g.type=tt.SCALAR,g.count=i,g.buffer=d;const _=[p,g],b=new Be.Material;b.unlit=!0;const x=new Be.FeatureIdAttribute;x.featureCount=r,x.propertyTableId=0,x.setIndex=0,x.positionalLabel="featureId_0";const E=[x],C=new Be.Primitive;return C.attributes=_,C.featureIds=E,C.primitiveType=Fe.POINTS,C.material=b,C}function hle(e,t){const n=new tle,i=lle[e.type];l(i)&&i(e,n);const r=n.features,s=r.length;if(s===0)throw new te("GeoJSON must have at least one feature");const o={};for(let N=0;N<s;N++){const B=r[N],U=T(B.properties,T.EMPTY_OBJECT);for(const V in U)U.hasOwnProperty(V)&&(l(o[V])||(o[V]=new Array(s)))}for(let N=0;N<s;N++){const B=r[N];for(const U in o)if(o.hasOwnProperty(U)){const V=T(B.properties[U],"");o[U][N]=V}}const a=new Bu({count:s,properties:o}),u=[new mi({id:0,count:s,jsonMetadataTable:a})],h=Sl.fromJson({}),d=new zo({schema:h,propertyTables:u}),p=new m(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),g=new m(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);let _=!1,b=!1;for(let N=0;N<s;N++){const B=r[N];if(l(B.lines)){_=!0;const U=B.lines.length;for(let V=0;V<U;V++){const f=B.lines[V],I=f.length;for(let F=0;F<I;F++)m.minimumByComponent(p,f[F],p),m.maximumByComponent(g,f[F],g)}}if(l(B.points)){b=!0;const U=B.points.length;for(let V=0;V<U;V++){const f=B.points[V];m.minimumByComponent(p,f,p),m.maximumByComponent(g,f,g)}}}const x=m.midpoint(p,g,new m),E=m.fromDegrees(x.x,x.y,x.z,fe.WGS84,new m),C=et.eastNorthUpToFixedFrame(E,fe.WGS84,new P),w=P.inverseTransformation(C,new P),S=[];_&&S.push(ule(r,w,t)),b&&S.push(fle(r,w,t));const v=new Be.Node;v.index=0,v.primitives=S;const D=[v],L=new Be.Scene;L.nodes=D;const O=new Be.Components;return O.scene=L,O.nodes=D,O.transform=C,O.structuralMetadata=d,O}fl.prototype.unload=function(){this._components=void 0};const sy={};sy._deprecationWarning=pc;const Fc=Uint32Array.BYTES_PER_ELEMENT;sy.parse=function(e,t){y.defined("arrayBuffer",e);const n=T(t,0);t=n;const i=new Uint8Array(e),r=new DataView(e);t+=Fc;const s=r.getUint32(t,!0);if(s!==1)throw new te(`Only Instanced 3D Model version 1 is supported. Version ${s} is not.`);t+=Fc;const o=r.getUint32(t,!0);t+=Fc;const a=r.getUint32(t,!0);if(a===0)throw new te("featureTableJsonByteLength is zero, the feature table must be defined.");t+=Fc;const c=r.getUint32(t,!0);t+=Fc;const u=r.getUint32(t,!0);t+=Fc;const h=r.getUint32(t,!0);t+=Fc;const d=r.getUint32(t,!0);if(d!==1&&d!==0)throw new te(`Only glTF format 0 (uri) or 1 (embedded) are supported. Format ${d} is not.`);t+=Fc;const p=Cs(i,t,a);t+=a;const g=new Uint8Array(e,t,c);t+=c;let _,b;u>0&&(_=Cs(i,t,u),t+=u,h>0&&(b=new Uint8Array(e,t,h),b=new Uint8Array(b),t+=h));const x=n+o-t;if(x===0)throw new te("glTF byte length must be greater than 0.");let E;return t%4===0?E=new Uint8Array(e,t,x):(sy._deprecationWarning("i3dm-glb-unaligned","The embedded glb is not aligned to a 4-byte boundary."),E=new Uint8Array(i.subarray(t,t+x))),{gltfFormat:d,featureTableJson:p,featureTableBinary:g,batchTableJson:_,batchTableBinary:b,gltf:E}};const ec={NOT_LOADED:0,LOADING:1,PROCESSING:2,POST_PROCESSING:3,READY:4,FAILED:5,UNLOADED:6},bg=Be.Attribute,dle=Be.FeatureIdAttribute,h2=Be.Instances;function tc(e){e=T(e,T.EMPTY_OBJECT);const t=e.i3dmResource,n=e.arrayBuffer;let i=e.baseResource;const r=T(e.byteOffset,0),s=T(e.releaseGltfJson,!1),o=T(e.asynchronous,!0),a=T(e.incrementallyLoadTextures,!0),c=T(e.upAxis,ir.Y),u=T(e.forwardAxis,ir.X),h=T(e.loadAttributesAsTypedArray,!1),d=T(e.loadIndicesForWireframe,!1),p=T(e.loadPrimitiveOutline,!0),g=T(e.enablePick,!1);y.typeOf.object("options.i3dmResource",t),y.typeOf.object("options.arrayBuffer",n),i=l(i)?i:t.clone(),this._i3dmResource=t,this._baseResource=i,this._arrayBuffer=n,this._byteOffset=r,this._releaseGltfJson=s,this._asynchronous=o,this._incrementallyLoadTextures=a,this._upAxis=c,this._forwardAxis=u,this._loadAttributesAsTypedArray=h,this._loadIndicesForWireframe=d,this._loadPrimitiveOutline=p,this._enablePick=g,this._state=ec.NOT_LOADED,this._promise=void 0,this._gltfLoader=void 0,this._buffers=[],this._components=void 0,this._transform=P.IDENTITY,this._batchTable=void 0,this._featureTable=void 0,this._instancesLength=0}l(Object.create)&&(tc.prototype=Object.create(ai.prototype),tc.prototype.constructor=tc);Object.defineProperties(tc.prototype,{texturesLoaded:{get:function(){var e;return(e=this._gltfLoader)==null?void 0:e.texturesLoaded}},cacheKey:{get:function(){}},components:{get:function(){return this._components}}});tc.prototype.load=function(){if(l(this._promise))return this._promise;const e=sy.parse(this._arrayBuffer,this._byteOffset),t=e.featureTableJson,n=e.featureTableBinary,i=e.batchTableJson,r=e.batchTableBinary,s=e.gltfFormat,o=new Ll(t,n);this._featureTable=o;const a=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=a,!l(a))throw new te("Feature table global property: INSTANCES_LENGTH must be defined");this._instancesLength=a;const c=o.getGlobalProperty("RTC_CENTER",q.FLOAT,3);l(c)&&(this._transform=P.fromTranslation(m.fromArray(c))),this._batchTable={json:i,binary:r};const u={upAxis:this._upAxis,forwardAxis:this._forwardAxis,releaseGltfJson:this._releaseGltfJson,incrementallyLoadTextures:this._incrementallyLoadTextures,loadAttributesAsTypedArray:this._loadAttributesAsTypedArray,enablePick:this._enablePick,loadIndicesForWireframe:this._loadIndicesForWireframe,loadPrimitiveOutline:this._loadPrimitiveOutline};if(s===0){let d=gs(e.gltf);d=d.replace(/[\s\0]+$/,"");const p=this._baseResource.getDerivedResource({url:d});u.gltfResource=p,u.baseResource=p}else u.gltfResource=this._i3dmResource,u.typedArray=e.gltf;const h=new Ts(u);return this._gltfLoader=h,this._state=ec.LOADING,this._promise=h.load().then(()=>{if(!this.isDestroyed())return this._state=ec.PROCESSING,this}).catch(d=>{if(!this.isDestroyed())throw ple(this,d)}),this._promise};function ple(e,t){return e.unload(),e._state=ec.FAILED,e.getError("Failed to load i3dm",t)}tc.prototype.process=function(e){if(y.typeOf.object("frameState",e),this._state===ec.READY)return!0;const t=this._gltfLoader;let n=!1;if(this._state===ec.PROCESSING&&(n=t.process(e)),!n)return!1;const i=t.components;return i.transform=P.multiplyTransformation(this._transform,i.transform,i.transform),_le(this,i,e),mle(this,i),this._components=i,this._arrayBuffer=void 0,this._state=ec.READY,!0};function mle(e,t){const n=e._batchTable,i=e._instancesLength;if(i===0)return;let r;if(l(n.json))r=Uu({count:i,batchTable:n.json,binaryBody:n.binary});else{const s=new mi({name:Al.BATCH_TABLE_CLASS_NAME,count:i});r=new zo({schema:{},propertyTables:[s]})}t.structuralMetadata=r}const Tg=new m,aE=new Array(4),gle=new P;function _le(e,t,n){let i;const r=e._featureTable,s=e._instancesLength;if(s===0)return;const o=r.getGlobalProperty("RTC_CENTER",q.FLOAT,3),a=r.getGlobalProperty("EAST_NORTH_UP"),c=r.hasProperty("NORMAL_UP")||r.hasProperty("NORMAL_UP_OCT32P")||a,u=r.hasProperty("SCALE")||r.hasProperty("SCALE_NON_UNIFORM"),h=ble(r);let d;c&&(d=new Float32Array(4*s));let p;u&&(p=new Float32Array(3*s));const g=new Float32Array(s),_=m.unpackArray(h);let b=new m;const x=new m,E=new m,C=new m,w=new H,S=new re,v=new Array(4),D=new m,L=new Array(3),O=new P;if(!l(o)||m.equals(m.unpack(o),m.ZERO)){const X=ee.fromPoints(_);for(i=0;i<_.length;i++)m.subtract(_[i],X.center,Tg),h[3*i+0]=Tg.x,h[3*i+1]=Tg.y,h[3*i+2]=Tg.z;const Z=P.fromTranslation(X.center,gle);t.transform=P.multiplyTransformation(Z,t.transform,t.transform)}for(i=0;i<s;i++){b=m.clone(_[i]),l(o)&&m.add(b,m.unpack(o),b),c&&(Tle(r,a,i,S,b,E,x,C,w,O),re.pack(S,v,0),d[4*i+0]=v[0],d[4*i+1]=v[1],d[4*i+2]=v[2],d[4*i+3]=v[3]),u&&(xle(r,i,D),m.pack(D,L,0),p[3*i+0]=L[0],p[3*i+1]=L[1],p[3*i+2]=L[2]);let X=r.getProperty("BATCH_ID",q.UNSIGNED_SHORT,1,i);l(X)||(X=i),g[i]=X}const N=new h2;N.transformInWorldSpace=!0;const B=e._buffers,U=new bg;if(U.name="Instance Translation",U.semantic=Tr.TRANSLATION,U.componentDatatype=q.FLOAT,U.type=tt.VEC3,U.count=s,U.typedArray=h,!c){const X=ze.createVertexBuffer({context:n.context,typedArray:h,usage:Ae.STATIC_DRAW});X.vertexArrayDestroyable=!1,B.push(X),U.buffer=X}if(N.attributes.push(U),c){const X=new bg;X.name="Instance Rotation",X.semantic=Tr.ROTATION,X.componentDatatype=q.FLOAT,X.type=tt.VEC4,X.count=s,X.typedArray=d,N.attributes.push(X)}if(u){const X=new bg;if(X.name="Instance Scale",X.semantic=Tr.SCALE,X.componentDatatype=q.FLOAT,X.type=tt.VEC3,X.count=s,c)X.typedArray=p;else{const Z=ze.createVertexBuffer({context:n.context,typedArray:p,usage:Ae.STATIC_DRAW});Z.vertexArrayDestroyable=!1,B.push(Z),X.buffer=Z}N.attributes.push(X)}const V=new bg;V.name="Instance Feature ID",V.setIndex=0,V.semantic=Tr.FEATURE_ID,V.componentDatatype=q.FLOAT,V.type=tt.SCALAR,V.count=s;const f=ze.createVertexBuffer({context:n.context,typedArray:g,usage:Ae.STATIC_DRAW});f.vertexArrayDestroyable=!1,B.push(f),V.buffer=f,N.attributes.push(V);const I=new dle;I.propertyTableId=0,I.setIndex=0,I.positionalLabel="instanceFeatureId_0",N.featureIds.push(I);const F=t.nodes,G=F.length;let W=!1;for(i=0;i<G;i++){const X=F[i];X.primitives.length>0&&(X.instances=W?yle(N):N,W=!0)}}function yle(e){const t=new h2;t.transformInWorldSpace=e.transformInWorldSpace;const n=e.attributes,i=n.length;for(let r=0;r<i;r++){const s=Se(n[r],!1);t.attributes.push(s)}return t.featureIds=e.featureIds,t}function ble(e,t){if(e.hasProperty("POSITION"))return e.getPropertyArray("POSITION",q.FLOAT,3);if(e.hasProperty("POSITION_QUANTIZED")){const n=e.getPropertyArray("POSITION_QUANTIZED",q.UNSIGNED_SHORT,3),i=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",q.FLOAT,3);if(!l(i))throw new te("Global property: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const r=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",q.FLOAT,3);if(!l(r))throw new te("Global property: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const s=new Float32Array(n.length);for(let o=0;o<n.length/3;o++)for(let a=0;a<3;a++){const c=3*o+a;s[c]=n[c]/65535*r[a]+i[a]}return s}else throw new te("Either POSITION or POSITION_QUANTIZED must be defined for each instance.")}const V1=new Array(4);function Tle(e,t,n,i,r,s,o,a,c,u){const h=e.getProperty("NORMAL_UP",q.FLOAT,3,n,aE),d=e.getProperty("NORMAL_RIGHT",q.FLOAT,3,n,V1);let p=!1;if(l(h)){if(!l(d))throw new te("To define a custom orientation, both NORMAL_UP and NORMAL_RIGHT must be defined.");m.unpack(h,0,s),m.unpack(d,0,o),p=!0}else{const g=e.getProperty("NORMAL_UP_OCT32P",q.UNSIGNED_SHORT,2,n,aE),_=e.getProperty("NORMAL_RIGHT_OCT32P",q.UNSIGNED_SHORT,2,n,V1);if(l(g)){if(!l(_))throw new te("To define a custom orientation with oct-encoded vectors, both NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P must be defined.");nt.octDecodeInRange(g[0],g[1],65535,s),nt.octDecodeInRange(_[0],_[1],65535,o),p=!0}else t?(et.eastNorthUpToFixedFrame(r,fe.WGS84,u),P.getMatrix3(u,c)):H.clone(H.IDENTITY,c)}p&&(m.cross(o,s,a),m.normalize(a,a),H.setColumn(c,0,o,c),H.setColumn(c,1,s,c),H.setColumn(c,2,a,c)),re.fromRotationMatrix(c,i)}function xle(e,t,n){n=m.fromElements(1,1,1,n);const i=e.getProperty("SCALE",q.FLOAT,1,t);l(i)&&m.multiplyByScalar(n,i,n);const r=e.getProperty("SCALE_NON_UNIFORM",q.FLOAT,3,t,aE);l(r)&&(n.x*=r[0],n.y*=r[1],n.z*=r[2])}function Ele(e){const t=e._buffers,n=t.length;for(let i=0;i<n;i++){const r=t[i];r.isDestroyed()||r.destroy()}t.length=0}tc.prototype.isUnloaded=function(){return this._state===ec.UNLOADED};tc.prototype.unload=function(){l(this._gltfLoader)&&!this._gltfLoader.isDestroyed()&&this._gltfLoader.unload(),Ele(this),this._components=void 0,this._arrayBuffer=void 0,this._state=ec.UNLOADED};const Cle={STOPPED:0,ANIMATING:1},_f=Object.freeze(Cle),Lf=Be.AnimatedPropertyType;function Lw(e){e=T(e,T.EMPTY_OBJECT);const t=e.channel,n=e.runtimeAnimation,i=e.runtimeNode;y.typeOf.object("options.channel",t),y.typeOf.object("options.runtimeAnimation",n),y.typeOf.object("options.runtimeNode",i),this._channel=t,this._runtimeAnimation=n,this._runtimeNode=i,this._splines=[],this._path=void 0,Ile(this)}Object.defineProperties(Lw.prototype,{channel:{get:function(){return this._channel}},runtimeAnimation:{get:function(){return this._runtimeAnimation}},runtimeNode:{get:function(){return this._runtimeNode}},splines:{get:function(){return this._splines}}});function wle(e,t){const n=[],i=[],r=[],s=t.length;for(let o=0;o<s;o+=3)i.push(t[o]),n.push(t[o+1]),r.push(t[o+2]);return i.splice(0,1),r.length=r.length-1,new os({times:e,points:n,inTangents:i,outTangents:r})}function G1(e,t,n,i){if(e.length===1&&t.length===1)return new Ih(t[0]);switch(n){case Gf.STEP:return new Rh({times:e,points:t});case Gf.CUBICSPLINE:return wle(e,t);case Gf.LINEAR:return i===Lf.ROTATION?new Oh({times:e,points:t}):new Dl({times:e,points:t})}}function Ale(e,t,n,i,r){const s=[];if(i===Lf.WEIGHTS){const a=t.length/r;let c,u;for(c=0;c<r;c++){const h=new Array(a);let d=c;if(n===Gf.CUBICSPLINE)for(u=0;u<a;u+=3)h[u]=t[d],h[u+1]=t[d+r],h[u+2]=t[d+2*r],d+=r*3;else for(u=0;u<a;u++)h[u]=t[d],d+=r;s.push(G1(e,h,n,i))}}else s.push(G1(e,t,n,i));return s}const Sle=new m,vle=new re;function Ile(e){const t=e._channel,n=t.sampler,i=n.input,r=n.output,s=n.interpolation,a=t.target.path,c=e._runtimeNode,u=l(c.morphWeights)?c.morphWeights.length:1,h=Ale(i,r,s,a,u);e._splines=h,e._path=a}Lw.prototype.animate=function(e){const t=this._splines,n=this._path,i=this._runtimeAnimation.model,r=this._runtimeNode;if(n===Lf.WEIGHTS){const s=r.morphWeights,o=s.length;for(let a=0;a<o;a++){const c=t[a],u=i.clampAnimations?c.clampTime(e):c.wrapTime(e);s[a]=c.evaluate(u)}}else{if(r.userAnimated)return;{const s=t[0],o=i.clampAnimations?s.clampTime(e):s.wrapTime(e);n===Lf.TRANSLATION||n===Lf.SCALE?r[n]=s.evaluate(o,Sle):n===Lf.ROTATION&&(r[n]=s.evaluate(o,vle))}}};function Pw(e,t,n){this._animation=t,this._name=t.name,this._runtimeChannels=void 0,this._startTime=ue.clone(n.startTime),this._delay=T(n.delay,0),this._stopTime=ue.clone(n.stopTime),this.removeOnStop=T(n.removeOnStop,!1),this._multiplier=T(n.multiplier,1),this._reverse=T(n.reverse,!1),this._loop=T(n.loop,Df.NONE),this._animationTime=n.animationTime,this._prevAnimationDelta=void 0,this.start=new jt,this.update=new jt,this.stop=new jt,this._state=_f.STOPPED,this._computedStartTime=void 0,this._duration=void 0;const i=this;this._raiseStartEvent=function(){i.start.raiseEvent(e,i)},this._updateEventTime=0,this._raiseUpdateEvent=function(){i.update.raiseEvent(e,i,i._updateEventTime)},this._raiseStopEvent=function(){i.stop.raiseEvent(e,i)},this._model=e,this._localStartTime=void 0,this._localStopTime=void 0,Ole(this)}Object.defineProperties(Pw.prototype,{animation:{get:function(){return this._animation}},name:{get:function(){return this._name}},runtimeChannels:{get:function(){return this._runtimeChannels}},model:{get:function(){return this._model}},localStartTime:{get:function(){return this._localStartTime}},localStopTime:{get:function(){return this._localStopTime}},startTime:{get:function(){return this._startTime}},delay:{get:function(){return this._delay}},stopTime:{get:function(){return this._stopTime}},multiplier:{get:function(){return this._multiplier}},reverse:{get:function(){return this._reverse}},loop:{get:function(){return this._loop}},animationTime:{get:function(){return this._animationTime}}});function Ole(e){let t=Number.MAX_VALUE,n=-Number.MAX_VALUE;const i=e._model.sceneGraph,s=e._animation.channels,o=s.length,a=[];for(let c=0;c<o;c++){const u=s[c],h=u.target;if(!l(h))continue;const d=h.node.index,p=i._runtimeNodes[d],g=new Lw({channel:u,runtimeAnimation:e,runtimeNode:p}),_=u.sampler.input;t=Math.min(t,_[0]),n=Math.max(n,_[_.length-1]),a.push(g)}e._runtimeChannels=a,e._localStartTime=t,e._localStopTime=n}Pw.prototype.animate=function(e){const t=this._runtimeChannels,n=t.length;for(let i=0;i<n;i++)t[i].animate(e)};function _c(e){this.animationAdded=new jt,this.animationRemoved=new jt,this.animateWhilePaused=!1,this._model=e,this._runtimeAnimations=[],this._previousTime=void 0}Object.defineProperties(_c.prototype,{length:{get:function(){return this._runtimeAnimations.length}},model:{get:function(){return this._model}}});function cE(e,t,n){const i=e._model,r=new Pw(i,t,n);return e._runtimeAnimations.push(r),e.animationAdded.raiseEvent(i,r),r}_c.prototype.add=function(e){e=T(e,T.EMPTY_OBJECT);const t=this._model;if(!t.ready)throw new A("Animations are not loaded.  Wait for Model.ready to be true.");const n=t.sceneGraph.components.animations;if(!l(e.name)&&!l(e.index))throw new A("Either options.name or options.index must be defined.");if(l(e.multiplier)&&e.multiplier<=0)throw new A("options.multiplier must be greater than zero.");if(l(e.index)&&(e.index>=n.length||e.index<0))throw new A("options.index must be a valid animation index.");let i=e.index;if(l(i))return cE(this,n[i],e);const r=n.length;for(let s=0;s<r;++s)if(n[s].name===e.name){i=s;break}if(!l(i))throw new A("options.name must be a valid animation name.");return cE(this,n[i],e)};_c.prototype.addAll=function(e){e=T(e,T.EMPTY_OBJECT);const t=this._model;if(!t.ready)throw new A("Animations are not loaded.  Wait for Model.ready to be true.");if(l(e.multiplier)&&e.multiplier<=0)throw new A("options.multiplier must be greater than zero.");const n=t.sceneGraph.components.animations,i=[],r=n.length;for(let s=0;s<r;++s){const o=cE(this,n[s],e);i.push(o)}return i};_c.prototype.remove=function(e){if(!l(e))return!1;const t=this._runtimeAnimations,n=t.indexOf(e);return n!==-1?(t.splice(n,1),this.animationRemoved.raiseEvent(this._model,e),!0):!1};_c.prototype.removeAll=function(){const e=this._model,t=this._runtimeAnimations,n=t.length;this._runtimeAnimations.length=0;for(let i=0;i<n;++i)this.animationRemoved.raiseEvent(e,t[i])};_c.prototype.contains=function(e){return l(e)?this._runtimeAnimations.indexOf(e)!==-1:!1};_c.prototype.get=function(e){if(!l(e))throw new A("index is required.");if(e>=this._runtimeAnimations.length||e<0)throw new A("index must be valid within the range of the collection");return this._runtimeAnimations[e]};const xg=[];function Rle(e,t,n){return function(){e.animationRemoved.raiseEvent(t,n)}}_c.prototype.update=function(e){const t=this._runtimeAnimations;let n=t.length;if(n===0)return this._previousTime=void 0,!1;if(!this.animateWhilePaused&&ue.equals(e.time,this._previousTime))return!1;this._previousTime=ue.clone(e.time,this._previousTime);let i=!1;const r=e.time,s=this._model;for(let o=0;o<n;++o){const a=t[o];l(a._computedStartTime)||(a._computedStartTime=ue.addSeconds(T(a.startTime,r),a.delay,new ue)),l(a._duration)||(a._duration=a.localStopTime*(1/a.multiplier));const c=a._computedStartTime,u=a._duration,h=a.stopTime,d=ue.lessThanOrEquals(c,r),p=l(h)&&ue.greaterThan(r,h);let g=0;if(u!==0){const x=ue.secondsDifference(p?h:r,c);g=l(a._animationTime)?a._animationTime(u,x):x/u}const _=a.loop===Df.REPEAT||a.loop===Df.MIRRORED_REPEAT,b=(d||_&&!l(a.startTime))&&(g<=1||_)&&!p;if(g===a._prevAnimationDelta){const x=a._state===_f.STOPPED;if(b!==x)continue}if(a._prevAnimationDelta=g,b||a._state===_f.ANIMATING){if(b&&a._state===_f.STOPPED&&(a._state=_f.ANIMATING,a.start.numberOfListeners>0&&e.afterRender.push(a._raiseStartEvent)),a.loop===Df.REPEAT)g=g-Math.floor(g);else if(a.loop===Df.MIRRORED_REPEAT){const E=Math.floor(g),C=g-E;g=E%2===1?1-C:C}a.reverse&&(g=1-g);let x=g*u*a.multiplier;x=R.clamp(x,a.localStartTime,a.localStopTime),a.animate(x),a.update.numberOfListeners>0&&(a._updateEventTime=x,e.afterRender.push(a._raiseUpdateEvent)),i=!0,b||(a._state=_f.STOPPED,a.stop.numberOfListeners>0&&e.afterRender.push(a._raiseStopEvent),a.removeOnStop&&xg.push(a))}}n=xg.length;for(let o=0;o<n;++o){const a=xg[o];t.splice(t.indexOf(a),1),e.afterRender.push(Rle(this,s,a))}return xg.length=0,i};function ku(e){this._model=e.model,this._featureTable=e.featureTable,this._featureId=e.featureId,this._color=void 0}Object.defineProperties(ku.prototype,{show:{get:function(){return this._featureTable.getShow(this._featureId)},set:function(e){this._featureTable.setShow(this._featureId,e)}},color:{get:function(){return l(this._color)||(this._color=new M),this._featureTable.getColor(this._featureId,this._color)},set:function(e){this._featureTable.setColor(this._featureId,e)}},primitive:{get:function(){return this._model}},featureTable:{get:function(){return this._featureTable}},featureId:{get:function(){return this._featureId}}});ku.prototype.hasProperty=function(e){return this._featureTable.hasProperty(this._featureId,e)};ku.prototype.getProperty=function(e){return this._featureTable.getProperty(this._featureId,e)};ku.prototype.getPropertyInherited=function(e){return this._featureTable.hasPropertyBySemantic(this._featureId,e)?this._featureTable.getPropertyBySemantic(this._featureId,e):this._featureTable.getProperty(this._featureId,e)};ku.prototype.getPropertyIds=function(e){return this._featureTable.getPropertyIds(e)};ku.prototype.setProperty=function(e,t){return this._featureTable.setProperty(this._featureId,e,t)};const zd={ALL_OPAQUE:0,ALL_TRANSLUCENT:1,OPAQUE_AND_TRANSLUCENT:2};zd.getStyleCommandsNeeded=function(e,t){return t===0?zd.ALL_OPAQUE:t===e?zd.ALL_TRANSLUCENT:zd.OPAQUE_AND_TRANSLUCENT};const Lp=Object.freeze(zd),jc={GLTF:"GLTF",TILE_GLTF:"TILE_GLTF",TILE_B3DM:"B3DM",TILE_I3DM:"I3DM",TILE_PNTS:"PNTS",TILE_GEOJSON:"TILE_GEOJSON"};jc.is3DTiles=function(e){switch(y.typeOf.string("modelType",e),e){case jc.TILE_GLTF:case jc.TILE_B3DM:case jc.TILE_I3DM:case jc.TILE_PNTS:case jc.TILE_GEOJSON:return!0;case jc.GLTF:return!1;default:throw new A("modelType is not a valid value.")}};const Or=Object.freeze(jc);function ti(e){const t=e.model,n=e.propertyTable;y.typeOf.object("propertyTable",n),y.typeOf.object("model",t),this._propertyTable=n,this._model=t,this._features=void 0,this._featuresLength=0,this._batchTexture=void 0,this._styleCommandsNeededDirty=!1,this._styleCommandsNeeded=Lp.ALL_OPAQUE,Dle(this)}Object.defineProperties(ti.prototype,{batchTexture:{get:function(){return this._batchTexture}},featuresLength:{get:function(){return this._featuresLength}},batchTextureByteLength:{get:function(){return l(this._batchTexture)?this._batchTexture.byteLength:0}},styleCommandsNeededDirty:{get:function(){return this._styleCommandsNeededDirty}}});function Dle(e){const t=e._model,n=Or.is3DTiles(t.type),i=e._propertyTable.count;if(i===0)return;let r;const s=new Array(i);if(n){const o=t.content;for(r=0;r<i;r++)s[r]=new vr(o,r)}else for(r=0;r<i;r++)s[r]=new ku({model:t,featureId:r,featureTable:e});e._features=s,e._featuresLength=i,e._batchTexture=new zn({featuresLength:i,owner:e,statistics:n?t.content.tileset.statistics:void 0})}ti.prototype.update=function(e){this._styleCommandsNeededDirty=!1,this._batchTexture.update(void 0,e);const t=Lp.getStyleCommandsNeeded(this._featuresLength,this._batchTexture.translucentFeaturesLength);this._styleCommandsNeeded!==t&&(this._styleCommandsNeededDirty=!0,this._styleCommandsNeeded=t)};ti.prototype.setShow=function(e,t){this._batchTexture.setShow(e,t)};ti.prototype.setAllShow=function(e){this._batchTexture.setAllShow(e)};ti.prototype.getShow=function(e){return this._batchTexture.getShow(e)};ti.prototype.setColor=function(e,t){this._batchTexture.setColor(e,t)};ti.prototype.setAllColor=function(e){this._batchTexture.setAllColor(e)};ti.prototype.getColor=function(e,t){return this._batchTexture.getColor(e,t)};ti.prototype.getPickColor=function(e){return this._batchTexture.getPickColor(e)};ti.prototype.getFeature=function(e){return this._features[e]};ti.prototype.hasProperty=function(e,t){return this._propertyTable.hasProperty(e,t)};ti.prototype.hasPropertyBySemantic=function(e,t){return this._propertyTable.hasPropertyBySemantic(e,t)};ti.prototype.getProperty=function(e,t){return this._propertyTable.getProperty(e,t)};ti.prototype.getPropertyBySemantic=function(e,t){return this._propertyTable.getPropertyBySemantic(e,t)};ti.prototype.getPropertyIds=function(e){return this._propertyTable.getPropertyIds(e)};ti.prototype.setProperty=function(e,t,n){return this._propertyTable.setProperty(e,t,n)};ti.prototype.isClass=function(e,t){return this._propertyTable.isClass(e,t)};ti.prototype.isExactClass=function(e,t){return this._propertyTable.isExactClass(e,t)};ti.prototype.getExactClassName=function(e){return this._propertyTable.getExactClassName(e)};const Mle=new M;ti.prototype.applyStyle=function(e){if(!l(e)){this.setAllColor(zn.DEFAULT_COLOR_VALUE),this.setAllShow(zn.DEFAULT_SHOW_VALUE);return}for(let t=0;t<this._featuresLength;t++){const n=this.getFeature(t),i=l(e.color)?T(e.color.evaluateColor(n,Mle),zn.DEFAULT_COLOR_VALUE):zn.DEFAULT_COLOR_VALUE,r=l(e.show)?T(e.show.evaluate(n),zn.DEFAULT_SHOW_VALUE):zn.DEFAULT_SHOW_VALUE;this.setColor(t,i),this.setShow(t,r)}};ti.prototype.isDestroyed=function(){return!1};ti.prototype.destroy=function(e){this._batchTexture=this._batchTexture&&this._batchTexture.destroy(),Ye(this)};const Lle=`
precision highp float;
czm_modelMaterial defaultModelMaterial()
{
    czm_modelMaterial material;
    material.diffuse = vec3(0.0);
    material.specular = vec3(1.0);
    material.roughness = 1.0;
    material.occlusion = 1.0;
    material.normalEC = vec3(0.0, 0.0, 1.0);
    material.emissive = vec3(0.0);
    material.alpha = 1.0;
    return material;
}

vec4 handleAlpha(vec3 color, float alpha)
{
    #ifdef ALPHA_MODE_MASK
    if (alpha < u_alphaCutoff) {
        discard;
    }
    #endif

    return vec4(color, alpha);
}

SelectedFeature selectedFeature;

void main()
{
    #ifdef HAS_MODEL_SPLITTER
    modelSplitterStage();
    #endif

    czm_modelMaterial material = defaultModelMaterial();

    ProcessedAttributes attributes;
    geometryStage(attributes);

    FeatureIds featureIds;
    featureIdStage(featureIds, attributes);

    Metadata metadata;
    MetadataClass metadataClass;
    MetadataStatistics metadataStatistics;
    metadataStage(metadata, metadataClass, metadataStatistics, attributes);

    #ifdef HAS_SELECTED_FEATURE_ID
    selectedFeatureIdStage(selectedFeature, featureIds);
    #endif

    #ifndef CUSTOM_SHADER_REPLACE_MATERIAL
    materialStage(material, attributes, selectedFeature);
    #endif

    #ifdef HAS_CUSTOM_FRAGMENT_SHADER
    customShaderStage(material, attributes, featureIds, metadata, metadataClass, metadataStatistics);
    #endif

    lightingStage(material, attributes);

    #ifdef HAS_SELECTED_FEATURE_ID
    cpuStylingStage(material, selectedFeature);
    #endif

    #ifdef HAS_MODEL_COLOR
    modelColorStage(material);
    #endif

    #ifdef HAS_PRIMITIVE_OUTLINE
    primitiveOutlineStage(material);
    #endif

    vec4 color = handleAlpha(material.diffuse, material.alpha);

    #ifdef HAS_CLIPPING_PLANES
    modelClippingPlanesStage(color);
    #endif

    #ifdef ENABLE_CLIPPING_POLYGONS
    modelClippingPolygonsStage();
    #endif

    #if defined(HAS_SILHOUETTE) && defined(HAS_NORMALS)
    silhouetteStage(color);
    #endif

    #ifdef HAS_ATMOSPHERE
    atmosphereStage(color, attributes);
    #endif

    out_FragColor = color;
}
`,Ple=`precision highp float;

czm_modelVertexOutput defaultVertexOutput(vec3 positionMC) {
    czm_modelVertexOutput vsOutput;
    vsOutput.positionMC = positionMC;
    vsOutput.pointSize = 1.0;
    return vsOutput;
}

void main()
{
    // Initialize the attributes struct with all
    // attributes except quantized ones.
    ProcessedAttributes attributes;
    initializeAttributes(attributes);

    // Dequantize the quantized ones and add them to the
    // attributes struct.
    #ifdef USE_DEQUANTIZATION
    dequantizationStage(attributes);
    #endif

    #ifdef HAS_MORPH_TARGETS
    morphTargetsStage(attributes);
    #endif

    #ifdef HAS_SKINNING
    skinningStage(attributes);
    #endif

    #ifdef HAS_PRIMITIVE_OUTLINE
    primitiveOutlineStage();
    #endif

    // Compute the bitangent according to the formula in the glTF spec.
    // Normal and tangents can be affected by morphing and skinning, so
    // the bitangent should not be computed until their values are finalized.
    #ifdef HAS_BITANGENTS
    attributes.bitangentMC = normalize(cross(attributes.normalMC, attributes.tangentMC) * attributes.tangentSignMC);
    #endif

    FeatureIds featureIds;
    featureIdStage(featureIds, attributes);

    #ifdef HAS_SELECTED_FEATURE_ID
    SelectedFeature feature;
    selectedFeatureIdStage(feature, featureIds);
    // Handle any show properties that come from the style.
    cpuStylingStage(attributes.positionMC, feature);
    #endif

    #if defined(USE_2D_POSITIONS) || defined(USE_2D_INSTANCING)
    // The scene mode 2D pipeline stage and instancing stage add a different
    // model view matrix to accurately project the model to 2D. However, the
    // output positions and normals should be transformed by the 3D matrices
    // to keep the data the same for the fragment shader.
    mat4 modelView = czm_modelView3D;
    mat3 normal = czm_normal3D;
    #else
    // These are used for individual model projection because they will
    // automatically change based on the scene mode.
    mat4 modelView = czm_modelView;
    mat3 normal = czm_normal;
    #endif

    // Update the position for this instance in place
    #ifdef HAS_INSTANCING

        // The legacy instance stage is used when rendering i3dm models that
        // encode instances transforms in world space, as opposed to glTF models
        // that use EXT_mesh_gpu_instancing, where instance transforms are encoded
        // in object space.
        #ifdef USE_LEGACY_INSTANCING
        mat4 instanceModelView;
        mat3 instanceModelViewInverseTranspose;

        legacyInstancingStage(attributes, instanceModelView, instanceModelViewInverseTranspose);

        modelView = instanceModelView;
        normal = instanceModelViewInverseTranspose;
        #else
        instancingStage(attributes);
        #endif

        #ifdef USE_PICKING
        v_pickColor = a_pickColor;
        #endif

    #endif

    Metadata metadata;
    MetadataClass metadataClass;
    MetadataStatistics metadataStatistics;
    metadataStage(metadata, metadataClass, metadataStatistics, attributes);

    #ifdef HAS_VERTICAL_EXAGGERATION
    verticalExaggerationStage(attributes);
    #endif

    #ifdef HAS_CUSTOM_VERTEX_SHADER
    czm_modelVertexOutput vsOutput = defaultVertexOutput(attributes.positionMC);
    customShaderStage(vsOutput, attributes, featureIds, metadata, metadataClass, metadataStatistics);
    #endif

    // Compute the final position in each coordinate system needed.
    // This returns the value that will be assigned to gl_Position.
    vec4 positionClip = geometryStage(attributes, modelView, normal);

    // This must go after the geometry stage as it needs v_positionWC
    #ifdef HAS_ATMOSPHERE
    atmosphereStage(attributes);
    #endif

    #ifdef ENABLE_CLIPPING_POLYGONS
    modelClippingPolygonsStage(attributes);
    #endif

    #ifdef HAS_SILHOUETTE
    silhouetteStage(attributes, positionClip);
    #endif

    #ifdef HAS_POINT_CLOUD_SHOW_STYLE
    float show = pointCloudShowStylingStage(attributes, metadata);
    #else
    float show = 1.0;
    #endif

    #ifdef HAS_POINT_CLOUD_BACK_FACE_CULLING
    show *= pointCloudBackFaceCullingStage();
    #endif

    #ifdef HAS_POINT_CLOUD_COLOR_STYLE
    v_pointCloudColor = pointCloudColorStylingStage(attributes, metadata);
    #endif

    #ifdef PRIMITIVE_TYPE_POINTS
        #ifdef HAS_CUSTOM_VERTEX_SHADER
        gl_PointSize = vsOutput.pointSize;
        #elif defined(HAS_POINT_CLOUD_POINT_SIZE_STYLE) || defined(HAS_POINT_CLOUD_ATTENUATION)
        gl_PointSize = pointCloudPointSizeStylingStage(attributes, metadata);
        #else
        gl_PointSize = 1.0;
        #endif

        gl_PointSize *= show;
    #endif

    gl_Position = show * positionClip;
}
`;function Nw(e){e=T(e,T.EMPTY_OBJECT);const t=e.command,n=e.primitiveRenderResources;y.typeOf.object("options.command",t),y.typeOf.object("options.primitiveRenderResources",n);const i=n.model;this._command=t,this._model=i,this._runtimePrimitive=n.runtimePrimitive,this._modelMatrix=t.modelMatrix,this._boundingVolume=t.boundingVolume,this._cullFace=t.renderState.cull.face;const r=i.classificationType;this._classificationType=r,this._classifiesTerrain=r!==Ks.CESIUM_3D_TILE,this._classifies3DTiles=r!==Ks.TERRAIN,this._useDebugWireframe=i._enableDebugWireframe&&i.debugWireframe,this._pickId=n.pickId,this._commandListTerrain=[],this._commandList3DTiles=[],this._commandListIgnoreShow=[],this._commandListDebugWireframe=[],this._commandListTerrainPicking=[],this._commandList3DTilesPicking=[],zle(this)}function Nle(e){return{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},stencilTest:{enabled:!0,frontFunction:e,frontOperation:{fail:Qe.KEEP,zFail:Qe.DECREMENT_WRAP,zPass:Qe.KEEP},backFunction:e,backOperation:{fail:Qe.KEEP,zFail:Qe.INCREMENT_WRAP,zPass:Qe.KEEP},reference:yt.CESIUM_3D_TILE_MASK,mask:yt.CESIUM_3D_TILE_MASK},stencilMask:yt.CLASSIFICATION_MASK,depthTest:{enabled:!0,func:Xy.LESS_OR_EQUAL},depthMask:!1}}const Fle={stencilTest:{enabled:!0,frontFunction:Ei.NOT_EQUAL,frontOperation:{fail:Qe.ZERO,zFail:Qe.ZERO,zPass:Qe.ZERO},backFunction:Ei.NOT_EQUAL,backOperation:{fail:Qe.ZERO,zFail:Qe.ZERO,zPass:Qe.ZERO},reference:0,mask:yt.CLASSIFICATION_MASK},stencilMask:yt.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1,blending:vs.PRE_MULTIPLIED_ALPHA_BLEND},Ble={stencilTest:{enabled:!0,frontFunction:Ei.NOT_EQUAL,frontOperation:{fail:Qe.ZERO,zFail:Qe.ZERO,zPass:Qe.ZERO},backFunction:Ei.NOT_EQUAL,backOperation:{fail:Qe.ZERO,zFail:Qe.ZERO,zPass:Qe.ZERO},reference:0,mask:yt.CLASSIFICATION_MASK},stencilMask:yt.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1},d2=[];function zle(e){const t=e._command,n=d2;if(e._useDebugWireframe){t.pass=Ke.OPAQUE,n.length=0,n.push(t),e._commandListDebugWireframe=Qd(e,n,e._commandListDebugWireframe);const s=e._commandListDebugWireframe,o=s.length;for(let a=0;a<o;a++){const c=s[a];c.count*=2,c.offset*=2}return}const r=e.model.allowPicking;if(e._classifiesTerrain){const s=Ke.TERRAIN_CLASSIFICATION,o=lE(t,s),a=H1(t,s);n.length=0,n.push(o,a),e._commandListTerrain=Qd(e,n,e._commandListTerrain),r&&(e._commandListTerrainPicking=q1(e,n,e._commandListTerrainPicking))}if(e._classifies3DTiles){const s=Ke.CESIUM_3D_TILE_CLASSIFICATION,o=lE(t,s),a=H1(t,s);n.length=0,n.push(o,a),e._commandList3DTiles=Qd(e,n,e._commandList3DTiles),r&&(e._commandList3DTilesPicking=q1(e,n,e._commandList3DTilesPicking))}}function Qd(e,t,n){const i=e._runtimePrimitive,r=i.batchLengths,s=i.batchOffsets,o=r.length,a=t.length;for(let c=0;c<o;c++){const u=r[c],h=s[c];for(let d=0;d<a;d++){const p=t[d],g=Tt.shallowClone(p);g.count=u,g.offset=h,n.push(g)}}return n}function lE(e,t){const n=Tt.shallowClone(e);n.cull=!1,n.pass=t;const i=t===Ke.TERRAIN_CLASSIFICATION?Ei.ALWAYS:Ei.EQUAL,r=Nle(i);return n.renderState=it.fromCache(r),n}function H1(e,t){const n=Tt.shallowClone(e);return n.cull=!1,n.pass=t,n.renderState=it.fromCache(Fle),n}const Ule=[];function q1(e,t,n){const i=it.fromCache(Ble),r=t[0],s=t[1],o=Tt.shallowClone(r);o.cull=!0,o.pickOnly=!0;const a=Tt.shallowClone(s);a.cull=!0,a.pickOnly=!0,a.renderState=i,a.pickId=e._pickId;const c=Ule;return c.length=0,c.push(o,a),Qd(e,c,n)}Object.defineProperties(Nw.prototype,{command:{get:function(){return this._command}},runtimePrimitive:{get:function(){return this._runtimePrimitive}},batchLengths:{get:function(){return this._runtimePrimitive.batchLengths}},batchOffsets:{get:function(){return this._runtimePrimitive.batchOffsets}},model:{get:function(){return this._model}},classificationType:{get:function(){return this._classificationType}},modelMatrix:{get:function(){return this._modelMatrix},set:function(e){this._modelMatrix=P.clone(e,this._modelMatrix);const t=this._runtimePrimitive.boundingSphere;this._boundingVolume=ee.transform(t,this._modelMatrix,this._boundingVolume)}},boundingVolume:{get:function(){return this._boundingVolume}},cullFace:{get:function(){return this._cullFace},set:function(e){this._cullFace=e}}});Nw.prototype.pushCommands=function(e,t){const n=e.passes;if(n.render){if(this._useDebugWireframe){t.push.apply(t,this._commandListDebugWireframe);return}if(this._classifiesTerrain&&t.push.apply(t,this._commandListTerrain),this._classifies3DTiles&&t.push.apply(t,this._commandList3DTiles),e.invertClassification&&this._classifies3DTiles){if(this._commandListIgnoreShow.length===0){const r=Ke.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW,s=lE(this._command,r),o=d2;o.length=0,o.push(s),this._commandListIgnoreShow=Qd(this,o,this._commandListIgnoreShow)}t.push.apply(t,this._commandListIgnoreShow)}}return n.pick&&(this._classifiesTerrain&&t.push.apply(t,this._commandListTerrainPicking),this._classifies3DTiles&&t.push.apply(t,this._commandList3DTilesPicking)),t};function nb(e){e=T(e,T.EMPTY_OBJECT);const t=e.command,n=e.primitiveRenderResources;y.typeOf.object("options.command",t),y.typeOf.object("options.primitiveRenderResources",n);const i=n.model;this._model=i;const r=n.runtimePrimitive;this._runtimePrimitive=r;const s=t.pass===Ke.TRANSLUCENT,a=!r.primitive.material.doubleSided&&!s,c=n.hasSilhouette,u=!s&&!c,h=n.hasSkipLevelOfDetail&&!s,d=c;this._command=t,this._modelMatrix=P.clone(t.modelMatrix),this._boundingVolume=ee.clone(t.boundingVolume),this._modelMatrix2D=new P,this._boundingVolume2D=new ee,this._modelMatrix2DDirty=!1,this._backFaceCulling=t.renderState.cull.enabled,this._cullFace=t.renderState.cull.face,this._shadows=i.shadows,this._debugShowBoundingVolume=t.debugShowBoundingVolume,this._usesBackFaceCulling=a,this._needsTranslucentCommand=u,this._needsSkipLevelOfDetailCommands=h,this._needsSilhouetteCommands=d,this._originalCommand=void 0,this._translucentCommand=void 0,this._skipLodBackfaceCommand=void 0,this._skipLodStencilCommand=void 0,this._silhouetteModelCommand=void 0,this._silhouetteColorCommand=void 0,this._derivedCommands=[],this._has2DCommands=!1,kle(this)}function Va(e){this.command=e.command,this.updateShadows=e.updateShadows,this.updateBackFaceCulling=e.updateBackFaceCulling,this.updateCullFace=e.updateCullFace,this.updateDebugShowBoundingVolume=e.updateDebugShowBoundingVolume,this.is2D=T(e.is2D,!1),this.derivedCommand2D=void 0}Va.clone=function(e){return new Va({command:e.command,updateShadows:e.updateShadows,updateBackFaceCulling:e.updateBackFaceCulling,updateCullFace:e.updateCullFace,updateDebugShowBoundingVolume:e.updateDebugShowBoundingVolume,is2D:e.is2D,derivedCommand2D:e.derivedCommand2D})};function kle(e){const t=e._command;t.modelMatrix=e._modelMatrix,t.boundingVolume=e._boundingVolume;const n=e._model,i=e._usesBackFaceCulling,r=e._derivedCommands;e._originalCommand=new Va({command:t,updateShadows:!0,updateBackFaceCulling:i,updateCullFace:i,updateDebugShowBoundingVolume:!0,is2D:!1}),r.push(e._originalCommand),e._needsTranslucentCommand&&(e._translucentCommand=new Va({command:$le(t),updateShadows:!0,updateBackFaceCulling:!1,updateCullFace:!1,updateDebugShowBoundingVolume:!0}),r.push(e._translucentCommand)),e._needsSkipLevelOfDetailCommands&&(e._skipLodBackfaceCommand=new Va({command:Qle(t),updateShadows:!1,updateBackFaceCulling:!1,updateCullFace:i,updateDebugShowBoundingVolume:!1}),e._skipLodStencilCommand=new Va({command:eue(t),updateShadows:!0,updateBackFaceCulling:i,updateCullFace:i,updateDebugShowBoundingVolume:!0}),r.push(e._skipLodBackfaceCommand),r.push(e._skipLodStencilCommand)),e._needsSilhouetteCommands&&(e._silhouetteModelCommand=new Va({command:Xle(t,n),updateShadows:!0,updateBackFaceCulling:i,updateCullFace:i,updateDebugShowBoundingVolume:!0}),e._silhouetteColorCommand=new Va({command:Yle(t,n),updateShadows:!1,updateBackFaceCulling:!1,updateCullFace:!1,updateDebugShowBoundingVolume:!1}),r.push(e._silhouetteModelCommand),r.push(e._silhouetteColorCommand))}Object.defineProperties(nb.prototype,{command:{get:function(){return this._command}},runtimePrimitive:{get:function(){return this._runtimePrimitive}},model:{get:function(){return this._model}},primitiveType:{get:function(){return this._command.primitiveType}},modelMatrix:{get:function(){return this._modelMatrix},set:function(e){this._modelMatrix=P.clone(e,this._modelMatrix),this._modelMatrix2DDirty=!0,this._boundingVolume=ee.transform(this.runtimePrimitive.boundingSphere,this._modelMatrix,this._boundingVolume)}},boundingVolume:{get:function(){return this._boundingVolume}},shadows:{get:function(){return this._shadows},set:function(e){this._shadows=e,Vle(this)}},backFaceCulling:{get:function(){return this._backFaceCulling},set:function(e){this._backFaceCulling!==e&&(this._backFaceCulling=e,Gle(this))}},cullFace:{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,Hle(this))}},debugShowBoundingVolume:{get:function(){return this._debugShowBoundingVolume},set:function(e){this._debugShowBoundingVolume!==e&&(this._debugShowBoundingVolume=e,qle(this))}}});function jle(e,t){const n=e._modelMatrix;e._modelMatrix2D=P.clone(n,e._modelMatrix2D),e._modelMatrix2D[13]-=R.sign(n[13])*2*R.PI*t.mapProjection.ellipsoid.maximumRadius,e._boundingVolume2D=ee.transform(e.runtimePrimitive.boundingSphere,e._modelMatrix2D,e._boundingVolume2D)}function Vle(e){const t=e.shadows,n=rc.castShadows(t),i=rc.receiveShadows(t),r=e._derivedCommands;for(let s=0;s<r.length;++s){const o=r[s];if(o.updateShadows){const a=o.command;a.castShadows=n,a.receiveShadows=i}}}function Gle(e){const t=e.backFaceCulling,n=e._derivedCommands;for(let i=0;i<n.length;++i){const r=n[i];if(r.updateBackFaceCulling){const s=r.command,o=Se(s.renderState,!0);o.cull.enabled=t,s.renderState=it.fromCache(o)}}}function Hle(e){const t=e.cullFace,n=e._derivedCommands;for(let i=0;i<n.length;++i){const r=n[i];if(r.updateCullFace){const s=r.command,o=Se(s.renderState,!0);o.cull.face=t,s.renderState=it.fromCache(o)}}}function qle(e){const t=e.debugShowBoundingVolume,n=e._derivedCommands;for(let i=0;i<n.length;++i){const r=n[i];if(r.updateDebugShowBoundingVolume){const s=r.command;s.debugShowBoundingVolume=t}}}nb.prototype.pushCommands=function(e,t){const n=p2(this,e);n&&!this._has2DCommands&&(Wle(this),this._has2DCommands=!0,this._modelMatrix2DDirty=!0),this._modelMatrix2DDirty&&(jle(this,e),this._modelMatrix2DDirty=!1);const i=this.model.styleCommandsNeeded;if(!(this._needsTranslucentCommand&&l(i)&&(i!==Lp.ALL_OPAQUE&&yf(t,this._translucentCommand,n),i===Lp.ALL_TRANSLUCENT))){if(this._needsSkipLevelOfDetailCommands){const{tileset:r,tile:s}=this._model.content;if(r.hasMixedContent){s._finalResolution||yf(r._backfaceCommands,this._skipLodBackfaceCommand,n),Kle(this,s,n),yf(t,this._skipLodStencilCommand,n);return}}if(this._needsSilhouetteCommands){yf(t,this._silhouetteModelCommand,n);return}return yf(t,this._originalCommand,n),t}};nb.prototype.pushSilhouetteCommands=function(e,t){const n=p2(this,e);return yf(t,this._silhouetteColorCommand,n),t};function yf(e,t,n){e.push(t.command),n&&e.push(t.derivedCommand2D.command)}function p2(e,t){if(t.mode!==Ie.SCENE2D||e.model._projectTo2D)return!1;const i=e.model.sceneGraph._boundingSphere2D,r=i.center.y-i.radius,s=i.center.y+i.radius,o=t.mapProjection.ellipsoid.maximumRadius*R.PI;return r<o&&s>o||r<-o&&s>-o}function af(e,t){if(!l(t))return;const n=Va.clone(t),i=Tt.shallowClone(t.command);return i.modelMatrix=e._modelMatrix2D,i.boundingVolume=e._boundingVolume2D,n.command=i,n.updateShadows=!1,n.is2D=!0,t.derivedCommand2D=n,e._derivedCommands.push(n),n}function Wle(e){af(e,e._originalCommand),af(e,e._translucentCommand),af(e,e._skipLodBackfaceCommand),af(e,e._skipLodStencilCommand),af(e,e._silhouetteModelCommand),af(e,e._silhouetteColorCommand)}function $le(e){const t=Tt.shallowClone(e);t.pass=Ke.TRANSLUCENT;const n=Se(e.renderState,!0);return n.cull.enabled=!1,n.depthMask=!1,n.blending=vs.ALPHA_BLEND,t.renderState=it.fromCache(n),t}function Xle(e,t){const n=t._silhouetteId%255,i=Tt.shallowClone(e),r=Se(e.renderState,!0);return r.stencilTest={enabled:!0,frontFunction:j.ALWAYS,backFunction:j.ALWAYS,reference:n,mask:-1,frontOperation:{fail:j.KEEP,zFail:j.KEEP,zPass:j.REPLACE},backOperation:{fail:j.KEEP,zFail:j.KEEP,zPass:j.REPLACE}},t.isInvisible()&&(r.colorMask={red:!1,green:!1,blue:!1,alpha:!1}),i.renderState=it.fromCache(r),i}function Yle(e,t){const n=t._silhouetteId%255,i=Tt.shallowClone(e),r=Se(e.renderState,!0);r.cull.enabled=!1,(e.pass===Ke.TRANSLUCENT||t.silhouetteColor.alpha<1)&&(i.pass=Ke.TRANSLUCENT,r.depthMask=!1,r.blending=vs.ALPHA_BLEND),r.stencilTest={enabled:!0,frontFunction:j.NOTEQUAL,backFunction:j.NOTEQUAL,reference:n,mask:-1,frontOperation:{fail:j.KEEP,zFail:j.KEEP,zPass:j.KEEP},backOperation:{fail:j.KEEP,zFail:j.KEEP,zPass:j.KEEP}};const o=Se(e.uniformMap);return o.model_silhouettePass=function(){return!0},i.renderState=it.fromCache(r),i.uniformMap=o,i.castShadows=!1,i.receiveShadows=!1,i}function Kle(e,t,n){const i=e._skipLodStencilCommand,r=i.command,s=t._selectionDepth,o=Zle(r);if(s!==o){const a=Jle(s),c=Se(r.renderState,!0);c.stencilTest.reference=a,r.renderState=it.fromCache(c),n&&(i.derivedCommand2D.renderState=c)}}function Zle(e){return(e.renderState.stencilTest.reference&yt.SKIP_LOD_MASK)>>>yt.SKIP_LOD_BIT_SHIFT}function Jle(e){return yt.CESIUM_3D_TILE_MASK|e<<yt.SKIP_LOD_BIT_SHIFT}function Qle(e){const t=Tt.shallowClone(e),n=Se(e.renderState,!0);n.cull.enabled=!0,n.cull.face=wo.FRONT,n.colorMask={red:!1,green:!1,blue:!1,alpha:!1},n.polygonOffset={enabled:!0,factor:5,units:5};const i=Se(t.uniformMap),r=new k(5,5);return i.u_polygonOffset=function(){return r},t.renderState=it.fromCache(n),t.uniformMap=i,t.castShadows=!1,t.receiveShadows=!1,t}function eue(e){const t=Tt.shallowClone(e),n=Se(e.renderState,!0),{stencilTest:i}=n;return i.enabled=!0,i.mask=yt.SKIP_LOD_MASK,i.reference=yt.CESIUM_3D_TILE_MASK,i.frontFunction=Ei.GREATER_OR_EQUAL,i.frontOperation.zPass=Qe.REPLACE,i.backFunction=Ei.GREATER_OR_EQUAL,i.backOperation.zPass=Qe.REPLACE,n.stencilMask=yt.CESIUM_3D_TILE_MASK|yt.SKIP_LOD_MASK,t.renderState=it.fromCache(n),t}function tue(e,t){const n=e.shaderBuilder;n.addVertexLines(Ple),n.addFragmentLines(Lle);const i=nue(e),r=new $i({context:t.context,indexBuffer:i,attributes:e.attributes}),s=e.model;s._pipelineResources.push(r);const o=n.buildShaderProgram(t.context);s._pipelineResources.push(o);const a=e.alphaOptions.pass,c=s.sceneGraph,u=t.mode===Ie.SCENE3D;let h,d;if(!u&&!t.scene3DOnly&&s._projectTo2D)h=P.multiplyTransformation(c._computedModelMatrix,e.runtimeNode.computedTransform,new P),d=e.runtimePrimitive.boundingSphere2D;else{const C=u?c._computedModelMatrix:c._computedModelMatrix2D;h=P.multiplyTransformation(C,e.runtimeNode.computedTransform,new P),d=ee.transform(e.boundingSphere,h,e.boundingSphere)}let p=Se(it.fromCache(e.renderStateOptions),!0);p.cull.face=je.getCullFace(h,e.primitiveType),p=it.fromCache(p);const g=l(s.classificationType),_=g?!1:rc.castShadows(s.shadows),b=g?!1:rc.receiveShadows(s.shadows),x=g?void 0:e.pickId,E=new Tt({boundingVolume:d,modelMatrix:h,uniformMap:e.uniformMap,renderState:p,vertexArray:r,shaderProgram:o,cull:s.cull,pass:a,count:e.count,owner:s,pickId:x,instanceCount:e.instanceCount,primitiveType:e.primitiveType,debugShowBoundingVolume:s.debugShowBoundingVolume,castShadows:_,receiveShadows:b});return g?new Nw({primitiveRenderResources:e,command:E}):new nb({primitiveRenderResources:e,command:E})}function nue(e){const t=e.wireframeIndexBuffer;if(l(t))return t;const n=e.indices;if(l(n)){if(!l(n.buffer))throw new A("Indices must be provided as a Buffer");return n.buffer}}const m2={name:"TilesetPipelineStage"};m2.process=function(e,t,n){if(t.hasSkipLevelOfDetail(n)){e.shaderBuilder.addDefine("POLYGON_OFFSET",void 0,Q.FRAGMENT);const s={u_polygonOffset:function(){return k.ZERO}};e.uniformMap=wt(s,e.uniformMap),e.hasSkipLevelOfDetail=!0}const i=e.renderStateOptions;i.stencilTest=yt.setCesium3DTileBit(),i.stencilMask=yt.CESIUM_3D_TILE_MASK};const iue=`// robust iterative solution without trig functions
// https://github.com/0xfaded/ellipse_demo/issues/1
// https://stackoverflow.com/questions/22959698/distance-from-given-point-to-given-ellipse
//
// This version uses only a single iteration for best performance. For fog
// rendering, the difference is negligible.
vec2 nearestPointOnEllipseFast(vec2 pos, vec2 radii) {
    vec2 p = abs(pos);
    vec2 inverseRadii = 1.0 / radii;
    vec2 evoluteScale = (radii.x * radii.x - radii.y * radii.y) * vec2(1.0, -1.0) * inverseRadii;

    // We describe the ellipse parametrically: v = radii * vec2(cos(t), sin(t))
    // but store the cos and sin of t in a vec2 for efficiency.
    // Initial guess: t = cos(pi/4)
    vec2 tTrigs = vec2(0.70710678118);
    vec2 v = radii * tTrigs;

    // Find the evolute of the ellipse (center of curvature) at v.
    vec2 evolute = evoluteScale * tTrigs * tTrigs * tTrigs;
    // Find the (approximate) intersection of p - evolute with the ellipsoid.
    vec2 q = normalize(p - evolute) * length(v - evolute);
    // Update the estimate of t.
    tTrigs = (q + evolute) * inverseRadii;
    tTrigs = normalize(clamp(tTrigs, 0.0, 1.0));
    v = radii * tTrigs;

    return v * sign(pos);
}

vec3 computeEllipsoidPositionWC(vec3 positionMC) {
    // Get the world-space position and project onto a meridian plane of
    // the ellipsoid
    vec3 positionWC = (czm_model * vec4(positionMC, 1.0)).xyz;

    vec2 positionEllipse = vec2(length(positionWC.xy), positionWC.z);
    vec2 nearestPoint = nearestPointOnEllipseFast(positionEllipse, czm_ellipsoidRadii.xz);

    // Reconstruct a 3D point in world space
    return vec3(nearestPoint.x * normalize(positionWC.xy), nearestPoint.y);
}

void applyFog(inout vec4 color, vec4 groundAtmosphereColor, vec3 lightDirection, float distanceToCamera) {

    vec3 fogColor = groundAtmosphereColor.rgb;

    // If there is dynamic lighting, apply that to the fog.
    const float NONE = 0.0;
    if (czm_atmosphereDynamicLighting != NONE) {
        float darken = clamp(dot(normalize(czm_viewerPositionWC), lightDirection), czm_fogMinimumBrightness, 1.0);
        fogColor *= darken;
    }

    // Tonemap if HDR rendering is disabled
    #ifndef HDR
        fogColor.rgb = czm_acesTonemapping(fogColor.rgb);
        fogColor.rgb = czm_inverseGamma(fogColor.rgb);
    #endif

    // Matches the constant in GlobeFS.glsl. This makes the fog falloff
    // more gradual.
    const float fogModifier = 0.15;
    vec3 withFog = czm_fog(distanceToCamera, color.rgb, fogColor, fogModifier);
    color = vec4(withFog, color.a);
}

void atmosphereStage(inout vec4 color, in ProcessedAttributes attributes) {
    vec3 rayleighColor;
    vec3 mieColor;
    float opacity;

    vec3 positionWC;
    vec3 lightDirection;

    // When the camera is in space, compute the position per-fragment for
    // more accurate ground atmosphere. All other cases will use
    //
    // The if condition will be added in https://github.com/CesiumGS/cesium/issues/11717
    if (false) {
        positionWC = computeEllipsoidPositionWC(attributes.positionMC);
        lightDirection = czm_getDynamicAtmosphereLightDirection(positionWC, czm_atmosphereDynamicLighting);

        // The fog color is derived from the ground atmosphere color
        czm_computeGroundAtmosphereScattering(
            positionWC,
            lightDirection,
            rayleighColor,
            mieColor,
            opacity
        );
    } else {
        positionWC = attributes.positionWC;
        lightDirection = czm_getDynamicAtmosphereLightDirection(positionWC, czm_atmosphereDynamicLighting);
        rayleighColor = v_atmosphereRayleighColor;
        mieColor = v_atmosphereMieColor;
        opacity = v_atmosphereOpacity;
    }

    //color correct rayleigh and mie colors
    const bool ignoreBlackPixels = true;
    rayleighColor = czm_applyHSBShift(rayleighColor, czm_atmosphereHsbShift, ignoreBlackPixels);
    mieColor = czm_applyHSBShift(mieColor, czm_atmosphereHsbShift, ignoreBlackPixels);

    vec4 groundAtmosphereColor = czm_computeAtmosphereColor(positionWC, lightDirection, rayleighColor, mieColor, opacity);

    if (u_isInFog) {
        float distanceToCamera = length(attributes.positionEC);
        applyFog(color, groundAtmosphereColor, lightDirection, distanceToCamera);
    } else {
        // Ground atmosphere
    }
}
`,rue=`void atmosphereStage(ProcessedAttributes attributes) {
    vec3 lightDirection = czm_getDynamicAtmosphereLightDirection(v_positionWC, czm_atmosphereDynamicLighting);

    czm_computeGroundAtmosphereScattering(
        // This assumes the geometry stage came before this.
        v_positionWC,
        lightDirection,
        v_atmosphereRayleighColor,
        v_atmosphereMieColor,
        v_atmosphereOpacity
    );
}
`,g2={name:"AtmospherePipelineStage"};g2.process=function(e,t,n){const i=e.shaderBuilder;i.addDefine("HAS_ATMOSPHERE",void 0,Q.BOTH),i.addDefine("COMPUTE_POSITION_WC_ATMOSPHERE",void 0,Q.BOTH),i.addVarying("vec3","v_atmosphereRayleighColor"),i.addVarying("vec3","v_atmosphereMieColor"),i.addVarying("float","v_atmosphereOpacity"),i.addVertexLines([rue]),i.addFragmentLines([iue]),i.addUniform("bool","u_isInFog",Q.FRAGMENT),e.uniformMap.u_isInFog=function(){const r=m.distance(n.camera.positionWC,t.boundingSphere.center);return R.fog(r,n.fog.density)>R.EPSILON3}};const sue=`/**
 * Compute some metrics for a procedural sky lighting model
 *
 * @param {vec3} positionWC The position of the fragment in world coordinates.
 * @param {vec3} reflectionWC A unit vector in the direction of the reflection, in world coordinates.
 * @return {vec3} The dot products of the horizon and reflection directions with the nadir, and an atmosphere boundary distance.
 */
vec3 getProceduralSkyMetrics(vec3 positionWC, vec3 reflectionWC)
{
    // Figure out if the reflection vector hits the ellipsoid
    float horizonDotNadir = 1.0 - min(1.0, czm_ellipsoidRadii.x / length(positionWC));
    float reflectionDotNadir = dot(reflectionWC, normalize(positionWC));
    float atmosphereHeight = 0.05;
    float smoothstepHeight = smoothstep(0.0, atmosphereHeight, horizonDotNadir);
    return vec3(horizonDotNadir, reflectionDotNadir, smoothstepHeight);
}

/**
 * Compute the diffuse irradiance for a procedural sky lighting model.
 *
 * @param {vec3} skyMetrics The dot products of the horizon and reflection directions with the nadir, and an atmosphere boundary distance.
 * @return {vec3} The computed diffuse irradiance.
 */
vec3 getProceduralDiffuseIrradiance(vec3 skyMetrics)
{
    vec3 blueSkyDiffuseColor = vec3(0.7, 0.85, 0.9); 
    float diffuseIrradianceFromEarth = (1.0 - skyMetrics.x) * (skyMetrics.y * 0.25 + 0.75) * skyMetrics.z;  
    float diffuseIrradianceFromSky = (1.0 - skyMetrics.z) * (1.0 - (skyMetrics.y * 0.25 + 0.25));
    return blueSkyDiffuseColor * clamp(diffuseIrradianceFromEarth + diffuseIrradianceFromSky, 0.0, 1.0);
}

/**
 * Compute the specular irradiance for a procedural sky lighting model.
 *
 * @param {vec3} reflectionWC The reflection vector in world coordinates.
 * @param {vec3} skyMetrics The dot products of the horizon and reflection directions with the nadir, and an atmosphere boundary distance.
 * @param {float} roughness The roughness of the material.
 * @return {vec3} The computed specular irradiance.
 */
vec3 getProceduralSpecularIrradiance(vec3 reflectionWC, vec3 skyMetrics, float roughness)
{
    // Flipping the X vector is a cheap way to get the inverse of czm_temeToPseudoFixed, since that's a rotation about Z.
    reflectionWC.x = -reflectionWC.x;
    reflectionWC = -normalize(czm_temeToPseudoFixed * reflectionWC);
    reflectionWC.x = -reflectionWC.x;

    float inverseRoughness = 1.0 - roughness;
    inverseRoughness *= inverseRoughness;
    vec3 sceneSkyBox = czm_textureCube(czm_environmentMap, reflectionWC).rgb * inverseRoughness;

    // Compute colors at different angles relative to the horizon
    vec3 belowHorizonColor = mix(vec3(0.1, 0.15, 0.25), vec3(0.4, 0.7, 0.9), skyMetrics.z);
    vec3 nadirColor = belowHorizonColor * 0.5;
    vec3 aboveHorizonColor = mix(vec3(0.9, 1.0, 1.2), belowHorizonColor, roughness * 0.5);
    vec3 blueSkyColor = mix(vec3(0.18, 0.26, 0.48), aboveHorizonColor, skyMetrics.y * inverseRoughness * 0.5 + 0.75);
    vec3 zenithColor = mix(blueSkyColor, sceneSkyBox, skyMetrics.z);

    // Compute blend zones
    float blendRegionSize = 0.1 * ((1.0 - inverseRoughness) * 8.0 + 1.1 - skyMetrics.x);
    float blendRegionOffset = roughness * -1.0;
    float farAboveHorizon = clamp(skyMetrics.x - blendRegionSize * 0.5 + blendRegionOffset, 1.0e-10 - blendRegionSize, 0.99999);
    float aroundHorizon = clamp(skyMetrics.x + blendRegionSize * 0.5, 1.0e-10 - blendRegionSize, 0.99999);
    float farBelowHorizon = clamp(skyMetrics.x + blendRegionSize * 1.5, 1.0e-10 - blendRegionSize, 0.99999);

    // Blend colors
    float notDistantRough = (1.0 - skyMetrics.x * roughness * 0.8);
    vec3 specularIrradiance = mix(zenithColor, aboveHorizonColor, smoothstep(farAboveHorizon, aroundHorizon, skyMetrics.y) * notDistantRough);
    specularIrradiance = mix(specularIrradiance, belowHorizonColor, smoothstep(aroundHorizon, farBelowHorizon, skyMetrics.y) * inverseRoughness);
    specularIrradiance = mix(specularIrradiance, nadirColor, smoothstep(farBelowHorizon, 1.0, skyMetrics.y) * inverseRoughness);

    return specularIrradiance;
}

#ifdef USE_SUN_LUMINANCE
float clampedDot(vec3 x, vec3 y)
{
    return clamp(dot(x, y), 0.001, 1.0);
}
/**
 * Sun luminance following the "CIE Clear Sky Model"
 * See page 40 of https://3dvar.com/Green2003Spherical.pdf
 *
 * @param {vec3} positionWC The position of the fragment in world coordinates.
 * @param {vec3} normalEC The surface normal in eye coordinates.
 * @param {vec3} lightDirectionEC Unit vector pointing to the light source in eye coordinates.
 * @return {float} The computed sun luminance.
 */
float getSunLuminance(vec3 positionWC, vec3 normalEC, vec3 lightDirectionEC)
{
    vec3 normalWC = normalize(czm_inverseViewRotation * normalEC);
    vec3 lightDirectionWC = normalize(czm_inverseViewRotation * lightDirectionEC);
    vec3 vWC = -normalize(positionWC);

    // Angle between sun and zenith.
    float LdotZenith = clampedDot(lightDirectionWC, vWC);
    float S = acos(LdotZenith);
    // Angle between zenith and current pixel
    float NdotZenith = clampedDot(normalWC, vWC);
    // Angle between sun and current pixel
    float NdotL = clampedDot(normalEC, lightDirectionEC);
    float gamma = acos(NdotL);

    float numerator = ((0.91 + 10.0 * exp(-3.0 * gamma) + 0.45 * NdotL * NdotL) * (1.0 - exp(-0.32 / NdotZenith)));
    float denominator = (0.91 + 10.0 * exp(-3.0 * S) + 0.45 * LdotZenith * LdotZenith) * (1.0 - exp(-0.32));
    return model_luminanceAtZenith * (numerator / denominator);
}
#endif

/**
 * Compute the light contribution from a procedural sky model
 *
 * @param {vec3} positionEC The position of the fragment in eye coordinates.
 * @param {vec3} normalEC The surface normal in eye coordinates.
 * @param {vec3} lightDirectionEC Unit vector pointing to the light source in eye coordinates.
 * @param {czm_modelMaterial} The material properties.
 * @return {vec3} The computed HDR color
 */
 vec3 proceduralIBL(
    vec3 positionEC,
    vec3 normalEC,
    vec3 lightDirectionEC,
    czm_modelMaterial material
) {
    vec3 viewDirectionEC = -normalize(positionEC);
    vec3 positionWC = vec3(czm_inverseView * vec4(positionEC, 1.0));
    vec3 reflectionWC = normalize(czm_inverseViewRotation * reflect(viewDirectionEC, normalEC));
    vec3 skyMetrics = getProceduralSkyMetrics(positionWC, reflectionWC);

    float roughness = material.roughness;
    vec3 f0 = material.specular;

    vec3 specularIrradiance = getProceduralSpecularIrradiance(reflectionWC, skyMetrics, roughness);
    float NdotV = abs(dot(normalEC, viewDirectionEC)) + 0.001;
    vec2 brdfLut = texture(czm_brdfLut, vec2(NdotV, roughness)).rg;
    vec3 specularColor = czm_srgbToLinear(f0 * brdfLut.x + brdfLut.y);
    vec3 specularContribution = specularIrradiance * specularColor * model_iblFactor.y;
    #ifdef USE_SPECULAR
        specularContribution *= material.specularWeight;
    #endif

    vec3 diffuseIrradiance = getProceduralDiffuseIrradiance(skyMetrics);
    vec3 diffuseColor = material.diffuse;
    vec3 diffuseContribution = diffuseIrradiance * diffuseColor * model_iblFactor.x;

    vec3 iblColor = specularContribution + diffuseContribution;

    #ifdef USE_SUN_LUMINANCE
        iblColor *= getSunLuminance(positionWC, normalEC, lightDirectionEC);
    #endif

    return iblColor;
}

#ifdef DIFFUSE_IBL
vec3 computeDiffuseIBL(vec3 cubeDir)
{
    #ifdef CUSTOM_SPHERICAL_HARMONICS
        return czm_sphericalHarmonics(cubeDir, model_sphericalHarmonicCoefficients); 
    #else
        return czm_sphericalHarmonics(cubeDir, czm_sphericalHarmonicCoefficients); 
    #endif
}
#endif

#ifdef SPECULAR_IBL
vec3 sampleSpecularEnvironment(vec3 cubeDir, float roughness)
{
    #ifdef CUSTOM_SPECULAR_IBL
        float maxLod = model_specularEnvironmentMapsMaximumLOD;
        float lod = roughness * maxLod;
        return czm_sampleOctahedralProjection(model_specularEnvironmentMaps, model_specularEnvironmentMapsSize, cubeDir, lod, maxLod);
    #else
        float maxLod = czm_specularEnvironmentMapsMaximumLOD;
        float lod = roughness * maxLod;
        return czm_sampleOctahedralProjection(czm_specularEnvironmentMaps, czm_specularEnvironmentMapSize, cubeDir, lod, maxLod);
    #endif
}
vec3 computeSpecularIBL(vec3 cubeDir, float NdotV, vec3 f0, float roughness)
{
    // see https://bruop.github.io/ibl/ at Single Scattering Results
    // Roughness dependent fresnel, from Fdez-Aguera
    vec3 f90 = max(vec3(1.0 - roughness), f0);
    vec3 F = fresnelSchlick2(f0, f90, NdotV);

    vec2 brdfLut = texture(czm_brdfLut, vec2(NdotV, roughness)).rg;
    vec3 specularSample = sampleSpecularEnvironment(cubeDir, roughness);

    return specularSample * (F * brdfLut.x + brdfLut.y);
}
#endif

#if defined(DIFFUSE_IBL) || defined(SPECULAR_IBL)
/**
 * Compute the light contributions from environment maps and spherical harmonic coefficients
 *
 * @param {vec3} viewDirectionEC Unit vector pointing from the fragment to the eye position
 * @param {vec3} normalEC The surface normal in eye coordinates
 * @param {vec3} lightDirectionEC Unit vector pointing to the light source in eye coordinates.
 * @param {czm_modelMaterial} The material properties.
 * @return {vec3} The computed HDR color
 */
vec3 textureIBL(
    vec3 viewDirectionEC,
    vec3 normalEC,
    vec3 lightDirectionEC,
    czm_modelMaterial material
) {
    #ifdef DIFFUSE_IBL
        vec3 normalMC = normalize(model_iblReferenceFrameMatrix * normalEC);
        vec3 diffuseContribution = computeDiffuseIBL(normalMC) * material.diffuse;
    #else
        vec3 diffuseContribution = vec3(0.0); 
    #endif

    #ifdef USE_ANISOTROPY
        // Bend normal to account for anisotropic distortion of specular reflection
        vec3 anisotropyDirection = material.anisotropicB;
        vec3 anisotropicTangent = cross(anisotropyDirection, viewDirectionEC);
        vec3 anisotropicNormal = cross(anisotropicTangent, anisotropyDirection);
        float bendFactor = 1.0 - material.anisotropyStrength * (1.0 - material.roughness);
        float bendFactorPow4 = bendFactor * bendFactor * bendFactor * bendFactor;
        vec3 bentNormal = normalize(mix(anisotropicNormal, normalEC, bendFactorPow4));
        vec3 reflectEC = reflect(-viewDirectionEC, bentNormal);
    #else
        vec3 reflectEC = reflect(-viewDirectionEC, normalEC);
    #endif

    #ifdef SPECULAR_IBL
        vec3 reflectMC = normalize(model_iblReferenceFrameMatrix * reflectEC);
        float NdotV = clamp(dot(normalEC, viewDirectionEC), 0.0, 1.0);
        vec3 f0 = material.specular;
        vec3 specularContribution = computeSpecularIBL(reflectMC, NdotV, f0, material.roughness);
    #else
        vec3 specularContribution = vec3(0.0); 
    #endif

    #ifdef USE_SPECULAR
        specularContribution *= material.specularWeight;
    #endif

    return diffuseContribution + specularContribution;
}
#endif
`,_2={name:"ImageBasedLightingPipelineStage"};_2.process=function(e,t,n){const i=t.imageBasedLighting,r=e.shaderBuilder;r.addDefine("USE_IBL_LIGHTING",void 0,Q.FRAGMENT),r.addUniform("vec2","model_iblFactor",Q.FRAGMENT),sc.isSupported(n.context)&&((i.useSphericalHarmonics||i.useSpecularEnvironmentMaps||i.enabled)&&r.addUniform("mat3","model_iblReferenceFrameMatrix",Q.FRAGMENT),l(i.sphericalHarmonicCoefficients)?(r.addDefine("DIFFUSE_IBL",void 0,Q.FRAGMENT),r.addDefine("CUSTOM_SPHERICAL_HARMONICS",void 0,Q.FRAGMENT),r.addUniform("vec3","model_sphericalHarmonicCoefficients[9]",Q.FRAGMENT)):i.useDefaultSphericalHarmonics&&r.addDefine("DIFFUSE_IBL",void 0,Q.FRAGMENT),l(i.specularEnvironmentMapAtlas)&&i.specularEnvironmentMapAtlas.ready?(r.addDefine("SPECULAR_IBL",void 0,Q.FRAGMENT),r.addDefine("CUSTOM_SPECULAR_IBL",void 0,Q.FRAGMENT),r.addUniform("sampler2D","model_specularEnvironmentMaps",Q.FRAGMENT),r.addUniform("vec2","model_specularEnvironmentMapsSize",Q.FRAGMENT),r.addUniform("float","model_specularEnvironmentMapsMaximumLOD",Q.FRAGMENT)):t.useDefaultSpecularMaps&&r.addDefine("SPECULAR_IBL",void 0,Q.FRAGMENT)),l(i.luminanceAtZenith)&&(r.addDefine("USE_SUN_LUMINANCE",void 0,Q.FRAGMENT),r.addUniform("float","model_luminanceAtZenith",Q.FRAGMENT)),r.addFragmentLines(sue);const s={model_iblFactor:function(){return i.imageBasedLightingFactor},model_iblReferenceFrameMatrix:function(){return t._iblReferenceFrameMatrix},model_luminanceAtZenith:function(){return i.luminanceAtZenith},model_sphericalHarmonicCoefficients:function(){return i.sphericalHarmonicCoefficients},model_specularEnvironmentMaps:function(){return i.specularEnvironmentMapAtlas.texture},model_specularEnvironmentMapsSize:function(){return i.specularEnvironmentMapAtlas.texture.dimensions},model_specularEnvironmentMapsMaximumLOD:function(){return i.specularEnvironmentMapAtlas.maximumMipmapLevel}};e.uniformMap=wt(s,e.uniformMap)};const oue=R.EPSILON16;function Fw(e){e=T(e,T.EMPTY_OBJECT);const t=e.stage,n=e.runtimeArticulation;y.typeOf.object("options.stage",t),y.typeOf.object("options.runtimeArticulation",n),this._stage=t,this._runtimeArticulation=n,this._name=t.name,this._type=t.type,this._minimumValue=t.minimumValue,this._maximumValue=t.maximumValue,this._currentValue=t.initialValue}Object.defineProperties(Fw.prototype,{stage:{get:function(){return this._stage}},runtimeArticulation:{get:function(){return this._runtimeArticulation}},name:{get:function(){return this._name}},type:{get:function(){return this._type}},minimumValue:{get:function(){return this._minimumValue}},maximumValue:{get:function(){return this._maximumValue}},currentValue:{get:function(){return this._currentValue},set:function(e){y.typeOf.number("value",e),e=R.clamp(e,this.minimumValue,this.maximumValue),R.equalsEpsilon(this._currentValue,e,oue)||(this._currentValue=e,this.runtimeArticulation._dirty=!0)}}});const aue=new m,lT=new H;Fw.prototype.applyStageToMatrix=function(e){y.typeOf.object("result",e);const t=this.type,n=this.currentValue,i=aue;let r;switch(t){case _o.XROTATE:r=H.fromRotationX(R.toRadians(n),lT),e=P.multiplyByMatrix3(e,r,e);break;case _o.YROTATE:r=H.fromRotationY(R.toRadians(n),lT),e=P.multiplyByMatrix3(e,r,e);break;case _o.ZROTATE:r=H.fromRotationZ(R.toRadians(n),lT),e=P.multiplyByMatrix3(e,r,e);break;case _o.XTRANSLATE:i.x=n,i.y=0,i.z=0,e=P.multiplyByTranslation(e,i,e);break;case _o.YTRANSLATE:i.x=0,i.y=n,i.z=0,e=P.multiplyByTranslation(e,i,e);break;case _o.ZTRANSLATE:i.x=0,i.y=0,i.z=n,e=P.multiplyByTranslation(e,i,e);break;case _o.XSCALE:i.x=n,i.y=1,i.z=1,e=P.multiplyByScale(e,i,e);break;case _o.YSCALE:i.x=1,i.y=n,i.z=1,e=P.multiplyByScale(e,i,e);break;case _o.ZSCALE:i.x=1,i.y=1,i.z=n,e=P.multiplyByScale(e,i,e);break;case _o.UNIFORMSCALE:e=P.multiplyByUniformScale(e,n,e);break}return e};function ib(e){e=T(e,T.EMPTY_OBJECT);const t=e.articulation,n=e.sceneGraph;y.typeOf.object("options.articulation",t),y.typeOf.object("options.sceneGraph",n),this._articulation=t,this._sceneGraph=n,this._name=t.name,this._runtimeStages=[],this._runtimeStagesByName={},this._runtimeNodes=[],this._dirty=!0,cue(this)}Object.defineProperties(ib.prototype,{articulation:{get:function(){return this._articulation}},sceneGraph:{get:function(){return this._sceneGraph}},name:{get:function(){return this._name}},runtimeStages:{get:function(){return this._runtimeStages}},runtimeNodes:{get:function(){return this._runtimeNodes}}});function cue(e){const n=e.articulation.stages,i=n.length,r=e._runtimeStages,s=e._runtimeStagesByName;for(let o=0;o<i;o++){const a=n[o],c=new Fw({stage:a,runtimeArticulation:e});r.push(c);const u=a.name;s[u]=c}}ib.prototype.setArticulationStage=function(e,t){const n=this._runtimeStagesByName[e];l(n)&&(n.currentValue=t)};const lue=new P,uue=new P;ib.prototype.apply=function(){if(!this._dirty)return;this._dirty=!1;let e=P.clone(P.IDENTITY,lue),t;const n=this._runtimeStages,i=n.length;for(t=0;t<i;t++)e=n[t].applyStageToMatrix(e);const r=this._runtimeNodes,s=r.length;for(t=0;t<s;t++){const o=r[t],a=P.multiplyTransformation(o.originalTransform,e,uue);o.transform=a}};const fue=`void modelColorStage(inout czm_modelMaterial material)
{
    material.diffuse = mix(material.diffuse, model_color.rgb, model_colorBlend);
    float highlight = ceil(model_colorBlend);
    material.diffuse *= mix(model_color.rgb, vec3(1.0), highlight);
    material.alpha *= model_color.a;
}
`,Xc={name:"ModelColorPipelineStage",COLOR_UNIFORM_NAME:"model_color",COLOR_BLEND_UNIFORM_NAME:"model_colorBlend"};Xc.process=function(e,t,n){const i=e.shaderBuilder;i.addDefine("HAS_MODEL_COLOR",void 0,Q.FRAGMENT),i.addFragmentLines(fue);const r={},s=t.color;s.alpha===0&&!t.hasSilhouette(n)&&(e.renderStateOptions.colorMask={red:!1,green:!1,blue:!1,alpha:!1}),s.alpha<1&&(e.alphaOptions.pass=Ke.TRANSLUCENT),i.addUniform("vec4",Xc.COLOR_UNIFORM_NAME,Q.FRAGMENT),r[Xc.COLOR_UNIFORM_NAME]=function(){return t.color},i.addUniform("float",Xc.COLOR_BLEND_UNIFORM_NAME,Q.FRAGMENT),r[Xc.COLOR_BLEND_UNIFORM_NAME]=function(){return vw.getColorBlend(t.colorBlendMode,t.colorBlendAmount)},e.uniformMap=wt(r,e.uniformMap)};const hue=`#ifdef USE_CLIPPING_PLANES_FLOAT_TEXTURE
vec4 getClippingPlane(
    highp sampler2D packedClippingPlanes,
    int clippingPlaneNumber,
    mat4 transform
) {
    int pixY = clippingPlaneNumber / CLIPPING_PLANES_TEXTURE_WIDTH;
    int pixX = clippingPlaneNumber - (pixY * CLIPPING_PLANES_TEXTURE_WIDTH);
    float pixelWidth = 1.0 / float(CLIPPING_PLANES_TEXTURE_WIDTH);
    float pixelHeight = 1.0 / float(CLIPPING_PLANES_TEXTURE_HEIGHT);
    float u = (float(pixX) + 0.5) * pixelWidth; // sample from center of pixel
    float v = (float(pixY) + 0.5) * pixelHeight;
    vec4 plane = texture(packedClippingPlanes, vec2(u, v));
    return czm_transformPlane(plane, transform);
}
#else
// Handle uint8 clipping texture instead
vec4 getClippingPlane(
    highp sampler2D packedClippingPlanes,
    int clippingPlaneNumber,
    mat4 transform
) {
    int clippingPlaneStartIndex = clippingPlaneNumber * 2; // clipping planes are two pixels each
    int pixY = clippingPlaneStartIndex / CLIPPING_PLANES_TEXTURE_WIDTH;
    int pixX = clippingPlaneStartIndex - (pixY * CLIPPING_PLANES_TEXTURE_WIDTH);
    float pixelWidth = 1.0 / float(CLIPPING_PLANES_TEXTURE_WIDTH);
    float pixelHeight = 1.0 / float(CLIPPING_PLANES_TEXTURE_HEIGHT);
    float u = (float(pixX) + 0.5) * pixelWidth; // sample from center of pixel
    float v = (float(pixY) + 0.5) * pixelHeight;
    vec4 oct32 = texture(packedClippingPlanes, vec2(u, v)) * 255.0;
    vec2 oct = vec2(oct32.x * 256.0 + oct32.y, oct32.z * 256.0 + oct32.w);
    vec4 plane;
    plane.xyz = czm_octDecode(oct, 65535.0);
    plane.w = czm_unpackFloat(texture(packedClippingPlanes, vec2(u + pixelWidth, v)));
    return czm_transformPlane(plane, transform);
}
#endif

float clip(vec4 fragCoord, sampler2D clippingPlanes, mat4 clippingPlanesMatrix) {
    vec4 position = czm_windowToEyeCoordinates(fragCoord);
    vec3 clipNormal = vec3(0.0);
    vec3 clipPosition = vec3(0.0);
    float pixelWidth = czm_metersPerPixel(position);
    
    #ifdef UNION_CLIPPING_REGIONS
    float clipAmount; // For union planes, we want to get the min distance. So we set the initial value to the first plane distance in the loop below.
    #else
    float clipAmount = 0.0;
    bool clipped = true;
    #endif

    for (int i = 0; i < CLIPPING_PLANES_LENGTH; ++i) {
        vec4 clippingPlane = getClippingPlane(clippingPlanes, i, clippingPlanesMatrix);
        clipNormal = clippingPlane.xyz;
        clipPosition = -clippingPlane.w * clipNormal;
        float amount = dot(clipNormal, (position.xyz - clipPosition)) / pixelWidth;
        
        #ifdef UNION_CLIPPING_REGIONS
        clipAmount = czm_branchFreeTernary(i == 0, amount, min(amount, clipAmount));
        if (amount <= 0.0) {
            discard;
        }
        #else
        clipAmount = max(amount, clipAmount);
        clipped = clipped && (amount <= 0.0);
        #endif
    }

    #ifndef UNION_CLIPPING_REGIONS
    if (clipped) {
        discard;
    }
    #endif
    
    return clipAmount;
}

void modelClippingPlanesStage(inout vec4 color)
{
    float clipDistance = clip(gl_FragCoord, model_clippingPlanes, model_clippingPlanesMatrix);
    vec4 clippingPlanesEdgeColor = vec4(1.0);
    clippingPlanesEdgeColor.rgb = model_clippingPlanesEdgeStyle.rgb;
    float clippingPlanesEdgeWidth = model_clippingPlanesEdgeStyle.a;
    
    if (clipDistance > 0.0 && clipDistance < clippingPlanesEdgeWidth) {
        color = clippingPlanesEdgeColor;
    }
}
`,y2={name:"ModelClippingPlanesPipelineStage"},due=new k;y2.process=function(e,t,n){const i=t.clippingPlanes,r=n.context,s=e.shaderBuilder;s.addDefine("HAS_CLIPPING_PLANES",void 0,Q.FRAGMENT),s.addDefine("CLIPPING_PLANES_LENGTH",i.length,Q.FRAGMENT),i.unionClippingRegions&&s.addDefine("UNION_CLIPPING_REGIONS",void 0,Q.FRAGMENT),di.useFloatTexture(r)&&s.addDefine("USE_CLIPPING_PLANES_FLOAT_TEXTURE",void 0,Q.FRAGMENT);const o=di.getTextureResolution(i,r,due);s.addDefine("CLIPPING_PLANES_TEXTURE_WIDTH",o.x,Q.FRAGMENT),s.addDefine("CLIPPING_PLANES_TEXTURE_HEIGHT",o.y,Q.FRAGMENT),s.addUniform("sampler2D","model_clippingPlanes",Q.FRAGMENT),s.addUniform("vec4","model_clippingPlanesEdgeStyle",Q.FRAGMENT),s.addUniform("mat4","model_clippingPlanesMatrix",Q.FRAGMENT),s.addFragmentLines(hue);const a={model_clippingPlanes:function(){return i.texture},model_clippingPlanesEdgeStyle:function(){const c=M.clone(i.edgeColor);return c.alpha=i.edgeWidth,c},model_clippingPlanesMatrix:function(){return t._clippingPlanesMatrix}};e.uniformMap=wt(a,e.uniformMap)};const pue=`void modelClippingPolygonsStage(ProcessedAttributes attributes)
{
    vec2 sphericalLatLong = czm_approximateSphericalCoordinates(v_positionWC);
    sphericalLatLong.y = czm_branchFreeTernary(sphericalLatLong.y < czm_pi, sphericalLatLong.y, sphericalLatLong.y - czm_twoPi);

    vec2 minDistance = vec2(czm_infinity);
    v_regionIndex = -1;
    v_clippingPosition = vec2(czm_infinity);

    for (int regionIndex = 0; regionIndex < CLIPPING_POLYGON_REGIONS_LENGTH; regionIndex++) {
        vec4 extents = czm_unpackClippingExtents(model_clippingExtents, regionIndex);
        vec2 rectUv = (sphericalLatLong.yx - extents.yx) * extents.wz;

        vec2 clamped = clamp(rectUv, vec2(0.0), vec2(1.0));
        vec2 distance = abs(rectUv - clamped) * extents.wz;
        
        if (minDistance.x > distance.x || minDistance.y > distance.y) {
            minDistance = distance;
            v_clippingPosition = rectUv;
        }

        float threshold = 0.01;
        if (rectUv.x > threshold && rectUv.y > threshold && rectUv.x < 1.0 - threshold && rectUv.y < 1.0 - threshold) {
            v_regionIndex = regionIndex;
        }
    }
}
`,mue=`void modelClippingPolygonsStage()
{
    vec2 clippingPosition = v_clippingPosition;
    int regionIndex = v_regionIndex;
    czm_clipPolygons(model_clippingDistance, CLIPPING_POLYGON_REGIONS_LENGTH, clippingPosition, regionIndex);
}
`,b2={name:"ModelClippingPolygonsPipelineStage"};b2.process=function(e,t,n){const i=t.clippingPolygons,r=e.shaderBuilder;r.addDefine("ENABLE_CLIPPING_POLYGONS",void 0,Q.BOTH),i.inverse&&r.addDefine("CLIPPING_INVERSE",void 0,Q.FRAGMENT),r.addDefine("CLIPPING_POLYGON_REGIONS_LENGTH",i.extentsCount,Q.BOTH),r.addUniform("sampler2D","model_clippingDistance",Q.FRAGMENT),r.addUniform("sampler2D","model_clippingExtents",Q.VERTEX),r.addVarying("vec2","v_clippingPosition"),r.addVarying("int","v_regionIndex","flat"),r.addVertexLines(pue),r.addFragmentLines(mue);const s={model_clippingDistance:function(){return i.clippingTexture},model_clippingExtents:function(){return i.extentsTexture}};e.uniformMap=wt(s,e.uniformMap)};function T2(e,t){y.typeOf.object("model",e),y.typeOf.object("runtimeNode",t),this._model=e,this._runtimeNode=t}Object.defineProperties(T2.prototype,{name:{get:function(){return this._runtimeNode._name}},id:{get:function(){return this._runtimeNode._id}},show:{get:function(){return this._runtimeNode.show},set:function(e){this._runtimeNode.show=e}},matrix:{get:function(){return this._runtimeNode.transform},set:function(e){l(e)?(this._runtimeNode.transform=e,this._runtimeNode.userAnimated=!0,this._model._userAnimationDirty=!0):(this._runtimeNode.transform=this.originalMatrix,this._runtimeNode.userAnimated=!1)}},originalMatrix:{get:function(){return this._runtimeNode.originalTransform}}});const gue=`mat4 getInstancingTransform()
{
    mat4 instancingTransform;

    #ifdef HAS_INSTANCE_MATRICES
    instancingTransform = mat4(
        a_instancingTransformRow0.x, a_instancingTransformRow1.x, a_instancingTransformRow2.x, 0.0, // Column 1
        a_instancingTransformRow0.y, a_instancingTransformRow1.y, a_instancingTransformRow2.y, 0.0, // Column 2
        a_instancingTransformRow0.z, a_instancingTransformRow1.z, a_instancingTransformRow2.z, 0.0, // Column 3
        a_instancingTransformRow0.w, a_instancingTransformRow1.w, a_instancingTransformRow2.w, 1.0  // Column 4
    );
    #else
    vec3 translation = vec3(0.0, 0.0, 0.0);
    vec3 scale = vec3(1.0, 1.0, 1.0);
    
        #ifdef HAS_INSTANCE_TRANSLATION
        translation = a_instanceTranslation;
        #endif
        #ifdef HAS_INSTANCE_SCALE
        scale = a_instanceScale;
        #endif

    instancingTransform = mat4(
        scale.x, 0.0, 0.0, 0.0,
        0.0, scale.y, 0.0, 0.0,
        0.0, 0.0, scale.z, 0.0,
        translation.x, translation.y, translation.z, 1.0
    ); 
    #endif

    return instancingTransform;
}

#ifdef USE_2D_INSTANCING
mat4 getInstancingTransform2D()
{
    mat4 instancingTransform2D;

    #ifdef HAS_INSTANCE_MATRICES
    instancingTransform2D = mat4(
        a_instancingTransform2DRow0.x, a_instancingTransform2DRow1.x, a_instancingTransform2DRow2.x, 0.0, // Column 1
        a_instancingTransform2DRow0.y, a_instancingTransform2DRow1.y, a_instancingTransform2DRow2.y, 0.0, // Column 2
        a_instancingTransform2DRow0.z, a_instancingTransform2DRow1.z, a_instancingTransform2DRow2.z, 0.0, // Column 3
        a_instancingTransform2DRow0.w, a_instancingTransform2DRow1.w, a_instancingTransform2DRow2.w, 1.0  // Column 4
    );
    #else
    vec3 translation2D = vec3(0.0, 0.0, 0.0);
    vec3 scale = vec3(1.0, 1.0, 1.0);
    
        #ifdef HAS_INSTANCE_TRANSLATION
        translation2D = a_instanceTranslation2D;
        #endif
        #ifdef HAS_INSTANCE_SCALE
        scale = a_instanceScale;
        #endif

    instancingTransform2D = mat4(
        scale.x, 0.0, 0.0, 0.0,
        0.0, scale.y, 0.0, 0.0,
        0.0, 0.0, scale.z, 0.0,
        translation2D.x, translation2D.y, translation2D.z, 1.0
    ); 
    #endif

    return instancingTransform2D;
}
#endif
`,_ue=`void instancingStage(inout ProcessedAttributes attributes) 
{
    vec3 positionMC = attributes.positionMC;
    
    mat4 instancingTransform = getInstancingTransform();
    
    attributes.positionMC = (instancingTransform * vec4(positionMC, 1.0)).xyz;

    #ifdef HAS_NORMALS
    vec3 normalMC = attributes.normalMC;
    attributes.normalMC = (instancingTransform * vec4(normalMC, 0.0)).xyz;
    #endif

    #ifdef USE_2D_INSTANCING
    mat4 instancingTransform2D = getInstancingTransform2D();
    attributes.position2D = (instancingTransform2D * vec4(positionMC, 1.0)).xyz;
    #endif
}
`,yue=`void legacyInstancingStage(
    inout ProcessedAttributes attributes,
    out mat4 instanceModelView,
    out mat3 instanceModelViewInverseTranspose)
{
    vec3 positionMC = attributes.positionMC;

    mat4 instancingTransform = getInstancingTransform();
 
    mat4 instanceModel = instancingTransform * u_instance_nodeTransform;
    instanceModelView = u_instance_modifiedModelView;
    instanceModelViewInverseTranspose = mat3(u_instance_modifiedModelView * instanceModel);

    attributes.positionMC = (instanceModel * vec4(positionMC, 1.0)).xyz;
    
    #ifdef USE_2D_INSTANCING
    mat4 instancingTransform2D = getInstancingTransform2D();
    attributes.position2D = (instancingTransform2D * vec4(positionMC, 1.0)).xyz;
    #endif
}
`,Eg=new P,bue=new P,Tue=new P,x2={name:"InstancingPipelineStage",_getInstanceTransformsAsMatrices:S2,_transformsToTypedArray:uE};x2.process=function(e,t,n){const i=t.instances,r=i.attributes[0].count,s=e.shaderBuilder;s.addDefine("HAS_INSTANCING"),s.addVertexLines(gue);const o=e.model,a=o.sceneGraph,c=e.runtimeNode,u=n.mode!==Ie.SCENE3D&&!n.scene3DOnly&&o._projectTo2D,h=o._enablePick&&!n.context.webgl2,d=[];Mue(e,n,i,d,u,h),Nue(e,n,i,d);const p={};if(i.transformInWorldSpace?(s.addDefine("USE_LEGACY_INSTANCING",void 0,Q.VERTEX),s.addUniform("mat4","u_instance_modifiedModelView",Q.VERTEX),s.addUniform("mat4","u_instance_nodeTransform",Q.VERTEX),p.u_instance_modifiedModelView=function(){let g=P.multiplyTransformation(o.modelMatrix,a.components.transform,Eg);return u?P.multiplyTransformation(n.context.uniformState.view3D,g,Eg):(n.mode!==Ie.SCENE3D&&(g=et.basisTo2D(n.mapProjection,g,Eg)),P.multiplyTransformation(n.context.uniformState.view,g,Eg))},p.u_instance_nodeTransform=function(){return P.multiplyTransformation(a.axisCorrectionMatrix,c.computedTransform,bue)},s.addVertexLines(yue)):s.addVertexLines(_ue),u){s.addDefine("USE_2D_INSTANCING",void 0,Q.VERTEX),s.addUniform("mat4","u_modelView2D",Q.VERTEX);const g=n.context,_=P.fromTranslation(c.instancingReferencePoint2D,new P);p.u_modelView2D=function(){return P.multiplyTransformation(g.uniformState.view,_,Tue)}}e.uniformMap=wt(p,e.uniformMap),e.instanceCount=r,e.attributes.push.apply(e.attributes,d)};const ep=new P,xue=new m;function Eue(e,t,n,i,r){let s=P.multiplyTransformation(t,e,ep);return s=P.multiplyTransformation(s,n,ep),r=et.basisTo2D(i.mapProjection,s,r),r}function Cue(e,t,n,i,r){const s=P.fromTranslation(e,ep);let o=P.multiplyTransformation(t,s,ep);o=P.multiplyTransformation(o,n,ep);const a=P.getTranslation(o,xue);return r=an.computeActualEllipsoidPosition(i,a,r),r}function E2(e,t,n){const i=e.model,r=i.sceneGraph;e.runtimeNode.node.instances.transformInWorldSpace?(t=P.multiplyTransformation(i.modelMatrix,r.components.transform,t),n=P.multiplyTransformation(r.axisCorrectionMatrix,e.runtimeNode.computedTransform,n)):(t=P.clone(r.computedModelMatrix,t),t=P.multiplyTransformation(t,e.runtimeNode.computedTransform,t),n=P.clone(P.IDENTITY,n))}const C2=new P,w2=new P,wue=new P,Aue=new m;function Sue(e,t,n,i){const r=C2,s=w2;E2(t,r,s);const a=t.runtimeNode.instancingReferencePoint2D,c=e.length;for(let u=0;u<c;u++){const h=e[u],d=Eue(h,r,s,n,wue),p=P.getTranslation(d,Aue),g=m.subtract(p,a,p);i[u]=P.setTranslation(d,g,i[u])}return i}function vue(e,t,n,i){const r=C2,s=w2;E2(t,r,s);const a=t.runtimeNode.instancingReferencePoint2D,c=e.length;for(let u=0;u<c;u++){const h=e[u],d=Cue(h,r,s,n,h);i[u]=m.subtract(d,a,i[u])}return i}const Iue=new m,Oue=new m;function A2(e,t){const n=e.runtimeNode,i=e.model.sceneGraph.computedModelMatrix,r=P.multiplyByPoint(i,n.instancingTranslationMin,Iue),s=an.computeActualEllipsoidPosition(t,r,r),o=P.multiplyByPoint(i,n.instancingTranslationMax,Oue),a=an.computeActualEllipsoidPosition(t,o,o);n.instancingReferencePoint2D=m.lerp(s,a,.5,new m)}function uE(e){const n=e.length,i=new Float32Array(n*12);for(let r=0;r<n;r++){const s=e[r],o=12*r;i[o+0]=s[0],i[o+1]=s[4],i[o+2]=s[8],i[o+3]=s[12],i[o+4]=s[1],i[o+5]=s[5],i[o+6]=s[9],i[o+7]=s[13],i[o+8]=s[2],i[o+9]=s[6],i[o+10]=s[10],i[o+11]=s[14]}return i}function Rue(e){const n=e.length,i=new Float32Array(n*3);for(let r=0;r<n;r++){const s=e[r],o=3*r;i[o+0]=s[0],i[o+1]=s[4],i[o+2]=s[8]}return i}function S2(e,t,n){const i=new Array(t),r=je.getAttributeBySemantic(e,Tr.TRANSLATION),s=je.getAttributeBySemantic(e,Tr.ROTATION),o=je.getAttributeBySemantic(e,Tr.SCALE),a=new m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),c=new m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),u=l(r),h=l(s),d=l(o),p=u?r.typedArray:new Float32Array(t*3);let g=h?s.typedArray:new Float32Array(t*4);h&&s.normalized&&(g=nt.dequantize(g,s.componentDatatype,s.type,t));let _;d?_=o.typedArray:(_=new Float32Array(t*3),_.fill(1));for(let x=0;x<t;x++){const E=new m(p[x*3],p[x*3+1],p[x*3+2]);m.maximumByComponent(a,E,a),m.minimumByComponent(c,E,c);const C=new re(g[x*4],g[x*4+1],g[x*4+2],h?g[x*4+3]:1),w=new m(_[x*3],_[x*3+1],_[x*3+2]),S=P.fromTranslationQuaternionRotationScale(E,C,w,new P);i[x]=S}const b=n.runtimeNode;return b.instancingTranslationMin=c,b.instancingTranslationMax=a,u&&(r.typedArray=void 0),h&&(s.typedArray=void 0),d&&(o.typedArray=void 0),i}function Due(e,t,n){const i=new Array(t),r=e.typedArray,s=new m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let c=0;c<t;c++){const u=new m(r[c*3],r[c*3+1],r[c*3+2]);i[c]=u,m.minimumByComponent(s,u,s),m.maximumByComponent(o,u,o)}const a=n.runtimeNode;return a.instancingTranslationMin=s,a.instancingTranslationMax=o,e.typedArray=void 0,i}function fE(e,t){const n=ze.createVertexBuffer({context:t.context,typedArray:e,usage:Ae.STATIC_DRAW});return n.vertexArrayDestroyable=!1,n}function Mue(e,t,n,i,r,s){const o=je.getAttributeBySemantic(n,Tr.ROTATION);l(o)?Lue(e,n,i,t,r,s):Pue(e,n,i,t,r)}function Lue(e,t,n,i,r,s){const o=e.shaderBuilder,a=t.attributes[0].count,c=e.model,u=e.runtimeNode;o.addDefine("HAS_INSTANCE_MATRICES");const h="Transform";let d,p=u.instancingTransformsBuffer;if(!l(p)){d=S2(t,a,e);const x=uE(d);p=fE(x,i),c._modelResources.push(p),s&&(u.transformsTypedArray=x),u.instancingTransformsBuffer=p}if(W1(e,p,n,h),!r)return;const g=Se(i);g.mode=Ie.COLUMBUS_VIEW,A2(e,g);let _=u.instancingTransformsBuffer2D;if(!l(_)){const x=Sue(d,e,g,d),E=uE(x);_=fE(E,i),c._modelResources.push(_),u.instancingTransformsBuffer2D=_}W1(e,_,n,"Transform2D")}function Pue(e,t,n,i,r,s){const o=e.shaderBuilder,a=e.runtimeNode,c=je.getAttributeBySemantic(t,Tr.TRANSLATION),u=je.getAttributeBySemantic(t,Tr.SCALE);if(l(u)&&(o.addDefine("HAS_INSTANCE_SCALE"),uT(e,u.buffer,u.byteOffset,u.byteStride,n,"Scale")),!l(c))return;let h;const d=c.typedArray;if(l(d)?h=Due(c,c.count,e):l(a.instancingTranslationMin)||(a.instancingTranslationMin=c.min,a.instancingTranslationMax=c.max),o.addDefine("HAS_INSTANCE_TRANSLATION"),uT(e,c.buffer,c.byteOffset,c.byteStride,n,"Translation"),!r&&!s)return;const g=Se(i);g.mode=Ie.COLUMBUS_VIEW,A2(e,g);let _=a.instancingTranslationBuffer2D;if(!l(_)){const C=vue(h,e,g,h),w=Rue(C);_=fE(w,i),e.model._modelResources.push(_),a.instancingTranslationBuffer2D=_}if(!r)return;uT(e,_,0,void 0,n,"Translation2D")}function W1(e,t,n,i){const s=q.getSizeInBytes(q.FLOAT),o=s*12,a=[{index:e.attributeIndex++,vertexBuffer:t,componentsPerAttribute:4,componentDatatype:q.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:o,instanceDivisor:1},{index:e.attributeIndex++,vertexBuffer:t,componentsPerAttribute:4,componentDatatype:q.FLOAT,normalize:!1,offsetInBytes:s*4,strideInBytes:o,instanceDivisor:1},{index:e.attributeIndex++,vertexBuffer:t,componentsPerAttribute:4,componentDatatype:q.FLOAT,normalize:!1,offsetInBytes:s*8,strideInBytes:o,instanceDivisor:1}],c=e.shaderBuilder;c.addAttribute("vec4",`a_instancing${i}Row0`),c.addAttribute("vec4",`a_instancing${i}Row1`),c.addAttribute("vec4",`a_instancing${i}Row2`),n.push.apply(n,a)}function uT(e,t,n,i,r,s){r.push({index:e.attributeIndex++,vertexBuffer:t,componentsPerAttribute:3,componentDatatype:q.FLOAT,normalize:!1,offsetInBytes:n,strideInBytes:i,instanceDivisor:1}),e.shaderBuilder.addAttribute("vec3",`a_instance${s}`)}function Nue(e,t,n,i){const r=n.attributes,s=e.shaderBuilder;for(let o=0;o<r.length;o++){const a=r[o];a.semantic===Tr.FEATURE_ID&&(a.setIndex>=e.featureIdVertexAttributeSetIndex&&(e.featureIdVertexAttributeSetIndex=a.setIndex+1),i.push({index:e.attributeIndex++,vertexBuffer:a.buffer,componentsPerAttribute:tt.getNumberOfComponents(a.type),componentDatatype:a.componentDatatype,normalize:!1,offsetInBytes:a.byteOffset,strideInBytes:a.byteStride,instanceDivisor:1}),s.addAttribute("float",`a_instanceFeatureId_${a.setIndex}`))}}const Bw={};Bw.name="ModelMatrixUpdateStage";Bw.update=function(e,t,n){const i=n.mode!==Ie.SCENE3D;if(!(i&&t._model._projectTo2D)&&e._transformDirty){const r=i?t._computedModelMatrix2D:t._computedModelMatrix;v2(e,t,r,e.transformToRoot),e._transformDirty=!1}};function v2(e,t,n,i){let r;i=P.multiplyTransformation(i,e.transform,new P),e.updateComputedTransform();const s=e.runtimePrimitives.length;for(r=0;r<s;r++){const c=e.runtimePrimitives[r].drawCommand;c.modelMatrix=P.multiplyTransformation(n,i,c.modelMatrix),c.cullFace=je.getCullFace(c.modelMatrix,c.primitiveType)}const o=e.children.length;for(r=0;r<o;r++){const a=t._runtimeNodes[e.children[r]];a._transformToRoot=P.clone(i,a._transformToRoot),v2(a,t,n,i),a._transformDirty=!1}}const I2={name:"NodeStatisticsPipelineStage",_countInstancingAttributes:O2,_countGeneratedBuffers:R2};I2.process=function(e,t,n){const i=e.model.statistics,r=t.instances,s=e.runtimeNode;O2(i,r),R2(i,s)};function O2(e,t){if(!l(t))return;const n=t.attributes,i=n.length;for(let r=0;r<i;r++){const s=n[r];l(s.buffer)&&e.addBuffer(s.buffer,!1)}}function R2(e,t){l(t.instancingTransformsBuffer)&&e.addBuffer(t.instancingTransformsBuffer,!1),l(t.instancingTransformsBuffer2D)&&e.addBuffer(t.instancingTransformsBuffer2D,!1),l(t.instancingTranslationBuffer2D)&&e.addBuffer(t.instancingTranslationBuffer2D,!1)}function zh(e){e=T(e,T.EMPTY_OBJECT);const t=e.node,n=e.transform,i=e.transformToRoot,r=e.sceneGraph,s=e.children;y.typeOf.object("options.node",t),y.typeOf.object("options.transform",n),y.typeOf.object("options.transformToRoot",i),y.typeOf.object("options.sceneGraph",r),y.typeOf.object("options.children",s),this._node=t,this._name=t.name,this._id=t.index,this._sceneGraph=r,this._children=s,this._originalTransform=P.clone(n,this._originalTransform),this._transform=P.clone(n,this._transform),this._transformToRoot=P.clone(i,this._transformToRoot),this._computedTransform=new P,this._transformDirty=!1,this._transformParameters=void 0,this._morphWeights=[],this._runtimeSkin=void 0,this._computedJointMatrices=[],this.show=!0,this.userAnimated=!1,this.pipelineStages=[],this.runtimePrimitives=[],this.updateStages=[],this.instancingTranslationMin=void 0,this.instancingTranslationMax=void 0,this.instancingTransformsBuffer=void 0,this.instancingTransformsBuffer2D=void 0,this.instancingTranslationBuffer2D=void 0,this.instancingReferencePoint2D=void 0,Fue(this)}Object.defineProperties(zh.prototype,{node:{get:function(){return this._node}},sceneGraph:{get:function(){return this._sceneGraph}},children:{get:function(){return this._children}},transform:{get:function(){return this._transform},set:function(e){this._transformDirty=!0,this._transform=P.clone(e,this._transform)}},transformToRoot:{get:function(){return this._transformToRoot}},computedTransform:{get:function(){return this._computedTransform}},originalTransform:{get:function(){return this._originalTransform}},translation:{get:function(){return l(this._transformParameters)?this._transformParameters.translation:void 0},set:function(e){const t=this._transformParameters;if(!l(t))throw new A("The translation of a node cannot be set if it was defined using a matrix in the model.");const n=t.translation;m.equals(n,e)||(t.translation=m.clone(e,t.translation),fT(this,t))}},rotation:{get:function(){return l(this._transformParameters)?this._transformParameters.rotation:void 0},set:function(e){const t=this._transformParameters;if(!l(t))throw new A("The rotation of a node cannot be set if it was defined using a matrix in the model.");const n=t.rotation;re.equals(n,e)||(t.rotation=re.clone(e,t.rotation),fT(this,t))}},scale:{get:function(){return l(this._transformParameters)?this._transformParameters.scale:void 0},set:function(e){const t=this._transformParameters;if(!l(t))throw new A("The scale of a node cannot be set if it was defined using a matrix in the model.");const n=t.scale;m.equals(n,e)||(t.scale=m.clone(e,t.scale),fT(this,t))}},morphWeights:{get:function(){return this._morphWeights},set:function(e){const t=e.length;if(this._morphWeights.length!==t)throw new A("value must have the same length as the original weights array.");for(let n=0;n<t;n++)this._morphWeights[n]=e[n]}},runtimeSkin:{get:function(){return this._runtimeSkin}},computedJointMatrices:{get:function(){return this._computedJointMatrices}}});function Fue(e){const t=e.transform,n=e.transformToRoot,i=e._computedTransform;e._computedTransform=P.multiply(n,t,i);const r=e.node;l(r.matrix)||(e._transformParameters=new qL(r.translation,r.rotation,r.scale)),l(r.morphWeights)&&(e._morphWeights=r.morphWeights.slice());const s=r.articulationName;if(l(s)){const c=e.sceneGraph._runtimeArticulations[s];l(c)&&c.runtimeNodes.push(e)}}function fT(e,t){e._transformDirty=!0,e._transform=P.fromTranslationRotationScale(t,e._transform)}zh.prototype.getChild=function(e){if(y.typeOf.number("index",e),e<0||e>=this.children.length)throw new A("index must be greater than or equal to 0 and less than the number of children.");return this.sceneGraph._runtimeNodes[this.children[e]]};zh.prototype.configurePipeline=function(){const e=this.node,t=this.pipelineStages;t.length=0;const n=this.updateStages;n.length=0,l(e.instances)&&t.push(x2),t.push(I2),n.push(Bw)};zh.prototype.updateComputedTransform=function(){this._computedTransform=P.multiply(this._transformToRoot,this._transform,this._computedTransform)};zh.prototype.updateJointMatrices=function(){const e=this._runtimeSkin;if(!l(e))return;e.updateJointMatrices();const t=this._computedJointMatrices,n=e.jointMatrices,i=n.length;for(let r=0;r<i;r++){l(t[r])||(t[r]=new P);const s=P.multiplyTransformation(this.transformToRoot,this.transform,t[r]),o=P.inverseTransformation(s,t[r]);t[r]=P.multiplyTransformation(o,n[r],t[r])}};const D2={name:"AlphaPipelineStage"};D2.process=function(e,t,n){const i=e.alphaOptions,r=e.model;i.pass=T(i.pass,r.opaquePass);const s=e.renderStateOptions;i.pass===Ke.TRANSLUCENT&&(s.cull.enabled=!1,s.depthMask=!1,s.blending=vs.ALPHA_BLEND);const o=e.shaderBuilder,a=e.uniformMap;l(i.alphaCutoff)&&(o.addDefine("ALPHA_MODE_MASK",void 0,Q.FRAGMENT),o.addUniform("float","u_alphaCutoff",Q.FRAGMENT),a.u_alphaCutoff=function(){return i.alphaCutoff})};const M2={name:"BatchTexturePipelineStage"};M2.process=function(e,t,n){const i=e.shaderBuilder,r={},s=e.model,o=s.featureTables[s.featureTableId],a=o.featuresLength;i.addUniform("int","model_featuresLength"),r.model_featuresLength=function(){return a};const c=o.batchTexture;i.addUniform("sampler2D","model_batchTexture"),r.model_batchTexture=function(){return T(c.batchTexture,c.defaultTexture)},i.addUniform("vec4","model_textureStep"),r.model_textureStep=function(){return c.textureStep},c.textureDimensions.y>1&&(i.addDefine("MULTILINE_BATCH_TEXTURE"),i.addUniform("vec2","model_textureDimensions"),r.model_textureDimensions=function(){return c.textureDimensions}),e.uniformMap=wt(r,e.uniformMap)};const L2={name:"ClassificationPipelineStage"};L2.process=function(e,t,n){e.shaderBuilder.addDefine("HAS_CLASSIFICATION",void 0,Q.BOTH);const r=e.runtimePrimitive;l(r.batchLengths)||Bue(t,r)};function Bue(e,t){const n=je.getAttributeBySemantic(e,Me.POSITION);if(!l(n))throw new te("Primitives must have a position attribute to be used for classification.");let i;const r=e.indices,s=l(r);s&&(i=r.typedArray,r.typedArray=void 0);const o=s?r.count:n.count,a=je.getAttributeBySemantic(e,Me.FEATURE_ID,0);if(!l(a)){t.batchLengths=[o],t.batchOffsets=[0];return}const c=a.typedArray;a.typedArray=void 0;const u=[],h=[0],d=s?i[0]:0;let p=c[d],g=0;for(let b=1;b<o;b++){const x=s?i[b]:b,E=c[x];if(E!==p){const C=b-g,w=b;u.push(C),h.push(w),g=w,p=E}}const _=o-g;u.push(_),t.batchLengths=u,t.batchOffsets=h}const zue=`void filterByPassType(inout vec3 positionMC, vec4 featureColor)
{
    bool styleTranslucent = (featureColor.a != 1.0);
    // Only render translucent features in the translucent pass (if the style or the original command has translucency).
    if (czm_pass == czm_passTranslucent && !styleTranslucent && !model_commandTranslucent)
    {
        // If the model has a translucent silhouette, it needs to render during the silhouette color command,
        // (i.e. the command where model_silhouettePass = true), even if the model isn't translucent.
        #ifdef HAS_SILHOUETTE
        positionMC *= float(model_silhouettePass);
        #else
        positionMC *= 0.0;
        #endif
    }
    // If the current pass is not the translucent pass and the style is not translucent, don't render the feature.
    else if (czm_pass != czm_passTranslucent && styleTranslucent)
    {
        positionMC *= 0.0;
    }
}

void cpuStylingStage(inout vec3 positionMC, inout SelectedFeature feature)
{
    float show = ceil(feature.color.a);
    positionMC *= show;

    #if defined(HAS_SELECTED_FEATURE_ID_ATTRIBUTE) && !defined(HAS_CLASSIFICATION)
    filterByPassType(positionMC, feature.color);
    #endif
}
`,Uue=`void filterByPassType(vec4 featureColor)
{
    bool styleTranslucent = (featureColor.a != 1.0);
    // Only render translucent features in the translucent pass (if the style or the original command has translucency).
    if (czm_pass == czm_passTranslucent && !styleTranslucent && !model_commandTranslucent)
    {   
        // If the model has a translucent silhouette, it needs to render during the silhouette color command,
        // (i.e. the command where model_silhouettePass = true), even if the model isn't translucent.
        #ifdef HAS_SILHOUETTE
        if(!model_silhouettePass) {
            discard;
        }
        #else
        discard;
        #endif
    }
    // If the current pass is not the translucent pass and the style is not translucent, don't render the feature.
    else if (czm_pass != czm_passTranslucent && styleTranslucent)
    {
        discard;
    }
}

void cpuStylingStage(inout czm_modelMaterial material, SelectedFeature feature)
{
    vec4 featureColor = feature.color;
    if (featureColor.a == 0.0)
    {
        discard;
    }

    // If a feature ID vertex attribute is used, the pass type filter is applied in the vertex shader.
    // So, we only apply in in the fragment shader if the feature ID texture is used.
    #if defined(HAS_SELECTED_FEATURE_ID_TEXTURE) && !defined(HAS_CLASSIFICATION)
    filterByPassType(featureColor);
    #endif

    featureColor = czm_gammaCorrect(featureColor);

    // Classification models compute the diffuse differently.
    #ifdef HAS_CLASSIFICATION
    material.diffuse = featureColor.rgb * featureColor.a;
    #else
    float highlight = ceil(model_colorBlend);
    material.diffuse *= mix(featureColor.rgb, vec3(1.0), highlight);
    #endif
    
    material.alpha *= featureColor.a;
}
`,P2={name:"CPUStylingPipelineStage"};P2.process=function(e,t,n){const i=e.model,r=e.shaderBuilder;r.addVertexLines(zue),r.addFragmentLines(Uue),r.addDefine("USE_CPU_STYLING",void 0,Q.BOTH),l(i.color)||(r.addUniform("float",Xc.COLOR_BLEND_UNIFORM_NAME,Q.FRAGMENT),e.uniformMap[Xc.COLOR_BLEND_UNIFORM_NAME]=function(){return vw.getColorBlend(i.colorBlendMode,i.colorBlendAmount)}),r.addUniform("bool","model_commandTranslucent",Q.BOTH),e.uniformMap.model_commandTranslucent=function(){return e.alphaOptions.pass===Ke.TRANSLUCENT}};const N2={MODIFY_MATERIAL:"MODIFY_MATERIAL",REPLACE_MATERIAL:"REPLACE_MATERIAL"};N2.getDefineName=function(e){return`CUSTOM_SHADER_${e}`};const F2=Object.freeze(N2),kue=`void customShaderStage(
    inout czm_modelVertexOutput vsOutput, 
    inout ProcessedAttributes attributes, 
    FeatureIds featureIds,
    Metadata metadata,
    MetadataClass metadataClass,
    MetadataStatistics metadataStatistics
) {
    // VertexInput and initializeInputStruct() are dynamically generated in JS, 
    // see CustomShaderPipelineStage.js
    VertexInput vsInput;
    initializeInputStruct(vsInput, attributes);
    vsInput.featureIds = featureIds;
    vsInput.metadata = metadata;
    vsInput.metadataClass = metadataClass;
    vsInput.metadataStatistics = metadataStatistics;
    vertexMain(vsInput, vsOutput);
    attributes.positionMC = vsOutput.positionMC;
}
`,jue=`void customShaderStage(
    inout czm_modelMaterial material,
    ProcessedAttributes attributes,
    FeatureIds featureIds,
    Metadata metadata,
    MetadataClass metadataClass,
    MetadataStatistics metadataStatistics
) {
    // FragmentInput and initializeInputStruct() are dynamically generated in JS, 
    // see CustomShaderPipelineStage.js
    FragmentInput fsInput;
    initializeInputStruct(fsInput, attributes);
    fsInput.featureIds = featureIds;
    fsInput.metadata = metadata;
    fsInput.metadataClass = metadataClass;
    fsInput.metadataStatistics = metadataStatistics;
    fragmentMain(fsInput, material);
}
`,Vue=`void featureIdStage(out FeatureIds featureIds, ProcessedAttributes attributes) {
  initializeFeatureIds(featureIds, attributes);
  initializeFeatureIdAliases(featureIds);
}
`,Gue=`void featureIdStage(out FeatureIds featureIds, ProcessedAttributes attributes) 
{
  initializeFeatureIds(featureIds, attributes);
  initializeFeatureIdAliases(featureIds);
  setFeatureIdVaryings();
}
`,Mt={name:"FeatureIdPipelineStage",STRUCT_ID_FEATURE_IDS_VS:"FeatureIdsVS",STRUCT_ID_FEATURE_IDS_FS:"FeatureIdsFS",STRUCT_NAME_FEATURE_IDS:"FeatureIds",FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS:"initializeFeatureIdsVS",FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS:"initializeFeatureIdsFS",FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_VS:"initializeFeatureIdAliasesVS",FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_FS:"initializeFeatureIdAliasesFS",FUNCTION_SIGNATURE_INITIALIZE_FEATURE_IDS:"void initializeFeatureIds(out FeatureIds featureIds, ProcessedAttributes attributes)",FUNCTION_SIGNATURE_INITIALIZE_FEATURE_ID_ALIASES:"void initializeFeatureIdAliases(inout FeatureIds featureIds)",FUNCTION_ID_SET_FEATURE_ID_VARYINGS:"setFeatureIdVaryings",FUNCTION_SIGNATURE_SET_FEATURE_ID_VARYINGS:"void setFeatureIdVaryings()"};Mt.process=function(e,t,n){const i=e.shaderBuilder;Hue(i);const r=e.runtimeNode.node.instances;l(r)&&que(e,r,n),Wue(e,t,n),i.addVertexLines(Gue),i.addFragmentLines(Vue)};function Hue(e){e.addStruct(Mt.STRUCT_ID_FEATURE_IDS_VS,Mt.STRUCT_NAME_FEATURE_IDS,Q.VERTEX),e.addStruct(Mt.STRUCT_ID_FEATURE_IDS_FS,Mt.STRUCT_NAME_FEATURE_IDS,Q.FRAGMENT),e.addFunction(Mt.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS,Mt.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_IDS,Q.VERTEX),e.addFunction(Mt.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,Mt.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_IDS,Q.FRAGMENT),e.addFunction(Mt.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_VS,Mt.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_ID_ALIASES,Q.VERTEX),e.addFunction(Mt.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_FS,Mt.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_ID_ALIASES,Q.FRAGMENT),e.addFunction(Mt.FUNCTION_ID_SET_FEATURE_ID_VARYINGS,Mt.FUNCTION_SIGNATURE_SET_FEATURE_ID_VARYINGS,Q.VERTEX)}function que(e,t,n){const i=t.featureIds,r=t.attributes[0].count;for(let s=0;s<i.length;s++){const o=i[s],a=o.positionalLabel;o instanceof Be.FeatureIdAttribute?$ue(e,o,a):B2(e,o,a,r,1,n);const c=o.label;l(c)&&z2(e,a,c,Q.BOTH)}}function Wue(e,t,n){const i=t.featureIds,s=je.getAttributeBySemantic(t,Me.POSITION).count;for(let o=0;o<i.length;o++){const a=i[o],c=a.positionalLabel;let u=Q.BOTH;a instanceof Be.FeatureIdAttribute?Xue(e,a,c):a instanceof Be.FeatureIdImplicitRange?B2(e,a,c,s,void 0,n):(Yue(e,a,c,o,n),u=Q.FRAGMENT);const h=a.label;l(h)&&z2(e,c,h,u)}}function $ue(e,t,n){const i=e.shaderBuilder;i.addStructField(Mt.STRUCT_ID_FEATURE_IDS_VS,"int",n),i.addStructField(Mt.STRUCT_ID_FEATURE_IDS_FS,"int",n);const r=t.setIndex,s=n.replace(/_\d+$/,"_"),o=`a_${s}${r}`,a=`v_${s}${r}`,c=`featureIds.${n} = int(czm_round(${o}));`,u=`featureIds.${n} = int(czm_round(${a}));`;i.addFunctionLines(Mt.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS,[c]),i.addFunctionLines(Mt.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,[u]),i.addVarying("float",a),i.addFunctionLines(Mt.FUNCTION_ID_SET_FEATURE_ID_VARYINGS,[`${a} = ${o};`])}function Xue(e,t,n){const i=e.shaderBuilder;i.addStructField(Mt.STRUCT_ID_FEATURE_IDS_VS,"int",n),i.addStructField(Mt.STRUCT_ID_FEATURE_IDS_FS,"int",n);const r=t.setIndex,s=n.replace(/_\d+$/,"_"),o=[`featureIds.${n} = int(czm_round(attributes.${s}${r}));`];i.addFunctionLines(Mt.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS,o),i.addFunctionLines(Mt.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,o)}function B2(e,t,n,i,r,s){Kue(e,t,i,r,s);const o=e.shaderBuilder,a=`a_implicit_${n}`;o.addAttribute("float",a);const c=`v_implicit_${n}`;o.addVarying("float",c),o.addStructField(Mt.STRUCT_ID_FEATURE_IDS_VS,"int",n),o.addStructField(Mt.STRUCT_ID_FEATURE_IDS_FS,"int",n),o.addFunctionLines(Mt.FUNCTION_ID_SET_FEATURE_ID_VARYINGS,[`${c} = ${a};`]),o.addFunctionLines(Mt.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS,[`featureIds.${n} = int(czm_round(${a}));`]),o.addFunctionLines(Mt.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,[`featureIds.${n} = int(czm_round(${c}));`])}function Yue(e,t,n,i,r){const s=`u_featureIdTexture_${i}`,o=e.uniformMap,a=t.textureReader;o[s]=function(){return T(a.texture,r.context.defaultTexture)};const c=a.channels,u=e.shaderBuilder;u.addStructField(Mt.STRUCT_ID_FEATURE_IDS_FS,"int",n),u.addUniform("sampler2D",s,Q.FRAGMENT);const d=`v_texCoord_${a.texCoord}`;let p=d;const g=a.transform;if(l(g)&&!H.equals(g,H.IDENTITY)){const x=`${s}Transform`;u.addUniform("mat3",x,Q.FRAGMENT),o[x]=function(){return g},p=`vec2(${x} * vec3(${d}, 1.0))`}const _=`texture(${s}, ${p}).${c}`,b=`featureIds.${n} = czm_unpackUint(${_});`;u.addFunctionLines(Mt.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,[b])}function z2(e,t,n,i){const r=e.shaderBuilder,s=Q.includesVertexShader(i);s&&r.addStructField(Mt.STRUCT_ID_FEATURE_IDS_VS,"int",n),r.addStructField(Mt.STRUCT_ID_FEATURE_IDS_FS,"int",n);const o=[`featureIds.${n} = featureIds.${t};`];s&&r.addFunctionLines(Mt.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_VS,o),r.addFunctionLines(Mt.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_FS,o)}function Kue(e,t,n,i,r){const s=e.model;let o,a;if(l(t.repeat)){const u=Zue(t,n);o=ze.createVertexBuffer({context:r.context,typedArray:u,usage:Ae.STATIC_DRAW}),o.vertexArrayDestroyable=!1,s._pipelineResources.push(o),s.statistics.addBuffer(o,!1)}else a=[t.offset];const c={index:e.attributeIndex++,instanceDivisor:i,value:a,vertexBuffer:o,normalize:!1,componentsPerAttribute:1,componentDatatype:q.FLOAT,strideInBytes:q.getSizeInBytes(q.FLOAT),offsetInBytes:0};e.attributes.push(c)}function Zue(e,t){const n=e.offset,i=e.repeat,r=new Float32Array(t);for(let s=0;s<t;s++)r[s]=n+Math.floor(s/i);return r}const Jue=`void metadataStage(
  out Metadata metadata,
  out MetadataClass metadataClass,
  out MetadataStatistics metadataStatistics,
  ProcessedAttributes attributes
  )
{
  initializeMetadata(metadata, metadataClass, metadataStatistics, attributes);
}
`,Que=`void metadataStage(
  out Metadata metadata,
  out MetadataClass metadataClass,
  out MetadataStatistics metadataStatistics,
  ProcessedAttributes attributes
  )
{
  initializeMetadata(metadata, metadataClass, metadataStatistics, attributes);
  setMetadataVaryings();
}
`,dt={name:"MetadataPipelineStage",STRUCT_ID_METADATA_VS:"MetadataVS",STRUCT_ID_METADATA_FS:"MetadataFS",STRUCT_NAME_METADATA:"Metadata",STRUCT_ID_METADATA_CLASS_VS:"MetadataClassVS",STRUCT_ID_METADATA_CLASS_FS:"MetadataClassFS",STRUCT_NAME_METADATA_CLASS:"MetadataClass",STRUCT_ID_METADATA_STATISTICS_VS:"MetadataStatisticsVS",STRUCT_ID_METADATA_STATISTICS_FS:"MetadataStatisticsFS",STRUCT_NAME_METADATA_STATISTICS:"MetadataStatistics",FUNCTION_ID_INITIALIZE_METADATA_VS:"initializeMetadataVS",FUNCTION_ID_INITIALIZE_METADATA_FS:"initializeMetadataFS",FUNCTION_SIGNATURE_INITIALIZE_METADATA:"void initializeMetadata(out Metadata metadata, out MetadataClass metadataClass, out MetadataStatistics metadataStatistics, ProcessedAttributes attributes)",FUNCTION_ID_SET_METADATA_VARYINGS:"setMetadataVaryings",FUNCTION_SIGNATURE_SET_METADATA_VARYINGS:"void setMetadataVaryings()",METADATA_CLASS_FIELDS:[{specName:"noData",shaderName:"noData"},{specName:"default",shaderName:"defaultValue"},{specName:"min",shaderName:"minValue"},{specName:"max",shaderName:"maxValue"}],METADATA_STATISTICS_FIELDS:[{specName:"min",shaderName:"minValue"},{specName:"max",shaderName:"maxValue"},{specName:"mean",shaderName:"mean",type:"float"},{specName:"median",shaderName:"median"},{specName:"standardDeviation",shaderName:"standardDeviation",type:"float"},{specName:"variance",shaderName:"variance",type:"float"},{specName:"sum",shaderName:"sum"}]};dt.process=function(e,t,n){var d;const{shaderBuilder:i,model:r}=e,{structuralMetadata:s={},content:o}=r,a=(d=o==null?void 0:o.tileset.metadataExtension)==null?void 0:d.statistics,c=efe(s.propertyAttributes,t,a),u=nfe(s.propertyTextures,a),h=c.concat(u);rfe(i,h),afe(i),i.addVertexLines(Que),i.addFragmentLines(Jue);for(let p=0;p<c.length;p++){const g=c[p];cfe(e,g)}for(let p=0;p<u.length;p++){const g=u[p];ufe(e,g)}};function efe(e,t,n){return l(e)?e.flatMap(i=>tfe(i,t,n)):[]}function tfe(e,t,n){const{getAttributeByName:i,getAttributeInfo:r,sanitizeGlslIdentifier:s}=je,o=e.class.id,a=n==null?void 0:n.classes[o],c=Object.entries(e.properties),u=new Array(c.length);for(let h=0;h<c.length;h++){const[d,p]=c[h],g=i(t,p.attribute),{glslType:_,variableName:b}=r(g);u[h]={metadataVariable:s(d),property:p,type:p.classProperty.type,glslType:_,variableName:b,propertyStatistics:a==null?void 0:a.properties[d],shaderDestination:Q.BOTH}}return u}function nfe(e,t){return l(e)?e.flatMap(n=>ife(n,t)):[]}function ife(e,t){const{sanitizeGlslIdentifier:n}=je,i=e.class.id,r=t==null?void 0:t.classes[i],s=Object.entries(e.properties).filter(([a,c])=>c.isGpuCompatible()),o=new Array(s.length);for(let a=0;a<s.length;a++){const[c,u]=s[a];o[a]={metadataVariable:n(c),property:u,type:u.classProperty.type,glslType:u.getGlslType(),propertyStatistics:r==null?void 0:r.properties[c],shaderDestination:Q.FRAGMENT}}return o}function rfe(e,t){const n=new Set,i=new Set;for(let a=0;a<t.length;a++){const{type:c,glslType:u,propertyStatistics:h}=t[a];n.add(u),l(h)&&c!==at.ENUM&&i.add(u)}const r=dt.METADATA_CLASS_FIELDS;for(const a of n){const c=`${a}MetadataClass`;o(c,a,r)}const s=dt.METADATA_STATISTICS_FIELDS;for(const a of i){const c=`${a}MetadataStatistics`;o(c,a,s)}function o(a,c,u){e.addStruct(a,a,Q.BOTH);for(let h=0;h<u.length;h++){const{shaderName:d}=u[h],p=u[h].type==="float"?ofe(c):c;e.addStructField(a,p,d)}}}const sfe={int:"float",ivec2:"vec2",ivec3:"vec3",ivec4:"vec4"};function ofe(e){const t=sfe[e];return l(t)?t:e}function afe(e){e.addStruct(dt.STRUCT_ID_METADATA_VS,dt.STRUCT_NAME_METADATA,Q.VERTEX),e.addStruct(dt.STRUCT_ID_METADATA_FS,dt.STRUCT_NAME_METADATA,Q.FRAGMENT),e.addStruct(dt.STRUCT_ID_METADATA_CLASS_VS,dt.STRUCT_NAME_METADATA_CLASS,Q.VERTEX),e.addStruct(dt.STRUCT_ID_METADATA_CLASS_FS,dt.STRUCT_NAME_METADATA_CLASS,Q.FRAGMENT),e.addStruct(dt.STRUCT_ID_METADATA_STATISTICS_VS,dt.STRUCT_NAME_METADATA_STATISTICS,Q.VERTEX),e.addStruct(dt.STRUCT_ID_METADATA_STATISTICS_FS,dt.STRUCT_NAME_METADATA_STATISTICS,Q.FRAGMENT),e.addFunction(dt.FUNCTION_ID_INITIALIZE_METADATA_VS,dt.FUNCTION_SIGNATURE_INITIALIZE_METADATA,Q.VERTEX),e.addFunction(dt.FUNCTION_ID_INITIALIZE_METADATA_FS,dt.FUNCTION_SIGNATURE_INITIALIZE_METADATA,Q.FRAGMENT),e.addFunction(dt.FUNCTION_ID_SET_METADATA_VARYINGS,dt.FUNCTION_SIGNATURE_SET_METADATA_VARYINGS,Q.VERTEX)}function cfe(e,t){lfe(e,t),U2(e.shaderBuilder,t),k2(e.shaderBuilder,t)}function lfe(e,t){const{shaderBuilder:n}=e,{metadataVariable:i,property:r,glslType:s}=t,o=V2({valueExpression:`attributes.${t.variableName}`,renderResources:e,glslType:s,metadataVariable:i,shaderDestination:Q.BOTH,property:r});n.addStructField(dt.STRUCT_ID_METADATA_VS,s,i),n.addStructField(dt.STRUCT_ID_METADATA_FS,s,i);const a=`metadata.${i} = ${o};`;n.addFunctionLines(dt.FUNCTION_ID_INITIALIZE_METADATA_VS,[a]),n.addFunctionLines(dt.FUNCTION_ID_INITIALIZE_METADATA_FS,[a])}function ufe(e,t){ffe(e,t),U2(e.shaderBuilder,t),k2(e.shaderBuilder,t)}function ffe(e,t){const{shaderBuilder:n,uniformMap:i}=e,{metadataVariable:r,glslType:s,property:o}=t,{texCoord:a,channels:c,index:u,texture:h,transform:d}=o.textureReader,p=`u_propertyTexture_${u}`;i.hasOwnProperty(p)||(n.addUniform("sampler2D",p,Q.FRAGMENT),i[p]=()=>h),n.addStructField(dt.STRUCT_ID_METADATA_FS,s,r);const g=`attributes.texCoord_${a}`;let _=g;if(l(d)&&!H.equals(d,H.IDENTITY)){const w=`${p}Transform`;n.addUniform("mat3",w,Q.FRAGMENT),i[w]=function(){return d},_=`vec2(${w} * vec3(${g}, 1.0))`}const b=`texture(${p}, ${_}).${c}`,x=o.unpackInShader(b),E=V2({valueExpression:x,renderResources:e,glslType:s,metadataVariable:r,shaderDestination:Q.FRAGMENT,property:o}),C=`metadata.${r} = ${E};`;n.addFunctionLines(dt.FUNCTION_ID_INITIALIZE_METADATA_FS,[C])}function U2(e,t){const{classProperty:n}=t.property,{metadataVariable:i,glslType:r,shaderDestination:s}=t,o=j2(dt.METADATA_CLASS_FIELDS,n,`metadataClass.${i}`,r),a=`${r}MetadataClass`;e.addStructField(dt.STRUCT_ID_METADATA_CLASS_FS,a,i),e.addFunctionLines(dt.FUNCTION_ID_INITIALIZE_METADATA_FS,o),Q.includesVertexShader(s)&&(e.addStructField(dt.STRUCT_ID_METADATA_CLASS_VS,a,i),e.addFunctionLines(dt.FUNCTION_ID_INITIALIZE_METADATA_VS,o))}function k2(e,t){const{propertyStatistics:n}=t;if(!l(n))return;const{metadataVariable:i,type:r,glslType:s}=t;if(r===at.ENUM)return;const o=dt.METADATA_STATISTICS_FIELDS,a=`metadataStatistics.${i}`,c=j2(o,n,a,s),u=`${s}MetadataStatistics`;e.addStructField(dt.STRUCT_ID_METADATA_STATISTICS_FS,u,i),e.addFunctionLines(dt.FUNCTION_ID_INITIALIZE_METADATA_FS,c),Q.includesVertexShader(t.shaderDestination)&&(e.addStructField(dt.STRUCT_ID_METADATA_STATISTICS_VS,u,i),e.addFunctionLines(dt.FUNCTION_ID_INITIALIZE_METADATA_VS,c))}function j2(e,t,n,i){function r(s){const o=t[s.specName];if(l(o))return`${n}.${s.shaderName} = ${i}(${o});`}return l(t)?e.map(r).filter(l):[]}function V2(e){const{valueExpression:t,property:n}=e;if(!n.hasValueTransform)return t;const i=e.metadataVariable,r=`u_${i}_offset`,s=`u_${i}_scale`,{shaderBuilder:o,uniformMap:a}=e.renderResources,{glslType:c,shaderDestination:u}=e;o.addUniform(c,r,u),o.addUniform(c,s,u);const{offset:h,scale:d}=n;return a[r]=()=>h,a[s]=()=>d,`czm_valueTransform(${r}, ${s}, ${t})`}const hfe={INHERIT:0,OPAQUE:1,TRANSLUCENT:2},$1=Object.freeze(hfe),Vi={name:"CustomShaderPipelineStage",STRUCT_ID_ATTRIBUTES_VS:"AttributesVS",STRUCT_ID_ATTRIBUTES_FS:"AttributesFS",STRUCT_NAME_ATTRIBUTES:"Attributes",STRUCT_ID_VERTEX_INPUT:"VertexInput",STRUCT_NAME_VERTEX_INPUT:"VertexInput",STRUCT_ID_FRAGMENT_INPUT:"FragmentInput",STRUCT_NAME_FRAGMENT_INPUT:"FragmentInput",FUNCTION_ID_INITIALIZE_INPUT_STRUCT_VS:"initializeInputStructVS",FUNCTION_SIGNATURE_INITIALIZE_INPUT_STRUCT_VS:"void initializeInputStruct(out VertexInput vsInput, ProcessedAttributes attributes)",FUNCTION_ID_INITIALIZE_INPUT_STRUCT_FS:"initializeInputStructFS",FUNCTION_SIGNATURE_INITIALIZE_INPUT_STRUCT_FS:"void initializeInputStruct(out FragmentInput fsInput, ProcessedAttributes attributes)",_oneTimeWarning:kr};Vi.process=function(e,t,n){const{shaderBuilder:i,model:r,alphaOptions:s}=e,{customShader:o}=r,{lightingModel:a,translucencyMode:c}=o;l(a)&&(e.lightingOptions.lightingModel=a),c===$1.TRANSLUCENT?s.pass=Ke.TRANSLUCENT:c===$1.OPAQUE&&(s.pass=void 0);const u=Tfe(o,t);if(!u.customShaderEnabled)return;if(wfe(i,o,u),u.shouldComputePositionWC&&i.addDefine("COMPUTE_POSITION_WC_CUSTOM_SHADER",void 0,Q.BOTH),l(o.vertexShaderText)&&i.addDefine("HAS_CUSTOM_VERTEX_SHADER",void 0,Q.VERTEX),l(o.fragmentShaderText)){i.addDefine("HAS_CUSTOM_FRAGMENT_SHADER",void 0,Q.FRAGMENT);const p=F2.getDefineName(o.mode);i.addDefine(p,void 0,Q.FRAGMENT)}const h=o.uniforms;for(const p in h)if(h.hasOwnProperty(p)){const g=h[p];i.addUniform(g.type,p)}const d=o.varyings;for(const p in d)if(d.hasOwnProperty(p)){const g=d[p];i.addVarying(g,p)}e.uniformMap=wt(e.uniformMap,o.uniformMap)};function dfe(e){const t={};for(let n=0;n<e.length;n++){const i=je.getAttributeInfo(e[n]);t[i.variableName]=i}return t}const pfe={position:"vec3",normal:"vec3",tangent:"vec3",bitangent:"vec3",texCoord:"vec2",color:"vec4",joints:"ivec4",weights:"vec4"},mfe={position:"vec3(0.0)",normal:"vec3(0.0, 0.0, 1.0)",tangent:"vec3(1.0, 0.0, 0.0)",bitangent:"vec3(0.0, 1.0, 0.0)",texCoord:"vec2(0.0)",color:"vec4(1.0)",joints:"ivec4(0)",weights:"vec4(0.0)"};function G2(e){let t=e.replace(/_[0-9]+$/,"");t=t.replace(/(MC|EC)$/,"");const n=pfe[t],i=mfe[t];if(l(n))return{attributeField:[n,e],value:i}}function gfe(e,t){if(!l(e.vertexShaderText))return{enabled:!1};const n=e.usedVariablesVertex.attributeSet,i=H2(t,n,!1),r=q2(t,n,!1);let s;const o=[],a=[];for(const c in i){if(!i.hasOwnProperty(c))continue;const h=[i[c].glslType,c];o.push(h),s=`vsInput.attributes.${c} = attributes.${c};`,a.push(s)}for(let c=0;c<r.length;c++){const u=r[c],h=G2(u);if(!l(h))return Vi._oneTimeWarning("CustomShaderPipelineStage.incompatiblePrimitiveVS",`Primitive is missing attribute ${u}, disabling custom vertex shader`),{enabled:!1};o.push(h.attributeField),s=`vsInput.attributes.${u} = ${h.value};`,a.push(s)}return{enabled:!0,attributeFields:o,initializationLines:a}}function _fe(e){const t=[],n=[],i=e.usedVariablesFragment.attributeSet;return i.hasOwnProperty("positionWC")&&(t.push(["vec3","positionWC"]),n.push("fsInput.attributes.positionWC = attributes.positionWC;")),i.hasOwnProperty("positionEC")&&(t.push(["vec3","positionEC"]),n.push("fsInput.attributes.positionEC = attributes.positionEC;")),{attributeFields:t,initializationLines:n}}function yfe(e,t){if(!l(e.fragmentShaderText))return{enabled:!1};const n=e.usedVariablesFragment.attributeSet,i=H2(t,n,!0),r=q2(t,n,!0);let s;const o=[],a=[];for(const u in i){if(!i.hasOwnProperty(u))continue;const d=[i[u].glslType,u];o.push(d),s=`fsInput.attributes.${u} = attributes.${u};`,a.push(s)}for(let u=0;u<r.length;u++){const h=r[u],d=G2(h);if(!l(d))return Vi._oneTimeWarning("CustomShaderPipelineStage.incompatiblePrimitiveFS",`Primitive is missing attribute ${h}, disabling custom fragment shader.`),{enabled:!1};o.push(d.attributeField),s=`fsInput.attributes.${h} = ${d.value};`,a.push(s)}const c=_fe(e);return{enabled:!0,attributeFields:o.concat(c.attributeFields),initializationLines:c.initializationLines.concat(a)}}const bfe={positionWC:!0,positionEC:!0};function H2(e,t,n){const i={};for(const r in e){if(!e.hasOwnProperty(r))continue;const s=e[r];let o=r;n&&r==="normalMC"?o="normalEC":n&&r==="tangentMC"&&(o="tangentEC",s.glslType="vec3"),t.hasOwnProperty(o)&&(i[o]=s)}return i}function q2(e,t,n){const i=[];for(const r in t){if(!t.hasOwnProperty(r)||bfe.hasOwnProperty(r))continue;let s=r;n&&r==="normalEC"?s="normalMC":n&&r==="tangentEC"&&(s="tangentMC"),e.hasOwnProperty(s)||i.push(r)}return i}function Tfe(e,t){const n=dfe(t.attributes),i=gfe(e,n),r=yfe(e,n),o=e.usedVariablesFragment.attributeSet.hasOwnProperty("positionWC")&&r.enabled;return{vertexLines:i,fragmentLines:r,customShaderEnabled:i.enabled||r.enabled,shouldComputePositionWC:o}}function xfe(e,t){let n=Vi.STRUCT_ID_ATTRIBUTES_VS;e.addStruct(n,Vi.STRUCT_NAME_ATTRIBUTES,Q.VERTEX);const{attributeFields:i,initializationLines:r}=t;for(let o=0;o<i.length;o++){const[a,c]=i[o];e.addStructField(n,a,c)}n=Vi.STRUCT_ID_VERTEX_INPUT,e.addStruct(n,Vi.STRUCT_NAME_VERTEX_INPUT,Q.VERTEX),e.addStructField(n,Vi.STRUCT_NAME_ATTRIBUTES,"attributes"),e.addStructField(n,Mt.STRUCT_NAME_FEATURE_IDS,"featureIds"),e.addStructField(n,dt.STRUCT_NAME_METADATA,"metadata"),e.addStructField(n,dt.STRUCT_NAME_METADATA_CLASS,"metadataClass"),e.addStructField(n,dt.STRUCT_NAME_METADATA_STATISTICS,"metadataStatistics");const s=Vi.FUNCTION_ID_INITIALIZE_INPUT_STRUCT_VS;e.addFunction(s,Vi.FUNCTION_SIGNATURE_INITIALIZE_INPUT_STRUCT_VS,Q.VERTEX),e.addFunctionLines(s,r)}function Efe(e,t){let n=Vi.STRUCT_ID_ATTRIBUTES_FS;e.addStruct(n,Vi.STRUCT_NAME_ATTRIBUTES,Q.FRAGMENT);const{attributeFields:i,initializationLines:r}=t;for(let o=0;o<i.length;o++){const[a,c]=i[o];e.addStructField(n,a,c)}n=Vi.STRUCT_ID_FRAGMENT_INPUT,e.addStruct(n,Vi.STRUCT_NAME_FRAGMENT_INPUT,Q.FRAGMENT),e.addStructField(n,Vi.STRUCT_NAME_ATTRIBUTES,"attributes"),e.addStructField(n,Mt.STRUCT_NAME_FEATURE_IDS,"featureIds"),e.addStructField(n,dt.STRUCT_NAME_METADATA,"metadata"),e.addStructField(n,dt.STRUCT_NAME_METADATA_CLASS,"metadataClass"),e.addStructField(n,dt.STRUCT_NAME_METADATA_STATISTICS,"metadataStatistics");const s=Vi.FUNCTION_ID_INITIALIZE_INPUT_STRUCT_FS;e.addFunction(s,Vi.FUNCTION_SIGNATURE_INITIALIZE_INPUT_STRUCT_FS,Q.FRAGMENT),e.addFunctionLines(s,r)}const Cfe=[];function wfe(e,t,n){const{vertexLines:i,fragmentLines:r}=n,s=Cfe;i.enabled&&(xfe(e,i),s.length=0,s.push("#line 0",t.vertexShaderText,kue),e.addVertexLines(s)),r.enabled&&(Efe(e,r),s.length=0,s.push("#line 0",t.fragmentShaderText,jue),e.addFragmentLines(s))}const tp={name:"DequantizationPipelineStage",FUNCTION_ID_DEQUANTIZATION_STAGE_VS:"dequantizationStage",FUNCTION_SIGNATURE_DEQUANTIZATION_STAGE_VS:"void dequantizationStage(inout ProcessedAttributes attributes)"};tp.process=function(e,t,n){const i=e.shaderBuilder,r=e.model,s=l(r.classificationType);i.addDefine("USE_DEQUANTIZATION",void 0,Q.VERTEX),i.addFunction(tp.FUNCTION_ID_DEQUANTIZATION_STAGE_VS,tp.FUNCTION_SIGNATURE_DEQUANTIZATION_STAGE_VS,Q.VERTEX);const o=t.attributes;for(let a=0;a<o.length;a++){const c=o[a],u=c.quantization;if(!l(u))continue;const h=c.semantic===Me.POSITION,d=c.semantic===Me.TEXCOORD;if(s&&!h&&!d)continue;const p=je.getAttributeInfo(c);Sfe(i,p),Afe(e,p)}};function Afe(e,t){const n=e.shaderBuilder,i=e.uniformMap,r=t.variableName,s=t.attribute.quantization;if(s.octEncoded){const o=`model_normalizationRange_${r}`;n.addUniform("float",o,Q.VERTEX),i[o]=function(){return s.normalizationRange}}else{const o=`model_quantizedVolumeOffset_${r}`,a=`model_quantizedVolumeStepSize_${r}`,c=t.glslType;n.addUniform(c,o,Q.VERTEX),n.addUniform(c,a,Q.VERTEX);let u=s.quantizedVolumeOffset,h=s.quantizedVolumeStepSize;/^color_\d+$/.test(r)&&(u=X1(u,0),h=X1(h,1)),i[o]=function(){return u},i[a]=function(){return h}}}function X1(e,t){return e instanceof Y?e:new Y(e.x,e.y,e.z,t)}function Sfe(e,t){const n=t.variableName,i=t.attribute.quantization;let r;i.octEncoded?r=vfe(n,i):r=Ife(n),e.addFunctionLines(tp.FUNCTION_ID_DEQUANTIZATION_STAGE_VS,[r])}function vfe(e,t){const n=`attributes.${e}`,i=`a_quantized_${e}`,r=`model_normalizationRange_${e}`,s=t.octEncodedZXY?".zxy":".xyz";return`${n} = czm_octDecode(${i}, ${r})${s};`}function Ife(e){const t=`attributes.${e}`,n=`a_quantized_${e}`,i=`model_quantizedVolumeOffset_${e}`,r=`model_quantizedVolumeStepSize_${e}`;return`${t} = ${i} + ${n} * ${r};`}const Ofe=`void geometryStage(out ProcessedAttributes attributes)
{
  attributes.positionMC = v_positionMC;
  attributes.positionEC = v_positionEC;

  #if defined(COMPUTE_POSITION_WC_CUSTOM_SHADER) || defined(COMPUTE_POSITION_WC_STYLE) || defined(COMPUTE_POSITION_WC_ATMOSPHERE)
  attributes.positionWC = v_positionWC;
  #endif

  #ifdef HAS_NORMALS
  // renormalize after interpolation
  attributes.normalEC = normalize(v_normalEC);
  #endif

  #ifdef HAS_TANGENTS
  attributes.tangentEC = normalize(v_tangentEC);
  #endif

  #ifdef HAS_BITANGENTS
  attributes.bitangentEC = normalize(v_bitangentEC);
  #endif

  // Everything else is dynamically generated in GeometryPipelineStage
  setDynamicVaryings(attributes);
}
`,Rfe=`vec4 geometryStage(inout ProcessedAttributes attributes, mat4 modelView, mat3 normal)
{
    vec4 computedPosition;

    // Compute positions in different coordinate systems
    vec3 positionMC = attributes.positionMC;
    v_positionMC = positionMC;
    v_positionEC = (modelView * vec4(positionMC, 1.0)).xyz;

    #if defined(USE_2D_POSITIONS) || defined(USE_2D_INSTANCING)
    vec3 position2D = attributes.position2D;
    vec3 positionEC = (u_modelView2D * vec4(position2D, 1.0)).xyz;
    computedPosition = czm_projection * vec4(positionEC, 1.0);
    #else
    computedPosition = czm_projection * vec4(v_positionEC, 1.0);
    #endif

    // Sometimes the custom shader and/or style needs this
    #if defined(COMPUTE_POSITION_WC_CUSTOM_SHADER) || defined(COMPUTE_POSITION_WC_STYLE) || defined(COMPUTE_POSITION_WC_ATMOSPHERE) || defined(ENABLE_CLIPPING_POLYGONS)
    // Note that this is a 32-bit position which may result in jitter on small
    // scales.
    v_positionWC = (czm_model * vec4(positionMC, 1.0)).xyz;
    #endif

    #ifdef HAS_NORMALS
    v_normalEC = normalize(normal * attributes.normalMC);
    #endif

    #ifdef HAS_TANGENTS
    v_tangentEC = normalize(normal * attributes.tangentMC);
    #endif

    #ifdef HAS_BITANGENTS
    v_bitangentEC = normalize(normal * attributes.bitangentMC);
    #endif

    // All other varyings need to be dynamically generated in
    // GeometryPipelineStage
    setDynamicVaryings(attributes);

    return computedPosition;
}
`,Y1=`vec2 computeSt(float featureId)
{
    float stepX = model_textureStep.x;
    float centerX = model_textureStep.y;

    #ifdef MULTILINE_BATCH_TEXTURE
    float stepY = model_textureStep.z;
    float centerY = model_textureStep.w;

    float xId = mod(featureId, model_textureDimensions.x); 
    float yId = floor(featureId / model_textureDimensions.x);
    
    return vec2(centerX + (xId * stepX), centerY + (yId * stepY));
    #else
    return vec2(centerX + (featureId * stepX), 0.5);
    #endif
}

void selectedFeatureIdStage(out SelectedFeature feature, FeatureIds featureIds)
{   
    int featureId = featureIds.SELECTED_FEATURE_ID;


    if (featureId < model_featuresLength)
    {
        vec2 featureSt = computeSt(float(featureId));

        feature.id = featureId;
        feature.st = featureSt;
        feature.color = texture(model_batchTexture, featureSt);
    }
    // Floating point comparisons can be unreliable in GLSL, so we
    // increment the feature ID to make sure it's always greater
    // then the model_featuresLength - a condition we check for in the
    // pick ID, to avoid sampling the pick texture if the feature ID is
    // greater than the number of features.
    else
    {
        feature.id = model_featuresLength + 1;
        feature.st = vec2(0.0);
        feature.color = vec4(1.0);
    }

    #ifdef HAS_NULL_FEATURE_ID
    if (featureId == model_nullFeatureId) {
        feature.id = featureId;
        feature.st = vec2(0.0);
        feature.color = vec4(1.0);
    }
    #endif
}
`,Eu={name:"SelectedFeatureIdPipelineStage",STRUCT_ID_SELECTED_FEATURE:"SelectedFeature",STRUCT_NAME_SELECTED_FEATURE:"SelectedFeature",FUNCTION_ID_FEATURE_VARYINGS_VS:"updateFeatureStructVS",FUNCTION_ID_FEATURE_VARYINGS_FS:"updateFeatureStructFS",FUNCTION_SIGNATURE_UPDATE_FEATURE:"void updateFeatureStruct(inout SelectedFeature feature)"};Eu.process=function(e,t,n){const i=e.shaderBuilder;e.hasPropertyTable=!0;const r=e.model,s=e.runtimeNode.node,o=Dfe(r,s,t),a=o.shaderDestination;i.addDefine("HAS_SELECTED_FEATURE_ID",void 0,a),i.addDefine("SELECTED_FEATURE_ID",o.variableName,a),i.addDefine(o.featureIdDefine,void 0,a),Mfe(i);const c=o.featureIds.nullFeatureId,u=e.uniformMap;l(c)&&(i.addDefine("HAS_NULL_FEATURE_ID",void 0,a),i.addUniform("int","model_nullFeatureId",a),u.model_nullFeatureId=function(){return c}),o.shaderDestination===Q.BOTH&&i.addVertexLines(Y1),i.addFragmentLines(Y1)};function K1(e){return e instanceof Be.FeatureIdTexture?"HAS_SELECTED_FEATURE_ID_TEXTURE":"HAS_SELECTED_FEATURE_ID_ATTRIBUTE"}function Z1(e){return e instanceof Be.FeatureIdTexture?Q.FRAGMENT:Q.BOTH}function Dfe(e,t,n){let i,r;return l(t.instances)&&(r=je.getFeatureIdsByLabel(t.instances.featureIds,e.instanceFeatureIdLabel),l(r))?(i=T(r.label,r.positionalLabel),{featureIds:r,variableName:i,shaderDestination:Z1(r),featureIdDefine:K1(r)}):(r=je.getFeatureIdsByLabel(n.featureIds,e.featureIdLabel),i=T(r.label,r.positionalLabel),{featureIds:r,variableName:i,shaderDestination:Z1(r),featureIdDefine:K1(r)})}function Mfe(e){e.addStructField(Eu.STRUCT_ID_SELECTED_FEATURE,"int","id"),e.addStructField(Eu.STRUCT_ID_SELECTED_FEATURE,"vec2","st"),e.addStructField(Eu.STRUCT_ID_SELECTED_FEATURE,"vec4","color")}const Ii={name:"GeometryPipelineStage",STRUCT_ID_PROCESSED_ATTRIBUTES_VS:"ProcessedAttributesVS",STRUCT_ID_PROCESSED_ATTRIBUTES_FS:"ProcessedAttributesFS",STRUCT_NAME_PROCESSED_ATTRIBUTES:"ProcessedAttributes",FUNCTION_ID_INITIALIZE_ATTRIBUTES:"initializeAttributes",FUNCTION_SIGNATURE_INITIALIZE_ATTRIBUTES:"void initializeAttributes(out ProcessedAttributes attributes)",FUNCTION_ID_SET_DYNAMIC_VARYINGS_VS:"setDynamicVaryingsVS",FUNCTION_ID_SET_DYNAMIC_VARYINGS_FS:"setDynamicVaryingsFS",FUNCTION_SIGNATURE_SET_DYNAMIC_VARYINGS:"void setDynamicVaryings(inout ProcessedAttributes attributes)"};Ii.process=function(e,t,n){const{shaderBuilder:i,model:r}=e;i.addStruct(Ii.STRUCT_ID_PROCESSED_ATTRIBUTES_VS,"ProcessedAttributes",Q.VERTEX),i.addStruct(Ii.STRUCT_ID_PROCESSED_ATTRIBUTES_FS,"ProcessedAttributes",Q.FRAGMENT),i.addStruct(Eu.STRUCT_ID_SELECTED_FEATURE,Eu.STRUCT_NAME_SELECTED_FEATURE,Q.BOTH),i.addFunction(Ii.FUNCTION_ID_INITIALIZE_ATTRIBUTES,Ii.FUNCTION_SIGNATURE_INITIALIZE_ATTRIBUTES,Q.VERTEX),i.addVarying("vec3","v_positionWC"),i.addVarying("vec3","v_positionEC"),i.addStructField(Ii.STRUCT_ID_PROCESSED_ATTRIBUTES_FS,"vec3","positionWC"),i.addStructField(Ii.STRUCT_ID_PROCESSED_ATTRIBUTES_FS,"vec3","positionEC"),i.addFunction(Ii.FUNCTION_ID_SET_DYNAMIC_VARYINGS_VS,Ii.FUNCTION_SIGNATURE_SET_DYNAMIC_VARYINGS,Q.VERTEX),i.addFunction(Ii.FUNCTION_ID_SET_DYNAMIC_VARYINGS_FS,Ii.FUNCTION_SIGNATURE_SET_DYNAMIC_VARYINGS,Q.FRAGMENT),r.type===Or.TILE_PNTS&&i.addDefine("HAS_SRGB_COLOR",void 0,Q.FRAGMENT);const s=n.mode!==Ie.SCENE3D&&!n.scene3DOnly&&r._projectTo2D,o=l(e.runtimeNode.node.instances),a=s&&!o,c=t.attributes.length;for(let u=0;u<c;u++){const h=t.attributes[u],d=tt.getAttributeLocationCount(h.type);if(!l(h.buffer)&&!l(h.constant))throw new A("Attributes must be provided as a Buffer or constant value");const p=h.semantic===Me.POSITION;let g;d>1?(g=e.attributeIndex,e.attributeIndex+=d):p&&!a?g=0:g=e.attributeIndex++,Lfe(e,h,g,d,s,o)}Vfe(i,t.attributes),t.primitiveType===Fe.POINTS&&i.addDefine("PRIMITIVE_TYPE_POINTS"),i.addVertexLines(Rfe),i.addFragmentLines(Ofe)};function Lfe(e,t,n,i,r,s){const o=e.shaderBuilder,a=je.getAttributeInfo(t),c=r&&!s;i>1?Ffe(e,t,n,i):Nfe(e,t,n,c),zfe(o,a,c),Bfe(o,a),l(t.semantic)&&Pfe(o,t),Ufe(o,a,r),kfe(o,a,c),jfe(o,a)}function Pfe(e,t){const{semantic:n,setIndex:i}=t;switch(n){case Me.NORMAL:e.addDefine("HAS_NORMALS");break;case Me.TANGENT:e.addDefine("HAS_TANGENTS");break;case Me.FEATURE_ID:e.addDefine(`HAS${n}_${i}`);break;case Me.TEXCOORD:case Me.COLOR:e.addDefine(`HAS_${n}_${i}`)}}function Nfe(e,t,n,i){const{quantization:r,semantic:s,setIndex:o}=t,{type:a,componentDatatype:c}=l(r)?r:t;s===Me.FEATURE_ID&&o>=e.featureIdVertexAttributeSetIndex&&(e.featureIdVertexAttributeSetIndex=o+1);const u=s===Me.POSITION,h=u?0:n,d=tt.getNumberOfComponents(a),p={index:h,value:l(t.buffer)?void 0:t.constant,vertexBuffer:t.buffer,count:t.count,componentsPerAttribute:d,componentDatatype:c,offsetInBytes:t.byteOffset,strideInBytes:t.byteStride,normalize:t.normalized};if(e.attributes.push(p),!u||!i)return;const g=e.runtimePrimitive.positionBuffer2D,_={index:n,vertexBuffer:g,count:t.count,componentsPerAttribute:d,componentDatatype:q.FLOAT,offsetInBytes:0,strideInBytes:void 0,normalize:t.normalized};e.attributes.push(_)}function Ffe(e,t,n,i){const{quantization:r,normalized:s}=t,{type:o,componentDatatype:a}=l(r)?r:t,u=tt.getNumberOfComponents(o)/i,h=q.getSizeInBytes(a),d=u*h,p=t.byteStride;for(let g=0;g<i;g++){const _=t.byteOffset+g*d,b={index:n+g,vertexBuffer:t.buffer,componentsPerAttribute:u,componentDatatype:a,offsetInBytes:_,strideInBytes:p,normalize:s};e.attributes.push(b)}}function Bfe(e,t){const n=t.variableName;let i=`v_${n}`,r;n==="normalMC"?(i="v_normalEC",r=t.glslType):n==="tangentMC"?(r="vec3",i="v_tangentEC"):r=t.glslType,e.addVarying(r,i)}function zfe(e,t,n){const i=t.attribute.semantic,r=t.variableName;let s,o;t.isQuantized?(s=`a_quantized_${r}`,o=t.quantizedGlslType):(s=`a_${r}`,o=t.glslType);const a=i===Me.POSITION;a?e.setPositionAttribute(o,s):e.addAttribute(o,s),a&&n&&e.addAttribute("vec3","a_position2D")}function Ufe(e,t,n){const i=Ii.STRUCT_ID_PROCESSED_ATTRIBUTES_VS,r=Ii.STRUCT_ID_PROCESSED_ATTRIBUTES_FS,{variableName:s,glslType:o}=t;s==="tangentMC"?(e.addStructField(i,"vec3","tangentMC"),e.addStructField(i,"float","tangentSignMC"),e.addStructField(r,"vec3","tangentEC")):s==="normalMC"?(e.addStructField(i,"vec3","normalMC"),e.addStructField(r,"vec3","normalEC")):(e.addStructField(i,o,s),e.addStructField(r,o,s)),s==="positionMC"&&n&&e.addStructField(i,"vec3","position2D")}function kfe(e,t,n){const i=Ii.FUNCTION_ID_INITIALIZE_ATTRIBUTES,r=t.variableName;if(r==="positionMC"&&n&&e.addFunctionLines(i,["attributes.position2D = a_position2D;"]),t.isQuantized)return;const o=[];r==="tangentMC"?(o.push("attributes.tangentMC = a_tangentMC.xyz;"),o.push("attributes.tangentSignMC = a_tangentMC.w;")):o.push(`attributes.${r} = a_${r};`),e.addFunctionLines(i,o)}function jfe(e,t){const{semantic:n,setIndex:i}=t.attribute;if(l(n)&&!l(i))return;let r=Ii.FUNCTION_ID_SET_DYNAMIC_VARYINGS_VS;const s=t.variableName;let o=`v_${s} = attributes.${s};`;e.addFunctionLines(r,[o]),r=Ii.FUNCTION_ID_SET_DYNAMIC_VARYINGS_FS,o=`attributes.${s} = v_${s};`,e.addFunctionLines(r,[o])}function Vfe(e,t){let n=!1,i=!1;for(let r=0;r<t.length;r++){const s=t[r];s.semantic===Me.NORMAL?n=!0:s.semantic===Me.TANGENT&&(i=!0)}!n||!i||(e.addDefine("HAS_BITANGENTS"),e.addVarying("vec3","v_bitangentEC"),e.addStructField(Ii.STRUCT_ID_PROCESSED_ATTRIBUTES_VS,"vec3","bitangentMC"),e.addStructField(Ii.STRUCT_ID_PROCESSED_ATTRIBUTES_FS,"vec3","bitangentEC"))}const Gfe=`#ifdef USE_IBL_LIGHTING
vec3 computeIBL(vec3 position, vec3 normal, vec3 lightDirection, vec3 lightColorHdr, czm_modelMaterial material)
{
    #if defined(DIFFUSE_IBL) || defined(SPECULAR_IBL)
        // Environment maps were provided, use them for IBL
        vec3 viewDirection = -normalize(position);
        vec3 iblColor = textureIBL(viewDirection, normal, lightDirection, material);
    #else
        // Use procedural IBL if there are no environment maps
        vec3 imageBasedLighting = proceduralIBL(position, normal, lightDirection, material);
        float maximumComponent = czm_maximumComponent(lightColorHdr);
        vec3 clampedLightColor = lightColorHdr / max(maximumComponent, 1.0);
        vec3 iblColor = clampedLightColor * imageBasedLighting;
    #endif
    return iblColor * material.occlusion;
}
#endif

#ifdef USE_CLEARCOAT
vec3 addClearcoatReflection(vec3 baseLayerColor, vec3 position, vec3 lightDirection, vec3 lightColorHdr, czm_modelMaterial material)
{
    vec3 viewDirection = -normalize(position);
    vec3 halfwayDirection = normalize(viewDirection + lightDirection);
    vec3 normal = material.clearcoatNormal;
    float NdotL = clamp(dot(normal, lightDirection), 0.001, 1.0);

    // clearcoatF0 = vec3(pow((ior - 1.0) / (ior + 1.0), 2.0)), but without KHR_materials_ior, ior is a constant 1.5.
    vec3 f0 = vec3(0.04);
    vec3 f90 = vec3(1.0);
    // Note: clearcoat Fresnel computed with dot(n, v) instead of dot(v, h).
    // This is to make it energy conserving with a simple layering function.
    float NdotV = clamp(dot(normal, viewDirection), 0.0, 1.0);
    vec3 F = fresnelSchlick2(f0, f90, NdotV);

    // compute specular reflection from direct lighting
    float roughness = material.clearcoatRoughness;
    float alphaRoughness = roughness * roughness;
    float directStrength = computeDirectSpecularStrength(normal, lightDirection, viewDirection, halfwayDirection, alphaRoughness);
    vec3 directReflection = F * directStrength * NdotL;
    vec3 color = lightColorHdr * directReflection;

    #ifdef SPECULAR_IBL
        // Find the direction in which to sample the environment map
        vec3 reflectMC = normalize(model_iblReferenceFrameMatrix * reflect(-viewDirection, normal));
        vec3 iblColor = computeSpecularIBL(reflectMC, NdotV, f0, roughness);
        color += iblColor * material.occlusion;
    #elif defined(USE_IBL_LIGHTING)
        vec3 positionWC = vec3(czm_inverseView * vec4(position, 1.0));
        vec3 reflectionWC = normalize(czm_inverseViewRotation * reflect(viewDirection, normal));
        vec3 skyMetrics = getProceduralSkyMetrics(positionWC, reflectionWC);

        vec3 specularIrradiance = getProceduralSpecularIrradiance(reflectionWC, skyMetrics, roughness);
        vec2 brdfLut = texture(czm_brdfLut, vec2(NdotV, roughness)).rg;
        vec3 specularColor = czm_srgbToLinear(f0 * brdfLut.x + brdfLut.y);
        vec3 iblColor = specularIrradiance * specularColor * model_iblFactor.y;
        #ifdef USE_SUN_LUMINANCE
            iblColor *= getSunLuminance(positionWC, normal, lightDirection);
        #endif
        float maximumComponent = czm_maximumComponent(lightColorHdr);
        vec3 clampedLightColor = lightColorHdr / max(maximumComponent, 1.0);
        color += clampedLightColor * iblColor * material.occlusion;
    #endif

    float clearcoatFactor = material.clearcoatFactor;
    vec3 clearcoatColor = color * clearcoatFactor;

    // Dim base layer based on transmission loss through clearcoat
    return baseLayerColor * (1.0 - clearcoatFactor * F) + clearcoatColor;
}
#endif

#if defined(LIGHTING_PBR) && defined(HAS_NORMALS)
vec3 computePbrLighting(in czm_modelMaterial material, in vec3 position)
{
    #ifdef USE_CUSTOM_LIGHT_COLOR
        vec3 lightColorHdr = model_lightColorHdr;
    #else
        vec3 lightColorHdr = czm_lightColorHdr;
    #endif

    vec3 viewDirection = -normalize(position);
    vec3 normal = material.normalEC;
    vec3 lightDirection = normalize(czm_lightDirectionEC);

    vec3 directLighting = czm_pbrLighting(viewDirection, normal, lightDirection, material);
    vec3 directColor = lightColorHdr * directLighting;

    // Accumulate colors from base layer
    vec3 color = directColor + material.emissive;
    #ifdef USE_IBL_LIGHTING
        color += computeIBL(position, normal, lightDirection, lightColorHdr, material);
    #endif

    #ifdef USE_CLEARCOAT
        color = addClearcoatReflection(color, position, lightDirection, lightColorHdr, material);
    #endif

    return color;
}
#endif

/**
 * Compute the material color under the current lighting conditions.
 * All other material properties are passed through so further stages
 * have access to them.
 *
 * @param {czm_modelMaterial} material The material properties from {@MaterialStageFS}
 * @param {ProcessedAttributes} attributes
 */
void lightingStage(inout czm_modelMaterial material, ProcessedAttributes attributes)
{
    #ifdef LIGHTING_PBR
        #ifdef HAS_NORMALS
            vec3 color = computePbrLighting(material, attributes.positionEC);
        #else
            vec3 color = material.diffuse * material.occlusion + material.emissive;
        #endif
        // In HDR mode, the frame buffer is in linear color space. The
        // post-processing stages (see PostProcessStageCollection) will handle
        // tonemapping. However, if HDR is not enabled, we must tonemap else large
        // values may be clamped to 1.0
        #ifndef HDR
            color = czm_acesTonemapping(color);
        #endif
    #else // unlit
        vec3 color = material.diffuse;
    #endif

    #ifdef HAS_POINT_CLOUD_COLOR_STYLE
        // The colors resulting from point cloud styles are adjusted differently.
        color = czm_gammaCorrect(color);
    #elif !defined(HDR)
        // If HDR is not enabled, the frame buffer stores sRGB colors rather than
        // linear colors so the linear value must be converted.
        color = czm_linearToSrgb(color);
    #endif

    material.diffuse = color;
}
`,Hfe={UNLIT:0,PBR:1},oy=Object.freeze(Hfe),W2={name:"LightingPipelineStage"};W2.process=function(e,t){const{model:n,lightingOptions:i,shaderBuilder:r}=e;if(l(n.lightColor)){r.addDefine("USE_CUSTOM_LIGHT_COLOR",void 0,Q.FRAGMENT),r.addUniform("vec3","model_lightColorHdr",Q.FRAGMENT);const o=e.uniformMap;o.model_lightColorHdr=function(){return n.lightColor}}const{lightingModel:s}=i;s===oy.PBR?r.addDefine("LIGHTING_PBR",void 0,Q.FRAGMENT):r.addDefine("LIGHTING_UNLIT",void 0,Q.FRAGMENT),r.addFragmentLines(Gfe)};const qfe=`// If the style color is white, it implies the feature has not been styled.
bool isDefaultStyleColor(vec3 color)
{
    return all(greaterThan(color, vec3(1.0 - czm_epsilon3)));
}

vec3 blend(vec3 sourceColor, vec3 styleColor, float styleColorBlend)
{
    vec3 blendColor = mix(sourceColor, styleColor, styleColorBlend);
    vec3 color = isDefaultStyleColor(styleColor.rgb) ? sourceColor : blendColor;
    return color;
}

vec2 computeTextureTransform(vec2 texCoord, mat3 textureTransform)
{
    return vec2(textureTransform * vec3(texCoord, 1.0));
}

#ifdef HAS_NORMAL_TEXTURE
vec2 getNormalTexCoords()
{
    vec2 texCoord = TEXCOORD_NORMAL;
    #ifdef HAS_NORMAL_TEXTURE_TRANSFORM
        texCoord = vec2(u_normalTextureTransform * vec3(texCoord, 1.0));
    #endif
    return texCoord;
}
#endif

#if defined(HAS_NORMAL_TEXTURE) || defined(HAS_CLEARCOAT_NORMAL_TEXTURE)
vec3 computeTangent(in vec3 position, in vec2 normalTexCoords)
{
    vec2 tex_dx = dFdx(normalTexCoords);
    vec2 tex_dy = dFdy(normalTexCoords);
    float determinant = tex_dx.x * tex_dy.y - tex_dy.x * tex_dx.y;
    vec3 tangent = tex_dy.t * dFdx(position) - tex_dx.t * dFdy(position);
    return tangent / determinant;
}
#endif

#ifdef USE_ANISOTROPY
struct NormalInfo {
    vec3 tangent;
    vec3 bitangent;
    vec3 normal;
    vec3 geometryNormal;
};

NormalInfo getNormalInfo(ProcessedAttributes attributes)
{
    vec3 geometryNormal = attributes.normalEC;
    #ifdef HAS_NORMAL_TEXTURE
        vec2 normalTexCoords = getNormalTexCoords();
    #endif

    #ifdef HAS_BITANGENTS
        vec3 tangent = attributes.tangentEC;
        vec3 bitangent = attributes.bitangentEC;
    #else // Assume HAS_NORMAL_TEXTURE
        vec3 tangent = computeTangent(attributes.positionEC, normalTexCoords);
        tangent = normalize(tangent - geometryNormal * dot(geometryNormal, tangent));
        vec3 bitangent = normalize(cross(geometryNormal, tangent));
    #endif

    #ifdef HAS_NORMAL_TEXTURE
        mat3 tbn = mat3(tangent, bitangent, geometryNormal);
        vec3 normalSample = texture(u_normalTexture, normalTexCoords).rgb;
        normalSample = 2.0 * normalSample - 1.0;
        #ifdef HAS_NORMAL_TEXTURE_SCALE
            normalSample.xy *= u_normalTextureScale;
        #endif
        vec3 normal = normalize(tbn * normalSample);
    #else
        vec3 normal = geometryNormal;
    #endif

    #ifdef HAS_DOUBLE_SIDED_MATERIAL
        if (czm_backFacing()) {
            tangent *= -1.0;
            bitangent *= -1.0;
            normal *= -1.0;
            geometryNormal *= -1.0;
        }
    #endif

    NormalInfo normalInfo;
    normalInfo.tangent = tangent;
    normalInfo.bitangent = bitangent;
    normalInfo.normal = normal;
    normalInfo.geometryNormal = geometryNormal;

    return normalInfo;
}
#endif

#if defined(HAS_NORMAL_TEXTURE) && !defined(HAS_WIREFRAME)
vec3 getNormalFromTexture(ProcessedAttributes attributes, vec3 geometryNormal)
{
    vec2 normalTexCoords = getNormalTexCoords();

    // If HAS_BITANGENTS is set, then HAS_TANGENTS is also set
    #ifdef HAS_BITANGENTS
        vec3 t = attributes.tangentEC;
        vec3 b = attributes.bitangentEC;
    #else
        vec3 t = computeTangent(attributes.positionEC, normalTexCoords);
        t = normalize(t - geometryNormal * dot(geometryNormal, t));
        vec3 b = normalize(cross(geometryNormal, t));
    #endif

    mat3 tbn = mat3(t, b, geometryNormal);
    vec3 normalSample = texture(u_normalTexture, normalTexCoords).rgb;
    normalSample = 2.0 * normalSample - 1.0;
    #ifdef HAS_NORMAL_TEXTURE_SCALE
        normalSample.xy *= u_normalTextureScale;
    #endif
    return normalize(tbn * normalSample);
}
#endif

#ifdef HAS_CLEARCOAT_NORMAL_TEXTURE
vec3 getClearcoatNormalFromTexture(ProcessedAttributes attributes, vec3 geometryNormal)
{
    vec2 normalTexCoords = TEXCOORD_CLEARCOAT_NORMAL;
    #ifdef HAS_CLEARCOAT_NORMAL_TEXTURE_TRANSFORM
        normalTexCoords = vec2(u_clearcoatNormalTextureTransform * vec3(normalTexCoords, 1.0));
    #endif

    // If HAS_BITANGENTS is set, then HAS_TANGENTS is also set
    #ifdef HAS_BITANGENTS
        vec3 t = attributes.tangentEC;
        vec3 b = attributes.bitangentEC;
    #else
        vec3 t = computeTangent(attributes.positionEC, normalTexCoords);
        t = normalize(t - geometryNormal * dot(geometryNormal, t));
        vec3 b = normalize(cross(geometryNormal, t));
    #endif

    mat3 tbn = mat3(t, b, geometryNormal);
    vec3 normalSample = texture(u_clearcoatNormalTexture, normalTexCoords).rgb;
    normalSample = 2.0 * normalSample - 1.0;
    #ifdef HAS_CLEARCOAT_NORMAL_TEXTURE_SCALE
        normalSample.xy *= u_clearcoatNormalTextureScale;
    #endif
    return normalize(tbn * normalSample);
}
#endif

#ifdef HAS_NORMALS
vec3 computeNormal(ProcessedAttributes attributes)
{
    // Geometry normal. This is already normalized 
    vec3 normal = attributes.normalEC;

    #if defined(HAS_NORMAL_TEXTURE) && !defined(HAS_WIREFRAME)
        normal = getNormalFromTexture(attributes, normal);
    #endif

    #ifdef HAS_DOUBLE_SIDED_MATERIAL
        if (czm_backFacing()) {
            normal = -normal;
        }
    #endif

    return normal;
}
#endif

#ifdef HAS_BASE_COLOR_TEXTURE
vec4 getBaseColorFromTexture()
{
    vec2 baseColorTexCoords = TEXCOORD_BASE_COLOR;
    #ifdef HAS_BASE_COLOR_TEXTURE_TRANSFORM
        baseColorTexCoords = computeTextureTransform(baseColorTexCoords, u_baseColorTextureTransform);
    #endif

    vec4 baseColorWithAlpha = czm_srgbToLinear(texture(u_baseColorTexture, baseColorTexCoords));

    #ifdef HAS_BASE_COLOR_FACTOR
        baseColorWithAlpha *= u_baseColorFactor;
    #endif

    return baseColorWithAlpha;
}
#endif

#ifdef HAS_EMISSIVE_TEXTURE
vec3 getEmissiveFromTexture()
{
    vec2 emissiveTexCoords = TEXCOORD_EMISSIVE;
    #ifdef HAS_EMISSIVE_TEXTURE_TRANSFORM
        emissiveTexCoords = computeTextureTransform(emissiveTexCoords, u_emissiveTextureTransform);
    #endif

    vec3 emissive = czm_srgbToLinear(texture(u_emissiveTexture, emissiveTexCoords).rgb);
    #ifdef HAS_EMISSIVE_FACTOR
        emissive *= u_emissiveFactor;
    #endif

    return emissive;
}
#endif

#if defined(LIGHTING_PBR) && defined(USE_SPECULAR_GLOSSINESS)
void setSpecularGlossiness(inout czm_modelMaterial material)
{
    #ifdef HAS_SPECULAR_GLOSSINESS_TEXTURE
        vec2 specularGlossinessTexCoords = TEXCOORD_SPECULAR_GLOSSINESS;
        #ifdef HAS_SPECULAR_GLOSSINESS_TEXTURE_TRANSFORM
            specularGlossinessTexCoords = computeTextureTransform(specularGlossinessTexCoords, u_specularGlossinessTextureTransform);
        #endif

        vec4 specularGlossiness = czm_srgbToLinear(texture(u_specularGlossinessTexture, specularGlossinessTexCoords));
        vec3 specular = specularGlossiness.rgb;
        float glossiness = specularGlossiness.a;
        #ifdef HAS_LEGACY_SPECULAR_FACTOR
            specular *= u_legacySpecularFactor;
        #endif

        #ifdef HAS_GLOSSINESS_FACTOR
            glossiness *= u_glossinessFactor;
        #endif
    #else
        #ifdef HAS_LEGACY_SPECULAR_FACTOR
            vec3 specular = clamp(u_legacySpecularFactor, vec3(0.0), vec3(1.0));
        #else
            vec3 specular = vec3(1.0);
        #endif

        #ifdef HAS_GLOSSINESS_FACTOR
            float glossiness = clamp(u_glossinessFactor, 0.0, 1.0);
        #else
            float glossiness = 1.0;
        #endif
    #endif

    #ifdef HAS_DIFFUSE_TEXTURE
        vec2 diffuseTexCoords = TEXCOORD_DIFFUSE;
        #ifdef HAS_DIFFUSE_TEXTURE_TRANSFORM
            diffuseTexCoords = computeTextureTransform(diffuseTexCoords, u_diffuseTextureTransform);
        #endif

        vec4 diffuse = czm_srgbToLinear(texture(u_diffuseTexture, diffuseTexCoords));
        #ifdef HAS_DIFFUSE_FACTOR
            diffuse *= u_diffuseFactor;
        #endif
    #elif defined(HAS_DIFFUSE_FACTOR)
        vec4 diffuse = clamp(u_diffuseFactor, vec4(0.0), vec4(1.0));
    #else
        vec4 diffuse = vec4(1.0);
    #endif

    material.diffuse = diffuse.rgb * (1.0 - czm_maximumComponent(specular));
    // the specular glossiness extension's alpha overrides anything set
    // by the base material.
    material.alpha = diffuse.a;

    material.specular = specular;

    // glossiness is the opposite of roughness, but easier for artists to use.
    material.roughness = 1.0 - glossiness;
}
#elif defined(LIGHTING_PBR)
float setMetallicRoughness(inout czm_modelMaterial material)
{
    #ifdef HAS_METALLIC_ROUGHNESS_TEXTURE
        vec2 metallicRoughnessTexCoords = TEXCOORD_METALLIC_ROUGHNESS;
        #ifdef HAS_METALLIC_ROUGHNESS_TEXTURE_TRANSFORM
            metallicRoughnessTexCoords = computeTextureTransform(metallicRoughnessTexCoords, u_metallicRoughnessTextureTransform);
        #endif

        vec3 metallicRoughness = texture(u_metallicRoughnessTexture, metallicRoughnessTexCoords).rgb;
        float metalness = clamp(metallicRoughness.b, 0.0, 1.0);
        float roughness = clamp(metallicRoughness.g, 0.0, 1.0);
        #ifdef HAS_METALLIC_FACTOR
            metalness = clamp(metalness * u_metallicFactor, 0.0, 1.0);
        #endif

        #ifdef HAS_ROUGHNESS_FACTOR
            roughness = clamp(roughness * u_roughnessFactor, 0.0, 1.0);
        #endif
    #else
        #ifdef HAS_METALLIC_FACTOR
            float metalness = clamp(u_metallicFactor, 0.0, 1.0);
        #else
            float metalness = 1.0;
        #endif

        #ifdef HAS_ROUGHNESS_FACTOR
            float roughness = clamp(u_roughnessFactor, 0.0, 1.0);
        #else
            float roughness = 1.0;
        #endif
    #endif

    // dielectrics use f0 = 0.04, metals use albedo as f0
    const vec3 REFLECTANCE_DIELECTRIC = vec3(0.04);
    vec3 f0 = mix(REFLECTANCE_DIELECTRIC, material.baseColor.rgb, metalness);

    material.specular = f0;

    // diffuse only applies to dielectrics.
    material.diffuse = mix(material.baseColor.rgb, vec3(0.0), metalness);

    // This is perceptual roughness. The square of this value is used for direct lighting
    material.roughness = roughness;

    return metalness;
}
#ifdef USE_SPECULAR
void setSpecular(inout czm_modelMaterial material, in float metalness)
{
    #ifdef HAS_SPECULAR_TEXTURE
        vec2 specularTexCoords = TEXCOORD_SPECULAR;
        #ifdef HAS_SPECULAR_TEXTURE_TRANSFORM
            specularTexCoords = computeTextureTransform(specularTexCoords, u_specularTextureTransform);
        #endif
        float specularWeight = texture(u_specularTexture, specularTexCoords).a;
        #ifdef HAS_SPECULAR_FACTOR
            specularWeight *= u_specularFactor;
        #endif
    #else
        #ifdef HAS_SPECULAR_FACTOR
            float specularWeight = u_specularFactor;
        #else
            float specularWeight = 1.0;
        #endif
    #endif

    #ifdef HAS_SPECULAR_COLOR_TEXTURE
        vec2 specularColorTexCoords = TEXCOORD_SPECULAR_COLOR;
        #ifdef HAS_SPECULAR_COLOR_TEXTURE_TRANSFORM
            specularColorTexCoords = computeTextureTransform(specularColorTexCoords, u_specularColorTextureTransform);
        #endif
        vec3 specularColorSample = texture(u_specularColorTexture, specularColorTexCoords).rgb;
        vec3 specularColorFactor = czm_srgbToLinear(specularColorSample);
        #ifdef HAS_SPECULAR_COLOR_FACTOR
            specularColorFactor *= u_specularColorFactor;
        #endif
    #else
        #ifdef HAS_SPECULAR_COLOR_FACTOR
            vec3 specularColorFactor = u_specularColorFactor;
        #else
            vec3 specularColorFactor = vec3(1.0);
        #endif
    #endif
    material.specularWeight = specularWeight;
    vec3 f0 = material.specular;
    vec3 dielectricSpecularF0 = min(f0 * specularColorFactor, vec3(1.0));
    material.specular = mix(dielectricSpecularF0, material.baseColor.rgb, metalness);
}
#endif
#ifdef USE_ANISOTROPY
void setAnisotropy(inout czm_modelMaterial material, in NormalInfo normalInfo)
{
    mat2 rotation = mat2(u_anisotropy.xy, -u_anisotropy.y, u_anisotropy.x);
    float anisotropyStrength = u_anisotropy.z;

    vec2 direction = vec2(1.0, 0.0);
    #ifdef HAS_ANISOTROPY_TEXTURE
        vec2 anisotropyTexCoords = TEXCOORD_ANISOTROPY;
        #ifdef HAS_ANISOTROPY_TEXTURE_TRANSFORM
            anisotropyTexCoords = computeTextureTransform(anisotropyTexCoords, u_anisotropyTextureTransform);
        #endif
        vec3 anisotropySample = texture(u_anisotropyTexture, anisotropyTexCoords).rgb;
        direction = anisotropySample.rg * 2.0 - vec2(1.0);
        anisotropyStrength *= anisotropySample.b;
    #endif

    direction = rotation * direction;
    mat3 tbn = mat3(normalInfo.tangent, normalInfo.bitangent, normalInfo.normal);
    vec3 anisotropicT = tbn * normalize(vec3(direction, 0.0));
    vec3 anisotropicB = cross(normalInfo.geometryNormal, anisotropicT);

    material.anisotropicT = anisotropicT;
    material.anisotropicB = anisotropicB;
    material.anisotropyStrength = anisotropyStrength;
}
#endif
#ifdef USE_CLEARCOAT
void setClearcoat(inout czm_modelMaterial material, in ProcessedAttributes attributes)
{
    #ifdef HAS_CLEARCOAT_TEXTURE
        vec2 clearcoatTexCoords = TEXCOORD_CLEARCOAT;
        #ifdef HAS_CLEARCOAT_TEXTURE_TRANSFORM
            clearcoatTexCoords = computeTextureTransform(clearcoatTexCoords, u_clearcoatTextureTransform);
        #endif
        float clearcoatFactor = texture(u_clearcoatTexture, clearcoatTexCoords).r;
        #ifdef HAS_CLEARCOAT_FACTOR
            clearcoatFactor *= u_clearcoatFactor;
        #endif
    #else
        #ifdef HAS_CLEARCOAT_FACTOR
            float clearcoatFactor = u_clearcoatFactor;
        #else
            // PERFORMANCE_IDEA: this case should turn the whole extension off
            float clearcoatFactor = 0.0;
        #endif
    #endif

    #ifdef HAS_CLEARCOAT_ROUGHNESS_TEXTURE
        vec2 clearcoatRoughnessTexCoords = TEXCOORD_CLEARCOAT_ROUGHNESS;
        #ifdef HAS_CLEARCOAT_ROUGHNESS_TEXTURE_TRANSFORM
            clearcoatRoughnessTexCoords = computeTextureTransform(clearcoatRoughnessTexCoords, u_clearcoatRoughnessTextureTransform);
        #endif
        float clearcoatRoughness = texture(u_clearcoatRoughnessTexture, clearcoatRoughnessTexCoords).g;
        #ifdef HAS_CLEARCOAT_ROUGHNESS_FACTOR
            clearcoatRoughness *= u_clearcoatRoughnessFactor;
        #endif
    #else
        #ifdef HAS_CLEARCOAT_ROUGHNESS_FACTOR
            float clearcoatRoughness = u_clearcoatRoughnessFactor;
        #else
            float clearcoatRoughness = 0.0;
        #endif
    #endif

    material.clearcoatFactor = clearcoatFactor;
    // This is perceptual roughness. The square of this value is used for direct lighting
    material.clearcoatRoughness = clearcoatRoughness;
    #ifdef HAS_CLEARCOAT_NORMAL_TEXTURE
        material.clearcoatNormal = getClearcoatNormalFromTexture(attributes, attributes.normalEC);
    #else
        material.clearcoatNormal = attributes.normalEC;
    #endif
}
#endif
#endif

void materialStage(inout czm_modelMaterial material, ProcessedAttributes attributes, SelectedFeature feature)
{
    #ifdef USE_ANISOTROPY
        NormalInfo normalInfo = getNormalInfo(attributes);
        material.normalEC = normalInfo.normal;
    #elif defined(HAS_NORMALS)
        material.normalEC = computeNormal(attributes);
    #endif

    vec4 baseColorWithAlpha = vec4(1.0);
    // Regardless of whether we use PBR, set a base color
    #ifdef HAS_BASE_COLOR_TEXTURE
        baseColorWithAlpha = getBaseColorFromTexture();
    #elif defined(HAS_BASE_COLOR_FACTOR)
        baseColorWithAlpha = u_baseColorFactor;
    #endif

    #ifdef HAS_POINT_CLOUD_COLOR_STYLE
        baseColorWithAlpha = v_pointCloudColor;
    #elif defined(HAS_COLOR_0)
        vec4 color = attributes.color_0;
        // .pnts files store colors in the sRGB color space
        #ifdef HAS_SRGB_COLOR
            color = czm_srgbToLinear(color);
        #endif
        baseColorWithAlpha *= color;
    #endif

    #ifdef USE_CPU_STYLING
        baseColorWithAlpha.rgb = blend(baseColorWithAlpha.rgb, feature.color.rgb, model_colorBlend);
    #endif
    material.baseColor = baseColorWithAlpha;
    material.diffuse = baseColorWithAlpha.rgb;
    material.alpha = baseColorWithAlpha.a;

    #ifdef HAS_OCCLUSION_TEXTURE
        vec2 occlusionTexCoords = TEXCOORD_OCCLUSION;
        #ifdef HAS_OCCLUSION_TEXTURE_TRANSFORM
            occlusionTexCoords = computeTextureTransform(occlusionTexCoords, u_occlusionTextureTransform);
        #endif
        material.occlusion = texture(u_occlusionTexture, occlusionTexCoords).r;
    #endif

    #ifdef HAS_EMISSIVE_TEXTURE
        material.emissive = getEmissiveFromTexture();
    #elif defined(HAS_EMISSIVE_FACTOR)
        material.emissive = u_emissiveFactor;
    #endif

    #if defined(LIGHTING_PBR) && defined(USE_SPECULAR_GLOSSINESS)
        setSpecularGlossiness(material);
    #elif defined(LIGHTING_PBR)
        float metalness = setMetallicRoughness(material);
        #ifdef USE_SPECULAR
            setSpecular(material, metalness);
        #endif
        #ifdef USE_ANISOTROPY
            setAnisotropy(material, normalInfo);
        #endif
        #ifdef USE_CLEARCOAT
            setClearcoat(material, attributes);
        #endif
    #endif
}
`,{Material:Wfe,MetallicRoughness:hT,SpecularGlossiness:dT,Specular:J1,Clearcoat:Q1}=Be,$2={name:"MaterialPipelineStage",_processTexture:rs,_processTextureTransform:X2};$2.process=function(e,t,n){const i=t.material,{model:r,uniformMap:s,shaderBuilder:o}=e,a=l(r.classificationType),c=a,{defaultTexture:u,defaultNormalTexture:h,defaultEmissiveTexture:d}=n.context;Xfe(i,s,o,u,h,d,c),l(i.specularGlossiness)?Yfe(i.specularGlossiness,s,o,u,c):(l(i.specular)&&je.supportedExtensions.KHR_materials_specular&&Kfe(i.specular,s,o,u,c),l(i.anisotropy)&&je.supportedExtensions.KHR_materials_anisotropy&&Jfe(i.anisotropy,s,o,u,c),l(i.clearcoat)&&je.supportedExtensions.KHR_materials_clearcoat&&Qfe(i.clearcoat,s,o,u,c),ehe(i.metallicRoughness,s,o,u,c));const p=je.getAttributeBySemantic(t,Me.NORMAL),g=e.lightingOptions;i.unlit||!p||a?g.lightingModel=oy.UNLIT:g.lightingModel=oy.PBR;const _=r.backFaceCulling&&!i.doubleSided;e.renderStateOptions.cull.enabled=_;const b=e.alphaOptions;i.alphaMode===Q_.BLEND?b.pass=Ke.TRANSLUCENT:i.alphaMode===Q_.MASK&&(b.alphaCutoff=i.alphaCutoff),o.addFragmentLines(qfe),i.doubleSided&&o.addDefine("HAS_DOUBLE_SIDED_MATERIAL",void 0,Q.BOTH)};function X2(e,t,n,i,r){const s=`HAS_${r}_TEXTURE_TRANSFORM`;e.addDefine(s,void 0,Q.FRAGMENT);const o=`${i}Transform`;e.addUniform("mat3",o,Q.FRAGMENT),t[o]=function(){return n.transform}}function $fe(e,t,n,i,r){const s=`HAS_${r}_TEXTURE_SCALE`;e.addDefine(s,void 0,Q.FRAGMENT);const o=`${i}Scale`;e.addUniform("float",o,Q.FRAGMENT),t[o]=function(){return n.scale}}function rs(e,t,n,i,r,s){e.addUniform("sampler2D",i,Q.FRAGMENT),t[i]=function(){return T(n.texture,s)};const o=`HAS_${r}_TEXTURE`;e.addDefine(o,void 0,Q.FRAGMENT);const c=`v_texCoord_${n.texCoord}`,u=`TEXCOORD_${r}`;e.addDefine(u,c,Q.FRAGMENT);const h=n.transform;l(h)&&!H.equals(h,H.IDENTITY)&&X2(e,t,n,i,r);const{scale:d}=n;l(d)&&d!==1&&$fe(e,t,n,i,r)}function Xfe(e,t,n,i,r,s,o){const{emissiveFactor:a,emissiveTexture:c,normalTexture:u,occlusionTexture:h}=e;l(a)&&!m.equals(a,Wfe.DEFAULT_EMISSIVE_FACTOR)&&(n.addUniform("vec3","u_emissiveFactor",Q.FRAGMENT),t.u_emissiveFactor=function(){return e.emissiveFactor},n.addDefine("HAS_EMISSIVE_FACTOR",void 0,Q.FRAGMENT),l(c)&&!o&&rs(n,t,c,"u_emissiveTexture","EMISSIVE",s)),l(u)&&!o&&rs(n,t,u,"u_normalTexture","NORMAL",r),l(h)&&!o&&rs(n,t,h,"u_occlusionTexture","OCCLUSION",i)}function Yfe(e,t,n,i,r){const{diffuseTexture:s,diffuseFactor:o,specularGlossinessTexture:a,specularFactor:c,glossinessFactor:u}=e;n.addDefine("USE_SPECULAR_GLOSSINESS",void 0,Q.FRAGMENT),l(s)&&!r&&rs(n,t,s,"u_diffuseTexture","DIFFUSE",i),l(o)&&!Y.equals(o,dT.DEFAULT_DIFFUSE_FACTOR)&&(n.addUniform("vec4","u_diffuseFactor",Q.FRAGMENT),t.u_diffuseFactor=function(){return e.diffuseFactor},n.addDefine("HAS_DIFFUSE_FACTOR",void 0,Q.FRAGMENT)),l(a)&&!r&&rs(n,t,a,"u_specularGlossinessTexture","SPECULAR_GLOSSINESS",i),l(c)&&!m.equals(c,dT.DEFAULT_SPECULAR_FACTOR)&&(n.addUniform("vec3","u_legacySpecularFactor",Q.FRAGMENT),t.u_legacySpecularFactor=function(){return e.specularFactor},n.addDefine("HAS_LEGACY_SPECULAR_FACTOR",void 0,Q.FRAGMENT)),l(u)&&u!==dT.DEFAULT_GLOSSINESS_FACTOR&&(n.addUniform("float","u_glossinessFactor",Q.FRAGMENT),t.u_glossinessFactor=function(){return e.glossinessFactor},n.addDefine("HAS_GLOSSINESS_FACTOR",void 0,Q.FRAGMENT))}function Kfe(e,t,n,i,r){const{specularTexture:s,specularFactor:o,specularColorTexture:a,specularColorFactor:c}=e;n.addDefine("USE_SPECULAR",void 0,Q.FRAGMENT),l(s)&&!r&&rs(n,t,s,"u_specularTexture","SPECULAR",i),l(o)&&o!==J1.DEFAULT_SPECULAR_FACTOR&&(n.addUniform("float","u_specularFactor",Q.FRAGMENT),t.u_specularFactor=function(){return e.specularFactor},n.addDefine("HAS_SPECULAR_FACTOR",void 0,Q.FRAGMENT)),l(a)&&!r&&rs(n,t,a,"u_specularColorTexture","SPECULAR_COLOR",i),l(c)&&!m.equals(c,J1.DEFAULT_SPECULAR_COLOR_FACTOR)&&(n.addUniform("vec3","u_specularColorFactor",Q.FRAGMENT),t.u_specularColorFactor=function(){return e.specularColorFactor},n.addDefine("HAS_SPECULAR_COLOR_FACTOR",void 0,Q.FRAGMENT))}const Zfe=new m;function Jfe(e,t,n,i,r){const{anisotropyStrength:s,anisotropyRotation:o,anisotropyTexture:a}=e;n.addDefine("USE_ANISOTROPY",void 0,Q.FRAGMENT),l(a)&&!r&&rs(n,t,a,"u_anisotropyTexture","ANISOTROPY",i);const c=Math.cos(o),u=Math.sin(o);n.addUniform("vec3","u_anisotropy",Q.FRAGMENT),t.u_anisotropy=function(){return m.fromElements(c,u,s,Zfe)}}function Qfe(e,t,n,i,r){const{clearcoatFactor:s,clearcoatTexture:o,clearcoatRoughnessFactor:a,clearcoatRoughnessTexture:c,clearcoatNormalTexture:u}=e;n.addDefine("USE_CLEARCOAT",void 0,Q.FRAGMENT),l(s)&&s!==Q1.DEFAULT_CLEARCOAT_FACTOR&&(n.addUniform("float","u_clearcoatFactor",Q.FRAGMENT),t.u_clearcoatFactor=function(){return e.clearcoatFactor},n.addDefine("HAS_CLEARCOAT_FACTOR",void 0,Q.FRAGMENT)),l(o)&&!r&&rs(n,t,o,"u_clearcoatTexture","CLEARCOAT",i),l(a)&&s!==Q1.DEFAULT_CLEARCOAT_ROUGHNESS_FACTOR&&(n.addUniform("float","u_clearcoatRoughnessFactor",Q.FRAGMENT),t.u_clearcoatRoughnessFactor=function(){return e.clearcoatRoughnessFactor},n.addDefine("HAS_CLEARCOAT_ROUGHNESS_FACTOR",void 0,Q.FRAGMENT)),l(c)&&!r&&rs(n,t,c,"u_clearcoatRoughnessTexture","CLEARCOAT_ROUGHNESS",i),l(u)&&!r&&rs(n,t,u,"u_clearcoatNormalTexture","CLEARCOAT_NORMAL",i)}function ehe(e,t,n,i,r){n.addDefine("USE_METALLIC_ROUGHNESS",void 0,Q.FRAGMENT);const s=e.baseColorTexture;l(s)&&!r&&rs(n,t,s,"u_baseColorTexture","BASE_COLOR",i);const o=e.baseColorFactor;l(o)&&!Y.equals(o,hT.DEFAULT_BASE_COLOR_FACTOR)&&(n.addUniform("vec4","u_baseColorFactor",Q.FRAGMENT),t.u_baseColorFactor=function(){return e.baseColorFactor},n.addDefine("HAS_BASE_COLOR_FACTOR",void 0,Q.FRAGMENT));const a=e.metallicRoughnessTexture;l(a)&&!r&&rs(n,t,a,"u_metallicRoughnessTexture","METALLIC_ROUGHNESS",i);const c=e.metallicFactor;l(c)&&c!==hT.DEFAULT_METALLIC_FACTOR&&(n.addUniform("float","u_metallicFactor",Q.FRAGMENT),t.u_metallicFactor=function(){return e.metallicFactor},n.addDefine("HAS_METALLIC_FACTOR",void 0,Q.FRAGMENT));const u=e.roughnessFactor;l(u)&&u!==hT.DEFAULT_ROUGHNESS_FACTOR&&(n.addUniform("float","u_roughnessFactor",Q.FRAGMENT),t.u_roughnessFactor=function(){return e.roughnessFactor},n.addDefine("HAS_ROUGHNESS_FACTOR",void 0,Q.FRAGMENT))}const the=`void morphTargetsStage(inout ProcessedAttributes attributes) 
{
    vec3 positionMC = attributes.positionMC;
    attributes.positionMC = getMorphedPosition(positionMC);

    #ifdef HAS_NORMALS
    vec3 normalMC = attributes.normalMC;
    attributes.normalMC = getMorphedNormal(normalMC);
    #endif

    #ifdef HAS_TANGENTS
    vec3 tangentMC = attributes.tangentMC;
    attributes.tangentMC = getMorphedTangent(tangentMC);
    #endif
}`,tr={name:"MorphTargetsPipelineStage",FUNCTION_ID_GET_MORPHED_POSITION:"getMorphedPosition",FUNCTION_SIGNATURE_GET_MORPHED_POSITION:"vec3 getMorphedPosition(in vec3 position)",FUNCTION_ID_GET_MORPHED_NORMAL:"getMorphedNormal",FUNCTION_SIGNATURE_GET_MORPHED_NORMAL:"vec3 getMorphedNormal(in vec3 normal)",FUNCTION_ID_GET_MORPHED_TANGENT:"getMorphedTangent",FUNCTION_SIGNATURE_GET_MORPHED_TANGENT:"vec3 getMorphedTangent(in vec3 tangent)"};tr.process=function(e,t){const n=e.shaderBuilder;n.addDefine("HAS_MORPH_TARGETS",void 0,Q.VERTEX),ahe(n);const i=t.morphTargets.length;for(let a=0;a<i;a++){const c=t.morphTargets[a].attributes,u=c.length;for(let h=0;h<u;h++){const d=c[h],p=d.semantic;p!==Me.POSITION&&p!==Me.NORMAL&&p!==Me.TANGENT||(ihe(e,d,e.attributeIndex,a),e.attributeIndex++)}}che(n);const s=e.runtimeNode.morphWeights.length;n.addUniform("float",`u_morphWeights[${s}]`,Q.VERTEX),n.addVertexLines(the);const o={u_morphWeights:function(){return e.runtimeNode.morphWeights}};e.uniformMap=wt(o,e.uniformMap)};const nhe={attributeString:void 0,functionId:void 0};function ihe(e,t,n,i){const r=e.shaderBuilder;rhe(e,t,n);const s=she(t,nhe);ohe(r,s,i)}function rhe(e,t,n){const i={index:n,value:l(t.buffer)?void 0:t.constant,vertexBuffer:t.buffer,componentsPerAttribute:tt.getNumberOfComponents(t.type),componentDatatype:t.componentDatatype,offsetInBytes:t.byteOffset,strideInBytes:t.byteStride,normalize:t.normalized};e.attributes.push(i)}function she(e,t){switch(e.semantic){case Me.POSITION:t.attributeString="Position",t.functionId=tr.FUNCTION_ID_GET_MORPHED_POSITION;break;case Me.NORMAL:t.attributeString="Normal",t.functionId=tr.FUNCTION_ID_GET_MORPHED_NORMAL;break;case Me.TANGENT:t.attributeString="Tangent",t.functionId=tr.FUNCTION_ID_GET_MORPHED_TANGENT;break}return t}function ohe(e,t,n){const i=t.attributeString,r=`a_target${i}_${n}`,s=`morphed${i} += u_morphWeights[${n}] * a_target${i}_${n};`;e.addAttribute("vec3",r),e.addFunctionLines(t.functionId,[s])}function ahe(e){e.addFunction(tr.FUNCTION_ID_GET_MORPHED_POSITION,tr.FUNCTION_SIGNATURE_GET_MORPHED_POSITION,Q.VERTEX),e.addFunctionLines(tr.FUNCTION_ID_GET_MORPHED_POSITION,["vec3 morphedPosition = position;"]),e.addFunction(tr.FUNCTION_ID_GET_MORPHED_NORMAL,tr.FUNCTION_SIGNATURE_GET_MORPHED_NORMAL,Q.VERTEX),e.addFunctionLines(tr.FUNCTION_ID_GET_MORPHED_NORMAL,["vec3 morphedNormal = normal;"]),e.addFunction(tr.FUNCTION_ID_GET_MORPHED_TANGENT,tr.FUNCTION_SIGNATURE_GET_MORPHED_TANGENT,Q.VERTEX),e.addFunctionLines(tr.FUNCTION_ID_GET_MORPHED_TANGENT,["vec3 morphedTangent = tangent;"])}function che(e){e.addFunctionLines(tr.FUNCTION_ID_GET_MORPHED_POSITION,["return morphedPosition;"]),e.addFunctionLines(tr.FUNCTION_ID_GET_MORPHED_NORMAL,["return morphedNormal;"]),e.addFunctionLines(tr.FUNCTION_ID_GET_MORPHED_TANGENT,["return morphedTangent;"])}const Y2={name:"PickingPipelineStage"};Y2.process=function(e,t,n){const i=n.context,r=e.runtimeNode,s=e.shaderBuilder,o=e.model,a=r.node.instances;if(e.hasPropertyTable)lhe(e,t,a);else if(l(a))uhe(e,i);else{const c=K2(e),u=i.createPickId(c);o._pipelineResources.push(u),o._pickIds.push(u),s.addUniform("vec4","czm_pickColor",Q.FRAGMENT);const h=e.uniformMap;h.czm_pickColor=function(){return u.color},e.pickId="czm_pickColor"}};function K2(e,t){const n=e.model;if(l(n.pickObject))return n.pickObject;const i={model:n,node:e.runtimeNode,primitive:e.runtimePrimitive};let r;if(Or.is3DTiles(n.type)){const s=n.content;r={content:s,primitive:s.tileset,detail:i}}else r={primitive:n,detail:i};return r.id=n.id,l(t)&&(r.instanceId=t),r}function lhe(e,t,n){const i=e.model;let r,s;const o=i.featureIdLabel,a=i.instanceFeatureIdLabel;l(i.featureTableId)?r=i.featureTableId:l(n)?(s=je.getFeatureIdsByLabel(n.featureIds,a),r=s.propertyTableId):(s=je.getFeatureIdsByLabel(t.featureIds,o),r=s.propertyTableId);const c=i.featureTables[r];e.shaderBuilder.addUniform("sampler2D","model_pickTexture",Q.FRAGMENT);const h=c.batchTexture;e.uniformMap.model_pickTexture=function(){return T(h.pickTexture,h.defaultTexture)},e.pickId="((selectedFeature.id < int(model_featuresLength)) ? texture(model_pickTexture, selectedFeature.st) : vec4(0.0))"}function uhe(e,t){const n=e.instanceCount,i=new Array(n),r=new Uint8Array(n*4),s=e.model,o=s._pipelineResources;for(let d=0;d<n;d++){const p=K2(e,d),g=t.createPickId(p);o.push(g),i[d]=g;const _=g.color;r[d*4+0]=M.floatToByte(_.red),r[d*4+1]=M.floatToByte(_.green),r[d*4+2]=M.floatToByte(_.blue),r[d*4+3]=M.floatToByte(_.alpha)}s._pickIds=i;const a=ze.createVertexBuffer({context:t,typedArray:r,usage:Ae.STATIC_DRAW});a.vertexArrayDestroyable=!1,s.statistics.addBuffer(a,!1),o.push(a);const u={index:e.attributeIndex++,vertexBuffer:a,componentsPerAttribute:4,componentDatatype:q.UNSIGNED_BYTE,normalize:!0,offsetInBytes:0,strideInBytes:0,instanceDivisor:1};e.attributes.push(u);const h=e.shaderBuilder;h.addDefine("USE_PICKING",void 0,Q.BOTH),h.addAttribute("vec4","a_pickColor"),h.addVarying("vec4","v_pickColor"),e.pickId="v_pickColor"}const fhe={ADD:0,REPLACE:1},sr=Object.freeze(fhe),hhe=`float getPointSizeFromAttenuation(vec3 positionEC) {
  // Variables are packed into a single vector to minimize gl.uniformXXX() calls
  float pointSize = model_pointCloudParameters.x;
  float geometricError = model_pointCloudParameters.y;
  float depthMultiplier = model_pointCloudParameters.z;

  float depth = -positionEC.z;
  return min((geometricError / depth) * depthMultiplier, pointSize);
}

#ifdef HAS_POINT_CLOUD_SHOW_STYLE
float pointCloudShowStylingStage(in ProcessedAttributes attributes, in Metadata metadata) {
  float tiles3d_tileset_time = model_pointCloudParameters.w;
  return float(getShowFromStyle(attributes, metadata, tiles3d_tileset_time));
}
#endif

#ifdef HAS_POINT_CLOUD_COLOR_STYLE
vec4 pointCloudColorStylingStage(in ProcessedAttributes attributes, in Metadata metadata) {
  float tiles3d_tileset_time = model_pointCloudParameters.w;
  return getColorFromStyle(attributes, metadata, tiles3d_tileset_time);
}
#endif

#ifdef HAS_POINT_CLOUD_POINT_SIZE_STYLE
float pointCloudPointSizeStylingStage(in ProcessedAttributes attributes, in Metadata metadata) {
  float tiles3d_tileset_time = model_pointCloudParameters.w;
  return float(getPointSizeFromStyle(attributes, metadata, tiles3d_tileset_time));
}
#elif defined(HAS_POINT_CLOUD_ATTENUATION)
float pointCloudPointSizeStylingStage(in ProcessedAttributes attributes, in Metadata metadata) {
  return getPointSizeFromAttenuation(v_positionEC);
}
#endif

#ifdef HAS_POINT_CLOUD_BACK_FACE_CULLING
float pointCloudBackFaceCullingStage() {
  #if defined(HAS_NORMALS) && !defined(HAS_DOUBLE_SIDED_MATERIAL)
  // This needs to be computed in eye coordinates so we can't use attributes.normalMC
  return step(-v_normalEC.z, 0.0);
  #else
  return 1.0;
  #endif
}
#endif`,dhe=new Y,Z2={name:"PointCloudStylingPipelineStage"};Z2.process=function(e,t,n){const i=e.shaderBuilder,r=e.model,s=r.style,o=r.structuralMetadata,a=l(o)?o.propertyAttributes:void 0,c=l(r.featureTableId)&&r.featureTables[r.featureTableId].featuresLength>0,u=!l(a)&&c;if(l(s)&&!u){const b=_he(a),x=yhe(s,b);bhe(i,x);const C=The(x).indexOf("normalMC")>=0,w=je.getAttributeBySemantic(t,Me.NORMAL);if(C&&!w)throw new te("Style references the NORMAL semantic but the point cloud does not have normals");i.addDefine("COMPUTE_POSITION_WC_STYLE",void 0,Q.VERTEX),x.styleTranslucent&&(e.alphaOptions.pass=Ke.TRANSLUCENT)}const h=r.pointCloudShading;h.attenuation&&i.addDefine("HAS_POINT_CLOUD_ATTENUATION",void 0,Q.VERTEX),h.backFaceCulling&&i.addDefine("HAS_POINT_CLOUD_BACK_FACE_CULLING",void 0,Q.VERTEX);let d,p,g;Or.is3DTiles(r.type)&&(p=!0,d=r.content,g=d.tile.refine===sr.ADD),i.addUniform("vec4","model_pointCloudParameters",Q.VERTEX),i.addVertexLines(hhe);const _=e.uniformMap;_.model_pointCloudParameters=function(){const b=dhe;let x=1;p&&(x=g?5:d.tileset.memoryAdjustedScreenSpaceError),b.x=T(h.maximumAttenuation,x),b.x*=n.pixelRatio;const E=phe(e,t,h,d);b.y=E*h.geometricErrorScale;const C=n.context,w=n.camera.frustum;let S;return n.mode===Ie.SCENE2D||w instanceof Sr?S=Number.POSITIVE_INFINITY:S=C.drawingBufferHeight/n.camera.frustum.sseDenominator,b.z=S,p&&(b.w=d.tileset.timeSinceLoad),b}};const eO=new m;function phe(e,t,n,i){if(l(i)){const h=i.tile.geometricError;if(h>0)return h}if(l(n.baseResolution))return n.baseResolution;const r=je.getAttributeBySemantic(t,Me.POSITION),s=r.count,o=e.runtimeNode.transform;let a=m.subtract(r.max,r.min,eO);a=P.multiplyByPointAsVector(o,a,eO);const c=a.x*a.y*a.z;return R.cbrt(c/s)}const mhe={colorStyleFunction:void 0,showStyleFunction:void 0,pointSizeStyleFunction:void 0,styleTranslucent:!1},ghe={POSITION:"attributes.positionMC",POSITION_ABSOLUTE:"v_positionWC",COLOR:"attributes.color_0",NORMAL:"attributes.normalMC"};function _he(e){const t=Se(ghe);if(!l(e))return t;for(let n=0;n<e.length;n++){const r=e[n].properties;for(const s in r)r.hasOwnProperty(s)&&(t[s]=`metadata.${s}`)}return t}const pT="ProcessedAttributes attributes, Metadata metadata, float tiles3d_tileset_time";function yhe(e,t){const n=mhe,i={translucent:!1};return n.colorStyleFunction=e.getColorShaderFunction(`getColorFromStyle(${pT})`,t,i),n.showStyleFunction=e.getShowShaderFunction(`getShowFromStyle(${pT})`,t,i),n.pointSizeStyleFunction=e.getPointSizeShaderFunction(`getPointSizeFromStyle(${pT})`,t,i),n.styleTranslucent=l(n.colorStyleFunction)&&i.translucent,n}function bhe(e,t){const n=t.colorStyleFunction;l(n)&&(e.addDefine("HAS_POINT_CLOUD_COLOR_STYLE",void 0,Q.BOTH),e.addVertexLines(n),e.addVarying("vec4","v_pointCloudColor"));const i=t.showStyleFunction;l(i)&&(e.addDefine("HAS_POINT_CLOUD_SHOW_STYLE",void 0,Q.VERTEX),e.addVertexLines(i));const r=t.pointSizeStyleFunction;l(r)&&(e.addDefine("HAS_POINT_CLOUD_POINT_SIZE_STYLE",void 0,Q.VERTEX),e.addVertexLines(r))}function mT(e,t){const n=/attributes\.(\w+)/g;let i=n.exec(e);for(;i!==null;){const r=i[1];t.indexOf(r)===-1&&t.push(r),i=n.exec(e)}}function The(e){const t=e.colorStyleFunction,n=e.showStyleFunction,i=e.pointSizeStyleFunction,r=[];return l(t)&&mT(t,r),l(n)&&mT(n,r),l(i)&&mT(i,r),r}const xhe=`void primitiveOutlineStage() {
    v_outlineCoordinates = a_outlineCoordinates;
}
`,Ehe=`void primitiveOutlineStage(inout czm_modelMaterial material) {
    if (!model_showOutline) {
        return;
    }

    float outlineX = 
        texture(model_outlineTexture, vec2(v_outlineCoordinates.x, 0.5)).r;
    float outlineY = 
        texture(model_outlineTexture, vec2(v_outlineCoordinates.y, 0.5)).r;
    float outlineZ = 
        texture(model_outlineTexture, vec2(v_outlineCoordinates.z, 0.5)).r;
    float outlineness = max(outlineX, max(outlineY, outlineZ));

    material.diffuse = mix(material.diffuse, model_outlineColor.rgb, model_outlineColor.a * outlineness);
}

`,J2={name:"PrimitiveOutlinePipelineStage"};J2.process=function(e,t,n){const i=e.shaderBuilder,r=e.uniformMap;i.addDefine("HAS_PRIMITIVE_OUTLINE",void 0,Q.BOTH),i.addAttribute("vec3","a_outlineCoordinates"),i.addVarying("vec3","v_outlineCoordinates");const s=t.outlineCoordinates,o={index:e.attributeIndex++,vertexBuffer:s.buffer,componentsPerAttribute:tt.getNumberOfComponents(s.type),componentDatatype:s.componentDatatype,offsetInBytes:s.byteOffset,strideInBytes:s.byteStride,normalize:s.normalized};e.attributes.push(o),i.addUniform("sampler2D","model_outlineTexture",Q.FRAGMENT);const a=um.createTexture(n.context);r.model_outlineTexture=function(){return a};const c=e.model;i.addUniform("vec4","model_outlineColor",Q.FRAGMENT),r.model_outlineColor=function(){return c.outlineColor},i.addUniform("bool","model_showOutline",Q.FRAGMENT),r.model_showOutline=function(){return c.showOutline},i.addVertexLines(xhe),i.addFragmentLines(Ehe)};const Q2={name:"PrimitiveStatisticsPipelineStage",_countGeometry:eF,_count2DPositions:tF,_countMorphTargetAttributes:nF,_countMaterialTextures:iF,_countFeatureIdTextures:rF,_countBinaryMetadata:sF};Q2.process=function(e,t,n){const i=e.model,r=i.statistics;eF(r,t),tF(r,e.runtimePrimitive),nF(r,t),iF(r,t.material),rF(r,t.featureIds),sF(r,i)};function eF(e,t){const n=l(t.indices)?t.indices.count:je.getAttributeBySemantic(t,"POSITION").count,i=t.primitiveType;i===Fe.POINTS?e.pointsLength+=n:Fe.isTriangles(i)&&(e.trianglesLength+=Che(i,n));const r=t.attributes,s=r.length;for(let c=0;c<s;c++){const u=r[c];if(l(u.buffer)){const h=l(u.typedArray);e.addBuffer(u.buffer,h)}}const o=t.outlineCoordinates;l(o)&&l(o.buffer)&&e.addBuffer(o.buffer,!1);const a=t.indices;if(l(a)&&l(a.buffer)){const c=l(a.typedArray);e.addBuffer(a.buffer,c)}}function Che(e,t){switch(e){case Fe.TRIANGLES:return t/3;case Fe.TRIANGLE_STRIP:case Fe.TRIANGLE_FAN:return Math.max(t-2,0);default:return 0}}function tF(e,t){const n=t.positionBuffer2D;l(n)&&e.addBuffer(n,!0)}function nF(e,t){const n=t.morphTargets;if(!l(n))return;const i=!1,r=n.length;for(let s=0;s<r;s++){const o=n[s].attributes,a=o.length;for(let c=0;c<a;c++){const u=o[c];l(u.buffer)&&e.addBuffer(u.buffer,i)}}}function iF(e,t){const n=whe(t),i=n.length;for(let r=0;r<i;r++){const s=n[r];l(s)&&l(s.texture)&&e.addTexture(s.texture)}}function whe(e){const t=e.metallicRoughness,n=[e.emissiveTexture,e.normalTexture,e.occlusionTexture,t.baseColorTexture,t.metallicRoughnessTexture],i=e.specularGlossiness;return l(i)&&(n.push(i.diffuseTexture),n.push(i.specularGlossinessTexture)),n}function rF(e,t){const n=t.length;for(let i=0;i<n;i++){const r=t[i];if(r instanceof Be.FeatureIdTexture){const s=r.textureReader;l(s.texture)&&e.addTexture(s.texture)}}}function sF(e,t){const n=t.structuralMetadata;l(n)&&(Ahe(e,n),e.propertyTablesByteLength+=n.propertyTablesByteLength);const i=t.featureTables;if(!l(i))return;const r=i.length;for(let s=0;s<r;s++){const o=i[s];e.addBatchTexture(o.batchTexture)}}function Ahe(e,t){const n=t.propertyTextures;if(!l(n))return;const i=n.length;for(let r=0;r<i;r++){const o=n[r].properties;for(const a in o)if(o.hasOwnProperty(a)){const u=o[a].textureReader;l(u.texture)&&e.addTexture(u.texture)}}}const She=new P,vhe=new P,oF={name:"SceneMode2DPipelineStage"};oF.process=function(e,t,n){const i=je.getAttributeBySemantic(t,Me.POSITION),r=e.shaderBuilder,s=e.model,o=s.sceneGraph.computedModelMatrix,a=e.runtimeNode.computedTransform,c=P.multiplyTransformation(o,a,She),u=Rhe(e,c,n),h=e.runtimePrimitive;h.boundingSphere2D=u;const d=e.runtimeNode.node.instances;if(l(d))return;if(l(i.typedArray)){const b=Lhe(i,c,u,n);h.positionBuffer2D=b,s._modelResources.push(b),i.typedArray=void 0}r.addDefine("USE_2D_POSITIONS",void 0,Q.VERTEX),r.addUniform("mat4","u_modelView2D",Q.VERTEX);const p=P.fromTranslation(u.center,new P),g=n.context,_={u_modelView2D:function(){return P.multiplyTransformation(g.uniformState.view,p,vhe)}};e.uniformMap=wt(_,e.uniformMap)};const Ihe=new m,Ohe=new m;function Rhe(e,t,n){const i=P.multiplyByPoint(t,e.positionMin,Ihe),r=an.computeActualEllipsoidPosition(n,i,i),s=P.multiplyByPoint(t,e.positionMax,Ohe),o=an.computeActualEllipsoidPosition(n,s,s);return ee.fromCornerPoints(r,o,new ee)}const aF=new m;function Dhe(e,t){const n=e.length,i=new Float32Array(n),r=t.quantizedVolumeOffset,s=t.quantizedVolumeStepSize;for(let o=0;o<n;o+=3){const a=m.fromArray(e,o,aF),c=m.multiplyComponents(a,s,a),u=m.add(c,r,c);i[o]=u.x,i[o+1]=u.y,i[o+2]=u.z}return i}function Mhe(e,t,n,i){let r;l(e.quantization)?r=Dhe(e.typedArray,e.quantization):r=e.typedArray.slice();const s=e.byteOffset/Float32Array.BYTES_PER_ELEMENT,o=r.length,a=l(e.byteStride)?e.byteStride/Float32Array.BYTES_PER_ELEMENT:3;for(let c=s;c<o;c+=a){const u=m.fromArray(r,c,aF);if(isNaN(u.x)||isNaN(u.y)||isNaN(u.z))continue;const h=P.multiplyByPoint(t,u,u),d=an.computeActualEllipsoidPosition(i,h,h),p=m.subtract(d,n,d);r[c]=p.x,r[c+1]=p.y,r[c+2]=p.z}return r}function Lhe(e,t,n,i){const r=Se(i);r.mode=Ie.COLUMBUS_VIEW;const s=n.center,o=Mhe(e,t,s,r),a=ze.createVertexBuffer({context:i.context,typedArray:o,usage:Ae.STATIC_DRAW});return a.vertexArrayDestroyable=!1,a}const Phe=`void skinningStage(inout ProcessedAttributes attributes) 
{
    mat4 skinningMatrix = getSkinningMatrix();
    mat3 skinningMatrixMat3 = mat3(skinningMatrix);

    vec4 positionMC = vec4(attributes.positionMC, 1.0);
    attributes.positionMC = vec3(skinningMatrix * positionMC);

    #ifdef HAS_NORMALS
    vec3 normalMC = attributes.normalMC;
    attributes.normalMC = skinningMatrixMat3 * normalMC;
    #endif

    #ifdef HAS_TANGENTS
    vec3 tangentMC = attributes.tangentMC;
    attributes.tangentMC = skinningMatrixMat3 * tangentMC;
    #endif
}`,fu={name:"SkinningPipelineStage",FUNCTION_ID_GET_SKINNING_MATRIX:"getSkinningMatrix",FUNCTION_SIGNATURE_GET_SKINNING_MATRIX:"mat4 getSkinningMatrix()"};fu.process=function(e,t){const n=e.shaderBuilder;n.addDefine("HAS_SKINNING",void 0,Q.VERTEX),Fhe(n,t);const i=e.runtimeNode,r=i.computedJointMatrices;n.addUniform("mat4",`u_jointMatrices[${r.length}]`,Q.VERTEX),n.addVertexLines(Phe);const s={u_jointMatrices:function(){return i.computedJointMatrices}};e.uniformMap=wt(s,e.uniformMap)};function Nhe(e){let t=-1;const n=e.attributes,i=n.length;for(let r=0;r<i;r++){const s=n[r];(s.semantic===Me.JOINTS||s.semantic===Me.WEIGHTS)&&(t=Math.max(t,s.setIndex))}return t}function Fhe(e,t){e.addFunction(fu.FUNCTION_ID_GET_SKINNING_MATRIX,fu.FUNCTION_SIGNATURE_GET_SKINNING_MATRIX,Q.VERTEX),e.addFunctionLines(fu.FUNCTION_ID_GET_SKINNING_MATRIX,["mat4 skinnedMatrix = mat4(0);"]);let i,r;const s=["x","y","z","w"],o=Nhe(t);for(i=0;i<=o;i++)for(r=0;r<=3;r++){const c=s[r],u=`skinnedMatrix += a_weights_${i}.${c} * u_jointMatrices[int(a_joints_${i}.${c})];`;e.addFunctionLines(fu.FUNCTION_ID_GET_SKINNING_MATRIX,[u])}e.addFunctionLines(fu.FUNCTION_ID_GET_SKINNING_MATRIX,["return skinnedMatrix;"])}const Bhe=`void verticalExaggerationStage(
  inout ProcessedAttributes attributes
) {
  // Compute the distance from the camera to the local center of curvature.
  vec4 vertexPositionENU = czm_modelToEnu * vec4(attributes.positionMC, 1.0);
  vec2 vertexAzimuth = normalize(vertexPositionENU.xy);
  // Curvature = 1 / radius of curvature.
  float azimuthalCurvature = dot(vertexAzimuth * vertexAzimuth, czm_eyeEllipsoidCurvature);
  float eyeToCenter = 1.0 / azimuthalCurvature + czm_eyeHeight;

  // Compute the approximate ellipsoid normal at the vertex position.
  // Uses a circular approximation for the Earth curvature along the geodesic.
  vec3 vertexPositionEC = (czm_modelView * vec4(attributes.positionMC, 1.0)).xyz;
  vec3 centerToVertex = eyeToCenter * czm_eyeEllipsoidNormalEC + vertexPositionEC;
  vec3 vertexNormal = normalize(centerToVertex);

  // Estimate the (sine of the) angle between the camera direction and the vertex normal
  float verticalDistance = dot(vertexPositionEC, czm_eyeEllipsoidNormalEC);
  float horizontalDistance = length(vertexPositionEC - verticalDistance * czm_eyeEllipsoidNormalEC);
  float sinTheta = horizontalDistance / (eyeToCenter + verticalDistance);
  bool isSmallAngle = clamp(sinTheta, 0.0, 0.05) == sinTheta;

  // Approximate the change in height above the ellipsoid, from camera to vertex position.
  float exactVersine = 1.0 - dot(czm_eyeEllipsoidNormalEC, vertexNormal);
  float smallAngleVersine = 0.5 * sinTheta * sinTheta;
  float versine = isSmallAngle ? smallAngleVersine : exactVersine;
  float dHeight = dot(vertexPositionEC, vertexNormal) - eyeToCenter * versine;
  float vertexHeight = czm_eyeHeight + dHeight;

  // Transform the approximate vertex normal to model coordinates.
  vec3 vertexNormalMC = (czm_inverseModelView * vec4(vertexNormal, 0.0)).xyz;
  vertexNormalMC = normalize(vertexNormalMC);

  // Compute the exaggeration and apply it along the approximate vertex normal.
  float stretch = u_verticalExaggerationAndRelativeHeight.x;
  float shift = u_verticalExaggerationAndRelativeHeight.y;
  float exaggeration = (vertexHeight - shift) * (stretch - 1.0);
  attributes.positionMC += exaggeration * vertexNormalMC;
}
`,cF={name:"VerticalExaggerationPipelineStage"},zhe=new k;cF.process=function(e,t,n){const{shaderBuilder:i,uniformMap:r}=e;i.addVertexLines(Bhe),i.addDefine("HAS_VERTICAL_EXAGGERATION",void 0,Q.VERTEX),i.addUniform("vec2","u_verticalExaggerationAndRelativeHeight",Q.VERTEX),r.u_verticalExaggerationAndRelativeHeight=function(){return k.fromElements(n.verticalExaggeration,n.verticalExaggerationRelativeHeight,zhe)}};const lF={name:"WireframePipelineStage"};lF.process=function(e,t,n){e.shaderBuilder.addDefine("HAS_WIREFRAME",void 0,Q.FRAGMENT);const r=e.model,s=Uhe(t,e.indices,n);r._pipelineResources.push(s),e.wireframeIndexBuffer=s,r.statistics.addBuffer(s,!1);const a=e.primitiveType,c=e.count;e.primitiveType=Fe.LINES,e.count=Wy.getWireframeIndicesCount(a,c)};function Uhe(e,t,n){const r=je.getAttributeBySemantic(e,Me.POSITION).count,s=n.context.webgl2;let o;if(l(t)){const h=t.buffer,d=t.count;l(h)&&s?(o=h.sizeInBytes===d?new Uint8Array(d):Ge.createTypedArray(r,d),h.getBufferData(o)):o=t.typedArray}const a=e.primitiveType,c=Wy.createWireframeIndices(a,r,o),u=Ge.fromSizeInBytes(c.BYTES_PER_ELEMENT);return ze.createIndexBuffer({context:n.context,typedArray:c,usage:Ae.STATIC_DRAW,indexDatatype:u})}function uF(e){e=T(e,T.EMPTY_OBJECT);const t=e.primitive,n=e.node,i=e.model;y.typeOf.object("options.primitive",t),y.typeOf.object("options.node",n),y.typeOf.object("options.model",i),this.primitive=t,this.node=n,this.model=i,this.pipelineStages=[],this.drawCommand=void 0,this.boundingSphere=void 0,this.boundingSphere2D=void 0,this.positionBuffer2D=void 0,this.batchLengths=void 0,this.batchOffsets=void 0,this.updateStages=[]}uF.prototype.configurePipeline=function(e){const t=this.pipelineStages;t.length=0;const n=this.primitive,i=this.node,r=this.model,s=r.customShader,o=r.style,a=e.context.webgl2,u=e.mode!==Ie.SCENE3D&&!e.scene3DOnly&&r._projectTo2D,h=e.verticalExaggeration!==1,d=l(n.morphTargets)&&n.morphTargets.length>0,p=l(i.skin),g=l(s),b=!(g&&l(s.fragmentShaderText))||s.mode!==F2.REPLACE_MATERIAL,x=je.hasQuantizedAttributes(n.attributes),E=r.debugWireframe&&Fe.isTriangles(n.primitiveType)&&(r._enableDebugWireframe||a),C=r.pointCloudShading,w=l(C)&&C.attenuation,S=l(C)&&C.backFaceCulling,v=n.primitiveType===Fe.POINTS&&(l(o)||w||S),D=r._enableShowOutline&&l(n.outlineCoordinates),L=khe(r,i,n),O=l(r.classificationType);u&&t.push(oF),t.push(Ii),E&&t.push(lF),O&&t.push(L2),d&&t.push(tr),p&&t.push(fu),v&&t.push(Z2),x&&t.push(tp),b&&t.push($2),t.push(Mt),t.push(dt),L.hasPropertyTable&&(t.push(Eu),t.push(M2),t.push(P2)),h&&t.push(cF),g&&t.push(Vi),t.push(W2),r.allowPicking&&t.push(Y2),D&&t.push(J2),t.push(D2),t.push(Q2)};function khe(e,t,n){let i;return l(t.instances)&&(i=je.getFeatureIdsByLabel(t.instances.featureIds,e.instanceFeatureIdLabel),l(i))?{hasFeatureIds:!0,hasPropertyTable:l(i.propertyTableId)}:(i=je.getFeatureIdsByLabel(n.featureIds,e.featureIdLabel),l(i)?{hasFeatureIds:!0,hasPropertyTable:l(i.propertyTableId)}:{hasFeatureIds:!1,hasPropertyTable:!1})}function zw(e){e=T(e,T.EMPTY_OBJECT),y.typeOf.object("options.skin",e.skin),y.typeOf.object("options.sceneGraph",e.sceneGraph),this._sceneGraph=e.sceneGraph;const t=e.skin;this._skin=t,this._inverseBindMatrices=void 0,this._joints=[],this._jointMatrices=[],jhe(this)}Object.defineProperties(zw.prototype,{skin:{get:function(){return this._skin}},sceneGraph:{get:function(){return this._sceneGraph}},inverseBindMatrices:{get:function(){return this._inverseBindMatrices}},joints:{get:function(){return this._joints}},jointMatrices:{get:function(){return this._jointMatrices}}});function jhe(e){const t=e.skin,n=t.inverseBindMatrices;e._inverseBindMatrices=n;const i=t.joints,r=i.length,s=e.sceneGraph._runtimeNodes,o=e.joints,a=e._jointMatrices;for(let c=0;c<r;c++){const u=i[c].index,h=s[u];o.push(h);const d=n[c],p=fF(h,d,new P);a.push(p)}}function fF(e,t,n){const i=P.multiplyTransformation(e.transformToRoot,e.transform,n);return n=P.multiplyTransformation(i,t,n),n}zw.prototype.updateJointMatrices=function(){const e=this._jointMatrices,t=e.length;for(let n=0;n<t;n++){const i=this.joints[n],r=this.inverseBindMatrices[n];e[n]=fF(i,r,e[n])}};function Vhe(){this.pass=void 0,this.alphaCutoff=void 0}function Ghe(e){y.typeOf.object("model",e),this.shaderBuilder=new Gr,this.model=e,this.uniformMap={},this.alphaOptions=new Vhe,this.renderStateOptions=it.getState(it.fromCache({depthTest:{enabled:!0,func:Xy.LESS_OR_EQUAL}})),this.hasSilhouette=!1,this.hasSkipLevelOfDetail=!1}const Hhe=`void silhouetteStage(inout vec4 color) {
    if(model_silhouettePass) {
        color = czm_gammaCorrect(model_silhouetteColor);
    }
}`,qhe=`void silhouetteStage(in ProcessedAttributes attributes, inout vec4 positionClip) {
     #ifdef HAS_NORMALS
     if(model_silhouettePass) {
          vec3 normal = normalize(czm_normal3D * attributes.normalMC);
          normal.x *= czm_projection[0][0];
          normal.y *= czm_projection[1][1];
          positionClip.xy += normal.xy * positionClip.w * model_silhouetteSize * czm_pixelRatio / czm_viewport.z;
    }
    #endif
}
`,ay={name:"ModelSilhouettePipelineStage"};ay.silhouettesLength=0;ay.process=function(e,t,n){l(t._silhouetteId)||(t._silhouetteId=++ay.silhouettesLength);const i=e.shaderBuilder;i.addDefine("HAS_SILHOUETTE",void 0,Q.BOTH),i.addVertexLines(qhe),i.addFragmentLines(Hhe),i.addUniform("vec4","model_silhouetteColor",Q.FRAGMENT),i.addUniform("float","model_silhouetteSize",Q.VERTEX),i.addUniform("bool","model_silhouettePass",Q.BOTH);const r={model_silhouetteColor:function(){return t.silhouetteColor},model_silhouetteSize:function(){return t.silhouetteSize},model_silhouettePass:function(){return!1}};e.uniformMap=wt(r,e.uniformMap),e.hasSilhouette=!0};const Whe=`void modelSplitterStage()
{
    // Don't split when rendering the shadow map, because it is rendered from
    // the perspective of a totally different camera.
#ifndef SHADOW_MAP
    if (model_splitDirection < 0.0 && gl_FragCoord.x > czm_splitPosition) discard;
    if (model_splitDirection > 0.0 && gl_FragCoord.x < czm_splitPosition) discard;
#endif
}
`,f_={name:"ModelSplitterPipelineStage",SPLIT_DIRECTION_UNIFORM_NAME:"model_splitDirection"};f_.process=function(e,t,n){const i=e.shaderBuilder;i.addDefine("HAS_MODEL_SPLITTER",void 0,Q.FRAGMENT),i.addFragmentLines(Whe);const r={};i.addUniform("float",f_.SPLIT_DIRECTION_UNIFORM_NAME,Q.FRAGMENT),r[f_.SPLIT_DIRECTION_UNIFORM_NAME]=function(){return t.splitDirection},e.uniformMap=wt(r,e.uniformMap)};function $he(e,t){y.typeOf.object("modelRenderResources",e),y.typeOf.object("runtimeNode",t),this.model=e.model,this.shaderBuilder=e.shaderBuilder.clone(),this.uniformMap=Se(e.uniformMap),this.alphaOptions=Se(e.alphaOptions),this.renderStateOptions=Se(e.renderStateOptions,!0),this.hasSilhouette=e.hasSilhouette,this.hasSkipLevelOfDetail=e.hasSkipLevelOfDetail,this.runtimeNode=t,this.attributes=[],this.attributeIndex=1,this.featureIdVertexAttributeSetIndex=0,this.instanceCount=0}function Xhe(e){e=T(e,T.EMPTY_OBJECT),this.lightingModel=T(e.lightingModel,oy.UNLIT)}function Yhe(e,t){y.typeOf.object("nodeRenderResources",e),y.typeOf.object("runtimePrimitive",t),this.model=e.model,this.runtimeNode=e.runtimeNode,this.attributes=e.attributes.slice(),this.attributeIndex=e.attributeIndex,this.featureIdVertexAttributeSetIndex=e.featureIdVertexAttributeSetIndex,this.uniformMap=Se(e.uniformMap),this.alphaOptions=Se(e.alphaOptions),this.renderStateOptions=Se(e.renderStateOptions,!0),this.hasSilhouette=e.hasSilhouette,this.hasSkipLevelOfDetail=e.hasSkipLevelOfDetail,this.shaderBuilder=e.shaderBuilder.clone(),this.instanceCount=e.instanceCount,this.runtimePrimitive=t;const n=t.primitive;this.count=l(n.indices)?n.indices.count:je.getAttributeBySemantic(n,"POSITION").count,this.hasPropertyTable=!1,this.indices=n.indices,this.wireframeIndexBuffer=void 0,this.primitiveType=n.primitiveType;const i=je.getPositionMinMax(n,this.runtimeNode.instancingTranslationMin,this.runtimeNode.instancingTranslationMax);this.positionMin=m.clone(i.min,new m),this.positionMax=m.clone(i.max,new m),this.boundingSphere=ee.fromCornerPoints(this.positionMin,this.positionMax,new ee),this.lightingOptions=new Xhe,this.pickId=void 0}function Is(e){e=T(e,T.EMPTY_OBJECT);const t=e.modelComponents;y.typeOf.object("options.model",e.model),y.typeOf.object("options.modelComponents",t),this._model=e.model,this._components=t,this._pipelineStages=[],this._updateStages=[],this._runtimeNodes=[],this._rootNodes=[],this._skinnedNodes=[],this._runtimeSkins=[],this.modelPipelineStages=[],this._boundingSphere=void 0,this._boundingSphere2D=void 0,this._computedModelMatrix=P.clone(P.IDENTITY),this._computedModelMatrix2D=P.clone(P.IDENTITY),this._axisCorrectionMatrix=je.getAxisCorrectionMatrix(t.upAxis,t.forwardAxis,new P),this._runtimeArticulations={},Khe(this)}Object.defineProperties(Is.prototype,{components:{get:function(){return this._components}},computedModelMatrix:{get:function(){return this._computedModelMatrix}},axisCorrectionMatrix:{get:function(){return this._axisCorrectionMatrix}},boundingSphere:{get:function(){return this._boundingSphere}}});function Khe(e){const t=e._components,n=t.scene,r=e._model.modelMatrix;hF(e,r);const s=t.articulations,o=s.length,a=e._runtimeArticulations;for(let C=0;C<o;C++){const w=s[C],S=new ib({articulation:w,sceneGraph:e}),v=S.name;a[v]=S}const c=t.nodes,u=c.length;e._runtimeNodes=new Array(u);const d=n.nodes.length,p=P.IDENTITY;for(let C=0;C<d;C++){const w=n.nodes[C],S=dF(e,w,p);e._rootNodes.push(S)}const g=t.skins,_=e._runtimeSkins,b=g.length;for(let C=0;C<b;C++){const w=g[C];_.push(new zw({skin:w,sceneGraph:e}))}const x=e._skinnedNodes,E=x.length;for(let C=0;C<E;C++){const w=x[C],S=e._runtimeNodes[w],D=c[w].skin.index;S._runtimeSkin=_[D],S.updateJointMatrices()}e.applyArticulations()}function hF(e,t){const n=e._components,i=e._model;e._computedModelMatrix=P.multiplyTransformation(t,n.transform,e._computedModelMatrix),e._computedModelMatrix=P.multiplyTransformation(e._computedModelMatrix,e._axisCorrectionMatrix,e._computedModelMatrix),e._computedModelMatrix=P.multiplyByUniformScale(e._computedModelMatrix,i.computedScale,e._computedModelMatrix)}const Zhe=new m;function Jhe(e,t){const n=e._computedModelMatrix,i=P.getTranslation(n,Zhe);if(!m.equals(i,m.ZERO))e._computedModelMatrix2D=et.basisTo2D(t.mapProjection,n,e._computedModelMatrix2D);else{const r=e.boundingSphere.center,s=et.ellipsoidTo2DModelMatrix(t.mapProjection,r,e._computedModelMatrix2D);e._computedModelMatrix2D=P.multiply(s,n,e._computedModelMatrix2D)}e._boundingSphere2D=ee.transform(e._boundingSphere,e._computedModelMatrix2D,e._boundingSphere2D)}function dF(e,t,n){const i=[],r=je.getNodeTransform(t),s=t.children.length;for(let h=0;h<s;h++){const d=t.children[h],p=P.multiplyTransformation(n,r,new P),g=dF(e,d,p);i.push(g)}const o=new zh({node:t,transform:r,transformToRoot:n,children:i,sceneGraph:e}),a=t.primitives.length;for(let h=0;h<a;h++)o.runtimePrimitives.push(new uF({primitive:t.primitives[h],node:t,model:e._model}));const c=t.index;e._runtimeNodes[c]=o,l(t.skin)&&e._skinnedNodes.push(c);const u=t.name;if(l(u)){const h=e._model,d=new T2(h,o);h._nodesByName[u]=d}return c}const Qhe=new m,ede=new m,tde=new m,nde=new m;Is.prototype.buildDrawCommands=function(e){const t=this._model,n=new Ghe(t);t.statistics.clear(),this.configurePipeline(e);const i=this.modelPipelineStages;let r,s,o;for(r=0;r<i.length;r++)i[r].process(n,t,e);const a=m.fromElements(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Qhe),c=m.fromElements(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,ede);for(r=0;r<this._runtimeNodes.length;r++){const u=this._runtimeNodes[r];if(!l(u))continue;u.configurePipeline();const h=u.pipelineStages,d=new $he(n,u);for(s=0;s<h.length;s++)h[s].process(d,u.node,e);const p=u.computedTransform;for(s=0;s<u.runtimePrimitives.length;s++){const g=u.runtimePrimitives[s];g.configurePipeline(e);const _=g.pipelineStages,b=new Yhe(d,g);for(o=0;o<_.length;o++)_[o].process(b,g.primitive,e);g.boundingSphere=ee.clone(b.boundingSphere,new ee);const x=P.multiplyByPoint(p,b.positionMin,tde),E=P.multiplyByPoint(p,b.positionMax,nde);m.minimumByComponent(a,x,a),m.maximumByComponent(c,E,c);const C=tue(b,e);g.drawCommand=C}}this._boundingSphere=ee.fromCornerPoints(a,c,new ee),this._boundingSphere=ee.transformWithoutScale(this._boundingSphere,this._axisCorrectionMatrix,this._boundingSphere),this._boundingSphere=ee.transform(this._boundingSphere,this._components.transform,this._boundingSphere),t._boundingSphere=ee.transform(this._boundingSphere,t.modelMatrix,t._boundingSphere),t._initialRadius=t._boundingSphere.radius,t._boundingSphere.radius*=t._clampedScale};Is.prototype.configurePipeline=function(e){const t=this.modelPipelineStages;t.length=0;const n=this._model,i=e.fog.enabled&&e.fog.renderable;l(n.color)&&t.push(Xc),!l(n.classificationType)&&(n.imageBasedLighting.enabled&&t.push(_2),n.isClippingEnabled()&&t.push(y2),n.isClippingPolygonsEnabled()&&t.push(b2),n.hasSilhouette(e)&&t.push(ay),l(n.splitDirection)&&n.splitDirection!==tm.NONE&&t.push(f_),Or.is3DTiles(n.type)&&t.push(m2),i&&t.push(g2))};Is.prototype.update=function(e,t){let n,i,r;for(n=0;n<this._runtimeNodes.length;n++){const s=this._runtimeNodes[n];if(!l(s))continue;for(i=0;i<s.updateStages.length;i++)s.updateStages[i].update(s,this,e);const o=e.mode!==Ie.SCENE3D&&this._model._projectTo2D;for(t&&!o&&this.updateJointMatrices(),i=0;i<s.runtimePrimitives.length;i++){const a=s.runtimePrimitives[i];for(r=0;r<a.updateStages.length;r++)a.updateStages[r].update(a,this)}}};Is.prototype.updateModelMatrix=function(e,t){hF(this,e),t.mode!==Ie.SCENE3D&&Jhe(this,t);const n=this._rootNodes;for(let i=0;i<n.length;i++){const r=this._runtimeNodes[n[i]];r._transformDirty=!0}};Is.prototype.updateJointMatrices=function(){const e=this._skinnedNodes,t=e.length;for(let n=0;n<t;n++){const i=e[n];this._runtimeNodes[i].updateJointMatrices()}};function pF(e,t,n,i,r){if(n&&!t.show)return;const s=t.children.length;for(let c=0;c<s;c++){const u=t.getChild(c);pF(e,u,n,i,r)}const o=t.runtimePrimitives,a=o.length;for(let c=0;c<a;c++){const u=o[c];i(u,r)}}function rb(e,t,n,i){const r=e._rootNodes,s=r.length;for(let o=0;o<s;o++){const a=r[o],c=e._runtimeNodes[a];pF(e,c,t,n,i)}}const ide={backFaceCulling:void 0};Is.prototype.updateBackFaceCulling=function(e){const t=ide;t.backFaceCulling=e,rb(this,!1,rde,t)};function rde(e,t){const n=e.drawCommand;n.backFaceCulling=t.backFaceCulling}const sde={shadowMode:void 0};Is.prototype.updateShadows=function(e){const t=sde;t.shadowMode=e,rb(this,!1,ode,t)};function ode(e,t){const n=e.drawCommand;n.shadows=t.shadowMode}const ade={debugShowBoundingVolume:void 0};Is.prototype.updateShowBoundingVolume=function(e){const t=ade;t.debugShowBoundingVolume=e,rb(this,!1,cde,t)};function cde(e,t){const n=e.drawCommand;n.debugShowBoundingVolume=t.debugShowBoundingVolume}const mF=[],lde={frameState:void 0,hasSilhouette:void 0};Is.prototype.pushDrawCommands=function(e){const t=mF;t.length=0;const n=lde;n.hasSilhouette=this._model.hasSilhouette(e),n.frameState=e,rb(this,!0,ude,n),e.commandList.push.apply(e.commandList,t)};function ude(e,t){const n=t.frameState,i=t.hasSilhouette,r=n.passes,s=mF,o=e.drawCommand;o.pushCommands(n,n.commandList),i&&!r.pick&&o.pushSilhouetteCommands(n,s)}Is.prototype.setArticulationStage=function(e,t){const n=e.split(" ");if(n.length!==2)return;const i=n[0],r=n[1],s=this._runtimeArticulations[i];l(s)&&s.setArticulationStage(r,t)};Is.prototype.applyArticulations=function(){const e=this._runtimeArticulations;for(const t in e)e.hasOwnProperty(t)&&e[t].apply()};function Uh(){this.pointsLength=0,this.trianglesLength=0,this.geometryByteLength=0,this.texturesByteLength=0,this.propertyTablesByteLength=0,this._bufferIdSet={},this._textureIdSet={},this._batchTextureIdMap=new Lu}Object.defineProperties(Uh.prototype,{batchTexturesByteLength:{get:function(){const e=this._batchTextureIdMap.length,t=this._batchTextureIdMap.values;let n=0;for(let i=0;i<e;i++)n+=t[i].byteLength;return n}}});Uh.prototype.clear=function(){this.pointsLength=0,this.trianglesLength=0,this.geometryByteLength=0,this.texturesByteLength=0,this.propertyTablesByteLength=0,this._bufferIdSet={},this._textureIdSet={},this._batchTextureIdMap.removeAll()};Uh.prototype.addBuffer=function(e,t){if(y.typeOf.object("buffer",e),y.typeOf.bool("hasCpuCopy",t),!this._bufferIdSet.hasOwnProperty(e._id)){const n=t?2:1;this.geometryByteLength+=e.sizeInBytes*n}this._bufferIdSet[e._id]=!0};Uh.prototype.addTexture=function(e){y.typeOf.object("texture",e),this._textureIdSet.hasOwnProperty(e._id)||(this.texturesByteLength+=e.sizeInBytes),this._textureIdSet[e._id]=!0};Uh.prototype.addBatchTexture=function(e){y.typeOf.object("batchTexture",e),this._batchTextureIdMap.contains(e._id)||this._batchTextureIdMap.set(e._id,e)};const gF={},Zl=Uint32Array.BYTES_PER_ELEMENT;gF.parse=function(e,t){t=T(t,0),y.defined("arrayBuffer",e);const n=new Uint8Array(e),i=new DataView(e);t+=Zl;const r=i.getUint32(t,!0);if(r!==1)throw new te(`Only Point Cloud tile version 1 is supported.  Version ${r} is not.`);t+=Zl,t+=Zl;const s=i.getUint32(t,!0);if(s===0)throw new te("Feature table must have a byte length greater than zero");t+=Zl;const o=i.getUint32(t,!0);t+=Zl;const a=i.getUint32(t,!0);t+=Zl;const c=i.getUint32(t,!0);t+=Zl;const u=Cs(n,t,s);t+=s;const h=new Uint8Array(e,t,o);t+=o;let d,p;a>0&&(d=Cs(n,t,a),t+=a,c>0&&(p=new Uint8Array(e,t,c),t+=c));const g=new Ll(u,h),_=g.getGlobalProperty("POINTS_LENGTH");if(g.featuresLength=_,!l(_))throw new te("Feature table global property: POINTS_LENGTH must be defined");let b=g.getGlobalProperty("RTC_CENTER",q.FLOAT,3);l(b)&&(b=m.unpack(b));const x=fde(g,d);if(x.rtcCenter=b,x.pointsLength=_,!x.hasPositions){const E=hde(g);x.positions=E,x.hasPositions=x.hasPositions||l(E)}if(!x.hasPositions)throw new te("Either POSITION or POSITION_QUANTIZED must be defined.");if(!x.hasNormals){const E=pde(g);x.normals=E,x.hasNormals=x.hasNormals||l(E)}if(!x.hasColors){const E=dde(g);x.colors=E,x.hasColors=x.hasColors||l(E),x.hasConstantColor=l(x.constantColor),x.isTranslucent=l(E)&&E.isTranslucent}if(!x.hasBatchIds){const E=mde(g);x.batchIds=E,x.hasBatchIds=x.hasBatchIds||l(E)}if(x.hasBatchIds){const E=g.getGlobalProperty("BATCH_LENGTH");if(!l(E))throw new te("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");x.batchLength=E}return l(p)&&(p=new Uint8Array(p),x.batchTableJson=d,x.batchTableBinary=p),x};function fde(e,t){const n=e.json;let i,r,s;const o=l(n.extensions)?n.extensions["3DTILES_draco_point_compression"]:void 0,a=l(t)&&l(t.extensions)?t.extensions["3DTILES_draco_point_compression"]:void 0;l(a)&&(s=a.properties);let c,u,h,d,p;if(l(o)){r=o.properties;const _=o.byteOffset,b=o.byteLength;if(!l(r)||!l(_)||!l(b))throw new te("Draco properties, byteOffset, and byteLength must be defined");i=e.buffer.slice(_,_+b),c=l(r.POSITION),u=l(r.RGB)||l(r.RGBA),h=l(r.NORMAL),d=l(r.BATCH_ID),p=l(r.RGBA)}let g;return l(i)&&(g={buffer:i,featureTableProperties:r,batchTableProperties:s,properties:wt(r,s),dequantizeInShader:!0}),{draco:g,hasPositions:c,hasColors:u,isTranslucent:p,hasNormals:h,hasBatchIds:d}}function hde(e){const t=e.json;let n;if(l(t.POSITION))return n=e.getPropertyArray("POSITION",q.FLOAT,3),{name:Me.POSITION,semantic:Me.POSITION,typedArray:n,isQuantized:!1,componentDatatype:q.FLOAT,type:tt.VEC3};if(l(t.POSITION_QUANTIZED)){n=e.getPropertyArray("POSITION_QUANTIZED",q.UNSIGNED_SHORT,3);const i=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",q.FLOAT,3);if(!l(i))throw new te("Global property: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const r=65535,s=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",q.FLOAT,3);if(!l(s))throw new te("Global property: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");return{name:Me.POSITION,semantic:Me.POSITION,typedArray:n,isQuantized:!0,componentDatatype:q.FLOAT,type:tt.VEC3,quantizedRange:r,quantizedVolumeOffset:m.unpack(s),quantizedVolumeScale:m.unpack(i),quantizedComponentDatatype:q.UNSIGNED_SHORT,quantizedType:tt.VEC3}}}function dde(e){const t=e.json;let n;if(l(t.RGBA))return n=e.getPropertyArray("RGBA",q.UNSIGNED_BYTE,4),{name:Me.COLOR,semantic:Me.COLOR,setIndex:0,typedArray:n,componentDatatype:q.UNSIGNED_BYTE,type:tt.VEC4,normalized:!0,isRGB565:!1,isTranslucent:!0};if(l(t.RGB))return n=e.getPropertyArray("RGB",q.UNSIGNED_BYTE,3),{name:"COLOR",semantic:Me.COLOR,setIndex:0,typedArray:n,componentDatatype:q.UNSIGNED_BYTE,type:tt.VEC3,normalized:!0,isRGB565:!1,isTranslucent:!1};if(l(t.RGB565))return n=e.getPropertyArray("RGB565",q.UNSIGNED_SHORT,1),{name:"COLOR",semantic:Me.COLOR,setIndex:0,typedArray:n,componentDatatype:q.FLOAT,type:tt.VEC3,normalized:!1,isRGB565:!0,isTranslucent:!1};if(l(t.CONSTANT_RGBA)){const i=e.getGlobalProperty("CONSTANT_RGBA",q.UNSIGNED_BYTE,4),r=i[3],s=M.fromBytes(i[0],i[1],i[2],r),o=r<255;return{name:Me.COLOR,semantic:Me.COLOR,setIndex:0,constantColor:s,componentDatatype:q.FLOAT,type:tt.VEC4,isQuantized:!1,isTranslucent:o}}}function pde(e){const t=e.json;let n;if(l(t.NORMAL))return n=e.getPropertyArray("NORMAL",q.FLOAT,3),{name:Me.NORMAL,semantic:Me.NORMAL,typedArray:n,octEncoded:!1,octEncodedZXY:!1,componentDatatype:q.FLOAT,type:tt.VEC3};if(l(t.NORMAL_OCT16P))return n=e.getPropertyArray("NORMAL_OCT16P",q.UNSIGNED_BYTE,2),{name:Me.NORMAL,semantic:Me.NORMAL,typedArray:n,octEncoded:!0,octEncodedZXY:!1,quantizedRange:(1<<8)-1,quantizedType:tt.VEC2,quantizedComponentDatatype:q.UNSIGNED_BYTE,componentDatatype:q.FLOAT,type:tt.VEC3}}function mde(e){const t=e.json;if(l(t.BATCH_ID)){const n=e.getPropertyArray("BATCH_ID",q.UNSIGNED_SHORT,1);return{name:Me.FEATURE_ID,semantic:Me.FEATURE_ID,setIndex:0,typedArray:n,componentDatatype:q.fromTypedArray(n),type:tt.SCALAR}}}const gde=Be.Components,_de=Be.Scene,yde=Be.Node,bde=Be.Primitive,Tde=Be.Attribute,tO=Be.Quantization,xde=Be.FeatureIdAttribute,Ede=Be.Material,Cde=Be.MetallicRoughness;function hl(e){e=T(e,T.EMPTY_OBJECT);const t=e.arrayBuffer,n=T(e.byteOffset,0);y.typeOf.object("options.arrayBuffer",t),this._arrayBuffer=t,this._byteOffset=n,this._loadAttributesFor2D=T(e.loadAttributesFor2D,!1),this._parsedContent=void 0,this._decodePromise=void 0,this._decodedAttributes=void 0,this._promise=void 0,this._error=void 0,this._state=Oe.UNLOADED,this._buffers=[],this._components=void 0,this._transform=P.IDENTITY}l(Object.create)&&(hl.prototype=Object.create(ai.prototype),hl.prototype.constructor=hl);Object.defineProperties(hl.prototype,{cacheKey:{get:function(){}},components:{get:function(){return this._components}},transform:{get:function(){return this._transform}}});hl.prototype.load=function(){if(l(this._promise))return this._promise;this._parsedContent=gF.parse(this._arrayBuffer,this._byteOffset),this._state=Oe.PROCESSING,this._promise=Promise.resolve(this)};hl.prototype.process=function(e){if(l(this._error)){const t=this._error;throw this._error=void 0,t}if(this._state===Oe.READY)return!0;if(this._state===Oe.PROCESSING){if(l(this._decodePromise))return!1;this._decodePromise=wde(this,e.context)}return!1};function wde(e,t){const i=e._parsedContent.draco;let r;if(l(i)?r=Hn.decodePointCloud(i,t):r=Promise.resolve(),!!l(r))return e._decodePromise=r,r.then(function(s){if(!e.isDestroyed())return l(s)&&Ade(e,i,s),Fde(e,t),e._state=Oe.READY,e}).catch(function(s){e.unload(),e._state=Oe.FAILED;const o="Failed to load Draco pnts";e._error=e.getError(o,s)})}function Ade(e,t,n){e._state=Oe.READY;const i=e._parsedContent;let r;if(l(n.POSITION)){if(r={name:"POSITION",semantic:Me.POSITION,typedArray:n.POSITION.array,componentDatatype:q.FLOAT,type:tt.VEC3,isQuantized:!1},l(n.POSITION.data.quantization)){const a=n.POSITION.data.quantization,c=a.range,u=m.fromElements(c,c,c),h=m.unpack(a.minValues),d=(1<<a.quantizationBits)-1;r.isQuantized=!0,r.quantizedRange=d,r.quantizedVolumeOffset=h,r.quantizedVolumeScale=u,r.quantizedComponentDatatype=d<=255?q.UNSIGNED_BYTE:q.UNSIGNED_SHORT,r.quantizedType=tt.VEC3}i.positions=r}if(l(n.NORMAL)){if(r={name:"NORMAL",semantic:Me.NORMAL,typedArray:n.NORMAL.array,componentDatatype:q.FLOAT,type:tt.VEC3,isQuantized:!1,octEncoded:!1,octEncodedZXY:!1},l(n.NORMAL.data.quantization)){const a=(1<<n.NORMAL.data.quantization.quantizationBits)-1;r.quantizedRange=a,r.octEncoded=!0,r.octEncodedZXY=!0,r.quantizedComponentDatatype=q.UNSIGNED_BYTE,r.quantizedType=tt.VEC2}i.normals=r}if(l(n.RGBA)?i.colors={name:"COLOR",semantic:Me.COLOR,setIndex:0,typedArray:n.RGBA.array,componentDatatype:q.UNSIGNED_BYTE,type:tt.VEC4,normalized:!0,isTranslucent:!0}:l(n.RGB)&&(i.colors={name:"COLOR",semantic:Me.COLOR,setIndex:0,typedArray:n.RGB.array,componentDatatype:q.UNSIGNED_BYTE,type:tt.VEC3,normalized:!0,isTranslucent:!1}),l(n.BATCH_ID)){const a=n.BATCH_ID.array;i.batchIds={name:"_FEATURE_ID",semantic:Me.FEATURE_ID,setIndex:0,typedArray:a,componentDatatype:q.fromTypedArray(a),type:tt.SCALAR}}let s=i.batchTableJson;const o=t.batchTableProperties;for(const a in o)if(o.hasOwnProperty(a)){const c=n[a];l(s)||(s={}),i.hasDracoBatchTable=!0;const u=c.data;s[a]={byteOffset:u.byteOffset,type:Sde(u.componentsPerAttribute),componentType:vde(u.componentDatatype),typedArray:c.array}}i.batchTableJson=s}function Sde(e){switch(e){case 1:return"SCALAR";case 2:return"VEC2";case 3:return"VEC3";case 4:return"VEC4";default:throw new A("componentsPerAttribute must be a number from 1-4")}}function vde(e){switch(e){case j.BYTE:return"BYTE";case j.UNSIGNED_BYTE:return"UNSIGNED_BYTE";case j.SHORT:return"SHORT";case j.UNSIGNED_SHORT:return"UNSIGNED_SHORT";case j.INT:return"INT";case j.UNSIGNED_INT:return"UNSIGNED_INT";case j.DOUBLE:return"DOUBLE";case j.FLOAT:return"FLOAT";default:throw new A("value is not a valid WebGL constant")}}function _d(e,t,n){let i=t.typedArray,r;if(t.octEncoded&&(r=new tO,r.octEncoded=t.octEncoded,r.octEncodedZXY=t.octEncodedZXY,r.normalizationRange=t.quantizedRange,r.type=t.quantizedType,r.componentDatatype=t.quantizedComponentDatatype),t.isQuantized){r=new tO;const a=t.quantizedRange;r.normalizationRange=a,r.quantizedVolumeOffset=m.ZERO;const c=t.quantizedVolumeScale;r.quantizedVolumeDimensions=c,r.quantizedVolumeStepSize=m.divideByScalar(c,a,new m),r.componentDatatype=t.quantizedComponentDatatype,r.type=t.quantizedType}const s=new Tde;if(s.name=t.name,s.semantic=t.semantic,s.setIndex=t.setIndex,s.componentDatatype=t.componentDatatype,s.type=t.type,s.normalized=T(t.normalized,!1),s.min=t.min,s.max=t.max,s.quantization=r,t.isRGB565&&(i=nt.decodeRGB565(i)),l(t.constantColor)){const a=new Array(4);s.constant=M.pack(t.constantColor,a)}else{const a=ze.createVertexBuffer({typedArray:i,context:n,usage:Ae.STATIC_DRAW});a.vertexArrayDestroyable=!1,e._buffers.push(a),s.buffer=a}const o=e._loadAttributesFor2D;return s.semantic===Me.POSITION&&o&&(s.typedArray=i),s}let nO,Cg;function Ide(e){if(!l(Cg)){nO=new CC(0),Cg=new Array(e);for(let t=0;t<e;++t)Cg[t]=nO.random()}return Cg}const Ode=new m,Rde=new m,Dde=new m;function Mde(e){const t=e.typedArray,n=20,i=t.length/3,r=Math.min(i,n),s=Ide(n),o=Number.MAX_VALUE,a=-Number.MAX_VALUE;let c=m.fromElements(o,o,o,Ode),u=m.fromElements(a,a,a,Rde),h,d,p;if(e.isQuantized)c=m.ZERO,u=e.quantizedVolumeScale;else for(h=0;h<r;++h)d=Math.floor(s[h]*i),p=m.unpack(t,d*3,Dde),m.minimumByComponent(c,p,c),m.maximumByComponent(u,p,u);e.min=m.clone(c),e.max=m.clone(u)}const Lde={name:Me.COLOR,semantic:Me.COLOR,setIndex:0,constantColor:M.DARKGRAY,componentDatatype:q.FLOAT,type:tt.VEC4,isQuantized:!1,isTranslucent:!1};function Pde(e,t,n){const i=[];let r;const s=t.positions;return l(s)&&(Mde(s),r=_d(e,s,n),r.count=t.pointsLength,i.push(r)),l(t.normals)&&(r=_d(e,t.normals,n),i.push(r)),l(t.colors)?(r=_d(e,t.colors,n),i.push(r)):(r=_d(e,Lde,n),i.push(r)),l(t.batchIds)&&(r=_d(e,t.batchIds,n),i.push(r)),i}function Nde(e,t){const n=e.batchLength,i=e.pointsLength,r=e.batchTableBinary,s=!l(e.batchIds);if(l(r)||e.hasDracoBatchTable){const o=T(n,i);return Uu({count:o,batchTable:e.batchTableJson,binaryBody:r,parseAsPropertyAttributes:s,customAttributeOutput:t})}return new zo({schema:{},propertyTables:[]})}function Fde(e,t){const n=e._parsedContent,i=new Cde;i.metallicFactor=0,i.roughnessFactor=.9;const r=new Ede;r.metallicRoughness=i;const s=n.colors;l(s)&&s.isTranslucent&&(r.alphaMode=Q_.BLEND);const o=!l(n.normals);r.unlit=o;const a=new bde;if(a.attributes=Pde(e,n,t),a.primitiveType=Fe.POINTS,a.material=r,l(n.batchIds)){const g=new xde;g.propertyTableId=0,g.setIndex=0,g.positionalLabel="featureId_0",a.featureIds.push(g)}const c=new yde;c.index=0,c.primitives=[a];const u=new _de;u.nodes=[c],u.upAxis=ir.Z,u.forwardAxis=ir.X;const h=new gde;h.scene=u,h.nodes=[c];const d=[];h.structuralMetadata=Nde(n,d),d.length>0&&Bde(e,a,d,t),l(n.rtcCenter)&&(h.transform=P.multiplyByTranslation(h.transform,n.rtcCenter,h.transform));const p=n.positions;l(p)&&p.isQuantized&&(h.transform=P.multiplyByTranslation(h.transform,p.quantizedVolumeOffset,h.transform)),e._components=h,e._parsedContent=void 0,e._arrayBuffer=void 0}function Bde(e,t,n,i){const r=t.attributes,s=n.length;for(let o=0;o<s;o++){const a=n[o],c=ze.createVertexBuffer({typedArray:a.typedArray,context:i,usage:Ae.STATIC_DRAW});c.vertexArrayDestroyable=!1,e._buffers.push(c),a.buffer=c,a.typedArray=void 0,r.push(a)}t.propertyAttributeIds=[0]}hl.prototype.unload=function(){const e=this._buffers;for(let t=0;t<e.length;t++)e[t].destroy();e.length=0,this._components=void 0,this._parsedContent=void 0,this._arrayBuffer=void 0};const zde=new m,Ude=new m,kde=new m,jde=new P,Vde=new P,Gde=new P,Hde=new oe,qde=new ee;function Wde(e,t,n,i,r,s,o){if(y.typeOf.object("model",e),y.typeOf.object("ray",t),y.typeOf.object("frameState",n),!e._ready||n.mode===Ie.MORPHING)return;let a=Number.MAX_VALUE;const c=e.sceneGraph,u=c._runtimeNodes;for(let h=0;h<u.length;h++){const d=u[h],p=d.node;let g=P.clone(d.computedTransform,jde),_=P.clone(c.computedModelMatrix,Vde);const b=p.instances;l(b)&&b.transformInWorldSpace&&(_=P.multiplyTransformation(e.modelMatrix,c.components.transform,_),g=P.multiplyTransformation(c.axisCorrectionMatrix,d.computedTransform,g));let x=P.multiplyTransformation(_,g,Gde);n.mode!==Ie.SCENE3D&&(x=et.basisTo2D(n.mapProjection,x,x));const E=[];if(l(b)){const w=b.attributes[0].count,S=b.attributes[0].componentDatatype,v=12;let D=d.transformsTypedArray;if(!l(D)){const L=d.instancingTransformsBuffer;l(L)&&n.context.webgl2&&(D=q.createTypedArray(S,w*v),L.getBufferData(D))}if(l(D))for(let L=0;L<w;L++){const O=L*v,N=new P(D[O],D[O+1],D[O+2],D[O+3],D[O+4],D[O+5],D[O+6],D[O+7],D[O+8],D[O+9],D[O+10],D[O+11],0,0,0,1);b.transformInWorldSpace?(P.multiplyTransformation(N,g,N),P.multiplyTransformation(_,N,N)):P.multiplyTransformation(N,x,N),E.push(N)}}E.length===0&&E.push(x);const C=d.runtimePrimitives.length;for(let w=0;w<C;w++){const S=d.runtimePrimitives[w],v=S.primitive;if(l(S.boundingSphere)&&!l(b)){const le=ee.transform(S.boundingSphere,x,qde),pe=Ct.raySphere(t,le);if(!l(pe))continue}const D=je.getAttributeBySemantic(v,Me.POSITION),L=D.byteOffset,O=D.byteStride,N=D.count;if(!l(v.indices))continue;let B=v.indices.typedArray;if(!l(B)){const le=v.indices.buffer,pe=v.indices.count,we=v.indices.indexDatatype;l(le)&&n.context.webgl2&&(we===Ge.UNSIGNED_BYTE?B=new Uint8Array(pe):we===Ge.UNSIGNED_SHORT?B=new Uint16Array(pe):we===Ge.UNSIGNED_INT&&(B=new Uint32Array(pe)),le.getBufferData(B))}let U=D.typedArray,V=D.componentDatatype,f=D.type;const I=D.quantization;l(I)&&(V=D.quantization.componentDatatype,f=D.quantization.type);const F=tt.getNumberOfComponents(f),G=q.getSizeInBytes(V),W=!l(U)&&l(O)&&O!==F*G;let X=F,Z=0;W&&(X=O/G,Z=L/G);const $=N*X;if(!l(U)){const le=D.buffer;l(le)&&n.context.webgl2&&(U=q.createTypedArray(V,$),le.getBufferData(U,W?0:L,0,$)),I&&D.normalized&&(U=nt.dequantize(U,V,f,N))}if(!l(B)||!l(U))return;s=T(s,fe.default),i=T(i,1),r=T(r,0);const ne=B.length;for(let le=0;le<ne;le+=3){const pe=B[le],we=B[le+1],me=B[le+2];for(const Pe of E){const ot=gT(U,pe,Z,X,I,Pe,i,r,s,zde),At=gT(U,we,Z,X,I,Pe,i,r,s,Ude),St=gT(U,me,Z,X,I,Pe,i,r,s,kde),he=Ct.rayTriangleParametric(t,ot,At,St,T(e.backFaceCulling,!0));l(he)&&he<a&&he>=0&&(a=he)}}}}if(a!==Number.MAX_VALUE){if(o=ya.getPoint(t,a,o),n.mode!==Ie.SCENE3D){m.fromElements(o.y,o.z,o.x,o);const h=n.mapProjection,d=h.ellipsoid,p=h.unproject(o,Hde);d.cartographicToCartesian(p,o)}return o}}function gT(e,t,n,i,r,s,o,a,c,u){const h=n+t*i;if(u.x=e[h],u.y=e[h+1],u.z=e[h+2],l(r))if(r.octEncoded){if(u=nt.octDecodeInRange(u,r.normalizationRange,u),r.octEncodedZXY){const d=u.x;u.x=u.z,u.z=u.y,u.y=d}}else u=m.multiplyComponents(u,r.quantizedVolumeStepSize,u),u=m.add(u,r.quantizedVolumeOffset,u);return u=P.multiplyByPoint(s,u,u),o!==1&&sl.getPosition(u,c,o,a,u),u}function Vt(e){e=T(e,T.EMPTY_OBJECT),y.typeOf.object("options.loader",e.loader),y.typeOf.object("options.resource",e.resource),this._loader=e.loader,this._resource=e.resource,this.type=T(e.type,Or.GLTF),this.modelMatrix=P.clone(T(e.modelMatrix,P.IDENTITY)),this._modelMatrix=P.clone(this.modelMatrix),this._scale=T(e.scale,1),this._minimumPixelSize=T(e.minimumPixelSize,0),this._maximumScale=e.maximumScale,this._clampedScale=l(this._maximumScale)?Math.min(this._scale,this._maximumScale):this._scale,this._computedScale=this._clampedScale,this._updateModelMatrix=!1,this.referenceMatrix=void 0,this._iblReferenceFrameMatrix=H.clone(H.IDENTITY),this._resourcesLoaded=!1,this._drawCommandsBuilt=!1,this._ready=!1,this._customShader=e.customShader,this._content=e.content,this._texturesLoaded=!1,this._defaultTexture=void 0,this._activeAnimations=new _c(this),this._clampAnimations=T(e.clampAnimations,!0),this._userAnimationDirty=!1,this._id=e.id,this._idDirty=!1,this._color=M.clone(e.color),this._colorBlendMode=T(e.colorBlendMode,vw.HIGHLIGHT),this._colorBlendAmount=T(e.colorBlendAmount,.5);const t=T(e.silhouetteColor,M.RED);this._silhouetteColor=M.clone(t),this._silhouetteSize=T(e.silhouetteSize,0),this._silhouetteDirty=!1,this._silhouetteId=void 0,this._cull=T(e.cull,!0),this._opaquePass=T(e.opaquePass,Ke.OPAQUE),this._allowPicking=T(e.allowPicking,!0),this._show=T(e.show,!0),this._style=void 0,this._styleDirty=!1,this._styleCommandsNeeded=void 0;let n=T(e.featureIdLabel,"featureId_0");typeof n=="number"&&(n=`featureId_${n}`),this._featureIdLabel=n;let i=T(e.instanceFeatureIdLabel,"instanceFeatureId_0");typeof i=="number"&&(i=`instanceFeatureId_${i}`),this._instanceFeatureIdLabel=i,this._featureTables=[],this._featureTableId=void 0,this._featureTableIdDirty=!0,this._pipelineResources=[],this._modelResources=[],this._pickIds=[],this._boundingSphere=new ee,this._initialRadius=void 0,this._heightReference=T(e.heightReference,fa.NONE),this._heightDirty=this._heightReference!==fa.NONE,this._removeUpdateHeightCallback=void 0,this._verticalExaggerationOn=!1,this._clampedModelMatrix=void 0;const r=e.scene;l(r)&&l(r.terrainProviderChanged)&&(this._terrainProviderChangedCallback=r.terrainProviderChanged.addEventListener(()=>{this._heightDirty=!0})),this._scene=r,this._distanceDisplayCondition=e.distanceDisplayCondition;const s=new Rw(e.pointCloudShading);this._pointCloudShading=s,this._attenuation=s.attenuation,this._pointCloudBackFaceCulling=s.backFaceCulling;const o=e.clippingPlanes;l(o)&&o.owner===void 0?di.setOwner(o,this,"_clippingPlanes"):this._clippingPlanes=o,this._clippingPlanesState=0,this._clippingPlanesMatrix=P.clone(P.IDENTITY);const a=e.clippingPolygons;l(a)&&a.owner===void 0?jn.setOwner(a,this,"_clippingPolygons"):this._clippingPolygons=a,this._clippingPolygonsState=0,this._lightColor=m.clone(e.lightColor),this._imageBasedLighting=l(e.imageBasedLighting)?e.imageBasedLighting:new Lh,this._shouldDestroyImageBasedLighting=!l(e.imageBasedLighting),this._backFaceCulling=T(e.backFaceCulling,!0),this._backFaceCullingDirty=!1,this._shadows=T(e.shadows,rc.ENABLED),this._shadowsDirty=!1,this._debugShowBoundingVolumeDirty=!1,this._debugShowBoundingVolume=T(e.debugShowBoundingVolume,!1),this._enableDebugWireframe=T(e.enableDebugWireframe,!1),this._enableShowOutline=T(e.enableShowOutline,!0),this._debugWireframe=T(e.debugWireframe,!1),this._debugWireframe===!0&&this._enableDebugWireframe===!1&&this.type===Or.GLTF&&kr("model-debug-wireframe-ignored","enableDebugWireframe must be set to true in Model.fromGltf, otherwise debugWireframe will be ignored.");let c=e.credit;typeof c=="string"&&(c=new zt(c)),this._credits=[],this._credit=c,this._resourceCredits=[],this._gltfCredits=[],this._showCreditsOnScreen=T(e.showCreditsOnScreen,!1),this._showCreditsOnScreenDirty=!0,this._splitDirection=T(e.splitDirection,tm.NONE),this._enableShowOutline=T(e.enableShowOutline,!0),this.showOutline=T(e.showOutline,!0),this.outlineColor=T(e.outlineColor,M.BLACK),this._classificationType=e.classificationType,this._statistics=new Uh,this._sceneMode=void 0,this._projectTo2D=T(e.projectTo2D,!1),this._enablePick=T(e.enablePick,!1),this._fogRenderable=void 0,this._skipLevelOfDetail=!1,this._ignoreCommands=T(e.ignoreCommands,!1),this._errorEvent=new jt,this._readyEvent=new jt,this._texturesReadyEvent=new jt,this._sceneGraph=void 0,this._nodesByName={},this.pickObject=e.pickObject}function _T(e,t){if(e._errorEvent.numberOfListeners>0){e._errorEvent.raiseEvent(t);return}console.log(t)}function $de(e,t){const n=e._featureTables,i=t.propertyTables,r=i.length;for(let s=0;s<r;s++){const o=i[s],a=new ti({model:e,propertyTable:o});n.push(a)}return n}function Xde(e,t){const n=t._featureIdLabel,i=t._instanceFeatureIdLabel;let r,s,o,a;for(r=0;r<e.nodes.length;r++)if(a=e.nodes[r],l(a.instances)&&(o=je.getFeatureIdsByLabel(a.instances.featureIds,i),l(o)&&l(o.propertyTableId)))return o.propertyTableId;for(r=0;r<e.nodes.length;r++)for(a=e.nodes[r],s=0;s<a.primitives.length;s++){const c=a.primitives[s],u=je.getFeatureIdsByLabel(c.featureIds,n);if(l(u))return u.propertyTableId}if(t._featureTables.length===1)return 0}function hE(e,t){if(!l(e)&&!l(t))return!1;if(l(e)!==l(t))return!0;const n=e.alpha,i=t.alpha;return Math.floor(n)!==Math.floor(i)||Math.ceil(n)!==Math.ceil(i)}Object.defineProperties(Vt.prototype,{ready:{get:function(){return this._ready}},errorEvent:{get:function(){return this._errorEvent}},readyEvent:{get:function(){return this._readyEvent}},incrementallyLoadTextures:{get:function(){return T(this._loader.incrementallyLoadTextures,!1)}},texturesReadyEvent:{get:function(){return this._texturesReadyEvent}},loader:{get:function(){return this._loader}},statistics:{get:function(){return this._statistics}},activeAnimations:{get:function(){return this._activeAnimations}},clampAnimations:{get:function(){return this._clampAnimations},set:function(e){this._clampAnimations=e}},cull:{get:function(){return this._cull}},opaquePass:{get:function(){return this._opaquePass}},pointCloudShading:{get:function(){return this._pointCloudShading},set:function(e){y.defined("pointCloudShading",e),e!==this._pointCloudShading&&this.resetDrawCommands(),this._pointCloudShading=e}},customShader:{get:function(){return this._customShader},set:function(e){e!==this._customShader&&this.resetDrawCommands(),this._customShader=e}},sceneGraph:{get:function(){return this._sceneGraph}},content:{get:function(){return this._content}},heightReference:{get:function(){return this._heightReference},set:function(e){e!==this._heightReference&&(this._heightDirty=!0),this._heightReference=e}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){if(l(e)&&e.far<=e.near)throw new A("far must be greater than near");this._distanceDisplayCondition=$n.clone(e,this._distanceDisplayCondition)}},structuralMetadata:{get:function(){return this._sceneGraph.components.structuralMetadata}},featureTableId:{get:function(){return this._featureTableId},set:function(e){this._featureTableId=e}},featureTables:{get:function(){return this._featureTables},set:function(e){this._featureTables=e}},id:{get:function(){return this._id},set:function(e){e!==this._id&&(this._idDirty=!0),this._id=e}},allowPicking:{get:function(){return this._allowPicking}},style:{get:function(){return this._style},set:function(e){this._style=e,this._styleDirty=!0}},color:{get:function(){return this._color},set:function(e){hE(e,this._color)&&this.resetDrawCommands(),this._color=M.clone(e,this._color)}},colorBlendMode:{get:function(){return this._colorBlendMode},set:function(e){this._colorBlendMode=e}},colorBlendAmount:{get:function(){return this._colorBlendAmount},set:function(e){this._colorBlendAmount=e}},silhouetteColor:{get:function(){return this._silhouetteColor},set:function(e){if(!M.equals(e,this._silhouetteColor)){const t=hE(e,this._silhouetteColor);this._silhouetteDirty=this._silhouetteDirty||t}this._silhouetteColor=M.clone(e,this._silhouetteColor)}},silhouetteSize:{get:function(){return this._silhouetteSize},set:function(e){if(e!==this._silhouetteSize){const t=this._silhouetteSize,n=e>0&&t===0||e===0&&t>0;this._silhouetteDirty=this._silhouetteDirty||n,this._backFaceCullingDirty=this._backFaceCullingDirty||n}this._silhouetteSize=e}},boundingSphere:{get:function(){if(!this._ready)throw new A("The model is not loaded. Use Model.readyEvent or wait for Model.ready to be true.");const e=l(this._clampedModelMatrix)?this._clampedModelMatrix:this.modelMatrix;return yF(this,e),this._boundingSphere}},debugShowBoundingVolume:{get:function(){return this._debugShowBoundingVolume},set:function(e){this._debugShowBoundingVolume!==e&&(this._debugShowBoundingVolumeDirty=!0),this._debugShowBoundingVolume=e}},debugWireframe:{get:function(){return this._debugWireframe},set:function(e){this._debugWireframe!==e&&this.resetDrawCommands(),this._debugWireframe=e,this._debugWireframe===!0&&this._enableDebugWireframe===!1&&this.type===Or.GLTF&&kr("model-debug-wireframe-ignored","enableDebugWireframe must be set to true in Model.fromGltfAsync, otherwise debugWireframe will be ignored.")}},show:{get:function(){return this._show},set:function(e){this._show=e}},featureIdLabel:{get:function(){return this._featureIdLabel},set:function(e){typeof e=="number"&&(e=`featureId_${e}`),y.typeOf.string("value",e),e!==this._featureIdLabel&&(this._featureTableIdDirty=!0),this._featureIdLabel=e}},instanceFeatureIdLabel:{get:function(){return this._instanceFeatureIdLabel},set:function(e){typeof e=="number"&&(e=`instanceFeatureId_${e}`),y.typeOf.string("value",e),e!==this._instanceFeatureIdLabel&&(this._featureTableIdDirty=!0),this._instanceFeatureIdLabel=e}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){e!==this._clippingPlanes&&(di.setOwner(e,this,"_clippingPlanes"),this.resetDrawCommands())}},clippingPolygons:{get:function(){return this._clippingPolygons},set:function(e){e!==this._clippingPolygons&&(jn.setOwner(e,this,"_clippingPolygons"),this.resetDrawCommands())}},lightColor:{get:function(){return this._lightColor},set:function(e){l(e)!==l(this._lightColor)&&this.resetDrawCommands(),this._lightColor=m.clone(e,this._lightColor)}},imageBasedLighting:{get:function(){return this._imageBasedLighting},set:function(e){y.typeOf.object("imageBasedLighting",this._imageBasedLighting),e!==this._imageBasedLighting&&(this._shouldDestroyImageBasedLighting&&!this._imageBasedLighting.isDestroyed()&&this._imageBasedLighting.destroy(),this._imageBasedLighting=e,this._shouldDestroyImageBasedLighting=!1,this.resetDrawCommands())}},backFaceCulling:{get:function(){return this._backFaceCulling},set:function(e){e!==this._backFaceCulling&&(this._backFaceCullingDirty=!0),this._backFaceCulling=e}},scale:{get:function(){return this._scale},set:function(e){e!==this._scale&&(this._updateModelMatrix=!0),this._scale=e}},computedScale:{get:function(){return this._computedScale}},minimumPixelSize:{get:function(){return this._minimumPixelSize},set:function(e){e!==this._minimumPixelSize&&(this._updateModelMatrix=!0),this._minimumPixelSize=e}},maximumScale:{get:function(){return this._maximumScale},set:function(e){e!==this._maximumScale&&(this._updateModelMatrix=!0),this._maximumScale=e}},shadows:{get:function(){return this._shadows},set:function(e){e!==this._shadows&&(this._shadowsDirty=!0),this._shadows=e}},credit:{get:function(){return this._credit}},showCreditsOnScreen:{get:function(){return this._showCreditsOnScreen},set:function(e){this._showCreditsOnScreen!==e&&(this._showCreditsOnScreenDirty=!0),this._showCreditsOnScreen=e}},splitDirection:{get:function(){return this._splitDirection},set:function(e){this._splitDirection!==e&&this.resetDrawCommands(),this._splitDirection=e}},classificationType:{get:function(){return this._classificationType}},pickIds:{get:function(){return this._pickIds}},styleCommandsNeeded:{get:function(){return this._styleCommandsNeeded}}});Vt.prototype.getNode=function(e){if(!this._ready)throw new A("The model is not loaded. Use Model.readyEvent or wait for Model.ready to be true.");return y.typeOf.string("name",e),this._nodesByName[e]};Vt.prototype.setArticulationStage=function(e,t){if(y.typeOf.number("value",t),!this._ready)throw new A("The model is not loaded. Use Model.readyEvent or wait for Model.ready to be true.");this._sceneGraph.setArticulationStage(e,t)};Vt.prototype.applyArticulations=function(){if(!this._ready)throw new A("The model is not loaded. Use Model.readyEvent or wait for Model.ready to be true.");this._sceneGraph.applyArticulations()};Vt.prototype.makeStyleDirty=function(){this._styleDirty=!0};Vt.prototype.resetDrawCommands=function(){this._drawCommandsBuilt=!1};const Yde=new P,Kde=new H,Zde=new P;Vt.prototype.update=function(e){let t=!1;try{t=Jde(this,e)}catch(n){if(!this._loader.incrementallyLoadTextures&&n.name==="TextureError")_T(this,n);else{const i=je.getError("model",this._resource,n);_T(this,i)}}if(Qde(this,e),epe(this,e),!this._resourcesLoaded&&t){this._resourcesLoaded=!0;const n=this._loader.components;if(!l(n)){if(this._loader.isUnloaded())return;const s=je.getError("model",this._resource,new te("Failed to load model."));_T(s),this._rejectLoad=this._rejectLoad&&this._rejectLoad(s)}const i=n.structuralMetadata;l(i)&&i.propertyTableCount>0&&$de(this,i);const r=new Is({model:this,modelComponents:n});this._sceneGraph=r,this._gltfCredits=r.components.asset.credits}if(!(!this._resourcesLoaded||e.mode===Ie.MORPHING)){if(tpe(this),npe(this),ipe(this,e),rpe(this),spe(this,e),ope(this,e),ape(this,e),cpe(this,e),lpe(this,e),upe(this,e),fpe(this,e),this._defaultTexture=e.context.defaultTexture,hpe(this,e),dpe(this,e),ppe(this),mpe(this,e),bpe(this,e),!this._ready){e.afterRender.push(()=>{this._ready=!0,this._readyEvent.raiseEvent(this)});return}this._loader.incrementallyLoadTextures&&!this._texturesLoaded&&this._loader.texturesLoaded&&(this.resetDrawCommands(),this._texturesLoaded=!0,this._texturesReadyEvent.raiseEvent(this)),_pe(this),Tpe(this,e),xpe(this),Epe(this,e)}};function Jde(e,t){return!e._resourcesLoaded||e._loader.incrementallyLoadTextures&&!e._texturesLoaded?(t.afterRender.push(()=>!0),e._loader.process(t)):!0}function Qde(e,t){l(e._customShader)&&e._customShader.update(t)}function epe(e,t){e._imageBasedLighting.update(t),e._imageBasedLighting.shouldRegenerateShaders&&e.resetDrawCommands()}function tpe(e){if(!e._featureTableIdDirty)return;e._featureTableIdDirty=!1;const t=e._sceneGraph.components,n=t.structuralMetadata;l(n)&&n.propertyTableCount>0&&(e.featureTableId=Xde(t,e),e._styleDirty=!0,e.resetDrawCommands())}function npe(e){e._styleDirty&&(e.applyStyle(e._style),e._styleDirty=!1)}function ipe(e,t){const n=e._featureTables,i=n.length;let r=!1;for(let s=0;s<i;s++)n[s].update(t),n[s].styleCommandsNeededDirty&&(r=!0);r&&_F(e)}function _F(e){const t=e.featureTables[e.featureTableId];e._styleCommandsNeeded=Lp.getStyleCommandsNeeded(t.featuresLength,t.batchTexture.translucentFeaturesLength)}function rpe(e){const t=e.pointCloudShading;t.attenuation!==e._attenuation&&(e.resetDrawCommands(),e._attenuation=t.attenuation),t.backFaceCulling!==e._pointCloudBackFaceCulling&&(e.resetDrawCommands(),e._pointCloudBackFaceCulling=t.backFaceCulling)}function spe(e,t){e._silhouetteDirty&&(bF(t)&&e.resetDrawCommands(),e._silhouetteDirty=!1)}function ope(e,t){const n=e.hasSkipLevelOfDetail(t);n!==e._skipLevelOfDetail&&(e.resetDrawCommands(),e._skipLevelOfDetail=n)}function ape(e,t){let n=0;e.isClippingEnabled()&&(e._clippingPlanes.owner===e&&e._clippingPlanes.update(t),n=e._clippingPlanes.clippingPlanesState),n!==e._clippingPlanesState&&(e.resetDrawCommands(),e._clippingPlanesState=n)}function cpe(e,t){let n=0;e.isClippingPolygonsEnabled()&&(e._clippingPolygons.owner===e&&(e._clippingPolygons.update(t),e._clippingPolygons.queueCommands(t)),n=e._clippingPolygons.clippingPolygonsState),n!==e._clippingPolygonsState&&(e.resetDrawCommands(),e._clippingPolygonsState=n)}function lpe(e,t){t.mode!==e._sceneMode&&(e._projectTo2D?e.resetDrawCommands():e._updateModelMatrix=!0,e._sceneMode=t.mode)}function upe(e,t){const n=t.fog.enabled&&t.fog.renderable;n!==e._fogRenderable&&(e.resetDrawCommands(),e._fogRenderable=n)}function fpe(e,t){const n=t.verticalExaggeration!==1;e._verticalExaggerationOn!==n&&(e.resetDrawCommands(),e._verticalExaggerationOn=n)}function hpe(e,t){e._drawCommandsBuilt||(e.destroyPipelineResources(),e._sceneGraph.buildDrawCommands(t),e._drawCommandsBuilt=!0)}function dpe(e,t){if(!P.equals(e.modelMatrix,e._modelMatrix)){if(t.mode!==Ie.SCENE3D&&e._projectTo2D)throw new A("Model.modelMatrix cannot be changed in 2D or Columbus View if projectTo2D is true.");e._updateModelMatrix=!0,e._modelMatrix=P.clone(e.modelMatrix,e._modelMatrix)}}const tl=new m,yT=new oe;function ppe(e){if(!e._updateModelMatrix&&!e._heightDirty&&e._minimumPixelSize===0)return;l(e._removeUpdateHeightCallback)&&(e._removeUpdateHeightCallback(),e._removeUpdateHeightCallback=void 0);const t=e._scene;if(!l(t)||e.heightReference===fa.NONE){if(e.heightReference!==fa.NONE)throw new A("Height reference is not supported without a scene.");e._clampedModelMatrix=void 0;return}const n=T(t.ellipsoid,fe.default),i=e.modelMatrix;tl.x=i[12],tl.y=i[13],tl.z=i[14];const r=n.cartesianToCartographic(tl);l(e._clampedModelMatrix)||(e._clampedModelMatrix=P.clone(i,new P)),e._removeUpdateHeightCallback=t.updateHeight(r,iO(e,n,r),e.heightReference);const s=t.getHeight(r,e.heightReference);if(l(s)){const o=iO(e,n,r);oe.clone(r,yT),yT.height=s,o(yT)}e._heightDirty=!1,e._updateModelMatrix=!0}function mpe(e,t){if(!e._updateModelMatrix&&e._minimumPixelSize===0)return;const n=l(e._clampedModelMatrix)?e._clampedModelMatrix:e.modelMatrix;yF(e,n),gpe(e,n,t)}function yF(e,t){e._clampedScale=l(e._maximumScale)?Math.min(e._scale,e._maximumScale):e._scale,e._boundingSphere.center=m.multiplyByScalar(e._sceneGraph.boundingSphere.center,e._clampedScale,e._boundingSphere.center),e._boundingSphere.radius=e._initialRadius*e._clampedScale,e._boundingSphere=ee.transform(e._boundingSphere,t,e._boundingSphere)}function gpe(e,t,n){let i=e.scale;if(e.minimumPixelSize!==0&&!e._projectTo2D){const r=n.context,s=Math.max(r.drawingBufferWidth,r.drawingBufferHeight);P.getTranslation(t,tl),e._sceneMode!==Ie.SCENE3D&&an.computeActualEllipsoidPosition(n,tl,tl);const o=e._boundingSphere.radius,a=Cpe(tl,o,n),c=1/a;Math.min(c*(2*o),s)<e.minimumPixelSize&&(i=e.minimumPixelSize*a/(2*e._initialRadius))}e._computedScale=l(e.maximumScale)?Math.min(e.maximumScale,i):i}function _pe(e){if(!e._idDirty)return;e._idDirty=!1;const t=e._id,n=e._pickIds,i=n.length;for(let r=0;r<i;++r)n[r].object.id=t}const ype=new H(1,0,0,0,0,1,0,-1,0);function bpe(e,t){const n=l(e._clampedModelMatrix)?e._clampedModelMatrix:e.modelMatrix,i=T(e.referenceMatrix,n),r=t.context,s=e._imageBasedLighting;if(s.useSphericalHarmonicCoefficients||s.useSpecularEnvironmentMaps){let o=Kde,a=Yde;a=P.multiply(r.uniformState.view3D,i,a),o=P.getRotation(a,o),o=H.transpose(o,o),e._iblReferenceFrameMatrix=H.multiply(ype,o,e._iblReferenceFrameMatrix)}if(e.isClippingEnabled()){let o=Zde;o=P.multiply(r.uniformState.view3D,i,o),o=P.multiply(o,e._clippingPlanes.modelMatrix,o),e._clippingPlanesMatrix=P.inverseTranspose(o,e._clippingPlanesMatrix)}}function Tpe(e,t){const n=e._sceneGraph;if(e._updateModelMatrix||e._minimumPixelSize!==0){const r=l(e._clampedModelMatrix)?e._clampedModelMatrix:e.modelMatrix;n.updateModelMatrix(r,t),e._updateModelMatrix=!1}e._backFaceCullingDirty&&(n.updateBackFaceCulling(e._backFaceCulling),e._backFaceCullingDirty=!1),e._shadowsDirty&&(n.updateShadows(e._shadows),e._shadowsDirty=!1),e._debugShowBoundingVolumeDirty&&(n.updateShowBoundingVolume(e._debugShowBoundingVolume),e._debugShowBoundingVolumeDirty=!1);let i=!1;l(e.classificationType)||(i=e._userAnimationDirty||e._activeAnimations.update(t)),n.update(t,i),e._userAnimationDirty=!1}function xpe(e){if(!e._showCreditsOnScreenDirty)return;e._showCreditsOnScreenDirty=!1,e._credits.length=0;const t=e._showCreditsOnScreen;if(l(e._credit)){const o=zt.clone(e._credit);o.showOnScreen=o.showOnScreen||t,e._credits.push(o)}const n=e._resourceCredits,i=n.length;for(let o=0;o<i;o++){const a=zt.clone(n[o]);a.showOnScreen=a.showOnScreen||t,e._credits.push(a)}const r=e._gltfCredits,s=r.length;for(let o=0;o<s;o++){const a=zt.clone(r[o]);a.showOnScreen=a.showOnScreen||t,e._credits.push(a)}}function Epe(e,t){const n=Ape(e,t),i=e.isInvisible(),r=e.hasSilhouette(t),s=e._show&&e._computedScale!==0&&n&&(!i||r),o=t.passes,a=o.render||o.pick&&e.allowPicking;s&&!e._ignoreCommands&&a&&(Spe(e,t),e._sceneGraph.pushDrawCommands(t))}const bT=new ee;function Cpe(e,t,n){return bT.center=e,bT.radius=t,n.camera.getPixelSize(bT,n.context.drawingBufferWidth,n.context.drawingBufferHeight)}const wg=new m;function iO(e,t,n){return function(i){zP(e.heightReference)&&(i.height+=n.height),t.cartographicToCartesian(i,wg);const r=e._clampedModelMatrix;P.clone(e.modelMatrix,r),r[12]=wg.x,r[13]=wg.y,r[14]=wg.z,e._heightDirty=!0}}const wpe=new m;function Ape(e,t){const n=e.distanceDisplayCondition;if(!l(n))return!0;const i=n.near*n.near,r=n.far*n.far;let s;if(t.mode===Ie.SCENE2D){const a=(t.camera.frustum.right-t.camera.frustum.left)*.5;s=a*a}else{const o=P.getTranslation(e.modelMatrix,wpe);an.computeActualEllipsoidPosition(t,o,o),s=m.distanceSquared(o,t.camera.positionWC)}return s>=i&&s<=r}function Spe(e,t){const n=t.creditDisplay,i=e._credits,r=i.length;for(let s=0;s<r;s++)n.addCreditToNextFrame(i[s])}Vt.prototype.isTranslucent=function(){const e=this.color;return l(e)&&e.alpha>0&&e.alpha<1};Vt.prototype.isInvisible=function(){const e=this.color;return l(e)&&e.alpha===0};function bF(e){return e.context.stencilBuffer}Vt.prototype.hasSilhouette=function(e){return bF(e)&&this._silhouetteSize>0&&this._silhouetteColor.alpha>0&&!l(this._classificationType)};Vt.prototype.hasSkipLevelOfDetail=function(e){if(!Or.is3DTiles(this.type))return!1;const t=e.context.stencilBuffer,n=this._content.tileset;return t&&n.isSkippingLevelOfDetail};Vt.prototype.isClippingEnabled=function(){const e=this._clippingPlanes;return l(e)&&e.enabled&&e.length!==0};Vt.prototype.pick=function(e,t,n,i,r){return Wde(this,e,t,n,i,r)};Vt.prototype.isClippingPolygonsEnabled=function(){const e=this._clippingPolygons;return l(e)&&e.enabled&&e.length!==0};Vt.prototype.isDestroyed=function(){return!1};Vt.prototype.destroy=function(){const e=this._loader;l(e)&&e.destroy();const t=this._featureTables;if(l(t)){const r=t.length;for(let s=0;s<r;s++)t[s].destroy()}this.destroyPipelineResources(),this.destroyModelResources(),l(this._removeUpdateHeightCallback)&&(this._removeUpdateHeightCallback(),this._removeUpdateHeightCallback=void 0),l(this._terrainProviderChangedCallback)&&(this._terrainProviderChangedCallback(),this._terrainProviderChangedCallback=void 0);const n=this._clippingPlanes;l(n)&&!n.isDestroyed()&&n.owner===this&&n.destroy(),this._clippingPlanes=void 0;const i=this._clippingPolygons;l(i)&&!i.isDestroyed()&&i.owner===this&&i.destroy(),this._clippingPolygons=void 0,this._shouldDestroyImageBasedLighting&&!this._imageBasedLighting.isDestroyed()&&this._imageBasedLighting.destroy(),this._imageBasedLighting=void 0,Ye(this)};Vt.prototype.destroyPipelineResources=function(){const e=this._pipelineResources;for(let t=0;t<e.length;t++)e[t].destroy();this._pipelineResources.length=0,this._pickIds.length=0};Vt.prototype.destroyModelResources=function(){const e=this._modelResources;for(let t=0;t<e.length;t++)e[t].destroy();this._modelResources.length=0};Vt.fromGltfAsync=async function(e){if(e=T(e,T.EMPTY_OBJECT),!l(e.url)&&!l(e.gltf))throw new A("options.url is required.");const t=T(e.url,e.gltf),n={releaseGltfJson:e.releaseGltfJson,asynchronous:e.asynchronous,incrementallyLoadTextures:e.incrementallyLoadTextures,upAxis:e.upAxis,forwardAxis:e.forwardAxis,loadAttributesFor2D:e.projectTo2D,enablePick:e.enablePick,loadIndicesForWireframe:e.enableDebugWireframe,loadPrimitiveOutline:e.enableShowOutline,loadForClassification:l(e.classificationType)},i=T(e.basePath,""),r=se.createIfNeeded(i);l(t.asset)?(n.gltfJson=t,n.baseResource=r,n.gltfResource=r):t instanceof Uint8Array?(n.typedArray=t,n.baseResource=r,n.gltfResource=r):n.gltfResource=se.createIfNeeded(t);const s=new Ts(n),a=l(e.content)?Or.TILE_GLTF:Or.GLTF,c=n.gltfResource,u=fm(s,a,e);u.resource=c;try{await s.load()}catch(g){throw s.destroy(),je.getError("model",c,g)}const h=e.gltfCallback;l(h)&&(y.typeOf.func("options.gltfCallback",h),h(s.gltfJson));const d=new Vt(u),p=d._resource.credits;if(l(p)){const g=p.length;for(let _=0;_<g;_++)d._resourceCredits.push(zt.clone(p[_]))}return d};Vt.fromB3dm=async function(e){const t={b3dmResource:e.resource,arrayBuffer:e.arrayBuffer,byteOffset:e.byteOffset,releaseGltfJson:e.releaseGltfJson,asynchronous:e.asynchronous,incrementallyLoadTextures:e.incrementallyLoadTextures,upAxis:e.upAxis,forwardAxis:e.forwardAxis,loadAttributesFor2D:e.projectTo2D,enablePick:e.enablePick,loadIndicesForWireframe:e.enableDebugWireframe,loadPrimitiveOutline:e.enableShowOutline,loadForClassification:l(e.classificationType)},n=new ul(t);try{await n.load();const i=fm(n,Or.TILE_B3DM,e);return new Vt(i)}catch(i){throw n.destroy(),i}};Vt.fromPnts=async function(e){const t={arrayBuffer:e.arrayBuffer,byteOffset:e.byteOffset,loadAttributesFor2D:e.projectTo2D},n=new hl(t);try{await n.load();const i=fm(n,Or.TILE_PNTS,e);return new Vt(i)}catch(i){throw n.destroy(),i}};Vt.fromI3dm=async function(e){const t={i3dmResource:e.resource,arrayBuffer:e.arrayBuffer,byteOffset:e.byteOffset,releaseGltfJson:e.releaseGltfJson,asynchronous:e.asynchronous,incrementallyLoadTextures:e.incrementallyLoadTextures,upAxis:e.upAxis,forwardAxis:e.forwardAxis,loadAttributesFor2D:e.projectTo2D,enablePick:e.enablePick,loadIndicesForWireframe:e.enableDebugWireframe,loadPrimitiveOutline:e.enableShowOutline},n=new tc(t);try{await n.load();const i=fm(n,Or.TILE_I3DM,e);return new Vt(i)}catch(i){throw n.destroy(),i}};Vt.fromGeoJson=async function(e){const t={geoJson:e.geoJson},n=new fl(t),i=fm(n,Or.TILE_GEOJSON,e);return new Vt(i)};const vpe=new M;Vt.prototype.applyColorAndShow=function(e){const t=M.clone(this._color,vpe),n=l(e)&&l(e.color),i=l(e)&&l(e.show);this._color=n?e.color.evaluateColor(void 0,this._color):M.clone(M.WHITE,this._color),this._show=i?e.show.evaluate(void 0):!0,hE(t,this._color)&&this.resetDrawCommands()};Vt.prototype.applyStyle=function(e){const t=this.type===Or.TILE_PNTS,n=l(this.featureTableId)&&this.featureTables[this.featureTableId].featuresLength>0,i=l(this.structuralMetadata)?this.structuralMetadata.propertyAttributes:void 0,r=l(i)&&l(i[0]);if(t&&(!n||r)){this.resetDrawCommands();return}n?(this.featureTables[this.featureTableId].applyStyle(e),_F(this)):(this.applyColorAndShow(e),this._styleCommandsNeeded=void 0)};function fm(e,t,n){return{loader:e,type:t,resource:n.resource,show:n.show,modelMatrix:n.modelMatrix,scale:n.scale,minimumPixelSize:n.minimumPixelSize,maximumScale:n.maximumScale,id:n.id,allowPicking:n.allowPicking,clampAnimations:n.clampAnimations,shadows:n.shadows,debugShowBoundingVolume:n.debugShowBoundingVolume,enableDebugWireframe:n.enableDebugWireframe,debugWireframe:n.debugWireframe,cull:n.cull,opaquePass:n.opaquePass,customShader:n.customShader,content:n.content,heightReference:n.heightReference,scene:n.scene,distanceDisplayCondition:n.distanceDisplayCondition,color:n.color,colorBlendAmount:n.colorBlendAmount,colorBlendMode:n.colorBlendMode,silhouetteColor:n.silhouetteColor,silhouetteSize:n.silhouetteSize,enableShowOutline:n.enableShowOutline,showOutline:n.showOutline,outlineColor:n.outlineColor,clippingPlanes:n.clippingPlanes,clippingPolygons:n.clippingPolygons,lightColor:n.lightColor,imageBasedLighting:n.imageBasedLighting,backFaceCulling:n.backFaceCulling,credit:n.credit,showCreditsOnScreen:n.showCreditsOnScreen,splitDirection:n.splitDirection,projectTo2D:n.projectTo2D,enablePick:n.enablePick,featureIdLabel:n.featureIdLabel,instanceFeatureIdLabel:n.instanceFeatureIdLabel,pointCloudShading:n.pointCloudShading,classificationType:n.classificationType,pickObject:n.pickObject}}function Un(e,t,n){this._tileset=e,this._tile=t,this._resource=n,this._model=void 0,this._metadata=void 0,this._group=void 0,this._ready=!1}Object.defineProperties(Un.prototype,{featuresLength:{get:function(){const e=this._model,t=e.featureTables,n=e.featureTableId;return l(t)&&l(t[n])?t[n].featuresLength:0}},pointsLength:{get:function(){return this._model.statistics.pointsLength}},trianglesLength:{get:function(){return this._model.statistics.trianglesLength}},geometryByteLength:{get:function(){return this._model.statistics.geometryByteLength}},texturesByteLength:{get:function(){return this._model.statistics.texturesByteLength}},batchTableByteLength:{get:function(){const e=this._model.statistics;return e.propertyTablesByteLength+e.batchTexturesByteLength}},innerContents:{get:function(){}},ready:{get:function(){return this._ready}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){const e=this._model,t=e.featureTables,n=e.featureTableId;if(l(t)&&l(t[n]))return t[n]}},metadata:{get:function(){return this._metadata},set:function(e){this._metadata=e}},group:{get:function(){return this._group},set:function(e){this._group=e}}});Un.prototype.getFeature=function(e){const t=this._model,n=t.featureTableId;if(!l(n))throw new A("No feature ID set is selected. Make sure Cesium3DTileset.featureIdLabel or Cesium3DTileset.instanceFeatureIdLabel is defined");const i=t.featureTables[n];if(!l(i))throw new A("No feature table found for the selected feature ID set");const r=i.featuresLength;if(!l(e)||e<0||e>=r)throw new A(`featureId is required and must be between 0 and featuresLength - 1 (${r-1}).`);return i.getFeature(e)};Un.prototype.hasProperty=function(e,t){const n=this._model,i=n.featureTableId;return l(i)?n.featureTables[i].hasProperty(e,t):!1};Un.prototype.applyDebugSettings=function(e,t){t=e?t:M.WHITE,this.featuresLength===0?this._model.color=t:l(this.batchTable)&&this.batchTable.setAllColor(t)};Un.prototype.applyStyle=function(e){this._model.style=e};Un.prototype.update=function(e,t){const n=this._model,i=this._tile;n.colorBlendAmount=e.colorBlendAmount,n.colorBlendMode=e.colorBlendMode,n.modelMatrix=i.computedTransform,n.customShader=e.customShader,n.featureIdLabel=e.featureIdLabel,n.instanceFeatureIdLabel=e.instanceFeatureIdLabel,n.lightColor=e.lightColor,n.imageBasedLighting=e.imageBasedLighting,n.backFaceCulling=e.backFaceCulling,n.shadows=e.shadows,n.showCreditsOnScreen=e.showCreditsOnScreen,n.splitDirection=e.splitDirection,n.debugWireframe=e.debugWireframe,n.showOutline=e.showOutline,n.outlineColor=e.outlineColor,n.pointCloudShading=e.pointCloudShading;const r=e.clippingPlanes;n.referenceMatrix=e.clippingPlanesOriginMatrix,l(r)&&i.clippingPlanesDirty&&(n._clippingPlanes=r.enabled&&i._isClipped?r:void 0),l(r)&&l(n._clippingPlanes)&&n._clippingPlanes!==r&&(n._clippingPlanes=r,n._clippingPlanesState=0);const s=e.clippingPolygons;l(s)&&i.clippingPolygonsDirty&&(n._clippingPolygons=s.enabled&&i._isClippedByPolygon?s:void 0),l(s)&&l(n._clippingPolygons)&&n._clippingPolygons!==s&&(n._clippingPolygons=s,n._clippingPolygonsState=0),n.update(t),!this._ready&&n.ready&&(n.activeAnimations.addAll({loop:Df.REPEAT}),this._ready=!0)};Un.prototype.isDestroyed=function(){return!1};Un.prototype.destroy=function(){return this._model=this._model&&this._model.destroy(),Ye(this)};Un.fromGltf=async function(e,t,n,i){const r=new Un(e,t,n),o=hm(e,t,r,{gltf:i,basePath:n}),a=e.vectorClassificationOnly?void 0:e.classificationType;o.classificationType=a;const c=await Vt.fromGltfAsync(o);return r._model=c,r};Un.fromB3dm=async function(e,t,n,i,r){const s=new Un(e,t,n),a=hm(e,t,s,{arrayBuffer:i,byteOffset:r,resource:n}),c=e.vectorClassificationOnly?void 0:e.classificationType;a.classificationType=c;const u=await Vt.fromB3dm(a);return s._model=u,s};Un.fromI3dm=async function(e,t,n,i,r){const s=new Un(e,t,n),a=hm(e,t,s,{arrayBuffer:i,byteOffset:r,resource:n}),c=await Vt.fromI3dm(a);return s._model=c,s};Un.fromPnts=async function(e,t,n,i,r){const s=new Un(e,t,n),a=hm(e,t,s,{arrayBuffer:i,byteOffset:r,resource:n}),c=await Vt.fromPnts(a);return s._model=c,s};Un.fromGeoJson=async function(e,t,n,i){const r=new Un(e,t,n),o=hm(e,t,r,{geoJson:i,resource:n}),a=await Vt.fromGeoJson(o);return r._model=a,r};Un.prototype.pick=function(e,t,n){if(!l(this._model)||!this._ready)return;const i=t.verticalExaggeration,r=t.verticalExaggerationRelativeHeight;return this._model.pick(e,t,i,r,fe.WGS84,n)};function hm(e,t,n,i){const r={cull:!1,releaseGltfJson:!0,opaquePass:Ke.CESIUM_3D_TILE,modelMatrix:t.computedTransform,upAxis:e._modelUpAxis,forwardAxis:e._modelForwardAxis,incrementallyLoadTextures:!1,customShader:e.customShader,content:n,colorBlendMode:e.colorBlendMode,colorBlendAmount:e.colorBlendAmount,lightColor:e.lightColor,imageBasedLighting:e.imageBasedLighting,featureIdLabel:e.featureIdLabel,instanceFeatureIdLabel:e.instanceFeatureIdLabel,pointCloudShading:e.pointCloudShading,clippingPlanes:e.clippingPlanes,backFaceCulling:e.backFaceCulling,shadows:e.shadows,showCreditsOnScreen:e.showCreditsOnScreen,splitDirection:e.splitDirection,enableDebugWireframe:e._enableDebugWireframe,debugWireframe:e.debugWireframe,projectTo2D:e._projectTo2D,enablePick:e._enablePick,enableShowOutline:e._enableShowOutline,showOutline:e.showOutline,outlineColor:e.outlineColor};return wt(i,r)}function oo(e,t,n){this._tileset=e,this._tile=t,this._resource=n,this.featurePropertiesDirty=!1,this._metadata=void 0,this._group=void 0,this._ready=!1}Object.defineProperties(oo.prototype,{featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){}},ready:{get:function(){return this._ready}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){}},metadata:{get:function(){return this._metadata},set:function(e){this._metadata=e}},group:{get:function(){return this._group},set:function(e){this._group=e}}});oo.fromJson=function(e,t,n,i){const r=new oo(e,t,n);return r._tileset.loadTileset(r._resource,i,r._tile),r._ready=!0,r};oo.prototype.hasProperty=function(e,t){return!1};oo.prototype.getFeature=function(e){};oo.prototype.applyDebugSettings=function(e,t){};oo.prototype.applyStyle=function(e){};oo.prototype.update=function(e,t){};oo.prototype.pick=function(e,t,n){};oo.prototype.isDestroyed=function(){return!1};oo.prototype.destroy=function(){return Ye(this)};const Ipe=`uniform sampler2D u_atlas;

#ifdef VECTOR_TILE
uniform vec4 u_highlightColor;
#endif

in vec2 v_textureCoordinates;
in vec4 v_pickColor;
in vec4 v_color;
in float v_splitDirection;

#ifdef SDF
in vec4 v_outlineColor;
in float v_outlineWidth;
#endif

#ifdef FRAGMENT_DEPTH_CHECK
in vec4 v_textureCoordinateBounds;                  // the min and max x and y values for the texture coordinates
in vec4 v_originTextureCoordinateAndTranslate;      // texture coordinate at the origin, billboard translate (used for label glyphs)
in vec4 v_compressed;                               // x: eyeDepth, y: applyTranslate & enableDepthCheck, z: dimensions, w: imageSize
in mat2 v_rotationMatrix;

const float SHIFT_LEFT12 = 4096.0;
const float SHIFT_LEFT1 = 2.0;

const float SHIFT_RIGHT12 = 1.0 / 4096.0;
const float SHIFT_RIGHT1 = 1.0 / 2.0;

float getGlobeDepth(vec2 adjustedST, vec2 depthLookupST, bool applyTranslate, vec2 dimensions, vec2 imageSize)
{
    vec2 lookupVector = imageSize * (depthLookupST - adjustedST);
    lookupVector = v_rotationMatrix * lookupVector;
    vec2 labelOffset = (dimensions - imageSize) * (depthLookupST - vec2(0.0, v_originTextureCoordinateAndTranslate.y)); // aligns label glyph with bounding rectangle.  Will be zero for billboards because dimensions and imageSize will be equal

    vec2 translation = v_originTextureCoordinateAndTranslate.zw;

    if (applyTranslate)
    {
        // this is only needed for labels where the horizontal origin is not LEFT
        // it moves the label back to where the "origin" should be since all label glyphs are set to HorizontalOrigin.LEFT
        translation += (dimensions * v_originTextureCoordinateAndTranslate.xy * vec2(1.0, 0.0));
    }

    vec2 st = ((lookupVector - translation + labelOffset) + gl_FragCoord.xy) / czm_viewport.zw;
    float logDepthOrDepth = czm_unpackDepth(texture(czm_globeDepthTexture, st));

    if (logDepthOrDepth == 0.0)
    {
        return 0.0; // not on the globe
    }

    vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth);
    return eyeCoordinate.z / eyeCoordinate.w;
}
#endif


#ifdef SDF

// Get the distance from the edge of a glyph at a given position sampling an SDF texture.
float getDistance(vec2 position)
{
    return texture(u_atlas, position).r;
}

// Samples the sdf texture at the given position and produces a color based on the fill color and the outline.
vec4 getSDFColor(vec2 position, float outlineWidth, vec4 outlineColor, float smoothing)
{
    float distance = getDistance(position);

    if (outlineWidth > 0.0)
    {
        // Don't get the outline edge exceed the SDF_EDGE
        float outlineEdge = clamp(SDF_EDGE - outlineWidth, 0.0, SDF_EDGE);
        float outlineFactor = smoothstep(SDF_EDGE - smoothing, SDF_EDGE + smoothing, distance);
        vec4 sdfColor = mix(outlineColor, v_color, outlineFactor);
        float alpha = smoothstep(outlineEdge - smoothing, outlineEdge + smoothing, distance);
        return vec4(sdfColor.rgb, sdfColor.a * alpha);
    }
    else
    {
        float alpha = smoothstep(SDF_EDGE - smoothing, SDF_EDGE + smoothing, distance);
        return vec4(v_color.rgb, v_color.a * alpha);
    }
}
#endif

void main()
{
    if (v_splitDirection < 0.0 && gl_FragCoord.x > czm_splitPosition) discard;
    if (v_splitDirection > 0.0 && gl_FragCoord.x < czm_splitPosition) discard;
    
    vec4 color = texture(u_atlas, v_textureCoordinates);

#ifdef SDF
    float outlineWidth = v_outlineWidth;
    vec4 outlineColor = v_outlineColor;

    // Get the current distance
    float distance = getDistance(v_textureCoordinates);

#if (__VERSION__ == 300 || defined(GL_OES_standard_derivatives))
    float smoothing = fwidth(distance);
    // Get an offset that is approximately half the distance to the neighbor pixels
    // 0.354 is approximately half of 1/sqrt(2)
    vec2 sampleOffset = 0.354 * vec2(dFdx(v_textureCoordinates) + dFdy(v_textureCoordinates));

    // Sample the center point
    vec4 center = getSDFColor(v_textureCoordinates, outlineWidth, outlineColor, smoothing);

    // Sample the 4 neighbors
    vec4 color1 = getSDFColor(v_textureCoordinates + vec2(sampleOffset.x, sampleOffset.y), outlineWidth, outlineColor, smoothing);
    vec4 color2 = getSDFColor(v_textureCoordinates + vec2(-sampleOffset.x, sampleOffset.y), outlineWidth, outlineColor, smoothing);
    vec4 color3 = getSDFColor(v_textureCoordinates + vec2(-sampleOffset.x, -sampleOffset.y), outlineWidth, outlineColor, smoothing);
    vec4 color4 = getSDFColor(v_textureCoordinates + vec2(sampleOffset.x, -sampleOffset.y), outlineWidth, outlineColor, smoothing);

    // Equally weight the center sample and the 4 neighboring samples
    color = (center + color1 + color2 + color3 + color4)/5.0;
#else
    // If no derivatives available (IE 10?), just do a single sample
    float smoothing = 1.0/32.0;
    color = getSDFColor(v_textureCoordinates, outlineWidth, outlineColor, smoothing);
#endif

    color = czm_gammaCorrect(color);
#else
    color = czm_gammaCorrect(color);
    color *= czm_gammaCorrect(v_color);
#endif

// Fully transparent parts of the billboard are not pickable.
#if !defined(OPAQUE) && !defined(TRANSLUCENT)
    if (color.a < 0.005)   // matches 0/255 and 1/255
    {
        discard;
    }
#else
// The billboard is rendered twice. The opaque pass discards translucent fragments
// and the translucent pass discards opaque fragments.
#ifdef OPAQUE
    if (color.a < 0.995)   // matches < 254/255
    {
        discard;
    }
#else
    if (color.a >= 0.995)  // matches 254/255 and 255/255
    {
        discard;
    }
#endif
#endif

#ifdef VECTOR_TILE
    color *= u_highlightColor;
#endif
    out_FragColor = color;

#ifdef LOG_DEPTH
    czm_writeLogDepth();
#endif

#ifdef FRAGMENT_DEPTH_CHECK
    float temp = v_compressed.y;

    temp = temp * SHIFT_RIGHT1;

    float temp2 = (temp - floor(temp)) * SHIFT_LEFT1;
    bool enableDepthTest = temp2 != 0.0;
    bool applyTranslate = floor(temp) != 0.0;

    if (enableDepthTest) {
        temp = v_compressed.z;
        temp = temp * SHIFT_RIGHT12;

        vec2 dimensions;
        dimensions.y = (temp - floor(temp)) * SHIFT_LEFT12;
        dimensions.x = floor(temp);

        temp = v_compressed.w;
        temp = temp * SHIFT_RIGHT12;

        vec2 imageSize;
        imageSize.y = (temp - floor(temp)) * SHIFT_LEFT12;
        imageSize.x = floor(temp);

        vec2 adjustedST = v_textureCoordinates - v_textureCoordinateBounds.xy;
        adjustedST = adjustedST / vec2(v_textureCoordinateBounds.z - v_textureCoordinateBounds.x, v_textureCoordinateBounds.w - v_textureCoordinateBounds.y);

        float epsilonEyeDepth = v_compressed.x + czm_epsilon1;
        float globeDepth1 = getGlobeDepth(adjustedST, v_originTextureCoordinateAndTranslate.xy, applyTranslate, dimensions, imageSize);

        // negative values go into the screen
        if (globeDepth1 != 0.0 && globeDepth1 > epsilonEyeDepth)
        {
            float globeDepth2 = getGlobeDepth(adjustedST, vec2(0.0, 1.0), applyTranslate, dimensions, imageSize); // top left corner
            if (globeDepth2 != 0.0 && globeDepth2 > epsilonEyeDepth)
            {
                float globeDepth3 = getGlobeDepth(adjustedST, vec2(1.0, 1.0), applyTranslate, dimensions, imageSize); // top right corner
                if (globeDepth3 != 0.0 && globeDepth3 > epsilonEyeDepth)
                {
                    discard;
                }
            }
        }
    }
#endif

}
`,Ope=`#ifdef INSTANCED
in vec2 direction;
#endif
in vec4 positionHighAndScale;
in vec4 positionLowAndRotation;
in vec4 compressedAttribute0;                       // pixel offset, translate, horizontal origin, vertical origin, show, direction, texture coordinates (texture offset)
in vec4 compressedAttribute1;                       // aligned axis, translucency by distance, image width
in vec4 compressedAttribute2;                       // label horizontal origin, image height, color, pick color, size in meters, valid aligned axis, 13 bits free
in vec4 eyeOffset;                                  // eye offset in meters, 4 bytes free (texture range)
in vec4 scaleByDistance;                            // near, nearScale, far, farScale
in vec4 pixelOffsetScaleByDistance;                 // near, nearScale, far, farScale
in vec4 compressedAttribute3;                       // distance display condition near, far, disableDepthTestDistance, dimensions
in vec2 sdf;                                        // sdf outline color (rgb) and width (w)
in float splitDirection;                            // splitDirection
#if defined(VERTEX_DEPTH_CHECK) || defined(FRAGMENT_DEPTH_CHECK)
in vec4 textureCoordinateBoundsOrLabelTranslate;    // the min and max x and y values for the texture coordinates
#endif
#ifdef VECTOR_TILE
in float a_batchId;
#endif

out vec2 v_textureCoordinates;
#ifdef FRAGMENT_DEPTH_CHECK
out vec4 v_textureCoordinateBounds;
out vec4 v_originTextureCoordinateAndTranslate;
out vec4 v_compressed;                                 // x: eyeDepth, y: applyTranslate & enableDepthCheck, z: dimensions, w: imageSize
out mat2 v_rotationMatrix;
#endif

out vec4 v_pickColor;
out vec4 v_color;
out float v_splitDirection;
#ifdef SDF
out vec4 v_outlineColor;
out float v_outlineWidth;
#endif

const float UPPER_BOUND = 32768.0;

const float SHIFT_LEFT16 = 65536.0;
const float SHIFT_LEFT12 = 4096.0;
const float SHIFT_LEFT8 = 256.0;
const float SHIFT_LEFT7 = 128.0;
const float SHIFT_LEFT5 = 32.0;
const float SHIFT_LEFT3 = 8.0;
const float SHIFT_LEFT2 = 4.0;
const float SHIFT_LEFT1 = 2.0;

const float SHIFT_RIGHT12 = 1.0 / 4096.0;
const float SHIFT_RIGHT8 = 1.0 / 256.0;
const float SHIFT_RIGHT7 = 1.0 / 128.0;
const float SHIFT_RIGHT5 = 1.0 / 32.0;
const float SHIFT_RIGHT3 = 1.0 / 8.0;
const float SHIFT_RIGHT2 = 1.0 / 4.0;
const float SHIFT_RIGHT1 = 1.0 / 2.0;

vec4 addScreenSpaceOffset(vec4 positionEC, vec2 imageSize, float scale, vec2 direction, vec2 origin, vec2 translate, vec2 pixelOffset, vec3 alignedAxis, bool validAlignedAxis, float rotation, bool sizeInMeters, out mat2 rotationMatrix, out float mpp)
{
    // Note the halfSize cannot be computed in JavaScript because it is sent via
    // compressed vertex attributes that coerce it to an integer.
    vec2 halfSize = imageSize * scale * 0.5;
    halfSize *= ((direction * 2.0) - 1.0);

    vec2 originTranslate = origin * abs(halfSize);

#if defined(ROTATION) || defined(ALIGNED_AXIS)
    if (validAlignedAxis || rotation != 0.0)
    {
        float angle = rotation;
        if (validAlignedAxis)
        {
            vec4 projectedAlignedAxis = czm_modelView3D * vec4(alignedAxis, 0.0);
            angle += sign(-projectedAlignedAxis.x) * acos(sign(projectedAlignedAxis.y) * (projectedAlignedAxis.y * projectedAlignedAxis.y) /
                    (projectedAlignedAxis.x * projectedAlignedAxis.x + projectedAlignedAxis.y * projectedAlignedAxis.y));
        }

        float cosTheta = cos(angle);
        float sinTheta = sin(angle);
        rotationMatrix = mat2(cosTheta, sinTheta, -sinTheta, cosTheta);
        halfSize = rotationMatrix * halfSize;
    }
    else
    {
        rotationMatrix = mat2(1.0, 0.0, 0.0, 1.0);
    }
#endif

    mpp = czm_metersPerPixel(positionEC);
    positionEC.xy += (originTranslate + halfSize) * czm_branchFreeTernary(sizeInMeters, 1.0, mpp);
    positionEC.xy += (translate + pixelOffset) * mpp;

    return positionEC;
}

#ifdef VERTEX_DEPTH_CHECK
float getGlobeDepth(vec4 positionEC)
{
    vec4 posWC = czm_eyeToWindowCoordinates(positionEC);

    float globeDepth = czm_unpackDepth(texture(czm_globeDepthTexture, posWC.xy / czm_viewport.zw));

    if (globeDepth == 0.0)
    {
        return 0.0; // not on the globe
    }

    vec4 eyeCoordinate = czm_windowToEyeCoordinates(posWC.xy, globeDepth);
    return eyeCoordinate.z / eyeCoordinate.w;
}
#endif
void main()
{
    // Modifying this shader may also require modifications to Billboard._computeScreenSpacePosition

    // unpack attributes
    vec3 positionHigh = positionHighAndScale.xyz;
    vec3 positionLow = positionLowAndRotation.xyz;
    float scale = positionHighAndScale.w;

#if defined(ROTATION) || defined(ALIGNED_AXIS)
    float rotation = positionLowAndRotation.w;
#else
    float rotation = 0.0;
#endif

    float compressed = compressedAttribute0.x;

    vec2 pixelOffset;
    pixelOffset.x = floor(compressed * SHIFT_RIGHT7);
    compressed -= pixelOffset.x * SHIFT_LEFT7;
    pixelOffset.x -= UPPER_BOUND;

    vec2 origin;
    origin.x = floor(compressed * SHIFT_RIGHT5);
    compressed -= origin.x * SHIFT_LEFT5;

    origin.y = floor(compressed * SHIFT_RIGHT3);
    compressed -= origin.y * SHIFT_LEFT3;

#ifdef FRAGMENT_DEPTH_CHECK
    vec2 depthOrigin = origin.xy;
#endif
    origin -= vec2(1.0);

    float show = floor(compressed * SHIFT_RIGHT2);
    compressed -= show * SHIFT_LEFT2;

#ifdef INSTANCED
    vec2 textureCoordinatesBottomLeft = czm_decompressTextureCoordinates(compressedAttribute0.w);
    vec2 textureCoordinatesRange = czm_decompressTextureCoordinates(eyeOffset.w);
    vec2 textureCoordinates = textureCoordinatesBottomLeft + direction * textureCoordinatesRange;
#else
    vec2 direction;
    direction.x = floor(compressed * SHIFT_RIGHT1);
    direction.y = compressed - direction.x * SHIFT_LEFT1;

    vec2 textureCoordinates = czm_decompressTextureCoordinates(compressedAttribute0.w);
#endif

    float temp = compressedAttribute0.y  * SHIFT_RIGHT8;
    pixelOffset.y = -(floor(temp) - UPPER_BOUND);

    vec2 translate;
    translate.y = (temp - floor(temp)) * SHIFT_LEFT16;

    temp = compressedAttribute0.z * SHIFT_RIGHT8;
    translate.x = floor(temp) - UPPER_BOUND;

    translate.y += (temp - floor(temp)) * SHIFT_LEFT8;
    translate.y -= UPPER_BOUND;

    temp = compressedAttribute1.x * SHIFT_RIGHT8;
    float temp2 = floor(compressedAttribute2.w * SHIFT_RIGHT2);

    vec2 imageSize = vec2(floor(temp), temp2);

#ifdef FRAGMENT_DEPTH_CHECK
    float labelHorizontalOrigin = floor(compressedAttribute2.w - (temp2 * SHIFT_LEFT2));
    float applyTranslate = 0.0;
    if (labelHorizontalOrigin != 0.0) // is a billboard, so set apply translate to false
    {
        applyTranslate = 1.0;
        labelHorizontalOrigin -= 2.0;
        depthOrigin.x = labelHorizontalOrigin + 1.0;
    }

    depthOrigin = vec2(1.0) - (depthOrigin * 0.5);
#endif

#ifdef EYE_DISTANCE_TRANSLUCENCY
    vec4 translucencyByDistance;
    translucencyByDistance.x = compressedAttribute1.z;
    translucencyByDistance.z = compressedAttribute1.w;

    translucencyByDistance.y = ((temp - floor(temp)) * SHIFT_LEFT8) / 255.0;

    temp = compressedAttribute1.y * SHIFT_RIGHT8;
    translucencyByDistance.w = ((temp - floor(temp)) * SHIFT_LEFT8) / 255.0;
#endif

#if defined(VERTEX_DEPTH_CHECK) || defined(FRAGMENT_DEPTH_CHECK)
    temp = compressedAttribute3.w;
    temp = temp * SHIFT_RIGHT12;

    vec2 dimensions;
    dimensions.y = (temp - floor(temp)) * SHIFT_LEFT12;
    dimensions.x = floor(temp);
#endif

#ifdef ALIGNED_AXIS
    vec3 alignedAxis = czm_octDecode(floor(compressedAttribute1.y * SHIFT_RIGHT8));
    temp = compressedAttribute2.z * SHIFT_RIGHT5;
    bool validAlignedAxis = (temp - floor(temp)) * SHIFT_LEFT1 > 0.0;
#else
    vec3 alignedAxis = vec3(0.0);
    bool validAlignedAxis = false;
#endif

    vec4 pickColor;
    vec4 color;

    temp = compressedAttribute2.y;
    temp = temp * SHIFT_RIGHT8;
    pickColor.b = (temp - floor(temp)) * SHIFT_LEFT8;
    temp = floor(temp) * SHIFT_RIGHT8;
    pickColor.g = (temp - floor(temp)) * SHIFT_LEFT8;
    pickColor.r = floor(temp);

    temp = compressedAttribute2.x;
    temp = temp * SHIFT_RIGHT8;
    color.b = (temp - floor(temp)) * SHIFT_LEFT8;
    temp = floor(temp) * SHIFT_RIGHT8;
    color.g = (temp - floor(temp)) * SHIFT_LEFT8;
    color.r = floor(temp);

    temp = compressedAttribute2.z * SHIFT_RIGHT8;
    bool sizeInMeters = floor((temp - floor(temp)) * SHIFT_LEFT7) > 0.0;
    temp = floor(temp) * SHIFT_RIGHT8;

    pickColor.a = (temp - floor(temp)) * SHIFT_LEFT8;
    pickColor /= 255.0;

    color.a = floor(temp);
    color /= 255.0;

    ///////////////////////////////////////////////////////////////////////////

    vec4 p = czm_translateRelativeToEye(positionHigh, positionLow);
    vec4 positionEC = czm_modelViewRelativeToEye * p;

#if defined(FRAGMENT_DEPTH_CHECK) || defined(VERTEX_DEPTH_CHECK)
    float eyeDepth = positionEC.z;
#endif

    positionEC = czm_eyeOffset(positionEC, eyeOffset.xyz);
    positionEC.xyz *= show;

    ///////////////////////////////////////////////////////////////////////////

#if defined(EYE_DISTANCE_SCALING) || defined(EYE_DISTANCE_TRANSLUCENCY) || defined(EYE_DISTANCE_PIXEL_OFFSET) || defined(DISTANCE_DISPLAY_CONDITION) || defined(DISABLE_DEPTH_DISTANCE)
    float lengthSq;
    if (czm_sceneMode == czm_sceneMode2D)
    {
        // 2D camera distance is a special case
        // treat all billboards as flattened to the z=0.0 plane
        lengthSq = czm_eyeHeight2D.y;
    }
    else
    {
        lengthSq = dot(positionEC.xyz, positionEC.xyz);
    }
#endif

#ifdef EYE_DISTANCE_SCALING
    float distanceScale = czm_nearFarScalar(scaleByDistance, lengthSq);
    scale *= distanceScale;
    translate *= distanceScale;
    // push vertex behind near plane for clipping
    if (scale == 0.0)
    {
        positionEC.xyz = vec3(0.0);
    }
#endif

    float translucency = 1.0;
#ifdef EYE_DISTANCE_TRANSLUCENCY
    translucency = czm_nearFarScalar(translucencyByDistance, lengthSq);
    // push vertex behind near plane for clipping
    if (translucency == 0.0)
    {
        positionEC.xyz = vec3(0.0);
    }
#endif

#ifdef EYE_DISTANCE_PIXEL_OFFSET
    float pixelOffsetScale = czm_nearFarScalar(pixelOffsetScaleByDistance, lengthSq);
    pixelOffset *= pixelOffsetScale;
#endif

#ifdef DISTANCE_DISPLAY_CONDITION
    float nearSq = compressedAttribute3.x;
    float farSq = compressedAttribute3.y;
    if (lengthSq < nearSq || lengthSq > farSq)
    {
        positionEC.xyz = vec3(0.0);
    }
#endif

    mat2 rotationMatrix;
    float mpp;

#ifdef DISABLE_DEPTH_DISTANCE
    float disableDepthTestDistance = compressedAttribute3.z;
#endif

#ifdef VERTEX_DEPTH_CHECK
if (lengthSq < disableDepthTestDistance) {
    float depthsilon = 10.0;

    vec2 labelTranslate = textureCoordinateBoundsOrLabelTranslate.xy;
    vec4 pEC1 = addScreenSpaceOffset(positionEC, dimensions, scale, vec2(0.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);
    float globeDepth1 = getGlobeDepth(pEC1);

    if (globeDepth1 != 0.0 && pEC1.z + depthsilon < globeDepth1)
    {
        vec4 pEC2 = addScreenSpaceOffset(positionEC, dimensions, scale, vec2(0.0, 1.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);
        float globeDepth2 = getGlobeDepth(pEC2);

        if (globeDepth2 != 0.0 && pEC2.z + depthsilon < globeDepth2)
        {
            vec4 pEC3 = addScreenSpaceOffset(positionEC, dimensions, scale, vec2(1.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);
            float globeDepth3 = getGlobeDepth(pEC3);
            if (globeDepth3 != 0.0 && pEC3.z + depthsilon < globeDepth3)
            {
                positionEC.xyz = vec3(0.0);
            }
        }
    }
}
#endif

    positionEC = addScreenSpaceOffset(positionEC, imageSize, scale, direction, origin, translate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);
    gl_Position = czm_projection * positionEC;
    v_textureCoordinates = textureCoordinates;

#ifdef LOG_DEPTH
    czm_vertexLogDepth();
#endif

#ifdef DISABLE_DEPTH_DISTANCE
    if (disableDepthTestDistance == 0.0 && czm_minimumDisableDepthTestDistance != 0.0)
    {
        disableDepthTestDistance = czm_minimumDisableDepthTestDistance;
    }

    if (disableDepthTestDistance != 0.0)
    {
        // Don't try to "multiply both sides" by w.  Greater/less-than comparisons won't work for negative values of w.
        float zclip = gl_Position.z / gl_Position.w;
        bool clipped = (zclip < -1.0 || zclip > 1.0);
        if (!clipped && (disableDepthTestDistance < 0.0 || (lengthSq > 0.0 && lengthSq < disableDepthTestDistance)))
        {
            // Position z on the near plane.
            gl_Position.z = -gl_Position.w;
#ifdef LOG_DEPTH
            v_depthFromNearPlusOne = 1.0;
#endif
        }
    }
#endif

#ifdef FRAGMENT_DEPTH_CHECK
    if (sizeInMeters) {
        translate /= mpp;
        dimensions /= mpp;
        imageSize /= mpp;
    }

#if defined(ROTATION) || defined(ALIGNED_AXIS)
    v_rotationMatrix = rotationMatrix;
#else
    v_rotationMatrix = mat2(1.0, 0.0, 0.0, 1.0);
#endif

    float enableDepthCheck = 0.0;
    if (lengthSq < disableDepthTestDistance)
    {
        enableDepthCheck = 1.0;
    }

    float dw = floor(clamp(dimensions.x, 0.0, SHIFT_LEFT12));
    float dh = floor(clamp(dimensions.y, 0.0, SHIFT_LEFT12));

    float iw = floor(clamp(imageSize.x, 0.0, SHIFT_LEFT12));
    float ih = floor(clamp(imageSize.y, 0.0, SHIFT_LEFT12));

    v_compressed.x = eyeDepth;
    v_compressed.y = applyTranslate * SHIFT_LEFT1 + enableDepthCheck;
    v_compressed.z = dw * SHIFT_LEFT12 + dh;
    v_compressed.w = iw * SHIFT_LEFT12 + ih;
    v_originTextureCoordinateAndTranslate.xy = depthOrigin;
    v_originTextureCoordinateAndTranslate.zw = translate;
    v_textureCoordinateBounds = textureCoordinateBoundsOrLabelTranslate;

#endif

#ifdef SDF
    vec4 outlineColor;
    float outlineWidth;

    temp = sdf.x;
    temp = temp * SHIFT_RIGHT8;
    outlineColor.b = (temp - floor(temp)) * SHIFT_LEFT8;
    temp = floor(temp) * SHIFT_RIGHT8;
    outlineColor.g = (temp - floor(temp)) * SHIFT_LEFT8;
    outlineColor.r = floor(temp);

    temp = sdf.y;
    temp = temp * SHIFT_RIGHT8;
    float temp3 = (temp - floor(temp)) * SHIFT_LEFT8;
    temp = floor(temp) * SHIFT_RIGHT8;
    outlineWidth = (temp - floor(temp)) * SHIFT_LEFT8;
    outlineColor.a = floor(temp);
    outlineColor /= 255.0;

    v_outlineWidth = outlineWidth / 255.0;
    v_outlineColor = outlineColor;
    v_outlineColor.a *= translucency;
#endif

    v_pickColor = pickColor;

    v_color = color;
    v_color.a *= translucency;
    v_splitDirection = splitDirection;
}
`;function Ue(e,t){if(e=T(e,T.EMPTY_OBJECT),l(e.disableDepthTestDistance)&&e.disableDepthTestDistance<0)throw new A("disableDepthTestDistance must be greater than or equal to 0.0.");let n=e.translucencyByDistance,i=e.pixelOffsetScaleByDistance,r=e.scaleByDistance,s=e.distanceDisplayCondition;if(l(n)){if(n.far<=n.near)throw new A("translucencyByDistance.far must be greater than translucencyByDistance.near.");n=Bt.clone(n)}if(l(i)){if(i.far<=i.near)throw new A("pixelOffsetScaleByDistance.far must be greater than pixelOffsetScaleByDistance.near.");i=Bt.clone(i)}if(l(r)){if(r.far<=r.near)throw new A("scaleByDistance.far must be greater than scaleByDistance.near.");r=Bt.clone(r)}if(l(s)){if(s.far<=s.near)throw new A("distanceDisplayCondition.far must be greater than distanceDisplayCondition.near.");s=$n.clone(s)}this._show=T(e.show,!0),this._position=m.clone(T(e.position,m.ZERO)),this._actualPosition=m.clone(this._position),this._pixelOffset=k.clone(T(e.pixelOffset,k.ZERO)),this._translate=new k(0,0),this._eyeOffset=m.clone(T(e.eyeOffset,m.ZERO)),this._heightReference=T(e.heightReference,fa.NONE),this._verticalOrigin=T(e.verticalOrigin,yn.CENTER),this._horizontalOrigin=T(e.horizontalOrigin,As.CENTER),this._scale=T(e.scale,1),this._color=M.clone(T(e.color,M.WHITE)),this._rotation=T(e.rotation,0),this._alignedAxis=m.clone(T(e.alignedAxis,m.ZERO)),this._width=e.width,this._height=e.height,this._scaleByDistance=r,this._translucencyByDistance=n,this._pixelOffsetScaleByDistance=i,this._sizeInMeters=T(e.sizeInMeters,!1),this._distanceDisplayCondition=s,this._disableDepthTestDistance=e.disableDepthTestDistance,this._id=e.id,this._collection=T(e.collection,t),this._pickId=void 0,this._pickPrimitive=T(e._pickPrimitive,this),this._billboardCollection=t,this._dirty=!1,this._index=-1,this._batchIndex=void 0,this._imageIndex=-1,this._imageIndexPromise=void 0,this._imageId=void 0,this._image=void 0,this._imageSubRegion=void 0,this._imageWidth=void 0,this._imageHeight=void 0,this._labelDimensions=void 0,this._labelHorizontalOrigin=void 0,this._labelTranslate=void 0;const o=e.image;let a=e.imageId;l(o)&&(l(a)||(typeof o=="string"?a=o:l(o.src)?a=o.src:a=dc()),this._imageId=a,this._image=o),l(e.imageSubRegion)&&(this._imageId=a,this._imageSubRegion=e.imageSubRegion),l(this._billboardCollection._textureAtlas)&&this._loadImage(),this._actualClampedPosition=void 0,this._removeCallbackFunc=void 0,this._mode=Ie.SCENE3D,this._clusterShow=!0,this._outlineColor=M.clone(T(e.outlineColor,M.BLACK)),this._outlineWidth=T(e.outlineWidth,0),this._updateClamping(),this._splitDirection=T(e.splitDirection,tm.NONE)}const rO=Ue.SHOW_INDEX=0,h_=Ue.POSITION_INDEX=1,TF=Ue.PIXEL_OFFSET_INDEX=2,Rpe=Ue.EYE_OFFSET_INDEX=3,Dpe=Ue.HORIZONTAL_ORIGIN_INDEX=4,Mpe=Ue.VERTICAL_ORIGIN_INDEX=5,Lpe=Ue.SCALE_INDEX=6,d_=Ue.IMAGE_INDEX_INDEX=7,sO=Ue.COLOR_INDEX=8,Ppe=Ue.ROTATION_INDEX=9,Npe=Ue.ALIGNED_AXIS_INDEX=10,Fpe=Ue.SCALE_BY_DISTANCE_INDEX=11,Bpe=Ue.TRANSLUCENCY_BY_DISTANCE_INDEX=12,zpe=Ue.PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX=13,Upe=Ue.DISTANCE_DISPLAY_CONDITION=14,kpe=Ue.DISABLE_DEPTH_DISTANCE=15;Ue.TEXTURE_COORDINATE_BOUNDS=16;const oO=Ue.SDF_INDEX=17,jpe=Ue.SPLIT_DIRECTION_INDEX=18;Ue.NUMBER_OF_PROPERTIES=19;function dn(e,t){const n=e._billboardCollection;l(n)&&(n._updateBillboard(e,t),e._dirty=!0)}Object.defineProperties(Ue.prototype,{show:{get:function(){return this._show},set:function(e){y.typeOf.bool("value",e),this._show!==e&&(this._show=e,dn(this,rO))}},position:{get:function(){return this._position},set:function(e){y.typeOf.object("value",e);const t=this._position;m.equals(t,e)||(m.clone(e,t),m.clone(e,this._actualPosition),this._updateClamping(),dn(this,h_))}},heightReference:{get:function(){return this._heightReference},set:function(e){y.typeOf.number("value",e);const t=this._heightReference;e!==t&&(this._heightReference=e,this._updateClamping(),dn(this,h_))}},pixelOffset:{get:function(){return this._pixelOffset},set:function(e){y.typeOf.object("value",e);const t=this._pixelOffset;k.equals(t,e)||(k.clone(e,t),dn(this,TF))}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(e){if(l(e)&&(y.typeOf.object("value",e),e.far<=e.near))throw new A("far distance must be greater than near distance.");const t=this._scaleByDistance;Bt.equals(t,e)||(this._scaleByDistance=Bt.clone(e,t),dn(this,Fpe))}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(e){if(l(e)&&(y.typeOf.object("value",e),e.far<=e.near))throw new A("far distance must be greater than near distance.");const t=this._translucencyByDistance;Bt.equals(t,e)||(this._translucencyByDistance=Bt.clone(e,t),dn(this,Bpe))}},pixelOffsetScaleByDistance:{get:function(){return this._pixelOffsetScaleByDistance},set:function(e){if(l(e)&&(y.typeOf.object("value",e),e.far<=e.near))throw new A("far distance must be greater than near distance.");const t=this._pixelOffsetScaleByDistance;Bt.equals(t,e)||(this._pixelOffsetScaleByDistance=Bt.clone(e,t),dn(this,zpe))}},eyeOffset:{get:function(){return this._eyeOffset},set:function(e){y.typeOf.object("value",e);const t=this._eyeOffset;m.equals(t,e)||(m.clone(e,t),dn(this,Rpe))}},horizontalOrigin:{get:function(){return this._horizontalOrigin},set:function(e){y.typeOf.number("value",e),this._horizontalOrigin!==e&&(this._horizontalOrigin=e,dn(this,Dpe))}},verticalOrigin:{get:function(){return this._verticalOrigin},set:function(e){y.typeOf.number("value",e),this._verticalOrigin!==e&&(this._verticalOrigin=e,dn(this,Mpe))}},scale:{get:function(){return this._scale},set:function(e){y.typeOf.number("value",e),this._scale!==e&&(this._scale=e,dn(this,Lpe))}},color:{get:function(){return this._color},set:function(e){y.typeOf.object("value",e);const t=this._color;M.equals(t,e)||(M.clone(e,t),dn(this,sO))}},rotation:{get:function(){return this._rotation},set:function(e){y.typeOf.number("value",e),this._rotation!==e&&(this._rotation=e,dn(this,Ppe))}},alignedAxis:{get:function(){return this._alignedAxis},set:function(e){y.typeOf.object("value",e);const t=this._alignedAxis;m.equals(t,e)||(m.clone(e,t),dn(this,Npe))}},width:{get:function(){return T(this._width,this._imageWidth)},set:function(e){l(e)&&y.typeOf.number("value",e),this._width!==e&&(this._width=e,dn(this,d_))}},height:{get:function(){return T(this._height,this._imageHeight)},set:function(e){l(e)&&y.typeOf.number("value",e),this._height!==e&&(this._height=e,dn(this,d_))}},sizeInMeters:{get:function(){return this._sizeInMeters},set:function(e){y.typeOf.bool("value",e),this._sizeInMeters!==e&&(this._sizeInMeters=e,dn(this,sO))}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){if(!$n.equals(e,this._distanceDisplayCondition)){if(l(e)&&(y.typeOf.object("value",e),e.far<=e.near))throw new A("far distance must be greater than near distance.");this._distanceDisplayCondition=$n.clone(e,this._distanceDisplayCondition),dn(this,Upe)}}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(e){if(l(e)&&(y.typeOf.number("value",e),e<0))throw new A("disableDepthTestDistance must be greater than or equal to 0.0.");this._disableDepthTestDistance!==e&&(this._disableDepthTestDistance=e,dn(this,kpe))}},id:{get:function(){return this._id},set:function(e){this._id=e,l(this._pickId)&&(this._pickId.object.id=e)}},pickPrimitive:{get:function(){return this._pickPrimitive},set:function(e){this._pickPrimitive=e,l(this._pickId)&&(this._pickId.object.primitive=e)}},pickId:{get:function(){return this._pickId}},image:{get:function(){return this._imageId},set:function(e){l(e)?typeof e=="string"?this.setImage(e,e):e instanceof se?this.setImage(e.url,e):l(e.src)?this.setImage(e.src,e):this.setImage(dc(),e):(this._imageIndex=-1,this._imageSubRegion=void 0,this._imageId=void 0,this._image=void 0,this._imageIndexPromise=void 0,dn(this,d_))}},ready:{get:function(){return this._imageIndex!==-1}},_clampedPosition:{get:function(){return this._actualClampedPosition},set:function(e){this._actualClampedPosition=m.clone(e,this._actualClampedPosition),dn(this,h_)}},clusterShow:{get:function(){return this._clusterShow},set:function(e){this._clusterShow!==e&&(this._clusterShow=e,dn(this,rO))}},outlineColor:{get:function(){return this._outlineColor},set:function(e){if(!l(e))throw new A("value is required.");const t=this._outlineColor;M.equals(t,e)||(M.clone(e,t),dn(this,oO))}},outlineWidth:{get:function(){return this._outlineWidth},set:function(e){this._outlineWidth!==e&&(this._outlineWidth=e,dn(this,oO))}},splitDirection:{get:function(){return this._splitDirection},set:function(e){this._splitDirection!==e&&(this._splitDirection=e,dn(this,jpe))}}});Ue.prototype.getPickId=function(e){return l(this._pickId)||(this._pickId=e.createPickId({primitive:this._pickPrimitive,collection:this._collection,id:this._id})),this._pickId};Ue.prototype._updateClamping=function(){Ue._updateClamping(this._billboardCollection,this)};const p_=new oe;Ue._updateClamping=function(e,t){const n=e._scene;if(!l(n)){if(t._heightReference!==fa.NONE)throw new A("Height reference is not supported without a scene.");return}const i=T(n.ellipsoid,fe.default),r=n.frameState.mode,s=r!==t._mode;if(t._mode=r,(t._heightReference===fa.NONE||s)&&l(t._removeCallbackFunc)&&(t._removeCallbackFunc(),t._removeCallbackFunc=void 0,t._clampedPosition=void 0),t._heightReference===fa.NONE||!l(t._position))return;l(t._removeCallbackFunc)&&t._removeCallbackFunc();const o=i.cartesianToCartographic(t._position);if(!l(o)){t._actualClampedPosition=void 0;return}function a(u){const h=i.cartographicToCartesian(u,t._clampedPosition);zP(t._heightReference)&&(t._mode===Ie.SCENE3D?(u.height+=o.height,i.cartographicToCartesian(u,h)):h.x+=o.height),t._clampedPosition=h}t._removeCallbackFunc=n.updateHeight(o,a,t._heightReference),oe.clone(o,p_);const c=n.getHeight(o,t._heightReference);l(c)&&(p_.height=c),a(p_)};Ue.prototype._loadImage=function(){const e=this._billboardCollection._textureAtlas,t=this._imageId,n=this._image,i=this._imageSubRegion;let r;const s=this;function o(c){if(s._imageId!==t||s._image!==n||!Ot.equals(s._imageSubRegion,i))return;const u=e.textureCoordinates[c];s._imageWidth=e.texture.width*u.width,s._imageHeight=e.texture.height*u.height,s._imageIndex=c,s._ready=!0,s._image=void 0,s._imageIndexPromise=void 0,dn(s,d_);const h=s._billboardCollection._scene;l(h)&&h.frameState.afterRender.push(()=>!0)}if(l(n)&&(r=e.addImage(t,n)),l(i)&&(r=e.addSubRegion(t,i)),this._imageIndexPromise=r,!l(r))return;const a=e.getImageIndex(t);if(l(a)&&!l(i)){o(a);return}r.then(o).catch(function(c){console.error(`Error loading image for billboard: ${c}`),s._imageIndexPromise=void 0})};Ue.prototype.setImage=function(e,t){if(!l(e))throw new A("id is required.");if(!l(t))throw new A("image is required.");this._imageId!==e&&(this._imageIndex=-1,this._imageSubRegion=void 0,this._imageId=e,this._image=t,l(this._billboardCollection._textureAtlas)&&this._loadImage())};Ue.prototype.setImageSubRegion=function(e,t){if(!l(e))throw new A("id is required.");if(!l(t))throw new A("subRegion is required.");this._imageId===e&&Ot.equals(this._imageSubRegion,t)||(this._imageIndex=-1,this._imageId=e,this._imageSubRegion=Ot.clone(t),l(this._billboardCollection._textureAtlas)&&this._loadImage())};Ue.prototype._setTranslate=function(e){if(!l(e))throw new A("value is required.");const t=this._translate;k.equals(t,e)||(k.clone(e,t),dn(this,TF))};Ue.prototype._getActualPosition=function(){return l(this._clampedPosition)?this._clampedPosition:this._actualPosition};Ue.prototype._setActualPosition=function(e){l(this._clampedPosition)||m.clone(e,this._actualPosition),dn(this,h_)};const aO=new Y;Ue._computeActualPosition=function(e,t,n,i){return l(e._clampedPosition)?(n.mode!==e._mode&&e._updateClamping(),e._clampedPosition):n.mode===Ie.SCENE3D?t:(P.multiplyByPoint(i,t,aO),an.computeActualEllipsoidPosition(n,aO))};const xF=new m;Ue._computeScreenSpacePosition=function(e,t,n,i,r,s){const o=P.multiplyByPoint(e,t,xF),a=an.worldWithEyeOffsetToWindowCoordinates(r,o,n,s);if(l(a))return k.add(a,i,a),a};const Ag=new k(0,0);Ue.prototype.computeScreenSpacePosition=function(e,t){const n=this._billboardCollection;if(l(t)||(t=new k),!l(n))throw new A("Billboard must be in a collection.  Was it removed?");if(!l(e))throw new A("scene is required.");k.clone(this._pixelOffset,Ag),k.add(Ag,this._translate,Ag);let i=n.modelMatrix,r=this._position;if(l(this._clampedPosition)&&(r=this._clampedPosition,e.mode!==Ie.SCENE3D)){const o=e.mapProjection,a=o.ellipsoid,c=o.unproject(r,p_);r=a.cartographicToCartesian(c,xF),i=P.IDENTITY}return Ue._computeScreenSpacePosition(i,r,this._eyeOffset,Ag,e,t)};Ue.getScreenSpaceBoundingBox=function(e,t,n){let i=e.width,r=e.height;const s=e.scale;i*=s,r*=s;let o=t.x;e.horizontalOrigin===As.RIGHT?o-=i:e.horizontalOrigin===As.CENTER&&(o-=i*.5);let a=t.y;return e.verticalOrigin===yn.BOTTOM||e.verticalOrigin===yn.BASELINE?a-=r:e.verticalOrigin===yn.CENTER&&(a-=r*.5),l(n)||(n=new Ot),n.x=o,n.y=a,n.width=i,n.height=r,n};Ue.prototype.equals=function(e){return this===e||l(e)&&this._id===e._id&&m.equals(this._position,e._position)&&this._imageId===e._imageId&&this._show===e._show&&this._scale===e._scale&&this._verticalOrigin===e._verticalOrigin&&this._horizontalOrigin===e._horizontalOrigin&&this._heightReference===e._heightReference&&Ot.equals(this._imageSubRegion,e._imageSubRegion)&&M.equals(this._color,e._color)&&k.equals(this._pixelOffset,e._pixelOffset)&&k.equals(this._translate,e._translate)&&m.equals(this._eyeOffset,e._eyeOffset)&&Bt.equals(this._scaleByDistance,e._scaleByDistance)&&Bt.equals(this._translucencyByDistance,e._translucencyByDistance)&&Bt.equals(this._pixelOffsetScaleByDistance,e._pixelOffsetScaleByDistance)&&$n.equals(this._distanceDisplayCondition,e._distanceDisplayCondition)&&this._disableDepthTestDistance===e._disableDepthTestDistance&&this._splitDirection===e._splitDirection};Ue.prototype._destroy=function(){l(this._customData)&&(this._billboardCollection._scene.globe._surface.removeTileCustomData(this._customData),this._customData=void 0),l(this._removeCallbackFunc)&&(this._removeCallbackFunc(),this._removeCallbackFunc=void 0),this.image=void 0,this._pickId=this._pickId&&this._pickId.destroy(),this._billboardCollection=void 0};const Vpe={OPAQUE:0,TRANSLUCENT:1,OPAQUE_AND_TRANSLUCENT:2},hs=Object.freeze(Vpe),Gpe={FONT_SIZE:48,PADDING:10,RADIUS:8,CUTOFF:.25},ys=Object.freeze(Gpe);function Ga(e,t,n,i,r){this.bottomLeft=T(e,k.ZERO),this.topRight=T(t,k.ZERO),this.childNode1=n,this.childNode2=i,this.imageIndex=r}const Hpe=new k(16,16);function xa(e){e=T(e,T.EMPTY_OBJECT);const t=T(e.borderWidthInPixels,1),n=T(e.initialSize,Hpe);if(!l(e.context))throw new A("context is required.");if(t<0)throw new A("borderWidthInPixels must be greater than or equal to zero.");if(n.x<1||n.y<1)throw new A("initialSize must be greater than zero.");this._context=e.context,this._pixelFormat=T(e.pixelFormat,Le.RGBA),this._borderWidthInPixels=t,this._textureCoordinates=[],this._guid=dc(),this._idHash={},this._indexHash={},this._initialSize=n,this._root=void 0}Object.defineProperties(xa.prototype,{borderWidthInPixels:{get:function(){return this._borderWidthInPixels}},textureCoordinates:{get:function(){return this._textureCoordinates}},texture:{get:function(){return l(this._texture)||(this._texture=new kt({context:this._context,width:this._initialSize.x,height:this._initialSize.y,pixelFormat:this._pixelFormat})),this._texture}},numberOfImages:{get:function(){return this._textureCoordinates.length}},guid:{get:function(){return this._guid}}});function qpe(e,t){const n=e._context,i=e.numberOfImages,r=2,s=e._borderWidthInPixels;if(i>0){const o=e._texture.width,a=e._texture.height,c=r*(o+t.width+s),u=r*(a+t.height+s),h=o/c,d=a/u,p=new Ga(new k(o+s,s),new k(c,a)),g=new Ga(new k,new k(c,a),e._root,p),_=new Ga(new k(s,a+s),new k(c,u)),b=new Ga(new k,new k(c,u),g,_);for(let C=0;C<e._textureCoordinates.length;C++){const w=e._textureCoordinates[C];l(w)&&(w.x*=h,w.y*=d,w.width*=h,w.height*=d)}const x=new kt({context:e._context,width:c,height:u,pixelFormat:e._pixelFormat}),E=new as({context:n,colorTextures:[e._texture],destroyAttachments:!1});E._bind(),x.copyFromFramebuffer(0,0,0,0,c,u),E._unBind(),E.destroy(),e._texture=e._texture&&e._texture.destroy(),e._texture=x,e._root=b}else{let o=r*(t.width+2*s),a=r*(t.height+2*s);o<e._initialSize.x&&(o=e._initialSize.x),a<e._initialSize.y&&(a=e._initialSize.y),e._texture=e._texture&&e._texture.destroy(),e._texture=new kt({context:e._context,width:o,height:a,pixelFormat:e._pixelFormat}),e._root=new Ga(new k(s,s),new k(o,a))}}function m_(e,t,n){if(l(t)){if(!l(t.childNode1)&&!l(t.childNode2)){if(l(t.imageIndex))return;const i=t.topRight.x-t.bottomLeft.x,r=t.topRight.y-t.bottomLeft.y,s=i-n.width,o=r-n.height;if(s<0||o<0)return;if(s===0&&o===0)return t;if(s>o){t.childNode1=new Ga(new k(t.bottomLeft.x,t.bottomLeft.y),new k(t.bottomLeft.x+n.width,t.topRight.y));const a=t.bottomLeft.x+n.width+e._borderWidthInPixels;a<t.topRight.x&&(t.childNode2=new Ga(new k(a,t.bottomLeft.y),new k(t.topRight.x,t.topRight.y)))}else{t.childNode1=new Ga(new k(t.bottomLeft.x,t.bottomLeft.y),new k(t.topRight.x,t.bottomLeft.y+n.height));const a=t.bottomLeft.y+n.height+e._borderWidthInPixels;a<t.topRight.y&&(t.childNode2=new Ga(new k(t.bottomLeft.x,a),new k(t.topRight.x,t.topRight.y)))}return m_(e,t.childNode1,n)}return m_(e,t.childNode1,n)||m_(e,t.childNode2,n)}}function EF(e,t,n){const i=m_(e,e._root,t);if(l(i)){i.imageIndex=n;const r=e._texture.width,s=e._texture.height,o=i.topRight.x-i.bottomLeft.x,a=i.topRight.y-i.bottomLeft.y,c=i.bottomLeft.x/r,u=i.bottomLeft.y/s,h=o/r,d=a/s;e._textureCoordinates[n]=new Ot(c,u,h,d),e._texture.copyFrom({source:t,xOffset:i.bottomLeft.x,yOffset:i.bottomLeft.y})}else qpe(e,t),EF(e,t,n);e._guid=dc()}function CF(e,t){if(!l(e)||e.isDestroyed())return-1;const n=e.numberOfImages;return EF(e,t,n),n}xa.prototype.getImageIndex=function(e){if(!l(e))throw new A("id is required.");return this._indexHash[e]};xa.prototype.addImageSync=function(e,t){if(!l(e))throw new A("id is required.");if(!l(t))throw new A("image is required.");let n=this._indexHash[e];return l(n)||(n=CF(this,t),this._idHash[e]=Promise.resolve(n),this._indexHash[e]=n),n};xa.prototype.addImage=function(e,t){if(!l(e))throw new A("id is required.");if(!l(t))throw new A("image is required.");let n=this._idHash[e];if(l(n))return n;if(typeof t=="function"){if(t=t(e),!l(t))throw new A("image is required.")}else(typeof t=="string"||t instanceof se)&&(t=se.createIfNeeded(t).fetchImage());const i=this;return n=Promise.resolve(t).then(function(r){const s=CF(i,r);return i._indexHash[e]=s,s}),this._idHash[e]=n,n};xa.prototype.addSubRegion=function(e,t){if(!l(e))throw new A("id is required.");if(!l(t))throw new A("subRegion is required.");const n=this._idHash[e];if(!l(n))throw new te(`image with id "${e}" not found in the atlas.`);const i=this;return Promise.resolve(n).then(function(r){if(r===-1)return-1;const s=i._texture.width,o=i._texture.height,a=i._textureCoordinates[r],c=a.x+t.x/s,u=a.y+t.y/o,h=t.width/s,d=t.height/o,p=i._textureCoordinates.push(new Ot(c,u,h,d))-1;return i._indexHash[e]=p,i._guid=dc(),p})};xa.prototype.isDestroyed=function(){return!1};xa.prototype.destroy=function(){return this._texture=this._texture&&this._texture.destroy(),Ye(this)};const Wpe=Ue.SHOW_INDEX,np=Ue.POSITION_INDEX,wF=Ue.PIXEL_OFFSET_INDEX,AF=Ue.EYE_OFFSET_INDEX,$pe=Ue.HORIZONTAL_ORIGIN_INDEX,Xpe=Ue.VERTICAL_ORIGIN_INDEX,Ype=Ue.SCALE_INDEX,yd=Ue.IMAGE_INDEX_INDEX,SF=Ue.COLOR_INDEX,Kpe=Ue.ROTATION_INDEX,Zpe=Ue.ALIGNED_AXIS_INDEX,vF=Ue.SCALE_BY_DISTANCE_INDEX,IF=Ue.TRANSLUCENCY_BY_DISTANCE_INDEX,OF=Ue.PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX,RF=Ue.DISTANCE_DISPLAY_CONDITION,Jpe=Ue.DISABLE_DEPTH_DISTANCE,Qpe=Ue.TEXTURE_COORDINATE_BOUNDS,DF=Ue.SDF_INDEX,MF=Ue.SPLIT_DIRECTION_INDEX,Uw=Ue.NUMBER_OF_PROPERTIES;let Zt;const eme={positionHighAndScale:0,positionLowAndRotation:1,compressedAttribute0:2,compressedAttribute1:3,compressedAttribute2:4,eyeOffset:5,scaleByDistance:6,pixelOffsetScaleByDistance:7,compressedAttribute3:8,textureCoordinateBoundsOrLabelTranslate:9,a_batchId:10,sdf:11,splitDirection:12},tme={direction:0,positionHighAndScale:1,positionLowAndRotation:2,compressedAttribute0:3,compressedAttribute1:4,compressedAttribute2:5,eyeOffset:6,scaleByDistance:7,pixelOffsetScaleByDistance:8,compressedAttribute3:9,textureCoordinateBoundsOrLabelTranslate:10,a_batchId:11,sdf:12,splitDirection:13};function cs(e){e=T(e,T.EMPTY_OBJECT),this._scene=e.scene,this._batchTable=e.batchTable,this._textureAtlas=void 0,this._textureAtlasGUID=void 0,this._destroyTextureAtlas=!0,this._sp=void 0,this._spTranslucent=void 0,this._rsOpaque=void 0,this._rsTranslucent=void 0,this._vaf=void 0,this._billboards=[],this._billboardsToUpdate=[],this._billboardsToUpdateIndex=0,this._billboardsRemoved=!1,this._createVertexArray=!1,this._shaderRotation=!1,this._compiledShaderRotation=!1,this._shaderAlignedAxis=!1,this._compiledShaderAlignedAxis=!1,this._shaderScaleByDistance=!1,this._compiledShaderScaleByDistance=!1,this._shaderTranslucencyByDistance=!1,this._compiledShaderTranslucencyByDistance=!1,this._shaderPixelOffsetScaleByDistance=!1,this._compiledShaderPixelOffsetScaleByDistance=!1,this._shaderDistanceDisplayCondition=!1,this._compiledShaderDistanceDisplayCondition=!1,this._shaderDisableDepthDistance=!1,this._compiledShaderDisableDepthDistance=!1,this._shaderClampToGround=!1,this._compiledShaderClampToGround=!1,this._propertiesChanged=new Uint32Array(Uw),this._maxSize=0,this._maxEyeOffset=0,this._maxScale=1,this._maxPixelOffset=0,this._allHorizontalCenter=!0,this._allVerticalCenter=!0,this._allSizedInMeters=!0,this._baseVolume=new ee,this._baseVolumeWC=new ee,this._baseVolume2D=new ee,this._boundingVolume=new ee,this._boundingVolumeDirty=!1,this._colorCommands=[],this.show=T(e.show,!0),this.modelMatrix=P.clone(T(e.modelMatrix,P.IDENTITY)),this._modelMatrix=P.clone(P.IDENTITY),this.debugShowBoundingVolume=T(e.debugShowBoundingVolume,!1),this.debugShowTextureAtlas=T(e.debugShowTextureAtlas,!1),this.blendOption=T(e.blendOption,hs.OPAQUE_AND_TRANSLUCENT),this._blendOption=void 0,this._mode=Ie.SCENE3D,this._buffersUsage=[Ae.STATIC_DRAW,Ae.STATIC_DRAW,Ae.STATIC_DRAW,Ae.STATIC_DRAW,Ae.STATIC_DRAW,Ae.STATIC_DRAW,Ae.STATIC_DRAW,Ae.STATIC_DRAW,Ae.STATIC_DRAW,Ae.STATIC_DRAW,Ae.STATIC_DRAW,Ae.STATIC_DRAW,Ae.STATIC_DRAW,Ae.STATIC_DRAW,Ae.STATIC_DRAW,Ae.STATIC_DRAW,Ae.STATIC_DRAW],this._highlightColor=M.clone(M.WHITE);const t=this;this._uniforms={u_atlas:function(){return t._textureAtlas.texture},u_highlightColor:function(){return t._highlightColor}};const n=this._scene;l(n)&&l(n.terrainProviderChanged)&&(this._removeCallbackFunc=n.terrainProviderChanged.addEventListener(function(){const i=this._billboards,r=i.length;for(let s=0;s<r;++s)l(i[s])&&i[s]._updateClamping()},this))}Object.defineProperties(cs.prototype,{length:{get:function(){return kw(this),this._billboards.length}},textureAtlas:{get:function(){return this._textureAtlas},set:function(e){this._textureAtlas!==e&&(this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._textureAtlas=e,this._createVertexArray=!0)}},destroyTextureAtlas:{get:function(){return this._destroyTextureAtlas},set:function(e){this._destroyTextureAtlas=e}}});function LF(e){const t=e.length;for(let n=0;n<t;++n)e[n]&&e[n]._destroy()}cs.prototype.add=function(e){const t=new Ue(e,this);return t._index=this._billboards.length,this._billboards.push(t),this._createVertexArray=!0,t};cs.prototype.remove=function(e){return this.contains(e)?(this._billboards[e._index]=void 0,this._billboardsRemoved=!0,this._createVertexArray=!0,e._destroy(),!0):!1};cs.prototype.removeAll=function(){LF(this._billboards),this._billboards=[],this._billboardsToUpdate=[],this._billboardsToUpdateIndex=0,this._billboardsRemoved=!1,this._createVertexArray=!0};function kw(e){if(e._billboardsRemoved){e._billboardsRemoved=!1;const t=[],n=e._billboards,i=n.length;for(let r=0,s=0;r<i;++r){const o=n[r];l(o)&&(o._index=s++,t.push(o))}e._billboards=t}}cs.prototype._updateBillboard=function(e,t){e._dirty||(this._billboardsToUpdate[this._billboardsToUpdateIndex++]=e),++this._propertiesChanged[t]};cs.prototype.contains=function(e){return l(e)&&e._billboardCollection===this};cs.prototype.get=function(e){return y.typeOf.number("index",e),kw(this),this._billboards[e]};let TT;function nme(e){let n=e.cache.billboardCollection_indexBufferBatched;if(l(n))return n;const i=16384*6-6,r=new Uint16Array(i);for(let s=0,o=0;s<i;s+=6,o+=4)r[s]=o,r[s+1]=o+1,r[s+2]=o+2,r[s+3]=o+0,r[s+4]=o+2,r[s+5]=o+3;return n=ze.createIndexBuffer({context:e,typedArray:r,usage:Ae.STATIC_DRAW,indexDatatype:Ge.UNSIGNED_SHORT}),n.vertexArrayDestroyable=!1,e.cache.billboardCollection_indexBufferBatched=n,n}function ime(e){let t=e.cache.billboardCollection_indexBufferInstanced;return l(t)||(t=ze.createIndexBuffer({context:e,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:Ae.STATIC_DRAW,indexDatatype:Ge.UNSIGNED_SHORT}),t.vertexArrayDestroyable=!1,e.cache.billboardCollection_indexBufferInstanced=t),t}function rme(e){let t=e.cache.billboardCollection_vertexBufferInstanced;return l(t)||(t=ze.createVertexBuffer({context:e,typedArray:new Float32Array([0,0,1,0,1,1,0,1]),usage:Ae.STATIC_DRAW}),t.vertexArrayDestroyable=!1,e.cache.billboardCollection_vertexBufferInstanced=t),t}cs.prototype.computeNewBuffersUsage=function(){const e=this._buffersUsage;let t=!1;const n=this._propertiesChanged;for(let i=0;i<Uw;++i){const r=n[i]===0?Ae.STATIC_DRAW:Ae.STREAM_DRAW;t=t||e[i]!==r,e[i]=r}return t};function sme(e,t,n,i,r,s){const o=[{index:Zt.positionHighAndScale,componentsPerAttribute:4,componentDatatype:q.FLOAT,usage:n[np]},{index:Zt.positionLowAndRotation,componentsPerAttribute:4,componentDatatype:q.FLOAT,usage:n[np]},{index:Zt.compressedAttribute0,componentsPerAttribute:4,componentDatatype:q.FLOAT,usage:n[wF]},{index:Zt.compressedAttribute1,componentsPerAttribute:4,componentDatatype:q.FLOAT,usage:n[IF]},{index:Zt.compressedAttribute2,componentsPerAttribute:4,componentDatatype:q.FLOAT,usage:n[SF]},{index:Zt.eyeOffset,componentsPerAttribute:4,componentDatatype:q.FLOAT,usage:n[AF]},{index:Zt.scaleByDistance,componentsPerAttribute:4,componentDatatype:q.FLOAT,usage:n[vF]},{index:Zt.pixelOffsetScaleByDistance,componentsPerAttribute:4,componentDatatype:q.FLOAT,usage:n[OF]},{index:Zt.compressedAttribute3,componentsPerAttribute:4,componentDatatype:q.FLOAT,usage:n[RF]},{index:Zt.textureCoordinateBoundsOrLabelTranslate,componentsPerAttribute:4,componentDatatype:q.FLOAT,usage:n[Qpe]},{index:Zt.splitDirection,componentsPerAttribute:1,componentDatatype:q.FLOAT,usage:n[MF]}];i&&o.push({index:Zt.direction,componentsPerAttribute:2,componentDatatype:q.FLOAT,vertexBuffer:rme(e)}),l(r)&&o.push({index:Zt.a_batchId,componentsPerAttribute:1,componentDatatype:q.FLOAT,bufferUsage:Ae.STATIC_DRAW}),s&&o.push({index:Zt.sdf,componentsPerAttribute:2,componentDatatype:q.FLOAT,usage:n[DF]});const a=i?t:4*t;return new Di(e,o,a,i)}const xT=new Tn;function PF(e,t,n,i,r){let s;const o=i[Zt.positionHighAndScale],a=i[Zt.positionLowAndRotation],c=r._getActualPosition();e._mode===Ie.SCENE3D&&(ee.expand(e._baseVolume,c,e._baseVolume),e._boundingVolumeDirty=!0),Tn.fromCartesian(c,xT);const u=r.scale,h=r.rotation;h!==0&&(e._shaderRotation=!0),e._maxScale=Math.max(e._maxScale,u);const d=xT.high,p=xT.low;e._instanced?(s=r._index,o(s,d.x,d.y,d.z,u),a(s,p.x,p.y,p.z,h)):(s=r._index*4,o(s+0,d.x,d.y,d.z,u),o(s+1,d.x,d.y,d.z,u),o(s+2,d.x,d.y,d.z,u),o(s+3,d.x,d.y,d.z,u),a(s+0,p.x,p.y,p.z,h),a(s+1,p.x,p.y,p.z,h),a(s+2,p.x,p.y,p.z,h),a(s+3,p.x,p.y,p.z,h))}const Us=new k,Ns=32768,Hf=65536,ET=4096,da=256,ome=128,ame=32,cme=8,NF=4,lme=1/256,FF=0,BF=2,zF=3,UF=1;function kF(e,t,n,i,r){let s;const o=i[Zt.compressedAttribute0],a=r.pixelOffset,c=a.x,u=a.y,h=r._translate,d=h.x,p=h.y;e._maxPixelOffset=Math.max(e._maxPixelOffset,Math.abs(c+d),Math.abs(-u+p));const g=r.horizontalOrigin;let _=r._verticalOrigin,b=r.show&&r.clusterShow;r.color.alpha===0&&(b=!1),_===yn.BASELINE&&(_=yn.BOTTOM),e._allHorizontalCenter=e._allHorizontalCenter&&g===As.CENTER,e._allVerticalCenter=e._allVerticalCenter&&_===yn.CENTER;let x=0,E=0,C=0,w=0;const S=r._imageIndex;if(S!==-1){const W=n[S];if(!l(W))throw new A(`Invalid billboard image index: ${S}`);x=W.x,E=W.y,C=W.width,w=W.height}const v=x+C,D=E+w;let L=Math.floor(R.clamp(c,-Ns,Ns)+Ns)*ome;L+=(g+1)*ame,L+=(_+1)*cme,L+=(b?1:0)*NF;let O=Math.floor(R.clamp(u,-Ns,Ns)+Ns)*da,N=Math.floor(R.clamp(d,-Ns,Ns)+Ns)*da;const B=(R.clamp(p,-Ns,Ns)+Ns)*lme,U=Math.floor(B),V=Math.floor((B-U)*da);O+=U,N+=V,Us.x=x,Us.y=E;const f=nt.compressTextureCoordinates(Us);Us.x=v;const I=nt.compressTextureCoordinates(Us);Us.y=D;const F=nt.compressTextureCoordinates(Us);Us.x=x;const G=nt.compressTextureCoordinates(Us);e._instanced?(s=r._index,o(s,L,O,N,f)):(s=r._index*4,o(s+0,L+FF,O,N,f),o(s+1,L+BF,O,N,I),o(s+2,L+zF,O,N,F),o(s+3,L+UF,O,N,G))}function jF(e,t,n,i,r){let s;const o=i[Zt.compressedAttribute1],a=r.alignedAxis;m.equals(a,m.ZERO)||(e._shaderAlignedAxis=!0);let c=0,u=1,h=1,d=1;const p=r.translucencyByDistance;l(p)&&(c=p.near,u=p.nearValue,h=p.far,d=p.farValue,(u!==1||d!==1)&&(e._shaderTranslucencyByDistance=!0));let g=0;const _=r._imageIndex;if(_!==-1){const w=n[_];if(!l(w))throw new A(`Invalid billboard image index: ${_}`);g=w.width}const b=e._textureAtlas.texture.width,x=Math.round(T(r.width,b*g));e._maxSize=Math.max(e._maxSize,x);let E=R.clamp(x,0,Hf),C=0;Math.abs(m.magnitudeSquared(a)-1)<R.EPSILON6&&(C=nt.octEncodeFloat(a)),u=R.clamp(u,0,1),u=u===1?255:u*255|0,E=E*da+u,d=R.clamp(d,0,1),d=d===1?255:d*255|0,C=C*da+d,e._instanced?(s=r._index,o(s,E,C,c,h)):(s=r._index*4,o(s+0,E,C,c,h),o(s+1,E,C,c,h),o(s+2,E,C,c,h),o(s+3,E,C,c,h))}function dE(e,t,n,i,r){let s;const o=i[Zt.compressedAttribute2],a=r.color,c=l(e._batchTable)?M.WHITE:r.getPickId(t.context).color,u=r.sizeInMeters?1:0,h=Math.abs(m.magnitudeSquared(r.alignedAxis)-1)<R.EPSILON6?1:0;e._allSizedInMeters=e._allSizedInMeters&&u===1;let d=0;const p=r._imageIndex;if(p!==-1){const L=n[p];if(!l(L))throw new A(`Invalid billboard image index: ${p}`);d=L.height}const g=e._textureAtlas.texture.dimensions,_=Math.round(T(r.height,g.y*d));e._maxSize=Math.max(e._maxSize,_);let b=T(r._labelHorizontalOrigin,-2);b+=2;const x=_*NF+b;let E=M.floatToByte(a.red),C=M.floatToByte(a.green),w=M.floatToByte(a.blue);const S=E*Hf+C*da+w;E=M.floatToByte(c.red),C=M.floatToByte(c.green),w=M.floatToByte(c.blue);const v=E*Hf+C*da+w;let D=M.floatToByte(a.alpha)*Hf+M.floatToByte(c.alpha)*da;D+=u*2+h,e._instanced?(s=r._index,o(s,S,v,D,x)):(s=r._index*4,o(s+0,S,v,D,x),o(s+1,S,v,D,x),o(s+2,S,v,D,x),o(s+3,S,v,D,x))}function pE(e,t,n,i,r){let s;const o=i[Zt.eyeOffset],a=r.eyeOffset;let c=a.z;if(r._heightReference!==fa.NONE&&(c*=1.005),e._maxEyeOffset=Math.max(e._maxEyeOffset,Math.abs(a.x),Math.abs(a.y),Math.abs(c)),e._instanced){let u=0,h=0;const d=r._imageIndex;if(d!==-1){const g=n[d];if(!l(g))throw new A(`Invalid billboard image index: ${d}`);u=g.width,h=g.height}Us.x=u,Us.y=h;const p=nt.compressTextureCoordinates(Us);s=r._index,o(s,a.x,a.y,c,p)}else s=r._index*4,o(s+0,a.x,a.y,c,0),o(s+1,a.x,a.y,c,0),o(s+2,a.x,a.y,c,0),o(s+3,a.x,a.y,c,0)}function VF(e,t,n,i,r){let s;const o=i[Zt.scaleByDistance];let a=0,c=1,u=1,h=1;const d=r.scaleByDistance;l(d)&&(a=d.near,c=d.nearValue,u=d.far,h=d.farValue,(c!==1||h!==1)&&(e._shaderScaleByDistance=!0)),e._instanced?(s=r._index,o(s,a,c,u,h)):(s=r._index*4,o(s+0,a,c,u,h),o(s+1,a,c,u,h),o(s+2,a,c,u,h),o(s+3,a,c,u,h))}function GF(e,t,n,i,r){let s;const o=i[Zt.pixelOffsetScaleByDistance];let a=0,c=1,u=1,h=1;const d=r.pixelOffsetScaleByDistance;l(d)&&(a=d.near,c=d.nearValue,u=d.far,h=d.farValue,(c!==1||h!==1)&&(e._shaderPixelOffsetScaleByDistance=!0)),e._instanced?(s=r._index,o(s,a,c,u,h)):(s=r._index*4,o(s+0,a,c,u,h),o(s+1,a,c,u,h),o(s+2,a,c,u,h),o(s+3,a,c,u,h))}function HF(e,t,n,i,r){let s;const o=i[Zt.compressedAttribute3];let a=0,c=Number.MAX_VALUE;const u=r.distanceDisplayCondition;l(u)&&(a=u.near,c=u.far,a*=a,c*=c,e._shaderDistanceDisplayCondition=!0);let h=r.disableDepthTestDistance;const d=cw(r.heightReference)&&t.context.depthTexture;l(h)||(h=d?5e3:0),h*=h,(d||h>0)&&(e._shaderDisableDepthDistance=!0,h===Number.POSITIVE_INFINITY&&(h=-1));let p,g;if(l(r._labelDimensions))g=r._labelDimensions.x,p=r._labelDimensions.y;else{let E=0,C=0;const w=r._imageIndex;if(w!==-1){const v=n[w];if(!l(v))throw new A(`Invalid billboard image index: ${w}`);E=v.height,C=v.width}p=Math.round(T(r.height,e._textureAtlas.texture.dimensions.y*E));const S=e._textureAtlas.texture.width;g=Math.round(T(r.width,S*C))}const _=Math.floor(R.clamp(g,0,ET)),b=Math.floor(R.clamp(p,0,ET)),x=_*ET+b;e._instanced?(s=r._index,o(s,a,c,h,x)):(s=r._index*4,o(s+0,a,c,h,x),o(s+1,a,c,h,x),o(s+2,a,c,h,x),o(s+3,a,c,h,x))}function qF(e,t,n,i,r){if(cw(r.heightReference)){const _=e._scene,b=t.context,x=t.globeTranslucencyState.translucent,E=l(_.globe)&&_.globe.depthTestAgainstTerrain;e._shaderClampToGround=b.depthTexture&&!x&&E}let s;const o=i[Zt.textureCoordinateBoundsOrLabelTranslate];if(We.maximumVertexTextureImageUnits>0){let _=0,b=0;l(r._labelTranslate)&&(_=r._labelTranslate.x,b=r._labelTranslate.y),e._instanced?(s=r._index,o(s,_,b,0,0)):(s=r._index*4,o(s+0,_,b,0,0),o(s+1,_,b,0,0),o(s+2,_,b,0,0),o(s+3,_,b,0,0));return}let a=0,c=0,u=0,h=0;const d=r._imageIndex;if(d!==-1){const _=n[d];if(!l(_))throw new A(`Invalid billboard image index: ${d}`);a=_.x,c=_.y,u=_.width,h=_.height}const p=a+u,g=c+h;e._instanced?(s=r._index,o(s,a,c,p,g)):(s=r._index*4,o(s+0,a,c,p,g),o(s+1,a,c,p,g),o(s+2,a,c,p,g),o(s+3,a,c,p,g))}function ume(e,t,n,i,r){if(!l(e._batchTable))return;const s=i[Zt.a_batchId],o=r._batchIndex;let a;e._instanced?(a=r._index,s(a,o)):(a=r._index*4,s(a+0,o),s(a+1,o),s(a+2,o),s(a+3,o))}function WF(e,t,n,i,r){if(!e._sdf)return;let s;const o=i[Zt.sdf],a=r.outlineColor,c=r.outlineWidth,u=M.floatToByte(a.red),h=M.floatToByte(a.green),d=M.floatToByte(a.blue),p=u*Hf+h*da+d,g=c/ys.RADIUS,_=M.floatToByte(a.alpha)*Hf+M.floatToByte(g)*da;e._instanced?(s=r._index,o(s,p,_)):(s=r._index*4,o(s+0,p+FF,_),o(s+1,p+BF,_),o(s+2,p+zF,_),o(s+3,p+UF,_))}function $F(e,t,n,i,r){const s=i[Zt.splitDirection];let o=0;const a=r.splitDirection;l(a)&&(o=a);let c;e._instanced?(c=r._index,s(c,o)):(c=r._index*4,s(c+0,o),s(c+1,o),s(c+2,o),s(c+3,o))}function fme(e,t,n,i,r){PF(e,t,n,i,r),kF(e,t,n,i,r),jF(e,t,n,i,r),dE(e,t,n,i,r),pE(e,t,n,i,r),VF(e,t,n,i,r),GF(e,t,n,i,r),HF(e,t,n,i,r),qF(e,t,n,i,r),ume(e,t,n,i,r),WF(e,t,n,i,r),$F(e,t,n,i,r)}function CT(e,t,n,i,r,s){let o;i.mode===Ie.SCENE3D?(o=e._baseVolume,e._boundingVolumeDirty=!0):o=e._baseVolume2D;const a=[];for(let c=0;c<n;++c){const u=t[c],h=u.position,d=Ue._computeActualPosition(u,h,i,r);l(d)&&(u._setActualPosition(d),s?a.push(d):ee.expand(o,d,o))}s&&ee.fromPoints(a,o)}function hme(e,t){const n=t.mode,i=e._billboards,r=e._billboardsToUpdate,s=e._modelMatrix;e._createVertexArray||e._mode!==n||n!==Ie.SCENE3D&&!P.equals(s,e.modelMatrix)?(e._mode=n,P.clone(e.modelMatrix,s),e._createVertexArray=!0,(n===Ie.SCENE3D||n===Ie.SCENE2D||n===Ie.COLUMBUS_VIEW)&&CT(e,i,i.length,t,s,!0)):n===Ie.MORPHING?CT(e,i,i.length,t,s,!0):(n===Ie.SCENE2D||n===Ie.COLUMBUS_VIEW)&&CT(e,r,e._billboardsToUpdateIndex,t,s,!1)}function dme(e,t,n){let i=1;(!e._allSizedInMeters||e._maxPixelOffset!==0)&&(i=t.camera.getPixelSize(n,t.context.drawingBufferWidth,t.context.drawingBufferHeight));let r=i*e._maxScale*e._maxSize*2;e._allHorizontalCenter&&e._allVerticalCenter&&(r*=.5);const s=i*e._maxPixelOffset+e._maxEyeOffset;n.radius+=r+s}function pme(e,t){const i=t.createViewportQuadCommand(`uniform sampler2D billboard_texture; 
in vec2 v_textureCoordinates; 
void main() 
{ 
    out_FragColor = texture(billboard_texture, v_textureCoordinates); 
} 
`,{uniformMap:{billboard_texture:function(){return e._textureAtlas.texture}}});return i.pass=Ke.OVERLAY,i}const mme=[];cs.prototype.update=function(e){if(kw(this),!this.show)return;let t=this._billboards,n=t.length;const i=e.context;this._instanced=i.instancedArrays,Zt=this._instanced?tme:eme,TT=this._instanced?ime:nme;let r=this._textureAtlas;if(!l(r)){r=this._textureAtlas=new xa({context:i});for(let O=0;O<n;++O)t[O]._loadImage()}const s=r.textureCoordinates;if(s.length===0)return;hme(this,e),t=this._billboards,n=t.length;const o=this._billboardsToUpdate,a=this._billboardsToUpdateIndex,c=this._propertiesChanged,u=r.guid,h=this._createVertexArray||this._textureAtlasGUID!==u;this._textureAtlasGUID=u;let d;const p=e.passes,g=p.pick;if(h||!g&&this.computeNewBuffersUsage()){this._createVertexArray=!1;for(let O=0;O<Uw;++O)c[O]=0;if(this._vaf=this._vaf&&this._vaf.destroy(),n>0){this._vaf=sme(i,n,this._buffersUsage,this._instanced,this._batchTable,this._sdf),d=this._vaf.writers;for(let O=0;O<n;++O){const N=this._billboards[O];N._dirty=!1,fme(this,e,s,d,N)}this._vaf.commit(TT(i))}this._billboardsToUpdateIndex=0}else if(a>0){const O=mme;O.length=0,(c[np]||c[Kpe]||c[Ype])&&O.push(PF),(c[yd]||c[wF]||c[$pe]||c[Xpe]||c[Wpe])&&(O.push(kF),this._instanced&&O.push(pE)),(c[yd]||c[Zpe]||c[IF])&&(O.push(jF),O.push(dE)),(c[yd]||c[SF])&&O.push(dE),c[AF]&&O.push(pE),c[vF]&&O.push(VF),c[OF]&&O.push(GF),(c[RF]||c[Jpe]||c[yd]||c[np])&&O.push(HF),(c[yd]||c[np])&&O.push(qF),c[DF]&&O.push(WF),c[MF]&&O.push($F);const N=O.length;if(d=this._vaf.writers,a/n>.1){for(let B=0;B<a;++B){const U=o[B];U._dirty=!1;for(let V=0;V<N;++V)O[V](this,e,s,d,U)}this._vaf.commit(TT(i))}else{for(let B=0;B<a;++B){const U=o[B];U._dirty=!1;for(let V=0;V<N;++V)O[V](this,e,s,d,U);this._instanced?this._vaf.subCommit(U._index,1):this._vaf.subCommit(U._index*4,4)}this._vaf.endSubCommits()}this._billboardsToUpdateIndex=0}if(a>n*1.5&&(o.length=n),!l(this._vaf)||!l(this._vaf.va))return;this._boundingVolumeDirty&&(this._boundingVolumeDirty=!1,ee.transform(this._baseVolume,this.modelMatrix,this._baseVolumeWC));let _,b=P.IDENTITY;e.mode===Ie.SCENE3D?(b=this.modelMatrix,_=ee.clone(this._baseVolumeWC,this._boundingVolume)):_=ee.clone(this._baseVolume2D,this._boundingVolume),dme(this,e,_);const x=this._blendOption!==this.blendOption;if(this._blendOption=this.blendOption,x){this._blendOption===hs.OPAQUE||this._blendOption===hs.OPAQUE_AND_TRANSLUCENT?this._rsOpaque=it.fromCache({depthTest:{enabled:!0,func:j.LESS},depthMask:!0}):this._rsOpaque=void 0;const O=this._blendOption===hs.TRANSLUCENT;this._blendOption===hs.TRANSLUCENT||this._blendOption===hs.OPAQUE_AND_TRANSLUCENT?this._rsTranslucent=it.fromCache({depthTest:{enabled:!0,func:O?j.LEQUAL:j.LESS},depthMask:O,blending:vs.ALPHA_BLEND}):this._rsTranslucent=void 0}this._shaderDisableDepthDistance=this._shaderDisableDepthDistance||e.minimumDisableDepthTestDistance!==0;let E,C,w,S,v;const D=We.maximumVertexTextureImageUnits>0;if(x||this._shaderRotation!==this._compiledShaderRotation||this._shaderAlignedAxis!==this._compiledShaderAlignedAxis||this._shaderScaleByDistance!==this._compiledShaderScaleByDistance||this._shaderTranslucencyByDistance!==this._compiledShaderTranslucencyByDistance||this._shaderPixelOffsetScaleByDistance!==this._compiledShaderPixelOffsetScaleByDistance||this._shaderDistanceDisplayCondition!==this._compiledShaderDistanceDisplayCondition||this._shaderDisableDepthDistance!==this._compiledShaderDisableDepthDistance||this._shaderClampToGround!==this._compiledShaderClampToGround||this._sdf!==this._compiledSDF){E=Ope,C=Ipe,v=[],l(this._batchTable)&&(v.push("VECTOR_TILE"),E=this._batchTable.getVertexShaderCallback(!1,"a_batchId",void 0)(E),C=this._batchTable.getFragmentShaderCallback(!1,void 0)(C)),w=new Je({defines:v,sources:[E]}),this._instanced&&w.defines.push("INSTANCED"),this._shaderRotation&&w.defines.push("ROTATION"),this._shaderAlignedAxis&&w.defines.push("ALIGNED_AXIS"),this._shaderScaleByDistance&&w.defines.push("EYE_DISTANCE_SCALING"),this._shaderTranslucencyByDistance&&w.defines.push("EYE_DISTANCE_TRANSLUCENCY"),this._shaderPixelOffsetScaleByDistance&&w.defines.push("EYE_DISTANCE_PIXEL_OFFSET"),this._shaderDistanceDisplayCondition&&w.defines.push("DISTANCE_DISPLAY_CONDITION"),this._shaderDisableDepthDistance&&w.defines.push("DISABLE_DEPTH_DISTANCE"),this._shaderClampToGround&&(D?w.defines.push("VERTEX_DEPTH_CHECK"):w.defines.push("FRAGMENT_DEPTH_CHECK"));const O=1-ys.CUTOFF;this._sdf&&w.defines.push("SDF");const N=l(this._batchTable)?"VECTOR_TILE":"";this._blendOption===hs.OPAQUE_AND_TRANSLUCENT&&(S=new Je({defines:["OPAQUE",N],sources:[C]}),this._shaderClampToGround&&(D?S.defines.push("VERTEX_DEPTH_CHECK"):S.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(S.defines.push("SDF"),S.defines.push(`SDF_EDGE ${O}`)),this._sp=kn.replaceCache({context:i,shaderProgram:this._sp,vertexShaderSource:w,fragmentShaderSource:S,attributeLocations:Zt}),S=new Je({defines:["TRANSLUCENT",N],sources:[C]}),this._shaderClampToGround&&(D?S.defines.push("VERTEX_DEPTH_CHECK"):S.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(S.defines.push("SDF"),S.defines.push(`SDF_EDGE ${O}`)),this._spTranslucent=kn.replaceCache({context:i,shaderProgram:this._spTranslucent,vertexShaderSource:w,fragmentShaderSource:S,attributeLocations:Zt})),this._blendOption===hs.OPAQUE&&(S=new Je({defines:[N],sources:[C]}),this._shaderClampToGround&&(D?S.defines.push("VERTEX_DEPTH_CHECK"):S.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(S.defines.push("SDF"),S.defines.push(`SDF_EDGE ${O}`)),this._sp=kn.replaceCache({context:i,shaderProgram:this._sp,vertexShaderSource:w,fragmentShaderSource:S,attributeLocations:Zt})),this._blendOption===hs.TRANSLUCENT&&(S=new Je({defines:[N],sources:[C]}),this._shaderClampToGround&&(D?S.defines.push("VERTEX_DEPTH_CHECK"):S.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(S.defines.push("SDF"),S.defines.push(`SDF_EDGE ${O}`)),this._spTranslucent=kn.replaceCache({context:i,shaderProgram:this._spTranslucent,vertexShaderSource:w,fragmentShaderSource:S,attributeLocations:Zt})),this._compiledShaderRotation=this._shaderRotation,this._compiledShaderAlignedAxis=this._shaderAlignedAxis,this._compiledShaderScaleByDistance=this._shaderScaleByDistance,this._compiledShaderTranslucencyByDistance=this._shaderTranslucencyByDistance,this._compiledShaderPixelOffsetScaleByDistance=this._shaderPixelOffsetScaleByDistance,this._compiledShaderDistanceDisplayCondition=this._shaderDistanceDisplayCondition,this._compiledShaderDisableDepthDistance=this._shaderDisableDepthDistance,this._compiledShaderClampToGround=this._shaderClampToGround,this._compiledSDF=this._sdf}const L=e.commandList;if(p.render||p.pick){const O=this._colorCommands,N=this._blendOption===hs.OPAQUE,B=this._blendOption===hs.OPAQUE_AND_TRANSLUCENT,U=this._vaf.va,V=U.length;let f=this._uniforms,I;l(this._batchTable)?(f=this._batchTable.getUniformMapCallback()(f),I=this._batchTable.getPickId()):I="v_pickColor",O.length=V;const F=B?V*2:V;for(let G=0;G<F;++G){let W=O[G];l(W)||(W=O[G]=new Tt);const X=N||B&&G%2===0;W.pass=X||!B?Ke.OPAQUE:Ke.TRANSLUCENT,W.owner=this;const Z=B?Math.floor(G/2):G;W.boundingVolume=_,W.modelMatrix=b,W.count=U[Z].indicesCount,W.shaderProgram=X?this._sp:this._spTranslucent,W.uniformMap=f,W.vertexArray=U[Z].va,W.renderState=X?this._rsOpaque:this._rsTranslucent,W.debugShowBoundingVolume=this.debugShowBoundingVolume,W.pickId=I,this._instanced&&(W.count=6,W.instanceCount=n),L.push(W)}this.debugShowTextureAtlas&&(l(this.debugCommand)||(this.debugCommand=pme(this,e.context)),L.push(this.debugCommand))}};cs.prototype.isDestroyed=function(){return!1};cs.prototype.destroy=function(){return l(this._removeCallbackFunc)&&(this._removeCallbackFunc(),this._removeCallbackFunc=void 0),this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._sp=this._sp&&this._sp.destroy(),this._spTranslucent=this._spTranslucent&&this._spTranslucent.destroy(),this._vaf=this._vaf&&this._vaf.destroy(),LF(this._billboards),Ye(this)};function gme(e,t,n,i,r){return function(){const s=document.createElement("canvas"),o=r+2*i;s.height=s.width=o;const a=s.getContext("2d");return a.clearRect(0,0,o,o),i!==0&&(a.beginPath(),a.arc(o/2,o/2,o/2,0,2*Math.PI,!0),a.closePath(),a.fillStyle=n,a.fill(),e<1&&(a.save(),a.globalCompositeOperation="destination-out",a.beginPath(),a.arc(o/2,o/2,r/2,0,2*Math.PI,!0),a.closePath(),a.fillStyle="black",a.fill(),a.restore())),a.beginPath(),a.arc(o/2,o/2,r/2,0,2*Math.PI,!0),a.closePath(),a.fillStyle=t,a.fill(),s}}function ri(e,t,n,i,r){this._content=e,this._billboard=n,this._label=i,this._polyline=r,this._batchId=t,this._billboardImage=void 0,this._billboardColor=void 0,this._billboardOutlineColor=void 0,this._billboardOutlineWidth=void 0,this._billboardSize=void 0,this._pointSize=void 0,this._color=void 0,this._pointSize=void 0,this._pointOutlineColor=void 0,this._pointOutlineWidth=void 0,this._heightOffset=void 0,this._pickIds=new Array(3),bf(this)}const _me=new oe;Object.defineProperties(ri.prototype,{show:{get:function(){return this._label.show},set:function(e){this._label.show=e,this._billboard.show=e,this._polyline.show=e}},color:{get:function(){return this._color},set:function(e){this._color=M.clone(e,this._color),bf(this)}},pointSize:{get:function(){return this._pointSize},set:function(e){this._pointSize=e,bf(this)}},pointOutlineColor:{get:function(){return this._pointOutlineColor},set:function(e){this._pointOutlineColor=M.clone(e,this._pointOutlineColor),bf(this)}},pointOutlineWidth:{get:function(){return this._pointOutlineWidth},set:function(e){this._pointOutlineWidth=e,bf(this)}},labelColor:{get:function(){return this._label.fillColor},set:function(e){this._label.fillColor=e,this._polyline.show=this._label.show&&e.alpha>0}},labelOutlineColor:{get:function(){return this._label.outlineColor},set:function(e){this._label.outlineColor=e}},labelOutlineWidth:{get:function(){return this._label.outlineWidth},set:function(e){this._label.outlineWidth=e}},font:{get:function(){return this._label.font},set:function(e){this._label.font=e}},labelStyle:{get:function(){return this._label.style},set:function(e){this._label.style=e}},labelText:{get:function(){return this._label.text},set:function(e){l(e)||(e=""),this._label.text=e}},backgroundColor:{get:function(){return this._label.backgroundColor},set:function(e){this._label.backgroundColor=e}},backgroundPadding:{get:function(){return this._label.backgroundPadding},set:function(e){this._label.backgroundPadding=e}},backgroundEnabled:{get:function(){return this._label.showBackground},set:function(e){this._label.showBackground=e}},scaleByDistance:{get:function(){return this._label.scaleByDistance},set:function(e){this._label.scaleByDistance=e,this._billboard.scaleByDistance=e}},translucencyByDistance:{get:function(){return this._label.translucencyByDistance},set:function(e){this._label.translucencyByDistance=e,this._billboard.translucencyByDistance=e}},distanceDisplayCondition:{get:function(){return this._label.distanceDisplayCondition},set:function(e){this._label.distanceDisplayCondition=e,this._polyline.distanceDisplayCondition=e,this._billboard.distanceDisplayCondition=e}},heightOffset:{get:function(){return this._heightOffset},set:function(e){const t=T(this._heightOffset,0),n=this._content.tileset.ellipsoid,i=n.cartesianToCartographic(this._billboard.position,_me);i.height=i.height-t+e;const r=n.cartographicToCartesian(i);this._billboard.position=r,this._label.position=this._billboard.position,this._polyline.positions=[this._polyline.positions[0],r],this._heightOffset=e}},anchorLineEnabled:{get:function(){return this._polyline.show},set:function(e){this._polyline.show=e}},anchorLineColor:{get:function(){return this._polyline.material.uniforms.color},set:function(e){this._polyline.material.uniforms.color=M.clone(e,this._polyline.material.uniforms.color)}},image:{get:function(){return this._billboardImage},set:function(e){const t=this._billboardImage!==e;this._billboardImage=e,t&&bf(this)}},disableDepthTestDistance:{get:function(){return this._label.disableDepthTestDistance},set:function(e){this._label.disableDepthTestDistance=e,this._billboard.disableDepthTestDistance=e}},horizontalOrigin:{get:function(){return this._billboard.horizontalOrigin},set:function(e){this._billboard.horizontalOrigin=e}},verticalOrigin:{get:function(){return this._billboard.verticalOrigin},set:function(e){this._billboard.verticalOrigin=e}},labelHorizontalOrigin:{get:function(){return this._label.horizontalOrigin},set:function(e){this._label.horizontalOrigin=e}},labelVerticalOrigin:{get:function(){return this._label.verticalOrigin},set:function(e){this._label.verticalOrigin=e}},content:{get:function(){return this._content}},tileset:{get:function(){return this._content.tileset}},primitive:{get:function(){return this._content.tileset}},pickIds:{get:function(){const e=this._pickIds;return e[0]=this._billboard.pickId,e[1]=this._label.pickId,e[2]=this._polyline.pickId,e}}});ri.defaultColor=M.WHITE;ri.defaultPointOutlineColor=M.BLACK;ri.defaultPointOutlineWidth=0;ri.defaultPointSize=8;function bf(e){const t=e._billboard;if(l(e._billboardImage)&&e._billboardImage!==t.image){t.image=e._billboardImage;return}if(l(e._billboardImage))return;const n=T(e._color,ri.defaultColor),i=T(e._pointOutlineColor,ri.defaultPointOutlineColor),r=T(e._pointOutlineWidth,ri.defaultPointOutlineWidth),s=T(e._pointSize,ri.defaultPointSize),o=e._billboardColor,a=e._billboardOutlineColor,c=e._billboardOutlineWidth,u=e._billboardSize;if(M.equals(n,o)&&M.equals(i,a)&&r===c&&s===u)return;e._billboardColor=M.clone(n,e._billboardColor),e._billboardOutlineColor=M.clone(i,e._billboardOutlineColor),e._billboardOutlineWidth=r,e._billboardSize=s;const h=n.alpha,d=n.toCssColorString(),p=i.toCssColorString(),g=JSON.stringify([d,s,p,r]);t.setImage(g,gme(h,d,p,r,s))}ri.prototype.hasProperty=function(e){return this._content.batchTable.hasProperty(this._batchId,e)};ri.prototype.getPropertyIds=function(e){return this._content.batchTable.getPropertyIds(this._batchId,e)};ri.prototype.getProperty=function(e){return this._content.batchTable.getProperty(this._batchId,e)};ri.prototype.getPropertyInherited=function(e){return vr.getPropertyInherited(this._content,this._batchId,e)};ri.prototype.setProperty=function(e,t){this._content.batchTable.setProperty(this._batchId,e,t),this._content.featurePropertiesDirty=!0};ri.prototype.isExactClass=function(e){return this._content.batchTable.isExactClass(this._batchId,e)};ri.prototype.isClass=function(e){return this._content.batchTable.isClass(this._batchId,e)};ri.prototype.getExactClassName=function(){return this._content.batchTable.getExactClassName(this._batchId)};var yme=bme,ip=1e20;function bme(e,t){t||(t={});var n=t.cutoff==null?.25:t.cutoff,i=t.radius==null?8:t.radius,r=t.channel||0,s,o,a,c,u,h,d,p,g,_,b;if(ArrayBuffer.isView(e)||Array.isArray(e)){if(!t.width||!t.height)throw Error("For raw data width and height should be provided by options");s=t.width,o=t.height,c=e,t.stride?h=t.stride:h=Math.floor(e.length/s/o)}else window.HTMLCanvasElement&&e instanceof window.HTMLCanvasElement?(p=e,d=p.getContext("2d"),s=p.width,o=p.height,g=d.getImageData(0,0,s,o),c=g.data,h=4):window.CanvasRenderingContext2D&&e instanceof window.CanvasRenderingContext2D?(p=e.canvas,d=e,s=p.width,o=p.height,g=d.getImageData(0,0,s,o),c=g.data,h=4):window.ImageData&&e instanceof window.ImageData&&(g=e,s=e.width,o=e.height,c=g.data,h=4);if(a=Math.max(s,o),window.Uint8ClampedArray&&c instanceof window.Uint8ClampedArray||window.Uint8Array&&c instanceof window.Uint8Array)for(u=c,c=Array(s*o),_=0,b=Math.floor(u.length/h);_<b;_++)c[_]=u[_*h+r]/255;else if(h!==1)throw Error("Raw data can have only 1 value per pixel");var x=Array(s*o),E=Array(s*o),C=Array(a),w=Array(a),S=Array(a+1),v=Array(a);for(_=0,b=s*o;_<b;_++){var D=c[_];x[_]=D===1?0:D===0?ip:Math.pow(Math.max(0,.5-D),2),E[_]=D===1?ip:D===0?0:Math.pow(Math.max(0,D-.5),2)}cO(x,s,o,C,w,v,S),cO(E,s,o,C,w,v,S);var L=window.Float32Array?new Float32Array(s*o):new Array(s*o);for(_=0,b=s*o;_<b;_++)L[_]=Math.min(Math.max(1-((x[_]-E[_])/i+n),0),1);return L}function cO(e,t,n,i,r,s,o){for(var a=0;a<t;a++){for(var c=0;c<n;c++)i[c]=e[c*t+a];for(lO(i,r,s,o,n),c=0;c<n;c++)e[c*t+a]=r[c]}for(c=0;c<n;c++){for(a=0;a<t;a++)i[a]=e[c*t+a];for(lO(i,r,s,o,t),a=0;a<t;a++)e[c*t+a]=Math.sqrt(r[a])}}function lO(e,t,n,i,r){n[0]=0,i[0]=-ip,i[1]=+ip;for(var s=1,o=0;s<r;s++){for(var a=(e[s]+s*s-(e[n[o]]+n[o]*n[o]))/(2*s-2*n[o]);a<=i[o];)o--,a=(e[s]+s*s-(e[n[o]]+n[o]*n[o]))/(2*s-2*n[o]);o++,n[o]=s,i[o]=a,i[o+1]=+ip}for(s=0,o=0;s<r;s++){for(;i[o+1]<s;)o++;t[s]=(s-n[o])*(s-n[o])+e[n[o]]}}const Tme=Th(yme),xme={FILL:0,OUTLINE:1,FILL_AND_OUTLINE:2},oa=Object.freeze(xme),uO={};let fO=0;const Eme=256,Cme=new M(.165,.165,.165,.8),wme=new k(7,5),fi=Object.freeze({LTR:0,RTL:1,WEAK:2,BRACKETS:3});function Jl(e){!e._rebindAllGlyphs&&!e._repositionAllGlyphs&&e._labelCollection._labelsToUpdate.push(e),e._rebindAllGlyphs=!0}function bd(e){!e._rebindAllGlyphs&&!e._repositionAllGlyphs&&e._labelCollection._labelsToUpdate.push(e),e._repositionAllGlyphs=!0}function Td(e,t){return document.defaultView.getComputedStyle(e,null).getPropertyValue(t)}function XF(e){let t=uO[e._font];if(!l(t)){const n=document.createElement("div");n.style.position="absolute",n.style.opacity=0,n.style.font=e._font,document.body.appendChild(n);let i=parseFloat(Td(n,"line-height"));isNaN(i)&&(i=void 0),t={family:Td(n,"font-family"),size:Td(n,"font-size").replace("px",""),style:Td(n,"font-style"),weight:Td(n,"font-weight"),lineHeight:i},document.body.removeChild(n),fO<Eme&&(uO[e._font]=t,fO++)}e._fontFamily=t.family,e._fontSize=t.size,e._fontStyle=t.style,e._fontWeight=t.weight,e._lineHeight=t.lineHeight}function ac(e,t){if(e=T(e,T.EMPTY_OBJECT),l(e.disableDepthTestDistance)&&e.disableDepthTestDistance<0)throw new A("disableDepthTestDistance must be greater than 0.0.");let n=e.translucencyByDistance,i=e.pixelOffsetScaleByDistance,r=e.scaleByDistance,s=e.distanceDisplayCondition;if(l(n)){if(n.far<=n.near)throw new A("translucencyByDistance.far must be greater than translucencyByDistance.near.");n=Bt.clone(n)}if(l(i)){if(i.far<=i.near)throw new A("pixelOffsetScaleByDistance.far must be greater than pixelOffsetScaleByDistance.near.");i=Bt.clone(i)}if(l(r)){if(r.far<=r.near)throw new A("scaleByDistance.far must be greater than scaleByDistance.near.");r=Bt.clone(r)}if(l(s)){if(s.far<=s.near)throw new A("distanceDisplayCondition.far must be greater than distanceDisplayCondition.near.");s=$n.clone(s)}this._renderedText=void 0,this._text=void 0,this._show=T(e.show,!0),this._font=T(e.font,"30px sans-serif"),this._fillColor=M.clone(T(e.fillColor,M.WHITE)),this._outlineColor=M.clone(T(e.outlineColor,M.BLACK)),this._outlineWidth=T(e.outlineWidth,1),this._showBackground=T(e.showBackground,!1),this._backgroundColor=M.clone(T(e.backgroundColor,Cme)),this._backgroundPadding=k.clone(T(e.backgroundPadding,wme)),this._style=T(e.style,oa.FILL),this._verticalOrigin=T(e.verticalOrigin,yn.BASELINE),this._horizontalOrigin=T(e.horizontalOrigin,As.LEFT),this._pixelOffset=k.clone(T(e.pixelOffset,k.ZERO)),this._eyeOffset=m.clone(T(e.eyeOffset,m.ZERO)),this._position=m.clone(T(e.position,m.ZERO)),this._scale=T(e.scale,1),this._id=e.id,this._translucencyByDistance=n,this._pixelOffsetScaleByDistance=i,this._scaleByDistance=r,this._heightReference=T(e.heightReference,fa.NONE),this._distanceDisplayCondition=s,this._disableDepthTestDistance=e.disableDepthTestDistance,this._labelCollection=t,this._glyphs=[],this._backgroundBillboard=void 0,this._batchIndex=void 0,this._rebindAllGlyphs=!0,this._repositionAllGlyphs=!0,this._actualClampedPosition=void 0,this._removeCallbackFunc=void 0,this._mode=void 0,this._clusterShow=!0,this.text=T(e.text,""),this._relativeSize=1,XF(this),this._updateClamping()}Object.defineProperties(ac.prototype,{show:{get:function(){return this._show},set:function(e){if(!l(e))throw new A("value is required.");if(this._show!==e){this._show=e;const t=this._glyphs;for(let i=0,r=t.length;i<r;i++){const s=t[i].billboard;l(s)&&(s.show=e)}const n=this._backgroundBillboard;l(n)&&(n.show=e)}}},position:{get:function(){return this._position},set:function(e){if(!l(e))throw new A("value is required.");const t=this._position;if(!m.equals(t,e)){m.clone(e,t);const n=this._glyphs;for(let r=0,s=n.length;r<s;r++){const o=n[r].billboard;l(o)&&(o.position=e)}const i=this._backgroundBillboard;l(i)&&(i.position=e),this._updateClamping()}}},heightReference:{get:function(){return this._heightReference},set:function(e){if(!l(e))throw new A("value is required.");if(e!==this._heightReference){this._heightReference=e;const t=this._glyphs;for(let i=0,r=t.length;i<r;i++){const s=t[i].billboard;l(s)&&(s.heightReference=e)}const n=this._backgroundBillboard;l(n)&&(n.heightReference=e),bd(this),this._updateClamping()}}},text:{get:function(){return this._text},set:function(e){if(!l(e))throw new A("value is required.");if(this._text!==e){this._text=e;const t=e.replace(/\u00ad/g,"");this._renderedText=ac.enableRightToLeftDetection?Rme(t):t,Jl(this)}}},font:{get:function(){return this._font},set:function(e){if(!l(e))throw new A("value is required.");this._font!==e&&(this._font=e,Jl(this),XF(this))}},fillColor:{get:function(){return this._fillColor},set:function(e){if(!l(e))throw new A("value is required.");const t=this._fillColor;M.equals(t,e)||(M.clone(e,t),Jl(this))}},outlineColor:{get:function(){return this._outlineColor},set:function(e){if(!l(e))throw new A("value is required.");const t=this._outlineColor;M.equals(t,e)||(M.clone(e,t),Jl(this))}},outlineWidth:{get:function(){return this._outlineWidth},set:function(e){if(!l(e))throw new A("value is required.");this._outlineWidth!==e&&(this._outlineWidth=e,Jl(this))}},showBackground:{get:function(){return this._showBackground},set:function(e){if(!l(e))throw new A("value is required.");this._showBackground!==e&&(this._showBackground=e,Jl(this))}},backgroundColor:{get:function(){return this._backgroundColor},set:function(e){if(!l(e))throw new A("value is required.");const t=this._backgroundColor;if(!M.equals(t,e)){M.clone(e,t);const n=this._backgroundBillboard;l(n)&&(n.color=t)}}},backgroundPadding:{get:function(){return this._backgroundPadding},set:function(e){if(!l(e))throw new A("value is required.");const t=this._backgroundPadding;k.equals(t,e)||(k.clone(e,t),bd(this))}},style:{get:function(){return this._style},set:function(e){if(!l(e))throw new A("value is required.");this._style!==e&&(this._style=e,Jl(this))}},pixelOffset:{get:function(){return this._pixelOffset},set:function(e){if(!l(e))throw new A("value is required.");const t=this._pixelOffset;if(!k.equals(t,e)){k.clone(e,t);const n=this._glyphs;for(let r=0,s=n.length;r<s;r++){const o=n[r];l(o.billboard)&&(o.billboard.pixelOffset=e)}const i=this._backgroundBillboard;l(i)&&(i.pixelOffset=e)}}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(e){if(l(e)&&e.far<=e.near)throw new A("far distance must be greater than near distance.");const t=this._translucencyByDistance;if(!Bt.equals(t,e)){this._translucencyByDistance=Bt.clone(e,t);const n=this._glyphs;for(let r=0,s=n.length;r<s;r++){const o=n[r];l(o.billboard)&&(o.billboard.translucencyByDistance=e)}const i=this._backgroundBillboard;l(i)&&(i.translucencyByDistance=e)}}},pixelOffsetScaleByDistance:{get:function(){return this._pixelOffsetScaleByDistance},set:function(e){if(l(e)&&e.far<=e.near)throw new A("far distance must be greater than near distance.");const t=this._pixelOffsetScaleByDistance;if(!Bt.equals(t,e)){this._pixelOffsetScaleByDistance=Bt.clone(e,t);const n=this._glyphs;for(let r=0,s=n.length;r<s;r++){const o=n[r];l(o.billboard)&&(o.billboard.pixelOffsetScaleByDistance=e)}const i=this._backgroundBillboard;l(i)&&(i.pixelOffsetScaleByDistance=e)}}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(e){if(l(e)&&e.far<=e.near)throw new A("far distance must be greater than near distance.");const t=this._scaleByDistance;if(!Bt.equals(t,e)){this._scaleByDistance=Bt.clone(e,t);const n=this._glyphs;for(let r=0,s=n.length;r<s;r++){const o=n[r];l(o.billboard)&&(o.billboard.scaleByDistance=e)}const i=this._backgroundBillboard;l(i)&&(i.scaleByDistance=e)}}},eyeOffset:{get:function(){return this._eyeOffset},set:function(e){if(!l(e))throw new A("value is required.");const t=this._eyeOffset;if(!m.equals(t,e)){m.clone(e,t);const n=this._glyphs;for(let r=0,s=n.length;r<s;r++){const o=n[r];l(o.billboard)&&(o.billboard.eyeOffset=e)}const i=this._backgroundBillboard;l(i)&&(i.eyeOffset=e)}}},horizontalOrigin:{get:function(){return this._horizontalOrigin},set:function(e){if(!l(e))throw new A("value is required.");this._horizontalOrigin!==e&&(this._horizontalOrigin=e,bd(this))}},verticalOrigin:{get:function(){return this._verticalOrigin},set:function(e){if(!l(e))throw new A("value is required.");if(this._verticalOrigin!==e){this._verticalOrigin=e;const t=this._glyphs;for(let i=0,r=t.length;i<r;i++){const s=t[i];l(s.billboard)&&(s.billboard.verticalOrigin=e)}const n=this._backgroundBillboard;l(n)&&(n.verticalOrigin=e),bd(this)}}},scale:{get:function(){return this._scale},set:function(e){if(!l(e))throw new A("value is required.");if(this._scale!==e){this._scale=e;const t=this._glyphs;for(let i=0,r=t.length;i<r;i++){const s=t[i];l(s.billboard)&&(s.billboard.scale=e*this._relativeSize)}const n=this._backgroundBillboard;l(n)&&(n.scale=e*this._relativeSize),bd(this)}}},totalScale:{get:function(){return this._scale*this._relativeSize}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){if(l(e)&&e.far<=e.near)throw new A("far must be greater than near");if(!$n.equals(e,this._distanceDisplayCondition)){this._distanceDisplayCondition=$n.clone(e,this._distanceDisplayCondition);const t=this._glyphs;for(let i=0,r=t.length;i<r;i++){const s=t[i];l(s.billboard)&&(s.billboard.distanceDisplayCondition=e)}const n=this._backgroundBillboard;l(n)&&(n.distanceDisplayCondition=e)}}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(e){if(this._disableDepthTestDistance!==e){if(l(e)&&e<0)throw new A("disableDepthTestDistance must be greater than 0.0.");this._disableDepthTestDistance=e;const t=this._glyphs;for(let i=0,r=t.length;i<r;i++){const s=t[i];l(s.billboard)&&(s.billboard.disableDepthTestDistance=e)}const n=this._backgroundBillboard;l(n)&&(n.disableDepthTestDistance=e)}}},id:{get:function(){return this._id},set:function(e){if(this._id!==e){this._id=e;const t=this._glyphs;for(let i=0,r=t.length;i<r;i++){const s=t[i];l(s.billboard)&&(s.billboard.id=e)}const n=this._backgroundBillboard;l(n)&&(n.id=e)}}},pickId:{get:function(){if(!(this._glyphs.length===0||!l(this._glyphs[0].billboard)))return this._glyphs[0].billboard.pickId}},_clampedPosition:{get:function(){return this._actualClampedPosition},set:function(e){this._actualClampedPosition=m.clone(e,this._actualClampedPosition);const t=this._glyphs;for(let i=0,r=t.length;i<r;i++){const s=t[i];l(s.billboard)&&(s.billboard._clampedPosition=e)}const n=this._backgroundBillboard;l(n)&&(n._clampedPosition=e)}},clusterShow:{get:function(){return this._clusterShow},set:function(e){if(this._clusterShow!==e){this._clusterShow=e;const t=this._glyphs;for(let i=0,r=t.length;i<r;i++){const s=t[i];l(s.billboard)&&(s.billboard.clusterShow=e)}const n=this._backgroundBillboard;l(n)&&(n.clusterShow=e)}}}});ac.prototype._updateClamping=function(){Ue._updateClamping(this._labelCollection,this)};ac.prototype.computeScreenSpacePosition=function(e,t){if(!l(e))throw new A("scene is required.");l(t)||(t=new k);const i=this._labelCollection.modelMatrix,r=l(this._actualClampedPosition)?this._actualClampedPosition:this._position;return Ue._computeScreenSpacePosition(i,r,this._eyeOffset,this._pixelOffset,e,t)};ac.getScreenSpaceBoundingBox=function(e,t,n){let i=0,r=0,s=0,o=0;const a=e.totalScale,c=e._backgroundBillboard;if(l(c))i=t.x+c._translate.x,r=t.y-c._translate.y,s=c.width*a,o=c.height*a,e.verticalOrigin===yn.BOTTOM||e.verticalOrigin===yn.BASELINE?r-=o:e.verticalOrigin===yn.CENTER&&(r-=o*.5);else{i=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY;let u=0,h=0;const d=e._glyphs,p=d.length;for(let g=0;g<p;++g){const _=d[g],b=_.billboard;if(!l(b))continue;const x=t.x+b._translate.x;let E=t.y-b._translate.y;const C=_.dimensions.width*a,w=_.dimensions.height*a;e.verticalOrigin===yn.BOTTOM||e.verticalOrigin===yn.BASELINE?E-=w:e.verticalOrigin===yn.CENTER&&(E-=w*.5),e._verticalOrigin===yn.TOP?E+=ys.PADDING*a:(e._verticalOrigin===yn.BOTTOM||e._verticalOrigin===yn.BASELINE)&&(E-=ys.PADDING*a),i=Math.min(i,x),r=Math.min(r,E),u=Math.max(u,x+C),h=Math.max(h,E+w)}s=u-i,o=h-r}return l(n)||(n=new Ot),n.x=i,n.y=r,n.width=s,n.height=o,n};ac.prototype.equals=function(e){return this===e||l(e)&&this._show===e._show&&this._scale===e._scale&&this._outlineWidth===e._outlineWidth&&this._showBackground===e._showBackground&&this._style===e._style&&this._verticalOrigin===e._verticalOrigin&&this._horizontalOrigin===e._horizontalOrigin&&this._heightReference===e._heightReference&&this._renderedText===e._renderedText&&this._font===e._font&&m.equals(this._position,e._position)&&M.equals(this._fillColor,e._fillColor)&&M.equals(this._outlineColor,e._outlineColor)&&M.equals(this._backgroundColor,e._backgroundColor)&&k.equals(this._backgroundPadding,e._backgroundPadding)&&k.equals(this._pixelOffset,e._pixelOffset)&&m.equals(this._eyeOffset,e._eyeOffset)&&Bt.equals(this._translucencyByDistance,e._translucencyByDistance)&&Bt.equals(this._pixelOffsetScaleByDistance,e._pixelOffsetScaleByDistance)&&Bt.equals(this._scaleByDistance,e._scaleByDistance)&&$n.equals(this._distanceDisplayCondition,e._distanceDisplayCondition)&&this._disableDepthTestDistance===e._disableDepthTestDistance&&this._id===e._id};ac.prototype.isDestroyed=function(){return!1};ac.enableRightToLeftDetection=!1;function Ame(e,t){const n=/[a-zA-Z0-9]/,i=/[()[\]{}<>]/,r=[];let s="",o=fi.LTR,a="";const c=e.length;for(let u=0;u<c;++u){const h=e.charAt(u);t.test(h)?a=fi.RTL:n.test(h)?a=fi.LTR:i.test(h)?a=fi.BRACKETS:a=fi.WEAK,u===0&&(o=a),o===a&&a!==fi.BRACKETS?s+=h:(s!==""&&r.push({Type:o,Word:s}),o=a,s=h)}return r.push({Type:a,Word:s}),r}function Sme(e){return e.split("").reverse().join("")}function xd(e,t,n){return e.slice(0,t)+n+e.slice(t)}function vme(e){switch(e){case"(":return")";case")":return"(";case"[":return"]";case"]":return"[";case"{":return"}";case"}":return"{";case"<":return">";case">":return"<"}}const Ime="×-×ª",Ome="Ø-Û¿Ý-Ý¿à¢ -à£¿",hO=new RegExp(`[${Ime}${Ome}]`);function Rme(e){const t=e.split(`
`);let n="";for(let i=0;i<t.length;i++){const r=t[i],s=hO.test(r.charAt(0)),o=Ame(r,hO);let a=0,c="";for(let u=0;u<o.length;++u){const h=o[u],d=h.Type===fi.BRACKETS?vme(h.Word):Sme(h.Word);s?h.Type===fi.RTL?(c=d+c,a=0):h.Type===fi.LTR?(c=xd(c,a,h.Word),a+=h.Word.length):(h.Type===fi.WEAK||h.Type===fi.BRACKETS)&&(h.Type===fi.WEAK&&o[u-1].Type===fi.BRACKETS?c=d+c:o[u-1].Type===fi.RTL?(c=d+c,a=0):o.length>u+1?o[u+1].Type===fi.RTL?(c=d+c,a=0):(c=xd(c,a,h.Word),a+=h.Word.length):c=xd(c,0,d)):h.Type===fi.RTL?c=xd(c,a,d):h.Type===fi.LTR?(c+=h.Word,a=c.length):(h.Type===fi.WEAK||h.Type===fi.BRACKETS)&&(u>0&&o[u-1].Type===fi.RTL?o.length>u+1?o[u+1].Type===fi.RTL?c=xd(c,a,d):(c+=h.Word,a=c.length):c+=h.Word:(c+=h.Word,a=c.length))}n+=c,i<t.length-1&&(n+=`
`)}return n}var YF={exports:{}};(function(e){function t(){var n=0,i=1,r=2,s=3,o=4,a=5,c=6,u=7,h=8,d=9,p=10,g=11,_=12,b=13,x=14,E=15,C=16,w=17,S=0,v=1,D=2,L=3,O=4;function N(f,I){return 55296<=f.charCodeAt(I)&&f.charCodeAt(I)<=56319&&56320<=f.charCodeAt(I+1)&&f.charCodeAt(I+1)<=57343}function B(f,I){I===void 0&&(I=0);var F=f.charCodeAt(I);if(55296<=F&&F<=56319&&I<f.length-1){var G=F,W=f.charCodeAt(I+1);return 56320<=W&&W<=57343?(G-55296)*1024+(W-56320)+65536:G}if(56320<=F&&F<=57343&&I>=1){var G=f.charCodeAt(I-1),W=F;return 55296<=G&&G<=56319?(G-55296)*1024+(W-56320)+65536:W}return F}function U(f,I,F){var G=[f].concat(I).concat([F]),W=G[G.length-2],X=F,Z=G.lastIndexOf(x);if(Z>1&&G.slice(1,Z).every(function(le){return le==s})&&[s,b,w].indexOf(f)==-1)return D;var $=G.lastIndexOf(o);if($>0&&G.slice(1,$).every(function(le){return le==o})&&[_,o].indexOf(W)==-1)return G.filter(function(le){return le==o}).length%2==1?L:O;if(W==n&&X==i)return S;if(W==r||W==n||W==i)return X==x&&I.every(function(le){return le==s})?D:v;if(X==r||X==n||X==i)return v;if(W==c&&(X==c||X==u||X==d||X==p))return S;if((W==d||W==u)&&(X==u||X==h))return S;if((W==p||W==h)&&X==h)return S;if(X==s||X==E)return S;if(X==a)return S;if(W==_)return S;var ne=G.indexOf(s)!=-1?G.lastIndexOf(s)-1:G.length-2;return[b,w].indexOf(G[ne])!=-1&&G.slice(ne+1,-1).every(function(le){return le==s})&&X==x||W==E&&[C,w].indexOf(X)!=-1?S:I.indexOf(o)!=-1?D:W==o&&X==o?S:v}this.nextBreak=function(f,I){if(I===void 0&&(I=0),I<0)return 0;if(I>=f.length-1)return f.length;for(var F=V(B(f,I)),G=[],W=I+1;W<f.length;W++)if(!N(f,W-1)){var X=V(B(f,W));if(U(F,G,X))return W;G.push(X)}return f.length},this.splitGraphemes=function(f){for(var I=[],F=0,G;(G=this.nextBreak(f,F))<f.length;)I.push(f.slice(F,G)),F=G;return F<f.length&&I.push(f.slice(F)),I},this.iterateGraphemes=function(f){var I=0,F={next:(function(){var G,W;return(W=this.nextBreak(f,I))<f.length?(G=f.slice(I,W),I=W,{value:G,done:!1}):I<f.length?(G=f.slice(I),I=f.length,{value:G,done:!1}):{value:void 0,done:!0}}).bind(this)};return typeof Symbol<"u"&&Symbol.iterator&&(F[Symbol.iterator]=function(){return F}),F},this.countGraphemes=function(f){for(var I=0,F=0,G;(G=this.nextBreak(f,F))<f.length;)F=G,I++;return F<f.length&&I++,I};function V(f){return 1536<=f&&f<=1541||f==1757||f==1807||f==2274||f==3406||f==69821||70082<=f&&f<=70083||f==72250||72326<=f&&f<=72329||f==73030?_:f==13?n:f==10?i:0<=f&&f<=9||11<=f&&f<=12||14<=f&&f<=31||127<=f&&f<=159||f==173||f==1564||f==6158||f==8203||8206<=f&&f<=8207||f==8232||f==8233||8234<=f&&f<=8238||8288<=f&&f<=8292||f==8293||8294<=f&&f<=8303||55296<=f&&f<=57343||f==65279||65520<=f&&f<=65528||65529<=f&&f<=65531||113824<=f&&f<=113827||119155<=f&&f<=119162||f==917504||f==917505||917506<=f&&f<=917535||917632<=f&&f<=917759||918e3<=f&&f<=921599?r:768<=f&&f<=879||1155<=f&&f<=1159||1160<=f&&f<=1161||1425<=f&&f<=1469||f==1471||1473<=f&&f<=1474||1476<=f&&f<=1477||f==1479||1552<=f&&f<=1562||1611<=f&&f<=1631||f==1648||1750<=f&&f<=1756||1759<=f&&f<=1764||1767<=f&&f<=1768||1770<=f&&f<=1773||f==1809||1840<=f&&f<=1866||1958<=f&&f<=1968||2027<=f&&f<=2035||2070<=f&&f<=2073||2075<=f&&f<=2083||2085<=f&&f<=2087||2089<=f&&f<=2093||2137<=f&&f<=2139||2260<=f&&f<=2273||2275<=f&&f<=2306||f==2362||f==2364||2369<=f&&f<=2376||f==2381||2385<=f&&f<=2391||2402<=f&&f<=2403||f==2433||f==2492||f==2494||2497<=f&&f<=2500||f==2509||f==2519||2530<=f&&f<=2531||2561<=f&&f<=2562||f==2620||2625<=f&&f<=2626||2631<=f&&f<=2632||2635<=f&&f<=2637||f==2641||2672<=f&&f<=2673||f==2677||2689<=f&&f<=2690||f==2748||2753<=f&&f<=2757||2759<=f&&f<=2760||f==2765||2786<=f&&f<=2787||2810<=f&&f<=2815||f==2817||f==2876||f==2878||f==2879||2881<=f&&f<=2884||f==2893||f==2902||f==2903||2914<=f&&f<=2915||f==2946||f==3006||f==3008||f==3021||f==3031||f==3072||3134<=f&&f<=3136||3142<=f&&f<=3144||3146<=f&&f<=3149||3157<=f&&f<=3158||3170<=f&&f<=3171||f==3201||f==3260||f==3263||f==3266||f==3270||3276<=f&&f<=3277||3285<=f&&f<=3286||3298<=f&&f<=3299||3328<=f&&f<=3329||3387<=f&&f<=3388||f==3390||3393<=f&&f<=3396||f==3405||f==3415||3426<=f&&f<=3427||f==3530||f==3535||3538<=f&&f<=3540||f==3542||f==3551||f==3633||3636<=f&&f<=3642||3655<=f&&f<=3662||f==3761||3764<=f&&f<=3769||3771<=f&&f<=3772||3784<=f&&f<=3789||3864<=f&&f<=3865||f==3893||f==3895||f==3897||3953<=f&&f<=3966||3968<=f&&f<=3972||3974<=f&&f<=3975||3981<=f&&f<=3991||3993<=f&&f<=4028||f==4038||4141<=f&&f<=4144||4146<=f&&f<=4151||4153<=f&&f<=4154||4157<=f&&f<=4158||4184<=f&&f<=4185||4190<=f&&f<=4192||4209<=f&&f<=4212||f==4226||4229<=f&&f<=4230||f==4237||f==4253||4957<=f&&f<=4959||5906<=f&&f<=5908||5938<=f&&f<=5940||5970<=f&&f<=5971||6002<=f&&f<=6003||6068<=f&&f<=6069||6071<=f&&f<=6077||f==6086||6089<=f&&f<=6099||f==6109||6155<=f&&f<=6157||6277<=f&&f<=6278||f==6313||6432<=f&&f<=6434||6439<=f&&f<=6440||f==6450||6457<=f&&f<=6459||6679<=f&&f<=6680||f==6683||f==6742||6744<=f&&f<=6750||f==6752||f==6754||6757<=f&&f<=6764||6771<=f&&f<=6780||f==6783||6832<=f&&f<=6845||f==6846||6912<=f&&f<=6915||f==6964||6966<=f&&f<=6970||f==6972||f==6978||7019<=f&&f<=7027||7040<=f&&f<=7041||7074<=f&&f<=7077||7080<=f&&f<=7081||7083<=f&&f<=7085||f==7142||7144<=f&&f<=7145||f==7149||7151<=f&&f<=7153||7212<=f&&f<=7219||7222<=f&&f<=7223||7376<=f&&f<=7378||7380<=f&&f<=7392||7394<=f&&f<=7400||f==7405||f==7412||7416<=f&&f<=7417||7616<=f&&f<=7673||7675<=f&&f<=7679||f==8204||8400<=f&&f<=8412||8413<=f&&f<=8416||f==8417||8418<=f&&f<=8420||8421<=f&&f<=8432||11503<=f&&f<=11505||f==11647||11744<=f&&f<=11775||12330<=f&&f<=12333||12334<=f&&f<=12335||12441<=f&&f<=12442||f==42607||42608<=f&&f<=42610||42612<=f&&f<=42621||42654<=f&&f<=42655||42736<=f&&f<=42737||f==43010||f==43014||f==43019||43045<=f&&f<=43046||43204<=f&&f<=43205||43232<=f&&f<=43249||43302<=f&&f<=43309||43335<=f&&f<=43345||43392<=f&&f<=43394||f==43443||43446<=f&&f<=43449||f==43452||f==43493||43561<=f&&f<=43566||43569<=f&&f<=43570||43573<=f&&f<=43574||f==43587||f==43596||f==43644||f==43696||43698<=f&&f<=43700||43703<=f&&f<=43704||43710<=f&&f<=43711||f==43713||43756<=f&&f<=43757||f==43766||f==44005||f==44008||f==44013||f==64286||65024<=f&&f<=65039||65056<=f&&f<=65071||65438<=f&&f<=65439||f==66045||f==66272||66422<=f&&f<=66426||68097<=f&&f<=68099||68101<=f&&f<=68102||68108<=f&&f<=68111||68152<=f&&f<=68154||f==68159||68325<=f&&f<=68326||f==69633||69688<=f&&f<=69702||69759<=f&&f<=69761||69811<=f&&f<=69814||69817<=f&&f<=69818||69888<=f&&f<=69890||69927<=f&&f<=69931||69933<=f&&f<=69940||f==70003||70016<=f&&f<=70017||70070<=f&&f<=70078||70090<=f&&f<=70092||70191<=f&&f<=70193||f==70196||70198<=f&&f<=70199||f==70206||f==70367||70371<=f&&f<=70378||70400<=f&&f<=70401||f==70460||f==70462||f==70464||f==70487||70502<=f&&f<=70508||70512<=f&&f<=70516||70712<=f&&f<=70719||70722<=f&&f<=70724||f==70726||f==70832||70835<=f&&f<=70840||f==70842||f==70845||70847<=f&&f<=70848||70850<=f&&f<=70851||f==71087||71090<=f&&f<=71093||71100<=f&&f<=71101||71103<=f&&f<=71104||71132<=f&&f<=71133||71219<=f&&f<=71226||f==71229||71231<=f&&f<=71232||f==71339||f==71341||71344<=f&&f<=71349||f==71351||71453<=f&&f<=71455||71458<=f&&f<=71461||71463<=f&&f<=71467||72193<=f&&f<=72198||72201<=f&&f<=72202||72243<=f&&f<=72248||72251<=f&&f<=72254||f==72263||72273<=f&&f<=72278||72281<=f&&f<=72283||72330<=f&&f<=72342||72344<=f&&f<=72345||72752<=f&&f<=72758||72760<=f&&f<=72765||f==72767||72850<=f&&f<=72871||72874<=f&&f<=72880||72882<=f&&f<=72883||72885<=f&&f<=72886||73009<=f&&f<=73014||f==73018||73020<=f&&f<=73021||73023<=f&&f<=73029||f==73031||92912<=f&&f<=92916||92976<=f&&f<=92982||94095<=f&&f<=94098||113821<=f&&f<=113822||f==119141||119143<=f&&f<=119145||119150<=f&&f<=119154||119163<=f&&f<=119170||119173<=f&&f<=119179||119210<=f&&f<=119213||119362<=f&&f<=119364||121344<=f&&f<=121398||121403<=f&&f<=121452||f==121461||f==121476||121499<=f&&f<=121503||121505<=f&&f<=121519||122880<=f&&f<=122886||122888<=f&&f<=122904||122907<=f&&f<=122913||122915<=f&&f<=122916||122918<=f&&f<=122922||125136<=f&&f<=125142||125252<=f&&f<=125258||917536<=f&&f<=917631||917760<=f&&f<=917999?s:127462<=f&&f<=127487?o:f==2307||f==2363||2366<=f&&f<=2368||2377<=f&&f<=2380||2382<=f&&f<=2383||2434<=f&&f<=2435||2495<=f&&f<=2496||2503<=f&&f<=2504||2507<=f&&f<=2508||f==2563||2622<=f&&f<=2624||f==2691||2750<=f&&f<=2752||f==2761||2763<=f&&f<=2764||2818<=f&&f<=2819||f==2880||2887<=f&&f<=2888||2891<=f&&f<=2892||f==3007||3009<=f&&f<=3010||3014<=f&&f<=3016||3018<=f&&f<=3020||3073<=f&&f<=3075||3137<=f&&f<=3140||3202<=f&&f<=3203||f==3262||3264<=f&&f<=3265||3267<=f&&f<=3268||3271<=f&&f<=3272||3274<=f&&f<=3275||3330<=f&&f<=3331||3391<=f&&f<=3392||3398<=f&&f<=3400||3402<=f&&f<=3404||3458<=f&&f<=3459||3536<=f&&f<=3537||3544<=f&&f<=3550||3570<=f&&f<=3571||f==3635||f==3763||3902<=f&&f<=3903||f==3967||f==4145||4155<=f&&f<=4156||4182<=f&&f<=4183||f==4228||f==6070||6078<=f&&f<=6085||6087<=f&&f<=6088||6435<=f&&f<=6438||6441<=f&&f<=6443||6448<=f&&f<=6449||6451<=f&&f<=6456||6681<=f&&f<=6682||f==6741||f==6743||6765<=f&&f<=6770||f==6916||f==6965||f==6971||6973<=f&&f<=6977||6979<=f&&f<=6980||f==7042||f==7073||7078<=f&&f<=7079||f==7082||f==7143||7146<=f&&f<=7148||f==7150||7154<=f&&f<=7155||7204<=f&&f<=7211||7220<=f&&f<=7221||f==7393||7410<=f&&f<=7411||f==7415||43043<=f&&f<=43044||f==43047||43136<=f&&f<=43137||43188<=f&&f<=43203||43346<=f&&f<=43347||f==43395||43444<=f&&f<=43445||43450<=f&&f<=43451||43453<=f&&f<=43456||43567<=f&&f<=43568||43571<=f&&f<=43572||f==43597||f==43755||43758<=f&&f<=43759||f==43765||44003<=f&&f<=44004||44006<=f&&f<=44007||44009<=f&&f<=44010||f==44012||f==69632||f==69634||f==69762||69808<=f&&f<=69810||69815<=f&&f<=69816||f==69932||f==70018||70067<=f&&f<=70069||70079<=f&&f<=70080||70188<=f&&f<=70190||70194<=f&&f<=70195||f==70197||70368<=f&&f<=70370||70402<=f&&f<=70403||f==70463||70465<=f&&f<=70468||70471<=f&&f<=70472||70475<=f&&f<=70477||70498<=f&&f<=70499||70709<=f&&f<=70711||70720<=f&&f<=70721||f==70725||70833<=f&&f<=70834||f==70841||70843<=f&&f<=70844||f==70846||f==70849||71088<=f&&f<=71089||71096<=f&&f<=71099||f==71102||71216<=f&&f<=71218||71227<=f&&f<=71228||f==71230||f==71340||71342<=f&&f<=71343||f==71350||71456<=f&&f<=71457||f==71462||72199<=f&&f<=72200||f==72249||72279<=f&&f<=72280||f==72343||f==72751||f==72766||f==72873||f==72881||f==72884||94033<=f&&f<=94078||f==119142||f==119149?a:4352<=f&&f<=4447||43360<=f&&f<=43388?c:4448<=f&&f<=4519||55216<=f&&f<=55238?u:4520<=f&&f<=4607||55243<=f&&f<=55291?h:f==44032||f==44060||f==44088||f==44116||f==44144||f==44172||f==44200||f==44228||f==44256||f==44284||f==44312||f==44340||f==44368||f==44396||f==44424||f==44452||f==44480||f==44508||f==44536||f==44564||f==44592||f==44620||f==44648||f==44676||f==44704||f==44732||f==44760||f==44788||f==44816||f==44844||f==44872||f==44900||f==44928||f==44956||f==44984||f==45012||f==45040||f==45068||f==45096||f==45124||f==45152||f==45180||f==45208||f==45236||f==45264||f==45292||f==45320||f==45348||f==45376||f==45404||f==45432||f==45460||f==45488||f==45516||f==45544||f==45572||f==45600||f==45628||f==45656||f==45684||f==45712||f==45740||f==45768||f==45796||f==45824||f==45852||f==45880||f==45908||f==45936||f==45964||f==45992||f==46020||f==46048||f==46076||f==46104||f==46132||f==46160||f==46188||f==46216||f==46244||f==46272||f==46300||f==46328||f==46356||f==46384||f==46412||f==46440||f==46468||f==46496||f==46524||f==46552||f==46580||f==46608||f==46636||f==46664||f==46692||f==46720||f==46748||f==46776||f==46804||f==46832||f==46860||f==46888||f==46916||f==46944||f==46972||f==47e3||f==47028||f==47056||f==47084||f==47112||f==47140||f==47168||f==47196||f==47224||f==47252||f==47280||f==47308||f==47336||f==47364||f==47392||f==47420||f==47448||f==47476||f==47504||f==47532||f==47560||f==47588||f==47616||f==47644||f==47672||f==47700||f==47728||f==47756||f==47784||f==47812||f==47840||f==47868||f==47896||f==47924||f==47952||f==47980||f==48008||f==48036||f==48064||f==48092||f==48120||f==48148||f==48176||f==48204||f==48232||f==48260||f==48288||f==48316||f==48344||f==48372||f==48400||f==48428||f==48456||f==48484||f==48512||f==48540||f==48568||f==48596||f==48624||f==48652||f==48680||f==48708||f==48736||f==48764||f==48792||f==48820||f==48848||f==48876||f==48904||f==48932||f==48960||f==48988||f==49016||f==49044||f==49072||f==49100||f==49128||f==49156||f==49184||f==49212||f==49240||f==49268||f==49296||f==49324||f==49352||f==49380||f==49408||f==49436||f==49464||f==49492||f==49520||f==49548||f==49576||f==49604||f==49632||f==49660||f==49688||f==49716||f==49744||f==49772||f==49800||f==49828||f==49856||f==49884||f==49912||f==49940||f==49968||f==49996||f==50024||f==50052||f==50080||f==50108||f==50136||f==50164||f==50192||f==50220||f==50248||f==50276||f==50304||f==50332||f==50360||f==50388||f==50416||f==50444||f==50472||f==50500||f==50528||f==50556||f==50584||f==50612||f==50640||f==50668||f==50696||f==50724||f==50752||f==50780||f==50808||f==50836||f==50864||f==50892||f==50920||f==50948||f==50976||f==51004||f==51032||f==51060||f==51088||f==51116||f==51144||f==51172||f==51200||f==51228||f==51256||f==51284||f==51312||f==51340||f==51368||f==51396||f==51424||f==51452||f==51480||f==51508||f==51536||f==51564||f==51592||f==51620||f==51648||f==51676||f==51704||f==51732||f==51760||f==51788||f==51816||f==51844||f==51872||f==51900||f==51928||f==51956||f==51984||f==52012||f==52040||f==52068||f==52096||f==52124||f==52152||f==52180||f==52208||f==52236||f==52264||f==52292||f==52320||f==52348||f==52376||f==52404||f==52432||f==52460||f==52488||f==52516||f==52544||f==52572||f==52600||f==52628||f==52656||f==52684||f==52712||f==52740||f==52768||f==52796||f==52824||f==52852||f==52880||f==52908||f==52936||f==52964||f==52992||f==53020||f==53048||f==53076||f==53104||f==53132||f==53160||f==53188||f==53216||f==53244||f==53272||f==53300||f==53328||f==53356||f==53384||f==53412||f==53440||f==53468||f==53496||f==53524||f==53552||f==53580||f==53608||f==53636||f==53664||f==53692||f==53720||f==53748||f==53776||f==53804||f==53832||f==53860||f==53888||f==53916||f==53944||f==53972||f==54e3||f==54028||f==54056||f==54084||f==54112||f==54140||f==54168||f==54196||f==54224||f==54252||f==54280||f==54308||f==54336||f==54364||f==54392||f==54420||f==54448||f==54476||f==54504||f==54532||f==54560||f==54588||f==54616||f==54644||f==54672||f==54700||f==54728||f==54756||f==54784||f==54812||f==54840||f==54868||f==54896||f==54924||f==54952||f==54980||f==55008||f==55036||f==55064||f==55092||f==55120||f==55148||f==55176?d:44033<=f&&f<=44059||44061<=f&&f<=44087||44089<=f&&f<=44115||44117<=f&&f<=44143||44145<=f&&f<=44171||44173<=f&&f<=44199||44201<=f&&f<=44227||44229<=f&&f<=44255||44257<=f&&f<=44283||44285<=f&&f<=44311||44313<=f&&f<=44339||44341<=f&&f<=44367||44369<=f&&f<=44395||44397<=f&&f<=44423||44425<=f&&f<=44451||44453<=f&&f<=44479||44481<=f&&f<=44507||44509<=f&&f<=44535||44537<=f&&f<=44563||44565<=f&&f<=44591||44593<=f&&f<=44619||44621<=f&&f<=44647||44649<=f&&f<=44675||44677<=f&&f<=44703||44705<=f&&f<=44731||44733<=f&&f<=44759||44761<=f&&f<=44787||44789<=f&&f<=44815||44817<=f&&f<=44843||44845<=f&&f<=44871||44873<=f&&f<=44899||44901<=f&&f<=44927||44929<=f&&f<=44955||44957<=f&&f<=44983||44985<=f&&f<=45011||45013<=f&&f<=45039||45041<=f&&f<=45067||45069<=f&&f<=45095||45097<=f&&f<=45123||45125<=f&&f<=45151||45153<=f&&f<=45179||45181<=f&&f<=45207||45209<=f&&f<=45235||45237<=f&&f<=45263||45265<=f&&f<=45291||45293<=f&&f<=45319||45321<=f&&f<=45347||45349<=f&&f<=45375||45377<=f&&f<=45403||45405<=f&&f<=45431||45433<=f&&f<=45459||45461<=f&&f<=45487||45489<=f&&f<=45515||45517<=f&&f<=45543||45545<=f&&f<=45571||45573<=f&&f<=45599||45601<=f&&f<=45627||45629<=f&&f<=45655||45657<=f&&f<=45683||45685<=f&&f<=45711||45713<=f&&f<=45739||45741<=f&&f<=45767||45769<=f&&f<=45795||45797<=f&&f<=45823||45825<=f&&f<=45851||45853<=f&&f<=45879||45881<=f&&f<=45907||45909<=f&&f<=45935||45937<=f&&f<=45963||45965<=f&&f<=45991||45993<=f&&f<=46019||46021<=f&&f<=46047||46049<=f&&f<=46075||46077<=f&&f<=46103||46105<=f&&f<=46131||46133<=f&&f<=46159||46161<=f&&f<=46187||46189<=f&&f<=46215||46217<=f&&f<=46243||46245<=f&&f<=46271||46273<=f&&f<=46299||46301<=f&&f<=46327||46329<=f&&f<=46355||46357<=f&&f<=46383||46385<=f&&f<=46411||46413<=f&&f<=46439||46441<=f&&f<=46467||46469<=f&&f<=46495||46497<=f&&f<=46523||46525<=f&&f<=46551||46553<=f&&f<=46579||46581<=f&&f<=46607||46609<=f&&f<=46635||46637<=f&&f<=46663||46665<=f&&f<=46691||46693<=f&&f<=46719||46721<=f&&f<=46747||46749<=f&&f<=46775||46777<=f&&f<=46803||46805<=f&&f<=46831||46833<=f&&f<=46859||46861<=f&&f<=46887||46889<=f&&f<=46915||46917<=f&&f<=46943||46945<=f&&f<=46971||46973<=f&&f<=46999||47001<=f&&f<=47027||47029<=f&&f<=47055||47057<=f&&f<=47083||47085<=f&&f<=47111||47113<=f&&f<=47139||47141<=f&&f<=47167||47169<=f&&f<=47195||47197<=f&&f<=47223||47225<=f&&f<=47251||47253<=f&&f<=47279||47281<=f&&f<=47307||47309<=f&&f<=47335||47337<=f&&f<=47363||47365<=f&&f<=47391||47393<=f&&f<=47419||47421<=f&&f<=47447||47449<=f&&f<=47475||47477<=f&&f<=47503||47505<=f&&f<=47531||47533<=f&&f<=47559||47561<=f&&f<=47587||47589<=f&&f<=47615||47617<=f&&f<=47643||47645<=f&&f<=47671||47673<=f&&f<=47699||47701<=f&&f<=47727||47729<=f&&f<=47755||47757<=f&&f<=47783||47785<=f&&f<=47811||47813<=f&&f<=47839||47841<=f&&f<=47867||47869<=f&&f<=47895||47897<=f&&f<=47923||47925<=f&&f<=47951||47953<=f&&f<=47979||47981<=f&&f<=48007||48009<=f&&f<=48035||48037<=f&&f<=48063||48065<=f&&f<=48091||48093<=f&&f<=48119||48121<=f&&f<=48147||48149<=f&&f<=48175||48177<=f&&f<=48203||48205<=f&&f<=48231||48233<=f&&f<=48259||48261<=f&&f<=48287||48289<=f&&f<=48315||48317<=f&&f<=48343||48345<=f&&f<=48371||48373<=f&&f<=48399||48401<=f&&f<=48427||48429<=f&&f<=48455||48457<=f&&f<=48483||48485<=f&&f<=48511||48513<=f&&f<=48539||48541<=f&&f<=48567||48569<=f&&f<=48595||48597<=f&&f<=48623||48625<=f&&f<=48651||48653<=f&&f<=48679||48681<=f&&f<=48707||48709<=f&&f<=48735||48737<=f&&f<=48763||48765<=f&&f<=48791||48793<=f&&f<=48819||48821<=f&&f<=48847||48849<=f&&f<=48875||48877<=f&&f<=48903||48905<=f&&f<=48931||48933<=f&&f<=48959||48961<=f&&f<=48987||48989<=f&&f<=49015||49017<=f&&f<=49043||49045<=f&&f<=49071||49073<=f&&f<=49099||49101<=f&&f<=49127||49129<=f&&f<=49155||49157<=f&&f<=49183||49185<=f&&f<=49211||49213<=f&&f<=49239||49241<=f&&f<=49267||49269<=f&&f<=49295||49297<=f&&f<=49323||49325<=f&&f<=49351||49353<=f&&f<=49379||49381<=f&&f<=49407||49409<=f&&f<=49435||49437<=f&&f<=49463||49465<=f&&f<=49491||49493<=f&&f<=49519||49521<=f&&f<=49547||49549<=f&&f<=49575||49577<=f&&f<=49603||49605<=f&&f<=49631||49633<=f&&f<=49659||49661<=f&&f<=49687||49689<=f&&f<=49715||49717<=f&&f<=49743||49745<=f&&f<=49771||49773<=f&&f<=49799||49801<=f&&f<=49827||49829<=f&&f<=49855||49857<=f&&f<=49883||49885<=f&&f<=49911||49913<=f&&f<=49939||49941<=f&&f<=49967||49969<=f&&f<=49995||49997<=f&&f<=50023||50025<=f&&f<=50051||50053<=f&&f<=50079||50081<=f&&f<=50107||50109<=f&&f<=50135||50137<=f&&f<=50163||50165<=f&&f<=50191||50193<=f&&f<=50219||50221<=f&&f<=50247||50249<=f&&f<=50275||50277<=f&&f<=50303||50305<=f&&f<=50331||50333<=f&&f<=50359||50361<=f&&f<=50387||50389<=f&&f<=50415||50417<=f&&f<=50443||50445<=f&&f<=50471||50473<=f&&f<=50499||50501<=f&&f<=50527||50529<=f&&f<=50555||50557<=f&&f<=50583||50585<=f&&f<=50611||50613<=f&&f<=50639||50641<=f&&f<=50667||50669<=f&&f<=50695||50697<=f&&f<=50723||50725<=f&&f<=50751||50753<=f&&f<=50779||50781<=f&&f<=50807||50809<=f&&f<=50835||50837<=f&&f<=50863||50865<=f&&f<=50891||50893<=f&&f<=50919||50921<=f&&f<=50947||50949<=f&&f<=50975||50977<=f&&f<=51003||51005<=f&&f<=51031||51033<=f&&f<=51059||51061<=f&&f<=51087||51089<=f&&f<=51115||51117<=f&&f<=51143||51145<=f&&f<=51171||51173<=f&&f<=51199||51201<=f&&f<=51227||51229<=f&&f<=51255||51257<=f&&f<=51283||51285<=f&&f<=51311||51313<=f&&f<=51339||51341<=f&&f<=51367||51369<=f&&f<=51395||51397<=f&&f<=51423||51425<=f&&f<=51451||51453<=f&&f<=51479||51481<=f&&f<=51507||51509<=f&&f<=51535||51537<=f&&f<=51563||51565<=f&&f<=51591||51593<=f&&f<=51619||51621<=f&&f<=51647||51649<=f&&f<=51675||51677<=f&&f<=51703||51705<=f&&f<=51731||51733<=f&&f<=51759||51761<=f&&f<=51787||51789<=f&&f<=51815||51817<=f&&f<=51843||51845<=f&&f<=51871||51873<=f&&f<=51899||51901<=f&&f<=51927||51929<=f&&f<=51955||51957<=f&&f<=51983||51985<=f&&f<=52011||52013<=f&&f<=52039||52041<=f&&f<=52067||52069<=f&&f<=52095||52097<=f&&f<=52123||52125<=f&&f<=52151||52153<=f&&f<=52179||52181<=f&&f<=52207||52209<=f&&f<=52235||52237<=f&&f<=52263||52265<=f&&f<=52291||52293<=f&&f<=52319||52321<=f&&f<=52347||52349<=f&&f<=52375||52377<=f&&f<=52403||52405<=f&&f<=52431||52433<=f&&f<=52459||52461<=f&&f<=52487||52489<=f&&f<=52515||52517<=f&&f<=52543||52545<=f&&f<=52571||52573<=f&&f<=52599||52601<=f&&f<=52627||52629<=f&&f<=52655||52657<=f&&f<=52683||52685<=f&&f<=52711||52713<=f&&f<=52739||52741<=f&&f<=52767||52769<=f&&f<=52795||52797<=f&&f<=52823||52825<=f&&f<=52851||52853<=f&&f<=52879||52881<=f&&f<=52907||52909<=f&&f<=52935||52937<=f&&f<=52963||52965<=f&&f<=52991||52993<=f&&f<=53019||53021<=f&&f<=53047||53049<=f&&f<=53075||53077<=f&&f<=53103||53105<=f&&f<=53131||53133<=f&&f<=53159||53161<=f&&f<=53187||53189<=f&&f<=53215||53217<=f&&f<=53243||53245<=f&&f<=53271||53273<=f&&f<=53299||53301<=f&&f<=53327||53329<=f&&f<=53355||53357<=f&&f<=53383||53385<=f&&f<=53411||53413<=f&&f<=53439||53441<=f&&f<=53467||53469<=f&&f<=53495||53497<=f&&f<=53523||53525<=f&&f<=53551||53553<=f&&f<=53579||53581<=f&&f<=53607||53609<=f&&f<=53635||53637<=f&&f<=53663||53665<=f&&f<=53691||53693<=f&&f<=53719||53721<=f&&f<=53747||53749<=f&&f<=53775||53777<=f&&f<=53803||53805<=f&&f<=53831||53833<=f&&f<=53859||53861<=f&&f<=53887||53889<=f&&f<=53915||53917<=f&&f<=53943||53945<=f&&f<=53971||53973<=f&&f<=53999||54001<=f&&f<=54027||54029<=f&&f<=54055||54057<=f&&f<=54083||54085<=f&&f<=54111||54113<=f&&f<=54139||54141<=f&&f<=54167||54169<=f&&f<=54195||54197<=f&&f<=54223||54225<=f&&f<=54251||54253<=f&&f<=54279||54281<=f&&f<=54307||54309<=f&&f<=54335||54337<=f&&f<=54363||54365<=f&&f<=54391||54393<=f&&f<=54419||54421<=f&&f<=54447||54449<=f&&f<=54475||54477<=f&&f<=54503||54505<=f&&f<=54531||54533<=f&&f<=54559||54561<=f&&f<=54587||54589<=f&&f<=54615||54617<=f&&f<=54643||54645<=f&&f<=54671||54673<=f&&f<=54699||54701<=f&&f<=54727||54729<=f&&f<=54755||54757<=f&&f<=54783||54785<=f&&f<=54811||54813<=f&&f<=54839||54841<=f&&f<=54867||54869<=f&&f<=54895||54897<=f&&f<=54923||54925<=f&&f<=54951||54953<=f&&f<=54979||54981<=f&&f<=55007||55009<=f&&f<=55035||55037<=f&&f<=55063||55065<=f&&f<=55091||55093<=f&&f<=55119||55121<=f&&f<=55147||55149<=f&&f<=55175||55177<=f&&f<=55203?p:f==9757||f==9977||9994<=f&&f<=9997||f==127877||127938<=f&&f<=127940||f==127943||127946<=f&&f<=127948||128066<=f&&f<=128067||128070<=f&&f<=128080||f==128110||128112<=f&&f<=128120||f==128124||128129<=f&&f<=128131||128133<=f&&f<=128135||f==128170||128372<=f&&f<=128373||f==128378||f==128400||128405<=f&&f<=128406||128581<=f&&f<=128583||128587<=f&&f<=128591||f==128675||128692<=f&&f<=128694||f==128704||f==128716||129304<=f&&f<=129308||129310<=f&&f<=129311||f==129318||129328<=f&&f<=129337||129341<=f&&f<=129342||129489<=f&&f<=129501?b:127995<=f&&f<=127999?x:f==8205?E:f==9792||f==9794||9877<=f&&f<=9878||f==9992||f==10084||f==127752||f==127806||f==127859||f==127891||f==127908||f==127912||f==127979||f==127981||f==128139||128187<=f&&f<=128188||f==128295||f==128300||f==128488||f==128640||f==128658?C:128102<=f&&f<=128105?w:g}return this}e.exports&&(e.exports=t)})(YF);var Dme=YF.exports;const Mme=Th(Dme);function Lme(){this.textureInfo=void 0,this.dimensions=void 0,this.billboard=void 0}function Pme(e,t,n){this.labelCollection=e,this.index=t,this.dimensions=n}const Nme=1.2,KF="ID_WHITE_PIXEL",mE=new k(4,4),Fme=new Ot(1,1,1,1);function Bme(e){const t=document.createElement("canvas");t.width=mE.x,t.height=mE.y;const n=t.getContext("2d");return n.fillStyle="#fff",n.fillRect(0,0,t.width,t.height),e.addImage(KF,t)}const Fs={};function zme(e,t,n,i,r,s,o){return Fs.font=t,Fs.fillColor=n,Fs.strokeColor=i,Fs.strokeWidth=r,Fs.padding=ys.PADDING,o===yn.CENTER?Fs.textBaseline="middle":o===yn.TOP?Fs.textBaseline="top":Fs.textBaseline="bottom",Fs.fill=s===oa.FILL||s===oa.FILL_AND_OUTLINE,Fs.stroke=s===oa.OUTLINE||s===oa.FILL_AND_OUTLINE,Fs.backgroundColor=M.BLACK,BX(e,Fs)}function gE(e,t){t.textureInfo=void 0,t.dimensions=void 0;const n=t.billboard;l(n)&&(n.show=!1,n.image=void 0,l(n._removeCallbackFunc)&&(n._removeCallbackFunc(),n._removeCallbackFunc=void 0),e._spareBillboards.push(n),t.billboard=void 0)}function Ume(e,t,n,i){i.index=e.addImageSync(t,n)}const kme=new Mme;function jme(e,t){const n=t._renderedText,i=kme.splitGraphemes(n),r=i.length,s=t._glyphs,o=s.length;let a,c,u;if(t._relativeSize=t._fontSize/ys.FONT_SIZE,r<o)for(c=r;c<o;++c)gE(e,s[c]);s.length=r;const h=t.show&&t._showBackground&&n.split(`
`).join("").length>0;let d=t._backgroundBillboard;const p=e._backgroundBillboardCollection;h?(l(d)||(d=p.add({collection:e,image:KF,imageSubRegion:Fme}),t._backgroundBillboard=d),d.color=t._backgroundColor,d.show=t._show,d.position=t._position,d.eyeOffset=t._eyeOffset,d.pixelOffset=t._pixelOffset,d.horizontalOrigin=As.LEFT,d.verticalOrigin=t._verticalOrigin,d.heightReference=t._heightReference,d.scale=t.totalScale,d.pickPrimitive=t,d.id=t._id,d.translucencyByDistance=t._translucencyByDistance,d.pixelOffsetScaleByDistance=t._pixelOffsetScaleByDistance,d.scaleByDistance=t._scaleByDistance,d.distanceDisplayCondition=t._distanceDisplayCondition,d.disableDepthTestDistance=t._disableDepthTestDistance,d.clusterShow=t.clusterShow):l(d)&&(p.remove(d),t._backgroundBillboard=d=void 0);const g=e._glyphTextureCache;for(u=0;u<r;++u){const _=i[u],b=t._verticalOrigin,x=JSON.stringify([_,t._fontFamily,t._fontStyle,t._fontWeight,+b]);let E=g[x];if(!l(E)){const C=`${t._fontStyle} ${t._fontWeight} ${ys.FONT_SIZE}px ${t._fontFamily}`,w=zme(_,C,M.WHITE,M.WHITE,0,oa.FILL,b);if(E=new Pme(e,-1,w.dimensions),g[x]=E,w.width>0&&w.height>0){const S=Tme(w,{cutoff:ys.CUTOFF,radius:ys.RADIUS}),v=w.getContext("2d"),D=w.width,L=w.height,O=v.getImageData(0,0,D,L);for(let N=0;N<D;N++)for(let B=0;B<L;B++){const U=B*D+N,V=S[U]*255,f=U*4;O.data[f+0]=V,O.data[f+1]=V,O.data[f+2]=V,O.data[f+3]=V}v.putImageData(O,0,0),_!==" "&&Ume(e._textureAtlas,x,w,E)}}if(a=s[u],l(a)?E.index===-1?gE(e,a):l(a.textureInfo)&&(a.textureInfo=void 0):(a=new Lme,s[u]=a),a.textureInfo=E,a.dimensions=E.dimensions,E.index!==-1){let C=a.billboard;const w=e._spareBillboards;l(C)||(w.length>0?C=w.pop():(C=e._billboardCollection.add({collection:e}),C._labelDimensions=new k,C._labelTranslate=new k),a.billboard=C),C.show=t._show,C.position=t._position,C.eyeOffset=t._eyeOffset,C.pixelOffset=t._pixelOffset,C.horizontalOrigin=As.LEFT,C.verticalOrigin=t._verticalOrigin,C.heightReference=t._heightReference,C.scale=t.totalScale,C.pickPrimitive=t,C.id=t._id,C.image=x,C.translucencyByDistance=t._translucencyByDistance,C.pixelOffsetScaleByDistance=t._pixelOffsetScaleByDistance,C.scaleByDistance=t._scaleByDistance,C.distanceDisplayCondition=t._distanceDisplayCondition,C.disableDepthTestDistance=t._disableDepthTestDistance,C._batchIndex=t._batchIndex,C.outlineColor=t.outlineColor,t.style===oa.FILL_AND_OUTLINE?(C.color=t._fillColor,C.outlineWidth=t.outlineWidth):t.style===oa.FILL?(C.color=t._fillColor,C.outlineWidth=0):t.style===oa.OUTLINE&&(C.color=M.TRANSPARENT,C.outlineWidth=t.outlineWidth)}}t._repositionAllGlyphs=!0}function dO(e,t,n){return t===As.CENTER?-e/2:t===As.RIGHT?-(e+n.x):n.x}const Bn=new k,Vme=new k;function Gme(e){const t=e._glyphs,n=e._renderedText;let i,r,s=0,o=0;const a=[];let c=Number.NEGATIVE_INFINITY,u=0,h=1,d;const p=t.length,g=e._backgroundBillboard,_=k.clone(l(g)?e._backgroundPadding:k.ZERO,Vme);for(_.x/=e._relativeSize,_.y/=e._relativeSize,d=0;d<p;++d)n.charAt(d)===`
`?(a.push(s),++h,s=0):(i=t[d],r=i.dimensions,u=Math.max(u,r.height-r.descent),c=Math.max(c,r.descent),s+=r.width-r.minx,d<p-1&&(s+=t[d+1].dimensions.minx),o=Math.max(o,s));a.push(s);const b=u+c,x=e.totalScale,E=e._horizontalOrigin,C=e._verticalOrigin;let w=0,S=a[w],v=dO(S,E,_);const D=(l(e._lineHeight)?e._lineHeight:Nme*e._fontSize)/e._relativeSize,L=D*(h-1);let O=o,N=b+L;l(g)&&(O+=_.x*2,N+=_.y*2,g._labelHorizontalOrigin=E),Bn.x=v*x,Bn.y=0;let B=!0,U=0;for(d=0;d<p;++d)if(n.charAt(d)===`
`)++w,U+=D,S=a[w],v=dO(S,E,_),Bn.x=v*x,B=!0;else if(i=t[d],r=i.dimensions,C===yn.TOP?(Bn.y=r.height-u-_.y,Bn.y+=ys.PADDING):C===yn.CENTER?Bn.y=(L+r.height-u)/2:C===yn.BASELINE?(Bn.y=L,Bn.y-=ys.PADDING):(Bn.y=L+c+_.y,Bn.y-=ys.PADDING),Bn.y=(Bn.y-r.descent-U)*x,B&&(Bn.x-=ys.PADDING*x,B=!1),l(i.billboard)&&(i.billboard._setTranslate(Bn),i.billboard._labelDimensions.x=O,i.billboard._labelDimensions.y=N,i.billboard._labelHorizontalOrigin=E),d<p-1){const V=t[d+1];Bn.x+=(r.width-r.minx+V.dimensions.minx)*x}if(l(g)&&n.split(`
`).join("").length>0&&(E===As.CENTER?v=-o/2-_.x:E===As.RIGHT?v=-(o+_.x*2):v=0,Bn.x=v*x,C===yn.TOP?Bn.y=b-u-c:C===yn.CENTER?Bn.y=(b-u)/2-c:C===yn.BASELINE?Bn.y=-_.y-c:Bn.y=0,Bn.y=Bn.y*x,g.width=O,g.height=N,g._setTranslate(Bn),g._labelTranslate=k.clone(Bn,g._labelTranslate)),cw(e.heightReference))for(d=0;d<p;++d){i=t[d];const V=i.billboard;l(V)&&(V._labelTranslate=k.clone(Bn,V._labelTranslate))}}function ZF(e,t){const n=t._glyphs;for(let i=0,r=n.length;i<r;++i)gE(e,n[i]);l(t._backgroundBillboard)&&(e._backgroundBillboardCollection.remove(t._backgroundBillboard),t._backgroundBillboard=void 0),t._labelCollection=void 0,l(t._removeCallbackFunc)&&t._removeCallbackFunc(),Ye(t)}function Uo(e){e=T(e,T.EMPTY_OBJECT),this._scene=e.scene,this._batchTable=e.batchTable,this._textureAtlas=void 0,this._backgroundTextureAtlas=void 0,this._backgroundBillboardCollection=new cs({scene:this._scene}),this._backgroundBillboardCollection.destroyTextureAtlas=!1,this._billboardCollection=new cs({scene:this._scene,batchTable:this._batchTable}),this._billboardCollection.destroyTextureAtlas=!1,this._billboardCollection._sdf=!0,this._spareBillboards=[],this._glyphTextureCache={},this._labels=[],this._labelsToUpdate=[],this._totalGlyphCount=0,this._highlightColor=M.clone(M.WHITE),this.show=T(e.show,!0),this.modelMatrix=P.clone(T(e.modelMatrix,P.IDENTITY)),this.debugShowBoundingVolume=T(e.debugShowBoundingVolume,!1),this.blendOption=T(e.blendOption,hs.OPAQUE_AND_TRANSLUCENT)}Object.defineProperties(Uo.prototype,{length:{get:function(){return this._labels.length}}});Uo.prototype.add=function(e){const t=new ac(e,this);return this._labels.push(t),this._labelsToUpdate.push(t),t};Uo.prototype.remove=function(e){if(l(e)&&e._labelCollection===this){const t=this._labels.indexOf(e);if(t!==-1)return this._labels.splice(t,1),ZF(this,e),!0}return!1};Uo.prototype.removeAll=function(){const e=this._labels;for(let t=0,n=e.length;t<n;++t)ZF(this,e[t]);e.length=0};Uo.prototype.contains=function(e){return l(e)&&e._labelCollection===this};Uo.prototype.get=function(e){if(!l(e))throw new A("index is required.");return this._labels[e]};Uo.prototype.update=function(e){if(!this.show)return;const t=this._billboardCollection,n=this._backgroundBillboardCollection;t.modelMatrix=this.modelMatrix,t.debugShowBoundingVolume=this.debugShowBoundingVolume,n.modelMatrix=this.modelMatrix,n.debugShowBoundingVolume=this.debugShowBoundingVolume;const i=e.context;l(this._textureAtlas)||(this._textureAtlas=new xa({context:i}),t.textureAtlas=this._textureAtlas),l(this._backgroundTextureAtlas)||(this._backgroundTextureAtlas=new xa({context:i,initialSize:mE}),n.textureAtlas=this._backgroundTextureAtlas,Bme(this._backgroundTextureAtlas));const r=this._labelsToUpdate.length;for(let o=0;o<r;++o){const a=this._labelsToUpdate[o];if(a.isDestroyed())continue;const c=a._glyphs.length;a._rebindAllGlyphs&&(jme(this,a),a._rebindAllGlyphs=!1),a._repositionAllGlyphs&&(Gme(a),a._repositionAllGlyphs=!1);const u=a._glyphs.length-c;this._totalGlyphCount+=u}const s=n.length>0?hs.TRANSLUCENT:this.blendOption;t.blendOption=s,n.blendOption=s,t._highlightColor=this._highlightColor,n._highlightColor=this._highlightColor,this._labelsToUpdate.length=0,n.update(e),t.update(e)};Uo.prototype.isDestroyed=function(){return!1};Uo.prototype.destroy=function(){return this.removeAll(),this._billboardCollection=this._billboardCollection.destroy(),this._textureAtlas=this._textureAtlas&&this._textureAtlas.destroy(),this._backgroundBillboardCollection=this._backgroundBillboardCollection.destroy(),this._backgroundTextureAtlas=this._backgroundTextureAtlas&&this._backgroundTextureAtlas.destroy(),Ye(this)};const Hme=`in vec3 position3DHigh;
in vec3 position3DLow;
in vec3 position2DHigh;
in vec3 position2DLow;
in vec3 prevPosition3DHigh;
in vec3 prevPosition3DLow;
in vec3 prevPosition2DHigh;
in vec3 prevPosition2DLow;
in vec3 nextPosition3DHigh;
in vec3 nextPosition3DLow;
in vec3 nextPosition2DHigh;
in vec3 nextPosition2DLow;
in vec4 texCoordExpandAndBatchIndex;

out vec2  v_st;
out float v_width;
out vec4 v_pickColor;
out float v_polylineAngle;

void main()
{
    float texCoord = texCoordExpandAndBatchIndex.x;
    float expandDir = texCoordExpandAndBatchIndex.y;
    bool usePrev = texCoordExpandAndBatchIndex.z < 0.0;
    float batchTableIndex = texCoordExpandAndBatchIndex.w;

    vec2 widthAndShow = batchTable_getWidthAndShow(batchTableIndex);
    float width = widthAndShow.x + 0.5;
    float show = widthAndShow.y;

    if (width < 1.0)
    {
        show = 0.0;
    }

    vec4 pickColor = batchTable_getPickColor(batchTableIndex);

    vec4 p, prev, next;
    if (czm_morphTime == 1.0)
    {
        p = czm_translateRelativeToEye(position3DHigh.xyz, position3DLow.xyz);
        prev = czm_translateRelativeToEye(prevPosition3DHigh.xyz, prevPosition3DLow.xyz);
        next = czm_translateRelativeToEye(nextPosition3DHigh.xyz, nextPosition3DLow.xyz);
    }
    else if (czm_morphTime == 0.0)
    {
        p = czm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy);
        prev = czm_translateRelativeToEye(prevPosition2DHigh.zxy, prevPosition2DLow.zxy);
        next = czm_translateRelativeToEye(nextPosition2DHigh.zxy, nextPosition2DLow.zxy);
    }
    else
    {
        p = czm_columbusViewMorph(
                czm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy),
                czm_translateRelativeToEye(position3DHigh.xyz, position3DLow.xyz),
                czm_morphTime);
        prev = czm_columbusViewMorph(
                czm_translateRelativeToEye(prevPosition2DHigh.zxy, prevPosition2DLow.zxy),
                czm_translateRelativeToEye(prevPosition3DHigh.xyz, prevPosition3DLow.xyz),
                czm_morphTime);
        next = czm_columbusViewMorph(
                czm_translateRelativeToEye(nextPosition2DHigh.zxy, nextPosition2DLow.zxy),
                czm_translateRelativeToEye(nextPosition3DHigh.xyz, nextPosition3DLow.xyz),
                czm_morphTime);
    }

    #ifdef DISTANCE_DISPLAY_CONDITION
        vec3 centerHigh = batchTable_getCenterHigh(batchTableIndex);
        vec4 centerLowAndRadius = batchTable_getCenterLowAndRadius(batchTableIndex);
        vec3 centerLow = centerLowAndRadius.xyz;
        float radius = centerLowAndRadius.w;
        vec2 distanceDisplayCondition = batchTable_getDistanceDisplayCondition(batchTableIndex);

        float lengthSq;
        if (czm_sceneMode == czm_sceneMode2D)
        {
            lengthSq = czm_eyeHeight2D.y;
        }
        else
        {
            vec4 center = czm_translateRelativeToEye(centerHigh.xyz, centerLow.xyz);
            lengthSq = max(0.0, dot(center.xyz, center.xyz) - radius * radius);
        }

        float nearSq = distanceDisplayCondition.x * distanceDisplayCondition.x;
        float farSq = distanceDisplayCondition.y * distanceDisplayCondition.y;
        if (lengthSq < nearSq || lengthSq > farSq)
        {
            show = 0.0;
        }
    #endif

    float polylineAngle;
    vec4 positionWC = getPolylineWindowCoordinates(p, prev, next, expandDir, width, usePrev, polylineAngle);
    gl_Position = czm_viewportOrthographic * positionWC * show;

    v_st.s = texCoord;
    v_st.t = czm_writeNonPerspective(clamp(expandDir, 0.0, 1.0), gl_Position.w);

    v_width = width;
    v_pickColor = pickColor;
    v_polylineAngle = polylineAngle;
}
`;function Si(e,t){e=T(e,T.EMPTY_OBJECT),this._show=T(e.show,!0),this._width=T(e.width,1),this._loop=T(e.loop,!1),this._distanceDisplayCondition=e.distanceDisplayCondition,this._material=e.material,l(this._material)||(this._material=ce.fromType(ce.ColorType,{color:new M(1,1,1,1)}));let n=e.positions;l(n)||(n=[]),this._positions=n,this._actualPositions=Iu(n,m.equalsEpsilon),this._loop&&this._actualPositions.length>2&&(this._actualPositions===this._positions&&(this._actualPositions=n.slice()),this._actualPositions.push(m.clone(this._actualPositions[0]))),this._length=this._actualPositions.length,this._id=e.id;let i;l(t)&&(i=P.clone(t.modelMatrix)),this._modelMatrix=i,this._segments=Ar.wrapLongitude(this._actualPositions,i),this._actualLength=void 0,this._propertiesChanged=new Uint32Array(QF),this._polylineCollection=t,this._dirty=!1,this._pickId=void 0,this._boundingVolume=ee.fromPoints(this._actualPositions),this._boundingVolumeWC=ee.transform(this._boundingVolume,this._modelMatrix),this._boundingVolume2D=new ee}const JF=Si.POSITION_INDEX=0,qme=Si.SHOW_INDEX=1,Wme=Si.WIDTH_INDEX=2,$me=Si.MATERIAL_INDEX=3,rp=Si.POSITION_SIZE_INDEX=4,Xme=Si.DISTANCE_DISPLAY_CONDITION=5,QF=Si.NUMBER_OF_PROPERTIES=6;function Ua(e,t){++e._propertiesChanged[t];const n=e._polylineCollection;l(n)&&(n._updatePolyline(e,t),e._dirty=!0)}Object.defineProperties(Si.prototype,{show:{get:function(){return this._show},set:function(e){if(!l(e))throw new A("value is required.");e!==this._show&&(this._show=e,Ua(this,qme))}},positions:{get:function(){return this._positions},set:function(e){if(!l(e))throw new A("value is required.");let t=Iu(e,m.equalsEpsilon);this._loop&&t.length>2&&(t===e&&(t=e.slice()),t.push(m.clone(t[0]))),(this._actualPositions.length!==t.length||this._actualPositions.length!==this._length)&&Ua(this,rp),this._positions=e,this._actualPositions=t,this._length=t.length,this._boundingVolume=ee.fromPoints(this._actualPositions,this._boundingVolume),this._boundingVolumeWC=ee.transform(this._boundingVolume,this._modelMatrix,this._boundingVolumeWC),Ua(this,JF),this.update()}},material:{get:function(){return this._material},set:function(e){if(!l(e))throw new A("material is required.");this._material!==e&&(this._material=e,Ua(this,$me))}},width:{get:function(){return this._width},set:function(e){if(!l(e))throw new A("value is required.");const t=this._width;e!==t&&(this._width=e,Ua(this,Wme))}},loop:{get:function(){return this._loop},set:function(e){if(!l(e))throw new A("value is required.");if(e!==this._loop){let t=this._actualPositions;e?t.length>2&&!m.equals(t[0],t[t.length-1])&&(t.length===this._positions.length&&(this._actualPositions=t=this._positions.slice()),t.push(m.clone(t[0]))):t.length>2&&m.equals(t[0],t[t.length-1])&&(t.length-1===this._positions.length?this._actualPositions=this._positions:t.pop()),this._loop=e,Ua(this,rp)}}},id:{get:function(){return this._id},set:function(e){this._id=e,l(this._pickId)&&(this._pickId.object.id=e)}},pickId:{get:function(){return this._pickId}},isDestroyed:{get:function(){return!l(this._polylineCollection)}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){if(l(e)&&e.far<=e.near)throw new A("far distance must be greater than near distance.");$n.equals(e,this._distanceDisplayCondition)||(this._distanceDisplayCondition=$n.clone(e,this._distanceDisplayCondition),Ua(this,Xme))}}});Si.prototype.update=function(){let e=P.IDENTITY;l(this._polylineCollection)&&(e=this._polylineCollection.modelMatrix);const t=this._segments.positions.length,n=this._segments.lengths,i=this._propertiesChanged[JF]>0||this._propertiesChanged[rp]>0;if((!P.equals(e,this._modelMatrix)||i)&&(this._segments=Ar.wrapLongitude(this._actualPositions,e),this._boundingVolumeWC=ee.transform(this._boundingVolume,e,this._boundingVolumeWC)),this._modelMatrix=P.clone(e,this._modelMatrix),this._segments.positions.length!==t)Ua(this,rp);else{const r=n.length;for(let s=0;s<r;++s)if(n[s]!==this._segments.lengths[s]){Ua(this,rp);break}}};Si.prototype.getPickId=function(e){return l(this._pickId)||(this._pickId=e.createPickId({primitive:this,collection:this._polylineCollection,id:this._id})),this._pickId};Si.prototype._clean=function(){this._dirty=!1;const e=this._propertiesChanged;for(let t=0;t<QF-1;++t)e[t]=0};Si.prototype._destroy=function(){this._pickId=this._pickId&&this._pickId.destroy(),this._material=this._material&&this._material.destroy(),this._polylineCollection=void 0};const Yme=Si.SHOW_INDEX,Kme=Si.WIDTH_INDEX,_E=Si.POSITION_INDEX,Zme=Si.MATERIAL_INDEX,pO=Si.POSITION_SIZE_INDEX,Jme=Si.DISTANCE_DISPLAY_CONDITION,eB=Si.NUMBER_OF_PROPERTIES,Kr={texCoordExpandAndBatchIndex:0,position3DHigh:1,position3DLow:2,position2DHigh:3,position2DLow:4,prevPosition3DHigh:5,prevPosition3DLow:6,prevPosition2DHigh:7,prevPosition2DLow:8,nextPosition3DHigh:9,nextPosition3DLow:10,nextPosition2DHigh:11,nextPosition2DLow:12};function ko(e){e=T(e,T.EMPTY_OBJECT),this.show=T(e.show,!0),this.modelMatrix=P.clone(T(e.modelMatrix,P.IDENTITY)),this._modelMatrix=P.clone(P.IDENTITY),this.debugShowBoundingVolume=T(e.debugShowBoundingVolume,!1),this._opaqueRS=void 0,this._translucentRS=void 0,this._colorCommands=[],this._polylinesUpdated=!1,this._polylinesRemoved=!1,this._createVertexArray=!1,this._propertiesChanged=new Uint32Array(eB),this._polylines=[],this._polylineBuckets={},this._positionBufferUsage={bufferUsage:Ae.STATIC_DRAW,frameCount:0},this._mode=void 0,this._polylinesToUpdate=[],this._vertexArrays=[],this._positionBuffer=void 0,this._texCoordExpandAndBatchIndexBuffer=void 0,this._batchTable=void 0,this._createBatchTable=!1,this._useHighlightColor=!1,this._highlightColor=M.clone(M.WHITE);const t=this;this._uniformMap={u_highlightColor:function(){return t._highlightColor}}}Object.defineProperties(ko.prototype,{length:{get:function(){return jw(this),this._polylines.length}}});ko.prototype.add=function(e){const t=new Si(e,this);return t._index=this._polylines.length,this._polylines.push(t),this._createVertexArray=!0,this._createBatchTable=!0,t};ko.prototype.remove=function(e){if(this.contains(e)){if(this._polylinesRemoved=!0,this._createVertexArray=!0,this._createBatchTable=!0,l(e._bucket)){const t=e._bucket;t.shaderProgram=t.shaderProgram&&t.shaderProgram.destroy()}return e._destroy(),!0}return!1};ko.prototype.removeAll=function(){Vw(this),sB(this),this._polylineBuckets={},this._polylinesRemoved=!1,this._polylines.length=0,this._polylinesToUpdate.length=0,this._createVertexArray=!0};ko.prototype.contains=function(e){return l(e)&&e._polylineCollection===this};ko.prototype.get=function(e){if(!l(e))throw new A("index is required.");return jw(this),this._polylines[e]};function Qme(e,t){l(e._batchTable)&&e._batchTable.destroy();const n=[{functionName:"batchTable_getWidthAndShow",componentDatatype:q.UNSIGNED_BYTE,componentsPerAttribute:2},{functionName:"batchTable_getPickColor",componentDatatype:q.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0},{functionName:"batchTable_getCenterHigh",componentDatatype:q.FLOAT,componentsPerAttribute:3},{functionName:"batchTable_getCenterLowAndRadius",componentDatatype:q.FLOAT,componentsPerAttribute:4},{functionName:"batchTable_getDistanceDisplayCondition",componentDatatype:q.FLOAT,componentsPerAttribute:2}];e._batchTable=new wa(t,n,e._polylines.length)}const tB=new Tn,nB=new Y,iB=new k;ko.prototype.update=function(e){if(jw(this),this._polylines.length===0||!this.show)return;sge(this,e);const t=e.context,n=e.mapProjection;let i,r=this._propertiesChanged;if(this._createBatchTable){if(We.maximumVertexTextureImageUnits===0)throw new te("Vertex texture fetch support is required to render polylines. The maximum number of vertex texture image units must be greater than zero.");Qme(this,t),this._createBatchTable=!1}if(this._createVertexArray||tge(this))_O(this,t,n);else if(this._polylinesUpdated){const c=this._polylinesToUpdate;if(this._mode!==Ie.SCENE3D){const u=c.length;for(let h=0;h<u;++h)i=c[h],i.update()}if(r[pO]||r[Zme])_O(this,t,n);else{const u=c.length,h=this._polylineBuckets;for(let d=0;d<u;++d){i=c[d],r=i._propertiesChanged;const p=i._bucket;let g=0;for(const _ in h)if(h.hasOwnProperty(_)){if(h[_]===p){r[_E]&&p.writeUpdate(g,i,this._positionBuffer,n);break}g+=h[_].lengthOfPositions}if((r[Yme]||r[Kme])&&this._batchTable.setBatchedAttribute(i._index,0,new k(i._width,i._show)),this._batchTable.attributes.length>2){if(r[_E]||r[pO]){const _=e.mode===Ie.SCENE2D?i._boundingVolume2D:i._boundingVolumeWC,b=Tn.fromCartesian(_.center,tB),x=Y.fromElements(b.low.x,b.low.y,b.low.z,_.radius,nB);this._batchTable.setBatchedAttribute(i._index,2,b.high),this._batchTable.setBatchedAttribute(i._index,3,x)}if(r[Jme]){const _=iB;_.x=0,_.y=Number.MAX_VALUE;const b=i.distanceDisplayCondition;l(b)&&(_.x=b.near,_.y=b.far),this._batchTable.setBatchedAttribute(i._index,4,_)}}i._clean()}}c.length=0,this._polylinesUpdated=!1}r=this._propertiesChanged;for(let c=0;c<eB;++c)r[c]=0;let s=P.IDENTITY;e.mode===Ie.SCENE3D&&(s=this.modelMatrix);const o=e.passes,a=e.morphTime!==0;if((!l(this._opaqueRS)||this._opaqueRS.depthTest.enabled!==a)&&(this._opaqueRS=it.fromCache({depthMask:a,depthTest:{enabled:a}})),(!l(this._translucentRS)||this._translucentRS.depthTest.enabled!==a)&&(this._translucentRS=it.fromCache({blending:vs.ALPHA_BLEND,depthMask:!a,depthTest:{enabled:a}})),this._batchTable.update(e),o.render||o.pick){const c=this._colorCommands;ege(this,e,c,s)}};const Ed=new ee,mO=new ee;function ege(e,t,n,i){const r=t.context,s=t.commandList,o=n.length;let a=0,c=!0;const u=e._vertexArrays,h=e.debugShowBoundingVolume,p=e._batchTable.getUniformMapCallback(),g=u.length;for(let _=0;_<g;++_){const b=u[_],x=b.buckets,E=x.length;for(let C=0;C<E;++C){const w=x[C];let S=w.offset;const v=w.bucket.shaderProgram,D=w.bucket.polylines,L=D.length;let O,N,B=0,U,V;for(let f=0;f<L;++f){const I=D[f],F=ige(I._material);if(F!==O){if(l(O)&&B>0){const Z=N.isTranslucent();a>=o?(U=new Tt({owner:e}),n.push(U)):U=n[a],++a,V=wt(p(N._uniforms),e._uniformMap),U.boundingVolume=ee.clone(Ed,U.boundingVolume),U.modelMatrix=i,U.shaderProgram=v,U.vertexArray=b.va,U.renderState=Z?e._translucentRS:e._opaqueRS,U.pass=Z?Ke.TRANSLUCENT:Ke.OPAQUE,U.debugShowBoundingVolume=h,U.pickId="v_pickColor",U.uniformMap=V,U.count=B,U.offset=S,S+=B,B=0,c=!0,s.push(U)}N=I._material,N.update(r),O=F}const G=I._locatorBuckets,W=G.length;for(let Z=0;Z<W;++Z){const $=G[Z];$.locator===w&&(B+=$.count)}let X;t.mode===Ie.SCENE3D?X=I._boundingVolumeWC:t.mode===Ie.COLUMBUS_VIEW?X=I._boundingVolume2D:t.mode===Ie.SCENE2D?l(I._boundingVolume2D)&&(X=ee.clone(I._boundingVolume2D,mO),X.center.x=0):l(I._boundingVolumeWC)&&l(I._boundingVolume2D)&&(X=ee.union(I._boundingVolumeWC,I._boundingVolume2D,mO)),c?(c=!1,ee.clone(X,Ed)):ee.union(X,Ed,Ed)}l(O)&&B>0&&(a>=o?(U=new Tt({owner:e}),n.push(U)):U=n[a],++a,V=wt(p(N._uniforms),e._uniformMap),U.boundingVolume=ee.clone(Ed,U.boundingVolume),U.modelMatrix=i,U.shaderProgram=v,U.vertexArray=b.va,U.renderState=N.isTranslucent()?e._translucentRS:e._opaqueRS,U.pass=N.isTranslucent()?Ke.TRANSLUCENT:Ke.OPAQUE,U.debugShowBoundingVolume=h,U.pickId="v_pickColor",U.uniformMap=V,U.count=B,U.offset=S,c=!0,s.push(U)),O=void 0}}n.length=a}ko.prototype.isDestroyed=function(){return!1};ko.prototype.destroy=function(){return rB(this),Vw(this),sB(this),this._batchTable=this._batchTable&&this._batchTable.destroy(),Ye(this)};function tge(e){let t=!1;const n=e._propertiesChanged,i=e._positionBufferUsage;return n[_E]?(i.bufferUsage!==Ae.STREAM_DRAW&&(t=!0,i.bufferUsage=Ae.STREAM_DRAW),i.frameCount=100):i.bufferUsage!==Ae.STATIC_DRAW&&(i.frameCount===0?(t=!0,i.bufferUsage=Ae.STATIC_DRAW):i.frameCount--),t}const gO=[0,0,0];function _O(e,t,n){e._createVertexArray=!1,Vw(e),rB(e),rge(e);const i=[[]];let r=i[0];const s=e._batchTable,o=e._useHighlightColor,a=[0];let c=0;const u=[[]];let h=0;const d=e._polylineBuckets;let p,g;for(p in d)d.hasOwnProperty(p)&&(g=d[p],g.updateShader(t,s,o),h+=g.lengthOfPositions);if(h>0){const _=e._mode,b=new Float32Array(6*h*3),x=new Float32Array(h*4);let E,C=0,w=0,S=0;for(p in d)if(d.hasOwnProperty(p)){g=d[p],g.write(b,x,C,w,S,s,t,n),_===Ie.MORPHING&&(l(E)||(E=new Float32Array(6*h*3)),g.writeForMorph(E,C));const V=g.lengthOfPositions;C+=6*V*3,w+=V*4,S+=V*4,c=g.updateIndices(i,a,u,c)}const v=e._positionBufferUsage.bufferUsage,D=Ae.STATIC_DRAW;e._positionBuffer=ze.createVertexBuffer({context:t,typedArray:b,usage:v});let L;l(E)&&(L=ze.createVertexBuffer({context:t,typedArray:E,usage:v})),e._texCoordExpandAndBatchIndexBuffer=ze.createVertexBuffer({context:t,typedArray:x,usage:D});const O=3*Float32Array.BYTES_PER_ELEMENT,N=4*Float32Array.BYTES_PER_ELEMENT;let B=0;const U=i.length;for(let V=0;V<U;++V)if(r=i[V],r.length>0){const f=new Uint16Array(r),I=ze.createIndexBuffer({context:t,typedArray:f,usage:Ae.STATIC_DRAW,indexDatatype:Ge.UNSIGNED_SHORT});B+=a[V];const F=6*(V*(O*R.SIXTY_FOUR_KILOBYTES)-B*O),G=O+F,W=O+G,X=O+W,Z=O+X,$=O+Z,ne=V*(N*R.SIXTY_FOUR_KILOBYTES)-B*N,le=[{index:Kr.position3DHigh,componentsPerAttribute:3,componentDatatype:q.FLOAT,offsetInBytes:F,strideInBytes:6*O},{index:Kr.position3DLow,componentsPerAttribute:3,componentDatatype:q.FLOAT,offsetInBytes:G,strideInBytes:6*O},{index:Kr.position2DHigh,componentsPerAttribute:3,componentDatatype:q.FLOAT,offsetInBytes:F,strideInBytes:6*O},{index:Kr.position2DLow,componentsPerAttribute:3,componentDatatype:q.FLOAT,offsetInBytes:G,strideInBytes:6*O},{index:Kr.prevPosition3DHigh,componentsPerAttribute:3,componentDatatype:q.FLOAT,offsetInBytes:W,strideInBytes:6*O},{index:Kr.prevPosition3DLow,componentsPerAttribute:3,componentDatatype:q.FLOAT,offsetInBytes:X,strideInBytes:6*O},{index:Kr.prevPosition2DHigh,componentsPerAttribute:3,componentDatatype:q.FLOAT,offsetInBytes:W,strideInBytes:6*O},{index:Kr.prevPosition2DLow,componentsPerAttribute:3,componentDatatype:q.FLOAT,offsetInBytes:X,strideInBytes:6*O},{index:Kr.nextPosition3DHigh,componentsPerAttribute:3,componentDatatype:q.FLOAT,offsetInBytes:Z,strideInBytes:6*O},{index:Kr.nextPosition3DLow,componentsPerAttribute:3,componentDatatype:q.FLOAT,offsetInBytes:$,strideInBytes:6*O},{index:Kr.nextPosition2DHigh,componentsPerAttribute:3,componentDatatype:q.FLOAT,offsetInBytes:Z,strideInBytes:6*O},{index:Kr.nextPosition2DLow,componentsPerAttribute:3,componentDatatype:q.FLOAT,offsetInBytes:$,strideInBytes:6*O},{index:Kr.texCoordExpandAndBatchIndex,componentsPerAttribute:4,componentDatatype:q.FLOAT,vertexBuffer:e._texCoordExpandAndBatchIndexBuffer,offsetInBytes:ne}];let pe,we,me,Pe;_===Ie.SCENE3D?(we=e._positionBuffer,pe="vertexBuffer",me=gO,Pe="value"):_===Ie.SCENE2D||_===Ie.COLUMBUS_VIEW?(we=gO,pe="value",me=e._positionBuffer,Pe="vertexBuffer"):(we=L,pe="vertexBuffer",me=e._positionBuffer,Pe="vertexBuffer"),le[0][pe]=we,le[1][pe]=we,le[2][Pe]=me,le[3][Pe]=me,le[4][pe]=we,le[5][pe]=we,le[6][Pe]=me,le[7][Pe]=me,le[8][pe]=we,le[9][pe]=we,le[10][Pe]=me,le[11][Pe]=me;const ot=new $i({context:t,attributes:le,indexBuffer:I});e._vertexArrays.push({va:ot,buckets:u[V]})}}}function nge(e,t){return t instanceof kt?t.id:t}const Sg=[];function ige(e){const t=ce._uniformList[e.type],n=t.length;Sg.length=2*n;let i=0;for(let r=0;r<n;++r){const s=t[r];Sg[i]=s,Sg[i+1]=e._uniforms[s](),i+=2}return`${e.type}:${JSON.stringify(Sg,nge)}`}function rge(e){const t=e._mode,n=e._modelMatrix,i=e._polylineBuckets={},r=e._polylines,s=r.length;for(let o=0;o<s;++o){const a=r[o];if(a._actualPositions.length>1){a.update();const c=a.material;let u=i[c.type];l(u)||(u=i[c.type]=new Da(c,t,n)),u.addPolyline(a)}}}function sge(e,t){const n=t.mode;(e._mode!==n||!P.equals(e._modelMatrix,e.modelMatrix))&&(e._mode=n,e._modelMatrix=P.clone(e.modelMatrix),e._createVertexArray=!0)}function jw(e){if(e._polylinesRemoved){e._polylinesRemoved=!1;const t=[],n=[];let i=0,r;const s=e._polylines.length;for(let o=0;o<s;++o)r=e._polylines[o],r.isDestroyed||(r._index=i++,n.push(r),t.push(r));e._polylines=t,e._polylinesToUpdate=n}}function Vw(e){const t=e._polylines,n=t.length;for(let i=0;i<n;++i)if(!t[i].isDestroyed){const r=t[i]._bucket;l(r)&&(r.shaderProgram=r.shaderProgram&&r.shaderProgram.destroy())}}function rB(e){const t=e._vertexArrays.length;for(let n=0;n<t;++n)e._vertexArrays[n].va.destroy();e._vertexArrays.length=0}ko.prototype._updatePolyline=function(e,t){this._polylinesUpdated=!0,e._dirty||this._polylinesToUpdate.push(e),++this._propertiesChanged[t]};function sB(e){const t=e._polylines,n=t.length;for(let i=0;i<n;++i)t[i].isDestroyed||t[i]._destroy()}function wT(e,t,n){this.count=e,this.offset=t,this.bucket=n}function Da(e,t,n){this.polylines=[],this.lengthOfPositions=0,this.material=e,this.shaderProgram=void 0,this.mode=t,this.modelMatrix=n}Da.prototype.addPolyline=function(e){this.polylines.push(e),e._actualLength=this.getPolylinePositionsLength(e),this.lengthOfPositions+=e._actualLength,e._bucket=this};Da.prototype.updateShader=function(e,t,n){if(l(this.shaderProgram))return;const i=["DISTANCE_DISPLAY_CONDITION"];n&&i.push("VECTOR_TILE"),this.material.shaderSource.search(/in\s+float\s+v_polylineAngle;/g)!==-1&&i.push("POLYLINE_DASH"),It.isInternetExplorer()||i.push("CLIP_POLYLINE");const r=new Je({defines:i,sources:[`in vec4 v_pickColor;
`,this.material.shaderSource,nte]}),s=t.getVertexShaderCallback()(Hme),o=new Je({defines:i,sources:[lw,s]});this.shaderProgram=kn.fromCache({context:e,vertexShaderSource:o,fragmentShaderSource:r,attributeLocations:Kr})};function oB(e){return m.dot(m.UNIT_X,e._boundingVolume.center)<0||e._boundingVolume.intersectPlane(Ve.ORIGIN_ZX_PLANE)===ut.INTERSECTING}Da.prototype.getPolylinePositionsLength=function(e){let t;if(this.mode===Ie.SCENE3D||!oB(e))return t=e._actualPositions.length,t*4-4;let n=0;const i=e._segments.lengths;t=i.length;for(let r=0;r<t;++r)n+=i[r]*4-4;return n};const _i=new m,Hs=new m,qs=new m,cy=new m,oge=new Y,age=new k;Da.prototype.write=function(e,t,n,i,r,s,o,a){const c=this.mode,u=a.ellipsoid.maximumRadius*R.PI,h=this.polylines,d=h.length;for(let p=0;p<d;++p){const g=h[p],_=g.width,b=g.show&&_>0,x=g._index,E=this.getSegments(g,a),C=E.positions,w=E.lengths,S=C.length,v=g.getPickId(o).color;let D=0,L=0,O;for(let W=0;W<S;++W){W===0?g._loop?O=C[S-2]:(O=cy,m.subtract(C[0],C[1],O),m.add(C[0],O,O)):O=C[W-1],m.clone(O,Hs),m.clone(C[W],_i),W===S-1?g._loop?O=C[1]:(O=cy,m.subtract(C[S-1],C[S-2],O),m.add(C[S-1],O,O)):O=C[W+1],m.clone(O,qs);const X=w[D];W===L+X&&(L+=X,++D);const Z=W-L===0,$=W===L+w[D]-1;c===Ie.SCENE2D&&(Hs.z=0,_i.z=0,qs.z=0),(c===Ie.SCENE2D||c===Ie.MORPHING)&&(Z||$)&&u-Math.abs(_i.x)<1&&((_i.x<0&&Hs.x>0||_i.x>0&&Hs.x<0)&&m.clone(_i,Hs),(_i.x<0&&qs.x>0||_i.x>0&&qs.x<0)&&m.clone(_i,qs));const ne=Z?2:0,le=$?2:4;for(let pe=ne;pe<le;++pe){Tn.writeElements(_i,e,n),Tn.writeElements(Hs,e,n+6),Tn.writeElements(qs,e,n+12);const we=pe-2<0?-1:1;t[r]=W/(S-1),t[r+1]=2*(pe%2)-1,t[r+2]=we,t[r+3]=x,n+=6*3,r+=4}}const N=oge;N.x=M.floatToByte(v.red),N.y=M.floatToByte(v.green),N.z=M.floatToByte(v.blue),N.w=M.floatToByte(v.alpha);const B=age;B.x=_,B.y=b?1:0;const U=c===Ie.SCENE2D?g._boundingVolume2D:g._boundingVolumeWC,V=Tn.fromCartesian(U.center,tB),f=V.high,I=Y.fromElements(V.low.x,V.low.y,V.low.z,U.radius,nB),F=iB;F.x=0,F.y=Number.MAX_VALUE;const G=g.distanceDisplayCondition;l(G)&&(F.x=G.near,F.y=G.far),s.setBatchedAttribute(x,0,B),s.setBatchedAttribute(x,1,N),s.attributes.length>2&&(s.setBatchedAttribute(x,2,f),s.setBatchedAttribute(x,3,I),s.setBatchedAttribute(x,4,F))}};const cge=new m,lge=new m,uge=new m,yO=new m;Da.prototype.writeForMorph=function(e,t){const n=this.modelMatrix,i=this.polylines,r=i.length;for(let s=0;s<r;++s){const o=i[s],a=o._segments.positions,c=o._segments.lengths,u=a.length;let h=0,d=0;for(let p=0;p<u;++p){let g;p===0?o._loop?g=a[u-2]:(g=yO,m.subtract(a[0],a[1],g),m.add(a[0],g,g)):g=a[p-1],g=P.multiplyByPoint(n,g,lge);const _=P.multiplyByPoint(n,a[p],cge);let b;p===u-1?o._loop?b=a[1]:(b=yO,m.subtract(a[u-1],a[u-2],b),m.add(a[u-1],b,b)):b=a[p+1],b=P.multiplyByPoint(n,b,uge);const x=c[h];p===d+x&&(d+=x,++h);const E=p-d===0,C=p===d+c[h]-1,w=E?2:0,S=C?2:4;for(let v=w;v<S;++v)Tn.writeElements(_,e,t),Tn.writeElements(g,e,t+6),Tn.writeElements(b,e,t+12),t+=6*3}}};const fge=new Array(1);Da.prototype.updateIndices=function(e,t,n,i){let r=n.length-1,s=new wT(0,i,this);n[r].push(s);let o=0,a=e[e.length-1],c=0;a.length>0&&(c=a[a.length-1]+1);const u=this.polylines,h=u.length;for(let d=0;d<h;++d){const p=u[d];p._locatorBuckets=[];let g;if(this.mode===Ie.SCENE3D){g=fge;const b=p._actualPositions.length;if(b>0)g[0]=b;else continue}else g=p._segments.lengths;const _=g.length;if(_>0){let b=0;for(let x=0;x<_;++x){const E=g[x]-1;for(let C=0;C<E;++C)c+4>R.SIXTY_FOUR_KILOBYTES&&(p._locatorBuckets.push({locator:s,count:b}),b=0,t.push(4),a=[],e.push(a),c=0,s.count=o,o=0,i=0,s=new wT(0,0,this),n[++r]=[s]),a.push(c,c+2,c+1),a.push(c+1,c+2,c+3),b+=6,o+=6,i+=6,c+=4}p._locatorBuckets.push({locator:s,count:b}),c+4>R.SIXTY_FOUR_KILOBYTES&&(t.push(0),a=[],e.push(a),c=0,s.count=o,i=0,o=0,s=new wT(0,0,this),n[++r]=[s])}p._clean()}return s.count=o,i};Da.prototype.getPolylineStartIndex=function(e){const t=this.polylines;let n=0;const i=t.length;for(let r=0;r<i;++r){const s=t[r];if(s===e)break;n+=s._actualLength}return n};const cf={positions:void 0,lengths:void 0},bO=new Array(1),hge=new m,dge=new oe;Da.prototype.getSegments=function(e,t){let n=e._actualPositions;if(this.mode===Ie.SCENE3D)return bO[0]=n.length,cf.positions=n,cf.lengths=bO,cf;oB(e)&&(n=e._segments.positions);const i=t.ellipsoid,r=[],s=this.modelMatrix,o=n.length;let a,c=hge;for(let u=0;u<o;++u)a=n[u],c=P.multiplyByPoint(s,a,c),r.push(t.project(i.cartesianToCartographic(c,dge)));if(r.length>0){e._boundingVolume2D=ee.fromPoints(r,e._boundingVolume2D);const u=e._boundingVolume2D.center;e._boundingVolume2D.center=new m(u.z,u.x,u.y)}return cf.positions=r,cf.lengths=e._segments.lengths,cf};let TO;Da.prototype.writeUpdate=function(e,t,n,i){const r=this.mode,s=i.ellipsoid.maximumRadius*R.PI;let o=t._actualLength;if(o){e+=this.getPolylineStartIndex(t);let a=TO;const c=6*o*3;!l(a)||a.length<c?a=TO=new Float32Array(c):a.length>c&&(a=new Float32Array(a.buffer,0,c));const u=this.getSegments(t,i),h=u.positions,d=u.lengths;let p=0,g=0,_=0,b;o=h.length;for(let x=0;x<o;++x){x===0?t._loop?b=h[o-2]:(b=cy,m.subtract(h[0],h[1],b),m.add(h[0],b,b)):b=h[x-1],m.clone(b,Hs),m.clone(h[x],_i),x===o-1?t._loop?b=h[1]:(b=cy,m.subtract(h[o-1],h[o-2],b),m.add(h[o-1],b,b)):b=h[x+1],m.clone(b,qs);const E=d[g];x===_+E&&(_+=E,++g);const C=x-_===0,w=x===_+d[g]-1;r===Ie.SCENE2D&&(Hs.z=0,_i.z=0,qs.z=0),(r===Ie.SCENE2D||r===Ie.MORPHING)&&(C||w)&&s-Math.abs(_i.x)<1&&((_i.x<0&&Hs.x>0||_i.x>0&&Hs.x<0)&&m.clone(_i,Hs),(_i.x<0&&qs.x>0||_i.x>0&&qs.x<0)&&m.clone(_i,qs));const S=C?2:0,v=w?2:4;for(let D=S;D<v;++D)Tn.writeElements(_i,a,p),Tn.writeElements(Hs,a,p+6),Tn.writeElements(qs,a,p+12),p+=6*3}n.copyFromArrayView(a,6*3*Float32Array.BYTES_PER_ELEMENT*e)}};function Pl(e){this._positions=e.positions,this._batchTable=e.batchTable,this._batchIds=e.batchIds,this._rectangle=e.rectangle,this._minHeight=e.minimumHeight,this._maxHeight=e.maximumHeight,this._billboardCollection=new cs({batchTable:e.batchTable}),this._labelCollection=new Uo({batchTable:e.batchTable}),this._polylineCollection=new ko,this._polylineCollection._useHighlightColor=!0,this._packedBuffer=void 0,this._ready=!1,this._promise=void 0,this._error=void 0}Object.defineProperties(Pl.prototype,{ready:{get:function(){return this._ready}},pointsLength:{get:function(){return this._billboardCollection.length}},texturesByteLength:{get:function(){const e=this._billboardCollection.textureAtlas.texture.sizeInBytes,t=this._labelCollection._textureAtlas.texture.sizeInBytes;return e+t}}});function pge(e,t){const n=e._rectangle,i=e._minHeight,r=e._maxHeight,s=2+ie.packedLength+fe.packedLength,o=new Float64Array(s);let a=0;return o[a++]=i,o[a++]=r,ie.pack(n,o,a),a+=ie.packedLength,fe.pack(t,o,a),o}const mge=new Dn("createVectorTilePoints",5),gge=new m;function _ge(e,t){let n=e._positions,i=e._packedBuffer;l(i)||(n=e._positions=n.slice(),e._batchIds=e._batchIds.slice(),i=e._packedBuffer=pge(e,t));const r=[n.buffer,i.buffer],s={positions:n.buffer,packedBuffer:i.buffer},o=mge.scheduleTask(s,r);if(l(o))return o.then(a=>{if(e.isDestroyed())return;e._positions=new Float64Array(a.positions);const c=e._billboardCollection,u=e._labelCollection,h=e._polylineCollection;n=e._positions;const d=e._batchIds,p=n.length/3;for(let g=0;g<p;++g){const _=d[g],b=m.unpack(n,g*3,gge),x=c.add();x.position=b,x._batchIndex=_;const E=u.add();E.text=" ",E.position=b,E._batchIndex=_;const C=h.add();C.positions=[m.clone(b),m.clone(b)]}e._positions=void 0,e._packedBuffer=void 0,e._ready=!0}).catch(a=>{e.isDestroyed()||(e._error=a)})}Pl.prototype.createFeatures=function(e,t){const n=this._billboardCollection,i=this._labelCollection,r=this._polylineCollection,s=this._batchIds,o=s.length;for(let a=0;a<o;++a){const c=s[a],u=n.get(a),h=i.get(a),d=r.get(a);t[c]=new ri(e,c,u,h,d)}};Pl.prototype.applyDebugSettings=function(e,t){e?(M.clone(t,this._billboardCollection._highlightColor),M.clone(t,this._labelCollection._highlightColor),M.clone(t,this._polylineCollection._highlightColor)):(M.clone(M.WHITE,this._billboardCollection._highlightColor),M.clone(M.WHITE,this._labelCollection._highlightColor),M.clone(M.WHITE,this._polylineCollection._highlightColor))};function yge(e,t){const n=e._batchIds,i=n.length;for(let r=0;r<i;++r){const s=n[r],o=t[s];o.show=!0,o.pointSize=ri.defaultPointSize,o.color=ri.defaultColor,o.pointOutlineColor=ri.defaultPointOutlineColor,o.pointOutlineWidth=ri.defaultPointOutlineWidth,o.labelColor=M.WHITE,o.labelOutlineColor=M.WHITE,o.labelOutlineWidth=1,o.font="30px sans-serif",o.labelStyle=oa.FILL,o.labelText=void 0,o.backgroundColor=new M(.165,.165,.165,.8),o.backgroundPadding=new k(7,5),o.backgroundEnabled=!1,o.scaleByDistance=void 0,o.translucencyByDistance=void 0,o.distanceDisplayCondition=void 0,o.heightOffset=0,o.anchorLineEnabled=!1,o.anchorLineColor=M.WHITE,o.image=void 0,o.disableDepthTestDistance=0,o.horizontalOrigin=As.CENTER,o.verticalOrigin=yn.CENTER,o.labelHorizontalOrigin=As.RIGHT,o.labelVerticalOrigin=yn.BASELINE}}const bge=new M,Tge=new M,xge=new M,Ege=new M,Cge=new M,wge=new M,Cd=new Bt,wd=new Bt,AT=new $n;Pl.prototype.applyStyle=function(e,t){if(!l(e)){yge(this,t);return}const n=this._batchIds,i=n.length;for(let r=0;r<i;++r){const s=n[r],o=t[s];if(l(e.show)&&(o.show=e.show.evaluate(o)),l(e.pointSize)&&(o.pointSize=e.pointSize.evaluate(o)),l(e.color)&&(o.color=e.color.evaluateColor(o,bge)),l(e.pointOutlineColor)&&(o.pointOutlineColor=e.pointOutlineColor.evaluateColor(o,Tge)),l(e.pointOutlineWidth)&&(o.pointOutlineWidth=e.pointOutlineWidth.evaluate(o)),l(e.labelColor)&&(o.labelColor=e.labelColor.evaluateColor(o,xge)),l(e.labelOutlineColor)&&(o.labelOutlineColor=e.labelOutlineColor.evaluateColor(o,Ege)),l(e.labelOutlineWidth)&&(o.labelOutlineWidth=e.labelOutlineWidth.evaluate(o)),l(e.font)&&(o.font=e.font.evaluate(o)),l(e.labelStyle)&&(o.labelStyle=e.labelStyle.evaluate(o)),l(e.labelText)?o.labelText=e.labelText.evaluate(o):o.labelText=void 0,l(e.backgroundColor)&&(o.backgroundColor=e.backgroundColor.evaluateColor(o,Cge)),l(e.backgroundPadding)&&(o.backgroundPadding=e.backgroundPadding.evaluate(o)),l(e.backgroundEnabled)&&(o.backgroundEnabled=e.backgroundEnabled.evaluate(o)),l(e.scaleByDistance)){const a=e.scaleByDistance.evaluate(o);l(a)?(Cd.near=a.x,Cd.nearValue=a.y,Cd.far=a.z,Cd.farValue=a.w,o.scaleByDistance=Cd):o.scaleByDistance=void 0}else o.scaleByDistance=void 0;if(l(e.translucencyByDistance)){const a=e.translucencyByDistance.evaluate(o);l(a)?(wd.near=a.x,wd.nearValue=a.y,wd.far=a.z,wd.farValue=a.w,o.translucencyByDistance=wd):o.translucencyByDistance=void 0}else o.translucencyByDistance=void 0;if(l(e.distanceDisplayCondition)){const a=e.distanceDisplayCondition.evaluate(o);l(a)?(AT.near=a.x,AT.far=a.y,o.distanceDisplayCondition=AT):o.distanceDisplayCondition=void 0}else o.distanceDisplayCondition=void 0;l(e.heightOffset)&&(o.heightOffset=e.heightOffset.evaluate(o)),l(e.anchorLineEnabled)&&(o.anchorLineEnabled=e.anchorLineEnabled.evaluate(o)),l(e.anchorLineColor)&&(o.anchorLineColor=e.anchorLineColor.evaluateColor(o,wge)),l(e.image)?o.image=e.image.evaluate(o):o.image=void 0,l(e.disableDepthTestDistance)&&(o.disableDepthTestDistance=e.disableDepthTestDistance.evaluate(o)),l(e.horizontalOrigin)&&(o.horizontalOrigin=e.horizontalOrigin.evaluate(o)),l(e.verticalOrigin)&&(o.verticalOrigin=e.verticalOrigin.evaluate(o)),l(e.labelHorizontalOrigin)&&(o.labelHorizontalOrigin=e.labelHorizontalOrigin.evaluate(o)),l(e.labelVerticalOrigin)&&(o.labelVerticalOrigin=e.labelVerticalOrigin.evaluate(o))}};Pl.prototype.update=function(e){if(!this._ready){if(l(this._promise)||(this._promise=_ge(this,e.mapProjection.ellipsoid)),l(this._error)){const t=this._error;throw this._error=void 0,t}return}this._polylineCollection.update(e),this._billboardCollection.update(e),this._labelCollection.update(e)};Pl.prototype.isDestroyed=function(){return!1};Pl.prototype.destroy=function(){return this._billboardCollection=this._billboardCollection&&this._billboardCollection.destroy(),this._labelCollection=this._labelCollection&&this._labelCollection.destroy(),this._polylineCollection=this._polylineCollection&&this._polylineCollection.destroy(),Ye(this)};function yc(e){this._batchTable=e.batchTable,this._batchIds=e.batchIds,this._positions=e.positions,this._counts=e.counts,this._indices=e.indices,this._indexCounts=e.indexCounts,this._indexOffsets=void 0,this._batchTableColors=void 0,this._packedBuffer=void 0,this._batchedPositions=void 0,this._transferrableBatchIds=void 0,this._vertexBatchIds=void 0,this._ellipsoid=T(e.ellipsoid,fe.WGS84),this._minimumHeight=e.minimumHeight,this._maximumHeight=e.maximumHeight,this._polygonMinimumHeights=e.polygonMinimumHeights,this._polygonMaximumHeights=e.polygonMaximumHeights,this._center=T(e.center,m.ZERO),this._rectangle=e.rectangle,this._center=void 0,this._boundingVolume=e.boundingVolume,this._boundingVolumes=void 0,this._batchedIndices=void 0,this._ready=!1,this._promise=void 0,this._error=void 0,this._primitive=void 0,this.debugWireframe=!1,this.forceRebatch=!1,this.classificationType=Ks.BOTH}Object.defineProperties(yc.prototype,{trianglesLength:{get:function(){return l(this._primitive)?this._primitive.trianglesLength:0}},geometryByteLength:{get:function(){return l(this._primitive)?this._primitive.geometryByteLength:0}},ready:{get:function(){return this._ready}}});function Age(e){const t=new Float64Array(3+m.packedLength+fe.packedLength+ie.packedLength);let n=0;return t[n++]=e._indices.BYTES_PER_ELEMENT,t[n++]=e._minimumHeight,t[n++]=e._maximumHeight,m.pack(e._center,t,n),n+=m.packedLength,fe.pack(e._ellipsoid,t,n),n+=fe.packedLength,ie.pack(e._rectangle,t,n),t}function Sge(e,t){let n=1;const i=t[n++],r=e._boundingVolumes=new Array(i);for(let a=0;a<i;++a)r[a]=st.unpack(t,n),n+=st.packedLength;const s=t[n++],o=e._batchedIndices=new Array(s);for(let a=0;a<s;++a){const c=M.unpack(t,n);n+=M.packedLength;const u=t[n++],h=t[n++],d=t[n++],p=new Array(d);for(let g=0;g<d;++g)p[g]=t[n++];o[a]=new Y_({color:c,offset:u,count:h,batchIds:p})}}const vge=new Dn("createVectorTilePolygons",5),Ige=new M;function Oge(e){if(l(e._primitive))return;let t=e._positions,n=e._counts,i=e._indexCounts,r=e._indices,s=e._transferrableBatchIds,o=e._batchTableColors,a=e._packedBuffer;if(!l(o)){t=e._positions=e._positions.slice(),n=e._counts=e._counts.slice(),i=e._indexCounts=e._indexCounts.slice(),r=e._indices=e._indices.slice(),e._center=e._ellipsoid.cartographicToCartesian(ie.center(e._rectangle)),s=e._transferrableBatchIds=new Uint32Array(e._batchIds),o=e._batchTableColors=new Uint32Array(s.length);const g=e._batchTable,_=o.length;for(let b=0;b<_;++b){const x=g.getColor(b,Ige);o[b]=x.toRgba()}a=e._packedBuffer=Age(e)}const c=[t.buffer,n.buffer,i.buffer,r.buffer,s.buffer,o.buffer,a.buffer],u={packedBuffer:a.buffer,positions:t.buffer,counts:n.buffer,indexCounts:i.buffer,indices:r.buffer,batchIds:s.buffer,batchTableColors:o.buffer};let h=e._polygonMinimumHeights,d=e._polygonMaximumHeights;l(h)&&l(d)&&(h=h.slice(),d=d.slice(),c.push(h.buffer,d.buffer),u.minimumHeights=h,u.maximumHeights=d);const p=vge.scheduleTask(u,c);if(l(p))return p.then(g=>{if(e.isDestroyed())return;e._positions=void 0,e._counts=void 0,e._polygonMinimumHeights=void 0,e._polygonMaximumHeights=void 0;const _=new Float64Array(g.packedBuffer),b=_[0];Sge(e,_),e._indices=Ge.getSizeInBytes(b)===2?new Uint16Array(g.indices):new Uint32Array(g.indices),e._indexOffsets=new Uint32Array(g.indexOffsets),e._indexCounts=new Uint32Array(g.indexCounts),e._batchedPositions=new Float32Array(g.positions),e._vertexBatchIds=new Uint16Array(g.batchIds),Rge(e),e._ready=!0}).catch(g=>{e.isDestroyed()||(e._error=g)})}function Rge(e){l(e._primitive)||(e._primitive=new Sa({batchTable:e._batchTable,positions:e._batchedPositions,batchIds:e._batchIds,vertexBatchIds:e._vertexBatchIds,indices:e._indices,indexOffsets:e._indexOffsets,indexCounts:e._indexCounts,batchedIndices:e._batchedIndices,boundingVolume:e._boundingVolume,boundingVolumes:e._boundingVolumes,center:e._center}),e._batchTable=void 0,e._batchIds=void 0,e._positions=void 0,e._counts=void 0,e._indices=void 0,e._indexCounts=void 0,e._indexOffsets=void 0,e._batchTableColors=void 0,e._packedBuffer=void 0,e._batchedPositions=void 0,e._transferrableBatchIds=void 0,e._vertexBatchIds=void 0,e._ellipsoid=void 0,e._minimumHeight=void 0,e._maximumHeight=void 0,e._polygonMinimumHeights=void 0,e._polygonMaximumHeights=void 0,e._center=void 0,e._rectangle=void 0,e._boundingVolume=void 0,e._boundingVolumes=void 0,e._batchedIndices=void 0)}yc.prototype.createFeatures=function(e,t){this._primitive.createFeatures(e,t)};yc.prototype.applyDebugSettings=function(e,t){this._primitive.applyDebugSettings(e,t)};yc.prototype.applyStyle=function(e,t){this._primitive.applyStyle(e,t)};yc.prototype.updateCommands=function(e,t){this._primitive.updateCommands(e,t)};yc.prototype.update=function(e){if(!this._ready){if(l(this._promise)||(this._promise=Oge(this)),l(this._error)){const t=this._error;throw this._error=void 0,t}return}this._primitive.debugWireframe=this.debugWireframe,this._primitive.forceRebatch=this.forceRebatch,this._primitive.classificationType=this.classificationType,this._primitive.update(e)};yc.prototype.isDestroyed=function(){return!1};yc.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),Ye(this)};const Dge=`in vec4 currentPosition;
in vec4 previousPosition;
in vec4 nextPosition;
in vec2 expandAndWidth;
in float a_batchId;

uniform mat4 u_modifiedModelView;

void main()
{
    float expandDir = expandAndWidth.x;
    float width = abs(expandAndWidth.y) + 0.5;
    bool usePrev = expandAndWidth.y < 0.0;

    vec4 p = u_modifiedModelView * currentPosition;
    vec4 prev = u_modifiedModelView * previousPosition;
    vec4 next = u_modifiedModelView * nextPosition;

    float angle;
    vec4 positionWC = getPolylineWindowCoordinatesEC(p, prev, next, expandDir, width, usePrev, angle);
    gl_Position = czm_viewportOrthographic * positionWC;
}
`;function ao(e){this._positions=e.positions,this._widths=e.widths,this._counts=e.counts,this._batchIds=e.batchIds,this._ellipsoid=T(e.ellipsoid,fe.WGS84),this._minimumHeight=e.minimumHeight,this._maximumHeight=e.maximumHeight,this._center=e.center,this._rectangle=e.rectangle,this._boundingVolume=e.boundingVolume,this._batchTable=e.batchTable,this._va=void 0,this._sp=void 0,this._rs=void 0,this._uniformMap=void 0,this._command=void 0,this._transferrableBatchIds=void 0,this._packedBuffer=void 0,this._keepDecodedPositions=e.keepDecodedPositions,this._decodedPositions=void 0,this._decodedPositionOffsets=void 0,this._currentPositions=void 0,this._previousPositions=void 0,this._nextPositions=void 0,this._expandAndWidth=void 0,this._vertexBatchIds=void 0,this._indices=void 0,this._constantColor=M.clone(M.WHITE),this._highlightColor=this._constantColor,this._trianglesLength=0,this._geometryByteLength=0,this._ready=!1,this._promise=void 0,this._error=void 0}Object.defineProperties(ao.prototype,{trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},ready:{get:function(){return this._ready}}});function Mge(e){const t=e._rectangle,n=e._minimumHeight,i=e._maximumHeight,r=e._ellipsoid,s=e._center,o=2+ie.packedLength+fe.packedLength+m.packedLength,a=new Float64Array(o);let c=0;return a[c++]=n,a[c++]=i,ie.pack(t,a,c),c+=ie.packedLength,fe.pack(r,a,c),c+=fe.packedLength,m.pack(s,a,c),a}const Lge=new Dn("createVectorTilePolylines",5),Tf={previousPosition:0,currentPosition:1,nextPosition:2,expandAndWidth:3,a_batchId:4};function Pge(e,t){if(l(e._va))return;let n=e._positions,i=e._widths,r=e._counts,s=e._transferrableBatchIds,o=e._packedBuffer;l(o)||(n=e._positions=n.slice(),i=e._widths=i.slice(),r=e._counts=r.slice(),s=e._transferrableBatchIds=e._batchIds.slice(),o=e._packedBuffer=Mge(e));const a=[n.buffer,i.buffer,r.buffer,s.buffer,o.buffer],c={positions:n.buffer,widths:i.buffer,counts:r.buffer,batchIds:s.buffer,packedBuffer:o.buffer,keepDecodedPositions:e._keepDecodedPositions},u=Lge.scheduleTask(c,a);if(l(u))return u.then(function(h){if(e.isDestroyed())return;e._keepDecodedPositions&&(e._decodedPositions=new Float64Array(h.decodedPositions),e._decodedPositionOffsets=new Uint32Array(h.decodedPositionOffsets)),e._currentPositions=new Float32Array(h.currentPositions),e._previousPositions=new Float32Array(h.previousPositions),e._nextPositions=new Float32Array(h.nextPositions),e._expandAndWidth=new Float32Array(h.expandAndWidth),e._vertexBatchIds=new Uint16Array(h.batchIds);const d=h.indexDatatype;e._indices=d===Ge.UNSIGNED_SHORT?new Uint16Array(h.indices):new Uint32Array(h.indices),Nge(e,t),e._ready=!0}).catch(h=>{e.isDestroyed()||(e._error=h)})}function Nge(e,t){if(!l(e._va)){const n=e._currentPositions,i=e._previousPositions,r=e._nextPositions,s=e._expandAndWidth,o=e._vertexBatchIds,a=e._indices;let c=i.byteLength+n.byteLength+r.byteLength;c+=s.byteLength+o.byteLength+a.byteLength,e._trianglesLength=a.length/3,e._geometryByteLength=c;const u=ze.createVertexBuffer({context:t,typedArray:i,usage:Ae.STATIC_DRAW}),h=ze.createVertexBuffer({context:t,typedArray:n,usage:Ae.STATIC_DRAW}),d=ze.createVertexBuffer({context:t,typedArray:r,usage:Ae.STATIC_DRAW}),p=ze.createVertexBuffer({context:t,typedArray:s,usage:Ae.STATIC_DRAW}),g=ze.createVertexBuffer({context:t,typedArray:o,usage:Ae.STATIC_DRAW}),_=ze.createIndexBuffer({context:t,typedArray:a,usage:Ae.STATIC_DRAW,indexDatatype:a.BYTES_PER_ELEMENT===2?Ge.UNSIGNED_SHORT:Ge.UNSIGNED_INT}),b=[{index:Tf.previousPosition,vertexBuffer:u,componentDatatype:q.FLOAT,componentsPerAttribute:3},{index:Tf.currentPosition,vertexBuffer:h,componentDatatype:q.FLOAT,componentsPerAttribute:3},{index:Tf.nextPosition,vertexBuffer:d,componentDatatype:q.FLOAT,componentsPerAttribute:3},{index:Tf.expandAndWidth,vertexBuffer:p,componentDatatype:q.FLOAT,componentsPerAttribute:2},{index:Tf.a_batchId,vertexBuffer:g,componentDatatype:q.UNSIGNED_SHORT,componentsPerAttribute:1}];e._va=new $i({context:t,attributes:b,indexBuffer:_}),e._positions=void 0,e._widths=void 0,e._counts=void 0,e._ellipsoid=void 0,e._minimumHeight=void 0,e._maximumHeight=void 0,e._rectangle=void 0,e._transferrableBatchIds=void 0,e._packedBuffer=void 0,e._currentPositions=void 0,e._previousPositions=void 0,e._nextPositions=void 0,e._expandAndWidth=void 0,e._vertexBatchIds=void 0,e._indices=void 0}}const Ad=new P,xO=new m;function Fge(e,t){l(e._uniformMap)||(e._uniformMap={u_modifiedModelView:function(){const n=t.uniformState.view;return P.clone(n,Ad),P.multiplyByPoint(Ad,e._center,xO),P.setTranslation(Ad,xO,Ad),Ad},u_highlightColor:function(){return e._highlightColor}})}function Bge(e){if(l(e._rs))return;const t={enabled:!0,factor:-5,units:-5};e._rs=it.fromCache({blending:vs.ALPHA_BLEND,depthMask:!1,depthTest:{enabled:!0},polygonOffset:t})}const zge=`uniform vec4 u_highlightColor; 
void main()
{
    out_FragColor = u_highlightColor;
}
`;function Uge(e,t){if(l(e._sp))return;const n=e._batchTable,i=n.getVertexShaderCallback(!1,"a_batchId",void 0)(Dge),r=n.getFragmentShaderCallback(!1,void 0,!1)(zge),s=new Je({defines:["VECTOR_TILE",It.isInternetExplorer()?"":"CLIP_POLYLINE"],sources:[lw,i]}),o=new Je({defines:["VECTOR_TILE"],sources:[r]});e._sp=kn.fromCache({context:t,vertexShaderSource:s,fragmentShaderSource:o,attributeLocations:Tf})}function kge(e,t){if(!l(e._command)){const n=e._batchTable.getUniformMapCallback()(e._uniformMap);e._command=new Tt({owner:e,vertexArray:e._va,renderState:e._rs,shaderProgram:e._sp,uniformMap:n,boundingVolume:e._boundingVolume,pass:Ke.TRANSLUCENT,pickId:e._batchTable.getPickId()})}t.commandList.push(e._command)}ao.getPolylinePositions=function(e,t){const n=e._batchIds,i=e._decodedPositions,r=e._decodedPositionOffsets;if(!l(n)||!l(i))return;let s,o;const a=n.length;let c=0,u=0;for(s=0;s<a;++s)n[s]===t&&(c+=r[s+1]-r[s]);if(c===0)return;const h=new Float64Array(c*3);for(s=0;s<a;++s)if(n[s]===t){const d=r[s],p=r[s+1]-d;for(o=0;o<p;++o){const g=(d+o)*3;h[u++]=i[g],h[u++]=i[g+1],h[u++]=i[g+2]}}return h};ao.prototype.getPositions=function(e){return ao.getPolylinePositions(this,e)};ao.prototype.createFeatures=function(e,t){const n=this._batchIds,i=n.length;for(let r=0;r<i;++r){const s=n[r];t[s]=new vr(e,s)}};ao.prototype.applyDebugSettings=function(e,t){this._highlightColor=e?t:this._constantColor};function jge(e,t){const n=e._batchIds,i=n.length;for(let r=0;r<i;++r){const s=n[r],o=t[s];o.show=!0,o.color=M.WHITE}}const Vge=new M,Gge=M.WHITE,Hge=!0;ao.prototype.applyStyle=function(e,t){if(!l(e)){jge(this,t);return}const n=this._batchIds,i=n.length;for(let r=0;r<i;++r){const s=n[r],o=t[s];o.color=l(e.color)?e.color.evaluateColor(o,Vge):Gge,o.show=l(e.show)?e.show.evaluate(o):Hge}};ao.prototype.update=function(e){const t=e.context;if(!this._ready){if(l(this._promise)||(this._promise=Pge(this,t)),l(this._error)){const i=this._error;throw this._error=void 0,i}return}Fge(this,t),Uge(this,t),Bge(this);const n=e.passes;(n.render||n.pick)&&kge(this,e)};ao.prototype.isDestroyed=function(){return!1};ao.prototype.destroy=function(){return this._va=this._va&&this._va.destroy(),this._sp=this._sp&&this._sp.destroy(),Ye(this)};const qge=`in vec3 startEllipsoidNormal;
in vec3 endEllipsoidNormal;
in vec4 startPositionAndHeight;
in vec4 endPositionAndHeight;
in vec4 startFaceNormalAndVertexCorner;
in vec4 endFaceNormalAndHalfWidth;
in float a_batchId;

uniform mat4 u_modifiedModelView;
uniform vec2 u_minimumMaximumVectorHeights;

out vec4 v_startPlaneEC;
out vec4 v_endPlaneEC;
out vec4 v_rightPlaneEC;
out float v_halfWidth;
out vec3 v_volumeUpEC;

void main()
{
    // vertex corner IDs
    //          3-----------7
    //         /|   left   /|
    //        / | 1       / |
    //       2-----------6  5  end
    //       | /         | /
    // start |/  right   |/
    //       0-----------4
    //
    float isEnd = floor(startFaceNormalAndVertexCorner.w * 0.251); // 0 for front, 1 for end
    float isTop = floor(startFaceNormalAndVertexCorner.w * mix(0.51, 0.19, isEnd)); // 0 for bottom, 1 for top

    vec3 forward = endPositionAndHeight.xyz - startPositionAndHeight.xyz;
    vec3 right = normalize(cross(forward, startEllipsoidNormal));

    vec4 position = vec4(startPositionAndHeight.xyz, 1.0);
    position.xyz += forward * isEnd;

    v_volumeUpEC = czm_normal * normalize(cross(right, forward));

    // Push for volume height
    float offset;
    vec3 ellipsoidNormal = mix(startEllipsoidNormal, endEllipsoidNormal, isEnd);

    // offset height to create volume
    offset = mix(startPositionAndHeight.w, endPositionAndHeight.w, isEnd);
    offset = mix(u_minimumMaximumVectorHeights.y, u_minimumMaximumVectorHeights.x, isTop) - offset;
    position.xyz += offset * ellipsoidNormal;

    // move from RTC to EC
    position = u_modifiedModelView * position;
    right = czm_normal * right;

    // Push for width in a direction that is in the start or end plane and in a plane with right
    // N = normalEC ("right-facing" direction for push)
    // R = right
    // p = angle between N and R
    // w = distance to push along R if R == N
    // d = distance to push along N
    //
    //   N   R
    //  {  p| }      * cos(p) = dot(N, R) = w / d
    //  d  |  |w    * d = w / dot(N, R)
    //    { | }
    //       o---------- polyline segment ---->
    //
    vec3 scratchNormal = mix(-startFaceNormalAndVertexCorner.xyz, endFaceNormalAndHalfWidth.xyz, isEnd);
    scratchNormal = cross(scratchNormal, mix(startEllipsoidNormal, endEllipsoidNormal, isEnd));
    vec3 miterPushNormal = czm_normal * normalize(scratchNormal);

    offset = 2.0 * endFaceNormalAndHalfWidth.w * max(0.0, czm_metersPerPixel(position)); // offset = widthEC
    offset = offset / dot(miterPushNormal, right);
    position.xyz += miterPushNormal * (offset * sign(0.5 - mod(startFaceNormalAndVertexCorner.w, 2.0)));

    gl_Position = czm_depthClamp(czm_projection * position);

    position = u_modifiedModelView * vec4(startPositionAndHeight.xyz, 1.0);
    vec3 startNormalEC = czm_normal * startFaceNormalAndVertexCorner.xyz;
    v_startPlaneEC = vec4(startNormalEC, -dot(startNormalEC, position.xyz));
    v_rightPlaneEC = vec4(right, -dot(right, position.xyz));

    position = u_modifiedModelView * vec4(endPositionAndHeight.xyz, 1.0);
    vec3 endNormalEC = czm_normal * endFaceNormalAndHalfWidth.xyz;
    v_endPlaneEC = vec4(endNormalEC, -dot(endNormalEC, position.xyz));
    v_halfWidth = endFaceNormalAndHalfWidth.w;
}
`,Wge=`in vec4 v_startPlaneEC;
in vec4 v_endPlaneEC;
in vec4 v_rightPlaneEC;
in float v_halfWidth;
in vec3 v_volumeUpEC;

uniform vec4 u_highlightColor;
void main()
{
    float logDepthOrDepth = czm_branchFreeTernary(czm_sceneMode == czm_sceneMode2D, gl_FragCoord.z, czm_unpackDepth(texture(czm_globeDepthTexture, gl_FragCoord.xy / czm_viewport.zw)));

    // Discard for sky
    if (logDepthOrDepth == 0.0) {
#ifdef DEBUG_SHOW_VOLUME
        out_FragColor = vec4(0.0, 0.0, 1.0, 0.5);
        return;
#else // DEBUG_SHOW_VOLUME
        discard;
#endif // DEBUG_SHOW_VOLUME
    }

    vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth);
    eyeCoordinate /= eyeCoordinate.w;

    float halfMaxWidth = v_halfWidth * czm_metersPerPixel(eyeCoordinate);

    // Expand halfMaxWidth if direction to camera is almost perpendicular with the volume's up direction
    halfMaxWidth += halfMaxWidth * (1.0 - dot(-normalize(eyeCoordinate.xyz), v_volumeUpEC));

    // Check distance of the eye coordinate against the right-facing plane
    float widthwiseDistance = czm_planeDistance(v_rightPlaneEC, eyeCoordinate.xyz);

    // Check eye coordinate against the mitering planes
    float distanceFromStart = czm_planeDistance(v_startPlaneEC, eyeCoordinate.xyz);
    float distanceFromEnd = czm_planeDistance(v_endPlaneEC, eyeCoordinate.xyz);

    if (abs(widthwiseDistance) > halfMaxWidth || distanceFromStart < 0.0 || distanceFromEnd < 0.0) {
#ifdef DEBUG_SHOW_VOLUME
        out_FragColor = vec4(logDepthOrDepth, 0.0, 0.0, 0.5);
        return;
#else // DEBUG_SHOW_VOLUME
        discard;
#endif // DEBUG_SHOW_VOLUME
    }
    out_FragColor = u_highlightColor;

    czm_writeDepthClamp();
}
`;function bc(e){this._positions=e.positions,this._widths=e.widths,this._counts=e.counts,this._batchIds=e.batchIds,this._ellipsoid=T(e.ellipsoid,fe.WGS84),this._minimumHeight=e.minimumHeight,this._maximumHeight=e.maximumHeight,this._center=e.center,this._rectangle=e.rectangle,this._batchTable=e.batchTable,this._va=void 0,this._sp=void 0,this._rs=void 0,this._uniformMap=void 0,this._command=void 0,this._transferrableBatchIds=void 0,this._packedBuffer=void 0,this._minimumMaximumVectorHeights=new k(on._defaultMinTerrainHeight,on._defaultMaxTerrainHeight),this._boundingVolume=st.fromRectangle(e.rectangle,on._defaultMinTerrainHeight,on._defaultMaxTerrainHeight,this._ellipsoid),this._classificationType=e.classificationType,this._keepDecodedPositions=e.keepDecodedPositions,this._decodedPositions=void 0,this._decodedPositionOffsets=void 0,this._startEllipsoidNormals=void 0,this._endEllipsoidNormals=void 0,this._startPositionAndHeights=void 0,this._startFaceNormalAndVertexCornerIds=void 0,this._endPositionAndHeights=void 0,this._endFaceNormalAndHalfWidths=void 0,this._vertexBatchIds=void 0,this._indices=void 0,this._constantColor=M.clone(M.WHITE),this._highlightColor=this._constantColor,this._trianglesLength=0,this._geometryByteLength=0,this._ready=!1,this._promise=void 0,this._error=void 0}Object.defineProperties(bc.prototype,{trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},ready:{get:function(){return this._ready}}});function $ge(e,t,n){const i=on.getMinimumMaximumHeights(t,n),r=i.minimumTerrainHeight,s=i.maximumTerrainHeight,o=e._minimumMaximumVectorHeights;o.x=r,o.y=s;const a=e._boundingVolume,c=e._rectangle;st.fromRectangle(c,r,s,n,a)}function Xge(e){const t=e._rectangle,n=e._minimumHeight,i=e._maximumHeight,r=e._ellipsoid,s=e._center,o=2+ie.packedLength+fe.packedLength+m.packedLength,a=new Float64Array(o);let c=0;return a[c++]=n,a[c++]=i,ie.pack(t,a,c),c+=ie.packedLength,fe.pack(r,a,c),c+=fe.packedLength,m.pack(s,a,c),a}const Yge=new Dn("createVectorTileClampedPolylines"),Vc={startEllipsoidNormal:0,endEllipsoidNormal:1,startPositionAndHeight:2,endPositionAndHeight:3,startFaceNormalAndVertexCorner:4,endFaceNormalAndHalfWidth:5,a_batchId:6};function Kge(e,t){if(l(e._va))return;let n=e._positions,i=e._widths,r=e._counts,s=e._transferrableBatchIds,o=e._packedBuffer;l(o)||(n=e._positions=n.slice(),i=e._widths=i.slice(),r=e._counts=r.slice(),s=e._transferrableBatchIds=e._batchIds.slice(),o=e._packedBuffer=Xge(e));const a=[n.buffer,i.buffer,r.buffer,s.buffer,o.buffer],c={positions:n.buffer,widths:i.buffer,counts:r.buffer,batchIds:s.buffer,packedBuffer:o.buffer,keepDecodedPositions:e._keepDecodedPositions},u=Yge.scheduleTask(c,a);if(l(u))return u.then(function(h){if(e.isDestroyed())return;e._keepDecodedPositions&&(e._decodedPositions=new Float64Array(h.decodedPositions),e._decodedPositionOffsets=new Uint32Array(h.decodedPositionOffsets)),e._startEllipsoidNormals=new Float32Array(h.startEllipsoidNormals),e._endEllipsoidNormals=new Float32Array(h.endEllipsoidNormals),e._startPositionAndHeights=new Float32Array(h.startPositionAndHeights),e._startFaceNormalAndVertexCornerIds=new Float32Array(h.startFaceNormalAndVertexCornerIds),e._endPositionAndHeights=new Float32Array(h.endPositionAndHeights),e._endFaceNormalAndHalfWidths=new Float32Array(h.endFaceNormalAndHalfWidths),e._vertexBatchIds=new Uint16Array(h.vertexBatchIds);const d=h.indexDatatype;e._indices=d===Ge.UNSIGNED_SHORT?new Uint16Array(h.indices):new Uint32Array(h.indices),Zge(e,t),e._ready=!0}).catch(h=>{e.isDestroyed()||(e._error=h)})}function Zge(e,t){if(!l(e._va)){const n=e._startEllipsoidNormals,i=e._endEllipsoidNormals,r=e._startPositionAndHeights,s=e._endPositionAndHeights,o=e._startFaceNormalAndVertexCornerIds,a=e._endFaceNormalAndHalfWidths,c=e._vertexBatchIds,u=e._indices;let h=n.byteLength+i.byteLength;h+=r.byteLength+s.byteLength,h+=o.byteLength+a.byteLength,h+=c.byteLength+u.byteLength,e._trianglesLength=u.length/3,e._geometryByteLength=h;const d=ze.createVertexBuffer({context:t,typedArray:n,usage:Ae.STATIC_DRAW}),p=ze.createVertexBuffer({context:t,typedArray:i,usage:Ae.STATIC_DRAW}),g=ze.createVertexBuffer({context:t,typedArray:r,usage:Ae.STATIC_DRAW}),_=ze.createVertexBuffer({context:t,typedArray:s,usage:Ae.STATIC_DRAW}),b=ze.createVertexBuffer({context:t,typedArray:o,usage:Ae.STATIC_DRAW}),x=ze.createVertexBuffer({context:t,typedArray:a,usage:Ae.STATIC_DRAW}),E=ze.createVertexBuffer({context:t,typedArray:c,usage:Ae.STATIC_DRAW}),C=ze.createIndexBuffer({context:t,typedArray:u,usage:Ae.STATIC_DRAW,indexDatatype:u.BYTES_PER_ELEMENT===2?Ge.UNSIGNED_SHORT:Ge.UNSIGNED_INT}),w=[{index:Vc.startEllipsoidNormal,vertexBuffer:d,componentDatatype:q.FLOAT,componentsPerAttribute:3},{index:Vc.endEllipsoidNormal,vertexBuffer:p,componentDatatype:q.FLOAT,componentsPerAttribute:3},{index:Vc.startPositionAndHeight,vertexBuffer:g,componentDatatype:q.FLOAT,componentsPerAttribute:4},{index:Vc.endPositionAndHeight,vertexBuffer:_,componentDatatype:q.FLOAT,componentsPerAttribute:4},{index:Vc.startFaceNormalAndVertexCorner,vertexBuffer:b,componentDatatype:q.FLOAT,componentsPerAttribute:4},{index:Vc.endFaceNormalAndHalfWidth,vertexBuffer:x,componentDatatype:q.FLOAT,componentsPerAttribute:4},{index:Vc.a_batchId,vertexBuffer:E,componentDatatype:q.UNSIGNED_SHORT,componentsPerAttribute:1}];e._va=new $i({context:t,attributes:w,indexBuffer:C}),e._positions=void 0,e._widths=void 0,e._counts=void 0,e._ellipsoid=void 0,e._minimumHeight=void 0,e._maximumHeight=void 0,e._rectangle=void 0,e._transferrableBatchIds=void 0,e._packedBuffer=void 0,e._startEllipsoidNormals=void 0,e._endEllipsoidNormals=void 0,e._startPositionAndHeights=void 0,e._startFaceNormalAndVertexCornerIds=void 0,e._endPositionAndHeights=void 0,e._endFaceNormalAndHalfWidths=void 0,e._vertexBatchIds=void 0,e._indices=void 0}}const Sd=new P,EO=new m;function Jge(e,t){l(e._uniformMap)||(e._uniformMap={u_modifiedModelView:function(){const n=t.uniformState.view;return P.clone(n,Sd),P.multiplyByPoint(Sd,e._center,EO),P.setTranslation(Sd,EO,Sd),Sd},u_highlightColor:function(){return e._highlightColor},u_minimumMaximumVectorHeights:function(){return e._minimumMaximumVectorHeights}})}function CO(e){return it.fromCache({cull:{enabled:!0,face:wo.FRONT},blending:vs.PRE_MULTIPLIED_ALPHA_BLEND,depthMask:!1,stencilTest:{enabled:e,frontFunction:Ei.EQUAL,frontOperation:{fail:Qe.KEEP,zFail:Qe.KEEP,zPass:Qe.KEEP},backFunction:Ei.EQUAL,backOperation:{fail:Qe.KEEP,zFail:Qe.KEEP,zPass:Qe.KEEP},reference:yt.CESIUM_3D_TILE_MASK,mask:yt.CESIUM_3D_TILE_MASK}})}function Qge(e){l(e._rs)||(e._rs=CO(!1),e._rs3DTiles=CO(!0))}function e_e(e,t){if(l(e._sp))return;const n=e._batchTable,i=n.getVertexShaderCallback(!1,"a_batchId",void 0)(qge),r=n.getFragmentShaderCallback(!1,void 0,!0)(Wge),s=new Je({defines:["VECTOR_TILE",It.isInternetExplorer()?"":"CLIP_POLYLINE"],sources:[lw,i]}),o=new Je({defines:["VECTOR_TILE"],sources:[r]});e._sp=kn.fromCache({context:t,vertexShaderSource:s,fragmentShaderSource:o,attributeLocations:Vc})}function t_e(e,t){let n=e._command;if(!l(e._command)){const r=e._batchTable.getUniformMapCallback()(e._uniformMap);n=e._command=new Tt({owner:e,vertexArray:e._va,renderState:e._rs,shaderProgram:e._sp,uniformMap:r,boundingVolume:e._boundingVolume,pass:Ke.TERRAIN_CLASSIFICATION,pickId:e._batchTable.getPickId()});const s=Tt.shallowClone(n,n.derivedCommands.tileset);s.renderState=e._rs3DTiles,s.pass=Ke.CESIUM_3D_TILE_CLASSIFICATION,n.derivedCommands.tileset=s}const i=e._classificationType;(i===Ks.TERRAIN||i===Ks.BOTH)&&t.commandList.push(n),(i===Ks.CESIUM_3D_TILE||i===Ks.BOTH)&&t.commandList.push(n.derivedCommands.tileset)}bc.prototype.getPositions=function(e){return ao.getPolylinePositions(this,e)};bc.prototype.createFeatures=function(e,t){const n=this._batchIds,i=n.length;for(let r=0;r<i;++r){const s=n[r];t[s]=new vr(e,s)}};bc.prototype.applyDebugSettings=function(e,t){this._highlightColor=e?t:this._constantColor};function n_e(e,t){const n=e._batchIds,i=n.length;for(let r=0;r<i;++r){const s=n[r],o=t[s];o.show=!0,o.color=M.WHITE}}const i_e=new M,r_e=M.WHITE,s_e=!0;bc.prototype.applyStyle=function(e,t){if(!l(e)){n_e(this,t);return}const n=this._batchIds,i=n.length;for(let r=0;r<i;++r){const s=n[r],o=t[s];o.color=l(e.color)?e.color.evaluateColor(o,i_e):r_e,o.show=l(e.show)?e.show.evaluate(o):s_e}};function o_e(e){return on.initialize().then(function(){$ge(e,e._rectangle,e._ellipsoid)}).catch(t=>{e.isDestroyed()||(e._error=t)})}bc.prototype.update=function(e){const t=e.context;if(!this._ready){if(l(this._promise)||(this._promise=o_e(this).then(Kge(this,t))),l(this._error)){const i=this._error;throw this._error=void 0,i}return}Jge(this,t),e_e(this,t),Qge(this);const n=e.passes;(n.render||n.pick)&&t_e(this,e)};bc.prototype.isDestroyed=function(){return!1};bc.prototype.destroy=function(){return this._va=this._va&&this._va.destroy(),this._sp=this._sp&&this._sp.destroy(),Ye(this)};function jo(e,t,n,i,r){this._tileset=e,this._tile=t,this._resource=n,this._polygons=void 0,this._polylines=void 0,this._points=void 0,this._metadata=void 0,this._batchTable=void 0,this._features=void 0,this.featurePropertiesDirty=!1,this._group=void 0,this._ready=!1,f_e(this,i,r)}Object.defineProperties(jo.prototype,{featuresLength:{get:function(){return l(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return l(this._points)?this._points.pointsLength:0}},trianglesLength:{get:function(){let e=0;return l(this._polygons)&&(e+=this._polygons.trianglesLength),l(this._polylines)&&(e+=this._polylines.trianglesLength),e}},geometryByteLength:{get:function(){let e=0;return l(this._polygons)&&(e+=this._polygons.geometryByteLength),l(this._polylines)&&(e+=this._polylines.geometryByteLength),e}},texturesByteLength:{get:function(){return l(this._points)?this._points.texturesByteLength:0}},batchTableByteLength:{get:function(){return l(this._batchTable)?this._batchTable.batchTableByteLength:0}},innerContents:{get:function(){}},ready:{get:function(){return this._ready}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},metadata:{get:function(){return this._metadata},set:function(e){this._metadata=e}},batchTable:{get:function(){return this._batchTable}},group:{get:function(){return this._group},set:function(e){this._group=e}}});function a_e(e){return function(t,n){l(e._polygons)&&e._polygons.updateCommands(t,n)}}function c_e(e,t){let n,i,r,s;const o=T(e.POLYGONS_LENGTH,0),a=T(e.POLYLINES_LENGTH,0),c=T(e.POINTS_LENGTH,0);if(o>0&&l(e.POLYGON_BATCH_IDS)){const p=t.byteOffset+e.POLYGON_BATCH_IDS.byteOffset;n=new Uint16Array(t.buffer,p,o)}if(a>0&&l(e.POLYLINE_BATCH_IDS)){const p=t.byteOffset+e.POLYLINE_BATCH_IDS.byteOffset;i=new Uint16Array(t.buffer,p,a)}if(c>0&&l(e.POINT_BATCH_IDS)){const p=t.byteOffset+e.POINT_BATCH_IDS.byteOffset;r=new Uint16Array(t.buffer,p,c)}const u=l(n)||l(i)||l(r),h=o>0&&!l(n)||a>0&&!l(i)||c>0&&!l(r);if(u&&h)throw new te("If one group of batch ids is defined, then all batch ids must be defined");if(!l(n)&&!l(i)&&!l(r)){let p=0;if(!l(n)&&o>0)for(n=new Uint16Array(o),s=0;s<o;++s)n[s]=p++;if(!l(i)&&a>0)for(i=new Uint16Array(a),s=0;s<a;++s)i[s]=p++;if(!l(r)&&c>0)for(r=new Uint16Array(c),s=0;s<c;++s)r[s]=p++}return{polygons:n,polylines:i,points:r}}const go=Uint32Array.BYTES_PER_ELEMENT;function l_e(e){return new ao(e)}function u_e(e){return new bc(e)}function f_e(e,t,n){n=T(n,0);const i=new Uint8Array(t),r=new DataView(t);n+=go;const s=r.getUint32(n,!0);if(s!==1)throw new te(`Only Vector tile version 1 is supported.  Version ${s} is not.`);n+=go;const o=r.getUint32(n,!0);if(n+=go,o===0){e._ready=!0;return}const a=r.getUint32(n,!0);if(n+=go,a===0)throw new te("Feature table must have a byte length greater than zero");const c=r.getUint32(n,!0);n+=go;const u=r.getUint32(n,!0);n+=go;const h=r.getUint32(n,!0);n+=go;const d=r.getUint32(n,!0);n+=go;const p=r.getUint32(n,!0);n+=go;const g=r.getUint32(n,!0);n+=go;const _=r.getUint32(n,!0);n+=go;const b=Cs(i,n,a);n+=a;const x=new Uint8Array(t,n,c);n+=c;let E,C;u>0&&(E=Cs(i,n,u),n+=u,h>0&&(C=new Uint8Array(t,n,h),C=new Uint8Array(C),n+=h));const w=T(b.POLYGONS_LENGTH,0),S=T(b.POLYLINES_LENGTH,0),v=T(b.POINTS_LENGTH,0),D=w+S+v,L=new en(e,D,E,C,a_e(e));if(e._batchTable=L,D===0)return;const O=new Ll(b,x),N=O.getGlobalProperty("REGION");if(!l(N))throw new te("Feature table global property: REGION must be defined");const B=ie.unpack(N),U=N[4],V=N[5],f=e._tile.computedTransform;let I=O.getGlobalProperty("RTC_CENTER",q.FLOAT,3);l(I)?(I=m.unpack(I),P.multiplyByPoint(f,I,I)):(I=ie.center(B),I.height=R.lerp(U,V,.5),I=fe.WGS84.cartographicToCartesian(I));const F=c_e(b,x);if(n+=(4-n%4)%4,w>0){O.featuresLength=w;const G=T(O.getPropertyArray("POLYGON_COUNTS",q.UNSIGNED_INT,1),O.getPropertyArray("POLYGON_COUNT",q.UNSIGNED_INT,1));if(!l(G))throw new te("Feature table property: POLYGON_COUNTS must be defined when POLYGONS_LENGTH is greater than 0");const W=T(O.getPropertyArray("POLYGON_INDEX_COUNTS",q.UNSIGNED_INT,1),O.getPropertyArray("POLYGON_INDEX_COUNT",q.UNSIGNED_INT,1));if(!l(W))throw new te("Feature table property: POLYGON_INDEX_COUNTS must be defined when POLYGONS_LENGTH is greater than 0");const X=G.reduce(function(we,me){return we+me*2},0),Z=W.reduce(function(we,me){return we+me},0),$=new Uint32Array(t,n,Z);n+=d;const ne=new Uint16Array(t,n,X);n+=p;let le,pe;l(b.POLYGON_MINIMUM_HEIGHTS)&&l(b.POLYGON_MAXIMUM_HEIGHTS)&&(le=O.getPropertyArray("POLYGON_MINIMUM_HEIGHTS",q.FLOAT,1),pe=O.getPropertyArray("POLYGON_MAXIMUM_HEIGHTS",q.FLOAT,1)),e._polygons=new yc({positions:ne,counts:G,indexCounts:W,indices:$,minimumHeight:U,maximumHeight:V,polygonMinimumHeights:le,polygonMaximumHeights:pe,center:I,rectangle:B,boundingVolume:e.tile.boundingVolume.boundingVolume,batchTable:L,batchIds:F.polygons,modelMatrix:f})}if(S>0){O.featuresLength=S;const G=T(O.getPropertyArray("POLYLINE_COUNTS",q.UNSIGNED_INT,1),O.getPropertyArray("POLYLINE_COUNT",q.UNSIGNED_INT,1));if(!l(G))throw new te("Feature table property: POLYLINE_COUNTS must be defined when POLYLINES_LENGTH is greater than 0");let W=O.getPropertyArray("POLYLINE_WIDTHS",q.UNSIGNED_SHORT,1);if(!l(W)){W=new Uint16Array(S);for(let pe=0;pe<S;++pe)W[pe]=2}const X=G.reduce(function(pe,we){return pe+we*3},0),Z=new Uint16Array(t,n,X);n+=g;const $=e._tileset,ne=$.examineVectorLinesFunction;if(l(ne)){const pe=ZY(new Uint16Array(Z),B,U,V,fe.WGS84);h_e(pe,G,F.polylines,L,e.url,ne)}let le=l_e;l($.classificationType)&&(le=u_e),e._polylines=le({positions:Z,widths:W,counts:G,batchIds:F.polylines,minimumHeight:U,maximumHeight:V,center:I,rectangle:B,boundingVolume:e.tile.boundingVolume.boundingVolume,batchTable:L,classificationType:$.classificationType,keepDecodedPositions:$.vectorKeepDecodedPositions})}if(v>0){const G=new Uint16Array(t,n,v*3);n+=_,e._points=new Pl({positions:G,batchIds:F.points,minimumHeight:U,maximumHeight:V,rectangle:B,batchTable:L})}}function Gw(e){const t=e.featuresLength;if(!l(e._features)&&t>0){const n=new Array(t);l(e._polygons)&&e._polygons.createFeatures(e,n),l(e._polylines)&&e._polylines.createFeatures(e,n),l(e._points)&&e._points.createFeatures(e,n),e._features=n}}jo.prototype.hasProperty=function(e,t){return this._batchTable.hasProperty(e,t)};jo.prototype.getFeature=function(e){const t=this.featuresLength;if(!l(e)||e<0||e>=t)throw new A(`batchId is required and between zero and featuresLength - 1 (${t-1}).`);return l(this._features)||Gw(this),this._features[e]};jo.prototype.applyDebugSettings=function(e,t){l(this._polygons)&&this._polygons.applyDebugSettings(e,t),l(this._polylines)&&this._polylines.applyDebugSettings(e,t),l(this._points)&&this._points.applyDebugSettings(e,t)};jo.prototype.applyStyle=function(e){l(this._features)||Gw(this),l(this._polygons)&&this._polygons.applyStyle(e,this._features),l(this._polylines)&&this._polylines.applyStyle(e,this._features),l(this._points)&&this._points.applyStyle(e,this._features)};jo.prototype.update=function(e,t){let n=!0;l(this._polygons)&&(this._polygons.classificationType=this._tileset.classificationType,this._polygons.debugWireframe=this._tileset.debugWireframe,this._polygons.update(t),n=n&&this._polygons.ready),l(this._polylines)&&(this._polylines.update(t),n=n&&this._polylines.ready),l(this._points)&&(this._points.update(t),n=n&&this._points.ready),l(this._batchTable)&&n&&(l(this._features)||Gw(this),this._batchTable.update(e,t),this._ready=!0)};jo.prototype.pick=function(e,t,n){};jo.prototype.getPolylinePositions=function(e){const t=this._polylines;if(l(t))return t.getPositions(e)};jo.prototype.isDestroyed=function(){return!1};jo.prototype.destroy=function(){return this._polygons=this._polygons&&this._polygons.destroy(),this._polylines=this._polylines&&this._polylines.destroy(),this._points=this._points&&this._points.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Ye(this)};function h_e(e,t,n,i,r,s){const o=t.length;let a=0;for(let c=0;c<o;c++){const u=t[c]*3,h=e.slice(a,a+u);a+=u,s(h,n[c],r,i)}}const Hw={b3dm:function(e,t,n,i,r){return Un.fromB3dm(e,t,n,i,r)},pnts:function(e,t,n,i,r){return Un.fromPnts(e,t,n,i,r)},i3dm:function(e,t,n,i,r){return Un.fromI3dm(e,t,n,i,r)},cmpt:function(e,t,n,i,r){return so.fromTileType(e,t,n,i,r,Hw)},externalTileset:function(e,t,n,i){return oo.fromJson(e,t,n,i)},geom:function(e,t,n,i,r){return new va(e,t,n,i,r)},vctr:function(e,t,n,i,r){return new jo(e,t,n,i,r)},subt:function(e,t,n,i,r){return Ir.fromSubtreeJson(e,t,n,void 0,i,r)},subtreeJson:function(e,t,n,i){return Ir.fromSubtreeJson(e,t,n,i)},glb:function(e,t,n,i,r){if(i.byteLength<12)throw new te("Invalid glb content");const a=new DataView(i,r).getUint32(8,!0),c=new Uint8Array(i,r,a);return Un.fromGltf(e,t,n,c)},gltf:function(e,t,n,i){return Un.fromGltf(e,t,n,i)},geoJson:function(e,t,n,i){return Un.fromGeoJson(e,t,n,i)}},d_e={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},si=Object.freeze(d_e),yo={BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",COMPOSITE:"cmpt",POINT_CLOUD:"pnts",VECTOR:"vctr",GEOMETRY:"geom",GLTF:"gltf",GLTF_BINARY:"glb",IMPLICIT_SUBTREE:"subt",IMPLICIT_SUBTREE_JSON:"subtreeJson",EXTERNAL_TILESET:"externalTileset",MULTIPLE_CONTENT:"multipleContent",GEOJSON:"geoJson",VOXEL_BINARY:"voxl",VOXEL_JSON:"voxelJson"};yo.isBinaryFormat=function(e){switch(e){case yo.BATCHED_3D_MODEL:case yo.INSTANCED_3D_MODEL:case yo.COMPOSITE:case yo.POINT_CLOUD:case yo.VECTOR:case yo.GEOMETRY:case yo.IMPLICIT_SUBTREE:case yo.VOXEL_BINARY:case yo.GLTF_BINARY:return!0;default:return!1}};const ts=Object.freeze(yo),p_e={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0},Pf=Object.freeze(p_e),Pi={RENDER:0,PICK:1,SHADOW:2,PRELOAD:3,PRELOAD_FLIGHT:4,REQUEST_RENDER_MODE_DEFER_CHECK:5,MOST_DETAILED_PRELOAD:6,MOST_DETAILED_PICK:7,NUMBER_OF_PASSES:8},Tc=new Array(Pi.NUMBER_OF_PASSES);Tc[Pi.RENDER]=Object.freeze({pass:Pi.RENDER,isRender:!0,requestTiles:!0,ignoreCommands:!1});Tc[Pi.PICK]=Object.freeze({pass:Pi.PICK,isRender:!1,requestTiles:!1,ignoreCommands:!1});Tc[Pi.SHADOW]=Object.freeze({pass:Pi.SHADOW,isRender:!1,requestTiles:!0,ignoreCommands:!1});Tc[Pi.PRELOAD]=Object.freeze({pass:Pi.PRELOAD,isRender:!1,requestTiles:!0,ignoreCommands:!0});Tc[Pi.PRELOAD_FLIGHT]=Object.freeze({pass:Pi.PRELOAD_FLIGHT,isRender:!1,requestTiles:!0,ignoreCommands:!0});Tc[Pi.REQUEST_RENDER_MODE_DEFER_CHECK]=Object.freeze({pass:Pi.REQUEST_RENDER_MODE_DEFER_CHECK,isRender:!1,requestTiles:!0,ignoreCommands:!0});Tc[Pi.MOST_DETAILED_PRELOAD]=Object.freeze({pass:Pi.MOST_DETAILED_PRELOAD,isRender:!1,requestTiles:!0,ignoreCommands:!0});Tc[Pi.MOST_DETAILED_PICK]=Object.freeze({pass:Pi.MOST_DETAILED_PICK,isRender:!1,requestTiles:!1,ignoreCommands:!1});Pi.getPassOptions=function(e){return Tc[e]};const So=Object.freeze(Pi);function Fo(e,t){this._tileset=e,this._tile=t,this.featurePropertiesDirty=!1}Object.defineProperties(Fo.prototype,{featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){}},ready:{get:function(){return!0}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){}},metadata:{get:function(){},set:function(e){throw new A("Empty3DTileContent cannot have content metadata")}},batchTable:{get:function(){}},group:{get:function(){},set:function(e){throw new A("Empty3DTileContent cannot have group metadata")}}});Fo.prototype.hasProperty=function(e,t){return!1};Fo.prototype.getFeature=function(e){};Fo.prototype.applyDebugSettings=function(e,t){};Fo.prototype.applyStyle=function(e){};Fo.prototype.update=function(e,t){};Fo.prototype.pick=function(e,t,n){};Fo.prototype.isDestroyed=function(){return!1};Fo.prototype.destroy=function(){return Ye(this)};function xc(e){e=T(e,T.EMPTY_OBJECT);const t=e.content,n=e.class;y.typeOf.object("options.content",t),y.typeOf.object("options.class",n),this._class=n,this._properties=t.properties,this._extensions=t.extensions,this._extras=t.extras}Object.defineProperties(xc.prototype,{class:{get:function(){return this._class}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});xc.prototype.hasProperty=function(e){return He.hasProperty(e,this._properties,this._class)};xc.prototype.hasPropertyBySemantic=function(e){return He.hasPropertyBySemantic(e,this._properties,this._class)};xc.prototype.getPropertyIds=function(e){return He.getPropertyIds(this._properties,this._class,e)};xc.prototype.getProperty=function(e){return He.getProperty(e,this._properties,this._class)};xc.prototype.setProperty=function(e,t){return He.setProperty(e,t,this._properties,this._class)};xc.prototype.getPropertyBySemantic=function(e){return He.getPropertyBySemantic(e,this._properties,this._class)};xc.prototype.setPropertyBySemantic=function(e,t){return He.setPropertyBySemantic(e,t,this._properties,this._class)};function sb(e,t){const n=oi(t,"3DTILES_metadata")?t.extensions["3DTILES_metadata"]:t.metadata;if(!l(n))return;if(!l(e.schema)){sb._oneTimeWarning("findContentMetadata-missing-root-schema","Could not find a metadata schema for content metadata. For tilesets that contain external tilesets, make sure the schema is added to the root tileset.json.");return}const i=T(e.schema.classes,T.EMPTY_OBJECT);if(l(n.class)){const r=i[n.class];return new xc({content:n,class:r})}}sb._oneTimeWarning=kr;function aB(e,t){const n=e.metadataExtension;if(!l(n))return;const i=n.groups,r=oi(t,"3DTILES_metadata")?t.extensions["3DTILES_metadata"].group:t.group;if(typeof r=="number")return i[r];const s=n.groupIds.findIndex(function(o){return o===r});return s>=0?i[s]:void 0}function Ec(e){e=T(e,T.EMPTY_OBJECT);const t=e.tile,n=e.class;y.typeOf.object("options.tile",t),y.typeOf.object("options.class",n),this._class=n,this._properties=t.properties,this._extensions=t.extensions,this._extras=t.extras}Object.defineProperties(Ec.prototype,{class:{get:function(){return this._class}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});Ec.prototype.hasProperty=function(e){return He.hasProperty(e,this._properties,this._class)};Ec.prototype.hasPropertyBySemantic=function(e){return He.hasPropertyBySemantic(e,this._properties,this._class)};Ec.prototype.getPropertyIds=function(e){return He.getPropertyIds(this._properties,this._class,e)};Ec.prototype.getProperty=function(e){return He.getProperty(e,this._properties,this._class)};Ec.prototype.setProperty=function(e,t){return He.setProperty(e,t,this._properties,this._class)};Ec.prototype.getPropertyBySemantic=function(e){return He.getPropertyBySemantic(e,this._properties,this._class)};Ec.prototype.setPropertyBySemantic=function(e,t){return He.setPropertyBySemantic(e,t,this._properties,this._class)};function qw(e,t){const n=oi(t,"3DTILES_metadata")?t.extensions["3DTILES_metadata"]:t.metadata;if(!l(n))return;if(!l(e.schema)){qw._oneTimeWarning("findTileMetadata-missing-root-schema","Could not find a metadata schema for tile metadata. For tilesets that contain external tilesets, make sure the schema is added to the root tileset.json.");return}const i=T(e.schema.classes,T.EMPTY_OBJECT);if(l(n.class)){const r=i[n.class];return new Ec({tile:n,class:r})}}qw._oneTimeWarning=kr;function cB(e){const t=new Uint8Array(e);let n=$y(t);if(n==="glTF"&&(n="glb"),ts.isBinaryFormat(n))return{contentType:n,binaryPayload:t};const i=m_e(t);if(l(i.root))return{contentType:ts.EXTERNAL_TILESET,jsonPayload:i};if(l(i.asset))return{contentType:ts.GLTF,jsonPayload:i};if(l(i.tileAvailability))return{contentType:ts.IMPLICIT_SUBTREE_JSON,jsonPayload:i};if(l(i.type))return{contentType:ts.GEOJSON,jsonPayload:i};if(l(i.voxelTable))return{contentType:ts.VOXEL_JSON,jsonPayload:i};throw new te("Invalid tile content.")}function m_e(e){let t;try{t=Cs(e)}catch{throw new te("Invalid tile content.")}return t}function lo(e,t,n,i){this._tileset=e,this._tile=t,this._tilesetResource=n,this._contents=[],this._contentsCreated=!1;const r=l(i.contents)?i.contents:i.content;this._innerContentHeaders=r,this._requestsInFlight=0,this._cancelCount=0;const s=this._innerContentHeaders.length;this._arrayFetchPromises=new Array(s),this._requests=new Array(s),this._ready=!1,this._innerContentResources=new Array(s),this._serverKeys=new Array(s);for(let o=0;o<s;o++){const a=n.getDerivedResource({url:r[o].uri}),c=Jt.getServerKey(a.getUrlComponent());this._innerContentResources[o]=a,this._serverKeys[o]=c}}Object.defineProperties(lo.prototype,{featurePropertiesDirty:{get:function(){const e=this._contents,t=e.length;for(let n=0;n<t;++n)if(e[n].featurePropertiesDirty)return!0;return!1},set:function(e){const t=this._contents,n=t.length;for(let i=0;i<n;++i)t[i].featurePropertiesDirty=e}},featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){return this._contents}},ready:{get:function(){return this._contentsCreated?this._ready:!1}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){}},metadata:{get:function(){},set:function(){throw new A("Multiple3DTileContent cannot have metadata")}},batchTable:{get:function(){}},group:{get:function(){},set:function(){throw new A("Multiple3DTileContent cannot have group metadata")}},innerContentUrls:{get:function(){return this._innerContentHeaders.map(function(e){return e.uri})}}});function yE(e,t){e._requestsInFlight+=t,e.tileset.statistics.numberOfPendingRequests+=t}function wO(e,t){e._cancelCount++,e._tile._contentState=t;const n=e.tileset.statistics;n.numberOfPendingRequests-=e._requestsInFlight,n.numberOfAttemptedRequests+=e._requestsInFlight,e._requestsInFlight=0;const i=e._innerContentHeaders.length;e._arrayFetchPromises=new Array(i)}lo.prototype.requestInnerContents=function(){if(!g_e(this._serverKeys)){this.tileset.statistics.numberOfAttemptedRequests+=this._serverKeys.length;return}const e=this._innerContentHeaders;yE(this,e.length);const t=this._cancelCount;for(let n=0;n<e.length;n++)this._arrayFetchPromises[n]=__e(this,n,t,this._tile._contentState);return y_e(this)};function g_e(e){const t={};for(let n=0;n<e.length;n++){const i=e[n];l(t[i])?t[i]++:t[i]=1}for(const n in t)if(t.hasOwnProperty(n)&&!Jt.serverHasOpenSlots(n,t[n]))return!1;return Jt.heapHasOpenSlots(e.length)}function __e(e,t,n,i){const r=e._innerContentResources[t].clone(),s=e.tile,o=function(){return s._priority},a=e._serverKeys[t],c=new Tl({throttle:!0,throttleByServer:!0,type:Kp.TILES3D,priorityFunction:o,serverKey:a});r.request=c,e._requests[t]=c;const u=r.fetchArrayBuffer();if(l(u))return u.then(function(h){if(!(n<e._cancelCount)){if(r.request.cancelled||r.request.state===En.CANCELLED){wO(e,i);return}return yE(e,-1),h}}).catch(function(h){if(!(n<e._cancelCount)){if(r.request.cancelled||r.request.state===En.CANCELLED){wO(e,i);return}yE(e,-1),lB(e,t,h)}})}async function y_e(e){const t=e._cancelCount,n=await Promise.all(e._arrayFetchPromises);if(t<e._cancelCount)return;const i=n.map((s,o)=>b_e(e,s,o)),r=await Promise.all(i);return e._contentsCreated=!0,e._contents=r.filter(l),r}async function b_e(e,t,n){if(l(t))try{const i=cB(t);if(i.contentType===ts.EXTERNAL_TILESET)throw new te("External tilesets are disallowed inside multiple contents");e._disableSkipLevelOfDetail=e._disableSkipLevelOfDetail||i.contentType===ts.GEOMETRY||i.contentType===ts.VECTOR;const r=e._tileset,s=e._innerContentResources[n],o=e._tile;let a;const c=Hw[i.contentType];l(i.binaryPayload)?a=await Promise.resolve(c(r,o,s,i.binaryPayload.buffer,0)):a=await Promise.resolve(c(r,o,s,i.jsonPayload));const u=e._innerContentHeaders[n];if(o.hasImplicitContentMetadata){const d=o.implicitSubtree,p=o.implicitCoordinates;a.metadata=d.getContentMetadataView(p,n)}else o.hasImplicitContent||(a.metadata=sb(r,u));const h=aB(r,u);return l(h)&&(a.group=new uw({metadata:h})),a}catch(i){lB(e,n,i)}}function lB(e,t,n){const i=e._tileset,r=e._innerContentResources[t].url,s=l(n.message)?n.message:n.toString();i.tileFailed.numberOfListeners>0?i.tileFailed.raiseEvent({url:r,message:s}):(console.log(`A content failed to load: ${r}`),console.log(`Error: ${s}`))}lo.prototype.cancelRequests=function(){for(let e=0;e<this._requests.length;e++){const t=this._requests[e];l(t)&&t.cancel()}};lo.prototype.hasProperty=function(e,t){return!1};lo.prototype.getFeature=function(e){};lo.prototype.applyDebugSettings=function(e,t){const n=this._contents,i=n.length;for(let r=0;r<i;++r)n[r].applyDebugSettings(e,t)};lo.prototype.applyStyle=function(e){const t=this._contents,n=t.length;for(let i=0;i<n;++i)t[i].applyStyle(e)};lo.prototype.update=function(e,t){const n=this._contents,i=n.length;let r=!0;for(let s=0;s<i;++s)n[s].update(e,t),r=r&&n[s].ready;!this._ready&&r&&(this._ready=!0)};lo.prototype.pick=function(e,t,n){if(!this._ready)return;let i,r=Number.POSITIVE_INFINITY;const s=this._contents,o=s.length;for(let a=0;a<o;++a){const c=s[a].pick(e,t,n);if(!l(c))continue;const u=m.distance(e.origin,c);u<r&&(i=c,r=u)}if(l(i))return n};lo.prototype.isDestroyed=function(){return!1};lo.prototype.destroy=function(){const e=this._contents,t=e.length;for(let n=0;n<t;++n)e[n].destroy();return Ye(this)};function cc(e){y.typeOf.object("options",e),y.typeOf.object("options.rectangle",e.rectangle),this.rectangle=ie.clone(e.rectangle),this.minimumHeight=T(e.minimumHeight,0),this.maximumHeight=T(e.maximumHeight,0),this.southwestCornerCartesian=new m,this.northeastCornerCartesian=new m,this.westNormal=new m,this.southNormal=new m,this.eastNormal=new m,this.northNormal=new m;const t=T(e.ellipsoid,fe.WGS84);w_e(this,e.rectangle,t),this._orientedBoundingBox=void 0,this._boundingSphere=void 0,T(e.computeBoundingVolumes,!0)&&this.computeBoundingVolumes(t)}Object.defineProperties(cc.prototype,{boundingVolume:{get:function(){return this._orientedBoundingBox}},boundingSphere:{get:function(){return this._boundingSphere}}});cc.prototype.computeBoundingVolumes=function(e){this._orientedBoundingBox=st.fromRectangle(this.rectangle,this.minimumHeight,this.maximumHeight,e),this._boundingSphere=ee.fromOrientedBoundingBox(this._orientedBoundingBox)};const AO=new m,vg=new m,SO=new m,T_e=new m,x_e=new m,E_e=new m,C_e=new m,Bs=new oe,vO=new Ve(m.UNIT_X,0),lf=new ya;function w_e(e,t,n){n.cartographicToCartesian(ie.southwest(t),e.southwestCornerCartesian),n.cartographicToCartesian(ie.northeast(t),e.northeastCornerCartesian),Bs.longitude=t.west,Bs.latitude=(t.south+t.north)*.5,Bs.height=0;const i=n.cartographicToCartesian(Bs,E_e),r=m.cross(i,m.UNIT_Z,T_e);m.normalize(r,e.westNormal),Bs.longitude=t.east;const s=n.cartographicToCartesian(Bs,C_e),o=m.cross(m.UNIT_Z,s,AO);m.normalize(o,e.eastNormal);let a=m.subtract(i,s,AO);m.magnitude(a)===0&&(a=m.clone(r,a));const c=m.normalize(a,x_e),u=t.south;let h;if(u>0){Bs.longitude=(t.west+t.east)*.5,Bs.latitude=u;const b=n.cartographicToCartesian(Bs,lf.origin);m.clone(c,lf.direction);const x=Ve.fromPointNormal(e.southwestCornerCartesian,e.westNormal,vO);Ct.rayPlane(lf,x,e.southwestCornerCartesian),h=n.geodeticSurfaceNormal(b,vg)}else h=n.geodeticSurfaceNormalCartographic(ie.southeast(t),vg);const d=m.cross(h,a,SO);m.normalize(d,e.southNormal);const p=t.north;let g;if(p<0){Bs.longitude=(t.west+t.east)*.5,Bs.latitude=p;const b=n.cartographicToCartesian(Bs,lf.origin);m.negate(c,lf.direction);const x=Ve.fromPointNormal(e.northeastCornerCartesian,e.eastNormal,vO);Ct.rayPlane(lf,x,e.northeastCornerCartesian),g=n.geodeticSurfaceNormal(b,vg)}else g=n.geodeticSurfaceNormalCartographic(ie.northwest(t),vg);const _=m.cross(a,g,SO);m.normalize(_,e.northNormal)}const A_e=new m,S_e=new m,v_e=new m(0,-1,0),I_e=new m(0,0,-1),IO=new m;function O_e(e,t){const n=t.camera,i=n.positionWC,r=n.positionCartographic;let s=0;if(!ie.contains(e.rectangle,r)){let u=e.southwestCornerCartesian,h=e.northeastCornerCartesian,d=e.westNormal,p=e.southNormal,g=e.eastNormal,_=e.northNormal;t.mode!==Ie.SCENE3D&&(u=t.mapProjection.project(ie.southwest(e.rectangle),A_e),u.z=u.y,u.y=u.x,u.x=0,h=t.mapProjection.project(ie.northeast(e.rectangle),S_e),h.z=h.y,h.y=h.x,h.x=0,d=v_e,g=m.UNIT_Y,p=I_e,_=m.UNIT_Z);const b=m.subtract(i,u,IO),x=m.dot(b,d),E=m.dot(b,p),C=m.subtract(i,h,IO),w=m.dot(C,g),S=m.dot(C,_);x>0?s+=x*x:w>0&&(s+=w*w),E>0?s+=E*E:S>0&&(s+=S*S)}let o,a,c;if(t.mode===Ie.SCENE3D?(o=r.height,a=e.minimumHeight,c=e.maximumHeight):(o=i.x,a=0,c=0),o>c){const u=o-c;s+=u*u}else if(o<a){const u=a-o;s+=u*u}return Math.sqrt(s)}cc.prototype.distanceToCamera=function(e){y.defined("frameState",e);const t=O_e(this,e);if(e.mode===Ie.SCENE3D&&l(this._orientedBoundingBox)){const n=Math.sqrt(this._orientedBoundingBox.distanceSquaredTo(e.camera.positionWC));return Math.max(t,n)}return t};cc.prototype.intersectPlane=function(e){return y.defined("plane",e),this._orientedBoundingBox.intersectPlane(e)};cc.prototype.createDebugVolume=function(e){y.defined("color",e);const t=new P.clone(P.IDENTITY),n=new fh({rectangle:this.rectangle,height:this.minimumHeight,extrudedHeight:this.maximumHeight}),i=new Oo({geometry:n,id:"outline",modelMatrix:t,attributes:{color:Qs.fromColor(e)}});return new bn({geometryInstances:i,appearance:new ro({translucent:!1,flat:!0}),asynchronous:!1})};let Ig=new oe;function dm(e){y.typeOf.object("options",e),y.typeOf.string("options.token",e.token);const t=mn.fromToken(e.token),n=T(e.minimumHeight,0),i=T(e.maximumHeight,0),r=T(e.ellipsoid,fe.WGS84);this.s2Cell=t,this.minimumHeight=n,this.maximumHeight=i,this.ellipsoid=r;const s=z_e(t,n,i,r);this._boundingPlanes=s;const o=V_e(s);this._vertices=o,this._edgeNormals=new Array(6),this._edgeNormals[0]=LT(s[0],o.slice(0,4));let a;for(a=0;a<4;a++)this._edgeNormals[0][a]=m.negate(this._edgeNormals[0][a],this._edgeNormals[0][a]);for(this._edgeNormals[1]=LT(s[1],o.slice(4,8)),a=0;a<4;a++)this._edgeNormals[2+a]=LT(s[2+a],[o[a%4],o[(a+1)%4],o[4+(a+1)%4],o[4+a]]);for(this._planeVertices=[this._vertices.slice(0,4),this._vertices.slice(4,8)],a=0;a<4;a++)this._planeVertices.push([this._vertices[a%4],this._vertices[(a+1)%4],this._vertices[4+(a+1)%4],this._vertices[4+a]]);const c=t.getCenter();Ig=r.cartesianToCartographic(c,Ig),Ig.height=(i+n)/2,this.center=r.cartographicToCartesian(Ig,c),this._boundingSphere=ee.fromPoints(o)}const R_e=new m,D_e=new oe,M_e=new m,L_e=new oe,P_e=new m,N_e=new m,F_e=new m,B_e=new m;function z_e(e,t,n,i){const r=new Array(6),s=e.getCenter(),o=i.geodeticSurfaceNormal(s,R_e),a=i.cartesianToCartographic(s,D_e);a.height=n;const c=i.cartographicToCartesian(a,M_e),u=Ve.fromPointNormal(c,o);r[0]=u;let h=0,d;const p=[];let g,_;for(d=0;d<4;d++){g=e.getVertex(d),p[d]=g,_=i.cartesianToCartographic(g,L_e),_.height=t;const x=Ve.getPointDistance(u,i.cartographicToCartesian(_,P_e));x<h&&(h=x)}const b=Ve.clone(u);for(b.normal=m.negate(b.normal,b.normal),b.distance=b.distance*-1+h,r[1]=b,d=0;d<4;d++){g=p[d];const x=p[(d+1)%4],E=i.geodeticSurfaceNormal(g,N_e),C=m.subtract(x,g,B_e);let w=m.cross(C,E,F_e);w=m.normalize(w,w),r[2+d]=Ve.fromPointNormal(g,w)}return r}let Ql=new m,eu=new m,tu=new m,ST=new m,vT=new m,IT=new m;const U_e=new m,k_e=new m,j_e=new m;let OT=new m,RT=new m,DT=new m,Bc=new m;const Qo=new H;function OO(e,t,n){Ql=e.normal,eu=t.normal,tu=n.normal,ST=m.multiplyByScalar(e.normal,-e.distance,ST),vT=m.multiplyByScalar(t.normal,-t.distance,vT),IT=m.multiplyByScalar(n.normal,-n.distance,IT),OT=m.multiplyByScalar(m.cross(eu,tu,U_e),m.dot(ST,Ql),OT),RT=m.multiplyByScalar(m.cross(tu,Ql,k_e),m.dot(vT,eu),RT),DT=m.multiplyByScalar(m.cross(Ql,eu,j_e),m.dot(IT,tu),DT),Qo[0]=Ql.x,Qo[1]=eu.x,Qo[2]=tu.x,Qo[3]=Ql.y,Qo[4]=eu.y,Qo[5]=tu.y,Qo[6]=Ql.z,Qo[7]=eu.z,Qo[8]=tu.z;const i=H.determinant(Qo);return Bc=m.add(OT,RT,Bc),Bc=m.add(Bc,DT,Bc),new m(Bc.x/i,Bc.y/i,Bc.z/i)}function V_e(e){const t=new Array(8);for(let n=0;n<4;n++)t[n]=OO(e[0],e[2+(n+3)%4],e[2+n%4]),t[n+4]=OO(e[1],e[2+(n+3)%4],e[2+n%4]);return t}let MT=new m,uf=new m;function LT(e,t){const n=[];for(let i=0;i<4;i++)MT=m.subtract(t[(i+1)%4],t[i],MT),uf=m.cross(e.normal,MT,uf),uf=m.normalize(uf,uf),n[i]=m.clone(uf);return n}Object.defineProperties(dm.prototype,{boundingVolume:{get:function(){return this}},boundingSphere:{get:function(){return this._boundingSphere}}});const PT=new m;dm.prototype.distanceToCamera=function(e){y.defined("frameState",e);const t=e.camera.positionWC,n=[],i=[];let r;Ve.getPointDistance(this._boundingPlanes[0],t)>0?(n.push(0),i.push(this._planeVertices[0]),r=this._edgeNormals[0]):Ve.getPointDistance(this._boundingPlanes[1],t)>0&&(n.push(1),i.push(this._planeVertices[1]),r=this._edgeNormals[1]);let s,o;for(s=0;s<4;s++)o=2+s,Ve.getPointDistance(this._boundingPlanes[o],t)>0&&(n.push(o),i.push(this._planeVertices[o]),r=this._edgeNormals[o]);if(n.length===0)return 0;let a,c;if(n.length===1)return c=this._boundingPlanes[n[0]],a=NT(Ve.projectPointOntoPlane(c,t,PT),i[0],c,r),m.distance(a,t);if(n.length===2){if(n[0]===0){const p=[this._vertices[4*n[0]+(n[1]-2)],this._vertices[4*n[0]+(n[1]-2+1)%4]];return a=uB(t,p[0],p[1]),m.distance(a,t)}let h=Number.MAX_VALUE,d;for(s=0;s<2;s++)c=this._boundingPlanes[n[s]],a=NT(Ve.projectPointOntoPlane(c,t,PT),i[s],c,this._edgeNormals[n[s]]),d=m.distanceSquared(a,t),d<h&&(h=d);return Math.sqrt(h)}else if(n.length>3)return a=NT(Ve.projectPointOntoPlane(this._boundingPlanes[1],t,PT),this._planeVertices[1],this._boundingPlanes[1],this._edgeNormals[1]),m.distance(a,t);const u=n[1]===2&&n[2]===5?0:1;return n[0]===0?m.distance(t,this._vertices[(n[1]-2+u)%4]):m.distance(t,this._vertices[4+(n[1]-2+u)%4])};const G_e=new m,H_e=new m;function uB(e,t,n){const i=m.subtract(n,t,G_e),r=m.subtract(e,t,H_e);let s=m.dot(i,r);if(s<=0)return t;const o=m.dot(i,i);return s>=o?n:(s=s/o,new m((1-s)*t.x+s*n.x,(1-s)*t.y+s*n.y,(1-s)*t.z+s*n.z))}const q_e=new Ve(m.UNIT_X,0);function NT(e,t,n,i){let r=Number.MAX_VALUE,s,o,a;for(let c=0;c<t.length;c++){const u=Ve.fromPointNormal(t[c],i[c],q_e);Ve.getPointDistance(u,e)<0||(a=uB(e,t[c],t[(c+1)%4]),s=m.distance(e,a),s<r&&(r=s,o=a))}return l(o)?o:e}dm.prototype.intersectPlane=function(e){y.defined("plane",e);let t=0,n=0;for(let i=0;i<this._vertices.length;i++)m.dot(e.normal,this._vertices[i])+e.distance<0?n++:t++;return t===this._vertices.length?ut.INSIDE:n===this._vertices.length?ut.OUTSIDE:ut.INTERSECTING};dm.prototype.createDebugVolume=function(e){y.defined("color",e);const t=new P.clone(P.IDENTITY),n=new Gs({polygonHierarchy:{positions:this._planeVertices[0]}}),i=Gs.createGeometry(n),r=new Oo({geometry:i,id:"outline",modelMatrix:t,attributes:{color:Qs.fromColor(e)}}),s=new Gs({polygonHierarchy:{positions:this._planeVertices[1]}}),o=Gs.createGeometry(s),a=new Oo({geometry:o,id:"outline",modelMatrix:t,attributes:{color:Qs.fromColor(e)}}),c=[];for(let u=0;u<4;u++){const h=new Gs({polygonHierarchy:{positions:this._planeVertices[2+u]}}),d=Gs.createGeometry(h);c[u]=new Oo({geometry:d,id:"outline",modelMatrix:t,attributes:{color:Qs.fromColor(e)}})}return new bn({geometryInstances:[c[0],c[1],c[2],c[3],a,r],appearance:new ro({translucent:!1,flat:!0}),asynchronous:!1})};function Cc(e,t){t===0&&(t=R.EPSILON7),this._boundingSphere=new ee(e,t)}Object.defineProperties(Cc.prototype,{center:{get:function(){return this._boundingSphere.center}},radius:{get:function(){return this._boundingSphere.radius}},boundingVolume:{get:function(){return this._boundingSphere}},boundingSphere:{get:function(){return this._boundingSphere}}});Cc.prototype.distanceToCamera=function(e){y.defined("frameState",e);const t=this._boundingSphere;return Math.max(0,m.distance(t.center,e.camera.positionWC)-t.radius)};Cc.prototype.intersectPlane=function(e){return y.defined("plane",e),ee.intersectPlane(this._boundingSphere,e)};Cc.prototype.update=function(e,t){m.clone(e,this._boundingSphere.center),this._boundingSphere.radius=t};Cc.prototype.createDebugVolume=function(e){y.defined("color",e);const t=new hh({radius:this.radius}),n=P.fromTranslation(this.center,new P.clone(P.IDENTITY)),i=new Oo({geometry:t,id:"outline",modelMatrix:n,attributes:{color:Qs.fromColor(e)}});return new bn({geometryInstances:i,appearance:new ro({translucent:!1,flat:!0}),asynchronous:!1})};const W_e=new m,$_e=new m,X_e=new m,Y_e=new m;function ou(e,t,n){n=m.cross(e,t,n);const i=m.magnitude(n);return m.multiplyByScalar(n,R.EPSILON7/i,n)}function FT(e,t){const n=m.normalize(e,Y_e),i=m.equalsEpsilon(n,m.UNIT_X,R.EPSILON6)?m.UNIT_Y:m.UNIT_X;return ou(e,i,t)}function fB(e){let t=H.getColumn(e,0,W_e),n=H.getColumn(e,1,$_e),i=H.getColumn(e,2,X_e);const r=m.equals(t,m.ZERO),s=m.equals(n,m.ZERO),o=m.equals(i,m.ZERO);return!r&&!s&&!o?e:r&&s&&o?(e[0]=R.EPSILON7,e[4]=R.EPSILON7,e[8]=R.EPSILON7,e):(r&&!s&&!o?t=ou(n,i,t):!r&&s&&!o?n=ou(t,i,n):!r&&!s&&o?i=ou(n,t,i):r?s?o||(t=FT(i,t),n=ou(i,t,n)):(t=FT(n,t),i=ou(n,t,i)):(n=FT(t,n),i=ou(n,t,i)),H.setColumn(e,0,t,e),H.setColumn(e,1,n,e),H.setColumn(e,2,i,e),e)}function co(e,t){t=fB(t),this._orientedBoundingBox=new st(e,t),this._boundingSphere=ee.fromOrientedBoundingBox(this._orientedBoundingBox)}Object.defineProperties(co.prototype,{boundingVolume:{get:function(){return this._orientedBoundingBox}},boundingSphere:{get:function(){return this._boundingSphere}}});co.prototype.distanceToCamera=function(e){return y.defined("frameState",e),Math.sqrt(this._orientedBoundingBox.distanceSquaredTo(e.camera.positionWC))};co.prototype.intersectPlane=function(e){return y.defined("plane",e),this._orientedBoundingBox.intersectPlane(e)};co.prototype.update=function(e,t){m.clone(e,this._orientedBoundingBox.center),t=fB(t),H.clone(t,this._orientedBoundingBox.halfAxes),ee.fromOrientedBoundingBox(this._orientedBoundingBox,this._boundingSphere)};co.prototype.createDebugVolume=function(e){y.defined("color",e);const t=new ba({minimum:new m(-1,-1,-1),maximum:new m(1,1,1)}),n=P.fromRotationTranslation(this.boundingVolume.halfAxes,this.boundingVolume.center),i=new Oo({geometry:t,id:"outline",modelMatrix:n,attributes:{color:Qs.fromColor(e)}});return new bn({geometryInstances:i,appearance:new ro({translucent:!1,flat:!0}),asynchronous:!1})};function xn(e,t,n,i){this._tileset=e,this._header=n;const r=l(n.contents),s=r&&n.contents.length>1||oi(n,"3DTILES_multiple_contents"),o=r&&!s?n.contents[0]:n.content;this._contentHeader=o,this.transform=l(n.transform)?P.unpack(n.transform):P.clone(P.IDENTITY);const a=l(i)?i.computedTransform:e.modelMatrix,c=P.multiply(a,this.transform,new P),u=l(i)?i._initialTransform:P.IDENTITY;this._initialTransform=P.multiply(u,this.transform,new P),this.computedTransform=c,this.metadata=qw(e,n),this._verticalExaggeration=1,this._verticalExaggerationRelativeHeight=0,this._boundingVolume=this.createBoundingVolume(n.boundingVolume,c),this._boundingVolume2D=void 0;let h;l(o)&&l(o.boundingVolume)&&(h=this.createBoundingVolume(o.boundingVolume,c)),this._contentBoundingVolume=h,this._contentBoundingVolume2D=void 0;let d;l(n.viewerRequestVolume)&&(d=this.createBoundingVolume(n.viewerRequestVolume,c)),this._viewerRequestVolume=d,this.geometricError=n.geometricError,this._geometricError=n.geometricError,l(this._geometricError)||(this._geometricError=l(i)?i._geometricError:e._geometricError,xn._deprecationWarning("geometricErrorUndefined","Required property geometricError is undefined for this tile. Using parent's geometric error instead.")),this.updateGeometricErrorScale();let p;l(n.refine)?((n.refine==="replace"||n.refine==="add")&&xn._deprecationWarning("lowercase-refine",`This tile uses a lowercase refine "${n.refine}". Instead use "${n.refine.toUpperCase()}".`),p=n.refine.toUpperCase()==="REPLACE"?sr.REPLACE:sr.ADD):l(i)?p=i.refine:p=sr.REPLACE,this.refine=p,this.children=[],this.parent=i;let g,_=!1,b,x,E;if(t=se.createIfNeeded(t),s)b=si.UNLOADED,x=t.clone();else if(l(o)){let v=o.uri;l(o.url)&&(xn._deprecationWarning("contentUrl",'This tileset JSON uses the "content.url" property which has been deprecated. Use "content.uri" instead.'),v=o.url),v===""?(xn._deprecationWarning("contentUriEmpty","content.uri property is an empty string, which creates a circular dependency, making this tileset invalid. Omit the content property instead"),g=new Fo(e,this),_=!0,b=si.READY):(b=si.UNLOADED,x=t.getDerivedResource({url:v}),E=Jt.getServerKey(x.getUrlComponent()))}else g=new Fo(e,this),_=!0,b=si.READY;this._content=g,this._contentResource=x,this._contentState=b,this._expiredContent=void 0,this._serverKey=E,this.hasEmptyContent=_,this.hasTilesetContent=!1,this.hasImplicitContent=!1,this.hasImplicitContentMetadata=!1,this.hasMultipleContents=s,this.cacheNode=void 0;const C=n.expire;let w,S;l(C)&&(w=C.duration,l(C.date)&&(S=ue.fromIso8601(C.date))),this.expireDuration=w,this.expireDate=S,this.lastStyleTime=0,this._optimChildrenWithinParent=Pf.NOT_COMPUTED,this.clippingPlanesDirty=!1,this.clippingPolygonsDirty=!1,this.priorityDeferred=!1,this.implicitTileset=void 0,this.implicitCoordinates=void 0,this.implicitSubtree=void 0,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._screenSpaceErrorProgressiveResolution=0,this._visibilityPlaneMask=0,this._visible=!1,this._inRequestVolume=!1,this._finalResolution=!0,this._depth=0,this._stackLength=0,this._selectionDepth=0,this._updatedVisibilityFrame=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._wasSelectedLastFrame=!1,this._requestedFrame=0,this._ancestorWithContent=void 0,this._ancestorWithContentAvailable=void 0,this._refines=!1,this._shouldSelect=!1,this._isClipped=!0,this._isClippedByPolygon=!1,this._clippingPlanesState=0,this._clippingPolygonsState=0,this._debugBoundingVolume=void 0,this._debugContentBoundingVolume=void 0,this._debugViewerRequestVolume=void 0,this._debugColor=M.fromRandom({alpha:1}),this._debugColorizeTiles=!1,this._priority=0,this._priorityHolder=this,this._priorityProgressiveResolution=!1,this._priorityProgressiveResolutionScreenSpaceErrorLeaf=!1,this._priorityReverseScreenSpaceError=0,this._foveatedFactor=0,this._wasMinPriorityChild=!1,this._loadTimestamp=new ue,this._commandsLength=0,this._color=void 0,this._colorDirty=!1,this._request=void 0}xn._deprecationWarning=pc;Object.defineProperties(xn.prototype,{tileset:{get:function(){return this._tileset}},content:{get:function(){return this._content}},boundingVolume:{get:function(){return this._boundingVolume}},contentBoundingVolume:{get:function(){return T(this._contentBoundingVolume,this._boundingVolume)}},boundingSphere:{get:function(){return this._boundingVolume.boundingSphere}},isVisible:{get:function(){return this._visible&&this._inRequestVolume}},extras:{get:function(){return this._header.extras}},color:{get:function(){return l(this._color)||(this._color=new M),M.clone(this._color)},set:function(e){this._color=M.clone(e,this._color),this._colorDirty=!0}},hasRenderableContent:{get:function(){return!this.hasEmptyContent&&!this.hasTilesetContent&&!this.hasImplicitContent}},contentAvailable:{get:function(){return this.contentReady&&this.hasRenderableContent||l(this._expiredContent)&&!this.contentFailed}},contentReady:{get:function(){return this._contentState===si.READY}},contentUnloaded:{get:function(){return this._contentState===si.UNLOADED}},hasUnloadedRenderableContent:{get:function(){return this.hasRenderableContent&&this.contentUnloaded}},contentExpired:{get:function(){return this._contentState===si.EXPIRED}},contentFailed:{get:function(){return this._contentState===si.FAILED}},commandsLength:{get:function(){return this._commandsLength}}});const zc=new m;function K_e(e,t){const{tileset:n,boundingSphere:i}=e,{radius:r,center:s}=i,{camera:o}=t,a=m.multiplyByScalar(o.directionWC,e._centerZDepth,zc),c=m.add(o.positionWC,a,zc),u=m.subtract(c,s,zc);if(m.magnitude(u)>r){const S=m.normalize(u,zc),v=m.multiplyByScalar(S,r,zc),D=m.add(s,v,zc),L=m.subtract(D,o.positionWC,zc),O=m.normalize(L,zc);e._foveatedFactor=1-Math.abs(m.dot(o.directionWC,O))}else e._foveatedFactor=0;const p=e.refine===sr.REPLACE,g=n.isSkippingLevelOfDetail;if(p&&!g||!n.foveatedScreenSpaceError||n.foveatedConeSize===1||e._priorityProgressiveResolution&&p&&g||n._pass===So.PRELOAD_FLIGHT||n._pass===So.PRELOAD)return!1;const _=1-Math.cos(o.frustum.fov*.5),b=n.foveatedConeSize*_;if(e._foveatedFactor<=b)return!1;const x=_-b,E=R.clamp((e._foveatedFactor-b)/x,0,1),C=n.foveatedInterpolationCallback(n.foveatedMinimumScreenSpaceErrorRelaxation,n.memoryAdjustedScreenSpaceError,E),w=e._screenSpaceError===0&&l(e.parent)?e.parent._screenSpaceError*.5:e._screenSpaceError;return n.memoryAdjustedScreenSpaceError-C<=w}const hB=new ue;xn.prototype.getScreenSpaceError=function(e,t,n){const i=this._tileset,r=T(n,1),s=l(this.parent)?this.parent.geometricError:i._scaledGeometricError,o=t?s:this.geometricError;if(o===0)return 0;const{camera:a,context:c}=e;let u=a.frustum;const h=c.drawingBufferWidth,d=c.drawingBufferHeight*r;let p;if(e.mode===Ie.SCENE2D||u instanceof Sr){const g=u.offCenterFrustum;l(g)&&(u=g);const _=Math.max(u.top-u.bottom,u.right-u.left)/Math.max(h,d);p=o/_}else{const g=Math.max(this._distanceToCamera,R.EPSILON7),_=u.sseDenominator;if(p=o*d/(g*_),i.dynamicScreenSpaceError){const b=i._dynamicScreenSpaceErrorComputedDensity,x=i.dynamicScreenSpaceErrorFactor,E=R.fog(g,b)*x;p-=E}}return p/=e.pixelRatio,p};function Z_e(e,t){if(e.progressiveResolutionHeightFraction<=0||e.progressiveResolutionHeightFraction>.5)return!1;const n=e.memoryAdjustedScreenSpaceError;let i=t._screenSpaceErrorProgressiveResolution>n;t._priorityProgressiveResolutionScreenSpaceErrorLeaf=!1;const r=t.parent,s=t._screenSpaceErrorProgressiveResolution<=n,o=l(r)&&r._screenSpaceErrorProgressiveResolution>n;return s&&o&&(t._priorityProgressiveResolutionScreenSpaceErrorLeaf=!0,i=!0),i}function J_e(e,t){const n=t.parent,r=l(n)&&(!e.isSkippingLevelOfDetail||t._screenSpaceError===0||n.hasTilesetContent||n.hasImplicitContent)?n._screenSpaceError:t._screenSpaceError;return e.root._screenSpaceError-r}xn.prototype.updateVisibility=function(e){const{parent:t,tileset:n}=this;if(this._updatedVisibilityFrame===n._updatedVisibilityFrame)return;const i=l(t)?t.computedTransform:n.modelMatrix,r=l(t)?t._visibilityPlaneMask:br.MASK_INDETERMINATE;this.updateTransform(i,e),this._distanceToCamera=this.distanceToTile(e),this._centerZDepth=this.distanceToTileCenter(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._screenSpaceErrorProgressiveResolution=this.getScreenSpaceError(e,!1,n.progressiveResolutionHeightFraction),this._visibilityPlaneMask=this.visibility(e,r),this._visible=this._visibilityPlaneMask!==br.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._priorityReverseScreenSpaceError=J_e(n,this),this._priorityProgressiveResolution=Z_e(n,this),this.priorityDeferred=K_e(this,e),this._updatedVisibilityFrame=n._updatedVisibilityFrame};xn.prototype.updateExpiration=function(){if(l(this.expireDate)&&this.contentReady&&!this.hasEmptyContent&&!this.hasMultipleContents){const e=ue.now(hB);ue.lessThan(this.expireDate,e)&&(this._contentState=si.EXPIRED,this._expiredContent=this._content)}};function Q_e(e){if(!l(e.expireDuration))return;const t=ue.now(hB);ue.addSeconds(t,e.expireDuration,t),l(e.expireDate)?ue.lessThan(e.expireDate,t)&&ue.clone(t,e.expireDate):e.expireDate=ue.clone(t)}function eye(e){return function(){return e._priority}}xn.prototype.requestContent=function(){if(!this.hasEmptyContent)return this.hasMultipleContents?tye(this):iye(this)};function tye(e){let t=e._content;const n=e._tileset;if(!l(t)){const r=oi(e._header,"3DTILES_multiple_contents")?e._header.extensions["3DTILES_multiple_contents"]:e._header;t=new lo(n,e,e._contentResource.clone(),r),e._content=t}const i=t.requestInnerContents();if(l(i))return e._contentState=si.LOADING,i.then(r=>{if(!e.isDestroyed()&&l(r))return e._contentState=si.PROCESSING,t}).catch(r=>{if(!e.isDestroyed())throw e._contentState=si.FAILED,r})}async function nye(e,t,n,i,r){const s=e._contentState;e._contentState=si.LOADING,++t.statistics.numberOfPendingRequests;let o;try{o=await r}catch(a){if(--t.statistics.numberOfPendingRequests,e.isDestroyed())return;if(n.cancelled||n.state===En.CANCELLED){e._contentState=s,++t.statistics.numberOfAttemptedRequests;return}throw e._contentState=si.FAILED,a}if(e.isDestroyed()){--t.statistics.numberOfPendingRequests;return}if(n.cancelled||n.state===En.CANCELLED){e._contentState=s,--t.statistics.numberOfPendingRequests,++t.statistics.numberOfAttemptedRequests;return}try{const a=await rye(e,o);return--t.statistics.numberOfPendingRequests,e.isDestroyed()?void 0:(i&&(e.expireDate=void 0),e._content=a,e._contentState=si.PROCESSING,a)}catch(a){if(--t.statistics.numberOfPendingRequests,e.isDestroyed())return;throw e._contentState=si.FAILED,a}}function iye(e){const t=e._contentResource.clone(),n=e.contentExpired;n&&t.setQueryParameters({expired:e.expireDate.toString()});const i=new Tl({throttle:!0,throttleByServer:!0,type:Kp.TILES3D,priorityFunction:eye(e),serverKey:e._serverKey});e._request=i,t.request=i;const r=e._tileset,s=t.fetchArrayBuffer();if(!l(s)){++r.statistics.numberOfAttemptedRequests;return}return nye(e,r,i,n,s)}async function rye(e,t){const n=cB(t),i=e._tileset;i._disableSkipLevelOfDetail=i._disableSkipLevelOfDetail||n.contentType===ts.GEOMETRY||n.contentType===ts.VECTOR,(n.contentType===ts.IMPLICIT_SUBTREE||n.contentType===ts.IMPLICIT_SUBTREE_JSON)&&(e.hasImplicitContent=!0),n.contentType===ts.EXTERNAL_TILESET&&(e.hasTilesetContent=!0);let r;const s=Hw[n.contentType];if(e.isDestroyed())return;l(n.binaryPayload)?r=await Promise.resolve(s(i,e,e._contentResource,n.binaryPayload.buffer,0)):r=await Promise.resolve(s(i,e,e._contentResource,n.jsonPayload));const o=e._contentHeader;if(e.hasImplicitContentMetadata){const c=e.implicitSubtree,u=e.implicitCoordinates;r.metadata=c.getContentMetadataView(u,0)}else e.hasImplicitContent||(r.metadata=sb(i,o));const a=aB(i,o);return l(a)&&(r.group=new uw({metadata:a})),r}xn.prototype.cancelRequests=function(){this.hasMultipleContents?this._content.cancelRequests():this._request.cancel()};xn.prototype.unloadContent=function(){this.hasRenderableContent&&(this._content=this._content&&this._content.destroy(),this._contentState=si.UNLOADED,this.lastStyleTime=0,this.clippingPlanesDirty=this._clippingPlanesState===0,this._clippingPlanesState=0,this.clippingPolygonsDirty=this._clippingPolygonsState===0,this._clippingPolygonsState=0,this._debugColorizeTiles=!1,this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy())};const dB=new ee;function Ww(e,t){if(t.mode!==Ie.SCENE3D&&!l(e._boundingVolume2D)){const n=e._boundingVolume.boundingSphere,i=ee.projectTo2D(n,t.mapProjection,dB);e._boundingVolume2D=new Cc(i.center,i.radius)}return t.mode!==Ie.SCENE3D?e._boundingVolume2D:e._boundingVolume}function sye(e,t){if(t.mode!==Ie.SCENE3D&&!l(e._contentBoundingVolume2D)){const n=e._contentBoundingVolume.boundingSphere,i=ee.projectTo2D(n,t.mapProjection,dB);e._contentBoundingVolume2D=new Cc(i.center,i.radius)}return t.mode!==Ie.SCENE3D?e._contentBoundingVolume2D:e._contentBoundingVolume}xn.prototype.visibility=function(e,t){const n=e.cullingVolume,i=Ww(this,e),r=this._tileset,s=r.clippingPlanes;if(l(s)&&s.enabled){const a=s.computeIntersectionWithBoundingVolume(i,r.clippingPlanesOriginMatrix);if(this._isClipped=a!==ut.INSIDE,a===ut.OUTSIDE)return br.MASK_OUTSIDE}const o=r.clippingPolygons;if(l(o)&&o.enabled){const a=o.computeIntersectionWithBoundingVolume(i);this._isClippedByPolygon=a!==ut.OUTSIDE}return n.computeVisibilityWithPlaneMask(i,t)};xn.prototype.contentVisibility=function(e){if(!l(this._contentBoundingVolume)||this._visibilityPlaneMask===br.MASK_INSIDE)return ut.INSIDE;const t=e.cullingVolume,n=sye(this,e),i=this._tileset,r=i.clippingPlanes;if(l(r)&&r.enabled){const o=r.computeIntersectionWithBoundingVolume(n,i.clippingPlanesOriginMatrix);if(this._isClipped=o!==ut.INSIDE,o===ut.OUTSIDE)return ut.OUTSIDE}const s=i.clippingPolygons;if(l(s)&&s.enabled){const o=s.computeIntersectionWithBoundingVolume(n);if(this._isClippedByPolygon=o!==ut.OUTSIDE,o===ut.INSIDE)return ut.OUTSIDE}return t.computeVisibility(n)};xn.prototype.distanceToTile=function(e){return Ww(this,e).distanceToCamera(e)};const oye=new m;xn.prototype.distanceToTileCenter=function(e){const n=Ww(this,e).boundingVolume,i=m.subtract(n.center,e.camera.positionWC,oye);return m.dot(e.camera.directionWC,i)};xn.prototype.insideViewerRequestVolume=function(e){const t=this._viewerRequestVolume;return!l(t)||t.distanceToCamera(e)===0};const pB=new H,mB=new m,aye=new H,$w=new m,gB=new ie,_B=new st,bE=new P;function cye(e,t,n){let i=m.fromElements(e[0],e[1],e[2],$w),r=H.fromArray(e,3,aye);i=P.multiplyByPoint(t,i,i);const s=P.getMatrix3(t,pB);return r=H.multiply(s,r,r),l(n)?(n.update(i,r),n):new co(i,r)}function lye(e,t,n,i){const r=ie.unpack(e,0,gB),s=e[4],o=e[5],a=st.fromRectangle(r,s,o,fe.WGS84,_B);let c=a.center,u=a.halfAxes;t=P.multiplyTransformation(t,P.inverseTransformation(n,bE),bE),c=P.multiplyByPoint(t,c,c);const h=P.getMatrix3(t,pB);return u=H.multiply(h,u,u),l(i)&&i instanceof co?(i.update(c,u),i):new co(c,u)}function uye(e,t,n,i){if(!P.equalsEpsilon(t,n,R.EPSILON8))return lye(e,t,n,i);const r=ie.unpack(e,0,gB);return l(i)?(i.rectangle=ie.clone(r,i.rectangle),i.minimumHeight=e[4],i.maximumHeight=e[5],i.computeBoundingVolumes(fe.WGS84),i):new cc({rectangle:r,minimumHeight:e[4],maximumHeight:e[5]})}function fye(e,t,n){let i=m.fromElements(e[0],e[1],e[2],$w),r=e[3];i=P.multiplyByPoint(t,i,i);const s=P.getScale(t,mB),o=m.maximumComponent(s);return r*=o,l(n)?(n.update(i,r),n):new Cc(i,r)}xn.prototype.createBoundingVolume=function(e,t,n){const i=this.metadata;let r;if(l(i)&&(r=js.parseBoundingVolumeSemantic("TILE",i)),l(r)&&(e=r),!l(e))throw new te("boundingVolume must be defined");if(oi(e,"3DTILES_bounding_volume_S2"))return new dm(e.extensions["3DTILES_bounding_volume_S2"]);const{box:s,region:o,sphere:a}=e;if(l(s)){const c=cye(s,t,n);return this._verticalExaggeration!==1&&RO(c,this._verticalExaggeration,this._verticalExaggerationRelativeHeight),c}if(l(o)){const c=uye(o,t,this._initialTransform,n);return this._verticalExaggeration===1||(c instanceof co?RO(c,this._verticalExaggeration,this._verticalExaggerationRelativeHeight):(c.minimumHeight=sl.getHeight(c.minimumHeight,this._verticalExaggeration,this._verticalExaggerationRelativeHeight),c.maximumHeight=sl.getHeight(c.maximumHeight,this._verticalExaggeration,this._verticalExaggerationRelativeHeight),c.computeBoundingVolumes(fe.WGS84))),c}if(l(a)){const c=fye(a,t,n);if(this._verticalExaggeration!==1){const u=sl.getPosition(c.center,fe.WGS84,this._verticalExaggeration,this._verticalExaggerationRelativeHeight,$w),h=c.radius*this._verticalExaggeration;c.update(u,h)}return c}throw new te("boundingVolume must contain a sphere, region, or box")};const hye=m.unpackArray(new Array(8*3).fill(0));function RO(e,t,n){const i=e.boundingVolume.computeCorners(hye).map(s=>sl.getPosition(s,fe.WGS84,t,n,s)),r=st.fromPoints(i,_B);e.update(r.center,r.halfAxes)}xn.prototype.updateTransform=function(e,t){e=T(e,P.IDENTITY);const n=P.multiplyTransformation(e,this.transform,bE),i=!P.equals(n,this.computedTransform),r=l(t)&&(this._verticalExaggeration!==t.verticalExaggeration||this._verticalExaggerationRelativeHeight!==t.verticalExaggerationRelativeHeight);if(!i&&!r)return;i&&P.clone(n,this.computedTransform),r&&(this._verticalExaggeration=t.verticalExaggeration,this._verticalExaggerationRelativeHeight=t.verticalExaggerationRelativeHeight);const s=this._header,o=this._contentHeader;this._boundingVolume=this.createBoundingVolume(s.boundingVolume,this.computedTransform,this._boundingVolume),l(this._contentBoundingVolume)&&(this._contentBoundingVolume=this.createBoundingVolume(o.boundingVolume,this.computedTransform,this._contentBoundingVolume)),l(this._viewerRequestVolume)&&(this._viewerRequestVolume=this.createBoundingVolume(s.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)),this.updateGeometricErrorScale(),this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy()};xn.prototype.updateGeometricErrorScale=function(){const e=P.getScale(this.computedTransform,mB),t=m.maximumComponent(e);if(this.geometricError=this._geometricError*t,!l(this.parent)){const n=this._tileset;n._scaledGeometricError=n._geometricError*t}};function dye(e,t,n,i){if(!i.isRender)return;const r=l(e._contentHeader)&&l(e._contentHeader.boundingVolume),s=t.debugShowBoundingVolume||t.debugShowContentBoundingVolume&&!r;if(s){let c;e._finalResolution?e.hasRenderableContent?c=M.WHITE:c=M.DARKGRAY:c=M.YELLOW,l(e._debugBoundingVolume)||(e._debugBoundingVolume=e._boundingVolume.createDebugVolume(c)),e._debugBoundingVolume.update(n);const u=e._debugBoundingVolume.getGeometryInstanceAttributes("outline");u.color=Qs.toValue(c,u.color)}else!s&&l(e._debugBoundingVolume)&&(e._debugBoundingVolume=e._debugBoundingVolume.destroy());t.debugShowContentBoundingVolume&&r?(l(e._debugContentBoundingVolume)||(e._debugContentBoundingVolume=e._contentBoundingVolume.createDebugVolume(M.BLUE)),e._debugContentBoundingVolume.update(n)):!t.debugShowContentBoundingVolume&&l(e._debugContentBoundingVolume)&&(e._debugContentBoundingVolume=e._debugContentBoundingVolume.destroy()),t.debugShowViewerRequestVolume&&l(e._viewerRequestVolume)?(l(e._debugViewerRequestVolume)||(e._debugViewerRequestVolume=e._viewerRequestVolume.createDebugVolume(M.YELLOW)),e._debugViewerRequestVolume.update(n)):!t.debugShowViewerRequestVolume&&l(e._debugViewerRequestVolume)&&(e._debugViewerRequestVolume=e._debugViewerRequestVolume.destroy());const o=t.debugColorizeTiles&&!e._debugColorizeTiles||l(t._heatmap.tilePropertyName),a=!t.debugColorizeTiles&&e._debugColorizeTiles;o?(t._heatmap.colorize(e,n),e._debugColorizeTiles=!0,e.color=e._debugColor):a&&(e._debugColorizeTiles=!1,e.color=M.WHITE),e._colorDirty&&(e._colorDirty=!1,e._content.applyDebugSettings(!0,e._color)),a&&t.makeStyleDirty()}function pye(e,t,n){const i=e._expiredContent;if(!e.hasMultipleContents&&l(i)){if(!e.contentReady){try{i.update(t,n)}catch{}return}e._expiredContent.destroy(),e._expiredContent=void 0}if(l(e.content))try{e.content.update(t,n)}catch(r){throw e._contentState=si.FAILED,r}}function mye(e,t){const n=t.clippingPlanes;let i=0;l(n)&&e._isClipped&&n.enabled&&(i=n.clippingPlanesState),i!==e._clippingPlanesState&&(e._clippingPlanesState=i,e.clippingPlanesDirty=!0)}function gye(e,t){const n=t.clippingPolygons;let i=0;l(n)&&e._isClippedByPolygon&&n.enabled&&(i=n.clippingPolygonsState),i!==e._clippingPolygonsState&&(e._clippingPolygonsState=i,e.clippingPolygonsDirty=!0)}xn.prototype.update=function(e,t,n){const{commandList:i}=t,r=i.length;mye(this,e),gye(this,e),dye(this,e,t,n),pye(this,e,t);const s=i.length;this._commandsLength=s-r;for(let o=r;o<s;++o){const a=i[o],c=a.pass===Ke.TRANSLUCENT;a.depthForTranslucentClassification=c}this.clippingPlanesDirty=!1,this.clippingPolygonsDirty=!1};const DO=[];xn.prototype.process=function(e,t){!this.contentExpired&&!this.contentReady&&this._content.ready&&(Q_e(this),this._selectedFrame=0,this.lastStyleTime=0,ue.now(this._loadTimestamp),this._contentState=si.READY,!this.hasTilesetContent&&!this.hasImplicitContent&&(e._statistics.incrementLoadCounts(this.content),++e._statistics.numberOfTilesWithContentReady,++e._statistics.numberOfLoadedTilesTotal,e._cache.add(this)));const n=t.commandList;t.commandList=DO;try{this._content.update(e,t)}catch(i){throw this._contentState=si.FAILED,i}DO.length=0,t.commandList=n};function MO(e,t,n){const i=e*Math.pow(10,t);return parseInt(i)*Math.pow(10,n)}function Og(e,t,n){return Math.max(R.normalize(e,t,n)-R.EPSILON7,0)}xn.prototype.updatePriority=function(){const e=this.tileset,t=e.preferLeaves,n=e._minimumPriority,i=e._maximumPriority,r=4,s=1,o=0,a=r,c=o+a,u=r,h=c+u,d=s,p=Math.pow(10,h),g=h+d,_=s,b=Math.pow(10,g),x=g+_,E=Math.pow(10,x);let C=Og(this._depth,n.depth,i.depth);C=t?1-C:C;const S=!e.isSkippingLevelOfDetail&&this.refine===sr.REPLACE?Og(this._priorityHolder._distanceToCamera,n.distance,i.distance):Og(this._priorityReverseScreenSpaceError,n.reverseScreenSpaceError,i.reverseScreenSpaceError),v=MO(S,a,o),D=this._priorityProgressiveResolution?0:p,L=Og(this._priorityHolder._foveatedFactor,n.foveatedFactor,i.foveatedFactor),O=MO(L,u,c),N=this.priorityDeferred?b:0,B=e._pass===So.PRELOAD_FLIGHT?0:E;this._priority=C+v+D+O+N+B};xn.prototype.isDestroyed=function(){return!1};xn.prototype.destroy=function(){return this._content=this._content&&this._content.destroy(),this._expiredContent=this._expiredContent&&!this._expiredContent.isDestroyed()&&this._expiredContent.destroy(),this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy(),Ye(this)};function Ea(e){e=T(e,T.EMPTY_OBJECT);const t=e.id,n=e.group,i=e.class;y.typeOf.object("options.group",n),y.typeOf.object("options.class",i);const r=l(n.properties)?n.properties:{};this._class=i,this._properties=r,this._id=t,this._extras=n.extras,this._extensions=n.extensions}Object.defineProperties(Ea.prototype,{class:{get:function(){return this._class}},id:{get:function(){return this._id}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});Ea.prototype.hasProperty=function(e){return He.hasProperty(e,this._properties,this._class)};Ea.prototype.hasPropertyBySemantic=function(e){return He.hasPropertyBySemantic(e,this._properties,this._class)};Ea.prototype.getPropertyIds=function(e){return He.getPropertyIds(this._properties,this._class,e)};Ea.prototype.getProperty=function(e){return He.getProperty(e,this._properties,this._class)};Ea.prototype.setProperty=function(e,t){return He.setProperty(e,t,this._properties,this._class)};Ea.prototype.getPropertyBySemantic=function(e){return He.getPropertyBySemantic(e,this._properties,this._class)};Ea.prototype.setPropertyBySemantic=function(e,t){return He.setPropertyBySemantic(e,t,this._properties,this._class)};function wc(e){e=T(e,T.EMPTY_OBJECT);const t=e.tileset,n=e.class;y.typeOf.object("options.tileset",t),y.typeOf.object("options.class",n);const i=l(t.properties)?t.properties:{};this._class=n,this._properties=i,this._extras=t.extras,this._extensions=t.extensions}Object.defineProperties(wc.prototype,{class:{get:function(){return this._class}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});wc.prototype.hasProperty=function(e){return He.hasProperty(e,this._properties,this._class)};wc.prototype.hasPropertyBySemantic=function(e){return He.hasPropertyBySemantic(e,this._properties,this._class)};wc.prototype.getPropertyIds=function(e){return He.getPropertyIds(this._properties,this._class,e)};wc.prototype.getProperty=function(e){return He.getProperty(e,this._properties,this._class)};wc.prototype.setProperty=function(e,t){return He.setProperty(e,t,this._properties,this._class)};wc.prototype.getPropertyBySemantic=function(e){return He.getPropertyBySemantic(e,this._properties,this._class)};wc.prototype.setPropertyBySemantic=function(e,t){return He.setPropertyBySemantic(e,t,this._properties,this._class)};function yB(e){e=T(e,T.EMPTY_OBJECT);const t=e.metadataJson,n=e.schema;y.typeOf.object("options.metadataJson",t),y.typeOf.object("options.schema",n);const i=T(t.metadata,t.tileset);let r;l(i)&&(r=new wc({tileset:i,class:n.classes[i.class]}));let s=[];const o=[],a=t.groups;if(Array.isArray(a)){const c=a.length;for(let u=0;u<c;u++){const h=a[u];o.push(new Ea({group:h,class:n.classes[h.class]}))}}else if(l(a)){s=Object.keys(a).sort();const c=s.length;for(let u=0;u<c;u++){const h=s[u];if(a.hasOwnProperty(h)){const d=a[h];o.push(new Ea({id:h,group:a[h],class:n.classes[d.class]}))}}}this._schema=n,this._groups=o,this._groupIds=s,this._tileset=r,this._statistics=t.statistics,this._extras=t.extras,this._extensions=t.extensions}Object.defineProperties(yB.prototype,{schema:{get:function(){return this._schema}},groups:{get:function(){return this._groups}},groupIds:{get:function(){return this._groupIds}},tileset:{get:function(){return this._tileset}},statistics:{get:function(){return this._statistics}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});const bB={},_ye=new m;bB.checkChildrenWithinParent=function(e){y.typeOf.object("tile",e);const t=e.children,n=t.length,i=e.boundingVolume;if(i instanceof co||i instanceof cc){const r=i._orientedBoundingBox;e._optimChildrenWithinParent=Pf.USE_OPTIMIZATION;for(let s=0;s<n;++s){const a=t[s].boundingVolume;if(!(a instanceof co||a instanceof cc)){e._optimChildrenWithinParent=Pf.SKIP_OPTIMIZATION;break}const c=a._orientedBoundingBox,u=m.subtract(c.center,r.center,_ye),h=m.magnitude(u);m.divideByScalar(u,h,u);const d=Math.abs(r.halfAxes[0]*u.x)+Math.abs(r.halfAxes[1]*u.y)+Math.abs(r.halfAxes[2]*u.z)+Math.abs(r.halfAxes[3]*u.x)+Math.abs(r.halfAxes[4]*u.y)+Math.abs(r.halfAxes[5]*u.z)+Math.abs(r.halfAxes[6]*u.x)+Math.abs(r.halfAxes[7]*u.y)+Math.abs(r.halfAxes[8]*u.z),p=Math.abs(c.halfAxes[0]*u.x)+Math.abs(c.halfAxes[1]*u.y)+Math.abs(c.halfAxes[2]*u.z)+Math.abs(c.halfAxes[3]*u.x)+Math.abs(c.halfAxes[4]*u.y)+Math.abs(c.halfAxes[5]*u.z)+Math.abs(c.halfAxes[6]*u.x)+Math.abs(c.halfAxes[7]*u.y)+Math.abs(c.halfAxes[8]*u.z);if(d<=p+h){e._optimChildrenWithinParent=Pf.SKIP_OPTIMIZATION;break}}}return e._optimChildrenWithinParent===Pf.USE_OPTIMIZATION};function ju(){this._list=new em,this._sentinel=this._list.add(),this._trimTiles=!1}ju.prototype.reset=function(){this._list.splice(this._list.tail,this._sentinel)};ju.prototype.touch=function(e){const t=e.cacheNode;l(t)&&this._list.splice(this._sentinel,t)};ju.prototype.add=function(e){l(e.cacheNode)||(e.cacheNode=this._list.add(e))};ju.prototype.unloadTile=function(e,t,n){const i=t.cacheNode;l(i)&&(this._list.remove(i),t.cacheNode=void 0,n(e,t))};ju.prototype.unloadTiles=function(e,t){const n=this._trimTiles;this._trimTiles=!1;const i=this._list,r=this._sentinel;let s=i.head;for(;s!==r&&(e.totalMemoryUsageInBytes>e.cacheBytes||n);){const o=s.item;s=s.next,this.unloadTile(e,o,t)}};ju.prototype.trim=function(){this._trimTiles=!0};function ob(e){this.tilePropertyName=e,this._minimum=Number.MAX_VALUE,this._maximum=-Number.MAX_VALUE,this._previousMinimum=Number.MAX_VALUE,this._previousMaximum=-Number.MAX_VALUE,this._referenceMinimum={},this._referenceMaximum={}}function TE(e,t){let n;return t==="_loadTimestamp"?n=ue.toDate(e).getTime():n=e,n}ob.prototype.setReferenceMinimumMaximum=function(e,t,n){this._referenceMinimum[n]=TE(e,n),this._referenceMaximum[n]=TE(t,n)};function yye(e,t){const n=e.tilePropertyName;if(l(n)){const i=TE(t[n],n);return l(i)?(e._maximum=Math.max(i,e._maximum),e._minimum=Math.min(i,e._minimum),i):(e.tilePropertyName=void 0,i)}}const BT=[new M(.1,.1,.1,1),new M(.153,.278,.878,1),new M(.827,.231,.49,1),new M(.827,.188,.22,1),new M(1,.592,.259,1),new M(1,.843,0,1)];ob.prototype.colorize=function(e,t){const n=this.tilePropertyName;if(!l(n)||!e.contentAvailable||e._selectedFrame!==t.frameNumber)return;const i=yye(this,e),r=this._previousMinimum,s=this._previousMaximum;if(r===Number.MAX_VALUE||s===-Number.MAX_VALUE)return;const o=s-r+R.EPSILON7,c=R.clamp(i-r,0,o)/o,u=BT.length-1,h=c*u,d=Math.floor(h),p=Math.ceil(h),g=h-d,_=BT[d],b=BT[p],x=M.clone(M.WHITE);x.red=R.lerp(_.red,b.red,g),x.green=R.lerp(_.green,b.green,g),x.blue=R.lerp(_.blue,b.blue,g),e._debugColor=x};ob.prototype.resetMinimumMaximum=function(){const e=this.tilePropertyName;if(l(e)){const t=this._referenceMinimum[e],n=this._referenceMaximum[e],i=l(t)&&l(n);this._previousMinimum=i?t:this._minimum,this._previousMaximum=i?n:this._maximum,this._minimum=Number.MAX_VALUE,this._maximum=-Number.MAX_VALUE}};function pa(){this.selected=0,this.visited=0,this.numberOfCommands=0,this.numberOfAttemptedRequests=0,this.numberOfPendingRequests=0,this.numberOfTilesProcessing=0,this.numberOfTilesWithContentReady=0,this.numberOfTilesTotal=0,this.numberOfLoadedTilesTotal=0,this.numberOfFeaturesSelected=0,this.numberOfFeaturesLoaded=0,this.numberOfPointsSelected=0,this.numberOfPointsLoaded=0,this.numberOfTrianglesSelected=0,this.numberOfTilesStyled=0,this.numberOfFeaturesStyled=0,this.numberOfTilesCulledWithChildrenUnion=0,this.geometryByteLength=0,this.texturesByteLength=0,this.batchTableByteLength=0}pa.prototype.clear=function(){this.selected=0,this.visited=0,this.numberOfCommands=0,this.numberOfAttemptedRequests=0,this.numberOfFeaturesSelected=0,this.numberOfPointsSelected=0,this.numberOfTrianglesSelected=0,this.numberOfTilesStyled=0,this.numberOfFeaturesStyled=0,this.numberOfTilesCulledWithChildrenUnion=0};function ab(e,t,n,i){const r=t.innerContents,s=t.pointsLength,o=t.trianglesLength,a=t.featuresLength,c=t.geometryByteLength,u=t.texturesByteLength,h=t.batchTableByteLength;if(i?(e.numberOfFeaturesLoaded+=n?-a:a,e.numberOfPointsLoaded+=n?-s:s,e.geometryByteLength+=n?-c:c,e.texturesByteLength+=n?-u:u,e.batchTableByteLength+=n?-h:h):(e.numberOfFeaturesSelected+=n?-a:a,e.numberOfPointsSelected+=n?-s:s,e.numberOfTrianglesSelected+=n?-o:o),l(r)){const d=r.length;for(let p=0;p<d;++p)ab(e,r[p],n,i)}}pa.prototype.incrementSelectionCounts=function(e){ab(this,e,!1,!1)};pa.prototype.incrementLoadCounts=function(e){ab(this,e,!1,!0)};pa.prototype.decrementLoadCounts=function(e){ab(this,e,!0,!0)};pa.clone=function(e,t){t.selected=e.selected,t.visited=e.visited,t.numberOfCommands=e.numberOfCommands,t.selected=e.selected,t.numberOfAttemptedRequests=e.numberOfAttemptedRequests,t.numberOfPendingRequests=e.numberOfPendingRequests,t.numberOfTilesProcessing=e.numberOfTilesProcessing,t.numberOfTilesWithContentReady=e.numberOfTilesWithContentReady,t.numberOfTilesTotal=e.numberOfTilesTotal,t.numberOfFeaturesSelected=e.numberOfFeaturesSelected,t.numberOfFeaturesLoaded=e.numberOfFeaturesLoaded,t.numberOfPointsSelected=e.numberOfPointsSelected,t.numberOfPointsLoaded=e.numberOfPointsLoaded,t.numberOfTrianglesSelected=e.numberOfTrianglesSelected,t.numberOfTilesStyled=e.numberOfTilesStyled,t.numberOfFeaturesStyled=e.numberOfFeaturesStyled,t.numberOfTilesCulledWithChildrenUnion=e.numberOfTilesCulledWithChildrenUnion,t.geometryByteLength=e.geometryByteLength,t.texturesByteLength=e.texturesByteLength,t.batchTableByteLength=e.batchTableByteLength};function pm(){this._style=void 0,this._styleDirty=!1,this._lastStyleTime=0}Object.defineProperties(pm.prototype,{style:{get:function(){return this._style},set:function(e){e!==this._style&&(this._style=e,this._styleDirty=!0)}}});pm.prototype.makeDirty=function(){this._styleDirty=!0};pm.prototype.resetDirty=function(){this._styleDirty=!1};pm.prototype.applyStyle=function(e){if(!l(e.root)||l(this._style)&&!this._style._ready)return;const t=this._styleDirty;t&&++this._lastStyleTime;const n=this._lastStyleTime,i=e._statistics,r=t?e._selectedTiles:e._selectedTilesToStyle,s=r.length;for(let o=0;o<s;++o){const a=r[o];if(a.lastStyleTime!==n){const c=a.content;a.lastStyleTime=n,c.applyStyle(this._style),i.numberOfFeaturesStyled+=c.featuresLength,++i.numberOfTilesStyled}}};function bye(e,t,n){const i=oi(t,"3DTILES_implicit_tiling")?t.extensions["3DTILES_implicit_tiling"]:t.implicitTiling;y.typeOf.object("implicitTiling",i),this.baseResource=e,this.geometricError=t.geometricError,this.metadataSchema=n;const r=t.boundingVolume;if(!l(r.box)&&!l(r.region)&&!oi(r,"3DTILES_bounding_volume_S2")&&!oi(r,"3DTILES_bounding_volume_cylinder"))throw new te("Only box, region, 3DTILES_bounding_volume_S2, and 3DTILES_bounding_volume_cylinder are supported for implicit tiling");this.boundingVolume=r,this.refine=t.refine,this.subtreeUriTemplate=new se({url:i.subtrees.uri}),this.contentUriTemplates=[],this.contentHeaders=[];const s=Tye(t);for(let o=0;o<s.length;o++){const a=s[o];this.contentHeaders.push(Se(a,!0));const c=new se({url:a.uri});this.contentUriTemplates.push(c)}this.contentCount=this.contentHeaders.length,this.tileHeader=xye(t),this.subdivisionScheme=Ti[i.subdivisionScheme],this.branchingFactor=Ti.getBranchingFactor(this.subdivisionScheme),this.subtreeLevels=i.subtreeLevels,l(i.availableLevels)?this.availableLevels=i.availableLevels:this.availableLevels=i.maximumLevel+1}function Tye(e){if(oi(e,"3DTILES_multiple_contents")){const t=e.extensions["3DTILES_multiple_contents"];return l(t.contents)?t.contents:t.content}return l(e.contents)?e.contents:l(e.content)?[e.content]:[]}function xye(e){const t=Se(e,!0);return l(t.extensions)&&(delete t.extensions["3DTILES_implicit_tiling"],delete t.extensions["3DTILES_multiple_contents"],Object.keys(t.extensions).length===0&&delete t.extensions),delete t.implicitTiling,delete t.contents,delete t.content,t}function wn(e){if(y.typeOf.string("options.subdivisionScheme",e.subdivisionScheme),y.typeOf.number("options.subtreeLevels",e.subtreeLevels),y.typeOf.number("options.level",e.level),y.typeOf.number("options.x",e.x),y.typeOf.number("options.y",e.y),e.subdivisionScheme===Ti.OCTREE&&y.typeOf.number("options.z",e.z),e.level<0)throw new A("level must be non-negative");if(e.x<0)throw new A("x must be non-negative");if(e.y<0)throw new A("y must be non-negative");if(e.subdivisionScheme===Ti.OCTREE&&e.z<0)throw new A("z must be non-negative");const t=1<<e.level;if(e.x>=t)throw new A("x is out of range");if(e.y>=t)throw new A("y is out of range");if(e.subdivisionScheme===Ti.OCTREE&&e.z>=t)throw new A("z is out of range");this.subdivisionScheme=e.subdivisionScheme,this.subtreeLevels=e.subtreeLevels,this.level=e.level,this.x=e.x,this.y=e.y,this.z=void 0,e.subdivisionScheme===Ti.OCTREE&&(this.z=e.z)}Object.defineProperties(wn.prototype,{childIndex:{get:function(){let e=0;return e|=this.x&1,e|=(this.y&1)<<1,this.subdivisionScheme===Ti.OCTREE&&(e|=(this.z&1)<<2),e}},mortonIndex:{get:function(){return this.subdivisionScheme===Ti.OCTREE?wl.encode3D(this.x,this.y,this.z):wl.encode2D(this.x,this.y)}},tileIndex:{get:function(){const e=this.subdivisionScheme===Ti.OCTREE?((1<<3*this.level)-1)/7:((1<<2*this.level)-1)/3,t=this.mortonIndex;return e+t}}});function Xw(e,t){if(e.subdivisionScheme!==t.subdivisionScheme)throw new A("coordinates must have same subdivisionScheme");if(e.subtreeLevels!==t.subtreeLevels)throw new A("coordinates must have same subtreeLevels")}wn.prototype.getDescendantCoordinates=function(e){y.typeOf.object("offsetCoordinates",e),Xw(this,e);const t=this.level+e.level,n=(this.x<<e.level)+e.x,i=(this.y<<e.level)+e.y;if(this.subdivisionScheme===Ti.OCTREE){const r=(this.z<<e.level)+e.z;return new wn({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:t,x:n,y:i,z:r})}return new wn({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:t,x:n,y:i})};wn.prototype.getAncestorCoordinates=function(e){if(y.typeOf.number("offsetLevels",e),e<0)throw new A("offsetLevels must be non-negative");if(e>this.level)throw new A("ancestor cannot be above the tileset root");const t=1<<e,n=this.level-e,i=Math.floor(this.x/t),r=Math.floor(this.y/t);if(this.subdivisionScheme===Ti.OCTREE){const s=Math.floor(this.z/t);return new wn({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:n,x:i,y:r,z:s})}return new wn({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:n,x:i,y:r})};wn.prototype.getOffsetCoordinates=function(e){if(y.typeOf.object("descendantCoordinates",e),!this.isEqual(e)&&!this.isAncestor(e))throw new A("this is not an ancestor of descendant");Xw(this,e);const t=e.level-this.level,n=1<<t,i=e.x%n,r=e.y%n;if(this.subdivisionScheme===Ti.OCTREE){const s=e.z%n;return new wn({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:t,x:i,y:r,z:s})}return new wn({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:t,x:i,y:r})};wn.prototype.getChildCoordinates=function(e){y.typeOf.number("childIndex",e);const t=Ti.getBranchingFactor(this.subdivisionScheme);if(e<0||t<=e)throw new A(`childIndex must be at least 0 and less than ${t}`);const n=this.level+1,i=2*this.x+e%2,r=2*this.y+Math.floor(e/2)%2;if(this.subdivisionScheme===Ti.OCTREE){const s=2*this.z+Math.floor(e/4)%2;return new wn({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:n,x:i,y:r,z:s})}return new wn({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:n,x:i,y:r})};wn.prototype.getSubtreeCoordinates=function(){return this.getAncestorCoordinates(this.level%this.subtreeLevels)};wn.prototype.getParentSubtreeCoordinates=function(){return this.getAncestorCoordinates(this.level%this.subtreeLevels+this.subtreeLevels)};wn.prototype.isAncestor=function(e){y.typeOf.object("descendantCoordinates",e),Xw(this,e);const t=e.level-this.level;if(t<=0)return!1;const n=e.x>>t,i=e.y>>t,r=this.x===n,s=this.y===i;if(this.subdivisionScheme===Ti.OCTREE){const o=e.z>>t,a=this.z===o;return r&&s&&a}return r&&s};wn.prototype.isEqual=function(e){return y.typeOf.object("otherCoordinates",e),this.subdivisionScheme===e.subdivisionScheme&&this.subtreeLevels===e.subtreeLevels&&this.level===e.level&&this.x===e.x&&this.y===e.y&&(this.subdivisionScheme===Ti.OCTREE?this.z===e.z:!0)};wn.prototype.isImplicitTilesetRoot=function(){return this.level===0};wn.prototype.isSubtreeRoot=function(){return this.level%this.subtreeLevels===0};wn.prototype.isBottomOfSubtree=function(){return this.level%this.subtreeLevels===this.subtreeLevels-1};wn.prototype.getTemplateValues=function(){const e={level:this.level,x:this.x,y:this.y};return this.subdivisionScheme===Ti.OCTREE&&(e.z=this.z),e};const LO=[0,0,0];wn.fromMortonIndex=function(e,t,n,i){let r;return e===Ti.OCTREE?(r=wl.decode3D(i,LO),new wn({subdivisionScheme:e,subtreeLevels:t,level:n,x:r[0],y:r[1],z:r[2]})):(r=wl.decode2D(i,LO),new wn({subdivisionScheme:e,subtreeLevels:t,level:n,x:r[0],y:r[1]}))};wn.fromTileIndex=function(e,t,n){let i,r,s;return e===Ti.OCTREE?(i=Math.floor(R.log2(7*n+1)/3),r=((1<<3*i)-1)/7,s=n-r):(i=Math.floor(R.log2(3*n+1)/2),r=((1<<2*i)-1)/3,s=n-r),wn.fromMortonIndex(e,t,i,s)};function pi(){}pi.selectTiles=function(e,t){A.throwInstantiationError()};pi.sortChildrenByDistanceToCamera=function(e,t){return t._distanceToCamera===0&&e._distanceToCamera===0?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera};pi.canTraverse=function(e){return e.children.length===0?!1:e.hasTilesetContent||e.hasImplicitContent?!e.contentExpired:e._screenSpaceError>e.tileset.memoryAdjustedScreenSpaceError};pi.selectTile=function(e,t){if(e.contentVisibility(t)===ut.OUTSIDE)return;e._wasSelectedLastFrame=!0;const{content:n,tileset:i}=e;n.featurePropertiesDirty?(n.featurePropertiesDirty=!1,e.lastStyleTime=0,i._selectedTilesToStyle.push(e)):e._selectedFrame<t.frameNumber-1&&(i._selectedTilesToStyle.push(e),e._wasSelectedLastFrame=!1),e._selectedFrame=t.frameNumber,i._selectedTiles.push(e)};pi.visitTile=function(e,t){++e.tileset._statistics.visited,e._visitedFrame=t.frameNumber};pi.touchTile=function(e,t){e._touchedFrame!==t.frameNumber&&(e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber)};pi.loadTile=function(e,t){const{tileset:n}=e;if(e._requestedFrame===t.frameNumber||!e.hasUnloadedRenderableContent&&!e.contentExpired||!Eye(e,t))return;const i=t.camera.timeSinceMoved<n.foveatedTimeDelay;e.priorityDeferred&&i||(e._requestedFrame=t.frameNumber,n._requestedTiles.push(e))};function Eye(e,t){const{tileset:n}=e;if(!n._cullRequestsWhileMoving)return!0;const{positionWCDeltaMagnitude:i,positionWCDeltaMagnitudeLastFrame:r}=t.camera,s=i!==0?i:r,o=Math.max(e.boundingSphere.radius*2,1);return n.cullRequestsWhileMovingMultiplier*s/o<1}pi.updateTile=function(e,t){TB(e,t),e.updateExpiration(),e._wasMinPriorityChild=!1,e._priorityHolder=e,Aye(e),e._shouldSelect=!1,e._finalResolution=!0};function TB(e,t){if(e.updateVisibility(t),!e.isVisible)return;const n=e.children.length>0;if((e.hasTilesetContent||e.hasImplicitContent)&&n){const s=e.children[0];TB(s,t),e._visible=s._visible;return}if(Cye(e,t)){e._visible=!1;return}const i=e.refine===sr.REPLACE,r=e._optimChildrenWithinParent===Pf.USE_OPTIMIZATION;if(i&&r&&n&&!wye(e,t)){++e.tileset._statistics.numberOfTilesCulledWithChildrenUnion,e._visible=!1;return}}function Cye(e,t){const{parent:n,tileset:i}=e;return!l(n)||n.hasTilesetContent||n.hasImplicitContent||n.refine!==sr.ADD?!1:e.getScreenSpaceError(t,!0)<=i.memoryAdjustedScreenSpaceError}function wye(e,t){let n=!1;const i=e.children;for(let r=0;r<i.length;++r){const s=i[r];s.updateVisibility(t),n=n||s.isVisible}return n}function Aye(e){const t=e.tileset._minimumPriority,n=e.tileset._maximumPriority,i=e._priorityHolder;n.distance=Math.max(i._distanceToCamera,n.distance),t.distance=Math.min(i._distanceToCamera,t.distance),n.depth=Math.max(e._depth,n.depth),t.depth=Math.min(e._depth,t.depth),n.foveatedFactor=Math.max(i._foveatedFactor,n.foveatedFactor),t.foveatedFactor=Math.min(i._foveatedFactor,t.foveatedFactor),n.reverseScreenSpaceError=Math.max(e._priorityReverseScreenSpaceError,n.reverseScreenSpaceError),t.reverseScreenSpaceError=Math.min(e._priorityReverseScreenSpaceError,t.reverseScreenSpaceError)}function xB(){}const vd={stack:new cr,stackMaximumLength:0};xB.selectTiles=function(e,t){e._selectedTiles.length=0,e._requestedTiles.length=0,e.hasMixedContent=!1;let n=!0;const i=e.root;if(i.updateVisibility(t),!i.isVisible)return n;const{touchTile:r,visitTile:s}=pi,o=vd.stack;for(o.push(i);o.length>0;){vd.stackMaximumLength=Math.max(vd.stackMaximumLength,o.length);const a=o.pop(),c=a.refine===sr.ADD,u=a.refine===sr.REPLACE,h=Sye(a);h&&vye(a,o,t),(c||u&&!h)&&(Iye(e,a),r(a,t),Oye(a,t),a.hasRenderableContent&&!a.contentAvailable&&(n=!1)),s(a,t)}return vd.stack.trim(vd.stackMaximumLength),n};function Sye(e){return e.children.length===0?!1:e.hasTilesetContent||e.hasImplicitContent?!e.contentExpired:(e.hasEmptyContent,!0)}function vye(e,t,n){const{children:i}=e;for(let r=0;r<i.length;++r){const s=i[r];s.updateVisibility(n),s.isVisible&&t.push(s)}}function Iye(e,t){(t.hasUnloadedRenderableContent||t.contentExpired)&&(t._priority=0,e._requestedTiles.push(t))}function Oye(e,t){e.contentAvailable&&e.contentVisibility(t)!==ut.OUTSIDE&&e.tileset._selectedTiles.push(e)}function EB(){}const sp={stack:new cr,stackMaximumLength:0},op={stack:new cr,stackMaximumLength:0};EB.selectTiles=function(e,t){if(e._requestedTiles.length=0,e.debugFreezeFrame)return;e._selectedTiles.length=0,e._selectedTilesToStyle.length=0,e._emptyTiles.length=0,e.hasMixedContent=!1;const n=e.root;if(pi.updateTile(n,t),!n.isVisible||n.getScreenSpaceError(t,!0)<=e.memoryAdjustedScreenSpaceError)return;Dye(n,t),sp.stack.trim(sp.stackMaximumLength),op.stack.trim(op.stackMaximumLength);const i=e._requestedTiles;for(let r=0;r<i.length;++r)i[r].updatePriority()};function zT(e,t){e.contentAvailable&&pi.selectTile(e,t)}function Rye(e,t,n){const i=e.refine===sr.REPLACE,{tileset:r,children:s}=e,{updateTile:o,loadTile:a,touchTile:c}=pi;for(let _=0;_<s.length;++_)o(s[_],n);s.sort(pi.sortChildrenByDistanceToCamera);const u=i&&e.hasRenderableContent;let h=!0,d=!1,p=-1,g=Number.MAX_VALUE;for(let _=0;_<s.length;++_){const b=s[_];if(b.isVisible?(t.push(b),b._foveatedFactor<g&&(p=_,g=b._foveatedFactor),d=!0):(u||r.loadSiblings)&&(b._foveatedFactor<g&&(p=_,g=b._foveatedFactor),a(b,n),c(b,n)),u){let x;b._inRequestVolume?b.hasRenderableContent?x=b.contentAvailable:x=Mye(b,n):x=!1,h=h&&x}}if(d||(h=!1),p!==-1&&i){const _=s[p];_._wasMinPriorityChild=!0;const b=(e._wasMinPriorityChild||e===r.root)&&g<=e._priorityHolder._foveatedFactor?e._priorityHolder:e;b._foveatedFactor=Math.min(_._foveatedFactor,b._foveatedFactor),b._distanceToCamera=Math.min(_._distanceToCamera,b._distanceToCamera);for(let x=0;x<s.length;++x)s[x]._priorityHolder=b}return h}function Dye(e,t){const{tileset:n}=e,{canTraverse:i,loadTile:r,visitTile:s,touchTile:o}=pi,a=sp.stack;for(a.push(e);a.length>0;){sp.stackMaximumLength=Math.max(sp.stackMaximumLength,a.length);const c=a.pop(),u=c.parent,h=!l(u)||u._refines;c._refines=i(c)?Rye(c,a,t)&&h:!1;const d=!c._refines&&h;c.hasRenderableContent?c.refine===sr.ADD?(zT(c,t),r(c,t)):c.refine===sr.REPLACE&&(r(c,t),d&&zT(c,t)):(n._emptyTiles.push(c),r(c,t),d&&zT(c,t)),s(c,t),o(c,t)}}function Mye(e,t){const{canTraverse:n,updateTile:i,loadTile:r,touchTile:s}=pi;let o=!0;const a=op.stack;for(a.push(e);a.length>0;){op.stackMaximumLength=Math.max(op.stackMaximumLength,a.length);const c=a.pop(),u=c.children,h=u.length,d=!c.hasRenderableContent&&n(c);if(!d&&!c.contentAvailable&&(o=!1),i(c,t),c.isVisible||(r(c,t),s(c,t)),d)for(let p=0;p<h;++p){const g=u[p];a.push(g)}}return e.hasEmptyContent||o}function CB(){}const ap={stack:new cr,stackMaximumLength:0},cp={stack:new cr,stackMaximumLength:0},Ha={stack:new cr,stackMaximumLength:0,ancestorStack:new cr,ancestorStackMaximumLength:0},Lye=2;CB.selectTiles=function(e,t){if(e._requestedTiles.length=0,e.debugFreezeFrame)return;e._selectedTiles.length=0,e._selectedTilesToStyle.length=0,e._emptyTiles.length=0,e.hasMixedContent=!1;const n=e.root;if(pi.updateTile(n,t),!n.isVisible||n.getScreenSpaceError(t,!0)<=e.memoryAdjustedScreenSpaceError)return;Uye(n,t),kye(n,t),ap.stack.trim(ap.stackMaximumLength),cp.stack.trim(cp.stackMaximumLength),Ha.stack.trim(Ha.stackMaximumLength),Ha.ancestorStack.trim(Ha.ancestorStackMaximumLength);const i=e._requestedTiles;for(let r=0;r<i.length;++r)i[r].updatePriority()};function Pye(e,t){const{updateTile:n,touchTile:i,selectTile:r}=pi,s=cp.stack;for(s.push(e);s.length>0;){cp.stackMaximumLength=Math.max(cp.stackMaximumLength,s.length);const a=s.pop().children;for(let c=0;c<a.length;++c){const u=a[c];u.isVisible&&(u.contentAvailable?(n(u,t),i(u,t),r(u,t)):u._depth-e._depth<Lye&&s.push(u))}}}function Rg(e,t){const n=e.contentAvailable?e:e._ancestorWithContentAvailable;l(n)?n._shouldSelect=!0:Pye(e,t)}function Nye(e,t){e._ancestorWithContent=void 0,e._ancestorWithContentAvailable=void 0;const{parent:n}=e;if(!l(n))return;const i=!n.hasUnloadedRenderableContent||n._requestedFrame===t.frameNumber;e._ancestorWithContent=i?n:n._ancestorWithContent,e._ancestorWithContentAvailable=n.contentAvailable?n:n._ancestorWithContentAvailable}function Fye(e,t){const n=t._ancestorWithContent;return!e.immediatelyLoadDesiredLevelOfDetail&&(t._priorityProgressiveResolutionScreenSpaceErrorLeaf||l(n)&&t._screenSpaceError<n._screenSpaceError/e.skipScreenSpaceErrorFactor&&t._depth>n._depth+e.skipLevels)}function Bye(e,t,n){const{tileset:i,children:r}=e,{updateTile:s,loadTile:o,touchTile:a}=pi;for(let u=0;u<r.length;++u)s(r[u],n);r.sort(pi.sortChildrenByDistanceToCamera);let c=!1;for(let u=0;u<r.length;++u){const h=r[u];h.isVisible?(t.push(h),c=!0):i.loadSiblings&&(o(h,n),a(h,n))}return c}function zye(e,t){const{tileset:n}=e;return n.immediatelyLoadDesiredLevelOfDetail?!1:l(e._ancestorWithContent)?e._screenSpaceError===0?e.parent._screenSpaceError>t:e._screenSpaceError>t:!0}function Uye(e,t){const{tileset:n}=e,i=n.immediatelyLoadDesiredLevelOfDetail?Number.MAX_VALUE:Math.max(n.baseScreenSpaceError,n.memoryAdjustedScreenSpaceError),{canTraverse:r,loadTile:s,visitTile:o,touchTile:a}=pi,c=ap.stack;for(c.push(e);c.length>0;){ap.stackMaximumLength=Math.max(ap.stackMaximumLength,c.length);const u=c.pop();Nye(u,t);const h=u.parent,d=!l(h)||h._refines;u._refines=r(u)?Bye(u,c,t)&&d:!1;const p=!u._refines&&d;u.hasRenderableContent?u.refine===sr.ADD?(Rg(u,t),s(u,t)):u.refine===sr.REPLACE&&(zye(u,i)?(s(u,t),p&&Rg(u,t)):p?(Rg(u,t),s(u,t)):Fye(n,u)&&s(u,t)):(n._emptyTiles.push(u),s(u,t),p&&Rg(u,t)),o(u,t),a(u,t)}}function kye(e,t){const{selectTile:n,canTraverse:i}=pi,{stack:r,ancestorStack:s}=Ha;let o;for(r.push(e);r.length>0||s.length>0;){if(Ha.stackMaximumLength=Math.max(Ha.stackMaximumLength,r.length),Ha.ancestorStackMaximumLength=Math.max(Ha.ancestorStackMaximumLength,s.length),s.length>0){const u=s.peek();if(u._stackLength===r.length){s.pop(),u!==o&&(u._finalResolution=!1),n(u,t);continue}}const a=r.pop();if(!l(a))continue;const c=i(a);if(a._shouldSelect)if(a.refine===sr.ADD)n(a,t);else{if(a._selectionDepth=s.length,a._selectionDepth>0&&(a.tileset.hasMixedContent=!0),o=a,!c){n(a,t);continue}s.push(a),a._stackLength=r.length}if(c){const u=a.children;for(let h=0;h<u.length;++h){const d=u[h];d.isVisible&&r.push(d)}}}}function Ln(e){e=T(e,T.EMPTY_OBJECT),this._url=void 0,this._basePath=void 0,this._root=void 0,this._resource=void 0,this._asset=void 0,this._properties=void 0,this._geometricError=void 0,this._scaledGeometricError=void 0,this._extensionsUsed=void 0,this._extensions=void 0,this._modelUpAxis=void 0,this._modelForwardAxis=void 0,this._cache=new ju,this._processingQueue=[],this._selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this._selectedTilesToStyle=[],this._loadTimestamp=void 0,this._timeSinceLoad=0,this._updatedVisibilityFrame=0,this._updatedModelMatrixFrame=0,this._modelMatrixChanged=!1,this._previousModelMatrix=void 0,this._extras=void 0,this._credits=void 0,this._showCreditsOnScreen=T(e.showCreditsOnScreen,!1),this._cullWithChildrenBounds=T(e.cullWithChildrenBounds,!0),this._allTilesAdditive=!0,this._hasMixedContent=!1,this._stencilClearCommand=void 0,this._backfaceCommands=new cr,this._maximumScreenSpaceError=T(e.maximumScreenSpaceError,16),this._memoryAdjustedScreenSpaceError=this._maximumScreenSpaceError,this._cacheBytes=T(e.cacheBytes,512*1024*1024),y.typeOf.number.greaterThanOrEquals("cacheBytes",this._cacheBytes,0);const t=T(e.maximumCacheOverflowBytes,512*1024*1024);y.typeOf.number.greaterThanOrEquals("maximumCacheOverflowBytes",t,0),this._maximumCacheOverflowBytes=t,this._styleEngine=new pm,this._styleApplied=!1,this._modelMatrix=l(e.modelMatrix)?P.clone(e.modelMatrix):P.clone(P.IDENTITY),this._addHeightCallbacks=[],this._statistics=new pa,this._statisticsLast=new pa,this._statisticsPerPass=new Array(So.NUMBER_OF_PASSES);for(let r=0;r<So.NUMBER_OF_PASSES;++r)this._statisticsPerPass[r]=new pa;this._requestedTilesInFlight=[],this._maximumPriority={foveatedFactor:-Number.MAX_VALUE,depth:-Number.MAX_VALUE,distance:-Number.MAX_VALUE,reverseScreenSpaceError:-Number.MAX_VALUE},this._minimumPriority={foveatedFactor:Number.MAX_VALUE,depth:Number.MAX_VALUE,distance:Number.MAX_VALUE,reverseScreenSpaceError:Number.MAX_VALUE},this._heatmap=new ob(e.debugHeatmapTilePropertyName),this.cullRequestsWhileMoving=T(e.cullRequestsWhileMoving,!0),this._cullRequestsWhileMoving=!1,this.cullRequestsWhileMovingMultiplier=T(e.cullRequestsWhileMovingMultiplier,60),this.progressiveResolutionHeightFraction=R.clamp(T(e.progressiveResolutionHeightFraction,.3),0,.5),this.preferLeaves=T(e.preferLeaves,!1),this._tilesLoaded=!1,this._initialTilesLoaded=!1,this._tileDebugLabels=void 0,this._classificationType=e.classificationType,this._ellipsoid=T(e.ellipsoid,fe.WGS84),this._initialClippingPlanesOriginMatrix=P.IDENTITY,this._clippingPlanesOriginMatrix=void 0,this._clippingPlanesOriginMatrixDirty=!0,this._vectorClassificationOnly=T(e.vectorClassificationOnly,!1),this._vectorKeepDecodedPositions=T(e.vectorKeepDecodedPositions,!1),this.preloadWhenHidden=T(e.preloadWhenHidden,!1),this.preloadFlightDestinations=T(e.preloadFlightDestinations,!0),this._pass=void 0,this.dynamicScreenSpaceError=T(e.dynamicScreenSpaceError,!0),this.foveatedScreenSpaceError=T(e.foveatedScreenSpaceError,!0),this._foveatedConeSize=T(e.foveatedConeSize,.1),this._foveatedMinimumScreenSpaceErrorRelaxation=T(e.foveatedMinimumScreenSpaceErrorRelaxation,0),this.foveatedInterpolationCallback=T(e.foveatedInterpolationCallback,R.lerp),this.foveatedTimeDelay=T(e.foveatedTimeDelay,.2),this.dynamicScreenSpaceErrorDensity=T(e.dynamicScreenSpaceErrorDensity,2e-4),this.dynamicScreenSpaceErrorFactor=T(e.dynamicScreenSpaceErrorFactor,24),this.dynamicScreenSpaceErrorHeightFalloff=T(e.dynamicScreenSpaceErrorHeightFalloff,.25),this._dynamicScreenSpaceErrorComputedDensity=0,this.shadows=T(e.shadows,rc.ENABLED),this.show=T(e.show,!0),this.colorBlendMode=c_.HIGHLIGHT,this.colorBlendAmount=.5,this._pointCloudShading=new Rw(e.pointCloudShading),this._pointCloudEyeDomeLighting=new zu,this.loadProgress=new jt,this.allTilesLoaded=new jt,this.initialTilesLoaded=new jt,this.tileLoad=new jt,this.tileUnload=new jt,this.tileFailed=new jt,this.tileVisible=new jt,this.skipLevelOfDetail=T(e.skipLevelOfDetail,!1),this._disableSkipLevelOfDetail=!1,this.baseScreenSpaceError=T(e.baseScreenSpaceError,1024),this.skipScreenSpaceErrorFactor=T(e.skipScreenSpaceErrorFactor,16),this.skipLevels=T(e.skipLevels,1),this.immediatelyLoadDesiredLevelOfDetail=T(e.immediatelyLoadDesiredLevelOfDetail,!1),this.loadSiblings=T(e.loadSiblings,!1),this._clippingPlanes=void 0,l(e.clippingPlanes)&&di.setOwner(e.clippingPlanes,this,"_clippingPlanes"),this._clippingPolygons=void 0,l(e.clippingPolygons)&&jn.setOwner(e.clippingPolygons,this,"_clippingPolygons"),l(e.imageBasedLighting)?(this._imageBasedLighting=e.imageBasedLighting,this._shouldDestroyImageBasedLighting=!1):(this._imageBasedLighting=new Lh,this._shouldDestroyImageBasedLighting=!0),this.lightColor=e.lightColor,this.backFaceCulling=T(e.backFaceCulling,!0),this._enableShowOutline=T(e.enableShowOutline,!0),this.showOutline=T(e.showOutline,!0),this.outlineColor=T(e.outlineColor,M.BLACK),this.splitDirection=T(e.splitDirection,tm.NONE),this.enableCollision=T(e.enableCollision,!1),this._projectTo2D=T(e.projectTo2D,!1),this._enablePick=T(e.enablePick,!1),this.debugFreezeFrame=T(e.debugFreezeFrame,!1),this.debugColorizeTiles=T(e.debugColorizeTiles,!1),this._enableDebugWireframe=T(e.enableDebugWireframe,!1),this.debugWireframe=T(e.debugWireframe,!1),this.debugWireframe===!0&&this._enableDebugWireframe===!1&&kr("tileset-debug-wireframe-ignored","enableDebugWireframe must be set to true in the Cesium3DTileset constructor, otherwise debugWireframe will be ignored."),this.debugShowBoundingVolume=T(e.debugShowBoundingVolume,!1),this.debugShowContentBoundingVolume=T(e.debugShowContentBoundingVolume,!1),this.debugShowViewerRequestVolume=T(e.debugShowViewerRequestVolume,!1),this._tileDebugLabels=void 0,this.debugPickedTileLabelOnly=!1,this.debugPickedTile=void 0,this.debugPickPosition=void 0,this.debugShowGeometricError=T(e.debugShowGeometricError,!1),this.debugShowRenderingStatistics=T(e.debugShowRenderingStatistics,!1),this.debugShowMemoryUsage=T(e.debugShowMemoryUsage,!1),this.debugShowUrl=T(e.debugShowUrl,!1),this.examineVectorLinesFunction=void 0,this._metadataExtension=void 0,this._customShader=e.customShader;let n=T(e.featureIdLabel,"featureId_0");typeof n=="number"&&(n=`featureId_${n}`),this._featureIdLabel=n;let i=T(e.instanceFeatureIdLabel,"instanceFeatureId_0");typeof i=="number"&&(i=`instanceFeatureId_${i}`),this._instanceFeatureIdLabel=i}Object.defineProperties(Ln.prototype,{isCesium3DTileset:{get:function(){return!0}},asset:{get:function(){return this._asset}},extensions:{get:function(){return this._extensions}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){di.setOwner(e,this,"_clippingPlanes")}},clippingPolygons:{get:function(){return this._clippingPolygons},set:function(e){jn.setOwner(e,this,"_clippingPolygons")}},properties:{get:function(){return this._properties}},tilesLoaded:{get:function(){return this._tilesLoaded}},resource:{get:function(){return this._resource}},basePath:{get:function(){return pc("Cesium3DTileset.basePath","Cesium3DTileset.basePath has been deprecated. All tiles are relative to the url of the tileset JSON file that contains them. Use the url property instead."),this._basePath}},style:{get:function(){return this._styleEngine.style},set:function(e){this._styleEngine.style=e}},customShader:{get:function(){return this._customShader},set:function(e){this._customShader=e}},hasMixedContent:{get:function(){return this._hasMixedContent},set:function(e){y.typeOf.bool("value",e),this._hasMixedContent=e}},isSkippingLevelOfDetail:{get:function(){return this.skipLevelOfDetail&&!l(this._classificationType)&&!this._disableSkipLevelOfDetail&&!this._allTilesAdditive}},metadataExtension:{get:function(){return this._metadataExtension}},metadata:{get:function(){if(l(this._metadataExtension))return this._metadataExtension.tileset}},schema:{get:function(){if(l(this._metadataExtension))return this._metadataExtension.schema}},maximumScreenSpaceError:{get:function(){return this._maximumScreenSpaceError},set:function(e){y.typeOf.number.greaterThanOrEquals("maximumScreenSpaceError",e,0),this._maximumScreenSpaceError=e,this._memoryAdjustedScreenSpaceError=e}},cacheBytes:{get:function(){return this._cacheBytes},set:function(e){y.typeOf.number.greaterThanOrEquals("value",e,0),this._cacheBytes=e}},maximumCacheOverflowBytes:{get:function(){return this._maximumCacheOverflowBytes},set:function(e){y.typeOf.number.greaterThanOrEquals("value",e,0),this._maximumCacheOverflowBytes=e}},memoryAdjustedScreenSpaceError:{get:function(){return this._memoryAdjustedScreenSpaceError}},pointCloudShading:{get:function(){return this._pointCloudShading},set:function(e){y.defined("pointCloudShading",e),this._pointCloudShading=e}},root:{get:function(){return this._root}},boundingSphere:{get:function(){return this._root.updateTransform(this._modelMatrix),this._root.boundingSphere}},modelMatrix:{get:function(){return this._modelMatrix},set:function(e){this._modelMatrix=P.clone(e,this._modelMatrix)}},timeSinceLoad:{get:function(){return this._timeSinceLoad}},totalMemoryUsageInBytes:{get:function(){const e=this._statistics;return e.texturesByteLength+e.geometryByteLength+e.batchTableByteLength}},clippingPlanesOriginMatrix:{get:function(){return l(this._clippingPlanesOriginMatrix)?(this._clippingPlanesOriginMatrixDirty&&(P.multiply(this.root.computedTransform,this._initialClippingPlanesOriginMatrix,this._clippingPlanesOriginMatrix),this._clippingPlanesOriginMatrixDirty=!1),this._clippingPlanesOriginMatrix):P.IDENTITY}},styleEngine:{get:function(){return this._styleEngine}},statistics:{get:function(){return this._statistics}},classificationType:{get:function(){return this._classificationType}},ellipsoid:{get:function(){return this._ellipsoid}},foveatedConeSize:{get:function(){return this._foveatedConeSize},set:function(e){y.typeOf.number.greaterThanOrEquals("foveatedConeSize",e,0),y.typeOf.number.lessThanOrEquals("foveatedConeSize",e,1),this._foveatedConeSize=e}},foveatedMinimumScreenSpaceErrorRelaxation:{get:function(){return this._foveatedMinimumScreenSpaceErrorRelaxation},set:function(e){y.typeOf.number.greaterThanOrEquals("foveatedMinimumScreenSpaceErrorRelaxation",e,0),y.typeOf.number.lessThanOrEquals("foveatedMinimumScreenSpaceErrorRelaxation",e,this.maximumScreenSpaceError),this._foveatedMinimumScreenSpaceErrorRelaxation=e}},extras:{get:function(){return this._extras}},imageBasedLighting:{get:function(){return this._imageBasedLighting},set:function(e){y.typeOf.object("imageBasedLighting",this._imageBasedLighting),e!==this._imageBasedLighting&&(this._shouldDestroyImageBasedLighting&&!this._imageBasedLighting.isDestroyed()&&this._imageBasedLighting.destroy(),this._imageBasedLighting=e,this._shouldDestroyImageBasedLighting=!1)}},vectorClassificationOnly:{get:function(){return this._vectorClassificationOnly}},vectorKeepDecodedPositions:{get:function(){return this._vectorKeepDecodedPositions}},showCreditsOnScreen:{get:function(){return this._showCreditsOnScreen},set:function(e){this._showCreditsOnScreen=e,IB(this)}},featureIdLabel:{get:function(){return this._featureIdLabel},set:function(e){typeof e=="number"&&(e=`featureId_${e}`),y.typeOf.string("value",e),this._featureIdLabel=e}},instanceFeatureIdLabel:{get:function(){return this._instanceFeatureIdLabel},set:function(e){typeof e=="number"&&(e=`instanceFeatureId_${e}`),y.typeOf.string("value",e),this._instanceFeatureIdLabel=e}}});Ln.fromIonAssetId=async function(e,t){y.defined("assetId",e);const n=await qi.fromAssetId(e);return Ln.fromUrl(n,t)};Ln.fromUrl=async function(e,t){y.defined("url",e),t=T(t,T.EMPTY_OBJECT);const n=se.createIfNeeded(e);let i;n.extension==="json"?i=n.getBaseUri(!0):n.isDataUri&&(i="");const r=await Ln.loadJson(n),s=await jye(n,r),o=new Ln(t);o._resource=n,o._url=n.url,o._basePath=i,o._metadataExtension=s,o._geometricError=r.geometricError,o._scaledGeometricError=r.geometricError;const a=r.asset;o._asset=a,o._extras=r.extras,IB(o);const c=l(r.asset.gltfUpAxis)?ir.fromName(r.asset.gltfUpAxis):ir.Y,u=T(t.modelUpAxis,c),h=T(t.modelForwardAxis,ir.X);o._properties=r.properties,o._extensionsUsed=r.extensionsUsed,o._extensions=r.extensions,o._modelUpAxis=u,o._modelForwardAxis=h,o._root=o.loadTileset(n,r);const p=o._root.createBoundingVolume(r.root.boundingVolume,P.IDENTITY).boundingSphere.center,g=o._ellipsoid.cartesianToCartographic(p);return l(g)&&g.height>on._defaultMinTerrainHeight&&(o._initialClippingPlanesOriginMatrix=et.eastNorthUpToFixedFrame(p)),o._clippingPlanesOriginMatrix=P.clone(o._initialClippingPlanesOriginMatrix),o};Ln.loadJson=function(e){return se.createIfNeeded(e).fetchJson()};Ln.prototype.makeStyleDirty=function(){this._styleEngine.makeDirty()};Ln.prototype.loadTileset=function(e,t,n){const i=t.asset;if(!l(i))throw new te("Tileset must have an asset property.");if(i.version!=="0.0"&&i.version!=="1.0"&&i.version!=="1.1")throw new te("The tileset must be 3D Tiles version 0.0, 1.0, or 1.1");l(t.extensionsRequired)&&Ln.checkSupportedExtensions(t.extensionsRequired);const r=this._statistics,s=i.tilesetVersion;l(s)&&(this._basePath+=`?v=${s}`,e=e.clone(),e.setQueryParameters({v:s}));const o=PO(this,e,t.root,n);l(n)&&(n.children.push(o),o._depth=n._depth+1);const a=[];for(a.push(o);a.length>0;){const c=a.pop();++r.numberOfTilesTotal,this._allTilesAdditive=this._allTilesAdditive&&c.refine===sr.ADD;const u=c._header.children;if(l(u))for(let h=0;h<u.length;++h){const d=u[h],p=PO(this,e,d,c);c.children.push(p),p._depth=c._depth+1,a.push(p)}this._cullWithChildrenBounds&&bB.checkChildrenWithinParent(c)}return o};function PO(e,t,n,i){if(!(l(n.implicitTiling)||oi(n,"3DTILES_implicit_tiling")))return new xn(e,t,n,i);const s=e.schema,o=new bye(t,n,s),a=new wn({subdivisionScheme:o.subdivisionScheme,subtreeLevels:o.subtreeLevels,level:0,x:0,y:0,z:0}),c=o.subtreeUriTemplate.getDerivedResource({templateValues:a.getTemplateValues()}).url,h=Se(n,!0);h.contents=[{uri:c}],delete h.content,delete h.extensions;const d=new xn(e,t,h,i);return d.implicitTileset=o,d.implicitCoordinates=a,d}async function jye(e,t){const n=oi(t,"3DTILES_metadata")?t.extensions["3DTILES_metadata"]:t;let i;if(l(n.schemaUri))e=e.getDerivedResource({url:n.schemaUri}),i=Re.getSchemaLoader({resource:e});else if(l(n.schema))i=Re.getSchemaLoader({schema:n.schema});else return;await i.load();const r=new yB({schema:i.schema,metadataJson:n});return Re.unload(i),r}const NO=new m,Vye=new oe,Gye=new P,Hye=new m,qye=new m,Wye=new m,$ye=new m;function Xye(e,t){let n,i,r,s,o;const a=t.camera,c=e._root,u=c.contentBoundingVolume;if(u instanceof cc)n=m.normalize(a.positionWC,NO),i=a.directionWC,r=a.positionCartographic.height,s=u.minimumHeight,o=u.maximumHeight;else{const b=P.inverseTransformation(c.computedTransform,Gye),x=t.mapProjection.ellipsoid,E=u.boundingVolume,C=P.multiplyByPoint(b,E.center,Hye);if(m.magnitude(C)>x.minimumRadius){const w=oe.fromCartesian(C,x,Vye);n=m.normalize(a.positionWC,NO),i=a.directionWC,r=a.positionCartographic.height,s=0,o=w.height*2}else{const w=P.multiplyByPoint(b,a.positionWC,qye);if(n=m.UNIT_Z,i=P.multiplyByPointAsVector(b,a.directionWC,Wye),i=m.normalize(i,i),r=w.z,u instanceof co){const S=H.getColumn(E.halfAxes,2,$ye),v=m.magnitude(S);s=C.z-v,o=C.z+v}else if(u instanceof Cc){const S=E.radius;s=C.z-S,o=C.z+S}}}const h=e.dynamicScreenSpaceErrorHeightFalloff,d=s+(o-s)*h,p=o,g=R.clamp((r-d)/(p-d),0,1);let _=1-Math.abs(m.dot(i,n));_=_*(1-g),e._dynamicScreenSpaceErrorComputedDensity=e.dynamicScreenSpaceErrorDensity*_}function Yye(e,t){if(t.hasEmptyContent)return;const{statistics:n}=e,i=t.contentExpired,r=t.requestContent();l(r)&&(r.then(s=>{!l(s)||t.isDestroyed()||e.isDestroyed()||(e._processingQueue.push(t),++n.numberOfTilesProcessing)}).catch(s=>{AB(s,e,t)}),i&&(t.hasTilesetContent||t.hasImplicitContent?lbe(e,t):(n.decrementLoadCounts(t.content),--n.numberOfTilesWithContentReady)),e._requestedTilesInFlight.push(t))}function wB(e,t){return e._priority-t._priority}Ln.prototype.postPassesUpdate=function(e){l(this._root)&&(Kye(this,e),fbe(this,e),this._cache.unloadTiles(this,vB),this._styleApplied&&this._styleEngine.resetDirty(),this._styleApplied=!1)};Ln.prototype.prePassesUpdate=function(e){if(!l(this._root))return;ibe(this,e);const t=this._clippingPlanes;this._clippingPlanesOriginMatrixDirty=!0,l(t)&&t.enabled&&t.update(e);const n=this._clippingPolygons;l(n)&&n.enabled&&n.update(e),l(this._loadTimestamp)||(this._loadTimestamp=ue.clone(e.time)),this._timeSinceLoad=Math.max(ue.secondsDifference(e.time,this._loadTimestamp)*1e3,0),this.dynamicScreenSpaceError&&Xye(this,e),e.newFrame&&this._cache.reset()};function Kye(e,t){const n=e._requestedTilesInFlight;let i=0;for(let r=0;r<n.length;++r){const s=n[r],o=t.frameNumber-s._touchedFrame>=1;if(s._contentState!==si.LOADING){++i;continue}else if(o){s.cancelRequests(),++i;continue}i>0&&(n[r-i]=s)}n.length-=i}function Zye(e){const t=e._requestedTiles;t.sort(wB);for(let n=0;n<t.length;++n)Yye(e,t[n])}function AB(e,t,n){if(t.isDestroyed())return;let i;n.isDestroyed()||(i=n._contentResource.url);const r=l(e.message)?e.message:e.toString();t.tileFailed.numberOfListeners>0?t.tileFailed.raiseEvent({url:i,message:r}):(console.log(`A 3D tile failed to load: ${i}`),console.log(`Error: ${r}`))}function Jye(e){const t=e._processingQueue;let n=0;for(let i=0;i<t.length;++i){const r=t[i];if(r.isDestroyed()||r._contentState!==si.PROCESSING){++n;continue}n>0&&(t[i-n]=r)}t.length-=n}const Qye=new oe,ebe=new oe,tbe=new m;function nbe(e,t,n){if(!e.enableCollision||!e.show)return;const i=e._addHeightCallbacks,r=t.boundingSphere;for(const s of i){if(s.invoked||t._wasSelectedLastFrame)continue;const o=s.ellipsoid,a=oe.clone(s.positionCartographic,Qye),c=oe.fromCartesian(r.center,o,ebe);l(c)&&(a.height=c.height);const u=oe.toCartesian(a,o,tbe);m.distance(u,r.center)<=r.radius&&n.afterRender.push(()=>{l(s.callback)&&s.callback(a),s.invoked=!1})}}function ibe(e,t){Jye(e);const n=e._processingQueue,{cacheBytes:i,maximumCacheOverflowBytes:r,statistics:s}=e,o=i+r;let a=!1;for(let c=0;c<n.length;++c){if(e.totalMemoryUsageInBytes>o){a=!0;break}const u=n[c];try{u.process(e,t),u.contentReady&&(--s.numberOfTilesProcessing,e.tileLoad.raiseEvent(u))}catch(h){--s.numberOfTilesProcessing,AB(h,e,u)}}e.totalMemoryUsageInBytes<i?sbe(e):a&&n.length>0&&rbe(e)}function rbe(e){kr("increase-screenSpaceError",`The tiles needed to meet maximumScreenSpaceError would use more memory than allocated for this tileset.
    The tileset will be rendered with a larger screen space error (see memoryAdjustedScreenSpaceError).
    Consider using larger values for cacheBytes and maximumCacheOverflowBytes.`),e._memoryAdjustedScreenSpaceError*=1.02;const t=e._processingQueue;for(let n=0;n<t.length;++n)t[n].updatePriority();t.sort(wB)}function sbe(e){e._memoryAdjustedScreenSpaceError=Math.max(e.memoryAdjustedScreenSpaceError/1.02,e.maximumScreenSpaceError)}const Dg=new m,obe={maximumFractionDigits:3};function FO(e){const t=e/1048576;return t<1?t.toLocaleString(void 0,obe):Math.round(t).toLocaleString()}function UT(e){const{halfAxes:t,radius:n,center:i}=e.boundingVolume.boundingVolume;let r=m.clone(i,Dg);if(l(t))r.x+=.75*(t[0]+t[3]+t[6]),r.y+=.75*(t[1]+t[4]+t[7]),r.z+=.75*(t[2]+t[5]+t[8]);else if(l(n)){let s=m.normalize(i,Dg);s=m.multiplyByScalar(s,.75*n,Dg),r=m.add(s,i,Dg)}return r}function kT(e,t,n){let i="",r=0;if(t.debugShowGeometricError&&(i+=`
Geometric error: ${e.geometricError}`,r++),t.debugShowRenderingStatistics&&(i+=`
Commands: ${e.commandsLength}`,r++,e.content.pointsLength>0&&(i+=`
Points: ${e.content.pointsLength}`,r++),e.content.trianglesLength>0&&(i+=`
Triangles: ${e.content.trianglesLength}`,r++),i+=`
Features: ${e.content.featuresLength}`,r++),t.debugShowMemoryUsage&&(i+=`
Texture Memory: ${FO(e.content.texturesByteLength)}`,i+=`
Geometry Memory: ${FO(e.content.geometryByteLength)}`,r+=2),t.debugShowUrl)if(e.hasMultipleContents){i+=`
Urls:`;const o=e.content.innerContentUrls;for(let a=0;a<o.length;a++)i+=`
- ${o[a]}`;r+=o.length}else i+=`
Url: ${e._contentHeader.uri}`,r++;const s={text:i.substring(1),position:n,font:`${19-r}px sans-serif`,showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY};return t._tileDebugLabels.add(s)}function abe(e,t){const n=e._selectedTiles,i=n.length,r=e._emptyTiles,s=r.length;if(e._tileDebugLabels.removeAll(),e.debugPickedTileLabelOnly){if(l(e.debugPickedTile)){const o=l(e.debugPickPosition)?e.debugPickPosition:UT(e.debugPickedTile),a=kT(e.debugPickedTile,e,o);a.pixelOffset=new k(15,-15)}}else{for(let o=0;o<i;++o){const a=n[o];kT(a,e,UT(a))}for(let o=0;o<s;++o){const a=r[o];(a.hasTilesetContent||a.hasImplicitContent)&&kT(a,e,UT(a))}}e._tileDebugLabels.update(t)}function cbe(e,t,n){e._styleEngine.applyStyle(e),e._styleApplied=!0;const{commandList:i,context:r}=t,s=i.length,o=e._selectedTiles,a=e.isSkippingLevelOfDetail&&e._hasMixedContent&&r.stencilBuffer&&o.length>0;e._backfaceCommands.length=0,a&&(l(e._stencilClearCommand)||(e._stencilClearCommand=new vp({stencil:0,pass:Ke.CESIUM_3D_TILE,renderState:it.fromCache({stencilMask:yt.SKIP_LOD_MASK})})),i.push(e._stencilClearCommand));const{statistics:c,tileVisible:u}=e,h=n.isRender,d=i.length;for(let _=0;_<o.length;++_){const b=o[_];h&&u.raiseEvent(b),nbe(e,b,t),b.update(e,t,n),c.incrementSelectionCounts(b.content),++c.selected}const p=e._emptyTiles;for(let _=0;_<p.length;++_)p[_].update(e,t,n);let g=i.length-d;if(e._backfaceCommands.trim(),a){const _=e._backfaceCommands.values,b=_.length;i.length+=b;for(let x=g-1;x>=0;--x)i[d+b+x]=i[d+x];for(let x=0;x<b;++x)i[d+x]=_[x]}g=i.length-s,c.numberOfCommands=g,h&&(e.pointCloudShading.attenuation&&e.pointCloudShading.eyeDomeLighting&&g>0&&e._pointCloudEyeDomeLighting.update(t,s,e.pointCloudShading,e.boundingSphere),e.debugShowGeometricError||e.debugShowRenderingStatistics||e.debugShowMemoryUsage||e.debugShowUrl?(l(e._tileDebugLabels)||(e._tileDebugLabels=new Uo),abe(e,t)):e._tileDebugLabels=e._tileDebugLabels&&e._tileDebugLabels.destroy())}const SB=[];function lbe(e,t){const n=t,i=SB;for(i.push(t);i.length>0;){t=i.pop();const r=t.children;for(let s=0;s<r.length;++s)i.push(r[s]);t!==n&&(ube(e,t),--e._statistics.numberOfTilesTotal)}n.children=[]}function vB(e,t){e.tileUnload.raiseEvent(t),e._statistics.decrementLoadCounts(t.content),--e._statistics.numberOfTilesWithContentReady,t.unloadContent()}function ube(e,t){e._cache.unloadTile(e,t,vB),t.destroy()}Ln.prototype.trimLoadedTiles=function(){this._cache.trim()};function fbe(e,t){const n=e._statistics,i=e._statisticsLast,r=n.numberOfPendingRequests,s=n.numberOfTilesProcessing,o=i.numberOfPendingRequests,a=i.numberOfTilesProcessing;pa.clone(n,i);const c=r!==o||s!==a;c&&t.afterRender.push(function(){return e.loadProgress.raiseEvent(r,s),!0}),e._tilesLoaded=n.numberOfPendingRequests===0&&n.numberOfTilesProcessing===0&&n.numberOfAttemptedRequests===0,c&&e._tilesLoaded&&(t.afterRender.push(function(){return e.allTilesLoaded.raiseEvent(),!0}),e._initialTilesLoaded||(e._initialTilesLoaded=!0,t.afterRender.push(function(){return e.initialTilesLoaded.raiseEvent(),!0})))}function hbe(e){e._heatmap.resetMinimumMaximum(),e._minimumPriority.depth=Number.MAX_VALUE,e._maximumPriority.depth=-Number.MAX_VALUE,e._minimumPriority.foveatedFactor=Number.MAX_VALUE,e._maximumPriority.foveatedFactor=-Number.MAX_VALUE,e._minimumPriority.distance=Number.MAX_VALUE,e._maximumPriority.distance=-Number.MAX_VALUE,e._minimumPriority.reverseScreenSpaceError=Number.MAX_VALUE,e._maximumPriority.reverseScreenSpaceError=-Number.MAX_VALUE}function dbe(e,t){t.frameNumber===e._updatedModelMatrixFrame&&l(e._previousModelMatrix)||(e._updatedModelMatrixFrame=t.frameNumber,e._modelMatrixChanged=!P.equals(e.modelMatrix,e._previousModelMatrix),e._modelMatrixChanged&&(e._previousModelMatrix=P.clone(e.modelMatrix,e._previousModelMatrix)))}function pbe(e,t,n,i){if(t.mode===Ie.MORPHING||!l(e._root))return!1;const r=e._statistics;r.clear(),++e._updatedVisibilityFrame,hbe(e),dbe(e,t),e._cullRequestsWhileMoving=e.cullRequestsWhileMoving&&!e._modelMatrixChanged;const s=e.getTraversal(i).selectTiles(e,t);if(i.requestTiles&&Zye(e),cbe(e,t,i),pa.clone(r,n),i.isRender){const o=e._credits;if(l(o)&&r.selected!==0)for(let a=0;a<o.length;++a){const c=o[a];t.creditDisplay.addCreditToNextFrame(c)}}return s}function IB(e){let t=e._credits;l(t)||(t=[]),t.length=0,l(e.resource.credits)&&e.resource.credits.forEach(i=>{t.push(zt.clone(i))});const n=e.asset.extras;if(l(n)&&l(n.cesium)&&l(n.cesium.credits)){const i=n.cesium.credits;for(let r=0;r<i.length;++r){const s=i[r];t.push(new zt(s.html))}}t.forEach(i=>i.showOnScreen=i.showOnScreen||e._showCreditsOnScreen),e._credits=t}Ln.prototype.getTraversal=function(e){const{pass:t}=e;return t===So.MOST_DETAILED_PRELOAD||t===So.MOST_DETAILED_PICK?xB:this.isSkippingLevelOfDetail?CB:EB};Ln.prototype.update=function(e){this.updateForPass(e,e.tilesetPassState)};Ln.prototype.updateForPass=function(e,t){y.typeOf.object("frameState",e),y.typeOf.object("tilesetPassState",t);const n=t.pass;if(n===So.PRELOAD&&(!this.preloadWhenHidden||this.show)||n===So.PRELOAD_FLIGHT&&(!this.preloadFlightDestinations||!this.show&&!this.preloadWhenHidden)||n===So.REQUEST_RENDER_MODE_DEFER_CHECK&&(!this._cullRequestsWhileMoving&&this.foveatedTimeDelay<=0||!this.show))return;const i=e.commandList,r=e.camera,s=e.cullingVolume;t.ready=!1;const o=So.getPassOptions(n),a=o.ignoreCommands,c=T(t.commandList,i),u=c.length;e.commandList=c,e.camera=T(t.camera,r),e.cullingVolume=T(t.cullingVolume,s);const h=this._clippingPolygons;l(h)&&h.enabled&&h.queueCommands(e);const d=this._statisticsPerPass[n];(this.show||a)&&(this._pass=n,t.ready=pbe(this,e,d,o)),a&&(c.length=u),e.commandList=i,e.camera=r,e.cullingVolume=s};Ln.prototype.hasExtension=function(e){return l(this._extensionsUsed)?this._extensionsUsed.indexOf(e)>-1:!1};Ln.prototype.isDestroyed=function(){return!1};Ln.prototype.destroy=function(){if(this._tileDebugLabels=this._tileDebugLabels&&this._tileDebugLabels.destroy(),this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy(),this._clippingPolygons=this._clippingPolygons&&this._clippingPolygons.destroy(),l(this._root)){const e=SB;for(e.push(this._root);e.length>0;){const t=e.pop();t.destroy();const n=t.children;for(let i=0;i<n.length;++i)e.push(n[i])}}return this._root=void 0,this._shouldDestroyImageBasedLighting&&!this._imageBasedLighting.isDestroyed()&&this._imageBasedLighting.destroy(),this._imageBasedLighting=void 0,Ye(this)};Ln.supportedExtensions={"3DTILES_metadata":!0,"3DTILES_implicit_tiling":!0,"3DTILES_content_gltf":!0,"3DTILES_multiple_contents":!0,"3DTILES_bounding_volume_S2":!0,"3DTILES_batch_table_hierarchy":!0,"3DTILES_draco_point_compression":!0,MAXAR_content_geojson:!0};Ln.checkSupportedExtensions=function(e){for(let t=0;t<e.length;t++)if(!Ln.supportedExtensions[e[t]])throw new te(`Unsupported 3D Tiles Extension: ${e[t]}`)};const mbe=new ya,gbe=new m,_be=new oe;Ln.prototype.getHeight=function(e,t){var o;y.typeOf.object("cartographic",e),y.typeOf.object("scene",t);let n=t.ellipsoid;l(n)||(n=fe.WGS84);const i=mbe,r=n.cartographicToCartesian(e,i.direction);m.normalize(i.direction,i.direction),i.direction=m.normalize(r,i.direction),i.direction=m.negate(r,i.direction),i.origin=m.multiplyByScalar(i.direction,-2*n.maximumRadius,i.origin);const s=this.pick(i,t.frameState,gbe);if(l(s))return(o=n.cartesianToCartographic(s,_be))==null?void 0:o.height};Ln.prototype.updateHeight=function(e,t,n){n=T(n,fe.WGS84);const i={positionCartographic:e,ellipsoid:n,callback:t,invoked:!1},r=()=>{const s=this._addHeightCallbacks,o=s.length;for(let a=0;a<o;++a)if(s[a]===i){s.splice(a,1);break}i.callback&&(i.callback=void 0)};return this._addHeightCallbacks.push(i),r};const ybe=new Kc,bbe=new m;Ln.prototype.pick=function(e,t,n){if(!t.context.webgl2&&!this._enablePick)return;const i=this._selectedTiles,r=i.length,s=[];for(let c=0;c<r;++c){const u=i[c],h=Ct.raySphere(e,u.contentBoundingVolume.boundingSphere,ybe);!l(h)||!l(u.content)||s.push(u)}const o=s.length;s.sort((c,u)=>{const h=ee.distanceSquaredTo(c.contentBoundingVolume.boundingSphere,e.origin),d=ee.distanceSquaredTo(u.contentBoundingVolume.boundingSphere,e.origin);return h-d});let a;for(let c=0;c<o;++c){const h=s[c].content.pick(e,t,bbe);if(l(h))return a=m.clone(h,n),a}};const Tbe={UNLOADED:0,TRANSITIONING:1,RECEIVED:2,TEXTURE_LOADED:3,READY:4,FAILED:5,INVALID:6,PLACEHOLDER:7},Rn=Object.freeze(Tbe);let jT;const OB="AAPTxy8BH1VEsoebNVZXo8HurEOF051kAEKlhkOhBEc9BmTRbx8gaNqtBYKRq3vEnwSKnwUE1aRn2Siyo0gHWzzPwpJd-ZUeTyDgQZPqW8C6pXNLOE3bRO6-Jz3NFmp-qNquqGBQTATcCHbNsL-h9CPyMMPGsTcUvzPlIInazMfkWJNbFmqJeSzPj_1DHshXa0XCfkQn5mVxlF2dFt10Mq2bGo0HkpdpXwNQdoGwdphsLoU.AT1_CpQKgEim",Jr={};Jr.defaultAccessToken=OB;Jr.defaultWorldImageryServer=new se({url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"});Jr.defaultWorldHillshadeServer=new se({url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"});Jr.defaultWorldOceanServer=new se({url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"});Jr.getDefaultTokenCredit=function(e){if(e===OB){if(!l(jT)){const t='<b>             This application is using a default ArcGIS access token. Please assign <i>Cesium.ArcGisMapService.defaultAccessToken</i>             with an API key from your ArcGIS Developer account before using the ArcGIS tile services.             You can sign up for a free ArcGIS Developer account at <a href="https://developers.arcgis.com/">https://developers.arcgis.com/</a>.</b>';jT=new zt(t,!0)}return jT}};function Yw(e){if(e=T(e,T.EMPTY_OBJECT),!l(e.missingImageUrl))throw new A("options.missingImageUrl is required.");if(!l(e.pixelsToCheck))throw new A("options.pixelsToCheck is required.");this._pixelsToCheck=e.pixelsToCheck,this._missingImagePixels=void 0,this._missingImageByteLength=void 0,this._isReady=!1;const t=se.createIfNeeded(e.missingImageUrl),n=this;function i(s){l(s.blob)&&(n._missingImageByteLength=s.blob.size);let o=z_(s);if(e.disableCheckIfAllPixelsAreTransparent){let a=!0;const c=s.width,u=e.pixelsToCheck;for(let h=0,d=u.length;a&&h<d;++h){const p=u[h],g=p.x*4+p.y*c;o[g+3]>0&&(a=!1)}a&&(o=void 0)}n._missingImagePixels=o,n._isReady=!0}function r(){n._missingImagePixels=void 0,n._isReady=!0}t.fetchImage({preferBlob:!0,preferImageBitmap:!0,flipY:!0}).then(i).catch(r)}Yw.prototype.isReady=function(){return this._isReady};Yw.prototype.shouldDiscardImage=function(e){if(!this._isReady)throw new A("shouldDiscardImage must not be called before the discard policy is ready.");const t=this._pixelsToCheck,n=this._missingImagePixels;if(!l(n)||l(e.blob)&&e.blob.size!==this._missingImageByteLength)return!1;const i=z_(e),r=e.width;for(let s=0,o=t.length;s<o;++s){const a=t[s],c=a.x*4+a.y*r;for(let u=0;u<4;++u){const h=c+u;if(i[h]!==n[h])return!1}}return!0};function Nl(){this.name=void 0,this.description=void 0,this.position=void 0,this.data=void 0,this.imageryLayer=void 0}Nl.prototype.configureNameFromProperties=function(e){let t=10,n;for(const i in e)if(e.hasOwnProperty(i)&&e[i]){const r=i.toLowerCase();t>1&&r==="name"?(t=1,n=i):t>2&&r==="title"?(t=2,n=i):t>3&&/name/i.test(i)?(t=3,n=i):t>4&&/title/i.test(i)&&(t=4,n=i)}l(n)&&(this.name=e[n])};Nl.prototype.configureDescriptionFromProperties=function(e){function t(n){let i='<table class="cesium-infoBox-defaultTable">';for(const r in n)if(n.hasOwnProperty(r)){const s=n[r];l(s)&&(typeof s=="object"?i+=`<tr><td>${r}</td><td>${t(s)}</td></tr>`:i+=`<tr><td>${r}</td><td>${s}</td></tr>`)}return i+="</table>",i}this.description=t(e)};function Vo(){A.throwInstantiationError()}Object.defineProperties(Vo.prototype,{rectangle:{get:A.throwInstantiationError},tileWidth:{get:A.throwInstantiationError},tileHeight:{get:A.throwInstantiationError},maximumLevel:{get:A.throwInstantiationError},minimumLevel:{get:A.throwInstantiationError},tilingScheme:{get:A.throwInstantiationError},tileDiscardPolicy:{get:A.throwInstantiationError},errorEvent:{get:A.throwInstantiationError},credit:{get:A.throwInstantiationError},proxy:{get:A.throwInstantiationError},hasAlphaChannel:{get:A.throwInstantiationError}});Vo.prototype.getTileCredits=function(e,t,n){A.throwInstantiationError()};Vo.prototype.requestImage=function(e,t,n,i){A.throwInstantiationError()};Vo.prototype.pickFeatures=function(e,t,n,i,r){A.throwInstantiationError()};const xbe=/\.ktx2$/i;Vo.loadImage=function(e,t){y.defined("url",t);const n=se.createIfNeeded(t);return xbe.test(n.url)?Dh(n):l(e)&&l(e.tileDiscardPolicy)?n.fetchImage({preferBlob:!0,preferImageBitmap:!0,flipY:!0}):n.fetchImage({preferImageBitmap:!0,flipY:!0})};const Ebe={SATELLITE:1,OCEANS:2,HILLSHADE:3},VT=Object.freeze(Ebe);function RB(e){this.useTiles=T(e.usePreCachedTilesIfAvailable,!0);const t=e.ellipsoid;this.tilingScheme=T(e.tilingScheme,new Vr({ellipsoid:t})),this.rectangle=T(e.rectangle,this.tilingScheme.rectangle),this.ellipsoid=t;let n=e.credit;typeof n=="string"&&(n=new zt(n)),this.credit=n,this.tileCredits=void 0,this.tileDiscardPolicy=e.tileDiscardPolicy,this.tileWidth=T(e.tileWidth,256),this.tileHeight=T(e.tileHeight,256),this.maximumLevel=e.maximumLevel}RB.prototype.build=function(e){e._useTiles=this.useTiles,e._tilingScheme=this.tilingScheme,e._rectangle=this.rectangle,e._credit=this.credit,e._tileCredits=this.tileCredits,e._tileDiscardPolicy=this.tileDiscardPolicy,e._tileWidth=this.tileWidth,e._tileHeight=this.tileHeight,e._maximumLevel=this.maximumLevel,this.useTiles&&!l(this.tileDiscardPolicy)&&(e._tileDiscardPolicy=new Yw({missingImageUrl:DB(e,0,0,this.maximumLevel).url,pixelsToCheck:[new k(0,0),new k(200,20),new k(20,200),new k(80,110),new k(160,130)],disableCheckIfAllPixelsAreTransparent:!0}))};function Cbe(e,t){const n=e.tileInfo;if(!l(n))t.useTiles=!1;else{if(t.tileWidth=n.rows,t.tileHeight=n.cols,n.spatialReference.wkid===102100||n.spatialReference.wkid===102113)t.tilingScheme=new fs({ellipsoid:t.ellipsoid});else if(e.tileInfo.spatialReference.wkid===4326)t.tilingScheme=new Vr({ellipsoid:t.ellipsoid});else{const i=`Tile spatial reference WKID ${e.tileInfo.spatialReference.wkid} is not supported.`;throw new te(i)}if(t.maximumLevel=e.tileInfo.lods.length-1,l(e.fullExtent)){if(l(e.fullExtent.spatialReference)&&l(e.fullExtent.spatialReference.wkid))if(e.fullExtent.spatialReference.wkid===102100||e.fullExtent.spatialReference.wkid===102113){const i=new Jn,r=e.fullExtent,s=i.unproject(new m(Math.max(r.xmin,-t.tilingScheme.ellipsoid.maximumRadius*Math.PI),Math.max(r.ymin,-t.tilingScheme.ellipsoid.maximumRadius*Math.PI),0)),o=i.unproject(new m(Math.min(r.xmax,t.tilingScheme.ellipsoid.maximumRadius*Math.PI),Math.min(r.ymax,t.tilingScheme.ellipsoid.maximumRadius*Math.PI),0));t.rectangle=new ie(s.longitude,s.latitude,o.longitude,o.latitude)}else if(e.fullExtent.spatialReference.wkid===4326)t.rectangle=ie.fromDegrees(e.fullExtent.xmin,e.fullExtent.ymin,e.fullExtent.xmax,e.fullExtent.ymax);else{const i=`fullExtent.spatialReference WKID ${e.fullExtent.spatialReference.wkid} is not supported.`;throw new te(i)}}else t.rectangle=t.tilingScheme.rectangle;t.useTiles=!0}l(e.copyrightText)&&e.copyrightText.length>0&&(l(t.credit)?t.tileCredits=[new zt(e.copyrightText)]:t.credit=new zt(e.copyrightText))}function wbe(e,t){let n=`An error occurred while accessing ${e.url}`;throw l(t)&&l(t.message)&&(n+=`: ${t.message}`),new te(n)}async function Abe(e,t){const n=e.getDerivedResource({queryParameters:{f:"json"}});try{const i=await n.fetchJson();Cbe(i,t)}catch(i){wbe(e,i)}}function Ca(e){e=T(e,T.EMPTY_OBJECT),this._defaultAlpha=void 0,this._defaultNightAlpha=void 0,this._defaultDayAlpha=void 0,this._defaultBrightness=void 0,this._defaultContrast=void 0,this._defaultHue=void 0,this._defaultSaturation=void 0,this._defaultGamma=void 0,this._defaultMinificationFilter=void 0,this._defaultMagnificationFilter=void 0,this._tileDiscardPolicy=e.tileDiscardPolicy,this._tileWidth=T(e.tileWidth,256),this._tileHeight=T(e.tileHeight,256),this._maximumLevel=e.maximumLevel,this._tilingScheme=T(e.tilingScheme,new Vr({ellipsoid:e.ellipsoid})),this._useTiles=T(e.usePreCachedTilesIfAvailable,!0),this._rectangle=T(e.rectangle,this._tilingScheme.rectangle),this._layers=e.layers,this._credit=e.credit,this._tileCredits=void 0;let t=e.credit;typeof t=="string"&&(t=new zt(t)),this.enablePickFeatures=T(e.enablePickFeatures,!0),this._errorEvent=new jt}Ca.fromBasemapType=async function(e,t){y.defined("style",e),t=T(t,T.EMPTY_OBJECT);let n,i,r;switch(e){case VT.SATELLITE:{n=T(t.token,Jr.defaultAccessToken),i=se.createIfNeeded(Jr.defaultWorldImageryServer),i.appendForwardSlash();const s=Jr.getDefaultTokenCredit(n);l(s)&&(r=zt.clone(s))}break;case VT.OCEANS:{n=T(t.token,Jr.defaultAccessToken),i=se.createIfNeeded(Jr.defaultWorldOceanServer),i.appendForwardSlash();const s=Jr.getDefaultTokenCredit(n);l(s)&&(r=zt.clone(s))}break;case VT.HILLSHADE:{n=T(t.token,Jr.defaultAccessToken),i=se.createIfNeeded(Jr.defaultWorldHillshadeServer),i.appendForwardSlash();const s=Jr.getDefaultTokenCredit(n);l(s)&&(r=zt.clone(s))}break;default:throw new A(`Unsupported basemap type: ${e}`)}return Ca.fromUrl(i,{...t,token:n,credit:r,usePreCachedTilesIfAvailable:!0})};function DB(e,t,n,i,r){let s;if(e._useTiles)s=e._resource.getDerivedResource({url:`tile/${i}/${n}/${t}`,request:r});else{const o=e._tilingScheme.tileXYToNativeRectangle(t,n,i),c={bbox:`${o.west},${o.south},${o.east},${o.north}`,size:`${e._tileWidth},${e._tileHeight}`,format:"png32",transparent:!0,f:"image"};e._tilingScheme.projection instanceof ur?(c.bboxSR=4326,c.imageSR=4326):(c.bboxSR=3857,c.imageSR=3857),e.layers&&(c.layers=`show:${e.layers}`),s=e._resource.getDerivedResource({url:"export",request:r,queryParameters:c})}return s}Object.defineProperties(Ca.prototype,{url:{get:function(){return this._resource._url}},token:{get:function(){return this._resource.queryParameters.token}},proxy:{get:function(){return this._resource.proxy}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return this._maximumLevel}},minimumLevel:{get:function(){return 0}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._rectangle}},tileDiscardPolicy:{get:function(){return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},usingPrecachedTiles:{get:function(){return this._useTiles}},hasAlphaChannel:{get:function(){return!0}},layers:{get:function(){return this._layers}}});Ca.fromUrl=async function(e,t){y.defined("url",e),t=T(t,T.EMPTY_OBJECT);const n=se.createIfNeeded(e);n.appendForwardSlash(),l(t.token)&&n.setQueryParameters({token:t.token});const i=new Ca(t);i._resource=n;const r=new RB(t);return T(t.usePreCachedTilesIfAvailable,!0)&&await Abe(n,r),r.build(i),i};Ca.prototype.getTileCredits=function(e,t,n){return this._tileCredits};Ca.prototype.requestImage=function(e,t,n,i){return Vo.loadImage(this,DB(this,e,t,n,i))};Ca.prototype.pickFeatures=function(e,t,n,i,r){if(!this.enablePickFeatures)return;const s=this._tilingScheme.tileXYToNativeRectangle(e,t,n);let o,a,c;if(this._tilingScheme.projection instanceof ur)o=R.toDegrees(i),a=R.toDegrees(r),c="4326";else{const p=this._tilingScheme.projection.project(new oe(i,r,0));o=p.x,a=p.y,c="3857"}let u="visible";l(this._layers)&&(u+=`:${this._layers}`);const h={f:"json",tolerance:2,geometryType:"esriGeometryPoint",geometry:`${o},${a}`,mapExtent:`${s.west},${s.south},${s.east},${s.north}`,imageDisplay:`${this._tileWidth},${this._tileHeight},96`,sr:c,layers:u};return this._resource.getDerivedResource({url:"identify",queryParameters:h}).fetchJson().then(function(p){const g=[],_=p.results;if(!l(_))return g;for(let b=0;b<_.length;++b){const x=_[b],E=new Nl;if(E.data=x,E.name=x.value,E.properties=x.attributes,E.configureDescriptionFromProperties(x.attributes),x.geometryType==="esriGeometryPoint"&&x.geometry){const C=x.geometry.spatialReference&&x.geometry.spatialReference.wkid?x.geometry.spatialReference.wkid:4326;if(C===4326||C===4283)E.position=oe.fromDegrees(x.geometry.x,x.geometry.y,x.geometry.z);else if(C===102100||C===900913||C===3857){const w=new Jn;E.position=w.unproject(new m(x.geometry.x,x.geometry.y,x.geometry.z))}}g.push(E)}return g})};Ca._metadataCache={};const Sbe={AERIAL:"Aerial",AERIAL_WITH_LABELS:"AerialWithLabels",AERIAL_WITH_LABELS_ON_DEMAND:"AerialWithLabelsOnDemand",ROAD:"Road",ROAD_ON_DEMAND:"RoadOnDemand",CANVAS_DARK:"CanvasDark",CANVAS_LIGHT:"CanvasLight",CANVAS_GRAY:"CanvasGray",ORDNANCE_SURVEY:"OrdnanceSurvey",COLLINS_BART:"CollinsBart"},MB=Object.freeze(Sbe);function ph(e){}ph.prototype.isReady=function(){return!0};ph.prototype.shouldDiscardImage=function(e){return ph.EMPTY_IMAGE===e};let Mg;Object.defineProperties(ph,{EMPTY_IMAGE:{get:function(){return l(Mg)||(Mg=new Image,Mg.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="),Mg}}});function LB(e){this.tileWidth=void 0,this.tileHeight=void 0,this.maximumLevel=void 0,this.imageUrlSubdomains=void 0,this.imageUrlTemplate=void 0,this.attributionList=void 0}LB.prototype.build=function(e){e._tileWidth=this.tileWidth,e._tileHeight=this.tileHeight,e._maximumLevel=this.maximumLevel,e._imageUrlSubdomains=this.imageUrlSubdomains,e._imageUrlTemplate=this.imageUrlTemplate;let t=e._attributionList=this.attributionList;t||(t=[]),e._attributionList=t;for(let n=0,i=t.length;n<i;++n){const r=t[n];if(r.credit instanceof zt)break;r.credit=new zt(r.attribution);const s=r.coverageAreas;for(let o=0,a=r.coverageAreas.length;o<a;++o){const c=s[o],u=c.bbox;c.bbox=new ie(R.toRadians(u[1]),R.toRadians(u[0]),R.toRadians(u[3]),R.toRadians(u[2]))}}};function vbe(e,t){if(e.resourceSets.length!==1)throw new te("metadata does not specify one resource in resourceSets");const n=e.resourceSets[0].resources[0];t.tileWidth=n.imageWidth,t.tileHeight=n.imageHeight,t.maximumLevel=n.zoomMax-1,t.imageUrlSubdomains=n.imageUrlSubdomains,t.imageUrlTemplate=n.imageUrl;let i=n.imageryProviders;l(n.imageryProviders)&&(i=n.imageryProviders.filter(r=>{var s;return(s=r.coverageAreas)==null?void 0:s.some(o=>l(o.bbox))})),t.attributionList=i}function Ibe(e,t,n){let i=`An error occurred while accessing ${e.url}`;throw l(t)&&l(t.message)&&(i+=`: ${t.message}`),Mo.reportError(void 0,n,l(n)?n._errorEvent:void 0,i,void 0,void 0,void 0,t),new te(i)}async function Obe(e,t,n){const i=e.url;let r=bi._metadataCache[i];l(r)||(r=e.fetchJsonp("jsonp"),bi._metadataCache[i]=r);try{const s=await r;return vbe(s,t)}catch(s){Ibe(e,s,n)}}function bi(e){e=T(e,T.EMPTY_OBJECT),this._defaultAlpha=void 0,this._defaultNightAlpha=void 0,this._defaultDayAlpha=void 0,this._defaultBrightness=void 0,this._defaultContrast=void 0,this._defaultHue=void 0,this._defaultSaturation=void 0,this._defaultGamma=1,this._defaultMinificationFilter=void 0,this._defaultMagnificationFilter=void 0,this._mapStyle=T(e.mapStyle,MB.AERIAL),this._mapLayer=e.mapLayer,this._culture=T(e.culture,""),this._key=e.key,this._tileDiscardPolicy=e.tileDiscardPolicy,l(this._tileDiscardPolicy)||(this._tileDiscardPolicy=new ph),this._proxy=e.proxy,this._credit=new zt(`<a href="https://www.microsoft.com/en-us/maps/product/enduserterms"><img src="${bi.logoUrl}" title="Bing Imagery"/></a>`),this._tilingScheme=new fs({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,ellipsoid:e.ellipsoid}),this._tileWidth=void 0,this._tileHeight=void 0,this._maximumLevel=void 0,this._imageUrlTemplate=void 0,this._imageUrlSubdomains=void 0,this._attributionList=void 0,this._errorEvent=new jt}Object.defineProperties(bi.prototype,{url:{get:function(){return this._resource.url}},proxy:{get:function(){return this._resource.proxy}},key:{get:function(){return this._key}},mapStyle:{get:function(){return this._mapStyle}},mapLayer:{get:function(){return this._mapLayer}},culture:{get:function(){return this._culture}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return this._maximumLevel}},minimumLevel:{get:function(){return 0}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return l(this.mapLayer)}}});bi.fromUrl=async function(e,t){t=T(t,T.EMPTY_OBJECT),y.defined("url",e),y.defined("options.key",t.key);let n=t.tileProtocol;l(n)?n.length>0&&n[n.length-1]===":"&&(n=n.substr(0,n.length-1)):n=document.location.protocol==="http:"?"http":"https";const i=T(t.mapStyle,MB.AERIAL),r=se.createIfNeeded(e);r.appendForwardSlash();const s={incl:"ImageryProviders",key:t.key,uriScheme:n};l(t.mapLayer)&&(s.mapLayer=t.mapLayer),l(t.culture)&&(s.culture=t.culture);const o=r.getDerivedResource({url:`REST/v1/Imagery/Metadata/${i}`,queryParameters:s}),a=new bi(t);a._resource=r;const c=new LB;return await Obe(o,c),c.build(a),a};const Rbe=new ie;bi.prototype.getTileCredits=function(e,t,n){const i=this._tilingScheme.tileXYToRectangle(e,t,n,Rbe);return Lbe(this._attributionList,n,i)};bi.prototype.requestImage=function(e,t,n,i){const r=Vo.loadImage(this,Dbe(this,e,t,n,i));if(l(r))return r.catch(function(s){return l(s.blob)&&s.blob.size===0?ph.EMPTY_IMAGE:Promise.reject(s)})};bi.prototype.pickFeatures=function(e,t,n,i,r){};bi.tileXYToQuadKey=function(e,t,n){let i="";for(let r=n;r>=0;--r){const s=1<<r;let o=0;e&s&&(o|=1),t&s&&(o|=2),i+=o}return i};bi.quadKeyToTileXY=function(e){let t=0,n=0;const i=e.length-1;for(let r=i;r>=0;--r){const s=1<<r,o=+e[i-r];o&1&&(t|=s),o&2&&(n|=s)}return{x:t,y:n,level:i}};bi._logoUrl=void 0;Object.defineProperties(bi,{logoUrl:{get:function(){return l(bi._logoUrl)||(bi._logoUrl=ss("Assets/Images/bing_maps_credit.png")),bi._logoUrl},set:function(e){y.defined("value",e),bi._logoUrl=e}}});function Dbe(e,t,n,i,r){const s=e._imageUrlTemplate,o=e._imageUrlSubdomains,a=(t+n+i)%o.length;return e._resource.getDerivedResource({url:s,request:r,templateValues:{quadkey:bi.tileXYToQuadKey(t,n,i),subdomain:o[a],culture:e._culture},queryParameters:{n:"z"}})}const Mbe=new ie;function Lbe(e,t,n){++t;const i=[];for(let r=0,s=e.length;r<s;++r){const o=e[r],a=o.coverageAreas;let c=!1;for(let u=0,h=o.coverageAreas.length;!c&&u<h;++u){const d=a[u];if(t>=d.zoomMin&&t<=d.zoomMax){const p=ie.intersection(n,d.bbox,Mbe);l(p)&&(c=!0)}}c&&i.push(o.credit)}return i}bi._metadataCache={};const PB=/{[^}]+}/g,NB={x:Bbe,y:Ube,z:Vbe,s:Gbe,reverseX:zbe,reverseY:kbe,reverseZ:jbe,westDegrees:Hbe,southDegrees:qbe,eastDegrees:Wbe,northDegrees:$be,westProjected:Xbe,southProjected:Ybe,eastProjected:Kbe,northProjected:Zbe,width:Jbe,height:Qbe},Pbe=wt(NB,{i:e0e,j:t0e,reverseI:n0e,reverseJ:i0e,longitudeDegrees:s0e,latitudeDegrees:o0e,longitudeProjected:a0e,latitudeProjected:c0e,format:u0e});function Ac(e){e=T(e,T.EMPTY_OBJECT),this._errorEvent=new jt,y.defined("options.url",e.url);const t=se.createIfNeeded(e.url),n=se.createIfNeeded(e.pickFeaturesUrl);this._resource=t,this._urlSchemeZeroPadding=e.urlSchemeZeroPadding,this._getFeatureInfoFormats=e.getFeatureInfoFormats,this._pickFeaturesResource=n;let i=e.subdomains;Array.isArray(i)?i=i.slice():l(i)&&i.length>0?i=i.split(""):i=["a","b","c"],this._subdomains=i,this._tileWidth=T(e.tileWidth,256),this._tileHeight=T(e.tileHeight,256),this._minimumLevel=T(e.minimumLevel,0),this._maximumLevel=e.maximumLevel,this._tilingScheme=T(e.tilingScheme,new fs({ellipsoid:e.ellipsoid})),this._rectangle=T(e.rectangle,this._tilingScheme.rectangle),this._rectangle=ie.intersection(this._rectangle,this._tilingScheme.rectangle),this._tileDiscardPolicy=e.tileDiscardPolicy;let r=e.credit;typeof r=="string"&&(r=new zt(r)),this._credit=r,this._hasAlphaChannel=T(e.hasAlphaChannel,!0);const s=e.customTags,o=wt(NB,s),a=wt(Pbe,s);this._tags=o,this._pickFeaturesTags=a,this._defaultAlpha=void 0,this._defaultNightAlpha=void 0,this._defaultDayAlpha=void 0,this._defaultBrightness=void 0,this._defaultContrast=void 0,this._defaultHue=void 0,this._defaultSaturation=void 0,this._defaultGamma=void 0,this._defaultMinificationFilter=void 0,this._defaultMagnificationFilter=void 0,this.enablePickFeatures=T(e.enablePickFeatures,!0)}Object.defineProperties(Ac.prototype,{url:{get:function(){return this._resource.url}},urlSchemeZeroPadding:{get:function(){return this._urlSchemeZeroPadding}},pickFeaturesUrl:{get:function(){return this._pickFeaturesResource.url}},proxy:{get:function(){return this._resource.proxy}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return this._maximumLevel}},minimumLevel:{get:function(){return this._minimumLevel}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._rectangle}},tileDiscardPolicy:{get:function(){return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return this._hasAlphaChannel}}});Ac.prototype.getTileCredits=function(e,t,n){};Ac.prototype.requestImage=function(e,t,n,i){return Vo.loadImage(this,Nbe(this,e,t,n,i))};Ac.prototype.pickFeatures=function(e,t,n,i,r){if(!this.enablePickFeatures||!l(this._pickFeaturesResource)||this._getFeatureInfoFormats.length===0)return;let s=0;const o=this;function a(u,h){return u.callback(h)}function c(){if(s>=o._getFeatureInfoFormats.length)return Promise.resolve([]);const u=o._getFeatureInfoFormats[s],h=Fbe(o,e,t,n,i,r,u.format);return++s,u.type==="json"?h.fetchJson().then(u.callback).catch(c):u.type==="xml"?h.fetchXML().then(u.callback).catch(c):u.type==="text"||u.type==="html"?h.fetchText().then(u.callback).catch(c):h.fetch({responseType:u.format}).then(a.bind(void 0,u)).catch(c)}return c()};let ly=!1;const ds=new ie;let uy=!1;const mm=new ie;function Nbe(e,t,n,i,r){ly=!1,uy=!1;const s=e._resource,o=s.getUrlComponent(!0),a=e._tags,c={},u=o.match(PB);return l(u)&&u.forEach(function(h){const d=h.substring(1,h.length-1);l(a[d])&&(c[d]=a[d](e,t,n,i))}),s.getDerivedResource({request:r,templateValues:c})}let xE=!1;const mh=new k;let EE=!1;function Fbe(e,t,n,i,r,s,o){ly=!1,uy=!1,xE=!1,EE=!1;const a=e._pickFeaturesResource,c=a.getUrlComponent(!0),u=e._pickFeaturesTags,h={},d=c.match(PB);return l(d)&&d.forEach(function(p){const g=p.substring(1,p.length-1);l(u[g])&&(h[g]=u[g](e,t,n,i,r,s,o))}),a.getDerivedResource({templateValues:h})}function kh(e,t,n){if(e&&e.urlSchemeZeroPadding&&e.urlSchemeZeroPadding.hasOwnProperty(t)){const i=e.urlSchemeZeroPadding[t];if(typeof i=="string"){const r=i.length;r>1&&(n=n.length>=r?n:new Array(r-n.toString().length+1).join("0")+n)}}return n}function Bbe(e,t,n,i){return kh(e,"{x}",t)}function zbe(e,t,n,i){const r=e.tilingScheme.getNumberOfXTilesAtLevel(i)-t-1;return kh(e,"{reverseX}",r)}function Ube(e,t,n,i){return kh(e,"{y}",n)}function kbe(e,t,n,i){const r=e.tilingScheme.getNumberOfYTilesAtLevel(i)-n-1;return kh(e,"{reverseY}",r)}function jbe(e,t,n,i){const r=e.maximumLevel,s=l(r)&&i<r?r-i-1:i;return kh(e,"{reverseZ}",s)}function Vbe(e,t,n,i){return kh(e,"{z}",i)}function Gbe(e,t,n,i){const r=(t+n+i)%e._subdomains.length;return e._subdomains[r]}function cb(e,t,n,i){ly||(e.tilingScheme.tileXYToRectangle(t,n,i,ds),ds.west=R.toDegrees(ds.west),ds.south=R.toDegrees(ds.south),ds.east=R.toDegrees(ds.east),ds.north=R.toDegrees(ds.north),ly=!0)}function Hbe(e,t,n,i){return cb(e,t,n,i),ds.west}function qbe(e,t,n,i){return cb(e,t,n,i),ds.south}function Wbe(e,t,n,i){return cb(e,t,n,i),ds.east}function $be(e,t,n,i){return cb(e,t,n,i),ds.north}function lb(e,t,n,i){uy||(e.tilingScheme.tileXYToNativeRectangle(t,n,i,mm),uy=!0)}function Xbe(e,t,n,i){return lb(e,t,n,i),mm.west}function Ybe(e,t,n,i){return lb(e,t,n,i),mm.south}function Kbe(e,t,n,i){return lb(e,t,n,i),mm.east}function Zbe(e,t,n,i){return lb(e,t,n,i),mm.north}function Jbe(e,t,n,i){return e.tileWidth}function Qbe(e,t,n,i){return e.tileHeight}function e0e(e,t,n,i,r,s,o){return ub(e,t,n,i,r,s),mh.x}function t0e(e,t,n,i,r,s,o){return ub(e,t,n,i,r,s),mh.y}function n0e(e,t,n,i,r,s,o){return ub(e,t,n,i,r,s),e.tileWidth-mh.x-1}function i0e(e,t,n,i,r,s,o){return ub(e,t,n,i,r,s),e.tileHeight-mh.y-1}const r0e=new ie,qf=new m;function ub(e,t,n,i,r,s,o){if(xE)return;Kw(e,t,n,i,r,s);const a=qf,c=e.tilingScheme.tileXYToNativeRectangle(t,n,i,r0e);mh.x=e.tileWidth*(a.x-c.west)/c.width|0,mh.y=e.tileHeight*(c.north-a.y)/c.height|0,xE=!0}function s0e(e,t,n,i,r,s,o){return R.toDegrees(r)}function o0e(e,t,n,i,r,s,o){return R.toDegrees(s)}function a0e(e,t,n,i,r,s,o){return Kw(e,t,n,i,r,s),qf.x}function c0e(e,t,n,i,r,s,o){return Kw(e,t,n,i,r,s),qf.y}const l0e=new oe;function Kw(e,t,n,i,r,s,o){if(!EE){if(e.tilingScheme.projection instanceof ur)qf.x=R.toDegrees(r),qf.y=R.toDegrees(s);else{const a=l0e;a.longitude=r,a.latitude=s,e.tilingScheme.projection.project(a,qf)}EE=!0}}function u0e(e,t,n,i,r,s,o){return o}function xs(e){Ac.call(this,e)}xs._requestMetadata=async function(e,t,n,i){try{const r=await n.fetchXML();return xs._metadataSuccess(r,e,t,n,i)}catch(r){if(r instanceof sh)return xs._metadataFailure(e,t);throw r}};xs.fromUrl=async function(e,t){y.defined("url",e);const n=se.createIfNeeded(e);n.appendForwardSlash();const i=n,r=n.getDerivedResource({url:"tilemapresource.xml"});t=T(t,T.EMPTY_OBJECT);const s=await xs._requestMetadata(t,i,r);return new xs(s)};l(Object.create)&&(xs.prototype=Object.create(Ac.prototype),xs.prototype.constructor=xs);function FB(e,t){return e.west<t.rectangle.west&&(e.west=t.rectangle.west),e.east>t.rectangle.east&&(e.east=t.rectangle.east),e.south<t.rectangle.south&&(e.south=t.rectangle.south),e.north>t.rectangle.north&&(e.north=t.rectangle.north),e}function BB(e,t,n){const i=e.positionToTileXY(ie.southwest(t),n),r=e.positionToTileXY(ie.northeast(t),n);return(Math.abs(r.x-i.x)+1)*(Math.abs(r.y-i.y)+1)>4?0:n}xs._metadataSuccess=function(e,t,n,i,r){const s=/tileformat/i,o=/tileset/i,a=/tilesets/i,c=/boundingbox/i;let u,h,d;const p=[],g=e.childNodes[0].childNodes;for(let O=0;O<g.length;O++)if(s.test(g.item(O).nodeName))u=g.item(O);else if(a.test(g.item(O).nodeName)){d=g.item(O);const N=g.item(O).childNodes;for(let B=0;B<N.length;B++)o.test(N.item(B).nodeName)&&p.push(N.item(B))}else c.test(g.item(O).nodeName)&&(h=g.item(O));let _;if(!l(d)||!l(h))throw _=`Unable to find expected tilesets or bbox attributes in ${i.url}.`,l(r)&&Mo.reportError(void 0,r,r.errorEvent,_),new te(_);const b=T(t.fileExtension,u.getAttribute("extension")),x=T(t.tileWidth,parseInt(u.getAttribute("width"),10)),E=T(t.tileHeight,parseInt(u.getAttribute("height"),10));let C=T(t.minimumLevel,parseInt(p[0].getAttribute("order"),10));const w=T(t.maximumLevel,parseInt(p[p.length-1].getAttribute("order"),10)),S=d.getAttribute("profile");let v=t.tilingScheme;if(!l(v))if(S==="geodetic"||S==="global-geodetic")v=new Vr({ellipsoid:t.ellipsoid});else if(S==="mercator"||S==="global-mercator")v=new fs({ellipsoid:t.ellipsoid});else throw _=`${i.url} specifies an unsupported profile attribute, ${S}.`,l(r)&&Mo.reportError(void 0,r,r.errorEvent,_),new te(_);let D=ie.clone(t.rectangle);if(!l(D)){let O,N,B,U;T(t.flipXY,!1)?(B=new k(parseFloat(h.getAttribute("miny")),parseFloat(h.getAttribute("minx"))),U=new k(parseFloat(h.getAttribute("maxy")),parseFloat(h.getAttribute("maxx")))):(B=new k(parseFloat(h.getAttribute("minx")),parseFloat(h.getAttribute("miny"))),U=new k(parseFloat(h.getAttribute("maxx")),parseFloat(h.getAttribute("maxy"))));const f=S==="geodetic"||S==="mercator";if(v.projection instanceof ur||f)O=oe.fromDegrees(B.x,B.y),N=oe.fromDegrees(U.x,U.y);else{const I=v.projection;O=I.unproject(B),N=I.unproject(U)}D=new ie(O.longitude,O.latitude,N.longitude,N.latitude)}return D=FB(D,v),C=BB(v,D,C),{url:n.getDerivedResource({url:`{z}/{x}/{reverseY}.${b}`}),tilingScheme:v,rectangle:D,tileWidth:x,tileHeight:E,minimumLevel:C,maximumLevel:w,tileDiscardPolicy:t.tileDiscardPolicy,credit:t.credit}};xs._metadataFailure=function(e,t){const n=T(e.fileExtension,"png"),i=T(e.tileWidth,256),r=T(e.tileHeight,256),s=e.maximumLevel,o=l(e.tilingScheme)?e.tilingScheme:new fs({ellipsoid:e.ellipsoid});let a=T(e.rectangle,o.rectangle);a=FB(a,o);const c=BB(o,a,e.minimumLevel);return{url:t.getDerivedResource({url:`{z}/{x}/{reverseY}.${n}`}),tilingScheme:o,rectangle:a,tileWidth:i,tileHeight:r,minimumLevel:c,maximumLevel:s,tileDiscardPolicy:e.tileDiscardPolicy,credit:e.credit}};function zB(e){this.channel=e.channel,this.ellipsoid=e.ellipsoid,this.tilingScheme=void 0,this.version=void 0}zB.prototype.build=function(e){e._channel=this.channel,e._version=this.version,e._tilingScheme=this.tilingScheme};function f0e(e,t){let n;try{n=JSON.parse(e)}catch{n=JSON.parse(e.replace(/([\[\{,])[\n\r ]*([A-Za-z0-9]+)[\n\r ]*:/g,'$1"$2":'))}let i;for(let r=0;r<n.layers.length;r++)if(n.layers[r].id===t.channel){i=n.layers[r];break}if(!l(i)){const r=`Could not find layer with channel (id) of ${t.channel}.`;throw new te(r)}if(!l(i.version)){const r=`Could not find a version in channel (id) ${t.channel}.`;throw new te(r)}if(t.version=i.version,l(n.projection)&&n.projection==="flat")t.tilingScheme=new Vr({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,rectangle:new ie(-Math.PI,-Math.PI,Math.PI,Math.PI),ellipsoid:t.ellipsoid});else if(!l(n.projection)||n.projection==="mercator")t.tilingScheme=new fs({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,ellipsoid:t.ellipsoid});else{const r=`Unsupported projection ${n.projection}.`;throw new te(r)}return!0}function h0e(e,t,n){let i=`An error occurred while accessing ${t.url}.`;throw l(e)&&l(e.message)&&(i+=`: ${e.message}`),Mo.reportError(void 0,n,l(n)?n._errorEvent:void 0,i),new te(i)}async function d0e(e,t,n){try{const i=await e.fetchText();f0e(i,t)}catch(i){h0e(i,e,n)}}function ns(e){e=T(e,{}),this._defaultAlpha=void 0,this._defaultNightAlpha=void 0,this._defaultDayAlpha=void 0,this._defaultBrightness=void 0,this._defaultContrast=void 0,this._defaultHue=void 0,this._defaultSaturation=void 0,this._defaultGamma=1.9,this._defaultMinificationFilter=void 0,this._defaultMagnificationFilter=void 0,this._tileDiscardPolicy=e.tileDiscardPolicy,this._channel=e.channel,this._requestType="ImageryMaps",this._credit=new zt(`<a href="http://www.google.com/enterprise/mapsearth/products/earthenterprise.html"><img src="${ns.logoUrl}" title="Google Imagery"/></a>`),this._tilingScheme=void 0,this._version=void 0,this._tileWidth=256,this._tileHeight=256,this._maximumLevel=e.maximumLevel,this._errorEvent=new jt}Object.defineProperties(ns.prototype,{url:{get:function(){return this._url}},path:{get:function(){return this._path}},proxy:{get:function(){return this._resource.proxy}},channel:{get:function(){return this._channel}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return this._maximumLevel}},minimumLevel:{get:function(){return 0}},tilingScheme:{get:function(){return this._tilingScheme}},version:{get:function(){return this._version}},requestType:{get:function(){return this._requestType}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!0}}});ns.fromUrl=async function(e,t,n){y.defined("url",e),y.defined("channel",t),n=T(n,{});const i=T(n.path,"/default_map"),r=se.createIfNeeded(e).getDerivedResource({url:i[0]==="/"?i.substring(1):i});r.appendForwardSlash();const s=r.getDerivedResource({url:"query",queryParameters:{request:"Json",vars:"geeServerDefs",is2d:"t"}}),o=new zB(n);o.channel=t,await d0e(s,o);const a=new ns(n);return o.build(a),a._resource=r,a._url=e,a._path=i,a};ns.prototype.getTileCredits=function(e,t,n){};ns.prototype.requestImage=function(e,t,n,i){const r=this._resource.getDerivedResource({url:"query",request:i,queryParameters:{request:this._requestType,channel:this._channel,version:this._version,x:e,y:t,z:n+1}});return Vo.loadImage(this,r)};ns.prototype.pickFeatures=function(e,t,n,i,r){};ns._logoUrl=void 0;Object.defineProperties(ns,{logoUrl:{get:function(){return l(ns._logoUrl)||(ns._logoUrl=ss("Assets/Images/google_earth_credit.png")),ns._logoUrl},set:function(e){y.defined("value",e),ns._logoUrl=e}}});const p0e=/\/$/,UB=new zt('&copy; <a href="https://www.mapbox.com/about/maps/">Mapbox</a> &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <strong><a href="https://www.mapbox.com/map-feedback/">Improve this map</a></strong>');function jh(e){e=T(e,T.EMPTY_OBJECT);const t=e.mapId;if(!l(t))throw new A("options.mapId is required.");const n=e.accessToken;if(!l(n))throw new A("options.accessToken is required.");this._defaultAlpha=void 0,this._defaultNightAlpha=void 0,this._defaultDayAlpha=void 0,this._defaultBrightness=void 0,this._defaultContrast=void 0,this._defaultHue=void 0,this._defaultSaturation=void 0,this._defaultGamma=void 0,this._defaultMinificationFilter=void 0,this._defaultMagnificationFilter=void 0;const i=se.createIfNeeded(T(e.url,"https://{s}.tiles.mapbox.com/v4/"));this._mapId=t,this._accessToken=n;let r=T(e.format,"png");/\./.test(r)||(r=`.${r}`),this._format=r;let s=i.getUrlComponent();p0e.test(s)||(s+="/"),s+=`${t}/{z}/{x}/{y}${this._format}`,i.url=s,i.setQueryParameters({access_token:n});let o;l(e.credit)?(o=e.credit,typeof o=="string"&&(o=new zt(o))):o=UB,this._resource=i,this._imageryProvider=new Ac({url:i,credit:o,ellipsoid:e.ellipsoid,minimumLevel:e.minimumLevel,maximumLevel:e.maximumLevel,rectangle:e.rectangle})}Object.defineProperties(jh.prototype,{url:{get:function(){return this._imageryProvider.url}},rectangle:{get:function(){return this._imageryProvider.rectangle}},tileWidth:{get:function(){return this._imageryProvider.tileWidth}},tileHeight:{get:function(){return this._imageryProvider.tileHeight}},maximumLevel:{get:function(){return this._imageryProvider.maximumLevel}},minimumLevel:{get:function(){return this._imageryProvider.minimumLevel}},tilingScheme:{get:function(){return this._imageryProvider.tilingScheme}},tileDiscardPolicy:{get:function(){return this._imageryProvider.tileDiscardPolicy}},errorEvent:{get:function(){return this._imageryProvider.errorEvent}},credit:{get:function(){return this._imageryProvider.credit}},proxy:{get:function(){return this._imageryProvider.proxy}},hasAlphaChannel:{get:function(){return this._imageryProvider.hasAlphaChannel}}});jh.prototype.getTileCredits=function(e,t,n){};jh.prototype.requestImage=function(e,t,n,i){return this._imageryProvider.requestImage(e,t,n,i)};jh.prototype.pickFeatures=function(e,t,n,i,r){return this._imageryProvider.pickFeatures(e,t,n,i,r)};jh._defaultCredit=UB;function Ru(e){e=T(e,T.EMPTY_OBJECT),this._defaultAlpha=void 0,this._defaultNightAlpha=void 0,this._defaultDayAlpha=void 0,this._defaultBrightness=void 0,this._defaultContrast=void 0,this._defaultHue=void 0,this._defaultSaturation=void 0,this._defaultGamma=void 0,this._defaultMinificationFilter=void 0,this._defaultMagnificationFilter=void 0;const t=T(e.rectangle,ie.MAX_VALUE),n=new Vr({rectangle:t,numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1,ellipsoid:e.ellipsoid});this._tilingScheme=n,this._image=void 0,this._texture=void 0,this._hasError=!1,this._errorEvent=new jt;let i=e.credit;typeof i=="string"&&(i=new zt(i)),this._credit=i,y.defined("options.url",e.url);const r=se.createIfNeeded(e.url);this._resource=r,y.typeOf.number("options.tileWidth",e.tileWidth),y.typeOf.number("options.tileHeight",e.tileHeight),this._tileWidth=e.tileWidth,this._tileHeight=e.tileHeight}Object.defineProperties(Ru.prototype,{url:{get:function(){return this._resource.url}},proxy:{get:function(){return this._resource.proxy}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return 0}},minimumLevel:{get:function(){return 0}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!0}}});function m0e(e,t,n,i){let r=`Failed to load image ${e.url}`;l(t)&&l(t.message)&&(r+=`: ${t.message}`);const s=Mo.reportError(i,n,l(n)?n._errorEvent:void 0,r,0,0,0,t);if(s.retry)return Zw(e,n,s);throw l(n)&&(n._hasError=!0),new te(r)}async function Zw(e,t,n){try{return await Vo.loadImage(null,e)}catch(i){return m0e(e,i,t,n)}}Ru.fromUrl=async function(e,t){y.defined("url",e);const n=se.createIfNeeded(e),i=await Zw(n);t=T(t,T.EMPTY_OBJECT);const r=new Ru({...t,url:e,tileWidth:i.width,tileHeight:i.height});return r._image=i,r};Ru.prototype.getTileCredits=function(e,t,n){};Ru.prototype.requestImage=async function(e,t,n,i){if(!this._hasError&&!l(this._image)){const r=await Zw(this._resource,this);return this._image=r,Mo.reportSuccess(this._errorEvent),r}return this._image};Ru.prototype.pickFeatures=function(e,t,n,i,r){};function GT(e,t,n){if(!l(e))throw new A("type is required.");if(this.type=e,!l(t))if(e==="json")t="application/json";else if(e==="xml")t="text/xml";else if(e==="html")t="text/html";else if(e==="text")t="text/plain";else throw new A('format is required when type is not "json", "xml", "html", or "text".');if(this.format=t,!l(n))if(e==="json")n=g0e;else if(e==="xml")n=T0e;else if(e==="html")n=BO;else if(e==="text")n=BO;else throw new A('callback is required when type is not "json", "xml", "html", or "text".');this.callback=n}function g0e(e){const t=[],n=e.features;for(let i=0;i<n.length;++i){const r=n[i],s=new Nl;if(s.data=r,s.properties=r.properties,s.configureNameFromProperties(r.properties),s.configureDescriptionFromProperties(r.properties),l(r.geometry)&&r.geometry.type==="Point"){const o=r.geometry.coordinates[0],a=r.geometry.coordinates[1];s.position=oe.fromDegrees(o,a)}t.push(s)}return t}const CE="http://www.mapinfo.com/mxp",_0e="http://www.esri.com/wms",y0e="http://www.opengis.net/wfs",b0e="http://www.opengis.net/gml";function T0e(e){const t=e.documentElement;if(t.localName==="MultiFeatureCollection"&&t.namespaceURI===CE)return x0e(e);if(t.localName==="FeatureInfoResponse"&&t.namespaceURI===_0e)return E0e(e);if(t.localName==="FeatureCollection"&&t.namespaceURI===y0e)return C0e(e);if(t.localName==="ServiceExceptionReport")throw new te(new XMLSerializer().serializeToString(t));return t.localName==="msGMLOutput"?w0e(e):A0e(e)}function x0e(e){const t=[],i=e.documentElement.getElementsByTagNameNS(CE,"Feature");for(let r=0;r<i.length;++r){const s=i[r],o={},a=s.getElementsByTagNameNS(CE,"Val");for(let u=0;u<a.length;++u){const h=a[u];if(h.hasAttribute("ref")){const d=h.getAttribute("ref"),p=h.textContent.trim();o[d]=p}}const c=new Nl;c.data=s,c.properties=o,c.configureNameFromProperties(o),c.configureDescriptionFromProperties(o),t.push(c)}return t}function E0e(e){const t=e.documentElement,n=[];let i;const r=t.getElementsByTagNameNS("*","FIELDS");if(r.length>0)for(let s=0;s<r.length;++s){const o=r[s];i={};const a=o.attributes;for(let c=0;c<a.length;++c){const u=a[c];i[u.name]=u.value}n.push(fy(o,i))}else{const s=t.getElementsByTagNameNS("*","FeatureInfo");for(let o=0;o<s.length;++o){const a=s[o];i={};const c=a.childNodes;for(let u=0;u<c.length;++u){const h=c[u];h.nodeType===Node.ELEMENT_NODE&&(i[h.localName]=h.textContent)}n.push(fy(a,i))}}return n}function C0e(e){const t=[],i=e.documentElement.getElementsByTagNameNS(b0e,"featureMember");for(let r=0;r<i.length;++r){const s=i[r],o={};Jw(s,o),t.push(fy(s,o))}return t}function w0e(e){const t=[];let n;const i=e.documentElement.childNodes;for(let s=0;s<i.length;s++)if(i[s].nodeType===Node.ELEMENT_NODE){n=i[s];break}if(!l(n))throw new te("Unable to find first child of the feature info xml document");const r=n.childNodes;for(let s=0;s<r.length;++s){const o=r[s];if(o.nodeType===Node.ELEMENT_NODE){const a={};Jw(o,a),t.push(fy(o,a))}}return t}function Jw(e,t){let n=!0;for(let i=0;i<e.childNodes.length;++i){const r=e.childNodes[i];r.nodeType===Node.ELEMENT_NODE&&(n=!1),!(r.localName==="Point"||r.localName==="LineString"||r.localName==="Polygon"||r.localName==="boundedBy")&&r.hasChildNodes()&&Jw(r,t)&&(t[r.localName]=r.textContent)}return n}function fy(e,t){const n=new Nl;return n.data=e,n.properties=t,n.configureNameFromProperties(t),n.configureDescriptionFromProperties(t),n}function A0e(e){const t=new XMLSerializer().serializeToString(e),n=document.createElement("div"),i=document.createElement("pre");i.textContent=t,n.appendChild(i);const r=new Nl;return r.data=e,r.description=n.innerHTML,[r]}const S0e=/<body>\s*<\/body>/im,v0e=/<ServiceExceptionReport([\s\S]*)<\/ServiceExceptionReport>/im,I0e=/<title>([\s\S]*)<\/title>/im;function BO(e){if(S0e.test(e)||v0e.test(e))return;let t;const n=I0e.exec(e);n&&n.length>1&&(t=n[1]);const i=new Nl;return i.name=t,i.description=e,i.data=e,[i]}function Vh(e){e=T(e,T.EMPTY_OBJECT),y.typeOf.object("options.clock",e.clock),y.typeOf.object("options.times",e.times),y.typeOf.func("options.requestImageFunction",e.requestImageFunction),y.typeOf.func("options.reloadFunction",e.reloadFunction),this._tileCache={},this._tilesRequestedForInterval=[];const t=this._clock=e.clock;this._times=e.times,this._requestImageFunction=e.requestImageFunction,this._reloadFunction=e.reloadFunction,this._currentIntervalIndex=-1,t.onTick.addEventListener(this._clockOnTick,this),this._clockOnTick(t)}Object.defineProperties(Vh.prototype,{clock:{get:function(){return this._clock},set:function(e){if(!l(e))throw new A("value is required.");this._clock!==e&&(this._clock=e,this._clockOnTick(e),this._reloadFunction())}},times:{get:function(){return this._times},set:function(e){if(!l(e))throw new A("value is required.");this._times!==e&&(this._times=e,this._clockOnTick(this._clock),this._reloadFunction())}},currentInterval:{get:function(){return this._times.get(this._currentIntervalIndex)}}});Vh.prototype.getFromCache=function(e,t,n,i){const r=kB(e,t,n);let s;const o=this._tileCache[this._currentIntervalIndex];if(l(o)&&l(o[r])){const a=o[r];s=a.promise.catch(function(c){throw i.state=a.request.state,c}),delete o[r]}return s};Vh.prototype.checkApproachingInterval=function(e,t,n,i){const r=kB(e,t,n),s=this._tilesRequestedForInterval,o=jB(this),a={key:r,priorityFunction:i.priorityFunction};(!l(o)||!VB(this,a,o))&&s.push(a),s.length>=512&&s.splice(0,256)};Vh.prototype._clockOnTick=function(e){const t=e.currentTime,i=this._times.indexOf(t),r=this._currentIntervalIndex;if(i!==r){const o=this._tileCache[r];for(const a in o)o.hasOwnProperty(a)&&o[a].request.cancel();delete this._tileCache[r],this._tilesRequestedForInterval=[],this._currentIntervalIndex=i,this._reloadFunction();return}const s=jB(this);if(l(s)){const o=this._tilesRequestedForInterval;let a=!0;for(;a&&o.length!==0;){const c=o.pop();a=VB(this,c,s),a||o.push(c)}}};function kB(e,t,n){return`${e}-${t}-${n}`}function O0e(e){const t=e.split("-");if(t.length===3)return{x:Number(t[0]),y:Number(t[1]),level:Number(t[2])}}function jB(e){const t=e._times;if(!l(t))return;const n=e._clock,i=n.currentTime,r=n.canAnimate&&n.shouldAnimate,s=n.multiplier;if(!r&&s!==0)return;let o,a=t.indexOf(i);if(a<0)return;const c=t.get(a);return s>0?(o=ue.secondsDifference(c.stop,i),++a):(o=ue.secondsDifference(c.start,i),--a),o/=s,a>=0&&o<=5?t.get(a):void 0}function VB(e,t,n){const i=e._times.indexOf(n.start),r=e._tileCache;let s=r[i];l(s)||(s=r[i]={});const o=t.key;if(l(s[o]))return!0;const a=O0e(o),c=new Tl({throttle:!1,throttleByServer:!0,type:Kp.IMAGERY,priorityFunction:t.priorityFunction}),u=e._requestImageFunction(a.x,a.y,a.level,c,n);return l(u)?(s[o]={promise:u,request:c},!0):!1}const R0e=[3034,3035,3042,3043,3044],D0e=[4471,4559];function eo(e){if(e=T(e,T.EMPTY_OBJECT),!l(e.url))throw new A("options.url is required.");if(!l(e.layers))throw new A("options.layers is required.");if(l(e.times)&&!l(e.clock))throw new A("options.times was specified, so options.clock is required.");this._defaultAlpha=void 0,this._defaultNightAlpha=void 0,this._defaultDayAlpha=void 0,this._defaultBrightness=void 0,this._defaultContrast=void 0,this._defaultHue=void 0,this._defaultSaturation=void 0,this._defaultGamma=void 0,this._defaultMinificationFilter=void 0,this._defaultMagnificationFilter=void 0,this._getFeatureInfoUrl=T(e.getFeatureInfoUrl,e.url);const t=se.createIfNeeded(e.url),n=se.createIfNeeded(this._getFeatureInfoUrl);t.setQueryParameters(eo.DefaultParameters,!0),n.setQueryParameters(eo.GetFeatureInfoDefaultParameters,!0),l(e.parameters)&&t.setQueryParameters(zO(e.parameters)),l(e.getFeatureInfoParameters)&&n.setQueryParameters(zO(e.getFeatureInfoParameters));const i=this;this._reload=void 0,l(e.times)&&(this._timeDynamicImagery=new Vh({clock:e.clock,times:e.times,requestImageFunction:function(o,a,c,u,h){return GB(i,o,a,c,u,h)},reloadFunction:function(){l(i._reload)&&i._reload()}}));const r={};if(r.layers=e.layers,r.bbox="{westProjected},{southProjected},{eastProjected},{northProjected}",r.width="{width}",r.height="{height}",parseFloat(t.queryParameters.version)>=1.3){r.crs=T(e.crs,e.tilingScheme&&e.tilingScheme.projection instanceof Jn?"EPSG:3857":"CRS:84");const o=r.crs.split(":");if(o[0]==="EPSG"&&o.length===2){const a=Number(o[1]);(a>=4e3&&a<5e3&&!D0e.includes(a)||R0e.includes(a))&&(r.bbox="{southProjected},{westProjected},{northProjected},{eastProjected}")}}else r.srs=T(e.srs,e.tilingScheme&&e.tilingScheme.projection instanceof Jn?"EPSG:3857":"EPSG:4326");t.setQueryParameters(r,!0),n.setQueryParameters(r,!0);const s={query_layers:e.layers,info_format:"{format}"};parseFloat(n.queryParameters.version)>=1.3?(s.i="{i}",s.j="{j}"):(s.x="{i}",s.y="{j}"),n.setQueryParameters(s,!0),this._resource=t,this._pickFeaturesResource=n,this._layers=e.layers,this._tileProvider=new Ac({url:t,pickFeaturesUrl:n,tilingScheme:T(e.tilingScheme,new Vr({ellipsoid:e.ellipsoid})),rectangle:e.rectangle,tileWidth:e.tileWidth,tileHeight:e.tileHeight,minimumLevel:e.minimumLevel,maximumLevel:e.maximumLevel,subdomains:e.subdomains,tileDiscardPolicy:e.tileDiscardPolicy,credit:e.credit,getFeatureInfoFormats:T(e.getFeatureInfoFormats,eo.DefaultGetFeatureInfoFormats),enablePickFeatures:e.enablePickFeatures})}function GB(e,t,n,i,r,s){const o=l(s)?s.data:void 0,a=e._tileProvider;return l(o)&&a._resource.setQueryParameters(o),a.requestImage(t,n,i,r)}function M0e(e,t,n,i,r,s,o){const a=l(o)?o.data:void 0,c=e._tileProvider;return l(a)&&c._pickFeaturesResource.setQueryParameters(a),c.pickFeatures(t,n,i,r,s)}Object.defineProperties(eo.prototype,{url:{get:function(){return this._resource._url}},proxy:{get:function(){return this._resource.proxy}},layers:{get:function(){return this._layers}},tileWidth:{get:function(){return this._tileProvider.tileWidth}},tileHeight:{get:function(){return this._tileProvider.tileHeight}},maximumLevel:{get:function(){return this._tileProvider.maximumLevel}},minimumLevel:{get:function(){return this._tileProvider.minimumLevel}},tilingScheme:{get:function(){return this._tileProvider.tilingScheme}},rectangle:{get:function(){return this._tileProvider.rectangle}},tileDiscardPolicy:{get:function(){return this._tileProvider.tileDiscardPolicy}},errorEvent:{get:function(){return this._tileProvider.errorEvent}},credit:{get:function(){return this._tileProvider.credit}},hasAlphaChannel:{get:function(){return this._tileProvider.hasAlphaChannel}},enablePickFeatures:{get:function(){return this._tileProvider.enablePickFeatures},set:function(e){this._tileProvider.enablePickFeatures=e}},clock:{get:function(){return this._timeDynamicImagery.clock},set:function(e){this._timeDynamicImagery.clock=e}},times:{get:function(){return this._timeDynamicImagery.times},set:function(e){this._timeDynamicImagery.times=e}},getFeatureInfoUrl:{get:function(){return this._getFeatureInfoUrl}}});eo.prototype.getTileCredits=function(e,t,n){return this._tileProvider.getTileCredits(e,t,n)};eo.prototype.requestImage=function(e,t,n,i){let r;const s=this._timeDynamicImagery;let o;return l(s)&&(o=s.currentInterval,r=s.getFromCache(e,t,n,i)),l(r)||(r=GB(this,e,t,n,i,o)),l(r)&&l(s)&&s.checkApproachingInterval(e,t,n,i),r};eo.prototype.pickFeatures=function(e,t,n,i,r){const s=this._timeDynamicImagery,o=l(s)?s.currentInterval:void 0;return M0e(this,e,t,n,i,r,o)};eo.DefaultParameters=Object.freeze({service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"});eo.GetFeatureInfoDefaultParameters=Object.freeze({service:"WMS",version:"1.1.1",request:"GetFeatureInfo"});eo.DefaultGetFeatureInfoFormats=Object.freeze([Object.freeze(new GT("json","application/json")),Object.freeze(new GT("xml","text/xml")),Object.freeze(new GT("text","text/html"))]);function zO(e){const t={};for(const n in e)e.hasOwnProperty(n)&&(t[n.toLowerCase()]=e[n]);return t}const L0e=Object.freeze({service:"WMTS",version:"1.0.0",request:"GetTile"});function gm(e){if(e=T(e,T.EMPTY_OBJECT),!l(e.url))throw new A("options.url is required.");if(!l(e.layer))throw new A("options.layer is required.");if(!l(e.style))throw new A("options.style is required.");if(!l(e.tileMatrixSetID))throw new A("options.tileMatrixSetID is required.");if(l(e.times)&&!l(e.clock))throw new A("options.times was specified, so options.clock is required.");this._defaultAlpha=void 0,this._defaultNightAlpha=void 0,this._defaultDayAlpha=void 0,this._defaultBrightness=void 0,this._defaultContrast=void 0,this._defaultHue=void 0,this._defaultSaturation=void 0,this._defaultGamma=void 0,this._defaultMinificationFilter=void 0,this._defaultMagnificationFilter=void 0;const t=se.createIfNeeded(e.url),n=e.style,i=e.tileMatrixSetID,r=t.url,s=r.match(/{/g);if(!l(s)||s.length===1&&/{s}/.test(r))t.setQueryParameters(L0e),this._useKvp=!0;else{const d={style:n,Style:n,TileMatrixSet:i};t.setTemplateValues(d),this._useKvp=!1}this._resource=t,this._layer=e.layer,this._style=n,this._tileMatrixSetID=i,this._tileMatrixLabels=e.tileMatrixLabels,this._format=T(e.format,"image/jpeg"),this._tileDiscardPolicy=e.tileDiscardPolicy,this._tilingScheme=l(e.tilingScheme)?e.tilingScheme:new fs({ellipsoid:e.ellipsoid}),this._tileWidth=T(e.tileWidth,256),this._tileHeight=T(e.tileHeight,256),this._minimumLevel=T(e.minimumLevel,0),this._maximumLevel=e.maximumLevel,this._rectangle=T(e.rectangle,this._tilingScheme.rectangle),this._dimensions=e.dimensions;const o=this;this._reload=void 0,l(e.times)&&(this._timeDynamicImagery=new Vh({clock:e.clock,times:e.times,requestImageFunction:function(d,p,g,_,b){return HB(o,d,p,g,_,b)},reloadFunction:function(){l(o._reload)&&o._reload()}}));const a=this._tilingScheme.positionToTileXY(ie.southwest(this._rectangle),this._minimumLevel),c=this._tilingScheme.positionToTileXY(ie.northeast(this._rectangle),this._minimumLevel),u=(Math.abs(c.x-a.x)+1)*(Math.abs(c.y-a.y)+1);if(u>4)throw new A(`The imagery provider's rectangle and minimumLevel indicate that there are ${u} tiles at the minimum level. Imagery providers with more than four tiles at the minimum level are not supported.`);this._errorEvent=new jt;const h=e.credit;this._credit=typeof h=="string"?new zt(h):h,this._subdomains=e.subdomains,Array.isArray(this._subdomains)?this._subdomains=this._subdomains.slice():l(this._subdomains)&&this._subdomains.length>0?this._subdomains=this._subdomains.split(""):this._subdomains=["a","b","c"]}function HB(e,t,n,i,r,s){const o=e._tileMatrixLabels,a=l(o)?o[i]:i.toString(),c=e._subdomains,u=e._dimensions,h=l(s)?s.data:void 0;let d,p;if(!e._useKvp)p={TileMatrix:a,TileRow:n.toString(),TileCol:t.toString(),s:c[(t+n+i)%c.length]},d=e._resource.getDerivedResource({request:r}),d.setTemplateValues(p),l(u)&&d.setTemplateValues(u),l(h)&&d.setTemplateValues(h);else{let g={};g.tilematrix=a,g.layer=e._layer,g.style=e._style,g.tilerow=n,g.tilecol=t,g.tilematrixset=e._tileMatrixSetID,g.format=e._format,l(u)&&(g=wt(g,u)),l(h)&&(g=wt(g,h)),p={s:c[(t+n+i)%c.length]},d=e._resource.getDerivedResource({queryParameters:g,request:r}),d.setTemplateValues(p)}return Vo.loadImage(e,d)}Object.defineProperties(gm.prototype,{url:{get:function(){return this._resource.url}},proxy:{get:function(){return this._resource.proxy}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return this._maximumLevel}},minimumLevel:{get:function(){return this._minimumLevel}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._rectangle}},tileDiscardPolicy:{get:function(){return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},format:{get:function(){return this._format}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!0}},clock:{get:function(){return this._timeDynamicImagery.clock},set:function(e){this._timeDynamicImagery.clock=e}},times:{get:function(){return this._timeDynamicImagery.times},set:function(e){this._timeDynamicImagery.times=e}},dimensions:{get:function(){return this._dimensions},set:function(e){this._dimensions!==e&&(this._dimensions=e,l(this._reload)&&this._reload())}}});gm.prototype.getTileCredits=function(e,t,n){};gm.prototype.requestImage=function(e,t,n,i){let r;const s=this._timeDynamicImagery;let o;return l(s)&&(o=s.currentInterval,r=s.getFromCache(e,t,n,i)),l(r)||(r=HB(this,e,t,n,i,o)),l(r)&&l(s)&&s.checkApproachingInterval(e,t,n,i),r};gm.prototype.pickFeatures=function(e,t,n,i,r){};const P0e={ARCGIS_MAPSERVER:Ca.fromUrl,BING:async(e,t)=>bi.fromUrl(e,t),GOOGLE_EARTH:async(e,t)=>{const n=t.channel;return delete t.channel,ns.fromUrl(e,n,t)},MAPBOX:(e,t)=>new jh({url:e,...t}),SINGLE_TILE:Ru.fromUrl,TMS:xs.fromUrl,URL_TEMPLATE:(e,t)=>new Ac({url:e,...t}),WMS:(e,t)=>new eo({url:e,...t}),WMTS:(e,t)=>new gm({url:e,...t})};function aa(e){e=T(e,T.EMPTY_OBJECT),this._defaultAlpha=void 0,this._defaultNightAlpha=void 0,this._defaultDayAlpha=void 0,this._defaultBrightness=void 0,this._defaultContrast=void 0,this._defaultHue=void 0,this._defaultSaturation=void 0,this._defaultGamma=void 0,this._defaultMinificationFilter=void 0,this._defaultMagnificationFilter=void 0,this._tileCredits=void 0,this._errorEvent=new jt}Object.defineProperties(aa.prototype,{rectangle:{get:function(){return this._imageryProvider.rectangle}},tileWidth:{get:function(){return this._imageryProvider.tileWidth}},tileHeight:{get:function(){return this._imageryProvider.tileHeight}},maximumLevel:{get:function(){return this._imageryProvider.maximumLevel}},minimumLevel:{get:function(){return this._imageryProvider.minimumLevel}},tilingScheme:{get:function(){return this._imageryProvider.tilingScheme}},tileDiscardPolicy:{get:function(){return this._imageryProvider.tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._imageryProvider.credit}},hasAlphaChannel:{get:function(){return this._imageryProvider.hasAlphaChannel}},proxy:{get:function(){}}});aa.fromAssetId=async function(e,t){y.typeOf.number("assetId",e),t=T(t,T.EMPTY_OBJECT);const n=qi._createEndpointResource(e,t),i=e.toString()+t.accessToken+t.server;let r=aa._endpointCache[i];l(r)||(r=n.fetchJson(),aa._endpointCache[i]=r);const s=await r;if(s.type!=="IMAGERY")throw new te(`Cesium ion asset ${e} is not an imagery asset.`);let o;const a=s.externalType;if(!l(a))o=await xs.fromUrl(new qi(s,n));else{const u=P0e[a];if(!l(u))throw new te(`Unrecognized Cesium ion imagery type: ${a}`);const h={...s.options},d=h.url;delete h.url,o=await u(d,h)}const c=new aa(t);return o.errorEvent.addEventListener(function(u){u.provider=c,c._errorEvent.raiseEvent(u)}),c._tileCredits=qi.getCreditsFromEndpoint(s,n),c._imageryProvider=o,c};aa.prototype.getTileCredits=function(e,t,n){const i=this._imageryProvider.getTileCredits(e,t,n);return l(i)?this._tileCredits.concat(i):this._tileCredits};aa.prototype.requestImage=function(e,t,n,i){return this._imageryProvider.requestImage(e,t,n,i)};aa.prototype.pickFeatures=function(e,t,n,i,r){return this._imageryProvider.pickFeatures(e,t,n,i,r)};aa._endpointCache={};const N0e={AERIAL:2,AERIAL_WITH_LABELS:3,ROAD:4},F0e=Object.freeze(N0e);function B0e(e){e=T(e,T.EMPTY_OBJECT);const t=T(e.style,F0e.AERIAL);return aa.fromAssetId(t)}const z0e=`uniform sampler2D u_texture;

in vec2 v_textureCoordinates;

void main()
{
    out_FragColor = texture(u_texture, v_textureCoordinates);
}
`,U0e=`in vec4 position;
in float webMercatorT;

uniform vec2 u_textureDimensions;

out vec2 v_textureCoordinates;

void main()
{
    v_textureCoordinates = vec2(position.x, webMercatorT);
    gl_Position = czm_viewportOrthographic * (position * vec4(u_textureDimensions, 1.0, 1.0));
}
`;function Du(e,t,n,i,r){if(this.imageryLayer=e,this.x=t,this.y=n,this.level=i,this.request=void 0,i!==0){const s=t/2|0,o=n/2|0,a=i-1;this.parent=e.getImageryFromCache(s,o,a)}this.state=Rn.UNLOADED,this.imageUrl=void 0,this.image=void 0,this.texture=void 0,this.textureWebMercator=void 0,this.credits=void 0,this.referenceCount=0,!l(r)&&e.ready&&(r=e.imageryProvider.tilingScheme.tileXYToRectangle(t,n,i)),this.rectangle=r}Du.createPlaceholder=function(e){const t=new Du(e,0,0,0);return t.addReference(),t.state=Rn.PLACEHOLDER,t};Du.prototype.addReference=function(){++this.referenceCount};Du.prototype.releaseReference=function(){return--this.referenceCount,this.referenceCount===0?(this.imageryLayer.removeImageryFromCache(this),l(this.parent)&&this.parent.releaseReference(),l(this.image)&&l(this.image.destroy)&&this.image.destroy(),l(this.texture)&&this.texture.destroy(),l(this.textureWebMercator)&&this.texture!==this.textureWebMercator&&this.textureWebMercator.destroy(),Ye(this),0):this.referenceCount};Du.prototype.processStateMachine=function(e,t,n){this.state===Rn.UNLOADED&&!n&&(this.state=Rn.TRANSITIONING,this.imageryLayer._requestImagery(this)),this.state===Rn.RECEIVED&&(this.state=Rn.TRANSITIONING,this.imageryLayer._createTexture(e.context,this));const i=this.state===Rn.READY&&t&&!this.texture;(this.state===Rn.TEXTURE_LOADED||i)&&(this.state=Rn.TRANSITIONING,this.imageryLayer._reprojectTexture(e,this,t))};function fb(e,t,n){this.readyImagery=void 0,this.loadingImagery=e,this.textureCoordinateRectangle=t,this.textureTranslationAndScale=void 0,this.useWebMercatorT=n}fb.prototype.freeResources=function(){l(this.readyImagery)&&this.readyImagery.releaseReference(),l(this.loadingImagery)&&this.loadingImagery.releaseReference()};fb.prototype.processStateMachine=function(e,t,n){const i=this.loadingImagery,r=i.imageryLayer;if(i.processStateMachine(t,!this.useWebMercatorT,n),i.state===Rn.READY)return l(this.readyImagery)&&this.readyImagery.releaseReference(),this.readyImagery=this.loadingImagery,this.loadingImagery=void 0,this.textureTranslationAndScale=r._calculateTextureTranslationAndScale(e,this),!0;let s=i.parent,o;for(;l(s)&&(s.state!==Rn.READY||!this.useWebMercatorT&&!l(s.texture));)s.state!==Rn.FAILED&&s.state!==Rn.INVALID&&(o=o||s),s=s.parent;return this.readyImagery!==s&&(l(this.readyImagery)&&this.readyImagery.releaseReference(),this.readyImagery=s,l(s)&&(s.addReference(),this.textureTranslationAndScale=r._calculateTextureTranslationAndScale(e,this))),i.state===Rn.FAILED||i.state===Rn.INVALID?l(o)?(o.processStateMachine(t,!this.useWebMercatorT,n),!1):!0:!1};function vt(e,t){this._imageryProvider=e,this._readyEvent=new jt,this._errorEvent=new jt,t=T(t,T.EMPTY_OBJECT),e=T(e,T.EMPTY_OBJECT),this.alpha=T(t.alpha,T(e._defaultAlpha,1)),this.nightAlpha=T(t.nightAlpha,T(e._defaultNightAlpha,1)),this.dayAlpha=T(t.dayAlpha,T(e._defaultDayAlpha,1)),this.brightness=T(t.brightness,T(e._defaultBrightness,vt.DEFAULT_BRIGHTNESS)),this.contrast=T(t.contrast,T(e._defaultContrast,vt.DEFAULT_CONTRAST)),this.hue=T(t.hue,T(e._defaultHue,vt.DEFAULT_HUE)),this.saturation=T(t.saturation,T(e._defaultSaturation,vt.DEFAULT_SATURATION)),this.gamma=T(t.gamma,T(e._defaultGamma,vt.DEFAULT_GAMMA)),this.splitDirection=T(t.splitDirection,vt.DEFAULT_SPLIT),this.minificationFilter=T(t.minificationFilter,T(e._defaultMinificationFilter,vt.DEFAULT_MINIFICATION_FILTER)),this.magnificationFilter=T(t.magnificationFilter,T(e._defaultMagnificationFilter,vt.DEFAULT_MAGNIFICATION_FILTER)),this.show=T(t.show,!0),this._minimumTerrainLevel=t.minimumTerrainLevel,this._maximumTerrainLevel=t.maximumTerrainLevel,this._rectangle=T(t.rectangle,ie.MAX_VALUE),this._maximumAnisotropy=t.maximumAnisotropy,this._imageryCache={},this._skeletonPlaceholder=new fb(Du.createPlaceholder(this)),this._show=!0,this._layerIndex=-1,this._isBaseLayer=!1,this._requestImageError=void 0,this._reprojectComputeCommands=[],this.cutoutRectangle=t.cutoutRectangle,this.colorToAlpha=t.colorToAlpha,this.colorToAlphaThreshold=T(t.colorToAlphaThreshold,vt.DEFAULT_APPLY_COLOR_TO_ALPHA_THRESHOLD)}Object.defineProperties(vt.prototype,{imageryProvider:{get:function(){return this._imageryProvider}},ready:{get:function(){return l(this._imageryProvider)}},errorEvent:{get:function(){return this._errorEvent}},readyEvent:{get:function(){return this._readyEvent}},rectangle:{get:function(){return this._rectangle}}});vt.DEFAULT_BRIGHTNESS=1;vt.DEFAULT_CONTRAST=1;vt.DEFAULT_HUE=0;vt.DEFAULT_SATURATION=1;vt.DEFAULT_GAMMA=1;vt.DEFAULT_SPLIT=tm.NONE;vt.DEFAULT_MINIFICATION_FILTER=Ut.LINEAR;vt.DEFAULT_MAGNIFICATION_FILTER=ws.LINEAR;vt.DEFAULT_APPLY_COLOR_TO_ALPHA_THRESHOLD=.004;vt.fromProviderAsync=function(e,t){y.typeOf.object("imageryProviderPromise",e);const n=new vt(void 0,t);return H0e(n,Promise.resolve(e)),n};vt.fromWorldImagery=function(e){return e=T(e,T.EMPTY_OBJECT),vt.fromProviderAsync(B0e({style:e.style}),e)};vt.prototype.isBaseLayer=function(){return this._isBaseLayer};vt.prototype.isDestroyed=function(){return!1};vt.prototype.destroy=function(){return Ye(this)};const qB=new ie,UO=new ie,HT=new ie,WB=new ie;vt.prototype.getImageryRectangle=function(){const e=this._imageryProvider,t=this._rectangle;return ie.intersection(e.rectangle,t)};vt.prototype._createTileImagerySkeletons=function(e,t,n){const i=e.data;if(!l(t)||l(this._minimumTerrainLevel)&&e.level<this._minimumTerrainLevel||l(this._maximumTerrainLevel)&&e.level>this._maximumTerrainLevel)return!1;l(n)||(n=i.imagery.length);const r=this._imageryProvider;if(!this.ready)return this._skeletonPlaceholder.loadingImagery.addReference(),i.imagery.splice(n,0,this._skeletonPlaceholder),!0;const s=r.tilingScheme.projection instanceof Jn&&e.rectangle.north<Jn.MaximumLatitude&&e.rectangle.south>-Jn.MaximumLatitude,o=ie.intersection(r.rectangle,this._rectangle,qB);let a=ie.intersection(e.rectangle,o,UO);if(!l(a)){if(!this.isBaseLayer())return!1;const f=o,I=e.rectangle;a=UO,I.south>=f.north?a.north=a.south=f.north:I.north<=f.south?a.north=a.south=f.south:(a.south=Math.max(I.south,f.south),a.north=Math.min(I.north,f.north)),I.west>=f.east?a.west=a.east=f.east:I.east<=f.west?a.west=a.east=f.west:(a.west=Math.max(I.west,f.west),a.east=Math.min(I.east,f.east))}let c=0;a.south>0?c=a.south:a.north<0&&(c=a.north);const h=1*t.getLevelMaximumGeometricError(e.level);let d=V0e(this,h,c);d=Math.max(0,d);const p=r.maximumLevel;if(d>p&&(d=p),l(r.minimumLevel)){const f=r.minimumLevel;d<f&&(d=f)}const g=r.tilingScheme,_=g.positionToTileXY(ie.northwest(a),d),b=g.positionToTileXY(ie.southeast(a),d);let x=e.rectangle.width/512,E=e.rectangle.height/512;const C=g.tileXYToRectangle(_.x,_.y,d);Math.abs(C.south-e.rectangle.north)<E&&_.y<b.y&&++_.y,Math.abs(C.east-e.rectangle.west)<x&&_.x<b.x&&++_.x;const w=g.tileXYToRectangle(b.x,b.y,d);Math.abs(w.north-e.rectangle.south)<E&&b.y>_.y&&--b.y,Math.abs(w.west-e.rectangle.east)<x&&b.x>_.x&&--b.x;const S=ie.clone(e.rectangle,WB);let v=g.tileXYToRectangle(_.x,_.y,d),D=ie.intersection(v,o,HT),L;s?(g.rectangleToNativeRectangle(S,S),g.rectangleToNativeRectangle(v,v),g.rectangleToNativeRectangle(D,D),g.rectangleToNativeRectangle(o,o),L=g.tileXYToNativeRectangle.bind(g),x=S.width/512,E=S.height/512):L=g.tileXYToRectangle.bind(g);let O,N=0,B=1,U;!this.isBaseLayer()&&Math.abs(D.west-S.west)>=x&&(N=Math.min(1,(D.west-S.west)/S.width)),!this.isBaseLayer()&&Math.abs(D.north-S.north)>=E&&(B=Math.max(0,(D.north-S.south)/S.height));const V=B;for(let f=_.x;f<=b.x;f++)if(O=N,v=L(f,_.y,d),D=ie.simpleIntersection(v,o,HT),!!l(D)){N=Math.min(1,(D.east-S.west)/S.width),f===b.x&&(this.isBaseLayer()||Math.abs(D.east-S.east)<x)&&(N=1),B=V;for(let I=_.y;I<=b.y;I++){if(U=B,v=L(f,I,d),D=ie.simpleIntersection(v,o,HT),!l(D))continue;B=Math.max(0,(D.south-S.south)/S.height),I===b.y&&(this.isBaseLayer()||Math.abs(D.south-S.south)<E)&&(B=0);const F=new Y(O,B,N,U),G=this.getImageryFromCache(f,I,d);i.imagery.splice(n,0,new fb(G,F,s)),++n}}return!0};vt.prototype._calculateTextureTranslationAndScale=function(e,t){let n=t.readyImagery.rectangle,i=e.rectangle;if(t.useWebMercatorT){const c=t.readyImagery.imageryLayer.imageryProvider.tilingScheme;n=c.rectangleToNativeRectangle(n,qB),i=c.rectangleToNativeRectangle(i,WB)}const r=i.width,s=i.height,o=r/n.width,a=s/n.height;return new Y(o*(i.west-n.west)/r,a*(i.south-n.south)/s,o,a)};vt.prototype._requestImagery=function(e){const t=this._imageryProvider,n=this;function i(o){if(!l(o))return r();e.image=o,e.state=Rn.RECEIVED,e.request=void 0,Mo.reportSuccess(n._requestImageError)}function r(o){if(e.request.state===En.CANCELLED){e.state=Rn.UNLOADED,e.request=void 0;return}e.state=Rn.FAILED,e.request=void 0;const a=`Failed to obtain image tile X: ${e.x} Y: ${e.y} Level: ${e.level}.`;n._requestImageError=Mo.reportError(n._requestImageError,t,t.errorEvent,a,e.x,e.y,e.level,o),n._requestImageError.retry&&s()}function s(){const o=new Tl({throttle:!1,throttleByServer:!0,type:Kp.IMAGERY});e.request=o,e.state=Rn.TRANSITIONING;const a=t.requestImage(e.x,e.y,e.level,o);if(!l(a)){e.state=Rn.UNLOADED,e.request=void 0;return}l(t.getTileCredits)&&(e.credits=t.getTileCredits(e.x,e.y,e.level)),a.then(function(c){i(c)}).catch(function(c){r(c)})}s()};vt.prototype._createTextureWebGL=function(e,t){const n=new Cn({minificationFilter:this.minificationFilter,magnificationFilter:this.magnificationFilter}),i=t.image;return l(i.internalFormat)?new kt({context:e,pixelFormat:i.internalFormat,width:i.width,height:i.height,source:{arrayBufferView:i.bufferView},sampler:n}):new kt({context:e,source:i,pixelFormat:this._imageryProvider.hasAlphaChannel?Le.RGBA:Le.RGB,sampler:n})};vt.prototype._createTexture=function(e,t){const n=this._imageryProvider,i=t.image;if(l(n.tileDiscardPolicy)){const s=n.tileDiscardPolicy;if(l(s)){if(!s.isReady()){t.state=Rn.RECEIVED;return}if(s.shouldDiscardImage(i)){t.state=Rn.INVALID;return}}}if(this.minificationFilter!==Ut.NEAREST&&this.minificationFilter!==Ut.LINEAR)throw new A("ImageryLayer minification filter must be NEAREST or LINEAR");const r=this._createTextureWebGL(e,t);n.tilingScheme.projection instanceof Jn?t.textureWebMercator=r:t.texture=r,t.image=void 0,t.state=Rn.TEXTURE_LOADED};function kO(e,t,n){return`${e}:${t}:${n}`}vt.prototype._finalizeReprojectTexture=function(e,t){let n=this.minificationFilter;const i=this.magnificationFilter;if(n===Ut.LINEAR&&i===ws.LINEAR&&!Le.isCompressedFormat(t.pixelFormat)&&R.isPowerOfTwo(t.width)&&R.isPowerOfTwo(t.height)){n=Ut.LINEAR_MIPMAP_LINEAR;const s=We.maximumTextureFilterAnisotropy,o=Math.min(s,T(this._maximumAnisotropy,s)),a=kO(n,i,o);let c=e.cache.imageryLayerMipmapSamplers;l(c)||(c={},e.cache.imageryLayerMipmapSamplers=c);let u=c[a];l(u)||(u=c[a]=new Cn({wrapS:ii.CLAMP_TO_EDGE,wrapT:ii.CLAMP_TO_EDGE,minificationFilter:n,magnificationFilter:i,maximumAnisotropy:o})),t.generateMipmap(dh.NICEST),t.sampler=u}else{const s=kO(n,i,0);let o=e.cache.imageryLayerNonMipmapSamplers;l(o)||(o={},e.cache.imageryLayerNonMipmapSamplers=o);let a=o[s];l(a)||(a=o[s]=new Cn({wrapS:ii.CLAMP_TO_EDGE,wrapT:ii.CLAMP_TO_EDGE,minificationFilter:n,magnificationFilter:i})),t.sampler=a}};vt.prototype._reprojectTexture=function(e,t,n){const i=t.textureWebMercator||t.texture,r=t.rectangle,s=e.context;if(n=T(n,!0),n&&!(this._imageryProvider.tilingScheme.projection instanceof ur)&&r.width/i.width>1e-5){const o=this;t.addReference();const a=new Ip({persists:!0,owner:this,preExecute:function(c){j0e(c,s,i,t.rectangle)},postExecute:function(c){t.texture=c,o._finalizeReprojectTexture(s,c),t.state=Rn.READY,t.releaseReference()},canceled:function(){t.state=Rn.TEXTURE_LOADED,t.releaseReference()}});this._reprojectComputeCommands.push(a)}else n&&(t.texture=i),this._finalizeReprojectTexture(s,i),t.state=Rn.READY};vt.prototype.queueReprojectionCommands=function(e){const t=this._reprojectComputeCommands,n=t.length;for(let i=0;i<n;++i)e.commandList.push(t[i]);t.length=0};vt.prototype.cancelReprojections=function(){this._reprojectComputeCommands.forEach(function(e){l(e.canceled)&&e.canceled()}),this._reprojectComputeCommands.length=0};vt.prototype.getImageryFromCache=function(e,t,n,i){const r=$B(e,t,n);let s=this._imageryCache[r];return l(s)||(s=new Du(this,e,t,n,i),this._imageryCache[r]=s),s.addReference(),s};vt.prototype.removeImageryFromCache=function(e){const t=$B(e.x,e.y,e.level);delete this._imageryCache[t]};function $B(e,t,n){return JSON.stringify([e,t,n])}const Lg={u_textureDimensions:function(){return this.textureDimensions},u_texture:function(){return this.texture},textureDimensions:new k,texture:void 0},k0e=It.supportsTypedArrays()?new Float32Array(2*64):void 0;function j0e(e,t,n,i){let r=t.cache.imageryLayer_reproject;if(!l(r)){r=t.cache.imageryLayer_reproject={vertexArray:void 0,shaderProgram:void 0,sampler:void 0,destroy:function(){l(this.framebuffer)&&this.framebuffer.destroy(),l(this.vertexArray)&&this.vertexArray.destroy(),l(this.shaderProgram)&&this.shaderProgram.destroy()}};const x=new Float32Array(2*64*2);let E=0;for(let D=0;D<64;++D){const L=D/63;x[E++]=0,x[E++]=L,x[E++]=1,x[E++]=L}const C={position:0,webMercatorT:1},w=Ur.getRegularGridIndices(2,64),S=ze.createIndexBuffer({context:t,typedArray:w,usage:Ae.STATIC_DRAW,indexDatatype:Ge.UNSIGNED_SHORT});r.vertexArray=new $i({context:t,attributes:[{index:C.position,vertexBuffer:ze.createVertexBuffer({context:t,typedArray:x,usage:Ae.STATIC_DRAW}),componentsPerAttribute:2},{index:C.webMercatorT,vertexBuffer:ze.createVertexBuffer({context:t,sizeInBytes:64*2*4,usage:Ae.STREAM_DRAW}),componentsPerAttribute:1}],indexBuffer:S});const v=new Je({sources:[U0e]});r.shaderProgram=kn.fromCache({context:t,vertexShaderSource:v,fragmentShaderSource:z0e,attributeLocations:C}),r.sampler=new Cn({wrapS:ii.CLAMP_TO_EDGE,wrapT:ii.CLAMP_TO_EDGE,minificationFilter:Ut.LINEAR,magnificationFilter:ws.LINEAR})}n.sampler=r.sampler;const s=n.width,o=n.height;Lg.textureDimensions.x=s,Lg.textureDimensions.y=o,Lg.texture=n;let a=Math.sin(i.south);const c=.5*Math.log((1+a)/(1-a));a=Math.sin(i.north);const h=1/(.5*Math.log((1+a)/(1-a))-c),d=new kt({context:t,width:s,height:o,pixelFormat:n.pixelFormat,pixelDatatype:n.pixelDatatype,preMultiplyAlpha:n.preMultiplyAlpha});R.isPowerOfTwo(s)&&R.isPowerOfTwo(o)&&d.generateMipmap(dh.NICEST);const p=i.south,g=i.north,_=k0e;let b=0;for(let x=0;x<64;++x){const E=x/63,C=R.lerp(p,g,E);a=Math.sin(C);const S=(.5*Math.log((1+a)/(1-a))-c)*h;_[b++]=S,_[b++]=S}r.vertexArray.getAttribute(1).vertexBuffer.copyFromArrayView(_),e.shaderProgram=r.shaderProgram,e.outputTexture=d,e.uniformMap=Lg,e.vertexArray=r.vertexArray}function V0e(e,t,n){const i=e._imageryProvider,r=i.tilingScheme,s=r.ellipsoid,o=e._imageryProvider.tilingScheme.projection instanceof ur?1:Math.cos(n),a=r.rectangle,u=s.maximumRadius*a.width*o/(i.tileWidth*r.getNumberOfXTilesAtLevel(0))/t,h=Math.log(u)/Math.log(2);return Math.round(h)|0}function G0e(e,t){e.numberOfListeners>0?e.raiseEvent(t):console.error(t)}async function H0e(e,t){let n;try{if(n=await Promise.resolve(t),e.isDestroyed())return;e._imageryProvider=n,e._readyEvent.raiseEvent(n)}catch(i){G0e(e._errorEvent,i)}}const qT="units",q0e=[1,2,5],Id=25.4/.28;class W0e extends Lz{constructor(t){t=t||{};const n=document.createElement("div");n.style.pointerEvents="none",super({element:n,render:t.render,target:t.target}),this.on,this.once,this.un;const i=t.className!==void 0?t.className:t.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=i+"-inner",this.element.className=i+" "+Pz,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=t.minWidth!==void 0?t.minWidth:64,this.maxWidth_=t.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(qT,this.handleUnitsChanged_),this.setUnits(t.units||"metric"),this.scaleBar_=t.bar||!1,this.scaleBarSteps_=t.steps||4,this.scaleBarText_=t.text||!1,this.dpi_=t.dpi||void 0}getUnits(){return this.get(qT)}handleUnitsChanged_(){this.updateElement_()}setUnits(t){this.set(qT,t)}setDpi(t){this.dpi_=t}updateElement_(){const t=this.viewState_;if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const n=t.center,i=t.projection,r=this.getUnits(),s=r=="degrees"?"degrees":"m";let o=T_(i,t.resolution,n,s);const a=this.minWidth_*(this.dpi_||Id)/Id,c=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||Id)/Id:void 0;let u=a*o,h="";if(r=="degrees"){const w=jE.degrees;u*=w,u<w/60?(h="â³",o*=3600):u<w?(h="â²",o*=60):h="Â°"}else if(r=="imperial")u<.9144?(h="in",o/=.0254):u<1609.344?(h="ft",o/=.3048):(h="mi",o/=1609.344);else if(r=="nautical")o/=1852,h="NM";else if(r=="metric")u<1e-6?(h="nm",o*=1e9):u<.001?(h="Î¼m",o*=1e6):u<1?(h="mm",o*=1e3):u<1e3?h="m":(h="km",o/=1e3);else if(r=="us")u<.9144?(h="in",o*=39.37):u<1609.344?(h="ft",o/=.30480061):(h="mi",o/=1609.3472);else throw new Error("Invalid units");let d=3*Math.floor(Math.log(a*o)/Math.log(10)),p,g,_,b,x,E;for(;;){_=Math.floor(d/3);const w=Math.pow(10,_);if(p=q0e[(d%3+3)%3]*w,g=Math.round(p/o),isNaN(g)){this.element.style.display="none",this.renderedVisible_=!1;return}if(c!==void 0&&g>=c){p=b,g=x,_=E;break}else if(g>=a)break;b=p,x=g,E=_,++d}const C=this.scaleBar_?this.createScaleBar(g,p,h):p.toFixed(_<0?-_:0)+" "+h;this.renderedHTML_!=C&&(this.innerElement_.innerHTML=C,this.renderedHTML_=C),this.renderedWidth_!=g&&(this.innerElement_.style.width=g+"px",this.renderedWidth_=g),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(t,n,i){const r=this.getScaleForResolution(),s=r<1?Math.round(1/r).toLocaleString()+" : 1":"1 : "+Math.round(r).toLocaleString(),o=this.scaleBarSteps_,a=t/o,c=[this.createMarker("absolute")];for(let h=0;h<o;++h){const d=h%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";c.push(`<div><div class="ol-scale-singlebar ${d}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(h%2===0||o===2?this.createStepText(h,t,!1,n,i):"")+"</div>")}return c.push(this.createStepText(o,t,!0,n,i)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${t}px;">`+s+"</div>":"")+c.join("")}createMarker(t){return`<div class="ol-scale-step-marker" style="position: ${t}; top: ${t==="absolute"?3:-10}px;"></div>`}createStepText(t,n,i,r,s){const a=(t===0?0:Math.round(r/this.scaleBarSteps_*t*100)/100)+(t===0?"":" "+s),c=t===0?-3:n/this.scaleBarSteps_*-1,u=t===0?0:n/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${c}px;text-align: ${t===0?"left":"center"};min-width: ${u}px;left: ${i?n+"px":"unset"};">`+a+"</div>"}getScaleForResolution(){const t=T_(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),n=this.dpi_||Id,i=1e3/25.4;return t*i*n}render(t){const n=t.frameState;n?this.viewState_=n.viewState:this.viewState_=null,this.updateElement_()}}class ca extends Hi{constructor(n,i,r,s,o,a,c){let u=a??{};u=ca.isGMFTreeItem(u)?ca.getOptionsFromGMFTreeItem(u):u;super(n,i,r,u);z(this,"url");z(this,"layer");z(this,"dimensions");z(this,"imageType");z(this,"style");z(this,"minResolution");z(this,"maxResolution");z(this,"legend");z(this,"legendImage");z(this,"isLegendExpanded");z(this,"wasLegendExpanded");z(this,"ogcServer");z(this,"wmsLayers");z(this,"queryLayers");z(this,"printLayers");z(this,"hiDPILegendImages");z(this,"_olayer");this.url=s,this.layer=o,this.ogcServer=c,this.dimensions=u.dimensions,this.imageType=u.imageType,this.style=u.style,this.wmsLayers=u.wmsLayers,this.queryLayers=u.queryLayers,this.printLayers=u.printLayers,this.minResolution=u.minResolution,this.maxResolution=u.maxResolution,this.legend=u.legend??!1,this.legendImage=u.legendImage,this.isLegendExpanded=(u==null?void 0:u.isLegendExpanded)??!1,this.wasLegendExpanded=(u==null?void 0:u.wasLegendExpanded)??!this.isLegendExpanded,this.hiDPILegendImages=u.hiDPILegendImages}clone(){const n={isDefaultChecked:this.isDefaultChecked,metadataUrl:this.metadataUrl,disclaimer:this.disclaimer,opacity:this.opacity,protected:this.protected,dimensions:this.dimensions,imageType:this.imageType,style:this.style,queryLayers:this.queryLayers,wmsLayers:this.wmsLayers,printLayers:this.printLayers,minResolution:this.minResolution,maxResolution:this.maxResolution,legend:this.legend,legendImage:this.legendImage,isLegendExpanded:this.isLegendExpanded,wasLegendExpanded:this.wasLegendExpanded,hiDPILegendImages:this.hiDPILegendImages},i=new ca(this.id,this.name,this.order,this.url,this.layer,n,this.ogcServer);return i.activeState=this.activeState,i}get layerUniqueId(){return this.dimensions?this.layer+JSON.stringify(this.dimensions):this.name}hasRestrictedResolution(){return this.minResolution&&this.minResolution!==0||this.maxResolution&&this.maxResolution!==999999999}isVisibleAtResolution(n){return n==null||!this.hasRestrictedResolution()?!0:n>=(this.minResolution??-1)&&n<=(this.maxResolution??1/0)}static isGMFTreeItem(n){return"id"in n}static getOptionsFromGMFTreeItem(n){var i,r,s,o,a,c,u,h,d,p,g,_,b;return{isDefaultChecked:(i=n.metadata)==null?void 0:i.isChecked,metadataUrl:(r=n.metadata)==null?void 0:r.metadataUrl,disclaimer:(s=n.metadata)==null?void 0:s.disclaimer,opacity:1,protected:(o=n.metadata)==null?void 0:o.protected,dimensions:n.dimensions,imageType:n.imageType,style:n.style,wmsLayers:(a=n.metadata)==null?void 0:a.wmsLayers,ogcServer:(c=n.metadata)==null?void 0:c.ogcServer,queryLayers:(u=n.metadata)==null?void 0:u.queryLayers,printLayers:(h=n.metadata)==null?void 0:h.printLayers,minResolution:n.minResolutionHint,maxResolution:n.maxResolutionHint,legend:(d=n.metadata)==null?void 0:d.legend,legendImage:(p=n.metadata)==null?void 0:p.legendImage,isLegendExpanded:(g=n.metadata)==null?void 0:g.isLegendExpanded,wasLegendExpanded:(_=n.metadata)==null?void 0:_.wasLegendExpanded,hiDPILegendImages:(b=n.metadata)==null?void 0:b.hiDPILegendImages}}}class hy extends Hi{constructor(n,i,r){super(0,n.name,0,{isDefaultChecked:!0});z(this,"_features");z(this,"lastModifiedDate");z(this,"legend",!0);z(this,"isLegendExpanded");z(this,"wasLegendExpanded");z(this,"extent");this._features=i,this.extent=r,this.lastModifiedDate=new Date(n.lastModified).toLocaleDateString(fn.getInstance().Config.general.locale),this.isLegendExpanded=!0,this.wasLegendExpanded=!1}clone(){throw new Error("Cannot clone layer for local file.")}}class $0e{constructor(t,n,i,r,s,o){z(this,"map");z(this,"swiper");z(this,"closeButton");z(this,"swiperEventListeners",{});z(this,"swiperMaxVal");z(this,"wmtsManager");z(this,"wmsManager");z(this,"localFileManager");this.map=t,this.swiper=n;const a=n.getAttribute("max");if(!a)throw new Error("The Attribute <max> on the swiper is not defined !");this.swiperMaxVal=parseInt(a),this.wmtsManager=r,this.wmsManager=s,this.localFileManager=o,this.closeButton=i}toggleSwipe(t){t instanceof ji?this.toggleSwipeForWms(t):t instanceof ca?this.toggleSwipeForWmts(t):t instanceof hy&&this.toggleSwipeForLocalFile(t)}toggleSwipeForWmts(t){if(this.wmtsManager.layerExists(t)){const n=this.wmtsManager.getLayer(t);if(n){t.swiped==="no"?this.deactivateSwipeForLayer(t.layer,n):this.activateSwipeForLayer(t.layer,n,t.swiped);return}}throw new Error("Cannot swipe this layer: it does not exist.")}toggleSwipeForLocalFile(t){if(this.localFileManager.layerExists(t)){const n=this.localFileManager.getLayer(t);if(n){t.swiped==="no"?this.deactivateSwipeForLayer(t.name,n):this.activateSwipeForLayer(t.name,n,t.swiped);return}}throw new Error("Cannot swipe this layer: it does not exist.")}toggleSwipeForWms(t){if(this.wmsManager.getClient(t).layerExists(t)){this.wmsManager.getClient(t).makeLayerIndependent(t);const n=this.wmsManager.getClient(t).getOLayer(t);if(n){t.swiped==="no"?this.deactivateSwipeForLayer(t.name,n):this.activateSwipeForLayer(t.name,n,t.swiped);return}}throw new Error("Layer does not exists. Cannot activate swiper.")}showSwiper(){this.swiper.style.display="block",this.closeButton.style.display="block"}hideSwiper(){this.swiper.style.display="none",this.closeButton.style.display="none"}activateSwipeForLayer(t,n,i){if(t in this.swiperEventListeners){const o=this.swiperEventListeners[t];n.removeEventListener("prerender",o.prerender),n.removeEventListener("postrender",o.postrender),delete this.swiperEventListeners[t]}const r=o=>this.prerenderSwipe(o,i),s=o=>this.postrenderSwipe(o);this.swiperEventListeners[t]={olayer:n,prerender:r,postrender:s},n.addEventListener("prerender",r),n.addEventListener("postrender",s),this.showSwiper(),this.map.render()}deactivateSwipeForLayer(t,n){if(t in this.swiperEventListeners){const i=this.swiperEventListeners[t];n.removeEventListener("prerender",i.prerender),n.removeEventListener("postrender",i.postrender),delete this.swiperEventListeners[t]}Object.keys(this.swiperEventListeners).length<=0&&this.hideSwiper(),this.map.render()}deactivateSwiper(){for(const[t,n]of Object.entries(this.swiperEventListeners))n.olayer.removeEventListener("prerender",n.prerender),n.olayer.removeEventListener("postrender",n.postrender);this.hideSwiper(),this.map.render()}prerenderSwipe(t,n){const i=t.context,r=this.map.getSize();if(!r)throw new Error("The size of the map is null !");const s=r,o=s[0]*(parseInt(this.swiper.value)/this.swiperMaxVal);let a=null,c=null,u=null,h=null;if(n==="right")a=Ic(t,[o,0]),c=Ic(t,[s[0],0]),u=Ic(t,[o,s[1]]),h=Ic(t,s);else if(n==="left")a=Ic(t,[0,0]),c=Ic(t,[o,0]),u=Ic(t,[0,s[1]]),h=Ic(t,[o,s[1]]);else throw new Error("Invalid value for parameter side");i.save(),i.beginPath(),i.moveTo(a[0],a[1]),i.lineTo(u[0],u[1]),i.lineTo(h[0],h[1]),i.lineTo(c[0],c[1]),i.closePath(),i.clip()}postrenderSwipe(t){t.context.restore()}}const Qw=34962,eA=34963,X0e=35040,tA=35044,Y0e=35048,K0e=5121,Z0e=5123,J0e=5125,XB=5126,jO=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function Q0e(e,t){t=Object.assign({preserveDrawingBuffer:!0,antialias:!Nz},t);const n=jO.length;for(let i=0;i<n;++i)try{const r=e.getContext(jO[i],t);if(r)return r}catch{}return null}const eTe={STATIC_DRAW:tA,STREAM_DRAW:X0e,DYNAMIC_DRAW:Y0e};class YB{constructor(t,n){this.array_=null,this.type_=t,Fz(t===Qw||t===eA,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=n!==void 0?n:eTe.STATIC_DRAW}ofSize(t){return this.array_=new(Pg(this.type_))(t),this}fromArray(t){return this.array_=Pg(this.type_).from(t),this}fromArrayBuffer(t){return this.array_=new(Pg(this.type_))(t),this}getType(){return this.type_}getArray(){return this.array_}setArray(t){const n=Pg(this.type_);if(!(t instanceof n))throw new Error(`Expected ${n}`);this.array_=t}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function Pg(e){switch(e){case Qw:return Float32Array;case eA:return Uint32Array;default:return Float32Array}}const Ng={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},tTe=`
  precision mediump float;

  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;

  uniform vec2 u_screenSize;

  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,nTe=`
  precision mediump float;

  uniform sampler2D u_image;
  uniform float u_opacity;

  varying vec2 v_texCoord;

  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class VO{constructor(t){this.gl_=t.webGlContext;const n=this.gl_;this.scaleRatio_=t.scaleRatio||1,this.renderTargetTexture_=n.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=n.createFramebuffer(),this.depthBuffer_=n.createRenderbuffer();const i=n.createShader(n.VERTEX_SHADER);n.shaderSource(i,t.vertexShader||tTe),n.compileShader(i);const r=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(r,t.fragmentShader||nTe),n.compileShader(r),this.renderTargetProgram_=n.createProgram(),n.attachShader(this.renderTargetProgram_,i),n.attachShader(this.renderTargetProgram_,r),n.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=n.createBuffer();const s=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];n.bindBuffer(n.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),n.bufferData(n.ARRAY_BUFFER,new Float32Array(s),n.STATIC_DRAW),this.renderTargetAttribLocation_=n.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=n.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=n.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=n.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],t.uniforms&&Object.keys(t.uniforms).forEach(o=>{this.uniforms_.push({value:t.uniforms[o],location:n.getUniformLocation(this.renderTargetProgram_,o)})})}getRenderTargetTexture(){return this.renderTargetTexture_}getGL(){return this.gl_}init(t){const n=this.getGL(),i=[n.drawingBufferWidth*this.scaleRatio_,n.drawingBufferHeight*this.scaleRatio_];if(n.bindFramebuffer(n.FRAMEBUFFER,this.getFrameBuffer()),n.bindRenderbuffer(n.RENDERBUFFER,this.getDepthBuffer()),n.viewport(0,0,i[0],i[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==i[0]||this.renderTargetTextureSize_[1]!==i[1]){this.renderTargetTextureSize_=i;const r=0,s=n.RGBA,o=0,a=n.RGBA,c=n.UNSIGNED_BYTE,u=null;n.bindTexture(n.TEXTURE_2D,this.renderTargetTexture_),n.texImage2D(n.TEXTURE_2D,r,s,i[0],i[1],o,a,c,u),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.renderTargetTexture_,0),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,i[0],i[1]),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,this.depthBuffer_)}}apply(t,n,i,r){const s=this.getGL(),o=t.size;if(s.bindFramebuffer(s.FRAMEBUFFER,n?n.getFrameBuffer():null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.renderTargetTexture_),!n){const c=is(s.canvas);if(!t.renderTargets[c]){const u=s.getContextAttributes();u&&u.preserveDrawingBuffer&&(s.clearColor(0,0,0,0),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)),t.renderTargets[c]=!0}}s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.bindBuffer(s.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),s.useProgram(this.renderTargetProgram_),s.enableVertexAttribArray(this.renderTargetAttribLocation_),s.vertexAttribPointer(this.renderTargetAttribLocation_,2,s.FLOAT,!1,0,0),s.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),s.uniform1i(this.renderTargetTextureLocation_,0);const a=t.layerStatesArray[t.layerIndex].opacity;s.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(t),i&&i(s,t),s.drawArrays(s.TRIANGLES,0,6),r&&r(s,t)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(t){const n=this.getGL();let i,r=1;this.uniforms_.forEach(function(s){if(i=typeof s.value=="function"?s.value(t):s.value,i instanceof HTMLCanvasElement||i instanceof ImageData)s.texture||(s.texture=n.createTexture()),n.activeTexture(n[`TEXTURE${r}`]),n.bindTexture(n.TEXTURE_2D,s.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),i instanceof ImageData?n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,i.width,i.height,0,n.UNSIGNED_BYTE,new Uint8Array(i.data)):n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,i),n.uniform1i(s.location,r++);else if(Array.isArray(i))switch(i.length){case 2:n.uniform2f(s.location,i[0],i[1]);return;case 3:n.uniform3f(s.location,i[0],i[1],i[2]);return;case 4:n.uniform4f(s.location,i[0],i[1],i[2],i[3]);return;default:return}else typeof i=="number"&&n.uniform1f(s.location,i)})}}function KB(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ZB(e,t){return e[0]=t[0],e[1]=t[1],e[4]=t[2],e[5]=t[3],e[12]=t[4],e[13]=t[5],e}const Uc={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},Ud={UNSIGNED_BYTE:K0e,UNSIGNED_SHORT:Z0e,UNSIGNED_INT:J0e,FLOAT:XB},dy={};function GO(e){return"shared/"+e}let HO=0;function iTe(){const e="unique/"+HO;return HO+=1,e}function rTe(e){let t=dy[e];if(!t){const n=document.createElement("canvas");n.width=1,n.height=1,n.style.position="absolute",n.style.left="0",t={users:0,context:Q0e(n)},dy[e]=t}return t.users+=1,t.context}function sTe(e){const t=dy[e];if(!t||(t.users-=1,t.users>0))return;const n=t.context,i=n.getExtension("WEBGL_lose_context");i&&i.loseContext();const r=n.canvas;r.width=1,r.height=1,delete dy[e]}class oTe extends Bz{constructor(t){super(),t=t||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=t.canvasCacheKey?GO(t.canvasCacheKey):iTe(),this.gl_=rTe(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const n=this.gl_.canvas;n.addEventListener(Ng.LOST,this.boundHandleWebGLContextLost_),n.addEventListener(Ng.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=x_(),this.offsetScaleMatrix_=x_(),this.tmpMat4_=KB(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],t.uniforms&&this.setUniforms(t.uniforms),this.postProcessPasses_=t.postProcesses?t.postProcesses.map(i=>new VO({webGlContext:this.gl_,scaleRatio:i.scaleRatio,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,uniforms:i.uniforms})):[new VO({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(t){this.uniforms_=[],this.addUniforms(t)}addUniforms(t){for(const n in t)this.uniforms_.push({name:n,value:t[n]})}canvasCacheKeyMatches(t){return this.canvasCacheKey_===GO(t)}getExtension(t){if(t in this.extensionCache_)return this.extensionCache_[t];const n=this.gl_.getExtension(t);return this.extensionCache_[t]=n,n}bindBuffer(t){const n=this.gl_,i=is(t);let r=this.bufferCache_[i];if(!r){const s=n.createBuffer();r={buffer:t,webGlBuffer:s},this.bufferCache_[i]=r}n.bindBuffer(t.getType(),r.webGlBuffer)}flushBufferData(t){const n=this.gl_;this.bindBuffer(t),n.bufferData(t.getType(),t.getArray(),t.getUsage())}deleteBuffer(t){const n=is(t);delete this.bufferCache_[n]}disposeInternal(){const t=this.gl_.canvas;t.removeEventListener(Ng.LOST,this.boundHandleWebGLContextLost_),t.removeEventListener(Ng.RESTORED,this.boundHandleWebGLContextRestored_),sTe(this.canvasCacheKey_),delete this.gl_}prepareDraw(t,n,i){const r=this.gl_,s=this.getCanvas(),o=t.size,a=t.pixelRatio;(s.width!==o[0]*a||s.height!==o[1]*a)&&(s.width=o[0]*a,s.height=o[1]*a,s.style.width=o[0]+"px",s.style.height=o[1]+"px");for(let c=this.postProcessPasses_.length-1;c>=0;c--)this.postProcessPasses_[c].init(t);r.bindTexture(r.TEXTURE_2D,null),r.clearColor(0,0,0,0),r.depthRange(0,1),r.clearDepth(1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.enable(r.BLEND),r.blendFunc(r.ONE,n?r.ZERO:r.ONE_MINUS_SRC_ALPHA),i?(r.enable(r.DEPTH_TEST),r.depthFunc(r.LEQUAL)):r.disable(r.DEPTH_TEST)}bindFrameBuffer(t,n){const i=this.getGL();i.bindFramebuffer(i.FRAMEBUFFER,t),n&&i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,n,0)}bindInitialFrameBuffer(){const t=this.getGL(),n=this.postProcessPasses_[0].getFrameBuffer();t.bindFramebuffer(t.FRAMEBUFFER,n);const i=this.postProcessPasses_[0].getRenderTargetTexture();t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0)}bindTexture(t,n,i){const r=this.gl_;r.activeTexture(r.TEXTURE0+n),r.bindTexture(r.TEXTURE_2D,t),r.uniform1i(this.getUniformLocation(i),n)}bindAttribute(t,n,i){const r=this.getGL();this.bindBuffer(t);const s=this.getAttributeLocation(n);r.enableVertexAttribArray(s),r.vertexAttribPointer(s,i,r.FLOAT,!1,0,0)}prepareDrawToRenderTarget(t,n,i,r){const s=this.gl_,o=n.getSize();s.bindFramebuffer(s.FRAMEBUFFER,n.getFramebuffer()),s.bindRenderbuffer(s.RENDERBUFFER,n.getDepthbuffer()),s.viewport(0,0,o[0],o[1]),s.bindTexture(s.TEXTURE_2D,n.getTexture()),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,i?s.ZERO:s.ONE_MINUS_SRC_ALPHA),r?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}drawElements(t,n){const i=this.gl_;this.getExtension("OES_element_index_uint");const r=i.UNSIGNED_INT,s=4,o=n-t,a=t*s;i.drawElements(i.TRIANGLES,o,r,a)}finalizeDraw(t,n,i){for(let r=0,s=this.postProcessPasses_.length;r<s;r++)r===s-1?this.postProcessPasses_[r].apply(t,null,n,i):this.postProcessPasses_[r].apply(t,this.postProcessPasses_[r+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(t){const n=t.size,i=t.viewState.rotation,r=t.pixelRatio;this.setUniformFloatValue(Uc.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(Uc.ZOOM,t.viewState.zoom),this.setUniformFloatValue(Uc.RESOLUTION,t.viewState.resolution),this.setUniformFloatValue(Uc.PIXEL_RATIO,r),this.setUniformFloatVec2(Uc.VIEWPORT_SIZE_PX,[n[0],n[1]]),this.setUniformFloatValue(Uc.ROTATION,i)}applyHitDetectionUniform(t){const n=this.getUniformLocation(Uc.HIT_DETECTION);this.getGL().uniform1i(n,t?1:0),t&&this.setUniformFloatValue(Uc.PIXEL_RATIO,.5)}applyUniforms(t){const n=this.gl_;let i,r=0;this.uniforms_.forEach(s=>{if(i=typeof s.value=="function"?s.value(t):s.value,i instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof ImageData||i instanceof WebGLTexture){i instanceof WebGLTexture&&!s.texture?(s.prevValue=void 0,s.texture=i):s.texture||(s.prevValue=void 0,s.texture=n.createTexture()),this.bindTexture(s.texture,r,s.name),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);const o=!(i instanceof HTMLImageElement)||i.complete;!(i instanceof WebGLTexture)&&o&&s.prevValue!==i&&(s.prevValue=i,n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,i)),r++}else if(Array.isArray(i)&&i.length===6)this.setUniformMatrixValue(s.name,ZB(this.tmpMat4_,i));else if(Array.isArray(i)&&i.length<=4)switch(i.length){case 2:n.uniform2f(this.getUniformLocation(s.name),i[0],i[1]);return;case 3:n.uniform3f(this.getUniformLocation(s.name),i[0],i[1],i[2]);return;case 4:n.uniform4f(this.getUniformLocation(s.name),i[0],i[1],i[2],i[3]);return;default:return}else typeof i=="number"&&n.uniform1f(this.getUniformLocation(s.name),i)})}useProgram(t,n){this.gl_.useProgram(t),this.currentProgram_=t,n&&(this.applyFrameState(n),this.applyUniforms(n))}compileShader(t,n){const i=this.gl_,r=i.createShader(n);return i.shaderSource(r,t),i.compileShader(r),r}getProgram(t,n){const i=this.gl_,r=this.compileShader(t,i.FRAGMENT_SHADER),s=this.compileShader(n,i.VERTEX_SHADER),o=i.createProgram();if(i.attachShader(o,r),i.attachShader(o,s),i.linkProgram(o),!i.getShaderParameter(r,i.COMPILE_STATUS)){const a=`Fragment shader compilation failed: ${i.getShaderInfoLog(r)}`;throw new Error(a)}if(i.deleteShader(r),!i.getShaderParameter(s,i.COMPILE_STATUS)){const a=`Vertex shader compilation failed: ${i.getShaderInfoLog(s)}`;throw new Error(a)}if(i.deleteShader(s),!i.getProgramParameter(o,i.LINK_STATUS)){const a=`GL program linking failed: ${i.getProgramInfoLog(o)}`;throw new Error(a)}return o}getUniformLocation(t){const n=is(this.currentProgram_);return this.uniformLocationsByProgram_[n]===void 0&&(this.uniformLocationsByProgram_[n]={}),this.uniformLocationsByProgram_[n][t]===void 0&&(this.uniformLocationsByProgram_[n][t]=this.gl_.getUniformLocation(this.currentProgram_,t)),this.uniformLocationsByProgram_[n][t]}getAttributeLocation(t){const n=is(this.currentProgram_);return this.attribLocationsByProgram_[n]===void 0&&(this.attribLocationsByProgram_[n]={}),this.attribLocationsByProgram_[n][t]===void 0&&(this.attribLocationsByProgram_[n][t]=this.gl_.getAttribLocation(this.currentProgram_,t)),this.attribLocationsByProgram_[n][t]}makeProjectionTransform(t,n){const i=t.size,r=t.viewState.rotation,s=t.viewState.resolution,o=t.viewState.center;return RR(n,0,0,2/(s*i[0]),2/(s*i[1]),-r,-o[0],-o[1]),n}setUniformFloatValue(t,n){this.gl_.uniform1f(this.getUniformLocation(t),n)}setUniformFloatVec2(t,n){this.gl_.uniform2fv(this.getUniformLocation(t),n)}setUniformFloatVec4(t,n){this.gl_.uniform4fv(this.getUniformLocation(t),n)}setUniformMatrixValue(t,n){this.gl_.uniformMatrix4fv(this.getUniformLocation(t),!1,n)}enableAttributeArray_(t,n,i,r,s){const o=this.getAttributeLocation(t);o<0||(this.gl_.enableVertexAttribArray(o),this.gl_.vertexAttribPointer(o,n,i,!1,r,s))}enableAttributes(t){const n=aTe(t);let i=0;for(let r=0;r<t.length;r++){const s=t[r];this.enableAttributeArray_(s.name,s.size,s.type||XB,n,i),i+=s.size*JB(s.type)}}handleWebGLContextLost(t){zz(this.bufferCache_),this.currentProgram_=null,t.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(t,n,i,r){const s=this.gl_;i=i||s.createTexture();const o=r?s.NEAREST:s.LINEAR;s.bindTexture(s.TEXTURE_2D,i),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,o),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,o),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE);const a=0,c=s.RGBA,u=0,h=s.RGBA,d=s.UNSIGNED_BYTE;return n instanceof Uint8Array?s.texImage2D(s.TEXTURE_2D,a,c,t[0],t[1],u,h,d,n):n?s.texImage2D(s.TEXTURE_2D,a,c,h,d,n):s.texImage2D(s.TEXTURE_2D,a,c,t[0],t[1],u,h,d,null),i}}function aTe(e){let t=0;for(let n=0;n<e.length;n++){const i=e[n];t+=i.size*JB(i.type)}return t}function JB(e){switch(e){case Ud.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case Ud.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case Ud.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case Ud.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class nA extends Uz{constructor(t,n){super(t),n=n||{},this.inversePixelTransform_=x_(),this.postProcesses_=n.postProcesses,this.uniforms_=n.uniforms,this.helper,this.onMapChanged_=()=>{this.clearCache(),this.removeHelper()},t.addChangeListener(hx.MAP,this.onMapChanged_),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(t,n){const i=this.getLayer();if(i.hasListener(Vu.PRECOMPOSE)){const r=new vb(Vu.PRECOMPOSE,void 0,n,t);i.dispatchEvent(r)}}dispatchPostComposeEvent(t,n){const i=this.getLayer();if(i.hasListener(Vu.POSTCOMPOSE)){const r=new vb(Vu.POSTCOMPOSE,void 0,n,t);i.dispatchEvent(r)}}reset(t){this.uniforms_=t.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(t){if(this.getLayer().getRenderSource()){let n=!0,i=-1,r;for(let o=0,a=t.layerStatesArray.length;o<a;o++){const c=t.layerStatesArray[o].layer,u=c.getRenderer();if(!(u instanceof nA)){n=!0;continue}const h=c.getClassName();if((n||h!==r)&&(i+=1,n=!1),r=h,u===this)break}const s="map/"+t.mapId+"/group/"+i;(!this.helper||!this.helper.canvasCacheKeyMatches(s)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new oTe({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),r&&(this.helper.getCanvas().className=r),this.afterHelperCreated())}return this.prepareFrameInternal(t)}afterHelperCreated(){}prepareFrameInternal(t){return!0}clearCache(){}disposeInternal(){var t;this.clearCache(),this.removeHelper(),(t=this.getLayer())==null||t.removeChangeListener(hx.MAP,this.onMapChanged_),super.disposeInternal()}dispatchRenderEvent_(t,n,i){const r=this.getLayer();if(r.hasListener(t)){RR(this.inversePixelTransform_,0,0,i.pixelRatio,-i.pixelRatio,0,0,-i.size[1]);const s=new vb(t,this.inversePixelTransform_,i,n);r.dispatchEvent(s)}}preRender(t,n){this.dispatchRenderEvent_(Vu.PRERENDER,t,n)}postRender(t,n){this.dispatchRenderEvent_(Vu.POSTRENDER,t,n)}}class cTe{constructor(t,n){this.name=t,this.data=n,this.texture_=null}getTexture(t){if(!this.texture_){const n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.data.length/4,1,0,t.RGBA,t.UNSIGNED_BYTE,this.data),this.texture_=n}return this.texture_}delete(t){this.texture_&&t.deleteTexture(this.texture_),this.texture_=null}}class lTe extends kz{constructor(t){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter=t.gutter||0,this.helper=t.helper,this.loaded=!1,this.ready=!1}setTile(t){if(t!==this.tile)if(this.tile&&this.tile.removeEventListener($s.CHANGE,this.handleTileChange_),this.tile=t,this.loaded=t.getState()===gn.LOADED,this.loaded)this.uploadTile();else{if(t instanceof DR){const n=t.getImage();n instanceof Image&&!n.crossOrigin&&(n.crossOrigin="anonymous")}t.addEventListener($s.CHANGE,this.handleTileChange_)}}uploadTile(){MR()}setReady(){this.ready=!0,this.dispatchEvent($s.CHANGE)}handleTileChange_(){this.tile.getState()===gn.LOADED&&(this.loaded=!0,this.uploadTile())}setHelper(t){this.helper=t,this.helper&&this.loaded&&this.uploadTile()}disposeInternal(){this.setHelper(null),this.tile.removeEventListener($s.CHANGE,this.handleTileChange_)}}function QB(e,t,n){const i=n?e.LINEAR:e.NEAREST;e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,i)}function uTe(e,t,n,i){QB(e,t,i),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)}function qO(e,t,n,i,r,s){const o=e.getGL();let a,c;n instanceof Float32Array?(a=o.FLOAT,e.getExtension("OES_texture_float"),c=e.getExtension("OES_texture_float_linear")!==null):(a=o.UNSIGNED_BYTE,c=!0),QB(o,t,s&&c);const u=n.byteLength/i[1];let h=1;u%8===0?h=8:u%4===0?h=4:u%2===0&&(h=2);let d;switch(r){case 1:{d=o.LUMINANCE;break}case 2:{d=o.LUMINANCE_ALPHA;break}case 3:{d=o.RGB;break}case 4:{d=o.RGBA;break}default:throw new Error(`Unsupported number of bands: ${r}`)}const p=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,h),o.texImage2D(o.TEXTURE_2D,0,d,i[0],i[1],0,d,a,n),o.pixelStorei(o.UNPACK_ALIGNMENT,p)}let xf=null;function fTe(){xf=jz(1,1,void 0,{willReadFrequently:!0})}class hTe extends lTe{constructor(t){super(t),this.textures=[],this.renderSize_=nl(t.grid.getTileSize(t.tile.tileCoord[0])),this.bandCount=NaN;const n=new YB(Qw,tA);n.fromArray([0,1,1,1,1,0,0,0]),this.helper.flushBufferData(n),this.coords=n,this.setTile(t.tile)}setHelper(t){var i;const n=(i=this.helper)==null?void 0:i.getGL();if(n){this.helper.deleteBuffer(this.coords);for(let r=0;r<this.textures.length;++r)n.deleteTexture(this.textures[r])}super.setHelper(t),t&&t.flushBufferData(this.coords)}uploadTile(){const t=this.helper,n=t.getGL(),i=this.tile;this.textures.length=0;let r;i instanceof DR||i instanceof VE?r=i.getImage():r=i.getData();const s=QA(r);if(s){const C=n.createTexture();this.textures.push(C),this.bandCount=4,uTe(n,C,s,i.interpolate),this.setReady();return}r=eS(r);const o=i.getSize(),a=[o[0]+2*this.gutter,o[1]+2*this.gutter],c=r instanceof Float32Array,u=a[0]*a[1],h=c?Float32Array:Uint8Array,d=h.BYTES_PER_ELEMENT,p=r.byteLength/a[1];this.bandCount=Math.floor(p/d/a[0]);const g=Math.ceil(this.bandCount/4);if(g===1){const C=n.createTexture();this.textures.push(C),qO(t,C,r,a,this.bandCount,i.interpolate),this.setReady();return}const _=new Array(g);for(let C=0;C<g;++C){const w=n.createTexture();this.textures.push(w);const S=C<g-1?4:(this.bandCount-1)%4+1;_[C]=new h(u*S)}let b=0,x=0;const E=a[0]*this.bandCount;for(let C=0;C<a[1];++C){for(let w=0;w<E;++w){const S=r[x+w],v=Math.floor(b/this.bandCount),D=w%this.bandCount,L=Math.floor(D/4),O=_[L],N=O.length/u,B=D%4;O[v*N+B]=S,++b}x+=p/d}for(let C=0;C<g;++C){const w=this.textures[C],S=_[C],v=S.length/u;qO(t,w,S,a,v,i.interpolate)}this.setReady()}getImagePixelData_(t,n,i){const r=this.gutter,s=this.renderSize_[0],o=this.renderSize_[1];xf||fTe(),xf.clearRect(0,0,1,1);const a=t.width,c=t.height,u=a-2*r,h=c-2*r,d=r+Math.floor(u*(n/s)),p=r+Math.floor(h*(i/o));let g;try{xf.drawImage(t,d,p,1,1,0,0,1,1),g=xf.getImageData(0,0,1,1).data}catch{return xf=null,null}return g}getArrayPixelData_(t,n,i,r){const s=this.gutter,o=this.renderSize_[0],a=this.renderSize_[1],c=n[0],u=n[1],h=c+2*s,d=u+2*s,p=s+Math.floor(c*(i/o)),g=s+Math.floor(u*(r/a));if(t instanceof DataView){const b=t.byteLength/(h*d),x=b*(g*h+p),E=t.buffer.slice(x,x+b);return new DataView(E)}const _=this.bandCount*(g*h+p);return t.slice(_,_+this.bandCount)}getPixelData(t,n){if(!this.loaded)return null;if(this.tile instanceof LR){const i=this.tile.getData(),r=eS(i);if(r){const s=this.tile.getSize();return this.getArrayPixelData_(r,s,t,n)}return this.getImagePixelData_(QA(i),t,n)}return this.getImagePixelData_(this.tile.getImage(),t,n)}}const dTe={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"};function WO(e){return 1/(e+2)}function pTe(){return{tileIds:new Set,representationsByZ:{}}}function $O(e,t){return e.tileIds.has(is(t))}function XO(e,t,n){const i=e.representationsByZ;n in i||(i[n]=new Set),i[n].add(t),e.tileIds.add(is(t.tile))}function WT(e,t){const n=e.layerStatesArray[e.layerIndex];n.extent&&(t=hp(t,PR(n.extent,e.viewState.projection)));const i=n.layer.getRenderSource();if(!i.getWrapX()){const r=i.getTileGridForProjection(e.viewState.projection).getExtent();r&&(t=hp(t,r))}return t}function wE(e,t){return`${e.getKey()},${df(t)}`}class mTe extends nA{constructor(t,n){super(t,{uniforms:n.uniforms,postProcesses:n.postProcesses}),this.renderComplete=!1,this.tileTransform_=x_(),this.tempMat4=KB(),this.tempTileRange_=new Vz(0,0,0,0),this.tempTileCoord_=tS(0,0,0),this.tempSize_=[0,0];const i=n.cacheSize!==void 0?n.cacheSize:512;this.tileRepresentationCache=new Gz(i),this.frameState=null,this.renderedProjection_=void 0}reset(t){super.reset({uniforms:t.uniforms})}prepareFrameInternal(t){this.renderedProjection_?t.viewState.projection!==this.renderedProjection_&&(this.clearCache(),this.renderedProjection_=t.viewState.projection):this.renderedProjection_=t.viewState.projection;const i=this.getLayer().getRenderSource();return!i||Hz(WT(t,t.extent))?!1:i.getState()==="ready"}createTileRepresentation(t){return MR()}enqueueTiles(t,n,i,r,s){const o=t.viewState,a=this.getLayer(),c=a.getRenderSource(),u=c.getTileGridForProjection(o.projection),h=c.getGutterForProjection(o.projection),d=is(c);d in t.wantedTiles||(t.wantedTiles[d]={});const p=t.wantedTiles[d],g=this.tileRepresentationCache,_=a.getMapInternal(),b=Math.max(i-s,u.getMinZoom(),u.getZForResolution(Math.min(a.getMaxResolution(),_?_.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):u.getResolution(0)),c.zDirection));for(let x=i;x>=b;--x){const E=u.getTileRangeForExtentAndZ(n,x,this.tempTileRange_),C=u.getResolution(x);for(let w=E.minX;w<=E.maxX;++w)for(let S=E.minY;S<=E.maxY;++S){const v=tS(x,w,S,this.tempTileCoord_),D=wE(c,v);let L,O;if(g.containsKey(D)&&(L=g.get(D),O=L.tile),(!L||L.tile.key!==c.getKey())&&(O=c.getTile(x,w,S,t.pixelRatio,o.projection),!O)||$O(r,O))continue;L?L.setTile(O):(L=this.createTileRepresentation({tile:O,grid:u,helper:this.helper,gutter:h}),g.set(D,L)),XO(r,L,x);const N=O.getKey();p[N]=!0,O.getState()===gn.IDLE&&(t.tileQueue.isKeyQueued(N)||t.tileQueue.enqueue([O,d,u.getTileCoordCenter(v),C]))}}}beforeTilesRender(t,n){this.helper.prepareDraw(this.frameState,!n,!0)}beforeTilesMaskRender(t){return!1}renderTile(t,n,i,r,s,o,a,c,u,h,d){}renderTileMask(t,n,i,r){}drawTile_(t,n,i,r,s,o,a){if(!n.ready)return;const u=n.tile.tileCoord,h=df(u),d=h in o?o[h]:1,p=a.getResolution(i),g=nl(a.getTileSize(i),this.tempSize_),_=a.getOrigin(i),b=a.getTileCoordExtent(u),x=d<1?-1:WO(i);d<1&&(t.animate=!0);const E=t.viewState,C=E.center[0],w=E.center[1],S=g[0]+2*r,v=g[1]+2*r,D=S/v,L=(C-_[0])/(g[0]*p),O=(_[1]-w)/(g[1]*p),N=E.resolution/p,B=u[1],U=u[2];qz(this.tileTransform_),nS(this.tileTransform_,2/(t.size[0]*N/S),-2/(t.size[1]*N/S)),Wz(this.tileTransform_,E.rotation),nS(this.tileTransform_,1,1/D),$z(this.tileTransform_,(g[0]*(B-L)-r)/S,(g[1]*(U-O)-r)/v),this.renderTile(n,this.tileTransform_,t,s,p,g,_,b,x,r,d)}renderFrame(t){this.frameState=t,this.renderComplete=!0;const n=this.helper.getGL();this.preRender(n,t);const i=t.viewState,r=this.getLayer(),s=r.getRenderSource(),o=s.getTileGridForProjection(i.projection),a=s.getGutterForProjection(i.projection),c=WT(t,t.extent),u=o.getZForResolution(i.resolution,s.zDirection),h=pTe(),d=r.getPreload();if(t.nextExtent){const v=o.getZForResolution(i.nextResolution,s.zDirection),D=WT(t,t.nextExtent);this.enqueueTiles(t,D,v,h,d)}this.enqueueTiles(t,c,u,h,0),d>0&&setTimeout(()=>{this.enqueueTiles(t,c,u-1,h,d-1)},0);const p={},g=is(this),_=t.time;let b=!1;const x=h.representationsByZ;if(u in x)for(const v of x[u]){const D=v.tile;if((D instanceof VE||D instanceof GE)&&D.getState()===gn.EMPTY)continue;const L=D.tileCoord;if(v.ready){const B=D.getAlpha(g,_);if(B===1){D.endTransition(g);continue}b=!0;const U=df(L);p[U]=B}if(this.renderComplete=!1,this.findAltTiles_(o,L,u+1,h))continue;const N=o.getMinZoom();for(let B=u-1;B>=N&&!this.findAltTiles_(o,L,B,h);--B);}const E=Object.keys(x).map(Number).sort(Xz);if(this.beforeTilesMaskRender(t))for(let v=0,D=E.length;v<D;++v){const L=E[v];for(const O of x[L]){const N=O.tile.tileCoord;if(df(N)in p)continue;const U=o.getTileCoordExtent(N);this.renderTileMask(O,L,U,WO(L))}}this.beforeTilesRender(t,b);for(let v=0,D=E.length;v<D;++v){const L=E[v];for(const O of x[L]){const N=O.tile.tileCoord;df(N)in p||this.drawTile_(t,O,L,a,c,p,o)}}if(u in x)for(const v of x[u]){const D=v.tile.tileCoord;df(D)in p&&this.drawTile_(t,v,u,a,c,p,o)}this.beforeFinalize(t),this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const w=this.helper.getCanvas(),S=this.tileRepresentationCache;for(;S.canExpireCache();)S.pop().dispose();return this.postRender(n,t),w}beforeFinalize(t){}findAltTiles_(t,n,i,r){const s=t.getTileRangeForTileCoordAndZ(n,i,this.tempTileRange_);if(!s)return!1;let o=!0;const a=this.tileRepresentationCache,c=this.getLayer().getRenderSource();for(let u=s.minX;u<=s.maxX;++u)for(let h=s.minY;h<=s.maxY;++h){const d=wE(c,[i,u,h]);let p=!1;if(a.containsKey(d)){const g=a.get(d);g.ready&&!$O(r,g.tile)&&(XO(r,g,i),p=!0)}p||(o=!1)}return o}clearCache(){super.clearCache();const t=this.tileRepresentationCache;t.forEach(n=>n.dispose()),t.clear()}afterHelperCreated(){super.afterHelperCreated(),this.tileRepresentationCache.forEach(t=>t.setHelper(this.helper))}disposeInternal(){super.disposeInternal(),delete this.frameState}}const pt={...dTe,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},g_={TEXTURE_COORD:"a_textureCoord"},gTe=[{name:g_.TEXTURE_COORD,size:2,type:Ud.FLOAT}];class _Te extends mTe{constructor(t,n){super(t,n),this.program_,this.vertexShader_=n.vertexShader,this.fragmentShader_=n.fragmentShader,this.indices_=new YB(eA,tA),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=n.paletteTextures||[]}reset(t){if(super.reset(t),this.helper){const n=this.helper.getGL();for(const i of this.paletteTextures_)i.delete(n)}if(this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.paletteTextures_=t.paletteTextures||[],this.helper){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_);const n=this.helper.getGL();for(const i of this.paletteTextures_)i.getTexture(n)}}afterHelperCreated(){super.afterHelperCreated();const t=this.helper.getGL();for(const n of this.paletteTextures_)n.getTexture(t);this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}removeHelper(){if(this.helper){const t=this.helper.getGL();for(const n of this.paletteTextures_)n.delete(t)}super.removeHelper()}createTileRepresentation(t){return new hTe(t)}beforeTilesRender(t,n){super.beforeTilesRender(t,n),this.helper.useProgram(this.program_,t)}renderTile(t,n,i,r,s,o,a,c,u,h,d){const p=this.helper.getGL();this.helper.bindBuffer(t.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(gTe);let g=0;for(;g<t.textures.length;){const D=`${pt.TILE_TEXTURE_ARRAY}[${g}]`;this.helper.bindTexture(t.textures[g],g,D),++g}for(let D=0;D<this.paletteTextures_.length;++D){const L=this.paletteTextures_[D],O=L.getTexture(p);this.helper.bindTexture(O,g,L.name),++g}const _=i.viewState,b=o[0]+2*h,x=o[1]+2*h,C=t.tile.tileCoord,w=C[1],S=C[2];this.helper.setUniformMatrixValue(pt.TILE_TRANSFORM,ZB(this.tempMat4,n)),this.helper.setUniformFloatValue(pt.TRANSITION_ALPHA,d),this.helper.setUniformFloatValue(pt.DEPTH,u);let v=r;h>0&&(v=c,hp(v,r,v)),this.helper.setUniformFloatVec4(pt.RENDER_EXTENT,v),this.helper.setUniformFloatValue(pt.RESOLUTION,_.resolution),this.helper.setUniformFloatValue(pt.ZOOM,_.zoom),this.helper.setUniformFloatValue(pt.TEXTURE_PIXEL_WIDTH,b),this.helper.setUniformFloatValue(pt.TEXTURE_PIXEL_HEIGHT,x),this.helper.setUniformFloatValue(pt.TEXTURE_RESOLUTION,s),this.helper.setUniformFloatValue(pt.TEXTURE_ORIGIN_X,a[0]+w*o[0]*s-h*s),this.helper.setUniformFloatValue(pt.TEXTURE_ORIGIN_Y,a[1]-S*o[1]*s+h*s),this.helper.drawElements(0,this.indices_.getSize())}getData(t){if(!this.helper.getGL())return null;const i=this.frameState;if(!i)return null;const r=this.getLayer(),s=Yz(i.pixelToCoordinateTransform,t.slice()),o=i.viewState,a=r.getExtent();if(a&&!iS(PR(a,o.projection),s))return null;const c=r.getSources(Kz([s]),o.resolution);let u,h,d;for(u=c.length-1;u>=0;--u)if(h=c[u],h.getState()==="ready"){if(d=h.getTileGridForProjection(o.projection),h.getWrapX())break;const g=d.getExtent();if(!g||iS(g,s))break}if(u<0)return null;const p=this.tileRepresentationCache;for(let g=d.getZForResolution(o.resolution);g>=d.getMinZoom();--g){const _=d.getTileCoordForCoordAndZ(s,g),b=wE(h,_);if(!p.containsKey(b))continue;const x=p.get(b),E=x.tile;if((E instanceof VE||E instanceof GE)&&E.getState()===gn.EMPTY)return null;if(!x.loaded)continue;const C=d.getOrigin(g),w=nl(d.getTileSize(g)),S=d.getResolution(g),v=(s[0]-C[0])/S-_[1]*w[0],D=(C[1]-s[1])/S-_[2]*w[1];return x.getPixelData(v,D)}return null}disposeInternal(){const t=this.helper;if(t){const n=t.getGL();for(const i of this.paletteTextures_)i.delete(n);this.paletteTextures_.length=0,n.deleteProgram(this.program_),delete this.program_,t.deleteBuffer(this.indices_)}super.disposeInternal(),delete this.indices_}}function yTe(e,t){return`operator_${e}_${Object.keys(t.functions).length}`}function hb(e){const t=e.toString();return t.includes(".")?t:t+".0"}function iA(e){if(e.length<2||e.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${e.length}(${e.map(hb).join(", ")})`}function bTe(e){const t=BR(e),n=t.length>3?t[3]:1;return iA([t[0]/255,t[1]/255,t[2]/255,n])}function TTe(e){const t=nl(e);return iA(t)}const $T={};let xTe=0;function e3(e){return e in $T||($T[e]=xTe++),$T[e]}function ETe(e){return hb(e3(e))}function t3(e){return"u_var_"+e}function CTe(){return{inFragmentShader:!1,variables:{},properties:{},functions:{},bandCount:0,style:{}}}const XT="getBandValue",n3="u_paletteTextures";function wTe(e,t,n,i){const r=Zz(e,t,n);return rA(r,t,i)}function Kt(e){return(t,n,i)=>{const r=n.args.length,s=new Array(r);for(let o=0;o<r;++o)s[o]=rA(n.args[o],i,t);return e(s,t)}}const ATe={[xt.Get]:(e,t)=>{const i=t.args[0].value;return i in e.properties||(e.properties[i]={name:i,type:t.type}),(e.inFragmentShader?"v_prop_":"a_prop_")+i},[xt.GeometryType]:(e,t,n)=>{const i="geometryType";return i in e.properties||(e.properties[i]={name:i,type:NR,evaluator:o=>iU(o.getGeometry())}),(e.inFragmentShader?"v_prop_":"a_prop_")+i},[xt.LineMetric]:()=>"currentLineMetric",[xt.Var]:(e,t)=>{const i=t.args[0].value;return i in e.variables||(e.variables[i]={name:i,type:t.type}),t3(i)},[xt.Resolution]:()=>"u_resolution",[xt.Zoom]:()=>"u_zoom",[xt.Time]:()=>"u_time",[xt.Any]:Kt(e=>`(${e.join(" || ")})`),[xt.All]:Kt(e=>`(${e.join(" && ")})`),[xt.Not]:Kt(([e])=>`(!${e})`),[xt.Equal]:Kt(([e,t])=>`(${e} == ${t})`),[xt.NotEqual]:Kt(([e,t])=>`(${e} != ${t})`),[xt.GreaterThan]:Kt(([e,t])=>`(${e} > ${t})`),[xt.GreaterThanOrEqualTo]:Kt(([e,t])=>`(${e} >= ${t})`),[xt.LessThan]:Kt(([e,t])=>`(${e} < ${t})`),[xt.LessThanOrEqualTo]:Kt(([e,t])=>`(${e} <= ${t})`),[xt.Multiply]:Kt(e=>`(${e.join(" * ")})`),[xt.Divide]:Kt(([e,t])=>`(${e} / ${t})`),[xt.Add]:Kt(e=>`(${e.join(" + ")})`),[xt.Subtract]:Kt(([e,t])=>`(${e} - ${t})`),[xt.Clamp]:Kt(([e,t,n])=>`clamp(${e}, ${t}, ${n})`),[xt.Mod]:Kt(([e,t])=>`mod(${e}, ${t})`),[xt.Pow]:Kt(([e,t])=>`pow(${e}, ${t})`),[xt.Abs]:Kt(([e])=>`abs(${e})`),[xt.Floor]:Kt(([e])=>`floor(${e})`),[xt.Ceil]:Kt(([e])=>`ceil(${e})`),[xt.Round]:Kt(([e])=>`floor(${e} + 0.5)`),[xt.Sin]:Kt(([e])=>`sin(${e})`),[xt.Cos]:Kt(([e])=>`cos(${e})`),[xt.Atan]:Kt(([e,t])=>t!==void 0?`atan(${e}, ${t})`:`atan(${e})`),[xt.Sqrt]:Kt(([e])=>`sqrt(${e})`),[xt.Match]:Kt(e=>{const t=e[0],n=e[e.length-1];let i=null;for(let r=e.length-3;r>=1;r-=2){const s=e[r],o=e[r+1];i=`(${t} == ${s} ? ${o} : ${i||n})`}return i}),[xt.Between]:Kt(([e,t,n])=>`(${e} >= ${t} && ${e} <= ${n})`),[xt.Interpolate]:Kt(([e,t,...n])=>{let i="";for(let r=0;r<n.length-2;r+=2){const s=n[r],o=i||n[r+1],a=n[r+2],c=n[r+3];let u;e===hb(1)?u=`(${t} - ${s}) / (${a} - ${s})`:u=`(pow(${e}, (${t} - ${s})) - 1.0) / (pow(${e}, (${a} - ${s})) - 1.0)`,i=`mix(${o}, ${c}, clamp(${u}, 0.0, 1.0))`}return i}),[xt.Case]:Kt(e=>{const t=e[e.length-1];let n=null;for(let i=e.length-3;i>=0;i-=2){const r=e[i],s=e[i+1];n=`(${r} ? ${s} : ${n||t})`}return n}),[xt.In]:Kt(([e,...t],n)=>{const i=yTe("in",n),r=[];for(let s=0;s<t.length;s+=1)r.push(`  if (inputValue == ${t[s]}) { return true; }`);return n.functions[i]=`bool ${i}(float inputValue) {
${r.join(`
`)}
  return false;
}`,`${i}(${e})`}),[xt.Array]:Kt(e=>`vec${e.length}(${e.join(", ")})`),[xt.Color]:Kt(e=>{if(e.length===1)return`vec4(vec3(${e[0]} / 255.0), 1.0)`;if(e.length===2)return`vec4(vec3(${e[0]} / 255.0), ${e[1]})`;const t=e.slice(0,3).map(i=>`${i} / 255.0`);if(e.length===3)return`vec4(${t.join(", ")}, 1.0)`;const n=e[3];return`vec4(${t.join(", ")}, ${n})`}),[xt.Band]:Kt(([e,t,n],i)=>{if(!(XT in i.functions)){let r="";const s=i.bandCount||1;for(let o=0;o<s;o++){const a=Math.floor(o/4);let c=o%4;o===s-1&&c===1&&(c=3);const u=`${pt.TILE_TEXTURE_ARRAY}[${a}]`;r+=`  if (band == ${o+1}.0) {
    return texture2D(${u}, v_textureCoord + vec2(dx, dy))[${c}];
  }
`}i.functions[XT]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${pt.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${pt.TEXTURE_PIXEL_HEIGHT};
${r}
}`}return`${XT}(${e}, ${t??"0.0"}, ${n??"0.0"})`}),[xt.Palette]:(e,t)=>{const[n,...i]=t.args,r=i.length,s=new Uint8Array(r*4);for(let u=0;u<i.length;u++){const h=i[u].value,d=BR(h),p=u*4;s[p]=d[0],s[p+1]=d[1],s[p+2]=d[2],s[p+3]=d[3]*255}e.paletteTextures||(e.paletteTextures=[]);const o=`${n3}[${e.paletteTextures.length}]`,a=new cTe(o,s);e.paletteTextures.push(a);const c=rA(n,cu,e);return`texture2D(${o}, vec2((${c} + 0.5) / ${r}.0, 0.5))`}};function rA(e,t,n){if(e instanceof Jz){const i=ATe[e.operator];if(i===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(e.operator)}`);return i(n,e,t)}if((e.type&cu)>0)return hb(e.value);if((e.type&Qz)>0)return e.value.toString();if((e.type&NR)>0)return ETe(e.value.toString());if((e.type&FR)>0)return bTe(e.value);if((e.type&eU)>0)return iA(e.value);if((e.type&tU)>0)return TTe(e.value);throw new Error(`Unexpected expression ${e.value} (expected type ${nU(t)})`)}function ff(e,t,n){const i=rU();return wTe(t,n,i,e)}function YO(e,t){const n=`
    attribute vec2 ${g_.TEXTURE_COORD};
    uniform mat4 ${pt.TILE_TRANSFORM};
    uniform float ${pt.TEXTURE_PIXEL_WIDTH};
    uniform float ${pt.TEXTURE_PIXEL_HEIGHT};
    uniform float ${pt.TEXTURE_RESOLUTION};
    uniform float ${pt.TEXTURE_ORIGIN_X};
    uniform float ${pt.TEXTURE_ORIGIN_Y};
    uniform float ${pt.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${g_.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${pt.TEXTURE_ORIGIN_X} + ${pt.TEXTURE_RESOLUTION} * ${pt.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${pt.TEXTURE_ORIGIN_Y} - ${pt.TEXTURE_RESOLUTION} * ${pt.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${pt.TILE_TRANSFORM} * vec4(${g_.TEXTURE_COORD}, ${pt.DEPTH}, 1.0);
    }
  `,i={...CTe(),inFragmentShader:!0,bandCount:t,style:e},r=[];if(e.color!==void 0){const d=ff(i,e.color,FR);r.push(`color = ${d};`)}if(e.contrast!==void 0){const d=ff(i,e.contrast,cu);r.push(`color.rgb = clamp((${d} + 1.0) * color.rgb - (${d} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(e.exposure!==void 0){const d=ff(i,e.exposure,cu);r.push(`color.rgb = clamp((${d} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(e.saturation!==void 0){const d=ff(i,e.saturation,cu);r.push(`
      float saturation = ${d} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(e.gamma!==void 0){const d=ff(i,e.gamma,cu);r.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${d}));`)}if(e.brightness!==void 0){const d=ff(i,e.brightness,cu);r.push(`color.rgb = clamp(color.rgb + ${d}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const s={},o=Object.keys(i.variables).length;if(o>1&&!e.variables)throw new Error(`Missing variables in style (expected ${i.variables})`);for(let d=0;d<o;++d){const p=i.variables[Object.keys(i.variables)[d]];if(!(p.name in e.variables))throw new Error(`Missing '${p.name}' in style variables`);const g=t3(p.name);s[g]=function(){let _=e.variables[p.name];return typeof _=="string"&&(_=e3(_)),_!==void 0?_:-9999999}}const a=Object.keys(s).map(function(d){return`uniform float ${d};`}),c=Math.ceil(t/4);a.push(`uniform sampler2D ${pt.TILE_TEXTURE_ARRAY}[${c}];`),i.paletteTextures&&a.push(`uniform sampler2D ${n3}[${i.paletteTextures.length}];`);const u=Object.keys(i.functions).map(function(d){return i.functions[d]}),h=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${pt.RENDER_EXTENT};
    uniform float ${pt.TRANSITION_ALPHA};
    uniform float ${pt.TEXTURE_PIXEL_WIDTH};
    uniform float ${pt.TEXTURE_PIXEL_HEIGHT};
    uniform float ${pt.RESOLUTION};
    uniform float ${pt.ZOOM};

    ${a.join(`
`)}

    ${u.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${pt.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${pt.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${pt.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${pt.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${pt.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${r.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${pt.TRANSITION_ALPHA};
    }`;return{vertexShader:n,fragmentShader:h,uniforms:s,paletteTextures:i.paletteTextures}}class AE extends sU{constructor(t){t=t?Object.assign({},t):{};const n=t.style||{};delete t.style,super(t),this.sources_=t.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=n,this.styleVariables_=this.style_.variables||{},this.addChangeListener(hx.SOURCE,this.handleSourceUpdate_)}getSources(t,n){const i=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(t,n):this.sources_:i?[i]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const t=this.getRenderSource();return t?t.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache();const t=this.getSource();if(t)if(t.getState()==="loading"){const n=()=>{t.getState()==="ready"&&(t.removeEventListener("change",n),this.setStyle(this.style_))};t.addEventListener("change",n)}else this.setStyle(this.style_)}getSourceBandCount_(){const t=Number.MAX_SAFE_INTEGER,n=this.getSources([-t,-t,t,t],t);return n&&n.length&&"bandCount"in n[0]?n[0].bandCount:4}createRenderer(){const t=YO(this.style_,this.getSourceBandCount_());return new _Te(this,{vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,cacheSize:this.getCacheSize(),paletteTextures:t.paletteTextures})}renderSources(t,n){const i=this.getRenderer();let r;for(let s=0,o=n.length;s<o;++s)this.renderedSource_=n[s],i.prepareFrame(t)&&(r=i.renderFrame(t));return r}render(t,n){this.rendered=!0;const i=t.viewState,r=this.getSources(t.extent,i.resolution);let s=!0;for(let a=0,c=r.length;a<c;++a){const u=r[a],h=u.getState();if(h=="loading"){const d=()=>{u.getState()=="ready"&&(u.removeEventListener("change",d),this.changed())};u.addEventListener("change",d)}s=s&&h=="ready"}const o=this.renderSources(t,r);if(this.getRenderer().renderComplete&&s)return this.renderedResolution_=i.resolution,o;if(this.renderedResolution_>.5*i.resolution){const a=this.getSources(t.extent,this.renderedResolution_).filter(c=>!r.includes(c));if(a.length>0)return this.renderSources(t,a)}return o}setStyle(t){if(this.styleVariables_=t.variables||{},this.style_=t,this.hasRenderer()){const n=YO(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,uniforms:n.uniforms,paletteTextures:n.paletteTextures}),this.changed()}}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}}AE.prototype.dispose;function STe(e){if(e.length===0)return[!0,!0];const t=e[0].ogcServer.url,n=e[0].ogcServer.imageType;let i=!0,r=!0;for(const s of e)i=i&&s.ogcServer.url===t,r=r&&s.ogcServer.imageType===n;if(!i)throw new Error("Not all layers of this list have the same server URL.");if(!r)throw new Error("Not all layers of this list have the same image type.");return[i,r]}class gh{constructor(t,n,i,r,s){z(this,"_ogcServer");z(this,"_layers");z(this,"_oLayer");z(this,"selectionBox");z(this,"srid");this._ogcServer=t,this._layers=n,this.selectionBox=i,this.srid=r,this._oLayer=s,STe(this._layers)}clone(t=()=>!0){return new gh(this._ogcServer,this._layers.filter(t),this.selectionBox,this.srid,this._oLayer)}}var hu,kd;class i3{constructor(t,n){fo(this,hu);z(this,"map");z(this,"ogcServer");z(this,"layerManager");z(this,"configManager");z(this,"resolutionTolerance",5);z(this,"layers",[]);z(this,"olayer");z(this,"independentLayers",{});z(this,"basemapLayers",[]);this.ogcServer=t,this.map=n,this.layerManager=Eh.getInstance(),this.configManager=fn.getInstance()}get state(){return An.getInstance().state}get audienceExcludedPaths(){var t,n;return((t=this.configManager.Config.oauth)==null?void 0:t.issuer.audienceExcludedPaths)??((n=this.configManager.Config.gmfauth)==null?void 0:n.audienceExcludedPaths)??[]}get uniqueQueryId(){return this.ogcServer.uniqueWmsQueryId}removeAllBasemapLayers(){this.basemapLayers.forEach(t=>{this.map.removeLayer(t)}),this.basemapLayers=[]}addLayer(t){this.layers.push(t),this.olayer||(this.olayer=new Hg,this.olayer.setZIndex(-t.order),this.map.addLayer(this.olayer));const n=this.createImageWMSSource();this.olayer.setSource(n),ki(this,hu,kd).call(this,t)}createImageWMSSource(t=this.layers){var h;const n=this.ogcServer.url,i=this.ogcServer.imageType,r=t.slice().sort((d,p)=>p.order-d.order),s=this.getOpenLayerLayerNames(r),o=new URL(n),a=this.audienceExcludedPaths.some(d=>new RegExp(d).test(o.pathname)),c=(h=this.state.oauth.audience)!=null&&h.includes(o.hostname)&&!a?"use-credentials":"anonymous",u=new zR({url:n,params:{LAYERS:s,FORMAT:i},crossOrigin:c});return u.on("imageloaderror",()=>{for(const d of t)this.layerManager.setError(d,"Image cannot be loaded from WMS Server")}),u.on("imageloadend",()=>{for(const d of t)this.layerManager.unsetError(d)}),u}addBasemapLayer(t){const n=this.createImageWMSSource([t]),i=new Hg({source:n,opacity:t.opacity});i.setZIndex(-5e3-t.order),this.basemapLayers.push(i),this.map.addLayer(i)}removeLayer(t){if(this.layerExists(t))if(t.treeItemId in this.independentLayers){const n=this.independentLayers[t.treeItemId].olayer;delete this.independentLayers[t.treeItemId],this.map.removeLayer(n)}else if(this.layerInStandardLayers(t))if(this.layers=this.layers.filter(n=>n.treeItemId!==t.treeItemId),this.layers.length>0){const n=this.createImageWMSSource();this.olayer.setSource(n)}else this.olayer&&(this.map.removeLayer(this.olayer),delete this.olayer);else console.warn("Nothing to remove !");else console.error(`Cannot remove WMS-Layer ${t.name} from the map: it does not exist!`)}layerExists(t){return this.layerInStandardLayers(t)||this.layerIsIndependantLayer(t)}layerInStandardLayers(t){return this.layers.some(n=>n.treeItemId===t.treeItemId)}layerIsIndependantLayer(t){return t.treeItemId in this.independentLayers}getOLayer(t){return t.treeItemId in this.independentLayers?this.independentLayers[t.treeItemId].olayer:this.layerInStandardLayers(t)?this.olayer:null}changeOpacity(t){ki(this,hu,kd).call(this,t)}changeFilter(t){ki(this,hu,kd).call(this,t)}changeTimeRestriction(t){ki(this,hu,kd).call(this,t)}makeLayerIndependent(t){if(!(t.treeItemId in this.independentLayers))if(this.layerInStandardLayers(t)){this.removeLayer(t);const n=this.createImageWMSSource([t]),i=new Hg({source:n,opacity:t.opacity});this.independentLayers[t.treeItemId]={layerWms:t,olayer:i},this.updateLayerFilter(t),this.updateTimeRestriction(t),this.map.addLayer(i)}else throw new Error("A layer can be made independent only if it has already been added to the map.")}updateLayerFilter(t){if(t.treeItemId in this.independentLayers){const i=this.independentLayers[t.treeItemId].olayer.getSource();if(t.hasFilter){const r=this.buildFilterQuery(t);i.updateParams({FILTER:r})}else{const r=i.getParams();r.FILTER&&(delete r.FILTER,i.updateParams(r))}}}updateTimeRestriction(t){const n=this.independentLayers[t.treeItemId].olayer,i=n.getSource();if(t.hasTimeRestriction)n.getSource().updateParams({TIME:t.timeRestriction});else{const r=i.getParams();r.TIME&&(delete r.TIME,i.updateParams(r))}}selectFeatures(t){const n=[];n.push(new gh(this.ogcServer,this.layers,t,this.state.projection,this.olayer));for(const i in this.independentLayers){const r=this.independentLayers[i];n.push(new gh(this.ogcServer,[r.layerWms],t,this.state.projection,r.olayer))}this.state.selection.selectionParameters.push(...n)}async getFeatureInfo(t){const n=this.getFeatureInfoUrl(t),i=Object.keys(n).map(r=>fetch(r).then(s=>s.text()).then(s=>this.handleGetFeatureInfoResponse(s,r,n)));return(await Promise.all(i)).flat()}getFeatureInfoUrl(t){const n={};return t._layers.forEach(i=>{var o,a;const r=t._oLayer??this.getOLayer(i);if(!i.queryable||!r||!i.isVisibleAtResolution(this.state.position.resolution))return;const s=(a=r.getSource())==null?void 0:a.getFeatureInfoUrl([(t.selectionBox[0]+t.selectionBox[2])/2,(t.selectionBox[1]+t.selectionBox[3])/2],(((o=r.getMapInternal())==null?void 0:o.getView().getResolution())??this.state.position.resolution)+this.resolutionTolerance,this.state.projection,{INFO_FORMAT:"application/vnd.ogc.gml",FEATURE_COUNT:300});if(s!==void 0)n[s]=i.name;else throw new Error(`Unable to construct GetFeatureInfo URL for layer ${i.name}`)}),n}handleGetFeatureInfoResponse(t,n,i){const r=new oU().readFeatures(t,{dataProjection:this.state.projection,featureProjection:this.state.projection});return r.forEach(s=>{s.getId()||s.setId(i[n])}),r}refreshZIndexes(){if(this.layers.length>0){for(const n of this.layers){const i=-n.order;this.olayer.setZIndex(i)}const t=this.createImageWMSSource(this.layers);this.olayer.setSource(t)}for(const t of Object.values(this.independentLayers)){const n=-t.layerWms.order;t.olayer.setZIndex(n)}}}hu=new WeakSet,kd=function(t){if(!this.layerExists(t))throw new Error("Cannot change filter for this layer: it does not exist");if(!t.hasFilter&&!t.hasTimeRestriction&&!t.isTransparent&&t.swiped==="no"){if(t.treeItemId in this.independentLayers){const n=this.independentLayers[t.treeItemId].olayer;delete this.independentLayers[t.treeItemId],this.map.removeLayer(n),this.addLayer(t)}}else if(t.treeItemId in this.independentLayers){const n=this.independentLayers[t.treeItemId].olayer;t.isTransparent&&n.setOpacity(t.opacity),this.updateLayerFilter(t),this.updateTimeRestriction(t)}else this.layerInStandardLayers(t)&&this.makeLayerIndependent(t)};class r3 extends i3{getOpenLayerLayerNames(t){return t.some(i=>i.hasFilter)?t.map(r=>{var s;return(s=r.queryLayers)==null?void 0:s.split(",")}).flat():t.map(r=>r.layers??r.name)}buildFilterQuery(t){let n="";if(t.hasFilter){const i=t.filter,r=t.queryLayers.split(",").length;n=("("+i.toWmsGetMapFilter()+")").repeat(r)}return n}}class s3 extends i3{getOpenLayerLayerNames(t){return t.map(n=>n.layers)}buildFilterQuery(t){let n="";if(t.hasFilter){const i=t.filter,r=t.queryLayers.split(",").length;n="("+i.toWmsGetMapFilter().repeat(r)+")"}return n}}const vTe=r3,ITe=s3;class o3 extends ei{constructor(){super(...arguments);z(this,"_clientClasses",new Map);z(this,"_clients",new Map)}createClient(n,i){return new n(i,{})}registerClientClass(n,i){this._clientClasses.set(n,i)}getClient(n){const i=n instanceof ji?n.ogcServer:n,r=i.type,s=this.getClientId(i);let o=this._clients.get(s);if(!o){let a=this._clientClasses.get(r);a||(console.info(`Client not found for ogcServer with type: ${r}. Using default client. ogcServer: ${i}. `),a=this._clientClasses.get("default")),o=this.createClient(a,i),this._clients.set(s,o)}return o}}class OTe extends o3{constructor(n){super(n);z(this,"map");this.registerClientClass("default",vTe),this.registerClientClass("geoserver",ITe),this.registerClientClass("mapserver",s3),this.registerClientClass("qgisserver",r3)}getClientId(n){return n.uniqueWmsQueryId}createClient(n,i){return new n(i,this.map)}selectFeatures(n){for(const i of this._clients.values())i.selectFeatures(n)}refreshZIndexes(){for(const n of this._clients.values())n.refreshZIndexes()}removeAllBasemapLayers(){for(const n of this._clients.values())n.removeAllBasemapLayers()}}var jp,SE;class RTe{constructor(t){fo(this,jp);z(this,"layerManager");z(this,"map3d");z(this,"baseLayers",[]);z(this,"layersRecord",{});z(this,"configManager");this.map3d=t,this.layerManager=Eh.getInstance(),this.configManager=fn.getInstance()}removeAllBasemapLayers(){this.baseLayers.forEach(t=>this.map3d.imageryLayers.remove(t)),this.baseLayers=[]}addLayer(t){t.serverUniqueQueryId in this.layersRecord||(this.layersRecord[t.serverUniqueQueryId]=[]);const n=this.newImagery(t.ogcServer.url,t.layers);this.layersRecord[t.serverUniqueQueryId].push({layers:t,imagery:n}),this.map3d.imageryLayers.add(n)}addBasemapLayer(t){this.baseLayers.push(this.newImagery(t.ogcServer.url,t.layers))}newImagery(t,n,i="image/png"){return new vt(new eo({url:t,layers:n,parameters:{transparent:!0,format:i},tileWidth:4096,tileHeight:4096}))}removeLayer(t){const n=this.layersRecord[t.serverUniqueQueryId];n!=null&&(this.map3d.imageryLayers.remove(n.filter(i=>i.layers===t)[0].imagery),this.layersRecord[t.serverUniqueQueryId]=n.filter(i=>i.layers!==t))}layerExists(t){return t.serverUniqueQueryId in this.layersRecord?this.layersRecord[t.serverUniqueQueryId].find(r=>r.layers.treeItemId===t.treeItemId)!==void 0:!1}changeOpacity(t){ki(this,jp,SE).call(this,t)}changeFilter(t){ki(this,jp,SE).call(this,t)}selectFeatures(t){const n=An.getInstance().state,i=[];for(const r in this.layersRecord){const s=this.layersRecord[r];i.push(new gh(s[0].layers.ogcServer,s.map(o=>o.layers),t,n.projection))}n.selection.selectionParameters.push(...i)}}jp=new WeakSet,SE=function(t){if(!this.layerExists(t))throw new Error("Cannot change filter for this layer: it does not exist");const i=this.layersRecord[t.serverUniqueQueryId].filter(r=>r.layers===t)[0].imagery;i.alpha=t.opacity};class DTe{constructor(t){z(this,"map");z(this,"basemapLayers",[]);this.map=t}removeAllBasemapLayers(){this.basemapLayers.forEach(t=>{this.map.removeLayer(t)}),this.basemapLayers=[]}addBasemapLayer(t){const n=new E_({source:new aU});this.basemapLayers.push(n),n.setZIndex(-5e3-t.order),this.map.addLayer(n)}}function MTe(e,t,n,i){const r=document.createElement("script"),s="olc_"+is(t);function o(){delete window[s],r.parentNode.removeChild(r)}r.async=!0,r.src=e+(e.includes("?")?"&":"?")+"callback="+s;const a=setTimeout(function(){o(),n&&n()},1e4);window[s]=function(c){clearTimeout(a),o(),t(c)},document.head.appendChild(r)}class LTe extends cU{constructor(t){if(super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:Er("EPSG:3857"),reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:"loading",tileLoadFunction:t.tileLoadFunction,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.tileJSON_=null,this.tileSize_=t.tileSize,t.url)if(t.jsonp)MTe(t.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const n=new XMLHttpRequest;n.addEventListener("load",this.onXHRLoad_.bind(this)),n.addEventListener("error",this.onXHRError_.bind(this)),n.open("GET",t.url),n.send()}else if(t.tileJSON)this.handleTileJSONResponse(t.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(t){const n=t.target;if(!n.status||n.status>=200&&n.status<300){let i;try{i=JSON.parse(n.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(i)}else this.handleTileJSONError()}onXHRError_(t){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(t){const n=Er("EPSG:4326"),i=this.getProjection();let r;if(t.bounds!==void 0){const u=lU(n,i);r=uU(t.bounds,u)}const s=HE(i),o=t.minzoom||0,a=t.maxzoom||22,c=Oy({extent:s,maxZoom:a,minZoom:o,tileSize:this.tileSize_});if(this.tileGrid=c,this.tileUrlFunction=fU(t.tiles,c),t.attribution&&!this.getAttributions()){const u=r!==void 0?r:s;this.setAttributions(function(h){return qE(u,h.extent)?[t.attribution]:null})}this.tileJSON_=t,this.setState("ready")}handleTileJSONError(){this.setState("error")}}class PTe extends hU{constructor(t){const n=t.projection||"EPSG:3857",i=t.extent||HE(n),r=t.tileGrid||Oy({extent:i,maxResolution:t.maxResolution,maxZoom:t.maxZoom!==void 0?t.maxZoom:22,minZoom:t.minZoom,tileSize:t.tileSize||512});super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,interpolate:!0,projection:n,state:t.state,tileGrid:r,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:a3,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX===void 0?!0:t.wrapX,transition:t.transition,zDirection:t.zDirection===void 0?1:t.zDirection}),this.format_=t.format?t.format:null,this.tileKeysBySourceTileUrl_={},this.sourceTiles_={},this.overlaps_=t.overlaps==null?!0:t.overlaps,this.tileClass=t.tileClass?t.tileClass:UR,this.tileGrids_={}}getOverlaps(){return this.overlaps_}getSourceTiles(t,n,i){if(i.getState()===gn.IDLE){i.setState(gn.LOADING);const r=i.wrappedTileCoord,s=this.getTileGridForProjection(n),o=s.getTileCoordExtent(r),a=r[0],c=s.getResolution(a);Ib(o,-c,o);const u=this.tileGrid,h=u.getExtent();h&&hp(o,h,o);const d=u.getZForResolution(c,this.zDirection);u.forEachTileCoord(o,d,p=>{const g=this.tileUrlFunction(p,t,n);this.sourceTiles_[g]||(this.sourceTiles_[g]=new this.tileClass(p,g?gn.IDLE:gn.EMPTY,g,this.format_,this.tileLoadFunction));const _=this.sourceTiles_[g];i.sourceTiles.push(_),this.tileKeysBySourceTileUrl_[g]||(this.tileKeysBySourceTileUrl_[g]=[]),this.tileKeysBySourceTileUrl_[g].push(i.getKey());const b=_.getState();if(b<gn.LOADED){const x=E=>{this.handleTileChange(E);const C=_.getState();if(C===gn.LOADED||C===gn.ERROR){const w=_.getKey();w in i.errorTileKeys?_.getState()===gn.LOADED&&delete i.errorTileKeys[w]:i.loadingSourceTiles--,C===gn.ERROR?i.errorTileKeys[w]=!0:_.removeEventListener($s.CHANGE,x),i.loadingSourceTiles===0&&i.setState(mU(i.errorTileKeys)?gn.LOADED:gn.ERROR)}};_.addEventListener($s.CHANGE,x),i.loadingSourceTiles++}b===gn.IDLE&&(_.extent=u.getTileCoordExtent(p),_.projection=n,_.resolution=u.getResolution(p[0]),_.load())}),i.loadingSourceTiles||i.setState(i.sourceTiles.some(p=>p.getState()===gn.ERROR)?gn.ERROR:gn.LOADED)}return i.sourceTiles}removeSourceTiles(t){const n=t.sourceTiles;for(let i=0,r=n.length;i<r;++i){const s=n[i].getTileUrl(),o=this.getKey();if(!this.tileKeysBySourceTileUrl_[s])return;const a=this.tileKeysBySourceTileUrl_[s][o];a!==-1&&(this.tileKeysBySourceTileUrl_[s].splice(a,1),this.tileKeysBySourceTileUrl_[s].length===0&&(delete this.tileKeysBySourceTileUrl_[s],delete this.sourceTiles_[s]))}}getTile(t,n,i,r,s){const o=[t,n,i];let a=this.getTileCoordForTileUrlFunction(o,s);const c=this.getTileGrid().getExtent(),u=this.getTileGridForProjection(s);if(a&&c){const p=u.getTileCoordExtent(a);Ib(p,-u.getResolution(t),p),qE(c,p)||(a=null)}let h=!0;if(a!==null){const p=this.tileGrid,g=u.getResolution(t),_=p.getZForResolution(g,1),b=u.getTileCoordExtent(a);Ib(b,-g,b),p.forEachTileCoord(b,_,x=>{h=h&&!this.tileUrlFunction(x,r,s)})}const d=new dU(o,h?gn.EMPTY:gn.IDLE,a,this.getSourceTiles.bind(this,r,s),this.removeSourceTiles.bind(this));return d.key=this.getKey(),d}getTileGridForProjection(t){const n=t.getCode();let i=this.tileGrids_[n];if(!i){const r=this.tileGrid,s=r.getResolutions().slice(),o=s.map(function(u,h){return r.getOrigin(h)}),a=s.map(function(u,h){return r.getTileSize(h)}),c=gU+1;for(let u=s.length;u<c;++u)s.push(s[u-1]/2),o.push(o[u-1]),a.push(a[u-1]);i=new WE({extent:r.getExtent(),origins:o,resolutions:s,tileSizes:a}),this.tileGrids_[n]=i}return i}getTilePixelRatio(t){return t}getTilePixelSize(t,n,i){const r=this.getTileGridForProjection(i),s=nl(r.getTileSize(t),this.tmpSize);return[Math.round(s[0]*n),Math.round(s[1]*n)]}}function a3(e,t){e.setLoader(function(n,i,r){pU(t,e.getFormat(),n,i,r,e.onLoad.bind(e),e.onError.bind(e))})}function c3(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var NTe={},l3,KO={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function lp(e){return e=Math.round(e),e<0?0:e>255?255:e}function ZO(e){return e<0?0:e>1?1:e}function YT(e){return e[e.length-1]==="%"?lp(parseFloat(e)/100*255):lp(parseInt(e))}function Fg(e){return e[e.length-1]==="%"?ZO(parseFloat(e)/100):ZO(parseFloat(e))}function KT(e,t,n){return n<0?n+=1:n>1&&(n-=1),n*6<1?e+(t-e)*n*6:n*2<1?t:n*3<2?e+(t-e)*(2/3-n)*6:e}function FTe(e){var t=e.replace(/ /g,"").toLowerCase();if(t in KO)return KO[t].slice();if(t[0]==="#"){if(t.length===4){var n=parseInt(t.substr(1),16);return n>=0&&n<=4095?[(n&3840)>>4|(n&3840)>>8,n&240|(n&240)>>4,n&15|(n&15)<<4,1]:null}else if(t.length===7){var n=parseInt(t.substr(1),16);return n>=0&&n<=16777215?[(n&16711680)>>16,(n&65280)>>8,n&255,1]:null}return null}var i=t.indexOf("("),r=t.indexOf(")");if(i!==-1&&r+1===t.length){var s=t.substr(0,i),o=t.substr(i+1,r-(i+1)).split(","),a=1;switch(s){case"rgba":if(o.length!==4)return null;a=Fg(o.pop());case"rgb":return o.length!==3?null:[YT(o[0]),YT(o[1]),YT(o[2]),a];case"hsla":if(o.length!==4)return null;a=Fg(o.pop());case"hsl":if(o.length!==3)return null;var c=(parseFloat(o[0])%360+360)%360/360,u=Fg(o[1]),h=Fg(o[2]),d=h<=.5?h*(u+1):h+u-h*u,p=h*2-d;return[lp(KT(p,d,c+1/3)*255),lp(KT(p,d,c)*255),lp(KT(p,d,c-1/3)*255),a];default:return null}}return null}try{l3=NTe.parseCSSColor=FTe}catch{}class ls{constructor(t,n,i,r=1){this.r=t,this.g=n,this.b=i,this.a=r}static parse(t){if(!t)return;if(t instanceof ls)return t;if(typeof t!="string")return;const n=l3(t);if(n)return new ls(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3])}toString(){const[t,n,i,r]=this.toArray();return`rgba(${Math.round(t)},${Math.round(n)},${Math.round(i)},${r})`}toArray(){const{r:t,g:n,b:i,a:r}=this;return r===0?[0,0,0,0]:[t*255/r,n*255/r,i*255/r,r]}toArray01(){const{r:t,g:n,b:i,a:r}=this;return r===0?[0,0,0,0]:[t/r,n/r,i/r,r]}toArray01PremultipliedAlpha(){const{r:t,g:n,b:i,a:r}=this;return[t,n,i,r]}}ls.black=new ls(0,0,0,1);ls.white=new ls(1,1,1,1);ls.transparent=new ls(0,0,0,0);ls.red=new ls(1,0,0,1);ls.blue=new ls(0,0,1,1);var Ss=ls;function Pp(e){return typeof e=="object"?["literal",e]:e}function BTe(e,t){let n=e.stops;if(!n)return zTe(e,t);const i=n&&typeof n[0][0]=="object",r=i||e.property!==void 0,s=i||!r;return n=n.map(o=>!r&&t.tokens&&typeof o[1]=="string"?[o[0],VTe(o[1])]:[o[0],Pp(o[1])]),i?UTe(e,t,n):s?jTe(e,t,n):vE(e,t,n)}function zTe(e,t){const n=["get",e.property];if(e.default===void 0)return t.type==="string"?["string",n]:n;if(t.type==="enum")return["match",n,Object.keys(t.values),n,e.default];{const i=[t.type==="color"?"to-color":t.type,n,Pp(e.default)];return t.type==="array"&&i.splice(1,0,t.value,t.length||null),i}}function sA(e){switch(e.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function UTe(e,t,n){const i={},r={},s=[];for(let a=0;a<n.length;a++){const c=n[a],u=c[0].zoom;i[u]===void 0&&(i[u]={zoom:u,type:e.type,property:e.property,default:e.default},r[u]=[],s.push(u)),r[u].push([c[0].value,c[1]])}if(aA({},t)==="exponential"){const a=[sA(e),["linear"],["zoom"]];for(const c of s){const u=vE(i[c],t,r[c]);Wf(a,c,u,!1)}return a}else{const a=["step",["zoom"]];for(const c of s){const u=vE(i[c],t,r[c]);Wf(a,c,u,!0)}return oA(a),a}}function kTe(e,t){if(e!==void 0)return e;if(t!==void 0)return t}function JO(e,t){const n=Pp(kTe(e.default,t.default));return n===void 0&&t.type==="resolvedImage"?"":n}function vE(e,t,n){const i=aA(e,t),r=["get",e.property];if(i==="categorical"&&typeof n[0][0]=="boolean"){const s=["case"];for(const o of n)s.push(["==",r,o[0]],o[1]);return s.push(JO(e,t)),s}else if(i==="categorical"){const s=["match",r];for(const o of n)Wf(s,o[0],o[1],!1);return s.push(JO(e,t)),s}else if(i==="interval"){const s=["step",["number",r]];for(const o of n)Wf(s,o[0],o[1],!0);return oA(s),e.default===void 0?s:["case",["==",["typeof",r],"number"],s,Pp(e.default)]}else if(i==="exponential"){const s=e.base!==void 0?e.base:1,o=[sA(e),s===1?["linear"]:["exponential",s],["number",r]];for(const a of n)Wf(o,a[0],a[1],!1);return e.default===void 0?o:["case",["==",["typeof",r],"number"],o,Pp(e.default)]}else throw new Error(`Unknown property function type ${i}`)}function jTe(e,t,n,i=["zoom"]){const r=aA(e,t);let s,o=!1;if(r==="interval")s=["step",i],o=!0;else if(r==="exponential"){const a=e.base!==void 0?e.base:1;s=[sA(e),a===1?["linear"]:["exponential",a],i]}else throw new Error(`Unknown zoom function type "${r}"`);for(const a of n)Wf(s,a[0],a[1],o);return oA(s),s}function oA(e){e[0]==="step"&&e.length===3&&(e.push(0),e.push(e[3]))}function Wf(e,t,n,i){e.length>3&&t===e[e.length-2]||(i&&e.length===2||e.push(t),e.push(n))}function aA(e,t){return e.type?e.type:t.expression.interpolated?"exponential":"interval"}function VTe(e){const t=["concat"],n=/{([^{}]+)}/g;let i=0;for(let r=n.exec(e);r!==null;r=n.exec(e)){const s=e.slice(i,n.lastIndex-r[0].length);i=n.lastIndex,s.length>0&&t.push(s),t.push(["get",r[1]])}if(t.length===1)return e;if(i<e.length)t.push(e.slice(i));else if(t.length===2)return["to-string",t[1]];return t}class GTe extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}var ia=GTe;class cA{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[i,r]of n)this.bindings[i]=r}concat(t){return new cA(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return this.bindings[t]?!0:this.parent?this.parent.has(t):!1}}var HTe=cA;const db={kind:"null"},Ce={kind:"number"},Et={kind:"string"},mt={kind:"boolean"},nc={kind:"color"},$f={kind:"object"},gt={kind:"value"},qTe={kind:"error"},pb={kind:"collator"},mb={kind:"formatted"},_m={kind:"resolvedImage"};function Ys(e,t){return{kind:"array",itemType:e,N:t}}function Wn(e){if(e.kind==="array"){const t=Wn(e.itemType);return typeof e.N=="number"?`array<${t}, ${e.N}>`:e.itemType.kind==="value"?"array":`array<${t}>`}else return e.kind}const WTe=[db,Ce,Et,mt,nc,mb,$f,Ys(gt),_m];function Np(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Np(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(const n of WTe)if(!Np(n,t))return null}}return`Expected ${Wn(e)} but found ${Wn(t)} instead.`}function lA(e,t){return t.some(n=>n.kind===e.kind)}function Fp(e,t){return t.some(n=>n==="null"?e===null:n==="array"?Array.isArray(e):n==="object"?e&&!Array.isArray(e)&&typeof e=="object":n===typeof e)}class uA{constructor(t,n,i){t?this.sensitivity=n?"variant":"case":this.sensitivity=n?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class IE{constructor(t,n,i,r,s){this.text=t.normalize?t.normalize():t,this.image=n,this.scale=i,this.fontStack=r,this.textColor=s}}class ma{constructor(t){this.sections=t}static fromString(t){return new ma([new IE(t,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof ma?t:ma.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const n of this.sections){if(n.image){t.push(["image",n.image.name]);continue}t.push(n.text);const i={};n.fontStack&&(i["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(i["font-scale"]=n.scale),n.textColor&&(i["text-color"]=["rgba"].concat(n.textColor.toArray())),t.push(i)}return t}}class Fl{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Fl({name:t,available:!1}):null}serialize(){return["image",this.name]}}function u3(e,t,n,i){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?typeof i>"u"||typeof i=="number"&&i>=0&&i<=1?null:`Invalid rgba value [${[e,t,n,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof i=="number"?[e,t,n,i]:[e,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function py(e){if(e===null)return!0;if(typeof e=="string")return!0;if(typeof e=="boolean")return!0;if(typeof e=="number")return!0;if(e instanceof Ss)return!0;if(e instanceof uA)return!0;if(e instanceof ma)return!0;if(e instanceof Fl)return!0;if(Array.isArray(e)){for(const t of e)if(!py(t))return!1;return!0}else if(typeof e=="object"){for(const t in e)if(!py(e[t]))return!1;return!0}else return!1}function Ri(e){if(e===null)return db;if(typeof e=="string")return Et;if(typeof e=="boolean")return mt;if(typeof e=="number")return Ce;if(e instanceof Ss)return nc;if(e instanceof uA)return pb;if(e instanceof ma)return mb;if(e instanceof Fl)return _m;if(Array.isArray(e)){const t=e.length;let n;for(const i of e){const r=Ri(i);if(!n)n=r;else{if(n===r)continue;n=gt;break}}return Ys(n||gt,t)}else return $f}function up(e){const t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof Ss||e instanceof ma||e instanceof Fl?e.toString():JSON.stringify(e)}class fA{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!py(t[1]))return n.error("invalid value");const i=t[1];let r=Ri(i);const s=n.expectedType;return r.kind==="array"&&r.N===0&&s&&s.kind==="array"&&(typeof s.N!="number"||s.N===0)&&(r=s),new fA(r,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ss?["rgba"].concat(this.value.toArray()):this.value instanceof ma?this.value.serialize():this.value}}var my=fA;class $Te{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}var or=$Te;const ZT={string:Et,number:Ce,boolean:mt,object:$f};class hA{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let i=1,r;const s=t[0];if(s==="array"){let a;if(t.length>2){const u=t[1];if(typeof u!="string"||!(u in ZT)||u==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);a=ZT[u],i++}else a=gt;let c;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);c=t[2],i++}r=Ys(a,c)}else r=ZT[s];const o=[];for(;i<t.length;i++){const a=n.parse(t[i],i,gt);if(!a)return null;o.push(a)}return new hA(r,o)}evaluate(t){for(let n=0;n<this.args.length;n++){const i=this.args[n].evaluate(t);if(Np(this.type,Ri(i))){if(n===this.args.length-1)throw new or(`Expected value to be of type ${Wn(this.type)}, but found ${Wn(Ri(i))} instead.`)}else return i}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,n=[t.kind];if(t.kind==="array"){const i=t.itemType;if(i.kind==="string"||i.kind==="number"||i.kind==="boolean"){n.push(i.kind);const r=t.N;(typeof r=="number"||this.args.length>1)&&n.push(r)}}return n.concat(this.args.map(i=>i.serialize()))}}var qa=hA;class gb{constructor(t){this.type=mb,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const i=t[1];if(!Array.isArray(i)&&typeof i=="object")return n.error("First argument must be an image or text section.");const r=[];let s=!1;for(let o=1;o<=t.length-1;++o){const a=t[o];if(s&&typeof a=="object"&&!Array.isArray(a)){s=!1;let c=null;if(a["font-scale"]&&(c=n.parse(a["font-scale"],1,Ce),!c))return null;let u=null;if(a["text-font"]&&(u=n.parse(a["text-font"],1,Ys(Et)),!u))return null;let h=null;if(a["text-color"]&&(h=n.parse(a["text-color"],1,nc),!h))return null;const d=r[r.length-1];d.scale=c,d.font=u,d.textColor=h}else{const c=n.parse(t[o],1,gt);if(!c)return null;const u=c.type.kind;if(u!=="string"&&u!=="value"&&u!=="null"&&u!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");s=!0,r.push({content:c,scale:null,font:null,textColor:null})}}return new gb(r)}evaluate(t){const n=i=>{const r=i.content.evaluate(t);return Ri(r)===_m?new IE("",r,null,null,null):new IE(up(r),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null)};return new ma(this.sections.map(n))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const n of this.sections){t.push(n.content.serialize());const i={};n.scale&&(i["font-scale"]=n.scale.serialize()),n.font&&(i["text-font"]=n.font.serialize()),n.textColor&&(i["text-color"]=n.textColor.serialize()),t.push(i)}return t}}class _b{constructor(t){this.type=_m,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const i=n.parse(t[1],1,Et);return i?new _b(i):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),i=Fl.fromString(n);return i&&t.availableImages&&(i.available=t.availableImages.indexOf(n)>-1),i}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const XTe={"to-boolean":mt,"to-color":nc,"to-number":Ce,"to-string":Et};class dA{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const i=t[0];if((i==="to-boolean"||i==="to-string")&&t.length!==2)return n.error("Expected one argument.");const r=XTe[i],s=[];for(let o=1;o<t.length;o++){const a=n.parse(t[o],o,gt);if(!a)return null;s.push(a)}return new dA(r,s)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let n,i;for(const r of this.args){if(n=r.evaluate(t),i=null,n instanceof Ss)return n;if(typeof n=="string"){const s=t.parseColor(n);if(s)return s}else if(Array.isArray(n)&&(n.length<3||n.length>4?i=`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:i=u3(n[0],n[1],n[2],n[3]),!i))return new Ss(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new or(i||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}else if(this.type.kind==="number"){let n=null;for(const i of this.args){if(n=i.evaluate(t),n===null)return 0;const r=Number(n);if(!isNaN(r))return r}throw new or(`Could not convert ${JSON.stringify(n)} to number.`)}else return this.type.kind==="formatted"?ma.fromString(up(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Fl.fromString(up(this.args[0].evaluate(t))):up(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new gb([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new _b(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(n=>{t.push(n.serialize())}),t}}var Nf=dA;const YTe=["Unknown","Point","LineString","Polygon"];class KTe{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?YTe[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:i,y:r}=this.featureTileCoord,s=i*n-t[0],o=r*n-t[1],a=this.featureDistanceData.bearing[0],c=this.featureDistanceData.bearing[1];return a*s+c*o}return 0}parseColor(t){let n=this._parseColorCache[t];return n||(n=this._parseColorCache[t]=Ss.parse(t)),n}}var f3=KTe;class Ff{constructor(t,n,i,r){this.name=t,this.type=n,this._evaluate=i,this.args=r}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,n){const i=t[0],r=Ff.definitions[i];if(!r)return n.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const s=Array.isArray(r)?r[0]:r.type,o=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,a=o.filter(([u])=>!Array.isArray(u)||u.length===t.length-1);let c=null;for(const[u,h]of a){c=new g3(n.registry,n.path,null,n.scope);const d=[];let p=!1;for(let g=1;g<t.length;g++){const _=t[g],b=Array.isArray(u)?u[g-1]:u.type,x=c.parse(_,1+d.length,b);if(!x){p=!0;break}d.push(x)}if(!p){if(Array.isArray(u)&&u.length!==d.length){c.error(`Expected ${u.length} arguments, but found ${d.length} instead.`);continue}for(let g=0;g<d.length;g++){const _=Array.isArray(u)?u[g]:u.type,b=d[g];c.concat(g+1).checkSubtype(_,b.type)}if(c.errors.length===0)return new Ff(i,s,h,d)}}if(a.length===1)n.errors.push(...c.errors);else{const h=(a.length?a:o).map(([p])=>ZTe(p)).join(" | "),d=[];for(let p=1;p<t.length;p++){const g=n.parse(t[p],1+d.length);if(!g)return null;d.push(Wn(g.type))}n.error(`Expected arguments of type ${h}, but found (${d.join(", ")}) instead.`)}return null}static register(t,n){Ff.definitions=n;for(const i in n)t[i]=Ff}}function ZTe(e){return Array.isArray(e)?`(${e.map(Wn).join(", ")})`:`(${Wn(e.type)}...)`}var Gh=Ff;class yb{constructor(t,n,i){this.type=pb,this.locale=i,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const i=t[1];if(typeof i!="object"||Array.isArray(i))return n.error("Collator options argument must be an object.");const r=n.parse(i["case-sensitive"]===void 0?!1:i["case-sensitive"],1,mt);if(!r)return null;const s=n.parse(i["diacritic-sensitive"]===void 0?!1:i["diacritic-sensitive"],1,mt);if(!s)return null;let o=null;return i.locale&&(o=n.parse(i.locale,1,Et),!o)?null:new yb(r,s,o)}evaluate(t){return new uA(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const dl=8192;function pA(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function JTe(e){return(180+e)/360}function QTe(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function gy(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function exe(e,t){const n=JTe(e[0]),i=QTe(e[1]),r=Math.pow(2,t.z);return[Math.round(n*r*dl),Math.round(i*r*dl)]}function txe(e,t,n){const i=e[0]-t[0],r=e[1]-t[1],s=e[0]-n[0],o=e[1]-n[1];return i*o-s*r===0&&i*s<=0&&r*o<=0}function nxe(e,t,n){return t[1]>e[1]!=n[1]>e[1]&&e[0]<(n[0]-t[0])*(e[1]-t[1])/(n[1]-t[1])+t[0]}function mA(e,t){let n=!1;for(let i=0,r=t.length;i<r;i++){const s=t[i];for(let o=0,a=s.length;o<a-1;o++){if(txe(e,s[o],s[o+1]))return!1;nxe(e,s[o],s[o+1])&&(n=!n)}}return n}function ixe(e,t){for(let n=0;n<t.length;n++)if(mA(e,t[n]))return!0;return!1}function rxe(e,t){return e[0]*t[1]-e[1]*t[0]}function QO(e,t,n,i){const r=e[0]-n[0],s=e[1]-n[1],o=t[0]-n[0],a=t[1]-n[1],c=i[0]-n[0],u=i[1]-n[1],h=r*u-c*s,d=o*u-c*a;return h>0&&d<0||h<0&&d>0}function sxe(e,t,n,i){const r=[t[0]-e[0],t[1]-e[1]],s=[i[0]-n[0],i[1]-n[1]];return rxe(s,r)===0?!1:!!(QO(e,t,n,i)&&QO(n,i,e,t))}function oxe(e,t,n){for(const i of n)for(let r=0;r<i.length-1;++r)if(sxe(e,t,i[r],i[r+1]))return!0;return!1}function h3(e,t){for(let n=0;n<e.length;++n)if(!mA(e[n],t))return!1;for(let n=0;n<e.length-1;++n)if(oxe(e[n],e[n+1],t))return!1;return!0}function axe(e,t){for(let n=0;n<t.length;n++)if(h3(e,t[n]))return!0;return!1}function gA(e,t,n){const i=[];for(let r=0;r<e.length;r++){const s=[];for(let o=0;o<e[r].length;o++){const a=exe(e[r][o],n);pA(t,a),s.push(a)}i.push(s)}return i}function d3(e,t,n){const i=[];for(let r=0;r<e.length;r++){const s=gA(e[r],t,n);i.push(s)}return i}function p3(e,t,n,i){if(e[0]<n[0]||e[0]>n[2]){const r=i*.5;let s=e[0]-n[0]>r?-i:n[0]-e[0]>r?i:0;s===0&&(s=e[0]-n[2]>r?-i:n[2]-e[0]>r?i:0),e[0]+=s}pA(t,e)}function cxe(e){e[0]=e[1]=1/0,e[2]=e[3]=-1/0}function eR(e,t,n,i){const r=Math.pow(2,i.z)*dl,s=[i.x*dl,i.y*dl],o=[];if(!e)return o;for(const a of e)for(const c of a){const u=[c.x+s[0],c.y+s[1]];p3(u,t,n,r),o.push(u)}return o}function tR(e,t,n,i){const r=Math.pow(2,i.z)*dl,s=[i.x*dl,i.y*dl],o=[];if(!e)return o;for(const a of e){const c=[];for(const u of a){const h=[u.x+s[0],u.y+s[1]];pA(t,h),c.push(h)}o.push(c)}if(t[2]-t[0]<=r/2){cxe(t);for(const a of o)for(const c of a)p3(c,t,n,r)}return o}function lxe(e,t){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if(!r)return!1;if(t.type==="Polygon"){const s=gA(t.coordinates,i,r),o=eR(e.geometry(),n,i,r);if(!gy(n,i))return!1;for(const a of o)if(!mA(a,s))return!1}if(t.type==="MultiPolygon"){const s=d3(t.coordinates,i,r),o=eR(e.geometry(),n,i,r);if(!gy(n,i))return!1;for(const a of o)if(!ixe(a,s))return!1}return!0}function uxe(e,t){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if(!r)return!1;if(t.type==="Polygon"){const s=gA(t.coordinates,i,r),o=tR(e.geometry(),n,i,r);if(!gy(n,i))return!1;for(const a of o)if(!h3(a,s))return!1}if(t.type==="MultiPolygon"){const s=d3(t.coordinates,i,r),o=tR(e.geometry(),n,i,r);if(!gy(n,i))return!1;for(const a of o)if(!axe(a,s))return!1}return!0}class fp{constructor(t,n){this.type=mt,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(py(t[1])){const i=t[1];if(i.type==="FeatureCollection")for(let r=0;r<i.features.length;++r){const s=i.features[r].geometry.type;if(s==="Polygon"||s==="MultiPolygon")return new fp(i,i.features[r].geometry)}else if(i.type==="Feature"){const r=i.geometry.type;if(r==="Polygon"||r==="MultiPolygon")return new fp(i,i.geometry)}else if(i.type==="Polygon"||i.type==="MultiPolygon")return new fp(i,i)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return lxe(t,this.geometries);if(t.geometryType()==="LineString")return uxe(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var _A=fp;function bb(e){if(e instanceof Gh){if(e.name==="get"&&e.args.length===1)return!1;if(e.name==="feature-state")return!1;if(e.name==="has"&&e.args.length===1)return!1;if(e.name==="properties"||e.name==="geometry-type"||e.name==="id")return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof _A)return!1;let t=!0;return e.eachChild(n=>{t&&!bb(n)&&(t=!1)}),t}function yA(e){if(e instanceof Gh&&e.name==="feature-state")return!1;let t=!0;return e.eachChild(n=>{t&&!yA(n)&&(t=!1)}),t}function bA(e,t){if(e instanceof Gh&&t.indexOf(e.name)>=0)return!1;let n=!0;return e.eachChild(i=>{n&&!bA(i,t)&&(n=!1)}),n}class TA{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const i=t[1];return n.scope.has(i)?new TA(i,n.scope.get(i)):n.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var m3=TA;class xA{constructor(t,n=[],i,r=new HTe,s=[]){this.registry=t,this.path=n,this.key=n.map(o=>`[${o}]`).join(""),this.scope=r,this.errors=s,this.expectedType=i}parse(t,n,i,r,s={}){return n?this.concat(n,i,r)._parse(t,s):this._parse(t,s)}_parse(t,n){(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number")&&(t=["literal",t]);function i(r,s,o){return o==="assert"?new qa(s,[r]):o==="coerce"?new Nf(s,[r]):r}if(Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r=t[0];if(typeof r!="string")return this.error(`Expression name must be a string, but found ${typeof r} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const s=this.registry[r];if(s){let o=s.parse(t,this);if(!o)return null;if(this.expectedType){const a=this.expectedType,c=o.type;if((a.kind==="string"||a.kind==="number"||a.kind==="boolean"||a.kind==="object"||a.kind==="array")&&c.kind==="value")o=i(o,a,n.typeAnnotation||"assert");else if((a.kind==="color"||a.kind==="formatted"||a.kind==="resolvedImage")&&(c.kind==="value"||c.kind==="string"))o=i(o,a,n.typeAnnotation||"coerce");else if(this.checkSubtype(a,c))return null}if(!(o instanceof my)&&o.type.kind!=="resolvedImage"&&OE(o)){const a=new f3;try{o=new my(o.type,o.evaluate(a))}catch(c){return this.error(c.message),null}}return o}return this.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof t>"u"?this.error("'undefined' value invalid. Use null instead."):typeof t=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof t} instead.`)}concat(t,n,i){const r=typeof t=="number"?this.path.concat(t):this.path,s=i?this.scope.concat(i):this.scope;return new xA(this.registry,r,n||null,s,this.errors)}error(t,...n){const i=`${this.key}${n.map(r=>`[${r}]`).join("")}`;this.errors.push(new ia(i,t))}checkSubtype(t,n){const i=Np(t,n);return i&&this.error(i),i}}var g3=xA;function OE(e){if(e instanceof m3)return OE(e.boundExpression);if(e instanceof Gh&&e.name==="error")return!1;if(e instanceof yb)return!1;if(e instanceof _A)return!1;const t=e instanceof Nf||e instanceof qa;let n=!0;return e.eachChild(i=>{t?n=n&&OE(i):n=n&&i instanceof my}),n?bb(e)&&bA(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"]):!1}function _3(e,t){const n=e.length-1;let i=0,r=n,s=0,o,a;for(;i<=r;)if(s=Math.floor((i+r)/2),o=e[s],a=e[s+1],o<=t){if(s===n||t<a)return s;i=s+1}else if(o>t)r=s-1;else throw new or("Input is not a number.");return 0}class EA{constructor(t,n,i){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[r,s]of i)this.labels.push(r),this.outputs.push(s)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!==0)return n.error("Expected an even number of arguments.");const i=n.parse(t[1],1,Ce);if(!i)return null;const r=[];let s=null;n.expectedType&&n.expectedType.kind!=="value"&&(s=n.expectedType);for(let o=1;o<t.length;o+=2){const a=o===1?-1/0:t[o],c=t[o+1],u=o,h=o+1;if(typeof a!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(r.length&&r[r.length-1][0]>=a)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);const d=n.parse(c,h,s);if(!d)return null;s=s||d.type,r.push([a,d])}return new EA(s,i,r)}evaluate(t){const n=this.labels,i=this.outputs;if(n.length===1)return i[0].evaluate(t);const r=this.input.evaluate(t);if(r<=n[0])return i[0].evaluate(t);const s=n.length;if(r>=n[s-1])return i[s-1].evaluate(t);const o=_3(n,r);return i[o].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&t.push(this.labels[n]),t.push(this.outputs[n].serialize());return t}}var y3=EA,fxe=Hh;function Hh(e,t,n,i){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=n,this.p2y=i}Hh.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e};Hh.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e};Hh.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx};Hh.prototype.solveCurveX=function(e,t){typeof t>"u"&&(t=1e-6);var n,i,r,s,o;for(r=e,o=0;o<8;o++){if(s=this.sampleCurveX(r)-e,Math.abs(s)<t)return r;var a=this.sampleCurveDerivativeX(r);if(Math.abs(a)<1e-6)break;r=r-s/a}if(n=0,i=1,r=e,r<n)return n;if(r>i)return i;for(;n<i;){if(s=this.sampleCurveX(r),Math.abs(s-e)<t)return r;e>s?n=r:i=r,r=(i-n)*.5+n}return r};Hh.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var hxe=c3(fxe);function bs(e,t,n){return e*(1-n)+t*n}function dxe(e,t,n){return new Ss(bs(e.r,t.r,n),bs(e.g,t.g,n),bs(e.b,t.b,n),bs(e.a,t.a,n))}function pxe(e,t,n){return e.map((i,r)=>bs(i,t[r],n))}var mxe=Object.freeze({__proto__:null,number:bs,color:dxe,array:pxe});const b3=.95047,T3=1,x3=1.08883,E3=4/29,Xf=6/29,C3=3*Xf*Xf,gxe=Xf*Xf*Xf,_xe=Math.PI/180,yxe=180/Math.PI;function JT(e){return e>gxe?Math.pow(e,1/3):e/C3+E3}function QT(e){return e>Xf?e*e*e:C3*(e-E3)}function ex(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function tx(e){return e/=255,e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function w3(e){const t=tx(e.r),n=tx(e.g),i=tx(e.b),r=JT((.4124564*t+.3575761*n+.1804375*i)/b3),s=JT((.2126729*t+.7151522*n+.072175*i)/T3),o=JT((.0193339*t+.119192*n+.9503041*i)/x3);return{l:116*s-16,a:500*(r-s),b:200*(s-o),alpha:e.a}}function A3(e){let t=(e.l+16)/116,n=isNaN(e.a)?t:t+e.a/500,i=isNaN(e.b)?t:t-e.b/200;return t=T3*QT(t),n=b3*QT(n),i=x3*QT(i),new Ss(ex(3.2404542*n-1.5371385*t-.4985314*i),ex(-.969266*n+1.8760108*t+.041556*i),ex(.0556434*n-.2040259*t+1.0572252*i),e.alpha)}function bxe(e,t,n){return{l:bs(e.l,t.l,n),a:bs(e.a,t.a,n),b:bs(e.b,t.b,n),alpha:bs(e.alpha,t.alpha,n)}}function Txe(e){const{l:t,a:n,b:i}=w3(e),r=Math.atan2(i,n)*yxe;return{h:r<0?r+360:r,c:Math.sqrt(n*n+i*i),l:t,alpha:e.a}}function xxe(e){const t=e.h*_xe,n=e.c,i=e.l;return A3({l:i,a:Math.cos(t)*n,b:Math.sin(t)*n,alpha:e.alpha})}function Exe(e,t,n){const i=t-e;return e+n*(i>180||i<-180?i-360*Math.round(i/360):i)}function Cxe(e,t,n){return{h:Exe(e.h,t.h,n),c:bs(e.c,t.c,n),l:bs(e.l,t.l,n),alpha:bs(e.alpha,t.alpha,n)}}const Bg={forward:w3,reverse:A3,interpolate:bxe},zg={forward:Txe,reverse:xxe,interpolate:Cxe};class _y{constructor(t,n,i,r,s){this.type=t,this.operator=n,this.interpolation=i,this.input=r,this.labels=[],this.outputs=[];for(const[o,a]of s)this.labels.push(o),this.outputs.push(a)}static interpolationFactor(t,n,i,r){let s=0;if(t.name==="exponential")s=nx(n,t.base,i,r);else if(t.name==="linear")s=nx(n,1,i,r);else if(t.name==="cubic-bezier"){const o=t.controlPoints;s=new hxe(o[0],o[1],o[2],o[3]).solve(nx(n,1,i,r))}return s}static parse(t,n){let[i,r,s,...o]=t;if(!Array.isArray(r)||r.length===0)return n.error("Expected an interpolation type expression.",1);if(r[0]==="linear")r={name:"linear"};else if(r[0]==="exponential"){const u=r[1];if(typeof u!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:u}}else if(r[0]==="cubic-bezier"){const u=r.slice(1);if(u.length!==4||u.some(h=>typeof h!="number"||h<0||h>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:u}}else return n.error(`Unknown interpolation type ${String(r[0])}`,1,0);if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!==0)return n.error("Expected an even number of arguments.");if(s=n.parse(s,2,Ce),!s)return null;const a=[];let c=null;i==="interpolate-hcl"||i==="interpolate-lab"?c=nc:n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);for(let u=0;u<o.length;u+=2){const h=o[u],d=o[u+1],p=u+3,g=u+4;if(typeof h!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',p);if(a.length&&a[a.length-1][0]>=h)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',p);const _=n.parse(d,g,c);if(!_)return null;c=c||_.type,a.push([h,_])}return c.kind!=="number"&&c.kind!=="color"&&!(c.kind==="array"&&c.itemType.kind==="number"&&typeof c.N=="number")?n.error(`Type ${Wn(c)} is not interpolatable.`):new _y(c,i,r,s,a)}evaluate(t){const n=this.labels,i=this.outputs;if(n.length===1)return i[0].evaluate(t);const r=this.input.evaluate(t);if(r<=n[0])return i[0].evaluate(t);const s=n.length;if(r>=n[s-1])return i[s-1].evaluate(t);const o=_3(n,r),a=n[o],c=n[o+1],u=_y.interpolationFactor(this.interpolation,r,a,c),h=i[o].evaluate(t),d=i[o+1].evaluate(t);return this.operator==="interpolate"?mxe[this.type.kind.toLowerCase()](h,d,u):this.operator==="interpolate-hcl"?zg.reverse(zg.interpolate(zg.forward(h),zg.forward(d),u)):Bg.reverse(Bg.interpolate(Bg.forward(h),Bg.forward(d),u))}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;this.interpolation.name==="linear"?t=["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?t=["linear"]:t=["exponential",this.interpolation.base]:t=["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,t,this.input.serialize()];for(let i=0;i<this.labels.length;i++)n.push(this.labels[i],this.outputs[i].serialize());return n}}function nx(e,t,n,i){const r=i-n,s=e-n;return r===0?0:t===1?s/r:(Math.pow(t,s)-1)/(Math.pow(t,r)-1)}var Cu=_y;class yy{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let i=null;const r=n.expectedType;r&&r.kind!=="value"&&(i=r);const s=[];for(const a of t.slice(1)){const c=n.parse(a,1+s.length,i,void 0,{typeAnnotation:"omit"});if(!c)return null;i=i||c.type,s.push(c)}return r&&s.some(a=>Np(r,a.type))?new yy(gt,s):new yy(i,s)}evaluate(t){let n=null,i=0,r;for(const s of this.args){if(i++,n=s.evaluate(t),n&&n instanceof Fl&&!n.available&&(r||(r=n),n=null,i===this.args.length))return r;if(n!==null)break}return n}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(n=>{t.push(n.serialize())}),t}}var S3=yy;class CA{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const i=[];for(let s=1;s<t.length-1;s+=2){const o=t[s];if(typeof o!="string")return n.error(`Expected string, but found ${typeof o} instead.`,s);if(/[^a-zA-Z0-9_]/.test(o))return n.error("Variable names must contain only alphanumeric characters or '_'.",s);const a=n.parse(t[s+1],s+1);if(!a)return null;i.push([o,a])}const r=n.parse(t[t.length-1],t.length-1,n.expectedType,i);return r?new CA(i,r):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[n,i]of this.bindings)t.push(n,i.serialize());return t.push(this.result.serialize()),t}}var v3=CA;class wA{constructor(t,n,i){this.type=t,this.index=n,this.input=i}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=n.parse(t[1],1,Ce),r=n.parse(t[2],2,Ys(n.expectedType||gt));if(!i||!r)return null;const s=r.type;return new wA(s.itemType,i,r)}evaluate(t){const n=this.index.evaluate(t),i=this.input.evaluate(t);if(n<0)throw new or(`Array index out of bounds: ${n} < 0.`);if(n>=i.length)throw new or(`Array index out of bounds: ${n} > ${i.length-1}.`);if(n!==Math.floor(n))throw new or(`Array index must be an integer, but found ${n} instead.`);return i[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var wxe=wA;class AA{constructor(t,n){this.type=mt,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=n.parse(t[1],1,gt),r=n.parse(t[2],2,gt);return!i||!r?null:lA(i.type,[mt,Et,Ce,db,gt])?new AA(i,r):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wn(i.type)} instead`)}evaluate(t){const n=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(i==null)return!1;if(!Fp(n,["boolean","string","number","null"]))throw new or(`Expected first argument to be of type boolean, string, number or null, but found ${Wn(Ri(n))} instead.`);if(!Fp(i,["string","array"]))throw new or(`Expected second argument to be of type array or string, but found ${Wn(Ri(i))} instead.`);return i.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Axe=AA;class by{constructor(t,n,i){this.type=Ce,this.needle=t,this.haystack=n,this.fromIndex=i}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=n.parse(t[1],1,gt),r=n.parse(t[2],2,gt);if(!i||!r)return null;if(!lA(i.type,[mt,Et,Ce,db,gt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wn(i.type)} instead`);if(t.length===4){const s=n.parse(t[3],3,Ce);return s?new by(i,r,s):null}else return new by(i,r)}evaluate(t){const n=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!Fp(n,["boolean","string","number","null"]))throw new or(`Expected first argument to be of type boolean, string, number or null, but found ${Wn(Ri(n))} instead.`);if(!Fp(i,["string","array"]))throw new or(`Expected second argument to be of type array or string, but found ${Wn(Ri(i))} instead.`);if(this.fromIndex){const r=this.fromIndex.evaluate(t);return i.indexOf(n,r)}return i.indexOf(n)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Sxe=by;class SA{constructor(t,n,i,r,s,o){this.inputType=t,this.type=n,this.input=i,this.cases=r,this.outputs=s,this.otherwise=o}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!==1)return n.error("Expected an even number of arguments.");let i,r;n.expectedType&&n.expectedType.kind!=="value"&&(r=n.expectedType);const s={},o=[];for(let u=2;u<t.length-1;u+=2){let h=t[u];const d=t[u+1];Array.isArray(h)||(h=[h]);const p=n.concat(u);if(h.length===0)return p.error("Expected at least one branch label.");for(const _ of h){if(typeof _!="number"&&typeof _!="string")return p.error("Branch labels must be numbers or strings.");if(typeof _=="number"&&Math.abs(_)>Number.MAX_SAFE_INTEGER)return p.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof _=="number"&&Math.floor(_)!==_)return p.error("Numeric branch labels must be integer values.");if(!i)i=Ri(_);else if(p.checkSubtype(i,Ri(_)))return null;if(typeof s[String(_)]<"u")return p.error("Branch labels must be unique.");s[String(_)]=o.length}const g=n.parse(d,u,r);if(!g)return null;r=r||g.type,o.push(g)}const a=n.parse(t[1],1,gt);if(!a)return null;const c=n.parse(t[t.length-1],t.length-1,r);return!c||a.type.kind!=="value"&&n.concat(1).checkSubtype(i,a.type)?null:new SA(i,r,a,s,o,c)}evaluate(t){const n=this.input.evaluate(t);return(Ri(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),i=[],r={};for(const o of n){const a=r[this.cases[o]];a===void 0?(r[this.cases[o]]=i.length,i.push([this.cases[o],[o]])):i[a][1].push(o)}const s=o=>this.inputType.kind==="number"?Number(o):o;for(const[o,a]of i)a.length===1?t.push(s(a[0])):t.push(a.map(s)),t.push(this.outputs[o].serialize());return t.push(this.otherwise.serialize()),t}}var vxe=SA;class vA{constructor(t,n,i){this.type=t,this.branches=n,this.otherwise=i}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!==0)return n.error("Expected an odd number of arguments.");let i;n.expectedType&&n.expectedType.kind!=="value"&&(i=n.expectedType);const r=[];for(let o=1;o<t.length-1;o+=2){const a=n.parse(t[o],o,mt);if(!a)return null;const c=n.parse(t[o+1],o+1,i);if(!c)return null;r.push([a,c]),i=i||c.type}const s=n.parse(t[t.length-1],t.length-1,i);return s?new vA(i,r,s):null}evaluate(t){for(const[n,i]of this.branches)if(n.evaluate(t))return i.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,i]of this.branches)t(n),t(i);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(n=>{t.push(n.serialize())}),t}}var Ixe=vA;class Ty{constructor(t,n,i,r){this.type=t,this.input=n,this.beginIndex=i,this.endIndex=r}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=n.parse(t[1],1,gt),r=n.parse(t[2],2,Ce);if(!i||!r)return null;if(!lA(i.type,[Ys(gt),Et,gt]))return n.error(`Expected first argument to be of type array or string, but found ${Wn(i.type)} instead`);if(t.length===4){const s=n.parse(t[3],3,Ce);return s?new Ty(i.type,i,r,s):null}else return new Ty(i.type,i,r)}evaluate(t){const n=this.input.evaluate(t),i=this.beginIndex.evaluate(t);if(!Fp(n,["string","array"]))throw new or(`Expected first argument to be of type array or string, but found ${Wn(Ri(n))} instead.`);if(this.endIndex){const r=this.endIndex.evaluate(t);return n.slice(i,r)}return n.slice(i)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Oxe=Ty;function nR(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Rxe(e,t,n){return t===n}function Dxe(e,t,n){return t!==n}function Mxe(e,t,n){return t<n}function Lxe(e,t,n){return t>n}function Pxe(e,t,n){return t<=n}function Nxe(e,t,n){return t>=n}function I3(e,t,n,i){return i.compare(t,n)===0}function Fxe(e,t,n,i){return!I3(e,t,n,i)}function Bxe(e,t,n,i){return i.compare(t,n)<0}function zxe(e,t,n,i){return i.compare(t,n)>0}function Uxe(e,t,n,i){return i.compare(t,n)<=0}function kxe(e,t,n,i){return i.compare(t,n)>=0}function qh(e,t,n){const i=e!=="=="&&e!=="!=";return class O3{constructor(s,o,a){this.type=mt,this.lhs=s,this.rhs=o,this.collator=a,this.hasUntypedArgument=s.type.kind==="value"||o.type.kind==="value"}static parse(s,o){if(s.length!==3&&s.length!==4)return o.error("Expected two or three arguments.");const a=s[0];let c=o.parse(s[1],1,gt);if(!c)return null;if(!nR(a,c.type))return o.concat(1).error(`"${a}" comparisons are not supported for type '${Wn(c.type)}'.`);let u=o.parse(s[2],2,gt);if(!u)return null;if(!nR(a,u.type))return o.concat(2).error(`"${a}" comparisons are not supported for type '${Wn(u.type)}'.`);if(c.type.kind!==u.type.kind&&c.type.kind!=="value"&&u.type.kind!=="value")return o.error(`Cannot compare types '${Wn(c.type)}' and '${Wn(u.type)}'.`);i&&(c.type.kind==="value"&&u.type.kind!=="value"?c=new qa(u.type,[c]):c.type.kind!=="value"&&u.type.kind==="value"&&(u=new qa(c.type,[u])));let h=null;if(s.length===4){if(c.type.kind!=="string"&&u.type.kind!=="string"&&c.type.kind!=="value"&&u.type.kind!=="value")return o.error("Cannot use collator to compare non-string types.");if(h=o.parse(s[3],3,pb),!h)return null}return new O3(c,u,h)}evaluate(s){const o=this.lhs.evaluate(s),a=this.rhs.evaluate(s);if(i&&this.hasUntypedArgument){const c=Ri(o),u=Ri(a);if(c.kind!==u.kind||!(c.kind==="string"||c.kind==="number"))throw new or(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${c.kind}, ${u.kind}) instead.`)}if(this.collator&&!i&&this.hasUntypedArgument){const c=Ri(o),u=Ri(a);if(c.kind!=="string"||u.kind!=="string")return t(s,o,a)}return this.collator?n(s,o,a,this.collator.evaluate(s)):t(s,o,a)}eachChild(s){s(this.lhs),s(this.rhs),this.collator&&s(this.collator)}outputDefined(){return!0}serialize(){const s=[e];return this.eachChild(o=>{s.push(o.serialize())}),s}}}const jxe=qh("==",Rxe,I3),Vxe=qh("!=",Dxe,Fxe),Gxe=qh("<",Mxe,Bxe),Hxe=qh(">",Lxe,zxe),qxe=qh("<=",Pxe,Uxe),Wxe=qh(">=",Nxe,kxe);class IA{constructor(t,n,i,r,s,o){this.type=Et,this.number=t,this.locale=n,this.currency=i,this.unit=r,this.minFractionDigits=s,this.maxFractionDigits=o}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const i=n.parse(t[1],1,Ce);if(!i)return null;const r=t[2];if(typeof r!="object"||Array.isArray(r))return n.error("NumberFormat options argument must be an object.");let s=null;if(r.locale&&(s=n.parse(r.locale,1,Et),!s))return null;let o=null;if(r.currency&&(o=n.parse(r.currency,1,Et),!o))return null;let a=null;if(r.unit&&(a=n.parse(r.unit,1,Et),!a))return null;let c=null;if(r["min-fraction-digits"]&&(c=n.parse(r["min-fraction-digits"],1,Ce),!c))return null;let u=null;return r["max-fraction-digits"]&&(u=n.parse(r["max-fraction-digits"],1,Ce),!u)?null:new IA(i,s,o,a,c,u)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency&&"currency"||this.unit&&"unit"||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class OA{constructor(t){this.type=Ce,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const i=n.parse(t[1],1);return i?i.type.kind!=="array"&&i.type.kind!=="string"&&i.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Wn(i.type)} instead.`):new OA(i):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string")return n.length;if(Array.isArray(n))return n.length;throw new or(`Expected value to be of type string or array, but found ${Wn(Ri(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(n=>{t.push(n.serialize())}),t}}var $xe=OA;const R3={"==":jxe,"!=":Vxe,">":Hxe,"<":Gxe,">=":Wxe,"<=":qxe,array:qa,at:wxe,boolean:qa,case:Ixe,coalesce:S3,collator:yb,format:gb,image:_b,in:Axe,"index-of":Sxe,interpolate:Cu,"interpolate-hcl":Cu,"interpolate-lab":Cu,length:$xe,let:v3,literal:my,match:vxe,number:qa,"number-format":IA,object:qa,slice:Oxe,step:y3,string:qa,"to-boolean":Nf,"to-color":Nf,"to-number":Nf,"to-string":Nf,var:m3,within:_A};function iR(e,[t,n,i,r]){t=t.evaluate(e),n=n.evaluate(e),i=i.evaluate(e);const s=r?r.evaluate(e):1,o=u3(t,n,i,s);if(o)throw new or(o);return new Ss(t/255*s,n/255*s,i/255*s,s)}function rR(e,t){return e in t}function ix(e,t){const n=t[e];return typeof n>"u"?null:n}function Xxe(e,t,n,i){for(;n<=i;){const r=n+i>>1;if(t[r]===e)return!0;t[r]>e?i=r-1:n=r+1}return!1}function nu(e){return{type:e}}Gh.register(R3,{error:[qTe,[Et],(e,[t])=>{throw new or(t.evaluate(e))}],typeof:[Et,[gt],(e,[t])=>Wn(Ri(t.evaluate(e)))],"to-rgba":[Ys(Ce,4),[nc],(e,[t])=>t.evaluate(e).toArray()],rgb:[nc,[Ce,Ce,Ce],iR],rgba:[nc,[Ce,Ce,Ce,Ce],iR],has:{type:mt,overloads:[[[Et],(e,[t])=>rR(t.evaluate(e),e.properties())],[[Et,$f],(e,[t,n])=>rR(t.evaluate(e),n.evaluate(e))]]},get:{type:gt,overloads:[[[Et],(e,[t])=>ix(t.evaluate(e),e.properties())],[[Et,$f],(e,[t,n])=>ix(t.evaluate(e),n.evaluate(e))]]},"feature-state":[gt,[Et],(e,[t])=>ix(t.evaluate(e),e.featureState||{})],properties:[$f,[],e=>e.properties()],"geometry-type":[Et,[],e=>e.geometryType()],id:[gt,[],e=>e.id()],zoom:[Ce,[],e=>e.globals.zoom],pitch:[Ce,[],e=>e.globals.pitch||0],"distance-from-center":[Ce,[],e=>e.distanceFromCenter()],"heatmap-density":[Ce,[],e=>e.globals.heatmapDensity||0],"line-progress":[Ce,[],e=>e.globals.lineProgress||0],"sky-radial-progress":[Ce,[],e=>e.globals.skyRadialProgress||0],accumulated:[gt,[],e=>e.globals.accumulated===void 0?null:e.globals.accumulated],"+":[Ce,nu(Ce),(e,t)=>{let n=0;for(const i of t)n+=i.evaluate(e);return n}],"*":[Ce,nu(Ce),(e,t)=>{let n=1;for(const i of t)n*=i.evaluate(e);return n}],"-":{type:Ce,overloads:[[[Ce,Ce],(e,[t,n])=>t.evaluate(e)-n.evaluate(e)],[[Ce],(e,[t])=>-t.evaluate(e)]]},"/":[Ce,[Ce,Ce],(e,[t,n])=>t.evaluate(e)/n.evaluate(e)],"%":[Ce,[Ce,Ce],(e,[t,n])=>t.evaluate(e)%n.evaluate(e)],ln2:[Ce,[],()=>Math.LN2],pi:[Ce,[],()=>Math.PI],e:[Ce,[],()=>Math.E],"^":[Ce,[Ce,Ce],(e,[t,n])=>Math.pow(t.evaluate(e),n.evaluate(e))],sqrt:[Ce,[Ce],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[Ce,[Ce],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[Ce,[Ce],(e,[t])=>Math.log(t.evaluate(e))],log2:[Ce,[Ce],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[Ce,[Ce],(e,[t])=>Math.sin(t.evaluate(e))],cos:[Ce,[Ce],(e,[t])=>Math.cos(t.evaluate(e))],tan:[Ce,[Ce],(e,[t])=>Math.tan(t.evaluate(e))],asin:[Ce,[Ce],(e,[t])=>Math.asin(t.evaluate(e))],acos:[Ce,[Ce],(e,[t])=>Math.acos(t.evaluate(e))],atan:[Ce,[Ce],(e,[t])=>Math.atan(t.evaluate(e))],min:[Ce,nu(Ce),(e,t)=>Math.min(...t.map(n=>n.evaluate(e)))],max:[Ce,nu(Ce),(e,t)=>Math.max(...t.map(n=>n.evaluate(e)))],abs:[Ce,[Ce],(e,[t])=>Math.abs(t.evaluate(e))],round:[Ce,[Ce],(e,[t])=>{const n=t.evaluate(e);return n<0?-Math.round(-n):Math.round(n)}],floor:[Ce,[Ce],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[Ce,[Ce],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[mt,[Et,gt],(e,[t,n])=>e.properties()[t.value]===n.value],"filter-id-==":[mt,[gt],(e,[t])=>e.id()===t.value],"filter-type-==":[mt,[Et],(e,[t])=>e.geometryType()===t.value],"filter-<":[mt,[Et,gt],(e,[t,n])=>{const i=e.properties()[t.value],r=n.value;return typeof i==typeof r&&i<r}],"filter-id-<":[mt,[gt],(e,[t])=>{const n=e.id(),i=t.value;return typeof n==typeof i&&n<i}],"filter->":[mt,[Et,gt],(e,[t,n])=>{const i=e.properties()[t.value],r=n.value;return typeof i==typeof r&&i>r}],"filter-id->":[mt,[gt],(e,[t])=>{const n=e.id(),i=t.value;return typeof n==typeof i&&n>i}],"filter-<=":[mt,[Et,gt],(e,[t,n])=>{const i=e.properties()[t.value],r=n.value;return typeof i==typeof r&&i<=r}],"filter-id-<=":[mt,[gt],(e,[t])=>{const n=e.id(),i=t.value;return typeof n==typeof i&&n<=i}],"filter->=":[mt,[Et,gt],(e,[t,n])=>{const i=e.properties()[t.value],r=n.value;return typeof i==typeof r&&i>=r}],"filter-id->=":[mt,[gt],(e,[t])=>{const n=e.id(),i=t.value;return typeof n==typeof i&&n>=i}],"filter-has":[mt,[gt],(e,[t])=>t.value in e.properties()],"filter-has-id":[mt,[],e=>e.id()!==null&&e.id()!==void 0],"filter-type-in":[mt,[Ys(Et)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[mt,[Ys(gt)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[mt,[Et,Ys(gt)],(e,[t,n])=>n.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[mt,[Et,Ys(gt)],(e,[t,n])=>Xxe(e.properties()[t.value],n.value,0,n.value.length-1)],all:{type:mt,overloads:[[[mt,mt],(e,[t,n])=>t.evaluate(e)&&n.evaluate(e)],[nu(mt),(e,t)=>{for(const n of t)if(!n.evaluate(e))return!1;return!0}]]},any:{type:mt,overloads:[[[mt,mt],(e,[t,n])=>t.evaluate(e)||n.evaluate(e)],[nu(mt),(e,t)=>{for(const n of t)if(n.evaluate(e))return!0;return!1}]]},"!":[mt,[mt],(e,[t])=>!t.evaluate(e)],"is-supported-script":[mt,[Et],(e,[t])=>{const n=e.globals&&e.globals.isSupportedScript;return n?n(t.evaluate(e)):!0}],upcase:[Et,[Et],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[Et,[Et],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[Et,nu(gt),(e,t)=>t.map(n=>up(n.evaluate(e))).join("")],"resolved-locale":[Et,[pb],(e,[t])=>t.evaluate(e).resolvedLocale()]});var D3=R3;function RE(e){return{result:"success",value:e}}function Ef(e){return{result:"error",value:e}}function Yxe(e){return e["property-type"]==="data-driven"}function Kxe(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Zxe(e){return!!e.expression&&e.expression.interpolated}function M3(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}class Jxe{constructor(t,n){this.expression=t,this._warningHistory={},this._evaluator=new f3,this._defaultValue=n?nEe(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,i,r,s,o,a,c){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=i,this._evaluator.canonical=r||null,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=c||null,this.expression.evaluate(this._evaluator)}evaluate(t,n,i,r,s,o,a,c){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=i||null,this._evaluator.canonical=r||null,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=c||null;try{const u=this.expression.evaluate(this._evaluator);if(u==null||typeof u=="number"&&u!==u)return this._defaultValue;if(this._enumValues&&!(u in this._enumValues))throw new or(`Expected value to be one of ${Object.keys(this._enumValues).map(h=>JSON.stringify(h)).join(", ")}, but found ${JSON.stringify(u)} instead.`);return u}catch(u){return this._warningHistory[u.message]||(this._warningHistory[u.message]=!0,typeof console<"u"&&console.warn(u.message)),this._defaultValue}}}function Qxe(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in D3}function DE(e,t){const n=new g3(D3,[],t?tEe(t):void 0),i=n.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return i?RE(new Jxe(i,t)):Ef(n.errors)}class sR{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!yA(n.expression)}evaluateWithoutErrorHandling(t,n,i,r,s,o){return this._styleExpression.evaluateWithoutErrorHandling(t,n,i,r,s,o)}evaluate(t,n,i,r,s,o){return this._styleExpression.evaluate(t,n,i,r,s,o)}}class oR{constructor(t,n,i,r){this.kind=t,this.zoomStops=i,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!yA(n.expression),this.interpolationType=r}evaluateWithoutErrorHandling(t,n,i,r,s,o){return this._styleExpression.evaluateWithoutErrorHandling(t,n,i,r,s,o)}evaluate(t,n,i,r,s,o){return this._styleExpression.evaluate(t,n,i,r,s,o)}interpolationFactor(t,n,i){return this.interpolationType?Cu.interpolationFactor(this.interpolationType,t,n,i):0}}function eEe(e,t){if(e=DE(e,t),e.result==="error")return e;const n=e.value.expression,i=bb(n);if(!i&&!Yxe(t))return Ef([new ia("","data expressions not supported")]);const r=bA(n,["zoom","pitch","distance-from-center"]);if(!r&&!Kxe(t))return Ef([new ia("","zoom expressions not supported")]);const s=__(n);if(!s&&!r)return Ef([new ia("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(s instanceof ia)return Ef([s]);if(s instanceof Cu&&!Zxe(t))return Ef([new ia("",'"interpolate" expressions cannot be used with this property')]);if(!s)return RE(i?new sR("constant",e.value):new sR("source",e.value));const o=s instanceof Cu?s.interpolation:void 0;return RE(i?new oR("camera",e.value,s.labels,o):new oR("composite",e.value,s.labels,o))}function __(e){let t=null;if(e instanceof v3)t=__(e.result);else if(e instanceof S3){for(const n of e.args)if(t=__(n),t)break}else(e instanceof y3||e instanceof Cu)&&e.input instanceof Gh&&e.input.name==="zoom"&&(t=e);return t instanceof ia||e.eachChild(n=>{const i=__(n);i instanceof ia?t=i:!t&&i?t=new ia("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&i&&t!==i&&(t=new ia("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function tEe(e){const t={color:nc,string:Et,number:Ce,enum:Et,boolean:mt,formatted:mb,resolvedImage:_m};return e.type==="array"?Ys(t[e.value]||gt,e.length):t[e.type]}function nEe(e){return e.type==="color"&&(M3(e.default)||Array.isArray(e.default))?new Ss(0,0,0,0):e.type==="color"?Ss.parse(e.default)||null:e.default===void 0?null:e.default}function iEe(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function ME(e){if(Array.isArray(e))return e.map(ME);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const n in e)t[n]=ME(e[n]);return t}return iEe(e)}var L3={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},fog:{type:"fog"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},projection:{type:"projection"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"},"fill-extrusion-edge-radius":{type:"number",private:!0,default:0,minimum:0,maximum:1,"property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_symbol:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature","pitch","distance-from-center"]}},filter_fill:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_line:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_circle:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},"filter_fill-extrusion":{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_heatmap:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},expression_name:{type:"enum",values:{let:{group:"Variable binding"},var:{group:"Variable binding"},literal:{group:"Types"},array:{group:"Types"},at:{group:"Lookup"},in:{group:"Lookup"},"index-of":{group:"Lookup"},slice:{group:"Lookup"},case:{group:"Decision"},match:{group:"Decision"},coalesce:{group:"Decision"},step:{group:"Ramps, scales, curves"},interpolate:{group:"Ramps, scales, curves"},"interpolate-hcl":{group:"Ramps, scales, curves"},"interpolate-lab":{group:"Ramps, scales, curves"},ln2:{group:"Math"},pi:{group:"Math"},e:{group:"Math"},typeof:{group:"Types"},string:{group:"Types"},number:{group:"Types"},boolean:{group:"Types"},object:{group:"Types"},collator:{group:"Types"},format:{group:"Types"},image:{group:"Types"},"number-format":{group:"Types"},"to-string":{group:"Types"},"to-number":{group:"Types"},"to-boolean":{group:"Types"},"to-rgba":{group:"Color"},"to-color":{group:"Types"},rgb:{group:"Color"},rgba:{group:"Color"},get:{group:"Lookup"},has:{group:"Lookup"},length:{group:"Lookup"},properties:{group:"Feature data"},"feature-state":{group:"Feature data"},"geometry-type":{group:"Feature data"},id:{group:"Feature data"},zoom:{group:"Camera"},pitch:{group:"Camera"},"distance-from-center":{group:"Camera"},"heatmap-density":{group:"Heatmap"},"line-progress":{group:"Feature data"},"sky-radial-progress":{group:"sky"},accumulated:{group:"Feature data"},"+":{group:"Math"},"*":{group:"Math"},"-":{group:"Math"},"/":{group:"Math"},"%":{group:"Math"},"^":{group:"Math"},sqrt:{group:"Math"},log10:{group:"Math"},ln:{group:"Math"},log2:{group:"Math"},sin:{group:"Math"},cos:{group:"Math"},tan:{group:"Math"},asin:{group:"Math"},acos:{group:"Math"},atan:{group:"Math"},min:{group:"Math"},max:{group:"Math"},round:{group:"Math"},abs:{group:"Math"},ceil:{group:"Math"},floor:{group:"Math"},distance:{group:"Math"},"==":{group:"Decision"},"!=":{group:"Decision"},">":{group:"Decision"},"<":{group:"Decision"},">=":{group:"Decision"},"<=":{group:"Decision"},all:{group:"Decision"},any:{group:"Decision"},"!":{group:"Decision"},within:{group:"Decision"},"is-supported-script":{group:"String"},upcase:{group:"String"},downcase:{group:"String"},concat:{group:"String"},"resolved-locale":{group:"String"}}},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"high-color":{type:"color","property-type":"data-constant",default:"#245cdf",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"space-color":{type:"color","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],4,.2,7,.1],minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"star-intensity":{type:"number","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],5,.35,6,0],minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},projection:{name:{type:"enum",values:{albers:{},equalEarth:{},equirectangular:{},lambertConformalConic:{},mercator:{},naturalEarth:{},winkelTripel:{},globe:{}},default:"mercator",required:!0},center:{type:"array",length:2,value:"number","property-type":"data-constant",minimum:[-180,-90],maximum:[180,90],transition:!1,requires:[{name:["albers","lambertConformalConic"]}]},parallels:{type:"array",length:2,value:"number","property-type":"data-constant",minimum:[-90,-90],maximum:[90,90],transition:!1,requires:[{name:["albers","lambertConformalConic"]}]}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,requires:["source"]}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant",type:"number",private:!0,default:0,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant",type:"number",private:!0,default:3,minimum:0,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,requires:["fill-extrusion-edge-radius"]}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!1,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{type:"array",value:"number",length:2,default:[0,0],minimum:[0,0],maximum:[1,1],transition:!1,requires:[{source:"geojson",has:{lineMetrics:!0}}],"property-type":"constant"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};function P3(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!P3(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function rEe(e,t="fill"){if(e==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};P3(e)||(e=xy(e));const n=e;let i=!0;try{i=sEe(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}const r=L3[`filter_${t}`],s=DE(i,r);let o=null;if(s.result==="error")throw new Error(s.value.map(h=>`${h.key}: ${h.message}`).join(", "));o=(h,d,p)=>s.value.evaluate(h,d,{},p);let a=null,c=null;if(i!==n){const h=DE(n,r);if(h.result==="error")throw new Error(h.value.map(d=>`${d.key}: ${d.message}`).join(", "));a=(d,p,g,_,b)=>h.value.evaluate(d,p,{},g,void 0,void 0,_,b),c=!bb(h.value.expression)}o=o;const u=B3(i);return{filter:o,dynamicFilter:a||void 0,needGeometry:u,needFeature:!!c}}function sEe(e){if(!Yf(e))return e;let t=ME(e);return F3(t),t=N3(t),t}function N3(e){if(!Array.isArray(e))return e;const t=cEe(e);return t===!0?t:t.map(n=>N3(n))}function F3(e){let t=!1;const n=[];if(e[0]==="case"){for(let i=1;i<e.length-1;i+=2)t=t||Yf(e[i]),n.push(e[i+1]);n.push(e[e.length-1])}else if(e[0]==="match"){t=t||Yf(e[1]);for(let i=2;i<e.length-1;i+=2)n.push(e[i+1]);n.push(e[e.length-1])}else if(e[0]==="step"){t=t||Yf(e[1]);for(let i=1;i<e.length-1;i+=2)n.push(e[i+1])}t&&(e.length=0,e.push("any",...n));for(let i=1;i<e.length;i++)F3(e[i])}function Yf(e){if(!Array.isArray(e))return!1;if(oEe(e[0]))return!0;for(let t=1;t<e.length;t++){const n=e[t];if(Yf(n))return!0}return!1}function oEe(e){return e==="pitch"||e==="distance-from-center"}const aEe=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function cEe(e){if(aEe.has(e[0]))for(let t=1;t<e.length;t++){const n=e[t];if(Yf(n))return!0}return e}function lEe(e,t){return e<t?-1:e>t?1:0}function B3(e){if(!Array.isArray(e))return!1;if(e[0]==="within")return!0;for(let t=1;t<e.length;t++)if(B3(e[t]))return!0;return!1}function xy(e){if(!e)return!0;const t=e[0];return e.length<=1?t!=="any":t==="=="?rx(e[1],e[2],"=="):t==="!="?Ug(rx(e[1],e[2],"==")):t==="<"||t===">"||t==="<="||t===">="?rx(e[1],e[2],t):t==="any"?uEe(e.slice(1)):t==="all"?["all"].concat(e.slice(1).map(xy)):t==="none"?["all"].concat(e.slice(1).map(xy).map(Ug)):t==="in"?aR(e[1],e.slice(2)):t==="!in"?Ug(aR(e[1],e.slice(2))):t==="has"?cR(e[1]):t==="!has"?Ug(cR(e[1])):t==="within"?e:!0}function rx(e,t,n){switch(e){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,e,t]}}function uEe(e){return["any"].concat(e.map(xy))}function aR(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",e,["literal",t.sort(lEe)]]:["filter-in-small",e,["literal",t]]}}function cR(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Ug(e){return["!",e]}var fEe=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function hEe(e,t){const n={};for(const i in e)i!=="ref"&&(n[i]=e[i]);return fEe.forEach(i=>{i in t&&(n[i]=t[i])}),n}function dEe(e){e=e.slice();const t=Object.create(null);for(let n=0;n<e.length;n++)t[e[n].id]=e[n];for(let n=0;n<e.length;n++)"ref"in e[n]&&(e[n]=hEe(e[n],t[e[n].ref]));return e}var lR={thin:100,hairline:100,"ultra-light":200,"extra-light":200,light:300,book:300,regular:400,normal:400,plain:400,roman:400,standard:400,medium:500,"semi-bold":600,"demi-bold":600,bold:700,"extra-bold":800,"ultra-bold":800,heavy:900,black:900,"heavy-black":900,fat:900,poster:900,"ultra-black":950,"extra-black":950},Od=" ",uR=/(italic|oblique)$/i,fR={},pEe=function(e,t,n){var i=fR[e];if(!i){Array.isArray(e)||(e=[e]);for(var r=400,s="normal",o=[],a,c,u=0,h=e.length;u<h;++u){var d=e[u],p=d.split(" "),g=p[p.length-1].toLowerCase();g=="normal"||g=="italic"||g=="oblique"?(s=c?s:g,c=!0,p.pop(),g=p[p.length-1].toLowerCase()):uR.test(g)&&(g=g.replace(uR,""),s=c?s:p[p.length-1].replace(g,""),c=!0);for(var _ in lR){var b=p.length>1?p[p.length-2].toLowerCase():"";if(g==_||g==_.replace("-","")||b+"-"+g==_){r=a?r:lR[_],p.pop(),b&&_.startsWith(b)&&p.pop();break}}!a&&typeof g=="number"&&(r=g,a=!0);var x=p.join(Od).replace("Klokantech Noto Sans","Noto Sans");x.indexOf(Od)!==-1&&(x='"'+x+'"'),o.push(x)}i=fR[e]=[s,r,o]}return i[0]+Od+i[1]+Od+t+"px"+(n?"/"+n:"")+Od+i[2]},LE=c3(pEe);const z3="https://api.mapbox.com";function RA(e){const t="mapbox://";return e.indexOf(t)!==0?"":e.slice(t.length)}function mEe(e,t,n){const i=RA(e);if(!i)return decodeURI(new URL(e,n).href);const r="sprites/";if(i.indexOf(r)!==0)throw new Error(`unexpected sprites url: ${e}`);const s=i.slice(r.length);return`${z3}/styles/v1/${s}/sprite?access_token=${t}`}function U3(e,t){const n=RA(e);if(!n)return decodeURI(new URL(e,location.href).href);const i="styles/";if(n.indexOf(i)!==0)throw new Error(`unexpected style url: ${e}`);const r=n.slice(i.length);return`${z3}/styles/v1/${r}?&access_token=${t}`}function y_(e,t,n,i){const r=new URL(e,i),s=RA(e);if(!s)return t&&(r.searchParams.has(n)||r.searchParams.set(n,t)),decodeURI(r.href);if(s==="mapbox.satellite"){const o=window.devicePixelRatio>=1.5?"@2x":"";return`https://api.mapbox.com/v4/${s}/{z}/{x}/{y}${o}.webp?access_token=${t}`}return`https://{a-d}.tiles.mapbox.com/v4/${s}/{z}/{x}/{y}.vector.pbf?access_token=${t}`}const hR={},dR={};let gEe=0;function DA(e){return e.id||(e.id=gEe++),e.id}function _Ee(e,t){return DA(e)+"."+is(t)}function yEe(e){let t=hR[e.id];return t||(t={},hR[DA(e)]=t),t}function bEe(e){let t=dR[e.id];return t||(t={},dR[DA(e)]=t),t}function sx(e){return e*Math.PI/180}const MA=function(){const e=[];for(let t=78271.51696402048;e.length<=24;t/=2)e.push(t);return e}();function Tb(e,t){if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof OffscreenCanvas<"u")return new OffscreenCanvas(e,t);const n=document.createElement("canvas");return n.width=e,n.height=t,n}function TEe(e,t){let n=0;const i=t.length;for(;n<i;++n)if(t[n]<e&&n+1<i){const s=t[n]/t[n+1];return n+Math.log(t[n]/e)/Math.log(s)}return i-1}function xEe(e,t){const n=Math.floor(e),i=Math.pow(2,e-n);return t[n]/i}const hf={};function _h(e,t,n={},i){if(t in hf)return i&&(i.request=hf[t][0]),hf[t][1];const r=n.transformRequest&&n.transformRequest(t,e)||t,s=dp(()=>r).then(o=>(o instanceof Request||(o=new Request(o)),o.headers.get("Accept")||o.headers.set("Accept","application/json"),i&&(i.request=o),fetch(o).then(function(a){return delete hf[t],a.ok?a.json():Promise.reject(new Error("Error fetching source "+t))}).catch(function(a){return delete hf[t],Promise.reject(new Error("Error fetching source "+t))})));return hf[t]=[r,s],s}function EEe(e,t){if(typeof e=="string")if(e.trim().startsWith("{"))try{const n=JSON.parse(e);return Promise.resolve(n)}catch(n){return Promise.reject(n)}else return e=U3(e,t.accessToken),_h("Style",e,t);else return Promise.resolve(e)}const pR={};function CEe(e,t,n={}){const i=[t,JSON.stringify(e)].toString();let r=pR[i];if(!r||n.transformRequest){let s;n.transformRequest&&(s=(a,c)=>{const u=n.transformRequest&&n.transformRequest(c,"Tiles")||c;if(a instanceof UR)a.setLoader((h,d,p)=>{dp(()=>u).then(g=>{fetch(g).then(_=>_.arrayBuffer()).then(_=>{const x=a.getFormat().readFeatures(_,{extent:h,featureProjection:p});a.setFeatures(x)}).catch(_=>a.setState(gn.ERROR))})});else{const h=a.getImage();dp(()=>u).then(d=>{d instanceof Request?fetch(d).then(p=>p.blob()).then(p=>{const g=URL.createObjectURL(p);h.addEventListener("load",()=>URL.revokeObjectURL(g)),h.addEventListener("error",()=>URL.revokeObjectURL(g)),h.src=g}).catch(p=>a.setState(gn.ERROR)):h.src=d})}});const o=e.url;if(o&&!e.tiles){const a=y_(o,n.accessToken,n.accessTokenParam||"access_token",t||location.href);if(o.startsWith("mapbox://"))r=Promise.resolve({tileJson:Object.assign({},e,{url:void 0,tiles:xU(a)}),tileLoadFunction:s});else{const c={};r=_h("Source",a,n,c).then(function(u){return u.tiles=u.tiles.map(function(h){return u.scheme==="tms"&&(h=h.replace("{y}","{-y}")),y_(h,n.accessToken,n.accessTokenParam||"access_token",c.request.url)}),Promise.resolve({tileJson:u,tileLoadFunction:s})})}}else e=Object.assign({},e,{tiles:e.tiles.map(function(a){return e.scheme==="tms"&&(a=a.replace("{y}","{-y}")),y_(a,n.accessToken,n.accessTokenParam||"access_token",t||location.href)})}),r=Promise.resolve({tileJson:Object.assign({},e),tileLoadFunction:s});pR[i]=r}return r}function mR(e,t,n,i){const r=[2*n*t.pixelRatio+t.width,2*n*t.pixelRatio+t.height],s=Tb(r[0],r[1]),o=s.getContext("2d");o.drawImage(e,t.x,t.y,t.width,t.height,n*t.pixelRatio,n*t.pixelRatio,t.width,t.height);const a=o.getImageData(0,0,r[0],r[1]);o.globalCompositeOperation="destination-over",o.fillStyle=`rgba(${i.r*255},${i.g*255},${i.b*255},${i.a})`;const c=a.data;for(let u=0,h=a.width;u<h;++u)for(let d=0,p=a.height;d<p;++d){const g=(d*h+u)*4;c[g+3]>0&&o.arc(u,d,n*t.pixelRatio,0,2*Math.PI)}return o.fill(),s}function wEe(e,t,n){const i=Math.max(0,Math.min(1,(n-e)/(t-e)));return i*i*(3-2*i)}function gR(e,t,n){const i=Tb(t.width,t.height),r=i.getContext("2d");r.drawImage(e,t.x,t.y,t.width,t.height,0,0,t.width,t.height);const s=r.getImageData(0,0,t.width,t.height),o=s.data;for(let a=0,c=s.width;a<c;++a)for(let u=0,h=s.height;u<h;++u){const d=(u*c+a)*4,p=o[d+3]/255,g=.75,_=.1,b=wEe(g-_,g+_,p);b>0?(o[d+0]=Math.round(255*n.r*b),o[d+1]=Math.round(255*n.g*b),o[d+2]=Math.round(255*n.b*b),o[d+3]=Math.round(255*b)):o[d+3]=0}return r.putImageData(s,0,0),i}const AEe=Array(256).join("â");function PE(e,t){if(t>=.05){let n="";const i=e.split(`
`),r=AEe.slice(0,Math.round(t/.1));for(let s=0,o=i.length;s<o;++s)s>0&&(n+=`
`),n+=i[s].split("").join(r);return n}return e}let ox;function k3(){return ox||(ox=Tb(1,1).getContext("2d")),ox}function iu(e,t){return k3().measureText(e).width+(e.length-1)*t}const _R={};function NE(e,t,n,i){if(e.indexOf(`
`)!==-1){const o=e.split(`
`),a=[];for(let c=0,u=o.length;c<u;++c)a.push(NE(o[c],t,n,i));return a.join(`
`)}const r=n+","+t+","+e+","+i;let s=_R[r];if(!s){const o=e.split(" ");if(o.length>1){const a=k3();a.font=t;const u=a.measureText("M").width*n;let h="";const d=[];for(let p=0,g=o.length;p<g;++p){const _=o[p],b=h+(h?" ":"")+_;iu(b,i)<=u?h=b:(h&&d.push(h),h=_)}h&&d.push(h);for(let p=0,g=d.length;p<g&&g>1;++p){const _=d[p];if(iu(_,i)<u*.35){const b=p>0?iu(d[p-1],i):1/0,x=p<g-1?iu(d[p+1],i):1/0;d.splice(p,1),g-=1,b<x?(d[p-1]+=" "+_,p-=1):d[p]=_+" "+d[p]}}for(let p=0,g=d.length-1;p<g;++p){const _=d[p],b=d[p+1];if(iu(_,i)>u*.7&&iu(b,i)<u*.6){const x=_.split(" "),E=x.pop();iu(E,i)<u*.2&&(d[p]=x.join(" "),d[p+1]=E+" "+b),g-=1}}s=d.join(`
`)}else s=e;s=PE(s,i),_R[r]=s}return s}const SEe=/font-family: ?([^;]*);/,vEe=/("|')/g;let kg;function IEe(e){if(!kg){kg={};const t=document.styleSheets;for(let n=0,i=t.length;n<i;++n){const r=t[n];try{const s=r.rules||r.cssRules;if(s)for(let o=0,a=s.length;o<a;++o){const c=s[o];if(c.type==5){const u=c.cssText.match(SEe);kg[u[1].replace(vEe,"")]=!0}}}catch{}}}return e in kg}const ax={};function OEe(e,t="https://cdn.jsdelivr.net/npm/@fontsource/{font-family}/{fontweight}{-fontstyle}.css"){const n=e.toString();if(n in ax)return ax[n];const i=[];for(let r=0,s=e.length;r<s;++r){e[r]=e[r].replace("Arial Unicode MS","Arial");const o=e[r],a=LE(o,1);_U(a);const c=a.split(" ");i.push([c.slice(3).join(" ").replace(/"/g,""),c[1],c[0]])}for(let r=0,s=i.length;r<s;++r){const o=i[r],a=o[0];if(!IEe(a)&&yU.get(`${o[2]}
${o[1]} 
${a}`)!==100){const c=t.replace("{font-family}",a.replace(/ /g,"-").toLowerCase()).replace("{Font+Family}",a.replace(/ /g,"+")).replace("{fontweight}",o[1]).replace("{-fontstyle}",o[2].replace("normal","").replace(/(.+)/,"-$1")).replace("{fontstyle}",o[2]);if(!document.querySelector('link[href="'+c+'"]')){const u=document.createElement("link");u.href=c,u.rel="stylesheet",document.head.appendChild(u)}}}return ax[n]=e,e}const REe={Point:1,MultiPoint:1,LineString:2,MultiLineString:2,Polygon:3,MultiPolygon:3},DEe={center:[.5,.5],left:[0,.5],right:[1,.5],top:[.5,0],bottom:[.5,1],"top-left":[0,0],"top-right":[1,0],"bottom-left":[0,1],"bottom-right":[1,1]},MEe=function(e,t){const n=eEe(e,t);if(n.result==="error")throw new Error(n.value.map(i=>`${i.key}: ${i.message}`).join(", "));return n.value},FE={},Ey={zoom:0};let jg,cx;function Ze(e,t,n,i,r,s,o){const a=e.id;s||(s={},console.warn("No functionCache provided to getValue()")),s[a]||(s[a]={});const c=s[a];if(!c[n]){let u=(e[t]||FE)[n];const h=L3[`${t}_${e.type}`][n];u===void 0&&(u=h.default);let d=Qxe(u);if(!d&&M3(u)&&(u=BTe(u,h),d=!0),d){const p=MEe(u,h);c[n]=p.evaluate.bind(p)}else h.type=="color"&&(u=Ss.parse(u)),c[n]=function(){return u}}return Ey.zoom=i,c[n](Ey,r,o)}function yR(e,t,n,i,r){return Ze(e,"layout",`${i}-allow-overlap`,t,n,r)?Ze(e,"layout",`${i}-ignore-placement`,t,n,r)?"none":"obstacle":"declutter"}function LEe(e,t,n,i,r){return r||console.warn("No filterCache provided to evaluateFilter()"),e in r||(r[e]=rEe(t).filter),Ey.zoom=i,r[e](Ey,n)}function ru(e,t){if(e){if(e.a===0||t===0)return;const n=e.a;return t=t===void 0?1:t,n===0?"transparent":"rgba("+Math.round(e.r*255/n)+","+Math.round(e.g*255/n)+","+Math.round(e.b*255/n)+","+n*t+")"}return e}const PEe=/\{[^{}}]*\}/g;function lx(e,t){return e.replace(PEe,function(n){return t[n.slice(1,-1)]||""})}const NEe={};function FEe(e,t,n,i=MA,r=void 0,s=void 0,o=void 0,a=void 0){if(typeof t=="string"&&(t=JSON.parse(t)),t.version!=8)throw new Error("glStyle version 8 required.");NEe[_Ee(t,e)]=Array.from(arguments);let c,u,h;if(s){if(typeof Image<"u"){const L=new Image;let O;dp(()=>s).then(N=>{N instanceof Request?fetch(N).then(B=>B.blob()).then(B=>{O=URL.createObjectURL(B),L.src=O}).catch(()=>{}):(L.crossOrigin="anonymous",L.src=N,O&&URL.revokeObjectURL(O))}),L.onload=function(){c=L,u=[L.width,L.height],e.changed(),L.onload=null}}else if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope){const L=self;L.postMessage({action:"loadImage",src:s}),L.addEventListener("message",function(N){N.data.action==="imageLoaded"&&N.data.src===s&&(c=N.data.image,u=[c.width,c.height])})}}const d=dEe(t.layers),p={},g=[],_={},b={},x=yEe(t),E=bEe(t);let C;for(let L=0,O=d.length;L<O;++L){const N=d[L],B=N.id;if(typeof n=="string"&&N.source==n||Array.isArray(n)&&n.indexOf(B)!==-1){const U=N["source-layer"];if(C){if(N.source!==C)throw new Error(`Layer "${B}" does not use source "${C}`)}else{C=N.source;const f=t.sources[C];if(!f)throw new Error(`Source "${C}" is not defined`);const I=f.type;if(I!=="vector"&&I!=="geojson")throw new Error(`Source "${C}" is not of type "vector" or "geojson", but "${I}"`)}let V=p[U];V||(V=[],p[U]=V),V.push({layer:N,index:L}),g.push(B)}}const w=new Pr,S=new Ws,v=[],D=function(L,O,N){const B=L.getProperties(),U=p[B.layer];if(!U)return;let V=i.indexOf(O);V==-1&&(V=TEe(O,i));const f=REe[L.getGeometry().getType()],I={id:L.getId(),properties:B,type:f},F=e.get("mapbox-featurestate")[L.getId()];let G=-1;for(let W=0,X=U.length;W<X;++W){const Z=U[W],$=Z.layer,ne=$.id;if(N!==void 0&&N!==ne)continue;const le=$.layout||FE,pe=$.paint||FE;if(le.visibility==="none"||"minzoom"in $&&V<$.minzoom||"maxzoom"in $&&V>=$.maxzoom)continue;const we=$.filter;if(!we||LEe(ne,we,I,V,E)){let me,Pe,ot,At,St,he;const hn=Z.index;if(f==3&&($.type=="fill"||$.type=="fill-extrusion"))if(Pe=Ze($,"paint",$.type+"-opacity",V,I,x,F),$.type+"-pattern"in pe){const cn=Ze($,"paint",$.type+"-pattern",V,I,x,F);if(cn){const tn=typeof cn=="string"?lx(cn,B):cn.toString();if(c&&r&&r[tn]){++G,he=v[G],(!he||!he.getFill()||he.getStroke()||he.getText())&&(he=new ps({fill:new Ws}),v[G]=he),ot=he.getFill(),he.setZIndex(hn);const Yt=tn+"."+Pe;let Pn=b[Yt];if(!Pn){const Pt=r[tn],qt=Tb(Pt.width,Pt.height),Nn=qt.getContext("2d");Nn.globalAlpha=Pe,Nn.drawImage(c,Pt.x,Pt.y,Pt.width,Pt.height,0,0,Pt.width,Pt.height),Pn=Nn.createPattern(qt,"repeat"),b[Yt]=Pn}ot.setColor(Pn)}}}else me=ru(Ze($,"paint",$.type+"-color",V,I,x,F),Pe),$.type+"-outline-color"in pe&&(St=ru(Ze($,"paint",$.type+"-outline-color",V,I,x,F),Pe)),St||(St=me),(me||St)&&(++G,he=v[G],(!he||me&&!he.getFill()||!me&&he.getFill()||St&&!he.getStroke()||!St&&he.getStroke()||he.getText())&&(he=new ps({fill:me?new Ws:void 0,stroke:St?new Pr:void 0}),v[G]=he),me&&(ot=he.getFill(),ot.setColor(me)),St&&(At=he.getStroke(),At.setColor(St),At.setWidth(.5)),he.setZIndex(hn));if(f!=1&&$.type=="line"){"line-pattern"in pe?me=void 0:me=ru(Ze($,"paint","line-color",V,I,x,F),Ze($,"paint","line-opacity",V,I,x,F));const cn=Ze($,"paint","line-width",V,I,x,F);me&&cn>0&&(++G,he=v[G],(!he||!he.getStroke()||he.getFill()||he.getText())&&(he=new ps({stroke:new Pr}),v[G]=he),At=he.getStroke(),At.setLineCap(Ze($,"layout","line-cap",V,I,x,F)),At.setLineJoin(Ze($,"layout","line-join",V,I,x,F)),At.setMiterLimit(Ze($,"layout","line-miter-limit",V,I,x,F)),At.setColor(me),At.setWidth(cn),At.setLineDash(pe["line-dasharray"]?Ze($,"paint","line-dasharray",V,I,x,F).map(function(tn){return tn*cn}):null),he.setZIndex(hn))}let Sn=!1,rt=null,ci=0,Ki,Xn,Go;if((f==1||f==2)&&"icon-image"in le){const cn=Ze($,"layout","icon-image",V,I,x,F);if(cn){Ki=typeof cn=="string"?lx(cn,B):cn.toString();let tn;const Yt=a?a(e,Ki):void 0;if(c&&r&&r[Ki]||Yt){const Pn=Ze($,"layout","icon-rotation-alignment",V,I,x,F);if(f==2){const Pt=L.getGeometry();if(Pt.getFlatMidpoint||Pt.getFlatMidpoints){const qt=Pt.getExtent();if(Math.sqrt(Math.max(Math.pow((qt[2]-qt[0])/O,2),Math.pow((qt[3]-qt[1])/O,2)))>150){const Vn=Pt.getType()==="MultiLineString"?Pt.getFlatMidpoints():Pt.getFlatMidpoint();if(cx||(jg=[NaN,NaN],cx=new wU("Point",jg,[],2,{},void 0)),tn=cx,jg[0]=Vn[0],jg[1]=Vn[1],Ze($,"layout","symbol-placement",V,I,x,F)==="line"&&Pn==="map"){const Bi=Pt.getStride(),Fn=Pt.getFlatCoordinates();for(let li=0,vn=Fn.length-Bi;li<vn;li+=Bi){const fr=Fn[li],qr=Fn[li+1],zi=Fn[li+Bi],Ui=Fn[li+Bi+1],Ul=Math.min(fr,zi),gi=Math.min(qr,Ui),vc=Math.max(fr,zi),wb=Math.max(qr,Ui);if(Vn[0]>=Ul&&Vn[0]<=vc&&Vn[1]>=gi&&Vn[1]<=wb){ci=Math.atan2(qr-Ui,zi-fr);break}}}}}}if(f!==2||tn){const Pt=Ze($,"layout","icon-size",V,I,x,F),qt=pe["icon-color"]!==void 0?Ze($,"paint","icon-color",V,I,x,F):null;if(!qt||qt.a!==0){const Nn=Ze($,"paint","icon-halo-color",V,I,x,F),Vn=Ze($,"paint","icon-halo-width",V,I,x,F);let Zi=`${Ki}.${Pt}.${Vn}.${Nn}`;if(qt!==null&&(Zi+=`.${qt}`),Xn=_[Zi],!Xn){const Bi=yR($,V,I,"icon",x);let Fn;"icon-offset"in le&&(Fn=Ze($,"layout","icon-offset",V,I,x,F).slice(0),Fn[0]*=Pt,Fn[1]*=-Pt);let li=qt?[qt.r*255,qt.g*255,qt.b*255,qt.a]:void 0;if(Yt){const vn={color:li,rotateWithView:Pn==="map",displacement:Fn,declutterMode:Bi,scale:Pt};typeof Yt=="string"?vn.src=Yt:(vn.img=Yt,vn.imgSize=[Yt.width,Yt.height]),Xn=new rS(vn)}else{const vn=r[Ki];let fr,qr,zi;Vn?vn.sdf?(fr=mR(gR(c,vn,qt||[0,0,0,1]),{x:0,y:0,width:vn.width,height:vn.height,pixelRatio:vn.pixelRatio},Vn,Nn),li=void 0):fr=mR(c,vn,Vn,Nn):(vn.sdf?(h||(h=gR(c,{x:0,y:0,width:u[0],height:u[1]},{r:1,g:1,b:1,a:1})),fr=h):fr=c,qr=[vn.width,vn.height],zi=[vn.x,vn.y]),Xn=new rS({color:li,img:fr,imgSize:u,size:qr,offset:zi,rotateWithView:Pn==="map",scale:Pt/vn.pixelRatio,displacement:Fn,declutterMode:Bi})}_[Zi]=Xn}}Xn&&(++G,he=v[G],(!he||!he.getImage()||he.getFill()||he.getStroke())&&(he=new ps,v[G]=he),he.setGeometry(tn),Xn.setRotation(ci+sx(Ze($,"layout","icon-rotate",V,I,x,F))),Xn.setOpacity(Ze($,"paint","icon-opacity",V,I,x,F)),Xn.setAnchor(DEe[Ze($,"layout","icon-anchor",V,I,x,F)]),he.setImage(Xn),rt=he.getText(),he.setText(void 0),he.setZIndex(hn),Sn=!0,Go=!1)}else Go=!0}}}if(f==1&&$.type==="circle"){++G,he=v[G],(!he||!he.getImage()||he.getFill()||he.getStroke())&&(he=new ps,v[G]=he);const cn="circle-radius"in pe?Ze($,"paint","circle-radius",V,I,x,F):5,tn=ru(Ze($,"paint","circle-stroke-color",V,I,x,F),Ze($,"paint","circle-stroke-opacity",V,I,x,F)),Yt=Ze($,"paint","circle-translate",V,I,x,F),Pn=ru(Ze($,"paint","circle-color",V,I,x,F),Ze($,"paint","circle-opacity",V,I,x,F)),Pt=Ze($,"paint","circle-stroke-width",V,I,x,F),qt=cn+"."+tn+"."+Pn+"."+Pt+"."+Yt[0]+"."+Yt[1];Xn=_[qt],Xn||(Xn=new pp({radius:cn,displacement:[Yt[0],-Yt[1]],stroke:tn&&Pt>0?new Pr({width:Pt,color:tn}):void 0,fill:Pn?new Ws({color:Pn}):void 0,declutterMode:"none"}),_[qt]=Xn),he.setImage(Xn),rt=he.getText(),he.setText(void 0),he.setGeometry(void 0),he.setZIndex(hn),Sn=!0}let ni,Ho,Sc,uo,Bl,zl;if("text-field"in le){uo=Math.round(Ze($,"layout","text-size",V,I,x,F));const cn=Ze($,"layout","text-font",V,I,x,F);Sc=Ze($,"layout","text-line-height",V,I,x,F),Ho=LE(o?o(cn,t.metadata?t.metadata["ol:webfonts"]:void 0):cn,uo,Sc),Ho.includes("sans-serif")||(Ho+=",sans-serif"),Bl=Ze($,"layout","text-letter-spacing",V,I,x,F),zl=Ze($,"layout","text-max-width",V,I,x,F);const tn=Ze($,"layout","text-field",V,I,x,F);typeof tn=="object"&&tn.sections?tn.sections.length===1?ni=tn.toString():ni=tn.sections.reduce((Yt,Pn,Pt)=>{const qt=Pn.fontStack?Pn.fontStack.split(","):cn,Nn=LE(o?o(qt):qt,uo*(Pn.scale||1),Sc);let Vn=Pn.text;if(Vn===`
`)return Yt.push(`
`,""),Yt;if(f==2){Yt.push(PE(Vn,Bl),Nn);return}Vn=NE(Vn,Nn,zl,Bl).split(`
`);for(let Zi=0,Bi=Vn.length;Zi<Bi;++Zi)Zi>0&&Yt.push(`
`,""),Yt.push(Vn[Zi],Nn);return Yt},[]):ni=lx(tn,B).trim(),Pe=Ze($,"paint","text-opacity",V,I,x,F)}if(ni&&Pe&&!Go){Sn||(++G,he=v[G],(!he||!he.getText()||he.getFill()||he.getStroke())&&(he=new ps,v[G]=he),he.setImage(void 0),he.setGeometry(void 0));const cn=yR($,V,I,"text",x);he.getText()||he.setText(rt),rt=he.getText(),(!rt||"getDeclutterMode"in rt&&rt.getDeclutterMode()!==cn)&&(rt=new EU({padding:[2,2,2,2],declutterMode:cn}),he.setText(rt));const tn=Ze($,"layout","text-transform",V,I,x,F);tn=="uppercase"?ni=Array.isArray(ni)?ni.map((Ui,Ul)=>Ul%2?Ui:Ui.toUpperCase()):ni.toUpperCase():tn=="lowercase"&&(ni=Array.isArray(ni)?ni.map((Ui,Ul)=>Ul%2?Ui:Ui.toLowerCase()):ni.toLowerCase());const Yt=Array.isArray(ni)?ni:f==2?PE(ni,Bl):NE(ni,Ho,zl,Bl);rt.setText(Yt),rt.setFont(Ho),rt.setRotation(sx(Ze($,"layout","text-rotate",V,I,x,F)));const Pn=Ze($,"layout","text-anchor",V,I,x,F),Pt=Sn||f==1?"point":Ze($,"layout","symbol-placement",V,I,x,F);let qt;if(Pt==="line-center"?(rt.setPlacement("line"),qt="center"):rt.setPlacement(Pt),Pt==="line"&&typeof rt.setRepeat=="function"){const Ui=Ze($,"layout","symbol-spacing",V,I,x,F);rt.setRepeat(Ui*2)}rt.setOverflow(Pt==="point");let Nn=Ze($,"paint","text-halo-width",V,I,x,F);const Vn=Ze($,"layout","text-offset",V,I,x,F),Zi=Ze($,"paint","text-translate",V,I,x,F);let Bi=0,Fn=0;if(Pt=="point"){qt="center",Pn.indexOf("left")!==-1?(qt="left",Fn=Nn):Pn.indexOf("right")!==-1&&(qt="right",Fn=-Nn);const Ui=Ze($,"layout","text-rotation-alignment",V,I,x,F);rt.setRotateWithView(Ui=="map")}else rt.setMaxAngle(sx(Ze($,"layout","text-max-angle",V,I,x,F))*ni.length/Yt.length),rt.setRotateWithView(!1);rt.setTextAlign(qt);let li="middle";Pn.indexOf("bottom")==0?(li="bottom",Bi=-Nn-.5*(Sc-1)*uo):Pn.indexOf("top")==0&&(li="top",Bi=Nn+.5*(Sc-1)*uo),rt.setTextBaseline(li);const vn=Ze($,"layout","text-justify",V,I,x,F);rt.setJustify(vn==="auto"?void 0:vn),rt.setOffsetX(Vn[0]*uo+Fn+Zi[0]),rt.setOffsetY(Vn[1]*uo+Bi+Zi[1]),S.setColor(ru(Ze($,"paint","text-color",V,I,x,F),Pe)),rt.setFill(S);const fr=ru(Ze($,"paint","text-halo-color",V,I,x,F),Pe);if(fr&&Nn>0){w.setColor(fr),Nn*=2;const Ui=.5*uo;w.setWidth(Nn<=Ui?Nn:Ui),rt.setStroke(w)}else rt.setStroke(void 0);const qr=Ze($,"layout","text-padding",V,I,x,F),zi=rt.getPadding();qr!==zi[0]&&(zi[0]=qr,zi[1]=qr,zi[2]=qr,zi[3]=qr),he.setZIndex(hn)}}}if(G>-1)return v.length=G+1,v};return e.setStyle(D),e.set("mapbox-source",C),e.set("mapbox-layers",g),e.set("mapbox-featurestate",e.get("mapbox-featurestate")||{}),D}function BEe(e,t=512){return e.getExtent()?Oy({extent:e.getExtent(),tileSize:t,maxZoom:22}).getResolutions():MA}function zEe(e,t){return t.accessToken||(t=Object.assign({},t),new URL(e).searchParams.forEach((i,r)=>{t.accessToken=i,t.accessTokenParam=r})),t}function UEe(e,t,n="",i={},r=void 0){let s,o,a,c,u=!0;return typeof n!="string"&&!Array.isArray(n)?(a=n,c=a.source||a.layers,i=a):c=n,typeof i=="string"?(s=i,a={}):(s=i.styleUrl,a=i),a.updateSource===!1&&(u=!1),r||(r=a.resolutions),!s&&typeof t=="string"&&!t.trim().startsWith("{")&&(s=t),s&&(s=s.startsWith("data:")?location.href:U3(s,a.accessToken),a=zEe(s,a)),new Promise(function(h,d){EEe(t,a).then(function(p){if(p.version!=8)return d(new Error("glStyle version 8 required."));if(!(e instanceof du||e instanceof qg))return d(new Error("Can only apply to VectorLayer or VectorTileLayer"));const g=e instanceof qg?"vector":"geojson";if(c?Array.isArray(c)?o=p.layers.find(function(S){return S.id===c[0]}).source:o=c:(o=Object.keys(p.sources).find(function(S){return p.sources[S].type===g}),c=o),!o)return d(new Error(`No ${g} source found in the glStyle.`));function _(){if(!u)return Promise.resolve();if(e instanceof qg)return VEe(p.sources[o],s,a).then(function(L){const O=e.getSource();O?L!==O&&(O.setTileUrlFunction(L.getTileUrlFunction()),typeof O.setUrls=="function"&&typeof L.getUrls=="function"&&O.setUrls(L.getUrls()),O.format_||(O.format_=L.format_),O.getAttributions()||O.setAttributions(L.getAttributions()),O.getTileLoadFunction()===a3&&O.setTileLoadFunction(L.getTileLoadFunction()),Wg(O.getProjection(),L.getProjection())&&(O.tileGrid=L.getTileGrid())):e.setSource(L);const N=e.getSource().getTileGrid();!isFinite(e.getMaxResolution())&&!isFinite(e.getMinZoom())&&N.getMinZoom()>0&&e.setMaxResolution(xEe(Math.max(0,N.getMinZoom()-1e-12),N.getResolutions()))});const S=p.sources[o];let v=e.getSource();(!v||v.get("mapbox-source")!==S)&&(v=HEe(S,s,a));const D=e.getSource();return D?v!==D&&(D.getAttributions()||D.setAttributions(v.getAttributions()),D.format_||(D.format_=v.getFormat()),D.url_=v.getUrl()):e.setSource(v),Promise.resolve()}let b,x,E,C;function w(){if(!C&&(!p.sprite||x)){if(a.projection&&!r){const v=Er(a.projection).getUnits();v!=="m"&&(r=MA.map(D=>D/jE[v]))}C=FEe(e,p,c,r,x,E,(S,v=a.webfonts)=>OEe(S,v),a.getImage),e.getStyle()?_().then(h).catch(d):d(new Error(`Nothing to show for source [${o}]`))}else C?(e.setStyle(C),_().then(h).catch(d)):d(new Error("Something went wrong trying to apply style."))}if(p.sprite){const S=new URL(mEe(p.sprite,a.accessToken,s||location.href));b=window.devicePixelRatio>=1.5?.5:1;const v=b==.5?"@2x":"";let D=S.origin+S.pathname+v+".json"+S.search;new Promise(function(L,O){_h("Sprite",D,a).then(L).catch(function(N){D=S.origin+S.pathname+".json"+S.search,_h("Sprite",D,a).then(L).catch(O)})}).then(function(L){if(L===void 0&&d(new Error("No sprites found.")),x=L,E=S.origin+S.pathname+v+".png"+S.search,a.transformRequest){const O=a.transformRequest(E,"SpriteImage")||E;(O instanceof Request||O instanceof Promise)&&(E=O)}w()}).catch(function(L){d(new Error(`Sprites cannot be loaded: ${D}: ${L.message}`))})}else w()}).catch(d)})}function kEe(e,t){const n=e.bounds;if(n){const i=sS([n[0],n[1]],t),r=sS([n[2],n[3]],t);return[i[0],i[1],r[0],r[1]]}return Er(t).getExtent()}function jEe(e,t,n){const i=new LTe({tileJSON:t,tileSize:e.tileSize||t.tileSize||512}),r=i.getTileJSON(),s=i.getTileGrid(),o=Er(n.projection||"EPSG:3857"),a=kEe(r,o),c=o.getExtent(),u=r.minzoom||0,h=r.maxzoom||22,d={attributions:i.getAttributions(),projection:o,tileGrid:new WE({origin:c?CU(c):s.getOrigin(0),extent:a||s.getExtent(),minZoom:u,resolutions:BEe(o,t.tileSize).slice(0,h+1),tileSize:s.getTileSize(0)})};return Array.isArray(r.tiles)?d.urls=r.tiles:d.url=r.tiles,d}function VEe(e,t,n){return new Promise(function(i,r){CEe(e,t,n).then(function({tileJson:s,tileLoadFunction:o}){const a=jEe(e,s,n);a.tileLoadFunction=o,a.format=new bU,i(new PTe(a))}).catch(r)})}function GEe(e){return`{bbox-${(e?e.getCode():"EPSG:3857").toLowerCase().replace(/[^a-z0-9]/g,"-")}}`}function HEe(e,t,n){const i=n.projection?new dx({dataProjection:n.projection}):new dx,r=e.data,s={};if(typeof r=="string"){const a=y_(r,n.accessToken,n.accessTokenParam||"access_token",t||location.href);if(/\{bbox-[0-9a-z-]+\}/.test(a)){const u=(d,p,g)=>{const _=GEe(g);return a.replace(_,`${d.join(",")}`)},h=new $a({attributions:e.attribution,format:i,loader:(d,p,g,_,b)=>{const x=typeof u=="function"?u(d,p,g):u;_h("GeoJSON",x,n).then(E=>{const C=h.getFormat().readFeatures(E,{featureProjection:g});h.addFeatures(C),_(C)}).catch(E=>{h.removeLoadedExtent(d),b()})},strategy:TU});return h.set("mapbox-source",e),h}const c=new $a({attributions:e.attribution,format:i,url:a,loader:(u,h,d,p,g)=>{_h("GeoJSON",a,n).then(_=>{const b=c.getFormat().readFeatures(_,{featureProjection:d});c.addFeatures(b),p(b)}).catch(_=>{c.removeLoadedExtent(u),g()})}});return c}s.features=i.readFeatures(r,{featureProjection:"EPSG:3857"});const o=new $a(Object.assign({attributions:e.attribution,format:i},s));return o.set("mapbox-source",e),o}class qEe{constructor(t){z(this,"map");z(this,"basemapLayers",[]);this.map=t}removeAllBasemapLayers(){this.basemapLayers.forEach(t=>{this.map.removeLayer(t)}),this.basemapLayers=[]}addBasemapLayer(t){const n=new qg({declutter:!0});UEe(n,t.style,t.source),this.basemapLayers.push(n),n.setZIndex(-5e3-t.order),this.map.getLayers().insertAt(0,n)}}class j3{constructor(t,n){z(this,"name");z(this,"url");z(this,"wfsSupport");z(this,"urlWfs");z(this,"type");z(this,"imageType");z(this,"aliases");this.name=t,this.url=n.url,this.wfsSupport=n.wfsSupport,this.urlWfs=n.urlWfs,this.type=n.type,this.imageType=n.imageType,this.aliases=this.initializeAliases(n)}getAliasKey(t,n){return`${t}-${n}`}initializeAliases(t){const n=new Map;if(t.attributes)for(const[i,r]of Object.entries(t.attributes))for(const[s,o]of Object.entries(r))o.alias&&n.set(this.getAliasKey(i,s),o.alias);return n}getAlias(t,n){const i=this.getAliasKey(t,n);return this.aliases.get(i)}get uniqueWmsQueryId(){return this.name+this.imageType}}class WEe{constructor(t){z(this,"map");z(this,"wmtsCapabilitiesByServer",{});z(this,"wmtsPromisesByServer",{});z(this,"wmtsAbortsByLayer",{});z(this,"wmtsLayers",{});z(this,"basemapLayers",{});this.map=t}get state(){return An.getInstance().state}removeAllBasemapLayers(){Object.values(this.basemapLayers).forEach(t=>{this.map.removeLayer(t.olayer)}),this.basemapLayers={}}addLayer(t){this.addLayerInternal(t,!1)}addBasemapLayer(t){this.addLayerInternal(t,!0)}async addLayerInternal(t,n){console.debug(`Adding WMTS Layer ${t.name} : UniqueID=${t.layerUniqueId}`);const i=new AbortController;this.wmtsAbortsByLayer[t.layerUniqueId]=i;const r=await this.getWmtsCapabilities(t.url);if(i.signal.aborted){console.debug(`Aborting WMTS Layer ${t.name} : UniqueID=${t.layerUniqueId}`);return}delete this.wmtsAbortsByLayer[t.layerUniqueId],console.debug(`Displaying WMTS Layer ${t.name} : UniqueID=${t.layerUniqueId}`);let s=t._olayer;if(!s){const a=AU(r,{layer:t.layer,projection:this.state.projection});if(a===null){console.warn("Cannot create WMTS layer for layer "+t.layer);return}for(const c in t.dimensions)c in a.dimensions?a.dimensions[c]=t.dimensions[c]:console.warn("A dimension "+c+" was defined for the WMTS layer "+t.layer+" but the server does not seem to accept it.");s=new E_({opacity:t.opacity,source:new SU(a)}),this.enrichWmtsLayerFromCapabilities(t,s,r),t._olayer=s}let o;n?(this.basemapLayers[t.layerUniqueId]={olayer:s,layerWmts:t},o=-5e3-t.order):(this.wmtsLayers[t.layerUniqueId]={olayer:s,layerWmts:t},o=-t.order),s.setZIndex(o),this.map.getLayers().getArray().includes(s)||this.map.addLayer(s)}refreshZIndexes(){for(const t of Object.values(this.wmtsLayers)){const n=-t.layerWmts.order;t.olayer.setZIndex(n)}}enrichWmtsLayerFromCapabilities(t,n,i){const s=((i==null?void 0:i.Contents).Layer??[]).find(o=>o.Identifier==t.layer);s?n.set("capabilitiesStyles",s.Style):console.warn("No matching layer name in wmts capabilities.")}removeLayer(t){if(console.debug(`Removal asked for WMTS Layer ${t.name} : UniqueID=${t.layerUniqueId}`),t.layerUniqueId in this.wmtsAbortsByLayer)console.debug(`Cancelling WMTS Layer ${t.name} : UniqueID=${t.layerUniqueId}`),this.wmtsAbortsByLayer[t.layerUniqueId].abort();else if(this.layerExists(t)){console.debug(`Removing WMTS Layer ${t.name} : UniqueID=${t.layerUniqueId}`);const n=this.wmtsLayers[t.layerUniqueId].olayer;delete this.wmtsLayers[t.layerUniqueId],this.map.removeLayer(n)}else throw new Error(`Cannot remove ${t.name}: it does not exist`)}layerExists(t){return t.layerUniqueId in this.wmtsLayers}getLayer(t){return this.layerExists(t)?this.wmtsLayers[t.layerUniqueId].olayer:null}changeOpacity(t,n){if(this.layerExists(t))this.wmtsLayers[t.layerUniqueId].olayer.setOpacity(n);else throw new Error("Cannot change opacity for this layer: it does not exist")}selectFeatures(t){const n=[];[...Object.values(this.basemapLayers),...Object.values(this.wmtsLayers)].forEach(r=>{const s=r.layerWmts,o=s.wmsLayers??s.queryLayers;if(!o||!s.ogcServer)return;const a=new j3(s.ogcServer.name,s.ogcServer),c=o.split(",").map(h=>new ji(0,h,0,a,{queryLayers:o,layers:o,queryable:!0})),u=new Hg({source:new zR({url:a.url,params:{LAYERS:o}})});n.push(new gh(a,c,t,this.state.projection,u))}),An.getInstance().state.selection.selectionParameters.push(...n)}async getWmtsCapabilities(t){if(t in this.wmtsPromisesByServer)return this.wmtsPromisesByServer[t];if(t in this.wmtsCapabilitiesByServer){const n=this.wmtsCapabilitiesByServer[t];return Promise.resolve(n)}return this.wmtsPromisesByServer[t]=(async()=>{const i=await(await fetch(t)).text(),s=new vU().read(i);return this.wmtsCapabilitiesByServer[t]=s,s})(),this.wmtsPromisesByServer[t]}}class $Ee{constructor(t){z(this,"map");z(this,"configManager");z(this,"zoom",null);z(this,"resolution",null);z(this,"scale",null);z(this,"defaultSrid");z(this,"center");z(this,"extent");z(this,"scales");z(this,"allowedResolutions");z(this,"constrainScales");z(this,"constrainRotation");var n;this.map=t,this.configManager=fn.getInstance(),this.defaultSrid=this.configManager.getDefaultConfigValue("map.srid"),this.center=this.configManager.Config.map.startPosition.split(",").map(Number),this.state.position.zoom=Number(this.configManager.Config.map.startZoom),this.constrainScales=this.configManager.Config.map.constrainScales,this.constrainRotation=this.configManager.Config.map.constrainRotation,this.extent=(n=this.configManager.Config.map.maxExtent)==null?void 0:n.split(",").map(Number),this.scales=this.configManager.Config.map.scales,this.allowedResolutions=this.scalesToResolutions(this.scales)}get state(){return An.getInstance().state}get projection(){return Er(this.state.projection)}scalesToResolutions(t){const n=new Array;return t.forEach(i=>{const r=this.scaleToResolution(i);n.push(r)}),n}scaleToResolution(t){const n=this.projection.getUnits();return t/Vs.METERS_PER_UNIT[n]/Vs.INCHES_PER_METER/Vs.SCREEN_DOTS_PER_INCH}getScale(){const t=this.projection.getUnits();return this.map.getView().getResolution()*Vs.METERS_PER_UNIT[t]*Vs.INCHES_PER_METER*Vs.SCREEN_DOTS_PER_INCH}getDefaultView(){return new oS({center:this.center,zoom:this.zoom??void 0,projection:this.defaultSrid,extent:this.extent,resolutions:this.allowedResolutions,constrainResolution:this.constrainScales,constrainRotation:this.constrainRotation})}getViewConvertedToSrid(t){const n=this.map.getView(),i=n.getProjection();if(i.getCode()===t)return n;const r=n.getResolution(),s=n.getCenter(),o=n.getRotation();this.center=Vd(s,i,this.projection);const a=i.getMetersPerUnit(),c=this.projection.getMetersPerUnit(),u=T_(i,1/a,s,"m")*a,h=T_(this.projection,1/c,this.center,"m")*c,d=r*u/h;this.allowedResolutions=this.scalesToResolutions(this.scales);const p=n.get("extent");let g;if(p){const b=Vd([p[0],p[1]],i,this.projection),x=Vd([p[2],p[3]],i,this.projection);g=[b[0],b[1],x[0],x[1]]}return new oS({center:this.center,resolution:d,rotation:o,projection:this.projection,resolutions:this.allowedResolutions,constrainResolution:this.constrainScales,constrainRotation:this.constrainRotation,extent:g})}setCenter(t){this.center=t,this.map.getView().setCenter(t)}setZoom(t){this.zoom=t,this.map.getView().setZoom(this.zoom),this.resolution=this.map.getView().getResolution()??null,this.scale=this.getScale()}setResolution(t){this.resolution=t,this.map.getView().setResolution(this.resolution),this.zoom=this.map.getView().getZoom()??null,this.scale=this.getScale()}setScale(t){this.scale=t,this.resolution=this.scaleToResolution(t),this.map.getView().setResolution(this.resolution),this.zoom=this.map.getView().getZoom()??null}}class XEe extends IU{constructor(t){const n=t.projection===void 0?"EPSG:3857":t.projection;let i=t.tileGrid;i===void 0&&n&&(i=Oy({extent:HE(n),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize})),super({cacheSize:.1,attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:n,tileGrid:i,state:t.state,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key}),this.gutter_=t.gutter!==void 0?t.gutter:0,this.tileSize_=t.tileSize?nl(t.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=t.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=t.bandCount===void 0?4:t.bandCount,this.tileGridForProjection_={},this.crossOrigin_=t.crossOrigin||"anonymous"}setTileSizes(t){this.tileSizes_=t}getTileSize(t){if(this.tileSizes_)return this.tileSizes_[t];if(this.tileSize_)return this.tileSize_;const n=this.getTileGrid();return n?nl(n.getTileSize(t)):[256,256]}getGutterForProjection(t){const n=this.getProjection();return!n||Wg(n,t)?this.gutter_:0}setLoader(t){this.loader_=t}getReprojTile_(t,n,i,r,s){const o=this.getTileGrid(),a=Math.max.apply(null,o.getResolutions().map((_,b)=>{const x=nl(o.getTileSize(b)),E=this.getTileSize(b);return Math.max(E[0]/x[0],E[1]/x[1])})),c=this.getTileGridForProjection(s),u=this.getTileGridForProjection(r),h=[t,n,i],d=this.getTileCoordForTileUrlFunction(h,r),p=Object.assign({sourceProj:s,sourceTileGrid:c,targetProj:r,targetTileGrid:u,tileCoord:h,wrappedTileCoord:d,pixelRatio:a,gutter:this.getGutterForProjection(s),getTileFunction:(_,b,x,E)=>this.getTile(_,b,x,E,s)},this.tileOptions),g=new GE(p);return g.key=this.getKey(),g}getTile(t,n,i,r,s){const o=this.getProjection();if(o&&s&&!Wg(o,s))return this.getReprojTile_(t,n,i,s,o);const a=this.getTileSize(t),c=this.loader_,u=new AbortController,h={signal:u.signal,crossOrigin:this.crossOrigin_},d=this.getTileCoordForTileUrlFunction([t,n,i]);if(!d)return null;const p=d[0],g=d[1],_=d[2];function b(){return dp(function(){return c(p,g,_,h)})}const x=Object.assign({tileCoord:[t,n,i],loader:b,size:a,controller:u},this.tileOptions),E=new LR(x);return E.key=this.getKey(),E.addEventListener($s.CHANGE,this.handleTileChange_),E}handleTileChange_(t){const n=t.target,i=is(n),r=n.getState();let s;r==gn.LOADING?(this.tileLoadingKeys_[i]=!0,s=Ob.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],s=r==gn.ERROR?Ob.TILELOADERROR:r==gn.LOADED?Ob.TILELOADEND:void 0),s&&this.dispatchEvent(new OU(s,n))}getTileGridForProjection(t){const n=this.getProjection();if(this.tileGrid&&(!n||Wg(n,t)))return this.tileGrid;const i=is(t);return i in this.tileGridForProjection_||(this.tileGridForProjection_[i]=RU(t)),this.tileGridForProjection_[i]}setTileGridForProjection(t,n){const i=Er(t);if(i){const r=is(i);r in this.tileGridForProjection_||(this.tileGridForProjection_[r]=n)}}}function YEe(e){return((e.fileDirectory.NewSubfileType||0)&4)===4}function KEe(e,t){if(!e)return!1;if(e===!0)return!0;if(t.getSamplesPerPixel()!==3)return!1;const n=t.fileDirectory.PhotometricInterpretation,i=Xr;return n===i.CMYK||n===i.YCbCr||n===i.CIELab||n===i.ICCLab}const bR="STATISTICS_MAXIMUM",TR="STATISTICS_MINIMUM",ux=256;let fx;function ZEe(){return fx||(fx=new P8),fx}function JEe(e){try{return e.getBoundingBox()}catch{return[0,0,e.getWidth(),e.getHeight()]}}function QEe(e){try{return e.getOrigin().slice(0,2)}catch{return[0,e.getHeight()]}}function eCe(e,t){try{return e.getResolution(t)}catch{return[t.getWidth()/e.getWidth(),t.getHeight()/e.getHeight()]}}function tCe(e){const t=e.geoKeys;if(!t)return null;if(t.ProjectedCSTypeGeoKey&&t.ProjectedCSTypeGeoKey!==32767){const n="EPSG:"+t.ProjectedCSTypeGeoKey;let i=Er(n);if(!i){const r=cS(t.ProjLinearUnitsGeoKey);r&&(i=new px({code:n,units:r}))}return i}if(t.GeographicTypeGeoKey&&t.GeographicTypeGeoKey!==32767){const n="EPSG:"+t.GeographicTypeGeoKey;let i=Er(n);if(!i){const r=cS(t.GeogAngularUnitsGeoKey);r&&(i=new px({code:n,units:r}))}return i}return null}function nCe(e){return e.getImageCount().then(function(t){const n=new Array(t);for(let i=0;i<t;++i)n[i]=e.getImage(i);return Promise.all(n)})}function iCe(e,t){let n;return e.blob?n=oj(e.blob):e.overviews?n=aj(e.url,e.overviews,t):n=sj(e.url,t),n.then(nCe)}function jd(e,t,n,i,r){if(Array.isArray(e)){const s=e.length;if(!Array.isArray(t)||s!=t.length){const o=new Error(i);throw r(o),o}for(let o=0;o<s;++o)jd(e[o],t[o],n,i,r);return}if(t=t,Math.abs(e-t)>n*e)throw new Error(i)}function rCe(e){return e instanceof Int8Array?-128:e instanceof Int16Array?-32768:e instanceof Int32Array?-2147483648:e instanceof Float32Array?12e-39:0}function sCe(e){return e instanceof Int8Array?127:e instanceof Uint8Array||e instanceof Uint8ClampedArray?255:e instanceof Int16Array?32767:e instanceof Uint16Array?65535:e instanceof Int32Array?2147483647:e instanceof Uint32Array?4294967295:e instanceof Float32Array?34e37:255}class BE extends XEe{constructor(t){super({state:"loading",tileGrid:null,projection:t.projection||null,transition:t.transition,interpolate:t.interpolate!==!1,wrapX:t.wrapX}),this.sourceInfo_=t.sources;const n=this.sourceInfo_.length;this.sourceOptions_=t.sourceOptions,this.sourceImagery_=new Array(n),this.sourceMasks_=new Array(n),this.resolutionFactors_=new Array(n),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=t.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=t.convertToRGB||!1,this.setKey(this.sourceInfo_.map(s=>s.url).join(","));const i=this,r=new Array(n);for(let s=0;s<n;++s)r[s]=iCe(this.sourceInfo_[s],this.sourceOptions_);Promise.all(r).then(function(s){i.configure_(s)}).catch(function(s){aS(s),i.error_=s,i.setState("error")})}getError(){return this.error_}determineProjection(t){const n=t[0];for(let i=n.length-1;i>=0;--i){const r=n[i],s=tCe(r);if(s){this.projection=s;break}}}configure_(t){let n,i,r,s,o;const a=new Array(t.length),c=new Array(t.length),u=new Array(t.length);let h=0;const d=t.length;for(let b=0;b<d;++b){const x=[],E=[];t[b].forEach(O=>{YEe(O)?E.push(O):x.push(O)});const C=x.length;if(E.length>0&&E.length!==C)throw new Error(`Expected one mask per image found ${E.length} masks and ${C} images`);let w,S;const v=new Array(C),D=new Array(C),L=new Array(C);c[b]=new Array(C),u[b]=new Array(C);for(let O=0;O<C;++O){const N=x[O],B=N.getGDALNoData();u[b][O]=N.getGDALMetadata(0),c[b][O]=B;const U=this.sourceInfo_[b].bands;a[b]=U?U.length:N.getSamplesPerPixel();const V=C-(O+1);w||(w=JEe(N)),S||(S=QEe(N));const f=eCe(N,x[0]);L[V]=f[0];const I=[N.getTileWidth(),N.getTileHeight()];I[0]!==I[1]&&I[1]<ux&&(I[0]=ux,I[1]=ux),v[V]=I;const F=f[0]/Math.abs(f[1]);D[V]=[I[0],I[1]/F]}if(n?hp(n,w,n):n=w,!i)i=S;else{const O=`Origin mismatch for source ${b}, got [${S}] but expected [${i}]`;jd(i,S,0,O,this.viewRejector)}if(!o)o=L,this.resolutionFactors_[b]=1;else{o.length-h>L.length&&(h=o.length-L.length);const O=o[o.length-1]/L[L.length-1];this.resolutionFactors_[b]=O;const N=L.map(U=>U*=O),B=`Resolution mismatch for source ${b}, got [${N}] but expected [${o}]`;jd(o.slice(h,o.length),N,.02,B,this.viewRejector)}r?jd(r.slice(h,r.length),D,.01,`Tile size mismatch for source ${b}`,this.viewRejector):r=D,s?jd(s.slice(h,s.length),v,0,`Tile size mismatch for source ${b}`,this.viewRejector):s=v,this.sourceImagery_[b]=x.reverse(),this.sourceMasks_[b]=E.reverse()}for(let b=0,x=this.sourceImagery_.length;b<x;++b){const E=this.sourceImagery_[b];for(;E.length<o.length;)E.unshift(void 0)}this.getProjection()||this.determineProjection(t),this.samplesPerPixel_=a,this.nodataValues_=c,this.metadata_=u;e:for(let b=0;b<d;++b){if(this.sourceInfo_[b].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[b].length){this.addAlpha_=!0;break}const x=c[b],E=this.sourceInfo_[b].bands;if(E){for(let C=0;C<E.length;++C)if(x[E[C]-1]!==null){this.addAlpha_=!0;break e}continue}for(let C=0;C<x.length;++C)if(x[C]!==null){this.addAlpha_=!0;break e}}let p=this.addAlpha_?1:0;for(let b=0;b<d;++b)p+=a[b];this.bandCount=p;const g=new WE({extent:n,minZoom:h,origin:i,resolutions:o,tileSizes:r});this.tileGrid=g,this.setTileSizes(s),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const _=1;o.length===2?o=[o[0],o[1],o[1]/2]:o.length===1&&(o=[o[0]*2,o[0],o[0]/2]),this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:o,center:DU(MU(n),this.projection),extent:LU(n,this.projection),zoom:_})}loadTile_(t,n,i,r){const s=this.getTileSize(t),o=this.sourceImagery_.length,a=new Array(o*2),c=this.nodataValues_,u=this.sourceInfo_,h=ZEe();for(let d=0;d<o;++d){const p=u[d],g=this.resolutionFactors_[d],_=[Math.round(n*(s[0]*g)),Math.round(i*(s[1]*g)),Math.round((n+1)*(s[0]*g)),Math.round((i+1)*(s[1]*g))],b=this.sourceImagery_[d][t];let x;p.bands&&(x=p.bands.map(function(v){return v-1}));let E;"nodata"in p&&p.nodata!==null?E=p.nodata:x?E=x.map(function(v){return c[d][v]}):E=c[d];const C={window:_,width:s[0],height:s[1],samples:x,fillValue:E,pool:h,interleave:!1,signal:r.signal};KEe(this.convertToRGB_,b)?a[d]=b.readRGB(C):a[d]=b.readRasters(C);const w=o+d,S=this.sourceMasks_[d][t];if(!S){a[w]=Promise.resolve(null);continue}a[w]=S.readRasters({window:_,width:s[0],height:s[1],samples:[0],pool:h,interleave:!1})}return Promise.all(a).then(this.composeTile_.bind(this,s)).catch(function(d){throw aS(d),d})}composeTile_(t,n){const i=this.metadata_,r=this.sourceInfo_,s=this.sourceImagery_.length,o=this.bandCount,a=this.samplesPerPixel_,c=this.nodataValues_,u=this.normalize_,h=this.addAlpha_,d=t[0]*t[1],p=d*o;let g;u?g=new Uint8Array(p):g=new Float32Array(p);let _=0;for(let b=0;b<d;++b){let x=h;for(let E=0;E<s;++E){const C=r[E];let w=C.min,S=C.max,v,D;if(u){const L=i[E][0];w===void 0&&(L&&TR in L?w=parseFloat(L[TR]):w=rCe(n[E][0])),S===void 0&&(L&&bR in L?S=parseFloat(L[bR]):S=sCe(n[E][0])),v=255/(S-w),D=-w*v}for(let L=0;L<a[E];++L){const O=n[E][L][b];let N;if(u?N=PU(v*O+D,0,255):N=O,!h)g[_]=N;else{let B=C.nodata;if(B===void 0){let V;C.bands?V=C.bands[L]-1:V=L,B=c[E][V]}const U=isNaN(B);(!U&&O!==B||U&&!isNaN(O))&&(x=!1,g[_]=N)}_++}if(!x){const L=s+E,O=n[L];O&&!O[0][b]&&(x=!0)}}h&&(x||(g[_]=255),_++)}return g}}BE.prototype.getView;class oCe{constructor(t){z(this,"map");z(this,"name");z(this,"supportedFileFormats",[NU,dx,FU,new BU({extractStyles:!0}),zU]);z(this,"supportedFileExtensions",["gpx","geojson","igc","kml","topojson","json"]);z(this,"stateManager");z(this,"i18nManager");z(this,"userInteractionManager");z(this,"activeLayers",{});z(this,"layerGroup");z(this,"layerGroupProxy");this.map=t,this.name=`localFileManager-${wu()}`,this.stateManager=An.getInstance(),this.i18nManager=Jf.getInstance(),this.userInteractionManager=hD.getInstance(),this.registerEvents();const n=this.createInteraction();this.map.addInteraction(n)}registerEvents(){this.userInteractionManager.registerListener("map.drop",!1,this.name),this.stateManager.subscribe("layers.layersList",(t,n)=>{t!=null&&t.includes(this.layerGroup)&&!(n!=null&&n.includes(this.layerGroup))&&(delete this.layerGroupProxy,delete this.layerGroup)})}createInteraction(){this.map.getViewport().addEventListener("drop",n=>this.handleUnsupportedFiles(n));const t=new J5({formatConstructors:this.supportedFileFormats});return t.on("addfeatures",n=>{if(!this.userInteractionManager.canListenerExecute("map.drop",this.name))return;this.layerGroup||(this.layerGroup=new ln(0,"Local Files",0,{isDefaultChecked:!0,isDefaultExpanded:!0}));const i=n.file.name.replace(".","_"),r=this.validateAndCompleteFeatures(i,n.features),s=new hy(n.file,r.features,r.globalExtent);s.parent=this.layerGroup,n.features&&n.features.length>r.features.length&&(s.hasError=!0,s.errorMessage=`Only ${r.features.length} features among ${n.features.length} could be loaded.
        Verify that those features can be displayed within the maximal extent configured in your application.`),this.layerGroupProxy?this.layerGroupProxy.children.push(s):(this.layerGroup.children.push(s),this.stateManager.state.layers.layersList.push(this.layerGroup),this.layerGroupProxy=this.stateManager.state.layers.layersList.find(o=>o.treeItemId===this.layerGroup.treeItemId))}),t}handleUnsupportedFiles(t){var s;if(!this.userInteractionManager.canListenerExecute("map.drop",this.name))return;const n=(s=t.dataTransfer)==null?void 0:s.files;if(!(n!=null&&n.length))return;const i=Array.from(n).filter(o=>!this.supportedFileExtensions.includes(o.name.split(".").slice(-1)[0].toLowerCase()));if(!(i!=null&&i.length))return;let r;i.length>1?(r=this.i18nManager.getTranslation("Files _fileNames_ are not supported"),r=r.replace("_fileNames_",i.map(o=>`"${o.name}"`).join(", "))):(r=this.i18nManager.getTranslation("File _fileName_ is not supported"),r=r.replace("_fileName_",`"${i[0].name}"`)),window.gAlert(r,"Unsupported file format")}validateAndCompleteFeatures(t,n){const i=[],r=this.map.getView().get("extent");let s=0,o=null;for(const a of n){const c=a.getGeometry();if(c){const u=c.getExtent();qE(r,u)&&(a.setId(`${t}.${++s}`),i.push(a),o=o==null?[...u]:UU(o,u))}}return{features:i,globalExtent:o}}addLayer(t){const n=new $a({features:t._features}),i=new du({source:n});this.map.addLayer(i),this.activeLayers[t.treeItemId]={layerFile:t,olayer:i}}getLayer(t){return this.layerExists(t)?this.activeLayers[t.treeItemId].olayer:null}removeLayer(t){if(this.layerExists(t)){const n=this.activeLayers[t.treeItemId].olayer;delete this.activeLayers[t.treeItemId],this.map.removeLayer(n)}else throw new Error("Cannot remove this layer: it does not exist")}layerExists(t){return t.treeItemId in this.activeLayers}selectFeatures(t){var n;for(const i of Object.values(this.activeLayers)){const r=(n=i.olayer.getSource())==null?void 0:n.getFeaturesInExtent(t);r&&r.length>0&&(this.stateManager.state.selection.selectedFeatures.push(...r),this.stateManager.state.interface.selectionComponentVisible=!0)}}}class aCe{constructor(t){z(this,"map");z(this,"basemapLayers",[]);z(this,"activeLayers",{});this.map=t}removeAllBasemapLayers(){this.basemapLayers.forEach(t=>{this.map.removeLayer(t)}),this.basemapLayers=[]}addBasemapLayer(t){const n=new BE({sources:[{url:t.source}]}),i=new AE({source:n});this.basemapLayers.push(i),i.setZIndex(-5e3-t.order),this.map.addLayer(i)}addLayer(t){const n=new BE({sources:[{url:t.source}]}),i=new AE({source:n});this.map.addLayer(i),this.activeLayers[t.treeItemId]={layer:t,olayer:i}}removeLayer(t){const n=this.activeLayers[t.treeItemId].olayer;delete this.activeLayers[t.treeItemId],this.map.removeLayer(n)}}class pl extends Hi{constructor(n,i,r,s,o){let a=o??{};a=pl.isGMFTreeItem(a)?pl.getOptionsFromGMFTreeItem(a):a;super(n,i,r,a);z(this,"source");this.source=s}clone(){const n={isDefaultChecked:this.isDefaultChecked,metadataUrl:this.metadataUrl,disclaimer:this.disclaimer,opacity:this.opacity,protected:this.protected},i=new pl(this.id,this.name,this.order,this.source,n);return i.activeState=this.activeState,i}static isGMFTreeItem(n){return"id"in n}static getOptionsFromGMFTreeItem(n){var i,r,s,o;return{isDefaultChecked:(i=n.metadata)==null?void 0:i.isChecked,metadataUrl:(r=n.metadata)==null?void 0:r.metadataUrl,disclaimer:(s=n.metadata)==null?void 0:s.disclaimer,opacity:1,protected:(o=n.metadata)==null?void 0:o.protected}}}class ml extends Hi{constructor(n,i,r,s,o){let a=o??{};a=ml.isGMFTreeItem(a)?ml.getOptionsFromGMFTreeItem(a):a;super(n,i,r,a);z(this,"source");this.source=s}clone(){const n={isDefaultChecked:this.isDefaultChecked,metadataUrl:this.metadataUrl,disclaimer:this.disclaimer,opacity:this.opacity,protected:this.protected},i=new ml(this.id,this.name,this.order,this.source,n);return i.activeState=this.activeState,i}static isGMFTreeItem(n){return"id"in n}static getOptionsFromGMFTreeItem(n){var i,r,s,o;return{isDefaultChecked:(i=n.metadata)==null?void 0:i.isChecked,metadataUrl:(r=n.metadata)==null?void 0:r.metadataUrl,disclaimer:(s=n.metadata)==null?void 0:s.disclaimer,opacity:1,protected:(o=n.metadata)==null?void 0:o.protected}}}class V3{static get LayerOsmId(){return-1}static get LayerSwisstopoVectorTilesId(){return-2}}class Bp extends Hi{constructor(t){super(V3.LayerOsmId,"OpenStreetMap",t)}clone(){const t=new Bp(this.order);return t.activeState=this.activeState,t}}class yh extends Hi{constructor(n,i,r,s,o,a){super(n,i,r,a);z(this,"style");z(this,"source");z(this,"projection");this.style=s,this.source=o,this.projection=a==null?void 0:a.projection}clone(){const n={projection:this.projection,isDefaultChecked:this.isDefaultChecked,metadataUrl:this.metadataUrl,disclaimer:this.disclaimer,opacity:this.opacity,protected:this.protected},i=new yh(this.id,this.name,this.order,this.style,this.source,n);return i.activeState=this.activeState,i}}var G3=(e=>(e.CustomEventType="GeoGirafe.App",e.undoDraw="undoDraw",e.zoomToExtent="zoomToExtent",e))(G3||{});class Cy{constructor(){z(this,"flashDuration",2e3);z(this,"olMap");z(this,"configManager");z(this,"flashStyleCache",{});z(this,"focusLayer");z(this,"focusSource");z(this,"focusAnimation",null);z(this,"strokeColor");this.olMap=eC.getInstance().getMap(),this.configManager=fn.getInstance(),this.configManager.loadConfig().then(()=>{this.createFocusLayer()})}setFocusedFeatures(t){this.flash(t)}createFocusLayer(){this.focusSource=new $a,this.focusLayer=new du({properties:{addToPrintedLayers:!0},source:this.focusSource}),this.setFocusLayerStyle(),this.olMap.addLayer(this.focusLayer),this.focusLayer.setZIndex(1004),this.focusLayer.set("altitudeMode","clampToGround")}setFocusLayerStyle(){const t=new ps({stroke:new Pr({color:this.configManager.Config.selection.highlightStrokeColor,width:this.configManager.Config.selection.defaultStrokeWidth}),fill:new Ws({color:this.configManager.Config.selection.highlightFillColor}),image:new pp({radius:7,fill:new Ws({color:this.configManager.Config.selection.highlightFillColor}),stroke:new Pr({color:this.configManager.Config.selection.highlightStrokeColor,width:this.configManager.Config.selection.defaultStrokeWidth})})});this.focusLayer.setStyle(t)}flash(t){var i,r;if((i=this.focusSource)==null||i.clear(),this.focusAnimation!==null&&OR(this.focusAnimation),!t||!this.focusLayer)return;const n=t.map(s=>s.getGeometry()).filter(s=>s);n.length&&((r=this.focusSource)==null||r.addFeatures(t),this.setFocusLayerStyle(),this.strokeColor=X5(this.configManager.Config.selection.highlightStrokeColor)||[255,0,0,1],this.focusAnimation=this.focusLayer.on("postrender",s=>{n.forEach(o=>{const a=o.clone();this.animate(s,a)}),this.focusLayer.changed()}))}animate(t,n){const i=kU(t);i.setStyle(this.getFlashStyleCache(t.frameState)),i.drawGeometry(n)}getFlashStyleCache(t){const n=Cy.getFlashDynamicValues((t==null?void 0:t.time)??0,this.flashDuration),i=n.join("-"),r=this.flashStyleCache[i];if(r)return r;const s=Cy.createFlashStyle(n,this.strokeColor);return this.flashStyleCache[i]=s,s}static createFlashStyle(t,n){const[i,r,s]=t;return new ps({image:new pp({radius:i,stroke:new Pr({color:lS([...n.slice(0,3),r]),width:4*r})}),stroke:new Pr({color:lS(n),width:12,lineDash:[16,32],lineDashOffset:s})})}static getFlashDynamicValues(t,n){const i=t,r=i%n/n,s=Math.round(r*1e3)/1e3,o=uS(s)*25+5,a=uS(1-s),c=Math.floor(i/100)%48;return[o,a,c]}}class cCe{constructor(t){z(this,"map");z(this,"basemapLayers",[]);z(this,"activeLayers",{});this.map=t}removeAllBasemapLayers(){this.basemapLayers.forEach(t=>{this.map.removeLayer(t)}),this.basemapLayers=[]}addBasemapLayer(t){const n=new fS({url:t.source}),i=new E_({source:n});this.basemapLayers.push(i),i.setZIndex(-5e3-t.order),this.map.addLayer(i)}addLayer(t){const n=new fS({url:t.source}),i=new E_({source:n});this.map.addLayer(i),this.activeLayers[t.treeItemId]={layer:t,olayer:i}}removeLayer(t){const n=this.activeLayers[t.treeItemId].olayer;delete this.activeLayers[t.treeItemId],this.map.removeLayer(n)}}function lCe(e,t){let n=null;return function(...i){const r=()=>{n=null,e.apply(this,i)};n!==null&&clearTimeout(n),n=window.setTimeout(r,t)}}class uCe{constructor(t,n){z(this,"name");z(this,"url");z(this,"layers",{});z(this,"featureTypeToGeometryColumnName",{});z(this,"initialized");this.name=t,this.url=n,this.initialized=!1}addLayerAttribute(t,n,i){t in this.layers||(this.layers[t]=[]),this.layers[t].push({name:n,type:i})}getGeometryColumnNameToFeatureTypes(t){if(!this.initialized)throw new Error("Initialize WFS server before trying to get geometry column names.");const n={};for(const i of t){i in this.layers||console.warn("featureType "+i+" is unknown to WFS server "+this.url+`
- available featureTypes: `+Object.keys(this.layers).join(", "));const r=this.featureTypeToGeometryColumnName[i];r in n||(n[r]=[]),n[r].push(i)}return n}}const H3=["byte","decimal","int","integer","long","negativeInteger","nonNegativeInteger","nonPositiveInteger","positiveInteger","short","unsignedLong","unsignedInt","unsignedShort","unsignedByte","double"],q3=["string"],W3=["date","dateTime"],fCe=[...H3,...q3,...W3];function tAe(e){return e.trim().length>0&&!isNaN(Number(e))}function nAe(e){return q3.includes(e)}function iAe(e){return H3.includes(e)}function rAe(e){return W3.includes(e)}var Iy,X3;class $3{constructor(t,n){fo(this,Iy);z(this,"stateManager");z(this,"ogcServer");z(this,"maxFeatures",300);z(this,"featurePrefix");z(this,"featureNS");z(this,"urlParameters",new URLSearchParams);z(this,"serverWfs");this.ogcServer=t,this.featureNS=n.featureNS,this.featurePrefix=n.featurePrefix,this.configMaxFeatures(),this.stateManager=An.getInstance()}get state(){return this.stateManager.state}get wfsUrl(){return this.ogcServer.urlWfs??""}configMaxFeatures(){fn.getInstance().loadConfig().then(t=>{this.maxFeatures=t.selection.maxFeature??this.maxFeatures})}getServerWfs(){return this.describeFeatureType()}describeFeatureType(){return this.serverWfs||(this.serverWfs=ki(this,Iy,X3).call(this),this.serverWfs.catch(t=>{const n="WFS server with URL "+this.wfsUrl+" could not be initialized.";console.error(n+" Error:",t),this.serverWfs=void 0})),this.serverWfs}initializeAttribute(t,n,i){const r=t.getAttribute("name");if(!r)throw new Error("Could not find a name for the complex type");const s=i[r],o=t.getElementsByTagName("sequence")[0].getElementsByTagName("element");let a=!1;for(const c of o)this.manageLayerAttribute(n,c,s)&&(a=!0);if(!a)throw new Error("No Geometry column for the type "+s)}manageLayerAttribute(t,n,i){let r=!1;const s=n.getAttribute("type");if(s!=null&&s.startsWith("gml:")){const o=n.getAttribute("name");if(o)t.featureTypeToGeometryColumnName[i]=o,r=!0;else throw new Error("Why is geometryAttributeName null here ?")}else{const o=n.getAttribute("name"),a=n.getAttribute("type");!o||!a?console.warn(`Error while loading attribute for layer ${i}. Querying or filtering this layer won't work correctly.`):this.validateLayerAttributeType(a)?t.addLayerAttribute(i,o,a):console.warn(`Unmanaged layer attribute type: ${a} for attribute ${o} of featureType ${i}. ${o} ignored.`)}return r}validateLayerAttributeType(t){return fCe.includes(t)}getElementToTypeName(t){const n={},i=t.querySelectorAll(":scope>element");for(const r of i)if(r.hasAttribute("name")&&r.hasAttribute("type")){const s=r.getAttribute("name");let o=r.getAttribute("type");o&&s&&(o.includes(":")&&(o=o.split(":")[1]),n[o]=s)}else console.log("What happend with this element? element",r);return n}getDescribeFeatureTypeUrl(){const t=new URL(this.wfsUrl);return t.searchParams.set("service","WFS"),t.searchParams.set("request","DescribeFeatureType"),t.searchParams.set("version","1.1.0"),t.href}async getFeature(t){var p;const n=t._layers.filter(g=>g.wfsQueryable&&g.isVisibleAtResolution(this.state.position.resolution));if(n.length<=0)return[];const i=await this.getServerWfs(),r=n.map(g=>g.queryLayers.split(",")).flat(1),s=i.getGeometryColumnNameToFeatureTypes(r),o=(p=n[0].filter)==null?void 0:p.toOpenLayersFilter(),a=this.setTimeRestriction(n[0]),c={srsName:t.srid,bbox:t.selectionBox,filter:o&&a?jU(o,a):o??a},u=Object.entries(s).map(async([g,_])=>this.getFeatureRaw(_,{geometryName:g,...c}));return(await Promise.all(u)).flat()}completeGetFeatureOptions(t,n){return{featurePrefix:this.featurePrefix,featureNS:this.featureNS,...n,featureTypes:t}}async getFeatureRaw(t,n){if(n.bbox&&!n.geometryName)throw new Error(`WFS GetFeature: not possible to query bbox ${n.bbox} without a geometryName.
FeatureTypes: ${t}
WFS: ${this.wfsUrl}`);const i=this.completeGetFeatureOptions(t,n);i.maxFeatures=i.maxFeatures?i.maxFeatures:this.maxFeatures;const r=new VU().writeGetFeature(i),s=new URL(this.wfsUrl);for(const[u,h]of this.urlParameters.entries())s.searchParams.set(u,h);const a=await(await fetch(s,{method:"POST",body:new XMLSerializer().serializeToString(r)})).text();return new GU().readFeatures(a)}setTimeRestriction(t){if(t.timeAttribute)return this.getTimeRestrictionFilter(t);this.addTimeRestrictionAsUrlParameter(t)}getTimeRestrictionFilter(t){if(t.timeRestriction&&t.timeAttribute)return new On(t.timeOptions).toOpenLayersWfsFilter(t.timeRestriction,t.timeAttribute)}addTimeRestrictionAsUrlParameter(t){t.timeRestriction?this.urlParameters.set("TIME",t.timeRestriction):this.urlParameters.has("TIME")&&this.urlParameters.delete("TIME")}}Iy=new WeakSet,X3=async function(){const t=new uCe("",this.wfsUrl),n=this.getDescribeFeatureTypeUrl(),r=await(await fetch(n)).text(),s=new DOMParser().parseFromString(r,"text/xml"),o=this.getElementToTypeName(s),a=s.getElementsByTagName("complexType");for(const c of a)this.initializeAttribute(c,t,o);return t.initialized=!0,t};class Y3 extends $3{constructor(t,n){super(t,{featurePrefix:"feature",featureNS:"https://mapserver.gis.umn.edu/mapserver",...n})}async getFeatureRaw(t,n){return console.debug("WFS CLIENT MAPSERVER getFeatureRaw() featureTypes:",t),super.getFeatureRaw(t,n)}}class K3 extends $3{constructor(t,n){super(t,{featurePrefix:"feature",featureNS:"https://www.qgis.org/gml",...n})}async getFeatureRaw(t,n){return console.debug("WFS CLIENT QGIS getFeatureRaw() featureTypes:",t),super.getFeatureRaw(t,n)}}const hCe=K3,dCe=Y3;class LA extends o3{constructor(n){super(n);z(this,"stateManager");this.stateManager=An.getInstance(),this.stateManager.subscribe(/layers\.layersList\..*\.filter/,(i,r)=>{this.onSelectedFeaturesFilterChange(r)}),this.stateManager.subscribe(/layers\.layersList\..*\.timeRestriction/,(i,r,s)=>{this.isFirstChildOfTimeAwareGroupOrIndependent(s)&&this.onSelectedFeaturesFilterChange(s.filter)}),this.registerClientClass("default",hCe),this.registerClientClass("geoserver",dCe),this.registerClientClass("mapserver",Y3),this.registerClientClass("qgisserver",K3)}get state(){return this.stateManager.state}getClientId(n){return n.urlWfs??""}async onSelectedFeaturesFilterChange(n){const r=this.state.selection.selectionParameters.map(u=>u.clone(h=>h.wfsQueryable&&h.filter===n)).filter(u=>u._layers.length>0),s=r.map(u=>u._layers.map(h=>h.queryLayers)).flat().join(";");if(r.length===0)return;this.state.loading=!0;const o=r.map(u=>this.getClient(u._ogcServer).getFeature(u)),a=(await Promise.all(o)).flat(),c=this.state.selection.selectedFeatures.filter(u=>{const h=u.getId(),d=h===void 0?"UNKNOWN":`${h}`.split(".")[0];return!s.includes(d)&&d!=="UNKNOWN"});c.push(...a),this.state.selection.selectedFeatures=c,this.state.interface.selectionComponentVisible=c.length!==0,this.state.loading=!1}isFirstChildOfTimeAwareGroupOrIndependent(n){if(n instanceof ji&&n.active){const i=n.parent;return i&&Ly(i)&&i.timeRestriction===n.timeRestriction?i.children.filter(r=>r.active)[0].id===n.id:!0}return!1}async getServerWfs(n){const i=n instanceof ji?n.ogcServer:n;return this.getClient(i).getServerWfs()}}class sAe extends b4{constructor(){super("map");z(this,"template",()=>gx`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style><style>
#container,#ol-map{background-color:var(--bkg-color);height:100%;width:100%}#ol-map.darkmap canvas{filter:invert(100%) hue-rotate(180deg)}.hidden{display:none}.center{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);margin:10px;text-align:center}.loading span{color:var(--text-color);display:block;margin-top:1rem;font-weight:600}.loading span.quote{font-style:italic;font-weight:300}#cs-map{background-color:var(--bkg-color);position:absolute;height:100%;overflow:hidden;display:none;border-left:solid 3px #444}.ol-zoom{right:2rem!important;top:2rem!important;left:unset!important}.ol-rotate{top:7rem!important;right:2rem!important}.ol-rotate-reset,.ol-zoom-in,.ol-zoom-out{width:2rem!important;height:2rem!important;cursor:pointer}.ol-scale-line{right:1rem!important;bottom:.5rem!important;left:unset!important}.ol-popup{position:absolute;background-color:var(--bkg-color);color:var(--text-color);box-shadow:0 1px 4px var(--bx-shdw);padding:15px;border-radius:10px;border:1px solid var(--text-color-grad1);bottom:12px;left:-50px;min-width:140px}.ol-popup:after,.ol-popup:before{top:100%;border:solid transparent;content:' ';height:0;width:0;position:absolute;pointer-events:none}.ol-popup:after{border-top-color:var(--bkg-color);border-width:10px;left:48px;margin-left:-10px}.ol-popup:before{border-top-color:var(--text-color-grad1);border-width:11px;left:48px;margin-left:-11px}.ol-popup-closer{text-decoration:none;position:absolute;top:2px;right:8px;background-color:var(--bkg-color);color:var(--text-color);cursor:pointer}.ol-popup-closer:after{content:'â'}#swiper{display:none;width:99%;position:absolute;left:.5%;top:50%;height:0}input[type=range]{-webkit-appearance:none;width:100%}input[type=range]::-webkit-slider-runnable-track{height:0}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;border:2px solid #444;height:0;margin-top:-1000px;padding-top:1000px;padding-bottom:1000px;width:6px;background:var(--bkg-color);cursor:ew-resize}input[type=range]::-moz-range-thumb{border:2px solid #444;height:0;padding-top:1000px;padding-bottom:1000px;width:3px;background:var(--bkg-color);cursor:ew-resize}.close-swiper{display:none;position:absolute;top:0;transform:translateX(-3px);width:2rem;height:2rem;background-color:var(--ol-background-color);color:var(--ol-subtle-foreground-color);border-radius:4px;border-width:1px;cursor:pointer}.close-swiper:focus,.close-swiper:hover{outline:1px solid var(--ol-subtle-foreground-color);color:var(--ol-foreground-color)}.ol-viewport .tooltip{position:relative;background:rgba(0,0,0,.5);border-radius:0;color:#fff;padding:.32rem .62rem;opacity:.7;white-space:nowrap}@media screen and (max-width:1000px){.ol-zoom{display:none!important}.ol-rotate{top:.5rem!important;right:.5rem!important}}.contextmenu{background-color:var(--bkg-color);color:var(--text-color);box-shadow:1px 3px 4px rgba(0,0,0,.4);border:1px solid #ccc}.menu-entry{cursor:pointer;padding:10px}
</style>
<link rel="stylesheet" href="lib/ol/ol.css" />

<div id="container">
  <div id="ol-map"></div>
  <div id="cs-map">
    <div class="${this.loading?"loading center":"loading hidden"}">
      <img alt="loading-icon" src="icons/loading.svg" class="gg-spin" />
      <span i18n="Loading cesium...">Loading cesium...</span>
      <span class="quote" i18n="cesium-loading-quote"
        >Please be patient, like a giraffe reaching for the tastiest leaves.</span
      >
    </div>
  </div>
  <div id="popup" class="ol-popup hidden">
    <button
      id="popup-closer"
      class="ol-popup-closer gg-icon-button gg-small"
      onclick="${()=>this.closePopup()}"></button>
    <div id="popup-content"></div>
  </div>
  <input id="swiper" type="range" min="0" max="1000" step="1" />
  <button tip="Hide Swiper" tip-placement="bottom" id="close-swiper" class="close-swiper">Ã</button>

  <div id="map-contextmenu"></div>
</div>
`);z(this,"olMap");z(this,"mapTarget");z(this,"map3d");z(this,"map3dTarget");z(this,"map3dShadowsTimestamp");z(this,"loading",!1);z(this,"swiper");z(this,"closeSwiperButton");z(this,"swipeManager");z(this,"wmtsManager");z(this,"wmsManager");z(this,"wmsManager3d",null);z(this,"osmManager");z(this,"cogManager");z(this,"xyzManager");z(this,"viewManager");z(this,"vectorTilesManager");z(this,"localFileManager");z(this,"defaultSrid");z(this,"crosshairFeature");z(this,"crosshairLayer");z(this,"tooltipContainer");z(this,"tooltipOverlay");z(this,"selectedFeaturesCollection",new hS);z(this,"highlightedFeaturesCollection",new hS);z(this,"selectionLayer");z(this,"highlightLayer");z(this,"pixelTolerance",10);z(this,"dragbox");z(this,"focusFeature");z(this,"initialPositionFromUrl",n4());z(this,"onChangeOrder",lCe(()=>this.reorderLayers(),0));this.olMap=eC.getInstance().getMap(),this.focusFeature=new Cy}get projection(){return this.olMap.getView().getProjection()}resetAllSwipedLayers(n){for(const i of n)i instanceof Hi?i.swiped="no":(i instanceof ln||i instanceof Kn)&&this.resetAllSwipedLayers(i.children);this.swipeManager.deactivateSwiper()}registerEvents(){this.swiper.addEventListener("input",()=>{this.olMap.render(),this.updateCloseSwiperPosition()}),this.closeSwiperButton.onclick=()=>{this.resetAllSwipedLayers(this.state.layers.layersList)},this.subscribe("activeBasemap",(n,i)=>this.onChangeBasemap(i)),this.subscribe("projection",(n,i)=>this.onChangeProjection(n,i)),this.subscribe("interface.darkMapMode",(n,i)=>this.onChangeDarkMode()),this.subscribe("position",(n,i)=>this.onPositionChanged(i)),this.subscribe("position.scale",(n,i)=>this.onChangeScale(i)),this.subscribe("position.resolution",(n,i)=>this.zoomToResolution(i)),this.subscribe("position.zoom",(n,i)=>this.zoomToZoom(i)),this.subscribe("position.center",(n,i)=>this.panToCoordinate(i)),this.subscribe("selection.selectionParameters",(n,i)=>this.onSelectFeatures(i)),this.subscribe("selection.selectedFeatures",(n,i)=>this.onFeaturesSelected(i)),this.subscribe("selection.highlightedFeatures",(n,i)=>this.onFeatureHighlighted(i)),this.subscribe("selection.focusedFeatures",(n,i)=>this.focusFeature.setFocusedFeatures(i)),this.subscribe("globe.display",()=>this.onGlobeToggled()),this.subscribe("globe.shadows",(n,i)=>this.onShadowsToggled(i)),this.subscribe("globe.shadowsTimestamp",(n,i)=>this.onShadowsTimestampChanged(i)),this.subscribe(/layers\.layersList\..*\.activeState/,(n,i,r)=>this.onLayerToggled(r)),this.subscribe(/layers\.layersList\..*\.opacity/,(n,i,r)=>this.onChangeOpacity(r)),this.subscribe(/layers\.layersList\..*\.swiped/,(n,i,r)=>this.onChangeSwiped(r)),this.subscribe(/layers\.layersList\..*\.filter/,(n,i,r)=>this.onChangeFilter(r)),this.subscribe(/layers\.layersList\..*\.timeRestriction/,(n,i,r)=>this.onChangeTime(r)),this.subscribe(/layers\.layersList\..*\.order/,()=>this.onChangeOrder()),this.subscribe("sharedStateIsLoaded",(n,i)=>{i&&(this.onPositionChanged(this.state.position),this.activateSharedLayers(this.state.layers.layersList),this.setMapPositionFromUrlAfterInit())})}activateSharedLayers(n){for(const i of n)i instanceof Hi&&i.isDefaultChecked&&(this.onLayerToggled(i),this.onChangeOpacity(i),this.onChangeFilter(i),this.onChangeTime(i)),(i instanceof ln||i instanceof Kn)&&this.activateSharedLayers(i.children)}render(){super.render(),this.activateTooltips(!1,[800,0],"right"),this.defaultSrid=this.configManager.getDefaultConfigValue("map.srid"),this.setMapPositionFromUrlAfterInit(),this.mapTarget=this.shadow.getElementById("ol-map"),this.map3dTarget=this.shadow.getElementById("cs-map"),this.olMap.setTarget(this.mapTarget),this.wmsManager=OTe.getInstance(),this.wmsManager.map=this.olMap,this.osmManager=new DTe(this.olMap),this.cogManager=new aCe(this.olMap),this.xyzManager=new cCe(this.olMap),this.viewManager=new $Ee(this.olMap),this.vectorTilesManager=new qEe(this.olMap),this.localFileManager=new oCe(this.olMap),this.wmtsManager=new WEe(this.olMap),this.swiper=this.shadow.getElementById("swiper"),this.closeSwiperButton=this.shadow.getElementById("close-swiper"),this.swipeManager=new $0e(this.olMap,this.swiper,this.closeSwiperButton,this.wmtsManager,this.wmsManager,this.localFileManager);const n=this.viewManager.getDefaultView();this.olMap.setView(n);const i=new $a({features:this.highlightedFeaturesCollection}),r=new $a({features:this.selectedFeaturesCollection});this.configManager.loadConfig().then(()=>{if(this.selectionLayer=new du({properties:{addToPrintedLayers:!0},source:r}),this.highlightLayer=new du({source:i}),this.setSelectLayerStyle(),this.setHighlightLayerStyle(),this.olMap.addLayer(this.selectionLayer),this.olMap.addLayer(this.highlightLayer),this.selectionLayer.setZIndex(1002),this.highlightLayer.setZIndex(1003),this.selectionLayer.set("altitudeMode","clampToGround"),this.configManager.Config.map.showScaleLine){const s=new W0e({units:"metric"});this.olMap.addControl(s)}}),setTimeout(()=>{this.olMap.updateSize()},1e3)}closePopup(){this.tooltipOverlay.setPosition(void 0),this.tooltipContainer.classList.add("hidden")}listenOpenLayersEvents(){this.olMap.on("loadstart",n=>this.onLoadStart(n)),this.olMap.on("loadend",n=>this.onLoadEnd(n)),this.registerInteractionListener("map.select",!1)&&(this.olMap.on("singleclick",n=>{this.canExecute("map.select")&&this.onClick(n)}),this.dragbox=new HU({condition:n=>qU(n)&&this.canExecute("map.select")}),this.olMap.addInteraction(this.dragbox),this.dragbox.on("boxend",n=>this.onDragSelection(n))),this.registerInteractionListener("map.mousemove",!1)&&(this.olMap.on("moveend",n=>{this.canExecute("map.mousemove")&&this.onMoveEnd(n)}),this.olMap.on("pointermove",n=>{this.canExecute("map.mousemove")&&this.onPointerMove(n)}))}onLoadStart(n){this.state.loading=!0}onLoadEnd(n){this.state.loading=!1}onPointerMove(n){this.state.mouseCoordinates=n.coordinate}onMoveEnd(n){const i=this.olMap.getView(),r=new S_;r.center=i.getCenter(),r.zoom=i.getZoom(),r.resolution=i.getResolution(),r.scale=this.viewManager.getScale(),r.tooltip=this.state.position.tooltip,r.isValid&&(this.state.position=r)}onClick(n){const i=[n.pixel[0]-this.pixelTolerance,n.pixel[1]-this.pixelTolerance],r=this.olMap.getCoordinateFromPixel(i),s=[n.pixel[0]+this.pixelTolerance,n.pixel[1]+this.pixelTolerance],o=this.olMap.getCoordinateFromPixel(s);this.select([r[0],r[1],o[0],o[1]])}onDragSelection(n){const i=this.dragbox.getGeometry().getExtent();this.select(i)}select(n){this.state.selection.selectedFeatures=[],this.state.selection.selectionParameters=[],this.state.selection.highlightedFeatures=[],this.wmsManager.selectFeatures(n),this.wmtsManager.selectFeatures(n),this.localFileManager.selectFeatures(n)}async onSelectFeatures(n){this.state.loading=!0;const i=n.map(c=>{const u=c.clone(d=>d.queryable&&!d.wfsQueryable);return this.wmsManager.getClient(u._ogcServer).getFeatureInfo(u)}),r=n.map(c=>{const u=c.clone(p=>p.wfsQueryable);return LA.getInstance().getClient(u._ogcServer).getFeature(u)}),s=(await Promise.all(i)).flat(),o=(await Promise.all(r)).flat(),a=[...s,...o];a.length===0&&this.state.selection.selectedFeatures.length==0?this.state.interface.selectionComponentVisible=!1:(this.state.selection.selectedFeatures.push(...a),this.state.interface.selectionComponentVisible=!0),this.state.loading=!1}connectedCallback(){this.loadConfig().then(()=>{this.render(),this.listenOpenLayersEvents(),this.registerEvents()})}onCustomGirafeEvent(n){n.action===G3.zoomToExtent&&this.zoomToExtent(n.extent)}onChangeSwiped(n){this.swipeManager.toggleSwipe(n),this.updateCloseSwiperPosition()}updateCloseSwiperPosition(){const n=parseFloat(this.swiper.value),i=parseFloat(this.swiper.max),r=parseFloat(this.swiper.min),o=(n-r)/(i-r)*this.swiper.offsetWidth;this.closeSwiperButton.style.left=`${o}px`}setSelectLayerStyle(){this.selectionLayer.setStyle(new ps({stroke:new Pr({color:this.configManager.Config.selection.defaultStrokeColor,width:this.configManager.Config.selection.defaultStrokeWidth}),fill:new Ws({color:this.configManager.Config.selection.defaultFillColor}),image:new pp({radius:7,fill:new Ws({color:this.configManager.Config.selection.defaultFillColor}),stroke:new Pr({color:this.configManager.Config.selection.defaultStrokeColor,width:this.configManager.Config.selection.defaultStrokeWidth})})}))}setHighlightLayerStyle(){this.highlightLayer.setStyle(new ps({stroke:new Pr({color:this.configManager.Config.selection.highlightStrokeColor,width:this.configManager.Config.selection.defaultStrokeWidth}),fill:new Ws({color:this.configManager.Config.selection.highlightFillColor}),image:new pp({radius:7,fill:new Ws({color:this.configManager.Config.selection.highlightFillColor}),stroke:new Pr({color:this.configManager.Config.selection.highlightStrokeColor,width:this.configManager.Config.selection.defaultStrokeWidth})})}))}setCrosshairStyle(){this.crosshairLayer.setStyle(new ps({image:new vR({fill:new Ws({color:this.configManager.Config.selection.defaultFillColor}),stroke:new Pr({color:this.configManager.Config.selection.defaultStrokeColor,width:2}),points:4,radius:10,radius2:0,angle:0})}))}async create3dMap(){if(!this.map3d&&this.configManager.Config.map3d){this.loading=!0,super.render();const n=await ga(()=>import("./Cesium-BhpIpNCZ.js"),__vite__mapDeps([10,11,8]),import.meta.url);window.Cesium=n;const i=await ga(()=>import("./olcs-0nA3eAVu.js"),__vite__mapDeps([12,8]),import.meta.url);this.map3d=new i.default({map:this.olMap,target:this.map3dTarget,time:()=>{const p=new Date(this.map3dShadowsTimestamp);return isNaN(p.getTime())?n.JulianDate.now():n.JulianDate.fromDate(p)}});const r=this.map3d.getCesiumScene(),s=this.configManager.Config.map3d;r.screenSpaceCameraController.maximumZoomDistance=s.maximumZoomDistance??3e4,s.terrainUrl&&(r.terrainProvider=await n.CesiumTerrainProvider.fromUrl(s.terrainUrl));let o=n.Rectangle.MAX_VALUE;s.terrainImagery&&(s.terrainImagery.coverageArea&&(o=n.Rectangle.fromDegrees(...s.terrainImagery.coverageArea)),r.imageryLayers.addImageryProvider(new n.UrlTemplateImageryProvider({url:s.terrainImagery.url,minimumLevel:s.terrainImagery.minLoD??0,maximumLevel:s.terrainImagery.maxLoD,tilingScheme:s.terrainImagery.srid===3857?new n.WebMercatorTilingScheme:new n.GeographicTilingScheme,rectangle:o})));const a={maximumScreenSpaceError:.5,dynamicScreenSpaceError:!0,dynamicScreenSpaceErrorFactor:s.tilesetsMaxError??7};s.tilesetsUrls.forEach(p=>{Ln.fromUrl(p,a).then(g=>r.primitives.add(g))});const c=r.postProcessStages.ambientOcclusion;c.enabled=!0,c.uniforms.bias=.5,c.uniforms.stepSize=1,c.uniforms.blurStepSize=1,this.loading=!1,this.state.globe.loaded=!0,super.render();const u=p=>{const g=n.Cartographic.fromCartesian(h(p)),_=[n.Math.toDegrees(g.longitude),n.Math.toDegrees(g.latitude)];return zr("EPSG:4326",this.configManager.Config.map.srid,_)},h=p=>{const g=r.camera.getPickRay(p);return g==null?void 0:r.globe.pick(g,r)};this.registerInteractionListener("globe.select",!0),new n.ScreenSpaceEventHandler(r.canvas).setInputAction(p=>{if(n.defined(p.position)&&this.canExecute("globe.select")){const g=p.position.clone();g.x-=this.pixelTolerance,g.y-=this.pixelTolerance;const _=p.position.clone();_.x+=this.pixelTolerance,_.y+=this.pixelTolerance;const b=u(g),x=u(_);this.select([b[0],b[1],x[0],x[1]])}},n.ScreenSpaceEventType.LEFT_CLICK),this.wmsManager3d=new RTe(r),this.state.layers.layersList.forEach(p=>this.addAllActiveLayers3dMap(p))}}addAllActiveLayers3dMap(n){var i;n instanceof ji?n.active&&((i=this.wmsManager3d)==null||i.addLayer(n)):n instanceof ln&&n.children.forEach(r=>this.addAllActiveLayers3dMap(r))}async onGlobeToggled(){this.state.globe.display==="3D"?(this.mapTarget.style.display="none",this.map3dTarget.style.display="block",this.map3dTarget.style.left="0",this.map3dTarget.style.width="100%",await this.create3dMap(),this.map3d.setEnabled(!0)):this.state.globe.display==="2D/3D"?(this.mapTarget.style.display="inline-block",this.mapTarget.style.width="45%",this.map3dTarget.style.display="inline-block",this.map3dTarget.style.left="45%",this.map3dTarget.style.width="55%",await this.create3dMap(),this.map3d.setEnabled(!0)):(this.map3d&&this.map3d.setEnabled(!1),this.mapTarget.style.display="block",this.mapTarget.style.width="100%",this.map3dTarget.style.display="none",this.unregisterInteractionListeners("globe.select"))}onShadowsToggled(n){if(this.map3d){const i=this.map3d.getCesiumScene();i.shadowMap.enabled=i.globe.enableLighting=n}}onShadowsTimestampChanged(n){this.map3d&&(this.map3dShadowsTimestamp=n)}onFeaturesSelected(n){if(this.selectedFeaturesCollection.clear(),n){for(const i of n)this.selectedFeaturesCollection.push(i);this.setSelectLayerStyle()}}onFeatureHighlighted(n){this.highlightedFeaturesCollection.clear();for(const i of n)this.highlightedFeaturesCollection.push(i);this.setHighlightLayerStyle()}onPositionChanged(n){this.zoomToResolution(n.resolution),n.isValid&&(this.panToCoordinate(n.center),this.updateUrlWithMapPosition())}onChangeScale(n){this.viewManager.setScale(n)}zoomToResolution(n){this.viewManager.setResolution(n)}zoomToZoom(n){this.viewManager.setZoom(n)}zoomToExtent(n){this.olMap.getView().fit(n)}panToCoordinate(n){this.viewManager.setCenter(n)}onChangeProjection(n,i){const r=this.viewManager.getViewConvertedToSrid(i);this.olMap.setView(r)}onChangeDarkMode(){this.state.interface.darkMapMode?this.mapTarget.classList.add("darkmap"):this.mapTarget.classList.remove("darkmap")}onLayerToggled(n){n instanceof Hi&&(n.active?this.onAddLayers([n]):this.onRemoveLayers([n]))}onAddLayers(n){n.forEach(i=>{i instanceof ji?(this.wmsManager.getClient(i).addLayer(i),this.wmsManager3d!=null&&this.wmsManager3d.addLayer(i)):i instanceof ca?this.wmtsManager.addLayer(i):i instanceof hy?this.localFileManager.addLayer(i):i instanceof pl?this.cogManager.addLayer(i):i instanceof ml&&this.xyzManager.addLayer(i)})}onRemoveLayers(n){n.forEach(i=>{i instanceof ji?(this.wmsManager.getClient(i).removeLayer(i),this.wmsManager3d!=null&&this.wmsManager3d.removeLayer(i)):i instanceof ca?this.wmtsManager.removeLayer(i):i instanceof hy?this.localFileManager.removeLayer(i):i instanceof pl?this.cogManager.removeLayer(i):i instanceof ml&&this.xyzManager.removeLayer(i)})}reorderLayers(){console.log("ORDER CHANGED FOR MAP"),this.wmtsManager.refreshZIndexes(),this.wmsManager.refreshZIndexes()}onChangeOpacity(n){n instanceof ji?(this.wmsManager.getClient(n).changeOpacity(n),this.wmsManager3d!=null&&this.wmsManager3d.changeOpacity(n)):n instanceof ca&&this.wmtsManager.layerExists(n)&&this.wmtsManager.changeOpacity(n,n.opacity)}onChangeFilter(n){n instanceof ji&&(this.wmsManager.getClient(n).changeFilter(n),this.wmsManager3d!=null&&this.wmsManager3d.changeFilter(n))}onChangeTime(n){if(n instanceof ji&&n.active)this.wmsManager.getClient(n).changeTimeRestriction(n);else if(n instanceof ln)for(const i of n.children)Ly(i)&&i.timeRestriction!==n.timeRestriction&&(i.timeRestriction=n.timeRestriction)}onChangeBasemap(n){this.wmtsManager.removeAllBasemapLayers(),this.wmsManager.removeAllBasemapLayers(),this.wmsManager3d!=null&&this.wmsManager3d.removeAllBasemapLayers(),this.osmManager.removeAllBasemapLayers(),this.cogManager.removeAllBasemapLayers(),this.xyzManager.removeAllBasemapLayers(),this.vectorTilesManager.removeAllBasemapLayers();for(const i of n.layersList)if(i instanceof Bp)this.osmManager.addBasemapLayer(i);else if(i instanceof yh)this.vectorTilesManager.addBasemapLayer(i);else if(i instanceof pl)this.cogManager.addBasemapLayer(i);else if(i instanceof ml)this.xyzManager.addBasemapLayer(i);else if(i instanceof ca)this.wmtsManager.addBasemapLayer(i);else if(i instanceof ji)this.wmsManager.getClient(i).addBasemapLayer(i),this.wmsManager3d!=null&&this.wmsManager3d.addBasemapLayer(i);else throw new Error("Unknown basemap type")}updateUrlWithMapPosition(){let n=this.state.position.center[0],i=this.state.position.center[1];if(!n||!i)return;EC()||(n=Math.round(n),i=Math.round(i));const r=new S_;r.center=[n,i],r.zoom=this.state.position.zoom,this.state.projection!==this.defaultSrid&&this.state.projection!=="EPSG:4326"&&(r.center=Vd(r.center,this.projection,"EPSG:4326")),i4(r)}setMapPositionFromUrlAfterInit(){this.initialPositionFromUrl&&(this.state.position=this.initialPositionFromUrl,!this.state.projection||!this.olMap.getView().getResolution()?this.olMap.once("rendercomplete",()=>{this.applyMapPositionFromUrl(this.initialPositionFromUrl)}):this.applyMapPositionFromUrl(this.initialPositionFromUrl))}applyMapPositionFromUrl(n){if(!this.state.projection||!this.olMap.getView().getResolution())return;const i=Er(Q5(n.center)?"EPSG:4326":this.defaultSrid);i.getCode()!==this.state.projection&&(n.center=Vd(n.center,i,this.projection)),n.crosshair&&(this.crosshairFeature&&this.olMap.removeLayer(this.crosshairLayer),this.crosshairFeature=new kR(new WU(n.center)),this.crosshairLayer=new du({source:new $a({features:[this.crosshairFeature]})}),this.setCrosshairStyle(),this.olMap.addLayer(this.crosshairLayer)),n.isValid&&(this.olMap.getView().setCenter(n.center),this.olMap.getView().setZoom(n.zoom))}}class pCe extends ei{constructor(n){super(n);z(this,"configManager");z(this,"stateManager");this.configManager=fn.getInstance(),this.stateManager=An.getInstance()}get isOAuth(){return this.configManager.Config.oauth!==void 0}get state(){return this.stateManager.state}get gmfConfigForOAuth(){return this.configManager.Config.oauth.geomapfish}get gmfConfigForGmfAuth(){return this.configManager.Config.gmfauth}async loginWithToken(){var n;if(this.gmfConfigForOAuth.loginUrl){if(console.debug("Auth: 2.1. Backend login with token"),!this.isOAuth)throw new Error("Login with JWT token if the issuer does not support oAuth is not supported.");const i=await fetch(this.gmfConfigForOAuth.loginUrl,{headers:{Authorization:`Bearer ${(n=this.state.oauth.tokens)==null?void 0:n.access_token}`}});if(!i.ok)throw new Error(i.statusText)}this.state.oauth.status="loggedIn"}async logout(){console.debug("Auth: 4. Backend logout");let n=null;if(this.isOAuth&&this.gmfConfigForOAuth.logoutUrl?n=this.gmfConfigForOAuth.logoutUrl:this.isOAuth||(n=`${this.gmfConfigForGmfAuth.url}/logout`),n){const i=await fetch(n);if(!i.ok)throw new Error(i.statusText)}this.state.oauth.userInfo=void 0,this.state.oauth.status="backend.loggedOut"}async getUserInfo(){console.debug("Auth: 3. Get UserInfo");const n=this.isOAuth?this.gmfConfigForOAuth.userInfoUrl:`${this.gmfConfigForGmfAuth.url}/loginuser`;this.state.oauth.userInfo=await fetch(n).then(i=>i.json())}}class Z3 extends ei{constructor(n){super(n);z(this,"configManager");z(this,"stateManager");this.configManager=fn.getInstance(),this.stateManager=An.getInstance()}get state(){return this.stateManager.state}loggedOutFromBackend(){this.state.oauth.status="loggedOutForcedFromBackend",this.state.oauth.tokens=void 0,this.state.oauth.userInfo=void 0,this.state.oauth.audience=[]}handleErrorFromIssuer(){this.state.oauth.status="loggedOut",this.state.oauth.tokens=void 0,this.state.oauth.userInfo=void 0,this.state.oauth.audience=[]}}let zE;var Gg,SR;(typeof navigator>"u"||!((SR=(Gg=navigator.userAgent)==null?void 0:Gg.startsWith)!=null&&SR.call(Gg,"Mozilla/5.0 ")))&&(zE="oauth4webapi/v3.1.2");function xb(e,t){if(e==null)return!1;try{return e instanceof t||Object.getPrototypeOf(e)[Symbol.toStringTag]===t.prototype[Symbol.toStringTag]}catch{return!1}}const lc="ERR_INVALID_ARG_VALUE",Bo="ERR_INVALID_ARG_TYPE";function Ci(e,t,n){const i=new TypeError(e,{cause:n});return Object.assign(i,{code:t}),i}const J3=Symbol(),mCe=Symbol(),gCe=Symbol(),Q3=Symbol(),_Ce=new TextEncoder,yCe=new TextDecoder;function UE(e){return typeof e=="string"?_Ce.encode(e):yCe.decode(e)}const xR=32768;function bCe(e){e instanceof ArrayBuffer&&(e=new Uint8Array(e));const t=[];for(let n=0;n<e.byteLength;n+=xR)t.push(String.fromCharCode.apply(null,e.subarray(n,n+xR)));return btoa(t.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function TCe(e){try{const t=atob(e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}catch(t){throw Ci("The input to be decoded is not correctly encoded.",lc,t)}}function wy(e){return typeof e=="string"?TCe(e):bCe(e)}class Ay extends Error{constructor(n,i){var r;super(n,i);z(this,"code");this.name=this.constructor.name,this.code=nwe,(r=Error.captureStackTrace)==null||r.call(Error,this,this.constructor)}}class xCe extends Error{constructor(n,i){var r;super(n,i);z(this,"code");this.name=this.constructor.name,i!=null&&i.code&&(this.code=i==null?void 0:i.code),(r=Error.captureStackTrace)==null||r.call(Error,this,this.constructor)}}function lt(e,t,n){return new xCe(e,{code:t,cause:n})}function zp(e){return!(e===null||typeof e!="object"||Array.isArray(e))}function ez(e){xb(e,Headers)&&(e=Object.fromEntries(e.entries()));const t=new Headers(e);if(zE&&!t.has("user-agent")&&t.set("user-agent",zE),t.has("authorization"))throw Ci('"options.headers" must not include the "authorization" header name',lc);if(t.has("dpop"))throw Ci('"options.headers" must not include the "dpop" header name',lc);return t}function tz(e){if(typeof e=="function"&&(e=e()),!(e instanceof AbortSignal))throw Ci('"options.signal" must return or be an instance of AbortSignal',Bo);return e}async function ECe(e,t){if(!(e instanceof URL))throw Ci('"issuerIdentifier" must be an instance of URL',Bo);sz(e,(t==null?void 0:t[J3])!==!0);const n=new URL(e.href);switch(t==null?void 0:t.algorithm){case void 0:case"oidc":n.pathname=`${n.pathname}/.well-known/openid-configuration`.replace("//","/");break;case"oauth2":n.pathname==="/"?n.pathname=".well-known/oauth-authorization-server":n.pathname=`.well-known/oauth-authorization-server/${n.pathname}`.replace("//","/");break;default:throw Ci('"options.algorithm" must be "oidc" (default), or "oauth2"',lc)}const i=ez(t==null?void 0:t.headers);return i.set("accept","application/json"),((t==null?void 0:t[Q3])||fetch)(n.href,{body:void 0,headers:Object.fromEntries(i.entries()),method:"GET",redirect:"manual",signal:t!=null&&t.signal?tz(t.signal):void 0})}function b_(e,t,n,i,r){try{if(typeof e!="number"||!Number.isFinite(e))throw Ci(`${n} must be a number`,Bo,r);if(e>0)return;throw Ci(`${n} must be a positive number`,lc,r)}catch(s){throw i?lt(s.message,i,r):s}}function Zs(e,t,n,i){try{if(typeof e!="string")throw Ci(`${t} must be a string`,Bo,i);if(e.length===0)throw Ci(`${t} must not be empty`,lc,i)}catch(r){throw n?lt(r.message,n,i):r}}async function CCe(e,t){if(!(e instanceof URL)&&e!==wR)throw Ci('"expectedIssuer" must be an instance of URL',Bo);if(!xb(t,Response))throw Ci('"response" must be an instance of Response',Bo);if(t.status!==200)throw lt('"response" is not a conform Authorization Server Metadata response',uz,t);NA(t),PA(t);let n;try{n=await t.json()}catch(i){throw lt('failed to parse "response" body as JSON',Sy,i)}if(!zp(n))throw lt('"response" body must be a top level object',un,{body:n});if(Zs(n.issuer,'"response" body "issuer" property',un,{body:n}),new URL(n.issuer).href!==e.href&&e!==wR)throw lt('"response" body "issuer" property does not match the expected value',awe,{expected:e.href,body:n,attribute:"issuer"});return n}function PA(e){ACe(e,"application/json")}function wCe(e,...t){let n='"response" content-type must be ';if(t.length>2){const i=t.pop();n+=`${t.join(", ")}, or ${i}`}else t.length===2?n+=`${t[0]} or ${t[1]}`:n+=t[0];return lt(n,rwe,e)}function ACe(e,t){if(kCe(e)!==t)throw wCe(e,t)}function SCe(){return wy(crypto.getRandomValues(new Uint8Array(32)))}function vCe(){return SCe()}async function ICe(e){return Zs(e,"codeVerifier"),wy(await crypto.subtle.digest("SHA-256",UE(e)))}function nz(e){const t=e==null?void 0:e[mCe];return typeof t=="number"&&Number.isFinite(t)?t:0}function iz(e){const t=e==null?void 0:e[gCe];return typeof t=="number"&&Number.isFinite(t)&&Math.sign(t)!==-1?t:30}function rz(){return Math.floor(Date.now()/1e3)}function Eb(e){if(typeof e!="object"||e===null)throw Ci('"as" must be an object',Bo);Zs(e.issuer,'"as.issuer"')}function Cb(e){if(typeof e!="object"||e===null)throw Ci('"client" must be an object',Bo);Zs(e.client_id,'"client.client_id"')}function OCe(){return(e,t,n,i)=>{n.set("client_id",t.client_id)}}function ER(){return OCe()}const RCe=URL.parse?(e,t)=>URL.parse(e,t):(e,t)=>{try{return new URL(e,t)}catch{return null}};function sz(e,t){if(t&&e.protocol!=="https:")throw lt("only requests to HTTPS are allowed",swe,e);if(e.protocol!=="https:"&&e.protocol!=="http:")throw lt("only HTTP and HTTPS requests are allowed",owe,e)}function CR(e,t,n,i){let r;if(typeof e!="string"||!(r=RCe(e)))throw lt(`authorization server metadata does not contain a valid ${n?`"as.mtls_endpoint_aliases.${t}"`:`"as.${t}"`}`,e===void 0?cwe:lwe,{attribute:n?`mtls_endpoint_aliases.${t}`:t});return sz(r,i),r}function DCe(e,t,n,i){return n&&e.mtls_endpoint_aliases&&t in e.mtls_endpoint_aliases?CR(e.mtls_endpoint_aliases[t],t,n,i):CR(e[t],t,n,i)}class MCe extends Error{constructor(n,i){var r;super(n,i);z(this,"cause");z(this,"code");z(this,"error");z(this,"status");z(this,"error_description");z(this,"response");this.name=this.constructor.name,this.code=twe,this.cause=i.cause,this.error=i.cause.error,this.status=i.response.status,this.error_description=i.cause.error_description,Object.defineProperty(this,"response",{enumerable:!1,value:i.response}),(r=Error.captureStackTrace)==null||r.call(Error,this,this.constructor)}}class LCe extends Error{constructor(n,i){var r;super(n,i);z(this,"cause");z(this,"code");z(this,"error");z(this,"error_description");this.name=this.constructor.name,this.code=iwe,this.cause=i.cause,this.error=i.cause.get("error"),this.error_description=i.cause.get("error_description")??void 0,(r=Error.captureStackTrace)==null||r.call(Error,this,this.constructor)}}class PCe extends Error{constructor(n,i){var r;super(n,i);z(this,"cause");z(this,"code");z(this,"response");z(this,"status");this.name=this.constructor.name,this.code=ewe,this.cause=i.cause,this.status=i.response.status,this.response=i.response,Object.defineProperty(this,"response",{enumerable:!1}),(r=Error.captureStackTrace)==null||r.call(Error,this,this.constructor)}}function NCe(e){return e.length>=2&&e[0]==='"'&&e[e.length-1]==='"'?e.slice(1,-1):e}const FCe=/((?:,|, )?[0-9a-zA-Z!#$%&'*+-.^_`|~]+=)/,BCe=/(?:^|, ?)([0-9a-zA-Z!#$%&'*+\-.^_`|~]+)(?=$|[ ,])/g;function zCe(e,t){const n=t.split(FCe).slice(1);if(!n.length)return{scheme:e.toLowerCase(),parameters:{}};n[n.length-1]=n[n.length-1].replace(/,$/,"");const i={};for(let r=1;r<n.length;r+=2){const s=r;if(n[s][0]==='"')for(;n[s].slice(-1)!=='"'&&++r<n.length;)n[s]+=n[r];const o=n[s-1].replace(/^(?:, ?)|=$/g,"").toLowerCase();i[o]=NCe(n[s])}return{scheme:e.toLowerCase(),parameters:i}}function UCe(e){if(!xb(e,Response))throw Ci('"response" must be an instance of Response',Bo);const t=e.headers.get("www-authenticate");if(t===null)return;const n=[];for(const{1:r,index:s}of t.matchAll(BCe))n.push([r,s]);return n.length?n.map(([r,s],o,a)=>{const c=a[o+1];let u;return c?u=t.slice(s,c[1]):u=t.slice(s),zCe(r,u)}):void 0}function kCe(e){var t;return(t=e.headers.get("content-type"))==null?void 0:t.split(";")[0]}async function jCe(e,t,n,i,r,s,o){return await n(e,t,r,s),s.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),((o==null?void 0:o[Q3])||fetch)(i.href,{body:r,headers:Object.fromEntries(s.entries()),method:"POST",redirect:"manual",signal:o!=null&&o.signal?tz(o.signal):void 0})}async function oz(e,t,n,i,r,s){const o=DCe(e,"token_endpoint",t.use_mtls_endpoint_aliases,(s==null?void 0:s[J3])!==!0);r.set("grant_type",i);const a=ez(s==null?void 0:s.headers);return a.set("accept","application/json"),await jCe(e,t,n,o,r,a,s)}async function VCe(e,t,n,i,r){Eb(e),Cb(t),Zs(i,'"refreshToken"');const s=new URLSearchParams(r==null?void 0:r.additionalParameters);return s.set("refresh_token",i),oz(e,t,n,"refresh_token",s,r)}const az=new WeakMap,GCe=new WeakMap;function HCe(e){if(!e.id_token)return;const t=az.get(e);if(!t)throw Ci('"ref" was already garbage collected or did not resolve from the proper sources',lc);return t}async function cz(e,t,n,i,r){var a;if(Eb(e),Cb(t),!xb(n,Response))throw Ci('"response" must be an instance of Response',Bo);let s;if(s=UCe(n))throw new PCe("server responded with a challenge in the WWW-Authenticate HTTP Header",{cause:s,response:n});if(n.status!==200){let c;throw(c=await uwe(n))?(await((a=n.body)==null?void 0:a.cancel()),new MCe("server responded with an error in the response body",{cause:c,response:n})):lt('"response" is not a conform Token Endpoint response',uz,n)}NA(n),PA(n);let o;try{o=await n.json()}catch(c){throw lt('failed to parse "response" body as JSON',Sy,c)}if(!zp(o))throw lt('"response" body must be a top level object',un,{body:o});if(Zs(o.access_token,'"response" body "access_token" property',un,{body:o}),Zs(o.token_type,'"response" body "token_type" property',un,{body:o}),o.token_type=o.token_type.toLowerCase(),o.token_type!=="dpop"&&o.token_type!=="bearer")throw new Ay("unsupported `token_type` value",{cause:{body:o}});if(o.expires_in!==void 0){let c=typeof o.expires_in!="number"?parseFloat(o.expires_in):o.expires_in;b_(c,!1,'"response" body "expires_in" property',un,{body:o}),o.expires_in=c}if(o.refresh_token!==void 0&&Zs(o.refresh_token,'"response" body "refresh_token" property',un,{body:o}),o.scope!==void 0&&typeof o.scope!="string")throw lt('"response" body "scope" property must be a string',un,{body:o});if(o.id_token!==void 0){Zs(o.id_token,'"response" body "id_token" property',un,{body:o});const c=["aud","exp","iat","iss","sub"];t.require_auth_time===!0&&c.push("auth_time"),t.default_max_age!==void 0&&(b_(t.default_max_age,!1,'"client.default_max_age"'),c.push("auth_time"));const{claims:u,jwt:h}=await fwe(o.id_token,hwe.bind(void 0,t.id_token_signed_response_alg,e.id_token_signing_alg_values_supported,"RS256"),nz(t),iz(t)).then(ZCe.bind(void 0,c)).then($Ce.bind(void 0,e)).then(WCe.bind(void 0,t.client_id));if(Array.isArray(u.aud)&&u.aud.length!==1){if(u.azp===void 0)throw lt('ID Token "aud" (audience) claim includes additional untrusted audiences',bh,{claims:u,claim:"aud"});if(u.azp!==t.client_id)throw lt('unexpected ID Token "azp" (authorized party) claim value',bh,{expected:t.client_id,claims:u,claim:"azp"})}u.auth_time!==void 0&&b_(u.auth_time,!1,'ID Token "auth_time" (authentication time)',un,{claims:u}),GCe.set(n,h),az.set(o,u)}return o}async function qCe(e,t,n,i){return cz(e,t,n)}function WCe(e,t){if(Array.isArray(t.claims.aud)){if(!t.claims.aud.includes(e))throw lt('unexpected JWT "aud" (audience) claim value',bh,{expected:e,claims:t.claims,claim:"aud"})}else if(t.claims.aud!==e)throw lt('unexpected JWT "aud" (audience) claim value',bh,{expected:e,claims:t.claims,claim:"aud"});return t}function $Ce(e,t){var i;const n=((i=e[_we])==null?void 0:i.call(e,t))??e.issuer;if(t.claims.iss!==n)throw lt('unexpected JWT "iss" (issuer) claim value',bh,{expected:n,claims:t.claims,claim:"iss"});return t}const lz=new WeakSet;function XCe(e){return lz.add(e),e}async function YCe(e,t,n,i,r,s,o){if(Eb(e),Cb(t),!lz.has(i))throw Ci('"callbackParameters" must be an instance of URLSearchParams obtained from "validateAuthResponse()", or "validateJwtAuthResponse()',lc);Zs(r,'"redirectUri"');const a=au(i,"code");if(!a)throw lt('no authorization code in "callbackParameters"',un);const c=new URLSearchParams(o==null?void 0:o.additionalParameters);return c.set("redirect_uri",r),c.set("code",a),s!==gwe&&(Zs(s,'"codeVerifier"'),c.set("code_verifier",s)),oz(e,t,n,"authorization_code",c,o)}const KCe={aud:"audience",c_hash:"code hash",client_id:"client id",exp:"expiration time",iat:"issued at",iss:"issuer",jti:"jwt id",nonce:"nonce",s_hash:"state hash",sub:"subject",ath:"access token hash",htm:"http method",htu:"http uri",cnf:"confirmation",auth_time:"authentication time"};function ZCe(e,t){for(const n of e)if(t.claims[n]===void 0)throw lt(`JWT "${n}" (${KCe[n]}) claim missing`,un,{claims:t.claims});return t}async function JCe(e,t,n,i){return QCe(e,t,n)}async function QCe(e,t,n,i){const r=await cz(e,t,n),s=HCe(r);if(s){if(t.default_max_age!==void 0){b_(t.default_max_age,!1,'"client.default_max_age"');const o=rz()+nz(t),a=iz(t);if(s.auth_time+t.default_max_age<o-a)throw lt("too much time has elapsed since the last End-User authentication",kE,{claims:s,now:o,tolerance:a,claim:"auth_time"})}if(s.nonce!==void 0)throw lt('unexpected ID Token "nonce" claim value',bh,{expected:void 0,claims:s,claim:"nonce"})}return r}const ewe="OAUTH_WWW_AUTHENTICATE_CHALLENGE",twe="OAUTH_RESPONSE_BODY_ERROR",nwe="OAUTH_UNSUPPORTED_OPERATION",iwe="OAUTH_AUTHORIZATION_RESPONSE_ERROR",Sy="OAUTH_PARSE_ERROR",un="OAUTH_INVALID_RESPONSE",rwe="OAUTH_RESPONSE_IS_NOT_JSON",uz="OAUTH_RESPONSE_IS_NOT_CONFORM",swe="OAUTH_HTTP_REQUEST_FORBIDDEN",owe="OAUTH_REQUEST_PROTOCOL_FORBIDDEN",kE="OAUTH_JWT_TIMESTAMP_CHECK_FAILED",bh="OAUTH_JWT_CLAIM_COMPARISON_FAILED",awe="OAUTH_JSON_ATTRIBUTE_COMPARISON_FAILED",cwe="OAUTH_MISSING_SERVER_METADATA",lwe="OAUTH_INVALID_SERVER_METADATA";function NA(e){if(e.bodyUsed)throw Ci('"response" body has been used already',lc)}async function uwe(e){if(e.status>399&&e.status<500){NA(e),PA(e);try{const t=await e.clone().json();if(zp(t)&&typeof t.error=="string"&&t.error.length)return t}catch{}}}async function fwe(e,t,n,i,r){let{0:s,1:o,length:a}=e.split(".");if(a===5)throw new Ay("JWE decryption is not configured",{cause:e});if(a!==3)throw lt("Invalid JWT",un,e);let c;try{c=JSON.parse(UE(wy(s)))}catch(d){throw lt("failed to parse JWT Header body as base64url encoded JSON",Sy,d)}if(!zp(c))throw lt("JWT Header must be a top level object",un,e);if(t(c),c.crit!==void 0)throw new Ay('no JWT "crit" header parameter extensions are supported',{cause:{header:c}});let u;try{u=JSON.parse(UE(wy(o)))}catch(d){throw lt("failed to parse JWT Payload body as base64url encoded JSON",Sy,d)}if(!zp(u))throw lt("JWT Payload must be a top level object",un,e);const h=rz()+n;if(u.exp!==void 0){if(typeof u.exp!="number")throw lt('unexpected JWT "exp" (expiration time) claim type',un,{claims:u});if(u.exp<=h-i)throw lt('unexpected JWT "exp" (expiration time) claim value, expiration is past current timestamp',kE,{claims:u,now:h,tolerance:i,claim:"exp"})}if(u.iat!==void 0&&typeof u.iat!="number")throw lt('unexpected JWT "iat" (issued at) claim type',un,{claims:u});if(u.iss!==void 0&&typeof u.iss!="string")throw lt('unexpected JWT "iss" (issuer) claim type',un,{claims:u});if(u.nbf!==void 0){if(typeof u.nbf!="number")throw lt('unexpected JWT "nbf" (not before) claim type',un,{claims:u});if(u.nbf>h+i)throw lt('unexpected JWT "nbf" (not before) claim value',kE,{claims:u,now:h,tolerance:i,claim:"nbf"})}if(u.aud!==void 0&&typeof u.aud!="string"&&!Array.isArray(u.aud))throw lt('unexpected JWT "aud" (audience) claim type',un,{claims:u});return{header:c,claims:u,jwt:e}}function hwe(e,t,n,i){if(e!==void 0){if(typeof e=="string"?i.alg!==e:!e.includes(i.alg))throw lt('unexpected JWT "alg" header parameter',un,{header:i,expected:e,reason:"client configuration"});return}if(Array.isArray(t)){if(!t.includes(i.alg))throw lt('unexpected JWT "alg" header parameter',un,{header:i,expected:t,reason:"authorization server metadata"});return}if(n!==void 0){if(typeof n=="string"?i.alg!==n:typeof n=="function"?!n(i.alg):!n.includes(i.alg))throw lt('unexpected JWT "alg" header parameter',un,{header:i,expected:n,reason:"default value"});return}throw lt('missing client or server configuration to verify used JWT "alg" header parameter',void 0,{client:e,issuer:t,fallback:n})}function au(e,t){const{0:n,length:i}=e.getAll(t);if(i>1)throw lt(`"${t}" parameter must be provided only once`,un);return n}const dwe=Symbol(),pwe=Symbol();function mwe(e,t,n,i){if(Eb(e),Cb(t),n instanceof URL&&(n=n.searchParams),!(n instanceof URLSearchParams))throw Ci('"parameters" must be an instance of URLSearchParams, or URL',Bo);if(au(n,"response"))throw lt('"parameters" contains a JARM response, use validateJwtAuthResponse() instead of validateAuthResponse()',un,{parameters:n});const r=au(n,"iss"),s=au(n,"state");if(!r&&e.authorization_response_iss_parameter_supported)throw lt('response parameter "iss" (issuer) missing',un,{parameters:n});if(r&&r!==e.issuer)throw lt('unexpected "iss" (issuer) response parameter value',un,{expected:e.issuer,parameters:n});switch(i){case void 0:case pwe:if(s!==void 0)throw lt('unexpected "state" response parameter encountered',un,{expected:void 0,parameters:n});break;case dwe:break;default:if(Zs(i,'"expectedState" argument'),s!==i)throw lt(s===void 0?'response parameter "state" missing':'unexpected "state" response parameter value',un,{expected:i,parameters:n})}if(au(n,"error"))throw new LCe("authorization response from the server is an error",{cause:n});const a=au(n,"id_token"),c=au(n,"token");if(a!==void 0||c!==void 0)throw new Ay("implicit and hybrid flows are not supported");return XCe(new URLSearchParams(n))}const gwe=Symbol(),wR=Symbol(),_we=Symbol();class ywe extends Z3{constructor(){super(...arguments);z(this,"authorizationServer");z(this,"storagePath","oAuth");z(this,"silentLoginIframe")}get issuerConfig(){return this.configManager.Config.oauth.issuer}authProcessed(){return new URL(window.location.href).searchParams.has("authentified")}isAuthentified(){return new URL(window.location.href).searchParams.get("authentified")==="true"}hasAuthError(){return new URL(window.location.href).searchParams.has("error")}async initialize(){window.addEventListener("message",async n=>{n.origin===window.location.origin&&await this.handleSilentLoggedInViaIframe(n)}),this.isAuthentified()&&(this.hasAuthError()?(this.resetUrlHistory(!1),this.handleErrorFromIssuer()):await this.handleLoggedInToIssuer())}get codeVerifier(){return this.loadFromLocalStorage("codeVerifier")}set codeVerifier(n){this.saveToLocalStorage("codeVerifier",n)}get redirectUrl(){return this.loadFromLocalStorage("redirectUrl")}set redirectUrl(n){this.saveToLocalStorage("redirectUrl",n)}get currentState(){return this.loadFromLocalStorage("currentState")}set currentState(n){n.startsWith("#")&&(n=n.substring(1)),this.saveToLocalStorage("currentState",n)}loadFromLocalStorage(n){return A_.getInstance().getUserData(`${this.storagePath}.${n}`,!0)??""}saveToLocalStorage(n,i){return A_.getInstance().saveUserData(`${this.storagePath}.${n}`,i,!0)}async getAuthorizationServer(){if(!this.authorizationServer){const n=await ECe(new URL(this.issuerConfig.url),{algorithm:this.issuerConfig.algorithm});this.authorizationServer=await CCe(new URL(this.issuerConfig.url),n)}return this.authorizationServer}async getAuthorizationUrl(n){const i=await this.getAuthorizationServer();if(!i.authorization_endpoint)throw new Error(`No authorization endpoint found for oauth issuer  ${this.issuerConfig.url}.`);this.codeVerifier=vCe();const r=await ICe(this.codeVerifier);this.currentState=n?window.location.hash:Qf.getInstance().getStateToShare();const s=new URL(i.authorization_endpoint);return this.redirectUrl=this.getLoginRedirectUrl(n),s.searchParams.set("client_id",this.issuerConfig.clientId),s.searchParams.set("redirect_uri",this.redirectUrl),s.searchParams.set("response_type","code"),s.searchParams.set("scope",this.issuerConfig.scope),s.searchParams.set("code_challenge",r),s.searchParams.set("code_challenge_method",this.issuerConfig.codeChallengeMethod),n&&s.searchParams.set("prompt","none"),s}getClient(){return{client_id:this.issuerConfig.clientId,token_endpoint_auth_method:"none"}}async login(){(!this.isAuthentified()||this.hasAuthError())&&(console.debug("Auth: 1. Issuer login"),await this.redirectToIssuerLogin())}async silentLogin(){this.authProcessed()||await this.silentLoginViaIframe()}async logout(){console.debug("Auth: 5. Issuer logout"),await this.logoutFromIssuer()}getLoginRedirectUrl(n){return n?`${window.location.protocol}//${window.location.host}${window.location.pathname}silentlogincallback.html?authentified=true`:`${window.location.protocol}//${window.location.host}${window.location.pathname}?authentified=true`}getLogoutRedirectUrl(){return`${window.location.protocol}//${window.location.host}${window.location.pathname}`}async silentLoginViaIframe(){const n=await this.getAuthorizationUrl(!0);this.silentLoginIframe=document.createElement("iframe"),this.silentLoginIframe.style.display="none",this.silentLoginIframe.src=n.toString(),document.body.appendChild(this.silentLoginIframe)}async handleSilentLoggedInViaIframe(n){var i,r;if(((i=n.data)==null?void 0:i.type)==="OAUTH_CALLBACK"){const s=new URLSearchParams(n.data.data),o=new URL(window.location.href);for(const[a,c]of s.entries())o.searchParams.set(a,c);window.history.replaceState(null,"",o.toString()),await this.handleLoggedInToIssuer()}else((r=n.data)==null?void 0:r.type)==="OAUTH_ERROR"&&console.error("Silent login error",n.data.error);document.body.removeChild(this.silentLoginIframe),this.silentLoginIframe=void 0}async redirectToIssuerLogin(){const n=await this.getAuthorizationUrl(!1);window.open(n,"_self")}async handleLoggedInToIssuer(){console.debug("Auth: 2. Issuer login handle");const n=await this.getAuthorizationServer(),i=this.getClient(),r=new URL(document.URL);try{const s=mwe(n,i,r),o=await YCe(n,i,ER(),s,this.redirectUrl,this.codeVerifier),a=await JCe(n,i,o);this.setToken(a),this.state.oauth.audience=this.issuerConfig.audience,this.resetUrlHistory(!0)}catch(s){this.manageError(s)}}setToken(n){if(this.state.oauth.tokens=n,this.state.oauth.tokens.expires_in){const i=this.state.oauth.tokens.expires_in*1e3;setTimeout(()=>this.refreshToken(),i)}this.state.oauth.status="issuer.loggedIn"}resetUrlHistory(n){let i;n?i=`${window.location.protocol}//${window.location.host}${window.location.pathname}#${this.currentState}`:i=`${window.location.protocol}//${window.location.host}${window.location.pathname}?authentified=${n}#${this.currentState}`,window.history.replaceState(null,"",i)}async refreshToken(){var s;if(!((s=this.state.oauth.tokens)!=null&&s.refresh_token))throw new Error("Token cannot be refreshed : there is no refresh-token");console.debug("Refreshing token");const n=await this.getAuthorizationServer(),i=this.getClient();let r;try{const o=await VCe(n,i,ER(),this.state.oauth.tokens.refresh_token);r=await qCe(n,i,o)}catch(o){const a=`OAuth: Refresh token failed: ${o.message}`;console.error(a),this.resetUrlHistory(!1),this.loggedOutFromBackend()}r&&this.setToken(r)}manageError(n){this.state.oauth.status="loginFailed";const i=`OAuth: Issuer login failed: ${n.message}`;console.error(i),this.resetUrlHistory(!1),this.handleErrorFromIssuer()}async logoutFromIssuer(){var s;this.currentState=Qf.getInstance().getStateToShare();const n=await this.getAuthorizationServer(),i=new URL(n.end_session_endpoint),r=this.getLogoutRedirectUrl();i.searchParams.set("client_id",this.issuerConfig.clientId),i.searchParams.set("post_logout_redirect_uri",r),(s=this.state.oauth.tokens)!=null&&s.id_token&&i.searchParams.set("id_token_hint",this.state.oauth.tokens.id_token),window.open(i,"_self")}}class bwe extends Z3{get authConfig(){return this.configManager.Config.gmfauth}isAuthentified(){return new URL(window.location.href).searchParams.get("authentified")==="true"}async initialize(){this.isAuthentified()&&this.handleLoggedInToIssuer()}async login(){console.debug("Auth: 1. Issuer login"),this.redirectToIssuerLogin()}async silentLogin(){throw new Error("Silent-Login is not possible with the legacy login-workflow")}async logout(){console.debug("Auth: 5. Issuer logout"),this.state.oauth.status="loggedOut"}redirectToIssuerLogin(){const t=Qf.getInstance().getStateToShare(),n=`${window.location.protocol}//${window.location.host}${window.location.pathname}?authentified=true#${t}`,i=new URL(`${this.authConfig.url}/login.html`);i.searchParams.set("came_from",n),window.open(i,"_self")}handleLoggedInToIssuer(){console.debug("Auth: 2. Issuer login handle"),this.resetUrlHistory(!0),this.state.oauth.status="issuer.loggedIn",this.state.oauth.audience=this.authConfig.audience,this.checkConnection()}checkConnection(){setTimeout(()=>this.refreshToken(),6e5)}resetUrlHistory(t){const n=`${window.location.protocol}//${window.location.host}${window.location.pathname}${window.location.hash}`;window.history.replaceState(null,"",n)}async refreshToken(){var n;console.debug("Refreshing token");const t=`${this.authConfig.url}/loginuser`;this.state.oauth.userInfo=await fetch(t).then(i=>i.json()),(n=this.state.oauth.userInfo)!=null&&n.username?this.checkConnection():(this.resetUrlHistory(!1),this.loggedOutFromBackend())}}class Twe extends ei{constructor(n){super(n);z(this,"serviceWorker",null);z(this,"stateManager");z(this,"issuerManager");z(this,"gmfManager");this.stateManager=An.getInstance(),this.gmfManager=pCe.getInstance(),this.stateManager.subscribe("oauth.status",()=>this.loginStateChanged()),this.stateManager.subscribe("oauth.tokens",()=>this.tokensChanged())}get state(){return this.stateManager.state}async initialize(n){var s;n||console.warn("ServiceWorker cannot be initialized. Authentication won't work properly."),this.serviceWorker=n;const i=(s=fn.getInstance().Config.oauth)==null?void 0:s.issuer,r=fn.getInstance().Config.gmfauth;i?await this.initializeOAuth(i):r&&await this.initializeGmfAuth(r)}async initializeOAuth(n){var i;(i=this.serviceWorker)==null||i.postMessage({clear_access_token:!0}),this.issuerManager=ywe.getInstance(),await this.issuerManager.initialize(),n.checkSessionOnLoad&&this.state.oauth.status!=="issuer.loggedIn"&&await this.silentLogin(),n.loginRequired&&this.state.oauth.status==="loggedOut"&&await this.login()}async initializeGmfAuth(n){var i;this.issuerManager=bwe.getInstance(),await this.issuerManager.initialize(),n.checkSessionOnLoad&&(await this.gmfManager.getUserInfo(),this.state.oauth.status=(i=this.state.oauth.userInfo)!=null&&i.username?"loggedIn":"loggedOut"),n.loginRequired&&this.state.oauth.status==="loggedOut"&&await this.login()}async loginStateChanged(){var n;try{if(this.state.oauth.status==="issuer.loggedIn")if(this.state.oauth.tokens&&await this.gmfManager.loginWithToken(),await this.gmfManager.getUserInfo(),(n=this.state.oauth.userInfo)!=null&&n.username)this.state.oauth.status="loggedIn";else throw new Error("Login failed, no user found.");else this.state.oauth.status==="loggedOutForcedFromBackend"&&this.userLoggedOutFromBackend()}catch(i){throw this.state.oauth.status="loginFailed",i}}userLoggedOutFromBackend(){this.stateManager.state.infobox.elements.push({id:wu(),text:"User has been logged out.",type:"warning"})}tokensChanged(){var n,i;(i=this.serviceWorker)==null||i.postMessage({access_token:(n=this.state.oauth.tokens)==null?void 0:n.access_token})}async login(){try{await this.issuerManager.login()}catch(n){throw this.state.oauth.status="loginFailed",n}}async silentLogin(){try{console.log("silentLogin"),await this.issuerManager.silentLogin()}catch{this.state.oauth.status="loggedOut"}}async logout(){try{await this.gmfManager.logout(),await this.issuerManager.logout()}catch(n){throw this.state.oauth.status="loginFailed",n}}}class xwe extends ei{constructor(n){super(n);z(this,"configManager");z(this,"i18nManager");this.i18nManager=Jf.getInstance(),this.configManager=fn.getInstance()}get config(){return this.configManager.Config}generateCsv(n,i){if(n.length==0||i.length==0)return"";const r=i.map(a=>this.i18nManager.getTranslation(a.name)),s=this.getRow(r),o=n.map(a=>{const c=i.map(u=>a[u.name]);return this.getRow(c)});return this.config.csv.includeHeader?s+o.join(""):o.join("")}getRow(n){const i=new RegExp(this.config.csv.quote,"g"),r=this.config.csv.quote+this.config.csv.quote;return`${n.map(o=>{if(o!=null){const a=`${o}`;return`${this.config.csv.quote}${a.replace(i,r)}${this.config.csv.quote}`}else return""}).join(this.config.csv.separator)}
`}startDownload(n,i,r){const s=this.generateCsv(n,i);Y5(s,r,`text/csv;charset=${this.config.csv.encoding}`)}}class Ewe extends ei{constructor(n){super(n);z(this,"userDataManager");z(this,"customThemes",[]);z(this,"storagePath","customThemes");this.userDataManager=A_.getInstance()}addTheme(n,i){const r=new wx(n);for(const s of i){const o=s.clone();this.manageActiveStateForClonedObject(o),r.layers.push(o)}this.customThemes.push(r),this.saveCustomThemes()}manageActiveStateForClonedObject(n){if(n instanceof Hi)n.isDefaultChecked=n.active,n.activeState="off";else if(n instanceof ln||n instanceof Kn)for(const i of n.children)this.manageActiveStateForClonedObject(i)}deleteTheme(n){const i=this.customThemes.findIndex(r=>r===n);if(i>=0)this.customThemes.splice(i,1),this.saveCustomThemes();else throw new Error("The custom theme to be removed cannot be found in the list of custom themes")}saveCustomThemes(){const n={};for(const i of this.customThemes)n[i.name]=i.getSerialized();this.userDataManager.saveUserData(this.storagePath,n)}loadCustomThemes(){const n=this.userDataManager.getUserData(this.storagePath);if(n)for(const i of Object.keys(n))try{const r=new wx(i),s=n[i],o=new yD().getDeserializedLayerTree(s);r.layers.push(...o),this.customThemes.push(r)}catch(r){console.warn("Cannot deserialize custom themes from local storage"),console.warn(r)}}}function Cwe(e){const t=Object.keys(e.defs),n=t.length;let i,r;for(i=0;i<n;++i){const s=t[i];if(!Er(s)){const o=e.defs(s);let a=o.units;!a&&o.projName==="longlat"&&(a="degrees"),$U(new px({code:s,axisOrientation:o.axis,metersPerUnit:o.to_meter,units:a}))}}for(i=0;i<n;++i){const s=t[i],o=Er(s);for(r=0;r<n;++r){const a=t[r],c=Er(a);if(!XU(s,a))if(e.defs[s]===e.defs[a])YU([o,c]);else{const u=e(s,a);KU(o,c,dS(o,c,u.forward),dS(c,o,u.inverse))}}}}class fz extends ei{constructor(n){super(n);z(this,"serviceWorker",null);z(this,"database");z(this,"map");z(this,"stateManager");z(this,"configManager");z(this,"totalLength",0);z(this,"counter",0);z(this,"progressCallback");z(this,"storeVersion");z(this,"dbCacheName");z(this,"tilesStoreName","tiles");z(this,"bboxStoreName","bbox");z(this,"vectorLayer",new du({style:new ps({stroke:new Pr({color:"red",width:5})})}));this.stateManager=An.getInstance(),this.configManager=fn.getInstance(),this.map=eC.getInstance().getMap(),this.map.addLayer(this.vectorLayer)}get state(){return this.stateManager.state}initializeOfflineState(n){this.registerEvents(),this.stateManager.state.isOffline=n}registerEvents(){window.addEventListener("offline",()=>{this.state.isOffline=!0}),window.addEventListener("online",()=>{this.state.isOffline=!1}),this.stateManager.subscribe("isOffline",()=>{this.switchOffline()})}async exportWMTSTiles(n,i,r){this.progressCallback=r,await this.saveBoundingBox(n);const s=this.getAllTileUrls(n,i);await this.fetchAndSaveTiles(s)}async openIndexedDB(){return new Promise((n,i)=>{console.debug("Opening IndexedDB");const r=indexedDB.open(this.dbCacheName,this.storeVersion);let s=!1;const o=setTimeout(()=>{s=!0,console.debug("Timeout while opening IndexedDB"),i(new Error("Timeout while opening IndexedDB"))},3e3);r.onerror=a=>{var c;if(!s){clearTimeout(o);const u=(c=a.target.error)==null?void 0:c.message;console.debug(`IndexedDB could not be opened : ${u}`),i(new Error(u))}},r.onsuccess=a=>{s||(clearTimeout(o),console.debug("IndexedDB is open"),n(a.target.result))},r.onupgradeneeded=a=>{console.debug("Upgrading IndexedDB");const c=a.target.result;c.createObjectStore("tiles",{autoIncrement:!0}).createIndex("url","url",{unique:!0}),c.createObjectStore("bbox",{autoIncrement:!0}),console.debug("IndexedDB upgraded."),n(c)}})}async setServiceWorker(n,i,r){if(!n){console.warn("ServiceWorker cannot be initialized. Offline functionalities won't be available.");return}this.serviceWorker=n,this.storeVersion=i,this.dbCacheName=r,this.database=await this.openIndexedDB(),await this.configManager.loadConfig(),this.serviceWorker.postMessage({storeVersion:this.storeVersion,dbCacheName:this.dbCacheName,tilesStoreName:this.tilesStoreName})}switchOffline(){this.stateManager.state.isOffline?this.displayBoundBoxes():this.vectorLayer&&this.vectorLayer.setSource(null)}getAllTileUrls(n,i){var s;const r=[];for(const o of i){const a=(s=o._olayer)==null?void 0:s.getSource();if(a){const c=a.getTileGrid();c&&r.push(...this.getTileUrlsForWmtsLayer(c,n,a))}}return r}getTileUrlsForWmtsLayer(n,i,r){var u;const s=n.getMinZoom(),o=(u=fn.getInstance().Config.offline)==null?void 0:u.downloadEndZoom;if(!o)throw new Error("Offline configuration is missing. Cannot download maps for offline usage.");const a=r.getProjection(),c=[];for(let h=s;h<=o;h++){const d=n.getTileRangeForExtentAndZ(i,h);for(let p=d.minX;p<=d.maxX;++p)for(let g=d.minY;g<=d.maxY;++g){const _=r.getTileUrlFunction()([h,p,g],window.devicePixelRatio,a);_&&c.push(_)}}return c}async fetchAndSaveTiles(n){this.totalLength=n.length,console.debug(`Number of Tile to load: ${this.totalLength}`);const i=n.values();this.counter=0;const r=Array(4).fill(i).map(s=>this.doWork(s));Promise.allSettled(r).then(()=>{console.debug("Everything downloaded."),this.progressCallback&&this.progressCallback(100)})}async doWork(n){for(const i of n){const r=await fetch(i);r.ok&&r.blob().then(s=>{const a=this.database.transaction([this.tilesStoreName],"readwrite").objectStore(this.tilesStoreName),u=a.index("url").getKey(i);u.onsuccess=()=>{let h;if(u.result){const d=u.result;h=a.put({url:i,data:s},d)}else h=a.put({url:i,data:s});h.onsuccess=()=>{this.progressCallback&&this.progressCallback(Math.round(this.counter*100/this.totalLength)),console.debug(`${this.counter++}/${this.totalLength} Tile ${i} added.`)},h.onerror=()=>{console.error(`Error while saving tile ${i}`)}}})}}async saveBoundingBox(n){this.database===void 0&&(this.database=await this.openIndexedDB());const s=this.database.transaction([this.bboxStoreName],"readwrite").objectStore(this.bboxStoreName).put(n);s.onsuccess=()=>{console.debug("BBOX Added to store")},s.onerror=()=>{console.error("Error while saving bbox")}}async displayBoundBoxes(){this.database===void 0&&(this.database=await this.openIndexedDB());const r=this.database.transaction([this.bboxStoreName],"readonly").objectStore(this.bboxStoreName).getAll();r.onsuccess=()=>{const s=new $a;if(r.result)for(const o of r.result){const a=new kR({geometry:ZU(o)});s.addFeature(a)}this.vectorLayer.setSource(s)},r.onerror=()=>{console.error("Error while saving bbox")}}}class Vg{constructor(t){z(this,"id");z(this,"name");z(this,"thumbnail");z(this,"layersList",[]);var n;this.id=t.id,this.name=t.name,this.thumbnail=((n=t.metadata)==null?void 0:n.thumbnail)??"images/basemap_default.png"}get projection(){return this.layersList[0]instanceof yh&&this.layersList[0].projection?this.layersList[0].projection:null}}class AR extends ei{constructor(n){super(n);z(this,"configManager");z(this,"stateManager");z(this,"layerManager");z(this,"shareManager");z(this,"customThemesManager");z(this,"isInitializingForUserInfo",new WeakMap);z(this,"anonymousUserInfo",{u:"anonymous"});this.configManager=fn.getInstance(),this.stateManager=An.getInstance(),this.layerManager=Eh.getInstance(),this.shareManager=Qf.getInstance(),this.customThemesManager=Ewe.getInstance(),this.stateManager.subscribe("oauth.userInfo",()=>{this.initialize()})}get state(){return this.stateManager.state}async initialize(){const n=this.state.oauth.userInfo??this.anonymousUserInfo;if(!this.isInitializingForUserInfo.get(n)){this.isInitializingForUserInfo.set(n,!0);try{await this.configManager.loadConfig(),await this.loadThemes(),console.log("Themes were loaded"),this.shareManager.hasSharedState()?this.shareManager.setStateFromUrl():this.setDefaultTheme()}catch(i){console.error(i),await window.gAlert("An error occurred while loading the themes. This has nothing to do with GeoGirafe and is very probably a backend-configuration error (wrong content in themes.json, or CORS error). Please check the backend configuration.","Backend error"),await window.gAlert("This instance of GeoGirafe cannot be used at the moment.","Backend error"),console.error(i)}finally{this.isInitializingForUserInfo.set(n,!1)}}}async loadThemes(){this.state.themes.isLoaded=!1;const i=await(await fetch(this.configManager.Config.themes.url)).json();if(this.state.ogcServers=this.prepareOgcServers(i.ogcServers),this.configManager.Config.basemaps.show&&(this.state.basemaps=this.prepareBasemaps(i.background_layers)),this.state.themes._allThemes=this.prepareThemes(i.themes),this.customThemesManager.loadCustomThemes(),this.state.themes.isLoaded=!0,this.configManager.Config.themes.showErrorsOnStart)for(const r of i.errors)I_.getInstance().pushMessage(wu(),r,"error")}setDefaultTheme(){if(!this.isNullOrUndefinedOrBlank(this.configManager.Config.themes.defaultTheme)){const i=[...Object.values(this.state.themes._allThemes),...Object.values(this.customThemesManager.customThemes)].find(r=>r.name===this.configManager.Config.themes.defaultTheme);i?this.state.themes.lastSelectedTheme=i:console.warn(`The default theme ${this.configManager.Config.themes.defaultTheme} could not be found.`)}}prepareOgcServers(n){const i={};if(n){for(const r of Object.keys(n)){const s=new j3(r,n[r]);i[r]=s}this.preloadWfsServer(i)}return i}async preloadWfsServer(n){for(const i of Object.values(n))i.wfsSupport&&await LA.getInstance().getServerWfs(i)}prepareBasemaps(n){const i={},r={isLegendExpanded:!1,wasLegendExpanded:!1,exclusiveGroup:!1,isExpanded:!1,isChecked:!1};if(this.configManager.Config.basemaps.emptyBasemap){const s=new Vg({id:0,name:"Empty",metadata:{...r,thumbnail:"images/basemap_empty.png"}});i[s.id]=s}if(this.configManager.Config.basemaps.OSM){const s=new Vg({id:-1,name:"OpenStreetMap",metadata:{...r,thumbnail:"images/basemap_osm.png"}});i[s.id]=s,s.layersList.push(new Bp(0))}if(this.configManager.Config.basemaps.SwissTopoVectorTiles){const s=new Vg({id:-2,name:"Vector-Tiles",metadata:{...r,thumbnail:"images/basemap_vectortiles.png"}});i[s.id]=s;const o=new yh(V3.LayerSwisstopoVectorTilesId,"Vector-Tiles",0,"https://vectortiles.geo.admin.ch/styles/ch.swisstopo.leichte-basiskarte.vt/style.json","leichtebasiskarte_v3.0.1",{projection:"EPSG:3857"});s.layersList.push(o)}return n.forEach(s=>{const o=new Vg(s);i[o.id]=o;const a={value:0};if(s.children)s.children.forEach(c=>{const u=this.prepareThemeLayer(c,null,a);u&&o.layersList.push(u)});else{const c=this.prepareThemeLayer(s,null,a);c&&o.layersList.push(c)}}),i}prepareThemes(n){const i={},r={value:0};return n.forEach((s,o)=>{!s.icon.startsWith("http")&&this.configManager.Config.themes.imagesUrlPrefix&&(s.icon=this.configManager.Config.themes.imagesUrlPrefix+s.icon);const a=new Kn(s.id,s.name,o,s.icon,s.metadata);s.children.forEach(c=>{const u=this.prepareThemeLayer(c,null,r);u&&(u.parent=a,a.children.push(u))}),i[o]=a}),i}prepareThemeLayer(n,i,r){var a,c,u,h,d,p,g,_,b;const s=n.ogcServer?n.ogcServer:i;let o=null;switch(n.type){case"OSM":{o=new Bp(r.value);break}case"VectorTiles":{const x={projection:n.projection,isDefaultChecked:(a=n.metadata)==null?void 0:a.isChecked,disclaimer:(c=n.metadata)==null?void 0:c.disclaimer,opacity:1};o=new yh(n.id,n.name,r.value,n.style,n.source,x);break}case"WMTS":{const x=(u=n.metadata)!=null&&u.ogcServer?this.state.ogcServers[(h=n.metadata)==null?void 0:h.ogcServer]:void 0;o=new ca(n.id,n.name,r.value,n.url,n.layer,n,x);break}case"WMS":{if(s){const x=this.state.ogcServers[s];o=new ji(n.id,n.name,r.value,x,n)}else I_.getInstance().pushMessage(wu(),`Layer ${n.name} (id=${n.id}) is invalid and cannot be created: missing OGC-Server.`,"error");break}case"COG":{o=new pl(n.id,n.name,r.value,n.url,n);break}case"XYZ":{o=new ml(n.id,n.name,r.value,n.url,n);break}default:{const x={isDefaultChecked:(d=n.metadata)==null?void 0:d.isChecked,metadataUrl:(p=n.metadata)==null?void 0:p.metadataUrl,disclaimer:(g=n.metadata)==null?void 0:g.disclaimer,isDefaultExpanded:(_=n.metadata)==null?void 0:_.isExpanded,isExclusiveGroup:(b=n.metadata)==null?void 0:b.exclusiveGroup,time:n.time},E=new ln(n.id,n.name,r.value,x);n.children&&n.children.forEach(C=>{x.time&&(C.time={...x.time});const w=this.prepareThemeLayer(C,s,r);w&&(w.parent=E,E.children.push(w))}),o=E}}return r.value=r.value+1,o}}class wwe extends ei{constructor(n){super(n);z(this,"configManager");z(this,"defaultDebug",console.debug);z(this,"defaultLog",console.log);z(this,"defaultInfo",console.info);z(this,"defaultWarn",console.warn);z(this,"defaultError",console.error);this.configManager=fn.getInstance()}async initLogging(){await this.configManager.loadConfig(),console.debug=this.debug.bind(this),console.log=this.log.bind(this),console.info=this.info.bind(this),console.warn=this.warn.bind(this),console.error=this.error.bind(this)}debug(n,...i){return this.configManager.Config.general.logLevel==="debug"?(this.defaultDebug(n,...i),!0):!1}log(n,...i){return this.configManager.Config.general.logLevel==="debug"||this.configManager.Config.general.logLevel==="info"?(this.defaultLog(n,...i),!0):!1}info(n,...i){return this.configManager.Config.general.logLevel==="debug"||this.configManager.Config.general.logLevel==="info"?(this.defaultInfo(n,...i),!0):!1}warn(n,...i){return this.configManager.Config.general.logLevel==="debug"||this.configManager.Config.general.logLevel==="info"||this.configManager.Config.general.logLevel==="warn"?(this.defaultWarn(n,...i),!0):!1}error(n,...i){return this.defaultError(n,...i),!0}}class Awe extends ei{constructor(n){super(n);z(this,"stateManager");z(this,"timeoutId");this.stateManager=An.getInstance(),this.registerEvents()}get state(){return this.stateManager.state}registerEvents(){this.stateManager.subscribe("layers.layersList",()=>this.reorderLayers()),this.stateManager.subscribe(/layers\.layersList\..*\.children/,()=>this.reorderLayers()),this.stateManager.subscribe(/layers\.layersList\..*\.order/,()=>this.reorderLayers())}reorderLayers(){this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{const n=this.getSortedLayers(this.state.layers.layersList),i={index:1e3};this.reorderLayersRecursively(n,i)})}reorderLayersRecursively(n,i){for(const r of n)if(console.log(`Setting layer ${r.name} to order=${i.index}`),r.order=i.index++,r instanceof ln||r instanceof Kn){const s=this.getSortedLayers(r.children);this.reorderLayersRecursively(s,i)}}getSortedLayers(n){return n.slice().sort((r,s)=>r.order-s.order)}}async function Swe(){const e=await navigator.serviceWorker.register("service-worker.js");if(e.active)return e.active;const t=e.installing||e.waiting;if(!t)throw new Error("No service worker is installing or waiting.");return new Promise(n=>{t.addEventListener("statechange",function i(){t.state==="activated"&&(t.removeEventListener("statechange",i),n(t))})})}async function vwe(){var o,a;const t="geogirafe-cache";if(!(navigator!=null&&navigator.serviceWorker)){console.warn("Service worker could not be initialized. Authentication and offline maps won't work");return}let n;try{n=await Swe()}catch{console.warn("Service worker could not be initialized. Authentication and offline maps won't work");return}const i=fn.getInstance().Config;n.postMessage({logLevel:i.general.logLevel});const r=((o=i.oauth)==null?void 0:o.issuer)??i.gmfauth,s=((a=i.oauth)==null?void 0:a.geomapfish)??i.gmfauth;if(r&&s){const c=new URL(r.url).hostname,u=[...r.audience,c];n.postMessage({audience:u,audienceExcludedPaths:r.audienceExcludedPaths,authMode:s.authMode,refererPolicy:s.refererPolicy})}await fz.getInstance().setServiceWorker(n,6,t),await Twe.getInstance().initialize(n)}async function oAe(){await fn.getInstance().loadConfig(),await wwe.getInstance().initLogging(),window.CESIUM_BASE_URL="lib/cesium/",fn.getInstance().Config.crs.forEach(e=>{zr.defs(e.code,e.definition)}),Cwe(zr),await vwe(),I_.getInstance(),xwe.getInstance(),Jf.getInstance(),LA.getInstance(),Awe.getInstance(),await AR.getInstance().initialize(),document.geogirafe={state:An.getInstance().state,stateManager:An.getInstance(),shareManager:Qf.getInstance(),offlineManager:fz.getInstance(),themesManager:AR.getInstance(),configManager:fn.getInstance()}}export{Wwe as $,Twe as A,ca as B,fn as C,QE as D,fe as E,Vs as F,b4 as G,fa as H,Jf as I,ue as J,hy as K,ji as L,eC as M,Kwe as N,Ywe as O,w7 as P,Xwe as Q,rAe as R,An as S,nAe as T,hD as U,tAe as V,LA as W,iAe as X,Zwe as Y,xwe as Z,nD as _,Dwe as a,xi as a$,Qf as a0,Ewe as a1,On as a2,ed as a3,q5 as a4,qwe as a5,ei as a6,Eh as a7,Ly as a8,Hi as a9,Tl as aA,Kp as aB,Mo as aC,zt as aD,Vr as aE,fs as aF,te as aG,Js as aH,Qt as aI,Pu as aJ,Lt as aK,Ht as aL,Fe as aM,Mn as aN,os as aO,Y as aP,Ge as aQ,qi as aR,Cs as aS,re as aT,H as aU,$t as aV,Oo as aW,ft as aX,Iu as aY,Jp as aZ,Ot as a_,Kn as aa,ln as ab,oAe as ac,fz as ad,D4 as ae,y as af,l as ag,ie as ah,ee as ai,T as aj,P as ak,nt as al,sl as am,q as an,A as ao,et as ap,Jn as aq,st as ar,wr as as,Dn as at,Ur as au,ur as av,Xp as aw,jt as ax,se as ay,En as az,_D as b,Di as b$,ar as b0,kr as b1,Ar as b2,br as b3,Sr as b4,ss as b5,iq as b6,qn as b7,ah as b8,wt as b9,De as bA,$i as bB,Ae as bC,pc as bD,As as bE,yn as bF,tm as bG,$n as bH,Lu as bI,Bt as bJ,ce as bK,mc as bL,ro as bM,bn as bN,rc as bO,Ks as bP,zP as bQ,Qs as bR,Sp as bS,ba as bT,Ln as bU,cw as bV,on as bW,an as bX,hs as bY,vs as bZ,Ke as b_,BX as ba,Co as bb,xl as bc,Nd as bd,Wc as be,Te as bf,Rt as bg,z_ as bh,Ye as bi,Do as bj,B$ as bk,j as bl,Tt as bm,vp as bn,as as bo,kn as bp,it as bq,Je as br,Tn as bs,Ie as bt,dc as bu,We as bv,Dh as bw,kt as bx,Le as by,Fu as bz,Qwe as c,m$ as c$,Uo as c0,cs as c1,Ue as c2,ac as c3,oa as c4,vw as c5,no as c6,io as c7,Gs as c8,fh as c9,Lo as cA,wo as cB,It as cC,wi as cD,Ei as cE,Qe as cF,yt as cG,Qc as cH,Rf as cI,dw as cJ,of as cK,Ps as cL,Kc as cM,So as cN,vr as cO,Ve as cP,at as cQ,Q as cR,Gr as cS,ct as cT,QY as cU,F2 as cV,$1 as cW,Jt as cX,sc as cY,ir as cZ,Ip as c_,Df as ca,Vt as cb,ko as cc,gme as cd,Yp as ce,Se as cf,rq as cg,sq as ch,Wi as ci,eq as cj,di as ck,Rn as cl,Ct as cm,ya as cn,ze as co,Cn as cp,ii as cq,Ut as cr,ws as cs,hc as ct,jn as cu,Xy as cv,ut as cw,cc as cx,hh as cy,vt as cz,Y5 as d,Mu as d$,No as d0,Hr as d1,oi as d2,yB as d3,bye as d4,Re as d5,roe as d6,wn as d7,cB as d8,Xi as d9,YJ as dA,$L as dB,Ipe as dC,Ope as dD,ite as dE,rte as dF,ste as dG,Coe as dH,lw as dI,nte as dJ,Hme as dK,z0e as dL,U0e as dM,$I as dN,Wge as dO,qge as dP,Dge as dQ,c1 as dR,_o as dS,lh as dT,Ih as dU,Zp as dV,em as dW,xp as dX,AC as dY,Cr as dZ,SC as d_,JY as da,xn as db,Ac as dc,gF as dd,en as de,Hn as df,CC as dg,Rw as dh,zu as di,B0e as dj,F0e as dk,Ca as dl,VT as dm,aa as dn,xs as dp,c_ as dq,es as dr,e_ as ds,ja as dt,dh as du,Mh as dv,ow as dw,sw as dx,lK as dy,dK as dz,m as e,Il as e$,W_ as e0,LC as e1,vM as e2,Gf as e3,Xa as e4,nn as e5,Dl as e6,cr as e7,wl as e8,Io as e9,tt as eA,Mf as eB,wa as eC,Aa as eD,zn as eE,bi as eF,MB as eG,js as eH,Ro as eI,uw as eJ,Hw as eK,si as eL,ts as eM,Ll as eN,Pf as eO,bB as eP,ri as eQ,sr as eR,pm as eS,EB as eT,ju as eU,ob as eV,xB as eW,CB as eX,pa as eY,pi as eZ,vl as e_,$C as ea,Oh as eb,sh as ec,mn as ed,Rh as ee,Gt as ef,KC as eg,qL as eh,YC as ei,vh as ej,Wy as ek,JH as el,ZY as em,zy as en,QH as eo,$y as ep,gs as eq,yM as er,Fx as es,RC as et,Nx as eu,cq as ev,dM as ew,eK as ex,Q_ as ey,Jr as ez,sj as f,Cc as f$,so as f0,xc as f1,ph as f2,Yw as f3,Fo as f4,ye as f5,va as f6,GT as f7,ol as f8,Ya as f9,ty as fA,ey as fB,Sl as fC,cl as fD,rm as fE,_f as fF,Be as fG,lo as fH,Si as fI,Bh as fJ,Po as fK,yi as fL,tb as fM,HN as fN,mi as fO,eb as fP,lm as fQ,Ai as fR,cm as fS,ai as fT,Oe as fU,ys as fV,Ru as fW,zo as fX,rae as fY,xa as fZ,dm as f_,ha as fa,Ka as fb,Za as fc,Ts as fd,Ta as fe,ll as ff,Ja as fg,Qa as fh,ns as fi,Ea as fj,sy as fk,Lh as fl,Du as fm,Nl as fn,Vo as fo,Ir as fp,Z_ as fq,Ia as fr,Ti as fs,gc as ft,Tr as fu,Bu as fv,jh as fw,Al as fx,Li as fy,He as fz,Jwe as g,Jue as g$,fb as g0,Ec as g1,co as g2,oo as g3,wc as g4,Vh as g5,Y_ as g6,bc as g7,jo as g8,rr as g9,SQ as gA,vQ as gB,IQ as gC,OQ as gD,RQ as gE,DQ as gF,MQ as gG,LQ as gH,PQ as gI,NQ as gJ,FQ as gK,iue as gL,rue as gM,Uue as gN,zue as gO,jue as gP,kue as gQ,Vue as gR,Gue as gS,Ofe as gT,Rfe as gU,sue as gV,gue as gW,_ue as gX,yue as gY,Gfe as gZ,qfe as g_,Pl as ga,yc as gb,ao as gc,Sa as gd,Me as ge,eo as gf,gm as gg,sb as gh,aB as gi,qw as gj,_u as gk,Uu as gl,Loe as gm,Moe as gn,ZQ as go,JQ as gp,QQ as gq,eee as gr,U0 as gs,bQ as gt,TQ as gu,xQ as gv,EQ as gw,CQ as gx,wQ as gy,AQ as gz,gx as h,Pw as h$,Que as h0,hue as h1,mue as h2,pue as h3,fue as h4,Lle as h5,Hhe as h6,qhe as h7,Whe as h8,Ple as h9,mN as hA,are as hB,mre as hC,Tre as hD,Ere as hE,Mi as hF,D2 as hG,g2 as hH,ul as hI,M2 as hJ,P2 as hK,Nw as hL,L2 as hM,Vi as hN,tp as hO,Mt as hP,fl as hQ,Ii as hR,tc as hS,_2 as hT,x2 as hU,oy as hV,W2 as hW,$2 as hX,dt as hY,Un as hZ,Vhe as h_,the as ha,hhe as hb,Ehe as hc,xhe as hd,Y1 as he,Phe as hf,Bhe as hg,Pce as hh,K as hi,yre as hj,ere as hk,dre as hl,om as hm,gw as hn,Ao as ho,yw as hp,_N as hq,Nh as hr,_w as hs,hre as ht,pre as hu,sm as hv,rre as hw,bre as hx,nE as hy,nre as hz,Rwe as i,kK as i$,Lw as i0,_c as i1,ib as i2,Fw as i3,y2 as i4,b2 as i5,Xc as i6,nb as i7,ku as i8,ti as i9,Eu as iA,fu as iB,Lp as iC,m2 as iD,cF as iE,lF as iF,tue as iG,Wde as iH,xK as iI,EK as iJ,CK as iK,wK as iL,AK as iM,SK as iN,vK as iO,IK as iP,OK as iQ,RK as iR,DK as iS,MK as iT,LK as iU,PK as iV,NK as iW,FK as iX,BK as iY,zK as iZ,UK as i_,Xhe as ia,Bw as ib,T2 as ic,Ghe as id,zh as ie,uF as ig,Is as ih,ay as ii,zw as ij,f_ as ik,Uh as il,Or as im,je as io,tr as ip,$he as iq,I2 as ir,Y2 as is,hl as it,Z2 as iu,um as iv,J2 as iw,Yhe as ix,Q2 as iy,oF as iz,R as j,rJ as j$,jK as j0,VK as j1,GK as j2,HK as j3,qK as j4,WK as j5,$K as j6,XK as j7,YK as j8,KK as j9,DZ as jA,MZ as jB,LZ as jC,PZ as jD,NZ as jE,FZ as jF,BZ as jG,zZ as jH,UZ as jI,kZ as jJ,jZ as jK,VZ as jL,GZ as jM,HZ as jN,qZ as jO,WZ as jP,$Z as jQ,XZ as jR,YZ as jS,KZ as jT,ZZ as jU,JZ as jV,QZ as jW,eJ as jX,tJ as jY,nJ as jZ,iJ as j_,ZK as ja,JK as jb,QK as jc,eZ as jd,tZ as je,nZ as jf,iZ as jg,rZ as jh,dZ as ji,pZ as jj,mZ as jk,gZ as jl,_Z as jm,yZ as jn,bZ as jo,TZ as jp,xZ as jq,EZ as jr,CZ as js,wZ as jt,AZ as ju,SZ as jv,vZ as jw,IZ as jx,OZ as jy,RZ as jz,Qp as k,sJ as k0,oJ as k1,aJ as k2,cJ as k3,lJ as k4,uJ as k5,fJ as k6,hJ as k7,dJ as k8,pJ as k9,jJ as kA,VJ as kB,GJ as kC,HJ as kD,qJ as kE,WJ as kF,$J as kG,XJ as kH,sZ as kI,oZ as kJ,aZ as kK,cZ as kL,lZ as kM,uZ as kN,fZ as kO,hZ as kP,PTe as kQ,Gwe as kR,Hwe as kS,mJ as ka,gJ as kb,_J as kc,yJ as kd,bJ as ke,TJ as kf,xJ as kg,EJ as kh,CJ as ki,wJ as kj,AJ as kk,SJ as kl,vJ as km,IJ as kn,OJ as ko,RJ as kp,DJ as kq,MJ as kr,LJ as ks,PJ as kt,NJ as ku,FJ as kv,BJ as kw,zJ as kx,UJ as ky,kJ as kz,oe as l,M as m,k as n,Mwe as o,zr as p,O4 as q,sAe as r,I_ as s,lCe as t,$we as u,wu as v,Nk as w,il as x,A_ as y,S_ as z};
//# sourceMappingURL=initialize-6doIkexO.js.map
