var Ga=Object.defineProperty;var is=g=>{throw TypeError(g)};var Ba=(g,t,e)=>t in g?Ga(g,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):g[t]=e;var l=(g,t,e)=>Ba(g,typeof t!="symbol"?t+"":t,e),rs=(g,t,e)=>t.has(g)||is("Cannot "+e);var Ur=(g,t,e)=>(rs(g,t,"read from private field"),e?e.call(g):t.get(g)),ns=(g,t,e)=>t.has(g)?is("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(g):t.set(g,e),ss=(g,t,e,i)=>(rs(g,t,"write to private field"),i?i.call(g,e):t.set(g,e),e);import{G as Y,h as _,f as Ua,C as je,p as Er,M as Kt,I as Vt,g as lt,d as ye,v as jt,U as fn,S as ae,i as ja,a as qa,D as Dt,b as C,c as Ne,H as Ha,e as D,E as jr,J as as,j as Qi,k as As,l as ge,m as Se,n as Ya,P as Wa,o as _t,q as Xa,r as Fs,s as Za,t as Li,u as Ai,w as ui,x as on,y as Os,z as Ka,A as Qa,L as Tt,B as mi,F as at,K as Xi,N as Ds,O as zs,Q as Ja,R as Oe,T as ln,V as Fi,W as to,X as eo,Y as io,Z as Vs,_ as ro,$ as no,a0 as so,a1 as $s,a2 as bn,a3 as ao,a4 as oo,a5 as lo,a6 as go,a7 as Ji,a8 as os,a9 as qr,aa as De,ab as de,ac as co}from"./initialize-6doIkexO.js";import{O as Gs,P as vn,F as Bs,T as Us,C as yi,f as et,s as ue,V as Ht,a as ie,n as yn,b as gn,c as ho,I as uo,E as tr,M as Lt,d as mo,e as yt,g as er,h as bt,i as Et,L as ct,j as ls,k as xi,l as qe,m as He,o as js,p as qs,q as po,B as xn,r as oe,G as Hs,t as fo,u as Ys,v as Ws,w as gs,x as bo,y as vo,z as yo,A as xo,D as wn,H as wo,J as _o,R as Xs,K as ir,N as rr,Q as nr,S as Hr,U as Mt,W as fe,X as sr,Y as ko,Z as Zs,_ as Ks,$ as So,a0 as Qs,a1 as Eo,a2 as Js,a3 as oi,a4 as Yr,a5 as Co,a6 as Io,a7 as ar,a8 as Lo,a9 as ta,aa as ce,ab as cn,ac as hn,ad as ea,ae as ia,af as _n,ag as Ye,ah as H,ai as Oi,aj as Di,ak as To,al as Mo,am as cs,an as li,ao as hs,ap as No,aq as ds,ar as Po,as as Ro,at as Wr,au as gi,av as Ao,aw as Fo,ax as Oo,ay as Do,az as zo,aA as Vo,aB as $o,aC as ra,aD as Go,aE as na,aF as us,aG as Bo,aH as Uo,aI as jo,aJ as qo,aK as Ho,aL as Yo,aM as Wo,aN as Xo,aO as Zo,aP as Ko,aQ as Qo,aR as sa,aS as ms,aT as ps,aU as zi,aV as fs,aW as Xr,aX as Jo,aY as Vi,aZ as tl,a_ as el,a$ as il,b0 as rl,b1 as bs,b2 as Zi,b3 as nl,b4 as sl,b5 as or,b6 as al}from"./lazy-CXj0l6bG.js";import{B as ll,I as gl}from"./component-DXCLPdaI.js";import{f as lr,p as cl,G as aa,S as hl}from"./component-Boz-e6Z0.js";import{S as dl,a as Le,E as vt,b as ul,e as ml,C as wi}from"./exportKml-B8RxacOT.js";class pl extends Y{constructor(){super("about");l(this,"template",()=>_`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style><style>
#panel{color:var(--text-color)}#panel>div{padding:1rem}img.logo{filter:var(--svg-filter);height:4rem;opacity:.8}
</style>
<div id="panel">
  <div>
    <img class="logo" alt="geogirafe-logo" src="images/logo/horizontal_black.svg" />
    <p>
      <span i18n="Version">Version</span> : ${this.version}<br />
      <span i18n="Build">Build</span> : ${this.build}<br />
      <span i18n="Date">Date</span> : ${this.date}
    </p>

    <p>
      <span i18n="Source">Source</span> :
      <a href="https://gitlab.com/geogirafe/gg-viewer" i18n="GitLab" rel="noopener" target="_blank">GitLab</a>
    </p>
  </div>
</div>
`);l(this,"visible",!1);l(this,"loaded",!1);l(this,"version");l(this,"build");l(this,"date")}async loadVersionInfos(){if(this.loaded)return;const e=await fetch("about.json"),{version:i,build:r,date:n}=await e.json();this.version=i,this.build=r,this.date=n,this.loaded=!0,this.render()}registerEvents(){this.subscribe("interface.aboutPanelVisible",(e,i)=>this.togglePanel(i))}togglePanel(e){this.visible=e,e&&this.loadVersionInfos(),this.render()}connectedCallback(){this.loadConfig().then(()=>{this.render(),this.registerEvents()})}render(){this.visible?super.render():this.hide(),super.girafeTranslate()}}var Ue;class fl extends Y{constructor(){super("coordinate");l(this,"template",()=>_`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style>
<label for="coordinates" class="${this.east?"gg-label":"hidden"}">E ${this.east} / N ${this.north}</label>
`);ns(this,Ue);l(this,"east",null);l(this,"north",null)}get locale(){if(!Ur(this,Ue))throw new Error("You called locale before render");return Ur(this,Ue)}render(){super.render(),ss(this,Ue,this.configManager.Config.general.locale)}registerEvents(){this.subscribe("mouseCoordinates",(e,i)=>this.onChangeCoordinates(i))}onChangeCoordinates(e){[this.east,this.north]=lr(e,this.locale),this.render()}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}}Ue=new WeakMap;function bl(g){const t=g.getTiePoints()[0],e=g.getFileDirectory().ModelPixelScale;return{tiePoint:t,pixelScale:e}}function vl(g,t,e){const i=Math.round((t-g.tiePoint.x)/g.pixelScale[0]),r=Math.round((g.tiePoint.y-e)/g.pixelScale[1]);return[i,r]}async function yl(g){return await(await Ua(g)).getImage()}async function xl(g,t,e){const[i,r]=vl(t,e[0],e[1]),n=[i,r,i+1,r+1],s=g.getWidth(),a=g.getHeight();let o;return i>=0&&i<s&&r>=0&&r<a?o=(await g.readRasters({samples:[0],window:n}))[0][0]:o=null,o}class wl{constructor(t){l(this,"MapContextMenuState");l(this,"sources");l(this,"rasters");this.MapContextMenuState=t,this.sources=je.getInstance().Config.contextmenu.sources,this.rasters=[],this.init()}init(){this.sources.forEach(async t=>{const e={id:t.id,url:t.url,type:"COG",crs:t.crs,label:t.translation,image:null,transform:null,pixelvalue:null,pixelstring:null,prefix:t.prefix,suffix:t.suffix,precision:t.precision};this.rasters.push(e),this.MapContextMenuState.sources.push({id:t.id,url:t.url,crs:t.crs,translation:t.translation,content:null});try{const i=await yl(t.url),r=bl(i);e.image=i,e.transform=r}catch(i){console.error(`Failed to load raster ${t.id}:`,i)}})}reset(){this.rasters.forEach(t=>{t.pixelvalue=null,t.pixelstring=null}),this.MapContextMenuState.sources.forEach(t=>{t.content=null})}refresh(t,e){this.reset(),this.rasters.forEach(async i=>{if(!(!i.image||!i.transform))try{const[r,n]=Er(t,i.crs,e),s=await xl(i.image,i.transform,[r,n]);i.pixelvalue=s,i.pixelstring=s!=null?`${i.prefix}${s.toFixed(i.precision)}${i.suffix}`:null;const a=this.MapContextMenuState.sources.find(o=>o.id===i.id);a&&(a.content=i.pixelstring)}catch(r){console.warn(`Failed to query raster source: ${i.url}:`,r)}})}}class _l{constructor(){l(this,"position",null);l(this,"projection",null);l(this,"crs",[]);l(this,"sources",[])}}class kl extends Y{constructor(){super("map-context-menu");l(this,"templateUrl",null);l(this,"styleUrls",null);l(this,"map");l(this,"eventsCallbacks",[]);l(this,"MapContextMenuState");l(this,"rasterQueryManager");this.state.extendedState.mapcontextmenu=new _l,this.MapContextMenuState=this.state.extendedState.mapcontextmenu,this.MapContextMenuState.crs=je.getInstance().Config.contextmenu.crs,this.map=Kt.getInstance().getMap(),this.rasterQueryManager=new wl(this.MapContextMenuState)}async updateData(){this.MapContextMenuState.position=this.state.mouseCoordinates,this.MapContextMenuState.projection=this.state.projection,this.rasterQueryManager.refresh(this.MapContextMenuState.projection,this.MapContextMenuState.position)}showContextMenu(e,i,r){let n=this.map.getOverlayById(e);n&&this.map.removeOverlay(n);const s=document.createElement(r);s.container=this,n=new Gs({id:e,element:s,position:i,autoPan:{animation:{duration:250}}}),this.map.addOverlay(n)}hideContextMenu(e){const i=this.map.getOverlayById(e);i&&i.setPosition(void 0)}registerEvents(){this.registerInteractionListener("map.contextmenu",!1)&&this.map.getViewport().addEventListener("contextmenu",async e=>{this.canExecute("map.contextmenu")&&(e.preventDefault(),await this.updateData(),this.showContextMenu("default-overlay",this.MapContextMenuState.position,"girafe-default-context-menu-content"))}),this.map.once("rendercomplete",()=>{this.state.position.tooltip&&this.showContextMenu("custom-overlay",this.state.position.center,"girafe-custom-context-menu-content")})}unregisterEvents(){this.unsubscribe(this.eventsCallbacks),this.eventsCallbacks.length=0}async connectedCallback(){await this.loadConfig(),this.registerEvents()}}class Sl extends Y{constructor(){super("default-context-menu-content");l(this,"template",()=>_`<style>
table.custom-table{width:100%;border-collapse:collapse;margin:10px auto}table.custom-table tr{border-bottom:1px solid #ccc}table.custom-table td,table.custom-table th{padding:5px 0;vertical-align:middle;text-align:left}table.custom-table tr:last-child{border-bottom:none}tr{border-bottom:1px solid #000}.custom-cell{display:flex;align-items:center;height:100%;width:100%;overflow:hidden;text-overflow:ellipsis}
</style><style>
.map-info-contextmenu{--contextmenu-border-width:1px;--contextmenu-triangle-width:20px;--contextmenu-triangle-height:10px;min-width:300px!important;position:absolute;box-sizing:content-box;background-color:var(--bkg-color)!important;color:var(--text-color);padding:15px;border-radius:0;border:var(--contextmenu-border-width) solid var(--text-color-grad1);bottom:var(--contextmenu-triangle-height);left:-165px}.map-info-contextmenu .tooltip-triangle{position:absolute;top:100%;left:50%;transform:translateX(-50%);width:20px;height:var(--contextmenu-triangle-height);pointer-events:none}.map-info-contextmenu .tooltip-triangle .triangle-fill{fill:var(--bkg-color);stroke:none}.map-info-contextmenu .tooltip-triangle .triangle-border{fill:none;stroke:var(--text-color-grad1);stroke-width:var(--contextmenu-border-width)}.contextmenu-closer{text-decoration:none;position:absolute;top:0;right:0}.contextmenu-closer:after{content:'✖'}.justify-right{display:flex;justify-content:flex-end!important;align-items:center}.hidden{display:none}
</style><style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style>
<div class="map-info-contextmenu">
  <button class="contextmenu-closer gg-icon-button gg-small" onclick="${()=>this.closeMenu()}"></button>
  <div>
    <table class="custom-table">
      <colgroup>
        <col style="width: 150px" />
        <col style="width: 120px" />
        <col style="width: 30px" />
      </colgroup>
      <thead>
        <tr>
          <th scope="col"></th>
          <th scope="col"></th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
        ${this.MapContextMenuState.crs.map(e=>_`
        <tr>
          <td i18n="${e.translation}"></td>
          <td>
            ${this.printCoordinate(this.proj4(this.projection,e.code,this.position),e.format,e.precision).map(i=>_`
            <div>${i}</div>
            `)}
          </td>
          <td>
            <div class="justify-right">
              <button
                class="gg-icon-button gg-small"
                tip="Copy value"
                tip-placement="top"
                onclick="${()=>{navigator.clipboard.writeText(this.printCoordinate(this.proj4(this.projection,e.code,this.position),e.format,e.precision).join(", "))}}">
                <img src="icons/content_copy.svg" alt="${this.i18nManager.getTranslation("Copy value")}" />
              </button>
            </div>
          </td>
        </tr>
        `)} ${this.MapContextMenuState.sources.map(e=>_`
        <tr>
          <td i18n="${e.translation}"></td>
          <td>
            <span class="custom-cell"
              >${e.content?e.content:_`<img
                src="icons/progress.svg"
                class="gg-spin gg-small"
                alt="${this.i18nManager.getTranslation("Loading")}" />`}
            </span>
          </td>
          <td>
            <div class="justify-right">
              <button
                class="gg-icon-button gg-small"
                tip="Copy value"
                tip-placement="top"
                onclick="${()=>{navigator.clipboard.writeText(e.content?e.content:"")}}">
                <img src="icons/content_copy.svg" alt="${this.i18nManager.getTranslation("Copy value")}" />
              </button>
            </div>
          </td>
        </tr>
        `)}
      </tbody>
    </table>
  </div>
  <svg class="tooltip-triangle" viewBox="0 0 20 10" preserveAspectRatio="none">
    <polygon points="0,0 10,10 20,0" class="triangle-fill" />
    <path d="M0,0 L10,10 L20,0" class="triangle-border" />
  </svg>
</div>
`);l(this,"i18nManager");l(this,"eventsCallbacks",[]);l(this,"MapContextMenuState");l(this,"container");l(this,"position",[]);l(this,"projection");l(this,"proj4",Er);l(this,"printCoordinate",cl);this.i18nManager=Vt.getInstance()}async renderComponent(){super.render(),super.girafeTranslate(),this.activateTooltips(!1,[800,0],"top-end")}registerEvents(){this.eventsCallbacks.push(this.subscribe(/extendedState\.mapcontextmenu\.sources\..*\.content/,(e,i)=>{console.debug(`mapcontextmenu changed from: ${e} to: ${i}`),super.render()}),this.subscribe("language",(e,i)=>{console.debug(`Language changed from: ${e} to: ${i}`),super.render(),super.girafeTranslate()}))}unregisterEvents(){this.unsubscribe(this.eventsCallbacks),this.eventsCallbacks.length=0}closeMenu(){this.container.hideContextMenu("default-overlay"),this.unregisterEvents()}async connectedCallback(){await this.loadConfig(),this.MapContextMenuState=this.container.MapContextMenuState,this.position=this.MapContextMenuState.position,this.projection=this.MapContextMenuState.projection,this.renderComponent(),this.registerEvents()}}class El extends Y{constructor(){super("custom-context-menu-content");l(this,"template",()=>_`<style>
.map-info-contextmenu{--contextmenu-border-width:1px;--contextmenu-triangle-width:20px;--contextmenu-triangle-height:10px;min-width:300px!important;position:absolute;box-sizing:content-box;background-color:var(--bkg-color)!important;color:var(--text-color);padding:15px;border-radius:0;border:var(--contextmenu-border-width) solid var(--text-color-grad1);bottom:var(--contextmenu-triangle-height);left:-165px}.map-info-contextmenu .tooltip-triangle{position:absolute;top:100%;left:50%;transform:translateX(-50%);width:20px;height:var(--contextmenu-triangle-height);pointer-events:none}.map-info-contextmenu .tooltip-triangle .triangle-fill{fill:var(--bkg-color);stroke:none}.map-info-contextmenu .tooltip-triangle .triangle-border{fill:none;stroke:var(--text-color-grad1);stroke-width:var(--contextmenu-border-width)}.contextmenu-closer{text-decoration:none;position:absolute;top:0;right:0}.contextmenu-closer:after{content:'✖'}.justify-right{display:flex;justify-content:flex-end!important;align-items:center}.hidden{display:none}
</style><style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style>
<div class="map-info-contextmenu">
  <button class="contextmenu-closer gg-icon-button gg-small" onclick="${()=>this.closeMenu()}"></button>
  <div>${this.htmlUnsafe(this.state.position.tooltip??"")}</div>
  <svg class="tooltip-triangle" viewBox="0 0 20 10" preserveAspectRatio="none">
    <polygon points="0,0 10,10 20,0" class="triangle-fill" />
    <path d="M0,0 L10,10 L20,0" class="triangle-border" />
  </svg>
</div>
`);l(this,"i18nManager");l(this,"eventsCallbacks",[]);l(this,"container");this.i18nManager=Vt.getInstance()}async renderComponent(){super.render(),super.girafeTranslate(),this.activateTooltips(!1,[800,0],"top-end")}registerEvents(){this.eventsCallbacks.push(this.subscribe("language",(e,i)=>{console.debug(`Language changed from: ${e} to: ${i}`),super.render(),super.girafeTranslate()}))}unregisterEvents(){this.unsubscribe(this.eventsCallbacks),this.eventsCallbacks.length=0}closeMenu(){this.container.hideContextMenu("custom-overlay"),this.unregisterEvents()}async connectedCallback(){await this.loadConfig(),this.renderComponent(),this.registerEvents()}}class Cl{constructor(){l(this,"loading",!0);l(this,"drawProfile",!0);l(this,"enableAnnotation",!1);l(this,"drawMarker",!1);l(this,"enableMeasurement",!1);l(this,"drawMeasurement",!1);l(this,"backgroundColor","#ffffff");l(this,"colorVariable","intensity");l(this,"colorUniform","#000000");l(this,"colorPalette","viridis");l(this,"cursorDomainCoordinates",[0,0]);l(this,"domain",{xmin:0,xmax:100,ymin:0,ymax:50});l(this,"pointSizeSettings",{default:3,min:.1,max:10,step:.1,value:3});l(this,"verticalExaggerationSettings",{default:1,min:.1,max:10,step:.1,value:1});l(this,"syncViews",!1);l(this,"margins",{left:45,right:5,top:10,bottom:25});l(this,"sectionWidthSettings",{default:1.5,min:.1,max:50,step:.1,value:1.5});l(this,"minLOD",1);l(this,"maxLOD",14);l(this,"markers",[]);l(this,"measurements",[]);l(this,"linestringCoordinates",[]);l(this,"linestringShift",.5);l(this,"numberOfPoints",0);l(this,"maxNumberOfPoints",5e6);l(this,"zoom",{k:1,tx:0,ty:0});l(this,"zoomUpdate",!1);l(this,"printProfile",!1);l(this,"printFileFormat","svg");l(this,"enableLinestringDownload",!1);l(this,"downloadLinestringFormat","kml");l(this,"enableAnnotationsDownload",!1);l(this,"downloadAnnotationsFormat","kml")}}const $i={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class Gi extends xn{constructor(t,e){super(t),this.feature=e}}function Il(g,t){const e=[];for(let i=0;i<t.length;++i){const n=t[i].getGeometry();oa(g,n,e)}return e}function Bi(g,t){return Ys(g[0],g[1],t[0],t[1])}function Pe(g,t){const e=g.length;return t<0?g[t+e]:t>=e?g[t-e]:g[t]}function Ui(g,t,e){let i,r;t<e?(i=t,r=e):(i=e,r=t);const n=Math.ceil(i),s=Math.floor(r);if(n>s){const o=Re(g,i),c=Re(g,r);return Bi(o,c)}let a=0;if(i<n){const o=Re(g,i),c=Pe(g,n);a+=Bi(o,c)}if(s<r){const o=Pe(g,s),c=Re(g,r);a+=Bi(o,c)}for(let o=n;o<s-1;++o){const c=Pe(g,o),h=Pe(g,o+1);a+=Bi(c,h)}return a}function oa(g,t,e){if(t instanceof ct){ji(g,t.getCoordinates(),!1,e);return}if(t instanceof qe){const i=t.getCoordinates();for(let r=0,n=i.length;r<n;++r)ji(g,i[r],!1,e);return}if(t instanceof oe){const i=t.getCoordinates();for(let r=0,n=i.length;r<n;++r)ji(g,i[r],!0,e);return}if(t instanceof He){const i=t.getCoordinates();for(let r=0,n=i.length;r<n;++r){const s=i[r];for(let a=0,o=s.length;a<o;++a)ji(g,s[a],!0,e)}return}if(t instanceof Hs){const i=t.getGeometries();for(let r=0;r<i.length;++r)oa(g,i[r],e);return}}const Zr={index:-1,endIndex:NaN};function Ll(g,t,e,i){const r=g[0],n=g[1];let s=1/0,a=-1,o=NaN;for(let d=0;d<t.targets.length;++d){const m=t.targets[d],p=m.coordinates;let b=1/0,x;for(let E=0;E<p.length-1;++E){const T=p[E],R=p[E+1],G=la(r,n,T,R);G.squaredDistance<b&&(b=G.squaredDistance,x=E+G.along)}b<s&&(s=b,m.ring&&t.targetIndex===d&&(m.endIndex>m.startIndex?x<m.startIndex&&(x+=p.length):m.endIndex<m.startIndex&&x>m.startIndex&&(x-=p.length)),o=x,a=d)}const c=t.targets[a];let h=c.ring;if(t.targetIndex===a&&h){const d=Re(c.coordinates,o),m=e.getPixelFromCoordinate(d);er(m,t.startPx)>i&&(h=!1)}if(h){const d=c.coordinates,m=d.length,p=c.startIndex,b=o;if(p<b){const x=Ui(d,p,b);Ui(d,p,b-m)<x&&(o-=m)}else{const x=Ui(d,p,b);Ui(d,p,b+m)<x&&(o+=m)}}return Zr.index=a,Zr.endIndex=o,Zr}function ji(g,t,e,i){const r=g[0],n=g[1];for(let s=0,a=t.length-1;s<a;++s){const o=t[s],c=t[s+1],h=la(r,n,o,c);if(h.squaredDistance===0){const d=s+h.along;i.push({coordinates:t,ring:e,startIndex:d,endIndex:d});return}}}const Kr={along:0,squaredDistance:0};function la(g,t,e,i){const r=e[0],n=e[1],s=i[0],a=i[1],o=s-r,c=a-n;let h=0,d=r,m=n;return(o!==0||c!==0)&&(h=xo(((g-r)*o+(t-n)*c)/(o*o+c*c),0,1),d+=o*h,m+=c*h),Kr.along=h,Kr.squaredDistance=fo(Ys(g,t,d,m),10),Kr}function Re(g,t){const e=g.length;let i=Math.floor(t);const r=t-i;i>=e?i-=e:i<0&&(i+=e);let n=i+1;n>=e&&(n-=e);const s=g[i],a=s[0],o=s[1],c=g[n],h=c[0]-a,d=c[1]-o;return[a+h*r,o+d*r]}class ga extends vn{constructor(t){const e=t;e.stopDown||(e.stopDown=Bs),super(e),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=t.source?t.source:null,this.features_=t.features?t.features:null,this.snapTolerance_=t.snapTolerance?t.snapTolerance:12,this.type_=t.type,this.mode_=Pl(this.type_),this.stopClick_=!!t.stopClick,this.minPoints_=t.minPoints?t.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:t.maxPoints?t.maxPoints:1/0,this.finishCondition_=t.finishCondition?t.finishCondition:Us,this.geometryLayout_=t.geometryLayout?t.geometryLayout:"XY";let i=t.geometryFunction;if(!i){const r=this.mode_;if(r==="Circle")i=(n,s,a)=>{const o=s||new yi([NaN,NaN]),c=et(n[0]),h=ue(c,et(n[n.length-1]));return o.setCenterAndRadius(c,Math.sqrt(h),this.geometryLayout_),o};else{let n;r==="Point"?n=Et:r==="LineString"?n=ct:r==="Polygon"&&(n=oe),i=(s,a,o)=>(a?r==="Polygon"?s[0].length?a.setCoordinates([s[0].concat([s[0][0]])],this.geometryLayout_):a.setCoordinates([],this.geometryLayout_):a.setCoordinates(s,this.geometryLayout_):a=new n(s,this.geometryLayout_),a)}}this.geometryFunction_=i,this.dragVertexDelay_=t.dragVertexDelay!==void 0?t.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=t.clickTolerance?t.clickTolerance*t.clickTolerance:36,this.overlay_=new Ht({source:new ie({useSpatialIndex:!1,wrapX:t.wrapX?t.wrapX:!1}),style:t.style?t.style:Tl(),updateWhileInteracting:!0}),this.geometryName_=t.geometryName,this.condition_=t.condition?t.condition:yn,this.freehandCondition_,t.freehand?this.freehandCondition_=gn:this.freehandCondition_=t.freehandCondition?t.freehandCondition:ho,this.traceCondition_,this.setTrace(t.trace||!1),this.traceState_={active:!1},this.traceSource_=t.traceSource||t.source||null,this.addChangeListener(uo.ACTIVE,this.updateState_)}setTrace(t){let e;t?t===!0?e=gn:e=t:e=Ws,this.traceCondition_=e}setMap(t){super.setMap(t),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(t){t.originalEvent.type===tr.CONTEXTMENU&&t.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(t);let e=t.type===Lt.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&t.type===Lt.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=t.pixel,this.shouldHandle_=!this.freehand_,e=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&t.type===Lt.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(t.coordinate),i=!1):this.freehand_&&t.type===Lt.POINTERDOWN?i=!1:e&&this.getPointerCount()<2?(i=t.type===Lt.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(t),this.shouldHandle_&&t.originalEvent.preventDefault()):(t.originalEvent.pointerType==="mouse"||t.type===Lt.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(t)):t.type===Lt.DBLCLICK&&(i=!1),super.handleEvent(t)&&i}handleDownEvent(t){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=t.pixel,this.finishCoordinate_||this.startDrawing_(t.coordinate),!0):this.condition_(t)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new mo(Lt.POINTERMOVE,t.map,t.originalEvent,!1,t.frameState))},this.dragVertexDelay_),this.downPx_=t.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(t){if(!this.traceSource_||!this.traceCondition_(t))return;if(this.traceState_.active){this.deactivateTrace_();return}const e=this.getMap(),i=e.getCoordinateFromPixel([t.pixel[0]-this.snapTolerance_,t.pixel[1]+this.snapTolerance_]),r=e.getCoordinateFromPixel([t.pixel[0]+this.snapTolerance_,t.pixel[1]-this.snapTolerance_]),n=yt([i,r]),s=this.traceSource_.getFeaturesInExtent(n);if(s.length===0)return;const a=Il(t.coordinate,s);a.length&&(this.traceState_={active:!0,startPx:t.pixel.slice(),targets:a,targetIndex:-1})}addOrRemoveTracedCoordinates_(t,e){const i=t.startIndex<=t.endIndex,r=t.startIndex<=e;i===r?i&&e>t.endIndex||!i&&e<t.endIndex?this.addTracedCoordinates_(t,t.endIndex,e):(i&&e<t.endIndex||!i&&e>t.endIndex)&&this.removeTracedCoordinates_(e,t.endIndex):(this.removeTracedCoordinates_(t.startIndex,t.endIndex),this.addTracedCoordinates_(t,t.startIndex,e))}removeTracedCoordinates_(t,e){if(t===e)return;let i=0;if(t<e){const r=Math.ceil(t);let n=Math.floor(e);n===e&&(n-=1),i=n-r+1}else{const r=Math.floor(t);let n=Math.ceil(e);n===e&&(n+=1),i=r-n+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(t,e,i){if(e===i)return;const r=[];if(e<i){const n=Math.ceil(e);let s=Math.floor(i);s===i&&(s-=1);for(let a=n;a<=s;++a)r.push(Pe(t.coordinates,a))}else{const n=Math.floor(e);let s=Math.ceil(i);s===i&&(s+=1);for(let a=n;a>=s;--a)r.push(Pe(t.coordinates,a))}r.length&&this.appendCoordinates(r)}updateTrace_(t){const e=this.traceState_;if(!e.active||e.targetIndex===-1&&er(e.startPx,t.pixel)<this.snapTolerance_)return;const i=Ll(t.coordinate,e,this.getMap(),this.snapTolerance_);if(e.targetIndex!==i.index){if(e.targetIndex!==-1){const o=e.targets[e.targetIndex];this.removeTracedCoordinates_(o.startIndex,o.endIndex)}const a=e.targets[i.index];this.addTracedCoordinates_(a,a.startIndex,i.endIndex)}else{const a=e.targets[e.targetIndex];this.addOrRemoveTracedCoordinates_(a,i.endIndex)}e.targetIndex=i.index;const r=e.targets[e.targetIndex];r.endIndex=i.endIndex;const n=Re(r.coordinates,r.endIndex),s=this.getMap().getPixelFromCoordinate(n);t.coordinate=n,t.pixel=[Math.round(s[0]),Math.round(s[1])]}handleUpEvent(t){let e=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(t);const i=this.traceState_.active;if(this.toggleTraceState_(t),this.shouldHandle_){const r=!this.finishCoordinate_;r&&this.startDrawing_(t.coordinate),!r&&this.freehand_?this.finishDrawing():!this.freehand_&&(!r||this.mode_==="Point")&&(this.atFinish_(t.pixel,i)?this.finishCondition_(t)&&this.finishDrawing():this.addToDrawing_(t.coordinate)),e=!1}else this.freehand_&&this.abortDrawing()}return!e&&this.stopClick_&&t.preventDefault(),e}handlePointerMove_(t){if(this.pointerType_=t.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const e=this.downPx_,i=t.pixel,r=e[0]-i[0],n=e[1]-i[1],s=r*r+n*n;if(this.shouldHandle_=this.freehand_?s>this.squaredClickTolerance_:s<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(t.coordinate.slice());return}this.updateTrace_(t),this.modifyDrawing_(t.coordinate)}atFinish_(t,e){let i=!1;if(this.sketchFeature_){let r=!1,n=[this.finishCoordinate_];const s=this.mode_;if(s==="Point")i=!0;else if(s==="Circle")i=this.sketchCoords_.length===2;else if(s==="LineString")r=!e&&this.sketchCoords_.length>this.minPoints_;else if(s==="Polygon"){const a=this.sketchCoords_;r=a[0].length>this.minPoints_,n=[a[0][0],a[0][a[0].length-2]],e?n=[a[0][0]]:n=[a[0][0],a[0][a[0].length-2]]}if(r){const a=this.getMap();for(let o=0,c=n.length;o<c;o++){const h=n[o],d=a.getPixelFromCoordinate(h),m=t[0]-d[0],p=t[1]-d[1],b=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(m*m+p*p)<=b,i){this.finishCoordinate_=h;break}}}}return i}createOrUpdateSketchPoint_(t){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(t):(this.sketchPoint_=new bt(new Et(t)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(t){this.sketchLine_||(this.sketchLine_=new bt);const e=t.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(e.getLayout(),e.getFlatCoordinates()),i.changed()):(i=new ct(e.getFlatCoordinates(),e.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(t){const e=this.getMap().getView().getProjection(),i=ls(this.geometryLayout_);for(;t.length<i;)t.push(0);this.finishCoordinate_=t,this.mode_==="Point"?this.sketchCoords_=t.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[t.slice(),t.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[t.slice(),t.slice()],this.sketchLineCoords_&&(this.sketchLine_=new bt(new ct(this.sketchLineCoords_)));const r=this.geometryFunction_(this.sketchCoords_,void 0,e);this.sketchFeature_=new bt,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(r),this.updateSketchFeatures_(),this.dispatchEvent(new Gi($i.DRAWSTART,this.sketchFeature_))}modifyDrawing_(t){const e=this.getMap(),i=this.sketchFeature_.getGeometry(),r=e.getView().getProjection(),n=ls(this.geometryLayout_);let s,a;for(;t.length<n;)t.push(0);this.mode_==="Point"?a=this.sketchCoords_:this.mode_==="Polygon"?(s=this.sketchCoords_[0],a=s[s.length-1],this.atFinish_(e.getPixelFromCoordinate(t))&&(t=this.finishCoordinate_.slice())):(s=this.sketchCoords_,a=s[s.length-1]),a[0]=t[0],a[1]=t[1],this.geometryFunction_(this.sketchCoords_,i,r),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(t),i.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(t){const e=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let r,n;const s=this.mode_;return s==="LineString"||s==="Circle"?(this.finishCoordinate_=t.slice(),n=this.sketchCoords_,n.length>=this.maxPoints_&&(this.freehand_?n.pop():r=!0),n.push(t.slice()),this.geometryFunction_(n,e,i)):s==="Polygon"&&(n=this.sketchCoords_[0],n.length>=this.maxPoints_&&(this.freehand_?n.pop():r=!0),n.push(t.slice()),r&&(this.finishCoordinate_=n[0]),this.geometryFunction_(this.sketchCoords_,e,i)),this.createOrUpdateSketchPoint_(t.slice()),this.updateSketchFeatures_(),r?this.finishDrawing():this.sketchFeature_}removeLastPoints_(t){if(!this.sketchFeature_)return;const e=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),r=this.mode_;for(let n=0;n<t;++n){let s;if(r==="LineString"||r==="Circle"){if(s=this.sketchCoords_,s.splice(-2,1),s.length>=2){this.finishCoordinate_=s[s.length-2].slice();const a=this.finishCoordinate_.slice();s[s.length-1]=a,this.createOrUpdateSketchPoint_(a)}this.geometryFunction_(s,e,i),e.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(e)}else if(r==="Polygon"){s=this.sketchCoords_[0],s.splice(-2,1);const a=this.sketchLine_.getGeometry();if(s.length>=2){const o=s[s.length-2].slice();s[s.length-1]=o,this.createOrUpdateSketchPoint_(o)}a.setCoordinates(s),this.geometryFunction_(this.sketchCoords_,e,i)}if(s.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const t=this.abortDrawing_();if(!t)return null;let e=this.sketchCoords_;const i=t.getGeometry(),r=this.getMap().getView().getProjection();return this.mode_==="LineString"?(e.pop(),this.geometryFunction_(e,i,r)):this.mode_==="Polygon"&&(e[0].pop(),this.geometryFunction_(e,i,r),e=i.getCoordinates()),this.type_==="MultiPoint"?t.setGeometry(new xi([e])):this.type_==="MultiLineString"?t.setGeometry(new qe([e])):this.type_==="MultiPolygon"&&t.setGeometry(new He([e])),this.dispatchEvent(new Gi($i.DRAWEND,t)),this.features_&&this.features_.push(t),this.source_&&this.source_.addFeature(t),t}abortDrawing_(){this.finishCoordinate_=null;const t=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),t}abortDrawing(){const t=this.abortDrawing_();t&&this.dispatchEvent(new Gi($i.DRAWABORT,t))}appendCoordinates(t){const e=this.mode_,i=!this.sketchFeature_;i&&this.startDrawing_(t[0]);let r;if(e==="LineString"||e==="Circle")r=this.sketchCoords_;else if(e==="Polygon")r=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;i&&r.shift(),r.pop();for(let s=0;s<t.length;s++)this.addToDrawing_(t[s]);const n=t[t.length-1];this.sketchFeature_=this.addToDrawing_(n),this.modifyDrawing_(n)}extend(t){const i=t.getGeometry();this.sketchFeature_=t,this.sketchCoords_=i.getCoordinates();const r=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=r.slice(),this.sketchCoords_.push(r.slice()),this.sketchPoint_=new bt(new Et(r)),this.updateSketchFeatures_(),this.dispatchEvent(new Gi($i.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const t=[];this.sketchFeature_&&t.push(this.sketchFeature_),this.sketchLine_&&t.push(this.sketchLine_),this.sketchPoint_&&t.push(this.sketchPoint_);const e=this.overlay_.getSource();e.clear(!0),e.addFeatures(t)}updateState_(){const t=this.getMap(),e=this.getActive();(!t||!e)&&this.abortDrawing(),this.overlay_.setMap(e?t:null)}}function Tl(){const g=js();return function(t,e){return g[t.getGeometry().getType()]}}function Ml(g,t){return function(e,i,r){const n=et(e[0]),s=et(e[e.length-1]),a=Math.sqrt(ue(n,s));i=i||qs(new yi(n),g);let o=t;{const c=s[0]-n[0],h=s[1]-n[1];o=Math.atan2(h,c)}return po(i,n,a,o),i}}function Nl(){return function(g,t,e){const i=yt([g[0],g[g.length-1]].map(function(n){return et(n)})),r=[[gs(i),bo(i),vo(i),yo(i),gs(i)]];return t?t.setCoordinates(r):t=new oe(r),t}}function Pl(g){switch(g){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+g)}}const vs=0,pi=1,ys=[0,0,0,0],ze=[],Qr={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class Jr extends xn{constructor(t,e,i){super(t),this.features=e,this.mapBrowserEvent=i}}class ca extends vn{constructor(t){super(t),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=t.condition?t.condition:wn,this.defaultDeleteCondition_=function(i){return wo(i)&&_o(i)},this.deleteCondition_=t.deleteCondition?t.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=t.insertVertexCondition?t.insertVertexCondition:gn,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new Xs,this.pixelTolerance_=t.pixelTolerance!==void 0?t.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Ht({source:new ie({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.style?t.style:Al(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let e;if(t.features?e=t.features:t.source&&(this.source_=t.source,e=new ir(this.source_.getFeatures()),this.source_.addEventListener(rr.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(rr.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!e)throw new Error("The modify interaction requires features, a source or a layer");t.hitDetection&&(this.hitDetection_=t.hitDetection),this.features_=e,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(nr.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(nr.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=t.snapToPointer===void 0?!this.hitDetection_:t.snapToPointer}addFeature_(t){const e=t.getGeometry();if(e){const r=this.SEGMENT_WRITERS_[e.getType()];r&&r(t,e)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,i),t.addEventListener(tr.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(t,e){if(!this.featuresBeingModified_){this.featuresBeingModified_=new ir;const i=this.featuresBeingModified_.getArray();for(let r=0,n=e.length;r<n;++r){const s=e[r];for(let a=0,o=s.length;a<o;++a){const c=s[a].feature;c&&!i.includes(c)&&this.featuresBeingModified_.push(c)}}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new Jr(Qr.MODIFYSTART,this.featuresBeingModified_,t))}}removeFeature_(t){this.removeFeatureSegmentData_(t),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.removeEventListener(tr.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(t){const e=this.rBush_,i=[];e.forEach(function(r){t===r.feature&&i.push(r)});for(let r=i.length-1;r>=0;--r){const n=i[r];for(let s=this.dragSegments_.length-1;s>=0;--s)this.dragSegments_[s][0]===n&&this.dragSegments_.splice(s,1);e.remove(n)}}setActive(t){this.vertexFeature_&&!t&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(t)}setMap(t){this.overlay_.setMap(t),super.setMap(t)}getOverlay(){return this.overlay_}handleSourceAdd_(t){t.feature&&this.features_.push(t.feature)}handleSourceRemove_(t){t.feature&&this.features_.remove(t.feature)}handleFeatureAdd_(t){this.addFeature_(t.element)}handleFeatureChange_(t){if(!this.changingFeature_){const e=t.target;this.removeFeature_(e),this.addFeature_(e)}}handleFeatureRemove_(t){this.removeFeature_(t.element)}writePointGeometry_(t,e){const i=e.getCoordinates(),r={feature:t,geometry:e,segment:[i,i]};this.rBush_.insert(e.getExtent(),r)}writeMultiPointGeometry_(t,e){const i=e.getCoordinates();for(let r=0,n=i.length;r<n;++r){const s=i[r],a={feature:t,geometry:e,depth:[r],index:r,segment:[s,s]};this.rBush_.insert(e.getExtent(),a)}}writeLineStringGeometry_(t,e){const i=e.getCoordinates();for(let r=0,n=i.length-1;r<n;++r){const s=i.slice(r,r+2),a={feature:t,geometry:e,index:r,segment:s};this.rBush_.insert(yt(s),a)}}writeMultiLineStringGeometry_(t,e){const i=e.getCoordinates();for(let r=0,n=i.length;r<n;++r){const s=i[r];for(let a=0,o=s.length-1;a<o;++a){const c=s.slice(a,a+2),h={feature:t,geometry:e,depth:[r],index:a,segment:c};this.rBush_.insert(yt(c),h)}}}writePolygonGeometry_(t,e){const i=e.getCoordinates();for(let r=0,n=i.length;r<n;++r){const s=i[r];for(let a=0,o=s.length-1;a<o;++a){const c=s.slice(a,a+2),h={feature:t,geometry:e,depth:[r],index:a,segment:c};this.rBush_.insert(yt(c),h)}}}writeMultiPolygonGeometry_(t,e){const i=e.getCoordinates();for(let r=0,n=i.length;r<n;++r){const s=i[r];for(let a=0,o=s.length;a<o;++a){const c=s[a];for(let h=0,d=c.length-1;h<d;++h){const m=c.slice(h,h+2),p={feature:t,geometry:e,depth:[a,r],index:h,segment:m};this.rBush_.insert(yt(m),p)}}}}writeCircleGeometry_(t,e){const i=e.getCenter(),r={feature:t,geometry:e,index:vs,segment:[i,i]},n={feature:t,geometry:e,index:pi,segment:[i,i]},s=[r,n];r.featureSegments=s,n.featureSegments=s,this.rBush_.insert(Hr(i),r);let a=e;this.rBush_.insert(a.getExtent(),n)}writeGeometryCollectionGeometry_(t,e){const i=e.getGeometriesArray();for(let r=0;r<i.length;++r){const n=i[r],s=this.SEGMENT_WRITERS_[n.getType()];s(t,n)}}createOrUpdateVertexFeature_(t,e,i){let r=this.vertexFeature_;return r?r.getGeometry().setCoordinates(t):(r=new bt(new Et(t)),this.vertexFeature_=r,this.overlay_.getSource().addFeature(r)),r.set("features",e),r.set("geometries",i),r}handleEvent(t){if(!t.originalEvent)return!0;this.lastPointerEvent_=t;let e;return!t.map.getView().getInteracting()&&t.type==Lt.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(t),this.vertexFeature_&&this.deleteCondition_(t)&&(t.type!=Lt.SINGLECLICK||!this.ignoreNextSingleClick_?e=this.removePoint():e=!0),t.type==Lt.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(t)&&!e}handleDragEvent(t){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(t,this.dragSegments_);const e=[t.coordinate[0]+this.delta_[0],t.coordinate[1]+this.delta_[1]],i=[],r=[];for(let n=0,s=this.dragSegments_.length;n<s;++n){const a=this.dragSegments_[n],o=a[0],c=o.feature;i.includes(c)||i.push(c);const h=o.geometry;r.includes(h)||r.push(h);const d=o.depth;let m;const p=o.segment,b=a[1];for(;e.length<h.getStride();)e.push(p[b][e.length]);switch(h.getType()){case"Point":m=e,p[0]=e,p[1]=e;break;case"MultiPoint":m=h.getCoordinates(),m[o.index]=e,p[0]=e,p[1]=e;break;case"LineString":m=h.getCoordinates(),m[o.index+b]=e,p[b]=e;break;case"MultiLineString":m=h.getCoordinates(),m[d[0]][o.index+b]=e,p[b]=e;break;case"Polygon":m=h.getCoordinates(),m[d[0]][o.index+b]=e,p[b]=e;break;case"MultiPolygon":m=h.getCoordinates(),m[d[1]][d[0]][o.index+b]=e,p[b]=e;break;case"Circle":if(p[0]=e,p[1]=e,o.index===vs)this.changingFeature_=!0,h.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0,t.map.getView().getProjection();let x=er(et(h.getCenter()),et(e));h.setRadius(x),this.changingFeature_=!1}break}m&&this.setGeometryCoordinates_(h,m)}this.createOrUpdateVertexFeature_(e,i,r)}handleDownEvent(t){if(!this.condition_(t))return!1;const e=t.coordinate;this.handlePointerAtPixel_(t.pixel,t.map,e),this.dragSegments_.length=0,this.featuresBeingModified_=null;const i=this.vertexFeature_;if(i){t.map.getView().getProjection();const r=[],n=i.getGeometry().getCoordinates(),s=yt([n]),a=this.rBush_.getInExtent(s),o={};a.sort(Rl);for(let c=0,h=a.length;c<h;++c){const d=a[c],m=d.segment;let p=Mt(d.geometry);const b=d.depth;if(b&&(p+="-"+b.join("-")),o[p]||(o[p]=new Array(2)),d.geometry.getType()==="Circle"&&d.index===pi){const x=ws(e,d);fe(x,n)&&!o[p][0]&&(this.dragSegments_.push([d,0]),o[p][0]=d);continue}if(fe(m[0],n)&&!o[p][0]){this.dragSegments_.push([d,0]),o[p][0]=d;continue}if(fe(m[1],n)&&!o[p][1]){if(o[p][0]&&o[p][0].index===0){let x=d.geometry.getCoordinates();switch(d.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":x=x[b[1]];case"Polygon":if(d.index!==x[b[0]].length-2)continue;break}}this.dragSegments_.push([d,1]),o[p][1]=d;continue}Mt(m)in this.vertexSegments_&&!o[p][0]&&!o[p][1]&&this.insertVertexCondition_(t)&&r.push(d)}r.length&&this.willModifyFeatures_(t,[r]);for(let c=r.length-1;c>=0;--c)this.insertVertex_(r[c],n)}return!!this.vertexFeature_}handleUpEvent(t){for(let e=this.dragSegments_.length-1;e>=0;--e){const i=this.dragSegments_[e][0],r=i.geometry;if(r.getType()==="Circle"){const n=r.getCenter(),s=i.featureSegments[0],a=i.featureSegments[1];s.segment[0]=n,s.segment[1]=n,a.segment[0]=n,a.segment[1]=n,this.rBush_.update(Hr(n),s);let o=r;this.rBush_.update(o.getExtent(),a)}else this.rBush_.update(yt(i.segment),i)}return this.featuresBeingModified_&&(this.dispatchEvent(new Jr(Qr.MODIFYEND,this.featuresBeingModified_,t)),this.featuresBeingModified_=null),!1}handlePointerMove_(t){this.lastPixel_=t.pixel,this.handlePointerAtPixel_(t.pixel,t.map,t.coordinate)}handlePointerAtPixel_(t,e,i){const r=i||e.getCoordinateFromPixel(t);e.getView().getProjection();const n=function(o,c){return xs(r,o)-xs(r,c)};let s,a;if(this.hitDetection_){const o=typeof this.hitDetection_=="object"?c=>c===this.hitDetection_:void 0;e.forEachFeatureAtPixel(t,(c,h,d)=>{d&&d.getType()==="Point"&&(d=new Et(sr(d.getCoordinates())));const m=d||c.getGeometry();if(c instanceof bt&&this.features_.getArray().includes(c)){a=m;const p=c.getGeometry().getFlatCoordinates().slice(0,2);s=[{feature:c,geometry:a,segment:[p,p]}]}return!0},{layerFilter:o})}if(!s){const o=ko(Hr(r,ys)),c=e.getView().getResolution()*this.pixelTolerance_,h=Zs(Ks(o,c,ys));s=this.rBush_.getInExtent(h)}if(s&&s.length>0){const o=s.sort(n)[0],c=o.segment;let h=ws(r,o);const d=e.getPixelFromCoordinate(h);let m=er(t,d);if(a||m<=this.pixelTolerance_){const p={};if(p[Mt(c)]=!0,this.snapToPointer_||(this.delta_[0]=h[0]-r[0],this.delta_[1]=h[1]-r[1]),o.geometry.getType()==="Circle"&&o.index===pi)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(h,[o.feature],[o.geometry]);else{const b=e.getPixelFromCoordinate(c[0]),x=e.getPixelFromCoordinate(c[1]),E=ue(d,b),T=ue(d,x);m=Math.sqrt(Math.min(E,T)),this.snappedToVertex_=m<=this.pixelTolerance_,this.snappedToVertex_&&(h=E>T?c[1]:c[0]),this.createOrUpdateVertexFeature_(h,[o.feature],[o.geometry]);const R={};R[Mt(o.geometry)]=!0;for(let G=1,St=s.length;G<St;++G){const ut=s[G].segment;if(fe(c[0],ut[0])&&fe(c[1],ut[1])||fe(c[0],ut[1])&&fe(c[1],ut[0])){const Gt=Mt(s[G].geometry);Gt in R||(R[Gt]=!0,p[Mt(ut)]=!0)}else break}}this.vertexSegments_=p;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(t,e){const i=t.segment,r=t.feature,n=t.geometry,s=t.depth,a=t.index;let o;for(;e.length<n.getStride();)e.push(0);switch(n.getType()){case"MultiLineString":o=n.getCoordinates(),o[s[0]].splice(a+1,0,e);break;case"Polygon":o=n.getCoordinates(),o[s[0]].splice(a+1,0,e);break;case"MultiPolygon":o=n.getCoordinates(),o[s[1]][s[0]].splice(a+1,0,e);break;case"LineString":o=n.getCoordinates(),o.splice(a+1,0,e);break;default:return}this.setGeometryCoordinates_(n,o);const c=this.rBush_;c.remove(t),this.updateSegmentIndices_(n,a,s,1);const h={segment:[i[0],e],feature:r,geometry:n,depth:s,index:a};c.insert(yt(h.segment),h),this.dragSegments_.push([h,1]);const d={segment:[e,i[1]],feature:r,geometry:n,depth:s,index:a+1};c.insert(yt(d.segment),d),this.dragSegments_.push([d,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=Lt.POINTERDRAG){const t=this.lastPointerEvent_;this.willModifyFeatures_(t,this.dragSegments_);const e=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Jr(Qr.MODIFYEND,this.featuresBeingModified_,t)),this.featuresBeingModified_=null,e}return!1}removeVertex_(){const t=this.dragSegments_,e={};let i=!1,r,n,s,a,o,c,h,d,m,p,b;for(o=t.length-1;o>=0;--o)s=t[o],p=s[0],b=Mt(p.feature),p.depth&&(b+="-"+p.depth.join("-")),b in e||(e[b]={}),s[1]===0?(e[b].right=p,e[b].index=p.index):s[1]==1&&(e[b].left=p,e[b].index=p.index+1);for(b in e){switch(m=e[b].right,h=e[b].left,c=e[b].index,d=c-1,h!==void 0?p=h:p=m,d<0&&(d=0),a=p.geometry,n=a.getCoordinates(),r=n,i=!1,a.getType()){case"MultiLineString":n[p.depth[0]].length>2&&(n[p.depth[0]].splice(c,1),i=!0);break;case"LineString":n.length>2&&(n.splice(c,1),i=!0);break;case"MultiPolygon":r=r[p.depth[1]];case"Polygon":r=r[p.depth[0]],r.length>4&&(c==r.length-1&&(c=0),r.splice(c,1),i=!0,c===0&&(r.pop(),r.push(r[0]),d=r.length-1));break}if(i){this.setGeometryCoordinates_(a,n);const x=[];if(h!==void 0&&(this.rBush_.remove(h),x.push(h.segment[0])),m!==void 0&&(this.rBush_.remove(m),x.push(m.segment[1])),h!==void 0&&m!==void 0){const E={depth:p.depth,feature:p.feature,geometry:p.geometry,index:d,segment:x};this.rBush_.insert(yt(E.segment),E)}this.updateSegmentIndices_(a,c,p.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.length=0}}return i}setGeometryCoordinates_(t,e){this.changingFeature_=!0,t.setCoordinates(e),this.changingFeature_=!1}updateSegmentIndices_(t,e,i,r){this.rBush_.forEachInExtent(t.getExtent(),function(n){n.geometry===t&&(i===void 0||n.depth===void 0||So(n.depth,i))&&n.index>e&&(n.index+=r)})}}function Rl(g,t){return g.index-t.index}function xs(g,t,e){const i=t.geometry;if(i.getType()==="Circle"){let n=i;if(t.index===pi){const s=ue(n.getCenter(),et(g)),a=Math.sqrt(s)-n.getRadius();return a*a}}const r=et(g);return ze[0]=et(t.segment[0]),ze[1]=et(t.segment[1]),Eo(r,ze)}function ws(g,t,e){const i=t.geometry;if(i.getType()==="Circle"&&t.index===pi)return sr(i.getClosestPoint(et(g)));const r=et(g);return ze[0]=et(t.segment[0]),ze[1]=et(t.segment[1]),sr(Qs(r,ze))}function Al(){const g=js();return function(t,e){return g.Point}}const Fl={SNAP:"snap"};class Ol extends xn{constructor(t,e){super(t),this.vertex=e.vertex,this.vertexPixel=e.vertexPixel,this.feature=e.feature,this.segment=e.segment}}function _s(g){return g.feature?g.feature:g.element?g.element:null}const tn=[];class Dl extends vn{constructor(t){t=t||{};const e=t;e.handleDownEvent||(e.handleDownEvent=Us),e.stopDown||(e.stopDown=Bs),super(e),this.on,this.once,this.un,this.source_=t.source?t.source:null,this.vertex_=t.vertex!==void 0?t.vertex:!0,this.edge_=t.edge!==void 0?t.edge:!0,this.features_=t.features?t.features:null,this.featuresListenerKeys_=[],this.featureChangeListenerKeys_={},this.indexedFeaturesExtents_={},this.pendingFeatures_={},this.pixelTolerance_=t.pixelTolerance!==void 0?t.pixelTolerance:10,this.rBush_=new Xs,this.GEOMETRY_SEGMENTERS_={Point:this.segmentPointGeometry_.bind(this),LineString:this.segmentLineStringGeometry_.bind(this),LinearRing:this.segmentLineStringGeometry_.bind(this),Polygon:this.segmentPolygonGeometry_.bind(this),MultiPoint:this.segmentMultiPointGeometry_.bind(this),MultiLineString:this.segmentMultiLineStringGeometry_.bind(this),MultiPolygon:this.segmentMultiPolygonGeometry_.bind(this),GeometryCollection:this.segmentGeometryCollectionGeometry_.bind(this),Circle:this.segmentCircleGeometry_.bind(this)}}addFeature(t,e){e=e!==void 0?e:!0;const i=Mt(t),r=t.getGeometry();if(r){const n=this.GEOMETRY_SEGMENTERS_[r.getType()];if(n){this.indexedFeaturesExtents_[i]=r.getExtent(Js());const s=[];if(n(s,r),s.length===1)this.rBush_.insert(yt(s[0]),{feature:t,segment:s[0]});else if(s.length>1){const a=s.map(c=>yt(c)),o=s.map(c=>({feature:t,segment:c}));this.rBush_.load(a,o)}}}e&&(this.featureChangeListenerKeys_[i]=oi(t,tr.CHANGE,this.handleFeatureChange_,this))}getFeatures_(){let t;return this.features_?t=this.features_:this.source_&&(t=this.source_.getFeatures()),t}handleEvent(t){const e=this.snapTo(t.pixel,t.coordinate,t.map);return e&&(t.coordinate=e.vertex.slice(0,2),t.pixel=e.vertexPixel,this.dispatchEvent(new Ol(Fl.SNAP,{vertex:t.coordinate,vertexPixel:t.pixel,feature:e.feature,segment:e.segment}))),super.handleEvent(t)}handleFeatureAdd_(t){const e=_s(t);e&&this.addFeature(e)}handleFeatureRemove_(t){const e=_s(t);e&&this.removeFeature(e)}handleFeatureChange_(t){const e=t.target;if(this.handlingDownUpSequence){const i=Mt(e);i in this.pendingFeatures_||(this.pendingFeatures_[i]=e)}else this.updateFeature_(e)}handleUpEvent(t){const e=Object.values(this.pendingFeatures_);return e.length&&(e.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1}removeFeature(t,e){const i=e!==void 0?e:!0,r=Mt(t),n=this.indexedFeaturesExtents_[r];if(n){const s=this.rBush_,a=[];s.forEachInExtent(n,function(o){t===o.feature&&a.push(o)});for(let o=a.length-1;o>=0;--o)s.remove(a[o])}i&&(Yr(this.featureChangeListenerKeys_[r]),delete this.featureChangeListenerKeys_[r])}setMap(t){const e=this.getMap(),i=this.featuresListenerKeys_,r=this.getFeatures_();e&&(i.forEach(Yr),i.length=0,this.rBush_.clear(),Object.values(this.featureChangeListenerKeys_).forEach(Yr),this.featureChangeListenerKeys_={}),super.setMap(t),t&&(this.features_?i.push(oi(this.features_,nr.ADD,this.handleFeatureAdd_,this),oi(this.features_,nr.REMOVE,this.handleFeatureRemove_,this)):this.source_&&i.push(oi(this.source_,rr.ADDFEATURE,this.handleFeatureAdd_,this),oi(this.source_,rr.REMOVEFEATURE,this.handleFeatureRemove_,this)),r.forEach(n=>this.addFeature(n)))}snapTo(t,e,i){i.getView().getProjection();const r=et(e),n=Zs(Ks(yt([r]),i.getView().getResolution()*this.pixelTolerance_)),s=this.rBush_.getInExtent(n),a=s.length;if(a===0)return null;let o,c=1/0,h,d=null;const m=this.pixelTolerance_*this.pixelTolerance_,p=()=>{if(o){const b=i.getPixelFromCoordinate(o);if(ue(t,b)<=m)return{vertex:o,vertexPixel:[Math.round(b[0]),Math.round(b[1])],feature:h,segment:d}}return null};if(this.vertex_){for(let x=0;x<a;++x){const E=s[x];E.feature.getGeometry().getType()!=="Circle"&&E.segment.forEach(T=>{const R=et(T),G=ue(r,R);G<c&&(o=T,c=G,h=E.feature)})}const b=p();if(b)return b}if(this.edge_){for(let x=0;x<a;++x){let E=null;const T=s[x];if(T.feature.getGeometry().getType()==="Circle"){let R=T.feature.getGeometry();E=Co(r,R)}else{const[R,G]=T.segment;G&&(tn[0]=et(R),tn[1]=et(G),E=Qs(r,tn))}if(E){const R=ue(r,E);R<c&&(o=sr(E),d=T.feature.getGeometry().getType()==="Circle"?null:T.segment,c=R,h=T.feature)}}const b=p();if(b)return b}return null}updateFeature_(t){this.removeFeature(t,!1),this.addFeature(t,!1)}segmentCircleGeometry_(t,e){this.getMap().getView().getProjection();const n=qs(e).getCoordinates()[0];for(let s=0,a=n.length-1;s<a;++s)t.push(n.slice(s,s+2))}segmentGeometryCollectionGeometry_(t,e){const i=e.getGeometriesArray();for(let r=0;r<i.length;++r){const n=this.GEOMETRY_SEGMENTERS_[i[r].getType()];n&&n(t,i[r])}}segmentLineStringGeometry_(t,e){const i=e.getCoordinates();for(let r=0,n=i.length-1;r<n;++r)t.push(i.slice(r,r+2))}segmentMultiLineStringGeometry_(t,e){const i=e.getCoordinates();for(let r=0,n=i.length;r<n;++r){const s=i[r];for(let a=0,o=s.length-1;a<o;++a)t.push(s.slice(a,a+2))}}segmentMultiPointGeometry_(t,e){e.getCoordinates().forEach(i=>{t.push([i])})}segmentMultiPolygonGeometry_(t,e){const i=e.getCoordinates();for(let r=0,n=i.length;r<n;++r){const s=i[r];for(let a=0,o=s.length;a<o;++a){const c=s[a];for(let h=0,d=c.length-1;h<d;++h)t.push(c.slice(h,h+2))}}}segmentPointGeometry_(t,e){t.push([e.getCoordinates()])}segmentPolygonGeometry_(t,e){const i=e.getCoordinates();for(let r=0,n=i.length;r<n;++r){const s=i[r];for(let a=0,o=s.length-1;a<o;++a)t.push(s.slice(a,a+2))}}}class en{static equalsWithTolerance(t,e,i){return Math.abs(t-e)<=i}}class Rt extends Error{constructor(t){super(t),this.name=Object.keys({Exception:Rt})[0]}toString(){return this.message}}class F extends Rt{constructor(t){super(t),this.name=Object.keys({IllegalArgumentException:F})[0]}}class ci{constructor(t,e){this.low=e||0,this.high=t||0}static toBinaryString(t){let e,i="";for(e=2147483648;e>0;e>>>=1)i+=(t.high&e)===e?"1":"0";for(e=2147483648;e>0;e>>>=1)i+=(t.low&e)===e?"1":"0";return i}}function S(){}S.NaN=NaN;S.isNaN=g=>Number.isNaN(g);S.isInfinite=g=>!Number.isFinite(g);S.MAX_VALUE=Number.MAX_VALUE;S.POSITIVE_INFINITY=Number.POSITIVE_INFINITY;S.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY;typeof Float64Array=="function"&&typeof Int32Array=="function"?function(){const e=new Float64Array(1),i=new Int32Array(e.buffer);S.doubleToLongBits=function(r){e[0]=r;let n=i[0]|0,s=i[1]|0;return(s&2146435072)===2146435072&&s&1048575&&n!==0&&(n=0,s=2146959360),new ci(s,n)},S.longBitsToDouble=function(r){return i[0]=r.low,i[1]=r.high,e[0]}}():function(){const t=Math.log2,e=Math.floor,i=Math.pow,r=function(){for(let n=53;n>0;n--){const s=i(2,n)-1;if(e(t(s))+1===n)return s}return 0}();S.doubleToLongBits=function(n){let s,a,o,c,h,d,m,p,b;if(n<0||1/n===Number.NEGATIVE_INFINITY?(d=1<<31,n=-n):d=0,n===0)return b=0,p=d,new ci(p,b);if(n===1/0)return b=0,p=d|2146435072,new ci(p,b);if(n!==n)return b=0,p=2146959360,new ci(p,b);if(c=0,b=0,s=e(n),s>1)if(s<=r)c=e(t(s)),c<=20?(b=0,p=s<<20-c&1048575):(o=c-20,a=i(2,o),b=s%a<<32-o,p=s/a&1048575);else for(o=s,b=0;a=o/2,o=e(a),o!==0;)c++,b>>>=1,b|=(p&1)<<31,p>>>=1,a!==o&&(p|=524288);if(m=c+1023,h=s===0,s=n-s,c<52&&s!==0)for(o=0;;){if(a=s*2,a>=1?(s=a-1,h?(m--,h=!1):(o<<=1,o|=1,c++)):(s=a,h?--m===0&&(c++,h=!1):(o<<=1,c++)),c===20)p|=o,o=0;else if(c===52){b|=o;break}if(a===1){c<20?p|=o<<20-c:c<52&&(b|=o<<52-c);break}}return p|=m<<20,p|=d,new ci(p,b)},S.longBitsToDouble=function(n){let s,a,o,c;const h=n.high,d=n.low,m=h&1<<31?-1:1;for(o=((h&2146435072)>>20)-1023,c=0,a=1<<19,s=1;s<=20;s++)h&a&&(c+=i(2,-s)),a>>>=1;for(a=1<<31,s=21;s<=52;s++)d&a&&(c+=i(2,-s)),a>>>=1;if(o===-1023){if(c===0)return m*0;o=-1022}else{if(o===1024)return c===0?m/0:NaN;c+=1}return m*c*i(2,o)}}();function Ct(){}function kt(){}class Nt extends Rt{constructor(t){super(t),this.name=Object.keys({RuntimeException:Nt})[0]}}class Ae extends Nt{constructor(){super(),Ae.constructor_.apply(this,arguments)}static constructor_(){if(arguments.length===0)Nt.constructor_.call(this);else if(arguments.length===1){const t=arguments[0];Nt.constructor_.call(this,t)}}}class P{static isTrue(){if(arguments.length===1){const t=arguments[0];P.isTrue(t,null)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];if(!t)throw e===null?new Ae:new Ae(e)}}static shouldNeverReachHere(){if(arguments.length===0)P.shouldNeverReachHere(null);else if(arguments.length===1){const t=arguments[0];throw new Ae("Should never reach here"+(t!==null?": "+t:""))}}static equals(){if(arguments.length===2){const t=arguments[0],e=arguments[1];P.equals(t,e,null)}else if(arguments.length===3){const t=arguments[0],e=arguments[1],i=arguments[2];if(!e.equals(t))throw new Ae("Expected "+t+" but encountered "+e+(i!==null?": "+i:""))}}}function Ti(){}function Mi(){}const ha=new ArrayBuffer(8),zl=new Float64Array(ha),ks=new Int32Array(ha);class f{constructor(){f.constructor_.apply(this,arguments)}static constructor_(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)f.constructor_.call(this,0,0);else if(arguments.length===1){const t=arguments[0];f.constructor_.call(this,t.x,t.y,t.getZ())}else if(arguments.length===2){const t=arguments[0],e=arguments[1];f.constructor_.call(this,t,e,f.NULL_ORDINATE)}else if(arguments.length===3){const t=arguments[0],e=arguments[1],i=arguments[2];this.x=t,this.y=e,this.z=i}}static hashCode(t){return zl[0]=t,ks[0]^ks[1]}equals2D(){if(arguments.length===1){const t=arguments[0];return!(this.x!==t.x||this.y!==t.y)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];return!(!en.equalsWithTolerance(this.x,t.x,e)||!en.equalsWithTolerance(this.y,t.y,e))}}setM(t){throw new F("Invalid ordinate index: "+f.M)}equals3D(t){return this.x===t.x&&this.y===t.y&&(this.getZ()===t.getZ()||S.isNaN(this.getZ())&&S.isNaN(t.getZ()))}setX(t){this.x=t}compareTo(t){const e=t;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0}getX(){return this.x}copy(){return new f(this)}toString(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}distance3D(t){const e=this.x-t.x,i=this.y-t.y,r=this.getZ()-t.getZ();return Math.sqrt(e*e+i*i+r*r)}getY(){return this.y}getM(){return S.NaN}setOrdinate(t,e){switch(t){case f.X:this.x=e;break;case f.Y:this.y=e;break;case f.Z:this.setZ(e);break;default:throw new F("Invalid ordinate index: "+t)}}getZ(){return this.z}getOrdinate(t){switch(t){case f.X:return this.x;case f.Y:return this.y;case f.Z:return this.getZ()}throw new F("Invalid ordinate index: "+t)}equals(t){return t instanceof f?this.equals2D(t):!1}equalInZ(t,e){return en.equalsWithTolerance(this.getZ(),t.getZ(),e)}setZ(t){this.z=t}clone(){try{return null}catch(t){if(t instanceof CloneNotSupportedException)return P.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw t}finally{}}setY(t){this.y=t}distance(t){const e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)}hashCode(){let t=17;return t=37*t+f.hashCode(this.x),t=37*t+f.hashCode(this.y),t}setCoordinate(t){this.x=t.x,this.y=t.y,this.z=t.getZ()}get interfaces_(){return[Ct,Ti,kt]}}class be{constructor(){be.constructor_.apply(this,arguments)}static constructor_(){if(this._dimensionsToTest=2,arguments.length===0)be.constructor_.call(this,2);else if(arguments.length===1){const t=arguments[0];if(t!==2&&t!==3)throw new F("only 2 or 3 dimensions may be specified");this._dimensionsToTest=t}}static compare(t,e){return t<e?-1:t>e?1:S.isNaN(t)?S.isNaN(e)?0:-1:S.isNaN(e)?1:0}compare(t,e){const i=be.compare(t.x,e.x);if(i!==0)return i;const r=be.compare(t.y,e.y);return r!==0?r:this._dimensionsToTest<=2?0:be.compare(t.getZ(),e.getZ())}get interfaces_(){return[Mi]}}f.DimensionalComparator=be;f.NULL_ORDINATE=S.NaN;f.X=0;f.Y=1;f.Z=2;f.M=3;function M(g,t){return g.interfaces_&&g.interfaces_.indexOf(t)>-1}class Vl{static ofLine(t){const e=t.size();if(e<=1)return 0;let i=0;const r=new f;t.getCoordinate(0,r);let n=r.x,s=r.y;for(let a=1;a<e;a++){t.getCoordinate(a,r);const o=r.x,c=r.y,h=o-n,d=c-s;i+=Math.sqrt(h*h+d*d),n=o,s=c}return i}}class Ni{filter(t){}}class te extends Rt{constructor(t){super(t),this.name=Object.keys({UnsupportedOperationException:te})[0]}}class Qt{add(){}addAll(){}isEmpty(){}iterator(){}size(){}toArray(){}remove(){}}class Cr extends Rt{constructor(t){super(t),this.name=Object.keys({IndexOutOfBoundsException:Cr})[0]}}class xe extends Qt{get(){}set(){}isEmpty(){}}class si extends Rt{constructor(t){super(t),this.name=Object.keys({NoSuchElementException:si})[0]}}class L extends xe{constructor(t){super(),this.array=[],t instanceof Qt&&this.addAll(t)}get interfaces_(){return[xe,Qt]}ensureCapacity(){}add(t){return arguments.length===1?this.array.push(t):this.array.splice(arguments[0],0,arguments[1]),!0}clear(){this.array=[]}addAll(t){for(const e of t)this.array.push(e)}set(t,e){const i=this.array[t];return this.array[t]=e,i}iterator(){return new $l(this)}get(t){if(t<0||t>=this.size())throw new Cr;return this.array[t]}isEmpty(){return this.array.length===0}sort(t){t?this.array.sort((e,i)=>t.compare(e,i)):this.array.sort()}size(){return this.array.length}toArray(){return this.array.slice()}remove(t){for(let e=0,i=this.array.length;e<i;e++)if(this.array[e]===t)return!!this.array.splice(e,1);return!1}[Symbol.iterator](){return this.array.values()}}let $l=class{constructor(t){this.arrayList=t,this.position=0}next(){if(this.position===this.arrayList.size())throw new si;return this.arrayList.get(this.position++)}hasNext(){return this.position<this.arrayList.size()}set(t){return this.arrayList.set(this.position-1,t)}remove(){this.arrayList.remove(this.arrayList.get(this.position))}};class re extends L{constructor(){super(),re.constructor_.apply(this,arguments)}static constructor_(){if(arguments.length!==0){if(arguments.length===1){const t=arguments[0];this.ensureCapacity(t.length),this.add(t,!0)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this.ensureCapacity(t.length),this.add(t,e)}}}getCoordinate(t){return this.get(t)}addAll(){if(arguments.length===2&&typeof arguments[1]=="boolean"&&M(arguments[0],Qt)){const t=arguments[0],e=arguments[1];let i=!1;for(let r=t.iterator();r.hasNext();)this.add(r.next(),e),i=!0;return i}else return super.addAll.apply(this,arguments)}clone(){const t=super.clone.call(this);for(let e=0;e<this.size();e++)t.add(e,this.get(e).clone());return t}closeRing(){if(this.size()>0){const t=this.get(0).copy();this.add(t,!1)}}toCoordinateArray(){if(arguments.length===0)return this.toArray(re.coordArrayType);if(arguments.length===1){if(arguments[0])return this.toArray(re.coordArrayType);const e=this.size(),i=new Array(e).fill(null);for(let r=0;r<e;r++)i[r]=this.get(e-r-1);return i}}add(){if(arguments.length===1){const t=arguments[0];return super.add.call(this,t)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){const t=arguments[0],e=arguments[1];return this.add(t,e,!0),!0}else if(arguments[0]instanceof f&&typeof arguments[1]=="boolean"){const t=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(t))return null;super.add.call(this,t)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){const t=arguments[0],e=arguments[1];return this.add(t,e),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){const t=arguments[0],e=arguments[1];if(arguments[2])for(let r=0;r<t.length;r++)this.add(t[r],e);else for(let r=t.length-1;r>=0;r--)this.add(t[r],e);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof f){const t=arguments[0],e=arguments[1];if(!arguments[2]){const r=this.size();if(r>0&&(t>0&&this.get(t-1).equals2D(e)||t<r&&this.get(t).equals2D(e)))return null}super.add.call(this,t,e)}}else if(arguments.length===4){const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3];let n=1;i>r&&(n=-1);for(let s=i;s!==r;s+=n)this.add(t[s],e);return!0}}}re.coordArrayType=new Array(0).fill(null);class ft extends f{constructor(){super(),ft.constructor_.apply(this,arguments)}static constructor_(){if(arguments.length===0)f.constructor_.call(this);else if(arguments.length===1){if(arguments[0]instanceof ft){const t=arguments[0];f.constructor_.call(this,t.x,t.y)}else if(arguments[0]instanceof f){const t=arguments[0];f.constructor_.call(this,t.x,t.y)}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];f.constructor_.call(this,t,e,f.NULL_ORDINATE)}}setOrdinate(t,e){switch(t){case ft.X:this.x=e;break;case ft.Y:this.y=e;break;default:throw new F("Invalid ordinate index: "+t)}}setZ(t){throw new F("CoordinateXY dimension 2 does not support z-ordinate")}copy(){return new ft(this)}toString(){return"("+this.x+", "+this.y+")"}setCoordinate(t){this.x=t.x,this.y=t.y,this.z=t.getZ()}getZ(){return f.NULL_ORDINATE}getOrdinate(t){switch(t){case ft.X:return this.x;case ft.Y:return this.y}throw new F("Invalid ordinate index: "+t)}}ft.X=0;ft.Y=1;ft.Z=-1;ft.M=-1;class st extends f{constructor(){super(),st.constructor_.apply(this,arguments)}static constructor_(){if(this._m=null,arguments.length===0)f.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof st){const t=arguments[0];f.constructor_.call(this,t.x,t.y),this._m=t._m}else if(arguments[0]instanceof f){const t=arguments[0];f.constructor_.call(this,t.x,t.y),this._m=this.getM()}}else if(arguments.length===3){const t=arguments[0],e=arguments[1],i=arguments[2];f.constructor_.call(this,t,e,f.NULL_ORDINATE),this._m=i}}setM(t){this._m=t}setZ(t){throw new F("CoordinateXY dimension 2 does not support z-ordinate")}copy(){return new st(this)}toString(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}setCoordinate(t){this.x=t.x,this.y=t.y,this.z=t.getZ(),this._m=t.getM()}getM(){return this._m}setOrdinate(t,e){switch(t){case st.X:this.x=e;break;case st.Y:this.y=e;break;case st.M:this._m=e;break;default:throw new F("Invalid ordinate index: "+t)}}getZ(){return f.NULL_ORDINATE}getOrdinate(t){switch(t){case st.X:return this.x;case st.Y:return this.y;case st.M:return this._m}throw new F("Invalid ordinate index: "+t)}}st.X=0;st.Y=1;st.Z=-1;st.M=2;class we extends f{constructor(){super(),we.constructor_.apply(this,arguments)}static constructor_(){if(this._m=null,arguments.length===0)f.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof we){const t=arguments[0];f.constructor_.call(this,t),this._m=t._m}else if(arguments[0]instanceof f){const t=arguments[0];f.constructor_.call(this,t),this._m=this.getM()}}else if(arguments.length===4){const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3];f.constructor_.call(this,t,e,i),this._m=r}}setM(t){this._m=t}getOrdinate(t){switch(t){case f.X:return this.x;case f.Y:return this.y;case f.Z:return this.getZ();case f.M:return this.getM()}throw new F("Invalid ordinate index: "+t)}copy(){return new we(this)}toString(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}setCoordinate(t){this.x=t.x,this.y=t.y,this.z=t.getZ(),this._m=t.getM()}getM(){return this._m}setOrdinate(t,e){switch(t){case f.X:this.x=e;break;case f.Y:this.y=e;break;case f.Z:this.z=e;break;case f.M:this._m=e;break;default:throw new F("Invalid ordinate index: "+t)}}}class We{static measures(t){return t instanceof ft?0:t instanceof st||t instanceof we?1:(t instanceof f,0)}static create(){if(arguments.length===1){const t=arguments[0];return We.create(t,0)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];return t===2?new ft:t===3&&e===0?new f:t===3&&e===1?new st:t===4&&e===1?new we:new f}}static dimension(t){return t instanceof ft?2:t instanceof st?3:t instanceof we?4:(t instanceof f,3)}}class Ee{static log10(t){const e=Math.log(t);return S.isInfinite(e)||S.isNaN(e)?e:e/Ee.LOG_10}static min(t,e,i,r){let n=t;return e<n&&(n=e),i<n&&(n=i),r<n&&(n=r),n}static clamp(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){const t=arguments[0],e=arguments[1],i=arguments[2];return t<e?e:t>i?i:t}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){const t=arguments[0],e=arguments[1],i=arguments[2];return t<e?e:t>i?i:t}}static average(t,e){return(t+e)/2}static wrap(t,e){return t<0?e- -t%e:t%e}static max(){if(arguments.length===3){const t=arguments[0],e=arguments[1],i=arguments[2];let r=t;return e>r&&(r=e),i>r&&(r=i),r}else if(arguments.length===4){const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3];let n=t;return e>n&&(n=e),i>n&&(n=i),r>n&&(n=r),n}}}Ee.LOG_10=Math.log(10);class Pt{static arraycopy(t,e,i,r,n){let s=0;for(let a=e;a<e+n;a++)i[r+s]=t[a],s++}static getProperty(t){return{"line.separator":`
`}[t]}}class A{constructor(){A.constructor_.apply(this,arguments)}static constructor_(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof f){const t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof A){const t=arguments[0];this.init(t)}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this.init(t.x,e.x,t.y,e.y)}else if(arguments.length===4){const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3];this.init(t,e,i,r)}}static intersects(){if(arguments.length===3){const t=arguments[0],e=arguments[1],i=arguments[2];return i.x>=(t.x<e.x?t.x:e.x)&&i.x<=(t.x>e.x?t.x:e.x)&&i.y>=(t.y<e.y?t.y:e.y)&&i.y<=(t.y>e.y?t.y:e.y)}else if(arguments.length===4){const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3];let n=Math.min(i.x,r.x),s=Math.max(i.x,r.x),a=Math.min(t.x,e.x),o=Math.max(t.x,e.x);return!(a>s||o<n||(n=Math.min(i.y,r.y),s=Math.max(i.y,r.y),a=Math.min(t.y,e.y),o=Math.max(t.y,e.y),a>s)||o<n)}}getArea(){return this.getWidth()*this.getHeight()}getMinX(){return this._minx}expandToInclude(){if(arguments.length===1){if(arguments[0]instanceof f){const t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof A){const t=arguments[0];if(t.isNull())return null;this.isNull()?(this._minx=t.getMinX(),this._maxx=t.getMaxX(),this._miny=t.getMinY(),this._maxy=t.getMaxY()):(t._minx<this._minx&&(this._minx=t._minx),t._maxx>this._maxx&&(this._maxx=t._maxx),t._miny<this._miny&&(this._miny=t._miny),t._maxy>this._maxy&&(this._maxy=t._maxy))}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this.isNull()?(this._minx=t,this._maxx=t,this._miny=e,this._maxy=e):(t<this._minx&&(this._minx=t),t>this._maxx&&(this._maxx=t),e<this._miny&&(this._miny=e),e>this._maxy&&(this._maxy=e))}}compareTo(t){const e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this._minx<e._minx?-1:this._minx>e._minx?1:this._miny<e._miny?-1:this._miny>e._miny?1:this._maxx<e._maxx?-1:this._maxx>e._maxx?1:this._maxy<e._maxy?-1:this._maxy>e._maxy?1:0}translate(t,e){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)}copy(){return new A(this)}expandBy(){if(arguments.length===1){const t=arguments[0];this.expandBy(t,t)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];if(this.isNull())return null;this._minx-=t,this._maxx+=t,this._miny-=e,this._maxy+=e,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}contains(){if(arguments.length===1){if(arguments[0]instanceof A){const t=arguments[0];return this.covers(t)}else if(arguments[0]instanceof f){const t=arguments[0];return this.covers(t)}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];return this.covers(t,e)}}hashCode(){let t=17;return t=37*t+f.hashCode(this._minx),t=37*t+f.hashCode(this._maxx),t=37*t+f.hashCode(this._miny),t=37*t+f.hashCode(this._maxy),t}equals(t){if(!(t instanceof A))return!1;const e=t;return this.isNull()?e.isNull():this._maxx===e.getMaxX()&&this._maxy===e.getMaxY()&&this._minx===e.getMinX()&&this._miny===e.getMinY()}intersection(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new A;const e=this._minx>t._minx?this._minx:t._minx,i=this._miny>t._miny?this._miny:t._miny,r=this._maxx<t._maxx?this._maxx:t._maxx,n=this._maxy<t._maxy?this._maxy:t._maxy;return new A(e,r,i,n)}isNull(){return this._maxx<this._minx}getMaxX(){return this._maxx}covers(){if(arguments.length===1){if(arguments[0]instanceof f){const t=arguments[0];return this.covers(t.x,t.y)}else if(arguments[0]instanceof A){const t=arguments[0];return this.isNull()||t.isNull()?!1:t.getMinX()>=this._minx&&t.getMaxX()<=this._maxx&&t.getMinY()>=this._miny&&t.getMaxY()<=this._maxy}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];return this.isNull()?!1:t>=this._minx&&t<=this._maxx&&e>=this._miny&&e<=this._maxy}}intersects(){if(arguments.length===1){if(arguments[0]instanceof A){const t=arguments[0];return this.isNull()||t.isNull()?!1:!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}else if(arguments[0]instanceof f){const t=arguments[0];return this.intersects(t.x,t.y)}}else if(arguments.length===2){if(arguments[0]instanceof f&&arguments[1]instanceof f){const t=arguments[0],e=arguments[1];return!(this.isNull()||(t.x<e.x?t.x:e.x)>this._maxx||(t.x>e.x?t.x:e.x)<this._minx||(t.y<e.y?t.y:e.y)>this._maxy||(t.y>e.y?t.y:e.y)<this._miny)}else if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){const t=arguments[0],e=arguments[1];return this.isNull()?!1:!(t>this._maxx||t<this._minx||e>this._maxy||e<this._miny)}}}getMinY(){return this._miny}getDiameter(){if(this.isNull())return 0;const t=this.getWidth(),e=this.getHeight();return Math.sqrt(t*t+e*e)}minExtent(){if(this.isNull())return 0;const t=this.getWidth(),e=this.getHeight();return t<e?t:e}getWidth(){return this.isNull()?0:this._maxx-this._minx}toString(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}setToNull(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}disjoint(t){return this.isNull()||t.isNull()?!0:t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny}getHeight(){return this.isNull()?0:this._maxy-this._miny}maxExtent(){if(this.isNull())return 0;const t=this.getWidth(),e=this.getHeight();return t>e?t:e}centre(){return this.isNull()?null:new f((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}init(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof f){const t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof A){const t=arguments[0];this._minx=t._minx,this._maxx=t._maxx,this._miny=t._miny,this._maxy=t._maxy}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this.init(t.x,e.x,t.y,e.y)}else if(arguments.length===4){const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3];t<e?(this._minx=t,this._maxx=e):(this._minx=e,this._maxx=t),i<r?(this._miny=i,this._maxy=r):(this._miny=r,this._maxy=i)}}getMaxY(){return this._maxy}distance(t){if(this.intersects(t))return 0;let e=0;this._maxx<t._minx?e=t._minx-this._maxx:this._minx>t._maxx&&(e=this._minx-t._maxx);let i=0;return this._maxy<t._miny?i=t._miny-this._maxy:this._miny>t._maxy&&(i=this._miny-t._maxy),e===0?i:i===0?e:Math.sqrt(e*e+i*i)}get interfaces_(){return[Ct,kt]}}class W{static scroll(t,e){const i=W.indexOf(e,t);if(i<0)return null;const r=new Array(t.length).fill(null);Pt.arraycopy(t,i,r,0,t.length-i),Pt.arraycopy(t,0,r,t.length-i,i),Pt.arraycopy(r,0,t,0,t.length)}static removeRepeatedPoints(t){return W.hasRepeatedPoints(t)?new re(t,!1).toCoordinateArray():t}static reverse(t){const e=t.length-1,i=Math.trunc(e/2);for(let r=0;r<=i;r++){const n=t[r];t[r]=t[e-r],t[e-r]=n}}static removeNull(t){let e=0;for(let n=0;n<t.length;n++)t[n]!==null&&e++;const i=new Array(e).fill(null);if(e===0)return i;let r=0;for(let n=0;n<t.length;n++)t[n]!==null&&(i[r++]=t[n]);return i}static copyDeep(){if(arguments.length===1){const t=arguments[0],e=new Array(t.length).fill(null);for(let i=0;i<t.length;i++)e[i]=t[i].copy();return e}else if(arguments.length===5){const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3],n=arguments[4];for(let s=0;s<n;s++)i[r+s]=t[e+s].copy()}}static isEqualReversed(t,e){for(let i=0;i<t.length;i++){const r=t[i],n=e[t.length-i-1];if(r.compareTo(n)!==0)return!1}return!0}static envelope(t){const e=new A;for(let i=0;i<t.length;i++)e.expandToInclude(t[i]);return e}static extract(t,e,i){e=Ee.clamp(e,0,t.length),i=Ee.clamp(i,-1,t.length);let r=i-e+1;i<0&&(r=0),e>=t.length&&(r=0),i<e&&(r=0);const n=new Array(r).fill(null);if(r===0)return n;let s=0;for(let a=e;a<=i;a++)n[s++]=t[a];return n}static isRing(t){return!(t.length<4||!t[0].equals2D(t[t.length-1]))}static ptNotInList(t,e){for(let i=0;i<t.length;i++){const r=t[i];if(W.indexOf(r,e)<0)return r}return null}static equals(){if(arguments.length===2){const t=arguments[0],e=arguments[1];if(t===e)return!0;if(t===null||e===null||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!t[i].equals(e[i]))return!1;return!0}else if(arguments.length===3){const t=arguments[0],e=arguments[1],i=arguments[2];if(t===e)return!0;if(t===null||e===null||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(i.compare(t[r],e[r])!==0)return!1;return!0}}static intersection(t,e){const i=new re;for(let r=0;r<t.length;r++)e.intersects(t[r])&&i.add(t[r],!0);return i.toCoordinateArray()}static measures(t){if(t===null||t.length===0)return 0;let e=0;for(const i of t)e=Math.max(e,We.measures(i));return e}static hasRepeatedPoints(t){for(let e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1}static toCoordinateArray(t){return t.toArray(W.coordArrayType)}static dimension(t){if(t===null||t.length===0)return 3;let e=0;for(const i of t)e=Math.max(e,We.dimension(i));return e}static atLeastNCoordinatesOrNothing(t,e){return e.length>=t?e:[]}static indexOf(t,e){for(let i=0;i<e.length;i++)if(t.equals(e[i]))return i;return-1}static increasingDirection(t){for(let e=0;e<Math.trunc(t.length/2);e++){const i=t.length-1-e,r=t[e].compareTo(t[i]);if(r!==0)return r}return 1}static compare(t,e){let i=0;for(;i<t.length&&i<e.length;){const r=t[i].compareTo(e[i]);if(r!==0)return r;i++}return i<e.length?-1:i<t.length?1:0}static minCoordinate(t){let e=null;for(let i=0;i<t.length;i++)(e===null||e.compareTo(t[i])>0)&&(e=t[i]);return e}}class Gl{compare(t,e){const i=t,r=e;return W.compare(i,r)}get interfaces_(){return[Mi]}}class Bl{compare(t,e){const i=t,r=e;if(i.length<r.length)return-1;if(i.length>r.length)return 1;if(i.length===0)return 0;const n=W.compare(i,r);return W.isEqualReversed(i,r)?0:n}OLDcompare(t,e){const i=t,r=e;if(i.length<r.length)return-1;if(i.length>r.length)return 1;if(i.length===0)return 0;const n=W.increasingDirection(i),s=W.increasingDirection(r);let a=n>0?0:i.length-1,o=s>0?0:i.length-1;for(let c=0;c<i.length;c++){const h=i[a].compareTo(r[o]);if(h!==0)return h;a+=n,o+=s}return 0}get interfaces_(){return[Mi]}}W.ForwardComparator=Gl;W.BidirectionalComparator=Bl;W.coordArrayType=new Array(0).fill(null);class dn{static isWhitespace(t){return t<=32&&t>=0||t===127}static toUpperCase(t){return t.toUpperCase()}}class y{static toDimensionSymbol(t){switch(t){case y.FALSE:return y.SYM_FALSE;case y.TRUE:return y.SYM_TRUE;case y.DONTCARE:return y.SYM_DONTCARE;case y.P:return y.SYM_P;case y.L:return y.SYM_L;case y.A:return y.SYM_A}throw new F("Unknown dimension value: "+t)}static toDimensionValue(t){switch(dn.toUpperCase(t)){case y.SYM_FALSE:return y.FALSE;case y.SYM_TRUE:return y.TRUE;case y.SYM_DONTCARE:return y.DONTCARE;case y.SYM_P:return y.P;case y.SYM_L:return y.L;case y.SYM_A:return y.A}throw new F("Unknown dimension symbol: "+t)}}y.P=0;y.L=1;y.A=2;y.FALSE=-1;y.TRUE=-2;y.DONTCARE=-3;y.SYM_FALSE="F";y.SYM_TRUE="T";y.SYM_DONTCARE="*";y.SYM_P="0";y.SYM_L="1";y.SYM_A="2";class k{constructor(){k.constructor_.apply(this,arguments)}isGeometryCollection(){return this.getTypeCode()===k.TYPECODE_GEOMETRYCOLLECTION}getFactory(){return this._factory}getGeometryN(t){return this}getArea(){return 0}isRectangle(){return!1}equalsExact(t){return this===t||this.equalsExact(t,0)}geometryChanged(){this.apply(k.geometryChangedFilter)}geometryChangedAction(){this._envelope=null}equalsNorm(t){return t===null?!1:this.norm().equalsExact(t.norm())}getLength(){return 0}getNumGeometries(){return 1}compareTo(){let t;if(arguments.length===1){const e=arguments[0];return t=e,this.getTypeCode()!==t.getTypeCode()?this.getTypeCode()-t.getTypeCode():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(e)}else if(arguments.length===2){const e=arguments[0],i=arguments[1];return t=e,this.getTypeCode()!==t.getTypeCode()?this.getTypeCode()-t.getTypeCode():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(e,i)}}getUserData(){return this._userData}getSRID(){return this._SRID}getEnvelope(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}static checkNotGeometryCollection(t){if(t.getTypeCode()===k.TYPECODE_GEOMETRYCOLLECTION)throw new F("This method does not support GeometryCollection arguments")}equal(t,e,i){return i===0?t.equals(e):t.distance(e)<=i}norm(){const t=this.copy();return t.normalize(),t}reverse(){const t=this.reverseInternal();return this.envelope!=null&&(t.envelope=this.envelope.copy()),t.setSRID(this.getSRID()),t}copy(){const t=this.copyInternal();return t.envelope=this._envelope==null?null:this._envelope.copy(),t._SRID=this._SRID,t._userData=this._userData,t}getPrecisionModel(){return this._factory.getPrecisionModel()}getEnvelopeInternal(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new A(this._envelope)}setSRID(t){this._SRID=t}setUserData(t){this._userData=t}compare(t,e){const i=t.iterator(),r=e.iterator();for(;i.hasNext()&&r.hasNext();){const n=i.next(),s=r.next(),a=n.compareTo(s);if(a!==0)return a}return i.hasNext()?1:r.hasNext()?-1:0}hashCode(){return this.getEnvelopeInternal().hashCode()}isEquivalentClass(t){return this.getTypeCode()==t.getTypeCode()}get interfaces_(){return[Ti,Ct,kt]}getClass(){return k}static hasNonEmptyElements(t){for(let e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1}static hasNullElements(t){for(let e=0;e<t.length;e++)if(t[e]===null)return!0;return!1}}k.constructor_=function(g){g&&(this._envelope=null,this._userData=null,this._factory=g,this._SRID=g.getSRID())};k.TYPECODE_POINT=0;k.TYPECODE_MULTIPOINT=1;k.TYPECODE_LINESTRING=2;k.TYPECODE_LINEARRING=3;k.TYPECODE_MULTILINESTRING=4;k.TYPECODE_POLYGON=5;k.TYPECODE_MULTIPOLYGON=6;k.TYPECODE_GEOMETRYCOLLECTION=7;k.TYPENAME_POINT="Point";k.TYPENAME_MULTIPOINT="MultiPoint";k.TYPENAME_LINESTRING="LineString";k.TYPENAME_LINEARRING="LinearRing";k.TYPENAME_MULTILINESTRING="MultiLineString";k.TYPENAME_POLYGON="Polygon";k.TYPENAME_MULTIPOLYGON="MultiPolygon";k.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection";k.geometryChangedFilter={get interfaces_(){return[Ni]},filter(g){g.geometryChangedAction()}};class Ir{filter(t){}}class da{}class O{getCoordinate(){}getCoordinateCopy(t){}createCoordinate(){}getDimension(){}hasM(){return this.getMeasures()>0}getX(t){}hasZ(){return this.getDimension()-this.getMeasures()>2}getMeasures(){return 0}expandEnvelope(t){}copy(){}getY(t){}toCoordinateArray(){}getM(t){if(this.hasM()){const e=this.getDimension()-this.getMeasures();return this.getOrdinate(t,e)}else return S.NaN}setOrdinate(t,e,i){}getZ(t){return this.hasZ()?this.getOrdinate(t,2):S.NaN}size(){}getOrdinate(t,e){}get interfaces_(){return[Ti]}}O.X=0;O.Y=1;O.Z=2;O.M=3;class K{static scroll(){if(arguments.length===2){if(M(arguments[0],O)&&Number.isInteger(arguments[1])){const t=arguments[0],e=arguments[1];K.scroll(t,e,K.isRing(t))}else if(M(arguments[0],O)&&arguments[1]instanceof f){const t=arguments[0],e=arguments[1],i=K.indexOf(e,t);if(i<=0)return null;K.scroll(t,i)}}else if(arguments.length===3){const t=arguments[0],e=arguments[1],i=arguments[2];if(e<=0)return null;const n=t.copy(),s=i?t.size()-1:t.size();for(let a=0;a<s;a++)for(let o=0;o<t.getDimension();o++)t.setOrdinate(a,o,n.getOrdinate((e+a)%s,o));if(i)for(let a=0;a<t.getDimension();a++)t.setOrdinate(s,a,t.getOrdinate(0,a))}}static isEqual(t,e){const i=t.size(),r=e.size();if(i!==r)return!1;const n=Math.min(t.getDimension(),e.getDimension());for(let s=0;s<i;s++)for(let a=0;a<n;a++){const o=t.getOrdinate(s,a),c=e.getOrdinate(s,a);if(t.getOrdinate(s,a)!==e.getOrdinate(s,a)&&!(S.isNaN(o)&&S.isNaN(c)))return!1}return!0}static minCoordinateIndex(){if(arguments.length===1){const t=arguments[0];return K.minCoordinateIndex(t,0,t.size()-1)}else if(arguments.length===3){const t=arguments[0],e=arguments[1],i=arguments[2];let r=-1,n=null;for(let s=e;s<=i;s++){const a=t.getCoordinate(s);(n===null||n.compareTo(a)>0)&&(n=a,r=s)}return r}}static extend(t,e,i){const r=t.create(i,e.getDimension()),n=e.size();if(K.copy(e,0,r,0,n),n>0)for(let s=n;s<i;s++)K.copy(e,n-1,r,s,1);return r}static reverse(t){const e=t.size()-1,i=Math.trunc(e/2);for(let r=0;r<=i;r++)K.swap(t,r,e-r)}static ensureValidRing(t,e){const i=e.size();return i===0?e:i<=3?K.createClosedRing(t,e,4):e.getOrdinate(0,O.X)===e.getOrdinate(i-1,O.X)&&e.getOrdinate(0,O.Y)===e.getOrdinate(i-1,O.Y)?e:K.createClosedRing(t,e,i+1)}static minCoordinate(t){let e=null;for(let i=0;i<t.size();i++){const r=t.getCoordinate(i);(e===null||e.compareTo(r)>0)&&(e=r)}return e}static copyCoord(t,e,i,r){const n=Math.min(t.getDimension(),i.getDimension());for(let s=0;s<n;s++)i.setOrdinate(r,s,t.getOrdinate(e,s))}static isRing(t){const e=t.size();return e===0?!0:e<=3?!1:t.getOrdinate(0,O.X)===t.getOrdinate(e-1,O.X)&&t.getOrdinate(0,O.Y)===t.getOrdinate(e-1,O.Y)}static swap(t,e,i){if(e===i)return null;for(let r=0;r<t.getDimension();r++){const n=t.getOrdinate(e,r);t.setOrdinate(e,r,t.getOrdinate(i,r)),t.setOrdinate(i,r,n)}}static copy(t,e,i,r,n){for(let s=0;s<n;s++)K.copyCoord(t,e+s,i,r+s)}static indexOf(t,e){for(let i=0;i<e.size();i++)if(t.x===e.getOrdinate(i,O.X)&&t.y===e.getOrdinate(i,O.Y))return i;return-1}static createClosedRing(t,e,i){const r=t.create(i,e.getDimension()),n=e.size();K.copy(e,0,r,0,n);for(let s=n;s<i;s++)K.copy(e,0,r,s,1);return r}}class Lr{filter(t){}}class Tr{filter(t,e){}isGeometryChanged(){}isDone(){}}class ne extends k{constructor(){super(),ne.constructor_.apply(this,arguments)}static constructor_(){if(this._points=null,arguments.length!==0){if(arguments.length===2){const t=arguments[0],e=arguments[1];k.constructor_.call(this,e),this.init(t)}}}computeEnvelopeInternal(){return this.isEmpty()?new A:this._points.expandEnvelope(new A)}isRing(){return this.isClosed()&&W.isRing(this.getCoordinates())}getCoordinates(){return this._points.toCoordinateArray()}copyInternal(){return new ne(this._points.copy(),this._factory)}equalsExact(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof k){const t=arguments[0],e=arguments[1];if(!this.isEquivalentClass(t))return!1;const i=t;if(this._points.size()!==i._points.size())return!1;for(let r=0;r<this._points.size();r++)if(!this.equal(this._points.getCoordinate(r),i._points.getCoordinate(r),e))return!1;return!0}else return super.equalsExact.apply(this,arguments)}isClosed(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}reverseInternal(){const t=this._points.copy();return K.reverse(t),this.getFactory().createLineString(t)}getEndPoint(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}getTypeCode(){return k.TYPECODE_LINESTRING}getDimension(){return 1}getBoundary(){throw new te}isEquivalentClass(t){return t instanceof ne}getCoordinateSequence(){return this._points}getPointN(t){return this.getFactory().createPoint(this._points.getCoordinate(t))}normalize(){for(let t=0;t<Math.trunc(this._points.size()/2);t++){const e=this._points.size()-1-t;if(!this._points.getCoordinate(t).equals(this._points.getCoordinate(e))){if(this._points.getCoordinate(t).compareTo(this._points.getCoordinate(e))>0){const i=this._points.copy();K.reverse(i),this._points=i}return null}}}getCoordinate(){return this.isEmpty()?null:this._points.getCoordinate(0)}getBoundaryDimension(){return this.isClosed()?y.FALSE:0}getLength(){return Vl.ofLine(this._points)}getNumPoints(){return this._points.size()}compareToSameClass(){if(arguments.length===1){const e=arguments[0];let i=0,r=0;for(;i<this._points.size()&&r<e._points.size();){const n=this._points.getCoordinate(i).compareTo(e._points.getCoordinate(r));if(n!==0)return n;i++,r++}return i<this._points.size()?1:r<e._points.size()?-1:0}else if(arguments.length===2){const t=arguments[0],e=arguments[1],i=t;return e.compare(this._points,i._points)}}apply(){if(M(arguments[0],Ir)){const t=arguments[0];for(let e=0;e<this._points.size();e++)t.filter(this._points.getCoordinate(e))}else if(M(arguments[0],Tr)){const t=arguments[0];if(this._points.size()===0)return null;for(let e=0;e<this._points.size()&&(t.filter(this._points,e),!t.isDone());e++);t.isGeometryChanged()&&this.geometryChanged()}else M(arguments[0],Lr)?arguments[0].filter(this):M(arguments[0],Ni)&&arguments[0].filter(this)}getCoordinateN(t){return this._points.getCoordinate(t)}getGeometryType(){return k.TYPENAME_LINESTRING}isEmpty(){return this._points.size()===0}init(t){if(t===null&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),t.size()===1)throw new F("Invalid number of points in LineString (found "+t.size()+" - must be 0 or >= 2)");this._points=t}isCoordinate(t){for(let e=0;e<this._points.size();e++)if(this._points.getCoordinate(e).equals(t))return!0;return!1}getStartPoint(){return this.isEmpty()?null:this.getPointN(0)}get interfaces_(){return[da]}}class se extends ne{constructor(){super(),se.constructor_.apply(this,arguments)}static constructor_(){const t=arguments[0],e=arguments[1];ne.constructor_.call(this,t,e),this.validateConstruction()}copyInternal(){return new se(this._points.copy(),this._factory)}getBoundaryDimension(){return y.FALSE}isClosed(){return this.isEmpty()?!0:super.isClosed.call(this)}reverseInternal(){const t=this._points.copy();return K.reverse(t),this.getFactory().createLinearRing(t)}getTypeCode(){return k.TYPECODE_LINEARRING}validateConstruction(){if(!this.isEmpty()&&!super.isClosed.call(this))throw new F("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<se.MINIMUM_VALID_SIZE)throw new F("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}getGeometryType(){return k.TYPENAME_LINEARRING}}se.MINIMUM_VALID_SIZE=4;class ua{create(){if(arguments.length===1)arguments[0]instanceof Array||M(arguments[0],O);else if(arguments.length!==2){if(arguments.length===3){const t=arguments[0],e=arguments[1];return this.create(t,e)}}}}class Mr{constructor(t){this.str=t}append(t){this.str+=t}setCharAt(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)}toString(){return this.str}}class Yt{constructor(){Yt.constructor_.apply(this,arguments)}static constructor_(){if(this._dimension=3,this._measures=0,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){const t=arguments[0];Yt.constructor_.call(this,t,W.dimension(t),W.measures(t))}else if(Number.isInteger(arguments[0])){const t=arguments[0];this._coordinates=new Array(t).fill(null);for(let e=0;e<t;e++)this._coordinates[e]=new f}else if(M(arguments[0],O)){const t=arguments[0];if(t===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=t.getDimension(),this._measures=t.getMeasures(),this._coordinates=new Array(t.size()).fill(null);for(let e=0;e<this._coordinates.length;e++)this._coordinates[e]=t.getCoordinateCopy(e)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){const t=arguments[0],e=arguments[1];Yt.constructor_.call(this,t,e,W.measures(t))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){const t=arguments[0],e=arguments[1];this._coordinates=new Array(t).fill(null),this._dimension=e;for(let i=0;i<t;i++)this._coordinates[i]=We.create(e)}}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){const t=arguments[0],e=arguments[1],i=arguments[2];this._dimension=e,this._measures=i,t===null?this._coordinates=new Array(0).fill(null):this._coordinates=t}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){const t=arguments[0],e=arguments[1],i=arguments[2];this._coordinates=new Array(t).fill(null),this._dimension=e,this._measures=i;for(let r=0;r<t;r++)this._coordinates[r]=this.createCoordinate()}}}getCoordinate(){if(arguments.length===1){const t=arguments[0];return this._coordinates[t]}else if(arguments.length===2){const t=arguments[0];arguments[1].setCoordinate(this._coordinates[t])}}getCoordinateCopy(t){const e=this.createCoordinate();return e.setCoordinate(this._coordinates[t]),e}createCoordinate(){return We.create(this.getDimension(),this.getMeasures())}getDimension(){return this._dimension}getX(t){return this._coordinates[t].x}getMeasures(){return this._measures}expandEnvelope(t){for(let e=0;e<this._coordinates.length;e++)t.expandToInclude(this._coordinates[e]);return t}copy(){const t=new Array(this.size()).fill(null);for(let e=0;e<this._coordinates.length;e++){const i=this.createCoordinate();i.setCoordinate(this._coordinates[e]),t[e]=i}return new Yt(t,this._dimension,this._measures)}toString(){if(this._coordinates.length>0){const t=new Mr(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(let e=1;e<this._coordinates.length;e++)t.append(", "),t.append(this._coordinates[e]);return t.append(")"),t.toString()}else return"()"}getY(t){return this._coordinates[t].y}toCoordinateArray(){return this._coordinates}getM(t){return this.hasM()?this._coordinates[t].getM():S.NaN}setOrdinate(t,e,i){switch(e){case O.X:this._coordinates[t].x=i;break;case O.Y:this._coordinates[t].y=i;break;default:this._coordinates[t].setOrdinate(e,i)}}getZ(t){return this.hasZ()?this._coordinates[t].getZ():S.NaN}size(){return this._coordinates.length}getOrdinate(t,e){switch(e){case O.X:return this._coordinates[t].x;case O.Y:return this._coordinates[t].y;default:return this._coordinates[t].getOrdinate(e)}}get interfaces_(){return[O,kt]}}class Xe{static instance(){return Xe.instanceObject}readResolve(){return Xe.instance()}create(){if(arguments.length===1){if(arguments[0]instanceof Array){const t=arguments[0];return new Yt(t)}else if(M(arguments[0],O)){const t=arguments[0];return new Yt(t)}}else if(arguments.length===2){let t=arguments[0],e=arguments[1];return e>3&&(e=3),e<2&&(e=2),new Yt(t,e)}else if(arguments.length===3){let t=arguments[0],e=arguments[1],i=arguments[2],r=e-i;return i>1&&(i=1),r>3&&(r=3),r<2&&(r=2),new Yt(t,r+i,i)}}get interfaces_(){return[ua,kt]}}Xe.instanceObject=new Xe;let ma=class extends Qt{contains(){}};class Ul extends ma{}class Ss extends Ul{constructor(t){super(),this.array=[],t instanceof Qt&&this.addAll(t)}contains(t){for(const e of this.array)if(e.compareTo(t)===0)return!0;return!1}add(t){if(this.contains(t))return!1;for(let e=0,i=this.array.length;e<i;e++)if(this.array[e].compareTo(t)===1)return!!this.array.splice(e,0,t);return this.array.push(t),!0}addAll(t){for(const e of t)this.add(e);return!0}remove(){throw new te}size(){return this.array.length}isEmpty(){return this.array.length===0}toArray(){return this.array.slice()}iterator(){return new jl(this.array)}}let jl=class{constructor(t){this.array=t,this.position=0}next(){if(this.position===this.array.length)throw new si;return this.array[this.position++]}hasNext(){return this.position<this.array.length}remove(){throw new te}};class _e{static sort(){const t=arguments[0];if(arguments.length===1)t.sort((e,i)=>e.compareTo(i));else if(arguments.length===2)t.sort((e,i)=>arguments[1].compare(e,i));else if(arguments.length===3){const e=t.slice(arguments[1],arguments[2]);e.sort();const i=t.slice(0,arguments[1]).concat(e,t.slice(arguments[2],t.length));t.splice(0,t.length);for(const r of i)t.push(r)}else if(arguments.length===4){const e=t.slice(arguments[1],arguments[2]);e.sort((r,n)=>arguments[3].compare(r,n));const i=t.slice(0,arguments[1]).concat(e,t.slice(arguments[2],t.length));t.splice(0,t.length);for(const r of i)t.push(r)}}static asList(t){const e=new L;for(const i of t)e.add(i);return e}static copyOf(t,e){return t.slice(0,e)}}class ht extends k{constructor(){super(),ht.constructor_.apply(this,arguments)}static constructor_(){if(this._geometries=null,arguments.length!==0){if(arguments.length===2){let t=arguments[0],e=arguments[1];if(k.constructor_.call(this,e),t===null&&(t=[]),k.hasNullElements(t))throw new F("geometries must not contain null elements");this._geometries=t}}}computeEnvelopeInternal(){const t=new A;for(let e=0;e<this._geometries.length;e++)t.expandToInclude(this._geometries[e].getEnvelopeInternal());return t}getGeometryN(t){return this._geometries[t]}getCoordinates(){const t=new Array(this.getNumPoints()).fill(null);let e=-1;for(let i=0;i<this._geometries.length;i++){const r=this._geometries[i].getCoordinates();for(let n=0;n<r.length;n++)e++,t[e]=r[n]}return t}getArea(){let t=0;for(let e=0;e<this._geometries.length;e++)t+=this._geometries[e].getArea();return t}copyInternal(){const t=new Array(this._geometries.length).fill(null);for(let e=0;e<t.length;e++)t[e]=this._geometries[e].copy();return new ht(t,this._factory)}equalsExact(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof k){const t=arguments[0],e=arguments[1];if(!this.isEquivalentClass(t))return!1;const i=t;if(this._geometries.length!==i._geometries.length)return!1;for(let r=0;r<this._geometries.length;r++)if(!this._geometries[r].equalsExact(i._geometries[r],e))return!1;return!0}else return super.equalsExact.apply(this,arguments)}reverseInternal(){const t=this._geometries.length,e=new L(t);for(let i=0;i<t;i++)e.add(this._geometries[i].reverse());return this.getFactory().buildGeometry(e)}getTypeCode(){return k.TYPECODE_GEOMETRYCOLLECTION}getDimension(){let t=y.FALSE;for(let e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getDimension());return t}getNumGeometries(){return this._geometries.length}getBoundary(){return k.checkNotGeometryCollection(this),P.shouldNeverReachHere(),null}getGeometryType(){return k.TYPENAME_GEOMETRYCOLLECTION}isEmpty(){for(let t=0;t<this._geometries.length;t++)if(!this._geometries[t].isEmpty())return!1;return!0}normalize(){for(let t=0;t<this._geometries.length;t++)this._geometries[t].normalize();_e.sort(this._geometries)}getCoordinate(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}getBoundaryDimension(){let t=y.FALSE;for(let e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getBoundaryDimension());return t}getLength(){let t=0;for(let e=0;e<this._geometries.length;e++)t+=this._geometries[e].getLength();return t}getNumPoints(){let t=0;for(let e=0;e<this._geometries.length;e++)t+=this._geometries[e].getNumPoints();return t}compareToSameClass(){if(arguments.length===1){const t=arguments[0],e=new Ss(_e.asList(this._geometries)),i=new Ss(_e.asList(t._geometries));return this.compare(e,i)}else if(arguments.length===2){const t=arguments[0],e=arguments[1],i=t,r=this.getNumGeometries(),n=i.getNumGeometries();let s=0;for(;s<r&&s<n;){const a=this.getGeometryN(s),o=i.getGeometryN(s),c=a.compareToSameClass(o,e);if(c!==0)return c;s++}return s<r?1:s<n?-1:0}}apply(){if(M(arguments[0],Ir)){const t=arguments[0];for(let e=0;e<this._geometries.length;e++)this._geometries[e].apply(t)}else if(M(arguments[0],Tr)){const t=arguments[0];if(this._geometries.length===0)return null;for(let e=0;e<this._geometries.length&&(this._geometries[e].apply(t),!t.isDone());e++);t.isGeometryChanged()&&this.geometryChanged()}else if(M(arguments[0],Lr)){const t=arguments[0];t.filter(this);for(let e=0;e<this._geometries.length;e++)this._geometries[e].apply(t)}else if(M(arguments[0],Ni)){const t=arguments[0];t.filter(this);for(let e=0;e<this._geometries.length;e++)this._geometries[e].apply(t)}}}class pa{}class Ze extends ht{constructor(){super(),Ze.constructor_.apply(this,arguments)}static constructor_(){const t=arguments[0],e=arguments[1];ht.constructor_.call(this,t,e)}copyInternal(){const t=new Array(this._geometries.length).fill(null);for(let e=0;e<t.length;e++)t[e]=this._geometries[e].copy();return new Ze(t,this._factory)}equalsExact(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof k){const t=arguments[0],e=arguments[1];return this.isEquivalentClass(t)?super.equalsExact.call(this,t,e):!1}else return super.equalsExact.apply(this,arguments)}getBoundaryDimension(){return 1}getTypeCode(){return k.TYPECODE_MULTIPOLYGON}getDimension(){return 2}getBoundary(){if(this.isEmpty())return this.getFactory().createMultiLineString();const t=new L;for(let i=0;i<this._geometries.length;i++){const n=this._geometries[i].getBoundary();for(let s=0;s<n.getNumGeometries();s++)t.add(n.getGeometryN(s))}const e=new Array(t.size()).fill(null);return this.getFactory().createMultiLineString(t.toArray(e))}getGeometryType(){return k.TYPENAME_MULTIPOLYGON}get interfaces_(){return[pa]}}let fa=class{get(){}put(){}size(){}values(){}entrySet(){}};class kn extends ma{constructor(t){super(),this.map=new Map,t instanceof Qt&&this.addAll(t)}contains(t){const e=t.hashCode?t.hashCode():t;return!!this.map.has(e)}add(t){const e=t.hashCode?t.hashCode():t;return this.map.has(e)?!1:!!this.map.set(e,t)}addAll(t){for(const e of t)this.add(e);return!0}remove(){throw new te}size(){return this.map.size}isEmpty(){return this.map.size===0}toArray(){return Array.from(this.map.values())}iterator(){return new ql(this.map)}[Symbol.iterator](){return this.map}}let ql=class{constructor(t){this.iterator=t.values();const{done:e,value:i}=this.iterator.next();this.done=e,this.value=i}next(){if(this.done)throw new si;const t=this.value,{done:e,value:i}=this.iterator.next();return this.done=e,this.value=i,t}hasNext(){return!this.done}remove(){throw new te}};class Hl extends fa{constructor(){super(),this.map=new Map}get(t){return this.map.get(t)||null}put(t,e){return this.map.set(t,e),e}values(){const t=new L,e=this.map.values();let i=e.next();for(;!i.done;)t.add(i.value),i=e.next();return t}entrySet(){const t=new kn;return this.map.entries().forEach(e=>t.add(e)),t}size(){return this.map.size()}}class Ke{constructor(t){this.value=t}intValue(){return this.value}compareTo(t){return this.value<t?-1:this.value>t?1:0}static compare(t,e){return t<e?-1:t>e?1:0}static isNan(t){return Number.isNaN(t)}static valueOf(t){return new Ke(t)}}class j{constructor(){j.constructor_.apply(this,arguments)}static constructor_(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=j.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof Wt){const t=arguments[0];this._modelType=t,t===j.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){const t=arguments[0];this._modelType=j.FIXED,this.setScale(t)}else if(arguments[0]instanceof j){const t=arguments[0];this._modelType=t._modelType,this._scale=t._scale}}}static mostPrecise(t,e){return t.compareTo(e)>=0?t:e}equals(t){if(!(t instanceof j))return!1;const e=t;return this._modelType===e._modelType&&this._scale===e._scale}compareTo(t){const e=t,i=this.getMaximumSignificantDigits(),r=e.getMaximumSignificantDigits();return Ke.compare(i,r)}getType(){return this._modelType}toString(){let t="UNKNOWN";return this._modelType===j.FLOATING?t="Floating":this._modelType===j.FLOATING_SINGLE?t="Floating-Single":this._modelType===j.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t}makePrecise(){if(typeof arguments[0]=="number"){const t=arguments[0];return S.isNaN(t)||this._modelType===j.FLOATING_SINGLE?t:this._modelType===j.FIXED?Math.round(t*this._scale)/this._scale:t}else if(arguments[0]instanceof f){const t=arguments[0];if(this._modelType===j.FLOATING)return null;t.x=this.makePrecise(t.x),t.y=this.makePrecise(t.y)}}getMaximumSignificantDigits(){let t=16;return this._modelType===j.FLOATING?t=16:this._modelType===j.FLOATING_SINGLE?t=6:this._modelType===j.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t}setScale(t){this._scale=Math.abs(t)}getScale(){return this._scale}isFloating(){return this._modelType===j.FLOATING||this._modelType===j.FLOATING_SINGLE}get interfaces_(){return[kt,Ct]}}class Wt{constructor(){Wt.constructor_.apply(this,arguments)}static constructor_(){this._name=null;const t=arguments[0];this._name=t,Wt.nameToTypeMap.put(t,this)}readResolve(){return Wt.nameToTypeMap.get(this._name)}toString(){return this._name}get interfaces_(){return[kt]}}Wt.nameToTypeMap=new Hl;j.Type=Wt;j.FIXED=new Wt("FIXED");j.FLOATING=new Wt("FLOATING");j.FLOATING_SINGLE=new Wt("FLOATING SINGLE");j.maximumPreciseValue=9007199254740992;class Qe extends ht{constructor(){super(),Qe.constructor_.apply(this,arguments)}static constructor_(){const t=arguments[0],e=arguments[1];ht.constructor_.call(this,t,e)}copyInternal(){const t=new Array(this._geometries.length).fill(null);for(let e=0;e<t.length;e++)t[e]=this._geometries[e].copy();return new Qe(t,this._factory)}equalsExact(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof k){const t=arguments[0],e=arguments[1];return this.isEquivalentClass(t)?super.equalsExact.call(this,t,e):!1}else return super.equalsExact.apply(this,arguments)}getBoundaryDimension(){return this.isClosed()?y.FALSE:0}isClosed(){if(this.isEmpty())return!1;for(let t=0;t<this._geometries.length;t++)if(!this._geometries[t].isClosed())return!1;return!0}getTypeCode(){return k.TYPECODE_MULTILINESTRING}getDimension(){return 1}getBoundary(){throw new te}getGeometryType(){return k.TYPENAME_MULTILINESTRING}get interfaces_(){return[da]}}class ba{}class Je extends Rt{constructor(t){super(t),this.name=Object.keys({IllegalStateException:Je})[0]}}class ti extends k{constructor(){super(),ti.constructor_.apply(this,arguments)}static constructor_(){this._coordinates=null;const t=arguments[0],e=arguments[1];k.constructor_.call(this,e),this.init(t)}computeEnvelopeInternal(){if(this.isEmpty())return new A;const t=new A;return t.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),t}getCoordinates(){return this.isEmpty()?[]:[this.getCoordinate()]}copyInternal(){return new ti(this._coordinates.copy(),this._factory)}equalsExact(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof k){const t=arguments[0],e=arguments[1];return this.isEquivalentClass(t)?this.isEmpty()&&t.isEmpty()?!0:this.isEmpty()!==t.isEmpty()?!1:this.equal(t.getCoordinate(),this.getCoordinate(),e):!1}else return super.equalsExact.apply(this,arguments)}reverseInternal(){return this.getFactory().createPoint(this._coordinates.copy())}getTypeCode(){return k.TYPECODE_POINT}getDimension(){return 0}getNumPoints(){return this.isEmpty()?0:1}getX(){if(this.getCoordinate()===null)throw new Je("getX called on empty Point");return this.getCoordinate().x}getBoundary(){return this.getFactory().createGeometryCollection()}getGeometryType(){return k.TYPENAME_POINT}getCoordinateSequence(){return this._coordinates}getY(){if(this.getCoordinate()===null)throw new Je("getY called on empty Point");return this.getCoordinate().y}isSimple(){return!0}normalize(){}getCoordinate(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null}getBoundaryDimension(){return y.FALSE}compareToSameClass(){if(arguments.length===1){const e=arguments[0];return this.getCoordinate().compareTo(e.getCoordinate())}else if(arguments.length===2){const t=arguments[0],e=arguments[1],i=t;return e.compare(this._coordinates,i._coordinates)}}apply(){if(M(arguments[0],Ir)){const t=arguments[0];if(this.isEmpty())return null;t.filter(this.getCoordinate())}else if(M(arguments[0],Tr)){const t=arguments[0];if(this.isEmpty())return null;t.filter(this._coordinates,0),t.isGeometryChanged()&&this.geometryChanged()}else M(arguments[0],Lr)?arguments[0].filter(this):M(arguments[0],Ni)&&arguments[0].filter(this)}isEmpty(){return this._coordinates.size()===0}init(t){t===null&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),P.isTrue(t.size()<=1),this._coordinates=t}get interfaces_(){return[ba]}}class _i{static ofRingSigned(){if(arguments[0]instanceof Array){const t=arguments[0];if(t.length<3)return 0;let e=0;const i=t[0].x;for(let r=1;r<t.length-1;r++){const n=t[r].x-i,s=t[r+1].y,a=t[r-1].y;e+=n*(a-s)}return e/2}else if(M(arguments[0],O)){const t=arguments[0],e=t.size();if(e<3)return 0;const i=new f,r=new f,n=new f;t.getCoordinate(0,r),t.getCoordinate(1,n);const s=r.x;n.x-=s;let a=0;for(let o=1;o<e-1;o++)i.y=r.y,r.x=n.x,r.y=n.y,t.getCoordinate(o+1,n),n.x-=s,a+=r.x*(i.y-n.y);return a/2}}static ofRing(){if(arguments[0]instanceof Array){const t=arguments[0];return Math.abs(_i.ofRingSigned(t))}else if(M(arguments[0],O)){const t=arguments[0];return Math.abs(_i.ofRingSigned(t))}}}class ki{constructor(t){this.str=t}append(t){this.str+=t}setCharAt(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)}toString(){return this.str}}class v{constructor(){v.constructor_.apply(this,arguments)}static constructor_(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){const t=arguments[0];this.init(t)}else if(arguments[0]instanceof v){const t=arguments[0];this.init(t)}else if(typeof arguments[0]=="string"){const t=arguments[0];v.constructor_.call(this,v.parse(t))}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this.init(t,e)}}static determinant(){if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3];return v.determinant(v.valueOf(t),v.valueOf(e),v.valueOf(i),v.valueOf(r))}else if(arguments[3]instanceof v&&arguments[2]instanceof v&&arguments[0]instanceof v&&arguments[1]instanceof v){const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3];return t.multiply(r).selfSubtract(e.multiply(i))}}static sqr(t){return v.valueOf(t).selfMultiply(t)}static valueOf(){if(typeof arguments[0]=="string"){const t=arguments[0];return v.parse(t)}else if(typeof arguments[0]=="number"){const t=arguments[0];return new v(t)}}static sqrt(t){return v.valueOf(t).sqrt()}static parse(t){let e=0;const i=t.length;for(;dn.isWhitespace(t.charAt(e));)e++;let r=!1;if(e<i){const m=t.charAt(e);(m==="-"||m==="+")&&(e++,m==="-"&&(r=!0))}const n=new v;let s=0,a=0,o=0,c=!1;for(;!(e>=i);){const m=t.charAt(e);if(e++,dn.isDigit(m)){const p=m-"0";n.selfMultiply(v.TEN),n.selfAdd(p),s++;continue}if(m==="."){a=s,c=!0;continue}if(m==="e"||m==="E"){const p=t.substring(e);try{o=Ke.parseInt(p)}catch(b){throw b instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+p+" in string "+t):b}finally{}break}throw new NumberFormatException("Unexpected character '"+m+"' at position "+e+" in string "+t)}let h=n;c||(a=s);const d=s-a-o;if(d===0)h=n;else if(d>0){const m=v.TEN.pow(d);h=n.divide(m)}else if(d<0){const m=v.TEN.pow(-d);h=n.multiply(m)}return r?h.negate():h}static createNaN(){return new v(S.NaN,S.NaN)}static copy(t){return new v(t)}static magnitude(t){const e=Math.abs(t),i=Math.log(e)/Math.log(10);let r=Math.trunc(Math.floor(i));return Math.pow(10,r)*10<=e&&(r+=1),r}static stringOfChar(t,e){const i=new ki;for(let r=0;r<e;r++)i.append(t);return i.toString()}le(t){return this._hi<t._hi||this._hi===t._hi&&this._lo<=t._lo}extractSignificantDigits(t,e){let i=this.abs(),r=v.magnitude(i._hi);const n=v.TEN.pow(r);i=i.divide(n),i.gt(v.TEN)?(i=i.divide(v.TEN),r+=1):i.lt(v.ONE)&&(i=i.multiply(v.TEN),r-=1);const s=r+1,a=new ki,o=v.MAX_PRINT_DIGITS-1;for(let c=0;c<=o;c++){t&&c===s&&a.append(".");const h=Math.trunc(i._hi);if(h<0)break;let d=!1,m=0;h>9?(d=!0,m="9"):m="0"+h,a.append(m),i=i.subtract(v.valueOf(h)).multiply(v.TEN),d&&i.selfAdd(v.TEN);let p=!0;const b=v.magnitude(i._hi);if(b<0&&Math.abs(b)>=o-c&&(p=!1),!p)break}return e[0]=r,a.toString()}sqr(){return this.multiply(this)}getSpecialNumberString(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}setValue(){if(arguments[0]instanceof v){const t=arguments[0];return this.init(t),this}else if(typeof arguments[0]=="number"){const t=arguments[0];return this.init(t),this}}multiply(){if(arguments[0]instanceof v){const t=arguments[0];return t.isNaN()?v.createNaN():v.copy(this).selfMultiply(t)}else if(typeof arguments[0]=="number"){const t=arguments[0];return S.isNaN(t)?v.createNaN():v.copy(this).selfMultiply(t,0)}}isNaN(){return S.isNaN(this._hi)}reciprocal(){let t=null,e=null,i=null,r=null,n=null,s=null,a=null,o=null;n=1/this._hi,s=v.SPLIT*n,t=s-n,o=v.SPLIT*this._hi,t=s-t,e=n-t,i=o-this._hi,a=n*this._hi,i=o-i,r=this._hi-i,o=t*i-a+t*r+e*i+e*r,s=(1-a-o-n*this._lo)/this._hi;const c=n+s,h=n-c+s;return new v(c,h)}doubleValue(){return this._hi+this._lo}subtract(){if(arguments[0]instanceof v){const t=arguments[0];return this.add(t.negate())}else if(typeof arguments[0]=="number"){const t=arguments[0];return this.add(-t)}}equals(){if(arguments.length===1&&arguments[0]instanceof v){const t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}}isZero(){return this._hi===0&&this._lo===0}selfSubtract(){if(arguments[0]instanceof v){const t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}else if(typeof arguments[0]=="number"){const t=arguments[0];return this.isNaN()?this:this.selfAdd(-t,0)}}min(t){return this.le(t)?this:t}selfDivide(){if(arguments.length===1){if(arguments[0]instanceof v){const t=arguments[0];return this.selfDivide(t._hi,t._lo)}else if(typeof arguments[0]=="number"){const t=arguments[0];return this.selfDivide(t,0)}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];let i=null,r=null,n=null,s=null,a=null,o=null,c=null,h=null;return a=this._hi/t,o=v.SPLIT*a,i=o-a,h=v.SPLIT*t,i=o-i,r=a-i,n=h-t,c=a*t,n=h-n,s=t-n,h=i*n-c+i*s+r*n+r*s,o=(this._hi-c-h+this._lo-a*e)/t,h=a+o,this._hi=h,this._lo=a-h+o,this}}dump(){return"DD<"+this._hi+", "+this._lo+">"}divide(){if(arguments[0]instanceof v){const t=arguments[0];let e=null,i=null,r=null,n=null,s=null,a=null,o=null,c=null;s=this._hi/t._hi,a=v.SPLIT*s,e=a-s,c=v.SPLIT*t._hi,e=a-e,i=s-e,r=c-t._hi,o=s*t._hi,r=c-r,n=t._hi-r,c=e*r-o+e*n+i*r+i*n,a=(this._hi-o-c+this._lo-s*t._lo)/t._hi,c=s+a;const h=c,d=s-c+a;return new v(h,d)}else if(typeof arguments[0]=="number"){const t=arguments[0];return S.isNaN(t)?v.createNaN():v.copy(this).selfDivide(t,0)}}ge(t){return this._hi>t._hi||this._hi===t._hi&&this._lo>=t._lo}pow(t){if(t===0)return v.valueOf(1);let e=new v(this),i=v.valueOf(1),r=Math.abs(t);if(r>1)for(;r>0;)r%2===1&&i.selfMultiply(e),r/=2,r>0&&(e=e.sqr());else i=e;return t<0?i.reciprocal():i}ceil(){if(this.isNaN())return v.NaN;const t=Math.ceil(this._hi);let e=0;return t===this._hi&&(e=Math.ceil(this._lo)),new v(t,e)}compareTo(t){const e=t;return this._hi<e._hi?-1:this._hi>e._hi?1:this._lo<e._lo?-1:this._lo>e._lo?1:0}rint(){return this.isNaN()?this:this.add(.5).floor()}max(t){return this.ge(t)?this:t}sqrt(){if(this.isZero())return v.valueOf(0);if(this.isNegative())return v.NaN;const t=1/Math.sqrt(this._hi),e=this._hi*t,i=v.valueOf(e),n=this.subtract(i.sqr())._hi*(t*.5);return i.add(n)}selfAdd(){if(arguments.length===1){if(arguments[0]instanceof v){const t=arguments[0];return this.selfAdd(t._hi,t._lo)}else if(typeof arguments[0]=="number"){const t=arguments[0];let e=null,i=null,r=null,n=null,s=null,a=null;return r=this._hi+t,s=r-this._hi,n=r-s,n=t-s+(this._hi-n),a=n+this._lo,e=r+a,i=a+(r-e),this._hi=e+i,this._lo=i+(e-this._hi),this}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];let i=null,r=null,n=null,s=null,a=null,o=null,c=null,h=null;a=this._hi+t,n=this._lo+e,c=a-this._hi,h=n-this._lo,o=a-c,s=n-h,o=t-c+(this._hi-o),s=e-h+(this._lo-s),c=o+n,i=a+c,r=c+(a-i),c=s+r;const d=i+c,m=c+(i-d);return this._hi=d,this._lo=m,this}}selfMultiply(){if(arguments.length===1){if(arguments[0]instanceof v){const t=arguments[0];return this.selfMultiply(t._hi,t._lo)}else if(typeof arguments[0]=="number"){const t=arguments[0];return this.selfMultiply(t,0)}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];let i=null,r=null,n=null,s=null,a=null,o=null;a=v.SPLIT*this._hi,i=a-this._hi,o=v.SPLIT*t,i=a-i,r=this._hi-i,n=o-t,a=this._hi*t,n=o-n,s=t-n,o=i*n-a+i*s+r*n+r*s+(this._hi*e+this._lo*t);const c=a+o;i=a-c;const h=o+i;return this._hi=c,this._lo=h,this}}selfSqr(){return this.selfMultiply(this)}floor(){if(this.isNaN())return v.NaN;const t=Math.floor(this._hi);let e=0;return t===this._hi&&(e=Math.floor(this._lo)),new v(t,e)}negate(){return this.isNaN()?this:new v(-this._hi,-this._lo)}clone(){try{return null}catch(t){if(t instanceof CloneNotSupportedException)return null;throw t}finally{}}intValue(){return Math.trunc(this._hi)}toString(){const t=v.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()}toStandardNotation(){const t=this.getSpecialNumberString();if(t!==null)return t;const e=new Array(1).fill(null),i=this.extractSignificantDigits(!0,e),r=e[0]+1;let n=i;if(i.charAt(0)===".")n="0"+i;else if(r<0)n="0."+v.stringOfChar("0",-r)+i;else if(i.indexOf(".")===-1){const s=r-i.length,a=v.stringOfChar("0",s);n=i+a+".0"}return this.isNegative()?"-"+n:n}toSciNotation(){if(this.isZero())return v.SCI_NOT_ZERO;const t=this.getSpecialNumberString();if(t!==null)return t;const e=new Array(1).fill(null),i=this.extractSignificantDigits(!1,e),r=v.SCI_NOT_EXPONENT_CHAR+e[0];if(i.charAt(0)==="0")throw new Je("Found leading zero: "+i);let n="";i.length>1&&(n=i.substring(1));const s=i.charAt(0)+"."+n;return this.isNegative()?"-"+s+r:s+r}abs(){return this.isNaN()?v.NaN:this.isNegative()?this.negate():new v(this)}isPositive(){return this._hi>0||this._hi===0&&this._lo>0}lt(t){return this._hi<t._hi||this._hi===t._hi&&this._lo<t._lo}add(){if(arguments[0]instanceof v){const t=arguments[0];return v.copy(this).selfAdd(t)}else if(typeof arguments[0]=="number"){const t=arguments[0];return v.copy(this).selfAdd(t)}}init(){if(arguments.length===1){if(typeof arguments[0]=="number"){const t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof v){const t=arguments[0];this._hi=t._hi,this._lo=t._lo}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this._hi=t,this._lo=e}}gt(t){return this._hi>t._hi||this._hi===t._hi&&this._lo>t._lo}isNegative(){return this._hi<0||this._hi===0&&this._lo<0}trunc(){return this.isNaN()?v.NaN:this.isPositive()?this.floor():this.ceil()}signum(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}get interfaces_(){return[kt,Ct,Ti]}}v.PI=new v(3.141592653589793,12246467991473532e-32);v.TWO_PI=new v(6.283185307179586,24492935982947064e-32);v.PI_2=new v(1.5707963267948966,6123233995736766e-32);v.E=new v(2.718281828459045,14456468917292502e-32);v.NaN=new v(S.NaN,S.NaN);v.EPS=123259516440783e-46;v.SPLIT=134217729;v.MAX_PRINT_DIGITS=32;v.TEN=v.valueOf(10);v.ONE=v.valueOf(1);v.SCI_NOT_EXPONENT_CHAR="E";v.SCI_NOT_ZERO="0.0E0";class qt{static orientationIndex(t,e,i){const r=qt.orientationIndexFilter(t,e,i);if(r<=1)return r;const n=v.valueOf(e.x).selfAdd(-t.x),s=v.valueOf(e.y).selfAdd(-t.y),a=v.valueOf(i.x).selfAdd(-e.x),o=v.valueOf(i.y).selfAdd(-e.y);return n.selfMultiply(o).selfSubtract(s.selfMultiply(a)).signum()}static signOfDet2x2(){if(arguments[3]instanceof v&&arguments[2]instanceof v&&arguments[0]instanceof v&&arguments[1]instanceof v){const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3];return t.multiply(r).selfSubtract(e.multiply(i)).signum()}else if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3],n=v.valueOf(t),s=v.valueOf(e),a=v.valueOf(i),o=v.valueOf(r);return n.multiply(o).selfSubtract(s.multiply(a)).signum()}}static intersection(t,e,i,r){const n=new v(t.y).selfSubtract(e.y),s=new v(e.x).selfSubtract(t.x),a=new v(t.x).selfMultiply(e.y).selfSubtract(new v(e.x).selfMultiply(t.y)),o=new v(i.y).selfSubtract(r.y),c=new v(r.x).selfSubtract(i.x),h=new v(i.x).selfMultiply(r.y).selfSubtract(new v(r.x).selfMultiply(i.y)),d=s.multiply(h).selfSubtract(c.multiply(a)),m=o.multiply(a).selfSubtract(n.multiply(h)),p=n.multiply(c).selfSubtract(o.multiply(s)),b=d.selfDivide(p).doubleValue(),x=m.selfDivide(p).doubleValue();return S.isNaN(b)||S.isInfinite(b)||S.isNaN(x)||S.isInfinite(x)?null:new f(b,x)}static orientationIndexFilter(t,e,i){let r=null;const n=(t.x-i.x)*(e.y-i.y),s=(t.y-i.y)*(e.x-i.x),a=n-s;if(n>0){if(s<=0)return qt.signum(a);r=n+s}else if(n<0){if(s>=0)return qt.signum(a);r=-n-s}else return qt.signum(a);const o=qt.DP_SAFE_EPSILON*r;return a>=o||-a>=o?qt.signum(a):2}static signum(t){return t>0?1:t<0?-1:0}}qt.DP_SAFE_EPSILON=1e-15;class I{static isCCW(){if(arguments[0]instanceof Array){const t=arguments[0],e=t.length-1;if(e<3)throw new F("Ring has fewer than 4 points, so orientation cannot be determined");let i=t[0],r=0;for(let d=1;d<=e;d++){const m=t[d];m.y>i.y&&(i=m,r=d)}let n=r;do n=n-1,n<0&&(n=e);while(t[n].equals2D(i)&&n!==r);let s=r;do s=(s+1)%e;while(t[s].equals2D(i)&&s!==r);const a=t[n],o=t[s];if(a.equals2D(i)||o.equals2D(i)||a.equals2D(o))return!1;const c=I.index(a,i,o);let h=null;return c===0?h=a.x>o.x:h=c>0,h}else if(M(arguments[0],O)){const t=arguments[0],e=t.size()-1;if(e<3)throw new F("Ring has fewer than 4 points, so orientation cannot be determined");let i=t.getCoordinate(0),r=0;for(let d=1;d<=e;d++){const m=t.getCoordinate(d);m.y>i.y&&(i=m,r=d)}let n=null,s=r;do s=s-1,s<0&&(s=e),n=t.getCoordinate(s);while(n.equals2D(i)&&s!==r);let a=null,o=r;do o=(o+1)%e,a=t.getCoordinate(o);while(a.equals2D(i)&&o!==r);if(n.equals2D(i)||a.equals2D(i)||n.equals2D(a))return!1;const c=I.index(n,i,a);let h=null;return c===0?h=n.x>a.x:h=c>0,h}}static index(t,e,i){return qt.orientationIndex(t,e,i)}}I.CLOCKWISE=-1;I.RIGHT=I.CLOCKWISE;I.COUNTERCLOCKWISE=1;I.LEFT=I.COUNTERCLOCKWISE;I.COLLINEAR=0;I.STRAIGHT=I.COLLINEAR;class Ce extends k{constructor(){super(),Ce.constructor_.apply(this,arguments)}static constructor_(){this._shell=null,this._holes=null;let t=arguments[0],e=arguments[1],i=arguments[2];if(k.constructor_.call(this,i),t===null&&(t=this.getFactory().createLinearRing()),e===null&&(e=[]),k.hasNullElements(e))throw new F("holes must not contain null elements");if(t.isEmpty()&&k.hasNonEmptyElements(e))throw new F("shell is empty but holes are not");this._shell=t,this._holes=e}computeEnvelopeInternal(){return this._shell.getEnvelopeInternal()}getCoordinates(){if(this.isEmpty())return[];const t=new Array(this.getNumPoints()).fill(null);let e=-1;const i=this._shell.getCoordinates();for(let r=0;r<i.length;r++)e++,t[e]=i[r];for(let r=0;r<this._holes.length;r++){const n=this._holes[r].getCoordinates();for(let s=0;s<n.length;s++)e++,t[e]=n[s]}return t}getArea(){let t=0;t+=_i.ofRing(this._shell.getCoordinateSequence());for(let e=0;e<this._holes.length;e++)t-=_i.ofRing(this._holes[e].getCoordinateSequence());return t}equalsExact(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof k){const t=arguments[0],e=arguments[1];if(!this.isEquivalentClass(t))return!1;const i=t,r=this._shell,n=i._shell;if(!r.equalsExact(n,e)||this._holes.length!==i._holes.length)return!1;for(let s=0;s<this._holes.length;s++)if(!this._holes[s].equalsExact(i._holes[s],e))return!1;return!0}else return super.equalsExact.apply(this,arguments)}reverseInternal(){const t=this.getExteriorRing().reverse(),e=new Array(this.getNumInteriorRing()).fill(null);for(let i=0;i<e.length;i++)e[i]=this.getInteriorRingN(i).reverse();return this.getFactory().createPolygon(t,e)}getTypeCode(){return k.TYPECODE_POLYGON}getDimension(){return 2}getBoundary(){if(this.isEmpty())return this.getFactory().createMultiLineString();const t=new Array(this._holes.length+1).fill(null);t[0]=this._shell;for(let e=0;e<this._holes.length;e++)t[e+1]=this._holes[e];return t.length<=1?this.getFactory().createLinearRing(t[0].getCoordinateSequence()):this.getFactory().createMultiLineString(t)}getGeometryType(){return k.TYPENAME_POLYGON}getExteriorRing(){return this._shell}copyInternal(){const t=this._shell.copy(),e=new Array(this._holes.length).fill(null);for(let i=0;i<this._holes.length;i++)e[i]=this._holes[i].copy();return new Ce(t,e,this._factory)}isRectangle(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;const t=this._shell.getCoordinateSequence(),e=this.getEnvelopeInternal();for(let n=0;n<5;n++){const s=t.getX(n);if(!(s===e.getMinX()||s===e.getMaxX()))return!1;const a=t.getY(n);if(!(a===e.getMinY()||a===e.getMaxY()))return!1}let i=t.getX(0),r=t.getY(0);for(let n=1;n<=4;n++){const s=t.getX(n),a=t.getY(n);if(s!==i===(a!==r))return!1;i=s,r=a}return!0}normalize(){if(arguments.length===0){this._shell=this.normalized(this._shell,!0);for(let t=0;t<this._holes.length;t++)this._holes[t]=this.normalized(this._holes[t],!1);_e.sort(this._holes)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];if(t.isEmpty())return null;const i=t.getCoordinateSequence(),r=K.minCoordinateIndex(i,0,i.size()-2);K.scroll(i,r,!0),I.isCCW(i)===e&&K.reverse(i)}}getCoordinate(){return this._shell.getCoordinate()}getNumInteriorRing(){return this._holes.length}getBoundaryDimension(){return 1}getLength(){let t=0;t+=this._shell.getLength();for(let e=0;e<this._holes.length;e++)t+=this._holes[e].getLength();return t}getNumPoints(){let t=this._shell.getNumPoints();for(let e=0;e<this._holes.length;e++)t+=this._holes[e].getNumPoints();return t}convexHull(){return this.getExteriorRing().convexHull()}normalized(t,e){const i=t.copy();return this.normalize(i,e),i}compareToSameClass(){if(arguments.length===1){const t=arguments[0],e=this._shell,i=t._shell;return e.compareToSameClass(i)}else if(arguments.length===2){const t=arguments[0],e=arguments[1],i=t,r=this._shell,n=i._shell,s=r.compareToSameClass(n,e);if(s!==0)return s;const a=this.getNumInteriorRing(),o=i.getNumInteriorRing();let c=0;for(;c<a&&c<o;){const h=this.getInteriorRingN(c),d=i.getInteriorRingN(c),m=h.compareToSameClass(d,e);if(m!==0)return m;c++}return c<a?1:c<o?-1:0}}apply(){if(M(arguments[0],Ir)){const t=arguments[0];this._shell.apply(t);for(let e=0;e<this._holes.length;e++)this._holes[e].apply(t)}else if(M(arguments[0],Tr)){const t=arguments[0];if(this._shell.apply(t),!t.isDone())for(let e=0;e<this._holes.length&&(this._holes[e].apply(t),!t.isDone());e++);t.isGeometryChanged()&&this.geometryChanged()}else if(M(arguments[0],Lr))arguments[0].filter(this);else if(M(arguments[0],Ni)){const t=arguments[0];t.filter(this),this._shell.apply(t);for(let e=0;e<this._holes.length;e++)this._holes[e].apply(t)}}isEmpty(){return this._shell.isEmpty()}getInteriorRingN(t){return this._holes[t]}get interfaces_(){return[pa]}}class ei extends ht{constructor(){super(),ei.constructor_.apply(this,arguments)}static constructor_(){const t=arguments[0],e=arguments[1];ht.constructor_.call(this,t,e)}equalsExact(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof k){const t=arguments[0],e=arguments[1];return this.isEquivalentClass(t)?super.equalsExact.call(this,t,e):!1}else return super.equalsExact.apply(this,arguments)}getTypeCode(){return k.TYPECODE_MULTIPOINT}getDimension(){return 0}getBoundary(){return this.getFactory().createGeometryCollection()}getGeometryType(){return k.TYPENAME_MULTIPOINT}copyInternal(){const t=new Array(this._geometries.length).fill(null);for(let e=0;e<t.length;e++)t[e]=this._geometries[e].copy();return new ei(t,this._factory)}isValid(){return!0}getCoordinate(){if(arguments.length===1&&Number.isInteger(arguments[0])){const t=arguments[0];return this._geometries[t].getCoordinate()}else return super.getCoordinate.apply(this,arguments)}getBoundaryDimension(){return y.FALSE}get interfaces_(){return[ba]}}class nt{constructor(){nt.constructor_.apply(this,arguments)}static constructor_(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,arguments.length===0)nt.constructor_.call(this,new j,0);else if(arguments.length===1){if(M(arguments[0],ua)){const t=arguments[0];nt.constructor_.call(this,new j,0,t)}else if(arguments[0]instanceof j){const t=arguments[0];nt.constructor_.call(this,t,0,nt.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];nt.constructor_.call(this,t,e,nt.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){const t=arguments[0],e=arguments[1],i=arguments[2];this._precisionModel=t,this._coordinateSequenceFactory=i,this._SRID=e}}static toMultiPolygonArray(t){const e=new Array(t.size()).fill(null);return t.toArray(e)}static toGeometryArray(t){if(t===null)return null;const e=new Array(t.size()).fill(null);return t.toArray(e)}static getDefaultCoordinateSequenceFactory(){return Xe.instance()}static toMultiLineStringArray(t){const e=new Array(t.size()).fill(null);return t.toArray(e)}static toLineStringArray(t){const e=new Array(t.size()).fill(null);return t.toArray(e)}static toMultiPointArray(t){const e=new Array(t.size()).fill(null);return t.toArray(e)}static toLinearRingArray(t){const e=new Array(t.size()).fill(null);return t.toArray(e)}static toPointArray(t){const e=new Array(t.size()).fill(null);return t.toArray(e)}static toPolygonArray(t){const e=new Array(t.size()).fill(null);return t.toArray(e)}static createPointFromInternalCoord(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)}createEmpty(t){switch(t){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new F("Invalid dimension: "+t)}}toGeometry(t){return t.isNull()?this.createPoint():t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new f(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new f(t.getMinX(),t.getMinY()),new f(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new f(t.getMinX(),t.getMinY()),new f(t.getMinX(),t.getMaxY()),new f(t.getMaxX(),t.getMaxY()),new f(t.getMaxX(),t.getMinY()),new f(t.getMinX(),t.getMinY())]),null)}createLineString(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){const t=arguments[0];return this.createLineString(t!==null?this.getCoordinateSequenceFactory().create(t):null)}else if(M(arguments[0],O)){const t=arguments[0];return new ne(t,this)}}}createMultiLineString(){if(arguments.length===0)return new Qe(null,this);if(arguments.length===1){const t=arguments[0];return new Qe(t,this)}}createPolygon(){if(arguments.length===0)return this.createPolygon(null,null);if(arguments.length===1){if(M(arguments[0],O)){const t=arguments[0];return this.createPolygon(this.createLinearRing(t))}else if(arguments[0]instanceof Array){const t=arguments[0];return this.createPolygon(this.createLinearRing(t))}else if(arguments[0]instanceof se){const t=arguments[0];return this.createPolygon(t,null)}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];return new Ce(t,e,this)}}getSRID(){return this._SRID}createGeometryCollection(){if(arguments.length===0)return new ht(null,this);if(arguments.length===1){const t=arguments[0];return new ht(t,this)}}getPrecisionModel(){return this._precisionModel}createLinearRing(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){const t=arguments[0];return this.createLinearRing(t!==null?this.getCoordinateSequenceFactory().create(t):null)}else if(M(arguments[0],O)){const t=arguments[0];return new se(t,this)}}}createMultiPolygon(){if(arguments.length===0)return new Ze(null,this);if(arguments.length===1){const t=arguments[0];return new Ze(t,this)}}createMultiPoint(){if(arguments.length===0)return new ei(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){const t=arguments[0];return new ei(t,this)}else if(M(arguments[0],O)){const t=arguments[0];if(t===null)return this.createMultiPoint(new Array(0).fill(null));const e=new Array(t.size()).fill(null);for(let i=0;i<t.size();i++){const r=this.getCoordinateSequenceFactory().create(1,t.getDimension(),t.getMeasures());K.copy(t,i,r,0,1),e[i]=this.createPoint(r)}return this.createMultiPoint(e)}}}buildGeometry(t){let e=null,i=!1,r=!1;for(let a=t.iterator();a.hasNext();){const o=a.next(),c=o.getTypeCode();e===null&&(e=c),c!==e&&(i=!0),o instanceof ht&&(r=!0)}if(e===null)return this.createGeometryCollection();if(i||r)return this.createGeometryCollection(nt.toGeometryArray(t));const n=t.iterator().next();if(t.size()>1){if(n instanceof Ce)return this.createMultiPolygon(nt.toPolygonArray(t));if(n instanceof ne)return this.createMultiLineString(nt.toLineStringArray(t));if(n instanceof ti)return this.createMultiPoint(nt.toPointArray(t));P.shouldNeverReachHere("Unhandled geometry type: "+n.getGeometryType())}return n}createMultiPointFromCoords(t){return this.createMultiPoint(t!==null?this.getCoordinateSequenceFactory().create(t):null)}createPoint(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof f){const t=arguments[0];return this.createPoint(t!==null?this.getCoordinateSequenceFactory().create([t]):null)}else if(M(arguments[0],O)){const t=arguments[0];return new ti(t,this)}}}getCoordinateSequenceFactory(){return this._coordinateSequenceFactory}get interfaces_(){return[kt]}}function hi(g){return[g.x,g.y]}class Yl{constructor(t,e){this.geometryFactory=t||new nt,this.ol=e||typeof ol<"u"&&ol}inject(t,e,i,r,n,s,a,o){this.ol={geom:{Point:t,LineString:e,LinearRing:i,Polygon:r,MultiPoint:n,MultiLineString:s,MultiPolygon:a,GeometryCollection:o}}}read(t){const e=this.ol;if(t instanceof e.geom.Point)return this.convertFromPoint(t);if(t instanceof e.geom.LineString)return this.convertFromLineString(t);if(t instanceof e.geom.LinearRing)return this.convertFromLinearRing(t);if(t instanceof e.geom.Polygon)return this.convertFromPolygon(t);if(t instanceof e.geom.MultiPoint)return this.convertFromMultiPoint(t);if(t instanceof e.geom.MultiLineString)return this.convertFromMultiLineString(t);if(t instanceof e.geom.MultiPolygon)return this.convertFromMultiPolygon(t);if(t instanceof e.geom.GeometryCollection)return this.convertFromCollection(t)}convertFromPoint(t){const e=t.getCoordinates();return this.geometryFactory.createPoint(new f(e[0],e[1]))}convertFromLineString(t){return this.geometryFactory.createLineString(t.getCoordinates().map(function(e){return new f(e[0],e[1])}))}convertFromLinearRing(t){return this.geometryFactory.createLinearRing(t.getCoordinates().map(function(e){return new f(e[0],e[1])}))}convertFromPolygon(t){const e=t.getLinearRings();let i=null;const r=[];for(let n=0;n<e.length;n++){const s=this.convertFromLinearRing(e[n]);n===0?i=s:r.push(s)}return this.geometryFactory.createPolygon(i,r)}convertFromMultiPoint(t){const e=t.getPoints().map(function(i){return this.convertFromPoint(i)},this);return this.geometryFactory.createMultiPoint(e)}convertFromMultiLineString(t){const e=t.getLineStrings().map(function(i){return this.convertFromLineString(i)},this);return this.geometryFactory.createMultiLineString(e)}convertFromMultiPolygon(t){const e=t.getPolygons().map(function(i){return this.convertFromPolygon(i)},this);return this.geometryFactory.createMultiPolygon(e)}convertFromCollection(t){const e=t.getGeometries().map(function(i){return this.read(i)},this);return this.geometryFactory.createGeometryCollection(e)}write(t){if(t.getGeometryType()==="Point")return this.convertToPoint(t.getCoordinate());if(t.getGeometryType()==="LineString")return this.convertToLineString(t);if(t.getGeometryType()==="LinearRing")return this.convertToLinearRing(t);if(t.getGeometryType()==="Polygon")return this.convertToPolygon(t);if(t.getGeometryType()==="MultiPoint")return this.convertToMultiPoint(t);if(t.getGeometryType()==="MultiLineString")return this.convertToMultiLineString(t);if(t.getGeometryType()==="MultiPolygon")return this.convertToMultiPolygon(t);if(t.getGeometryType()==="GeometryCollection")return this.convertToCollection(t)}convertToPoint(t){return new this.ol.geom.Point([t.x,t.y])}convertToLineString(t){const e=t._points._coordinates.map(hi);return new this.ol.geom.LineString(e)}convertToLinearRing(t){const e=t._points._coordinates.map(hi);return new this.ol.geom.LinearRing(e)}convertToPolygon(t){const e=[t._shell._points._coordinates.map(hi)];for(let i=0;i<t._holes.length;i++)e.push(t._holes[i]._points._coordinates.map(hi));return new this.ol.geom.Polygon(e)}convertToMultiPoint(t){return new this.ol.geom.MultiPoint(t.getCoordinates().map(hi))}convertToMultiLineString(t){const e=[];for(let i=0;i<t._geometries.length;i++)e.push(this.convertToLineString(t._geometries[i]).getCoordinates());return new this.ol.geom.MultiLineString(e)}convertToMultiPolygon(t){const e=[];for(let i=0;i<t._geometries.length;i++)e.push(this.convertToPolygon(t._geometries[i]).getCoordinates());return new this.ol.geom.MultiPolygon(e)}convertToCollection(t){const e=[];for(let i=0;i<t._geometries.length;i++){const r=t._geometries[i];e.push(this.write(r))}return new this.ol.geom.GeometryCollection(e)}}class N{constructor(){N.constructor_.apply(this,arguments)}static constructor_(){if(this._quadrantSegments=N.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=N.CAP_ROUND,this._joinStyle=N.JOIN_ROUND,this._mitreLimit=N.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=N.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){const t=arguments[0];this.setQuadrantSegments(t)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this.setQuadrantSegments(t),this.setEndCapStyle(e)}else if(arguments.length===4){const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3];this.setQuadrantSegments(t),this.setEndCapStyle(e),this.setJoinStyle(i),this.setMitreLimit(r)}}}static bufferDistanceError(t){const e=Math.PI/2/t;return 1-Math.cos(e/2)}getEndCapStyle(){return this._endCapStyle}isSingleSided(){return this._isSingleSided}setQuadrantSegments(t){this._quadrantSegments=t,this._quadrantSegments===0&&(this._joinStyle=N.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=N.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==N.JOIN_ROUND&&(this._quadrantSegments=N.DEFAULT_QUADRANT_SEGMENTS)}getJoinStyle(){return this._joinStyle}setJoinStyle(t){this._joinStyle=t}setSimplifyFactor(t){this._simplifyFactor=t<0?0:t}getSimplifyFactor(){return this._simplifyFactor}getQuadrantSegments(){return this._quadrantSegments}setEndCapStyle(t){this._endCapStyle=t}getMitreLimit(){return this._mitreLimit}setMitreLimit(t){this._mitreLimit=t}setSingleSided(t){this._isSingleSided=t}}N.CAP_ROUND=1;N.CAP_FLAT=2;N.CAP_SQUARE=3;N.JOIN_ROUND=1;N.JOIN_MITRE=2;N.JOIN_BEVEL=3;N.DEFAULT_QUADRANT_SEGMENTS=8;N.DEFAULT_MITRE_LIMIT=5;N.DEFAULT_SIMPLIFY_FACTOR=.01;class It{static relativeSign(t,e){return t<e?-1:t>e?1:0}static compareValue(t,e){return t<0?-1:t>0?1:e<0?-1:e>0?1:0}static compare(t,e,i){if(e.equals2D(i))return 0;const r=It.relativeSign(e.x,i.x),n=It.relativeSign(e.y,i.y);switch(t){case 0:return It.compareValue(r,n);case 1:return It.compareValue(n,r);case 2:return It.compareValue(n,-r);case 3:return It.compareValue(-r,n);case 4:return It.compareValue(-r,-n);case 5:return It.compareValue(-n,-r);case 6:return It.compareValue(-n,r);case 7:return It.compareValue(r,-n)}return P.shouldNeverReachHere("invalid octant value"),0}}class Sn{constructor(){Sn.constructor_.apply(this,arguments)}static constructor_(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3];this._segString=t,this.coord=new f(e),this.segmentIndex=i,this._segmentOctant=r,this._isInterior=!e.equals2D(t.getCoordinate(i))}getCoordinate(){return this.coord}print(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)}compareTo(t){const e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:this._isInterior?e._isInterior?It.compare(this._segmentOctant,this.coord,e.coord):1:-1}isEndPoint(t){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===t}toString(){return this.segmentIndex+":"+this.coord.toString()}isInterior(){return this._isInterior}get interfaces_(){return[Ct]}}class Wl{hasNext(){}next(){}remove(){}}class Xl extends fa{}const Ut=0,le=1;function Es(g){return g==null?Ut:g.color}function V(g){return g==null?null:g.parent}function Bt(g,t){g!==null&&(g.color=t)}function rn(g){return g==null?null:g.left}function Cs(g){return g==null?null:g.right}class me extends Xl{constructor(){super(),this.root_=null,this.size_=0}get(t){let e=this.root_;for(;e!==null;){const i=t.compareTo(e.key);if(i<0)e=e.left;else if(i>0)e=e.right;else return e.value}return null}put(t,e){if(this.root_===null)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:Ut,getValue(){return this.value},getKey(){return this.key}},this.size_=1,null;let i=this.root_,r,n;do if(r=i,n=t.compareTo(i.key),n<0)i=i.left;else if(n>0)i=i.right;else{const a=i.value;return i.value=e,a}while(i!==null);const s={key:t,left:null,right:null,value:e,parent:r,color:Ut,getValue(){return this.value},getKey(){return this.key}};return n<0?r.left=s:r.right=s,this.fixAfterInsertion(s),this.size_++,null}fixAfterInsertion(t){let e;for(t.color=le;t!=null&&t!==this.root_&&t.parent.color===le;)V(t)===rn(V(V(t)))?(e=Cs(V(V(t))),Es(e)===le?(Bt(V(t),Ut),Bt(e,Ut),Bt(V(V(t)),le),t=V(V(t))):(t===Cs(V(t))&&(t=V(t),this.rotateLeft(t)),Bt(V(t),Ut),Bt(V(V(t)),le),this.rotateRight(V(V(t))))):(e=rn(V(V(t))),Es(e)===le?(Bt(V(t),Ut),Bt(e,Ut),Bt(V(V(t)),le),t=V(V(t))):(t===rn(V(t))&&(t=V(t),this.rotateRight(t)),Bt(V(t),Ut),Bt(V(V(t)),le),this.rotateLeft(V(V(t)))));this.root_.color=Ut}values(){const t=new L;let e=this.getFirstEntry();if(e!==null)for(t.add(e.value);(e=me.successor(e))!==null;)t.add(e.value);return t}entrySet(){const t=new kn;let e=this.getFirstEntry();if(e!==null)for(t.add(e);(e=me.successor(e))!==null;)t.add(e);return t}rotateLeft(t){if(t!=null){const e=t.right;t.right=e.left,e.left!=null&&(e.left.parent=t),e.parent=t.parent,t.parent==null?this.root_=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}}rotateRight(t){if(t!=null){const e=t.left;t.left=e.right,e.right!=null&&(e.right.parent=t),e.parent=t.parent,t.parent==null?this.root_=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}}getFirstEntry(){let t=this.root_;if(t!=null)for(;t.left!=null;)t=t.left;return t}static successor(t){let e;if(t===null)return null;if(t.right!==null){for(e=t.right;e.left!==null;)e=e.left;return e}else{e=t.parent;let i=t;for(;e!==null&&i===e.right;)i=e,e=e.parent;return e}}size(){return this.size_}containsKey(t){let e=this.root_;for(;e!==null;){const i=t.compareTo(e.key);if(i<0)e=e.left;else if(i>0)e=e.right;else return!0}return!1}}class En{constructor(){En.constructor_.apply(this,arguments)}static constructor_(){this._nodeMap=new me,this._edge=null;const t=arguments[0];this._edge=t}getSplitCoordinates(){const t=new re;this.addEndpoints();const e=this.iterator();let i=e.next();for(;e.hasNext();){const r=e.next();this.addEdgeCoordinates(i,r,t),i=r}return t.toCoordinateArray()}print(t){t.println("Intersections:");for(let e=this.iterator();e.hasNext();)e.next().print(t)}findCollapsesFromExistingVertices(t){for(let e=0;e<this._edge.size()-2;e++){const i=this._edge.getCoordinate(e);this._edge.getCoordinate(e+1);const r=this._edge.getCoordinate(e+2);i.equals2D(r)&&t.add(Ke.valueOf(e+1))}}addEdgeCoordinates(t,e,i){const r=this.createSplitEdgePts(t,e);i.add(r,!1)}findCollapseIndex(t,e,i){if(!t.coord.equals2D(e.coord))return!1;let r=e.segmentIndex-t.segmentIndex;return e.isInterior()||r--,r===1?(i[0]=t.segmentIndex+1,!0):!1}findCollapsesFromInsertedNodes(t){const e=new Array(1).fill(null),i=this.iterator();let r=i.next();for(;i.hasNext();){const n=i.next();this.findCollapseIndex(r,n,e)&&t.add(Ke.valueOf(e[0])),r=n}}getEdge(){return this._edge}addEndpoints(){const t=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(t),t)}createSplitEdge(t,e){const i=this.createSplitEdgePts(t,e);return new Xt(i,this._edge.getData())}add(t,e){const i=new Sn(this._edge,t,e,this._edge.getSegmentOctant(e)),r=this._nodeMap.get(i);return r!==null?(P.isTrue(r.coord.equals2D(t),"Found equal nodes with different coordinates"),r):(this._nodeMap.put(i,i),i)}checkSplitEdgesCorrectness(t){const e=this._edge.getCoordinates(),r=t.get(0).getCoordinate(0);if(!r.equals2D(e[0]))throw new Nt("bad split edge start point at "+r);const s=t.get(t.size()-1).getCoordinates(),a=s[s.length-1];if(!a.equals2D(e[e.length-1]))throw new Nt("bad split edge end point at "+a)}addCollapsedNodes(){const t=new L;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(let e=t.iterator();e.hasNext();){const i=e.next().intValue();this.add(this._edge.getCoordinate(i),i)}}createSplitEdgePts(t,e){let i=e.segmentIndex-t.segmentIndex+2;if(i===2)return[new f(t.coord),new f(e.coord)];const r=this._edge.getCoordinate(e.segmentIndex),n=e.isInterior()||!e.coord.equals2D(r);n||i--;const s=new Array(i).fill(null);let a=0;s[a++]=new f(t.coord);for(let o=t.segmentIndex+1;o<=e.segmentIndex;o++)s[a++]=this._edge.getCoordinate(o);return n&&(s[a]=new f(e.coord)),s}iterator(){return this._nodeMap.values().iterator()}addSplitEdges(t){this.addEndpoints(),this.addCollapsedNodes();const e=this.iterator();let i=e.next();for(;e.hasNext();){const r=e.next(),n=this.createSplitEdge(i,r);t.add(n),i=r}}}const Te={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"},Is={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},va="EMPTY",ya="Z",xa="M",Zl="ZM",B={TEXT:1,LEFT_PAREN:2,RIGHT_PAREN:3,NUMBER:4,COMMA:5,EOF:6};for(const g in Is)Is[g].toUpperCase();class Kl{constructor(t){this.wkt=t,this.index_=-1}isAlpha_(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"}isNumeric_(t,e){const i=e!==void 0?e:!1;return t>="0"&&t<="9"||t=="."&&!i}isWhiteSpace_(t){return t==" "||t=="	"||t=="\r"||t==`
`}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){const t=this.nextChar_(),e=this.index_;let i=t,r;if(t=="(")r=B.LEFT_PAREN;else if(t==",")r=B.COMMA;else if(t==")")r=B.RIGHT_PAREN;else if(this.isNumeric_(t)||t=="-")r=B.NUMBER,i=this.readNumber_();else if(this.isAlpha_(t))r=B.TEXT,i=this.readText_();else{if(this.isWhiteSpace_(t))return this.nextToken();if(t==="")r=B.EOF;else throw new Error("Unexpected character: "+t)}return{position:e,value:i,type:r}}readNumber_(){let t;const e=this.index_;let i=!1,r=!1;do t=="."?i=!0:(t=="e"||t=="E")&&(r=!0),t=this.nextChar_();while(this.isNumeric_(t,i)||!r&&(t=="e"||t=="E")||r&&(t=="-"||t=="+"));return parseFloat(this.wkt.substring(e,this.index_--))}readText_(){let t;const e=this.index_;do t=this.nextChar_();while(this.isAlpha_(t));return this.wkt.substring(e,this.index_--).toUpperCase()}}class Ql{constructor(t,e){this.lexer_=t,this.token_,this.layout_=Te.XY,this.factory=e}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(t){return this.token_.type==t}match(t){const e=this.isTokenType(t);return e&&this.consume_(),e}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let t=Te.XY;const e=this.token_;if(this.isTokenType(B.TEXT)){const i=e.value;i===ya?t=Te.XYZ:i===xa?t=Te.XYM:i===Zl&&(t=Te.XYZM),t!==Te.XY&&this.consume_()}return t}parseGeometryCollectionText_(){if(this.match(B.LEFT_PAREN)){const t=[];do t.push(this.parseGeometry_());while(this.match(B.COMMA));if(this.match(B.RIGHT_PAREN))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(B.LEFT_PAREN)){const t=this.parsePoint_();if(this.match(B.RIGHT_PAREN))return t}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(B.LEFT_PAREN)){const t=this.parsePointList_();if(this.match(B.RIGHT_PAREN))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(B.LEFT_PAREN)){const t=this.parseLineStringTextList_();if(this.match(B.RIGHT_PAREN))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(B.LEFT_PAREN)){let t;if(this.token_.type==B.LEFT_PAREN?t=this.parsePointTextList_():t=this.parsePointList_(),this.match(B.RIGHT_PAREN))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(B.LEFT_PAREN)){const t=this.parseLineStringTextList_();if(this.match(B.RIGHT_PAREN))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(B.LEFT_PAREN)){const t=this.parsePolygonTextList_();if(this.match(B.RIGHT_PAREN))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}parsePoint_(){const t=[],e=this.layout_.length;for(let i=0;i<e;++i){const r=this.token_;if(this.match(B.NUMBER))t.push(r.value);else break}if(t.length==e)return t;throw new Error(this.formatErrorMessage_())}parsePointList_(){const t=[this.parsePoint_()];for(;this.match(B.COMMA);)t.push(this.parsePoint_());return t}parsePointTextList_(){const t=[this.parsePointText_()];for(;this.match(B.COMMA);)t.push(this.parsePointText_());return t}parseLineStringTextList_(){const t=[this.parseLineStringText_()];for(;this.match(B.COMMA);)t.push(this.parseLineStringText_());return t}parsePolygonTextList_(){const t=[this.parsePolygonText_()];for(;this.match(B.COMMA);)t.push(this.parsePolygonText_());return t}isEmptyGeometry_(){const t=this.isTokenType(B.TEXT)&&this.token_.value==va;return t&&this.consume_(),t}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){const t=this.factory,e=n=>n?new f(...n):new f,i=n=>{const s=n.map(a=>t.createLinearRing(a.map(e)));return s.length>1?t.createPolygon(s[0],s.slice(1)):s.length===1?t.createPolygon(s[0]):t.createPolygon()},r=this.token_;if(this.match(B.TEXT)){const n=r.value;if(this.layout_=this.parseGeometryLayout_(),n=="GEOMETRYCOLLECTION"){const s=this.parseGeometryCollectionText_();return t.createGeometryCollection(s)}else switch(n){case"POINT":{const s=this.parsePointText_();return s?t.createPoint(new f(...s)):t.createPoint()}case"LINESTRING":{const a=this.parseLineStringText_().map(e);return t.createLineString(a)}case"LINEARRING":{const a=this.parseLineStringText_().map(e);return t.createLinearRing(a)}case"POLYGON":{const s=this.parsePolygonText_();return!s||s.length===0?t.createPolygon():i(s)}case"MULTIPOINT":{const s=this.parseMultiPointText_();if(!s||s.length===0)return t.createMultiPoint();const a=s.map(e).map(o=>t.createPoint(o));return t.createMultiPoint(a)}case"MULTILINESTRING":{const a=this.parseMultiLineStringText_().map(o=>t.createLineString(o.map(e)));return t.createMultiLineString(a)}case"MULTIPOLYGON":{const s=this.parseMultiPolygonText_();if(!s||s.length===0)return t.createMultiPolygon();const a=s.map(i);return t.createMultiPolygon(a)}default:throw new Error("Invalid geometry type: "+n)}}throw new Error(this.formatErrorMessage_())}}function wa(g){if(g.isEmpty())return"";const t=g.getCoordinate(),e=[t.x,t.y];return t.z!==void 0&&!Number.isNaN(t.z)&&e.push(t.z),t.m!==void 0&&!Number.isNaN(t.m)&&e.push(t.m),e.join(" ")}function Jl(g){const t=[];for(let e=0,i=g.getNumGeometries();e<i;++e)t.push("("+wa(g.getGeometryN(e))+")");return t.join(", ")}function tg(g){const t=[];for(let e=0,i=g.getNumGeometries();e<i;++e)t.push(ka(g.getGeometryN(e)));return t.join(", ")}function Si(g){const t=g.getCoordinates().map(i=>{const r=[i.x,i.y];return i.z!==void 0&&!Number.isNaN(i.z)&&r.push(i.z),i.m!==void 0&&!Number.isNaN(i.m)&&r.push(i.m),r}),e=[];for(let i=0,r=t.length;i<r;++i)e.push(t[i].join(" "));return e.join(", ")}function eg(g){const t=[];for(let e=0,i=g.getNumGeometries();e<i;++e)t.push("("+Si(g.getGeometryN(e))+")");return t.join(", ")}function _a(g){const t=[];t.push("("+Si(g.getExteriorRing())+")");for(let e=0,i=g.getNumInteriorRing();e<i;++e)t.push("("+Si(g.getInteriorRingN(e))+")");return t.join(", ")}function ig(g){const t=[];for(let e=0,i=g.getNumGeometries();e<i;++e)t.push("("+_a(g.getGeometryN(e))+")");return t.join(", ")}function rg(g){let t="";if(g.isEmpty())return t;const e=g.getCoordinate();return e.z!==void 0&&!Number.isNaN(e.z)&&(t+=ya),e.m!==void 0&&!Number.isNaN(e.m)&&(t+=xa),t}const ng={Point:wa,LineString:Si,LinearRing:Si,Polygon:_a,MultiPoint:Jl,MultiLineString:eg,MultiPolygon:ig,GeometryCollection:tg};function ka(g){let t=g.getGeometryType();const e=ng[t];t=t.toUpperCase();const i=rg(g);if(i.length>0&&(t+=" "+i),g.isEmpty())return t+" "+va;const r=e(g);return t+" ("+r+")"}class sg{constructor(t){this.geometryFactory=t||new nt,this.precisionModel=this.geometryFactory.getPrecisionModel()}read(t){const e=new Kl(t);return new Ql(e,this.geometryFactory).parse()}write(t){return ka(t)}}class un{constructor(t){this.parser=new sg(t)}write(t){return this.parser.write(t)}static toLineString(t,e){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"}}class Cn{static octant(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){const t=arguments[0],e=arguments[1];if(t===0&&e===0)throw new F("Cannot compute the octant for point ( "+t+", "+e+" )");const i=Math.abs(t),r=Math.abs(e);return t>=0?e>=0?i>=r?0:1:i>=r?7:6:e>=0?i>=r?3:2:i>=r?4:5}else if(arguments[0]instanceof f&&arguments[1]instanceof f){const t=arguments[0],e=arguments[1],i=e.x-t.x,r=e.y-t.y;if(i===0&&r===0)throw new F("Cannot compute the octant for two identical points "+t);return Cn.octant(i,r)}}}class ag{getCoordinates(){}size(){}getCoordinate(t){}isClosed(){}setData(t){}getData(){}}class og{addIntersection(t,e){}get interfaces_(){return[ag]}}class Xt{constructor(){Xt.constructor_.apply(this,arguments)}static constructor_(){this._nodeList=new En(this),this._pts=null,this._data=null;const t=arguments[0],e=arguments[1];this._pts=t,this._data=e}static getNodedSubstrings(){if(arguments.length===1){const t=arguments[0],e=new L;return Xt.getNodedSubstrings(t,e),e}else if(arguments.length===2){const t=arguments[0],e=arguments[1];for(let i=t.iterator();i.hasNext();)i.next().getNodeList().addSplitEdges(e)}}getCoordinates(){return this._pts}size(){return this._pts.length}getCoordinate(t){return this._pts[t]}isClosed(){return this._pts[0].equals(this._pts[this._pts.length-1])}getSegmentOctant(t){return t===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))}toString(){return un.toLineString(new Yt(this._pts))}getNodeList(){return this._nodeList}addIntersectionNode(t,e){let i=e;const r=i+1;if(r<this._pts.length){const s=this._pts[r];t.equals2D(s)&&(i=r)}return this._nodeList.add(t,i)}addIntersections(t,e,i){for(let r=0;r<t.getIntersectionNum();r++)this.addIntersection(t,e,i,r)}setData(t){this._data=t}safeOctant(t,e){return t.equals2D(e)?0:Cn.octant(t,e)}getData(){return this._data}addIntersection(){if(arguments.length===2){const t=arguments[0],e=arguments[1];this.addIntersectionNode(t,e)}else if(arguments.length===4){const t=arguments[0],e=arguments[1],i=arguments[3],r=new f(t.getIntersection(i));this.addIntersection(r,e)}}get interfaces_(){return[og]}}class In{getNodedSubstrings(){}computeNodes(t){}}class gr{constructor(){gr.constructor_.apply(this,arguments)}static constructor_(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){const t=arguments[0],e=arguments[1];gr.constructor_.call(this,t,e,0,0)}else if(arguments.length===4){const t=arguments[0],e=arguments[1];this._noder=t,this._scaleFactor=e,this._isScaled=!this.isIntegerPrecision()}}rescale(){if(M(arguments[0],Qt)){const t=arguments[0];for(let e=t.iterator();e.hasNext();){const i=e.next();this.rescale(i.getCoordinates())}}else if(arguments[0]instanceof Array){const t=arguments[0];for(let e=0;e<t.length;e++)t[e].x=t[e].x/this._scaleFactor+this._offsetX,t[e].y=t[e].y/this._scaleFactor+this._offsetY;t.length===2&&t[0].equals2D(t[1])&&Pt.out.println(t)}}scale(){if(M(arguments[0],Qt)){const t=arguments[0],e=new L(t.size());for(let i=t.iterator();i.hasNext();){const r=i.next();e.add(new Xt(this.scale(r.getCoordinates()),r.getData()))}return e}else if(arguments[0]instanceof Array){const t=arguments[0],e=new Array(t.length).fill(null);for(let r=0;r<t.length;r++)e[r]=new f(Math.round((t[r].x-this._offsetX)*this._scaleFactor),Math.round((t[r].y-this._offsetY)*this._scaleFactor),t[r].getZ());return W.removeRepeatedPoints(e)}}isIntegerPrecision(){return this._scaleFactor===1}getNodedSubstrings(){const t=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(t),t}computeNodes(t){let e=t;this._isScaled&&(e=this.scale(t)),this._noder.computeNodes(e)}get interfaces_(){return[In]}}class $t extends Nt{constructor(t,e){super(e?t+" [ "+e+" ]":t),this.pt=e?new f(e):void 0,this.name=Object.keys({TopologyException:$t})[0]}getCoordinate(){return this.pt}}class Ln{static intersection(t,e,i,r){const n=t.x<e.x?t.x:e.x,s=t.y<e.y?t.y:e.y,a=t.x>e.x?t.x:e.x,o=t.y>e.y?t.y:e.y,c=i.x<r.x?i.x:r.x,h=i.y<r.y?i.y:r.y,d=i.x>r.x?i.x:r.x,m=i.y>r.y?i.y:r.y,p=n>c?n:c,b=a<d?a:d,x=s>h?s:h,E=o<m?o:m,T=(p+b)/2,R=(x+E)/2,G=t.x-T,St=t.y-R,ut=e.x-T,Gt=e.y-R,pe=i.x-T,ai=i.y-R,Yn=r.x-T,Wn=r.y-R,Xn=St-Gt,Zn=ut-G,Kn=G*Gt-ut*St,Qn=ai-Wn,Jn=Yn-pe,ts=pe*Wn-Yn*ai,Va=Zn*ts-Jn*Kn,$a=Qn*Kn-Xn*ts,es=Xn*Jn-Qn*Zn,Gr=Va/es,Br=$a/es;return S.isNaN(Gr)||S.isInfinite(Gr)||S.isNaN(Br)||S.isInfinite(Br)?null:new f(Gr+T,Br+R)}}class it{static pointToSegmentString(t,e){if(e.length===0)throw new F("Line array must contain at least one vertex");let i=t.distance(e[0]);for(let r=0;r<e.length-1;r++){const n=it.pointToSegment(t,e[r],e[r+1]);n<i&&(i=n)}return i}static segmentToSegment(t,e,i,r){if(t.equals(e))return it.pointToSegment(t,i,r);if(i.equals(r))return it.pointToSegment(r,t,e);let n=!1;if(!A.intersects(t,e,i,r))n=!0;else{const s=(e.x-t.x)*(r.y-i.y)-(e.y-t.y)*(r.x-i.x);if(s===0)n=!0;else{const a=(t.y-i.y)*(r.x-i.x)-(t.x-i.x)*(r.y-i.y),c=((t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y))/s,h=a/s;(h<0||h>1||c<0||c>1)&&(n=!0)}}return n?Ee.min(it.pointToSegment(t,i,r),it.pointToSegment(e,i,r),it.pointToSegment(i,t,e),it.pointToSegment(r,t,e)):0}static pointToLinePerpendicular(t,e,i){const r=(i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y),n=((e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y))/r;return Math.abs(n)*Math.sqrt(r)}static pointToSegment(t,e,i){if(e.x===i.x&&e.y===i.y)return t.distance(e);const r=(i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y),n=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/r;if(n<=0)return t.distance(e);if(n>=1)return t.distance(i);const s=((e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y))/r;return Math.abs(s)*Math.sqrt(r)}}class U{constructor(){U.constructor_.apply(this,arguments)}static constructor_(){this._result=null,this._inputLines=Array(2).fill().map(()=>Array(2)),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new f,this._intPt[1]=new f,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}static nonRobustComputeEdgeDistance(t,e,i){const r=t.x-e.x,n=t.y-e.y,s=Math.sqrt(r*r+n*n);return P.isTrue(!(s===0&&!t.equals(e)),"Invalid distance calculation"),s}static computeEdgeDistance(t,e,i){const r=Math.abs(i.x-e.x),n=Math.abs(i.y-e.y);let s=-1;if(t.equals(e))s=0;else if(t.equals(i))r>n?s=r:s=n;else{const a=Math.abs(t.x-e.x),o=Math.abs(t.y-e.y);r>n?s=a:s=o,s===0&&!t.equals(e)&&(s=Math.max(a,o))}return P.isTrue(!(s===0&&!t.equals(e)),"Bad distance calculation"),s}computeIntersection(t,e,i,r){this._inputLines[0][0]=t,this._inputLines[0][1]=e,this._inputLines[1][0]=i,this._inputLines[1][1]=r,this._result=this.computeIntersect(t,e,i,r)}getIntersectionNum(){return this._result}computeIntLineIndex(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(()=>Array(2)),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){const t=arguments[0],e=this.getEdgeDistance(t,0),i=this.getEdgeDistance(t,1);e>i?(this._intLineIndex[t][0]=0,this._intLineIndex[t][1]=1):(this._intLineIndex[t][0]=1,this._intLineIndex[t][1]=0)}}isInteriorIntersection(){if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){const t=arguments[0];for(let e=0;e<this._result;e++)if(!(this._intPt[e].equals2D(this._inputLines[t][0])||this._intPt[e].equals2D(this._inputLines[t][1])))return!0;return!1}}getIntersection(t){return this._intPt[t]}getEdgeDistance(t,e){return U.computeEdgeDistance(this._intPt[e],this._inputLines[t][0],this._inputLines[t][1])}isCollinear(){return this._result===U.COLLINEAR_INTERSECTION}toString(){return un.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+un.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}getEndpoint(t,e){return this._inputLines[t][e]}getIndexAlongSegment(t,e){return this.computeIntLineIndex(),this._intLineIndex[t][e]}getTopologySummary(){const t=new Mr;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()}isProper(){return this.hasIntersection()&&this._isProper}setPrecisionModel(t){this._precisionModel=t}isEndPoint(){return this.hasIntersection()&&!this._isProper}hasIntersection(){return this._result!==U.NO_INTERSECTION}isIntersection(t){for(let e=0;e<this._result;e++)if(this._intPt[e].equals2D(t))return!0;return!1}getIntersectionAlongSegment(t,e){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[t][e]]}}U.DONT_INTERSECT=0;U.DO_INTERSECT=1;U.COLLINEAR=2;U.NO_INTERSECTION=0;U.POINT_INTERSECTION=1;U.COLLINEAR_INTERSECTION=2;class Jt extends U{constructor(){super()}static nearestEndpoint(t,e,i,r){let n=t,s=it.pointToSegment(t,i,r),a=it.pointToSegment(e,i,r);return a<s&&(s=a,n=e),a=it.pointToSegment(i,t,e),a<s&&(s=a,n=i),a=it.pointToSegment(r,t,e),a<s&&(s=a,n=r),n}isInSegmentEnvelopes(t){const e=new A(this._inputLines[0][0],this._inputLines[0][1]),i=new A(this._inputLines[1][0],this._inputLines[1][1]);return e.contains(t)&&i.contains(t)}computeIntersection(){if(arguments.length===3){const t=arguments[0],e=arguments[1],i=arguments[2];if(this._isProper=!1,A.intersects(e,i,t)&&I.index(e,i,t)===0&&I.index(i,e,t)===0)return this._isProper=!0,(t.equals(e)||t.equals(i))&&(this._isProper=!1),this._result=U.POINT_INTERSECTION,null;this._result=U.NO_INTERSECTION}else return super.computeIntersection.apply(this,arguments)}intersection(t,e,i,r){let n=this.intersectionSafe(t,e,i,r);return this.isInSegmentEnvelopes(n)||(n=new f(Jt.nearestEndpoint(t,e,i,r))),this._precisionModel!==null&&this._precisionModel.makePrecise(n),n}checkDD(t,e,i,r,n){const s=qt.intersection(t,e,i,r),a=this.isInSegmentEnvelopes(s);Pt.out.println("DD in env = "+a+"  --------------------- "+s),n.distance(s)>1e-4&&Pt.out.println("Distance = "+n.distance(s))}intersectionSafe(t,e,i,r){let n=Ln.intersection(t,e,i,r);return n===null&&(n=Jt.nearestEndpoint(t,e,i,r)),n}computeCollinearIntersection(t,e,i,r){const n=A.intersects(t,e,i),s=A.intersects(t,e,r),a=A.intersects(i,r,t),o=A.intersects(i,r,e);return n&&s?(this._intPt[0]=i,this._intPt[1]=r,U.COLLINEAR_INTERSECTION):a&&o?(this._intPt[0]=t,this._intPt[1]=e,U.COLLINEAR_INTERSECTION):n&&a?(this._intPt[0]=i,this._intPt[1]=t,i.equals(t)&&!s&&!o?U.POINT_INTERSECTION:U.COLLINEAR_INTERSECTION):n&&o?(this._intPt[0]=i,this._intPt[1]=e,i.equals(e)&&!s&&!a?U.POINT_INTERSECTION:U.COLLINEAR_INTERSECTION):s&&a?(this._intPt[0]=r,this._intPt[1]=t,r.equals(t)&&!n&&!o?U.POINT_INTERSECTION:U.COLLINEAR_INTERSECTION):s&&o?(this._intPt[0]=r,this._intPt[1]=e,r.equals(e)&&!n&&!a?U.POINT_INTERSECTION:U.COLLINEAR_INTERSECTION):U.NO_INTERSECTION}computeIntersect(t,e,i,r){if(this._isProper=!1,!A.intersects(t,e,i,r))return U.NO_INTERSECTION;const n=I.index(t,e,i),s=I.index(t,e,r);if(n>0&&s>0||n<0&&s<0)return U.NO_INTERSECTION;const a=I.index(i,r,t),o=I.index(i,r,e);return a>0&&o>0||a<0&&o<0?U.NO_INTERSECTION:n===0&&s===0&&a===0&&o===0?this.computeCollinearIntersection(t,e,i,r):(n===0||s===0||a===0||o===0?(this._isProper=!1,t.equals2D(i)||t.equals2D(r)?this._intPt[0]=t:e.equals2D(i)||e.equals2D(r)?this._intPt[0]=e:n===0?this._intPt[0]=new f(i):s===0?this._intPt[0]=new f(r):a===0?this._intPt[0]=new f(t):o===0&&(this._intPt[0]=new f(e))):(this._isProper=!0,this._intPt[0]=this.intersection(t,e,i,r)),U.POINT_INTERSECTION)}}class Ei{constructor(){Ei.constructor_.apply(this,arguments)}static constructor_(){this._li=new Jt,this._segStrings=null;const t=arguments[0];this._segStrings=t}checkEndPtVertexIntersections(){if(arguments.length===0)for(let t=this._segStrings.iterator();t.hasNext();){const i=t.next().getCoordinates();this.checkEndPtVertexIntersections(i[0],this._segStrings),this.checkEndPtVertexIntersections(i[i.length-1],this._segStrings)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];for(let i=e.iterator();i.hasNext();){const n=i.next().getCoordinates();for(let s=1;s<n.length-1;s++)if(n[s].equals(t))throw new Nt("found endpt/interior pt intersection at index "+s+" :pt "+t)}}}checkInteriorIntersections(){if(arguments.length===0)for(let t=this._segStrings.iterator();t.hasNext();){const e=t.next();for(let i=this._segStrings.iterator();i.hasNext();){const r=i.next();this.checkInteriorIntersections(e,r)}}else if(arguments.length===2){const t=arguments[0],e=arguments[1],i=t.getCoordinates(),r=e.getCoordinates();for(let n=0;n<i.length-1;n++)for(let s=0;s<r.length-1;s++)this.checkInteriorIntersections(t,n,e,s)}else if(arguments.length===4){const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3];if(t===i&&e===r)return null;const n=t.getCoordinates()[e],s=t.getCoordinates()[e+1],a=i.getCoordinates()[r],o=i.getCoordinates()[r+1];if(this._li.computeIntersection(n,s,a,o),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,n,s)||this.hasInteriorIntersection(this._li,a,o)))throw new Nt("found non-noded intersection at "+n+"-"+s+" and "+a+"-"+o)}}checkValid(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}checkCollapses(){if(arguments.length===0)for(let t=this._segStrings.iterator();t.hasNext();){const e=t.next();this.checkCollapses(e)}else if(arguments.length===1){const e=arguments[0].getCoordinates();for(let i=0;i<e.length-2;i++)this.checkCollapse(e[i],e[i+1],e[i+2])}}hasInteriorIntersection(t,e,i){for(let r=0;r<t.getIntersectionNum();r++){const n=t.getIntersection(r);if(!(n.equals(e)||n.equals(i)))return!0}return!1}checkCollapse(t,e,i){if(t.equals(i))throw new Nt("found non-noded collapse at "+Ei.fact.createLineString([t,e,i]))}}Ei.fact=new nt;class Sa{getBounds(){}}class Ot{constructor(){Ot.constructor_.apply(this,arguments)}static constructor_(){this._bounds=null,this._item=null;const t=arguments[0],e=arguments[1];this._bounds=t,this._item=e}getItem(){return this._item}getBounds(){return this._bounds}get interfaces_(){return[Sa,kt]}}var lg=function(g,t){return g<t};function Q(g){if(!(this instanceof Q))return new Q(g);this.array=[],this.size=0,this.compare=g||lg}Q.prototype.clone=function(){var g=new Q(this.compare);return g.size=this.size,g.array=this.array.slice(0,this.size),g};Q.prototype.add=function(g){var t=this.size;this.array[this.size]=g,this.size+=1;for(var e,i;t>0&&(e=t-1>>1,i=this.array[e],!!this.compare(g,i));)this.array[t]=i,t=e;this.array[t]=g};Q.prototype.heapify=function(g){this.array=g,this.size=g.length;var t;for(t=this.size>>1;t>=0;t--)this._percolateDown(t)};Q.prototype._percolateUp=function(g,t){for(var e=this.array[g],i,r;g>0&&(i=g-1>>1,r=this.array[i],!(!t&&!this.compare(e,r)));)this.array[g]=r,g=i;this.array[g]=e};Q.prototype._percolateDown=function(g){for(var t=this.size,e=this.size>>>1,i=this.array[g],r,n,s;g<e&&(r=(g<<1)+1,n=r+1,s=this.array[r],n<t&&this.compare(this.array[n],s)&&(r=n,s=this.array[n]),!!this.compare(s,i));)this.array[g]=s,g=r;this.array[g]=i};Q.prototype._removeAt=function(g){if(!(g>this.size-1||g<0))return this._percolateUp(g,!0),this.poll()};Q.prototype.remove=function(g){for(var t=0;t<this.size;t++)if(!this.compare(this.array[t],g)&&!this.compare(g,this.array[t]))return this._removeAt(t),!0;return!1};Q.prototype.removeOne=function(g){if(typeof g=="function"){for(var t=0;t<this.size;t++)if(g(this.array[t]))return this._removeAt(t)}};Q.prototype.removeMany=function(g,t){if(typeof g!="function"||this.size<1)return[];t=t?Math.min(t,this.size):this.size;for(var e=0,i=new Array(t),r=0,n=new Array(this.size);e<t&&!this.isEmpty();){var s=this.poll();g(s)?i[e++]=s:n[r++]=s}i.length=e;for(var a=0;a<r;)this.add(n[a++]);return i};Q.prototype.peek=function(){if(this.size!=0)return this.array[0]};Q.prototype.poll=function(){if(this.size!=0){var g=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):this.size-=1,g}};Q.prototype.replaceTop=function(g){if(this.size!=0){var t=this.array[0];return this.array[0]=g,this._percolateDown(0),t}};Q.prototype.trim=function(){this.array=this.array.slice(0,this.size)};Q.prototype.isEmpty=function(){return this.size===0};Q.prototype.forEach=function(g){if(!(this.isEmpty()||typeof g!="function"))for(var t=0,e=this.clone();!e.isEmpty();)g(e.poll(),t++)};Q.prototype.kSmallest=function(g){if(this.size==0||g<=0)return[];g=Math.min(this.size,g);const t=Math.min(this.size,2**(g-1)+1);if(t<2)return[this.peek()];const e=new Q(this.compare);e.size=t,e.array=this.array.slice(0,t);const i=new Array(g);for(let r=0;r<g;r++)i[r]=e.poll();return i};var gg=Q;const Ls=Io(gg);class qi{constructor(){this._fpQueue=new Ls((t,e)=>t.compareTo(e)<0)}poll(){return this._fpQueue.poll()}size(){return this._fpQueue.size}clear(){this._fpQueue=new Ls}peek(){return this._fpQueue.peek()}remove(){return this._fpQueue.poll()}isEmpty(){return this._fpQueue.isEmpty()}add(t){this._fpQueue.add(t)}}class cg{query(){}insert(t,e){}remove(t,e){}}class xt{constructor(){xt.constructor_.apply(this,arguments)}static constructor_(){if(this._childBoundables=new L,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){const t=arguments[0];this._level=t}}}getLevel(){return this._level}addChildBoundable(t){P.isTrue(this._bounds===null),this._childBoundables.add(t)}isEmpty(){return this._childBoundables.isEmpty()}getBounds(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds}size(){return this._childBoundables.size()}getChildBoundables(){return this._childBoundables}get interfaces_(){return[Sa,kt]}}const ii={reverseOrder:function(){return{compare(g,t){return t.compareTo(g)}}},min:function(g){return ii.sort(g),g.get(0)},sort:function(g,t){const e=g.toArray();t?_e.sort(e,t):_e.sort(e);const i=g.iterator();for(let r=0,n=e.length;r<n;r++)i.next(),i.set(e[r])},singletonList:function(g){const t=new L;return t.add(g),t}};class Z{static distance(t,e,i,r){const n=i-t,s=r-e;return Math.sqrt(n*n+s*s)}static maximumDistance(t,e){const i=Math.min(t.getMinX(),e.getMinX()),r=Math.min(t.getMinY(),e.getMinY()),n=Math.max(t.getMaxX(),e.getMaxX()),s=Math.max(t.getMaxY(),e.getMaxY());return Z.distance(i,r,n,s)}static minMaxDistance(t,e){const i=t.getMinX(),r=t.getMinY(),n=t.getMaxX(),s=t.getMaxY(),a=e.getMinX(),o=e.getMinY(),c=e.getMaxX(),h=e.getMaxY();let d=Z.maxDistance(i,r,i,s,a,o,a,h);return d=Math.min(d,Z.maxDistance(i,r,i,s,a,o,c,o)),d=Math.min(d,Z.maxDistance(i,r,i,s,c,h,a,h)),d=Math.min(d,Z.maxDistance(i,r,i,s,c,h,c,o)),d=Math.min(d,Z.maxDistance(i,r,n,r,a,o,a,h)),d=Math.min(d,Z.maxDistance(i,r,n,r,a,o,c,o)),d=Math.min(d,Z.maxDistance(i,r,n,r,c,h,a,h)),d=Math.min(d,Z.maxDistance(i,r,n,r,c,h,c,o)),d=Math.min(d,Z.maxDistance(n,s,i,s,a,o,a,h)),d=Math.min(d,Z.maxDistance(n,s,i,s,a,o,c,o)),d=Math.min(d,Z.maxDistance(n,s,i,s,c,h,a,h)),d=Math.min(d,Z.maxDistance(n,s,i,s,c,h,c,o)),d=Math.min(d,Z.maxDistance(n,s,n,r,a,o,a,h)),d=Math.min(d,Z.maxDistance(n,s,n,r,a,o,c,o)),d=Math.min(d,Z.maxDistance(n,s,n,r,c,h,a,h)),d=Math.min(d,Z.maxDistance(n,s,n,r,c,h,c,o)),d}static maxDistance(t,e,i,r,n,s,a,o){let c=Z.distance(t,e,n,s);return c=Math.max(c,Z.distance(t,e,a,o)),c=Math.max(c,Z.distance(i,r,n,s)),c=Math.max(c,Z.distance(i,r,a,o)),c}}class gt{constructor(){gt.constructor_.apply(this,arguments)}static constructor_(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;const t=arguments[0],e=arguments[1],i=arguments[2];this._boundable1=t,this._boundable2=e,this._itemDistance=i,this._distance=this.distance()}static area(t){return t.getBounds().getArea()}static isComposite(t){return t instanceof xt}maximumDistance(){return Z.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}expandToQueue(t,e){const i=gt.isComposite(this._boundable1),r=gt.isComposite(this._boundable2);if(i&&r)return gt.area(this._boundable1)>gt.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,t,e),null):(this.expand(this._boundable2,this._boundable1,!0,t,e),null);if(i)return this.expand(this._boundable1,this._boundable2,!1,t,e),null;if(r)return this.expand(this._boundable2,this._boundable1,!0,t,e),null;throw new F("neither boundable is composite")}isLeaves(){return!(gt.isComposite(this._boundable1)||gt.isComposite(this._boundable2))}getBoundable(t){return t===0?this._boundable1:this._boundable2}getDistance(){return this._distance}distance(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}compareTo(t){const e=t;return this._distance<e._distance?-1:this._distance>e._distance?1:0}expand(t,e,i,r,n){const s=t.getChildBoundables();for(let a=s.iterator();a.hasNext();){const o=a.next();let c=null;i?c=new gt(e,o,this._itemDistance):c=new gt(o,e,this._itemDistance),c.getDistance()<n&&r.add(c)}}get interfaces_(){return[Ct]}}class Ea{visitItem(t){}}class Zt{constructor(){Zt.constructor_.apply(this,arguments)}static constructor_(){if(this._root=null,this._built=!1,this._itemBoundables=new L,this._nodeCapacity=null,arguments.length===0)Zt.constructor_.call(this,Zt.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){const t=arguments[0];P.isTrue(t>1,"Node capacity must be greater than 1"),this._nodeCapacity=t}}static compareDoubles(t,e){return t>e?1:t<e?-1:0}queryInternal(){if(M(arguments[2],Ea)&&arguments[0]instanceof Object&&arguments[1]instanceof xt){const t=arguments[0],e=arguments[1],i=arguments[2],r=e.getChildBoundables();for(let n=0;n<r.size();n++){const s=r.get(n);this.getIntersectsOp().intersects(s.getBounds(),t)&&(s instanceof xt?this.queryInternal(t,s,i):s instanceof Ot?i.visitItem(s.getItem()):P.shouldNeverReachHere())}}else if(M(arguments[2],xe)&&arguments[0]instanceof Object&&arguments[1]instanceof xt){const t=arguments[0],e=arguments[1],i=arguments[2],r=e.getChildBoundables();for(let n=0;n<r.size();n++){const s=r.get(n);this.getIntersectsOp().intersects(s.getBounds(),t)&&(s instanceof xt?this.queryInternal(t,s,i):s instanceof Ot?i.add(s.getItem()):P.shouldNeverReachHere())}}}insert(t,e){P.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Ot(t,e))}boundablesAtLevel(){if(arguments.length===1){const t=arguments[0],e=new L;return this.boundablesAtLevel(t,this._root,e),e}else if(arguments.length===3){const t=arguments[0],e=arguments[1],i=arguments[2];if(P.isTrue(t>-2),e.getLevel()===t)return i.add(e),null;for(let r=e.getChildBoundables().iterator();r.hasNext();){const n=r.next();n instanceof xt?this.boundablesAtLevel(t,n,i):(P.isTrue(n instanceof Ot),t===-1&&i.add(n))}return null}}getRoot(){return this.build(),this._root}remove(){if(arguments.length===2){const t=arguments[0],e=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),t)?this.remove(t,this._root,e):!1}else if(arguments.length===3){const t=arguments[0],e=arguments[1],i=arguments[2];let r=this.removeItem(e,i);if(r)return!0;let n=null;for(let s=e.getChildBoundables().iterator();s.hasNext();){const a=s.next();if(this.getIntersectsOp().intersects(a.getBounds(),t)&&a instanceof xt&&(r=this.remove(t,a,i),r)){n=a;break}}return n!==null&&n.getChildBoundables().isEmpty()&&e.getChildBoundables().remove(n),r}}createHigherLevels(t,e){P.isTrue(!t.isEmpty());const i=this.createParentBoundables(t,e+1);return i.size()===1?i.get(0):this.createHigherLevels(i,e+1)}depth(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){const t=arguments[0];let e=0;for(let i=t.getChildBoundables().iterator();i.hasNext();){const r=i.next();if(r instanceof xt){const n=this.depth(r);n>e&&(e=n)}}return e+1}}createParentBoundables(t,e){P.isTrue(!t.isEmpty());const i=new L;i.add(this.createNode(e));const r=new L(t);ii.sort(r,this.getComparator());for(let n=r.iterator();n.hasNext();){const s=n.next();this.lastNode(i).getChildBoundables().size()===this.getNodeCapacity()&&i.add(this.createNode(e)),this.lastNode(i).addChildBoundable(s)}return i}isEmpty(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}getNodeCapacity(){return this._nodeCapacity}lastNode(t){return t.get(t.size()-1)}size(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){const t=arguments[0];let e=0;for(let i=t.getChildBoundables().iterator();i.hasNext();){const r=i.next();r instanceof xt?e+=this.size(r):r instanceof Ot&&(e+=1)}return e}}removeItem(t,e){let i=null;for(let r=t.getChildBoundables().iterator();r.hasNext();){const n=r.next();n instanceof Ot&&n.getItem()===e&&(i=n)}return i!==null?(t.getChildBoundables().remove(i),!0):!1}itemsTree(){if(arguments.length===0){this.build();const t=this.itemsTree(this._root);return t===null?new L:t}else if(arguments.length===1){const t=arguments[0],e=new L;for(let i=t.getChildBoundables().iterator();i.hasNext();){const r=i.next();if(r instanceof xt){const n=this.itemsTree(r);n!==null&&e.add(n)}else r instanceof Ot?e.add(r.getItem()):P.shouldNeverReachHere()}return e.size()<=0?null:e}}query(){if(arguments.length===1){const t=arguments[0];this.build();const e=new L;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.queryInternal(t,this._root,e),e}else if(arguments.length===2){const t=arguments[0],e=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.queryInternal(t,this._root,e)}}build(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}get interfaces_(){return[kt]}}function hg(){}Zt.IntersectsOp=hg;Zt.DEFAULT_NODE_CAPACITY=10;class dg{distance(t,e){}}class J extends Zt{constructor(){super(),J.constructor_.apply(this,arguments)}static constructor_(){if(arguments.length===0)J.constructor_.call(this,J.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){const t=arguments[0];Zt.constructor_.call(this,t)}}static getItems(t){const e=new Array(t.size()).fill(null);let i=0;for(;!t.isEmpty();){const r=t.poll();e[i]=r.getBoundable(0).getItem(),i++}return e}static avg(t,e){return(t+e)/2}static centreY(t){return J.avg(t.getMinY(),t.getMaxY())}static centreX(t){return J.avg(t.getMinX(),t.getMaxX())}size(){return arguments.length===0?super.size.call(this):super.size.apply(this,arguments)}insert(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof A){const t=arguments[0],e=arguments[1];if(t.isNull())return null;super.insert.call(this,t,e)}else return super.insert.apply(this,arguments)}getIntersectsOp(){return J.intersectsOp}verticalSlices(t,e){const i=Math.trunc(Math.ceil(t.size()/e)),r=new Array(e).fill(null),n=t.iterator();for(let s=0;s<e;s++){r[s]=new L;let a=0;for(;n.hasNext()&&a<i;){const o=n.next();r[s].add(o),a++}}return r}query(){if(arguments.length===1){const t=arguments[0];return super.query.call(this,t)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];super.query.call(this,t,e)}}getComparator(){return J.yComparator}createParentBoundablesFromVerticalSlice(t,e){return super.createParentBoundables.call(this,t,e)}remove(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof A){const t=arguments[0],e=arguments[1];return super.remove.call(this,t,e)}else return super.remove.apply(this,arguments)}depth(){return arguments.length===0?super.depth.call(this):super.depth.apply(this,arguments)}createParentBoundables(t,e){P.isTrue(!t.isEmpty());const i=Math.trunc(Math.ceil(t.size()/this.getNodeCapacity())),r=new L(t);ii.sort(r,J.xComparator);const n=this.verticalSlices(r,Math.trunc(Math.ceil(Math.sqrt(i))));return this.createParentBoundablesFromVerticalSlices(n,e)}nearestNeighbour(){if(arguments.length===1){if(M(arguments[0],dg)){const t=arguments[0];if(this.isEmpty())return null;const e=new gt(this.getRoot(),this.getRoot(),t);return this.nearestNeighbour(e)}else if(arguments[0]instanceof gt){const t=arguments[0];let e=S.POSITIVE_INFINITY,i=null;const r=new qi;for(r.add(t);!r.isEmpty()&&e>0;){const n=r.poll(),s=n.getDistance();if(s>=e)break;n.isLeaves()?(e=s,i=n):n.expandToQueue(r,e)}return i===null?null:[i.getBoundable(0).getItem(),i.getBoundable(1).getItem()]}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];if(this.isEmpty()||t.isEmpty())return null;const i=new gt(this.getRoot(),t.getRoot(),e);return this.nearestNeighbour(i)}else if(arguments.length===3){const t=arguments[0],e=arguments[1],i=arguments[2],r=new Ot(t,e),n=new gt(this.getRoot(),r,i);return this.nearestNeighbour(n)[0]}else if(arguments.length===4){const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3],n=new Ot(t,e),s=new gt(this.getRoot(),n,i);return this.nearestNeighbourK(s,r)}}isWithinDistance(){if(arguments.length===2){const t=arguments[0],e=arguments[1];let i=S.POSITIVE_INFINITY;const r=new qi;for(r.add(t);!r.isEmpty();){const n=r.poll(),s=n.getDistance();if(s>e)return!1;if(n.maximumDistance()<=e)return!0;if(n.isLeaves()){if(i=s,i<=e)return!0}else n.expandToQueue(r,i)}return!1}else if(arguments.length===3){const t=arguments[0],e=arguments[1],i=arguments[2],r=new gt(this.getRoot(),t.getRoot(),e);return this.isWithinDistance(r,i)}}createParentBoundablesFromVerticalSlices(t,e){P.isTrue(t.length>0);const i=new L;for(let r=0;r<t.length;r++)i.addAll(this.createParentBoundablesFromVerticalSlice(t[r],e));return i}nearestNeighbourK(){if(arguments.length===2){const t=arguments[0],e=arguments[1];return this.nearestNeighbourK(t,S.POSITIVE_INFINITY,e)}else if(arguments.length===3){const t=arguments[0],e=arguments[1],i=arguments[2];let r=e;const n=new qi;n.add(t);const s=new qi;for(;!n.isEmpty()&&r>=0;){const a=n.poll(),o=a.getDistance();if(o>=r)break;a.isLeaves()?s.size()<i?s.add(a):(s.peek().getDistance()>o&&(s.poll(),s.add(a)),r=s.peek().getDistance()):a.expandToQueue(n,r)}return J.getItems(s)}}createNode(t){return new Nr(t)}get interfaces_(){return[cg,kt]}}class Nr extends xt{constructor(){super(),Nr.constructor_.apply(this,arguments)}static constructor_(){const t=arguments[0];xt.constructor_.call(this,t)}computeBounds(){let t=null;for(let e=this.getChildBoundables().iterator();e.hasNext();){const i=e.next();t===null?t=new A(i.getBounds()):t.expandToInclude(i.getBounds())}return t}}J.STRtreeNode=Nr;J.xComparator=new class{get interfaces_(){return[Mi]}compare(g,t){return Zt.compareDoubles(J.centreX(g.getBounds()),J.centreX(t.getBounds()))}};J.yComparator=new class{get interfaces_(){return[Mi]}compare(g,t){return Zt.compareDoubles(J.centreY(g.getBounds()),J.centreY(t.getBounds()))}};J.intersectsOp=new class{get interfaces_(){return[IntersectsOp]}intersects(g,t){return g.intersects(t)}};J.DEFAULT_NODE_CAPACITY=10;class X{constructor(){X.constructor_.apply(this,arguments)}static constructor_(){if(this.p0=null,this.p1=null,arguments.length===0)X.constructor_.call(this,new f,new f);else if(arguments.length===1){const t=arguments[0];X.constructor_.call(this,t.p0,t.p1)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this.p0=t,this.p1=e}else if(arguments.length===4){const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3];X.constructor_.call(this,new f(t,e),new f(i,r))}}static midPoint(t,e){return new f((t.x+e.x)/2,(t.y+e.y)/2)}minX(){return Math.min(this.p0.x,this.p1.x)}orientationIndex(){if(arguments[0]instanceof X){const t=arguments[0],e=I.index(this.p0,this.p1,t.p0),i=I.index(this.p0,this.p1,t.p1);return e>=0&&i>=0||e<=0&&i<=0?Math.max(e,i):0}else if(arguments[0]instanceof f){const t=arguments[0];return I.index(this.p0,this.p1,t)}}toGeometry(t){return t.createLineString([this.p0,this.p1])}isVertical(){return this.p0.x===this.p1.x}minY(){return Math.min(this.p0.y,this.p1.y)}midPoint(){return X.midPoint(this.p0,this.p1)}maxY(){return Math.max(this.p0.y,this.p1.y)}pointAlongOffset(t,e){const i=this.p0.x+t*(this.p1.x-this.p0.x),r=this.p0.y+t*(this.p1.y-this.p0.y),n=this.p1.x-this.p0.x,s=this.p1.y-this.p0.y,a=Math.sqrt(n*n+s*s);let o=0,c=0;if(e!==0){if(a<=0)throw new Je("Cannot compute offset from zero-length line segment");o=e*n/a,c=e*s/a}const h=i-c,d=r+o;return new f(h,d)}setCoordinates(){if(arguments.length===1){const t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this.p0.x=t.x,this.p0.y=t.y,this.p1.x=e.x,this.p1.y=e.y}}segmentFraction(t){let e=this.projectionFactor(t);return e<0?e=0:(e>1||S.isNaN(e))&&(e=1),e}toString(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}distance(){if(arguments[0]instanceof X){const t=arguments[0];return it.segmentToSegment(this.p0,this.p1,t.p0,t.p1)}else if(arguments[0]instanceof f){const t=arguments[0];return it.pointToSegment(t,this.p0,this.p1)}}equals(t){if(!(t instanceof X))return!1;const e=t;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)}intersection(t){const e=new Jt;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null}project(){if(arguments[0]instanceof f){const t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new f(t);const e=this.projectionFactor(t),i=new f;return i.x=this.p0.x+e*(this.p1.x-this.p0.x),i.y=this.p0.y+e*(this.p1.y-this.p0.y),i}else if(arguments[0]instanceof X){const t=arguments[0],e=this.projectionFactor(t.p0),i=this.projectionFactor(t.p1);if(e>=1&&i>=1||e<=0&&i<=0)return null;let r=this.project(t.p0);e<0&&(r=this.p0),e>1&&(r=this.p1);let n=this.project(t.p1);return i<0&&(n=this.p0),i>1&&(n=this.p1),new X(r,n)}}normalize(){this.p1.compareTo(this.p0)<0&&this.reverse()}angle(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}getCoordinate(t){return t===0?this.p0:this.p1}distancePerpendicular(t){return it.pointToLinePerpendicular(t,this.p0,this.p1)}closestPoint(t){const e=this.projectionFactor(t);if(e>0&&e<1)return this.project(t);const i=this.p0.distance(t),r=this.p1.distance(t);return i<r?this.p0:this.p1}projectionFactor(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;const e=this.p1.x-this.p0.x,i=this.p1.y-this.p0.y,r=e*e+i*i;return r<=0?S.NaN:((t.x-this.p0.x)*e+(t.y-this.p0.y)*i)/r}closestPoints(t){const e=this.intersection(t);if(e!==null)return[e,e];const i=new Array(2).fill(null);let r=S.MAX_VALUE,n=null;const s=this.closestPoint(t.p0);r=s.distance(t.p0),i[0]=s,i[1]=t.p0;const a=this.closestPoint(t.p1);n=a.distance(t.p1),n<r&&(r=n,i[0]=a,i[1]=t.p1);const o=t.closestPoint(this.p0);n=o.distance(this.p0),n<r&&(r=n,i[0]=this.p0,i[1]=o);const c=t.closestPoint(this.p1);return n=c.distance(this.p1),n<r&&(r=n,i[0]=this.p1,i[1]=c),i}maxX(){return Math.max(this.p0.x,this.p1.x)}getLength(){return this.p0.distance(this.p1)}compareTo(t){const e=t,i=this.p0.compareTo(e.p0);return i!==0?i:this.p1.compareTo(e.p1)}reverse(){const t=this.p0;this.p0=this.p1,this.p1=t}equalsTopo(t){return this.p0.equals(t.p0)&&this.p1.equals(t.p1)||this.p0.equals(t.p1)&&this.p1.equals(t.p0)}lineIntersection(t){return Ln.intersection(this.p0,this.p1,t.p0,t.p1)}isHorizontal(){return this.p0.y===this.p1.y}reflect(t){const e=this.p1.getY()-this.p0.getY(),i=this.p0.getX()-this.p1.getX(),r=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),n=e*e+i*i,s=e*e-i*i,a=t.getX(),o=t.getY(),c=(-s*a-2*e*i*o-2*e*r)/n,h=(s*o-2*e*i*a-2*i*r)/n;return new f(c,h)}pointAlong(t){const e=new f;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e}hashCode(){let t=S.doubleToLongBits(this.p0.x);t^=S.doubleToLongBits(this.p0.y)*31;const e=Math.trunc(t)^Math.trunc(t>>32);let i=S.doubleToLongBits(this.p1.x);i^=S.doubleToLongBits(this.p1.y)*31;const r=Math.trunc(i)^Math.trunc(i>>32);return e^r}get interfaces_(){return[Ct,kt]}}class Tn{constructor(){Tn.constructor_.apply(this,arguments)}static constructor_(){this._overlapSeg1=new X,this._overlapSeg2=new X}overlap(){if(arguments.length!==2){if(arguments.length===4){const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3];t.getLineSegment(e,this._overlapSeg1),i.getLineSegment(r,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}}class Pr{constructor(){Pr.constructor_.apply(this,arguments)}static constructor_(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3];this._pts=t,this._start=e,this._end=i,this._context=r}computeOverlaps(){if(arguments.length===2){const t=arguments[0],e=arguments[1];this.computeOverlaps(this._start,this._end,t,t._start,t._end,e)}else if(arguments.length===6){const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3],n=arguments[4],s=arguments[5];if(e-t===1&&n-r===1)return s.overlap(this,t,i,r),null;if(!this.overlaps(t,e,i,r,n))return null;const a=Math.trunc((t+e)/2),o=Math.trunc((r+n)/2);t<a&&(r<o&&this.computeOverlaps(t,a,i,r,o,s),o<n&&this.computeOverlaps(t,a,i,o,n,s)),a<e&&(r<o&&this.computeOverlaps(a,e,i,r,o,s),o<n&&this.computeOverlaps(a,e,i,o,n,s))}}setId(t){this._id=t}select(t,e){this.computeSelect(t,this._start,this._end,e)}getEnvelope(){if(this._env===null){const t=this._pts[this._start],e=this._pts[this._end];this._env=new A(t,e)}return this._env}overlaps(t,e,i,r,n){return A.intersects(this._pts[t],this._pts[e],i._pts[r],i._pts[n])}getEndIndex(){return this._end}getStartIndex(){return this._start}getContext(){return this._context}getId(){return this._id}getLineSegment(t,e){e.p0=this._pts[t],e.p1=this._pts[t+1]}computeSelect(t,e,i,r){const n=this._pts[e],s=this._pts[i];if(i-e===1)return r.select(this,e),null;if(!t.intersects(n,s))return null;const a=Math.trunc((e+i)/2);e<a&&this.computeSelect(t,e,a,r),a<i&&this.computeSelect(t,a,i,r)}getCoordinates(){const t=new Array(this._end-this._start+1).fill(null);let e=0;for(let i=this._start;i<=this._end;i++)t[e++]=this._pts[i];return t}}class q{static isNorthern(t){return t===q.NE||t===q.NW}static isOpposite(t,e){return t===e?!1:(t-e+4)%4===2}static commonHalfPlane(t,e){if(t===e)return t;if((t-e+4)%4===2)return-1;const r=t<e?t:e,n=t>e?t:e;return r===0&&n===3?3:r}static isInHalfPlane(t,e){return e===q.SE?t===q.SE||t===q.SW:t===e||t===e+1}static quadrant(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){const t=arguments[0],e=arguments[1];if(t===0&&e===0)throw new F("Cannot compute the quadrant for point ( "+t+", "+e+" )");return t>=0?e>=0?q.NE:q.SE:e>=0?q.NW:q.SW}else if(arguments[0]instanceof f&&arguments[1]instanceof f){const t=arguments[0],e=arguments[1];if(e.x===t.x&&e.y===t.y)throw new F("Cannot compute the quadrant for two identical points "+t);return e.x>=t.x?e.y>=t.y?q.NE:q.SE:e.y>=t.y?q.NW:q.SW}}}q.NE=0;q.NW=1;q.SW=2;q.SE=3;class cr{static findChainEnd(t,e){let i=e;for(;i<t.length-1&&t[i].equals2D(t[i+1]);)i++;if(i>=t.length-1)return t.length-1;const r=q.quadrant(t[i],t[i+1]);let n=e+1;for(;n<t.length&&!(!t[n-1].equals2D(t[n])&&q.quadrant(t[n-1],t[n])!==r);)n++;return n-1}static getChains(){if(arguments.length===1){const t=arguments[0];return cr.getChains(t,null)}else if(arguments.length===2){const t=arguments[0],e=arguments[1],i=new L;let r=0;do{const n=cr.findChainEnd(t,r),s=new Pr(t,r,n,e);i.add(s),r=n}while(r<t.length-1);return i}}}class hr{constructor(){hr.constructor_.apply(this,arguments)}static constructor_(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){const t=arguments[0];this.setSegmentIntersector(t)}}}setSegmentIntersector(t){this._segInt=t}get interfaces_(){return[In]}}class Pi extends hr{constructor(){super(),Pi.constructor_.apply(this,arguments)}static constructor_(){if(this._monoChains=new L,this._index=new J,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,arguments.length!==0){if(arguments.length===1){const t=arguments[0];hr.constructor_.call(this,t)}}}getMonotoneChains(){return this._monoChains}getNodedSubstrings(){return Xt.getNodedSubstrings(this._nodedSegStrings)}getIndex(){return this._index}add(t){const e=cr.getChains(t.getCoordinates(),t);for(let i=e.iterator();i.hasNext();){const r=i.next();r.setId(this._idCounter++),this._index.insert(r.getEnvelope(),r),this._monoChains.add(r)}}computeNodes(t){this._nodedSegStrings=t;for(let e=t.iterator();e.hasNext();)this.add(e.next());this.intersectChains()}intersectChains(){const t=new Rr(this._segInt);for(let e=this._monoChains.iterator();e.hasNext();){const i=e.next(),r=this._index.query(i.getEnvelope());for(let n=r.iterator();n.hasNext();){const s=n.next();if(s.getId()>i.getId()&&(i.computeOverlaps(s,t),this._nOverlaps++),this._segInt.isDone())return null}}}}class Rr extends Tn{constructor(){super(),Rr.constructor_.apply(this,arguments)}static constructor_(){this._si=null;const t=arguments[0];this._si=t}overlap(){if(arguments.length===4){const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3],n=t.getContext(),s=i.getContext();this._si.processIntersections(n,e,s,r)}else return super.overlap.apply(this,arguments)}}Pi.SegmentOverlapAction=Rr;class ri{constructor(){ri.constructor_.apply(this,arguments)}static constructor_(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;const t=arguments[0],e=arguments[1],i=arguments[2];if(this._originalPt=t,this._pt=t,this._scaleFactor=e,this._li=i,e<=0)throw new F("Scale factor must be non-zero");e!==1&&(this._pt=new f(this.scale(t.x),this.scale(t.y)),this._p0Scaled=new f,this._p1Scaled=new f),this.initCorners(this._pt)}intersectsScaled(t,e){const i=Math.min(t.x,e.x),r=Math.max(t.x,e.x),n=Math.min(t.y,e.y),s=Math.max(t.y,e.y),a=this._maxx<i||this._minx>r||this._maxy<n||this._miny>s;if(a)return!1;const o=this.intersectsToleranceSquare(t,e);return P.isTrue(!(a&&o),"Found bad envelope test"),o}copyScaled(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)}getSafeEnvelope(){if(this._safeEnv===null){const t=ri.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new A(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv}intersectsPixelClosure(t,e){return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.hasIntersection()))}intersectsToleranceSquare(t,e){let i=!1,r=!1;return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(i=!0),this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.isProper())||i&&r||t.equals(this._pt)||e.equals(this._pt))}addSnappedNode(t,e){const i=t.getCoordinate(e),r=t.getCoordinate(e+1);return this.intersects(i,r)?(t.addIntersection(this.getCoordinate(),e),!0):!1}initCorners(t){this._minx=t.x-.5,this._maxx=t.x+.5,this._miny=t.y-.5,this._maxy=t.y+.5,this._corner[0]=new f(this._maxx,this._maxy),this._corner[1]=new f(this._minx,this._maxy),this._corner[2]=new f(this._minx,this._miny),this._corner[3]=new f(this._maxx,this._miny)}intersects(t,e){return this._scaleFactor===1?this.intersectsScaled(t,e):(this.copyScaled(t,this._p0Scaled),this.copyScaled(e,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}scale(t){return Math.round(t*this._scaleFactor)}getCoordinate(){return this._originalPt}}ri.SAFE_ENV_EXPANSION_FACTOR=.75;class Mn{constructor(){Mn.constructor_.apply(this,arguments)}static constructor_(){this.selectedSegment=new X}select(){if(arguments.length!==1){if(arguments.length===2){const t=arguments[0],e=arguments[1];t.getLineSegment(e,this.selectedSegment),this.select(this.selectedSegment)}}}}class Ar{constructor(){Ar.constructor_.apply(this,arguments)}static constructor_(){this._index=null;const t=arguments[0];this._index=t}snap(){if(arguments.length===1){const t=arguments[0];return this.snap(t,null,-1)}else if(arguments.length===3){const t=arguments[0],e=arguments[1],i=arguments[2],r=t.getSafeEnvelope(),n=new Fr(t,e,i);return this._index.query(r,new class{get interfaces_(){return[Ea]}visitItem(s){s.select(r,n)}}),n.isNodeAdded()}}}class Fr extends Mn{constructor(){super(),Fr.constructor_.apply(this,arguments)}static constructor_(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;const t=arguments[0],e=arguments[1],i=arguments[2];this._hotPixel=t,this._parentEdge=e,this._hotPixelVertexIndex=i}select(){if(arguments.length===2&&Number.isInteger(arguments[1])&&arguments[0]instanceof Pr){const t=arguments[0],e=arguments[1],i=t.getContext();if(this._parentEdge===i&&(e===this._hotPixelVertexIndex||e+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(i,e)}else return super.select.apply(this,arguments)}isNodeAdded(){return this._isNodeAdded}}Ar.HotPixelSnapAction=Fr;class Ca{isDone(){}processIntersections(t,e,i,r){}}class Nn{constructor(){Nn.constructor_.apply(this,arguments)}static constructor_(){this._li=null,this._interiorIntersections=null;const t=arguments[0];this._li=t,this._interiorIntersections=new L}isDone(){return!1}processIntersections(t,e,i,r){if(t===i&&e===r)return null;const n=t.getCoordinates()[e],s=t.getCoordinates()[e+1],a=i.getCoordinates()[r],o=i.getCoordinates()[r+1];if(this._li.computeIntersection(n,s,a,o),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(let c=0;c<this._li.getIntersectionNum();c++)this._interiorIntersections.add(this._li.getIntersection(c));t.addIntersections(this._li,e,0),i.addIntersections(this._li,r,1)}}getInteriorIntersections(){return this._interiorIntersections}get interfaces_(){return[Ca]}}class Pn{constructor(){Pn.constructor_.apply(this,arguments)}static constructor_(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;const t=arguments[0];this._pm=t,this._li=new Jt,this._li.setPrecisionModel(t),this._scaleFactor=t.getScale()}checkCorrectness(t){const e=Xt.getNodedSubstrings(t),i=new Ei(e);try{i.checkValid()}catch(r){if(r instanceof Rt)r.printStackTrace();else throw r}finally{}}getNodedSubstrings(){return Xt.getNodedSubstrings(this._nodedSegStrings)}snapRound(t,e){const i=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(i),this.computeVertexSnaps(t)}findInteriorIntersections(t,e){const i=new Nn(e);return this._noder.setSegmentIntersector(i),this._noder.computeNodes(t),i.getInteriorIntersections()}computeVertexSnaps(){if(M(arguments[0],Qt)){const t=arguments[0];for(let e=t.iterator();e.hasNext();){const i=e.next();this.computeVertexSnaps(i)}}else if(arguments[0]instanceof Xt){const t=arguments[0],e=t.getCoordinates();for(let i=0;i<e.length;i++){const r=new ri(e[i],this._scaleFactor,this._li);this._pointSnapper.snap(r,t,i)&&t.addIntersection(e[i],i)}}}computeNodes(t){this._nodedSegStrings=t,this._noder=new Pi,this._pointSnapper=new Ar(this._noder.getIndex()),this.snapRound(t,this._li)}computeIntersectionSnaps(t){for(let e=t.iterator();e.hasNext();){const i=e.next(),r=new ri(i,this._scaleFactor,this._li);this._pointSnapper.snap(r)}}get interfaces_(){return[In]}}class u{static toLocationSymbol(t){switch(t){case u.EXTERIOR:return"e";case u.BOUNDARY:return"b";case u.INTERIOR:return"i";case u.NONE:return"-"}throw new F("Unknown location value: "+t)}}u.INTERIOR=0;u.BOUNDARY=1;u.EXTERIOR=2;u.NONE=-1;class w{static opposite(t){return t===w.LEFT?w.RIGHT:t===w.RIGHT?w.LEFT:t}}w.ON=0;w.LEFT=1;w.RIGHT=2;class dr extends Rt{constructor(t){super(t),this.name=Object.keys({EmptyStackException:dr})[0]}}class ug extends xe{constructor(){super(),this.array=[]}add(t){return this.array.push(t),!0}get(t){if(t<0||t>=this.size())throw new Cr;return this.array[t]}push(t){return this.array.push(t),t}pop(){if(this.array.length===0)throw new dr;return this.array.pop()}peek(){if(this.array.length===0)throw new dr;return this.array[this.array.length-1]}empty(){return this.array.length===0}isEmpty(){return this.empty()}search(t){return this.array.indexOf(t)}size(){return this.array.length}toArray(){return this.array.slice()}}class Rn{constructor(){Rn.constructor_.apply(this,arguments)}static constructor_(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}getCoordinate(){return this._minCoord}getRightmostSide(t,e){let i=this.getRightmostSideOfSegment(t,e);return i<0&&(i=this.getRightmostSideOfSegment(t,e-1)),i<0&&(this._minCoord=null,this.checkForRightmostCoordinate(t)),i}findRightmostEdgeAtVertex(){const t=this._minDe.getEdge().getCoordinates();P.isTrue(this._minIndex>0&&this._minIndex<t.length,"rightmost point expected to be interior vertex of edge");const e=t[this._minIndex-1],i=t[this._minIndex+1],r=I.index(this._minCoord,i,e);let n=!1;(e.y<this._minCoord.y&&i.y<this._minCoord.y&&r===I.COUNTERCLOCKWISE||e.y>this._minCoord.y&&i.y>this._minCoord.y&&r===I.CLOCKWISE)&&(n=!0),n&&(this._minIndex=this._minIndex-1)}getRightmostSideOfSegment(t,e){const r=t.getEdge().getCoordinates();if(e<0||e+1>=r.length||r[e].y===r[e+1].y)return-1;let n=w.LEFT;return r[e].y<r[e+1].y&&(n=w.RIGHT),n}getEdge(){return this._orientedDe}checkForRightmostCoordinate(t){const e=t.getEdge().getCoordinates();for(let i=0;i<e.length-1;i++)(this._minCoord===null||e[i].x>this._minCoord.x)&&(this._minDe=t,this._minIndex=i,this._minCoord=e[i])}findRightmostEdgeAtNode(){const e=this._minDe.getNode().getEdges();this._minDe=e.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}findEdge(t){for(let i=t.iterator();i.hasNext();){const r=i.next();r.isForward()&&this.checkForRightmostCoordinate(r)}P.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===w.LEFT&&(this._orientedDe=this._minDe.getSym())}}class mg{constructor(){this.array=[]}addLast(t){this.array.push(t)}removeFirst(){return this.array.shift()}isEmpty(){return this.array.length===0}}class An{constructor(){An.constructor_.apply(this,arguments)}static constructor_(){this._finder=null,this._dirEdgeList=new L,this._nodes=new L,this._rightMostCoord=null,this._env=null,this._finder=new Rn}clearVisitedEdges(){for(let t=this._dirEdgeList.iterator();t.hasNext();)t.next().setVisited(!1)}compareTo(t){const e=t;return this._rightMostCoord.x<e._rightMostCoord.x?-1:this._rightMostCoord.x>e._rightMostCoord.x?1:0}getEnvelope(){if(this._env===null){const t=new A;for(let e=this._dirEdgeList.iterator();e.hasNext();){const r=e.next().getEdge().getCoordinates();for(let n=0;n<r.length-1;n++)t.expandToInclude(r[n])}this._env=t}return this._env}addReachable(t){const e=new ug;for(e.add(t);!e.empty();){const i=e.pop();this.add(i,e)}}copySymDepths(t){const e=t.getSym();e.setDepth(w.LEFT,t.getDepth(w.RIGHT)),e.setDepth(w.RIGHT,t.getDepth(w.LEFT))}add(t,e){t.setVisited(!0),this._nodes.add(t);for(let i=t.getEdges().iterator();i.hasNext();){const r=i.next();this._dirEdgeList.add(r);const s=r.getSym().getNode();s.isVisited()||e.push(s)}}getRightmostCoordinate(){return this._rightMostCoord}computeNodeDepth(t){let e=null;for(let i=t.getEdges().iterator();i.hasNext();){const r=i.next();if(r.isVisited()||r.getSym().isVisited()){e=r;break}}if(e===null)throw new $t("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(e);for(let i=t.getEdges().iterator();i.hasNext();){const r=i.next();r.setVisited(!0),this.copySymDepths(r)}}computeDepth(t){this.clearVisitedEdges();const e=this._finder.getEdge();e.getNode(),e.getLabel(),e.setEdgeDepths(w.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)}create(t){this.addReachable(t),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}findResultEdges(){for(let t=this._dirEdgeList.iterator();t.hasNext();){const e=t.next();e.getDepth(w.RIGHT)>=1&&e.getDepth(w.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}}computeDepths(t){const e=new kn,i=new mg,r=t.getNode();for(i.addLast(r),e.add(r),t.setVisited(!0);!i.isEmpty();){const n=i.removeFirst();e.add(n),this.computeNodeDepth(n);for(let s=n.getEdges().iterator();s.hasNext();){const o=s.next().getSym();if(o.isVisited())continue;const c=o.getNode();e.contains(c)||(i.addLast(c),e.add(c))}}}getNodes(){return this._nodes}getDirectedEdges(){return this._dirEdgeList}get interfaces_(){return[Ct]}}class rt{constructor(){rt.constructor_.apply(this,arguments)}static constructor_(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=I.COUNTERCLOCKWISE;const t=arguments[0];this._inputLine=t}static simplify(t,e){return new rt(t).simplify(e)}isDeletable(t,e,i,r){const n=this._inputLine[t],s=this._inputLine[e],a=this._inputLine[i];return!this.isConcave(n,s,a)||!this.isShallow(n,s,a,r)?!1:this.isShallowSampled(n,s,t,i,r)}deleteShallowConcavities(){let t=1,e=this.findNextNonDeletedIndex(t),i=this.findNextNonDeletedIndex(e),r=!1;for(;i<this._inputLine.length;){let n=!1;this.isDeletable(t,e,i,this._distanceTol)&&(this._isDeleted[e]=rt.DELETE,n=!0,r=!0),n?t=i:t=e,e=this.findNextNonDeletedIndex(t),i=this.findNextNonDeletedIndex(e)}return r}isShallowConcavity(t,e,i,r){return I.index(t,e,i)===this._angleOrientation?it.pointToSegment(e,t,i)<r:!1}isShallowSampled(t,e,i,r,n){let s=Math.trunc((r-i)/rt.NUM_PTS_TO_CHECK);s<=0&&(s=1);for(let a=i;a<r;a+=s)if(!this.isShallow(t,e,this._inputLine[a],n))return!1;return!0}isConcave(t,e,i){return I.index(t,e,i)===this._angleOrientation}simplify(t){this._distanceTol=Math.abs(t),t<0&&(this._angleOrientation=I.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);let e=!1;do e=this.deleteShallowConcavities();while(e);return this.collapseLine()}findNextNonDeletedIndex(t){let e=t+1;for(;e<this._inputLine.length&&this._isDeleted[e]===rt.DELETE;)e++;return e}isShallow(t,e,i,r){return it.pointToSegment(e,t,i)<r}collapseLine(){const t=new re;for(let e=0;e<this._inputLine.length;e++)this._isDeleted[e]!==rt.DELETE&&t.add(this._inputLine[e]);return t.toCoordinateArray()}}rt.INIT=0;rt.DELETE=1;rt.KEEP=1;rt.NUM_PTS_TO_CHECK=10;class Ci{constructor(){Ci.constructor_.apply(this,arguments)}static constructor_(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new L}getCoordinates(){return this._ptList.toArray(Ci.COORDINATE_ARRAY_TYPE)}setPrecisionModel(t){this._precisionModel=t}addPt(t){const e=new f(t);if(this._precisionModel.makePrecise(e),this.isRedundant(e))return null;this._ptList.add(e)}reverse(){}addPts(t,e){if(e)for(let i=0;i<t.length;i++)this.addPt(t[i]);else for(let i=t.length-1;i>=0;i--)this.addPt(t[i])}isRedundant(t){if(this._ptList.size()<1)return!1;const e=this._ptList.get(this._ptList.size()-1);return t.distance(e)<this._minimimVertexDistance}toString(){return new nt().createLineString(this.getCoordinates()).toString()}closeRing(){if(this._ptList.size()<1)return null;const t=new f(this._ptList.get(0)),e=this._ptList.get(this._ptList.size()-1);if(t.equals(e))return null;this._ptList.add(t)}setMinimumVertexDistance(t){this._minimimVertexDistance=t}}Ci.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);class z{static toDegrees(t){return t*180/Math.PI}static isAcute(t,e,i){const r=t.x-e.x,n=t.y-e.y,s=i.x-e.x,a=i.y-e.y;return r*s+n*a>0}static isObtuse(t,e,i){const r=t.x-e.x,n=t.y-e.y,s=i.x-e.x,a=i.y-e.y;return r*s+n*a<0}static interiorAngle(t,e,i){const r=z.angle(e,t),n=z.angle(e,i);return Math.abs(n-r)}static normalizePositive(t){if(t<0){for(;t<0;)t+=z.PI_TIMES_2;t>=z.PI_TIMES_2&&(t=0)}else{for(;t>=z.PI_TIMES_2;)t-=z.PI_TIMES_2;t<0&&(t=0)}return t}static angleBetween(t,e,i){const r=z.angle(e,t),n=z.angle(e,i);return z.diff(r,n)}static diff(t,e){let i=null;return t<e?i=e-t:i=t-e,i>Math.PI&&(i=2*Math.PI-i),i}static toRadians(t){return t*Math.PI/180}static normalize(t){for(;t>Math.PI;)t-=z.PI_TIMES_2;for(;t<=-Math.PI;)t+=z.PI_TIMES_2;return t}static angle(){if(arguments.length===1){const t=arguments[0];return Math.atan2(t.y,t.x)}else if(arguments.length===2){const t=arguments[0],e=arguments[1],i=e.x-t.x,r=e.y-t.y;return Math.atan2(r,i)}}static getTurn(t,e){const i=Math.sin(e-t);return i>0?z.COUNTERCLOCKWISE:i<0?z.CLOCKWISE:z.NONE}static angleBetweenOriented(t,e,i){const r=z.angle(e,t),s=z.angle(e,i)-r;return s<=-Math.PI?s+z.PI_TIMES_2:s>Math.PI?s-z.PI_TIMES_2:s}}z.PI_TIMES_2=2*Math.PI;z.PI_OVER_2=Math.PI/2;z.PI_OVER_4=Math.PI/4;z.COUNTERCLOCKWISE=I.COUNTERCLOCKWISE;z.CLOCKWISE=I.CLOCKWISE;z.NONE=I.COLLINEAR;class zt{constructor(){zt.constructor_.apply(this,arguments)}static constructor_(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new X,this._seg1=new X,this._offset0=new X,this._offset1=new X,this._side=0,this._hasNarrowConcaveAngle=!1;const t=arguments[0],e=arguments[1],i=arguments[2];this._precisionModel=t,this._bufParams=e,this._li=new Jt,this._filletAngleQuantum=Math.PI/2/e.getQuadrantSegments(),e.getQuadrantSegments()>=8&&e.getJoinStyle()===N.JOIN_ROUND&&(this._closingSegLengthFactor=zt.MAX_CLOSING_SEG_LEN_FACTOR),this.init(i)}getCoordinates(){return this._segList.getCoordinates()}addMitreJoin(t,e,i,r){const n=Ln.intersection(e.p0,e.p1,i.p0,i.p1);if(n!==null&&(r<=0?1:n.distance(t)/Math.abs(r))<=this._bufParams.getMitreLimit())return this._segList.addPt(n),null;this.addLimitedMitreJoin(e,i,r,this._bufParams.getMitreLimit())}addLastSegment(){this._segList.addPt(this._offset1.p1)}initSideSegments(t,e,i){this._s1=t,this._s2=e,this._side=i,this._seg1.setCoordinates(t,e),this.computeOffsetSegment(this._seg1,i,this._distance,this._offset1)}addLimitedMitreJoin(t,e,i,r){const n=this._seg0.p1,s=z.angle(n,this._seg0.p0),o=z.angleBetweenOriented(this._seg0.p0,n,this._seg1.p1)/2,c=z.normalize(s+o),h=z.normalize(c+Math.PI),d=r*i,m=d*Math.abs(Math.sin(o)),p=i-m,b=n.x+d*Math.cos(h),x=n.y+d*Math.sin(h),E=new f(b,x),T=new X(n,E),R=T.pointAlongOffset(1,p),G=T.pointAlongOffset(1,-p);this._side===w.LEFT?(this._segList.addPt(R),this._segList.addPt(G)):(this._segList.addPt(G),this._segList.addPt(R))}addDirectedFillet(t,e,i,r,n){const s=r===I.CLOCKWISE?-1:1,a=Math.abs(e-i),o=Math.trunc(a/this._filletAngleQuantum+.5);if(o<1)return null;const c=a/o,h=new f;for(let d=0;d<o;d++){const m=e+s*d*c;h.x=t.x+n*Math.cos(m),h.y=t.y+n*Math.sin(m),this._segList.addPt(h)}}computeOffsetSegment(t,e,i,r){const n=e===w.LEFT?1:-1,s=t.p1.x-t.p0.x,a=t.p1.y-t.p0.y,o=Math.sqrt(s*s+a*a),c=n*i*s/o,h=n*i*a/o;r.p0.x=t.p0.x-h,r.p0.y=t.p0.y+c,r.p1.x=t.p1.x-h,r.p1.y=t.p1.y+c}addInsideTurn(t,e){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*zt.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){const i=new f((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(i);const r=new f((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}createCircle(t){const e=new f(t.x+this._distance,t.y);this._segList.addPt(e),this.addDirectedFillet(t,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}addBevelJoin(t,e){this._segList.addPt(t.p1),this._segList.addPt(e.p0)}init(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Ci,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*zt.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}addCollinear(t){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===N.JOIN_BEVEL||this._bufParams.getJoinStyle()===N.JOIN_MITRE?(t&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,I.CLOCKWISE,this._distance))}addNextSegment(t,e){if(this._s0=this._s1,this._s1=this._s2,this._s2=t,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;const i=I.index(this._s0,this._s1,this._s2),r=i===I.CLOCKWISE&&this._side===w.LEFT||i===I.COUNTERCLOCKWISE&&this._side===w.RIGHT;i===0?this.addCollinear(e):r?this.addOutsideTurn(i,e):this.addInsideTurn(i,e)}addLineEndCap(t,e){const i=new X(t,e),r=new X;this.computeOffsetSegment(i,w.LEFT,this._distance,r);const n=new X;this.computeOffsetSegment(i,w.RIGHT,this._distance,n);const s=e.x-t.x,a=e.y-t.y,o=Math.atan2(a,s);switch(this._bufParams.getEndCapStyle()){case N.CAP_ROUND:this._segList.addPt(r.p1),this.addDirectedFillet(e,o+Math.PI/2,o-Math.PI/2,I.CLOCKWISE,this._distance),this._segList.addPt(n.p1);break;case N.CAP_FLAT:this._segList.addPt(r.p1),this._segList.addPt(n.p1);break;case N.CAP_SQUARE:const c=new f;c.x=Math.abs(this._distance)*Math.cos(o),c.y=Math.abs(this._distance)*Math.sin(o);const h=new f(r.p1.x+c.x,r.p1.y+c.y),d=new f(n.p1.x+c.x,n.p1.y+c.y);this._segList.addPt(h),this._segList.addPt(d);break}}addOutsideTurn(t,e){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*zt.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===N.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===N.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(e&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))}createSquare(t){this._segList.addPt(new f(t.x+this._distance,t.y+this._distance)),this._segList.addPt(new f(t.x+this._distance,t.y-this._distance)),this._segList.addPt(new f(t.x-this._distance,t.y-this._distance)),this._segList.addPt(new f(t.x-this._distance,t.y+this._distance)),this._segList.closeRing()}addSegments(t,e){this._segList.addPts(t,e)}addFirstSegment(){this._segList.addPt(this._offset1.p0)}addCornerFillet(t,e,i,r,n){const s=e.x-t.x,a=e.y-t.y;let o=Math.atan2(a,s);const c=i.x-t.x,h=i.y-t.y,d=Math.atan2(h,c);r===I.CLOCKWISE?o<=d&&(o+=2*Math.PI):o>=d&&(o-=2*Math.PI),this._segList.addPt(e),this.addDirectedFillet(t,o,d,r,n),this._segList.addPt(i)}closeRing(){this._segList.closeRing()}hasNarrowConcaveAngle(){return this._hasNarrowConcaveAngle}}zt.OFFSET_SEGMENT_SEPARATION_FACTOR=.001;zt.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001;zt.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6;zt.MAX_CLOSING_SEG_LEN_FACTOR=80;class ur{constructor(){ur.constructor_.apply(this,arguments)}static constructor_(){this._distance=0,this._precisionModel=null,this._bufParams=null;const t=arguments[0],e=arguments[1];this._precisionModel=t,this._bufParams=e}static copyCoordinates(t){const e=new Array(t.length).fill(null);for(let i=0;i<e.length;i++)e[i]=new f(t[i]);return e}getOffsetCurve(t,e){if(this._distance=e,e===0)return null;const i=e<0,r=Math.abs(e),n=this.getSegGen(r);t.length<=1?this.computePointCurve(t[0],n):this.computeOffsetCurve(t,i,n);const s=n.getCoordinates();return i&&W.reverse(s),s}computeSingleSidedBufferCurve(t,e,i){const r=this.simplifyTolerance(this._distance);if(e){i.addSegments(t,!0);const n=rt.simplify(t,-r),s=n.length-1;i.initSideSegments(n[s],n[s-1],w.LEFT),i.addFirstSegment();for(let a=s-2;a>=0;a--)i.addNextSegment(n[a],!0)}else{i.addSegments(t,!1);const n=rt.simplify(t,r),s=n.length-1;i.initSideSegments(n[0],n[1],w.LEFT),i.addFirstSegment();for(let a=2;a<=s;a++)i.addNextSegment(n[a],!0)}i.addLastSegment(),i.closeRing()}computeRingBufferCurve(t,e,i){let r=this.simplifyTolerance(this._distance);e===w.RIGHT&&(r=-r);const n=rt.simplify(t,r),s=n.length-1;i.initSideSegments(n[s-1],n[0],e);for(let a=1;a<=s;a++){const o=a!==1;i.addNextSegment(n[a],o)}i.closeRing()}computeLineBufferCurve(t,e){const i=this.simplifyTolerance(this._distance),r=rt.simplify(t,i),n=r.length-1;e.initSideSegments(r[0],r[1],w.LEFT);for(let o=2;o<=n;o++)e.addNextSegment(r[o],!0);e.addLastSegment(),e.addLineEndCap(r[n-1],r[n]);const s=rt.simplify(t,-i),a=s.length-1;e.initSideSegments(s[a],s[a-1],w.LEFT);for(let o=a-2;o>=0;o--)e.addNextSegment(s[o],!0);e.addLastSegment(),e.addLineEndCap(s[1],s[0]),e.closeRing()}computePointCurve(t,e){switch(this._bufParams.getEndCapStyle()){case N.CAP_ROUND:e.createCircle(t);break;case N.CAP_SQUARE:e.createSquare(t);break}}getLineCurve(t,e){if(this._distance=e,this.isLineOffsetEmpty(e))return null;const i=Math.abs(e),r=this.getSegGen(i);if(t.length<=1)this.computePointCurve(t[0],r);else if(this._bufParams.isSingleSided()){const s=e<0;this.computeSingleSidedBufferCurve(t,s,r)}else this.computeLineBufferCurve(t,r);return r.getCoordinates()}getBufferParameters(){return this._bufParams}simplifyTolerance(t){return t*this._bufParams.getSimplifyFactor()}getRingCurve(t,e,i){if(this._distance=i,t.length<=2)return this.getLineCurve(t,i);if(i===0)return ur.copyCoordinates(t);const r=this.getSegGen(i);return this.computeRingBufferCurve(t,e,r),r.getCoordinates()}computeOffsetCurve(t,e,i){const r=this.simplifyTolerance(this._distance);if(e){const n=rt.simplify(t,-r),s=n.length-1;i.initSideSegments(n[s],n[s-1],w.LEFT),i.addFirstSegment();for(let a=s-2;a>=0;a--)i.addNextSegment(n[a],!0)}else{const n=rt.simplify(t,r),s=n.length-1;i.initSideSegments(n[0],n[1],w.LEFT),i.addFirstSegment();for(let a=2;a<=s;a++)i.addNextSegment(n[a],!0)}i.addLastSegment()}isLineOffsetEmpty(t){return t===0||t<0&&!this._bufParams.isSingleSided()}getSegGen(t){return new zt(this._precisionModel,this._bufParams,t)}}class pt{constructor(){pt.constructor_.apply(this,arguments)}static constructor_(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){const t=arguments[0];this.init(t.length)}else if(Number.isInteger(arguments[0])){const t=arguments[0];this.init(1),this.location[w.ON]=t}else if(arguments[0]instanceof pt){const t=arguments[0];if(this.init(t.location.length),t!==null)for(let e=0;e<this.location.length;e++)this.location[e]=t.location[e]}}else if(arguments.length===3){const t=arguments[0],e=arguments[1],i=arguments[2];this.init(3),this.location[w.ON]=t,this.location[w.LEFT]=e,this.location[w.RIGHT]=i}}setAllLocations(t){for(let e=0;e<this.location.length;e++)this.location[e]=t}isNull(){for(let t=0;t<this.location.length;t++)if(this.location[t]!==u.NONE)return!1;return!0}setAllLocationsIfNull(t){for(let e=0;e<this.location.length;e++)this.location[e]===u.NONE&&(this.location[e]=t)}isLine(){return this.location.length===1}merge(t){if(t.location.length>this.location.length){const e=new Array(3).fill(null);e[w.ON]=this.location[w.ON],e[w.LEFT]=u.NONE,e[w.RIGHT]=u.NONE,this.location=e}for(let e=0;e<this.location.length;e++)this.location[e]===u.NONE&&e<t.location.length&&(this.location[e]=t.location[e])}getLocations(){return this.location}flip(){if(this.location.length<=1)return null;const t=this.location[w.LEFT];this.location[w.LEFT]=this.location[w.RIGHT],this.location[w.RIGHT]=t}get(t){return t<this.location.length?this.location[t]:u.NONE}isEqualOnSide(t,e){return this.location[e]===t.location[e]}allPositionsEqual(t){for(let e=0;e<this.location.length;e++)if(this.location[e]!==t)return!1;return!0}toString(){const t=new ki;return this.location.length>1&&t.append(u.toLocationSymbol(this.location[w.LEFT])),t.append(u.toLocationSymbol(this.location[w.ON])),this.location.length>1&&t.append(u.toLocationSymbol(this.location[w.RIGHT])),t.toString()}setLocations(t,e,i){this.location[w.ON]=t,this.location[w.LEFT]=e,this.location[w.RIGHT]=i}isArea(){return this.location.length>1}isAnyNull(){for(let t=0;t<this.location.length;t++)if(this.location[t]===u.NONE)return!0;return!1}setLocation(){if(arguments.length===1){const t=arguments[0];this.setLocation(w.ON,t)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this.location[t]=e}}init(t){this.location=new Array(t).fill(null),this.setAllLocations(u.NONE)}}class dt{constructor(){dt.constructor_.apply(this,arguments)}static constructor_(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){const t=arguments[0];this.elt[0]=new pt(t),this.elt[1]=new pt(t)}else if(arguments[0]instanceof dt){const t=arguments[0];this.elt[0]=new pt(t.elt[0]),this.elt[1]=new pt(t.elt[1])}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this.elt[0]=new pt(u.NONE),this.elt[1]=new pt(u.NONE),this.elt[t].setLocation(e)}else if(arguments.length===3){const t=arguments[0],e=arguments[1],i=arguments[2];this.elt[0]=new pt(t,e,i),this.elt[1]=new pt(t,e,i)}else if(arguments.length===4){const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3];this.elt[0]=new pt(u.NONE,u.NONE,u.NONE),this.elt[1]=new pt(u.NONE,u.NONE,u.NONE),this.elt[t].setLocations(e,i,r)}}static toLineLabel(t){const e=new dt(u.NONE);for(let i=0;i<2;i++)e.setLocation(i,t.getLocation(i));return e}getGeometryCount(){let t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t}setAllLocations(t,e){this.elt[t].setAllLocations(e)}isNull(t){return this.elt[t].isNull()}setAllLocationsIfNull(){if(arguments.length===1){const t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this.elt[t].setAllLocationsIfNull(e)}}isLine(t){return this.elt[t].isLine()}merge(t){for(let e=0;e<2;e++)this.elt[e]===null&&t.elt[e]!==null?this.elt[e]=new pt(t.elt[e]):this.elt[e].merge(t.elt[e])}flip(){this.elt[0].flip(),this.elt[1].flip()}getLocation(){if(arguments.length===1){const t=arguments[0];return this.elt[t].get(w.ON)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];return this.elt[t].get(e)}}toString(){const t=new ki;return this.elt[0]!==null&&(t.append("A:"),t.append(this.elt[0].toString())),this.elt[1]!==null&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()}setLocation(){if(arguments.length===2){const t=arguments[0],e=arguments[1];this.elt[t].setLocation(w.ON,e)}else if(arguments.length===3){const t=arguments[0],e=arguments[1],i=arguments[2];this.elt[t].setLocation(e,i)}}isEqualOnSide(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)}allPositionsEqual(t,e){return this.elt[t].allPositionsEqual(e)}toLine(t){this.elt[t].isArea()&&(this.elt[t]=new pt(this.elt[t].location[0]))}isArea(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){const t=arguments[0];return this.elt[t].isArea()}}isAnyNull(t){return this.elt[t].isAnyNull()}}class Or{constructor(){Or.constructor_.apply(this,arguments)}static constructor_(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){const t=arguments[0];this._label=t}}}setVisited(t){this._isVisited=t}setInResult(t){this._isInResult=t}setLabel(t){this._label=t}getLabel(){return this._label}setCovered(t){this._isCovered=t,this._isCoveredSet=!0}updateIM(t){P.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(t)}isCovered(){return this._isCovered}isCoveredSet(){return this._isCoveredSet}isInResult(){return this._isInResult}isVisited(){return this._isVisited}}class Ie extends Or{constructor(){super(),Ie.constructor_.apply(this,arguments)}static constructor_(){this._coord=null,this._edges=null;const t=arguments[0],e=arguments[1];this._coord=t,this._edges=e,this._label=new dt(0,u.NONE)}isIncidentEdgeInResult(){for(let t=this.getEdges().getEdges().iterator();t.hasNext();)if(t.next().getEdge().isInResult())return!0;return!1}isIsolated(){return this._label.getGeometryCount()===1}getCoordinate(){return this._coord}computeMergedLocation(t,e){let i=u.NONE;if(i=this._label.getLocation(e),!t.isNull(e)){const r=t.getLocation(e);i!==u.BOUNDARY&&(i=r)}return i}setLabel(){if(arguments.length===2&&Number.isInteger(arguments[1])&&Number.isInteger(arguments[0])){const t=arguments[0],e=arguments[1];this._label===null?this._label=new dt(t,e):this._label.setLocation(t,e)}else return super.setLabel.apply(this,arguments)}getEdges(){return this._edges}mergeLabel(){if(arguments[0]instanceof Ie){const t=arguments[0];this.mergeLabel(t._label)}else if(arguments[0]instanceof dt){const t=arguments[0];for(let e=0;e<2;e++){const i=this.computeMergedLocation(t,e);this._label.getLocation(e)===u.NONE&&this._label.setLocation(e,i)}}}add(t){this._edges.insert(t),t.setNode(this)}setLabelBoundary(t){if(this._label===null)return null;let e=u.NONE;this._label!==null&&(e=this._label.getLocation(t));let i=null;switch(e){case u.BOUNDARY:i=u.INTERIOR;break;case u.INTERIOR:i=u.BOUNDARY;break;default:i=u.BOUNDARY;break}this._label.setLocation(t,i)}print(t){t.println("node "+this._coord+" lbl: "+this._label)}computeIM(t){}}class mr{constructor(){mr.constructor_.apply(this,arguments)}static constructor_(){this.nodeMap=new me,this.nodeFact=null;const t=arguments[0];this.nodeFact=t}print(t){for(let e=this.iterator();e.hasNext();)e.next().print(t)}iterator(){return this.nodeMap.values().iterator()}values(){return this.nodeMap.values()}getBoundaryNodes(t){const e=new L;for(let i=this.iterator();i.hasNext();){const r=i.next();r.getLabel().getLocation(t)===u.BOUNDARY&&e.add(r)}return e}add(t){const e=t.getCoordinate();this.addNode(e).add(t)}find(t){return this.nodeMap.get(t)}addNode(){if(arguments[0]instanceof f){const t=arguments[0];let e=this.nodeMap.get(t);return e===null&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}else if(arguments[0]instanceof Ie){const t=arguments[0],e=this.nodeMap.get(t.getCoordinate());return e===null?(this.nodeMap.put(t.getCoordinate(),t),t):(e.mergeLabel(t),e)}}}class Ia{createNode(t){return new Ie(t,null)}}class Ve{constructor(){Ve.constructor_.apply(this,arguments)}static constructor_(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){const t=arguments[0];this._edge=t}else if(arguments.length===3){const t=arguments[0],e=arguments[1],i=arguments[2];Ve.constructor_.call(this,t,e,i,null)}else if(arguments.length===4){const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3];Ve.constructor_.call(this,t),this.init(e,i),this._label=r}}compareDirection(t){return this._dx===t._dx&&this._dy===t._dy?0:this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:I.index(t._p0,t._p1,this._p1)}getDy(){return this._dy}print(t){const e=Math.atan2(this._dy,this._dx),i=this.getClass().getName(),r=i.lastIndexOf("."),n=i.substring(r+1);t.print("  "+n+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label)}getLabel(){return this._label}getEdge(){return this._edge}toString(){const t=Math.atan2(this._dy,this._dx),e=this.getClass().getName(),i=e.lastIndexOf(".");return"  "+e.substring(i+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label}computeLabel(t){}init(t,e){this._p0=t,this._p1=e,this._dx=e.x-t.x,this._dy=e.y-t.y,this._quadrant=q.quadrant(this._dx,this._dy),P.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")}getCoordinate(){return this._p0}setNode(t){this._node=t}compareTo(t){const e=t;return this.compareDirection(e)}getDirectedCoordinate(){return this._p1}getDx(){return this._dx}getQuadrant(){return this._quadrant}getNode(){return this._node}get interfaces_(){return[Ct]}}class Ii extends Ve{constructor(){super(),Ii.constructor_.apply(this,arguments)}static constructor_(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];const t=arguments[0],e=arguments[1];if(Ve.constructor_.call(this,t),this._isForward=e,e)this.init(t.getCoordinate(0),t.getCoordinate(1));else{const i=t.getNumPoints()-1;this.init(t.getCoordinate(i),t.getCoordinate(i-1))}this.computeDirectedLabel()}static depthFactor(t,e){return t===u.EXTERIOR&&e===u.INTERIOR?1:t===u.INTERIOR&&e===u.EXTERIOR?-1:0}setVisited(t){this._isVisited=t}setDepth(t,e){if(this._depth[t]!==-999&&this._depth[t]!==e)throw new $t("assigned depths do not match",this.getCoordinate());this._depth[t]=e}isInteriorAreaEdge(){let t=!0;for(let e=0;e<2;e++)this._label.isArea(e)&&this._label.getLocation(e,w.LEFT)===u.INTERIOR&&this._label.getLocation(e,w.RIGHT)===u.INTERIOR||(t=!1);return t}setNextMin(t){this._nextMin=t}print(t){super.print.call(this,t),t.print(" "+this._depth[w.LEFT]+"/"+this._depth[w.RIGHT]),t.print(" ("+this.getDepthDelta()+")"),this._isInResult&&t.print(" inResult")}setMinEdgeRing(t){this._minEdgeRing=t}getSym(){return this._sym}isForward(){return this._isForward}setSym(t){this._sym=t}setVisitedEdge(t){this.setVisited(t),this._sym.setVisited(t)}getNextMin(){return this._nextMin}getDepth(t){return this._depth[t]}computeDirectedLabel(){this._label=new dt(this._edge.getLabel()),this._isForward||this._label.flip()}getNext(){return this._next}isLineEdge(){const t=this._label.isLine(0)||this._label.isLine(1),e=!this._label.isArea(0)||this._label.allPositionsEqual(0,u.EXTERIOR),i=!this._label.isArea(1)||this._label.allPositionsEqual(1,u.EXTERIOR);return t&&e&&i}setEdgeRing(t){this._edgeRing=t}getMinEdgeRing(){return this._minEdgeRing}getDepthDelta(){let t=this._edge.getDepthDelta();return this._isForward||(t=-t),t}setInResult(t){this._isInResult=t}getEdge(){return this._edge}printEdge(t){this.print(t),t.print(" "),this._isForward?this._edge.print(t):this._edge.printReverse(t)}setEdgeDepths(t,e){let i=this.getEdge().getDepthDelta();this._isForward||(i=-i);let r=1;t===w.LEFT&&(r=-1);const n=w.opposite(t),s=i*r,a=e+s;this.setDepth(t,e),this.setDepth(n,a)}getEdgeRing(){return this._edgeRing}isInResult(){return this._isInResult}setNext(t){this._next=t}isVisited(){return this._isVisited}}class Dr{constructor(){Dr.constructor_.apply(this,arguments)}static constructor_(){if(this._edges=new L,this._nodes=null,this._edgeEndList=new L,arguments.length===0)this._nodes=new mr(new Ia);else if(arguments.length===1){const t=arguments[0];this._nodes=new mr(t)}}static linkResultDirectedEdges(t){for(let e=t.iterator();e.hasNext();)e.next().getEdges().linkResultDirectedEdges()}printEdges(t){t.println("Edges:");for(let e=0;e<this._edges.size();e++){t.println("edge "+e+":");const i=this._edges.get(e);i.print(t),i.eiList.print(t)}}debugPrintln(t){Pt.out.println(t)}isBoundaryNode(t,e){const i=this._nodes.find(e);if(i===null)return!1;const r=i.getLabel();return r!==null&&r.getLocation(t)===u.BOUNDARY}linkAllDirectedEdges(){for(let t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkAllDirectedEdges()}debugPrint(t){Pt.out.print(t)}findEdgeEnd(t){for(let e=this.getEdgeEnds().iterator();e.hasNext();){const i=e.next();if(i.getEdge()===t)return i}return null}getNodes(){return this._nodes.values()}findEdge(t,e){for(let i=0;i<this._edges.size();i++){const r=this._edges.get(i),n=r.getCoordinates();if(t.equals(n[0])&&e.equals(n[1]))return r}return null}find(t){return this._nodes.find(t)}addNode(){if(arguments[0]instanceof Ie){const t=arguments[0];return this._nodes.addNode(t)}else if(arguments[0]instanceof f){const t=arguments[0];return this._nodes.addNode(t)}}getNodeIterator(){return this._nodes.iterator()}linkResultDirectedEdges(){for(let t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()}matchInSameDirection(t,e,i,r){return t.equals(i)?I.index(t,e,r)===I.COLLINEAR&&q.quadrant(t,e)===q.quadrant(i,r):!1}getEdgeEnds(){return this._edgeEndList}getEdgeIterator(){return this._edges.iterator()}findEdgeInSameDirection(t,e){for(let i=0;i<this._edges.size();i++){const r=this._edges.get(i),n=r.getCoordinates();if(this.matchInSameDirection(t,e,n[0],n[1])||this.matchInSameDirection(t,e,n[n.length-1],n[n.length-2]))return r}return null}insertEdge(t){this._edges.add(t)}addEdges(t){for(let e=t.iterator();e.hasNext();){const i=e.next();this._edges.add(i);const r=new Ii(i,!0),n=new Ii(i,!1);r.setSym(n),n.setSym(r),this.add(r),this.add(n)}}add(t){this._nodes.add(t),this._edgeEndList.add(t)}}class fi{constructor(){fi.constructor_.apply(this,arguments)}static constructor_(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;const t=arguments[0];this._p=t}static locatePointInRing(){if(arguments[0]instanceof f&&M(arguments[1],O)){const t=arguments[0],e=arguments[1],i=new fi(t),r=new f,n=new f;for(let s=1;s<e.size();s++)if(e.getCoordinate(s,r),e.getCoordinate(s-1,n),i.countSegment(r,n),i.isOnSegment())return i.getLocation();return i.getLocation()}else if(arguments[0]instanceof f&&arguments[1]instanceof Array){const t=arguments[0],e=arguments[1],i=new fi(t);for(let r=1;r<e.length;r++){const n=e[r],s=e[r-1];if(i.countSegment(n,s),i.isOnSegment())return i.getLocation()}return i.getLocation()}}getLocation(){return this._isPointOnSegment?u.BOUNDARY:this._crossingCount%2===1?u.INTERIOR:u.EXTERIOR}isPointInPolygon(){return this.getLocation()!==u.EXTERIOR}isOnSegment(){return this._isPointOnSegment}countSegment(t,e){if(t.x<this._p.x&&e.x<this._p.x)return null;if(this._p.x===e.x&&this._p.y===e.y)return this._isPointOnSegment=!0,null;if(t.y===this._p.y&&e.y===this._p.y){let i=t.x,r=e.x;return i>r&&(i=e.x,r=t.x),this._p.x>=i&&this._p.x<=r&&(this._isPointOnSegment=!0),null}if(t.y>this._p.y&&e.y<=this._p.y||e.y>this._p.y&&t.y<=this._p.y){let i=I.index(t,e,this._p);if(i===I.COLLINEAR)return this._isPointOnSegment=!0,null;e.y<t.y&&(i=-i),i===I.LEFT&&this._crossingCount++}}}class Ri{static isInRing(t,e){return Ri.locateInRing(t,e)!==u.EXTERIOR}static locateInRing(t,e){return fi.locatePointInRing(t,e)}static isOnLine(){if(arguments[0]instanceof f&&M(arguments[1],O)){const t=arguments[0],e=arguments[1],i=new Jt,r=new f,n=new f,s=e.size();for(let a=1;a<s;a++)if(e.getCoordinate(a-1,r),e.getCoordinate(a,n),i.computeIntersection(t,r,n),i.hasIntersection())return!0;return!1}else if(arguments[0]instanceof f&&arguments[1]instanceof Array){const t=arguments[0],e=arguments[1],i=new Jt;for(let r=1;r<e.length;r++){const n=e[r-1],s=e[r];if(i.computeIntersection(t,n,s),i.hasIntersection())return!0}return!1}}}class ni{constructor(){ni.constructor_.apply(this,arguments)}static constructor_(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new L,this._pts=new L,this._label=new dt(u.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new L,this._geometryFactory=null,arguments.length!==0){if(arguments.length===2){const t=arguments[0],e=arguments[1];this._geometryFactory=e,this.computePoints(t),this.computeRing()}}}computeRing(){if(this._ring!==null)return null;const t=new Array(this._pts.size()).fill(null);for(let e=0;e<this._pts.size();e++)t[e]=this._pts.get(e);this._ring=this._geometryFactory.createLinearRing(t),this._isHole=I.isCCW(this._ring.getCoordinates())}isIsolated(){return this._label.getGeometryCount()===1}computePoints(t){this._startDe=t;let e=t,i=!0;do{if(e===null)throw new $t("Found null DirectedEdge");if(e.getEdgeRing()===this)throw new $t("Directed Edge visited twice during ring-building at "+e.getCoordinate());this._edges.add(e);const r=e.getLabel();P.isTrue(r.isArea()),this.mergeLabel(r),this.addPoints(e.getEdge(),e.isForward(),i),i=!1,this.setEdgeRing(e,this),e=this.getNext(e)}while(e!==this._startDe)}getLinearRing(){return this._ring}getCoordinate(t){return this._pts.get(t)}computeMaxNodeDegree(){this._maxNodeDegree=0;let t=this._startDe;do{const i=t.getNode().getEdges().getOutgoingDegree(this);i>this._maxNodeDegree&&(this._maxNodeDegree=i),t=this.getNext(t)}while(t!==this._startDe);this._maxNodeDegree*=2}addPoints(t,e,i){const r=t.getCoordinates();if(e){let n=1;i&&(n=0);for(let s=n;s<r.length;s++)this._pts.add(r[s])}else{let n=r.length-2;i&&(n=r.length-1);for(let s=n;s>=0;s--)this._pts.add(r[s])}}containsPoint(t){const e=this.getLinearRing();if(!e.getEnvelopeInternal().contains(t)||!Ri.isInRing(t,e.getCoordinates()))return!1;for(let r=this._holes.iterator();r.hasNext();)if(r.next().containsPoint(t))return!1;return!0}getMaxNodeDegree(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}setShell(t){this._shell=t,t!==null&&t.addHole(this)}toPolygon(t){const e=new Array(this._holes.size()).fill(null);for(let r=0;r<this._holes.size();r++)e[r]=this._holes.get(r).getLinearRing();return t.createPolygon(this.getLinearRing(),e)}isHole(){return this._isHole}setInResult(){let t=this._startDe;do t.getEdge().setInResult(!0),t=t.getNext();while(t!==this._startDe)}addHole(t){this._holes.add(t)}isShell(){return this._shell===null}getLabel(){return this._label}getEdges(){return this._edges}getShell(){return this._shell}mergeLabel(){if(arguments.length===1){const t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(arguments.length===2){const t=arguments[0],e=arguments[1],i=t.getLocation(e,w.RIGHT);if(i===u.NONE)return null;if(this._label.getLocation(e)===u.NONE)return this._label.setLocation(e,i),null}}}class Fn extends ni{constructor(){super(),Fn.constructor_.apply(this,arguments)}static constructor_(){const t=arguments[0],e=arguments[1];ni.constructor_.call(this,t,e)}getNext(t){return t.getNextMin()}setEdgeRing(t,e){t.setMinEdgeRing(e)}}class On extends ni{constructor(){super(),On.constructor_.apply(this,arguments)}static constructor_(){const t=arguments[0],e=arguments[1];ni.constructor_.call(this,t,e)}linkDirectedEdgesForMinimalEdgeRings(){let t=this._startDe;do t.getNode().getEdges().linkMinimalDirectedEdges(this),t=t.getNext();while(t!==this._startDe)}buildMinimalRings(){const t=new L;let e=this._startDe;do{if(e.getMinEdgeRing()===null){const i=new Fn(e,this._geometryFactory);t.add(i)}e=e.getNext()}while(e!==this._startDe);return t}getNext(t){return t.getNext()}setEdgeRing(t,e){t.setEdgeRing(e)}}class pr{constructor(){pr.constructor_.apply(this,arguments)}static constructor_(){this._geometryFactory=null,this._shellList=new L;const t=arguments[0];this._geometryFactory=t}static findEdgeRingContaining(t,e){const i=t.getLinearRing(),r=i.getEnvelopeInternal();let n=i.getCoordinateN(0),s=null,a=null;for(let o=e.iterator();o.hasNext();){const c=o.next(),h=c.getLinearRing(),d=h.getEnvelopeInternal();if(d.equals(r)||!d.contains(r))continue;n=W.ptNotInList(i.getCoordinates(),h.getCoordinates());let m=!1;Ri.isInRing(n,h.getCoordinates())&&(m=!0),m&&(s===null||a.contains(d))&&(s=c,a=s.getLinearRing().getEnvelopeInternal())}return s}sortShellsAndHoles(t,e,i){for(let r=t.iterator();r.hasNext();){const n=r.next();n.isHole()?i.add(n):e.add(n)}}computePolygons(t){const e=new L;for(let i=t.iterator();i.hasNext();){const n=i.next().toPolygon(this._geometryFactory);e.add(n)}return e}placeFreeHoles(t,e){for(let i=e.iterator();i.hasNext();){const r=i.next();if(r.getShell()===null){const n=pr.findEdgeRingContaining(r,t);if(n===null)throw new $t("unable to assign hole to a shell",r.getCoordinate(0));r.setShell(n)}}}buildMinimalEdgeRings(t,e,i){const r=new L;for(let n=t.iterator();n.hasNext();){const s=n.next();if(s.getMaxNodeDegree()>2){s.linkDirectedEdgesForMinimalEdgeRings();const a=s.buildMinimalRings(),o=this.findShell(a);o!==null?(this.placePolygonHoles(o,a),e.add(o)):i.addAll(a)}else r.add(s)}return r}buildMaximalEdgeRings(t){const e=new L;for(let i=t.iterator();i.hasNext();){const r=i.next();if(r.isInResult()&&r.getLabel().isArea()&&r.getEdgeRing()===null){const n=new On(r,this._geometryFactory);e.add(n),n.setInResult()}}return e}placePolygonHoles(t,e){for(let i=e.iterator();i.hasNext();){const r=i.next();r.isHole()&&r.setShell(t)}}getPolygons(){return this.computePolygons(this._shellList)}findShell(t){let e=0,i=null;for(let r=t.iterator();r.hasNext();){const n=r.next();n.isHole()||(i=n,e++)}return P.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),i}add(){if(arguments.length===1){const t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(arguments.length===2){const t=arguments[0],e=arguments[1];Dr.linkResultDirectedEdges(e);const i=this.buildMaximalEdgeRings(t),r=new L,n=this.buildMinimalEdgeRings(i,this._shellList,r);this.sortShellsAndHoles(n,this._shellList,r),this.placeFreeHoles(this._shellList,r)}}}class zr{constructor(){zr.constructor_.apply(this,arguments)}static constructor_(){this._subgraphs=null,this._seg=new X;const t=arguments[0];this._subgraphs=t}findStabbedSegments(){if(arguments.length===1){const t=arguments[0],e=new L;for(let i=this._subgraphs.iterator();i.hasNext();){const r=i.next(),n=r.getEnvelope();t.y<n.getMinY()||t.y>n.getMaxY()||this.findStabbedSegments(t,r.getDirectedEdges(),e)}return e}else if(arguments.length===3){if(M(arguments[2],xe)&&arguments[0]instanceof f&&arguments[1]instanceof Ii){const t=arguments[0],e=arguments[1],i=arguments[2],r=e.getEdge().getCoordinates();for(let n=0;n<r.length-1;n++){if(this._seg.p0=r[n],this._seg.p1=r[n+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),Math.max(this._seg.p0.x,this._seg.p1.x)<t.x||this._seg.isHorizontal()||t.y<this._seg.p0.y||t.y>this._seg.p1.y||I.index(this._seg.p0,this._seg.p1,t)===I.RIGHT)continue;let a=e.getDepth(w.LEFT);this._seg.p0.equals(r[n])||(a=e.getDepth(w.RIGHT));const o=new Vr(this._seg,a);i.add(o)}}else if(M(arguments[2],xe)&&arguments[0]instanceof f&&M(arguments[1],xe)){const t=arguments[0],e=arguments[1],i=arguments[2];for(let r=e.iterator();r.hasNext();){const n=r.next();n.isForward()&&this.findStabbedSegments(t,n,i)}}}}getDepth(t){const e=this.findStabbedSegments(t);return e.size()===0?0:ii.min(e)._leftDepth}}class Vr{constructor(){Vr.constructor_.apply(this,arguments)}static constructor_(){this._upwardSeg=null,this._leftDepth=null;const t=arguments[0],e=arguments[1];this._upwardSeg=new X(t),this._leftDepth=e}compareX(t,e){const i=t.p0.compareTo(e.p0);return i!==0?i:t.p1.compareTo(e.p1)}toString(){return this._upwardSeg.toString()}compareTo(t){const e=t;if(this._upwardSeg.minX()>=e._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=e._upwardSeg.minX())return-1;let i=this._upwardSeg.orientationIndex(e._upwardSeg);return i!==0||(i=-1*e._upwardSeg.orientationIndex(this._upwardSeg),i!==0)?i:this._upwardSeg.compareTo(e._upwardSeg)}get interfaces_(){return[Ct]}}zr.DepthSegment=Vr;class fr extends Rt{constructor(){super(),fr.constructor_.apply(this,arguments)}static constructor_(){Rt.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}class ke{constructor(){ke.constructor_.apply(this,arguments)}static constructor_(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){const t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){const t=arguments[0],e=arguments[1];this.x=t,this.y=e,this.w=1}else if(arguments[0]instanceof ke&&arguments[1]instanceof ke){const t=arguments[0],e=arguments[1];this.x=t.y*e.w-e.y*t.w,this.y=e.x*t.w-t.x*e.w,this.w=t.x*e.y-e.x*t.y}else if(arguments[0]instanceof f&&arguments[1]instanceof f){const t=arguments[0],e=arguments[1];this.x=t.y-e.y,this.y=e.x-t.x,this.w=t.x*e.y-e.x*t.y}}else if(arguments.length===3){const t=arguments[0],e=arguments[1],i=arguments[2];this.x=t,this.y=e,this.w=i}else if(arguments.length===4){const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3],n=t.y-e.y,s=e.x-t.x,a=t.x*e.y-e.x*t.y,o=i.y-r.y,c=r.x-i.x,h=i.x*r.y-r.x*i.y;this.x=s*h-c*a,this.y=o*a-n*h,this.w=n*c-o*s}}getCoordinate(){const t=new f;return t.x=this.getX(),t.y=this.getY(),t}getX(){const t=this.x/this.w;if(S.isNaN(t)||S.isInfinite(t))throw new fr;return t}getY(){const t=this.y/this.w;if(S.isNaN(t)||S.isInfinite(t))throw new fr;return t}}class mt{constructor(){mt.constructor_.apply(this,arguments)}static constructor_(){this.p0=null,this.p1=null,this.p2=null;const t=arguments[0],e=arguments[1],i=arguments[2];this.p0=t,this.p1=e,this.p2=i}static isAcute(t,e,i){return!(!z.isAcute(t,e,i)||!z.isAcute(e,i,t)||!z.isAcute(i,t,e))}static circumcentre(t,e,i){const r=i.x,n=i.y,s=t.x-r,a=t.y-n,o=e.x-r,c=e.y-n,h=2*mt.det(s,a,o,c),d=mt.det(a,s*s+a*a,c,o*o+c*c),m=mt.det(s,s*s+a*a,o,o*o+c*c),p=r-d/h,b=n+m/h;return new f(p,b)}static perpendicularBisector(t,e){const i=e.x-t.x,r=e.y-t.y,n=new ke(t.x+i/2,t.y+r/2,1),s=new ke(t.x-r+i/2,t.y+i+r/2,1);return new ke(n,s)}static angleBisector(t,e,i){const r=e.distance(t),n=e.distance(i),s=r/(r+n),a=i.x-t.x,o=i.y-t.y;return new f(t.x+s*a,t.y+s*o)}static inCentre(t,e,i){const r=e.distance(i),n=t.distance(i),s=t.distance(e),a=r+n+s,o=(r*t.x+n*e.x+s*i.x)/a,c=(r*t.y+n*e.y+s*i.y)/a;return new f(o,c)}static area(t,e,i){return Math.abs(((i.x-t.x)*(e.y-t.y)-(e.x-t.x)*(i.y-t.y))/2)}static signedArea(t,e,i){return((i.x-t.x)*(e.y-t.y)-(e.x-t.x)*(i.y-t.y))/2}static det(t,e,i,r){return t*r-e*i}static interpolateZ(t,e,i,r){const n=e.x,s=e.y,a=i.x-n,o=r.x-n,c=i.y-s,h=r.y-s,d=a*h-o*c,m=t.x-n,p=t.y-s,b=(h*m-o*p)/d,x=(-c*m+a*p)/d;return e.getZ()+b*(i.getZ()-e.getZ())+x*(r.getZ()-e.getZ())}static longestSideLength(t,e,i){const r=t.distance(e),n=e.distance(i),s=i.distance(t);let a=r;return n>a&&(a=n),s>a&&(a=s),a}static circumcentreDD(t,e,i){const r=v.valueOf(t.x).subtract(i.x),n=v.valueOf(t.y).subtract(i.y),s=v.valueOf(e.x).subtract(i.x),a=v.valueOf(e.y).subtract(i.y),o=v.determinant(r,n,s,a).multiply(2),c=r.sqr().add(n.sqr()),h=s.sqr().add(a.sqr()),d=v.determinant(n,c,a,h),m=v.determinant(r,c,s,h),p=v.valueOf(i.x).subtract(d.divide(o)).doubleValue(),b=v.valueOf(i.y).add(m.divide(o)).doubleValue();return new f(p,b)}static area3D(t,e,i){const r=e.x-t.x,n=e.y-t.y,s=e.getZ()-t.getZ(),a=i.x-t.x,o=i.y-t.y,c=i.getZ()-t.getZ(),h=n*c-s*o,d=s*a-r*c,m=r*o-n*a,p=h*h+d*d+m*m;return Math.sqrt(p)/2}static centroid(t,e,i){const r=(t.x+e.x+i.x)/3,n=(t.y+e.y+i.y)/3;return new f(r,n)}interpolateZ(t){if(t===null)throw new F("Supplied point is null.");return mt.interpolateZ(t,this.p0,this.p1,this.p2)}longestSideLength(){return mt.longestSideLength(this.p0,this.p1,this.p2)}isAcute(){return mt.isAcute(this.p0,this.p1,this.p2)}circumcentre(){return mt.circumcentre(this.p0,this.p1,this.p2)}inCentre(){return mt.inCentre(this.p0,this.p1,this.p2)}area(){return mt.area(this.p0,this.p1,this.p2)}signedArea(){return mt.signedArea(this.p0,this.p1,this.p2)}area3D(){return mt.area3D(this.p0,this.p1,this.p2)}centroid(){return mt.centroid(this.p0,this.p1,this.p2)}}class Dn{constructor(){Dn.constructor_.apply(this,arguments)}static constructor_(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new L;const t=arguments[0],e=arguments[1],i=arguments[2];this._inputGeom=t,this._distance=e,this._curveBuilder=i}addRingSide(t,e,i,r,n){if(e===0&&t.length<se.MINIMUM_VALID_SIZE)return null;let s=r,a=n;t.length>=se.MINIMUM_VALID_SIZE&&I.isCCW(t)&&(s=n,a=r,i=w.opposite(i));const o=this._curveBuilder.getRingCurve(t,i,e);this.addCurve(o,s,a)}addRingBothSides(t,e){this.addRingSide(t,e,w.LEFT,u.EXTERIOR,u.INTERIOR),this.addRingSide(t,e,w.RIGHT,u.INTERIOR,u.EXTERIOR)}addPoint(t){if(this._distance<=0)return null;const e=t.getCoordinates(),i=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(i,u.EXTERIOR,u.INTERIOR)}addPolygon(t){let e=this._distance,i=w.LEFT;this._distance<0&&(e=-this._distance,i=w.RIGHT);const r=t.getExteriorRing(),n=W.removeRepeatedPoints(r.getCoordinates());if(this._distance<0&&this.isErodedCompletely(r,this._distance)||this._distance<=0&&n.length<3)return null;this.addRingSide(n,e,i,u.EXTERIOR,u.INTERIOR);for(let s=0;s<t.getNumInteriorRing();s++){const a=t.getInteriorRingN(s),o=W.removeRepeatedPoints(a.getCoordinates());this._distance>0&&this.isErodedCompletely(a,-this._distance)||this.addRingSide(o,e,w.opposite(i),u.INTERIOR,u.EXTERIOR)}}isTriangleErodedCompletely(t,e){const i=new mt(t[0],t[1],t[2]),r=i.inCentre();return it.pointToSegment(r,i.p0,i.p1)<Math.abs(e)}addLineString(t){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;const e=W.removeRepeatedPoints(t.getCoordinates());if(W.isRing(e)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(e,this._distance);else{const i=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(i,u.EXTERIOR,u.INTERIOR)}}add(t){if(t.isEmpty())return null;if(t instanceof Ce)this.addPolygon(t);else if(t instanceof ne)this.addLineString(t);else if(t instanceof ti)this.addPoint(t);else if(t instanceof ei)this.addCollection(t);else if(t instanceof Qe)this.addCollection(t);else if(t instanceof Ze)this.addCollection(t);else if(t instanceof ht)this.addCollection(t);else throw new te(t.getGeometryType())}addCurve(t,e,i){if(t===null||t.length<2)return null;const r=new Xt(t,new dt(0,u.BOUNDARY,e,i));this._curveList.add(r)}getCurves(){return this.add(this._inputGeom),this._curveList}isErodedCompletely(t,e){const i=t.getCoordinates();if(i.length<4)return e<0;if(i.length===4)return this.isTriangleErodedCompletely(i,e);const r=t.getEnvelopeInternal(),n=Math.min(r.getHeight(),r.getWidth());return e<0&&2*Math.abs(e)>n}addCollection(t){for(let e=0;e<t.getNumGeometries();e++){const i=t.getGeometryN(e);this.add(i)}}}class pg{locate(t){}}class bi{constructor(){bi.constructor_.apply(this,arguments)}static constructor_(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;const t=arguments[0];this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()}static isAtomic(t){return!(t instanceof ht)}next(){if(this._atStart)return this._atStart=!1,bi.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new si;const t=this._parent.getGeometryN(this._index++);return t instanceof ht?(this._subcollectionIterator=new bi(t),this._subcollectionIterator.next()):t}hasNext(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}remove(){throw new te(this.getClass().getName())}get interfaces_(){return[Wl]}}class At{constructor(){At.constructor_.apply(this,arguments)}static constructor_(){this._geom=null;const t=arguments[0];this._geom=t}static locatePointInPolygon(t,e){if(e.isEmpty())return u.EXTERIOR;const i=e.getExteriorRing(),r=At.locatePointInRing(t,i);if(r!==u.INTERIOR)return r;for(let n=0;n<e.getNumInteriorRing();n++){const s=e.getInteriorRingN(n),a=At.locatePointInRing(t,s);if(a===u.BOUNDARY)return u.BOUNDARY;if(a===u.INTERIOR)return u.EXTERIOR}return u.INTERIOR}static locatePointInRing(t,e){return e.getEnvelopeInternal().intersects(t)?Ri.locateInRing(t,e.getCoordinates()):u.EXTERIOR}static isContained(t,e){return u.EXTERIOR!==At.locate(t,e)}static locate(t,e){return e.isEmpty()||!e.getEnvelopeInternal().intersects(t)?u.EXTERIOR:At.locateInGeometry(t,e)}static containsPointInPolygon(t,e){return u.EXTERIOR!==At.locatePointInPolygon(t,e)}static locateInGeometry(t,e){if(e instanceof Ce)return At.locatePointInPolygon(t,e);if(e instanceof ht){const i=new bi(e);for(;i.hasNext();){const r=i.next();if(r!==e){const n=At.locateInGeometry(t,r);if(n!==u.EXTERIOR)return n}}}return u.EXTERIOR}locate(t){return At.locate(t,this._geom)}get interfaces_(){return[pg]}}class zn{constructor(){zn.constructor_.apply(this,arguments)}static constructor_(){this._edgeMap=new me,this._edgeList=null,this._ptInAreaLocation=[u.NONE,u.NONE]}getNextCW(t){this.getEdges();const e=this._edgeList.indexOf(t);let i=e-1;return e===0&&(i=this._edgeList.size()-1),this._edgeList.get(i)}propagateSideLabels(t){let e=u.NONE;for(let r=this.iterator();r.hasNext();){const s=r.next().getLabel();s.isArea(t)&&s.getLocation(t,w.LEFT)!==u.NONE&&(e=s.getLocation(t,w.LEFT))}if(e===u.NONE)return null;let i=e;for(let r=this.iterator();r.hasNext();){const n=r.next(),s=n.getLabel();if(s.getLocation(t,w.ON)===u.NONE&&s.setLocation(t,w.ON,i),s.isArea(t)){const a=s.getLocation(t,w.LEFT),o=s.getLocation(t,w.RIGHT);if(o!==u.NONE){if(o!==i)throw new $t("side location conflict",n.getCoordinate());a===u.NONE&&P.shouldNeverReachHere("found single null side (at "+n.getCoordinate()+")"),i=a}else P.isTrue(s.getLocation(t,w.LEFT)===u.NONE,"found single null side"),s.setLocation(t,w.RIGHT,i),s.setLocation(t,w.LEFT,i)}}}getCoordinate(){const t=this.iterator();return t.hasNext()?t.next().getCoordinate():null}checkAreaLabelsConsistent(t){const e=this.getEdges();if(e.size()<=0)return!0;const i=e.size()-1,n=e.get(i).getLabel().getLocation(t,w.LEFT);P.isTrue(n!==u.NONE,"Found unlabelled area edge");let s=n;for(let a=this.iterator();a.hasNext();){const c=a.next().getLabel();P.isTrue(c.isArea(t),"Found non-area edge");const h=c.getLocation(t,w.LEFT),d=c.getLocation(t,w.RIGHT);if(h===d||d!==s)return!1;s=h}return!0}findIndex(t){this.iterator();for(let e=0;e<this._edgeList.size();e++)if(this._edgeList.get(e)===t)return e;return-1}iterator(){return this.getEdges().iterator()}getEdges(){return this._edgeList===null&&(this._edgeList=new L(this._edgeMap.values())),this._edgeList}getLocation(t,e,i){return this._ptInAreaLocation[t]===u.NONE&&(this._ptInAreaLocation[t]=At.locate(e,i[t].getGeometry())),this._ptInAreaLocation[t]}toString(){const t=new ki;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append(`
`);for(let e=this.iterator();e.hasNext();){const i=e.next();t.append(i),t.append(`
`)}return t.toString()}computeEdgeEndLabels(t){for(let e=this.iterator();e.hasNext();)e.next().computeLabel(t)}computeLabelling(t){this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);const e=[!1,!1];for(let i=this.iterator();i.hasNext();){const n=i.next().getLabel();for(let s=0;s<2;s++)n.isLine(s)&&n.getLocation(s)===u.BOUNDARY&&(e[s]=!0)}for(let i=this.iterator();i.hasNext();){const r=i.next(),n=r.getLabel();for(let s=0;s<2;s++)if(n.isAnyNull(s)){let a=u.NONE;if(e[s])a=u.EXTERIOR;else{const o=r.getCoordinate();a=this.getLocation(s,o,t)}n.setAllLocationsIfNull(s,a)}}}getDegree(){return this._edgeMap.size()}insertEdgeEnd(t,e){this._edgeMap.put(t,e),this._edgeList=null}print(t){Pt.out.println("EdgeEndStar:   "+this.getCoordinate());for(let e=this.iterator();e.hasNext();)e.next().print(t)}isAreaLabelsConsistent(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}}class Vn extends zn{constructor(){super(),Vn.constructor_.apply(this,arguments)}static constructor_(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}linkResultDirectedEdges(){this.getResultAreaEdges();let t=null,e=null,i=this._SCANNING_FOR_INCOMING;for(let r=0;r<this._resultAreaEdgeList.size();r++){const n=this._resultAreaEdgeList.get(r),s=n.getSym();if(n.getLabel().isArea())switch(t===null&&n.isInResult()&&(t=n),i){case this._SCANNING_FOR_INCOMING:if(!s.isInResult())continue;e=s,i=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!n.isInResult())continue;e.setNext(n),i=this._SCANNING_FOR_INCOMING;break}}if(i===this._LINKING_TO_OUTGOING){if(t===null)throw new $t("no outgoing dirEdge found",this.getCoordinate());P.isTrue(t.isInResult(),"unable to link last incoming dirEdge"),e.setNext(t)}}insert(t){const e=t;this.insertEdgeEnd(e,e)}getRightmostEdge(){const t=this.getEdges(),e=t.size();if(e<1)return null;const i=t.get(0);if(e===1)return i;const r=t.get(e-1),n=i.getQuadrant(),s=r.getQuadrant();return q.isNorthern(n)&&q.isNorthern(s)?i:!q.isNorthern(n)&&!q.isNorthern(s)?r:i.getDy()!==0?i:r.getDy()!==0?r:(P.shouldNeverReachHere("found two horizontal edges incident on node"),null)}updateLabelling(t){for(let e=this.iterator();e.hasNext();){const r=e.next().getLabel();r.setAllLocationsIfNull(0,t.getLocation(0)),r.setAllLocationsIfNull(1,t.getLocation(1))}}linkAllDirectedEdges(){this.getEdges();let t=null,e=null;for(let i=this._edgeList.size()-1;i>=0;i--){const r=this._edgeList.get(i),n=r.getSym();e===null&&(e=n),t!==null&&n.setNext(t),t=r}e.setNext(t)}computeDepths(){if(arguments.length===1){const t=arguments[0],e=this.findIndex(t),i=t.getDepth(w.LEFT),r=t.getDepth(w.RIGHT),n=this.computeDepths(e+1,this._edgeList.size(),i);if(this.computeDepths(0,e,n)!==r)throw new $t("depth mismatch at "+t.getCoordinate())}else if(arguments.length===3){const t=arguments[0],e=arguments[1];let r=arguments[2];for(let n=t;n<e;n++){const s=this._edgeList.get(n);s.setEdgeDepths(w.RIGHT,r),r=s.getDepth(w.LEFT)}return r}}mergeSymLabels(){for(let t=this.iterator();t.hasNext();){const e=t.next();e.getLabel().merge(e.getSym().getLabel())}}linkMinimalDirectedEdges(t){let e=null,i=null,r=this._SCANNING_FOR_INCOMING;for(let n=this._resultAreaEdgeList.size()-1;n>=0;n--){const s=this._resultAreaEdgeList.get(n),a=s.getSym();switch(e===null&&s.getEdgeRing()===t&&(e=s),r){case this._SCANNING_FOR_INCOMING:if(a.getEdgeRing()!==t)continue;i=a,r=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(s.getEdgeRing()!==t)continue;i.setNextMin(s),r=this._SCANNING_FOR_INCOMING;break}}r===this._LINKING_TO_OUTGOING&&(P.isTrue(e!==null,"found null for first outgoing dirEdge"),P.isTrue(e.getEdgeRing()===t,"unable to link last incoming dirEdge"),i.setNextMin(e))}getOutgoingDegree(){if(arguments.length===0){let t=0;for(let e=this.iterator();e.hasNext();)e.next().isInResult()&&t++;return t}else if(arguments.length===1){const t=arguments[0];let e=0;for(let i=this.iterator();i.hasNext();)i.next().getEdgeRing()===t&&e++;return e}}getLabel(){return this._label}findCoveredLineEdges(){let t=u.NONE;for(let i=this.iterator();i.hasNext();){const r=i.next(),n=r.getSym();if(!r.isLineEdge()){if(r.isInResult()){t=u.INTERIOR;break}if(n.isInResult()){t=u.EXTERIOR;break}}}if(t===u.NONE)return null;let e=t;for(let i=this.iterator();i.hasNext();){const r=i.next(),n=r.getSym();r.isLineEdge()?r.getEdge().setCovered(e===u.INTERIOR):(r.isInResult()&&(e=u.EXTERIOR),n.isInResult()&&(e=u.INTERIOR))}}computeLabelling(t){super.computeLabelling.call(this,t),this._label=new dt(u.NONE);for(let e=this.iterator();e.hasNext();){const n=e.next().getEdge().getLabel();for(let s=0;s<2;s++){const a=n.getLocation(s);(a===u.INTERIOR||a===u.BOUNDARY)&&this._label.setLocation(s,u.INTERIOR)}}}print(t){Pt.out.println("DirectedEdgeStar: "+this.getCoordinate());for(let e=this.iterator();e.hasNext();){const i=e.next();t.print("out "),i.print(t),t.println(),t.print("in "),i.getSym().print(t),t.println()}}getResultAreaEdges(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new L;for(let t=this.iterator();t.hasNext();){const e=t.next();(e.isInResult()||e.getSym().isInResult())&&this._resultAreaEdgeList.add(e)}return this._resultAreaEdgeList}}class fg extends Ia{constructor(){super()}createNode(t){return new Ie(t,new Vn)}}class $e{constructor(){$e.constructor_.apply(this,arguments)}static constructor_(){this._pts=null,this._orientation=null;const t=arguments[0];this._pts=t,this._orientation=$e.orientation(t)}static orientation(t){return W.increasingDirection(t)===1}static compareOriented(t,e,i,r){const n=e?1:-1,s=r?1:-1,a=e?t.length:-1,o=r?i.length:-1;let c=e?0:t.length-1,h=r?0:i.length-1;for(;;){const d=t[c].compareTo(i[h]);if(d!==0)return d;c+=n,h+=s;const m=c===a,p=h===o;if(m&&!p)return-1;if(!m&&p)return 1;if(m&&p)return 0}}compareTo(t){const e=t;return $e.compareOriented(this._pts,this._orientation,e._pts,e._orientation)}get interfaces_(){return[Ct]}}class $n{constructor(){$n.constructor_.apply(this,arguments)}static constructor_(){this._edges=new L,this._ocaMap=new me}print(t){t.print("MULTILINESTRING ( ");for(let e=0;e<this._edges.size();e++){const i=this._edges.get(e);e>0&&t.print(","),t.print("(");const r=i.getCoordinates();for(let n=0;n<r.length;n++)n>0&&t.print(","),t.print(r[n].x+" "+r[n].y);t.println(")")}t.print(")  ")}addAll(t){for(let e=t.iterator();e.hasNext();)this.add(e.next())}findEdgeIndex(t){for(let e=0;e<this._edges.size();e++)if(this._edges.get(e).equals(t))return e;return-1}iterator(){return this._edges.iterator()}getEdges(){return this._edges}get(t){return this._edges.get(t)}findEqualEdge(t){const e=new $e(t.getCoordinates());return this._ocaMap.get(e)}add(t){this._edges.add(t);const e=new $e(t.getCoordinates());this._ocaMap.put(e,t)}}class br{constructor(){br.constructor_.apply(this,arguments)}static constructor_(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;const t=arguments[0];this._li=t}static isAdjacentSegments(t,e){return Math.abs(t-e)===1}isTrivialIntersection(t,e,i,r){if(t===i&&this._li.getIntersectionNum()===1){if(br.isAdjacentSegments(e,r))return!0;if(t.isClosed()){const n=t.size()-1;if(e===0&&r===n||r===0&&e===n)return!0}}return!1}getProperIntersectionPoint(){return this._properIntersectionPoint}hasProperInteriorIntersection(){return this._hasProperInterior}getLineIntersector(){return this._li}hasProperIntersection(){return this._hasProper}processIntersections(t,e,i,r){if(t===i&&e===r)return null;this.numTests++;const n=t.getCoordinates()[e],s=t.getCoordinates()[e+1],a=i.getCoordinates()[r],o=i.getCoordinates()[r+1];this._li.computeIntersection(n,s,a,o),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(t,e,i,r)||(this._hasIntersection=!0,t.addIntersections(this._li,e,0),i.addIntersections(this._li,r,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}hasIntersection(){return this._hasIntersection}isDone(){return!1}hasInteriorIntersection(){return this._hasInterior}get interfaces_(){return[Ca]}}class Gn{constructor(){Gn.constructor_.apply(this,arguments)}static constructor_(){this.coord=null,this.segmentIndex=null,this.dist=null;const t=arguments[0],e=arguments[1],i=arguments[2];this.coord=new f(t),this.segmentIndex=e,this.dist=i}getSegmentIndex(){return this.segmentIndex}getCoordinate(){return this.coord}print(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)}compareTo(t){const e=t;return this.compare(e.segmentIndex,e.dist)}isEndPoint(t){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===t}toString(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}getDistance(){return this.dist}compare(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0}get interfaces_(){return[Ct]}}class Bn{constructor(){Bn.constructor_.apply(this,arguments)}static constructor_(){this._nodeMap=new me,this.edge=null;const t=arguments[0];this.edge=t}print(t){t.println("Intersections:");for(let e=this.iterator();e.hasNext();)e.next().print(t)}addEndpoints(){const t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)}createSplitEdge(t,e){let i=e.segmentIndex-t.segmentIndex+2;const r=this.edge.pts[e.segmentIndex],n=e.dist>0||!e.coord.equals2D(r);n||i--;const s=new Array(i).fill(null);let a=0;s[a++]=new f(t.coord);for(let o=t.segmentIndex+1;o<=e.segmentIndex;o++)s[a++]=this.edge.pts[o];return n&&(s[a]=e.coord),new he(s,new dt(this.edge._label))}add(t,e,i){const r=new Gn(t,e,i),n=this._nodeMap.get(r);return n!==null?n:(this._nodeMap.put(r,r),r)}isIntersection(t){for(let e=this.iterator();e.hasNext();)if(e.next().coord.equals(t))return!0;return!1}iterator(){return this._nodeMap.values().iterator()}addSplitEdges(t){this.addEndpoints();const e=this.iterator();let i=e.next();for(;e.hasNext();){const r=e.next(),n=this.createSplitEdge(i,r);t.add(n),i=r}}}class ${constructor(){$.constructor_.apply(this,arguments)}static constructor_(){if(this._matrix=null,arguments.length===0)this._matrix=Array(3).fill().map(()=>Array(3)),this.setAll(y.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){const t=arguments[0];$.constructor_.call(this),this.set(t)}else if(arguments[0]instanceof $){const t=arguments[0];$.constructor_.call(this),this._matrix[u.INTERIOR][u.INTERIOR]=t._matrix[u.INTERIOR][u.INTERIOR],this._matrix[u.INTERIOR][u.BOUNDARY]=t._matrix[u.INTERIOR][u.BOUNDARY],this._matrix[u.INTERIOR][u.EXTERIOR]=t._matrix[u.INTERIOR][u.EXTERIOR],this._matrix[u.BOUNDARY][u.INTERIOR]=t._matrix[u.BOUNDARY][u.INTERIOR],this._matrix[u.BOUNDARY][u.BOUNDARY]=t._matrix[u.BOUNDARY][u.BOUNDARY],this._matrix[u.BOUNDARY][u.EXTERIOR]=t._matrix[u.BOUNDARY][u.EXTERIOR],this._matrix[u.EXTERIOR][u.INTERIOR]=t._matrix[u.EXTERIOR][u.INTERIOR],this._matrix[u.EXTERIOR][u.BOUNDARY]=t._matrix[u.EXTERIOR][u.BOUNDARY],this._matrix[u.EXTERIOR][u.EXTERIOR]=t._matrix[u.EXTERIOR][u.EXTERIOR]}}}static isTrue(t){return t>=0||t===y.TRUE}static matches(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){const t=arguments[0],e=arguments[1];return e===y.SYM_DONTCARE||e===y.SYM_TRUE&&(t>=0||t===y.TRUE)||e===y.SYM_FALSE&&t===y.FALSE||e===y.SYM_P&&t===y.P||e===y.SYM_L&&t===y.L||e===y.SYM_A&&t===y.A}else if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){const t=arguments[0],e=arguments[1];return new $(t).matches(e)}}isIntersects(){return!this.isDisjoint()}set(){if(arguments.length===1){const t=arguments[0];for(let e=0;e<t.length;e++){const i=Math.trunc(e/3),r=e%3;this._matrix[i][r]=y.toDimensionValue(t.charAt(e))}}else if(arguments.length===3){const t=arguments[0],e=arguments[1],i=arguments[2];this._matrix[t][e]=i}}isContains(){return $.isTrue(this._matrix[u.INTERIOR][u.INTERIOR])&&this._matrix[u.EXTERIOR][u.INTERIOR]===y.FALSE&&this._matrix[u.EXTERIOR][u.BOUNDARY]===y.FALSE}isWithin(){return $.isTrue(this._matrix[u.INTERIOR][u.INTERIOR])&&this._matrix[u.INTERIOR][u.EXTERIOR]===y.FALSE&&this._matrix[u.BOUNDARY][u.EXTERIOR]===y.FALSE}isTouches(t,e){return t>e?this.isTouches(e,t):t===y.A&&e===y.A||t===y.L&&e===y.L||t===y.L&&e===y.A||t===y.P&&e===y.A||t===y.P&&e===y.L?this._matrix[u.INTERIOR][u.INTERIOR]===y.FALSE&&($.isTrue(this._matrix[u.INTERIOR][u.BOUNDARY])||$.isTrue(this._matrix[u.BOUNDARY][u.INTERIOR])||$.isTrue(this._matrix[u.BOUNDARY][u.BOUNDARY])):!1}isOverlaps(t,e){return t===y.P&&e===y.P||t===y.A&&e===y.A?$.isTrue(this._matrix[u.INTERIOR][u.INTERIOR])&&$.isTrue(this._matrix[u.INTERIOR][u.EXTERIOR])&&$.isTrue(this._matrix[u.EXTERIOR][u.INTERIOR]):t===y.L&&e===y.L?this._matrix[u.INTERIOR][u.INTERIOR]===1&&$.isTrue(this._matrix[u.INTERIOR][u.EXTERIOR])&&$.isTrue(this._matrix[u.EXTERIOR][u.INTERIOR]):!1}isEquals(t,e){return t!==e?!1:$.isTrue(this._matrix[u.INTERIOR][u.INTERIOR])&&this._matrix[u.INTERIOR][u.EXTERIOR]===y.FALSE&&this._matrix[u.BOUNDARY][u.EXTERIOR]===y.FALSE&&this._matrix[u.EXTERIOR][u.INTERIOR]===y.FALSE&&this._matrix[u.EXTERIOR][u.BOUNDARY]===y.FALSE}matches(t){if(t.length!==9)throw new F("Should be length 9: "+t);for(let e=0;e<3;e++)for(let i=0;i<3;i++)if(!$.matches(this._matrix[e][i],t.charAt(3*e+i)))return!1;return!0}add(t){for(let e=0;e<3;e++)for(let i=0;i<3;i++)this.setAtLeast(e,i,t.get(e,i))}isDisjoint(){return this._matrix[u.INTERIOR][u.INTERIOR]===y.FALSE&&this._matrix[u.INTERIOR][u.BOUNDARY]===y.FALSE&&this._matrix[u.BOUNDARY][u.INTERIOR]===y.FALSE&&this._matrix[u.BOUNDARY][u.BOUNDARY]===y.FALSE}isCrosses(t,e){return t===y.P&&e===y.L||t===y.P&&e===y.A||t===y.L&&e===y.A?$.isTrue(this._matrix[u.INTERIOR][u.INTERIOR])&&$.isTrue(this._matrix[u.INTERIOR][u.EXTERIOR]):t===y.L&&e===y.P||t===y.A&&e===y.P||t===y.A&&e===y.L?$.isTrue(this._matrix[u.INTERIOR][u.INTERIOR])&&$.isTrue(this._matrix[u.EXTERIOR][u.INTERIOR]):t===y.L&&e===y.L?this._matrix[u.INTERIOR][u.INTERIOR]===0:!1}isCovers(){return($.isTrue(this._matrix[u.INTERIOR][u.INTERIOR])||$.isTrue(this._matrix[u.INTERIOR][u.BOUNDARY])||$.isTrue(this._matrix[u.BOUNDARY][u.INTERIOR])||$.isTrue(this._matrix[u.BOUNDARY][u.BOUNDARY]))&&this._matrix[u.EXTERIOR][u.INTERIOR]===y.FALSE&&this._matrix[u.EXTERIOR][u.BOUNDARY]===y.FALSE}isCoveredBy(){return($.isTrue(this._matrix[u.INTERIOR][u.INTERIOR])||$.isTrue(this._matrix[u.INTERIOR][u.BOUNDARY])||$.isTrue(this._matrix[u.BOUNDARY][u.INTERIOR])||$.isTrue(this._matrix[u.BOUNDARY][u.BOUNDARY]))&&this._matrix[u.INTERIOR][u.EXTERIOR]===y.FALSE&&this._matrix[u.BOUNDARY][u.EXTERIOR]===y.FALSE}setAtLeast(){if(arguments.length===1){const t=arguments[0];for(let e=0;e<t.length;e++){const i=Math.trunc(e/3),r=e%3;this.setAtLeast(i,r,y.toDimensionValue(t.charAt(e)))}}else if(arguments.length===3){const t=arguments[0],e=arguments[1],i=arguments[2];this._matrix[t][e]<i&&(this._matrix[t][e]=i)}}setAtLeastIfValid(t,e,i){t>=0&&e>=0&&this.setAtLeast(t,e,i)}toString(){const t=new Mr("123456789");for(let e=0;e<3;e++)for(let i=0;i<3;i++)t.setCharAt(3*e+i,y.toDimensionSymbol(this._matrix[e][i]));return t.toString()}setAll(t){for(let e=0;e<3;e++)for(let i=0;i<3;i++)this._matrix[e][i]=t}get(t,e){return this._matrix[t][e]}transpose(){let t=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=t,t=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=t,t=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=t,this}get interfaces_(){return[Ti]}}class Ft{constructor(){Ft.constructor_.apply(this,arguments)}static constructor_(){this._depth=Array(2).fill().map(()=>Array(3));for(let t=0;t<2;t++)for(let e=0;e<3;e++)this._depth[t][e]=Ft.NULL_VALUE}static depthAtLocation(t){return t===u.EXTERIOR?0:t===u.INTERIOR?1:Ft.NULL_VALUE}getDepth(t,e){return this._depth[t][e]}setDepth(t,e,i){this._depth[t][e]=i}isNull(){if(arguments.length===0){for(let t=0;t<2;t++)for(let e=0;e<3;e++)if(this._depth[t][e]!==Ft.NULL_VALUE)return!1;return!0}else if(arguments.length===1){const t=arguments[0];return this._depth[t][1]===Ft.NULL_VALUE}else if(arguments.length===2){const t=arguments[0],e=arguments[1];return this._depth[t][e]===Ft.NULL_VALUE}}normalize(){for(let t=0;t<2;t++)if(!this.isNull(t)){let e=this._depth[t][1];this._depth[t][2]<e&&(e=this._depth[t][2]),e<0&&(e=0);for(let i=1;i<3;i++){let r=0;this._depth[t][i]>e&&(r=1),this._depth[t][i]=r}}}getDelta(t){return this._depth[t][w.RIGHT]-this._depth[t][w.LEFT]}getLocation(t,e){return this._depth[t][e]<=0?u.EXTERIOR:u.INTERIOR}toString(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}add(){if(arguments.length===1){const t=arguments[0];for(let e=0;e<2;e++)for(let i=1;i<3;i++){const r=t.getLocation(e,i);(r===u.EXTERIOR||r===u.INTERIOR)&&(this.isNull(e,i)?this._depth[e][i]=Ft.depthAtLocation(r):this._depth[e][i]+=Ft.depthAtLocation(r))}}else if(arguments.length===3){const t=arguments[0],e=arguments[1];arguments[2]===u.INTERIOR&&this._depth[t][e]++}}}Ft.NULL_VALUE=-1;class vr{constructor(){vr.constructor_.apply(this,arguments)}static constructor_(){if(this._data=null,this._size=0,arguments.length===0)vr.constructor_.call(this,10);else if(arguments.length===1){const t=arguments[0];this._data=new Array(t).fill(null)}}size(){return this._size}addAll(t){if(t===null||t.length===0)return null;this.ensureCapacity(this._size+t.length),Pt.arraycopy(t,0,this._data,this._size,t.length),this._size+=t.length}ensureCapacity(t){if(t<=this._data.length)return null;const e=Math.max(t,this._data.length*2);this._data=_e.copyOf(this._data,e)}toArray(){const t=new Array(this._size).fill(null);return Pt.arraycopy(this._data,0,t,0,this._size),t}add(t){this.ensureCapacity(this._size+1),this._data[this._size]=t,++this._size}}class Un{static toIntArray(t){const e=new Array(t.size()).fill(null);for(let i=0;i<e.length;i++)e[i]=t.get(i).intValue();return e}findChainEnd(t,e){const i=q.quadrant(t[e],t[e+1]);let r=e+1;for(;r<t.length&&q.quadrant(t[r-1],t[r])===i;)r++;return r-1}OLDgetChainStartIndices(t){let e=0;const i=new L;i.add(e);do{const n=this.findChainEnd(t,e);i.add(n),e=n}while(e<t.length-1);return Un.toIntArray(i)}getChainStartIndices(t){let e=0;const i=new vr(Math.trunc(t.length/2));i.add(e);do{const r=this.findChainEnd(t,e);i.add(r),e=r}while(e<t.length-1);return i.toArray()}}class jn{constructor(){jn.constructor_.apply(this,arguments)}static constructor_(){this.e=null,this.pts=null,this.startIndex=null;const t=arguments[0];this.e=t,this.pts=t.getCoordinates();const e=new Un;this.startIndex=e.getChainStartIndices(this.pts)}getCoordinates(){return this.pts}getMaxX(t){const e=this.pts[this.startIndex[t]].x,i=this.pts[this.startIndex[t+1]].x;return e>i?e:i}getMinX(t){const e=this.pts[this.startIndex[t]].x,i=this.pts[this.startIndex[t+1]].x;return e<i?e:i}computeIntersectsForChain(){if(arguments.length===4){const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[i],e.startIndex[i+1],r)}else if(arguments.length===6){const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3],n=arguments[4],s=arguments[5];if(e-t===1&&n-r===1)return s.addIntersections(this.e,t,i.e,r),null;if(!this.overlaps(t,e,i,r,n))return null;const a=Math.trunc((t+e)/2),o=Math.trunc((r+n)/2);t<a&&(r<o&&this.computeIntersectsForChain(t,a,i,r,o,s),o<n&&this.computeIntersectsForChain(t,a,i,o,n,s)),a<e&&(r<o&&this.computeIntersectsForChain(a,e,i,r,o,s),o<n&&this.computeIntersectsForChain(a,e,i,o,n,s))}}overlaps(t,e,i,r,n){return A.intersects(this.pts[t],this.pts[e],i.pts[r],i.pts[n])}getStartIndexes(){return this.startIndex}computeIntersects(t,e){for(let i=0;i<this.startIndex.length-1;i++)for(let r=0;r<t.startIndex.length-1;r++)this.computeIntersectsForChain(i,t,r,e)}}class he extends Or{constructor(){super(),he.constructor_.apply(this,arguments)}static constructor_(){if(this.pts=null,this._env=null,this.eiList=new Bn(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Ft,this._depthDelta=0,arguments.length===1){const t=arguments[0];he.constructor_.call(this,t,null)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this.pts=t,this._label=e}}static updateIM(){if(arguments.length===2&&arguments[1]instanceof $&&arguments[0]instanceof dt){const t=arguments[0],e=arguments[1];e.setAtLeastIfValid(t.getLocation(0,w.ON),t.getLocation(1,w.ON),1),t.isArea()&&(e.setAtLeastIfValid(t.getLocation(0,w.LEFT),t.getLocation(1,w.LEFT),2),e.setAtLeastIfValid(t.getLocation(0,w.RIGHT),t.getLocation(1,w.RIGHT),2))}else return super.updateIM.apply(this,arguments)}getDepth(){return this._depth}getCollapsedEdge(){const t=new Array(2).fill(null);return t[0]=this.pts[0],t[1]=this.pts[1],new he(t,dt.toLineLabel(this._label))}setIsolated(t){this._isIsolated=t}setName(t){this._name=t}equals(t){if(!(t instanceof he))return!1;const e=t;if(this.pts.length!==e.pts.length)return!1;let i=!0,r=!0,n=this.pts.length;for(let s=0;s<this.pts.length;s++)if(this.pts[s].equals2D(e.pts[s])||(i=!1),this.pts[s].equals2D(e.pts[--n])||(r=!1),!i&&!r)return!1;return!0}getCoordinate(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){const t=arguments[0];return this.pts[t]}}isClosed(){return this.pts[0].equals(this.pts[this.pts.length-1])}getMaximumSegmentIndex(){return this.pts.length-1}setDepthDelta(t){this._depthDelta=t}getEdgeIntersectionList(){return this.eiList}addIntersections(t,e,i){for(let r=0;r<t.getIntersectionNum();r++)this.addIntersection(t,e,i,r)}isIsolated(){return this._isIsolated}getCoordinates(){return this.pts}print(t){t.print("edge "+this._name+": "),t.print("LINESTRING (");for(let e=0;e<this.pts.length;e++)e>0&&t.print(","),t.print(this.pts[e].x+" "+this.pts[e].y);t.print(")  "+this._label+" "+this._depthDelta)}computeIM(t){he.updateIM(this._label,t)}isCollapsed(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])}getDepthDelta(){return this._depthDelta}getNumPoints(){return this.pts.length}printReverse(t){t.print("edge "+this._name+": ");for(let e=this.pts.length-1;e>=0;e--)t.print(this.pts[e]+" ");t.println("")}getMonotoneChainEdge(){return this._mce===null&&(this._mce=new jn(this)),this._mce}getEnvelope(){if(this._env===null){this._env=new A;for(let t=0;t<this.pts.length;t++)this._env.expandToInclude(this.pts[t])}return this._env}addIntersection(t,e,i,r){const n=new f(t.getIntersection(r));let s=e,a=t.getEdgeDistance(i,r);const o=s+1;if(o<this.pts.length){const c=this.pts[o];n.equals2D(c)&&(s=o,a=0)}this.eiList.add(n,s,a)}toString(){const t=new Mr;t.append("edge "+this._name+": "),t.append("LINESTRING (");for(let e=0;e<this.pts.length;e++)e>0&&t.append(","),t.append(this.pts[e].x+" "+this.pts[e].y);return t.append(")  "+this._label+" "+this._depthDelta),t.toString()}isPointwiseEqual(t){if(this.pts.length!==t.pts.length)return!1;for(let e=0;e<this.pts.length;e++)if(!this.pts[e].equals2D(t.pts[e]))return!1;return!0}}class Ge{constructor(){Ge.constructor_.apply(this,arguments)}static constructor_(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new $n;const t=arguments[0];this._bufParams=t}static convertSegStrings(t){const e=new nt,i=new L;for(;t.hasNext();){const r=t.next(),n=e.createLineString(r.getCoordinates());i.add(n)}return e.buildGeometry(i)}static depthDelta(t){const e=t.getLocation(0,w.LEFT),i=t.getLocation(0,w.RIGHT);return e===u.INTERIOR&&i===u.EXTERIOR?1:e===u.EXTERIOR&&i===u.INTERIOR?-1:0}createEmptyResultGeometry(){return this._geomFact.createPolygon()}getNoder(t){if(this._workingNoder!==null)return this._workingNoder;const e=new Pi,i=new Jt;return i.setPrecisionModel(t),e.setSegmentIntersector(new br(i)),e}buffer(t,e){let i=this._workingPrecisionModel;i===null&&(i=t.getPrecisionModel()),this._geomFact=t.getFactory();const r=new ur(i,this._bufParams),s=new Dn(t,e,r).getCurves();if(s.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(s,i),this._graph=new Dr(new fg),this._graph.addEdges(this._edgeList.getEdges());const a=this.createSubgraphs(this._graph),o=new pr(this._geomFact);this.buildSubgraphs(a,o);const c=o.getPolygons();return c.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(c)}computeNodedEdges(t,e){const i=this.getNoder(e);i.computeNodes(t);const r=i.getNodedSubstrings();for(let n=r.iterator();n.hasNext();){const s=n.next(),a=s.getCoordinates();if(a.length===2&&a[0].equals2D(a[1]))continue;const o=s.getData(),c=new he(s.getCoordinates(),new dt(o));this.insertUniqueEdge(c)}}setNoder(t){this._workingNoder=t}setWorkingPrecisionModel(t){this._workingPrecisionModel=t}insertUniqueEdge(t){const e=this._edgeList.findEqualEdge(t);if(e!==null){const i=e.getLabel();let r=t.getLabel();e.isPointwiseEqual(t)||(r=new dt(t.getLabel()),r.flip()),i.merge(r);const n=Ge.depthDelta(r),a=e.getDepthDelta()+n;e.setDepthDelta(a)}else this._edgeList.add(t),t.setDepthDelta(Ge.depthDelta(t.getLabel()))}buildSubgraphs(t,e){const i=new L;for(let r=t.iterator();r.hasNext();){const n=r.next(),s=n.getRightmostCoordinate(),o=new zr(i).getDepth(s);n.computeDepth(o),n.findResultEdges(),i.add(n),e.add(n.getDirectedEdges(),n.getNodes())}}createSubgraphs(t){const e=new L;for(let i=t.getNodes().iterator();i.hasNext();){const r=i.next();if(!r.isVisited()){const n=new An;n.create(r),e.add(n)}}return ii.sort(e,ii.reverseOrder()),e}}class wt{constructor(){wt.constructor_.apply(this,arguments)}static constructor_(){if(this._argGeom=null,this._distance=null,this._bufParams=new N,this._resultGeometry=null,this._saveException=null,arguments.length===1){const t=arguments[0];this._argGeom=t}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this._argGeom=t,this._bufParams=e}}static bufferOp(){if(arguments.length===2){const t=arguments[0],e=arguments[1];return new wt(t).getResultGeometry(e)}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof k&&typeof arguments[1]=="number"){const t=arguments[0],e=arguments[1],i=arguments[2],r=new wt(t);return r.setQuadrantSegments(i),r.getResultGeometry(e)}else if(arguments[2]instanceof N&&arguments[0]instanceof k&&typeof arguments[1]=="number"){const t=arguments[0],e=arguments[1],i=arguments[2];return new wt(t,i).getResultGeometry(e)}}else if(arguments.length===4){const t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3],n=new wt(t);return n.setQuadrantSegments(i),n.setEndCapStyle(r),n.getResultGeometry(e)}}static precisionScaleFactor(t,e,i){const r=t.getEnvelopeInternal(),n=Ee.max(Math.abs(r.getMaxX()),Math.abs(r.getMaxY()),Math.abs(r.getMinX()),Math.abs(r.getMinY())),s=e>0?e:0,a=n+2*s,o=Math.trunc(Math.log(a)/Math.log(10)+1),c=i-o;return Math.pow(10,c)}bufferFixedPrecision(t){const e=new gr(new Pn(new j(1)),t.getScale()),i=new Ge(this._bufParams);i.setWorkingPrecisionModel(t),i.setNoder(e),this._resultGeometry=i.buffer(this._argGeom,this._distance)}bufferReducedPrecision(){if(arguments.length===0){for(let t=wt.MAX_PRECISION_DIGITS;t>=0;t--){try{this.bufferReducedPrecision(t)}catch(e){if(e instanceof $t)this._saveException=e;else throw e}finally{}if(this._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){const t=arguments[0],e=wt.precisionScaleFactor(this._argGeom,this._distance,t),i=new j(e);this.bufferFixedPrecision(i)}}bufferOriginalPrecision(){try{const t=new Ge(this._bufParams);this._resultGeometry=t.buffer(this._argGeom,this._distance)}catch(t){if(t instanceof Nt)this._saveException=t;else throw t}finally{}}getResultGeometry(t){return this._distance=t,this.computeGeometry(),this._resultGeometry}setEndCapStyle(t){this._bufParams.setEndCapStyle(t)}computeGeometry(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;const t=this._argGeom.getFactory().getPrecisionModel();t.getType()===j.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()}setQuadrantSegments(t){this._bufParams.setQuadrantSegments(t)}}wt.CAP_ROUND=N.CAP_ROUND;wt.CAP_BUTT=N.CAP_FLAT;wt.CAP_FLAT=N.CAP_FLAT;wt.CAP_SQUARE=N.CAP_SQUARE;wt.MAX_PRECISION_DIGITS=12;class bg extends Y{constructor(){super("cross-section-settings");l(this,"template",()=>_`<style>
#panel{height:100%;overflow:auto;min-width:20rem}#content{background:var(--bkg-color);padding:1.5rem;margin:0}#content .message{text-align:center;width:100%}#content .message *{margin:.25rem}#content div.option{margin-top:.5rem;display:flex;justify-content:space-between}.text-label,h3{color:var(--text-color)}.scrollable-table-container{width:100%;max-height:200px;overflow-y:auto;display:block}.scrollable-table{width:100%;border-collapse:collapse}.table-cell{border:none;padding:4px 2px}.sticky-header{position:sticky;top:0;z-index:1;background-color:#f1f1f1;padding:5px 2px;border:none}.cell{flex:1 1 100px;min-width:100px;max-width:100%}input{background-color:var(--bkg-color);color:var(--text-color);border-radius:3px;outline:0;border:solid 1px var(--text-color)}.btn-group{margin:5px 0}.btn-group-flex{display:flex;flex-direction:row;gap:.5rem;margin:.5rem auto}.btn-group-flex>button,.btn-group-flex>input,.btn-group-flex>select{flex:50%}.btn-group-flex>label{flex:50%;text-align:right}.btn-group-flex label:after{content:' :'}.btn-group-inline{display:inline;gap:5px;margin:10px auto}.btn-group-grid{display:grid;gap:5px;margin:10px auto}.reset-btn{width:22px;background-color:var(--bkg-color);color:var(--text-color);border:none;border-radius:50%;padding:0;margin:2px;display:flex;justify-content:center;align-items:center}.reset-btn img{object-fit:contain}.reset-btn:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.action-btn{color:#fff;background-color:none;border-radius:50%;padding:2px;margin:2px}.action-btn:hover{background-color:var(--bkg-color-grad1);border-radius:50%;cursor:pointer}
</style><style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style>
<div id="panel">
  <div id="content">
    <!-- DRAW/DELETE CROSS SECTION BUTTONS -->
    <div class="btn-group-flex">
      <button
        id="draw-profile-btn"
        class="${this.crossSectionState.drawProfile?"gg-button active":"gg-button"}"
        title="${this.i18nManager.getTranslation("draw_profile_help")}"
        onclick="${()=>this.toggleLineDraw()}"
        i18n="draw_profile">
        Draw
      </button>
      <button
        id="delete-profile-btn"
        class="gg-button"
        title="${this.i18nManager.getTranslation("delete_help")}"
        onclick="${()=>this.deleteProfile()}"
        i18n="delete">
        Delete
      </button>
    </div>

    <!-- CROSS SECTION WIDTH BUTTON -->
    <div class="btn-group-flex">
      <label for="section-width-btn" i18n="profile_width" class="gg-label">Width [m]</label>
      <input
        id="section-width-btn"
        class="gg-input"
        type="number"
        value="${this.crossSectionState.sectionWidthSettings.value}"
        min="${this.crossSectionState.sectionWidthSettings.min}"
        max="${this.crossSectionState.sectionWidthSettings.max}"
        step="${this.crossSectionState.sectionWidthSettings.step}"
        oninput="${e=>this.setSectionWidth(parseFloat(e.target.value))}" />
    </div>

    <!-- MAP/CROSS SECTION VIEW SYNC BUTTONS -->
    <div class="btn-group-flex">
      <button
        id="reset-zoom-btn"
        class="gg-button"
        title="${this.i18nManager.getTranslation("profile_reset_view_help")}"
        onclick="${()=>this.resetZoom()}"
        i18n="profile_reset_view">
        Reset view
      </button>
      <button
        id="sync-views-btn"
        class="${this.crossSectionState.syncViews?"gg-button active":"gg-button"}"
        title="${this.i18nManager.getTranslation("profile_sync_view_help")}"
        onclick="${()=>this.setViewSync(!this.crossSectionState.syncViews)}"
        i18n="profile_sync_view">
        Sync. views
      </button>
    </div>

    <!-- TRANSLATE PROFILE BUTTONS -->
    <div class="btn-group-flex">
      <button
        class="gg-icon-button gg-big"
        title="${this.i18nManager.getTranslation("profile_shift_up_help")}"
        onclick="${()=>this.shiftLinestring([0,this.crossSectionState.linestringShift])}"
        i18n="">
        <img src="icons/arrow_up.svg" alt="${this.i18nManager.getTranslation("profile_shift_up_help")}" />
      </button>
      <button
        class="gg-icon-button gg-big"
        title="${this.i18nManager.getTranslation("profile_shift_down_help")}"
        onclick="${()=>this.shiftLinestring([0,-this.crossSectionState.linestringShift])}"
        i18n="">
        <img src="icons/arrow_down.svg" alt="${this.i18nManager.getTranslation("profile_shift_down_help")}" />
      </button>
      <button
        class="gg-icon-button gg-big"
        title="${this.i18nManager.getTranslation("profile_shift_left_help")}"
        onclick="${()=>this.shiftLinestring([-this.crossSectionState.linestringShift,0])}"
        i18n="">
        <img src="icons/arrow_left.svg" alt="${this.i18nManager.getTranslation("profile_shift_left_help")}" />
      </button>
      <button
        class="gg-icon-button gg-big"
        title="${this.i18nManager.getTranslation("profile_shift_right_help")}"
        onclick="${()=>this.shiftLinestring([this.crossSectionState.linestringShift,0])}"
        i18n="">
        <img src="icons/arrow_right.svg" alt="${this.i18nManager.getTranslation("profile_shift_right_help")}" />
      </button>
    </div>

    <div class="btn-group-flex">
      <div class="cell">
        <label for="z-ratio-btn" class="gg-label">
          ${this.i18nManager.getTranslation("profile_exaggeration")}
          (${this.crossSectionState.verticalExaggerationSettings.value})</label
        >
        <div style="display: flex; align-items: center">
          <input
            id="z-ratio-btn"
            type="range"
            class="gg-range"
            min="${this.crossSectionState.verticalExaggerationSettings.min}"
            max="${this.crossSectionState.verticalExaggerationSettings.max}"
            step="${this.crossSectionState.verticalExaggerationSettings.step}"
            value="${this.crossSectionState.verticalExaggerationSettings.value}"
            oninput="${e=>this.setVerticalExaggeration(parseFloat(e.target.value))}"
            style="flex: 1; min-width: 0; box-sizing: border-box" />
          <button
            id="z-ratio-reset-btn"
            class="reset-btn"
            title="${this.i18nManager.getTranslation("profile_exaggeration_reset_help")}"
            onclick="${()=>this.setVerticalExaggeration(this.crossSectionState.verticalExaggerationSettings.default)}">
            <img
              src="icons/restart_alt.svg"
              alt="${this.i18nManager.getTranslation("profile_exaggeration_reset_help")}" />
          </button>
        </div>
      </div>
    </div>

    <div class="btn-group-flex">
      <div class="cell">
        <label for="point-size-label" class="gg-label">
          ${this.i18nManager.getTranslation("profile_point_size")}
          (${this.crossSectionState.pointSizeSettings.value})</label
        >
        <div style="display: flex; align-items: center">
          <input
            id="point-size-btn"
            type="range"
            class="gg-range"
            min="${this.crossSectionState.pointSizeSettings.min}"
            max="${this.crossSectionState.pointSizeSettings.max}"
            step="${this.crossSectionState.pointSizeSettings.step}"
            value="${this.crossSectionState.pointSizeSettings.value}"
            oninput="${e=>this.setPointSize(parseFloat(e.target.value))}"
            style="flex: 1; min-width: 0; box-sizing: border-box" />
          <button
            id="point-size-reset-btn"
            class="reset-btn"
            title="${this.i18nManager.getTranslation("profile_point_size_reset_help")}"
            onclick="${()=>this.setPointSize(this.crossSectionState.pointSizeSettings.default)}">
            <img
              src="icons/restart_alt.svg"
              alt="${this.i18nManager.getTranslation("profile_point_size_reset_help")}" />
          </button>
        </div>
      </div>
    </div>

    <h3 i18n="profile_colors">Colors</h3>

    <div class="btn-group-flex">
      <!-- SELECT VARIABLE USED FOR COLORING -->
      <label for="color-variable-btn" i18n="profile_color_by" class="gg-label">Color by</label>
      <select
        id="color-variable-btn"
        class="gg-select"
        oninput="${e=>this.setColorVariable(e.target.value)}">
        <option
          value="uniform"
          i18n="color_option_uniform"
          ?selected="${this.crossSectionState.colorVariable==="uniform"}">
          Single color
        </option>
        <option
          value="natural"
          i18n="color_option_natural"
          ?selected="${this.crossSectionState.colorVariable==="natural"}">
          Natural
        </option>
        <option
          value="intensity"
          i18n="color_option_intensity"
          ?selected="${this.crossSectionState.colorVariable==="intensity"}">
          Intensity
        </option>
        <option
          value="classification"
          i18n="color_option_classification"
          ?selected="${this.crossSectionState.colorVariable==="classification"}">
          Classification
        </option>
      </select>
    </div>

    <div class="btn-group-flex" hidden="${this.crossSectionState.colorVariable!=="intensity"}">
      <!-- SELECT PALETTE  -->
      <label for="sequential-color-btn" i18n="profile_colormap" class="gg-label">Colorscale</label>
      <select
        id="sequential-color-btn"
        class="gg-select"
        oninput="${e=>this.setColorPalette(e.target.value)}">
        <option
          value="spectral"
          ?selected="${this.crossSectionState.colorPalette==="spectral"}"
          i18n="palette_option_spectral">
          Spectral
        </option>
        <option
          value="greys"
          ?selected="${this.crossSectionState.colorPalette==="greys"}"
          i18n="palette_option_greys">
          Greys
        </option>
        <option
          value="blues"
          ?selected="${this.crossSectionState.colorPalette==="blues"}"
          i18n="palette_option_blues">
          Blues
        </option>
        <option
          value="viridis"
          ?selected="${this.crossSectionState.colorPalette==="viridis"}"
          i18n="palette_option_viridis">
          Viridis
        </option>
        <option
          value="magma"
          ?selected="${this.crossSectionState.colorPalette==="magma"}"
          i18n="palette_option_magma">
          Magma
        </option>
      </select>
    </div>

    <div class="btn-group-flex" hidden="${this.crossSectionState.colorVariable!=="uniform"}">
      <!-- SELECT UNIFORM COLOR -->
      <label for="uniform-color-btn" i18n="color_option_uniform" class="gg-label">Uniform color</label>
      <input
        id="uniform-color-btn"
        class="gg-input"
        type="color"
        value="${this.crossSectionState.colorUniform}"
        oninput="${e=>this.setUniformColor(e.target.value)}" />
    </div>

    <!-- SELECT BACKGROUND COLOR -->
    <div class="btn-group-flex">
      <label for="background-color-btn" i18n="profile_background_color" class="gg-label">Background color</label>
      <input
        id="background-color-btn"
        class="gg-input"
        type="color"
        value="${this.crossSectionState.backgroundColor}"
        oninput="${e=>this.setBackgroundColor(e.target.value)}" />
    </div>

    <!-- MEASUREMENTS BUTTONS -->
    <div class="btn-group-flex">
      <button
        id="draw-measurements-btn"
        class="${this.crossSectionState.drawMeasurement?"gg-button active":"gg-button"}"
        title="${this.i18nManager.getTranslation("profile_measurement_help")}"
        onclick="${()=>this.toggleMeasureDraw()}"
        i18n="profile_measurement"
        ?disabled="${!this.crossSectionState.enableMeasurement}">
        Measure
      </button>
      <button
        id="delete-measurements-btn"
        class="gg-button"
        title="${this.i18nManager.getTranslation("profile_delete_measurements_help")}"
        onclick="${()=>this.deleteAllMeasurements()}"
        i18n="profile_delete_measurements">
        Delete all
      </button>
    </div>

    <!-- MEASUREMENTS TABLE -->
    <div class="scrollable-table-container">
      <table id="measurements-table" class="scrollable-table">
        <thead>
          <tr>
            <th class="table-cell sticky-header" style="text-align: center"></th>
            <th class="table-cell sticky-header" style="text-align: right" i18n="profile_table_dist">DIST.</th>
            <th class="table-cell sticky-header" style="text-align: right" i18n="profile_table_slope">SLOPE.</th>
            <th class="table-cell sticky-header" style="text-align: center"></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- DRAW/DELETE MARKERS SECTION -->
    <div class="btn-group-flex">
      <button
        id="draw-markers-btn"
        class="${this.crossSectionState.drawMarker?"gg-button active":"gg-button"}"
        title="${this.i18nManager.getTranslation("profile_draw_markers_help")}"
        onclick="${()=>this.toggleMarkerDraw()}"
        i18n="profile_draw_markers"
        ?disabled="${!this.crossSectionState.enableAnnotation}">
        Annotate
      </button>
      <button
        id="delete-markers-btn"
        class="gg-button"
        title="${this.i18nManager.getTranslation("profile_delete_markers_help")}"
        onclick="${()=>this.deleteAllMarkers()}"
        i18n="profile_delete_markers">
        Delete all
      </button>
    </div>

    <!-- ANNOTATIONS TABLE -->
    <div class="scrollable-table-container">
      <table id="markers-table" class="scrollable-table">
        <thead>
          <tr>
            <th class="sticky-header" style="text-align: center" i18n="profile_table_id">ID</th>
            <th class="sticky-header" style="text-align: right" i18n="profile_table_coord">COORD.</th>
            <th class="sticky-header" style="text-align: center"></th>
            <th class="sticky-header" style="text-align: center"></th>
            <th class="sticky-header" style="text-align: center"></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <h3 i18n="profile_print_title">Print</h3>

    <!-- PRINT BUTTON -->
    <div class="btn-group-flex">
      <select
        id="print-profile-format-btn"
        class="gg-select"
        oninput="${e=>this.setPrintFileFormat(e.target.value)}">
        <option value="svg" i18n="">SVG</option>
      </select>
      <button
        id="print-profile-btn"
        class="gg-button"
        title="${this.i18nManager.getTranslation("profile_print_help")}"
        onclick="${()=>this.printPlot(this.crossSectionState.printFileFormat)}"
        i18n="profile_print">
        Print
      </button>
    </div>

    <h3 i18n="profile_download_title">Downloads</h3>

    <!-- MARKERS DOWNLOAD BUTTON -->
    <div class="text-label" i18n="profile_markers_download">Markers</div>
    <div class="btn-group-flex">
      <select
        id="download-markers-format-btn"
        class="gg-select"
        oninput="${e=>this.setAnnotationsFileFormat(e.target.value)}">
        <option value="kml" i18n="">KML</option>
        <option value="geojson" i18n="">GeoJSON</option>
        <option value="gpx" i18n="">GPX</option>
      </select>
      <button
        id="download-markers-btn"
        class="gg-button"
        title="${this.i18nManager.getTranslation("download_help")}"
        onclick="${()=>this.exportFeature(this.points,"markers",this.crossSectionState.downloadAnnotationsFormat)}"
        i18n="download"
        ?disabled="${!this.crossSectionState.enableAnnotationsDownload}">
        Download
      </button>
    </div>

    <!-- LINESTRING DOWNLOAD BUTTON -->
    <div class="text-label" i18n="profile_linestring_download">Profile line</div>
    <div class="btn-group-flex">
      <select
        id="download-linestring-format-btn"
        class="gg-select"
        oninput="${e=>this.setLineFileFormat(e.target.value)}">
        <option value="kml" i18n="">KML</option>
        <option value="geojson" i18n="">GeoJSON</option>
        <option value="gpx" i18n="">GPX</option>
      </select>
      <button
        id="download-linestring-btn"
        class="gg-button"
        title="${this.i18nManager.getTranslation("download_help")}"
        onclick="${()=>this.exportFeature([this.linestring],"linestring",this.crossSectionState.downloadLinestringFormat)}"
        i18n="download"
        ?disabled="${!this.crossSectionState.enableLinestringDownload}">
        Download
      </button>
    </div>
  </div>
</div>
`);l(this,"crossSectionState");l(this,"i18nManager");l(this,"eventsCallbacks",[]);l(this,"darkFrontendMode",!1);l(this,"visible",!1);l(this,"map");l(this,"linestring");l(this,"linestringSource");l(this,"linesLayer");l(this,"domainLinestring");l(this,"domainLinestringSource");l(this,"domainLineStringLayer");l(this,"polygon");l(this,"polygonSource");l(this,"polygonLayer");l(this,"pointer");l(this,"pointerSource");l(this,"pointerLayer");l(this,"points");l(this,"pointsSource");l(this,"pointsLayer");l(this,"drawInteraction");l(this,"modifyInteraction");l(this,"linestringLength",0);l(this,"markersTable",null);l(this,"measurementsTable",null);l(this,"parser",new Yl);l(this,"iconStyle",new ar({image:new Lo({color:"#FF8C00",anchor:[.5,.5],anchorXUnits:"fraction",anchorYUnits:"fraction",src:"icons/adjust.svg"})}));l(this,"pointStyleFunction",e=>new ar({image:new ta({radius:7,fill:new ce({color:e.get("show")?[255,255,0,.75]:[0,0,0,.75]}),stroke:new cn({color:e.get("show")?"#FF0000":"#000000",width:2})}),text:new hn({text:`${e.get("label")}`,font:"16px sans-serif",textAlign:"center",justify:"center",textBaseline:"middle",placement:"point",fill:new ce({color:[255,255,255,1]}),offsetY:-30,backgroundFill:new ce({color:[0,0,0,1]}),padding:[5,7,5,7]})}));this.state.extendedState.crossSection=new Cl,this.crossSectionState=this.state.extendedState.crossSection,this.i18nManager=Vt.getInstance(),this.map=Kt.getInstance().getMap(),this.parser.inject(Et,ct,ea,oe,xi,qe,He,Hs),this.initializeMapElements()}initializeMapElements(){this.initializeLinestring(),this.initializeDomainLinestring(),this.initializePolygon(),this.initializePointer(),this.initializePointsLayer(),this.initializeInteractions()}initializeLinestring(){this.linestring=new bt({id:"cross-section-linestring",geometry:new ct([])}),this.linestringSource=new ie,this.linestringSource.on("addfeature",e=>{this.handleAddFeature(e)}),this.linesLayer=new Ht({source:this.linestringSource,style:{"fill-color":"rgba(255, 255, 255, 0.2)","stroke-color":"#ff0000","stroke-width":2},properties:{addToPrintedLayers:!0,altitudeMode:"clampToGround"}}),this.map.addLayer(this.linesLayer)}initializeDomainLinestring(){this.domainLinestring=new bt({id:"domainLinestring",geometry:new ct([])}),this.domainLinestringSource=new ie({features:[]}),this.domainLineStringLayer=new Ht({source:this.domainLinestringSource,style:{"stroke-color":"#0000ff","stroke-width":2},properties:{addToPrintedLayers:!0,altitudeMode:"clampToGround"}}),this.map.addLayer(this.domainLineStringLayer)}initializePolygon(){this.polygon=new bt({id:"linestringBuffer",geometry:new oe([])}),this.polygonSource=new ie({features:[]}),this.polygonLayer=new Ht({source:this.polygonSource,style:{"fill-color":"rgba(255, 255, 255, 0.2)","stroke-color":"#ff0000","stroke-width":2},properties:{addToPrintedLayers:!0,altitudeMode:"clampToGround"}}),this.map.addLayer(this.polygonLayer)}initializePointer(){this.pointer=new bt({geometry:new Et([]),style:this.iconStyle}),this.pointerSource=new ie({features:[],wrapX:!1}),this.pointerLayer=new Ht({source:this.pointerSource,style:this.iconStyle,properties:{addToPrintedLayers:!0,altitudeMode:"clampToGround"}}),this.map.addLayer(this.pointerLayer)}initializePointsLayer(){this.points=[],this.pointsSource=new ie({features:this.points,wrapX:!1}),this.pointsLayer=new Ht({source:this.pointsSource,style:this.pointStyleFunction,properties:{addToPrintedLayers:!0,altitudeMode:"clampToGround"}}),this.map.addLayer(this.pointsLayer)}initializeInteractions(){this.initializeDrawInteraction(),this.initializeModifyInteraction()}handleAddFeature(e){var r;const i=(r=e.feature)==null?void 0:r.getGeometry();this.linestring.setGeometry(i),this.crossSectionState.linestringCoordinates=i.getCoordinates()}initializeDrawInteraction(){this.drawInteraction=new ga({source:this.linestringSource,type:"LineString",freehand:!1,condition:e=>yn(e)&&this.canExecute("map.draw")}),this.drawInteraction.on("drawstart",e=>{this.deleteProfile()}),this.drawInteraction.on("drawend",e=>{this.handleAddFeature(e)})}initializeModifyInteraction(){this.modifyInteraction=new ca({source:this.linestringSource,condition:e=>wn(e)&&this.canExecute("map.modify")}),this.modifyInteraction.on("modifystart",e=>{this.polygonSource.clear(),this.domainLinestringSource.clear(),this.pointerSource.clear()}),this.modifyInteraction.on("modifyend",e=>{this.crossSectionState.linestringCoordinates=this.linestring.getGeometry().getCoordinates()})}updateMarkers(e){if(!this.linestring){console.warn("updateMarkers: The cross-section linestring is undefined, unable to update markers");return}const i=this.linestring.getGeometry();this.points.forEach(r=>{var o,c;const n=(o=r.getGeometry())==null?void 0:o.getCoordinates();if(!n){console.warn("updateMarkers: Map point feature coordinate is undefined, unable to update markers");return}const s=(c=e.getGeometry())==null?void 0:c.intersectsCoordinate(n),a=this.crossSectionState.markers.find(h=>h.id==r.get("id"));if(a&&(a.show=s,r.set("show",s),s)){const h=i.getClosestPoint(n);a.x=this.getDistanceAtCoord(i,h)}})}drawLinestringBuffer(){if(this.crossSectionState.linestringCoordinates.length<2)return;if(!this.linestring){console.warn("updateLinestringBuffer: Linestring is undefined, unable to update buffer");return}this.polygonSource.clear();const e=this.linestring.getGeometry(),i=this.parser.read(e),r=new N(N.DEFAULT_QUADRANT_SEGMENTS,N.CAP_FLAT,N.JOIN_MITRE,N.DEFAULT_MITRE_LIMIT),s=new wt(i,r).getResultGeometry(this.crossSectionState.sectionWidthSettings.value),a=this.parser.write(s);this.polygon.setGeometry(a),this.polygonSource.addFeature(this.polygon),this.updateMarkers(this.polygon)}updateLinestringCoordinates(){this.pointerSource.clear(),this.domainLinestringSource.clear(),this.polygonSource.clear(),this.crossSectionState.linestringCoordinates.length>=2?(this.linestring.getGeometry().setCoordinates(this.crossSectionState.linestringCoordinates),this.linestringLength=lt(this.linestring.getGeometry().getCoordinates()),this.drawDomainLinestring(),this.drawLinestringBuffer()):this.linestringSource.clear()}drawDomainLinestring(){if(this.crossSectionState.linestringCoordinates.length<2)return;const e=this.linestring.getGeometry();if(!e){console.warn("drawDomainLinestring: Linestring geometry is undefined, unable to clip");return}if(e.getCoordinates().length<2)return;const i=lt(e.getCoordinates()),r=Math.max(0,this.crossSectionState.domain.xmin/i),n=Math.min(1,this.crossSectionState.domain.xmax/i);if(r>=0&&r<=1&&n>=0&&n<=1){const s=e.getCoordinateAt(r),a=e.getCoordinateAt(n),o=e.getCoordinates(),c=[];c.push(s);for(const h of o){const d=this.getDistanceAtCoord(e,h);d>=this.crossSectionState.domain.xmin&&d<=this.crossSectionState.domain.xmax&&c.push(h)}c.push(a),this.domainLinestring.getGeometry().setCoordinates(c),this.domainLinestringSource.getFeatures().length===0&&this.domainLinestringSource.addFeature(this.domainLinestring),this.crossSectionState.syncViews&&this.map.getView().setCenter(this.domainLinestring.getGeometry().getCoordinateAt(.5))}}getDistanceAtCoord(e,i){const r=e.getCoordinates();let n=0;for(let s=0;s<r.length-1;s++){const a=r[s],o=r[s+1];if(new ct([a,o]).intersectsCoordinate(i)){n+=lt([a,i]);break}n+=lt([a,o])}return n}shiftLinestring(e=[0,0]){this.crossSectionState.linestringCoordinates=this.crossSectionState.linestringCoordinates.map(i=>[i[0]+e[0],i[1]+e[1]])}drawPointer(e){const i=this.pointer.getGeometry();i&&(i.setCoordinates(e),this.pointerSource.getFeatures().length===0&&this.pointerSource.addFeature(this.pointer))}drawMapMarkers(){if(!this.linestring){console.warn("drawMapMarkers: Linestring is undefined, unable to draw markers on map");return}this.points=[],this.crossSectionState.markers.forEach(e=>{if(e.update){const r=this.linestring.getGeometry().getCoordinateAt(e.x/this.linestringLength);e.xm=r[0],e.ym=r[1]}e.update=!1;const i=new bt({geometry:new Et([e.xm,e.ym]),id:e.id,label:e.label,Z:e.y.toFixed(2),size:20,show:e.show});i.setId(e.id),this.points.push(i)}),this.pointsSource.clear(),this.pointsSource.addFeatures(this.points),this.pointsLayer.setSource(this.pointsSource),this.pointsLayer.changed()}addInteractions(){this.map.addInteraction(this.drawInteraction),this.map.addInteraction(this.modifyInteraction)}removeInteractions(){this.map.removeInteraction(this.drawInteraction),this.map.removeInteraction(this.modifyInteraction)}toggleMeasureDraw(){this.crossSectionState.drawMeasurement=!this.crossSectionState.drawMeasurement}toggleMarkerDraw(){this.crossSectionState.drawMarker=!this.crossSectionState.drawMarker}toggleLineDraw(){this.crossSectionState.drawProfile=!this.crossSectionState.drawProfile}setLineDrawingMode(e){this.crossSectionState.drawProfile=e,e?this.addInteractions():this.removeInteractions(),super.render()}setSectionWidth(e){(e<=0||e<this.crossSectionState.sectionWidthSettings.min||e>this.crossSectionState.sectionWidthSettings.max)&&(e=this.crossSectionState.sectionWidthSettings.default,console.warn(`setSectionWidth: Width is not within accepted range [${this.crossSectionState.sectionWidthSettings.min}, ${this.crossSectionState.sectionWidthSettings.max}]. Resetting to default value`)),this.crossSectionState.sectionWidthSettings.value=e}setVerticalExaggeration(e){(e<=0||e<this.crossSectionState.verticalExaggerationSettings.min||e>this.crossSectionState.verticalExaggerationSettings.max)&&(e=this.crossSectionState.verticalExaggerationSettings.default,console.warn(`setVerticalExaggeration: vertical exaggeration is not within accepted range [${this.crossSectionState.verticalExaggerationSettings.min}, ${this.crossSectionState.verticalExaggerationSettings.max}]. Resetting to default value`)),this.crossSectionState.verticalExaggerationSettings.value=e,super.render()}setPointSize(e){(e<=0||e<this.crossSectionState.pointSizeSettings.min||e>this.crossSectionState.pointSizeSettings.max)&&(e=this.crossSectionState.pointSizeSettings.default,console.warn(`setPointSize: point size is not within accepted range [${this.crossSectionState.pointSizeSettings.min}, ${this.crossSectionState.pointSizeSettings.max}]. Resetting to default value`)),this.crossSectionState.pointSizeSettings.value=e,super.render()}setBackgroundColor(e){this.crossSectionState.backgroundColor=e}setUniformColor(e){this.crossSectionState.colorUniform=e}setColorPalette(e){this.crossSectionState.colorPalette=e}setColorVariable(e){this.crossSectionState.colorVariable=e,super.render()}exportFeature(e,i,r){switch(r){case"geojson":{const n=new Ye().writeFeatures(e,{featureProjection:this.state.projection});ye(n,i+".geojson","application/geo+json");break}case"kml":{const n=new _n().writeFeatures(e,{featureProjection:this.state.projection});ye(n,i+".kml","application/vnd.google-earth.kml+xml");break}case"gpx":{const n=new ia().writeFeatures(e,{featureProjection:this.state.projection});ye(n,i+".gpx","application/gpx+xml");break}}}renderMeasurementsTable(e,i){e.tBodies[0].remove();const r=document.createElement("tbody");e.appendChild(r),i.forEach(n=>{const s=this.crossSectionState.markers.find(p=>p.id===n.from),a=this.crossSectionState.markers.find(p=>p.id===n.to),o=r.insertRow(-1);o.id=`row-${n.id}`;const c=o.insertCell(-1);c.classList.add("table-cell"),c.style.setProperty("text-align","center"),c.innerHTML=`${s.label} &rarr; ${a.label}`;let h=o.insertCell(-1);h.classList.add("table-cell"),h.style.setProperty("text-align","right"),h.innerHTML=`${n.distance.toFixed(2)}`,h=o.insertCell(-1),h.classList.add("table-cell"),h.style.setProperty("text-align","right"),h.innerHTML=`${(100*n.slope).toFixed(2)}%`;const d=document.createElement("img");d.title="Copy to clipboard",d.width=20,d.classList.add("action-btn"),d.src="icons/content_copy.svg",d.onclick=p=>{const b=`${n.id}, ${n.from}, ${n.to}, ${n.distance}, ${n.slope}`;navigator.clipboard.writeText(b)};const m=o.insertCell(-1);m.classList.add("table-cell"),m.style.setProperty("text-align","center"),m.appendChild(d)})}renderAnnotationsTable(e,i){e.tBodies[0].remove();const r=document.createElement("tbody");e.appendChild(r),i.forEach(n=>{const s=r.insertRow(-1);s.id=`row-${n.id}`;const a=s.insertCell(-1);a.classList.add("table-cell"),a.style.setProperty("text-align","center"),a.innerHTML=`${n.label}`;const o=s.insertCell(-1);o.classList.add("table-cell"),o.style.setProperty("text-align","right"),o.innerHTML=`${n.xm.toFixed(2)}<br>${n.ym.toFixed(2)}<br>${n.y.toFixed(2)}`;const c=document.createElement("img");c.title="Copy to clipboard",c.width=20,c.classList.add("action-btn"),c.src="icons/content_copy.svg",c.onclick=x=>{const E=`${n.id}, ${n.xm}, ${n.ym}, ${n.y}, ${n.x}`;navigator.clipboard.writeText(E)};const h=s.insertCell(-1);h.classList.add("table-cell"),h.style.setProperty("text-align","center"),h.appendChild(c);const d=document.createElement("img");d.title="Zoom to marker on map",d.width=20,d.classList.add("action-btn"),d.src="icons/loupe.svg",d.onclick=x=>{this.zoomToMarker(`${n.id}`)};const m=s.insertCell(-1);m.classList.add("table-cell"),m.style.setProperty("text-align","center"),m.appendChild(d);const p=document.createElement("img");p.title="Delete marker",p.width=20,p.classList.add("action-btn"),p.src="icons/delete_forever.svg",p.onclick=x=>{this.deleteMarker(n.id)};const b=s.insertCell(-1);b.classList.add("table-cell"),b.style.setProperty("text-align","center"),b.appendChild(p)})}deleteProfile(){this.crossSectionState.linestringCoordinates=[]}deleteMarker(e){const i=this.crossSectionState.markers.findIndex(r=>r.id===e);i!==-1&&this.crossSectionState.markers.splice(i,1)}deleteAllMarkers(){for(let e=this.crossSectionState.markers.length-1;e>=0;e--)this.crossSectionState.markers[e].feature==="marker"&&this.crossSectionState.markers.splice(e,1)}deleteAllMeasurements(){const e=new CustomEvent("delete-measurements",{bubbles:!0,composed:!0});this.dispatchEvent(e)}resetZoom(){this.crossSectionState.zoomUpdate=!0,this.crossSectionState.zoom={k:1,tx:0,ty:0}}zoomToMarker(e){const i=this.map.getView(),r=this.pointsSource.getFeatureById(e);r&&i.fit(r.getGeometry(),{maxZoom:17,size:[200,200]})}setViewSync(e){this.crossSectionState.syncViews=e}printPlot(e){const i=new CustomEvent("print-canvas",{detail:{format:e},bubbles:!0,composed:!0});this.dispatchEvent(i)}setPrintFileFormat(e){this.crossSectionState.printFileFormat=e}setAnnotationsFileFormat(e){this.crossSectionState.downloadAnnotationsFormat=e}setLineFileFormat(e){this.crossSectionState.downloadLinestringFormat=e}handleCursorDomainCoordinatesChange(e){if(this.crossSectionState.linestringCoordinates.length<2){console.warn("handleCursorDomainCoordinatesChange: Linestring coordinates are undefined, unable to update pointer coordinates");return}if(!this.linestring){console.warn("handleCursorDomainCoordinatesChange: Linestring is undefined, unable to update pointer coordinates");return}const i=this.linestring.getGeometry();if(!i){console.warn("handleCursorDomainCoordinatesChange: Linestring geometry is undefined, unable to update pointer coordinates");return}const r=e[0]/this.linestringLength;if(r>=0&&r<=1){const n=i.getCoordinateAt(r);this.drawPointer(n)}else this.pointerSource.clear()}render(){this.visible?this.renderComponent():this.renderEmptyComponent()}renderComponent(){super.render(),super.girafeTranslate(),this.markersTable=this.shadowRoot.getElementById("markers-table"),this.measurementsTable=this.shadowRoot.getElementById("measurements-table"),this.setLineDrawingMode(!0),this.activateTooltips(!1,[800,0],"top-end"),this.registerEvents()}renderEmptyComponent(){this.deleteProfile(),this.removeInteractions(),this.unregisterEvents(),this.renderEmpty()}registerEvents(){this.registerInteractionListener("map.select",!0),this.registerInteractionListener("map.draw",!0),this.registerInteractionListener("map.modify",!0),this.registerInteractionListener("keydown.ArrowUp",!0),this.registerInteractionListener("keydown.ArrowDown",!0),this.registerInteractionListener("keydown.ArrowLeft",!0),this.registerInteractionListener("keydown.ArrowRight",!0),this.eventsCallbacks.push(this.subscribe("interface.darkFrontendMode",(e,i)=>{this.darkFrontendMode=i}),this.subscribe("extendedState.crossSection.drawProfile",(e,i,r)=>{console.debug(`crossSection.drawProfile changed from: ${e} to: ${i}`),this.setLineDrawingMode(i)}),this.subscribe("extendedState.crossSection.enableMeasurement",(e,i,r)=>{console.debug(`crossSection.enableMeasurement changed from: ${e} to: ${i}`),i||(this.crossSectionState.drawMeasurement=!1),super.render()}),this.subscribe("extendedState.crossSection.drawMeasurement",(e,i,r)=>{console.debug(`crossSection.drawMeasurement changed from: ${e} to: ${i}`),super.render()}),this.subscribe("extendedState.crossSection.enableAnnotation",(e,i,r)=>{console.debug(`crossSection.enableAnnotation changed from: ${e} to: ${i}`),i||(this.crossSectionState.drawMarker=!1),super.render()}),this.subscribe("extendedState.crossSection.drawMarker",(e,i,r)=>{console.debug(`crossSection.drawMarker changed from: ${e} to: ${i}`),super.render()}),this.subscribe("extendedState.crossSection.markers",(e,i,r)=>{console.debug(`Settings |crossSection.markers (array length) changed from: ${e} to: ${i}`),!(this.crossSectionState.linestringCoordinates.length<2)&&(i.length===0?this.crossSectionState.enableAnnotationsDownload=!1:this.crossSectionState.enableAnnotationsDownload=!0,this.drawMapMarkers(),this.markersTable&&this.renderAnnotationsTable(this.markersTable,this.crossSectionState.markers),this.measurementsTable&&this.renderMeasurementsTable(this.measurementsTable,this.crossSectionState.measurements))}),this.subscribe(/extendedState\.crossSection\.markers\..*\..*/,(e,i,r)=>{console.debug(`Settings | crossSection.markers (properties) changed from: ${e} to: ${i}`),!(this.crossSectionState.linestringCoordinates.length<2)&&(this.drawMapMarkers(),this.markersTable&&this.renderAnnotationsTable(this.markersTable,this.crossSectionState.markers),this.measurementsTable&&this.renderMeasurementsTable(this.measurementsTable,this.crossSectionState.measurements))}),this.subscribe("extendedState.crossSection.cursorDomainCoordinates",(e,i,r)=>{console.debug(`crossSection.cursorDomainCoordinates changed from: ${e} to: ${i}`),this.handleCursorDomainCoordinatesChange(i)}),this.subscribe("extendedState.crossSection.syncViews",(e,i,r)=>{console.debug(`crossSection.syncViews changed from: ${e} to: ${i}`),super.render()}),this.subscribe("extendedState.crossSection.enableAnnotationsDownload",(e,i,r)=>{console.debug(`crossSection.enableAnnotationsDownload changed from: ${e} to: ${i}`),super.render()}),this.subscribe("extendedState.crossSection.enableLinestringDownload",(e,i,r)=>{console.debug(`crossSection.enableLinestringDownload changed from: ${e} to: ${i}`),super.render()}),this.subscribe("extendedState.crossSection.sectionWidthSettings.value",(e,i)=>{console.debug(`crossSection.sectionWidthSettings.value changed from: ${e} to: ${i}`),this.drawLinestringBuffer(),super.render()}),this.subscribe("extendedState.crossSection.linestringCoordinates",(e,i,r)=>{console.debug(`crossSection.linestringCoordinates changed from: ${e} to: ${i}`);const n=i.length>=2;this.crossSectionState.enableAnnotation=n,this.crossSectionState.enableMeasurement=n,this.crossSectionState.enableLinestringDownload=n,this.updateLinestringCoordinates(),super.render()}),this.subscribe("extendedState.crossSection.domain",(e,i,r)=>{console.debug(`crossSection.domain changed from: ${e} to: ${i}`),this.drawDomainLinestring()})),document.addEventListener("keydown",e=>{e.key==="ArrowUp"&&this.canExecute("keydown.ArrowUp")?this.shiftLinestring([0,this.crossSectionState.linestringShift]):e.key==="ArrowDown"&&this.canExecute("keydown.ArrowDown")?this.shiftLinestring([0,-this.crossSectionState.linestringShift]):e.key==="ArrowLeft"&&this.canExecute("keydown.ArrowLeft")?this.shiftLinestring([-this.crossSectionState.linestringShift,0]):e.key==="ArrowRight"&&this.canExecute("keydown.ArrowRight")&&this.shiftLinestring([this.crossSectionState.linestringShift,0])})}unregisterEvents(){this.unsubscribe(this.eventsCallbacks),this.eventsCallbacks.length=0,this.drawInteraction.un("drawstart",()=>{}),this.drawInteraction.un("drawend",()=>{}),this.modifyInteraction.un("modifystart",()=>{}),this.modifyInteraction.un("modifyend",()=>{})}registerVisibilityEvents(){this.subscribe("interface.crossSectionPanelVisible",(e,i)=>this.togglePanel(i))}async togglePanel(e){this.visible=e,this.render()}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerVisibilityEvents()})}}class qn extends Y{constructor(e,i){super(e);l(this,"gutter");l(this,"closeButton");l(this,"dock");l(this,"prevX",0);l(this,"prevY",0);l(this,"toggleSize",0);l(this,"lastWidth",0);l(this,"minWidth");l(this,"maxWidth");l(this,"lastHeight",0);l(this,"minHeight");l(this,"maxHeight");const r=i??this.getAttribute("dock");if(!r)this.dock="right";else if(r==="left"||r==="right"||r==="bottom")this.dock=r;else throw new Error(`Invalid value for the attribute dock: ${r}. Should be one of [left, right, bottom]`)}render(){this.restoreLastDimensions(),super.render(),this.makeResizable()}makeResizable(){this.gutter=this.shadow.querySelector("#gutter"),this.gutter.onmousedown=e=>this.mousedown(e),this.gutter.ondblclick=()=>this.togglePanelInternal(),this.closeButton=this.shadow.getElementById("close")||void 0,this.closeButton&&(this.closeButton.onclick=()=>this.closePanel()),this.toggleSize=this.dock==="bottom"?this.gutter.getBoundingClientRect().height:this.gutter.getBoundingClientRect().width,this.initSizeLimits()}initSizeLimits(){const e=getComputedStyle(this),i=parseFloat(e.minWidth);this.minWidth=isNaN(i)?void 0:i;const r=parseFloat(e.maxWidth);this.maxWidth=isNaN(r)?void 0:r;const n=parseFloat(e.minHeight);this.minHeight=isNaN(n)?void 0:n;const s=parseFloat(e.maxHeight);this.maxHeight=isNaN(s)?void 0:s}mousedown(e){e.preventDefault(),this.dispatchEvent(new CustomEvent("resize-start")),document.onmousemove=i=>this.mousemove(i),document.onmouseup=()=>this.mouseup(),this.prevX=e.x,this.prevY=e.y,this.lastWidth=parseFloat(getComputedStyle(this).width),this.lastHeight=parseFloat(getComputedStyle(this).height)}mousemove(e){e.preventDefault();const i=this.prevX-e.x,r=this.prevY-e.y;this.dock==="left"?this.resizePanelLeft(i):this.dock==="right"?this.resizePanelRight(i):this.dock==="bottom"&&this.resizePanelBottom(r)}mouseup(){document.onmouseup=null,document.onmousemove=null,this.dispatchEvent(new CustomEvent("resize-end"))}closePanel(){throw new Error("This function must be overriden to close and clean the associated panel")}clean(){this.style.width="",this.style.height=""}restoreLastDimensions(){this.lastWidth&&(this.style.width=this.lastWidth+"px"),this.lastHeight&&(this.style.height=this.lastHeight+"px")}togglePanelInternal(){this.dock==="left"||this.dock==="right"?this.togglePanelVertically():this.togglePanelHorizontally()}togglePanelVertically(){const e=this.getBoundingClientRect().width;e<=this.toggleSize?(this.style.width=this.lastWidth+"px",this.style.minWidth=this.minWidth+"px"):(this.lastWidth=e,this.style.width=this.toggleSize+"px",this.style.minWidth="0")}togglePanelHorizontally(){const e=this.getBoundingClientRect().height;e<=this.toggleSize?(this.style.height=this.lastHeight+"px",this.style.minWidth=this.minHeight+"px"):(this.lastHeight=e,this.style.height=this.toggleSize+"px",this.style.minHeight="0")}getLimitedWidth(e){return this.minWidth&&e<this.minWidth?this.minWidth:this.maxWidth&&e>this.maxWidth?this.maxWidth:e}getLimitedHeight(e){return this.minHeight&&e<this.minHeight?this.minHeight:this.maxHeight&&e>this.maxHeight?this.maxHeight:e}resizePanelLeft(e){const i=this.getLimitedWidth(this.lastWidth-e);this.style.width=i+"px"}resizePanelRight(e){const i=this.getLimitedWidth(this.lastWidth+e);this.style.width=i+"px"}resizePanelBottom(e){const i=this.getLimitedHeight(this.lastHeight+e);this.style.height=i+"px"}}class vg{constructor(t,e,i,r){l(this,"vertexShaderSource",`#version 300 es
                // VERTEX SHADER
                in vec2 vertex_position;
                in vec3 vertex_color;
                // in float vertex_classification;
                out lowp vec3 vert_color;
                // out lowp float vert_classification;

                uniform lowp float point_size;
                uniform vec2 offset;
                uniform vec2 range;
                uniform mat4 matrix;
                void main() {
                    vec2 vertex_position_tr = vec2(
                        2.0 * ((vertex_position.x - offset.x) / range.x) - 1.0,
                        2.0 * ((vertex_position.y - offset.y) / range.y) - 1.0
                    );
                   gl_Position = matrix * vec4( vertex_position_tr, 0.0, 1.0 );
                   vert_color = vertex_color;
                   gl_PointSize = point_size; // vertex_classification
                }`);l(this,"fragmentShaderSource",`#version 300 es
                // FRAGMENT SHADER
                precision lowp float;
                in vec3 vert_color;
                out vec4 color;      
                void main() {
                    color = vec4( vert_color, 1.0 );
                }`);l(this,"boundingBox",{xMin:0,xMax:0,yMin:0,yMax:0});l(this,"pointSize",3);l(this,"groupID",jt());l(this,"measure",!1);l(this,"draw",!1);l(this,"backgroundColor",[1,1,1,1]);l(this,"xGridColor",[0,0,0,1]);l(this,"yGridColor",[0,0,0,1]);l(this,"xDomain",[0,100]);l(this,"yDomain",[0,100]);l(this,"verticalExaggeration",1);l(this,"markers",[]);l(this,"measurements",[]);l(this,"canvasScalingFactor",3);l(this,"cx0",null);l(this,"cy0",null);l(this,"x0",0);l(this,"y0",0);l(this,"parent");l(this,"canvas");l(this,"containerSVG");l(this,"margins");l(this,"xy");l(this,"rgb");l(this,"drag");l(this,"measurementsSVG");l(this,"pointsSVG");l(this,"markerLabelBoxesSVG");l(this,"markerLabelsSVG");l(this,"measurementLabelsSVG");l(this,"zoom");l(this,"xAxis");l(this,"yAxis");l(this,"xGrid");l(this,"yGrid");l(this,"draggedElement");l(this,"cursorMoveEvent");l(this,"domainEvent");l(this,"drawEvent");l(this,"measureEvent");l(this,"gl");l(this,"shaderProgram");l(this,"pointsize_uniform");l(this,"offset_uniform");l(this,"range_uniform");l(this,"matrix_uniform");l(this,"vertex_attrib");l(this,"color_attrib");this.parent=t,this.margins=e,this.xy=i,this.rgb=r,this.initializeD3(),this.initializeWebGL(),this.initializeEvents()}initializeD3(){this.canvas=H(this.parent).append("canvas").attr("id","glcanvas"),this.containerSVG=H(this.parent).append("svg").attr("id","svg-outer").attr("width","100%").attr("height","100%").attr("overflow","visible"),this.containerSVG.append("defs"),this.containerSVG.append("marker").attr("id","dot").attr("refX",10).attr("refY",10).attr("markerWidth",15).attr("markerHeight",15).append("circle").attr("cx",10).attr("cy",10).attr("r",1.5).attr("fill","red"),this.containerSVG.append("clipPath").attr("id","clip").append("rect").attr("id","clipRegion").attr("width","100%").attr("height","100%").attr("x",0).attr("y",0).attr("fill","red"),this.appendAxis("svg-x-axis"),this.appendAxis("svg-y-axis"),this.containerSVG.append("g").attr("id","svg-x-grid").attr("class","x axis-grid").attr("pointer-events","none").attr("transform","").attr("stroke-width",1).attr("stroke-opacity",.1).attr("stroke","#ddeeff").attr("fill","none").attr("font-size",12).attr("font-family","sans-serif").attr("text-anchor","middle"),this.containerSVG.append("g").attr("id","svg-y-grid").attr("class","y axis-grid").attr("pointer-events","none").attr("transform","").attr("stroke-width",1).attr("stroke-opacity",.1).attr("stroke","#ddeeff").attr("fill","none").attr("font-size",12).attr("font-family","sans-serif").attr("text-anchor","middle"),this.containerSVG.append("g").attr("id","svg-points").attr("clip-path","url(#clip)").attr("transform",""),this.containerSVG.append("g").attr("id","svg-label-boxes").attr("pointer-events","none").attr("transform","").attr("fill","none").attr("clip-path","url(#clip)").attr("transform",""),this.containerSVG.append("g").attr("id","svg-labels").attr("font-family","sans-serif").attr("clip-path","url(#clip)").attr("transform",""),this.containerSVG.append("g").attr("id","svg-measurements").attr("class","").attr("clip-path","url(#clip)").attr("transform",""),this.containerSVG.append("g").attr("id","svg-measurement-labels").attr("pointer-events","none").attr("font-family","sans-serif").attr("clip-path","url(#clip)").attr("transform",""),this.xAxis=Oi(this.xScale),this.yAxis=Di(this.yScale),this.xGrid=Oi(this.xScale),this.yGrid=Di(this.yScale),this.drag=To().on("start",(t,e)=>this.dragstarted(t,e)).on("drag",(t,e)=>this.dragged(t,e)).on("end",(t,e)=>this.dragended(t,e)),this.measurementsSVG=H(this.parent).select("#svg-measurements"),this.pointsSVG=H(this.parent).select("#svg-points"),this.pointsSVG.selectAll("circle").data(this.markers.filter(t=>t.show)).join("circle").attr("id",function(t,e){return"marker-"+e}).attr("class","point").attr("fill","rgb(255,255,0)").attr("fill-opacity",.75).attr("stroke","red").attr("stroke-width",1.5).attr("r",5).attr("cx",t=>t.x).attr("cy",t=>t.y).call(this.drag),this.markerLabelBoxesSVG=H(this.parent).select("#svg-label-boxes"),this.markerLabelsSVG=H(this.parent).select("#svg-labels"),this.measurementLabelsSVG=H(this.parent).select("#svg-measurement-labels"),this.updateCanvas(),this.zoom=Mo().on("zoom",t=>this.handleZoom(t)),this.updateBody(),H(this.parent).select("#svg-outer").call(this.zoom).on("dblclick.zoom",null),this.updateXAxis(),this.updateYAxis(),this.updateXGrid(),this.updateYGrid()}initializeWebGL(){this.gl=this.canvas.node().getContext("webgl2"),this.shaderProgram=this.GLProgram(this.gl,this.vertexShaderSource,this.fragmentShaderSource),this.gl.useProgram(this.shaderProgram),this.vertex_attrib=this.gl.getAttribLocation(this.shaderProgram,"vertex_position"),this.color_attrib=this.gl.getAttribLocation(this.shaderProgram,"vertex_color"),this.pointsize_uniform=this.gl.getUniformLocation(this.shaderProgram,"point_size"),this.offset_uniform=this.gl.getUniformLocation(this.shaderProgram,"offset"),this.range_uniform=this.gl.getUniformLocation(this.shaderProgram,"range"),this.matrix_uniform=this.gl.getUniformLocation(this.shaderProgram,"matrix"),this.gl.enableVertexAttribArray(this.vertex_attrib),this.gl.enableVertexAttribArray(this.color_attrib),this.initializeGL(),this.updateTransform()}initializeEvents(){this.cursorMoveEvent=new CustomEvent("cursormove",{detail:{domainCoords:[NaN,NaN],rangeCoords:[NaN,NaN]},bubbles:!0,cancelable:!0,composed:!1}),this.domainEvent=new CustomEvent("changedomain",{detail:{xDomain:this.xDomain,yDomain:this.yDomain},bubbles:!0,cancelable:!0,composed:!1}),this.drawEvent=new CustomEvent("changemarkers",{detail:{markers:this.markers},bubbles:!0,cancelable:!0,composed:!1}),this.measureEvent=new CustomEvent("changemeasurements",{detail:{measurements:this.measurements},bubbles:!0,cancelable:!0,composed:!1}),new ResizeObserver(()=>{this.updatePlot(),H(this.parent).select("#svg-outer").transition().duration(100).call(this.zoom.transform,this.zoomTransform)}).observe(this.parent),H(this.parent).select("#svg-outer").on("mousemove",e=>{const i=cs(e),r=[this.xScale.invert(i[0]),this.yScale.invert(i[1])];this.cursorMoveEvent.detail.rangeCoords=i,this.cursorMoveEvent.detail.domainCoords=r,this.parent.dispatchEvent(this.cursorMoveEvent)}),H(this.parent).select("#svg-outer").on("click",e=>{const i=e.detail,r=cs(e),n=[this.xScale.invert(r[0]),this.yScale.invert(r[1])];if(this.draw){const s=jt();this.markers.push({id:s,label:this.generateId(this.markers),x:n[0],y:n[1],u:r[0],v:r[1],xm:null,ym:null,zm:null,colour:"#FFFFFF",opacity:1,feature:"marker",group:null,show:!0,update:!0}),this.appendMarker(s,r),this.drawEvent.detail.markers=this.markers,this.parent.dispatchEvent(this.drawEvent)}if(this.measure){if(i===2){this.groupID=jt(),this.addMeasurement(this.groupID);return}this.measurementPoints.length===0&&(this.groupID=jt(),this.addMeasurement(this.groupID));const s=jt();this.markers.push({id:s,label:this.generateId(this.markers),x:n[0],y:n[1],u:r[0],v:r[1],xm:null,ym:null,zm:null,colour:"#FFFFFF",opacity:1,feature:"measurement",group:`${this.groupID}`,show:!0,update:!0}),this.appendMarker(s,r),this.updateMeasurements(),this.measurementsSVG.select(`#path-${this.groupID}`).datum(this.markers.filter(a=>a.group===this.groupID)).attr("d",li().x(a=>this.xScale(a.x)).y(a=>this.yScale(a.y))),this.drawEvent.detail.markers=this.markers,this.parent.dispatchEvent(this.drawEvent),this.measureEvent.detail.measurements=this.measurements,this.parent.dispatchEvent(this.measureEvent)}this.updateLabels()})}get measurementPoints(){return this.markers.filter(t=>t.feature==="measurement")}get height(){return this.parent.clientHeight}get width(){return this.parent.clientWidth}get innerWidth(){return this.width-this.margins.left-this.margins.right}get innerHeight(){return this.height-this.margins.top-this.margins.bottom}get xRange(){return[0,this.innerWidth]}get yRange(){return[this.innerHeight,0]}get domainWidth(){return this.xDomain[1]-this.xDomain[0]}get domainHeight(){return this.verticalExaggeration*(this.yDomain[1]-this.yDomain[0])}get domainAspectRatio(){return this.domainWidth/this.domainHeight}get rangeAspectRatio(){return this.innerWidth/this.innerHeight}get xDomainAdjusted(){return this.domainAspectRatio<=this.rangeAspectRatio?[this.boundingBox.xMin,this.rangeAspectRatio*this.domainHeight+this.boundingBox.xMin]:this.xDomain}get yDomainAdjusted(){return this.domainAspectRatio>this.rangeAspectRatio?[this.boundingBox.yMin,this.boundingBox.yMin+this.domainWidth/(this.verticalExaggeration*this.rangeAspectRatio)]:this.yDomain}get xScale(){return this.zoomTransform.rescaleX(hs(this.xDomainAdjusted,this.xRange))}get yScale(){return this.zoomTransform.rescaleY(hs(this.yDomainAdjusted,this.yRange))}get nPoints(){return this.xy.length/2}get zoomTransform(){const e=H(this.parent).select("#svg-outer").node();return e?No(e):ds}updateBody(){H(this.parent).select("#svg-outer").attr("width",this.innerWidth).attr("height",this.innerHeight).attr("viewBox",[0,0,this.innerWidth,this.innerHeight]).style("top",`${this.margins.top}px`).style("left",`${this.margins.left}px`)}updateCanvas(){H(this.parent).select("#glcanvas").attr("width",this.canvasScalingFactor*this.innerWidth).attr("height",this.canvasScalingFactor*this.innerHeight).style("top",`${this.margins.top}px`).style("left",`${this.margins.left}px`).style("width",`${this.innerWidth}px`).style("height",`${this.innerHeight}px`)}appendAxis(t){this.containerSVG.append("g").attr("id",t).attr("class","svg-axis").attr("pointer-events","none").attr("transform","").attr("fill","none").attr("font-size",12).attr("font-family","sans-serif").attr("text-anchor","middle").attr("style","color: var(--text-color)")}updateXAxis(){this.xAxis=Oi(this.xScale),H(this.parent).select("#svg-x-axis").attr("transform",`translate(0, ${this.innerHeight})`).call(this.xAxis)}updateYAxis(){this.yAxis=Di(this.yScale),H(this.parent).select("#svg-y-axis").attr("transform","translate(0, 0)").call(this.yAxis)}updateXGrid(){this.xGrid=Oi(this.xScale).tickSize(-this.innerHeight).tickFormat(()=>""),H(this.parent).select("#svg-x-grid").attr("transform",`translate(0, ${this.innerHeight})`).call(this.xGrid)}updateYGrid(){this.yGrid=Di(this.yScale).tickSize(-this.innerWidth).tickFormat(()=>""),H(this.parent).select("#svg-y-grid").attr("transform","translate(0, 0)").call(this.yGrid)}updateBoundingBox(){const t=new Float32Array(this.nPoints),e=new Float32Array(this.nPoints);for(let i=0;i<this.nPoints;i++)t[i]=this.xy[2*i+0],e[i]=this.xy[2*i+1];this.boundingBox={xMin:t.reduce((i,r)=>Math.min(i,r)),xMax:t.reduce((i,r)=>Math.max(i,r)),yMin:e.reduce((i,r)=>Math.min(i,r)),yMax:e.reduce((i,r)=>Math.max(i,r))}}updatePoints(t){this.xy=t,this.updateBoundingBox(),this.xDomain=[this.boundingBox.xMin,this.boundingBox.xMax],this.yDomain=[this.boundingBox.yMin,this.boundingBox.yMax]}updateColors(t){this.rgb=t}updatePaths(){this.measurementsSVG.selectAll("path").nodes().forEach(e=>{const i=H(e),r=this.markers.filter(n=>`path-${n.group}`===i.attr("id"));i.datum(r).attr("d",li().x(n=>this.xScale(n.x)).y(n=>this.yScale(n.y)))})}updateMarkers(){this.pointsSVG.selectAll("circle").data(this.markers.filter(t=>t.show)).join("circle").attr("id",t=>`marker-${t.id}`).attr("class","point").attr("fill","rgb(255,255,0)").attr("fill-opacity",.75).attr("stroke","red").attr("stroke-width",1.5).attr("r",5).attr("cx",t=>this.xScale(t.x)).attr("cy",t=>this.yScale(t.y)).call(this.drag)}appendMarker(t,e){this.pointsSVG.selectAll("circle").data(this.markers.filter(i=>i.show)).enter().append("circle").attr("id",t).attr("class","point").attr("fill","rgb(255,255,0)").attr("fill-opacity",.75).attr("stroke","red").attr("stroke-width",1.5).attr("r",5).attr("cx",e[0]).attr("cy",e[1]).attr("cursor","grab").call(this.drag)}updateMeasurements(){this.measurements.splice(0,this.measurements.length);for(let t=0;t<this.markers.length-1;t++)if(this.markers[t].feature==="measurement"&&this.markers[t].group===this.markers[t+1].group){const e=this.markers[t].x-this.markers[t+1].x,i=this.markers[t].y-this.markers[t+1].y;this.measurements.push({id:this.markers[t].group,label:this.generateId(this.markers),x:(this.markers[t].x+this.markers[t+1].x)/2,y:(this.markers[t].y+this.markers[t+1].y)/2,u:(this.markers[t].u+this.markers[t+1].u)/2,v:(this.markers[t].v+this.markers[t+1].v)/2,from:this.markers[t].id,to:this.markers[t+1].id,distance:Math.sqrt(e*e+i*i),slope:i/e,text:null})}this.updatePaths()}updateLabels(){this.markerLabelsSVG.selectAll("text").data(this.markers.filter(t=>t.show)).join("text").attr("id",t=>`label-${t.id}`).attr("x",t=>this.xScale(t.x)).attr("y",t=>this.yScale(t.y)).text(t=>`${t.label}`).attr("dy","-20px").attr("pointer-events","none").attr("text-anchor","middle").attr("font-family","sans-serif").attr("font-size",16).attr("fill","white"),this.markerLabelBoxesSVG.selectAll("rect").data(this.markers.filter(t=>t.show)).join("rect").attr("id",t=>`label-box-${t.id}`).attr("x",t=>this.xScale(t.x)-13).attr("y",t=>this.yScale(t.y)-38).attr("pointer-events","none").attr("width",26).attr("height",26).attr("fill","black").attr("stroke","white").attr("stroke-width","1px"),this.measurementLabelsSVG.selectAll("text").data(this.measurements).join("text").attr("id",t=>`mlabel-${t.id}`).attr("x",t=>this.xScale(t.x)).attr("y",t=>this.yScale(t.y)).text(t=>`${t.distance.toFixed(2)} | ${(100*t.slope).toFixed(2)}%`).attr("dy","0px").attr("pointer-events","none").attr("text-anchor","middle").attr("font-family","sans-serif").attr("font-size",18).attr("font-weight","bolder").attr("fill","#FF4500")}setBackgroundColor(t){const e=Po(t);this.backgroundColor=[e.r/255,e.g/255,e.b/255,e.opacity],this.initializeGL(),this.updateTransform()}handleZoom(t){this.updatePlot(),this.updateTransform(),this.domainEvent.detail.xDomain=this.xScale.domain(),this.domainEvent.detail.yDomain=this.yScale.domain(),this.parent.dispatchEvent(this.domainEvent)}setZoom(t){const e=new Ro(t.k,t.tx,t.ty);H(this.parent).select("#svg-outer").transition().duration(100).call(this.zoom.transform,e)}resetZoom(){H(this.parent).select("#svg-outer").transition().duration(100).call(this.zoom.transform,ds)}getDraggedElement(t){return t.composedPath().find(i=>i instanceof SVGCircleElement)}updateDraggedElements(t,e){const i=this.xScale(this.x0),r=this.yScale(this.y0);e.u=i+t.x-this.x0,e.v=r+t.y-this.y0,e.x=this.xScale.invert(e.u),e.y=this.yScale.invert(e.v),e.update=!0,this.updateMeasurements(),this.updateLabels(),H(this.draggedElement).attr("cx",e.u).attr("cy",e.v),this.measurementsSVG.select(`#path-${e.group}`).attr("stroke","rgba(255,140,0,0.5)").attr("d",li().x(n=>this.xScale(n.x)).y(n=>this.yScale(n.y))),this.drawEvent.detail.markers=this.markers,this.parent.dispatchEvent(this.drawEvent)}dragstarted(t,e){this.draggedElement=this.getDraggedElement(t.sourceEvent),this.cx0=this.xScale(e.x),this.cy0=this.yScale(e.y),this.x0=e.x,this.y0=e.y,H(this.draggedElement).attr("cursor","grabbing")}dragged(t,e){this.updateDraggedElements(t,e),H(this.draggedElement).attr("cursor","grabbing")}dragended(t,e){this.updateDraggedElements(t,e),H(this.draggedElement).attr("cursor","grab")}updatePointSize(t){typeof t=="number"&&(this.pointSize=t,this.updatePlot(),this.updateTransform())}updateVerticalExaggeration(t){typeof t=="number"&&(this.verticalExaggeration=t,this.updatePlot(),this.updateTransform())}toggleAnnotation(t){this.draw=t,this.measure=!1,H(this.parent).select("#svg-outer").attr("cursor",this.draw?"crosshair":"default")}deleteAllMarkers(){this.markers.length!==0&&(this.markers.splice(0,this.markers.length),this.pointsSVG.selectAll("*").remove(),this.markerLabelsSVG.selectAll("*").remove(),this.markerLabelBoxesSVG.selectAll("*").remove(),this.measurementsSVG.selectAll("*").remove(),this.measurementLabelsSVG.selectAll("*").remove(),this.updateMeasurements(),this.drawEvent.detail.markers=this.markers,this.parent.dispatchEvent(this.drawEvent))}deleteMarker(t){const e=this.markers.find(i=>i.id===t);if(e){const i=this.markers.findIndex(r=>r.id===t);i!==-1&&this.markers.splice(i,1),this.pointsSVG.select(`#marker-${t}`).remove(),this.updateMeasurements(),this.updateLabels(),this.measurementsSVG.select(`#path-${e.group}`).datum(this.markers.filter(r=>r.group===e.group)).attr("d",li().x(r=>this.xScale(r.x)).y(r=>this.yScale(r.y)))}this.markerLabelsSVG.select(`#label-${t}`).remove(),this.markerLabelBoxesSVG.select(`#label-box-${t}`).remove(),this.drawEvent.detail.markers=this.markers,this.parent.dispatchEvent(this.drawEvent)}toggleMeasurement(t){this.measure=t,this.draw=!1,H(this.parent).select("#svg-outer").attr("cursor",this.measure?"crosshair":"default")}addMeasurement(t){this.measurementsSVG.append("path").attr("id",`path-${t}`).attr("class","line").attr("clip-path","url(#clip)").attr("pointer-events","none").attr("fill","none").attr("stroke-width",2).attr("stroke","rgba(255,140,0,0.5)").attr("marker-start","url(#dot)").attr("marker-mid","url(#dot)").attr("marker-end","url(#dot)").datum(this.markers.filter(e=>e.group===t)).attr("d",li().x(e=>this.xScale(e.x)).y(e=>this.yScale(e.y)))}deleteAllMeasurements(){if(this.measurements.length!==0){this.measurements.splice(0,this.measurements.length),this.measurementsSVG.selectAll("*").remove(),this.measurementLabelsSVG.selectAll("*").remove(),this.groupID=jt();for(let t=this.markers.length-1;t>=0;t--)this.markers[t].feature==="measurement"&&this.markers.splice(t,1);this.updateMarkers(),this.updateLabels(),this.drawEvent.detail.markers=this.markers,this.parent.dispatchEvent(this.drawEvent),this.measureEvent.detail.measurements=this.measurements,this.parent.dispatchEvent(this.measureEvent)}}updatePlot(){this.updateCanvas(),this.updateBody(),this.updateXAxis(),this.updateYAxis(),this.updateXGrid(),this.updateYGrid(),this.updateMarkers(),this.updateMeasurements(),this.updateLabels()}resetPlot(){this.xy=new Float32Array(0),this.rgb=new Uint8Array(0),this.clearGLPoints(),this.resetZoom(),this.markers.forEach((t,e)=>{t.show=!1}),this.drawEvent.detail.markers=this.markers,this.parent.dispatchEvent(this.drawEvent)}generateId(t){let e=0;const i=new Set(t.map(r=>parseInt(r.label)));for(;i.has(e);)e++;return e.toString()}clearGLPoints(){this.gl.clear(this.gl.COLOR_BUFFER_BIT)}initializeGL(){this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.clearColor(this.backgroundColor[0],this.backgroundColor[1],this.backgroundColor[2],this.backgroundColor[3]),this.gl.clear(this.gl.COLOR_BUFFER_BIT);const t=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.xy,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.vertex_attrib,2,this.gl.FLOAT,!1,0,0);const e=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.rgb,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.color_attrib,3,this.gl.UNSIGNED_BYTE,!0,0,0)}multiplyMatrix(t,e){const i=new Float32Array(16);for(let r=0;r<4;++r)for(let n=0;n<4;++n)i[r*4+n]=t[r*4+0]*e[0*4+n]+t[r*4+1]*e[1*4+n]+t[r*4+2]*e[2*4+n]+t[r*4+3]*e[3*4+n];return i}createOrthographic(t,e,i,r,n,s){const a=1/(t-e),o=1/(i-r),c=1/(n-s),h=new Float32Array(16);return h[0]=-2*a,h[5]=-2*o,h[10]=2*c,h[12]=(t+e)*a,h[13]=(r+i)*o,h[14]=(s+n)*c,h[15]=1,h}createTranslation(t,e,i){const r=new Float32Array(16);return r[0]=1,r[5]=1,r[10]=1,r[12]=t,r[13]=e,r[14]=i,r[15]=1,r}createScale(t,e,i){const r=new Float32Array(16);return r[0]=t,r[5]=e,r[10]=i,r[15]=1,r}updateTransform(){const t=this.zoomTransform.k,e=this.zoomTransform.x,i=this.zoomTransform.y,r=1/this.canvasScalingFactor;this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);let n=this.createOrthographic(0,r*this.gl.canvas.width,r*this.gl.canvas.height,0,-1,1);const s=this.createTranslation(e,i,0);n=this.multiplyMatrix(s,n);const a=this.createScale(t,t,1);n=this.multiplyMatrix(a,n);const o=this.createTranslation(r*this.gl.canvas.width/2,r*this.gl.canvas.height/2,0);n=this.multiplyMatrix(o,n);const c=this.createScale(r*this.gl.canvas.width/2,r*this.gl.canvas.height/2,1);n=this.multiplyMatrix(c,n);const h=this.createScale(1,-1,1);n=this.multiplyMatrix(h,n),this.gl.uniformMatrix4fv(this.matrix_uniform,!1,n);const d=new Float32Array([this.xDomainAdjusted[0],this.yDomainAdjusted[0]]),m=new Float32Array([this.xDomainAdjusted[1]-this.xDomainAdjusted[0],this.yDomainAdjusted[1]-this.yDomainAdjusted[0]]);this.gl.uniform2fv(this.offset_uniform,d),this.gl.uniform2fv(this.range_uniform,m),this.gl.uniform1f(this.pointsize_uniform,this.pointSize),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.POINTS,0,this.nPoints)}GLShader(t,e,i){const r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}GLProgram(t,e,i){const r=t.createProgram(),n=this.GLShader(t,t.VERTEX_SHADER,e),s=this.GLShader(t,t.FRAGMENT_SHADER,i);if(!r)throw new Error("GLProgram: Invalid shader program");if(!n)throw new Error("GLProgram: Invalid vertex shader");if(!s)throw new Error("GLProgram: Invalid fragment shader");return t.attachShader(r,n),t.attachShader(r,s),t.linkProgram(r),t.deleteShader(n),t.deleteShader(s),r}}class yg{constructor(t){l(this,"baseURL");l(this,"config",null);this.baseURL=t}async getConfig(){const t=new URL("./profile/config",this.baseURL);try{const e=await fetch(t);if(!e.ok)throw new Error(`PytreeManager: HTTP error! Status: ${e.status}`);this.config=await e.json()}catch(e){console.error("PytreeManager:",e)}}readPotreeAttributes(t,e,i,r,n){const s=4+e;let a=0;const o=new DataView(r),c=t.scale,h={x:t.boundingBox.lx,y:t.boundingBox.ly,z:t.boundingBox.lz},d=t.bytesPerPoint,m={};for(const p of n)if(p==="POSITION_CARTESIAN"){const b=new Float64Array(3*i);for(let x=0;x<i;x++){const E=o.getInt32(s+x*d+a+0,!0),T=o.getInt32(s+x*d+a+4,!0),R=o.getInt32(s+x*d+a+8,!0),G=E*c+h.x,St=T*c+h.y,ut=R*c+h.z;b[3*x+0]=G,b[3*x+1]=St,b[3*x+2]=ut}a+=12,m[p]=b}else if(p==="RGB"){const b=new Uint8Array(3*i);for(let x=0;x<i;x++){const E=o.getUint8(s+x*d+a+0),T=o.getUint8(s+x*d+a+1),R=o.getUint8(s+x*d+a+2);b[3*x+0]=E,b[3*x+1]=T,b[3*x+2]=R}a+=3,m[p]=b}else if(p==="COLOR_PACKED"){const b=new Uint8Array(4*i);for(let x=0;x<i;x++){const E=o.getUint8(s+x*d+a+0),T=o.getUint8(s+x*d+a+1),R=o.getUint8(s+x*d+a+2),G=o.getUint8(s+x*d+a+3);b[4*x+0]=E,b[4*x+1]=T,b[4*x+2]=R,b[4*x+3]=G}a+=4,m[p]=b}else if(p==="INTENSITY"){const b=new Uint16Array(i);for(let x=0;x<i;x++){const E=o.getUint16(s+x*d+a,!0);b[x]=E}a+=2,m[p]=b}else if(p==="CLASSIFICATION"){const b=new Uint8Array(i);for(let x=0;x<i;x++){const E=o.getUint8(s+x*d+a);b[x]=E}a+=1,m[p]=b}else if(p==="POSITION_PROJECTED_PROFILE"){const b=new Float32Array(2*i),x=t.scale;for(let E=0;E<i;E++){const T=o.getInt32(s+E*d+a+0,!0),R=o.getInt32(s+E*d+a+4,!0),G=T*x,St=R*x;b[2*E+0]=G,b[2*E+1]=St}a+=8,m[p]=b}else console.warn(`unkown attribute: ${p}`);return m}async getData(t,e,i,r,n,s){const a=new URL("./profile/get",this.baseURL);a.searchParams.append("minLOD",e.toString()),a.searchParams.append("maxLOD",i.toString()),a.searchParams.append("width",r.toString()),a.searchParams.append("coordinates",n),a.searchParams.append("pointCloud",t),a.searchParams.append("attributes","");try{const o=await fetch(a,{signal:s});if(!o.ok)throw new Error(`HTTP error! Status: ${o.status}`);const c=await o.arrayBuffer(),d=new DataView(c).getInt32(0,!0),m=c.slice(4,4+d),b=new TextDecoder("utf-8").decode(m).replace(/(-?inf)/g,"null"),x=JSON.parse(b),E=x.pointAttributes,T=x.points;return{data:this.readPotreeAttributes(x,d,T,c,E),metadata:x}}catch(o){o.name==="AbortError"?console.warn("Fetch aborted"):console.error("Fetch failed:",o)}}getClassificationColor(t,e){const i=new Uint8Array(t.length*3);return t.forEach((r,n)=>{var a;const s=((a=e[r])==null?void 0:a.color.split(",").map(Number))||[0,0,0];i.set(s,n*3)}),i}}function Ts(g,t="spectral",e=[]){const i=g.length;let r;switch(t){case"spectral":r=gi(zo).domain(e);break;case"viridis":r=gi(Do).domain(e);break;case"greys":r=gi(Oo).domain(e);break;case"magma":r=gi(Fo).domain(e);break;case"blues":r=gi(Ao).domain(e);break;case"custom":r=Wr().domain([1,2,3,4,5,6,7,9,11,14,15,17,18,19,21,22,25,26,29,31,41]).range(["#C0C0C0","#DEB887","#9ACD32","#32CD32","#008000","#B22222","#FFFF00","#87CEFA","#B8860B","#BA55D3","#FF1493","#EEE8AA","#FFD700","#7FFFD4","#DDA0DD","#A0522D","#FFA500","#FA8072","#FF6347","#BC8F8F","#6495ED"]);break;case"uniform":r=Wr().domain([1]).range(["#DEB887"]);break;default:r=Wr().domain([1]).range([t])}const n=new Uint8Array(i*3);return g.forEach((s,a)=>{const o=Vo(r(s));n[a*3+0]=o.r,n[a*3+1]=o.g,n[a*3+2]=o.b}),n}class xg extends qn{constructor(){super("cross-section-view");l(this,"template",()=>_`<style>
#panel,:host{position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden;height:100%;width:100%;min-height:10rem;background:var(--bkg-color)}#profile-panel{position:relative;width:100%;height:100%;margin:auto;background-color:none;overflow:hidden}#gutter{border:none;height:6px;width:100%;background:var(--bkg-color);position:absolute;top:0;left:0;cursor:row-resize}#glcanvas{position:absolute}#svg-outer{position:absolute;z-index:1}.svg-axis{font-size:12;font-family:inherit,sans-serif;user-select:none}.ruler-text{text-anchor:middle}.point:hover{stroke:blue;fill:chartreuse}#spinner{visibility:hidden;background-color:#f7f7f7;border-radius:50%}.spinner{z-index:99;position:absolute;top:15px;right:10px;width:30px;height:30px;-webkit-animation:spin 2s linear infinite;-moz-animation:spin 2s linear infinite;animation:spin 2s linear infinite}@-moz-keyframes spin{100%{-moz-transform:rotate(360deg)}}@-webkit-keyframes spin{100%{-webkit-transform:rotate(360deg)}}@keyframes spin{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}
</style><style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style>
<div id="panel">
  <div id="profile-panel"></div>
  <div id="gutter"></div>
</div>
`);l(this,"crossSectionState");l(this,"eventsCallbacks",[]);l(this,"darkFrontendMode",!1);l(this,"visible",!1);l(this,"scatterplot");l(this,"abortController");l(this,"uv");l(this,"rgb");l(this,"intensity");l(this,"classification");l(this,"currentRefreshId");l(this,"panel",null);l(this,"pytreeManager",null);this.crossSectionState=this.state.extendedState.crossSection,this.abortController=new AbortController,this.uv=new Float32Array(this.crossSectionState.maxNumberOfPoints*2),this.rgb=new Uint8Array(this.crossSectionState.maxNumberOfPoints*3),this.intensity=new Uint16Array(this.crossSectionState.maxNumberOfPoints),this.classification=new Uint8Array(this.crossSectionState.maxNumberOfPoints)}async initPytreeManager(){const e=je.getInstance().Config.lidar.url.replace(/\/?$/,"/");this.pytreeManager=new yg(e),await this.pytreeManager.getConfig()}async refreshData(e,i){if(!this.pytreeManager)try{await this.initPytreeManager()}catch(o){throw console.error("Cross-section-viewer: Unavble to initialize Pytree manager",o),o}this.scatterplot.clearGLPoints(),this.validateRequestArgs(e,i),this.abortOngoingRequest(),this.abortController=new AbortController;const r=this.abortController.signal;this.crossSectionState.loading=!0,this.state.loading=!0;const n=i.map(o=>`{${o}}`).join();this.crossSectionState.numberOfPoints=0,this.uv=new Float32Array(this.crossSectionState.maxNumberOfPoints*2),this.rgb=new Uint8Array(this.crossSectionState.maxNumberOfPoints*3),this.intensity=new Uint16Array(this.crossSectionState.maxNumberOfPoints),this.classification=new Uint8Array(this.crossSectionState.maxNumberOfPoints);const s=Symbol("refreshId");this.currentRefreshId=s;let a=1;for(;this.crossSectionState.numberOfPoints<this.crossSectionState.maxNumberOfPoints&&a<=14;)try{this.crossSectionState.loading=!0,this.state.loading=!0;const o=await this.pytreeManager.getData(this.pytreeManager.config.default_point_cloud,a,a,e,n,this.abortController.signal);if(!o||r.aborted||this.currentRefreshId!==s)break;const c=Math.max(0,this.crossSectionState.maxNumberOfPoints-this.crossSectionState.numberOfPoints);if(o.metadata.points>0&&c>0&&!r.aborted){for(const h in o.data)switch(h){case"POSITION_PROJECTED_PROFILE":this.uv.set(o.data.POSITION_PROJECTED_PROFILE.slice(0,c*2),this.crossSectionState.numberOfPoints*2);break;case"RGB":this.rgb.set(o.data.RGB.slice(0,c*3),this.crossSectionState.numberOfPoints*3);break;case"INTENSITY":this.intensity.set(o.data.INTENSITY.slice(0,c),this.crossSectionState.numberOfPoints);break;case"CLASSIFICATION":this.classification.set(o.data.CLASSIFICATION.slice(0,c),this.crossSectionState.numberOfPoints);break}this.crossSectionState.numberOfPoints=Math.min(this.crossSectionState.maxNumberOfPoints,this.crossSectionState.numberOfPoints+o.metadata.points),this.updateScatterplot(s)}if(c===0)return;a++}catch(o){throw console.error("Cross-section-viewer: Fetch failed due to unexpected error:",o),o}this.crossSectionState.loading=!1,this.state.loading=!1}validateRequestArgs(e,i){if(e<=0)throw new Error("lineWidth must be larger than 0");if(i.length<2)throw new Error("At least two line coordinates are required")}abortOngoingRequest(){this.crossSectionState.loading&&(this.abortController.abort("New linestring requested before previous data finished loading"),this.scatterplot.clearGLPoints(),this.crossSectionState.loading=!1,this.state.loading=!1),this.abortController=new AbortController}updateScatterplot(e){this.scatterplot&&this.currentRefreshId===e&&(this.scatterplot.updatePoints(this.uv.slice(0,this.crossSectionState.numberOfPoints*2)),this.changeColormap(this.crossSectionState.colorVariable,this.crossSectionState.colorPalette),this.scatterplot.updatePlot())}changeColormap(e,i="spectral"){let r;switch(e){case"intensity":r=Ts(this.intensity.slice(0,this.crossSectionState.numberOfPoints),i,[15e3,65e3]);break;case"natural":r=this.rgb.slice(0,this.crossSectionState.numberOfPoints*3);break;case"classification":r=this.pytreeManager.getClassificationColor(this.classification.slice(0,this.crossSectionState.numberOfPoints),this.pytreeManager.config.classification_colors);break;case"uniform":r=Ts(this.classification.slice(0,this.crossSectionState.numberOfPoints),this.crossSectionState.colorUniform,[]);break}this.scatterplot&&(this.scatterplot.updateColors(r),this.scatterplot.initializeGL(),this.scatterplot.updateTransform())}printCanvas(){var i,r,n;(i=this.scatterplot)==null||i.updateTransform();const e=(r=this.scatterplot)==null?void 0:r.canvas.node();if(e){const a=1*e.width,o=1*e.height,c=(n=this.scatterplot)==null?void 0:n.containerSVG.node().cloneNode(!0);c.setAttribute("width",a.toString()),c.setAttribute("height",o.toString());const h=new XMLSerializer().serializeToString(c),d=`<svg width="${a}" height="${o}" xmlns="http://www.w3.org/2000/svg"><image href="${e.toDataURL("image/png")}" x="0" y="0" width="${a}" height="${o}" />${h}</svg>`;ye(d,"profile.svg","image/svg+xml;charset=utf-8")}}render(){this.visible?this.renderComponent():this.renderEmpty()}renderComponent(){super.render(),super.girafeTranslate(),this.activateTooltips(!1,[800,0],"top-end"),this.panel=this.shadowRoot.getElementById("profile-panel"),this.scatterplot=new vg(this.panel,this.crossSectionState.margins,new Float32Array(0),new Uint8Array(0)),this.scatterplot.setZoom(this.crossSectionState.zoom),this.registerEvents()}registerEvents(){var e,i,r,n;this.eventsCallbacks.push(this.subscribe("interface.darkFrontendMode",(s,a)=>{this.darkFrontendMode=a}),this.subscribe("extendedState.crossSection.verticalExaggerationSettings.value",(s,a)=>{var o;(o=this.scatterplot)==null||o.updateVerticalExaggeration(a)}),this.subscribe("extendedState.crossSection.pointSizeSettings.value",(s,a,o)=>{var c;(c=this.scatterplot)==null||c.updatePointSize(a)}),this.subscribe("extendedState.crossSection.backgroundColor",(s,a,o)=>{var c;(c=this.scatterplot)==null||c.setBackgroundColor(a)}),this.subscribe("extendedState.crossSection.colorVariable",(s,a,o)=>{this.changeColormap(this.crossSectionState.colorVariable,this.crossSectionState.colorPalette)}),this.subscribe("extendedState.crossSection.colorUniform",(s,a,o)=>{this.crossSectionState.colorVariable==="uniform"&&this.changeColormap(this.crossSectionState.colorVariable,this.crossSectionState.colorPalette)}),this.subscribe("extendedState.crossSection.colorPalette",(s,a,o)=>{this.changeColormap(this.crossSectionState.colorVariable,this.crossSectionState.colorPalette)}),this.subscribe("extendedState.crossSection.zoom",(s,a,o)=>{var c;this.crossSectionState.zoomUpdate&&((c=this.scatterplot)==null||c.setZoom(a))}),this.subscribe("extendedState.crossSection.sectionWidthSettings.value",(s,a)=>{a>0&&this.crossSectionState.linestringCoordinates.length>=2&&this.refreshData(a,this.crossSectionState.linestringCoordinates)}),this.subscribe("extendedState.crossSection.linestringCoordinates",(s,a,o)=>{var c;if((c=this.scatterplot)==null||c.deleteAllMeasurements(),a.length===0){this.abortController.abort("Cross-section-viewer: current data fetch was aborted by new request"),this.scatterplot.resetPlot();return}this.crossSectionState.sectionWidthSettings.value>0&&this.crossSectionState.linestringCoordinates.length>=2&&this.refreshData(this.crossSectionState.sectionWidthSettings.value,this.crossSectionState.linestringCoordinates)}),this.subscribe("extendedState.crossSection.drawMeasurement",(s,a,o)=>{var c;a&&(this.crossSectionState.drawMarker=!1),(c=this.scatterplot)==null||c.toggleMeasurement(a)}),this.subscribe("extendedState.crossSection.drawMarker",(s,a,o)=>{var c;a&&(this.crossSectionState.drawMeasurement=!1),(c=this.scatterplot)==null||c.toggleAnnotation(a)}),this.subscribe("extendedState.crossSection.markers",(s,a,o)=>{var c,h,d;this.scatterplot.markers=a,(c=this.scatterplot)==null||c.updateMarkers(),(h=this.scatterplot)==null||h.updateMeasurements(),(d=this.scatterplot)==null||d.updateLabels()})),document.addEventListener("delete-measurements",()=>{var s;(s=this.scatterplot)==null||s.deleteAllMeasurements()}),document.addEventListener("print-canvas",()=>{this.printCanvas()}),(e=this.panel)==null||e.addEventListener("cursormove",s=>{this.crossSectionState.cursorDomainCoordinates=s.detail.domainCoords}),(i=this.panel)==null||i.addEventListener("changedomain",s=>{console.debug("Cross-section viewer: changedomain event fired"),this.crossSectionState.domain={xmin:s.detail.xDomain[0],xmax:s.detail.xDomain[1],ymin:s.detail.yDomain[0],ymax:s.detail.yDomain[1]},this.crossSectionState.zoomUpdate=!1,this.crossSectionState.zoom={k:this.scatterplot.zoomTransform.k,tx:this.scatterplot.zoomTransform.x,ty:this.scatterplot.zoomTransform.y}}),(r=this.panel)==null||r.addEventListener("changemarkers",s=>{console.debug("Cross-section viewer: changemarkers event fired"),this.crossSectionState.markers=s.detail.markers}),(n=this.panel)==null||n.addEventListener("changemeasurements",s=>{console.debug("Cross-section viewer: changemeasurements event fired"),this.crossSectionState.measurements=s.detail.measurements})}unregisterEvents(){this.unsubscribe(this.eventsCallbacks),this.eventsCallbacks.length=0}registerVisibilityEvents(){this.subscribe("interface.crossSectionPanelVisible",(e,i)=>{this.togglePanel(i)})}togglePanel(e){this.visible=e,this.render()}connectedCallback(){this.render(),this.registerVisibilityEvents()}}class wg{constructor(t=[],e=!1,i=()=>!0){l(this,"name");l(this,"_active",!1);l(this,"isExclusive");l(this,"map");l(this,"overlay");l(this,"container");l(this,"userInteractionManager");l(this,"openEventListener");l(this,"closeEventListener");this.name=`contextmenu-${jt()}`,this.map=Kt.getInstance().getMap(),this.userInteractionManager=fn.getInstance(),this.isExclusive=e,this.container=document.createElement("div"),this.container.classList.add("contextmenu"),this.container.classList.add("hidden"),this.updateMenuEntries(t),this.overlay=new Gs({element:this.container,position:void 0}),this.map.addOverlay(this.overlay),this.openEventListener=r=>{this.userInteractionManager.canListenerExecute("map.contextmenu",this.name)&&this.handleContextmenuEvent(r,i)},this.closeEventListener=r=>{this.active&&this.visible&&this.closeMenu()},this.enable()}get visible(){return!!this.overlay.getPosition()}get active(){return this._active}setActive(t){t?this.enable():this.disable()}enable(){this.userInteractionManager.registerListener("map.contextmenu",this.isExclusive,this.name)&&this.map.getViewport().addEventListener("contextmenu",this.openEventListener),this.map.getViewport().addEventListener("click",this.closeEventListener),this._active=!0}disable(){this._active=!1,this.userInteractionManager.unregisterAllListenersOfTool(this.name),this.map.getViewport().removeEventListener("contextmenu",this.openEventListener),this.map.getViewport().removeEventListener("click",this.closeEventListener)}handleContextmenuEvent(t,e){if(!this._active)return;this.visible&&this.closeMenu(),t.preventDefault();const i=this.map.getCoordinateFromPixel([t.offsetX,t.offsetY]);e(t,i)?this.openMenu(i):t.stopPropagation()}updateMenuEntries(t){this.container.replaceChildren(""),t.forEach(e=>{const i=document.createElement("div");i.classList.add("menu-entry"),i.innerHTML=e.entry,i.addEventListener("click",r=>this.onClickMenuEntry(r,e.callback)),this.container.appendChild(i)})}openMenu(t){if(!this.container.parentNode){const e=document.getElementById("map-contextmenu");e==null||e.appendChild(this.container)}this.overlay.setPosition(t),this.container.classList.remove("hidden")}closeMenu(){this.overlay.setPosition(void 0),this.container.classList.add("hidden")}onClickMenuEntry(t,e){try{e(t,this.overlay.getPosition())}finally{this.closeMenu()}}remove(){this.disable(),this.map.removeOverlay(this.overlay),this.container.remove()}}function Me(g){return new Et(new ct(g).getCoordinateAt(.5))}function Hi(g,t,e=1){const i=t;if(i.length>1&&g>0){const r=[i[i.length-2],i[i.length-1]];i[i.length-1]=new ct(r).getCoordinateAt(g/(lt(r)*e))}}function Ms(g){let t=[];return g instanceof Et?t=[g.getCoordinates()]:g instanceof xi||g instanceof ct||g instanceof ea?t=g.getCoordinates():g instanceof oe||g instanceof qe?t=g.getCoordinates().flat():g instanceof He&&(t=g.getCoordinates().flat().map(e=>e.flat())),new xi(t)}class _g{constructor(t,e){l(this,"map");l(this,"toolName");l(this,"state");l(this,"configManager");l(this,"userInteractionManager");l(this,"drawingState");l(this,"drawingSource");l(this,"modifiableFeatures",new ir([]));l(this,"draw",null);l(this,"modify",null);l(this,"snap",null);l(this,"editContextMenu",null);l(this,"currentShape",null);l(this,"fixedLength",0);this.map=t,this.toolName=e,this.state=ae.getInstance().state,this.configManager=je.getInstance(),this.userInteractionManager=fn.getInstance(),this.drawingState=this.state.extendedState.drawing,this.drawingSource=new ie({features:new ir}),this.drawingSource.on("addfeature",i=>this.onFeatureAdded(i)),this.map.olMap.addLayer(new Ht({source:this.drawingSource,zIndex:1001,properties:{addToPrintedLayers:!0,altitudeMode:"clampToGround"}})),this.map.stateManager.subscribe("extendedState.drawing.activeTool",(i,r)=>r===null?this.removeDrawInteraction():this.addDrawInteraction(r)),this.map.stateManager.subscribe(/extendedState.drawing.features.*\.selected/,(i,r)=>this.updateModifiableFeatures()),ae.getInstance().subscribe("globe.loaded",()=>{var i;this.state.globe.loaded&&((i=this.drawingSource.getListeners("addfeature"))==null||i.forEach(r=>this.drawingSource.removeEventListener("addfeature",r)),this.drawingSource.on("addfeature",r=>this.onFeatureAdded(r)))})}addModifyInteraction(){this.removeModifyInteraction(),this.modify=new ca({features:this.modifiableFeatures,condition:t=>(ja(t)||qa(t))&&this.canExecute("map.modify"),deleteCondition:Ws,insertVertexCondition:wn,style:new Dt(1,{},"").getVertexStyle(!0),snapToPointer:!0,pixelTolerance:this.map.pixelTolerance}),this.map.olMap.addInteraction(this.modify),this.modify.on("modifyend",t=>{t.features.forEach(e=>{const i=this.drawingState.features.findIndex(r=>r.id===e.getId());i>-1&&(this.drawingState.features[i].geojson=this.getGeoJsonFromOlFeature(e))})})}addSnapInteraction(){this.removeSnapInteraction(),this.snap=new Dl({source:this.drawingSource,pixelTolerance:this.map.pixelTolerance}),this.map.olMap.addInteraction(this.snap)}addEditContextMenu(){this.removeEditContextMenu();const t=[{entry:"Remove vertex",callback:(i,r)=>{if(!this.removeLastInteractedVertex()){const s=`It's not possible to remove vertex at ${lr(r,this.configManager.Config.general.locale)}`;this.state.infobox.elements.push({id:jt(),text:s,type:"warning"})}}}],e=(i,r)=>{var n;return!((n=this.modify)!=null&&n.getActive())||this.modifiableFeatures.getArray().length===0?!1:this.hasEditableVertexAtCoordinate(r)};this.editContextMenu=new wg(t,!0,e)}addEditInteractions(){this.modify||this.addModifyInteraction(),this.editContextMenu||this.addEditContextMenu(),this.addSnapInteraction()}removeEditInteractions(){this.removeModifyInteraction(),this.removeEditContextMenu(),this.draw||this.removeSnapInteraction()}hasEditableVertexAtCoordinate(t){const e=r=>this.modifiableFeatures.getArray().some(n=>r==n),i=this.getClosestVertexAndFeature(t,e);if(i){const r=i[0],n=this.map.olMap.getPixelFromCoordinate(r),s=this.map.olMap.getPixelFromCoordinate(t),a=n[0]-s[0],o=n[1]-s[1];if(Math.sqrt(a*a+o*o)<this.map.pixelTolerance)return!0}return!1}getClosestVertexAndFeature(t,e=()=>!0){const i=this.drawingSource.getClosestFeatureToCoordinate(t,e),r=i==null?void 0:i.getGeometry();if(r)return[Ms(r).getClosestPoint(t),i]}removeLastInteractedVertex(){var t;return(t=this.modify)==null?void 0:t.removePoint()}addFeatures(t){t.forEach(e=>{let i=this.getOlFeatureFromDrawingSource(e.id);i===null&&(i=this.createOlFeature(e),this.drawingSource.addFeature(i)),e.onChange=r=>i.setStyle(n=>this.getStyle(r,n)),e.onChange(e)})}deleteFeatures(t){t.forEach(e=>{const i=this.getOlFeatureFromDrawingSource(e.id);i!==null&&this.drawingSource.removeFeature(i)}),this.updateModifiableFeatures()}updateModifiableFeatures(){const t=this.drawingState.features.filter(e=>e.selected);this.modifiableFeatures.clear(),t.forEach(e=>{const i=this.getOlFeatureFromDrawingSource(e.id);i&&this.modifiableFeatures.push(i)}),this.modifiableFeatures.getLength()>0?this.addEditInteractions():this.removeEditInteractions()}onFeatureAdded(t){if(this.currentShape===null||!t.feature||this.isOlFeatureInState(t.feature))return;const e=t.feature,i=new Dt(this.currentShape);e.setId(i.id),i.geojson=this.getGeoJsonFromOlFeature(e),i.addToState()}getGeoJsonFromOlFeature(t){if(this.currentShape==C.Disk){const e=t.getGeometry();return{type:"Feature",geometry:{type:"Disk",center:e.getCenter(),radius:e.getRadius()}}}else return JSON.parse(new Ye().writeFeature(t))}getOlFeatureFromDrawingSource(t){return this.drawingSource.getFeatureById(t)}isOlFeatureInState(t){return t.getId()?this.drawingState.features.map(e=>e.id).includes(t.getId()):!1}createOlFeature(t){const e=t.geojson.geometry;let i;return e.type=="Disk"?i=new bt(new yi(e.center,e.radius)):i=new bt(new Ye().readFeatures(t.geojson)[0].getGeometry()),i.setId(t.id),i.setStyle(r=>this.getStyle(t,r)),i}setFixedLength(t){this.fixedLength=Number.isNaN(t)?0:t}createLineStringFixedLength(t,e){return Hi(this.fixedLength,t),e=e??new ct(t),e.setCoordinates(t),e}createSquareFixedLength(t,e,i){return Hi(this.fixedLength,t,Math.SQRT2),Ml(4)(t,e,i)}createPolygonFixedLength(t,e){const i=t[0];return Hi(this.fixedLength,i),e=e??new oe([i]),e.setCoordinates([i]),e}createDiskFixedLength(t,e){const i=t;return Hi(this.fixedLength,i),e=e??new yi(i[0],lt(i)),e.setCenterAndRadius(i[0],lt(i)),e}addDrawInteraction(t){this.removeDrawInteraction(),this.userInteractionManager.registerListener("map.select",!0,this.toolName),this.currentShape=t;let e,i;switch(t){case C.Point:i="Point";break;case C.Polyline:i="LineString",e=this.createLineStringFixedLength.bind(this);break;case C.Polygon:i="Polygon",e=this.createPolygonFixedLength.bind(this);break;case C.Disk:i="Circle",e=this.createDiskFixedLength.bind(this);break;case C.Square:i="Circle",e=this.createSquareFixedLength.bind(this);break;case C.Rectangle:i="Circle",e=Nl();break;case C.FreehandPolyline:i="LineString";break;case C.FreehandPolygon:i="Polygon";break}this.draw=new ga({source:this.drawingSource,type:i,freehand:t==C.FreehandPolyline||t==C.FreehandPolygon,stopClick:!0,geometryFunction:e,condition:r=>yn(r)&&this.canExecute("map.draw"),style:r=>this.getStyle(new Dt(t,{},""),r)}),this.draw.on("drawend",()=>{var r,n;(r=this.draw)==null||r.removeLastPoint(),(n=this.draw)==null||n.finishDrawing()}),this.map.olMap.addInteraction(this.draw),this.addSnapInteraction()}centerViewOnFeature(t){var r;const e=this.getOlFeatureFromDrawingSource(t.id),i=(r=e==null?void 0:e.getGeometry())==null?void 0:r.getExtent();if(i){const n=je.getInstance().Config.search.minResolution;Kt.getInstance().zoomToExtent(i,n)}}getStyle(t,e){const i=e.getGeometry(),r="Bold "+t.measureFontSize+"px/1 "+t.font,n="Bold "+t.nameFontSize+"px/1 "+t.font,s="rgba(0, 0, 0, 0.4)",a=new ar({stroke:new cn({color:t.strokeColor,width:t.strokeWidth}),fill:new ce({color:t.fillColor}),image:new ta({radius:t.strokeWidth,fill:new ce({color:t.strokeColor})}),text:new hn({text:t.displayName?t.name:"",font:n,textBaseline:"bottom",offsetY:t.type==C.Point?2*t.nameFontSize:1.2*t.nameFontSize,fill:new ce({color:t.nameColor})})}),o=new ar({text:new hn({font:r,padding:[2,2,2,2],textBaseline:"bottom",offsetY:-1*t.nameFontSize,fill:new ce({color:t.measureColor})}),image:new $o({radius:6,points:3,angle:Math.PI,displacement:[0,8],fill:new ce({color:s})})}),c=[a],h=(d,m)=>{if(m!=""){const p=o.clone();p.setGeometry(d),p.getText().setText(m),c.push(p)}};if(i.getType()=="LineString"&&t.type!==C.Polyline&&t.type!==C.FreehandPolyline)return[];if(t.type==C.Point||i.getType()==="Point")h(i,t.getCoordText(i.getCoordinates()));else if(t.type==C.Polyline)i.forEachSegment((d,m)=>h(Me([d,m]),t.getLengthText(lt([d,m]))));else if(t.type==C.Polygon){const d=i,m=this.ensurePolygonIsProperlyClosed(d);new ct(m).forEachSegment((p,b)=>h(Me([p,b]),t.getLengthText(lt([p,b])))),h(d.getInteriorPoint(),t.getAreaText(Ne(d)))}else if(t.type==C.Disk){const d=i.getRadius(),m=i.getCenter(),p=[m,[m[0]+d,m[1]]],b=a.clone();b.setStroke(new cn({color:s,width:t.strokeWidth})),b.getText().setText(""),b.setGeometry(t.displayMeasure?new ct(p):new ct([])),c.push(b),h(Me(p),t.getLengthText(d))}else if(t.type==C.FreehandPolygon){const d=i;this.ensurePolygonIsProperlyClosed(d),h(d.getInteriorPoint(),t.getAreaText(Ne(d))),h(new Et(d.getCoordinates()[0][0]),t.getLengthText(lt(d.getCoordinates()[0])))}else if(t.type==C.FreehandPolyline){const d=i;h(new Et(d.getCoordinates()[0]),t.getLengthText(lt(d.getCoordinates())))}else if(t.type==C.Rectangle){const d=i,m=[d.getCoordinates()[0][0],d.getCoordinates()[0][1]],p=[d.getCoordinates()[0][1],d.getCoordinates()[0][2]];h(Me(m),t.getLengthText(lt(m))),h(Me(p),t.getLengthText(lt(p))),h(d.getInteriorPoint(),t.getAreaText(Ne(d)))}else if(t.type==C.Square){const d=i,m=[d.getCoordinates()[0][0],d.getCoordinates()[0][1]];h(Me(m),t.getLengthText(lt(m))),h(d.getInteriorPoint(),t.getAreaText(Ne(d)))}if(t.selected){const d=t.getVertexStyle();d.setGeometry(function(m){const p=m==null?void 0:m.getGeometry();if(p&&p instanceof ra)return Ms(p)}),c.push(d)}return c}ensurePolygonIsProperlyClosed(t){const e=t.getCoordinates()[0];let i=[...e];return e.length>2&&e[0][0]!=e[e.length-1][0]&&(i=[...e,e[0]],t.setCoordinates([i])),i}removeDrawInteraction(){this.draw&&(this.map.olMap.removeInteraction(this.draw),this.draw=null),this.userInteractionManager.unregisterListener("map.select",this.toolName)}removeModifyInteraction(){this.modify&&(this.map.olMap.removeInteraction(this.modify),this.modify=null)}removeSnapInteraction(){this.snap&&(this.map.olMap.removeInteraction(this.snap),this.snap=null)}removeEditContextMenu(){this.editContextMenu&&(this.editContextMenu.remove(),this.editContextMenu=null)}registerInteractions(){this.userInteractionManager.registerListener("map.draw",!0,this.toolName),this.userInteractionManager.registerListener("map.modify",!0,this.toolName),this.userInteractionManager.registerListener("map.snap",!0,this.toolName)}unregisterInteractions(){this.removeDrawInteraction(),this.removeEditInteractions(),this.userInteractionManager.unregisterListener("map.draw",this.toolName),this.userInteractionManager.unregisterListener("map.modify",this.toolName),this.userInteractionManager.unregisterListener("map.snap",this.toolName)}canExecute(t){return this.userInteractionManager.canListenerExecute(t,this.toolName)}}const La=Ha.CLAMP_TO_GROUND;function yr(g){const t=ge.fromCartesian(g),e=[Qi.toDegrees(t.longitude),Qi.toDegrees(t.latitude),t.height];return Er("EPSG:4326",ae.getInstance().state.projection,e)}function Ki(g,t){return new As(ge.fromCartesian(g),ge.fromCartesian(t)).surfaceDistance}function ee(g,t=null,e=-15,i=null){if(t==null){const r=new Dt(C.Point);t=r.nameFontSize+"px"+r.font}return{text:g,font:t,pixelOffset:new Ya(0,e),fillColor:i??Se.fromCssColorString("#000000"),heightReference:La}}function nn(g=null){return g==null&&(g=Se.fromCssColorString(new Dt(C.Point).strokeColor)),{color:g,pixelSize:5,heightReference:La}}function sn(g){return D.divideByScalar(g.reduce((t,e)=>D.add(t,e,new D),new D),g.length,new D)}function di(g,t,e){return t.slice(0,-1).map((i,r)=>new vt({position:D.lerp(t[r],t[r+1],.5,new D),label:ee(g.getLengthText(Ki(t[r],t[r+1])),e)}))}function an(g){let t=0;for(let e=0;e<g.length-1;e++){const i=yr(g[e]),r=yr(g[e+1]);t+=i[0]*r[1]-r[0]*i[1]}return Math.abs(t)/2}function Yi(g,t){return{positions:new wi(()=>g,!1),clampToGround:!0,width:t.strokeWidth,material:Se.fromCssColorString(t.strokeColor)}}function Wi(g,t){return new vt({polygon:{hierarchy:new wi(()=>new Wa(g),!1),material:Se.fromCssColorString(t.fillColor)},polyline:{positions:new wi(()=>[...g,g[0]],!1),clampToGround:!0,width:t.strokeWidth,material:Se.fromCssColorString(t.strokeColor)}})}class kg{constructor(t,e){l(this,"toolName");l(this,"state");l(this,"userInteractionManager");l(this,"activeShapePoints",[]);l(this,"activeShapes",[]);l(this,"floatingPoint");l(this,"scene");l(this,"handler");l(this,"entities");l(this,"fixedLength",0);this.toolName=e,this.state=ae.getInstance().state,this.userInteractionManager=fn.getInstance(),ae.getInstance().subscribe("globe.loaded",()=>{this.state.globe.loaded&&(this.scene=t.map3d.getCesiumScene(),this.handler=new dl(this.scene.canvas),this.entities=t.map3d.getDataSourceDisplay().defaultDataSource.entities,t.stateManager.subscribe("extendedState.drawing.activeTool",(i,r)=>r===null?this.deactivateTool():this.activateTool(r)))})}setFixedLength(t){this.fixedLength=Number.isNaN(t)?0:t}activateTool(t){this.canExecute("globe.draw")&&(this.handler.setInputAction(this.addPoint(t),Le.LEFT_CLICK),this.handler.setInputAction(this.updateShape(t),Le.MOUSE_MOVE),this.handler.setInputAction(this.removeLastPointAndTerminateShape(t),Le.LEFT_DOUBLE_CLICK),this.floatingPoint&&this.entities.remove(this.floatingPoint),this.floatingPoint=new vt({position:new D,point:nn(),label:ee("",null,-30)}),this.entities.add(this.floatingPoint))}deactivateTool(){this.handler&&(this.handler.removeInputAction(Le.LEFT_CLICK),this.handler.removeInputAction(Le.MOUSE_MOVE),this.handler.removeInputAction(Le.LEFT_DOUBLE_CLICK),this.floatingPoint&&this.entities.remove(this.floatingPoint),this.floatingPoint=void 0)}pickOnGlobe(t){const e=this.scene.camera.getPickRay(t);return e==null?void 0:this.scene.globe.pick(e,this.scene)}removeLastPointAndTerminateShape(t){return()=>{this.activeShapePoints=this.activeShapePoints.slice(0,-1),this.terminateShape(t)}}terminateShape(t){var n,s;const e=this.activeShapePoints.slice(0,-1),i=this.getShapes(t,e,new Dt(t));this.activeShapes.forEach(a=>this.entities.remove(a));const r=new Dt(t);if(t==C.Disk){const a=jr.WGS84.cartesianToCartographic(i[0].position.getValue(as.now())),o=[Qi.toDegrees(a.longitude),Qi.toDegrees(a.latitude)];r.geojson={type:"Feature",geometry:{type:"Disk",center:Er("EPSG:4326",this.state.projection,o),radius:(s=(n=i[0].ellipse)==null?void 0:n.semiMajorAxis)==null?void 0:s.getValue(as.now())}},r.addToState()}else{const a=new ul;a.add(i[0]),ml({entities:a}).then(o=>{const c=new _n().readFeatures(o.kml,{dataProjection:"EPSG:4326",featureProjection:this.state.projection});r.geojson=JSON.parse(new Ye().writeFeature(c[0]));const h=r.geojson;h.geometry.type=="GeometryCollection"&&(h.geometry=h.geometry.geometries[1]),r.addToState()})}this.activeShapes=[],this.activeShapePoints=[]}fixLastLength(t,e,i){if(this.fixedLength>0&&t!=C.Rectangle){const r=t==C.Square?Math.SQRT2/2:1,n=new As(ge.fromCartesian(i[i.length-2]),ge.fromCartesian(i[i.length-1])).interpolateUsingSurfaceDistance(e*r);i[i.length-1]=ge.toCartesian(n)}}updateShape(t){return e=>{var r,n;const i=this.pickOnGlobe(e.endPosition);i&&(this.activeShapes.length>0&&(t==C.FreehandPolyline||t==C.FreehandPolygon?this.activeShapePoints.push(i):(this.activeShapePoints[this.activeShapePoints.length-1]=i,this.fixLastLength(t,this.fixedLength,this.activeShapePoints)),this.activeShapes.forEach(s=>this.entities.remove(s)),this.activeShapes=this.getShapes(t,this.activeShapePoints,new Dt(t)),this.activeShapes.forEach(s=>this.entities.add(s))),((r=this.floatingPoint)==null?void 0:r.position).setValue(i),((n=this.floatingPoint)==null?void 0:n.label.text).setValue(new Dt(t).getCoordText(yr(i))))}}addPoint(t){return e=>{const i=this.pickOnGlobe(e.position);i&&(this.activeShapePoints.push(i),this.activeShapePoints.length===1&&(this.activeShapePoints.push(i),this.activeShapes=this.getShapes(t,this.activeShapePoints,new Dt(t)),this.activeShapes.forEach(r=>this.entities.add(r))),(t===C.Point&&this.activeShapePoints.length===2||t===C.Disk&&this.activeShapePoints.length===3||t===C.Square&&this.activeShapePoints.length===3||t===C.Rectangle&&this.activeShapePoints.length===3)&&this.terminateShape(t))}}leveledCenterToMouse(t){const e=D.normalize(t[0],new D),i=D.subtract(t[1],t[0],new D),r=-(i.x*e.x+i.y*e.y+i.z*e.z);return D.add(i,D.multiplyByScalar(e,r,new D),i)}makeRectangle(t){if(t.length<2)return[t[0],t[0],t[0],t[0]];const e=jr.WGS84.cartesianToCartographic(t[0]),i=jr.WGS84.cartesianToCartographic(t[1]),r=e.clone();r.latitude=i.latitude;const n=e.clone();return n.longitude=i.longitude,[t[0],ge.toCartesian(r),t[1],ge.toCartesian(n),t[0]]}makeRegularPolygon(t,e,i){if(e.equals(t))return[t];const r=this.leveledCenterToMouse([t,e]),n=D.normalize(r,new D),s=D.normalize(D.cross(t,n,new D),new D),a=D.magnitude(r),o=[];for(let c=0;c<2*Math.PI;c+=2*Math.PI/i){const h=D.multiplyByScalar(n,a*Math.cos(c),new D),d=D.multiplyByScalar(s,a*Math.sin(c),new D);o.push(D.add(t,D.add(h,d,new D),new D))}return[...o,o[0]]}getShapes(t,e,i){const r=Se.fromCssColorString(i.strokeColor),n=i.nameFontSize+"px"+i.font;e=e.map(a=>a.clone());const s=[...e,e[0]];switch(t){case C.Point:return[new vt({position:e[0],point:nn(r),label:ee(i.getCoordText(yr(e[0])),n)})];case C.Polyline:return[new vt({polyline:Yi(e,i)}),...di(i,e,n)];case C.Polygon:return[Wi(e,i),...di(i,s,n),new vt({position:sn(e),label:ee(e.length<4?"":i.getAreaText(an(s)),n)})];case C.FreehandPolyline:return[new vt({polyline:Yi(e,i)}),new vt({position:e[Math.ceil(e.length/2)],label:ee(i.getLengthText(e.slice(0,-1).map((a,o)=>Ki(e[o],e[o+1])).reduce((a,o)=>a+o,0)),n)})];case C.FreehandPolygon:return[Wi(e,i),new vt({position:sn(e),label:ee(e.length<4?"":i.getAreaText(an(s)),n)}),new vt({position:e[Math.ceil(e.length/2)],label:ee(i.getLengthText(s.slice(0,-1).map((a,o)=>Ki(s[o],s[o+1])).reduce((a,o)=>a+o,0)),n)})];case C.Disk:return[new vt({position:e[0],ellipse:{semiMinorAxis:new wi(()=>D.magnitude(this.leveledCenterToMouse(e)),!1),semiMajorAxis:new wi(()=>D.magnitude(this.leveledCenterToMouse(e)),!1),material:Se.fromCssColorString(i.fillColor)},polyline:Yi(this.makeRegularPolygon(e[0],e[e.length-1],300),i),point:nn(r)}),new vt({polyline:Yi(s,i)}),...di(i,s,n)];case C.Square:{const a=this.makeRegularPolygon(e[0],e[e.length-1],4);return[Wi(a,i),...a.length>=2?di(i,[a[0],a[1]],n):[],new vt({position:e[0],label:ee(i.getAreaText(Math.pow(Math.SQRT2*Ki(e[0],e[1]),2)),n)})]}case C.Rectangle:{const a=this.makeRectangle(e);return[Wi(a,i),...a.length>=2?di(i,[a[0],a[1],a[2]],n):[],new vt({position:sn(e),label:ee(i.getAreaText(an(this.makeRectangle(e))),n)})]}default:throw Error(`Unrecognized tool : ${t}`)}}registerInteractions(){this.userInteractionManager.registerListener("globe.select",!0,this.toolName),this.userInteractionManager.registerListener("globe.draw",!0,this.toolName)}unregisterInteractions(){this.deactivateTool(),this.userInteractionManager.unregisterListener("globe.select",this.toolName),this.userInteractionManager.unregisterListener("globe.draw",this.toolName)}canExecute(t){return this.userInteractionManager.canListenerExecute(t,this.toolName)}}const Sg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l320 0c35.3 0 64-28.7 64-64l0-320c0-35.3-28.7-64-64-64L64 32zM337 209L209 337c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47L303 175c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z"/></svg>',Eg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M384 80c8.8 0 16 7.2 16 16l0 320c0 8.8-7.2 16-16 16L64 432c-8.8 0-16-7.2-16-16L48 96c0-8.8 7.2-16 16-16l320 0zM64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l320 0c35.3 0 64-28.7 64-64l0-320c0-35.3-28.7-64-64-64L64 32z"/></svg>',Cg=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <mask id="mask0_132_1886" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="24" height="24">
  <rect width="24" height="24" fill="#D9D9D9"/>
  </mask>
  <g mask="url(#mask0_132_1886)">
  <path d="M7 21C6.45 21 5.97917 20.8042 5.5875 20.4125C5.19583 20.0208 5 19.55 5 19V6C4.71667 6 4.47917 5.90417 4.2875 5.7125C4.09583 5.52083 4 5.28333 4 5C4 4.71667 4.09583 4.47917 4.2875 4.2875C4.47917 4.09583 4.71667 4 5 4H9C9 3.71667 9.09583 3.47917 9.2875 3.2875C9.47917 3.09583 9.71667 3 10 3H14C14.2833 3 14.5208 3.09583 14.7125 3.2875C14.9042 3.47917 15 3.71667 15 4H19C19.2833 4 19.5208 4.09583 19.7125 4.2875C19.9042 4.47917 20 4.71667 20 5C20 5.28333 19.9042 5.52083 19.7125 5.7125C19.5208 5.90417 19.2833 6 19 6V19C19 19.55 18.8042 20.0208 18.4125 20.4125C18.0208 20.8042 17.55 21 17 21H7ZM17 6H7V19H17V6ZM10 17C10.2833 17 10.5208 16.9042 10.7125 16.7125C10.9042 16.5208 11 16.2833 11 16V9C11 8.71667 10.9042 8.47917 10.7125 8.2875C10.5208 8.09583 10.2833 8 10 8C9.71667 8 9.47917 8.09583 9.2875 8.2875C9.09583 8.47917 9 8.71667 9 9V16C9 16.2833 9.09583 16.5208 9.2875 16.7125C9.47917 16.9042 9.71667 17 10 17ZM14 17C14.2833 17 14.5208 16.9042 14.7125 16.7125C14.9042 16.5208 15 16.2833 15 16V9C15 8.71667 14.9042 8.47917 14.7125 8.2875C14.5208 8.09583 14.2833 8 14 8C13.7167 8 13.4792 8.09583 13.2875 8.2875C13.0958 8.47917 13 8.71667 13 9V16C13 16.2833 13.0958 16.5208 13.2875 16.7125C13.4792 16.9042 13.7167 17 14 17Z" fill="#1C1B1F"/>
  </g>
</svg>
  `,Ig='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M256 0c17.7 0 32 14.3 32 32V66.7C368.4 80.1 431.9 143.6 445.3 224H480c17.7 0 32 14.3 32 32s-14.3 32-32 32H445.3C431.9 368.4 368.4 431.9 288 445.3V480c0 17.7-14.3 32-32 32s-32-14.3-32-32V445.3C143.6 431.9 80.1 368.4 66.7 288H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H66.7C80.1 143.6 143.6 80.1 224 66.7V32c0-17.7 14.3-32 32-32zM128 256a128 128 0 1 0 256 0 128 128 0 1 0 -256 0zm128-80a80 80 0 1 1 0 160 80 80 0 1 1 0-160z"/></svg>',Lg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM144 256a144 144 0 1 1 288 0 144 144 0 1 1 -288 0zm144-64c0 35.3-28.7 64-64 64c-7.1 0-13.9-1.2-20.3-3.3c-5.5-1.8-11.9 1.6-11.7 7.4c.3 6.9 1.3 13.8 3.2 20.7c13.7 51.2 66.4 81.6 117.6 67.9s81.6-66.4 67.9-117.6c-11.1-41.5-47.8-69.4-88.6-71.1c-5.8-.2-9.2 6.1-7.4 11.7c2.1 6.4 3.3 13.2 3.3 20.3z"/></svg>',Tg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c8.4-19.3 10.6-41.4 4.8-63.3c-11.1-41.5-47.8-69.4-88.6-71.1c-5.8-.2-9.2 6.1-7.4 11.7c2.1 6.4 3.3 13.2 3.3 20.3c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zM373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5L373 389.9z"/></svg>';class Mg extends Y{constructor(){super("drawing");l(this,"template",()=>{var e,i,r;return _`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style><style>
input{border:1px solid var(--bkg-color-grad1);width:inherit;padding-right:0;background-color:var(--bkg-color-input)}input:focus{border:1px solid var(--lt-color-gray-900)}button{border:solid 1px var(--bkg-color);color:var(--text-color);padding:0;background-color:var(--bkg-color);cursor:pointer}button:hover{border:solid 1px var(--text-color-grad2)}button.selected{border:solid 1px var(--text-color-grad2);background-color:var(--bkg-color-grad1);color:var(--bkg-color)}#toolbar{display:flex;flex-wrap:wrap}.label-container{flex-grow:1}.icon{width:1.2rem;height:1.2rem;fill:var(--text-color);margin:3px;flex-shrink:0}.icon:hover{fill:var(--text-color-grad2)}.gg-icon-button:hover{border:none}.colorPicker{border-radius:5px;border:1px solid var(--text-color)}.picker_wrapper{transform:translateX(-250px)}.picker_arrow{transform:translateX(200px) rotate(90deg) scaleX(-1)!important}.picker_arrow::after,.picker_arrow::before,.picker_wrapper{background-color:var(--bkg-color)!important}.picker_arrow::before,.picker_wrapper{box-shadow:0 0 10px 1px var(--text-color-grad1)!important}.disabled{pointer-events:none;opacity:.5}#panel{display:flex;flex-direction:column;height:100%;color:var(--text-color)}#panel>div{padding:1rem}.toolParameters{display:grid;justify-content:left;grid-template-columns:auto auto 60px auto;align-items:center;margin-top:10px}.toolParameters>label{padding:0 5px}#drawingListContainer{overflow-y:auto;overflow-x:hidden;flex-grow:1}#drawingList{display:flex;flex-flow:column;gap:.15rem}#drawingList .girafe{position:relative;display:flex;flex-wrap:wrap;align-items:center;padding:.3rem;border:solid 1px var(--text-color)}#drawingList .girafe span{flex-grow:1;padding-left:5px}#options{display:flex;flex-direction:column;box-shadow:0 -2px 3px -1px var(--text-color-grad1);position:relative;z-index:100}#optionsTitle{margin-bottom:20px;text-align:center;font-size:1.2rem}#options hr{width:100%;margin:8px}#optionsColorLine,#optionsLineLines,#optionsTextLines{display:grid;align-items:center}#optionsText{margin:auto}#optionsTextLines{grid-template-columns:65px 40px 35px 40px 20px 25px}#optionsTextLines button:hover{border:none}#optionsColor,#optionsExport,#optionsLine{margin:auto}#optionsColorLine{grid-template-columns:77px 70px 56px 26px}#optionsLineLines{grid-template-columns:60px 40px 20px}#optionsExportLine{display:flex;gap:.2rem;grid-template-columns:60px 60px 45px 45px}
</style>
<link rel="stylesheet" href="lib/vanilla-picker/vanilla-picker.csp.css" />
<link rel="stylesheet" href="styles/girafecolorpicker.css" />
<div id="panel">
  <div>
    <div id="toolbar">
      <button id="disable" tip="Disable drawing" class="gg-icon-button gg-medium">
        <img alt="select icon" src="icons/arrow.svg" />
      </button>
      <button id="point" tip="Point" class="gg-icon-button gg-medium">
        <img alt="point icon" src="icons/point.svg" />
      </button>
      <button id="line" tip="Line" class="gg-icon-button gg-medium">
        <img alt="polyline icon" src="icons/polyline.svg" />
      </button>
      <button id="polygon" tip="Polygon" class="gg-icon-button gg-medium">
        <img alt="polygon icon" src="icons/polygon.svg" />
      </button>
      <button id="square" tip="Square" class="gg-icon-button gg-medium">
        <img alt="square icon" src="icons/square.svg" />
      </button>
      <button id="rectangle" tip="Rectangle" class="gg-icon-button gg-medium">
        <img alt="rectangle icon" src="icons/rectangle.svg" />
      </button>
      <button id="circle" tip="Circle" class="gg-icon-button gg-medium">
        <img alt="circle icon" src="icons/circle.svg" />
      </button>
      <button id="freeline" tip="Freehand line" class="gg-icon-button gg-medium">
        <img alt="polyline-free icon" src="icons/polyline-free.svg" />
      </button>
      <button id="freepolygon" tip="Freehand polygon" class="gg-icon-button gg-medium">
        <img alt="polygon-free icon" src="icons/polygon-free.svg" />
      </button>
    </div>

    <div class="toolParameters">
      <button
        id="fixedLengthEnabled"
        class="${this.fixedLengthOptionAllowed()?"gg-icon-button icon":"gg-icon-button icon disabled"}"
        onclick="${()=>this.onToggleFixedLength()}">
        ${this.htmlUnsafe(this.fixedLengthEnabled?this.checkedIcon:this.noCheckedIcon)}
      </button>
      <label
        class="${this.fixedLengthEnabled&&this.fixedLengthOptionAllowed()?"gg-label":"gg-label disabled"}"
        for="fixedLengthValue"
        i18n="Fix length to"
        >Fix length to
      </label>
      <input
        class="${this.fixedLengthEnabled&&this.fixedLengthOptionAllowed()?"gg-input":"gg-input disabled"}"
        type="number"
        id="fixedLengthValue" />
      <label
        class="${this.fixedLengthEnabled&&this.fixedLengthOptionAllowed()?"gg-label":"gg-label disabled"}"
        for="fixedLengthValue"
        i18n="meters"
        >meters</label
      >
    </div>
  </div>
  <div id="drawingListContainer">
    <div id="drawingList">
      ${this.drawingState.features.map(n=>_t(n,n.id)`

      <div id="${"f-"+n.id}" class="girafe">
        <button
          id="${"f-select-"+n.id}"
          class="gg-icon-button gg-small"
          tip="Select to change appearance"
          onclick="${()=>this.onToggleFeatureSelection(n)}">
          <div class="icon">
            ${this.htmlUnsafe(n.selected?this.checkedIcon:this.noCheckedIcon)}
          </div>
        </button>

        <div class="label-container">
          <button
            class="${n.selected?"selectable-label gg-icon-button gg-small gg-selected":"selectable-label gg-icon-button gg-small gg-opacity"}"
            onclick="${()=>this.onToggleFeatureSelection(n)}">
            <span id="${"f-name-"+n.id}">${n.name}</span>
          </button>
        </div>

        <button
          class="gg-icon-button icon"
          tip="Center on shape"
          onclick="${()=>this.olDrawing.centerViewOnFeature(n)}">
          ${this.htmlUnsafe(this.locateIcon)}
        </button>

        <button class="gg-icon-button icon" tip="Delete shape" onclick="${()=>this.deleteFeature(n)}">
          ${this.htmlUnsafe(this.trashIcon)}
        </button>
      </div>
      `)}
    </div>
  </div>
  <div id="options" class="${this.selectedFeatures.length>0?"":"disabled"}">
    <input
      id="optionsTitle"
      type="text"
      value="${this.getOptionsTitle()}"
      class="${this.selectedFeatures.length>1?"gg-input disabled":"gg-input"}" />
    <div id="optionsText">
      <div id="optionsTextLines">
        <span i18n="Name">Name</span>
        <button
          class="gg-icon-button icon"
          id="visibleIconName"
          tip="Show or hide shape name"
          onclick="${()=>this.toggleNameVisibility()}">
          ${this.htmlUnsafe(this.isDisplayNameEnabled()?this.visibleIcon:this.notVisibleIcon)}
        </button>
        <span i18n="Font">Font</span>
        <input
          id="optionsNameFontSize"
          class="gg-input"
          type="number"
          min="1"
          value="${(e=this.selectedFeatures[0])==null?void 0:e.nameFontSize}"
          oninput="${()=>this.onOptionsChange()}" />
        <span>pt</span>
        <div class="icon colorPicker" id="nameColorPicker"></div>
        <span i18n="Measures">Measures</span>
        <button
          class="gg-icon-button icon"
          id="visibleIconMeasure"
          tip="Show or hide measure information"
          onclick="${()=>this.toggleMeasureVisibility()}">
          ${this.htmlUnsafe(this.isDisplayMeasureEnabled()?this.visibleIcon:this.notVisibleIcon)}
        </button>
        <span i18n="Font">Font</span>
        <input
          id="optionsMeasuresFontSize"
          class="gg-input"
          type="number"
          min="1"
          value="${(i=this.selectedFeatures[0])==null?void 0:i.measureFontSize}"
          oninput="${()=>this.onOptionsChange()}" />
        <span>pt</span>
        <div class="icon colorPicker" id="measureColorPicker"></div>
      </div>
    </div>
    <hr />
    <div id="optionsColor">
      <div id="optionsColorLine">
        <span i18n="Stroke color">Stroke color</span>
        <div class="icon colorPicker" id="strokePicker"></div>
        <span id="fillPickerSpan" class="${this.isFillColorEnabled()?"":"disabled"}" i18n="Fill color"
          >Fill color</span
        >
        <div class="${"icon colorPicker "+(this.isFillColorEnabled()?"":"disabled")}" id="fillPicker"></div>
      </div>
    </div>
    <hr />
    <div id="optionsLine">
      <div id="optionsLineLines">
        <span i18n="Line width">Line width</span>
        <input
          id="optionsStrokeWidth"
          type="number"
          class="gg-input"
          min="1"
          value="${(r=this.selectedFeatures[0])==null?void 0:r.strokeWidth}"
          oninput="${()=>this.onOptionsChange()}" />
        <span>px</span>
      </div>
    </div>
    <hr />
    <div id="optionsExport">
      <div id="optionsExportLine">
        <label for="export" class="gg-label" i18n="Export">Export</label>
        <button class="gg-button" onclick="${()=>this.exportSelectedFeatures("geojson")}">GeoJson</button>
        <button class="gg-button" onclick="${()=>this.exportSelectedFeatures("kml")}">KML</button>
        <button class="gg-button" onclick="${()=>this.exportSelectedFeatures("gpx")}">GPX</button>
      </div>
    </div>
  </div>
</div>
`});l(this,"checkedIcon",Sg);l(this,"noCheckedIcon",Eg);l(this,"trashIcon",Cg);l(this,"locateIcon",Ig);l(this,"visibleIcon",Lg);l(this,"notVisibleIcon",Tg);l(this,"visible",!1);l(this,"renderedOnce",!1);l(this,"drawingState");l(this,"colorPickers",[]);l(this,"buttons",[{id:"disable",tool:null},{id:"point",tool:C.Point},{id:"line",tool:C.Polyline},{id:"square",tool:C.Square},{id:"rectangle",tool:C.Rectangle},{id:"polygon",tool:C.Polygon},{id:"circle",tool:C.Disk},{id:"freeline",tool:C.FreehandPolyline},{id:"freepolygon",tool:C.FreehandPolygon}]);l(this,"toolSelected",null);l(this,"olDrawing");l(this,"cesiumDrawing");l(this,"fixedLengthEnabled",!1);l(this,"batchCreateMode",!1);this.state.extendedState.drawing||(this.state.extendedState.drawing=new Xa),this.drawingState=this.state.extendedState.drawing;const e=this.componentManager.getComponents(Fs)[0];this.olDrawing=new _g(e,this.name),this.cesiumDrawing=new kg(e,this.name),this.subscribe("extendedState.drawing.features",(i,r)=>this.onFeaturesChanged(i,r)),this.subscribe("projection",(i,r)=>this.onProjectionChanged(i,r)),this.subscribe("globe.loaded",()=>{this.state.globe.loaded&&this.visible?this.cesiumDrawing.registerInteractions():this.cesiumDrawing.unregisterInteractions()})}render(){super.render(),this.visible?this.renderComponent():this.hide(),this.activateTooltips(!1,[800,0],"top-end"),super.girafeTranslate()}renderComponent(){this.show(),this.renderedOnce||(this.renderedOnce=!0,this.buttons.forEach(e=>{this.getById(e.id).addEventListener("click",()=>{this.setTool(e.tool),e.tool&&(this.deselectAllFeatures(),this.refreshRender())})}),this.addColorPicker("nameColorPicker",e=>this.selectedFeatures.forEach(i=>i.nameColor=e.hex),()=>this.selectedFeatures[0].nameColor),this.addColorPicker("measureColorPicker",e=>this.selectedFeatures.forEach(i=>i.measureColor=e.hex),()=>this.selectedFeatures[0].measureColor),this.addColorPicker("fillPicker",e=>this.selectedFeatures.forEach(i=>i.fillColor=e.hex),()=>this.selectedFeatures[0].fillColor),this.addColorPicker("strokePicker",e=>this.selectedFeatures.forEach(i=>i.strokeColor=e.hex),()=>this.selectedFeatures[0].strokeColor),this.getById("optionsTitle").oninput=e=>{this.selectedFeatures[0].name=e.target.value,this.refreshRender()},this.getById("fixedLengthValue").oninput=e=>{const i=parseFloat(e.target.value);this.olDrawing.setFixedLength(i),this.cesiumDrawing.setFixedLength(i)},this.getById("fixedLengthEnabled").onchange=e=>{const i=Array.from(this.shadowRoot.querySelectorAll(".fixedLengthElement")),r=e.target;!r.disabled&&r.checked?(i.forEach(n=>n.classList.remove("disabled")),this.getById("fixedLengthValue").dispatchEvent(new Event("input"))):(i.forEach(n=>n.classList.add("disabled")),this.olDrawing.setFixedLength(0),this.cesiumDrawing.setFixedLength(0))},this.setTool()),this.warnWhenInWebMercator()}refreshRender(){this.selectedFeatures.length===1&&this.colorPickers.forEach(e=>e[0].setColor(e[1](),!1)),super.refreshRender()}registerEvents(){this.olDrawing.registerInteractions(),this.state.globe.loaded&&this.cesiumDrawing.registerInteractions()}unregisterEvents(){this.olDrawing.unregisterInteractions(),this.cesiumDrawing.unregisterInteractions()}addColorPicker(e,i,r){const n=this.getById(e),s=new aa({parent:n,popup:"top"},!0),a=o=>{i(o),n.style.backgroundColor=o.hex};s.onChange=a,s.onDone=a,this.colorPickers.push([s,r])}setTool(e=null){this.toolSelected!==null&&this.toolSelected.classList.remove("selected"),this.toolSelected=this.getById(this.buttons.find(i=>i.tool==e).id),this.toolSelected.classList.add("selected"),this.drawingState.activeTool=e}fixedLengthOptionAllowed(){return![null,C.Point,C.Rectangle,C.FreehandPolyline,C.FreehandPolygon].includes(this.drawingState.activeTool)}connectedCallback(){this.loadConfig().then(()=>{this.render(),this.subscribe("interface.drawingPanelVisible",(e,i)=>this.togglePanel(i)),this.subscribe("projection",(e,i)=>this.warnWhenInWebMercator(i))})}togglePanel(e){this.visible=e,this.visible?this.registerEvents():(this.setTool(null),this.deselectAllFeatures(),this.unregisterEvents()),this.render()}get selectedFeatures(){return this.drawingState.features.filter(e=>e.selected)}deselectAllFeatures(){for(const e of this.drawingState.features.keys())this.drawingState.features[e].selected=!1}onFeaturesChanged(e,i){e=e??[];const r=i.map(o=>o.id),n=e.map(o=>o.id),s=e.filter(o=>!r.includes(o.id)),a=i.filter(o=>!n.includes(o.id));if(!this.visible||this.batchCreateMode)this.deselectAllFeatures();else if(a.length>0)for(const[o,c]of this.drawingState.features.entries())this.drawingState.features[o].selected=a.map(h=>h.id).includes(c.id);s.length>0&&this.olDrawing.deleteFeatures(s),a.length>0&&this.olDrawing.addFeatures(a),this.visible&&(this.batchCreateMode||this.setTool(null),this.refreshRender())}onProjectionChanged(e,i){if(e!=null&&e!=i){const r=new Ye,n=[...this.drawingState.features];n.forEach(s=>{s.geojson=r.writeFeatureObject(r.readFeature(s.geojson,{dataProjection:e,featureProjection:i}))}),this.drawingState.features=[],this.drawingState.features=n}}onToggleBatchMode(){this.batchCreateMode=!this.batchCreateMode,this.batchCreateMode&&this.deselectAllFeatures(),this.refreshRender()}onToggleFixedLength(){this.fixedLengthEnabled=!this.fixedLengthEnabled;const e=this.fixedLengthEnabled?parseFloat(this.getById("fixedLengthValue").value):0;this.olDrawing.setFixedLength(e),this.cesiumDrawing.setFixedLength(e),this.refreshRender()}onToggleFeatureSelection(e){e.selected=!e.selected,this.refreshRender()}getOptionsTitle(){var e;return this.selectedFeatures.length<2?((e=this.selectedFeatures[0])==null?void 0:e.name)||"":`${this.selectedFeatures.length} Shapes selected`}isDisplayNameEnabled(){return this.selectedFeatures.some(e=>e.displayName)}isDisplayMeasureEnabled(){return this.selectedFeatures.some(e=>e.displayMeasure)}isFillColorEnabled(){return!this.selectedFeatures.every(e=>e.isPointOrPolyline())}async deleteFeature(e){if(await window.gConfirm(`Do you want to remove "${e.name}" ?`,"Delete Feature")){const r=this.drawingState.features.findIndex(n=>n.id===e.id);r>-1&&(this.drawingState.features.splice(r,1),this.refreshRender())}}onOptionsChange(){const e=parseInt(this.getById("optionsNameFontSize").value),i=parseInt(this.getById("optionsMeasuresFontSize").value),r=parseInt(this.getById("optionsStrokeWidth").value);this.selectedFeatures.forEach(n=>n.nameFontSize=e),this.selectedFeatures.forEach(n=>n.measureFontSize=i),this.selectedFeatures.forEach(n=>n.strokeWidth=r)}toggleNameVisibility(){const e=this.selectedFeatures.some(i=>i.displayName);this.selectedFeatures.forEach(i=>i.displayName=!e),this.refreshRender()}toggleMeasureVisibility(){const e=this.selectedFeatures.some(i=>i.displayMeasure);this.selectedFeatures.forEach(i=>i.displayMeasure=!e),this.refreshRender()}warnWhenInWebMercator(e=this.state.projection){this.visible&&e==="EPSG:3857"&&this.stateManager.state.infobox.elements.push({id:jt(),text:Vt.getInstance().getTranslation("Web Mercator projection distorts distances and areas"),type:"warning"})}exportSelectedFeatures(e){const i=[],r=this.selectedFeatures.length===1?this.selectedFeatures[0].name:"drawing_export";switch(this.selectedFeatures.forEach(n=>{let s=this.olDrawing.createOlFeature(n);if(n.type==C.Disk){const a=n.geojson,o=s.getStyle();s=new bt(new oe([Dt.circleToPolygon(a.geometry.center,a.geometry.radius)])),s.setStyle(o)}i.push(s)}),e){case"geojson":return ye(JSON.stringify(new Ye().writeFeaturesObject(i,{featureProjection:this.state.projection})),r+".geojson","application/geo+json");case"kml":return ye(new _n().writeFeatures(i,{featureProjection:this.state.projection}),r+".kml","application/vnd.google-earth.kml+xml");case"gpx":if(this.selectedFeatures.some(n=>!n.isPointOrPolyline()))Za.getInstance().pushMessage("export-gpx-error","The GPX format only supports points and polylines","warning");else return ye(new ia().writeFeatures(i,{featureProjection:this.state.projection}),r+".gpx","application/gpx+xml")}}}const Ng="data:image/webp;base64,UklGRtAJAABXRUJQVlA4WAoAAAAQAAAAywEAMgEAQUxQSHgIAAABsAMBtNpazl3WzF/wzIe3/HFGxYKWN5ySE5UKK+wwM7l8pcIqAioWXLoLM7n4oGJBweegP7wZvTDHZ0a690i6vjrnKOSIkOi2jSVJcYzyelKp2UFv9WP37gPUoMTG/9j4Hxv/49/Bcal36XAM77swGYzuMwHggzzHtscPv1vx74rnANi+lJd4Zk14MtPxVYDvPpObMoAvKKbjyQCcmF7lah7b+AJAZXpcuDqfrPjG36HGM1lYDSfblp7bl/KwmrYW6/ggVCB/sVECBmaKecxAR0J3Sy801Z8rSiHnI6rdOcL7lZJAUm56CeAURc5DemfNEZYVhZGQjMhVeH8x5J/BROiRrP78ViUJ3I/lPPTIVTCrymSRJWBi5FGo2rmiqCJTjJqU6QrEpLDNKIF2SiQmecILWyuZmI1iRE/vVko2AnAkI7p6l2/tprwRijBZM0YY6BVvLf/cIKho7YVdnZGGxMQcHEVSI3TwYPJGNqC8Nbahp/V7kWeE5Qx3POPAgb4hWdex0nqDmtv5Tudd9yqvg2gup0C81YBqQDiHPqIsS+u30sZh4/aHNG84rFoYJWAIyToRzcryzz2JP5c1ZtphbB/PgP5BPwd5DT+DpVlaknaZ+NYas1KHC8dUieOtJu5f7yejfSrQQ8yf3nJTVQTElddee+2VygruHnfBdGwDylmMayw1/H5lwsFY6VhWqD5CqpCeBICTaZrWU+nH3dhBvWzGah1YopgaPwi0YQkITqbRtYoxjNcBm1uqBgo+2+nvAQW1Bg1nxihNT+q7/3No2BCXqwZDUOLaSK/V+fu7qdj3msuvFNH8KAVA1dQgCeXTJS5Oykdci86H1WqJKSrKm8S1slFN9Uv9spocsZLRctda6E3SCTu6UiiqsTdpt/m4OCmQvDLCldGbNoGvKQ73ZFdF03J4lSzcFopG8Xu0ShJuN0XcGvJIzDUUqWIpjRYRevejMBA8SQJ5ZYrMan33Q+iV9HP458nmWZSbJ69kn9gsyhFkoCEfsR6j3NA7gSIeWakn62GwzBT9CHagRsx4xAYNl3pTrwq5Zxaw8TGWnFsj3eVkOwx2GB/ydqsxsFjOuGesxomZ7fD8/7zrZQMRobbaUIwgi9WgxMb/2PgfG/9j439s/I+N/0FxPGFQBrx4UMZPBkPc+EUH4oHhMHwGHIjJYBhuhF86EUNh+AxMHIjjMBCGG8GJUFANw2CEV7kQD1TDMBirSjdegBsHwfiAE3G8is8MgLF+xQn8sh4GwAjH3YjJABiOAMCOciMOVwFHZB+Z9rUj2KkiE/8Ih12JWPxDpn3tDOpYSH+cuHVAQiz40fzapeKF4EfXLpN2tO1F9GPsUsQg+Ckx6NXODZnMY+HgNVIMYp8yMUYHh4XI5xhXSC4OE4nP0Ts7OcARkc+BzNVvZyFtb2GOjg4TiXsTN/cZ3ZK3t+Py0bmQtxe7GYdB2lbm8qjURNg5AXyOi1NEXXMC6lh9RjkbN+jxqxMi5q+0+PENyl28V88HJBwP6OOLlcv4sZ7b8o1t1HPZEnK+ClDPfQtOSLfI8Nz/M3yzgWyJeo5bPxZwGqy8HiSIN7dBD4M9qXlAunyvUr3KbSHT/QZmSpY/Vkb0oYGZguUNqo8pVELNXqY4iTyc6GfObS/6zBOyIdahbwlrur/9zK843UFOkEml3vtjJG3vI/MTXKr5N9fK/sn15a+eyeNG/avVDetjv9Pyfv1iHq/U/BzgrbbfpxFvVX3FVgEGEmUTb63fp89chGet8yxKAjL3rWYBcJa3TKwfDCFOEvJsqCwi0t4nY2X2mQDKfucMkCrbEhK2eNb2weAjLFyl5dPuWqq2tJQBw7MIt5QiILGqxHbmPkf9rTOBVux5C9S0+mZZap+AZfo51qMiEflWwEzryTuTs236k1C1FnNrRuWKtn+6i8C+i75ZMswZavp2L9cSTvrbPdv6qDvTy2gxcWE3eWaIqcIoI8uEs6HdZJh+Di1cykzIbYmg4CKTszavgf2kq0vIhTQurN7gMrGkPdXgUoZg1iBsrssC7anGy2ZCReJb2US0JJ/FW9eg3lq7tIqziY1yPann1roUkaKhtW/nN6kh3U8mbDHMUQW6IlQ0lVtpQXTesgsA4/3d311aAIZHpuRufv74Edwo0kh1wv76TaZ0s/vv/ItdXFVHHMHY70/BorF/XCfNfKQro4Z6mKKK3vIWxi2qNbQkmfs7O+16U240bPK7Hdr6j1RJL6cdeEvtdK4nepNvbFtEUbsW1GZUcdyl726jw8mviP3qJQsXYfunpGYKrRlFRQGNW7qv2MH+qhSfWrRskRLKR3wrG3r1GralczQVgWqZxS00smX/dBffBabjah/gHf4jsEthpm37+1MdfoX9SgLYXyeFHCsZYf+YvkzrBxNiQp3U0fbGzX4L0jKFqUkpVVVJGMeyUlEUvfGbVOUthZh6RFGUFhX0+8JPEPXoV0I9bqkfuBXYQ5oxWfeFu7BbaEijKJLJa/gD8Eeoe0jj48+zq3ZcT7Xzi4zpmMinNNccPpxl+Qp0LBZZHAgggnixMP87nVWeHT6sTBBZGmemAXv1S8w7e7hzjaIY1TI5+lIcSMShty3vRpztAaJqh3xUBjBtBNkCdeLDigkcznLcYLg+z1o5pG/y2EqwyGIGVUN9iz2dg5VywIyYO9W2nrNyts7YAa7wet7K95gS8V7L3lyVxxlrIl6gtz6KRVStUcGUyuNGxVxrjkRgqFWb0zODrbkRQbbX6rkSo+WoYEOtkN4si5yL+9xYV7m9esZudRkQwaL7rQ/D1190r5HttdjTJVC+lxHtGr8PFQS2ohQA4OzdBMdz0mhrnxIHttLK+MNUEQ9hTD/5TjUgsW+fGpTY+B8b/2Pjf2z8j43/sVk1FFZQOCAyAQAAcCIAnQEqzAEzAT6RSKFNJaQjIiAIALASCWlu4XdhG0AJ7APfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOFAAA/v/eCKwuAAAAAAAAAAAAAAAAAAAA",Pg=""+new URL("arrow_white-hww14erJ.webp",import.meta.url).href;class Rg extends Y{constructor(){super("help");l(this,"template",()=>_`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style><style>
#content{z-index:10000;position:fixed;top:0;left:0;bottom:0;right:0;display:none}#themes{position:absolute;top:4.5rem;left:0;width:150px;height:120px;background-repeat:no-repeat;transform:rotateY(0) rotateX(0) rotateZ(90deg);background-position:bottom -50px left -60px}#search{position:absolute;top:8rem;left:45%;width:180px;height:70px;background-repeat:no-repeat;transform:rotateY(0) rotateX(0) rotateZ(90deg);background-position:-60px -30px}#menu{position:absolute;top:4.5rem;right:0;width:150px;height:120px;background-repeat:no-repeat;transform:rotateY(180deg) rotateX(0) rotateZ(90deg);background-position:bottom -50px left -60px}#basemap{position:absolute;bottom:3rem;left:21rem;width:150px;height:120px;background-repeat:no-repeat;transform:rotateY(0) rotateX(180deg) rotateZ(90deg);background-position:bottom -50px left -60px}#themes-descr{position:absolute;top:10rem;left:10rem;color:var(--bkg-color);font-size:1.2rem;width:12rem}#search-descr{position:absolute;top:16rem;left:45%;color:var(--bkg-color);font-size:1.2rem;width:12rem}#menu-descr{position:absolute;top:10rem;right:10rem;color:var(--bkg-color);font-size:1.2rem;width:12rem;text-align:right}#basemap-descr{position:absolute;bottom:9rem;left:31rem;color:var(--bkg-color);font-size:1.2rem;width:12rem}
</style>
<div id="content">
  <div id="themes"></div>
  <div id="themes-descr" i18n="help-themes">
    Clicking the Topics button opens the topic overview. After selecting the desired topic, all assigned maps are
    loaded.
  </div>

  <div id="search"></div>
  <div id="search-descr" i18n="help-search">Search for a place, an address, a map or a geographical data.</div>

  <div id="menu"></div>
  <div id="menu-descr" i18n="help-menu">
    This menu contains advanced functions such as printing, drawing, language, 3D view, etc...
  </div>

  <div id="basemap"></div>
  <div id="basemap-descr" i18n="help-basemap">Here, you can choose which background layers you want to use.</div>
</div>
`);l(this,"content");l(this,"themes");l(this,"search");l(this,"menu");l(this,"basemap");l(this,"darkFrontendMode",!1);l(this,"arrowBlack",Ng);l(this,"arrowWhite",Pg);l(this,"currentArrow")}render(){super.render(),this.content=this.shadow.querySelector("#content"),this.themes=this.shadow.querySelector("#themes"),this.search=this.shadow.querySelector("#search"),this.menu=this.shadow.querySelector("#menu"),this.basemap=this.shadow.querySelector("#basemap"),this.configManager.Config.basemaps.show||(this.shadow.querySelector("#basemap").style.display="none",this.shadow.querySelector("#basemap-descr").style.display="none")}registerEvents(){this.subscribe("interface.helpVisible",(e,i)=>this.toggleHelp(i)),this.subscribe("interface.darkFrontendMode",(e,i)=>{this.darkFrontendMode=i}),this.content.addEventListener("click",()=>{this.state.interface.helpVisible=!1})}changeArrowColor(){this.darkFrontendMode=this.stateManager.state.interface.darkFrontendMode,this.currentArrow=this.darkFrontendMode?this.arrowBlack:this.arrowWhite,this.themes.style.backgroundImage=`url(${this.currentArrow})`,this.search.style.backgroundImage=`url(${this.currentArrow})`,this.menu.style.backgroundImage=`url(${this.currentArrow})`,this.basemap.style.backgroundImage=`url(${this.currentArrow})`,this.content.style.backgroundColor=this.darkFrontendMode?"rgba(255, 255, 255, 0.65)":"rgba(0, 0, 0, 0.65)"}toggleHelp(e){e?(this.changeArrowColor(),this.content.style.display="block"):this.content.style.display="none"}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}}class Ta extends Y{constructor(e){super(e);l(this,"button");l(this,"div");l(this,"header");l(this,"closeButton");l(this,"container");l(this,"pos1",0);l(this,"pos2",0);l(this,"pos3",0);l(this,"pos4",0)}get host(){return this.shadow.getRootNode().host}makeDraggable(e){this.container=e||document.querySelector("#content"),this.div=this.shadow.querySelector("#draggable"),this.header=this.shadow.querySelector("#header"),this.setDefaultPosition(),this.header.onmousedown=i=>this.dragMouseDown(this,i),window.addEventListener("resize",Li(()=>this.resize(this),200)),this.closeButton=this.shadow.getElementById("close"),this.isNullOrUndefined(this.closeButton)||(this.closeButton.onclick=()=>this.closeWindow())}setDefaultPosition(){const e=getComputedStyle(this.host);this.host.style.top=e.top,this.host.style.left=e.left}closeWindow(){throw new Error("This function must be overriden to close the associated window")}dragMouseDown(e,i){i.preventDefault(),e.pos3=i.clientX,e.pos4=i.clientY,document.onmouseup=()=>e.closeDragElement(),document.onmousemove=r=>e.elementDrag(e,r)}elementDrag(e,i){i.preventDefault();const r=e.host.getBoundingClientRect(),n=e.pos3-i.clientX,s=e.host.offsetLeft-n,a=s+r.width;s<0?e.host.style.left="0px":a>this.getContainerWidth()?e.host.style.left=this.getContainerWidth()-r.width+"px":(e.pos1=n,e.pos3=i.clientX,e.host.style.left=s+"px");const o=e.pos4-i.clientY,c=e.host.offsetTop-o,h=c+r.height;c<0?e.host.style.top="0px":h>this.getContainerHeight()?e.host.style.top=this.getContainerHeight()-r.height+"px":(e.pos2=o,e.pos4=i.clientY,e.host.style.top=c+"px")}getContainerWidth(){var e,i;return Math.max((e=this.container)==null?void 0:e.scrollWidth,(i=this.container)==null?void 0:i.offsetWidth)}getContainerHeight(){var e,i;return Math.max((e=this.container)==null?void 0:e.scrollHeight,(i=this.container)==null?void 0:i.offsetHeight)}resize(e){const i=this.getContainerWidth(),r=this.getContainerHeight(),n=e.host.style.left,s=e.host.style.top;parseInt(n)+e.host.offsetWidth>i&&(e.host.style.left=i-e.host.offsetWidth+"px"),parseInt(s)+e.host.offsetHeight>r&&(e.host.style.top=r-e.host.offsetHeight+"px")}closeDragElement(){document.onmouseup=null,document.onmousemove=null}}class Ma{constructor(t){l(this,"directions",["tl","t","tr","r","br","b","bl","l"]);l(this,"shadow");l(this,"host");l(this,"top",0);l(this,"left",0);l(this,"minHeight",0);l(this,"maxHeight",0);l(this,"minWidth",0);l(this,"maxWidth",0);l(this,"height",0);l(this,"width",0);l(this,"originX",0);l(this,"originY",0);l(this,"elements",[]);l(this,"className","girafe-resizer");this.shadow=t,this.host=this.shadow.getRootNode().host,this.init()}init(){this.destroy(),this.elements=this.directions.map(t=>this.attachEvent(t))}destroy(){this.elements.filter(t=>t!==null).forEach(t=>t.onmousedown=null),this.elements=[]}attachEvent(t){const e=this.shadow.querySelector(`.${this.className}.${t}`);return e?(e.onmousedown=i=>{this.onResizeStarts(i,t)},e):null}onResizeStarts(t,e){this.originX=t.clientX,this.originY=t.clientY;const i=this.host.getBoundingClientRect();this.width=i.width,this.height=i.height;const r=getComputedStyle(this.host);this.minHeight=parseInt(r.minHeight)||0,this.maxHeight=parseInt(r.maxHeight)||1/0,this.minWidth=parseInt(r.minWidth)||0,this.maxWidth=parseInt(r.maxWidth)||1/0,this.top=parseInt(r.top)||0,this.left=parseInt(r.left)||0,document.onmousemove=n=>this.resize(n,e),document.onmouseup=()=>this.stopResize()}resize(t,e){const[i,r,n,s]=this.getNewSizeAndPosition(t.clientX,t.clientY,e);this.host.style.top=`${i}px`,this.host.style.left=`${r}px`,this.host.style.width=`${s}px`,this.host.style.height=`${n}px`}getNewSizeAndPosition(t,e,i){let r=this.height,n=this.width,s=this.top,a=this.left,o=t-this.originX,c=e-this.originY;if(i.includes("t")){const h=this.height-c;r=Ai(h,this.minHeight,this.maxHeight),r!==h&&(c=(r-this.height)*-1),s=this.top+c}else i.includes("b")&&(r=Ai(this.height+c,this.minHeight,this.maxHeight));if(i.includes("l")){const h=this.width-o;n=Ai(h,this.minWidth,this.maxWidth),n!==h&&(o=(n-this.width)*-1),a=this.left+o}else i.includes("r")&&(n=Ai(this.width+o,this.minWidth,this.maxWidth));return[s,a,r,n]}stopResize(){document.onmousemove=null,document.onmouseup=null}}class Ag extends Ta{constructor(){super("infowindow");l(this,"template",()=>_`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style><style>
.girafe-resizer{--resize-size:6px;--negative-resize-size:-6px}button.girafe-resizer{position:absolute;background-color:transparent;border:none}.girafe-resizer.corner{width:var(--resize-size);height:var(--resize-size)}.girafe-resizer.top-bottom{width:calc(100% - (2 * var(--resize-size)));height:var(--resize-size)}.girafe-resizer.left-right{width:var(--resize-size);height:calc(100% - (2 * var(--resize-size)))}.girafe-resizer.br:hover,.girafe-resizer.tl:hover{cursor:nw-resize}.girafe-resizer.bl:hover,.girafe-resizer.tr:hover{cursor:ne-resize}.girafe-resizer.top-bottom:hover{cursor:n-resize}.girafe-resizer.left-right:hover{cursor:e-resize}.girafe-resizer.tl{top:var(--negative-resize-size);left:var(--negative-resize-size)}.girafe-resizer.t{top:var(--negative-resize-size);left:var(--resize-size)}.girafe-resizer.tr{top:var(--negative-resize-size);right:var(--negative-resize-size)}.girafe-resizer.r{top:var(--resize-size);right:var(--negative-resize-size)}.girafe-resizer.br{bottom:var(--negative-resize-size);right:var(--negative-resize-size)}.girafe-resizer.b{bottom:var(--negative-resize-size);left:var(--resize-size)}.girafe-resizer.bl{bottom:var(--negative-resize-size);left:var(--negative-resize-size)}.girafe-resizer.l{top:var(--resize-size);left:var(--negative-resize-size)}.girafe-draggable-window{--window-header-height:2rem;--window-footer-height:2rem;border:solid 1px var(--text-color-grad1);border-radius:3px;box-shadow:var(--bx-shdw);background:var(--bkg-color);width:100%;height:100%}.girafe-draggable-window #header{height:var(--window-header-height);line-height:var(--window-header-height);padding:0 .5rem;cursor:move;z-index:10;background-color:var(--bkg-color-grad2);color:var(--text-color);text-align:center}.girafe-draggable-window #close{border:none;color:var(--text-color);padding:0;margin:.5rem;width:1rem;height:1rem;line-height:1rem;position:absolute;top:0;right:0;background-color:transparent;cursor:pointer}.girafe-draggable-window #close i:before{content:'\uf00d'}.girafe-draggable-window #close:hover{border-color:#000;color:#000}.girafe-draggable-window #content{width:100%;height:calc(100% - (var(--window-header-height) + var(--window-footer-height)));color:var(--text-color);overflow-y:auto}.girafe-draggable-window #footer{height:var(--window-footer-height);color:var(--text-color-grad1);border-top:solid 1px var(--text-color-grad1);display:flex;justify-content:space-around}
</style><style>
#content{padding-left:1rem;width:calc(100% - 1rem)!important;height:calc(100% - var(--window-header-height))!important;overflow-y:hidden!important;background-color:#fff}iframe{border:none;width:100%;height:100%;background:#fff}
</style>
<div id="draggable" class="girafe-draggable-window">
  <!--  Resize buttons-->
  <button tabindex="-1" class="girafe-resizer tl corner"></button>
  <button tabindex="-1" class="girafe-resizer t top-bottom"></button>
  <button tabindex="-1" class="girafe-resizer tr corner"></button>
  <button tabindex="-1" class="girafe-resizer r left-right"></button>
  <button tabindex="-1" class="girafe-resizer br corner"></button>
  <button tabindex="-1" class="girafe-resizer b top-bottom"></button>
  <button tabindex="-1" class="girafe-resizer bl corner"></button>
  <button tabindex="-1" class="girafe-resizer l left-right"></button>

  <div id="header">
    <span i18n="${this.state.infoWindow.title}"></span>
    <img id="close" alt="close-icon" src="icons/close.svg" />
  </div>
  <div id="content">
    <iframe title="iframe content" src="${this.state.infoWindow.url}"></iframe>
  </div>
</div>
`);l(this,"visible",!1);l(this,"resizeWindow",null);window.gOpenWindow=(e,i,r,n,s,a)=>{this.state.infoWindow.title=e,this.state.infoWindow.url=i,this.state.infoWindow.width=r??null,this.state.infoWindow.height=n??null,this.state.infoWindow.top=s??null,this.state.infoWindow.left=a??null,this.state.interface.infoWindowVisible=!0},this.updateWindowSizeAndPosition()}registerEvents(){this.subscribe("interface.infoWindowVisible",(e,i)=>{this.visible=i,this.render()}),this.subscribe(/infoWindow\.(width|height|top|left)/,(e,i)=>{e!==i&&(this.updateWindowSizeAndPosition(),this.render())}),this.subscribe(/infoWindow\.(url|title)/,()=>this.render())}render(){this.visible?this.renderComponent():this.renderEmptyComponent()}renderComponent(){super.render(),this.girafeTranslate(),this.resizeWindow=new Ma(this.shadow),this.makeDraggable()}renderEmptyComponent(){var e;(e=this.resizeWindow)==null||e.destroy(),this.resizeWindow=null,this.renderEmpty()}updateWindowSizeAndPosition(){const e=this.configManager.Config.infoWindow,i=this.shadow.getRootNode().host;i.style.width=this.configToCssValue(this.state.infoWindow.width)??e.defaultWindowWidth,i.style.height=this.configToCssValue(this.state.infoWindow.height)??e.defaultWindowHeight,i.style.top=this.configToCssValue(this.state.infoWindow.top)??e.defaultWindowPositionTop,i.style.left=this.configToCssValue(this.state.infoWindow.left)??e.defaultWindowPositionLeft}closeWindow(){this.state.interface.infoWindowVisible=!1}connectedCallback(){this.loadConfig().then(()=>{this.render(),this.registerEvents()})}configToCssValue(e){if(typeof e=="number"&&e>0)return e+"px";if(typeof e=="string"){if(e=e.replace(" ",""),Number(e)&&Number(e)>0)return e+"px";const i=e.match(/^\d.*(px|em|rem|%)$/g);return i&&i.length===1?e:null}return null}}const Fg=["2D","3D","2D/3D"];class Og extends Y{constructor(){super("layout");l(this,"template",()=>_`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style><style>
#panel{color:var(--text-color)}#panel>div{padding:1rem}.hidden{display:none}fieldset{margin-top:1rem}.option{margin-top:.5rem;display:flex}.option input,.option select{flex-grow:1}.option input.gg-checkbox{flex-grow:0}.option label{margin-right:.5rem}.option label:after{content:' :'}
</style>
<div id="panel">
  <div>
    <div class="option">
      <label for="layout" i18n="View" class="gg-label">View</label>
      <select id="layout" class="gg-select" onchange="${this.onLayoutSelect}">
        <option i18n="2D" value="2D">2D</option>
        <option i18n="2D / 3D" value="2D/3D">2D / 3D</option>
        <option i18n="3D" value="3D">3D</option>
      </select>
    </div>
    <fieldset class="shadows-group hidden">
      <legend i18n="Shadows">Shadows</legend>
      <div class="option shadows-option">
        <label for="shadowsCheckbox" i18n="Enable shadows" class="gg-label">Enable shadows</label>
        <input id="shadowsCheckbox" type="checkbox" class="gg-checkbox" onchange="${this.onShadowsToggle}" />
      </div>
      <div class="option shadows-date hidden">
        <label for="shadowsDate" i18n="Date" class="gg-label">Date</label>
        <input id="shadowsDate" type="datetime-local" class="gg-input" />
      </div>
    </fieldset>
  </div>
</div>
`);l(this,"visible",!1);this.onLayoutSelect=this.onLayoutSelect.bind(this),this.onShadowsToggle=this.onShadowsToggle.bind(this)}registerEvents(){this.subscribe("interface.layoutPanelVisible",(e,i)=>this.togglePanel(i)),this.subscribe("globe.display",(e,i)=>this.onLayoutChanged(i))}togglePanel(e){this.visible=e,this.render()}onLayoutSelect(e){var r;const i=(r=e.target)==null?void 0:r.value;if(Fg.includes(i)){this.state.globe.display=i;return}console.error(`${i} is not a valid layout!`)}onLayoutChanged(e){var i,r,n;if(this.visible){const s=(i=this.shadowRoot)==null?void 0:i.querySelector(".shadows-group"),a=(r=this.shadowRoot)==null?void 0:r.querySelector(".shadows-date"),o=(n=this.shadowRoot)==null?void 0:n.querySelector("#shadowsCheckbox"),c=e==="2D/3D"||e==="3D";s==null||s.classList.toggle("hidden",!c),a==null||a.classList.toggle("hidden",!c||!(o!=null&&o.checked))}}onShadowsToggle(e){var n;const i=(n=this.shadowRoot)==null?void 0:n.querySelector(".shadows-date"),r=e.target.checked;i==null||i.classList.toggle("hidden",!r),this.state.globe.shadows=r,r&&this.setDateTimePicker()}setDateTimePicker(){var i;const e=(i=this.shadowRoot)==null?void 0:i.querySelector("#shadowsDate");if(e){const r=new Date;e.valueAsNumber=Math.round((r.valueOf()-r.getTimezoneOffset()*6e4)/6e4)*6e4,e.addEventListener("input",()=>{this.update3dMapTimestamp(new Date(e.value))})}}update3dMapTimestamp(e){this.state.globe.shadowsTimestamp=e.valueOf()}connectedCallback(){this.loadConfig().then(()=>{this.render(),this.registerEvents()})}render(){this.visible?super.render():this.hide(),super.girafeTranslate()}}class xr{constructor(t,e){l(this,"eventsCallbacks",[]);l(this,"togglePaths");this.stateManager=e,this.togglePaths=xr.filterValidTogglePaths(this.stateManager,t),this.initToggle(),this.watchToggle()}get state(){return this.stateManager.state}destroy(){this.stateManager.unsubscribe(this.eventsCallbacks)}toggle(t,e){this.togglePaths.filter(i=>i!==t).forEach(i=>{ui(this.state,i,!1)}),ui(this.state,t,e)}deactivateAll(){this.toggle(this.togglePaths[0],!1)}initToggle(){let t=!1;this.togglePaths.forEach(e=>{const i=on(this.state,e);t&&ui(this.state,e,!1),i.object===!0&&(t=!0)})}watchToggle(){this.togglePaths.forEach(t=>{this.eventsCallbacks.push(this.stateManager.subscribe(t,(e,i)=>{e!=null&&e!==i&&this.toggle(t,i)}))})}static filterValidTogglePaths(t,e){return e.filter(i=>{const r=on(t.state,i);return r.found&&(r.object===!0||r.object===!1)?!0:(console.warn(`Configured state toggle path "${i}" doesn't lead to a boolean property. Skip it.`),!1)})}}class Dg extends qn{constructor(){super("lr-panel");l(this,"template",()=>_`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style><style>
#panel{height:100%}#gutter{height:100%}.main{height:100%;overflow-y:auto;overflow-x:hidden}#panel{position:relative;background:var(--bkg-color);display:flex;flex-direction:column}header{margin:.5rem;display:flex;align-items:center;border-bottom:var(--app-standard-border);padding-bottom:.5rem}header span{font-size:1rem;text-align:left;flex-grow:1;color:var(--text-color)}#gutter{position:absolute;z-index:100;width:6px;height:4rem;background:var(--bkg-color);top:calc(50% - 2rem);cursor:col-resize;border:var(--app-standard-border);border-radius:1rem}#panel.left #gutter{right:-1rem}#panel.right #gutter{left:-1rem}#panel.left #hide{display:none}
</style>
<div id="panel">
  <header class="${this.hasMultipleChilds?"":"hidden"}">
    <span i18n="${this.title}"></span>
    <button id="close" class="gg-icon-button gg-small">
      <img alt="Close icon" src="icons/close.svg" />
    </button>
  </header>
  <div id="gutter"></div>
  <div class="main">
    <slot name="main"></slot>
  </div>
</div>
`);l(this,"stateToggleManager");l(this,"title","Unknown panel");l(this,"panelTitles",{});this.render();const e=this.shadow.getElementById("panel");e==null||e.classList.add(this.dock);const i=this.retrieveTogglePaths();this.stateToggleManager=new xr(i,this.stateManager),this.showOnChildChange(i)}get hasMultipleChilds(){return Object.keys(this.panelTitles).length>1}closePanel(){this.stateToggleManager.deactivateAll(),this.hide()}retrieveTogglePaths(){const e=this.shadow.querySelectorAll("slot")[0].assignedNodes(),i=[];for(const r of e){const n=r.dataset.togglePath,s=r.dataset.title??"Unknown panel";n&&(this.panelTitles[n]=s,i.push(n))}return xr.filterValidTogglePaths(this.stateManager,i)}showOnChildChange(e){e.forEach(i=>{this.subscribe(i,(r,n)=>{r!==n&&(n?(this.title=this.panelTitles[i],this.show(),this.refreshRender()):this.hide())})})}}class zg extends Y{constructor(){super("menubutton");l(this,"template",()=>_`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style><style>
.container{position:relative}.menu-content{position:absolute;display:flex;font-size:0;border:var(--app-standard-border);background:var(--bkg-color);border-radius:4px;border-width:2px;margin-right:.2rem;z-index:1000;box-shadow:var(--bx-shdw)}.open-bottom{flex-direction:column;top:100%;left:0;height:max-content;width:fit-content}.open-bottom-left{flex-direction:row;top:100%;right:0;height:max-content;width:fit-content}.open-up{flex-direction:column;bottom:100%;right:0;height:max-content;width:fit-content}.open-up-right{flex-direction:column;bottom:100%;left:0;height:max-content;width:fit-content}.open-left{flex-direction:row;right:100%;top:0;width:max-content;height:fit-content}
</style>
<div class="container">
  <slot
    name="menu-button"
    onclick="${()=>this.toggleMenu()}"
    onkeydown="${e=>this.simulateClick(e)}"></slot>

  <div class="${this.getClass()}">
    <slot name="menu-content"></slot>
  </div>
</div>
`);l(this,"open",!1);l(this,"openDirection","bottom");l(this,"outsideClickHandler",e=>this.outsideClick(e));l(this,"closeMenuHandler",()=>this.closeMenu(!0))}render(){this.openDirection=this.hasAttribute("open")?this.getAttribute("open"):"bottom",super.render()}listenChildButtons(){const i=this.shadow.querySelector('slot[name="menu-content"]').assignedNodes(),r=this.findAllAssignedButtons(i);for(const n of r)n.removeEventListener("click",this.closeMenuHandler),n.addEventListener("click",this.closeMenuHandler)}getClass(){return this.open?"menu-content open-"+this.openDirection:"hidden"}toggleMenu(){this.open?this.closeMenu():this.openMenu()}openMenu(){this.listenChildButtons(),this.open=!0,setTimeout(()=>document.addEventListener("click",this.outsideClickHandler),0),this.refreshRender()}outsideClick(e){const i=e.target;this.shadow.contains(i)||this.closeMenu()}closeMenu(e=!1){if(this.open=!1,document.removeEventListener("click",this.outsideClickHandler),e){const i=super.getParentOfType("GIRAFE-MENU-BUTTON",this.shadow.host.parentNode);i!==null&&i.toggleMenu()}this.refreshRender()}findAllAssignedButtons(e){const i=[];for(const r of e)r.nodeName==="BUTTON"&&i.push(r),r.hasChildNodes()&&i.push(...this.findAllAssignedButtons(Array.from(r.childNodes)));return i}connectedCallback(){super.loadConfig().then(()=>{this.render(),super.girafeTranslate()})}}class Vg extends Y{constructor(){super("native-modals");l(this,"template",()=>_`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style><style>
#content{z-index:10000;position:fixed;display:flex;top:0;left:0;bottom:0;right:0;background-color:rgba(0,0,0,.65);align-items:center;justify-content:center}.modal{background:var(--bkg-color);border:var(-app-standard-border);min-height:400px;width:300px;box-shadow:5px 5px 10px rgb(0,0,0,.2);border-radius:10px}header{background:var(--app-color-grey);display:flex;height:100px;padding:2rem;border-top-left-radius:10px;border-top-right-radius:10px;justify-content:center}section{padding:30px 30px;display:flex;flex-direction:column;text-align:center}span{font-size:1.2rem;margin-bottom:1rem;display:inline-block}.confirm-buttons{display:flex;flex-direction:row;justify-content:center;gap:1rem;margin-top:2rem}.confirm-buttons button{width:7rem}h2,span{color:var(--text-color)}
</style>
<div id="content" class="${this.visible?"":"hidden"}">
  <div class="modal">
    <header>
      <img alt="question-icon" src="icons/help.svg" class="${this.boxType==="alert"?"hidden":""}" />
      <img alt="error-icon" src="icons/error.svg" class="${this.boxType==="alert"?"":"hidden"}" />
    </header>
    <section>
      <h2>${this.boxTitle}</h2>
      <span>${this.boxMessage}</span>

      <input
        id="input-text"
        type="text"
        class="${this.boxType==="prompt"?"gg-input":"hidden"}"
        placeholder="${this.boxPlaceholder}" />

      <!-- Alert box -->
      <div class="${this.boxType==="alert"?"confirm-buttons":"hidden"}">
        <button class="gg-button" onclick="${()=>this.ok()}" i18n="Ok">Ok</button>
      </div>

      <!-- Confirm box -->
      <div class="${this.boxType==="confirm"?"confirm-buttons":"hidden"}">
        <button class="gg-button" onclick="${()=>this.ok()}" i18n="Yes">Yes</button>
        <button class="gg-button" onclick="${()=>this.nok()}" i18n="No">No</button>
      </div>

      <!-- Prompt box -->
      <div class="${this.boxType==="prompt"?"confirm-buttons":"hidden"}">
        <button class="gg-button" onclick="${()=>this.promptOk()}" i18n="Ok">Ok</button>
        <button class="gg-button" onclick="${()=>this.promptNok()}" i18n="Cancel">Cancel</button>
      </div>
    </section>
  </div>
</div>
`);l(this,"visible",!1);l(this,"boxType");l(this,"boxTitle");l(this,"boxMessage");l(this,"boxPlaceholder");l(this,"resolveAlertConfirm");l(this,"resolvePrompt");l(this,"i18nManager",Vt.getInstance());window.gConfirm=(e,i)=>this.alertConfirmBox("confirm",e,i),window.gAlert=(e,i)=>this.alertConfirmBox("alert",e,i),window.gPrompt=(e,i,r)=>this.promptBox(e,i,r)}initBox(e,i,r,n){this.boxType=e,this.boxMessage=this.i18nManager.getTranslation(i),r&&(this.boxTitle=this.i18nManager.getTranslation(r)),n&&(this.boxPlaceholder=this.i18nManager.getTranslation(n)),this.visible=!0,this.refreshRender()}resetBox(){this.visible=!1,this.boxType=void 0,this.boxTitle=void 0,this.boxMessage=void 0,this.boxPlaceholder=void 0,this.refreshRender()}async promptBox(e,i,r){return this.initBox("prompt",e,i,r),new Promise(n=>{this.resolvePrompt=n})}async alertConfirmBox(e,i,r){return this.initBox(e,i,r),new Promise(n=>{this.resolveAlertConfirm=n})}ok(){this.resetBox(),this.resolveAlertConfirm(!0)}nok(){this.resetBox(),this.resolveAlertConfirm(!1)}promptOk(){const e=this.shadow.getElementById("input-text").value;this.resetBox(),this.resolvePrompt(e)}promptNok(){this.resetBox(),this.resolvePrompt(!1)}render(){super.render()}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate()})}}const Sr=class Sr{constructor(t,e){l(this,"name");l(this,"position");if(!Sr.BOOKMARKNAMEPATTERN.test(t))throw new Error("Bookmark name is not valid: it can only contain alphanumeric characters and the dash (-) underscore (_) and space characters.");this.name=t,this.position=e}};l(Sr,"BOOKMARKNAMEPATTERN",/^[A-Za-zÀ-ž0-9_ -]+$/);let wr=Sr;class $g extends Y{constructor(){super("navigation");l(this,"template",()=>_`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style><style>
.content-horizontal{display:flex;flex-direction:row}.content-vertical{display:flex;flex-direction:column}.menu-content{display:inline-flex;flex-direction:column;width:max-content;background-color:var(--bkg-color)}
</style>
<div class="content">
  <div class="content-horizontal">
    <div class="content-vertical">
      <button class="gg-icon-button gg-small" onclick="${()=>this.addBookmark()}">
        <img alt="add-icon" src="icons/bookmark-add.svg" />
      </button>
      <button class="gg-icon-button gg-small" onclick="${()=>this.navigateBack()}">
        <img alt="previous-icon" src="icons/previous.svg" />
      </button>
    </div>

    <div class="content-vertical">
      <girafe-menu-button open="bottom-left">
        <button slot="menu-button" class="gg-icon-button gg-small">
          <img alt="menu-icon" src="icons/bookmark-black.svg" />
        </button>

        <div slot="menu-content" class="${this.hasBookmark?"menu-content":"hidden"}">
          ${Object.values(this.bookmarks).map(e=>_t(e,e.name)`
          <div class="content-horizontal">
            <button
              slot="menu-button"
              class="gg-icon-button gg-small-withtext"
              onclick="${()=>this.navigateToPosition(e.position)}">
              <img alt="bookmark-icon" src="icons/bookmark.svg" />
              <span>${e.name}</span>
            </button>
            <button slot="menu-button" class="gg-icon-button gg-small" onclick="${()=>this.removeBookmark(e)}">
              <img alt="menu-icon" src="icons/trash.svg" />
            </button>
          </div>
          `)}
        </div>
        <div slot="menu-content" class="${this.hasBookmark?"hidden":"menu-content"}">
          <span i18n="No bookmark">No bookmark.</span>
        </div>
      </girafe-menu-button>

      <button slot="menu-button" class="gg-icon-button gg-small" onclick="${()=>this.navigateForward()}">
        <img alt="menu-icon" src="icons/next.svg" />
      </button>
    </div>
  </div>
</div>
`);l(this,"positionHistory",[]);l(this,"currentPositionIndex",-1);l(this,"bookmarks",[]);l(this,"storagePath","bookmarks");l(this,"userDataManager");l(this,"selfNavigation",!1);this.userDataManager=Os.getInstance()}get hasBookmark(){return this.bookmarks.length>0}render(){super.render()}async addBookmark(){const e=await window.gPrompt("Give a name to your bookmark","Add bookmark","Enter a name...");if(e){const i=new wr(e,this.state.position);this.bookmarks.push(i),this.saveBookmarks(),super.render(),super.girafeTranslate()}}async removeBookmark(e){if(await window.gConfirm("Do you want to delete this bookmark?","Delete bookmark")){const r=this.bookmarks.indexOf(e);r>=0&&this.bookmarks.splice(r,1),this.saveBookmarks(),super.render(),super.girafeTranslate()}}saveBookmarks(){this.userDataManager.saveUserData(this.storagePath,this.bookmarks)}loadBookmarks(){this.bookmarks=[];const e=this.userDataManager.getUserData(this.storagePath);if(e)for(const i of e)try{const r=new Ka;r.center=i.position.center,r.zoom=i.position.zoom,r.resolution=i.position.resolution,r.scale=i.position.scale,this.bookmarks.push(new wr(i.name,r))}catch(r){console.warn("Cannot read stored bookmarks"),console.warn(r)}}registerEvents(){this.subscribe("position",(e,i)=>this.onPositionChanged(i))}onPositionChanged(e){if(!this.selfNavigation){if(!e.isValid)return;this.currentPositionIndex!==this.positionHistory.length-1&&this.positionHistory.splice(this.currentPositionIndex+1),this.positionHistory.push(e),this.currentPositionIndex=this.positionHistory.length-1}}navigateBack(){let e=this.positionHistory[this.currentPositionIndex];this.currentPositionIndex>0&&(this.currentPositionIndex--,e=this.positionHistory[this.currentPositionIndex],console.log("Navigating back to:",e)),this.navigateToPosition(e)}navigateForward(){let e=this.positionHistory[this.currentPositionIndex];this.currentPositionIndex<this.positionHistory.length-1&&(this.currentPositionIndex++,e=this.positionHistory[this.currentPositionIndex],console.log("Navigating forward to:",e)),this.navigateToPosition(e)}navigateToPosition(e){this.selfNavigation=!0;try{this.state.position=e}finally{this.selfNavigation=!1}}connectedCallback(){this.loadConfig().then(()=>{this.loadBookmarks(),this.render(),super.girafeTranslate(),this.registerEvents()})}}class Gg extends Y{constructor(){super("oauth");l(this,"template",()=>{var e,i,r,n;return _`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style><style>
.container{display:flex;flex-direction:row;border-right:var(--app-standard-border);align-items:center}.name{display:flex;flex-direction:column;text-align:left}.user-avatar{--svg-filter:none}
</style>
<div class="${this.configManager.Config.oauth||this.configManager.Config.gmfauth?"":"hidden"}">
  <div class="${this.state.oauth.status==="loggedIn"?"hidden":"container"}">
    <button class="gg-icon-button gg-medium-withtext" onclick="${()=>this.onLoginClick()}">
      <img alt="menu-icon" src="icons/user.svg" />
      <span i18n="Login">Login</span>
    </button>
  </div>
  <div class="${this.state.oauth.status!=="loggedIn"?"hidden":"container"}">
    <button class="gg-icon-button gg-medium-withtext" onclick="${()=>this.onLogoutClick()}">
      <img
        alt="menu-icon"
        src="${this.userIconUrl??"icons/user.svg"}"
        class="${this.userIconUrl?"user-avatar":""}" />
      <div class="name">
        <span class="${(e=this.state.oauth.userInfo)!=null&&e.given_name?"":"hidden"}"
          >${((i=this.state.oauth.userInfo)==null?void 0:i.given_name)+" "+((r=this.state.oauth.userInfo)==null?void 0:r.family_name)}</span
        >
        <span>${(n=this.state.oauth.userInfo)==null?void 0:n.username}</span>
      </div>
    </button>
  </div>
</div>
`});l(this,"userIconUrl");l(this,"oauthManager");l(this,"menuOpen",!1);console.info("OauthComponent constructor"),this.oauthManager=Qa.getInstance()}registerEvents(){this.subscribe("oauth.status",()=>this.refreshRender()),this.subscribe(/oauth\.userInfo.*/,()=>this.refreshRender())}async refreshRender(){this.userIconUrl=await this.getUserIconUrl(),super.refreshRender()}onLoginClick(){if(!this.configManager.Config.oauth&&!this.configManager.Config.gmfauth)throw new Error("Authentication is not configured on this instance. Login cannot be done.");this.oauthManager.login()}async onLogoutClick(){await window.gConfirm("Do you want to logout ?","Logout")&&this.oauthManager.logout()}async getUserIconUrl(){var e;if((e=this.state.oauth.userInfo)!=null&&e.email)return`https://www.gravatar.com/avatar/${await this.sha256(this.state.oauth.userInfo.email)}?d=mp`}async sha256(e){const i=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",i);return Array.from(new Uint8Array(r)).map(a=>a.toString(16).padStart(2,"0")).join("")}connectedCallback(){this.loadConfig().then(()=>{super.render(),this.registerEvents(),super.girafeTranslate()})}}const _r=(g,t)=>g.opacity===0?!1:t===void 0?!0:t>=(g.minResolution??-1)&&t<=(g.maxResolution??1/0);class kr{}l(kr,"getWMSLegendURL",(t,e,i)=>{if(!t)return;const r={FORMAT:"image/png",TRANSPARENT:!0,SERVICE:"WMS",VERSION:"1.1.1",REQUEST:"GetLegendGraphic",LAYER:e},n=i==null?void 0:i.scale,s=i==null?void 0:i.legendRule,a=i==null?void 0:i.legendWidth,o=i==null?void 0:i.legendHeight,c=i==null?void 0:i.serverType,h=i==null?void 0:i.dpi,d=i==null?void 0:i.bbox,m=i==null?void 0:i.srs,p=i==null?void 0:i.additionalQueryString;return n!==void 0&&(r.SCALE=n),s!==void 0&&(r.RULE=s,a!==void 0&&(r.WIDTH=a),o!==void 0&&(r.HEIGHT=o)),c=="qgis"&&(h!=null&&(r.DPI=h),d!=null&&m!=null&&n!=null&&h!=null&&s==null&&(r.BBOX=d.join(","),r.SRS=m,r.SRCWIDTH=Math.round((d[2]-d[0])/n*39.37*h),r.SRCHEIGHT=Math.round((d[3]-d[1])/n*39.37*h),delete r.SCALE)),p&&Object.assign(r,p),Go(t,r)}),l(kr,"getWMTSLegendURL",t=>{const e=t.get("capabilitiesStyles");if(!Array.isArray(e)||e.length<=0)return;const i=e[0].LegendURL;if(!(!Array.isArray(i)||i.length<=0))return i[0].href});class Bg{constructor(){l(this,"options");l(this,"defaultOptions",{useExtent:!0,label:{},params:{},showGroupsTitle:!0})}setOptions(t){this.options={...this.defaultOptions,...t}}encodeLegend(t){this.setOptions(t);const i={classes:this.encodeLayersLegend(t.state.layers.layersList)};return i.classes.length>0?i:null}encodeLayersLegend(t){const e=[];return[...t].forEach(i=>{const r=this.encodeLayerLegendClasses(i);r&&this.addClassItemToArray(e,r)}),e}encodeLayerLegendClasses(t){return t.children?this.encodeLayerGroupLegendClasses(t):t.className===Tt.name?this.encodeLayerWmsLegendClasses(t):t.className===mi.name?this.encodeLayerWmtsLegendClasses(t):null}encodeLayerGroupLegendClasses(t){var r,n;const e={};(r=this.options)!=null&&r.showGroupsTitle&&(e.name=(n=this.options)==null?void 0:n.i18nManager.getTranslation(t.name));const i=[];return e.classes=i,t.children.forEach(s=>{const a=this.encodeLayerLegendClasses(s);a&&this.addClassItemToArray(i,a)}),this.tryToSimplifyLegendGroup(e)}encodeLayerWmtsLegendClasses(t){var i,r;if(!_r(t,(i=this.options)==null?void 0:i.printResolution)||t.inactive)return null;let e=this.getMetadataLegendImage(t);if(!e&&t._olayer){const n=kr.getWMTSLegendURL(t._olayer);n&&(e={url:n,dpi:at.SCREEN_DOTS_PER_INCH})}return e?{name:(r=this.options)==null?void 0:r.i18nManager.getTranslation(t.name),icons:[e.url]}:null}encodeLayerWmsLegendClasses(t){var h,d,m,p,b,x,E;if(!_r(t,(h=this.options)==null?void 0:h.printResolution)||t.inactive)return null;const e=(d=this.options)==null?void 0:d.state.ogcServers,i=e?e[t.ogcServer.name]:void 0,r=(i==null?void 0:i.type)??"",n=((m=this.options)==null?void 0:m.dpi)??at.SCREEN_DOTS_PER_INCH,s=this.getMetadataLegendImage(t);if(s)return this.getLegendClassForWMS(t.name,s,r);const a=[],o={classes:a};if((p=this.options)!=null&&p.showGroupsTitle&&(o.name=(b=this.options)==null?void 0:b.i18nManager.getTranslation(t.name)),(((x=t.layers)==null?void 0:x.split(","))??[]).forEach(T=>{var St,ut,Gt,pe,ai;const R=kr.getWMSLegendURL(t.ogcServer.url,T,{dpi:n,serverType:r,scale:(St=this.options)==null?void 0:St.scale,bbox:(ut=this.options)==null?void 0:ut.extent,srs:(Gt=this.options)==null?void 0:Gt.mapManager.getMap().getView().getProjection().getCode(),additionalQueryString:(pe=this.options)!=null&&pe.params?(ai=this.options)==null?void 0:ai.params[r]:void 0});if(!R){console.error("Missing legend url for wms: ",t.name);return}const G={url:R,dpi:r==="qgisserver"?n:at.SCREEN_DOTS_PER_INCH};a.push(this.getLegendClassForWMS(T,G,r))}),a.length===1){const T=a[0];return delete T.classes,T.name=(E=this.options)==null?void 0:E.i18nManager.getTranslation(t.name),T}return this.tryToSimplifyLegendGroup(o)}getLegendClassForWMS(t,e,i){var n;const r={name:this.mustHideLabel(i)?"":(n=this.options)==null?void 0:n.i18nManager.getTranslation(t),icons:[e.url]};return e.dpi!==at.SCREEN_DOTS_PER_INCH&&Object.assign(r,{dpi:e.dpi}),r}getMetadataLegendImage(t){var a;let e=((a=this.options)==null?void 0:a.dpi)??-1;e===-1&&(e=at.SCREEN_DOTS_PER_INCH);let i=e,r=t.legendImage;const n=t.hiDPILegendImages;let s=Number.MAX_VALUE;if(r&&(s=Math.abs(Math.log(at.SCREEN_DOTS_PER_INCH/e)),i=at.SCREEN_DOTS_PER_INCH),n)for(const o in n){const c=parseFloat(o),h=Math.abs(Math.log(c/e));h<s&&(s=h,i=c,r=n[o])}return r?{url:r,dpi:i}:null}mustHideLabel(t){var i;const e=(i=this.options)==null?void 0:i.label;return!!e&&e[t]===!1}addClassItemToArray(t,e){e&&(!e.classes||e.classes.length>0)&&t.push(e)}tryToSimplifyLegendGroup(t){var e;return((e=t.classes)==null?void 0:e.length)===1&&t.classes[0].name===t.name?t.classes[0]:t}}class Ug{constructor(){l(this,"printResolution",100);l(this,"options")}setOptions(t){this.options=t}encodeMap(t){this.setOptions(t);const e=t.mapManager,i=e.getMap().getView(),r=i.getCenter()??[0,0],n=i.getProjection().getCode(),s=na(i.getRotation());this.printResolution=i.getResolution()||100;const a=this.getAllLayers(t.state),o=this.encodeLayers(a);return o.unshift(...this.encodeSpecialLayers(e,t.customizer)),{center:r,dpi:t.dpi,projection:n,rotation:s,scale:t.scale,layers:o,useNearestScale:!1}}getAllLayers(t){var n;const i=[...this.getFlatLayers(t.layers.layersList).filter(s=>s.active)].sort((s,a)=>s.order-a.order),r=((n=t.activeBasemap)==null?void 0:n.layersList)??[];return[...i,...r]}getFlatLayers(t){return t.reduce((e,i)=>{if(i.children){const r=this.getFlatLayers(i.children);e.push(...r)}else e.push(i);return e},[])}encodeSpecialLayers(t,e){return[...t.getLayersToPrint()].sort((r,n)=>{const s=r.getZIndex()??0;return(n.getZIndex()??0)-s}).map(r=>r instanceof Ht?new us(r.getLayerState(),e).encodeVectorLayer(this.printResolution):null).filter(r=>r!==null)}encodeLayers(t){const e=[];for(const i of t){const r=this.encodeLayer(i);r&&(Array.isArray(r)?e.push(...r):e.push(r))}return e}encodeLayer(t){return t.className===Tt.name?this.encodeImageLayer(t):t.className===mi.name?this.encodeTileWmtsLayer(t):t.className===Xi.name?this.encodeLocalFileLayer(t):null}encodeImageLayer(t){var h,d,m,p;if(!_r(t,(h=this.options)==null?void 0:h.printResolution))return null;let e=t.ogcServer.url;t.ogcServer.url.startsWith("//")&&(e=window.location.protocol+e);const i=new URL(e),r={TRANSPARENT:"true"};i.searchParams&&i.searchParams.forEach((b,x)=>{r[x]=b});const n=(d=this.options)==null?void 0:d.state.ogcServers[t.ogcServer.name];let s=n==null?void 0:n.type;s==="arcgis"&&(s=void 0);const a=((m=t.layers)==null?void 0:m.split(","))??[""];let o=(p=t.style)==null?void 0:p.split(",");for(o||(o=[""]);a.length>o.length;)o.push("");return{baseURL:Bo(i.origin+i.pathname),imageFormat:t.ogcServer.imageType??"image/png",layers:a,customParams:r,serverType:s,type:"wms",opacity:t.opacity,useNativeAngle:t.printNativeAngle,styles:o}}encodeTileWmtsLayer(t){var s;if(!_r(t,(s=this.options)==null?void 0:s.printResolution))return null;if(t.printLayers||t.wmsLayers){const a=this.encodeWmsFromWmtsLayer(t);if(a)return a}const e=t._olayer,i=e==null?void 0:e.getSource();if(!e||!i)return console.warn("Can not encode tile layer: ",t),null;const r=i.getDimensions(),n=Object.keys(r);return{baseURL:Uo(i),dimensions:n,dimensionParams:r,imageFormat:i.getFormat(),layer:i.getLayer(),matrices:jo(i),matrixSet:i.getMatrixSet(),name:t.name,opacity:t.opacity,requestEncoding:i.getRequestEncoding(),style:i.getStyle(),type:"wmts",version:i.getVersion()}}encodeLocalFileLayer(t){var r;const e=new ie({features:t._features}),i=new Ht({source:e});return(r=this.options)!=null&&r.customizer?new us(i.getLayerState(),this.options.customizer).encodeVectorLayer(this.printResolution):null}encodeWmsFromWmtsLayer(t){if(!t.ogcServer)return console.error("Missing ogcServer"),null;const e=t.printLayers??t.wmsLayers??"",i=new Tt(0,e,0,t.ogcServer,{layers:e});return i.opacity=t.opacity,this.encodeImageLayer(i)}}class Ns{constructor(){l(this,"legendEncoder");l(this,"encoder");l(this,"customizer");this.legendEncoder=new Bg,this.encoder=new Ug,this.customizer=new qo}async requestReport(t,e){return Ho(t,e)}async cancelReport(t,e){return Yo(t,e)}async getDownloadUrl(t,e,i=1e3,r=3e4){return Wo(t,e,i,r)}encode(t){const e=t.mapManager.getMap().getView().getCenter()||[0,0];this.customizer.setPrintExtent(this.getExtent(t.pageSize,t.scale,e)||[0,0,0,0]);const r={map:this.encoder.encodeMap({state:t.state,mapManager:t.mapManager,scale:t.scale,printResolution:t.mapManager.getMap().getView().getResolution()||100,dpi:t.dpi,customizer:this.customizer})};return Object.assign(r,t.customAttributes),{attributes:r,format:t.format,layout:t.layout,lang:t.state.language??void 0}}encodeLegend(t){const e=t.mapManager.getMap().getView().getCenter()||[0,0],i=this.getExtent(t.pageSize,t.scale,e)||[0,0,0,0];return t.extent=t.extent??i,this.legendEncoder.encodeLegend(t)}getExtent(t,e,i){return Xo(t,i,e)}static getPrintDatasourceFromSelectedFeatures(t,e,i){return t.reduce((r,n)=>{var p;const s=((p=n.getGeometry())==null?void 0:p.getExtent())??[];if(!Zo(s,e))return r;const a=n.getId(),o=a===void 0?"UNKNOWN":`${a}`.split(".")[0],c=i.getTranslation(o),h=Ds(n),d=r.find(b=>b.title===c),m=Object.values(h);return d?(d.table.data.push(m),r):(r.push({title:c,table:{data:[m],columns:Object.keys(h).map(b=>i.getTranslation(b))}}),r)},[])||[]}}class $r extends Ko{constructor(e={},i="#000"){super({className:"simpleMask",...e});l(this,"context");l(this,"size",null);l(this,"fillColor");this.fillColor=i,this.context=Qo(),this.context.canvas.style.opacity="0.5",this.context.canvas.style.position="absolute"}updateSize(e){this.size=e}render(e){if(this.size===null)throw Error("Cannot render Mask : size has not been set.");const i=e.size[0],r=e.size[1],n=$r.calculateBoxCorners(i,r,this.size[0],this.size[1]);return this.drawBoxMask(i,r,...n),this.context.canvas}drawBoxMask(e,i,r,n,s,a){this.context.canvas.width=e,this.context.canvas.height=i,this.context.beginPath(),this.context.moveTo(0,0),this.context.lineTo(e,0),this.context.lineTo(e,i),this.context.lineTo(0,i),this.context.lineTo(0,0),this.context.closePath(),this.context.moveTo(...r),this.context.lineTo(...n),this.context.lineTo(...s),this.context.lineTo(...a),this.context.lineTo(...r),this.context.closePath(),this.context.fillStyle=this.fillColor,this.context.fill()}static calculateBoxCorners(e,i,r,n){if(e<=0||i<=0)throw new Error("Both totalWidth and totalHeight must be greater than 0.");if(r<=0||n<=0)throw new Error("Both boxWidth and boxHeight must be greater than 0.");const s=[e/2,i/2],a=r/2,o=n/2,c=s[0]-a,h=s[1]+o,d=s[1]-o,m=s[0]+a;return[[c,h],[m,h],[m,d],[c,d]]}}class jg extends $r{constructor(e={}){super({className:"printMask",...e});l(this,"scaleFn")}setGetScaleFn(e){this.scaleFn=e}getRotation(){return 0}render(e){if(this.size===null)throw Error("Cannot render Mask : size has not been set.");if(!this.scaleFn)throw Error("Cannot render Mask : scaleDn has not been set.");const i=e.size[0],r=e.size[1],n=[i/2,r/2],s=this.size[1],a=this.size[0],o=e.viewState.resolution,c=this.scaleFn(e),h=a/at.PRINT_DOTS_PER_INCH/at.INCHES_PER_METER*c/o/2,d=s/at.PRINT_DOTS_PER_INCH/at.INCHES_PER_METER*c/o/2,m=this.getRotation!==void 0?sa(this.getRotation()):0,p=Math.sqrt(Math.pow(h,2)+Math.pow(d,2)),b=Math.atan(d/h)-m,x=Math.atan(h/d)-m,E=n[0]-Math.cos(b)*p,T=n[1]+Math.sin(b)*p,R=n[0]+Math.sin(x)*p,G=n[1]+Math.cos(x)*p,St=n[0]+Math.cos(b)*p,ut=n[1]-Math.sin(b)*p,Gt=n[0]-Math.sin(x)*p,pe=n[1]-Math.cos(x)*p;return this.drawBoxMask(i,r,[E,T],[R,G],[St,ut],[Gt,pe]),this.context.canvas}}const Ps="PrintMask",vi=class vi{constructor(t){l(this,"stateManager");l(this,"printMaskLayer",new jg({name:Ps}));l(this,"map");l(this,"eventsCallbacks",[]);l(this,"possibleScales",[]);l(this,"scaleManuallySelected",!1);this.map=t,this.stateManager=ae.getInstance(),this.printMaskLayer.setGetScaleFn(this.getScaleFn.bind(this)),this.registerEvents()}get state(){return this.stateManager.state}destroy(){this.stateManager.unsubscribe(this.eventsCallbacks),this.eventsCallbacks.length=0,this.state.print.maskVisible=!1,this.onPrintMaskVisibleChanged()}setManuallySelectedScale(t){this.scaleManuallySelected=t}setPossibleScales(t){this.possibleScales=[...t].sort((e,i)=>i-e).reverse()}zoomToScale(t){const e=this.map.getSize()??[0,0],i=this.state.print.pageSize??[0,0],r=vi.getOptimalResolution(e,i,t);this.map.getView().setResolution(r)}registerEvents(){this.eventsCallbacks.push(this.stateManager.subscribe("print.pageSize",()=>this.onPrintFormatChanged()),this.stateManager.subscribe("print.maskVisible",()=>this.onPrintMaskVisibleChanged()))}getScaleFn(t){const e=t.size,i=t.viewState.resolution;console.assert(this.state.print.pageSize,"Can not get optimal scale without print pageSize");const r=this.state.print.pageSize??[0,0];let n;return this.scaleManuallySelected?n=this.state.print.scale??1e4:n=vi.getOptimalScale(e,i,r,this.possibleScales),this.state.print.scale=n,this.state.print.scale}onPrintMaskVisibleChanged(){const t=zs(this.map,Ps);if(this.state.print.maskVisible&&!t){this.map.addLayer(this.printMaskLayer);return}!this.state.print.maskVisible&&t&&this.map.removeLayer(this.printMaskLayer)}onPrintFormatChanged(){this.state.print.pageSize&&(this.printMaskLayer.updateSize(this.state.print.pageSize),this.renderMask())}renderMask(){this.state.print.maskVisible&&this.printMaskLayer.changed()}static getOptimalScale(t,e,i,r){const n=t[0]*e,s=t[1]*e,a=n*at.INCHES_PER_METER*at.PRINT_DOTS_PER_INCH/i[0],o=s*at.INCHES_PER_METER*at.PRINT_DOTS_PER_INCH/i[1],c=Math.min(a,o);return r.reduce((h,d)=>c>d?d:h,-1)}};l(vi,"getOptimalResolution",(t,e,i)=>{const r=at.PRINT_DOTS_PER_INCH*at.INCHES_PER_METER,n=e[0]*i/(r*t[0]),s=e[1]*i/(r*t[1]);return Math.max(n,s)});let mn=vi;class Fe extends Y{constructor(){super("print");l(this,"template",()=>_`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style><style>
#panel{height:100%;overflow:auto;min-width:20rem}#content{background:var(--bkg-color);color:var(--text-color);padding:1.5rem;margin:0}#content .message{text-align:center;width:100%}#content .message *{margin:.25rem}.option{margin-top:.5rem;display:flex}.option label{width:40%}.option label:after{content:' :'}.option input,.option select,.option textarea{flex-grow:1}.option input.gg-checkbox{flex-grow:0}.rotation{flex-grow:1;display:flex;gap:.5rem}#rotationSlider{width:0}#rotationNumber{width:4rem;flex-grow:0}#content #export-pdf{float:right;margin-top:1rem}#content button{background-color:var(--bkg-color);color:var(--text-color);border-radius:3px;outline:0;border:solid 1px var(--text-color);cursor:pointer}#content button:hover{background-color:var(--bkg-color-grad2)}#content #print-list{margin-top:5rem}#print-list .print-item{position:relative;padding:.5rem;margin-top:.5rem;border:solid 1px var(--text-color);color:var(--text-color)}#print-list .print-item .container{border:none;display:inline;text-align:unset;width:100%}#print-list .print-item .cancel{cursor:pointer;position:absolute;top:.5rem;right:.5rem;color:var(--text-color-grad1);border:none;background-color:transparent}.print-item .cancel i:before{content:'\uf00d'}.print-item .cancel:hover{border-color:var(--text-color);color:var(--text-color)}.print-item i.status{margin-right:1rem;float:left;width:3rem;text-align:center}.print-item:has(.success):hover{background-color:var(--bkg-color-grad2);cursor:pointer}.print-item i.status::before{line-height:3rem;display:block}.print-item p{line-height:1.3rem}.print-item p.time{position:absolute;bottom:0;right:0;margin-right:.5rem}#custom-scale{color:var(--text-color);display:flex;flex-direction:row;flex-wrap:wrap;justify-content:flex-start;align-items:center}#custom-scale .svg-info{margin-left:.5rem}#custom-scale>div{display:flex;width:100%;align-items:center}.gg-custom-scale{justify-content:flex-end}
</style>
<div id="panel">
  <div id="content">
    <div class="${this.getRenderState()==="loading"?"":"hidden"}">
      <div class="message">
        <div i18n="Connecting to the print server, please wait."></div>
        <img alt="loading-icon" src="icons/loading.svg" class="gg-spin" />
      </div>
    </div>

    <div class="${this.getRenderState()==="error"?"":"hidden"}">
      <div class="message" i18n="The print server is unavailable. Please, try later."></div>
    </div>

    <div class="${this.getRenderState()==="setup"?"":"hidden"}">
      <div class="option">
        <label for="layout" i18n="Layout" class="gg-label">Layout</label>
        <select id="layout" class="gg-select" onchange="${e=>this.onLayoutChanged(e)}">
          ${this.layouts.map(e=>{var i;return _`
          <option i18n="${e.name}" ?selected="${((i=this.selectedLayout)==null?void 0:i.name)===e.name}" value="${e.name}">
            ${e.name}
          </option>
          `})}
        </select>
      </div>

      <div class="option gg-custom-scale">
        <label for="scale" i18n="Scale" class="gg-label">Scale</label>
        <select id="scale" class="gg-select" onchange="${e=>this.onScaleChanged(e)}">
          ${this.scales.map(e=>_`
          <option ?selected="${this.getSelectedScale()===e}" value="${e}">
            <span>1&nbsp;:&nbsp;</span><span i18n="${e}" i18nFn="formatNumber">${e}</span>
          </option>
          `)}
          <option
            i18n="Manual entry"
            class="${this.configManager.Config.print.customScale===!0?"":"hidden"}"
            value="custom">
            Manual entry
          </option>
        </select>
      </div>

      <div class="${this.showCustomScale===!0?"option":"hidden"}">
        <div id="custom-scale">
          <label for="scale" i18n="Custom scale" class="gg-label">Custom scale</label>
          <div>
            <span>1&nbsp;:&nbsp;</span
            ><input
              class="gg-input"
              type="number"
              min="10"
              onkeypress="${e=>this.onCustomScaleTyped(e)}" />
            <span class="svg-info" tip="Press 'Enter' to apply" tip-placement="top"
              ><img alt="Info" src="icons/info.svg"
            /></span>
          </div>
        </div>
      </div>

      <div class="option">
        <label for="format" i18n="Format" class="gg-label">Format</label>
        <select id="format" class="gg-select" onchange="${e=>this.onFormatChanged(e)}">
          ${this.printFormats.map(e=>_`
          <option ?selected="${this.getSelectedFormat()===e}" value="${e}">${e.toUpperCase()}</option>
          `)}
        </select>
      </div>

      ${this.dpis.length<2?null:_`
      <div class="option">
        <label for="dpi" class="gg-label">DPI</label>
        <select id="dpi" class="gg-select" onchange="${e=>this.onDpiChanged(e)}">
          ${this.dpis.map(e=>_`
          <option ?selected="${this.getSelectedDpi()===e}" value="${e}">${e}</option>
          `)}
        </select>
      </div>
      `}

      <div class="option">
        <label for="rotationSlider" i18n="Rotation" class="gg-label">Rotation</label>
        <div class="rotation">
          <input
            id="rotationSlider"
            class="gg-range"
            type="range"
            min="-180"
            max="180"
            step="1"
            value="${this.getRotation()}"
            oninput="${e=>this.onInputRotationChanged(e)}" />
          <input
            id="rotationNumber"
            class="gg-input"
            type="number"
            min="-180"
            max="180"
            step="1"
            value="${this.getRotation()}"
            oninput="${e=>this.onInputRotationChanged(e)}" />
        </div>
      </div>

      <!-- prettier is breaking this line because it breaks just after the return -->
      <!-- prettier-ignore -->
      ${this.attributeNames.map(e=>{var i,r,n,s;return this.getAttributeInputType(e)==="number"?_`
      <div class="option">
        <label for="${e}" i18n="${this.attrNameForI18n(e)}" class="gg-label">${e}</label>
        <input
          id="${e}"
          type="number"
          class="gg-input"
          value="${(i=this.getCapabilitiesAttribute(e))==null?void 0:i.default}" />
      </div>
      `:this.getAttributeInputType(e)==="checkbox"?_`
      <div class="option">
        <label for="${e}" i18n="${this.attrNameForI18n(e)}" class="gg-label">${e}</label>
        <input
          id="${e}"
          type="checkbox"
          class="gg-checkbox"
          ?checked="${(r=this.getCapabilitiesAttribute(e))==null?void 0:r.default}" />
      </div>
      `:this.getAttributeInputType(e)==="textarea"?_`
      <div class="option">
        <!-- prettier-ignore -->
        <textarea
          id="${e}"
          class="gg-textarea"
          i18n="${this.attrNameForI18n(e)}"
          placeholder="${e}">${(n=this.getCapabilitiesAttribute(e))==null?void 0:n.default}</textarea>
      </div>
      `:_`
      <div class="option">
        <input
          id="${this.attrNameForI18n(e)}"
          class="gg-input"
          i18n="${e}"
          placeholder="${e}"
          type="text"
          value="${(s=this.getCapabilitiesAttribute(e))==null?void 0:s.default}" />
      </div>
      `})}

      <button id="export-pdf" class="gg-button" onclick="${()=>this.print()}" i18n="Print">Print</button>

      <div id="print-list">
        ${this.printList.map(e=>_`
        <div id="${e.id}" class="print-item" title="${e.elementTitle}">
          <button class="cancel" tabindex="0" onclick="${()=>this.onCancelPrintElementClicked(e.id)}">
            <img alt="close-icon" src="icons/close.svg" />
          </button>
          <button class="container" tabindex="0" onclick="${()=>this.onPrintElementClicked(e.id)}">
            <img
              alt="loading-icon"
              src="icons/loading.svg"
              class="${e.status===0?"gg-spin":"hidden"}" />
            <img
              alt="loading-icon"
              src="icons/download.svg"
              class="${e.status===1?"":"hidden"}" />
            <img
              alt="loading-icon"
              src="icons/error.svg"
              class="${e.status===2?"":"hidden"}" />
            <p>
              <span i18n="${e.selectedLayoutName}">${e.selectedLayoutName}</span>
              <span>(</span><span>${e.selectedFormat.toUpperCase()}</span><span>)</span>
            </p>
            <p class="time">${e.time}</p>
          </button>
        </div>
        `)}
      </div>
    </div>
  </div>
</div>
`);l(this,"default_dpi",96);l(this,"default_scale",1e4);l(this,"default_resolution",100);l(this,"default_format","pdf");l(this,"i18nManager");l(this,"mapManager");l(this,"eventsCallbacks",[]);l(this,"eventKeys",[]);l(this,"printManager");l(this,"printList",[]);l(this,"printUrl");l(this,"capabilities");l(this,"configAttributeNames",[]);l(this,"printMaskManager");l(this,"visible",!1);l(this,"isWithCapabilitiesComponentSetup",!1);l(this,"hasErrorFetchingCapabilities",!1);l(this,"showCustomScale",!1);l(this,"attributeNames",[]);l(this,"printFormats",[]);l(this,"layouts",[]);l(this,"selectedLayout");l(this,"scales",[]);l(this,"dpis",[]);this.mapManager=Kt.getInstance(),this.i18nManager=Vt.getInstance()}connectedCallback(){this.render(),this.registerVisibilityEvents()}render(){this.visible?this.renderComponent():this.renderEmptyComponent()}getRenderState(){return this.hasErrorFetchingCapabilities?"error":this.capabilities?"setup":"loading"}onLayoutChanged(e){var n;const i=(n=e.target)==null?void 0:n.value;this.selectedLayout=this.getCapabilitiesLayout(i);const r=this.getClientInfo();this.updateScales(r),this.updateDpis(r),this.updateAvailableAttributes(),this.state.print.pageSize=[r.width,r.height],this.render()}onScaleChanged(e){var i,r,n,s,a;if((i=this.printMaskManager)==null||i.setManuallySelectedScale(!1),this.configManager.Config.print.customScale){if(((r=e.target)==null?void 0:r.value)==="custom"){this.showCustomScale=!0,this.render();return}this.showCustomScale=!1,this.render()}this.state.print.scale=parseInt((n=e.target)==null?void 0:n.value),(s=this.printMaskManager)==null||s.zoomToScale(this.state.print.scale),(a=this.printMaskManager)==null||a.setManuallySelectedScale(!1)}onCustomScaleTyped(e){var i,r,n;if(e.key==="Enter"){const s=parseInt((i=e.target)==null?void 0:i.value);s&&(this.state.print.scale=s,(r=this.printMaskManager)==null||r.zoomToScale(this.state.print.scale),this.render(),(n=this.printMaskManager)==null||n.setManuallySelectedScale(!0))}}getSelectedScale(){return this.state.print.scale}getSelectedFormat(){return this.state.print.format}getSelectedDpi(){return this.state.print.dpi}onFormatChanged(e){var i;this.state.print.format=(i=e.target)==null?void 0:i.value}onDpiChanged(e){var r;const i=(r=e.target)==null?void 0:r.value;this.state.print.dpi=i?parseInt(i):this.default_dpi}getRotation(){return na(this.mapManager.getMap().getView().getRotation())}onInputRotationChanged(e){const i=e.target;this.setRotation(i)}getCapabilitiesAttribute(e){var r;return(((r=this.selectedLayout)==null?void 0:r.attributes)??[]).find(n=>n.name===e)}getAttributeInputType(e){const i=this.getCapabilitiesAttribute(e);return(i==null?void 0:i.name)==="comments"?"textarea":(i==null?void 0:i.type)==="Number"?"number":(i==null?void 0:i.type)==="LegendAttributeValue"||(i==null?void 0:i.type)==="Boolean"?"checkbox":"text"}attrNameForI18n(e){return e==="legend"?"Legend":e}print(){var r,n,s;const e=this.getCustomAttributes(),i=(n=this.printManager)==null?void 0:n.encode({mapManager:this.mapManager,i18nManager:this.i18nManager,state:this.state,scale:this.getSelectedScale()??this.default_scale,printResolution:this.mapManager.getMap().getView().getResolution()??this.default_resolution,pageSize:this.state.print.pageSize??[],dpi:this.getSelectedDpi()??this.default_dpi,layout:((r=this.selectedLayout)==null?void 0:r.name)??"",format:this.getSelectedFormat()??this.default_format,customAttributes:e});if(!i){console.error("Unable to create print spec");return}(s=this.printManager)==null||s.requestReport(this.printUrl??"",i).then(a=>this.trackPrintStatus(a))}onPrintElementClicked(e){const i=this.getPrintElement(e);(i==null?void 0:i.status)===1&&window.open(i.downloadUrl,"_blank")}onCancelPrintElementClicked(e){var n;const i=this.printList.findIndex(s=>s.id===e);if(i<0)return;const r=this.printList[i];r.status===0&&((n=this.printManager)==null||n.cancelReport(this.printUrl,r.id)),this.printList.splice(i,1),this.render()}renderComponent(){super.render(),this.renderComponentCapabilitiesPart(),this.activateTooltips(!1,[800,0],"top-end"),super.girafeTranslate()}async renderComponentCapabilitiesPart(){var e;if(this.capabilities){this.isWithCapabilitiesComponentSetup||this.setupWithCapabilitiesComponent(),(e=this.printMaskManager)==null||e.setPossibleScales(this.scales);return}this.hasErrorFetchingCapabilities||(await this.initComponentConfig(),this.render())}setupWithCapabilitiesComponent(){var e;this.updateInputRotationFromMap(),this.state.print.maskVisible=!0,this.printMaskManager=new mn(this.mapManager.getMap()),(e=this.printMaskManager)==null||e.setPossibleScales(this.scales),this.setupPrintManager(),this.registerEvents(),this.isWithCapabilitiesComponentSetup=!0}renderEmptyComponent(){var e;this.hasErrorFetchingCapabilities=!1,this.isWithCapabilitiesComponentSetup=!1,(e=this.printMaskManager)==null||e.destroy(),Ja(this.eventKeys),this.eventKeys.length=0,this.unsubscribe(this.eventsCallbacks),this.eventsCallbacks.length=0,this.renderEmpty()}setupPrintManager(){this.printManager||(this.printManager=new Ns)}registerVisibilityEvents(){this.subscribe("interface.printPanelVisible",(e,i)=>this.togglePanel(i))}registerEvents(){this.registerInteractionListener("map.select",!0);const e=this.mapManager.getMap().getView();this.eventKeys.push(e.on("change:rotation",()=>{this.updateInputRotationFromMap()})),this.eventsCallbacks.push(this.subscribe("print.scale",(i,r)=>{const n=this.shadow.querySelector("#scale");n.value=r})),this.eventsCallbacks.push(this.subscribe("oauth.status",async(i,r)=>{(r==="loggedIn"||r==="loggedOut")&&(await this.initComponentConfig(),this.render())}))}async togglePanel(e){this.visible=e,this.render()}updateInputRotationFromMap(){const e=this.shadow.querySelector("#rotationSlider");let i=Math.round(this.getRotation());i>180&&(i-=360),i<-180&&(i+=360),this.setRotation(e,i)}setRotation(e,i=null){var a,o;const r=(a=e.parentElement)==null?void 0:a.querySelector("#rotationSlider"),n=(o=e.parentElement)==null?void 0:o.querySelector("#rotationNumber"),s=i??parseInt(e.value);r.value=`${s}`,n.value=`${s}`,i||this.mapManager.getMap().getView().setRotation(sa(s))}getCapabilitiesUrl(){return this.printUrl+"/capabilities.json"}getPrintElement(e){return this.printList.find(i=>i.id===e)}async initComponentConfig(){await this.loadConfig(),await this.fetchCapabilities(),this.initFromCapabilities(),this.capabilities||(this.hasErrorFetchingCapabilities=!0)}async fetchCapabilities(){this.printUrl=this.configManager.Config.print.url,this.printUrl.endsWith("/")&&(this.printUrl=this.printUrl.slice(0,-1));let e;try{const i={referrer:""};(this.configManager.Config.oauth||this.state.oauth.status==="loggedIn")&&(i.credentials="include"),e=await(await fetch(this.getCapabilitiesUrl(),i)).json()}catch(i){console.error(i)}return this.capabilities=e,e}initFromCapabilities(){var s;if(!this.capabilities)return;const e=((s=this.capabilities)==null?void 0:s.layouts)??[];if(!e.length){console.error("Can't print without any configured print layouts."),this.capabilities=void 0;return}const i=this.configManager.Config.print;this.initLayouts();const r=this.getCapabilitiesLayout(i.defaultLayout??"");this.selectedLayout=r??e[0],this.initFormats();const n=this.getClientInfo();this.updateScales(n),this.updateDpis(n),this.state.print.pageSize=[n.width,n.height],i.attributeNames&&(this.configAttributeNames=i.attributeNames),this.updateAvailableAttributes()}initFormats(){var s;const e=this.configManager.Config.print,i=e.formats;this.printFormats=Fe.filterValidPrintFormats(i,(s=this.capabilities)==null?void 0:s.formats);const r=e.defaultFormat,n=Fe.getValidDefaultFormat(this.printFormats,r);this.state.print.format=n??this.default_format}initLayouts(){var r;const e=(r=this.capabilities)==null?void 0:r.layouts,i=this.configManager.Config.print.layouts;this.layouts=Fe.filterValidLayouts(e,i)}getCapabilitiesLayout(e){return this.layouts.find(i=>i.name===e)}updateScales(e){var i;this.scales=Fe.filterValidScales(e.scales,this.configManager.Config.print.scales),(i=this.printMaskManager)==null||i.setPossibleScales(this.scales)}updateDpis(e){this.dpis=e.dpiSuggestions;const i=this.getSelectedDpi()??0;(!this.dpis.includes(i)||i>e.maxDpi)&&(this.state.print.dpi=this.dpis.length?this.dpis[0]:this.default_dpi)}updateAvailableAttributes(){var i;const e=((i=this.selectedLayout)==null?void 0:i.attributes)??[];this.attributeNames=this.configAttributeNames.filter(r=>{var n;if(e.some(s=>s.name===r))return!0;console.warn(`Configured attribute "${r}" does not exist in layout "${(n=this.selectedLayout)==null?void 0:n.name}"`)})}getClientInfo(){const e=this.getCapabilitiesAttribute("map");return e||console.error("No map client info in the current layout"),e.clientInfo}getCapabilitiesAttributeValue(e){const i=this.getCapabilitiesAttribute(e);if(!i)return"";const r=this.getAttributeInputType(e),n=this.shadow.querySelector(`#${e}`);if(r==="checkbox")return`${(n==null?void 0:n.checked)??i.default??!1}`;const s=(n==null?void 0:n.value)??i.default;return s?`${s}`:""}getCustomAttributes(){const e=this.getAttributesAndValue();if(this.getCapabilitiesAttributeValue("legend")==="true"){const i=this.encodeLegend();i&&(e.legend=i)}return this.getCapabilitiesAttribute("datasource")&&(e.datasource=this.selectedFeaturesToDatasource()),e}getAttributesAndValue(){return this.attributeNames.filter(e=>e!=="legend").reduce((e,i)=>(e[i]=this.getCapabilitiesAttributeValue(i),e),{})}encodeLegend(){var i;const e={mapManager:this.mapManager,i18nManager:this.i18nManager,state:this.state,scale:this.getSelectedScale()??this.default_scale,printResolution:this.mapManager.getMap().getView().getResolution()??this.default_resolution,pageSize:this.state.print.pageSize??[],dpi:this.getSelectedDpi()??this.default_dpi,...this.configManager.Config.print.printLegend};return((i=this.printManager)==null?void 0:i.encodeLegend(e))||null}trackPrintStatus(e){var s,a;const i=e.ref,r=new Date(Date.now()),n=ms(r.getHours(),2)+":"+ms(r.getMinutes(),2);this.printList.push({id:i,time:n,selectedFormat:this.getSelectedFormat()??this.default_format,selectedLayoutName:((s=this.selectedLayout)==null?void 0:s.name)??"",title:this.getCapabilitiesAttributeValue("title")||i,status:0}),this.render(),(a=this.printManager)==null||a.getDownloadUrl(this.printUrl??"",e,2e3).then(o=>this.printFinished(i,o)).catch(o=>this.printError(i,o))}printFinished(e,i){const r=this.getPrintElement(e);r&&(r.status=1,r.downloadUrl=i,this.render())}printError(e,i){const r=this.getPrintElement(e);r&&(r.status=2,r.elementTitle=i,this.render())}selectedFeaturesToDatasource(){var a;const e=this.mapManager.getMap().getView().getCenter()??[0,0],i=this.getSelectedScale()??-1,r=this.state.print.pageSize??[],n=((a=this.printManager)==null?void 0:a.getExtent(r,i,e))||[0,0,1/0,1/0],s=this.state.selection.selectedFeatures??[];return Ns.getPrintDatasourceFromSelectedFeatures(s,n,this.i18nManager)}static filterValidPrintFormats(e,i){return e=e??[],e.filter(r=>i!=null&&i.includes(r)?!0:(console.warn(`Format ${r} is not supported.`),!1))}static getValidDefaultFormat(e,i){if(i){if(e.includes(i))return i;console.warn("Configured format does not exist: ",i)}return e.length?e[0]:void 0}static filterValidLayouts(e,i){return!i||i.length<=0?e??[]:(i.forEach(r=>{e!=null&&e.find(n=>n.name===r)||console.warn("Configured layout does not exist: ",r)}),(e==null?void 0:e.filter(r=>i.includes(r.name)))??[])}static filterValidScales(e,i){return!i||i.length<=0?e:(i.forEach(r=>{e.find(n=>n===r)&&console.warn("Configured scale does not exist: ",r)}),e==null?void 0:e.filter(r=>i.includes(r)))}}class qg extends Y{constructor(){super("prototype");l(this,"template",()=>_`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style><style>
a{color:#fff;text-decoration:none;text-transform:uppercase}
</style>
<a href="https://doc.geomapfish.dev/" i18n="Prototype" target="_blank" rel="noopener">PROTOTYPE</a>
`)}connectedCallback(){this.render()}}const Hg={string:["eq","neq","like","nlike","nul","nnul"],number:["eq","neq","gt","gte","lt","lte","between","nul","nnul"],date:["eq","neq","before","after","between","nnul"]};class tt{constructor(t,e,i,r="",n){l(this,"property");l(this,"propertyType");l(this,"operator");l(this,"value");l(this,"value2");l(this,"beginOfTime","0001-01-01");l(this,"endOfTime","9999-12-31");if(this.property=t,this.operator=e,this.value=i,this.value2=r,this.propertyType=n,this.operator==="between"&&!this.value2)throw new Error("Between operator needs two filter values !")}toOpenLayersFilter(){if(!this.propertyType)throw new Error("The type of the property should never be null !");switch(this.operator){case"eq":return ln(this.propertyType)&&Fi(this.value)?Vi(this.property,"*"+this.value+"*"):bs(this.property,this.value);case"neq":return ln(this.propertyType)&&Fi(this.value)?zi(Vi(this.property,"*"+this.value+"*")):Oe(this.propertyType)?zi(bs(this.property,this.value)):ps(this.property,this.value);case"gt":return rl(this.property,Number(this.value));case"gte":return il(this.property,Number(this.value));case"lt":return el(this.property,Number(this.value));case"lte":return tl(this.property,Number(this.value));case"like":return Vi(this.property,"*"+this.value+"*");case"nlike":return zi(Vi(this.property,"*"+this.value+"*"));case"before":return Xr(this.property,this.beginOfTime,this.value);case"after":return Xr(this.property,this.value,this.endOfTime);case"between":return Oe(this.propertyType)?Xr(this.property,this.value,this.value2):Jo(this.property,Number(this.value),Number(this.value2));case"nul":return fs(this.property);case"nnul":return Oe(this.propertyType)?ps(this.property,""):zi(fs(this.property));default:throw new Error("Unknown filter operator")}}toWmsGetMapFilter(){if(!this.propertyType)throw new Error("The type of the property should never be null !");const t=tt.simpleLikeFilterGenerateWildCard(this.value);switch(this.operator){case"eq":return this.propertyType==="string"&&Fi(this.value)?tt.simpleLikeFilter(this.property,this.value):tt.simpleEqFilter(this.property,this.value);case"neq":return this.propertyType==="string"&&Fi(this.value)?tt.simpleNlikeFilter(this.property,this.value):tt.simpleNeqFilter(this.property,this.value);case"gt":return tt.simpleGtFilter(this.property,this.value);case"gte":return tt.simpleGteFilter(this.property,this.value);case"lt":return tt.simpleLtFilter(this.property,this.value);case"lte":return tt.simpleLteFilter(this.property,this.value);case"like":return tt.simpleLikeFilter(this.property,t+this.value+t,t);case"nlike":return tt.simpleNlikeFilter(this.property,t+this.value+t,t);case"before":return tt.simpleLteFilter(this.property,this.value);case"after":return tt.simpleGteFilter(this.property,this.value);case"between":return tt.simpleBetweenFilter(this.property,this.value,this.value2);case"nul":return tt.simpleEqFilter(this.property,"");case"nnul":return tt.simpleNeqFilter(this.property,"");default:throw new Error("Unknown filter operator")}}static simpleEqFilter(t,e){return`<Filter><PropertyIsEqualTo><PropertyName>${t}</PropertyName><Literal>${e}</Literal></PropertyIsEqualTo></Filter>`}static simpleNeqFilter(t,e){return`<Filter><Not><PropertyIsEqualTo><PropertyName>${t}</PropertyName><Literal>${e}</Literal></PropertyIsEqualTo></Not></Filter>`}static simpleLtFilter(t,e){return`<Filter><PropertyIsLessThan><PropertyName>${t}</PropertyName><Literal>${e}</Literal></PropertyIsLessThan></Filter>`}static simpleLteFilter(t,e){return`<Filter><PropertyIsLessThanOrEqualTo><PropertyName>${t}</PropertyName><Literal>${e}</Literal></PropertyIsLessThanOrEqualTo></Filter>`}static simpleGtFilter(t,e){return`<Filter><PropertyIsGreaterThan><PropertyName>${t}</PropertyName><Literal>${e}</Literal></PropertyIsGreaterThan></Filter>`}static simpleGteFilter(t,e){return`<Filter><PropertyIsGreaterThanOrEqualTo><PropertyName>${t}</PropertyName><Literal>${e}</Literal></PropertyIsGreaterThanOrEqualTo></Filter>`}static simpleBetweenFilter(t,e,i){return`<Filter><And><PropertyIsGreaterThanOrEqualTo><PropertyName>${t}</PropertyName><Literal>${e}</Literal></PropertyIsGreaterThanOrEqualTo><PropertyIsLessThanOrEqualTo><PropertyName>${t}</PropertyName><Literal>${i}</Literal></PropertyIsLessThanOrEqualTo></And></Filter>`}static simpleInnerLikeFilter(t,e,i){return i||(i=tt.simpleLikeFilterGenerateWildCard(e)),`<PropertyIsLike wildCard="${i}" singleChar="." escapeChar="!"><PropertyName>${t}</PropertyName><Literal>${e}</Literal></PropertyIsLike>`}static simpleLikeFilter(t,e,i){return"<Filter>"+this.simpleInnerLikeFilter(t,e,i)+"</Filter>"}static simpleNlikeFilter(t,e,i){return"<Filter><Not>"+this.simpleInnerLikeFilter(t,e,i)+"</Not></Filter>"}static simpleLikeFilterGenerateWildCard(t){return"WABCDEFGIJKLMNOPQRSTUVXYZ".split("").find(e=>!t.includes(e))??"*"}}class Na extends Y{constructor(e){super("querybuilder");l(this,"template",()=>_`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style><style>
.container{background-color:var(--bkg-color)}.content{display:flex}.loading i{margin:.8rem}.deactivated i{margin:.8rem}
</style>
<div class="container">
  <div class="${this.loading?"loading":"loading hidden"}">
    <img alt="loading-icon" src="icons/loading.svg" class="gg-spin" />
    <span i18n="Loading server configuration...">Loading server configuration...</span>
  </div>
  <div class="${this.deactivated?"deactivated":"deactivated hidden"}">
    <img alt="info-icon" src="icons/info.svg" />
    <span i18n="Filtering deactivated: layers in layergroup don't have identical attributes."
      >Filtering deactivated: layers in layergroup don't have identical attributes.</span
    >
  </div>
  <div class="${this.loading||this.deactivated?"content hidden":"content"}">
    <select id="attribute" name="attribute" class="gg-select gg-medium" onchange="${()=>this.attributeChanged()}">
      <option value="" disabled ?selected="${!this.currentLayerAttribute}" i18n="Select attribute...">
        Select attribute...
      </option>
      ${this.layerAttributes.map(e=>{var i;return _t(e,e.name)`
      <option i18n="${e.name}" value="${e.name}" ?selected="${((i=this.currentLayerAttribute)==null?void 0:i.name)==e.name}">
        ${e.name}
      </option>
      `})}
    </select>

    <select id="operator" name="operator" class="gg-select gg-medium" onchange="${()=>this.operatorChanged()}">
      <option value="" disabled selected i18n="Select operator...">Select operator...</option>
      ${this.operatorOptions.map(e=>_t(e,e.operator)`
      <option i18n="${e.displayName}" value="${e.operator}">${e.displayName}</option>
      `)}
    </select>

    <input
      id="val"
      type="${this.inputTypeForFilterValue}"
      class="${this.showVal?"gg-input gg-medium":"hidden"}"
      placeholder="${this.showVal2?"Enter lower boundary...":"Enter value..."}"
      onkeydown="${e=>this.onValueKeyPress(e)}" />

    <input
      id="val2"
      type="${this.inputTypeForFilterValue}"
      class="${this.showVal2?"gg-input gg-medium":"hidden"}"
      placeholder="Enter upper boundary..."
      onkeydown="${e=>this.onValueKeyPress(e)}" />

    <button class="gg-icon-button gg-medium" tip="Apply filter" onclick="${()=>this.filter()}">
      <img alt="filter-icon" src="icons/filter.svg" />
    </button>

    <button class="gg-icon-button gg-medium" tip="Remove filter" onclick="${()=>this.removeFilter()}">
      <img alt="delete-icon" src="icons/trash.svg" />
    </button>
  </div>
</div>
`);l(this,"loading",!0);l(this,"deactivated",!1);l(this,"layer");l(this,"layerAttributes",[]);l(this,"currentLayerAttribute");l(this,"showVal",!1);l(this,"showVal2",!1);l(this,"allOperatorOptions",[{operator:"eq",displayName:"equals"},{operator:"neq",displayName:"does not equal"},{operator:"like",displayName:"contains"},{operator:"nlike",displayName:"does not contain"},{operator:"gt",displayName:"greater than"},{operator:"gte",displayName:"greater than or equal to"},{operator:"lt",displayName:"less than"},{operator:"lte",displayName:"less than or equal to"},{operator:"before",displayName:"before"},{operator:"after",displayName:"after"},{operator:"between",displayName:"between"},{operator:"nul",displayName:"is blank"},{operator:"nnul",displayName:"is not blank"}]);l(this,"operatorOptions",[]);this.layer=e}render(){if(!this.layer.ogcServer.urlWfs)throw new Error("No WFS URL found. Please verify the Layer type.");super.render(),to.getInstance().getServerWfs(this.layer).then(e=>{const i=this.layer.queryLayers.split(","),r=i.map(o=>e.layers[o]),n={};for(const o of r.flat())n[o.name]===void 0&&(n[o.name]=0),n[o.name]++;const s=Object.keys(n).filter(o=>n[o]===i.length),a=r[0]?r[0].filter(o=>s.includes(o.name)):[];this.deactivated=a.length===0,this.deactivated&&console.log("Filtering for layer group "+this.layer.name+" is deactivated because the queryLayers don't have common attributes."),this.layerAttributes=a,this.loading=!1,super.render(),this.activateTooltips(!1,[800,0],"top-end"),super.girafeTranslate()})}get inputTypeForFilterValue(){var e,i;return Oe(((e=this.currentLayerAttribute)==null?void 0:e.type)||"")?((i=this.currentLayerAttribute)==null?void 0:i.type)==="datetime"?"datetime-local":"date":"string"}updateOperatorOptions(){var n,s,a;this.operatorOptions=[];let e;ln(((n=this.currentLayerAttribute)==null?void 0:n.type)||"")?e="string":eo(((s=this.currentLayerAttribute)==null?void 0:s.type)||"")?e="number":Oe(((a=this.currentLayerAttribute)==null?void 0:a.type)||"")&&(e="date"),this.operatorOptions=this.allOperatorOptions.filter(o=>e?Hg[e].includes(o.operator):!1);const i=this.shadow.getElementById("operator"),r=i==null?void 0:i.value;this.operatorOptions.map(o=>o.operator).includes(r)||(i.value="",this.operatorChanged())}attributeChanged(){const e=this.shadow.getElementById("attribute"),i=this.layerAttributes.find(r=>r.name==e.value);if(!i)throw new Error("Why is this object null ? This should never happen...");this.currentLayerAttribute=i,this.updateOperatorOptions(),super.render(),super.girafeTranslate()}operatorChanged(){const e=this.shadow.getElementById("operator");this.showVal=!!(e!=null&&e.value)&&(e==null?void 0:e.value)!=="nul"&&(e==null?void 0:e.value)!=="nnul",this.showVal2=(e==null?void 0:e.value)==="between",super.render()}onValueKeyPress(e){e.key==="Enter"&&this.filter()}getFilterElements(){const e=this.shadow.getElementById("attribute"),i=this.shadow.getElementById("operator"),r=this.shadow.getElementById("val"),n=this.shadow.getElementById("val2");return[e,i,r,n]}validateInput(e){var i;if(e&&Oe(((i=this.currentLayerAttribute)==null?void 0:i.type)||"")){const r=new Date(e);if(isNaN(r.getTime()))throw new Error("Invalid date value entered !")}return e}getFilter(){var h;const[e,i,r,n]=this.getFilterElements(),s=e.value,a=i.value,o=this.validateInput(r.value),c=this.validateInput(n.value);if(!(this.showVal2&&(!o||!c)))return new tt(s,a,o,c,(h=this.currentLayerAttribute)==null?void 0:h.type)}filter(){this.layer.filter=this.getFilter()}removeFilter(){const[e,i,r,n]=this.getFilterElements();this.layer.filter=void 0,e.value="",i.value="",r.value="",n.value="",this.currentLayerAttribute=void 0,this.showVal=!1,this.showVal2=!1,super.render()}connectedCallback(){this.loadConfig().then(()=>{this.render()})}}class Yg extends Y{constructor(){super("scale");l(this,"template",()=>_`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style>
<select
  class="gg-select"
  onchange="${e=>{this.state.position.scale=parseInt(e.target.value)}}">
  ${this.configManager.Config.map.scales.map(e=>_`
  <option ?selected="${this.getFormatedScale()===this.getFormatedScale(e)}" value="${e}">
    ${this.getFormatedScale(e)}
  </option>
  `)}
</select>
`)}render(){this.configManager.loadConfig().then(()=>{super.render()})}registerEvents(){this.subscribe("position",()=>this.onScaleChanged())}onScaleChanged(){super.render()}getFormatedScale(e){const i=e??this.state.position.scale;return i?"1:"+Math.floor(i).toLocaleString(this.configManager.Config.general.locale):"No scale"}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}}class ve{constructor(t){l(this,"options");this.options={keepGeomProperty:!1,removeEmptyColumns:!0,...t}}toGridDataById(t){const e=t.reduce((i,r)=>this.addFeatureToGridDataById(i,r),{});return this.options.removeEmptyColumns&&Object.values(e).forEach(i=>ve.removeEmptyColumns(i)),e}addFeatureToGridDataById(t,e){const i=ve.getUserFeatureType(e),r=Ds(e,this.options.keepGeomProperty);if(!Object.keys(r).length)return t;Object.keys(t).includes(i)||(t[i]=ve.createGridDataWithColumns(r));const n=t[i];n.features.push(e),n.notOlProperties.push(r);const s=n.columns.map(a=>r[a]);return n.data.push(s),t}static createGridDataWithColumns(t){return{columns:Object.keys(t),notOlProperties:[],data:[],features:[]}}static removeEmptyColumns(t){const e=ve.findEmptyColumnIndexOf(t.data);t.columns=t.columns.filter((i,r)=>!e.includes(r)),t.data.forEach((i,r)=>{t.data[r]=t.data[r].filter((n,s)=>!e.includes(s))})}static findEmptyColumnIndexOf(t){if(!t[0])return[];const e=Array.from({length:t[0].length},(i,r)=>r);return t.forEach(i=>{const r=[];e.forEach(n=>{i[n]&&r.push(n)}),r.forEach(n=>{const s=e.findIndex(a=>a===n);e.splice(s,1)})}),e}static getUserFeatureId(t){const e=t.getId();return e===void 0?"UNKNOWN":`${e}`}static getUserFeatureType(t){const e=t.getId();if(!e)return"UNKNOWN";const i=`${e}`.split(".");return i.length<=1?`${e}`:(i.pop(),i.join("."))}}class Wg{constructor(){l(this,"locale","")}getGeometryIcons(t,e){this.locale=e;const i=this.getGeometryIconsInfo(t);return i[0]?i[0]:void 0}getGeometryIconsInfo(t){return t instanceof Et?this.getGeometryIconsInfoPoint(t):t instanceof xi?this.getGeometryIconsInfoMultiPoint(t):t instanceof ct||t instanceof qe?this.getGeometryIconsInfoLine(t):t instanceof oe||t instanceof He?this.getGeometryIconsInfoPolygon(t):t instanceof yi?this.getGeometryIconsInfoPolygon(io(t)):(console.error("Unknown geometry type",t==null?void 0:t.getType()),[null,null])}getGeometryIconsInfoPoint(t){let e='<img alt="point icon" src="icons/point.svg" />';const i=t.getFlatCoordinates(),r=lr(i,this.locale);return e+=`<span>E ${r[0]} / N ${r[1]}</span>`,[e,i]}getGeometryIconsInfoMultiPoint(t){let e='<img alt="multipoint icon" src="icons/multipoint.svg" />';if(t.getPoints.length===1){const r=t.getPoint(0).getFlatCoordinates(),n=lr(r,this.locale);return e+=`<span>E ${n[0]} / N ${n[1]}</span>`,[e,r]}const i=Zi(t.getExtent());return e+="<span>Multipoint</span>",[e,i]}getGeometryIconsInfoLine(t){let e='<img alt="polyline icon" src="icons/polyline.svg" />',i;t instanceof qe?i=t.getLineStrings().reduce((s,a)=>s+lt(a.getCoordinates()),0):i=lt(t.getCoordinates());const r=(Math.round(i*100)/100).toLocaleString(this.locale,{minimumFractionDigits:2});e+=`<span>${r}&nbsp;m</span>`;const n=Zi(t.getExtent());return[e,n]}getGeometryIconsInfoPolygon(t){let e='<img alt="polygon icon" src="icons/polygon.svg" />',i=0;t instanceof He?t.getPolygons().forEach(s=>i+=Ne(s)):i=Ne(t);const r=(Math.round(i*100)/100).toLocaleString(this.locale,{minimumFractionDigits:2});e+=`<span>${r}&nbsp;m<sup>2</sup></span>`;const n=Zi(t.getExtent());return[e,n]}}function pn(g,t){for(const e of Object.values(ae.getInstance().state.ogcServers)){const i=e.getAlias(g,t);if(i)return i}return t}class Xg{constructor(){l(this,"formatGridGeomValue",new Wg);l(this,"configManager");l(this,"featureToGridData",new ve({keepGeomProperty:!0}));l(this,"stateManager");l(this,"idTab",{});l(this,"tabHeaders",[]);l(this,"table",null);l(this,"element","");l(this,"data",{});this.configManager=je.getInstance(),this.stateManager=ae.getInstance()}setElement(t){this.element=t}replaceData(t){var i,r;const e=this.columnsToGridColumns(t,this.data[t].columns);(i=this.table)==null||i.setColumns(e),(r=this.table)==null||r.replaceData(this.data[t].notOlProperties)}activateTab(t){var i,r;(i=this.tabHeaders)==null||i.forEach(n=>n.active=!1);const e=(r=this.tabHeaders)==null?void 0:r.find(n=>n.id===t);e&&(e.active=!0)}displayGrid(t){var e;this.element&&(this.table=new nl(this.element,{data:this.data[t].notOlProperties,columns:this.columnsToGridColumns(t,this.data[t].columns),selectableRows:!0,layout:"fitColumns",locale:!0,maxHeight:"750",headerSortElement:function(i,r){switch(r){case"asc":return'<img alt="sort-up-icon" src="icons/sort-up.svg" />';case"desc":return'<img alt="sort-down-icon" src="icons/sort-down.svg" />';default:return'<img alt="sort-icon" src="icons/sort.svg" />'}}}),(e=this.table)==null||e.on("rowSelectionChanged",i=>{this.stateManager.state.selection.gridSelected=i.length>0;const r=new Map;this.data[t].features.forEach(s=>{const a=Mt(s.getGeometry());r.set(a,s)});const n=i.map(s=>r.get(Mt(s.geom??s.the_geom??s.geometry))).filter(s=>s!==void 0);this.stateManager.state.selection.highlightedFeatures=n}))}featuresToGridData(t){this.idTab={};const e=this.featureToGridData.toGridDataById(t);Object.keys(e).forEach(i=>this.gridDataToGridTab(i,e[i])),this.tabHeaders=Object.keys(this.idTab).map(i=>({id:i,text:Vt.getInstance().getTranslation(i),active:!1})),this.data=this.filterEmptyColumnsOnData(e)}gridDataToGridTab(t,e){t in this.idTab||(this.idTab[t]={columns:e.columns.map(i=>this.createGridColumn(t,i)),data:e.data.map(i=>this.createGridData(i)),features:e.features})}columnsToGridColumns(t,e){const i=[];return e.forEach(r=>{const n=pn(t,r);i.push({title:Vt.getInstance().getTranslation(n),field:r,formatter:"html"})}),i.forEach(r=>{(r.field==="the_geom"||r.field==="geom"||r.field==="geometry")&&(r.formatter=n=>this.formatGridGeomValue.getGeometryIcons(n.getValue(),this.getLocale())??n.getValue())}),i}filterEmptyColumnsOnData(t){for(const[e,i]of Object.entries(t)){const r=i.columns,n=i.notOlProperties;for(const[s,a]of Object.entries(n))for(const[o,c]of Object.entries(a))r.some(h=>h===o)||delete a[o]}return t}createGridColumn(t,e){const i=pn(t,e);return{id:e,name:Vt.getInstance().getTranslation(i)}}createGridData(t){return t.map(e=>e instanceof ra?this.formatGridGeomValue.getGeometryIcons(e,this.getLocale()):e)}getLocale(){return this.configManager.Config.general.locale}blockRedraw(){var t;(t=this.table)==null||t.blockRedraw()}restoreRedraw(){var t;(t=this.table)==null||t.restoreRedraw()}}class Zg extends qn{constructor(){super("selectiongrid");l(this,"template",()=>_`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style><style>
#panel,:host{min-height:10rem;height:16rem;background:var(--bkg-color)}#panel{top:0;left:0;right:0;bottom:0;overflow:hidden}#gutter{border:none;height:6px;width:100%;background:var(--bkg-color);position:absolute;top:0;left:0;cursor:row-resize}#close{border:none;color:#777;padding:0;margin:.5rem;width:1rem;height:1rem;line-height:1rem;position:absolute;top:0;right:0;background-color:var(--bkg-color);cursor:pointer}#close i:before{content:'\uf00d'}#close:hover{border-color:#000;color:#000}#content{position:absolute;top:0;left:0;right:0;bottom:0;background:var(--bkg-color);padding:0;margin:.5rem;overflow:hidden;display:flex;flex-direction:column}#header{flex:0;display:flex;justify-content:space-between}.selection-panel{margin-right:2rem}.tab{border:solid 1px #ccc;display:inline-block;height:2rem;line-height:2rem;padding:0 1rem;margin-right:.2rem;margin-bottom:.2rem;cursor:pointer;background-color:var(--bkg-color-grad2)}.tab.active{color:var(--text-color);background-color:var(--bkg-color)}#grid{overflow:hidden;flex:1}.geo-type{margin-right:.5rem}button{margin-left:.5rem}::-webkit-scrollbar{width:8px}::-webkit-scrollbar-thumb{background:#999}.tiny-margin{margin:.1rem}.tabulator-col[aria-sort=none] .tabulator-col-sorter i{color:#999}.tabulator-col[aria-sort=asc] .tabulator-col-sorter i{color:red}.tabulator-col[aria-sort=desc] .tabulator-col-sorter i{color:red;transform:scaleY(-1)}#tabulator{background-color:var(--bkg-color)}#tabulator .tabulator-header .tabulator-col-content{background-color:var(--bkg-color);color:var(--text-color)}#tabulator .tabulator-header .tabulator-col,#tabulator .tabulator-header .tabulator-col-row-handle{white-space:normal}#tabulator .tabulator-tableholder .tabulator-table .tabulator-row{background-color:var(--bkg-color);color:var(--text-color)}#tabulator .tabulator-tableholder .tabulator-table .tabulator-row:nth-child(2n){background-color:var(--bkg-color-grad1)}#tabulator .tabulator-tableholder .tabulator-table .tabulator-row.tabulator-selected{background-color:#9abcea}.tabulator-cell img{height:1.5rem;float:left;margin-right:.5rem}.tabulator-cell span{line-height:1.5rem;display:inline-flex;align-items:center;position:relative}.tabulator-cell span sup{position:absolute;right:-.5rem;top:-.3rem}@media (hover:hover) and (pointer:fine){#tabulator .tabulator-tableholder .tabulator-table .tabulator-row:hover{cursor:pointer;background-color:var(--bkg-color-grad2)}}
</style>
<link rel="stylesheet" href="styles/common.css" />
<link rel="stylesheet" href="lib/tabulator-tables/tabulator.min.css" />
<link rel="stylesheet" href="../../../node_modules/tabulator-tables/dist/css/tabulator.css" />

<div id="panel">
  <div id="content">
    <div id="header">
      <div class="tab-panel">
        ${this.getTabHeaders().map(e=>_`
        <button
          id="${e.id}"
          i18n="${e.text}"
          class="${e.active?"tab active":"tab"}"
          .active="${e.active}"
          onclick="${()=>this.displayGrid(e.id,!0)}"></button>
        `)}
      </div>
      <div class="selection-panel">
        <button
          class="${this.showCsvButton?"gg-button":"hidden"}"
          onclick="${()=>this.zoomToSelection()}"
          i18n="Zoom to"></button>
        <button class="gg-button" onclick="${()=>this.selectAll()}" i18n="Select all"></button>
        <button class="gg-button" onclick="${()=>this.selectNone()}" i18n="Select none"></button>
        <button class="gg-button" onclick="${()=>this.invertSelection()}" i18n="Invert selection"></button>
        <button
          class="${this.showCsvButton?"gg-button":"hidden"}"
          onclick="${()=>this.generateCSV()}"
          i18n="Generate CSV"></button>
      </div>
    </div>
    <div id="tabulator"></div>
  </div>
  <div id="gutter"></div>
  <button id="close" onclick="this.closePanel()">
    <img id="close" alt="close-icon" src="icons/close.svg" />
  </button>
</div>
`);l(this,"eventsCallbacks",[]);l(this,"selectionTabulatorManager",new Xg);l(this,"csvManager");l(this,"mapManager");l(this,"isVisibleComponentSetup",!1);l(this,"debounceOnFeaturesSelected",Li(this.onFeaturesSelected.bind(this),200));l(this,"visible",!1);l(this,"currentTabId","");l(this,"showCsvButton",!1);this.csvManager=Vs.getInstance(),this.mapManager=Kt.getInstance(),this.subscribe("selection.gridSelected",(e,i)=>{this.showCsvButton=i,this.render()}),this.addEventListener("resize-start",()=>{this.selectionTabulatorManager.blockRedraw()}),this.addEventListener("resize-end",()=>{this.selectionTabulatorManager.restoreRedraw()})}connectedCallback(){this.render(),this.registerVisibilityEvents()}render(){this.visible?this.renderComponent():this.renderComponentEmpty()}getTabHeaders(){return this.selectionTabulatorManager.tabHeaders}displayGrid(e,i=!1){i&&this.selectionTabulatorManager.replaceData(e),this.selectionTabulatorManager.activateTab(e),this.render(),this.selectionTabulatorManager.displayGrid(e),this.currentTabId=e}closePanel(){this.state.interface.selectionComponentVisible=!1,this.state.selection.selectedFeatures=[],this.showCsvButton=!1,this.state.selection.gridSelected=!1,super.clean()}selectAll(){var e;(e=this.selectionTabulatorManager.table)==null||e.selectRow()}selectNone(){var e;(e=this.selectionTabulatorManager.table)==null||e.deselectRow()}invertSelection(){var e;(e=this.selectionTabulatorManager.table)==null||e.getRows().forEach(i=>{i.toggleSelect()})}zoomToSelection(){var i;const e=Js();(i=this.selectionTabulatorManager.table)==null||i.getRows().forEach(r=>{if(r.isSelected()){const n=r.getData(),s=n.geom??n.the_geom??n.geometry;sl(e,s.getExtent())}}),this.mapManager.getMap().getView().fit(e,{duration:300})}generateCSV(){var n;const e=this.selectionTabulatorManager.data[this.currentTabId].columns.map(s=>({name:s})),i=["geom","the_geom","geometry"],r=e.filter(s=>!i.includes(s.name));this.csvManager.startDownload(((n=this.selectionTabulatorManager.table)==null?void 0:n.getSelectedData())??[],r,"query-results.csv")}renderComponent(){super.render(),this.isVisibleComponentSetup||this.setupVisibleComponent(),super.girafeTranslate(),this.activateTooltips(!1,[800,0],"top-end")}setupVisibleComponent(){this.showCsvButton=!1,this.state.selection.gridSelected=!1,this.isVisibleComponentSetup=!0,this.registerEvents()}renderComponentEmpty(){this.unsubscribe(this.eventsCallbacks),this.eventsCallbacks.length=0,this.isVisibleComponentSetup=!1,this.renderEmpty()}registerVisibilityEvents(){this.subscribe("interface.selectionComponentVisible",(e,i)=>this.togglePanel(i))}registerEvents(){this.eventsCallbacks.push(this.subscribe("selection.selectedFeatures",(e,i)=>{this.debounceOnFeaturesSelected(i)}))}onFeaturesSelected(e){if(this.selectionTabulatorManager.tabHeaders=[],this.isNullOrUndefined(e)||e.length<=0){this.closePanel();return}this.selectionTabulatorManager.featuresToGridData(e);const i=Object.keys(this.selectionTabulatorManager.idTab);this.selectionTabulatorManager.setElement(this.shadow.querySelector("#tabulator")),i.length||this.closePanel(),this.displayGrid(i[0])}togglePanel(e){if(this.state.interface.selectionComponent!=="grid"){if(!this.visible)return;e=!1}this.visible=e,e?this.onFeaturesSelected(this.state.selection.selectedFeatures):this.render()}}const Kg=""+new URL("center-DeU3lDk5.svg",import.meta.url).href;class Hn extends Ta{constructor(){super("selectionwindow");l(this,"template",()=>{var e;return _`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style><style>
.girafe-resizer{--resize-size:6px;--negative-resize-size:-6px}button.girafe-resizer{position:absolute;background-color:transparent;border:none}.girafe-resizer.corner{width:var(--resize-size);height:var(--resize-size)}.girafe-resizer.top-bottom{width:calc(100% - (2 * var(--resize-size)));height:var(--resize-size)}.girafe-resizer.left-right{width:var(--resize-size);height:calc(100% - (2 * var(--resize-size)))}.girafe-resizer.br:hover,.girafe-resizer.tl:hover{cursor:nw-resize}.girafe-resizer.bl:hover,.girafe-resizer.tr:hover{cursor:ne-resize}.girafe-resizer.top-bottom:hover{cursor:n-resize}.girafe-resizer.left-right:hover{cursor:e-resize}.girafe-resizer.tl{top:var(--negative-resize-size);left:var(--negative-resize-size)}.girafe-resizer.t{top:var(--negative-resize-size);left:var(--resize-size)}.girafe-resizer.tr{top:var(--negative-resize-size);right:var(--negative-resize-size)}.girafe-resizer.r{top:var(--resize-size);right:var(--negative-resize-size)}.girafe-resizer.br{bottom:var(--negative-resize-size);right:var(--negative-resize-size)}.girafe-resizer.b{bottom:var(--negative-resize-size);left:var(--resize-size)}.girafe-resizer.bl{bottom:var(--negative-resize-size);left:var(--negative-resize-size)}.girafe-resizer.l{top:var(--resize-size);left:var(--negative-resize-size)}.girafe-draggable-window{--window-header-height:2rem;--window-footer-height:2rem;border:solid 1px var(--text-color-grad1);border-radius:3px;box-shadow:var(--bx-shdw);background:var(--bkg-color);width:100%;height:100%}.girafe-draggable-window #header{height:var(--window-header-height);line-height:var(--window-header-height);padding:0 .5rem;cursor:move;z-index:10;background-color:var(--bkg-color-grad2);color:var(--text-color);text-align:center}.girafe-draggable-window #close{border:none;color:var(--text-color);padding:0;margin:.5rem;width:1rem;height:1rem;line-height:1rem;position:absolute;top:0;right:0;background-color:transparent;cursor:pointer}.girafe-draggable-window #close i:before{content:'\uf00d'}.girafe-draggable-window #close:hover{border-color:#000;color:#000}.girafe-draggable-window #content{width:100%;height:calc(100% - (var(--window-header-height) + var(--window-footer-height)));color:var(--text-color);overflow-y:auto}.girafe-draggable-window #footer{height:var(--window-footer-height);color:var(--text-color-grad1);border-top:solid 1px var(--text-color-grad1);display:flex;justify-content:space-around}
</style><style>
#content div{padding:1rem 2rem}table{border-collapse:collapse;width:100%}td.label{text-align:right;padding-right:1rem;color:var(--text-color-grad1);width:8rem;vertical-align:top}td.label:after{content:' :'}button{flex-grow:1;border:none;background-color:unset;color:var(--text-color-grad1);padding:.5rem;cursor:pointer}button>img{max-height:calc(var(--window-header-height)/ 2)}#previous i{float:left}#next i{float:right}#tools{display:flex;justify-content:space-around}#counter{line-height:var(--window-footer-height);height:var(--window-footer-height);text-align:center;margin-top:0}#layers-dropdown{background-color:var(--bkg-color);border:solid 1px var(--bkg-color-grad2);padding:.5rem 0;position:absolute;bottom:2rem;display:flex;flex-direction:column;align-items:center}option.layers-dropdown-item{cursor:pointer;padding:.1rem .5rem .1rem .5rem}option.layers-dropdown-item:hover{background-color:var(--bkg-color-grad1)}
</style>
<div id="draggable" class="${this.visible?"girafe-draggable-window":"hidden"}">
  <button tabindex="-1" class="girafe-resizer tl corner"></button>
  <button tabindex="-1" class="girafe-resizer t top-bottom"></button>
  <button tabindex="-1" class="girafe-resizer tr corner"></button>
  <button tabindex="-1" class="girafe-resizer r left-right"></button>
  <button tabindex="-1" class="girafe-resizer br corner"></button>
  <button tabindex="-1" class="girafe-resizer b top-bottom"></button>
  <button tabindex="-1" class="girafe-resizer bl corner"></button>
  <button tabindex="-1" class="girafe-resizer l left-right"></button>
  <div id="header">
    <span i18n="${(e=this.getWindowFeature())==null?void 0:e.id}"></span>
    <img id="close" alt="close-icon" src="icons/close.svg" />
  </div>
  <div id="content">
    <div>
      <table>
        <tr class="hidden">
          <th i18n="Label">Label</th>
          <th i18n="Value">Value</th>
        </tr>
        ${this.displayedProperties.map(i=>_`
        <tr>
          <td class="label" i18n="${i[0]}"></td>
          <td class="value">${this.htmlUnsafe(i[1])}</td>
        </tr>
        `)}
      </table>
    </div>
  </div>
  <div id="footer">
    <button
      id="previous"
      class="${this.maxIndex>0?"":"hidden"}"
      onclick="${()=>this.onFocusWindowFeature(this.focusedIndex-1)}">
      <img alt="previous-icon" src="icons/previous.svg" />
    </button>
    <div id="counter" class="${this.maxIndex>0?"":"hidden"}">
      <span class="${this.maxIndex>0?"":"hidden"}">
        <span>${this.focusedIndex+1}</span>
        <span>/</span>
        <span>${this.maxIndex+1}</span>
      </span>
    </div>
    <div class="tools">
      <button onclick="${()=>this.recenter()}">
        <img alt="recenter-icon" src="${this.iconCenter}" />
      </button>
      <button onclick="${()=>this.openDropdown()}"><img alt="csv-icon" src="icons/csv.svg" /></button>
      <div ?hidden="${!this.showDropdown}">
        <div id="layers-dropdown">
          ${this.getLayersList().map(i=>_`
          <option
            class="layers-dropdown-item"
            value="${i.id}"
            onclick="${()=>this.generateCSV(i.id)}"
            onkeydown="${()=>this.generateCSV(i.id)}"
            tabindex="0"
            i18n="${i.label}"></option>
          `)}
        </div>
      </div>
    </div>
    <button
      id="next"
      class="${this.maxIndex>0?"":"hidden"}"
      onclick="${()=>this.onFocusWindowFeature(this.focusedIndex+1)}">
      <img alt="next-icon" src="icons/next.svg" />
    </button>
  </div>
</div>
`});l(this,"eventsCallbacks",[]);l(this,"isVisibleComponentSetup",!1);l(this,"debounceOnFeaturesSelected",Li(this.onFeaturesSelected.bind(this),200));l(this,"resizeWindow",null);l(this,"featureToGridData",new ve({removeEmptyColumns:!1}));l(this,"windowFeatures",[]);l(this,"visible",!1);l(this,"focusedIndex",0);l(this,"maxIndex",0);l(this,"iconCenter",Kg);l(this,"csvManager",Vs.getInstance());l(this,"displayedProperties",[]);l(this,"showDropdown",!1)}connectedCallback(){this.render(),this.registerVisibilityEvents()}render(){this.visible?this.renderComponent():this.renderComponentEmpty()}getWindowFeature(){return this.windowFeatures[this.focusedIndex]}recenter(){var r,n;const e=this.getWindowFeature(),i=(n=(r=e==null?void 0:e.feature)==null?void 0:r.getGeometry())==null?void 0:n.getExtent();if(!i){console.error("Invalid feature to recenter on.");return}this.state.position.center=Zi(i)}openDropdown(){this.showDropdown=!this.showDropdown,this.render()}getLayersList(){const e=[];return this.windowFeatures.forEach(i=>{if(!e.some(r=>r.id===i.id)){const r=`Export ${i.id}`;e.push({id:i.id,label:r})}}),e}generateCSV(e){const i=[];this.windowFeatures.forEach(n=>{n.id===e&&i.push(n.notOlProperties)}),i.forEach(n=>this.ignoreUndefinedValues(n));const r=Object.keys(i[0]).map(n=>({name:n}));this.csvManager.startDownload(i,r,"query-results.csv"),this.showDropdown=!1,this.render()}ignoreUndefinedValues(e){Object.keys(e).forEach(i=>{e[i]===void 0&&delete e[i]})}closeWindow(){this.visible=!1,this.state.interface.selectionComponentVisible=!1,this.state.selection.focusedFeatures=null,this.state.selection.selectedFeatures=[]}onFocusWindowFeature(e){const i=this.selectedWindowFeature(e);this.state.selection.focusedFeatures=[i.feature],this.displayedProperties=Object.entries(i.notOlProperties).filter(r=>r[1]!==void 0),this.displayedProperties.forEach(r=>{let n={};this.configManager.Config.query.legacy&&(n={ADD_ATTR:["onclick"],ADD_URI_SAFE_ATTR:["onclick"]}),r[0]=Vt.getInstance().getTranslation(pn(i.id,r[0])),r[1]=ro.sanitize(r[1],n)}),this.render(),super.girafeTranslate()}renderComponent(){super.render(),this.isVisibleComponentSetup||this.setupVisibleComponent(),super.girafeTranslate(),this.activateTooltips(!1,[800,0],"top-end")}setupVisibleComponent(){this.isVisibleComponentSetup=!0,this.resizeWindow=new Ma(this.shadow),this.makeDraggable(),this.registerEvents()}renderComponentEmpty(){var e;(e=this.resizeWindow)==null||e.destroy(),this.resizeWindow=null,this.unsubscribe(this.eventsCallbacks),this.eventsCallbacks.length=0,this.isVisibleComponentSetup=!1,this.renderEmpty()}registerVisibilityEvents(){this.subscribe("interface.selectionComponentVisible",(e,i)=>this.togglePanel(i))}registerEvents(){this.eventsCallbacks.push(this.subscribe("selection.selectedFeatures",(e,i)=>{this.debounceOnFeaturesSelected(i)}))}onFeaturesSelected(e){if(!(e!=null&&e.length)){this.closeWindow();return}if(this.windowFeatures=Hn.createWindowFeatures(this.featureToGridData.toGridDataById(e??[])),!this.windowFeatures.length){this.closeWindow();return}this.maxIndex=this.windowFeatures.length-1,this.onFocusWindowFeature(0)}selectedWindowFeature(e){return this.focusedIndex=no(e,this.maxIndex),this.getWindowFeature()}togglePanel(e){if(this.state.interface.selectionComponent!=="window"){if(!this.visible)return;e=!1}this.visible=e,e?this.onFeaturesSelected(this.state.selection.selectedFeatures):this.render()}static createWindowFeatures(e){const i=[];return Object.keys(e).forEach(r=>{const n=e[r];n.features.forEach((s,a)=>{i.push({id:r,feature:s,notOlProperties:n.notOlProperties[a]})})}),i}}const Qg="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20448%20512'%3e%3c!--!Font%20Awesome%20Free%206.5.1%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202024%20Fonticons,%20Inc.--%3e%3cpath%20d='M64%2032C28.7%2032%200%2060.7%200%2096V416c0%2035.3%2028.7%2064%2064%2064H384c35.3%200%2064-28.7%2064-64V96c0-35.3-28.7-64-64-64H64zm297.1%2084L257.3%20234.6%20379.4%20396H283.8L209%20298.1%20123.3%20396H75.8l111-126.9L69.7%20116h98l67.7%2089.5L313.6%20116h47.5zM323.3%20367.6L153.4%20142.9H125.1L296.9%20367.6h26.3z'/%3e%3c/svg%3e",Jg="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20448%20512'%3e%3c!--!Font%20Awesome%20Free%206.5.1%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202024%20Fonticons,%20Inc.--%3e%3cpath%20d='M64%2032C28.7%2032%200%2060.7%200%2096V416c0%2035.3%2028.7%2064%2064%2064h98.2V334.2H109.4V256h52.8V222.3c0-87.1%2039.4-127.5%20125-127.5c16.2%200%2044.2%203.2%2055.7%206.4V172c-6-.6-16.5-1-29.6-1c-42%200-58.2%2015.9-58.2%2057.2V256h83.6l-14.4%2078.2H255V480H384c35.3%200%2064-28.7%2064-64V96c0-35.3-28.7-64-64-64H64z'/%3e%3c/svg%3e",tc="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20448%20512'%3e%3c!--!Font%20Awesome%20Free%206.5.1%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202024%20Fonticons,%20Inc.--%3e%3cpath%20d='M416%2032H31.9C14.3%2032%200%2046.5%200%2064.3v383.4C0%20465.5%2014.3%20480%2031.9%20480H416c17.6%200%2032-14.5%2032-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4%20416H69V202.2h66.5V416zm-33.2-243c-21.3%200-38.5-17.3-38.5-38.5S80.9%2096%20102.2%2096c21.2%200%2038.5%2017.3%2038.5%2038.5%200%2021.3-17.2%2038.5-38.5%2038.5zm282.1%20243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6%200-39.9%2027-39.9%2054.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8%2030.6-34.5%2062.9-34.5%2067.2%200%2079.7%2044.3%2079.7%20101.9V416z'/%3e%3c/svg%3e",ec="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20448%20512'%3e%3c!--!Font%20Awesome%20Free%206.5.1%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202024%20Fonticons,%20Inc.--%3e%3cpath%20d='M64%2032C28.7%2032%200%2060.7%200%2096V416c0%2035.3%2028.7%2064%2064%2064H384c35.3%200%2064-28.7%2064-64V96c0-35.3-28.7-64-64-64H64zM218%20271.7L64.2%20172.4C66%20156.4%2079.5%20144%2096%20144H352c16.5%200%2030%2012.4%2031.8%2028.4L230%20271.7c-1.8%201.2-3.9%201.8-6%201.8s-4.2-.6-6-1.8zm29.4%2026.9L384%20210.4V336c0%2017.7-14.3%2032-32%2032H96c-17.7%200-32-14.3-32-32V210.4l136.6%2088.2c7%204.5%2015.1%206.9%2023.4%206.9s16.4-2.4%2023.4-6.9z'/%3e%3c/svg%3e";class ic{constructor(t){l(this,"serviceUrl");this.serviceUrl=t}async shortenUrl(t){const e=new URLSearchParams;e.append("lsturl",t),e.append("format","json");const i={success:!1,shorturl:t};try{const n=await(await fetch(this.serviceUrl,{method:"POST",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"}),body:e})).json();if(n.success){const s=n;return{success:!0,shorturl:s.short,qrcode:`data:image/png;base64, ${s.qrcode}`}}return i}catch{return i}}}class rc{constructor(t){l(this,"serviceUrl");this.serviceUrl=t}async shortenUrl(t){const e={success:!1,shorturl:t};try{const i=new URLSearchParams;i.append("url",t);const n=await(await fetch(this.serviceUrl,{method:"POST",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"}),body:i})).json();return n?{success:!0,shorturl:n.short_url}:e}catch{return e}}}const Rs="SimpleMask";class nc{constructor(t){l(this,"maskLayer",new $r({name:Rs}));l(this,"map");l(this,"visible",!1);this.map=t}setMaskVisibility(t){const e=zs(this.map,Rs);if(this.visible=t,this.visible&&!e){this.map.addLayer(this.maskLayer);return}!this.visible&&e&&this.map.removeLayer(this.maskLayer)}setMaskSize(t){this.maskLayer.updateSize(t),this.renderMask()}renderMask(){this.visible&&this.maskLayer.changed()}}class sc extends Y{constructor(){super("share");l(this,"template",()=>_`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style><style>
#content{background:var(--bkg-color);color:var(--text-color);padding:1rem;margin:0}.group{padding-bottom:4em}.title{margin-top:0}.link{margin-top:.5rem;display:flex;flex-direction:column;gap:.2rem}.qrcode{margin:auto;margin-top:2rem;display:block;width:10rem;opacity:.7}.social{display:flex}.social button{margin:auto;margin-top:2rem;cursor:pointer;border:none;background-color:transparent}.social img{width:3rem;opacity:.7;filter:var(--svg-filter)}.social img:hover{opacity:1}input{font-size:.9rem;flex-grow:1}.error{order:3;color:var(--error-color);text-align:center;width:90%}.textarea-for-code{max-height:initial;line-height:1.1rem;font-size:.75rem;height:6.25rem;font-family:monospace,Arial,sans-serif}.copy-success,.copy-success:hover{background-color:var(--success-color)}
</style>
<div id="panel">
  <div id="content">
    <div class="${this.urlShortener?"hidden":""}">
      <div class="message" i18n="Error, the shortener service is not defined.">
        Error, the shortener service is not defined.
      </div>
    </div>

    <!-- share tab -->
    <div id="share-map" class="${this.urlShortener?"group":"hidden"}">
      <h3 class="title" i18n="Share this map">Share this map</h3>

      <div>
        <div class="link">
          <input type="text" value="${this.shareLink}" class="gg-input" />
          <button
            id="btn-copy-short"
            class="gg-button"
            disabled="${this.loading||!this.shareLink}"
            i18n="Copy link"
            onclick="${()=>this.copyToClipboard("short")}">
            Copy link
          </button>
        </div>
      </div>

      <img alt="share-qrcode" class="${this.qrCode?"qrcode":"hidden"}" src="${this.qrCode}" />
      <div class="${this.success?"hidden":"qrcode error"}">
        <img alt="error-icon" src="icons/error.svg" />
        <span i18n="Error, can not fetch the shortener service. Please try again later.">
          Error, can not fetch the shortener service. Please try again later.</span
        >
      </div>

      <div class="social">
        <button onclick="${()=>this.shareFacebook()}">
          <img alt="share-facebook" src="${this.facebookLogo}" />
        </button>
        <button onclick="${()=>this.shareTwitter()}">
          <img alt="share-twitter" src="${this.twitterLogo}" />
        </button>
        <button onclick="${()=>this.shareLinkedIn()}">
          <img alt="share-linkedin" src="${this.linkedInLogo}" />
        </button>
        <button onclick="${()=>this.shareMail()}">
          <img alt="share-mail" src="${this.mailLogo}" />
        </button>
      </div>
    </div>

    <!-- embed tab -->
    <div id="embed-map" class="${this.urlShortener?"group":"hidden"}">
      <h3 class="title" i18n="Embed this map">Embed this map</h3>

      <div class="link">
        <select class="gg-select" id="logLevel" onchange="${e=>this.onSizeChanged(e)}">
          <option ?selected="${this.iframeSize===""}" i18n="Select map size..." value="">Select map size...</option>
          <option ?selected="${this.iframeSize==="small"}" i18n="Small" value="small">Small</option>
          <option ?selected="${this.iframeSize==="medium"}" i18n="Medium" value="medium">Medium</option>
          <option ?selected="${this.iframeSize==="large"}" i18n="Large" value="large">Large</option>
        </select>
        <textarea value="${this.iframeCode}" class="gg-input gg-textarea textarea-for-code"></textarea>
        <button
          id="btn-copy-iframe"
          class="gg-button"
          disabled="${this.loading||!this.iframeSize||!this.iframeCode}"
          i18n="Copy code"
          onclick="${()=>this.copyToClipboard("iframe")}">
          Copy code
        </button>
      </div>
    </div>
  </div>
</div>
`);l(this,"visible",!1);l(this,"loading",!0);l(this,"shareLink");l(this,"qrCode");l(this,"success",!0);l(this,"twitterLogo",Qg);l(this,"facebookLogo",Jg);l(this,"linkedInLogo",tc);l(this,"mailLogo",ec);l(this,"iframeUrl");l(this,"iframeCode");l(this,"shareManager");l(this,"urlShortener");l(this,"mapManager");l(this,"simpleMaskManager");l(this,"eventsCallbacks",[]);l(this,"iframeSize","");this.shareManager=so.getInstance(),this.mapManager=Kt.getInstance()}get iframeWidth(){switch(this.iframeSize){case"small":return 400;case"medium":return 600;case"large":return 800;default:throw new Error("Unknown iframe size")}}get iframeHeight(){switch(this.iframeSize){case"small":return 300;case"medium":return 450;case"large":return 600;default:throw new Error("Unknown iframe size")}}initializeShortenerService(){switch(this.configManager.Config.share.service){case"gmf":this.urlShortener=new rc(this.configManager.Config.share.createUrl);break;case"lstu":this.urlShortener=new ic(this.configManager.Config.share.createUrl);break}}render(){this.visible?this.renderComponent():this.renderEmptyComponent(),this.activateTooltips(!1,[800,0],"top-end"),super.girafeTranslate()}renderComponent(){super.render(),this.simpleMaskManager=new nc(this.mapManager.getMap()),this.registerEvents(),this.generateShareLink()}renderEmptyComponent(){var e;(e=this.simpleMaskManager)==null||e.setMaskVisibility(!1),this.iframeSize="",this.unregisterEvents(),this.renderEmpty()}registerEvents(){const e=Li(()=>{this.generateShareLink()},500);this.eventsCallbacks.push(this.subscribe("position",()=>e()),this.subscribe("layers.layersList",()=>e()),this.subscribe(/layers\.layersList\..*\.activeState/,()=>e()),this.subscribe(/layers\.layersList\..*\.order/,()=>e()),this.subscribe("activeBasemap",()=>e()))}unregisterEvents(){this.unsubscribe(this.eventsCallbacks),this.eventsCallbacks.length=0}async generateShareLink(){if(this.urlShortener){this.loading=!0,this.shareLink="",this.iframeUrl="",this.iframeCode="",this.refreshRender();try{const e=new URL(window.location.href),i=`${e.protocol}//${e.host}${e.pathname}`,r=this.shareManager.getStateToShare(),n=`${i}#${r}`;let s=await this.urlShortener.shortenUrl(n);this.shareLink=s.shorturl,this.success=s.success,this.qrCode=s.qrcode;const a=`${i}iframe.html#${r}`;s=await this.urlShortener.shortenUrl(a),this.iframeUrl=s.shorturl,this.setIframeCode()}finally{this.loading=!1,this.refreshRender()}}}setIframeCode(){this.iframeSize&&this.iframeUrl?this.iframeCode=`<iframe title="iframe GeoGirafe" width="${this.iframeWidth}" height="${this.iframeHeight}" src="${this.iframeUrl}"></iframe>`:this.iframeCode=""}closeWindow(){this.state.interface.sharePanelVisible=!1}shareFacebook(){window.open("https://www.facebook.com/sharer/sharer.php?u="+this.shareLink,"_blank")}shareTwitter(){window.open("https://twitter.com/intent/tweet?url="+this.shareLink,"_blank")}shareLinkedIn(){window.open("https://www.linkedin.com/shareArticle?url="+this.shareLink,"_blank")}shareMail(){const e=encodeURIComponent("Check out this link"),i=encodeURIComponent("I thought you might be interested in this link: "+this.shareLink);window.location.href="mailto:?subject="+e+"&body="+i}copyToClipboard(e){let i="";e==="short"?i=this.shareLink??"":e==="iframe"&&(i=this.iframeCode??""),i&&(navigator.clipboard.writeText(i),this.showCopySuccessEffect(`btn-copy-${e}`))}onSizeChanged(e){var i;this.iframeSize=(i=e.target)==null?void 0:i.value,this.setIframeCode(),this.refreshRender(),this.iframeSize?this.showMapPreview():this.hideMapPreview()}showMapPreview(){var e,i;(e=this.simpleMaskManager)==null||e.setMaskSize([this.iframeWidth,this.iframeHeight]),(i=this.simpleMaskManager)==null||i.setMaskVisibility(!0)}hideMapPreview(){var e;(e=this.simpleMaskManager)==null||e.setMaskVisibility(!1)}showCopySuccessEffect(e){const i=this.shadow.getElementById(e);i.classList.add("copy-success"),setTimeout(()=>i.classList.remove("copy-success"),1e3)}connectedCallback(){this.loadConfig().then(()=>{this.render(),this.initializeShortenerService(),this.subscribe("interface.sharePanelVisible",(e,i)=>{this.visible=i,this.render()})})}}const ac="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20448%20512'%3e%3c!--!Font%20Awesome%20Free%206.5.2%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202024%20Fonticons,%20Inc.--%3e%3cpath%20d='M64%2032C28.7%2032%200%2060.7%200%2096V416c0%2035.3%2028.7%2064%2064%2064H384c35.3%200%2064-28.7%2064-64V96c0-35.3-28.7-64-64-64H64zM200%20344V280H136c-13.3%200-24-10.7-24-24s10.7-24%2024-24h64V168c0-13.3%2010.7-24%2024-24s24%2010.7%2024%2024v64h64c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024H248v64c0%2013.3-10.7%2024-24%2024s-24-10.7-24-24z'/%3e%3c/svg%3e";class oc extends Y{constructor(){super("themes");l(this,"template",()=>_`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style><style>
.themes{display:flex;flex-wrap:wrap;width:51rem;margin-top:0;overflow-y:auto;max-height:70vh;border:solid 1px #444;border-radius:3px;padding:1rem;background-color:var(--bkg-color);position:absolute}.custom-theme,.new-theme,.theme{align-content:flex-end;position:relative;width:9rem;border:none;background-color:transparent;cursor:pointer;margin:.5rem;padding:0;border-radius:.5rem}.custom-theme>button>span,.new-theme>button>span,.themes>button>span{display:inline-block;width:95%;text-align:center;color:var(--text-color)}.custom-theme>button>span,.themes>button>span{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.custom-theme>button>img,.new-theme>img,.theme>img{width:100%}button.select{border:none;padding:0;background-color:transparent;cursor:pointer;width:100%}button.select>img{height:3rem;margin-bottom:1rem}button.delete{position:absolute;top:0;right:0}.custom-theme.selected,.theme.selected{background-color:var(--bkg-color-grad2)}.theme-icon{--svg-filter:none}
</style>
<button
  class="gg-icon-button gg-big-withtext"
  title="Theme Selection"
  onclick="${()=>this.toggleThemesList()}"
  onblur="${()=>this.onBlur()}">
  <img
    alt="menu-icon"
    src="icons/themes.svg"
    class="${this.state.loading?"hidden":this.openedOnce?"":"gg-spin-wait"}" />
  <img alt="loading-icon" src="icons/loading.svg" class="${this.state.loading?"gg-spin":"hidden"}" />
  <span i18n="themes">Themes</span>
</button>

<div class="${this.menuOpen?"themes":"hidden"}">
  ${Object.values(this.state.themes._allThemes??{}).map(e=>_t(e,e.id)`
  <button
    class="${this.isThemeActive(e)?"theme selected":"theme"}"
    onmousedown="${()=>this.onThemeChanged(e)}">
    <img class="theme-icon" alt="${"Icon for "+e.name}" src="${e.icon}" />
    <span i18n="${e.name}">${e.name}</span>
  </button>
  `)} ${Object.values(this.customThemes??{}).map(e=>_t(e,e.id)`
  <div class="${this.isThemeActive(e)?"custom-theme selected":"custom-theme"}">
    <button class="select" onmousedown="${()=>this.onCustomThemeChanged(e)}">
      <img alt="${"Icon for "+e.name}" src="${e.icon}" />
      <span i18n="${e.name}">${e.name}</span>
    </button>
    <button class="girafe-button-small delete" onmousedown="${i=>this.onDeleteCustomTheme(e,i)}">
      <img alt="delete-icon" src="icons/close.svg" />
    </button>
  </div>
  `)}

  <div class="new-theme">
    <button class="select" onmousedown="${()=>this.onAddCustomTheme()}">
      <img alt="Create new theme" src="${this.newIcon}" tip="Save the current layer configuration as new theme" />
      <span i18n="Create new theme">Save current theme</span>
    </button>
  </div>
</div>
`);l(this,"newIcon",ac);l(this,"mapManager");l(this,"customThemesManager");l(this,"menuOpen",!1);l(this,"openedOnce",!1);this.mapManager=Kt.getInstance(),this.customThemesManager=$s.getInstance()}get customThemes(){return this.customThemesManager.customThemes}registerEvents(){this.subscribe("loading",()=>super.render()),this.subscribe("themes.isLoaded",()=>{this.state.themes.isLoaded&&(super.render(),super.girafeTranslate())})}onBlur(){this.menuOpen=!1,super.render()}toggleThemesList(){this.openedOnce=!0,this.menuOpen=!this.menuOpen,super.render()}onThemeChanged(e){if(this.state.themes.lastSelectedTheme=e,e.disclaimer&&this.state.infobox.elements.push({id:e.treeItemId,text:e.disclaimer,type:"info"}),this.onBlur(),e.location!=null||e.zoom!=null){const i=this.mapManager.getMap().getView();i.animate({center:e.location??i.getCenter(),zoom:e.zoom??i.getZoom(),duration:1e3})}}isThemeActive(e){var i;return e.id===((i=this.state.themes.lastSelectedTheme)==null?void 0:i.id)}onCustomThemeChanged(e){this.state.themes.lastSelectedTheme=e,this.onBlur()}async onAddCustomTheme(){const e=await window.gPrompt("Please enter a name for the new custom theme","Create custom theme","my theme");e!==!1&&e.trim().length>0&&(this.customThemesManager.addTheme(e,this.state.layers.layersList),super.render())}async onDeleteCustomTheme(e,i){i.stopPropagation(),await window.gConfirm("Do you want to delete this theme?","Delete Theme")&&(this.customThemesManager.deleteTheme(e),super.render())}connectedCallback(){this.loadConfig().then(()=>{super.render(),this.registerEvents(),this.activateTooltips(!1,[800,0],"top"),this.girafeTranslate()})}}const Pa="timeChange";class Ra extends Y{constructor(e){super(e);l(this,"lowerInputElem");l(this,"upperInputElem");l(this,"timeFormatter");l(this,"resolution");l(this,"mode");l(this,"minValue");l(this,"maxValue");l(this,"minDefaultValue","");l(this,"maxDefaultValue","");l(this,"debounceTime",500);l(this,"timeChangeEventDebounced")}initialize(e){this.timeFormatter=new bn(e),this.resolution=this.timeFormatter.resolution,this.mode=this.timeFormatter.mode,this.minValue=this.timeFormatter.minValue,this.maxValue=this.timeFormatter.maxValue,this.minDefaultValue=this.timeFormatter.formatDateString(e.minDefValue??""),this.maxDefaultValue=this.timeFormatter.formatDateString(e.maxDefValue??"")}render(){this.mode?this.rendered?(super.render(),super.girafeTranslate()):this.renderComponent():this.renderEmpty()}renderComponent(){super.render(),this.lowerInputElem=this.getById("input-lower"),this.upperInputElem=this.getById("input-upper")}getInputElement(e){return e==="upper"&&this.mode==="range"?this.upperInputElem:this.lowerInputElem}getValue(e){return e==="upper"&&this.mode==="value"?"":this.getInputElement(e).value}getTimeRestriction(){let e="";const i=this.getValue("lower"),r=this.getValue("upper");return this.mode==="value"?e=this.timeFormatter.formatDateString(i):e=this.timeFormatter.formatTimeRange(i,r),e===""?void 0:e}createTimeChangeEvent(e=!1){this.dispatchEvent(new CustomEvent(Pa,{bubbles:!0,cancelable:!0,detail:e?void 0:this.getTimeRestriction()}))}dispatchTimeChangeEvent(e=!1){this.timeChangeEventDebounced??(this.timeChangeEventDebounced=Li(this.createTimeChangeEvent,this.debounceTime)),this.timeChangeEventDebounced(e)}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate()})}}class Aa extends Y{constructor(e){super(`time-${e.id}`);l(this,"template",()=>_`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style><style>
#container{background-color:var(--bkg-color);color:var(--text-color);display:flex;align-items:center}
</style>
<div id="container">

  ${[this.widget].map(e=>e==="datepicker"?_`
    <girafe-time-picker id="time-widget"></girafe-time-picker>
    `:_`
    <girafe-time-slider id="time-widget"></girafe-time-slider>
    `)}

  <button class="gg-icon-button gg-medium" tip="Remove filter" onclick="${()=>this.onRemove()}">
    <img alt="delete-icon" src="icons/trash.svg" />
  </button>
</div>
`);l(this,"layer");l(this,"timeOptions");l(this,"timeFormatter");l(this,"mode");l(this,"widget");l(this,"timeWidget");this.layer=e,this.timeOptions=this.layer.timeOptions,this.mode=this.timeOptions.mode,this.widget=this.timeOptions.widget,this.timeFormatter=new bn(this.timeOptions)}renderComponent(){this.render(),super.girafeTranslate(),this.timeWidget||this.initTimeWidget(),setTimeout(()=>{this.onOutsideTimeChange(this.layer.timeRestriction)})}initTimeWidget(){this.timeWidget||(this.timeWidget=this.getById("time-widget"),this.timeWidget.initialize(this.timeOptions),this.render(),this.timeWidget.addEventListener(Pa,e=>this.onTimeChange(e.detail)))}onTimeChange(e){e=e===null?void 0:e,e!==this.layer.timeRestriction&&(this.layer.timeRestriction=e)}onRemove(){this.timeWidget.reset()}onOutsideTimeChange(e){if(!e)this.timeWidget.reset();else{const[i,r]=e.split(ao);this.timeWidget.setValue(i,"lower"),this.mode==="range"&&this.timeWidget.setValue(r,"upper")}}connectedCallback(){this.loadConfig().then(()=>{this.renderComponent()})}}class lc extends Ra{constructor(){super("time-picker");l(this,"template",()=>_`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style><style>
#container{display:flex;margin-right:.5rem}
</style>
<div id="container">
  <input id="input-lower"
         class="gg-select gg-medium" />

  <input id="input-upper"
         class="gg-select gg-medium" />
</div>
`)}renderComponent(){super.renderComponent(),this.configureInputElements(),this.addEventListeners()}setValue(e,i="lower"){if(!this.rendered)throw new Error("Cannot set value on unrendered component");i==="upper"&&this.mode==="value"||(this.getInputElement(i).value=e,i==="lower"?this.validateLowerLimit():this.validateUpperLimit(),this.dispatchTimeChangeEvent())}reset(){this.setValue(this.minDefaultValue,"lower"),this.mode==="range"&&this.setValue(this.maxDefaultValue,"upper")}configureInputElements(){this.lowerInputElem.type=this.getHtmlInputType(),this.lowerInputElem.min=this.timeFormatter.formatDateString(this.minValue),this.lowerInputElem.max=this.timeFormatter.formatDateString(this.maxValue),this.lowerInputElem.value=this.minDefaultValue,this.mode==="range"?(this.upperInputElem.type=this.getHtmlInputType(),this.upperInputElem.min=this.timeFormatter.formatDateString(this.minValue),this.upperInputElem.max=this.timeFormatter.formatDateString(this.maxValue),this.upperInputElem.value=this.maxDefaultValue):this.upperInputElem.classList.add("hidden")}getHtmlInputType(){if(oo()||lo())return"date";switch(this.resolution){case"day":return"date";case"week":return"date";case"month":return"month";case"year":return"month";default:return"date"}}addEventListeners(){this.lowerInputElem.addEventListener("change",e=>{(this.lowerInputElem.value===""||this.timeFormatter.formatDateString(this.lowerInputElem.value))&&(this.validateLowerLimit(),this.dispatchTimeChangeEvent())}),this.lowerInputElem.addEventListener("focusout",e=>{this.validateLowerLimit(),this.dispatchTimeChangeEvent()}),this.lowerInputElem.addEventListener("keypress",e=>{e.key==="Enter"&&(this.validateLowerLimit(),this.dispatchTimeChangeEvent())}),this.mode==="range"&&(this.upperInputElem.addEventListener("change",e=>{(this.upperInputElem.value===""||this.timeFormatter.formatDateString(this.upperInputElem.value))&&(this.validateUpperLimit(),this.dispatchTimeChangeEvent())}),this.upperInputElem.addEventListener("focusout",e=>{this.validateUpperLimit(),this.dispatchTimeChangeEvent()}),this.upperInputElem.addEventListener("keypress",e=>{e.key==="Enter"&&(this.validateUpperLimit(),this.dispatchTimeChangeEvent())}))}validateLowerLimit(){const e=this.getValue("lower");this.timeFormatter.formatDateString(e)?this.mode==="range"&&(this.upperInputElem.min=e):this.lowerInputElem.value=this.minDefaultValue}validateUpperLimit(){const e=this.getValue("upper");this.timeFormatter.formatDateString(e)?this.mode==="range"&&(this.lowerInputElem.max=e):this.upperInputElem.value=this.maxDefaultValue}}class gc extends Ra{constructor(){super("time-slider");l(this,"template",()=>_`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style><style>
#container{--slider-color:var(--text-color);--slider-disabled-color:var(--text-color-grad2);--slider-highlight-color:var(--bkg-color-grad2);--slider-length:130px;--thumb-width:16px;--margin-left:calc(var(--thumb-width) / 2);--slider-track-height:6px;--slider-track-border-color:var(--text-color-grad2);--slider-track-outside-color:var(--bkg-color-grad2);--slider-track-inside-color:var(--text-color);color:var(--text-color);display:flex;flex-direction:column;margin:.5rem 0 0 var(--margin-left)}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;pointer-events:all;width:var(--thumb-width);height:var(--thumb-width);margin-top:calc(-1 * var(--slider-track-height));background:var(--slider-color);border:1px solid var(--slider-highlight-color);border-radius:50%;box-shadow:1px 1px 2px #9c9c9c;cursor:pointer}input[type=range]::-webkit-slider-thumb:hover{box-shadow:inset 0 0 2px 0 var(--slider-highlight-color),0 0 4px var(--slider-highlight-color);border-color:var(--bkg-color)}input[type=range]::-webkit-slider-thumb:active{box-shadow:inset 0 0 2px 0 var(--slider-highlight-color),0 0 4px var(--slider-highlight-color);-webkit-box-shadow:inset 0 0 2px 0 var(--slider-highlight-color),0 0 4px var(--slider-highlight-color);border-color:var(--bkg-color)}input[type=range]::-webkit-slider-runnable-track{height:var(--slider-track-height)}input[type=range]::-moz-range-thumb{-webkit-appearance:none;pointer-events:all;width:var(--thumb-width);height:var(--thumb-width);margin-top:calc(-1 * var(--slider-track-height));background:var(--slider-color);border:1px solid var(--slider-highlight-color);border-radius:50%;cursor:pointer}input[type=range]::-moz-range-thumb:hover{box-shadow:inset 0 0 2px 0 var(--slider-highlight-color),0 0 4px var(--slider-highlight-color);border-color:var(--bkg-color)}input[type=range]::-moz-range-thumb:active{box-shadow:inset 0 0 2px 0 var(--slider-highlight-color),0 0 4px var(--slider-highlight-color);-webkit-box-shadow:inset 0 0 2px 0 var(--slider-highlight-color),0 0 4px var(--slider-highlight-color);border-color:var(--bkg-color)}input[type=range]::-moz-range-track{height:var(--slider-track-height)}input[type=range]{-webkit-appearance:none;appearance:none;height:var(--slider-track-height);width:var(--slider-length);background-color:transparent;pointer-events:none;z-index:2}#input-upper{position:absolute}#slider-track{width:calc(var(--slider-length) - var(--thumb-width));margin-left:var(--margin-left);height:var(--slider-track-height);position:absolute;cursor:pointer;pointer-events:all;z-index:0;border:1px solid var(--slider-track-border-color)}.slider-label{font-size:.8rem;margin:2px;display:flex;justify-content:space-around;pointer-events:none;height:1.1rem}
</style>
<div id="container">

  <input id="input-lower"
         type="range"
         min="0"
         max="1"
         step="1" />

  <input id="input-upper"
         type="range"
         min="0"
         max="1"
         step="1" />

  <div id="slider-track"></div>

  <div class="slider-label">
    <output id="output-label-lower"></output>
    <div class="${this.mode==="range"?"":"hidden"}">/</div>
    <output id="output-label-upper"
            class="${this.mode==="range"?"":"hidden"}"></output>
  </div>
</div>
`);l(this,"discreteTimeSteps")}initialize(e){var i;super.initialize(e),this.discreteTimeSteps=((i=e.values)==null?void 0:i.map(r=>this.timeFormatter.formatDateString(r)).filter(r=>r&&r!==""))??void 0,this.discreteTimeSteps&&(this.minValue=this.timeFormatter.parseDateString(this.discreteTimeSteps[0]),this.maxValue=this.timeFormatter.parseDateString(this.discreteTimeSteps[this.discreteTimeSteps.length-1]))}renderComponent(){super.renderComponent(),this.configureInputElements(),this.reset(),this.addEventListeners()}getValue(e){return this.sliderPositionToDateString(super.getValue(e))}setValue(e,i="lower",r=!0){if(!this.rendered)throw new Error("Cannot set value on unrendered component");i==="upper"&&this.mode==="value"||(this.getInputElement(i).value=this.dateStringToSliderPosition(e),this.updateOutputLabel(i),this.updateSliderColorRange(),this.toggleSliderState(e!==""),i==="lower"?this.validateLowerLimit():this.validateUpperLimit(),r&&this.dispatchTimeChangeEvent())}reset(){this.minDefaultValue||this.maxDefaultValue?(this.setValue(this.minDefaultValue,"lower"),this.mode==="range"&&this.setValue(this.maxDefaultValue,"upper")):(this.setValue(this.minDefaultValue,"lower",!1),this.mode==="range"&&this.setValue(this.timeFormatter.formatDateString(this.maxValue),"upper",!1),this.toggleSliderState(!1),this.dispatchTimeChangeEvent(!0))}configureInputElements(){this.lowerInputElem.max=this.countSliderStepsInRange().toString(),this.lowerInputElem.value=this.dateStringToSliderPosition(this.minDefaultValue),this.mode==="range"&&(this.upperInputElem.max=this.countSliderStepsInRange().toString(),this.upperInputElem.value=this.maxDefaultValue?this.dateStringToSliderPosition(this.maxDefaultValue):this.countSliderStepsInRange().toString()),this.mode==="value"&&this.upperInputElem.classList.add("hidden")}addEventListeners(){this.lowerInputElem.addEventListener("input",e=>{this.updateOutputLabel("lower"),this.updateSliderColorRange(),this.toggleSliderState(!0)}),this.lowerInputElem.addEventListener("change",e=>{this.validateLowerLimit(),this.dispatchTimeChangeEvent()}),this.mode==="range"&&(this.upperInputElem.addEventListener("input",e=>{this.updateOutputLabel("upper"),this.updateSliderColorRange(),this.toggleSliderState(!0)}),this.upperInputElem.addEventListener("change",e=>{this.validateUpperLimit(),this.dispatchTimeChangeEvent()})),this.getById("slider-track").addEventListener("click",e=>{this.trackClickToSliderPosition(e)})}updateOutputLabel(e){const i=this.getInputElement(e),r=this.getById(`output-label-${e}`),n=i.value??"";r.innerText=this.timeFormatter.formatDateString(this.sliderPositionToDateString(n))}updateSliderColorRange(){const e=this.countSliderStepsInRange();if(this.mode!=="range"||e===0)return;const i=100*parseInt(this.lowerInputElem.value)/e,r=100*(this.mode==="range"?parseInt(this.upperInputElem.value):e)/e,n=this.getById("slider-track"),s="var(--slider-track-outside-color)",a="var(--slider-track-inside-color)";n.style.background=`linear-gradient(to right, ${s} 0%, ${s} ${i}%, ${a} ${i}%, ${a} ${r}%, ${s} ${r}%, ${s} 100%)`}toggleSliderState(e){this.getById("output-label-lower").style.color=e?"var(--slider-color)":"var(--slider-disabled-color)",this.getById("output-label-upper").style.color=e?"var(--slider-color)":"var(--slider-disabled-color)",this.getById("slider-track").style.borderColor=e?"var(--slider-track-border-color)":"var(--slider-disabled-color)"}trackClickToSliderPosition(e){const i=e.offsetX,r=e.target.offsetWidth,n=Math.round(i/r*this.countSliderStepsInRange()),s=this.sliderPositionToDateString(n.toString());if(this.mode==="value")this.setValue(s,"lower");else{const a=Number(this.lowerInputElem.value),o=Number(this.upperInputElem.value),c=(a+o)/2;let h;n<=a?h="lower":n>=o?h="upper":h=n<c?"lower":"upper",this.setValue(s,h)}}validateLowerLimit(){const e=this.sliderPositionToDateString(this.lowerInputElem.value),i=this.sliderPositionToDateString(this.upperInputElem.value);this.mode==="range"&&e>i&&this.setValue(i,"lower")}validateUpperLimit(){const e=this.sliderPositionToDateString(this.upperInputElem.value),i=this.sliderPositionToDateString(this.lowerInputElem.value);this.mode==="range"&&e<i&&this.setValue(i,"upper"),Number(this.upperInputElem.value)<=0?this.upperInputElem.style.zIndex="3":this.upperInputElem.style.zIndex="1"}dateStringToSliderPosition(e){let i=0;if(this.timeFormatter.parseDateString(e)){const r=new Date(e);r>this.maxValue?i=this.countSliderStepsInRange():r>this.minValue&&(i=this.countSliderStepsInRange(r))}return i.toString()}sliderPositionToDateString(e){if(e===""||isNaN(Number(e)))return"";const i=Number(e),r=1e3*60*60*24;let n;if(this.discreteTimeSteps)return this.discreteTimeSteps.length===0||i>=this.discreteTimeSteps.length?"":this.discreteTimeSteps[i];switch(this.resolution){case"day":n=new Date(Date.UTC(this.minValue.getUTCFullYear(),this.minValue.getUTCMonth(),this.minValue.getUTCDate()+i));break;case"week":n=new Date(this.minValue.getTime()+r*7*i);break;case"month":n=new Date(Date.UTC(this.minValue.getUTCFullYear(),this.minValue.getUTCMonth()+i,this.minValue.getUTCDate()));break;case"year":n=new Date(Date.UTC(this.minValue.getUTCFullYear()+i,this.minValue.getUTCMonth(),this.minValue.getUTCDate()));break;default:throw new Error("Invalid resolution")}return bn.queryStringFromSingleValueAndResolution(n,this.resolution)}countSliderStepsInRange(e){if(e??(e=this.maxValue),this.discreteTimeSteps)return this.getPositionInTimeValuesList(e)??0;const i=e.getTime()-this.minValue.getTime(),r=1e3*60*60*24,n=e.getUTCFullYear()-this.minValue.getUTCFullYear();switch(this.resolution){case"day":return Math.round(i/r);case"week":return Math.round(i/(r*7));case"month":return n*12-this.minValue.getUTCMonth()+e.getUTCMonth();case"year":return n;default:return 0}}getPositionInTimeValuesList(e){if(!this.discreteTimeSteps)return;const i=this.timeFormatter.formatDateString(e);return this.discreteTimeSteps.findIndex(r=>r===i)}}class Be{static checkParents(t,e){if(t.parent!==e.parent)throw Error("Layers can only be reordered if the have the same parent")}static reorderLayers(t,e,i,r){Be.checkParents(t,e),t.order=e.order;const n=t.parent?t.parent.children:ae.getInstance().state.layers.layersList;for(const s of n)s.treeItemId!==t.treeItemId&&i(s.order,t.order)&&(s.order+=r)}static moveLayerAfter(t,e){const i=t.order;Be.reorderLayers(t,e,(r,n)=>r<=n&&r>=i,-1)}static moveLayerBefore(t,e){const i=t.order;Be.reorderLayers(t,e,(r,n)=>r>=n&&r<=i,1)}}class cc extends go{constructor(){super(...arguments);l(this,"layer");l(this,"destination");l(this,"dragAfter",!1);l(this,"dragBefore",!1)}dragStart(e){this.layer=e}dragEnd(){if(this.layer&&this.destination&&this.layer.parent===this.destination.parent){if(this.layer.order<this.destination.order)Be.moveLayerAfter(this.layer,this.destination);else if(this.layer.order>this.destination.order)Be.moveLayerBefore(this.layer,this.destination);else throw Error("Orders are equal. Not managed yet");this.layer=void 0,this.destination=void 0}else console.debug("Illegal drag&drop")}dragEnter(e){var i;return this.layer&&this.layer!==e&&((i=this.layer)==null?void 0:i.parent)===e.parent?(this.destination=e,this.layer.order>e.order?this.dragBefore=!0:this.dragAfter=!0,!0):!1}dragLeave(e){var i,r,n,s;return((i=this.layer)==null?void 0:i.treeItemId)!==e.treeItemId&&((n=(r=this.layer)==null?void 0:r.parent)==null?void 0:n.treeItemId)===((s=e.parent)==null?void 0:s.treeItemId)?(this.dragAfter=!1,this.dragBefore=!1,!0):!1}}class Fa extends Y{constructor(e,i){super(i);l(this,"dragManager");l(this,"layerManager");l(this,"layer");l(this,"dragButton");l(this,"container");this.layer=e,this.layerManager=Ji.getInstance(),this.dragManager=cc.getInstance()}render(){super.render(),this.dragButton=this.shadow.getElementById("drag-button"),this.container=this.shadow.getElementById("container"),super.girafeTranslate(),this.initializeDrag(),this.createTooltips(),os(this.layer)&&this.createTimeRestrictionTooltip(this.layer)}refreshRender(e){this.state.treeview.renderEnabled&&(!e||e===this.layer)&&(super.refreshRender(),this.createTooltips())}createTooltips(){super.activateTooltips(!1,[800,0],"top")}showMetadata(){window.gOpenWindow(this.layer.name,this.layer.metadataUrl)}initializeDrag(){this.dragButton.draggable=!0,this.dragButton.ondragstart=e=>this.dragStart(e),this.dragButton.ondragend=e=>this.dragEnd(e),this.ondragenter=e=>this.dragEnter(e),this.ondragleave=e=>this.dragLeave(e)}dragStart(e){this.dragManager.dragStart(this.layer),e.dataTransfer.setDragImage(this,this.offsetWidth,0)}dragEnd(e){this.dragManager.dragEnd()}dragEnter(e){this.dragManager.dragEnter(this.layer)&&this.setDragStyle()}dragLeave(e){this.dragManager.dragLeave(this.layer)&&this.setDragStyle()}setDragStyle(){this.dragManager.dragAfter?(this.container.classList.remove("dragBefore"),this.container.classList.add("dragAfter")):this.dragManager.dragBefore?(this.container.classList.remove("dragAfter"),this.container.classList.add("dragBefore")):(this.container.classList.remove("dragAfter"),this.container.classList.remove("dragBefore"))}getButtonClass(e){const i="gg-icon-button gg-small gg-opacity tool",r=i+" active";switch(e){case"swipedLeft":return!this.layer.inactive&&this.layer instanceof qr?this.layer.swiped==="left"?r:i:"hidden";case"swipedRight":return!this.layer.inactive&&this.layer instanceof qr?this.layer.swiped==="right"?r:i:"hidden";case"opacity":return!this.layer.inactive&&this.layer instanceof qr?this.layer.opacity<1?r:i:"hidden";case"filter":return!this.layer.inactive&&this.layer instanceof Tt&&this.layer.queryable?this.layer.hasFilter?r:i:"hidden";case"timeRestriction":return!this.layer.inactive&&os(this.layer)?this.layer.hasTimeRestriction?r:i:"hidden";default:throw Error("Unsupported type: "+e)}}createTimeRestrictionTooltip(e){const i=this.shadow.getElementById("timeRestriction");i&&or(i,{trigger:"click",arrow:!0,interactive:!0,theme:"light",placement:"right",appendTo:document.body,content:r=>new Aa(e)})}removeFromParent(){setTimeout(()=>{if(this.layer.parent){const e=this.layer.parent.children.findIndex(i=>i===this.layer);e>=0&&this.layer.parent.children.splice(e,1)}else{const e=this.state.layers.layersList.findIndex(i=>i===this.layer);e>=0&&this.state.layers.layersList.splice(e,1)}})}}class Oa extends Fa{constructor(e,i){super(e,i);l(this,"layer");this.layer=e}sortedChildren(){return this.layerManager.getSortedLayers(this.layer.children)}deactivateThemeOrGroup(e){if(e.activeState="off",e instanceof De||e instanceof de)for(const i of e.children)this.deactivateThemeOrGroup(i)}toggle(e){this.layerManager.toggleGroupOrTheme(this.layer,e)}}class hc extends Oa{constructor(e){super(e,"treeviewgroup");l(this,"template",()=>_`<style>
header{border-top:solid 1px #ddd;display:flex;align-items:center;height:2rem}.tool{display:none!important}header:hover .tool{display:flex!important}.tool.active{display:flex!important;opacity:1!important}.label-container{display:flex;flex-grow:1;align-items:center;overflow:auto}.label-out-resolution span{font-style:italic}.resolution-tool{margin-left:.5rem}.legend{display:flex}.legend img{height:fit-content;background:var(--svg-legend-bkg);filter:var(--svg-map-filter)}.legend-icon{max-height:1.5rem;margin-left:.5rem;background:var(--svg-legend-bkg);filter:var(--svg-map-filter)}.children{padding-left:1.3rem;flex-basis:100%;order:10}.dragAfter{border-bottom:dashed 1rem #ccc}.dragBefore{border-top:dashed 1rem #ccc}.gg-checkbox{width:1.2rem}.gg-caret,.gg-spacer{width:1.5rem;padding:0}.gg-caret{transform:scale(130%)}.gg-caret.gg-rotate90{transform:scale(130%) rotate(90deg)}.gg-small.gg-image{min-width:1rem;width:1rem;padding:.25rem}.gg-tree-label{text-align:left;padding-left:0;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.gg-grab:hover{cursor:grab}.gg-selected{opacity:1}.legend-file{display:flex;font-style:italic;color:var(--text-color)}
</style><style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style>
<link rel="stylesheet" href="lib/tippy.js/tippy.css" />
<link rel="stylesheet" href="lib/tippy.js/backdrop.css" />
<link rel="stylesheet" href="lib/tippy.js/border.css" />
<link rel="stylesheet" href="lib/tippy.js/svg-arrow.css" />

<div id="container">
  <header>
    <!-- Caret -->
    <button
      class="gg-icon-button gg-small gg-opacity"
      tip="Expand / Collapse"
      onclick="${()=>this.layer.isExpanded=!this.layer.isExpanded}">
      <img
        class="${this.layer.isExpanded?"gg-rotate90 gg-caret":"gg-caret"}"
        alt="Expand/Collapse button"
        src="icons/expand.svg" />
    </button>

    <!-- Checkbox -->
    <button
      class="${this.layer.activeState==="on"?"gg-icon-button gg-small gg-selected":"gg-icon-button gg-small gg-opacity"}"
      tip="Activate / Deactivate"
      onclick="${()=>this.toggle()}">
      <img
        class="${this.layer.activeState==="on"?"gg-checkbox":"hidden"}"
        alt="Expand/Collapse button"
        src="icons/checked-full.svg" />
      <img
        class="${this.layer.activeState==="semi"?"gg-checkbox":"hidden"}"
        alt="Expand/Collapse button"
        src="icons/checked-half.svg" />
      <img
        class="${this.layer.activeState==="off"?"gg-checkbox":"hidden"}"
        alt="Expand/Collapse button"
        src="icons/checked-no.svg" />
    </button>

    <!-- Error icon -->
    <button class="${this.layer.hasError?"gg-icon-button gg-small gg-opacity":"hidden"}" tip="Error on layer">
      <img alt="Error on layer" src="icons/error.svg" />
    </button>

    <!-- Label -->
    <div class="label-container">
      <button
        class="${this.layer.activeState==="on"?"gg-icon-button gg-small gg-selected":"gg-icon-button gg-small gg-opacity"}"
        onclick="${()=>this.toggle()}">
        <span i18n="${this.layer.name}" class="gg-tree-label"> ${this.layer.name} </span>
      </button>
    </div>

    <!-- Time restriction -->
    <button
      id="timeRestriction"
      class="${this.getButtonClass("timeRestriction")}"
      tip="Define time restriction on group">
      <img alt="Define time restriction on group" src="icons/clock.svg" />
    </button>

    <!-- Metadata icon -->
    <button
      class="${this.layer.hasMetadata?"metadata gg-icon-button gg-small gg-opacity tool":"hidden"}"
      tip="Show metadata"
      onclick="${()=>this.showMetadata()}">
      <img alt="Remove theme" src="icons/info.svg" />
    </button>

    <!-- Drag -->
    <button id="drag-button" class="gg-icon-button gg-small gg-grab gg-opacity tool" tip="Move">
      <img alt="Move layer" src="icons/drag.svg" />
    </button>

    <!-- Remove icon -->
    <button
      class="remove gg-icon-button gg-small gg-opacity tool"
      tip="Remove group"
      onclick="${()=>this.deleteGroup()}">
      <img alt="Remove group" src="icons/trash.svg" />
    </button>
  </header>

  <!-- Sub layers -->
  <div class="${this.layer.isExpanded&&this.layer.isVisible?"children":"hidden"}">
    <!-- prettier-ignore -->
    ${this.sortedChildren().filter(e=>e.isVisible).map(e=>e instanceof de?_t(e,e.treeItemId)`
    <girafe-tree-view-group groupid="${e.treeItemId}"></girafe-tree-view-group>
    `:_t(e,e.treeItemId)`
    <girafe-tree-view-item layerid="${e.treeItemId}"></girafe-tree-view-item>
    `)}
  </div>
</div>
`);l(this,"layer");this.layer=e}render(){const e=this.getAttribute("groupid");e&&(this.layer=this.layerManager.getTreeItem(e)),super.render()}registerEvents(){this.subscribe(/layers\.layersList\..*\.isExpanded/,(e,i,r)=>this.refreshRender(r)),this.subscribe(/layers\.layersList\..*\.activeState/,(e,i,r)=>this.refreshRender(r)),this.subscribe(/layers\.layersList\..*\.children/,(e,i,r)=>this.refreshRender(r)),this.subscribe(/layers\.layersList\..*\.order/,(e,i,r)=>{this.refreshRender(r),this.refreshRender(r.parent)}),this.subscribe(/layers\.layersList\..*\.timeRestriction/,(e,i,r)=>{r===this.layer&&this.refreshRender(this.layer)}),this.subscribe("treeview.renderEnabled",(e,i)=>{i&&this.refreshRender()})}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}deleteGroup(){this.deactivateThemeOrGroup(this.layer),this.removeFromParent()}}class dc extends Fa{constructor(e){super(e,"treeviewitem");l(this,"template",()=>{var e;return _`<style>
header{border-top:solid 1px #ddd;display:flex;align-items:center;height:2rem}.tool{display:none!important}header:hover .tool{display:flex!important}.tool.active{display:flex!important;opacity:1!important}.label-container{display:flex;flex-grow:1;align-items:center;overflow:auto}.label-out-resolution span{font-style:italic}.resolution-tool{margin-left:.5rem}.legend{display:flex}.legend img{height:fit-content;background:var(--svg-legend-bkg);filter:var(--svg-map-filter)}.legend-icon{max-height:1.5rem;margin-left:.5rem;background:var(--svg-legend-bkg);filter:var(--svg-map-filter)}.children{padding-left:1.3rem;flex-basis:100%;order:10}.dragAfter{border-bottom:dashed 1rem #ccc}.dragBefore{border-top:dashed 1rem #ccc}.gg-checkbox{width:1.2rem}.gg-caret,.gg-spacer{width:1.5rem;padding:0}.gg-caret{transform:scale(130%)}.gg-caret.gg-rotate90{transform:scale(130%) rotate(90deg)}.gg-small.gg-image{min-width:1rem;width:1rem;padding:.25rem}.gg-tree-label{text-align:left;padding-left:0;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.gg-grab:hover{cursor:grab}.gg-selected{opacity:1}.legend-file{display:flex;font-style:italic;color:var(--text-color)}
</style><style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style>
<link rel="stylesheet" href="lib/tippy.js/tippy.css" />
<link rel="stylesheet" href="lib/tippy.js/backdrop.css" />
<link rel="stylesheet" href="lib/tippy.js/border.css" />
<link rel="stylesheet" href="lib/tippy.js/svg-arrow.css" />

<div id="container">
  <header>
    <!-- Spacer -->
    <img
      class="${this.layer.protected?"gg-small gg-image gg-opacity":"hidden"}"
      alt="Protected layer"
      src="icons/protected.svg" />
    <div class="${this.layer.protected?"hidden":"gg-spacer gg-small"}"></div>

    <!-- Checkbox -->
    <button
      class="${this.layer.active?"gg-icon-button gg-small gg-selected":"gg-icon-button gg-small gg-opacity"}"
      tip="Activate / Deactivate"
      onclick="${()=>this.toggle()}">
      <img
        class="${this.layer.active?"gg-checkbox":"hidden"}"
        alt="Expand/Collapse button"
        src="icons/checked-full.svg" />
      <img
        class="${this.layer.active?"hidden":"gg-checkbox"}"
        alt="Expand/Collapse button"
        src="icons/checked-no.svg" />
    </button>

    <!-- Error icon -->
    <button class="${this.layer.hasError?"gg-icon-button gg-small gg-opacity":"hidden"}" tip="Error on layer">
      <img alt="Error on layer" src="icons/error.svg" />
    </button>

    <!-- Label -->
    <div class="${this.isVisibleInCurrentResolution()?"label-container":"label-container label-out-resolution"}">
      <button
        class="${this.layer.active?"gg-icon-button gg-small gg-selected":"gg-icon-button gg-small gg-opacity"}"
        onclick="${()=>this.toggle()}">
        <span i18n="${this.layer.name}" class="gg-tree-label"> ${this.layer.name} </span>
      </button>
      <!-- zoom to resolution -->
      <button
        class="${this.layer.active&&this.layer instanceof Tt&&!this.isVisibleInCurrentResolution()?"gg-icon-button gg-small resolution-tool":"hidden"}"
        tip="Zoom to visible resolution"
        onclick="${()=>this.zoomToVisibleResolution()}">
        <img alt="Zoom to visible resolution" src="icons/zoom.svg" />
      </button>
      <!-- layer icon -->
      <img
        class="${this.layer.active&&this.iconUrl?"legend-icon":"hidden"}"
        alt="${"Icon for "+this.layer.name}"
        src="${this.iconUrl}"
        crossorigin="${this.getCrossOrigin(this.iconUrl)}" />
    </div>

    <!-- zoom to full extent -->
    <button
      class="${this.layer.active&&this.layer instanceof Xi?"gg-icon-button gg-small gg-opacity tool":"hidden"}"
      tip="Zoom to full extent"
      onclick="${()=>this.zoomToFullExtent()}">
      <img alt="Zoom to full extent" src="icons/zoom.svg" />
    </button>

    <!-- swipe icons -->
    <button
      class="${this.getButtonClass("swipedLeft")}"
      tip="Swipe layer to the left"
      onclick="${()=>this.layer.swiped=this.layer.swiped==="left"?"no":"left"}">
      <img alt="Swipe layer to the left" src="icons/swipe-left.svg" />
    </button>
    <button
      class="${this.getButtonClass("swipedRight")}"
      tip="Swipe layer to the right"
      onclick="${()=>this.layer.swiped=this.layer.swiped==="right"?"no":"right"}">
      <img alt="Swipe layer to the right" src="icons/swipe-right.svg" />
    </button>

    <!-- opacity icon -->
    <button id="opacity" class="${this.getButtonClass("opacity")}" tip="Control opacity">
      <img alt="Control opacity" src="icons/opacity.svg" />
    </button>

    <!-- Filter -->
    <button id="filter" class="${this.getButtonClass("filter")}" tip="Filter layer">
      <img alt="Filter layer" src="icons/filter.svg" />
    </button>

    <!-- Time restriction -->
    <button id="timeRestriction" class="${this.getButtonClass("timeRestriction")}" tip="Define time restriction on layer">
      <img alt="Define time restriction on layer" src="icons/clock.svg" />
    </button>

    <!-- Legend icon -->
    <button
      class="${this.hasLegend?"gg-icon-button gg-small gg-opacity tool":"hidden"}"
      tip="Toggle legend"
      onclick="${()=>this.toggleLegend()}">
      <img alt="Toggle legend" src="icons/legend.svg" loading="lazy" />
    </button>

    <!-- Metadata icon -->
    <button
      class="${this.layer.hasMetadata?"metadata gg-icon-button gg-small gg-opacity tool":"hidden"}"
      onclick="${()=>this.showMetadata()}">
      <img alt="Remove theme" src="icons/info.svg" />
    </button>

    <!-- Drag -->
    <button id="drag-button" class="gg-icon-button gg-small gg-grab gg-opacity tool" tip="Move">
      <img alt="Move layer" src="icons/drag.svg" />
    </button>

    <!-- Remove icon -->
    <button
      class="remove gg-icon-button gg-small gg-opacity tool"
      tip="Remove layer"
      onclick="${()=>this.deleteLayer()}">
      <img alt="Remove layer" src="icons/trash.svg" />
    </button>
  </header>

  ${Object.keys(this.legendUrls).map(i=>_`
  <div class="${this.isLegendExpanded?"legend":"hidden"}">
    <div class="gg-spacer gg-small"></div>
    <img
      alt="${"Legend for "+i}"
      src="${this.legendUrls[i]}"
      loading="lazy"
      crossorigin="${this.getCrossOrigin(this.legendUrls[i])}" />
  </div>
  `)}

  <div class="${this.layer instanceof Xi&&this.isLegendExpanded?"legend-file":"legend-file hidden"}">
    <div class="gg-spacer gg-small"></div>
    <div class="gg-spacer gg-small"></div>
    <div>
      <span i18n="File from">File from</span>
      <span>${this.layer.lastModifiedDate}</span>
      <span>[</span>
      <span>${(e=this.layer._features)==null?void 0:e.length}</span>
      <span i18n="features">features</span>
      <span>]</span>
    </div>
  </div>
</div>



`});l(this,"iconUrl",null);l(this,"legendUrls",{});l(this,"layer");this.layer=e}get hasLegend(){return this.layerManager.isLayerWithLegend(this.layer)&&this.layer.legend}get isLegendExpanded(){return this.layerManager.isLayerWithLegend(this.layer)?this.layer.isLegendExpanded:!1}toggleLegend(){this.layerManager.isLayerWithLegend(this.layer)&&(this.layer.isLegendExpanded=!this.layer.isLegendExpanded)}render(){const e=this.getAttribute("layerid");e&&(this.layer=this.layerManager.getTreeItem(e),this.layer instanceof Tt&&this.setWmsLegend(),this.layer instanceof mi&&this.setWmtsLegend()),super.render(),this.createOpacityTooltip(),this.createFilterTooltip()}setWmsLegend(){this.layer instanceof Tt&&(this.layer.iconUrl?this.iconUrl=this.layer.iconUrl:this.layer.legendRule?this.iconUrl=Object.values(this.getLegendImageUrlFromWms(!0))[0]:this.iconUrl=null,this.layer.legend&&(this.layer.legendImage?this.legendUrls[this.layer.layers]=this.layer.legendImage:this.legendUrls=this.getLegendImageUrlFromWms(!1)))}setWmtsLegend(){this.layer instanceof mi&&this.layer.legend&&(this.layer.legendImage?this.legendUrls[this.layer.name]=this.layer.legendImage:console.error(`The WMTS Layer ${this.layer.name} has no legendImage.`))}getCrossOrigin(e){if(!e)return"anonymous";const i=new URL(e).hostname;return this.state.oauth.audience.includes(i)?"use-credentials":"anonymous"}getLegendImageUrlFromWms(e){if(!(this.layer instanceof Tt))throw new Error(`${this.layer.name} is not a WMS layer, this method should not be called.`);const i={};for(const r of this.layer.layers.split(",")){const n=new URL(this.layer.ogcServer.url).hostname;let a=new al({url:this.layer.ogcServer.url,params:{LAYERS:r},ratio:1,crossOrigin:this.state.oauth.audience.includes(n)?"use-credentials":"anonymous"}).getLegendUrl(this.state.position.resolution);if(!a){console.error(`The URL for legend of layer ${r} could not be calculated.`),i[r]="";continue}a.toLowerCase().includes("sld_version")||(a+="&SLD_Version=1.1.0"),e&&(this.isNullOrUndefined(this.layer.legendRule)||(a+="&RULE="+encodeURIComponent(this.layer.legendRule)),a+="&HEIGHT="+this.configManager.Config.treeview.defaultIconSize.height,a+="&WIDTH="+this.configManager.Config.treeview.defaultIconSize.width),i[r]=a}return i}createOpacityTooltip(){const e=this.shadow.getElementById("opacity");or(e,{trigger:"click",arrow:!0,interactive:!0,theme:"light",placement:"bottom-end",content:i=>{const r=document.createElement("input");return r.type="range",r.className="slider",r.min="0",r.max="20",r.value=(this.layer.opacity*20).toString(),r.oninput=()=>this.layer.opacity=parseInt(r.value)/20,r}})}createFilterTooltip(){const e=this.shadow.getElementById("filter");or(e,{trigger:"click",arrow:!0,interactive:!0,theme:"light",placement:"right",appendTo:document.body,content:i=>new Na(this.layer)})}registerEvents(){this.subscribe(/layers\..*\.isLegendExpanded/,(e,i,r)=>{this.refreshLegends(),this.refreshRender(r)}),this.subscribe(/layers\.layersList\..*\.activeState/,(e,i,r)=>{this.refreshLegends(),this.refreshRender(r)}),this.subscribe(/layers\.layersList\..*\.hasError/,(e,i,r)=>this.refreshRender(r)),this.subscribe(/layers\.layersList\..*\.errorMessage/,(e,i,r)=>this.refreshRender(r)),this.subscribe(/layers\.layersList\..*\.filter/,(e,i,r)=>this.refreshRender(r)),this.subscribe(/layers\.layersList\..*\.timeRestriction/,(e,i,r)=>{(r===this.layer||r===this.layer.parent)&&this.refreshRender(this.layer)}),this.subscribe(/layers\.layersList\..*\.opacity/,(e,i,r)=>this.refreshRender(r)),this.subscribe(/layers\.layersList\..*\.swiped/,(e,i,r)=>this.refreshRender(r)),this.subscribe("treeview.advanced",()=>this.refreshRender(this.layer)),this.subscribe("position",()=>this.refreshLegends())}refreshLegends(){this.layer instanceof Tt&&this.layer.hasRestrictedResolution()&&this.layer.isLegendExpanded&&(this.setWmsLegend(),super.refreshRender())}toggle(e){this.layerManager.toggleLayer(this.layer,e)}zoomToVisibleResolution(){if(!(this.layer instanceof Tt))throw new Error(`${this.layer.name} is not a WMS layer, this method should not be called here.`);if(this.layer.maxResolution)if(this.configManager.Config.map.constrainScales){const e=Kt.getInstance().getMap().getView().getResolutions(),i=this.layer.maxResolution,r=e.find(n=>n<i);this.state.position.resolution=r}else{const e=this.layer.maxResolution*.95;this.state.position.resolution=e}}isVisibleInCurrentResolution(){return!(this.layer instanceof Tt)&&!(this.layer instanceof mi)?!0:this.layer.isVisibleAtResolution(this.state.position.resolution)}zoomToFullExtent(){if(!(this.layer instanceof Xi))throw new Error(`${this.layer.name} is not a LocalFile layer, this method should not be called here.`);Kt.getInstance().zoomToExtent(this.layer.extent)}deleteLayer(){this.layerManager.toggleLayer(this.layer,"off"),this.removeFromParent()}connectedCallback(){this.loadConfig().then(()=>{this.render(),this.registerEvents()})}}const uc=(g,t)=>{const e=t.trim().toLowerCase(),r=g.flatMap(s=>Da(s)).filter(s=>s.name.includes(e)),n=Array.from(new Set(r.map(s=>s.idList).flat()));mc(g,n)},mc=(g,t)=>{Ji.getInstance().getFlattenedLayerTree(g).forEach(i=>{const r=t.includes(i.treeItemId);i.isVisible!==r&&(i.isVisible=r)})},Da=(g,t=[])=>{const e=Vt.getInstance().getTranslation(g.name).toLowerCase();return g instanceof De||g instanceof de?[{idList:[...t,...za(g)],name:e},...g.children.flatMap(i=>Da(i,[...t,g.treeItemId]))]:[{idList:[g.treeItemId,...t],name:e}]},za=g=>g instanceof De||g instanceof de?[g.treeItemId,...g.children.flatMap(t=>za(t))]:[g.treeItemId];class pc extends Y{constructor(){super("treeviewroot");l(this,"template",()=>_`<style>
.panel{position:absolute;top:0;left:0;right:0;bottom:0;display:flex;flex-direction:column-reverse;background:var(--bkg-color)}.menu{border-top:solid 1px #bbb;z-index:1;display:flex}.treeview-list,.treeview-no-data{padding-top:.5rem;overflow-y:auto;overflow-x:hidden;flex-grow:1}.treeview-search{flex-grow:1;align-self:center;background-color:var(--bkg-color);width:auto;display:flex;flex-direction:row;border:1px solid #cfd6dd;border-radius:4px;margin-right:2px}#treeview-search-field{font-size:1rem;outline:0;border:0;flex:1 1 auto;width:90%;background:0 0;color:var(--text-color);padding:0}.delete-icon,.filter-icon{width:16px;color:var(--text-color);padding:0 .5rem}.delete-button{border:none;padding:0;background-color:transparent;cursor:pointer}.treeview-no-data{display:flex;align-items:center;justify-content:center}.no-data{color:#999;text-align:center;display:flex;align-items:anchor-center;font-variant:small-caps;font-size:1rem;flex-direction:column;gap:.3rem}.no-data span{display:block;flex-grow:1}
</style><style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style>
<link rel="stylesheet" href="lib/tippy.js/tippy.css" />
<link rel="stylesheet" href="lib/tippy.js/backdrop.css" />
<link rel="stylesheet" href="lib/tippy.js/border.css" />
<link rel="stylesheet" href="lib/tippy.js/svg-arrow.css" />

<div id="panel" class="panel">
  <div class="menu">
    <button
      class="gg-icon-button gg-medium"
      tip="Expand / Collapse all"
      tip-placement="top"
      onclick="${()=>this.expandAll()}">
      <img class="${this.isAllExpanded?"":"hidden"}" alt="Collapse all icon" src="icons/collapse-all.svg" />
      <img class="${this.isAllExpanded?"hidden":""}" alt="Expand all icon" src="icons/expand-all.svg" />
    </button>

    <button
      class="gg-icon-button gg-medium"
      tip="Toggle all legends"
      tip-placement="top"
      onclick="${()=>this.toggleAllLegends()}">
      <img alt="Toggle all legends icon" src="icons/legend.svg" />
    </button>

    <button
      class="gg-icon-button gg-medium"
      tip="Remove all layers"
      tip-placement="top"
      onclick="${()=>this.removeAll()}">
      <img alt="Remove all layers icon" src="icons/trash.svg" />
    </button>

    <div class="treeview-search">
      <img class="filter-icon" alt="filter-button-icon" src="icons/filter.svg" />
      <input
        id="treeview-search-field"
        class="gg-input"
        type="text"
        placeholder="Filter layer tree"
        i18n="Filter layer tree"
        autocomplete="off"
        autocorrect="off"
        oninput="${e=>this.filterTree(e.target.value)}" />
      <button class="${this.isTreeFiltered?"delete-button":"hidden"}" onclick="${()=>this.clearFilter()}">
        <img
          class="delete-icon"
          alt="delete-button-icon"
          tip="Reset filter"
          tip-placement="top"
          i18n="Reset filter"
          src="icons/trash.svg" />
      </button>
    </div>
  </div>

  <div class="${this.state.layers.layersList.length>0?"treeview-list":"hidden"}">
    <!-- prettier-ignore -->
    ${this.sortedLayers().filter(e=>e.isVisible).map(e=>e instanceof De?_t(e,e.treeItemId)`
    <girafe-tree-view-theme themeid="${e.treeItemId}"></girafe-tree-view-theme>
    `:e instanceof de?_t(e,e.treeItemId)`
    <girafe-tree-view-group groupid="${e.treeItemId}"></girafe-tree-view-group>
    `:_t(e,e.treeItemId)`
    <girafe-tree-view-item layerid="${e.treeItemId}"></girafe-tree-view-item>
    `)}
  </div>

  <div class="${this.state.layers.layersList.length>0?"hidden":"treeview-no-data"}">
    <div class="no-data">
      <span i18n="Nothing here yet!">Nothing here yet!</span>
      <span>-</span>
      <span i18n="Add your first items">Add your first items</span>
      <span i18n="by selecting a theme">by selecting a theme</span>
      <span i18n="or">or</span>
      <span i18n="using the search bar">using the search bar</span>
    </div>
  </div>
</div>
`);l(this,"layerManager");l(this,"isAllExpanded",!1);l(this,"areAllLegendExpanded",!0);l(this,"isTreeFiltered",!1);this.layerManager=Ji.getInstance()}sortedLayers(){return this.layerManager.getSortedLayers(this.state.layers.layersList)}render(){super.render(),this.activateTooltips(!1,[800,0],"right"),this.girafeTranslate()}registerEvents(){this.subscribe("layers.layersList",()=>{this.isTreeFiltered&&this.clearFilter(),this.refreshRender()}),this.subscribe("treeview.advanced",()=>this.refreshRender()),this.subscribe(/layers\.layersList\..*\.order/,()=>this.refreshRender())}connectedCallback(){this.loadConfig().then(()=>{this.render(),this.registerEvents()})}expandAll(){this.isAllExpanded=!this.isAllExpanded,this.expandAllRecursive(this.state.layers.layersList),super.refreshRender()}expandAllRecursive(e){for(const i of e)(i instanceof de||i instanceof De)&&(i.isExpanded=this.isAllExpanded,this.expandAllRecursive(i.children))}toggleAllLegends(){this.areAllLegendExpanded=!this.areAllLegendExpanded,this.toggleAllLegendsRecursive(this.state.layers.layersList),super.refreshRender()}toggleAllLegendsRecursive(e){for(const i of e)i instanceof Tt&&i.legend?i.isLegendExpanded=this.areAllLegendExpanded:(i instanceof de||i instanceof De)&&this.toggleAllLegendsRecursive(i.children)}removeAll(){for(const e of this.stateManager.state.layers.layersList)this.layerManager.toggle(e,"off");this.state.layers.layersList=[],this.state.themes.lastSelectedTheme=null}filterTree(e){if(e===""){this.clearFilter();return}this.state.treeview.renderEnabled=!1;try{uc(this.state.layers.layersList,e),this.isTreeFiltered=!0}finally{this.state.treeview.renderEnabled=!0,this.refreshRender()}}clearFilter(){this.state.treeview.renderEnabled=!1;try{const e=this.shadow.getElementById("treeview-search-field");e.value="",Ji.getInstance().getFlattenedLayerTree(this.state.layers.layersList).forEach(r=>{r.isVisible||(r.isVisible=!0)}),this.isTreeFiltered=!1}finally{this.state.treeview.renderEnabled=!0,this.refreshRender()}}}class fc extends Oa{constructor(e){super(e,"treeviewtheme");l(this,"template",()=>_`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style><style>
header{border-top:solid 1px #ddd;display:flex;align-items:center;height:2rem}.tool{display:none!important}header:hover .tool{display:flex!important}.tool.active{display:flex!important;opacity:1!important}.label-container{display:flex;flex-grow:1;align-items:center;overflow:auto}.label-out-resolution span{font-style:italic}.resolution-tool{margin-left:.5rem}.legend{display:flex}.legend img{height:fit-content;background:var(--svg-legend-bkg);filter:var(--svg-map-filter)}.legend-icon{max-height:1.5rem;margin-left:.5rem;background:var(--svg-legend-bkg);filter:var(--svg-map-filter)}.children{padding-left:1.3rem;flex-basis:100%;order:10}.dragAfter{border-bottom:dashed 1rem #ccc}.dragBefore{border-top:dashed 1rem #ccc}.gg-checkbox{width:1.2rem}.gg-caret,.gg-spacer{width:1.5rem;padding:0}.gg-caret{transform:scale(130%)}.gg-caret.gg-rotate90{transform:scale(130%) rotate(90deg)}.gg-small.gg-image{min-width:1rem;width:1rem;padding:.25rem}.gg-tree-label{text-align:left;padding-left:0;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.gg-grab:hover{cursor:grab}.gg-selected{opacity:1}.legend-file{display:flex;font-style:italic;color:var(--text-color)}
</style><style>
header{border:solid 1px #ddd;border-radius:1rem;margin:.5rem;flex-direction:row-reverse;position:relative}header:hover{background-color:var(--bkg-color-grad1)}.children{padding-left:.5rem}.children:first-child{border:none}.label-container{position:absolute;top:0;left:0;right:0;bottom:0}.label-container button{flex-grow:1;text-align:center}button{border-radius:1rem}.tool{z-index:1}
</style>
<link rel="stylesheet" href="lib/tippy.js/tippy.css" />
<link rel="stylesheet" href="lib/tippy.js/backdrop.css" />
<link rel="stylesheet" href="lib/tippy.js/border.css" />
<link rel="stylesheet" href="lib/tippy.js/svg-arrow.css" />

<div id="container">
  <header>
    <!-- Label -->
    <div class="label-container">
      <button
        class="gg-icon-button gg-small gg-selected"
        onclick="${()=>this.layer.isExpanded=!this.layer.isExpanded}">
        <span i18n="${this.layer.name}" class="gg-tree-label"> ${this.layer.name} </span>
      </button>
    </div>

    <!-- Drag -->
    <button id="drag-button" class="gg-icon-button gg-small gg-grab gg-opacity tool" tip="Move">
      <img alt="Move layer" src="icons/drag.svg" />
    </button>

    <!-- Remove icon -->
    <button
      class="remove gg-icon-button gg-small gg-opacity tool"
      tip="Remove theme"
      onclick="${()=>this.deleteTheme()}">
      <img alt="Remove theme" src="icons/trash.svg" />
    </button>
  </header>

  <!-- Sub layers -->
  <div class="${this.layer.isExpanded&&this.layer.isVisible?"children":"hidden"}">
    <!-- prettier-ignore -->
    ${this.sortedChildren().filter(e=>e.isVisible).map(e=>e instanceof de?_t(e,e.treeItemId)`
    <girafe-tree-view-group groupid="${e.treeItemId}"></girafe-tree-view-group>
    `:_t(e,e.treeItemId)`
    <girafe-tree-view-item layerid="${e.treeItemId}"></girafe-tree-view-item>
    `)}
  </div>
</div>
`);l(this,"layer");this.layer=e}render(){const e=this.getAttribute("themeid");e&&(this.layer=this.layerManager.getTreeItem(e)),super.render()}registerEvents(){this.subscribe(/layers\.layersList\..*\.isExpanded/,(e,i,r)=>this.refreshRender(r)),this.subscribe(/layers\.layersList\..*\.activeState/,(e,i,r)=>this.refreshRender(r)),this.subscribe(/layers\.layersList\..*\.children/,(e,i,r)=>this.refreshRender(r)),this.subscribe(/layers\.layersList\..*\.filter/,(e,i,r)=>this.refreshRender(r)),this.subscribe(/layers\.layersList\..*\.order/,(e,i,r)=>{this.refreshRender(r),this.refreshRender(r.parent)}),this.subscribe("treeview.renderEnabled",(e,i)=>{i&&this.refreshRender()})}connectedCallback(){this.loadConfig().then(()=>{this.render(),super.girafeTranslate(),this.registerEvents()})}deleteTheme(){this.deactivateThemeOrGroup(this.layer),this.removeFromParent(),this.state.themes.lastSelectedTheme=null}}const bc=["system","map","visual"];class ot{constructor(t,e,i,r,n){l(this,"currentValue");l(this,"visible",!0);l(this,"configPath");l(this,"statePath");l(this,"group");l(this,"uiElement");l(this,"_configToStateMapper");l(this,"_options",[]);this.configPath=t,this.statePath=e,this.group=i,this.uiElement=r,this._configToStateMapper=n||(s=>s)}get options(){return this._options}set options(t){this._options=t,this._options.length===0&&(this.visible=!1)}getCurrentValueForState(){return this._configToStateMapper(this.currentValue)}}class vc extends Y{constructor(){super("user-preferences");l(this,"template",()=>_`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style><style>
#content{background:var(--bkg-color);color:var(--text-color);padding:1rem;margin:0}.preference-group{padding-bottom:1rem}.preference-group-title{font-weight:700;padding-bottom:10px}.preference-row{display:flex;flex-direction:column;padding-bottom:8px}.with-checkbox,.with-colorpicker{flex-direction:row;justify-content:space-between;height:2rem;align-items:center}.colorpicker{width:1.5rem;height:1.5rem;border:solid 1px var(--text-color);border-radius:3px;cursor:pointer}#reset-all{justify-self:end}#footer{margin-top:2rem}
</style>
<link rel="stylesheet" href="lib/vanilla-picker/vanilla-picker.csp.css" />
<link rel="stylesheet" href="styles/girafecolorpicker.css" />

<div id="panel">
  <div id="content">
    ${this.preferenceGroups.map(e=>_`

    <div class="preference-group">
      <div class="preference-group-title" i18n="${e}">${e}</div>

      ${this.getPreferencesByGroup(e).map(([i,r])=>_t(i,r)` ${i.uiElement==="select"?_`

      <div class="preference-row" hidden="${!i.visible}">
        <label for="${r}" class="gg-label" i18n="${r}">${r}</label>
        <select
          id="${r}"
          class="gg-select"
          onchange="${n=>this.onSelectOption(r,n)}"
          onmousedown="${()=>this.onOpenSelectOption(r)}">
          ${i.options.map(n=>_`
          <option
            i18n="${n.label}"
            ?selected="${i.currentValue===n.value}"
            value="${n.label}">
            ${n.label}
          </option>
          `)}
        </select>
      </div>
      `:_``} ${i.uiElement==="checkbox"?_`

      <div class="preference-row with-checkbox" hidden="${!i.visible}">
        <label for="${r}" i18n="${r}">${r}</label>
        <input
          id="${r}"
          type="checkbox"
          class="gg-checkbox"
          ?checked="${i.currentValue}"
          onchange="${()=>this.changePreference(r,!i.currentValue)}" />
      </div>
      `:_``} ${i.uiElement==="color"?_`

      <div class="preference-row with-colorpicker" hidden="${!i.visible}">
        <label for="${r}" i18n="${r}">${r}</label>
        <button class="colorpicker" id="${r}"></button>
      </div>
      `:_``} `)}
    </div>
    `)}

    <div id="footer">
      <button
        id="reset-all"
        class="gg-button"
        tip="Reset all preferences back to the default value"
        i18n="Reset All"
        onclick="${()=>this.onResetAll()}">
        Reset All
      </button>
    </div>
  </div>
</div>
`);l(this,"visible",!1);l(this,"ready",!1);l(this,"preferences");l(this,"preferenceGroups",bc);l(this,"colorPickers",{});l(this,"userDataManager");l(this,"storagePath","configOverrides");this.userDataManager=Os.getInstance(),this.preferences={language:new ot("languages.defaultLanguage","language","system","select"),logLevel:new ot("general.logLevel",null,"system","select"),theme:new ot("themes.defaultTheme","theme","map","select",e=>{const i=Object.keys(this.state.themes._allThemes).find(r=>this.state.themes._allThemes[Number(r)].name===e);return this.state.themes._allThemes[Number(i)]}),basemap:new ot("basemaps.defaultBasemap","activeBasemap","map","select",e=>{const i=Object.keys(this.state.basemaps).find(r=>this.state.basemaps[Number(r)].name===e);return this.state.basemaps[Number(i)]}),projection:new ot("map.srid","projection","map","select"),darkFrontendMode:new ot("interface.darkFrontendMode","interface.darkFrontendMode","visual","select"),darkMapMode:new ot("interface.darkMapMode","interface.darkMapMode","visual","checkbox"),selectionComponent:new ot("interface.defaultSelectionComponent","interface.selectionComponent","visual","select"),selectFillColor:new ot("selection.defaultFillColor",null,"visual","color"),selectStrokeColor:new ot("selection.defaultStrokeColor",null,"visual","color"),selectHighlightFillColor:new ot("selection.highlightFillColor",null,"visual","color"),selectHighlightStrokeColor:new ot("selection.highlightStrokeColor",null,"visual","color"),searchFillColor:new ot("search.defaultFillColor",null,"visual","color"),searchStrokeColor:new ot("search.defaultStrokeColor",null,"visual","color"),drawingFillColor:new ot("drawing.defaultFillColor",null,"visual","color"),drawingStrokeColor:new ot("drawing.defaultStrokeColor",null,"visual","color")},this.subscribe("themes.isLoaded",(e,i)=>{i&&(this.initPreferenceOptions(),this.initCurrentPreferenceValues(),this.initDarkModeDefaults(),this.initColorPicker(),this.ready=!0,this.render())})}connectedCallback(){this.loadConfig().then(()=>{this.render(),this.subscribe("interface.userPreferencesPanelVisible",(e,i)=>this.togglePanel(i)),this.subscribe("interface.darkFrontendMode",(e,i)=>this.onChangeDarkFrontendMode(i)),this.subscribe("interface.darkMapMode",(e,i)=>this.onChangeDarkMapMode(i))})}render(){this.visible?this.renderComponent():this.hide()}renderComponent(){this.ready&&(super.render(),this.activateTooltips(!1,[800,0],"top-end"),super.girafeTranslate())}togglePanel(e){this.visible=e,this.render()}onChangeDarkMapMode(e){const i=e?"dark":"light";this.activateTheme(i,"map")}onChangeDarkFrontendMode(e){const r=e??this.systemIsInDarkMode()?"dark":"light";this.activateTheme(r,"theme")}activateTheme(e,i){const r=e==="dark"?"light":"dark";document.body.classList.remove(`${r}-${i}`),document.body.classList.add(`${e}-${i}`)}systemIsInDarkMode(){return window.matchMedia("(prefers-color-scheme: dark)").matches}initPreferenceOptions(){this.preferences.language.options=Object.keys(this.configManager.Config.languages.translations).map(e=>({label:e,value:e})),this.preferences.logLevel.options=[{label:"debug",value:"debug"},{label:"info",value:"info"},{label:"warn",value:"warn"},{label:"error",value:"error"}],this.preferences.projection.options=Object.keys(this.configManager.Config.projections).map(e=>({label:this.configManager.Config.projections[e],value:e})),this.refreshThemeOptions(),this.preferences.basemap.options=Object.keys(this.state.basemaps).map(e=>{const i=this.state.basemaps[Number(e)].name;return{label:i,value:i}}),this.preferences.selectionComponent.options=[{label:"window",value:"window"},{label:"grid",value:"grid"}],this.preferences.darkFrontendMode.options=[{label:"same as system",value:void 0},{label:"dark",value:!0},{label:"light",value:!1}]}refreshThemeOptions(){let e=[{label:"-",value:""}];Object.keys(this.state.themes._allThemes).forEach(r=>{const n=this.state.themes._allThemes[Number(r)].name;e.push({label:n,value:n})}),e=e.sort((r,n)=>r.label.toUpperCase().localeCompare(n.label.toUpperCase()));const i=$s.getInstance().customThemes.map(r=>({label:r.name,value:r.name}));this.preferences.theme.options=[...e,...i]}initCurrentPreferenceValues(){for(const e in this.preferences){const{found:i,parentObject:r,lastKey:n}=on(this.configManager.Config,this.preferences[e].configPath);this.preferences[e].currentValue=i&&r&&n?r[n]:void 0}}initDarkModeDefaults(){const e=this.configManager.Config.interface.darkFrontendMode;this.state.interface.darkFrontendMode=e??this.systemIsInDarkMode(),this.state.interface.darkMapMode=this.configManager.Config.interface.darkMapMode}initColorPicker(){var e;super.render();for(const i in this.preferences)if(this.preferences[i].uiElement==="color"){const r=(e=this.shadowRoot)==null?void 0:e.getElementById(i);if(r){const n=new aa({parent:r,color:this.preferences[i].currentValue,popup:"top"},!0);n.onChange=s=>r.style.backgroundColor=s.hex,n.onClose=s=>this.changePreference(i,s.hex),n.setColor(this.preferences[i].currentValue,!1),this.colorPickers[i]=n}}}onOpenSelectOption(e){e==="theme"&&(this.refreshThemeOptions(),this.refreshRender())}onSelectOption(e,i){var s;const r=(s=i.target)==null?void 0:s.value,n=this.preferences[e].options.find(a=>a.label===r);n&&this.changePreference(e,n.value)}changePreference(e,i){this.preferences[e]&&(this.preferences[e].currentValue=i,this.updatePreferenceInConfig(e),this.updatePreferenceInState(e),this.updatePreferenceInStorage(e),this.refreshRender())}updatePreferenceInConfig(e){const i=this.preferences[e];ui(this.configManager.Config,i.configPath,i.currentValue)}updatePreferenceInState(e){const i=this.preferences[e];i.statePath&&ui(this.state,i.statePath,i.getCurrentValueForState())}updatePreferenceInStorage(e){const i=this.preferences[e];this.userDataManager.saveUserData(`${this.storagePath}.${i.configPath}`,i.currentValue)}deletePreferenceInStorage(e){this.userDataManager.deleteUserData(`${this.storagePath}.${this.preferences[e].configPath}`)}async onResetAll(){await window.gConfirm("Reset user preferences back to default values?","Reset preferences")&&this.resetAll()}resetAll(){var e;for(const i in this.preferences)this.deletePreferenceInStorage(i),this.preferences[i].currentValue=this.configManager.getDefaultConfigValue(this.preferences[i].configPath),this.updatePreferenceInState(i),this.updatePreferenceInConfig(i),(e=this.colorPickers[i])==null||e.setColor(this.preferences[i].currentValue,!1);this.render()}getPreferencesByGroup(e){return Object.keys(this.preferences).map(i=>[this.preferences[i],i]).filter(i=>i[0].group===e)}}class yc extends Y{constructor(){super("videorecord");l(this,"template",()=>_`<style>
*{font-family:Arial,sans-serif}.hidden{display:none!important}.gg-rotate90{transform:rotate(90deg)}.gg-rotate180{transform:rotate(180deg)}.gg-rotate270{transform:rotate(270deg)}img{filter:var(--svg-filter)}img.legend-image{filter:var(--svg-map-filter);background:var(--svg-legend-bkg)}div{scrollbar-width:thin}a{color:var(--link-color)}a:visited{color:var(--link-color)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin-wait{0%{transform:rotate(0)}7%{transform:rotate(360deg)}100%{transform:rotate(360deg)}}.gg-spin{animation-name:spin;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.gg-spin-wait{animation-name:spin-wait;animation-duration:10s;animation-iteration-count:infinite;animation-timing-function:linear}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#999}.gg-button,.gg-input,.gg-select,.gg-textarea{background-color:var(--bkg-color);color:var(--text-color);outline:0;border-radius:3px;border:var(--app-standard-border);display:inline-block;box-sizing:border-box;padding:0 0 0 .5rem;margin:0;cursor:pointer}.gg-label{background-color:var(--bkg-color);color:var(--text-color);border:none;display:inline-block;padding:0;margin:0}.gg-button,.gg-input,.gg-label,.gg-select{min-height:calc(var(--app-standard-height)/ 1.5);max-height:calc(var(--app-standard-height)/ 1.5);line-height:calc(var(--app-standard-height) / 1.5)}.gg-textarea{padding:.5rem;height:6rem}.gg-input{cursor:text}.gg-checkbox{accent-color:var(--text-color);width:1.2rem}.gg-range{accent-color:var(--text-color)}.gg-button{padding:0 .5rem}.gg-button.active{border:solid 1px var(--text-color-grad2);background-color:var(--text-color-grad2);color:var(--bkg-color)}.gg-button:disabled{background-color:#d3d3d3;color:grey;border:none;cursor:not-allowed}.gg-icon-button{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color);padding:0;align-items:center;justify-content:center;cursor:pointer}.gg-big,.gg-big-withtext{min-width:var(--app-standard-height);min-height:var(--app-standard-height);max-height:var(--app-standard-height)}.gg-big img,.gg-big-withtext img{margin:0;width:calc(var(--app-standard-height) - 1.5rem)}.gg-big-withtext span{font-size:.9rem;font-variant:small-caps;padding:0 1rem}.gg-medium,.gg-medium-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 1.2);min-height:calc(var(--app-standard-height)/ 1.2);max-height:calc(var(--app-standard-height)/ 1.2)}.gg-medium img{margin:0;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 2.4)}.gg-medium-withtext span{font-size:.9rem;padding:0 1rem;padding-left:.5rem}.gg-small,.gg-small-withtext{flex-direction:row;min-width:calc(var(--app-standard-height)/ 2);min-height:calc(var(--app-standard-height)/ 2);max-height:calc(var(--app-standard-height)/ 2)}.gg-small img{margin:0;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext img{margin-left:.5rem;width:calc(var(--app-standard-height)/ 3)}.gg-small-withtext span{font-size:.9rem;padding:0 .5rem;padding-left:.3rem}.gg-button:hover,.gg-icon-button:hover,.gg-input:hover,.gg-select:hover,.gg-textarea:hover{background-color:var(--bkg-color-grad1)}.gg-opacity{opacity:.5}.gg-opacity:hover{background-color:transparent;opacity:1}.gg-tabs{display:flex;justify-content:left;margin:.5rem auto 0;border-bottom:1px solid grey;cursor:pointer;height:2rem;align-items:end;gap:1rem;margin-bottom:1rem}.gg-tab{border:none;background:0 0;cursor:pointer;padding:.5rem;color:var(--text-color)}.gg-tab.active{border-bottom:solid 2px var(--text-color-grad2);font-weight:600}.girafe-button-big,.girafe-button-large,.girafe-button-small,.girafe-button-tiny{border:none;background-color:transparent;display:flex;flex-direction:column;color:var(--text-color)}.girafe-button-big:hover,.girafe-button-large:hover,.girafe-button-small:hover,.girafe-button-tiny:hover{background-color:var(--bkg-color-grad1);cursor:pointer}.girafe-button-big.dark,.girafe-button-large.dark,.girafe-button-small.dark,.girafe-button-tiny.dark{background-color:var(--bkg-color);filter:invert(1)}.girafe-button-big{width:var(--app-standard-height);height:var(--app-standard-height);align-items:center;padding:1rem}.girafe-button-big img{overflow:hidden}.girafe-button-large{flex-direction:row}.girafe-button-large img{margin:.3rem;height:2rem}.girafe-button-large span{line-height:2rem;height:2rem;margin:.3rem}.girafe-button-small{min-width:calc(var(--app-standard-height)/ 2);height:calc(var(--app-standard-height)/ 2);align-items:center;padding:.5rem}.girafe-button-small img{overflow:hidden}.girafe-button-small span{width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis}.girafe-button-tiny{width:1rem;height:1rem;align-items:center;padding:0}.girafe-button-tiny img{overflow:hidden}
</style><style>
button img{width:1.5rem}
</style>
<button
  class="${this.status==="downloaded"?"gg-icon-button gg-big":"hidden"}"
  onclick="${()=>this.startRecording()}">
  <img alt="help-icon" src="icons/video-record.svg" />
</button>
<button
  class="${this.status==="recording"?"gg-icon-button gg-big":"hidden"}"
  onclick="${()=>this.stopRecording()}">
  <img alt="help-icon" src="icons/video-stop.svg" />
</button>
<button
  class="${this.status==="recorded"?"gg-icon-button gg-big":"hidden"}"
  onclick="${()=>this.downloadRecord()}">
  <img alt="help-icon" src="icons/video-download.svg" />
</button>
`);l(this,"status","downloaded");l(this,"mediaRecorder",null);l(this,"chunks",[]);l(this,"stream",null)}connectedCallback(){this.loadConfig().then(()=>{super.render(),super.girafeTranslate()})}async startRecording(){if(this.status="recording",super.render(),this.chunks=[],this.mediaRecorder)try{this.mediaRecorder.start()}catch{this.mediaRecorder=null}this.mediaRecorder||await this.initializeMediaRecorder()&&this.mediaRecorder.start()}async initializeMediaRecorder(){try{return this.stream=await navigator.mediaDevices.getDisplayMedia({video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}}}),this.mediaRecorder=new MediaRecorder(this.stream,{mimeType:"video/webm; codecs:vp9",bitsPerSecond:5e6}),this.mediaRecorder.ondataavailable=e=>{e.data.size>0&&this.chunks.push(e.data)},!0}catch(e){console.warn("Unable to activate recording : "+e),this.status="downloaded",super.render()}return!1}stopRecording(){var e;this.status="recorded",super.render(),(e=this.mediaRecorder)==null||e.stop()}downloadRecord(){this.status="downloaded",super.render();const e=new Blob(this.chunks,{type:"video/webm"}),i=jt()+".webm",r=URL.createObjectURL(e),n=document.createElement("a");n.style.display="none",n.href=r,n.download=i,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(r)}}(navigator.userAgent.includes("iPhone")||navigator.userAgent.includes("Android"))&&(window.location.href="mobile.html");document.addEventListener("DOMContentLoaded",function(){var e;const g=navigator.language.toLowerCase();console.log(`Navigator language: ${g}`);let t="Loading...";g.startsWith("fr")?t="Chargement...":g.startsWith("de")?t="Wird geladen...":g.startsWith("it")&&(t="Caricamento..."),((e=document.getElementById("splash-screen"))==null?void 0:e.getElementsByTagName("span")[0]).innerHTML=t});co().then(()=>{or.setDefaultProps({maxWidth:""}),customElements.define("girafe-about",pl),customElements.define("girafe-basemap",ll),customElements.define("girafe-coordinate",fl),customElements.define("girafe-context-menu",kl),customElements.define("girafe-default-context-menu-content",Sl),customElements.define("girafe-custom-context-menu-content",El),customElements.define("girafe-layout",Og),customElements.define("girafe-help",Rg),customElements.define("girafe-infobox",gl),customElements.define("girafe-info-window",Ag),customElements.define("girafe-cross-section-settings",bg),customElements.define("girafe-cross-section-view",xg),customElements.define("girafe-lr-panel",Dg),customElements.define("girafe-map",Fs),customElements.define("girafe-menu-button",zg),customElements.define("girafe-modals",Vg),customElements.define("girafe-nav-history",$g),customElements.define("girafe-print",Fe),customElements.define("girafe-prototype-banner",qg),customElements.define("girafe-query-builder",Na),customElements.define("girafe-oauth",Gg),customElements.define("girafe-drawing",Mg),customElements.define("girafe-scale",Yg),customElements.define("girafe-search",hl),customElements.define("girafe-selection-grid",Zg),customElements.define("girafe-selection-window",Hn),customElements.define("girafe-share",sc),customElements.define("girafe-theme-select",oc),customElements.define("girafe-time-restriction",Aa),customElements.define("girafe-time-picker",lc),customElements.define("girafe-time-slider",gc),customElements.define("girafe-tree-view",pc),customElements.define("girafe-tree-view-group",hc),customElements.define("girafe-tree-view-item",dc),customElements.define("girafe-tree-view-theme",fc),customElements.define("girafe-user-preferences",vc),customElements.define("girafe-video-record",yc);const g=document.getElementById("splash-screen");g&&(g.style.opacity="0",setTimeout(()=>g.remove(),700))});
//# sourceMappingURL=desktop-DIfQ3feF.js.map
