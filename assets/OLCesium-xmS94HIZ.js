var fe=Object.defineProperty;var pe=(c,e,t)=>e in c?fe(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var h=(c,e,t)=>(pe(c,typeof e!="symbol"?e+"":e,t),t);import{B as _e,C as Ce,r as ye,a as ve,u as Pe,l as Le,M as Ee,o as we,b as Se,d as be,V as I,e as Te,E as V,f as W,h as Re,i as k,j as Oe,s as Fe,k as U,P as D,F as xe,m as ee,n as te,p as Ae,q as Ie,I as Me,t as ie,v as T,w as Ge,x as Ne,y as se,z as ne,A as Ve,D as B,G as ke,H as De,J as je,K as Ke,L as q,N as ze,T as Ue,O as He,Q as We,S as Be,U as qe,W as Y,X as Ye,Y as Xe,Z as $e,_ as Ze,$ as Qe,a0 as H,a1 as Je,a2 as et,a3 as tt,a4 as L,a5 as j,a6 as K,a7 as it,a8 as st,a9 as nt,aa as X,ab as rt,ac as $,ad as ot,ae as at}from"./index-sUC8zklA.js";import"./lazy-zORy1357.js";const v={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class ct extends _e{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+Ce,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(v.ELEMENT,this.handleElementChanged),this.addChangeListener(v.MAP,this.handleMapChanged),this.addChangeListener(v.OFFSET,this.handleOffsetChanged),this.addChangeListener(v.POSITION,this.handlePositionChanged),this.addChangeListener(v.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(v.ELEMENT)}getId(){return this.id}getMap(){return this.get(v.MAP)||null}getOffset(){return this.get(v.OFFSET)}getPosition(){return this.get(v.POSITION)}getPositioning(){return this.get(v.POSITIONING)}handleElementChanged(){ye(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(ve(this.element),Pe(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=Le(e,Ee.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(v.ELEMENT,e)}setMap(e){this.set(v.MAP,e)}setOffset(e){this.set(v.OFFSET,e)}setPosition(e){this.set(v.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(v.POSITION))return;const i=this.getRect(t.getTargetElement(),t.getSize()),s=this.getElement(),n=this.getRect(s,[we(s),Se(s)]);e=e||{};const r=e.margin===void 0?20:e.margin;if(!be(i,n)){const o=n[0]-i[0],a=i[2]-n[2],l=n[1]-i[1],m=i[3]-n[3],u=[0,0];if(o<0?u[0]=o-r:a<0&&(u[0]=Math.abs(a)+r),l<0?u[1]=l-r:m<0&&(u[1]=Math.abs(m)+r),u[0]!==0||u[1]!==0){const d=t.getView().getCenterInternal(),g=t.getPixelFromCoordinateInternal(d);if(!g)return;const f=[g[0]+u[0],g[1]+u[1]],p=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(f),duration:p.duration,easing:p.easing})}}}getRect(e,t){const i=e.getBoundingClientRect(),s=i.left+window.pageXOffset,n=i.top+window.pageYOffset;return[s,n,s+t[0],n+t[1]]}setPositioning(e){this.set(v.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const i=e.getPixelFromCoordinate(t),s=e.getSize();this.updateRenderedPosition(i,s)}updateRenderedPosition(e,t){const i=this.element.style,s=this.getOffset(),n=this.getPositioning();this.setVisible(!0);const r=Math.round(e[0]+s[0])+"px",o=Math.round(e[1]+s[1])+"px";let a="0%",l="0%";n=="bottom-right"||n=="center-right"||n=="top-right"?a="-100%":(n=="bottom-center"||n=="center-center"||n=="top-center")&&(a="-50%"),n=="bottom-left"||n=="bottom-center"||n=="bottom-right"?l="-100%":(n=="center-left"||n=="center-center"||n=="center-right")&&(l="-50%");const m=`translate(${a}, ${l}) translate(${r}, ${o})`;this.rendered.transform_!=m&&(this.rendered.transform_=m,i.transform=m)}getOptions(){return this.options}}class re extends I{constructor(e){super({attributions:e.attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=e.distance!==void 0?e.distance:20,this.minDistance=e.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=e.geometryFunction||function(t){const i=t.getGeometry();return Te(!i||i.getType()==="Point","The default `geometryFunction` can only handle `Point` or null geometries"),i},this.createCustomCluster_=e.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(e.source||null)}clear(e){this.features.length=0,super.clear(e)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(e,t,i){this.source.loadFeatures(e,t,i),t!==this.resolution&&(this.resolution=t,this.refresh())}setDistance(e){this.updateDistance(e,this.minDistance)}setMinDistance(e){this.updateDistance(this.distance,e)}getMinDistance(){return this.minDistance}setSource(e){this.source&&this.source.removeEventListener(V.CHANGE,this.boundRefresh_),this.source=e,e&&e.addEventListener(V.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(e,t){const i=e===0?0:Math.min(t,e)/e,s=e!==this.distance||this.interpolationRatio!==i;this.distance=e,this.minDistance=t,this.interpolationRatio=i,s&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const e=ee(),t=this.distance*this.resolution,i=this.source.getFeatures(),s={};for(let n=0,r=i.length;n<r;n++){const o=i[n];if(!(W(o)in s)){const a=this.geometryFunction(o);if(a){const l=a.getCoordinates();Re(l,e),k(e,t,e);const m=this.source.getFeaturesInExtent(e).filter(function(u){const d=W(u);return d in s?!1:(s[d]=!0,!0)});this.features.push(this.createCluster(m,e))}}}}createCluster(e,t){const i=[0,0];for(let o=e.length-1;o>=0;--o){const a=this.geometryFunction(e[o]);a?Oe(i,a.getCoordinates()):e.splice(o,1)}Fe(i,1/e.length);const s=U(t),n=this.interpolationRatio,r=new D([i[0]*(1-n)+s[0]*n,i[1]*(1-n)+s[1]*n]);return this.createCustomCluster_?this.createCustomCluster_(r,e):new xe({geometry:r,features:e})}}function lt(c){const e=c.load||te,t=c.imageExtent,i=new Image;return c.crossOrigin!==null&&(i.crossOrigin=c.crossOrigin),()=>e(i,c.url).then(s=>{const n=Ae(t)/s.width,r=Ie(t)/s.height;return{image:s,extent:t,resolution:n!==r?[n,r]:r,pixelRatio:1}})}class ht extends Me{constructor(e){const t=e.crossOrigin!==void 0?e.crossOrigin:null,i=e.imageLoadFunction!==void 0?e.imageLoadFunction:ie;super({attributions:e.attributions,interpolate:e.interpolate,projection:T(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image=null,this.image=new Ge(this.imageExtent_,void 0,1,lt({url:e.url,imageExtent:e.imageExtent,crossOrigin:t,load:(s,n)=>(this.image.setImage(s),i(this.image,n),te(s))})),this.image.addEventListener(V.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e,t,i,s){return Ne(e,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}const ut=ht;class dt extends se{constructor(e){e=e||{};const t=Object.assign({},e.params),i="TRANSPARENT"in t?t.TRANSPARENT:!0;super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:!i,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.params_=t,this.v13_=!0,this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=ee(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(e,t,i,s){const n=T(i),r=this.getProjection()||n;let o=this.getTileGrid();o||(o=this.getTileGridForProjection(r));const a=ne(e,n,r),l=Ve(r,n,e,t),m=o.getZForResolution(l,this.zDirection),u=o.getResolution(m),d=o.getTileCoordForCoordAndZ(a,m);if(o.getResolutions().length<=d[0])return;let g=o.getTileCoordExtent(d,this.tmpExtent_);const f=this.gutter_;f!==0&&(g=k(g,u*f,g));const p={QUERY_LAYERS:this.params_.LAYERS};Object.assign(p,B(this.params_,"GetFeatureInfo"),s);const _=Math.floor((a[0]-g[0])/u),C=Math.floor((g[3]-a[1])/u);return p[this.v13_?"I":"X"]=_,p[this.v13_?"J":"Y"]=C,this.getRequestUrl_(d,g,1,r||n,p)}getLegendUrl(e,t){if(this.urls[0]===void 0)return;const i={SERVICE:"WMS",VERSION:q,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(t===void 0||t.LAYER===void 0){const s=this.params_.LAYERS;if(!(!Array.isArray(s)||s.length===1))return;i.LAYER=s}if(e!==void 0){const s=this.getProjection()?this.getProjection().getMetersPerUnit():1,n=28e-5;i.SCALE=e*s/n}return Object.assign(i,t),ke(this.urls[0],i)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(e,t,i,s,n){const r=this.urls;if(!r)return;let o;if(r.length==1)o=r[0];else{const a=De(je(e),r.length);o=r[a]}return Ke(t,(this.tileGrid||this.getTileGridForProjection(s)).getResolution(e[0]),i,s,o,n,this.serverType_)}getTilePixelRatio(e){return!this.hidpi_||this.serverType_===void 0?1:e}getKeyForParams_(){let e=0;const t=[];for(const i in this.params_)t[e++]=i+"-"+this.params_[i];return t.join("/")}updateParams(e){Object.assign(this.params_,e),this.updateV13_(),this.setKey(this.getKeyForParams_())}updateV13_(){const e=this.params_.VERSION||q;this.v13_=ze(e,"1.3")>=0}tileUrlFunction(e,t,i){let s=this.getTileGrid();if(s||(s=this.getTileGridForProjection(i)),s.getResolutions().length<=e[0])return;t!=1&&(!this.hidpi_||this.serverType_===void 0)&&(t=1);const n=s.getResolution(e[0]);let r=s.getTileCoordExtent(e,this.tmpExtent_);const o=this.gutter_;o!==0&&(r=k(r,n*o,r));const a=Object.assign({},B(this.params_,"GetMap"));return this.getRequestUrl_(e,r,t,i,a)}}let R,oe;function z(){if(R===void 0){const c=document.createElement("canvas");c.setAttribute("style","image-rendering: -moz-crisp-edges; image-rendering: crisp-edges; image-rendering: pixelated;");const e=c.style.imageRendering;R=!!e,R&&(oe=e)}return R}function mt(){return z(),oe||""}function A(c){return c.get("olcs.projection")||c.getProjection()}let gt=0;function y(c){return c.olcs_uid||(c.olcs_uid=++gt)}function M(c){const e=c,t=e.readyPromise;return t||(e.ready!==void 0?e.ready?Promise.resolve(c):new Promise((i,s)=>{const n=setInterval(()=>{e.ready&&(clearInterval(n),i(c))},20)}):Promise.reject("Not a readyable object"))}function ae(){const c=document.createElement("canvas");return c.width=1,c.height=1,c}const ft=function(){const e=new Ue({projection:"EPSG:3857",wrapX:!0}).getTileCoordForTileUrlFunction([6,-31,22]);return e&&e[1]===33&&e[2]===22}();class pt{constructor(e,t,i){h(this,"source_");h(this,"projection_");h(this,"fallbackProj_");h(this,"map_");h(this,"shouldRequestNextLevel");h(this,"emptyCanvas_",ae());h(this,"emptyCanvasPromise_",Promise.resolve(this.emptyCanvas_));h(this,"tilingScheme_");h(this,"ready_");h(this,"rectangle_");h(this,"errorEvent",new Cesium.Event);h(this,"credit");h(this,"proxy");this.source_=t,this.projection_=null,this.ready_=!1,this.fallbackProj_=i||null,this.tilingScheme_=new Cesium.WebMercatorTilingScheme,this.rectangle_=null,this.map_=e,this.shouldRequestNextLevel=!1;const s=this.source_.get("olcs.proxy");s&&(typeof s=="function"?this.proxy={getURL:s}:typeof s=="string"&&(this.proxy=new Cesium.DefaultProxy(s))),this.source_.on("change",n=>{this.handleSourceChanged_()}),this.handleSourceChanged_()}get ready(){return this.ready_}get rectangle(){return this.rectangle_}get tilingScheme(){return this.tilingScheme_}get _ready(){return this.ready_}get tileWidth(){const e=this.source_.getTileGrid();if(e){const t=e.getTileSize(0);return Array.isArray(t)?t[0]:t}return 256}get tileHeight(){const e=this.source_.getTileGrid();if(e){const t=e.getTileSize(0);return Array.isArray(t)?t[1]:t}return 256}get maximumLevel(){const e=this.source_.getTileGrid();return e?e.getMaxZoom():18}get minimumLevel(){return 0}get tileDiscardPolicy(){}get hasAlphaChannel(){return!0}pickFeatures(e,t,i,s,n){}handleSourceChanged_(){if(!this.ready_&&this.source_.getState()=="ready"){this.projection_=A(this.source_)||this.fallbackProj_;const e={numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1};if(this.source_.tileGrid!==null&&this.source_.tileGrid.forEachTileCoord(this.projection_.getExtent(),0,([t,i,s])=>{e.numberOfLevelZeroTilesX=i+1,e.numberOfLevelZeroTilesY=s+1}),this.projection_.getCode()==="EPSG:4326")this.shouldRequestNextLevel=e.numberOfLevelZeroTilesX===1&&e.numberOfLevelZeroTilesY===1,this.tilingScheme_=new Cesium.GeographicTilingScheme(e);else if(this.projection_.getCode()==="EPSG:3857")this.shouldRequestNextLevel=!1,this.tilingScheme_=new Cesium.WebMercatorTilingScheme(e);else return;this.rectangle_=this.tilingScheme_.rectangle,this.ready_=!0}}getTileCredits(e,t,i){const s=this.source_.getAttributions();if(!s)return[];const n=this.map_.getView().calculateExtent(this.map_.getSize()),r=this.map_.getView().getCenter(),o=this.shouldRequestNextLevel?i+1:i;return le(s,o,r,n)}requestImage(e,t,i,s){const n=this.source_.getTileUrlFunction();if(n&&this.projection_){const r=this.shouldRequestNextLevel?i+1:i;let o=t;ft||(o=-t-1);let a=n.call(this.source_,[r,e,o],1,this.projection_);return this.proxy&&(a=this.proxy.getURL(a)),a?Cesium.ImageryProvider.loadImage(this,a):this.emptyCanvasPromise_}else return this.emptyCanvasPromise_}}const _t=new He({featureClass:We}),Ct=[new Be({stroke:new qe({color:"blue",width:2})})];class yt{constructor(e){h(this,"urls");h(this,"emptyCanvas_",ae());h(this,"emptyCanvasPromise_",Promise.resolve(this.emptyCanvas_));h(this,"tilingScheme_",new Cesium.WebMercatorTilingScheme);h(this,"ready_",!0);h(this,"rectangle_");h(this,"tileRectangle_");h(this,"tileWidth",256);h(this,"tileHeight",256);h(this,"maximumLevel",20);h(this,"minimumLevel_",0);h(this,"featureCache");h(this,"tileCache");h(this,"tileFunction_");h(this,"styleFunction_");h(this,"projection_",T("EPSG:3857"));h(this,"errorEvent",new Cesium.Event);h(this,"credit");h(this,"proxy");this.urls=e.urls,this.rectangle_=e.rectangle||this.tilingScheme.rectangle,this.credit=e.credit,this.styleFunction_=e.styleFunction||(()=>Ct),this.tileRectangle_=new Cesium.Rectangle;const t=e.cacheSize!==void 0?e.cacheSize:50;this.tileCache=new Y(t),this.featureCache=e.featureCache||new Y(t),this.minimumLevel_=e.minimumLevel||0;const i=Ye(this.projection_);this.tileFunction_=Xe(this.urls,i)}get minimumLevel(){return this.minimumLevel_}get ready(){return this.ready_}get rectangle(){return this.rectangle_}get tilingScheme(){return this.tilingScheme_}getTileCredits(e,t,i){return[]}get _ready(){return this.ready_}get tileDiscardPolicy(){}get hasAlphaChannel(){return!0}pickFeatures(e,t,i,s,n){}getTileFeatures(e,t,i){const s=this.getCacheKey_(e,t,i);let n;if(this.featureCache.containsKey(s)&&(n=this.featureCache.get(s)),!n){const r=this.getUrl_(e,t,i);if(n=fetch(r).then(o=>o.ok?o:Promise.reject(o)).then(o=>o.arrayBuffer()).then(o=>this.readFeaturesFromBuffer(o)),this.featureCache.set(s,n),this.featureCache.getCount()>2*this.featureCache.highWaterMark)for(;this.featureCache.canExpireCache();)this.featureCache.pop()}return n}readFeaturesFromBuffer(e){const i=_t.readFeatures(e,void 0),s=this.tileWidth/4096;return i.forEach(n=>{const r=n.getFlatCoordinates();for(let o=0;o<r.length;++o)r[o]*=s}),i}getUrl_(e,t,i){return this.tileFunction_([e,t,i],1,this.projection_)}getCacheKey_(e,t,i){return`${e}_${t}_${i}`}requestImage(e,t,i,s){if(i<this.minimumLevel_)return this.emptyCanvasPromise_;try{const n=this.getCacheKey_(i,e,t);let r;if(this.tileCache.containsKey(n)&&(r=this.tileCache.get(n)),!r&&(r=this.getTileFeatures(i,e,t).then(o=>{this.tilingScheme.tileXYToNativeRectangle(e,t,i,this.tileRectangle_);const a=(this.tileRectangle_.east-this.tileRectangle_.west)/this.tileWidth;return this.rasterizeFeatures(o,this.styleFunction_,a)}),this.tileCache.set(n,r),this.tileCache.getCount()>2*this.tileCache.highWaterMark))for(;this.tileCache.canExpireCache();)this.tileCache.pop();return r}catch(n){console.trace(n),this.errorEvent.raiseEvent("could not render pbf to tile",n)}}rasterizeFeatures(e,t,i){const s=document.createElement("canvas"),n=$e(s.getContext("2d"),{size:[this.tileWidth,this.tileHeight]});return e.forEach(r=>{const o=t(r,i);o&&(Array.isArray(o)?o.forEach(a=>{n.setStyle(a),n.drawGeometry(r)}):(n.setStyle(o),n.drawGeometry(r)))}),s}}function vt(c,e){const t=c.camera.getPickRay(e);return c.globe.pick(t,c)||c.camera.pickEllipsoid(e)}function Pt(c){const e=c.canvas,t=new Cesium.Cartesian2(e.clientWidth/2,e.clientHeight/2);return vt(c,t)}function ce(c,e){if(c&&e){const t=Je(c,e,"EPSG:4326");return Cesium.Rectangle.fromDegrees(t[0],t[1],t[2],t[3])}else return null}function Lt(c,e,t,i){const s=e.get("olcs_skip");if(s)return null;let n=null;if(e instanceof et&&e.getUrl()&&e.getImageLoadFunction()===ie){const r={"olcs.proxy":e.get("olcs.proxy"),"olcs.extent":e.get("olcs.extent"),"olcs.projection":e.get("olcs.projection"),"olcs.imagesource":e};e=new dt({url:e.getUrl(),attributions:e.getAttributions(),projection:e.getProjection(),params:e.getParams()}),e.setProperties(r)}if(e instanceof se){let r=A(e);if(r||(r=t),J(r))n=new pt(c,e,t);else return null}else if(e instanceof ut){let r=A(e);if(r||(r=t),J(r)){const o=Cesium.Rectangle.fromDegrees(e.getImageExtent()[0],e.getImageExtent()[1],e.getImageExtent()[2],e.getImageExtent()[3],new Cesium.Rectangle);n=new Cesium.SingleTileImageryProvider({url:e.getUrl(),rectangle:o})}else return null}else if(e instanceof tt&&i instanceof H){let r=A(e);if(r||(r=t),s===!1){const o=r.getCode().split(":")[1],a=e.urls.map(p=>p.replace(o,"3857")),l=i.getExtent(),m=ce(l,r),u=e.get("olcs_minimumLevel"),d=e.getAttributions(),g=i.getStyleFunction();let f;if(l&&d){const p=U(l);f=le(d,0,p,l)[0]}return n=new yt({credit:f,rectangle:m,minimumLevel:u,styleFunction:g,urls:a}),n}return null}else return null;return n}function Et(c,e,t){if(!(e instanceof Ze)&&!(e instanceof Qe)&&!(e instanceof H))return null;const i=e.getSource();if(!i)return null;let s=i.get("olcs_provider");if(s||(s=Lt(c,i,t,e)),!s)return null;const n={},o=e.get("olcs.extent")||e.getExtent();return o&&(n.rectangle=ce(o,t)),new Cesium.ImageryLayer(s,n)}function Z(c,e){let t=1,i=!0;[c.layer].concat(c.parents).forEach(s=>{const n=s.getOpacity();n!==void 0&&(t*=n);const r=s.getVisible();r!==void 0&&(i=i&&r)}),e.alpha=t,e.show=i}function w(c){const e=c;return e.length>2?Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]):Cesium.Cartesian3.fromDegrees(e[0],e[1])}function G(c){console.assert(c!==null);const e=w,t=[];for(let i=0;i<c.length;++i)t.push(e(c[i]));return t}function O(c,e){console.assert(e);const t=T("EPSG:4326"),i=T(e);if(i.getCode()!==t.getCode()){const s=c.getProperties();c=c.clone(),c.transform(i,t),c.setProperties(s)}return c}function Q(c){if(c=c||"black",Array.isArray(c))return new Cesium.Color(Cesium.Color.byteToFloat(c[0]),Cesium.Color.byteToFloat(c[1]),Cesium.Color.byteToFloat(c[2]),c[3]);if(typeof c=="string")return Cesium.Color.fromCssColorString(c);if(c instanceof CanvasPattern||c instanceof CanvasGradient){const e=document.createElement("canvas"),t=e.getContext("2d");return e.width=e.height=256,t.fillStyle=c,t.fillRect(0,0,e.width,e.height),new Cesium.ImageMaterialProperty({image:e})}console.assert(!1,"impossible")}function J(c){const e=c.getCode()==="EPSG:3857",t=c.getCode()==="EPSG:4326";return e||t}function le(c,e,t,i){if(!c)return[];let s=c({viewState:{zoom:e,center:t,projection:void 0,resolution:void 0,rotation:void 0},extent:i});return Array.isArray(s)||(s=[s]),s.map(n=>new Cesium.Credit(n,!0))}function wt(c,e,t,i){const s=t.canvas,r=t.camera.frustum.fovy;console.assert(!isNaN(r));const o=i.getMetersPerUnit(),a=c*s.clientHeight,l=Math.cos(Math.abs(e));return a*o*l/2/Math.tan(r/2)}function St(c,e,t,i){const s=t.canvas,r=t.camera.frustum.fovy;console.assert(!isNaN(r));const o=i.getMetersPerUnit(),a=2*c*Math.tan(r/2),l=Math.cos(Math.abs(e));return a/o/l/s.clientHeight}class bt{constructor(e){h(this,"ol3d");h(this,"scene_");h(this,"canvas_");h(this,"_boundNotifyRepaintRequired");h(this,"repaintEventNames_",["mousemove","mousedown","mouseup","touchstart","touchend","touchmove","pointerdown","pointerup","pointermove","wheel"]);this.ol3d=e,this.scene_=e.getCesiumScene(),this.canvas_=this.scene_.canvas,this._boundNotifyRepaintRequired=this.notifyRepaintRequired.bind(this),this.enable()}enable(){this.scene_.requestRenderMode=!0,this.scene_.maximumRenderTimeChange=1e3;for(const e of this.repaintEventNames_)this.canvas_.addEventListener(e,this._boundNotifyRepaintRequired,!1);window.addEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().on("change",this._boundNotifyRepaintRequired)}disable(){for(const e of this.repaintEventNames_)this.canvas_.removeEventListener(e,this._boundNotifyRepaintRequired,!1);window.removeEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().un("change",this._boundNotifyRepaintRequired),this.scene_.requestRenderMode=!1}restartRenderLoop(){this.notifyRepaintRequired()}notifyRepaintRequired(){this.scene_.requestRender()}}function F(c){return c*180/Math.PI}function b(c){return c*Math.PI/180}function x(c,e,t){const i=t||c.length;if(e)for(let s=0;s<i;++s)e[s]=c[s];return c}class Tt{constructor(e,t){h(this,"scene_");h(this,"cam_");h(this,"map_");h(this,"view_");h(this,"viewListenKey_",null);h(this,"toLonLat_",x);h(this,"fromLonLat_",x);h(this,"tilt_",0);h(this,"distance_",0);h(this,"lastCameraViewMatrix_",null);h(this,"viewUpdateInProgress_",!1);this.scene_=e,this.cam_=e.camera,this.map_=t,this.map_.on("change:view",i=>{this.setView_(this.map_.getView())}),this.setView_(this.map_.getView())}destroy(){L(this.viewListenKey_),this.viewListenKey_=null}setView_(e){if(this.view_&&(L(this.viewListenKey_),this.viewListenKey_=null),this.view_=e,e){const t=j(e.getProjection(),"EPSG:4326"),i=j("EPSG:4326",e.getProjection());console.assert(t&&i),this.toLonLat_=t,this.fromLonLat_=i,this.viewListenKey_=e.on("propertychange",s=>this.handleViewChangedEvent_()),this.readFromView()}else this.toLonLat_=x,this.fromLonLat_=x}handleViewChangedEvent_(){this.viewUpdateInProgress_||this.readFromView()}setHeading(e){this.view_&&this.view_.setRotation(e)}getHeading(){return this.view_?this.view_.getRotation()||0:void 0}setTilt(e){this.tilt_=e,this.updateCamera_()}getTilt(){return this.tilt_}setDistance(e){this.distance_=e,this.updateCamera_(),this.updateView()}getDistance(){return this.distance_}setCenter(e){this.view_&&this.view_.setCenter(e)}getCenter(){if(this.view_)return this.view_.getCenter()}setPosition(e){if(!this.toLonLat_)return;const t=this.toLonLat_(e);console.assert(t);const i=new Cesium.Cartographic(b(t[0]),b(t[1]),this.getAltitude());this.cam_.setView({destination:Cesium.Ellipsoid.WGS84.cartographicToCartesian(i)}),this.updateView()}getPosition(){if(!this.fromLonLat_)return;const e=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position),t=this.fromLonLat_([F(e.longitude),F(e.latitude)]);return console.assert(t),t}setAltitude(e){const t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);t.height=e,this.cam_.position=Cesium.Ellipsoid.WGS84.cartographicToCartesian(t),this.updateView()}getAltitude(){return Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position).height}updateCamera_(){if(!this.view_||!this.toLonLat_)return;const e=this.view_.getCenter();if(!e)return;const t=this.toLonLat_(e);console.assert(t);const i=new Cesium.Cartographic(b(t[0]),b(t[1]));if(this.scene_.globe){const r=this.scene_.globe.getHeight(i);i.height=r||0}const s=Cesium.Ellipsoid.WGS84.cartographicToCartesian(i),n={pitch:this.tilt_-Cesium.Math.PI_OVER_TWO,heading:-this.view_.getRotation(),roll:void 0};this.cam_.setView({destination:s,orientation:n}),this.cam_.moveBackward(this.distance_),this.checkCameraChange(!0)}readFromView(){if(!this.view_||!this.toLonLat_)return;const e=this.view_.getCenter();if(e==null)return;const t=this.toLonLat_(e);console.assert(t);const i=this.view_.getResolution();this.distance_=this.calcDistanceForResolution(i||0,b(t[1])),this.updateCamera_()}updateView(){if(!this.view_||!this.fromLonLat_)return;this.viewUpdateInProgress_=!0;const e=Cesium.Ellipsoid.WGS84,t=this.scene_,i=Pt(t);let s=i;if(!s){const r=t.globe,o=this.cam_.positionCartographic.clone(),a=r.getHeight(o);o.height=a||0,s=Cesium.Ellipsoid.WGS84.cartographicToCartesian(o)}this.distance_=Cesium.Cartesian3.distance(s,this.cam_.position);const n=e.cartesianToCartographic(s);if(this.view_.setCenter(this.fromLonLat_([F(n.longitude),F(n.latitude)])),this.view_.setResolution(this.calcResolutionForDistance(this.distance_,n?n.latitude:0)),i){const r=this.cam_.position,o=new Cesium.Cartesian3;e.geocentricSurfaceNormal(i,o);const a=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(r,i,a),Cesium.Cartesian3.normalize(a,a);const l=this.cam_.up,m=this.cam_.right,u=new Cesium.Cartesian3(-i.y,i.x,0),d=Cesium.Cartesian3.angleBetween(m,u),f=Cesium.Cartesian3.cross(i,l,new Cesium.Cartesian3).z;this.view_.setRotation(f<0?d:-d);const p=Math.acos(Cesium.Cartesian3.dot(o,a));this.tilt_=isNaN(p)?0:p}else this.view_.setRotation(this.cam_.heading),this.tilt_=-this.cam_.pitch+Math.PI/2;this.viewUpdateInProgress_=!1}checkCameraChange(e){const t=this.lastCameraViewMatrix_,i=this.cam_.viewMatrix;(!t||!Cesium.Matrix4.equalsEpsilon(t,i,1e-7))&&(this.lastCameraViewMatrix_=i.clone(),e!==!0&&this.updateView())}calcDistanceForResolution(e,t){return wt(e,t,this.scene_,this.view_.getProjection())}calcResolutionForDistance(e,t){return St(e,t,this.scene_,this.view_.getProjection())}}class he{constructor(e,t){h(this,"map");h(this,"view");h(this,"scene");h(this,"olLayers");h(this,"mapLayerGroup");h(this,"layerMap",{});h(this,"olLayerListenKeys",{});h(this,"olGroupListenKeys_",{});this.map=e,this.view=e.getView(),this.scene=t,this.olLayers=e.getLayerGroup().getLayers(),this.mapLayerGroup=e.getLayerGroup()}synchronize(){this.destroyAll(),this.addLayers_(this.mapLayerGroup)}orderLayers(){}addLayers_(e){const t=[{layer:e,parents:[]}];for(;t.length>0;){const i=t.splice(0,1)[0],s=i.layer,n=y(s).toString();this.olLayerListenKeys[n]=[],console.assert(!this.layerMap[n]);let r=null;if(s instanceof K)this.listenForGroupChanges_(s),s!==this.mapLayerGroup&&(r=this.createSingleLayerCounterparts(i)),r||s.getLayers().forEach(o=>{if(o){const a={layer:o,parents:s===this.mapLayerGroup?[]:[i.layer].concat(i.parents)};t.push(a)}});else if(r=this.createSingleLayerCounterparts(i),!r){const o=n,a=i,l=()=>{const m=this.createSingleLayerCounterparts(a);m&&(a.layer.un("change",l),this.addCesiumObjects_(m,o,a.layer),this.orderLayers())};this.olLayerListenKeys[n].push(a.layer.on("change",l))}r&&this.addCesiumObjects_(r,n,s)}this.orderLayers()}addCesiumObjects_(e,t,i){this.layerMap[t]=e,this.olLayerListenKeys[t].push(i.on("change:zIndex",()=>this.orderLayers())),e.forEach(s=>{this.addCesiumObject(s)})}removeAndDestroySingleLayer_(e){const t=y(e).toString(),i=this.layerMap[t];return i&&(i.forEach(s=>{this.removeSingleCesiumObject(s,!1),this.destroyCesiumObject(s)}),this.olLayerListenKeys[t].forEach(L),delete this.olLayerListenKeys[t]),delete this.layerMap[t],!!i}unlistenSingleGroup_(e){if(e===this.mapLayerGroup)return;const t=y(e).toString();this.olGroupListenKeys_[t].forEach(s=>{L(s)}),delete this.olGroupListenKeys_[t],delete this.layerMap[t]}removeLayer_(e){if(e){const t=[e];for(;t.length>0;){const i=t.splice(0,1)[0],s=this.removeAndDestroySingleLayer_(i);i instanceof K&&(this.unlistenSingleGroup_(i),s||i.getLayers().forEach(n=>{t.push(n)}))}}}listenForGroupChanges_(e){const t=y(e).toString();console.assert(this.olGroupListenKeys_[t]===void 0);const i=[];this.olGroupListenKeys_[t]=i;let s=[];const n=(function(){const r=e.getLayers();r&&(s=[r.on("add",o=>{this.addLayers_(o.element)}),r.on("remove",o=>{this.removeLayer_(o.element)})],i.push(...s))}).bind(this);n(),i.push(e.on("change:layers",r=>{s.forEach(o=>{const a=i.indexOf(o);a>=0&&i.splice(a,1),L(o)}),n()}))}destroyAll(){this.removeAllCesiumObjects(!0);let e;for(e in this.olGroupListenKeys_)this.olGroupListenKeys_[e].forEach(L);for(e in this.olLayerListenKeys)this.olLayerListenKeys[e].forEach(L);this.olGroupListenKeys_={},this.olLayerListenKeys={},this.layerMap={}}}class Rt extends he{constructor(t,i){super(t,i);h(this,"cesiumLayers_");h(this,"ourLayers_");this.cesiumLayers_=i.imageryLayers,this.ourLayers_=new Cesium.ImageryLayerCollection}addCesiumObject(t){this.cesiumLayers_.add(t),this.ourLayers_.add(t)}destroyCesiumObject(t){t.destroy()}removeSingleCesiumObject(t,i){this.cesiumLayers_.remove(t,i),this.ourLayers_.remove(t,!1)}removeAllCesiumObjects(t){for(let i=0;i<this.ourLayers_.length;++i)this.cesiumLayers_.remove(this.ourLayers_.get(i),t);this.ourLayers_.removeAll(!1)}convertLayerToCesiumImageries(t,i){const s=Et(this.map,t,i);return s?[s]:null}createSingleLayerCounterparts(t){const i=t.layer,s=y(i).toString(),n=this.view.getProjection();console.assert(n);const r=this.convertLayerToCesiumImageries(i,n);if(r){const o=[];if([t.layer].concat(t.parents).forEach(a=>{o.push(a.on(["change:opacity","change:visible"],()=>{console.assert(r);for(let l=0;l<r.length;++l)Z(t,r[l])}))}),i instanceof it){let a=i.getStyleFunction();o.push(i.on("change",()=>{var m;const l=i.getStyleFunction();if(a!==l){a=l;for(let u=0;u<r.length;++u){const d=r[u];d._imageryCache&&(d._imageryCache={});const g=d.imageryProvider;g&&((m=g.tileCache)==null||m.clear(),g.styleFunction_=l)}this.scene.requestRender()}}))}for(let a=0;a<r.length;++a)Z(t,r[a]);o.push(i.on("change:extent",a=>{for(let l=0;l<r.length;++l)this.cesiumLayers_.remove(r[l],!0),this.ourLayers_.remove(r[l],!1);delete this.layerMap[y(i)],this.synchronize()})),o.push(i.on("change",a=>{for(let l=0;l<r.length;++l){const m=this.cesiumLayers_.indexOf(r[l]);m>=0&&(this.cesiumLayers_.remove(r[l],!1),this.cesiumLayers_.add(r[l],m))}})),this.olLayerListenKeys[s].push(...o)}return Array.isArray(r)?r:null}orderLayers(){const t=[],i={},s=[this.mapLayerGroup];for(;s.length>0;){const n=s.splice(0,1)[0];if(t.push(n),i[y(n)]=n.getZIndex()||0,n instanceof K){const r=n.getLayers();r&&s.unshift(...r.getArray())}}t.sort((n,r)=>i[y(n)]-i[y(r)]),t.forEach(n=>{const r=y(n).toString(),o=this.layerMap[r];o&&o.forEach(a=>{this.raiseToTop(a)})})}raiseToTop(t){this.cesiumLayers_.raiseToTop(t)}}class Ot{constructor(e,t){h(this,"olListenKeys",[]);h(this,"context");h(this,"rootCollection_");const i=new Cesium.BillboardCollection({scene:t}),s=new Cesium.PrimitiveCollection;this.rootCollection_=new Cesium.PrimitiveCollection,this.context={projection:e,billboards:i,featureToCesiumMap:{},primitives:s},this.rootCollection_.add(i),this.rootCollection_.add(s)}destroy(){this.olListenKeys.forEach(L),this.olListenKeys.length=0}getRootPrimitive(){return this.rootCollection_}}class Ft{constructor(e){h(this,"scene");h(this,"boundOnRemoveOrClearFeatureListener_",this.onRemoveOrClearFeature_.bind(this));h(this,"defaultBillboardEyeOffset_",new Cesium.Cartesian3(0,0,10));this.scene=e,this.scene=e}onRemoveOrClearFeature_(e){const t=e.target;console.assert(t instanceof I);const i=t.olcs_cancellers;if(i){const s=e.feature;if(s){const n=y(s),r=i[n];r&&(r(),delete i[n])}else{for(const n in i)i.hasOwnProperty(n)&&i[n]();t.olcs_cancellers={}}}}setReferenceForPicking(e,t,i){i.olLayer=e,i.olFeature=t}createColoredPrimitive(e,t,i,s,n,r){const o=function(d,g){const f=new Cesium.GeometryInstance({geometry:d});return g&&!(g instanceof Cesium.ImageMaterialProperty)&&(f.attributes={color:Cesium.ColorGeometryInstanceAttribute.fromColor(g)}),f},a={flat:!0,renderState:{depthTest:{enabled:!0}}};r!==void 0&&(a.renderState.lineWidth=r);const l=o(s,n),m=this.getHeightReference(e,t,i);let u;if(m===Cesium.HeightReference.CLAMP_TO_GROUND){if(!("createShadowVolume"in l.geometry.constructor))return null;u=new Cesium.GroundPrimitive({geometryInstances:l})}else u=new Cesium.Primitive({geometryInstances:l});if(n instanceof Cesium.ImageMaterialProperty){const d=n.image.getValue().toDataURL();u.appearance=new Cesium.MaterialAppearance({flat:!0,renderState:{depthTest:{enabled:!0}},material:new Cesium.Material({fabric:{type:"Image",uniforms:{image:d}}})})}else u.appearance=new Cesium.MaterialAppearance({...a,material:new Cesium.Material({translucent:n.alpha!==1,fabric:{type:"Color",uniforms:{color:n}}})}),u instanceof Cesium.Primitive&&(t.get("olcs_shadows")||e.get("olcs_shadows"))&&(u.shadows=1);return this.setReferenceForPicking(e,t,u),u}extractColorFromOlStyle(e,t){const i=e.getFill()?e.getFill().getColor():null,s=e.getStroke()?e.getStroke().getColor():null;let n="black";return s&&t?n=s:i&&(n=i),Q(n)}extractLineWidthFromOlStyle(e){const t=e.getStroke()?e.getStroke().getWidth():void 0;return t!==void 0?t:1}wrapFillAndOutlineGeometries(e,t,i,s,n,r){const o=this.extractColorFromOlStyle(r,!1),a=this.extractColorFromOlStyle(r,!0),l=new Cesium.PrimitiveCollection;if(r.getFill()){const m=this.createColoredPrimitive(e,t,i,s,o);console.assert(!!m),l.add(m)}if(r.getStroke()&&n){const m=this.extractLineWidthFromOlStyle(r),u=this.createColoredPrimitive(e,t,i,n,a,m);u&&l.add(u)}return l}addTextStyle(e,t,i,s,n){let r;if(n instanceof Cesium.PrimitiveCollection?r=n:(r=new Cesium.PrimitiveCollection,r.add(n)),!s.getText())return r;const o=s.getText(),a=this.olGeometry4326TextPartToCesium(e,t,i,o);return a&&r.add(a),r}csAddBillboard(e,t,i,s,n,r){t.eyeOffset||(t.eyeOffset=this.defaultBillboardEyeOffset_);const o=e.add(t);return this.setReferenceForPicking(i,s,o),o}olCircleGeometryToCesium(e,t,i,s,n){i=O(i,s),console.assert(i.getType()=="Circle");const r=i.getCenter(),o=r.length==3?r[2]:0,a=r.slice();a[0]+=i.getRadius();const l=w(r),m=w(a),u=Cesium.Cartesian3.distance(l,m),d=new Cesium.CircleGeometry({center:l,radius:u,height:o});let g,f;if(this.getHeightReference(e,t,i)===Cesium.HeightReference.CLAMP_TO_GROUND){const _=this.extractLineWidthFromOlStyle(n);if(_){const C=st(i.getCenter(),u),P=G(C.getLinearRing(0).getCoordinates()),E=g=new Cesium.GroundPolylinePrimitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.GroundPolylineGeometry({positions:P,width:_})}),appearance:new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(t,n,!0)}),classificationType:Cesium.ClassificationType.TERRAIN});M(g).then(()=>{this.setReferenceForPicking(e,t,E._primitive)})}}else f=new Cesium.CircleOutlineGeometry({center:l,radius:u,extrudedHeight:o,height:o});const p=this.wrapFillAndOutlineGeometries(e,t,i,d,f,n);return g&&p.add(g),this.addTextStyle(e,t,i,n,p)}olLineStringGeometryToCesium(e,t,i,s,n){i=O(i,s),console.assert(i.getType()=="LineString");const r=G(i.getCoordinates()),o=this.extractLineWidthFromOlStyle(n);let a;const l=this.getHeightReference(e,t,i),m=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(t,n,!0)});if(l===Cesium.HeightReference.CLAMP_TO_GROUND){const u=new Cesium.GroundPolylineGeometry({positions:r,width:o}),d=a=new Cesium.GroundPolylinePrimitive({appearance:m,geometryInstances:new Cesium.GeometryInstance({geometry:u})});M(a).then(()=>{this.setReferenceForPicking(e,t,d._primitive)})}else{const u=new Cesium.PolylineGeometry({positions:r,width:o,vertexFormat:m.vertexFormat});a=new Cesium.Primitive({appearance:m,geometryInstances:new Cesium.GeometryInstance({geometry:u})})}return this.setReferenceForPicking(e,t,a),this.addTextStyle(e,t,i,n,a)}olPolygonGeometryToCesium(e,t,i,s,n){i=O(i,s),console.assert(i.getType()=="Polygon");const r=this.getHeightReference(e,t,i);let o,a,l;if(i.getCoordinates()[0].length==5&&t.get("olcs.polygon_kind")==="rectangle"){const u=i.getCoordinates()[0],d=nt(u),g=Cesium.Rectangle.fromDegrees(d[0],d[1],d[2],d[3]);let f=0;if(u[0].length==3)for(let _=0;_<u.length;_++)f=Math.max(f,u[_][2]);const p=t.get("olcs_extruded_height");o=new Cesium.RectangleGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:g,height:f,extrudedHeight:p}),a=new Cesium.RectangleOutlineGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:g,height:f,extrudedHeight:p})}else{const u=i.getLinearRings(),d={positions:[],holes:[]},g=d;console.assert(u.length>0);for(let p=0;p<u.length;++p){const _=u[p].getCoordinates(),C=G(_);console.assert(C&&C.length>0),p===0?d.positions=C:d.holes.push({positions:C,holes:[]})}const f=t.get("olcs_extruded_height");if(o=new Cesium.PolygonGeometry({polygonHierarchy:g,perPositionHeight:!0,extrudedHeight:f}),r===Cesium.HeightReference.CLAMP_TO_GROUND){const p=this.extractLineWidthFromOlStyle(n);if(p>0){const _=[d.positions];if(d.holes)for(let E=0;E<d.holes.length;++E)_.push(d.holes[E].positions);const C=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(t,n,!0)}),P=[];for(const E of _){const S=new Cesium.GroundPolylineGeometry({positions:E,width:p});P.push(new Cesium.GeometryInstance({geometry:S}))}l=new Cesium.GroundPolylinePrimitive({appearance:C,geometryInstances:P}),M(l).then(()=>{this.setReferenceForPicking(e,t,l._primitive)})}}else a=new Cesium.PolygonOutlineGeometry({polygonHierarchy:d,perPositionHeight:!0,extrudedHeight:f})}const m=this.wrapFillAndOutlineGeometries(e,t,i,o,a,n);return l&&m.add(l),this.addTextStyle(e,t,i,n,m)}getHeightReference(e,t,i){let s=i.get("altitudeMode");s===void 0&&(s=t.get("altitudeMode")),s===void 0&&(s=e.get("altitudeMode"));let n=Cesium.HeightReference.NONE;return s==="clampToGround"?n=Cesium.HeightReference.CLAMP_TO_GROUND:s==="relativeToGround"&&(n=Cesium.HeightReference.RELATIVE_TO_GROUND),n}createBillboardFromImage(e,t,i,s,n,r,o,a){r instanceof X&&r.load();const l=r.getImage(1),m=function(d){return d.src!=""&&d.naturalHeight!=0&&d.naturalWidth!=0&&d.complete},u=(function(){if(!l||!(l instanceof HTMLCanvasElement||l instanceof Image||l instanceof HTMLImageElement))return;const d=i.getCoordinates(),g=w(d);let f;const p=r.getOpacity();p!==void 0&&(f=new Cesium.Color(1,1,1,p));const _=r.getScale(),C=this.getHeightReference(e,t,i),P={image:l,color:f,scale:_,heightReference:C,position:g};if(Object.assign(P,t.get("cesiumOptions")),r instanceof X){const S=r.getAnchor();if(S){const me=Array.isArray(_)?_[0]:_,ge=Array.isArray(_)?_[1]:_;P.pixelOffset=new Cesium.Cartesian2((l.width/2-S[0])*me,(l.height/2-S[1])*ge)}}const E=this.csAddBillboard(o,P,e,t,i,n);a&&a(E)}).bind(this);if(l instanceof Image&&!m(l)){let d=!1;const g=e.getSource(),f=function(){d=!0};g.on(["removefeature","clear"],this.boundOnRemoveOrClearFeatureListener_);let p=g.olcs_cancellers;p||(p=g.olcs_cancellers={});const _=y(t);p[_]&&p[_](),p[_]=f;const C=function(){l.removeEventListener("load",C),!o.isDestroyed()&&!d&&u()};l.addEventListener("load",C)}else u()}olPointGeometryToCesium(e,t,i,s,n,r,o){console.assert(i.getType()=="Point"),i=O(i,s);let a=null;const l=n.getImage();if(l){const m=i.get("olcs_model")||t.get("olcs_model");if(m){a=new Cesium.PrimitiveCollection;const u=m(),d=Object.assign({},{scene:this.scene},u.cesiumOptions);if("fromGltf"in Cesium.Model){const g=Cesium.Model.fromGltf(d);a.add(g)}else Cesium.Model.fromGltfAsync(d).then(g=>{a.add(g)});u.debugModelMatrix&&a.add(new Cesium.DebugModelMatrixPrimitive({modelMatrix:u.debugModelMatrix}))}else this.createBillboardFromImage(e,t,i,s,n,l,r,o)}return n.getText()?this.addTextStyle(e,t,i,n,a||new Cesium.Primitive):a}olMultiGeometryToCesium(e,t,i,s,n,r,o){switch(i.getType()){case"MultiPoint":{const a=i.getPoints();if(n.getText()){const l=new Cesium.PrimitiveCollection;return a.forEach(m=>{console.assert(m);const u=this.olPointGeometryToCesium(e,t,m,s,n,r,o);u&&l.add(u)}),l}else return a.forEach(l=>{console.assert(l),this.olPointGeometryToCesium(e,t,l,s,n,r,o)}),null}case"MultiLineString":{const a=i.getLineStrings(),l=new Cesium.PrimitiveCollection;return a.forEach(m=>{const u=this.olLineStringGeometryToCesium(e,t,m,s,n);l.add(u)}),l}case"MultiPolygon":{const a=i.getPolygons(),l=new Cesium.PrimitiveCollection;return a.forEach(m=>{const u=this.olPolygonGeometryToCesium(e,t,m,s,n);l.add(u)}),l}default:console.assert(!1,`Unhandled multi geometry type${i.getType()}`)}}olGeometry4326TextPartToCesium(e,t,i,s){const n=s.getText();if(!n)return null;const r=new Cesium.LabelCollection({scene:this.scene}),o=U(i.getExtent());if(i instanceof rt){const f=i.getFirstCoordinate();o[2]=f.length==3?f[2]:0}const a={};a.position=w(o),a.text=n,a.heightReference=this.getHeightReference(e,t,i);const l=s.getOffsetX(),m=s.getOffsetY();if(l!=0||m!=0){const f=new Cesium.Cartesian2(l,m);a.pixelOffset=f}a.font=s.getFont()||"10px sans-serif";let u;s.getFill()&&(a.fillColor=this.extractColorFromOlStyle(s,!1),u=Cesium.LabelStyle.FILL),s.getStroke()&&(a.outlineWidth=this.extractLineWidthFromOlStyle(s),a.outlineColor=this.extractColorFromOlStyle(s,!0),u=Cesium.LabelStyle.OUTLINE),s.getFill()&&s.getStroke()&&(u=Cesium.LabelStyle.FILL_AND_OUTLINE),a.style=u;let d;switch(s.getTextAlign()){case"left":d=Cesium.HorizontalOrigin.LEFT;break;case"right":d=Cesium.HorizontalOrigin.RIGHT;break;case"center":default:d=Cesium.HorizontalOrigin.CENTER}if(a.horizontalOrigin=d,s.getTextBaseline()){let f;switch(s.getTextBaseline()){case"top":f=Cesium.VerticalOrigin.TOP;break;case"middle":f=Cesium.VerticalOrigin.CENTER;break;case"bottom":f=Cesium.VerticalOrigin.BOTTOM;break;case"alphabetic":f=Cesium.VerticalOrigin.TOP;break;case"hanging":f=Cesium.VerticalOrigin.BOTTOM;break;default:console.assert(!1,`unhandled baseline ${s.getTextBaseline()}`)}a.verticalOrigin=f}const g=r.add(a);return this.setReferenceForPicking(e,t,g),r}olStyleToCesium(e,t,i){const s=t.getFill(),n=t.getStroke();if(i&&!n||!i&&!s)return null;const r=i?n.getColor():s.getColor(),o=Q(r);return i&&n.getLineDash()?Cesium.Material.fromType("Stripe",{horizontal:!1,repeat:500,evenColor:o,oddColor:new Cesium.Color(0,0,0,0)}):Cesium.Material.fromType("Color",{color:o})}computePlainStyle(e,t,i,s){const n=t.getStyleFunction();let r=null;return n&&(r=n(t,s)),!r&&i&&(r=i(t,s)),r?Array.isArray(r)?r:[r]:null}getGeometryFromFeature(e,t,i){if(i)return i;const s=e.get("olcs.3d_geometry");if(s&&s instanceof $)return s;if(t){const n=t.getGeometryFunction()(e);if(n instanceof $)return n}return e.getGeometry()}olFeatureToCesium(e,t,i,s,n){const r=this.getGeometryFromFeature(t,i,n);if(!r)return null;const o=s.projection,a=function(l){const m=s.featureToCesiumMap[y(t)];m instanceof Array?m.push(l):s.featureToCesiumMap[y(t)]=[l]};switch(r.getType()){case"GeometryCollection":const l=new Cesium.PrimitiveCollection;return r.getGeometriesArray().forEach(d=>{if(d){const g=this.olFeatureToCesium(e,t,i,s,d);g&&l.add(g)}}),l;case"Point":const m=s.billboards,u=this.olPointGeometryToCesium(e,t,r,o,i,m,a);return u||null;case"Circle":return this.olCircleGeometryToCesium(e,t,r,o,i);case"LineString":return this.olLineStringGeometryToCesium(e,t,r,o,i);case"Polygon":return this.olPolygonGeometryToCesium(e,t,r,o,i);case"MultiPoint":return this.olMultiGeometryToCesium(e,t,r,o,i,s.billboards,a)||null;case"MultiLineString":return this.olMultiGeometryToCesium(e,t,r,o,i,s.billboards,a)||null;case"MultiPolygon":return this.olMultiGeometryToCesium(e,t,r,o,i,s.billboards,a)||null;case"LinearRing":throw new Error("LinearRing should only be part of polygon.");default:throw new Error(`Ol geom type not handled : ${r.getType()}`)}}olVectorLayerToCesium(e,t,i){const s=t.getProjection(),n=t.getResolution();if(n===void 0||!s)throw console.assert(!1,"View not ready"),new Error("View not ready");let r=e.getSource();r instanceof re&&(r=r.getSource()),console.assert(r instanceof I);const o=r.getFeatures(),a=new Ot(s,this.scene),l=a.context;for(let m=0;m<o.length;++m){const u=o[m];if(!u)continue;const d=e.getStyleFunction(),g=this.computePlainStyle(e,u,d,n);if(!g||!g.length)continue;let f=null;for(let p=0;p<g.length;p++){const _=this.olFeatureToCesium(e,u,g[p],l);if(_){if(!f)f=_;else if(_){let C=0,P;for(;P=_.get(C);)f.add(P),C++}}}f&&(i[y(u)]=f,a.getRootPrimitive().add(f))}return a}convert(e,t,i,s){const n=t.getProjection(),r=t.getResolution();if(r==null||!n)return null;const o=e.getStyleFunction(),a=this.computePlainStyle(e,i,o,r);if(!a||!a.length)return null;s.projection=n;let l=null;for(let m=0;m<a.length;m++){const u=this.olFeatureToCesium(e,i,a[m],s);if(!l)l=u;else if(u){let d=0,g;for(;g=u.get(d);)l.add(g),d++}}return l}}class xt extends he{constructor(t,i,s){super(t,i);h(this,"converter");h(this,"csAllPrimitives_");this.converter=s||new Ft(i),this.csAllPrimitives_=new Cesium.PrimitiveCollection,i.primitives.add(this.csAllPrimitives_),this.csAllPrimitives_.destroyPrimitives=!1}addCesiumObject(t){console.assert(t);const i=t.getRootPrimitive();i.counterpart=t,this.csAllPrimitives_.add(t.getRootPrimitive())}destroyCesiumObject(t){t.getRootPrimitive().destroy()}removeSingleCesiumObject(t,i){t.destroy(),this.csAllPrimitives_.destroyPrimitives=i,this.csAllPrimitives_.remove(t.getRootPrimitive()),this.csAllPrimitives_.destroyPrimitives=!1}removeAllCesiumObjects(t){if(this.csAllPrimitives_.destroyPrimitives=t,t)for(let i=0;i<this.csAllPrimitives_.length;++i)this.csAllPrimitives_.get(i).counterpart.destroy();this.csAllPrimitives_.removeAll(),this.csAllPrimitives_.destroyPrimitives=!1}updateLayerVisibility(t,i){let s=!0;[t.layer].concat(t.parents).forEach(n=>{const r=n.getVisible();r!==void 0?s=s&&r:s=!1}),i.show=s}createSingleLayerCounterparts(t){const i=t.layer;if(!(i instanceof ot)||i instanceof H)return null;console.assert(i instanceof at);let s=i.getSource();if(s instanceof re&&(s=s.getSource()),!s)return null;console.assert(s instanceof I),console.assert(this.view);const n=this.view,r={},o=this.converter.olVectorLayerToCesium(i,n,r),a=o.getRootPrimitive(),l=o.olListenKeys;[t.layer].concat(t.parents).forEach(d=>{l.push(d.on("change:visible",()=>{this.updateLayerVisibility(t,a)}))}),this.updateLayerVisibility(t,a);const m=d=>{const g=o.context,f=this.converter.convert(i,n,d,g);f&&(r[y(d)]=f,a.add(f))},u=d=>{const g=y(d),f=o.context,p=f.featureToCesiumMap[g];p&&(delete f.featureToCesiumMap[g],p.forEach(C=>{C instanceof Cesium.Billboard&&f.billboards.remove(C)}));const _=r[g];delete r[g],_&&a.remove(_)};return l.push(s.on("addfeature",d=>{console.assert(d.feature),m(d.feature)})),l.push(s.on("removefeature",d=>{console.assert(d.feature),u(d.feature)})),l.push(s.on("changefeature",d=>{const g=d.feature;console.assert(g),u(g),m(g)})),o?[o]:null}}function At(c){return c&&c.parentNode?c.parentNode.removeChild(c):null}function It(c){for(;c.lastChild;)c.removeChild(c.lastChild)}function ue(c,e){const t=c.cloneNode();c.nodeName==="CANVAS"&&t.getContext("2d").drawImage(c,0,0),e&&e.appendChild(t),c.nodeType!==Node.TEXT_NODE&&t.addEventListener("click",s=>{c.dispatchEvent(new MouseEvent("click",s)),s.stopPropagation()});const i=c.childNodes;for(let s=0;s<i.length;s++)i[s]&&ue(i[s],t);return t}class Mt extends ct{constructor(t){const i=t.parent;super(i.getOptions());h(this,"scenePostRenderListenerRemover_",null);h(this,"scene_");h(this,"synchronizer_");h(this,"parent_");h(this,"positionWGS84_");h(this,"observer_");h(this,"attributeObserver_",[]);h(this,"listenerKeys_");this.scene_=t.scene,this.synchronizer_=t.synchronizer,this.parent_=i,this.positionWGS84_=void 0,this.observer_=new MutationObserver(this.handleElementChanged.bind(this)),this.attributeObserver_=[],this.listenerKeys_=[];const s=n=>this.setPropertyFromEvent_(n);this.listenerKeys_.push(this.parent_.on("change:element",s)),this.listenerKeys_.push(this.parent_.on("change:offset",s)),this.listenerKeys_.push(this.parent_.on("change:position",s)),this.listenerKeys_.push(this.parent_.on("change:positioning",s)),this.setProperties(this.parent_.getProperties()),this.handleMapChanged(),this.handleElementChanged()}observeTarget_(t){if(this.observer_){this.observer_.disconnect(),this.observer_.observe(t,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),this.attributeObserver_.forEach(i=>{i.disconnect()}),this.attributeObserver_.length=0;for(let i=0;i<t.childNodes.length;i++){const s=t.childNodes[i];if(s.nodeType===1){const n=new MutationObserver(this.handleElementChanged.bind(this));n.observe(s,{attributes:!0,subtree:!0}),this.attributeObserver_.push(n)}}}}setPropertyFromEvent_(t){t.target&&t.key&&this.set(t.key,t.target.get(t.key))}getScene(){return this.scene_}handleMapChanged(){this.scenePostRenderListenerRemover_&&(this.scenePostRenderListenerRemover_(),At(this.element)),this.scenePostRenderListenerRemover_=null;const t=this.getScene();if(t){this.scenePostRenderListenerRemover_=t.postRender.addEventListener(this.updatePixelPosition.bind(this)),this.updatePixelPosition();const i=this.stopEvent?this.synchronizer_.getOverlayContainerStopEvent():this.synchronizer_.getOverlayContainer();this.insertFirst?i.insertBefore(this.element,i.childNodes[0]||null):i.appendChild(this.element)}}handlePositionChanged(){const t=this.getPosition();if(t){const i=this.parent_.getMap().getView().getProjection();this.positionWGS84_=ne(t,i,"EPSG:4326")}else this.positionWGS84_=void 0;this.updatePixelPosition()}handleElementChanged(){It(this.element);const t=this.getElement();if(t&&t.parentNode&&t.parentNode.childNodes)for(const i of Array.from(t.parentNode.childNodes)){const s=ue(i,null);this.element.appendChild(s)}t.parentNode&&this.observeTarget_(t.parentNode)}updatePixelPosition(){const t=this.positionWGS84_;if(!this.scene_||!t){this.setVisible(!1);return}let i=0;if(t.length===2){const d=this.scene_.globe.getHeight(Cesium.Cartographic.fromDegrees(t[0],t[1]));d&&this.scene_.globe.tilesLoaded&&(t[2]=d),d&&(i=d)}else i=t[2];const s=Cesium.Cartesian3.fromDegrees(t[0],t[1],i),n=this.scene_.camera,r=new Cesium.BoundingSphere(new Cesium.Cartesian3,6356752);if(!new Cesium.Occluder(r,n.position).isPointVisible(s)){this.setVisible(!1);return}if(n.frustum.computeCullingVolume(n.position,n.direction,n.up).computeVisibility(new Cesium.BoundingSphere(s))!==1){this.setVisible(!1);return}this.setVisible(!0);const l=this.scene_.cartesianToCanvasCoordinates(s),m=[l.x,l.y],u=[this.scene_.canvas.width,this.scene_.canvas.height];this.updateRenderedPosition(m,u)}destroy(){this.scenePostRenderListenerRemover_&&this.scenePostRenderListenerRemover_(),this.observer_&&this.observer_.disconnect(),L(this.listenerKeys_),this.listenerKeys_.splice(0),"removeNode"in this.element?this.element.removeNode(!0):this.element.remove(),this.element=null}}class Gt{constructor(e,t){h(this,"map");h(this,"scene");h(this,"overlayCollection_");h(this,"overlayContainerStopEvent_");h(this,"overlayContainer_");h(this,"overlayMap_",new Map);h(this,"overlayEvents",["click","dblclick","mousedown","touchstart","pointerdown","mousewheel","wheel"]);h(this,"listenerKeys_",[]);this.map=e,this.scene=t,this.map=e,this.overlayCollection_=this.map.getOverlays(),this.scene=t,this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.overlayEvents.forEach(i=>{this.overlayContainerStopEvent_.addEventListener(i,s=>s.stopPropagation())}),this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_),this.overlayContainer_=document.createElement("div"),this.overlayContainer_.className="ol-overlaycontainer",this.scene.canvas.parentElement.appendChild(this.overlayContainer_)}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOverlayContainer(){return this.overlayContainer_}synchronize(){this.destroyAll(),this.overlayCollection_.forEach(e=>{this.addOverlay(e)}),this.listenerKeys_.push(this.overlayCollection_.on("add",e=>this.addOverlay(e.element))),this.listenerKeys_.push(this.overlayCollection_.on("remove",e=>this.removeOverlay(e.element)))}addOverlay(e){if(!e)return;const t=new Mt({scene:this.scene,synchronizer:this,parent:e});this.overlayMap_.set(y(e),t)}removeOverlay(e){const t=y(e),i=this.overlayMap_.get(t);i&&(i.destroy(),this.overlayMap_.delete(t))}destroyAll(){this.overlayMap_.forEach(e=>{e.destroy()}),this.overlayMap_.clear(),L(this.listenerKeys_),this.listenerKeys_.length=0}}const N={DONE:0,PENDING:1,FAILED:2};class de{constructor(e){h(this,"autoRenderLoop_",null);h(this,"map_");h(this,"time_");h(this,"to4326Transform_");h(this,"resolutionScale_",1);h(this,"canvasClientWidth_",0);h(this,"canvasClientHeight_",0);h(this,"resolutionScaleChanged_",!0);h(this,"container_");h(this,"isOverMap_");h(this,"canvas_");h(this,"enabled_",!1);h(this,"pausedInteractions_",[]);h(this,"hiddenRootGroup_",null);h(this,"scene_");h(this,"camera_");h(this,"globe_");h(this,"dataSourceCollection_");h(this,"dataSourceDisplay_");h(this,"lastFrameTime_",0);h(this,"renderId_");h(this,"targetFrameRate_",Number.POSITIVE_INFINITY);h(this,"blockCesiumRendering_",!1);h(this,"warmingUp_",!1);h(this,"trackedFeature_",null);h(this,"trackedEntity_",null);h(this,"entityView_",null);h(this,"needTrackedEntityUpdate_",!1);h(this,"boundingSphereScratch_",new Cesium.BoundingSphere);h(this,"synchronizers_");this.map_=e.map,this.time_=e.time||function(){return Cesium.JulianDate.now()},this.to4326Transform_=j(this.map_.getView().getProjection(),"EPSG:4326");const t="position:absolute;top:0;left:0;width:100%;height:100%;touch-action:none;";this.container_=document.createElement("DIV");const i=document.createAttribute("style");i.value=`${t}visibility:hidden;`,this.container_.setAttributeNode(i);let s=e.target||this.map_.getViewport();if(typeof s=="string"&&(s=document.getElementById(s)),s.appendChild(this.container_),this.isOverMap_=!e.target,this.isOverMap_&&e.stopOpenLayersEventsPropagation){const m=["click","dblclick","mousedown","touchstart","pointerdown","mousewheel","wheel"];for(let u=0,d=m.length;u<d;++u)this.container_.addEventListener(m[u],g=>g.stopPropagation())}this.canvas_=document.createElement("canvas");const n=document.createAttribute("style");n.value=t,this.canvas_.setAttributeNode(n),z()&&(this.canvas_.style.imageRendering=mt()),this.canvas_.oncontextmenu=function(){return!1},this.canvas_.onselectstart=function(){return!1},this.container_.appendChild(this.canvas_);const r=e.sceneOptions!==void 0?{...e.sceneOptions,canvas:this.canvas_,scene3DOnly:!0}:{canvas:this.canvas_,scene3DOnly:!0};this.scene_=new Cesium.Scene(r);const o=this.scene_.screenSpaceCameraController;Array.isArray(o.tiltEventTypes)?(o.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.SHIFT}),o.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.ALT})):console.log("sscc is not an array"),o.enableLook=!1,this.scene_.camera.constrainedAxis=Cesium.Cartesian3.UNIT_Z,this.camera_=new Tt(this.scene_,this.map_),this.globe_=new Cesium.Globe(Cesium.Ellipsoid.WGS84),this.globe_.baseColor=Cesium.Color.WHITE,this.scene_.globe=this.globe_,this.scene_.skyAtmosphere=new Cesium.SkyAtmosphere;const a=new Cesium.SingleTileImageryProvider({tileHeight:1,tileWidth:1,url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",rectangle:Cesium.Rectangle.fromDegrees(0,0,1,1)});this.globe_.imageryLayers.addImageryProvider(a,0),this.dataSourceCollection_=new Cesium.DataSourceCollection,this.dataSourceDisplay_=new Cesium.DataSourceDisplay({scene:this.scene_,dataSourceCollection:this.dataSourceCollection_}),this.synchronizers_=e.createSynchronizers?e.createSynchronizers(this.map_,this.scene_,this.dataSourceCollection_):[new Rt(this.map_,this.scene_),new xt(this.map_,this.scene_),new Gt(this.map_,this.scene_)],this.handleResize_();for(let m=this.synchronizers_.length-1;m>=0;--m)this.synchronizers_[m].synchronize();new Cesium.EventHelper().add(this.scene_.postRender,de.prototype.updateTrackedEntity_,this)}destroy(){cancelAnimationFrame(this.renderId_),this.renderId_=void 0,this.synchronizers_.forEach(e=>e.destroyAll()),this.camera_.destroy(),this.scene_.destroy(),this.scene_._postRender=null,this.container_.remove()}render_(){this.renderId_!==void 0&&(cancelAnimationFrame(this.renderId_),this.renderId_=void 0),(this.enabled_||this.warmingUp_)&&!this.blockCesiumRendering_&&(this.renderId_=requestAnimationFrame(this.onAnimationFrame_.bind(this)))}onAnimationFrame_(e){this.renderId_=void 0;const t=1e3/this.targetFrameRate_;if(e-this.lastFrameTime_<t){this.render_();return}this.lastFrameTime_=e;const s=this.time_();if(this.scene_.initializeFrame(),this.handleResize_(),this.dataSourceDisplay_.update(s),this.entityView_){const n=this.trackedEntity_;this.dataSourceDisplay_.getBoundingSphere(n,!1,this.boundingSphereScratch_)===N.DONE&&(this.boundingSphereScratch_.radius=1,this.entityView_.update(s,this.boundingSphereScratch_))}this.scene_.render(s),this.camera_.checkCameraChange(),this.render_()}updateTrackedEntity_(){if(!this.needTrackedEntityUpdate_)return;const e=this.trackedEntity_,t=this.scene_,i=this.dataSourceDisplay_.getBoundingSphere(e,!1,this.boundingSphereScratch_);if(i===N.PENDING)return;t.screenSpaceCameraController.enableTilt=!1;const s=i!==N.FAILED?this.boundingSphereScratch_:void 0;s&&(s.radius=1),this.entityView_=new Cesium.EntityView(e,t,t.mapProjection.ellipsoid),this.entityView_.update(this.time_(),s),this.needTrackedEntityUpdate_=!1}handleResize_(){let e=this.canvas_.clientWidth,t=this.canvas_.clientHeight;if(e===0||t===0||e===this.canvasClientWidth_&&t===this.canvasClientHeight_&&!this.resolutionScaleChanged_)return;let i=this.resolutionScale_;z()||(i*=window.devicePixelRatio||1),this.resolutionScaleChanged_=!1,this.canvasClientWidth_=e,this.canvasClientHeight_=t,e*=i,t*=i,this.canvas_.width=e,this.canvas_.height=t,this.scene_.camera.frustum.aspectRatio=e/t}getCamera(){return this.camera_}getOlMap(){return this.map_}getOlView(){const e=this.map_.getView();return console.assert(e),e}getCesiumScene(){return this.scene_}getDataSources(){return this.dataSourceCollection_}getDataSourceDisplay(){return this.dataSourceDisplay_}getEnabled(){return this.enabled_}setEnabled(e){if(this.enabled_===e)return;this.enabled_=e,this.container_.style.visibility=this.enabled_?"visible":"hidden";let t;if(this.enabled_){if(this.throwOnUnitializedMap_(),this.isOverMap_){t=this.map_.getInteractions(),t.forEach((s,n,r)=>{this.pausedInteractions_.push(s)}),t.clear(),this.map_.addInteraction=s=>this.pausedInteractions_.push(s),this.map_.removeInteraction=s=>{let n=!1;return this.pausedInteractions_=this.pausedInteractions_.filter(r=>{const o=r!==s;return n||(n=o),o}),n?s:void 0};const i=this.map_.getLayerGroup();i.getVisible()&&(this.hiddenRootGroup_=i,this.hiddenRootGroup_.setVisible(!1)),this.map_.getOverlayContainer().classList.add("olcs-hideoverlay")}this.camera_.readFromView(),this.render_()}else this.isOverMap_&&(t=this.map_.getInteractions(),this.pausedInteractions_.forEach(i=>{t.push(i)}),this.pausedInteractions_.length=0,this.map_.addInteraction=i=>this.map_.getInteractions().push(i),this.map_.removeInteraction=i=>this.map_.getInteractions().remove(i),this.map_.getOverlayContainer().classList.remove("olcs-hideoverlay"),this.hiddenRootGroup_&&(this.hiddenRootGroup_.setVisible(!0),this.hiddenRootGroup_=null)),this.camera_.updateView()}warmUp(e,t){if(this.enabled_)return;this.throwOnUnitializedMap_(),this.camera_.readFromView();const i=this.globe_.ellipsoid,s=this.scene_.camera,n=i.cartesianToCartographic(s.position);n.height<e&&(n.height=e,s.position=i.cartographicToCartesian(n)),this.warmingUp_=!0,this.render_(),setTimeout(()=>{this.warmingUp_=!1},t)}setBlockCesiumRendering(e){this.blockCesiumRendering_!==e&&(this.blockCesiumRendering_=e,this.render_())}enableAutoRenderLoop(){this.autoRenderLoop_||(this.autoRenderLoop_=new bt(this))}getAutoRenderLoop(){return this.autoRenderLoop_}setResolutionScale(e){e=Math.max(0,e),e!==this.resolutionScale_&&(this.resolutionScale_=Math.max(0,e),this.resolutionScaleChanged_=!0,this.autoRenderLoop_&&this.autoRenderLoop_.restartRenderLoop())}setTargetFrameRate(e){this.targetFrameRate_!==e&&(this.targetFrameRate_=e,this.render_())}throwOnUnitializedMap_(){const t=this.map_.getView(),i=t.getCenter();if(!t.isDef()||isNaN(i[0])||isNaN(i[1]))throw new Error(`The OpenLayers map is not properly initialized: ${i} / ${t.getResolution()}`)}get trackedFeature(){return this.trackedFeature_}set trackedFeature(e){if(this.trackedFeature_!==e){const t=this.scene_;if(!e||!e.getGeometry()){this.needTrackedEntityUpdate_=!1,t.screenSpaceCameraController.enableTilt=!0,this.trackedEntity_&&this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_),this.trackedEntity_=null,this.trackedFeature_=null,this.entityView_=null,t.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);return}this.trackedFeature_=e,this.needTrackedEntityUpdate_=!0;const i=this.to4326Transform_,s=function(){const r=e.getGeometry();console.assert(r instanceof D);const o=r instanceof D?r.getCoordinates():[],a=i(o,void 0,o.length);return w(a)},n={position:new Cesium.CallbackProperty((r,o)=>s(),!1),point:{pixelSize:1,color:Cesium.Color.TRANSPARENT}};this.trackedEntity_=this.dataSourceDisplay_.defaultDataSource.entities.add(n)}}}export{de as default};
//# sourceMappingURL=OLCesium-xmS94HIZ.js.map
