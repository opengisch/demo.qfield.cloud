import{al as le,$ as u,a5 as h,a0 as N,J as B,a6 as Q,s as Nn,ah as ri,aR as dt,o as X,aM as yt,ab as tt,m as b,t as Y,aF as Lt,r as ae,az as un,au as qt,ak as Zt,cb as ai,cc as ge,cd as Yt,ao as _c,aq as so,ai as ze,aO as mt,a2 as uo,bV as mc,aQ as Ds,du as gc,aS as Hi,aI as wt,aT as Oe,aU as At,bm as yc,aH as zt,bu as Ws,bw as wc,ae as Xi,b1 as Gt,E as li,cm as ns,dG as za,bD as qs,aC as xc,aa as os,ac as Cc,b5 as Sc,bv as bc,q as Ec,aA as Ts,aw as Mt,c9 as fo,ag as pi,a8 as Ba,dp as Ua,g7 as Dc,af as Gs,dq as Tc,c2 as Ic,as as ss,d_ as Va,P as vc,av as Is,H as si,aG as Ac,a1 as qi,bS as ci,dH as Ha,eb as Ys,bk as Oc,Y as bo,Z as Eo,b2 as Pc}from"./component-DmEB9E06.js";function Bt(e){this._value=void 0,this._hasClone=!1,this._hasEquals=!1,this._definitionChanged=new le,this.setValue(e)}Object.defineProperties(Bt.prototype,{isConstant:{value:!0},definitionChanged:{get:function(){return this._definitionChanged}}});Bt.prototype.getValue=function(e,t){return this._hasClone?this._value.clone(t):this._value};Bt.prototype.setValue=function(e){const t=this._value;if(t!==e){const i=u(e),n=i&&typeof e.clone=="function",o=i&&typeof e.equals=="function";(!o||!e.equals(t))&&(this._hasClone=n,this._hasEquals=o,this._value=n?e.clone(this._value):e,this._definitionChanged.raiseEvent(this))}};Bt.prototype.equals=function(e){return this===e||e instanceof Bt&&(!this._hasEquals&&this._value===e._value||this._hasEquals&&this._value.equals(e._value))};Bt.prototype.valueOf=function(){return this._value};Bt.prototype.toString=function(){return String(this._value)};function Rc(e,t,i,n,o){return{configurable:n,get:function(){return this[t]},set:function(s){const r=this[t],l=this[i];u(l)&&(l(),this[i]=void 0),s!==void 0&&(!u(s)||!u(s.getValue))&&u(o)&&(s=o(s)),r!==s&&(this[t]=s,this._definitionChanged.raiseEvent(this,e,s,r)),u(s)&&u(s.definitionChanged)&&(this[i]=s.definitionChanged.addEventListener(function(){this._definitionChanged.raiseEvent(this,e,s,s)},this))}}}function Lc(e){return new Bt(e)}function C(e,t,i){return Rc(e,`_${e.toString()}`,`_${e.toString()}Subscription`,h(t,!1),h(i,Lc))}function Ii(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._image=void 0,this._imageSubscription=void 0,this._scale=void 0,this._scaleSubscription=void 0,this._pixelOffset=void 0,this._pixelOffsetSubscription=void 0,this._eyeOffset=void 0,this._eyeOffsetSubscription=void 0,this._horizontalOrigin=void 0,this._horizontalOriginSubscription=void 0,this._verticalOrigin=void 0,this._verticalOriginSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._color=void 0,this._colorSubscription=void 0,this._rotation=void 0,this._rotationSubscription=void 0,this._alignedAxis=void 0,this._alignedAxisSubscription=void 0,this._sizeInMeters=void 0,this._sizeInMetersSubscription=void 0,this._width=void 0,this._widthSubscription=void 0,this._height=void 0,this._heightSubscription=void 0,this._scaleByDistance=void 0,this._scaleByDistanceSubscription=void 0,this._translucencyByDistance=void 0,this._translucencyByDistanceSubscription=void 0,this._pixelOffsetScaleByDistance=void 0,this._pixelOffsetScaleByDistanceSubscription=void 0,this._imageSubRegion=void 0,this._imageSubRegionSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._disableDepthTestDistance=void 0,this._disableDepthTestDistanceSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(Ii.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),image:C("image"),scale:C("scale"),pixelOffset:C("pixelOffset"),eyeOffset:C("eyeOffset"),horizontalOrigin:C("horizontalOrigin"),verticalOrigin:C("verticalOrigin"),heightReference:C("heightReference"),color:C("color"),rotation:C("rotation"),alignedAxis:C("alignedAxis"),sizeInMeters:C("sizeInMeters"),width:C("width"),height:C("height"),scaleByDistance:C("scaleByDistance"),translucencyByDistance:C("translucencyByDistance"),pixelOffsetScaleByDistance:C("pixelOffsetScaleByDistance"),imageSubRegion:C("imageSubRegion"),distanceDisplayCondition:C("distanceDisplayCondition"),disableDepthTestDistance:C("disableDepthTestDistance")});Ii.prototype.clone=function(e){return u(e)?(e.show=this._show,e.image=this._image,e.scale=this._scale,e.pixelOffset=this._pixelOffset,e.eyeOffset=this._eyeOffset,e.horizontalOrigin=this._horizontalOrigin,e.verticalOrigin=this._verticalOrigin,e.heightReference=this._heightReference,e.color=this._color,e.rotation=this._rotation,e.alignedAxis=this._alignedAxis,e.sizeInMeters=this._sizeInMeters,e.width=this._width,e.height=this._height,e.scaleByDistance=this._scaleByDistance,e.translucencyByDistance=this._translucencyByDistance,e.pixelOffsetScaleByDistance=this._pixelOffsetScaleByDistance,e.imageSubRegion=this._imageSubRegion,e.distanceDisplayCondition=this._distanceDisplayCondition,e.disableDepthTestDistance=this._disableDepthTestDistance,e):new Ii(this)};Ii.prototype.merge=function(e){if(!u(e))throw new N("source is required.");this.show=h(this._show,e.show),this.image=h(this._image,e.image),this.scale=h(this._scale,e.scale),this.pixelOffset=h(this._pixelOffset,e.pixelOffset),this.eyeOffset=h(this._eyeOffset,e.eyeOffset),this.horizontalOrigin=h(this._horizontalOrigin,e.horizontalOrigin),this.verticalOrigin=h(this._verticalOrigin,e.verticalOrigin),this.heightReference=h(this._heightReference,e.heightReference),this.color=h(this._color,e.color),this.rotation=h(this._rotation,e.rotation),this.alignedAxis=h(this._alignedAxis,e.alignedAxis),this.sizeInMeters=h(this._sizeInMeters,e.sizeInMeters),this.width=h(this._width,e.width),this.height=h(this._height,e.height),this.scaleByDistance=h(this._scaleByDistance,e.scaleByDistance),this.translucencyByDistance=h(this._translucencyByDistance,e.translucencyByDistance),this.pixelOffsetScaleByDistance=h(this._pixelOffsetScaleByDistance,e.pixelOffsetScaleByDistance),this.imageSubRegion=h(this._imageSubRegion,e.imageSubRegion),this.distanceDisplayCondition=h(this._distanceDisplayCondition,e.distanceDisplayCondition),this.disableDepthTestDistance=h(this._disableDepthTestDistance,e.disableDepthTestDistance)};function te(){N.throwInstantiationError()}Object.defineProperties(te.prototype,{isConstant:{get:N.throwInstantiationError},definitionChanged:{get:N.throwInstantiationError}});te.prototype.getValue=N.throwInstantiationError;te.prototype.equals=N.throwInstantiationError;te.equals=function(e,t){return e===t||u(e)&&e.equals(t)};te.arrayEquals=function(e,t){if(e===t)return!0;if(!u(e)||!u(t)||e.length!==t.length)return!1;const i=e.length;for(let n=0;n<i;n++)if(!te.equals(e[n],t[n]))return!1;return!0};te.isConstant=function(e){return!u(e)||e.isConstant};te.getValueOrUndefined=function(e,t,i){return u(e)?e.getValue(t,i):void 0};te.getValueOrDefault=function(e,t,i,n){return u(e)?h(e.getValue(t,n),i):i};te.getValueOrClonedDefault=function(e,t,i,n){let o;return u(e)&&(o=e.getValue(t,n)),u(o)||(o=i.clone(o)),o};function J(e){e=h(e,h.EMPTY_OBJECT),this.start=u(e.start)?B.clone(e.start):new B,this.stop=u(e.stop)?B.clone(e.stop):new B,this.data=e.data,this.isStartIncluded=h(e.isStartIncluded,!0),this.isStopIncluded=h(e.isStopIncluded,!0)}Object.defineProperties(J.prototype,{isEmpty:{get:function(){const e=B.compare(this.stop,this.start);return e<0||e===0&&(!this.isStartIncluded||!this.isStopIncluded)}}});const Bi={start:void 0,stop:void 0,isStartIncluded:void 0,isStopIncluded:void 0,data:void 0};J.fromIso8601=function(e,t){Q.typeOf.object("options",e),Q.typeOf.string("options.iso8601",e.iso8601);const i=e.iso8601.split("/");if(i.length!==2)throw new N("options.iso8601 is an invalid ISO 8601 interval.");const n=B.fromIso8601(i[0]),o=B.fromIso8601(i[1]),s=h(e.isStartIncluded,!0),r=h(e.isStopIncluded,!0),l=e.data;return u(t)?(t.start=n,t.stop=o,t.isStartIncluded=s,t.isStopIncluded=r,t.data=l,t):(Bi.start=n,Bi.stop=o,Bi.isStartIncluded=s,Bi.isStopIncluded=r,Bi.data=l,new J(Bi))};J.toIso8601=function(e,t){return Q.typeOf.object("timeInterval",e),`${B.toIso8601(e.start,t)}/${B.toIso8601(e.stop,t)}`};J.clone=function(e,t){if(u(e))return u(t)?(t.start=e.start,t.stop=e.stop,t.isStartIncluded=e.isStartIncluded,t.isStopIncluded=e.isStopIncluded,t.data=e.data,t):new J(e)};J.equals=function(e,t,i){return e===t||u(e)&&u(t)&&(e.isEmpty&&t.isEmpty||e.isStartIncluded===t.isStartIncluded&&e.isStopIncluded===t.isStopIncluded&&B.equals(e.start,t.start)&&B.equals(e.stop,t.stop)&&(e.data===t.data||u(i)&&i(e.data,t.data)))};J.equalsEpsilon=function(e,t,i,n){return i=h(i,0),e===t||u(e)&&u(t)&&(e.isEmpty&&t.isEmpty||e.isStartIncluded===t.isStartIncluded&&e.isStopIncluded===t.isStopIncluded&&B.equalsEpsilon(e.start,t.start,i)&&B.equalsEpsilon(e.stop,t.stop,i)&&(e.data===t.data||u(n)&&n(e.data,t.data)))};J.intersect=function(e,t,i,n){if(Q.typeOf.object("left",e),!u(t))return J.clone(J.EMPTY,i);const o=e.start,s=e.stop,r=t.start,l=t.stop,a=B.greaterThanOrEquals(r,o)&&B.greaterThanOrEquals(s,r),c=!a&&B.lessThanOrEquals(r,o)&&B.lessThanOrEquals(o,l);if(!a&&!c)return J.clone(J.EMPTY,i);const d=e.isStartIncluded,g=e.isStopIncluded,m=t.isStartIncluded,y=t.isStopIncluded,w=B.lessThan(s,l);return u(i)||(i=new J),i.start=a?r:o,i.isStartIncluded=d&&m||!B.equals(r,o)&&(a&&m||c&&d),i.stop=w?s:l,i.isStopIncluded=w?g:g&&y||!B.equals(l,s)&&y,i.data=u(n)?n(e.data,t.data):e.data,i};J.contains=function(e,t){if(Q.typeOf.object("timeInterval",e),Q.typeOf.object("julianDate",t),e.isEmpty)return!1;const i=B.compare(e.start,t);if(i===0)return e.isStartIncluded;const n=B.compare(t,e.stop);return n===0?e.isStopIncluded:i<0&&n<0};J.prototype.clone=function(e){return J.clone(this,e)};J.prototype.equals=function(e,t){return J.equals(this,e,t)};J.prototype.equalsEpsilon=function(e,t,i){return J.equalsEpsilon(this,e,t,i)};J.prototype.toString=function(){return J.toIso8601(this)};J.EMPTY=Object.freeze(new J({start:new B,stop:new B,isStartIncluded:!1,isStopIncluded:!1}));const Wa=Object.freeze(B.fromIso8601("0000-01-01T00:00:00Z")),qa=Object.freeze(B.fromIso8601("9999-12-31T24:00:00Z")),Nc=Object.freeze(new J({start:Wa,stop:qa})),Mc={MINIMUM_VALUE:Wa,MAXIMUM_VALUE:qa,MAXIMUM_INTERVAL:Nc},Ue=Mc;function Ki(e){this._definitionChanged=new le,this._color=void 0,this._colorSubscription=void 0,this.color=e}Object.defineProperties(Ki.prototype,{isConstant:{get:function(){return te.isConstant(this._color)}},definitionChanged:{get:function(){return this._definitionChanged}},color:C("color")});Ki.prototype.getType=function(e){return"Color"};Ki.prototype.getValue=function(e,t){return u(t)||(t={}),t.color=te.getValueOrClonedDefault(this._color,e,Nn.WHITE,t.color),t};Ki.prototype.equals=function(e){return this===e||e instanceof Ki&&te.equals(this._color,e._color)};const kc=`in vec3 position3DHigh;
in vec3 position3DLow;
in float batchId;

#ifdef EXTRUDED_GEOMETRY
in vec3 extrudeDirection;

uniform float u_globeMinimumAltitude;
#endif // EXTRUDED_GEOMETRY

#ifdef PER_INSTANCE_COLOR
out vec4 v_color;
#endif // PER_INSTANCE_COLOR

#ifdef TEXTURE_COORDINATES
#ifdef SPHERICAL
out vec4 v_sphericalExtents;
#else // SPHERICAL
out vec2 v_inversePlaneExtents;
out vec4 v_westPlane;
out vec4 v_southPlane;
#endif // SPHERICAL
out vec3 v_uvMinAndSphericalLongitudeRotation;
out vec3 v_uMaxAndInverseDistance;
out vec3 v_vMaxAndInverseDistance;
#endif // TEXTURE_COORDINATES

void main()
{
    vec4 position = czm_computePosition();

#ifdef EXTRUDED_GEOMETRY
    float delta = min(u_globeMinimumAltitude, czm_geometricToleranceOverMeter * length(position.xyz));
    delta *= czm_sceneMode == czm_sceneMode3D ? 1.0 : 0.0;

    //extrudeDirection is zero for the top layer
    position = position + vec4(extrudeDirection * delta, 0.0);
#endif

#ifdef TEXTURE_COORDINATES
#ifdef SPHERICAL
    v_sphericalExtents = czm_batchTable_sphericalExtents(batchId);
    v_uvMinAndSphericalLongitudeRotation.z = czm_batchTable_longitudeRotation(batchId);
#else // SPHERICAL
#ifdef COLUMBUS_VIEW_2D
    vec4 planes2D_high = czm_batchTable_planes2D_HIGH(batchId);
    vec4 planes2D_low = czm_batchTable_planes2D_LOW(batchId);

    // If the primitive is split across the IDL (planes2D_high.x > planes2D_high.w):
    // - If this vertex is on the east side of the IDL (position3DLow.y > 0.0, comparison with position3DHigh may produce artifacts)
    // - existing "east" is on the wrong side of the world, far away (planes2D_high/low.w)
    // - so set "east" as beyond the eastmost extent of the projection (idlSplitNewPlaneHiLow)
    vec2 idlSplitNewPlaneHiLow = vec2(EAST_MOST_X_HIGH - (WEST_MOST_X_HIGH - planes2D_high.w), EAST_MOST_X_LOW - (WEST_MOST_X_LOW - planes2D_low.w));
    bool idlSplit = planes2D_high.x > planes2D_high.w && position3DLow.y > 0.0;
    planes2D_high.w = czm_branchFreeTernary(idlSplit, idlSplitNewPlaneHiLow.x, planes2D_high.w);
    planes2D_low.w = czm_branchFreeTernary(idlSplit, idlSplitNewPlaneHiLow.y, planes2D_low.w);

    // - else, if this vertex is on the west side of the IDL (position3DLow.y < 0.0)
    // - existing "west" is on the wrong side of the world, far away (planes2D_high/low.x)
    // - so set "west" as beyond the westmost extent of the projection (idlSplitNewPlaneHiLow)
    idlSplit = planes2D_high.x > planes2D_high.w && position3DLow.y < 0.0;
    idlSplitNewPlaneHiLow = vec2(WEST_MOST_X_HIGH - (EAST_MOST_X_HIGH - planes2D_high.x), WEST_MOST_X_LOW - (EAST_MOST_X_LOW - planes2D_low.x));
    planes2D_high.x = czm_branchFreeTernary(idlSplit, idlSplitNewPlaneHiLow.x, planes2D_high.x);
    planes2D_low.x = czm_branchFreeTernary(idlSplit, idlSplitNewPlaneHiLow.y, planes2D_low.x);

    vec3 southWestCorner = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(vec3(0.0, planes2D_high.xy), vec3(0.0, planes2D_low.xy))).xyz;
    vec3 northWestCorner = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(vec3(0.0, planes2D_high.x, planes2D_high.z), vec3(0.0, planes2D_low.x, planes2D_low.z))).xyz;
    vec3 southEastCorner = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(vec3(0.0, planes2D_high.w, planes2D_high.y), vec3(0.0, planes2D_low.w, planes2D_low.y))).xyz;
#else // COLUMBUS_VIEW_2D
    // 3D case has smaller "plane extents," so planes encoded as a 64 bit position and 2 vec3s for distances/direction
    vec3 southWestCorner = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(czm_batchTable_southWest_HIGH(batchId), czm_batchTable_southWest_LOW(batchId))).xyz;
    vec3 northWestCorner = czm_normal * czm_batchTable_northward(batchId) + southWestCorner;
    vec3 southEastCorner = czm_normal * czm_batchTable_eastward(batchId) + southWestCorner;
#endif // COLUMBUS_VIEW_2D

    vec3 eastWard = southEastCorner - southWestCorner;
    float eastExtent = length(eastWard);
    eastWard /= eastExtent;

    vec3 northWard = northWestCorner - southWestCorner;
    float northExtent = length(northWard);
    northWard /= northExtent;

    v_westPlane = vec4(eastWard, -dot(eastWard, southWestCorner));
    v_southPlane = vec4(northWard, -dot(northWard, southWestCorner));
    v_inversePlaneExtents = vec2(1.0 / eastExtent, 1.0 / northExtent);
#endif // SPHERICAL
    vec4 uvMinAndExtents = czm_batchTable_uvMinAndExtents(batchId);
    vec4 uMaxVmax = czm_batchTable_uMaxVmax(batchId);

    v_uMaxAndInverseDistance = vec3(uMaxVmax.xy, uvMinAndExtents.z);
    v_vMaxAndInverseDistance = vec3(uMaxVmax.zw, uvMinAndExtents.w);
    v_uvMinAndSphericalLongitudeRotation.xy = uvMinAndExtents.xy;
#endif // TEXTURE_COORDINATES

#ifdef PER_INSTANCE_COLOR
    v_color = czm_batchTable_color(batchId);
#endif

    gl_Position = czm_depthClamp(czm_modelViewProjectionRelativeToEye * position);
}
`;function Ot(e){if(e=h(e,h.EMPTY_OBJECT),!u(e.componentDatatype))throw new N("options.componentDatatype is required.");if(!u(e.componentsPerAttribute))throw new N("options.componentsPerAttribute is required.");if(e.componentsPerAttribute<1||e.componentsPerAttribute>4)throw new N("options.componentsPerAttribute must be between 1 and 4.");if(!u(e.value))throw new N("options.value is required.");this.componentDatatype=e.componentDatatype,this.componentsPerAttribute=e.componentsPerAttribute,this.normalize=h(e.normalize,!1),this.value=e.value}const Ga=`#ifdef TEXTURE_COORDINATES
#ifdef SPHERICAL
in vec4 v_sphericalExtents;
#else // SPHERICAL
in vec2 v_inversePlaneExtents;
in vec4 v_westPlane;
in vec4 v_southPlane;
#endif // SPHERICAL
in vec3 v_uvMinAndSphericalLongitudeRotation;
in vec3 v_uMaxAndInverseDistance;
in vec3 v_vMaxAndInverseDistance;
#endif // TEXTURE_COORDINATES

#ifdef PER_INSTANCE_COLOR
in vec4 v_color;
#endif

#ifdef NORMAL_EC
vec3 getEyeCoordinate3FromWindowCoordinate(vec2 fragCoord, float logDepthOrDepth) {
    vec4 eyeCoordinate = czm_windowToEyeCoordinates(fragCoord, logDepthOrDepth);
    return eyeCoordinate.xyz / eyeCoordinate.w;
}

vec3 vectorFromOffset(vec4 eyeCoordinate, vec2 positiveOffset) {
    vec2 glFragCoordXY = gl_FragCoord.xy;
    // Sample depths at both offset and negative offset
    float upOrRightLogDepth = czm_unpackDepth(texture(czm_globeDepthTexture, (glFragCoordXY + positiveOffset) / czm_viewport.zw));
    float downOrLeftLogDepth = czm_unpackDepth(texture(czm_globeDepthTexture, (glFragCoordXY - positiveOffset) / czm_viewport.zw));
    // Explicitly evaluate both paths
    // Necessary for multifrustum and for edges of the screen
    bvec2 upOrRightInBounds = lessThan(glFragCoordXY + positiveOffset, czm_viewport.zw);
    float useUpOrRight = float(upOrRightLogDepth > 0.0 && upOrRightInBounds.x && upOrRightInBounds.y);
    float useDownOrLeft = float(useUpOrRight == 0.0);
    vec3 upOrRightEC = getEyeCoordinate3FromWindowCoordinate(glFragCoordXY + positiveOffset, upOrRightLogDepth);
    vec3 downOrLeftEC = getEyeCoordinate3FromWindowCoordinate(glFragCoordXY - positiveOffset, downOrLeftLogDepth);
    return (upOrRightEC - (eyeCoordinate.xyz / eyeCoordinate.w)) * useUpOrRight + ((eyeCoordinate.xyz / eyeCoordinate.w) - downOrLeftEC) * useDownOrLeft;
}
#endif // NORMAL_EC

void main(void)
{
#ifdef REQUIRES_EC
    float logDepthOrDepth = czm_unpackDepth(texture(czm_globeDepthTexture, gl_FragCoord.xy / czm_viewport.zw));
    vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth);
#endif

#ifdef REQUIRES_WC
    vec4 worldCoordinate4 = czm_inverseView * eyeCoordinate;
    vec3 worldCoordinate = worldCoordinate4.xyz / worldCoordinate4.w;
#endif

#ifdef TEXTURE_COORDINATES
    vec2 uv;
#ifdef SPHERICAL
    // Treat world coords as a sphere normal for spherical coordinates
    vec2 sphericalLatLong = czm_approximateSphericalCoordinates(worldCoordinate);
    sphericalLatLong.y += v_uvMinAndSphericalLongitudeRotation.z;
    sphericalLatLong.y = czm_branchFreeTernary(sphericalLatLong.y < czm_pi, sphericalLatLong.y, sphericalLatLong.y - czm_twoPi);
    uv.x = (sphericalLatLong.y - v_sphericalExtents.y) * v_sphericalExtents.w;
    uv.y = (sphericalLatLong.x - v_sphericalExtents.x) * v_sphericalExtents.z;
#else // SPHERICAL
    // Unpack planes and transform to eye space
    uv.x = czm_planeDistance(v_westPlane, eyeCoordinate.xyz / eyeCoordinate.w) * v_inversePlaneExtents.x;
    uv.y = czm_planeDistance(v_southPlane, eyeCoordinate.xyz / eyeCoordinate.w) * v_inversePlaneExtents.y;
#endif // SPHERICAL
#endif // TEXTURE_COORDINATES

#ifdef PICK
#ifdef CULL_FRAGMENTS
    // When classifying translucent geometry, logDepthOrDepth == 0.0
    // indicates a region that should not be classified, possibly due to there
    // being opaque pixels there in another buffer.
    // Check for logDepthOrDepth != 0.0 to make sure this should be classified.
    if (0.0 <= uv.x && uv.x <= 1.0 && 0.0 <= uv.y && uv.y <= 1.0 || logDepthOrDepth != 0.0) {
        out_FragColor.a = 1.0; // 0.0 alpha leads to discard from ShaderSource.createPickFragmentShaderSource
        czm_writeDepthClamp();
    }
#else // CULL_FRAGMENTS
        out_FragColor.a = 1.0;
#endif // CULL_FRAGMENTS
#else // PICK

#ifdef CULL_FRAGMENTS
    // When classifying translucent geometry, logDepthOrDepth == 0.0
    // indicates a region that should not be classified, possibly due to there
    // being opaque pixels there in another buffer.
    if (uv.x <= 0.0 || 1.0 <= uv.x || uv.y <= 0.0 || 1.0 <= uv.y || logDepthOrDepth == 0.0) {
        discard;
    }
#endif

#ifdef NORMAL_EC
    // Compute normal by sampling adjacent pixels in 2x2 block in screen space
    vec3 downUp = vectorFromOffset(eyeCoordinate, vec2(0.0, 1.0));
    vec3 leftRight = vectorFromOffset(eyeCoordinate, vec2(1.0, 0.0));
    vec3 normalEC = normalize(cross(leftRight, downUp));
#endif


#ifdef PER_INSTANCE_COLOR

    vec4 color = czm_gammaCorrect(v_color);
#ifdef FLAT
    out_FragColor = color;
#else // FLAT
    czm_materialInput materialInput;
    materialInput.normalEC = normalEC;
    materialInput.positionToEyeEC = -eyeCoordinate.xyz;
    czm_material material = czm_getDefaultMaterial(materialInput);
    material.diffuse = color.rgb;
    material.alpha = color.a;

    out_FragColor = czm_phong(normalize(-eyeCoordinate.xyz), material, czm_lightDirectionEC);
#endif // FLAT

    // Premultiply alpha. Required for classification primitives on translucent globe.
    out_FragColor.rgb *= out_FragColor.a;

#else // PER_INSTANCE_COLOR

    // Material support.
    // USES_ is distinct from REQUIRES_, because some things are dependencies of each other or
    // dependencies for culling but might not actually be used by the material.

    czm_materialInput materialInput;

#ifdef USES_NORMAL_EC
    materialInput.normalEC = normalEC;
#endif

#ifdef USES_POSITION_TO_EYE_EC
    materialInput.positionToEyeEC = -eyeCoordinate.xyz;
#endif

#ifdef USES_TANGENT_TO_EYE
    materialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(worldCoordinate, normalEC);
#endif

#ifdef USES_ST
    // Remap texture coordinates from computed (approximately aligned with cartographic space) to the desired
    // texture coordinate system, which typically forms a tight oriented bounding box around the geometry.
    // Shader is provided a set of reference points for remapping.
    materialInput.st.x = czm_lineDistance(v_uvMinAndSphericalLongitudeRotation.xy, v_uMaxAndInverseDistance.xy, uv) * v_uMaxAndInverseDistance.z;
    materialInput.st.y = czm_lineDistance(v_uvMinAndSphericalLongitudeRotation.xy, v_vMaxAndInverseDistance.xy, uv) * v_vMaxAndInverseDistance.z;
#endif

    czm_material material = czm_getMaterial(materialInput);

#ifdef FLAT
    out_FragColor = vec4(material.diffuse + material.emission, material.alpha);
#else // FLAT
    out_FragColor = czm_phong(normalize(-eyeCoordinate.xyz), material, czm_lightDirectionEC);
#endif // FLAT

    // Premultiply alpha. Required for classification primitives on translucent globe.
    out_FragColor.rgb *= out_FragColor.a;

#endif // PER_INSTANCE_COLOR
    czm_writeDepthClamp();
#endif // PICK
}
`;function ke(e,t,i){Q.typeOf.bool("extentsCulling",e),Q.typeOf.bool("planarExtents",t),Q.typeOf.object("appearance",i),this._projectionExtentDefines={eastMostYhighDefine:"",eastMostYlowDefine:"",westMostYhighDefine:"",westMostYlowDefine:""};const n=new rs;n.requiresTextureCoordinates=e,n.requiresEC=!i.flat;const o=new rs;if(o.requiresTextureCoordinates=e,i instanceof ri)n.requiresNormalEC=!i.flat;else{const s=`${i.material.shaderSource}
${i.fragmentShaderSource}`;n.normalEC=s.indexOf("materialInput.normalEC")!==-1||s.indexOf("czm_getDefaultMaterial")!==-1,n.positionToEyeEC=s.indexOf("materialInput.positionToEyeEC")!==-1,n.tangentToEyeMatrix=s.indexOf("materialInput.tangentToEyeMatrix")!==-1,n.st=s.indexOf("materialInput.st")!==-1}this._colorShaderDependencies=n,this._pickShaderDependencies=o,this._appearance=i,this._extentsCulling=e,this._planarExtents=t}ke.prototype.createFragmentShader=function(e){Q.typeOf.bool("columbusView2D",e);const t=this._appearance,i=this._colorShaderDependencies,n=[];!e&&!this._planarExtents&&n.push("SPHERICAL"),i.requiresEC&&n.push("REQUIRES_EC"),i.requiresWC&&n.push("REQUIRES_WC"),i.requiresTextureCoordinates&&n.push("TEXTURE_COORDINATES"),this._extentsCulling&&n.push("CULL_FRAGMENTS"),i.requiresNormalEC&&n.push("NORMAL_EC"),t instanceof ri&&n.push("PER_INSTANCE_COLOR"),i.normalEC&&n.push("USES_NORMAL_EC"),i.positionToEyeEC&&n.push("USES_POSITION_TO_EYE_EC"),i.tangentToEyeMatrix&&n.push("USES_TANGENT_TO_EYE"),i.st&&n.push("USES_ST"),t.flat&&n.push("FLAT");let o="";return t instanceof ri||(o=t.material.shaderSource),new dt({defines:n,sources:[o,Ga]})};ke.prototype.createPickFragmentShader=function(e){Q.typeOf.bool("columbusView2D",e);const t=this._pickShaderDependencies,i=["PICK"];return!e&&!this._planarExtents&&i.push("SPHERICAL"),t.requiresEC&&i.push("REQUIRES_EC"),t.requiresWC&&i.push("REQUIRES_WC"),t.requiresTextureCoordinates&&i.push("TEXTURE_COORDINATES"),this._extentsCulling&&i.push("CULL_FRAGMENTS"),new dt({defines:i,sources:[Ga],pickColorQualifier:"in"})};ke.prototype.createVertexShader=function(e,t,i,n){return Q.defined("defines",e),Q.typeOf.string("vertexShaderSource",t),Q.typeOf.bool("columbusView2D",i),Q.defined("mapProjection",n),Ya(this._colorShaderDependencies,this._planarExtents,i,e,t,this._appearance,n,this._projectionExtentDefines)};ke.prototype.createPickVertexShader=function(e,t,i,n){return Q.defined("defines",e),Q.typeOf.string("vertexShaderSource",t),Q.typeOf.bool("columbusView2D",i),Q.defined("mapProjection",n),Ya(this._pickShaderDependencies,this._planarExtents,i,e,t,void 0,n,this._projectionExtentDefines)};const js=new b,Xs=new ae,Zs={high:0,low:0};function Ya(e,t,i,n,o,s,r,l){const a=n.slice();if(l.eastMostYhighDefine===""){const c=Xs;c.longitude=X.PI,c.latitude=0,c.height=0;const d=r.project(c,js);let g=yt.encode(d.x,Zs);l.eastMostYhighDefine=`EAST_MOST_X_HIGH ${g.high.toFixed(`${g.high}`.length+1)}`,l.eastMostYlowDefine=`EAST_MOST_X_LOW ${g.low.toFixed(`${g.low}`.length+1)}`;const m=Xs;m.longitude=-X.PI,m.latitude=0,m.height=0;const y=r.project(m,js);g=yt.encode(y.x,Zs),l.westMostYhighDefine=`WEST_MOST_X_HIGH ${g.high.toFixed(`${g.high}`.length+1)}`,l.westMostYlowDefine=`WEST_MOST_X_LOW ${g.low.toFixed(`${g.low}`.length+1)}`}return i&&(a.push(l.eastMostYhighDefine),a.push(l.eastMostYlowDefine),a.push(l.westMostYhighDefine),a.push(l.westMostYlowDefine)),u(s)&&s instanceof ri&&a.push("PER_INSTANCE_COLOR"),e.requiresTextureCoordinates&&(a.push("TEXTURE_COORDINATES"),t||i||a.push("SPHERICAL"),i&&a.push("COLUMBUS_VIEW_2D")),new dt({defines:a,sources:[o]})}function rs(){this._requiresEC=!1,this._requiresWC=!1,this._requiresNormalEC=!1,this._requiresTextureCoordinates=!1,this._usesNormalEC=!1,this._usesPositionToEyeEC=!1,this._usesTangentToEyeMat=!1,this._usesSt=!1}Object.defineProperties(rs.prototype,{requiresEC:{get:function(){return this._requiresEC},set:function(e){this._requiresEC=e||this._requiresEC}},requiresWC:{get:function(){return this._requiresWC},set:function(e){this._requiresWC=e||this._requiresWC,this.requiresEC=this._requiresWC}},requiresNormalEC:{get:function(){return this._requiresNormalEC},set:function(e){this._requiresNormalEC=e||this._requiresNormalEC,this.requiresEC=this._requiresNormalEC}},requiresTextureCoordinates:{get:function(){return this._requiresTextureCoordinates},set:function(e){this._requiresTextureCoordinates=e||this._requiresTextureCoordinates,this.requiresWC=this._requiresTextureCoordinates}},normalEC:{set:function(e){this.requiresNormalEC=e,this._usesNormalEC=e},get:function(){return this._usesNormalEC}},tangentToEyeMatrix:{set:function(e){this.requiresWC=e,this.requiresNormalEC=e,this._usesTangentToEyeMat=e},get:function(){return this._usesTangentToEyeMat}},positionToEyeEC:{set:function(e){this.requiresEC=e,this._usesPositionToEyeEC=e},get:function(){return this._usesPositionToEyeEC}},st:{set:function(e){this.requiresTextureCoordinates=e,this._usesSt=e},get:function(){return this._usesSt}}});function Ks(e,t,i){return Math.abs((t.y-e.y)*i.x-(t.x-e.x)*i.y+t.x*e.y-t.y*e.x)/Y.distance(t,e)}const Fc=[new Y,new Y,new Y,new Y];function ja(e,t){const i=Fc,n=Y.unpack(t,0,i[0]),o=Y.unpack(t,2,i[1]),s=Y.unpack(t,4,i[2]);e.uMaxVmax=new Ot({componentDatatype:tt.FLOAT,componentsPerAttribute:4,normalize:!1,value:[o.x,o.y,s.x,s.y]});const r=1/Ks(n,o,s),l=1/Ks(n,s,o);e.uvMinAndExtents=new Ot({componentDatatype:tt.FLOAT,componentsPerAttribute:4,normalize:!1,value:[n.x,n.y,r,l]})}const Xa=new ae,Za=new b,zc=new b,Bc=new b,Un={high:0,low:0};function Ka(e,t,i){const n=Xa;n.height=0,n.longitude=e.west,n.latitude=e.south;const o=t.project(n,Za);n.latitude=e.north;const s=t.project(n,zc);n.longitude=e.east,n.latitude=e.south;const r=t.project(n,Bc),l=[0,0,0,0],a=[0,0,0,0];let c=yt.encode(o.x,Un);l[0]=c.high,a[0]=c.low,c=yt.encode(o.y,Un),l[1]=c.high,a[1]=c.low,c=yt.encode(s.y,Un),l[2]=c.high,a[2]=c.low,c=yt.encode(r.x,Un),l[3]=c.high,a[3]=c.low,i.planes2D_HIGH=new Ot({componentDatatype:tt.FLOAT,componentsPerAttribute:4,normalize:!1,value:l}),i.planes2D_LOW=new Ot({componentDatatype:tt.FLOAT,componentsPerAttribute:4,normalize:!1,value:a})}const Uc=new qt,Vc=new qt,$s=new b,Hc=new ae,Wc=[new ae,new ae,new ae,new ae,new ae,new ae,new ae,new ae];function qc(e,t,i,n,o,s){const r=Lt.center(e,Hc);r.height=i;const l=ae.toCartesian(r,t,$s),a=un.eastNorthUpToFixedFrame(l,t,Uc),c=qt.inverse(a,Vc),d=e.west,g=e.east,m=e.north,y=e.south,w=Wc;w[0].latitude=y,w[0].longitude=d,w[1].latitude=m,w[1].longitude=d,w[2].latitude=m,w[2].longitude=g,w[3].latitude=y,w[3].longitude=g;const p=(d+g)*.5,f=(m+y)*.5;w[4].latitude=y,w[4].longitude=p,w[5].latitude=m,w[5].longitude=p,w[6].latitude=f,w[6].longitude=d,w[7].latitude=f,w[7].longitude=g;let _=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,S=Number.POSITIVE_INFINITY,I=Number.NEGATIVE_INFINITY;for(let v=0;v<8;v++){w[v].height=i;const A=ae.toCartesian(w[v],t,$s);qt.multiplyByPoint(c,A,A),A.z=0,_=Math.min(_,A.x),x=Math.max(x,A.x),S=Math.min(S,A.y),I=Math.max(I,A.y)}const D=n;D.x=_,D.y=S,D.z=0,qt.multiplyByPoint(a,D,D);const E=o;E.x=x,E.y=S,E.z=0,qt.multiplyByPoint(a,E,E),b.subtract(E,D,o);const T=s;T.x=_,T.y=I,T.z=0,qt.multiplyByPoint(a,T,T),b.subtract(T,D,s)}const Gc=new b,Yc=new b,jc=new yt;ke.getPlanarTextureCoordinateAttributes=function(e,t,i,n,o){Q.typeOf.object("boundingRectangle",e),Q.defined("textureCoordinateRotationPoints",t),Q.typeOf.object("ellipsoid",i),Q.typeOf.object("projection",n);const s=Za,r=Gc,l=Yc;qc(e,i,h(o,0),s,r,l);const a={};ja(a,t);const c=yt.fromCartesian(s,jc);return a.southWest_HIGH=new Ot({componentDatatype:tt.FLOAT,componentsPerAttribute:3,normalize:!1,value:b.pack(c.high,[0,0,0])}),a.southWest_LOW=new Ot({componentDatatype:tt.FLOAT,componentsPerAttribute:3,normalize:!1,value:b.pack(c.low,[0,0,0])}),a.eastward=new Ot({componentDatatype:tt.FLOAT,componentsPerAttribute:3,normalize:!1,value:b.pack(r,[0,0,0])}),a.northward=new Ot({componentDatatype:tt.FLOAT,componentsPerAttribute:3,normalize:!1,value:b.pack(l,[0,0,0])}),Ka(e,n,a),a};const Xc=new b;function Js(e,t,i,n){const o=Xa;o.latitude=e,o.longitude=t,o.height=0;const s=ae.toCartesian(o,i,Xc),r=Math.sqrt(s.x*s.x+s.y*s.y),l=X.fastApproximateAtan2(r,s.z),a=X.fastApproximateAtan2(s.x,s.y);return n.x=l,n.y=a,n}const Qs=new Y;ke.getSphericalExtentGeometryInstanceAttributes=function(e,t,i,n){Q.typeOf.object("boundingRectangle",e),Q.defined("textureCoordinateRotationPoints",t),Q.typeOf.object("ellipsoid",i),Q.typeOf.object("projection",n);const o=Js(e.south,e.west,i,Qs);let s=o.x,r=o.y;const l=Js(e.north,e.east,i,Qs);let a=l.x,c=l.y,d=0;r>c&&(d=X.PI-r,r=-X.PI,c+=d),s-=X.EPSILON5,r-=X.EPSILON5,a+=X.EPSILON5,c+=X.EPSILON5;const g=1/(c-r),m=1/(a-s),y={sphericalExtents:new Ot({componentDatatype:tt.FLOAT,componentsPerAttribute:4,normalize:!1,value:[s,r,m,g]}),longitudeRotation:new Ot({componentDatatype:tt.FLOAT,componentsPerAttribute:1,normalize:!1,value:[d]})};return ja(y,t),Ka(e,n,y),y};ke.hasAttributesForTextureCoordinatePlanes=function(e){return u(e.southWest_HIGH)&&u(e.southWest_LOW)&&u(e.northward)&&u(e.eastward)&&u(e.planes2D_HIGH)&&u(e.planes2D_LOW)&&u(e.uMaxVmax)&&u(e.uvMinAndExtents)};ke.hasAttributesForSphericalExtents=function(e){return u(e.sphericalExtents)&&u(e.longitudeRotation)&&u(e.planes2D_HIGH)&&u(e.planes2D_LOW)&&u(e.uMaxVmax)&&u(e.uvMinAndExtents)};function Zc(e){return Math.max(e.width,e.height)>ke.MAX_WIDTH_FOR_PLANAR_EXTENTS}ke.shouldUseSphericalCoordinates=function(e){return Q.typeOf.object("rectangle",e),Zc(e)};ke.MAX_WIDTH_FOR_PLANAR_EXTENTS=X.toRadians(1);function _i(e){e=h(e,h.EMPTY_OBJECT);const t=e.geometryInstances;this.geometryInstances=t,this.show=h(e.show,!0),this.classificationType=h(e.classificationType,Zt.BOTH),this.debugShowBoundingVolume=h(e.debugShowBoundingVolume,!1),this.debugShowShadowVolume=h(e.debugShowShadowVolume,!1),this._debugShowShadowVolume=!1,this._extruded=h(e._extruded,!1),this._uniformMap=e._uniformMap,this._sp=void 0,this._spStencil=void 0,this._spPick=void 0,this._spColor=void 0,this._spPick2D=void 0,this._spColor2D=void 0,this._rsStencilDepthPass=void 0,this._rsStencilDepthPass3DTiles=void 0,this._rsColorPass=void 0,this._rsPickPass=void 0,this._commandsIgnoreShow=[],this._ready=!1,this._primitive=void 0,this._pickPrimitive=e._pickPrimitive,this._hasSphericalExtentsAttribute=!1,this._hasPlanarExtentsAttributes=!1,this._hasPerColorAttribute=!1,this.appearance=e.appearance,this._createBoundingVolumeFunction=e._createBoundingVolumeFunction,this._updateAndQueueCommandsFunction=e._updateAndQueueCommandsFunction,this._usePickOffsets=!1,this._primitiveOptions={geometryInstances:void 0,appearance:void 0,vertexCacheOptimize:h(e.vertexCacheOptimize,!1),interleave:h(e.interleave,!1),releaseGeometryInstances:h(e.releaseGeometryInstances,!0),allowPicking:h(e.allowPicking,!0),asynchronous:h(e.asynchronous,!0),compressVertices:h(e.compressVertices,!0),_createBoundingVolumeFunction:void 0,_createRenderStatesFunction:void 0,_createShaderProgramFunction:void 0,_createCommandsFunction:void 0,_updateAndQueueCommandsFunction:void 0,_createPickOffsets:!0}}Object.defineProperties(_i.prototype,{vertexCacheOptimize:{get:function(){return this._primitiveOptions.vertexCacheOptimize}},interleave:{get:function(){return this._primitiveOptions.interleave}},releaseGeometryInstances:{get:function(){return this._primitiveOptions.releaseGeometryInstances}},allowPicking:{get:function(){return this._primitiveOptions.allowPicking}},asynchronous:{get:function(){return this._primitiveOptions.asynchronous}},compressVertices:{get:function(){return this._primitiveOptions.compressVertices}},ready:{get:function(){return this._ready}},_needs2DShader:{get:function(){return this._hasPlanarExtentsAttributes||this._hasSphericalExtentsAttribute}}});_i.isSupported=function(e){return e.context.stencilBuffer};function Gi(e,t){const i=t?ai.EQUAL:ai.ALWAYS;return{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},stencilTest:{enabled:e,frontFunction:i,frontOperation:{fail:ge.KEEP,zFail:ge.DECREMENT_WRAP,zPass:ge.KEEP},backFunction:i,backOperation:{fail:ge.KEEP,zFail:ge.INCREMENT_WRAP,zPass:ge.KEEP},reference:Yt.CESIUM_3D_TILE_MASK,mask:Yt.CESIUM_3D_TILE_MASK},stencilMask:Yt.CLASSIFICATION_MASK,depthTest:{enabled:!0,func:mc.LESS_OR_EQUAL},depthMask:!1}}function as(e){return{stencilTest:{enabled:e,frontFunction:ai.NOT_EQUAL,frontOperation:{fail:ge.ZERO,zFail:ge.ZERO,zPass:ge.ZERO},backFunction:ai.NOT_EQUAL,backOperation:{fail:ge.ZERO,zFail:ge.ZERO,zPass:ge.ZERO},reference:0,mask:Yt.CLASSIFICATION_MASK},stencilMask:Yt.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1,blending:Ds.PRE_MULTIPLIED_ALPHA_BLEND}}const Kc={stencilTest:{enabled:!0,frontFunction:ai.NOT_EQUAL,frontOperation:{fail:ge.ZERO,zFail:ge.ZERO,zPass:ge.ZERO},backFunction:ai.NOT_EQUAL,backOperation:{fail:ge.ZERO,zFail:ge.ZERO,zPass:ge.ZERO},reference:0,mask:Yt.CLASSIFICATION_MASK},stencilMask:Yt.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1};function $c(e,t,i,n){if(u(e._rsStencilDepthPass))return;const o=!e.debugShowShadowVolume;e._rsStencilDepthPass=mt.fromCache(Gi(o,!1)),e._rsStencilDepthPass3DTiles=mt.fromCache(Gi(o,!0)),e._rsColorPass=mt.fromCache(as(o)),e._rsPickPass=mt.fromCache(Kc)}function Jc(e,t){if(!e.compressVertices)return t;if(t.search(/in\s+vec3\s+extrudeDirection;/g)!==-1){const i="compressedAttributes",n=`in vec2 ${i};`,o=`vec3 extrudeDirection;
`,s=`    extrudeDirection = czm_octDecode(${i}, 65535.0);
`;let r=t;r=r.replace(/in\s+vec3\s+extrudeDirection;/g,""),r=dt.replaceMain(r,"czm_non_compressed_main");const l=`void main() 
{ 
${s}    czm_non_compressed_main(); 
}`;return[n,o,r,l].join(`
`)}}function Qc(e,t){const i=t.context,n=e._primitive;let o=kc;o=e._primitive._batchTable.getVertexShaderCallback()(o),o=ze._appendDistanceDisplayConditionToShader(n,o),o=ze._modifyShaderPosition(e,o,t.scene3DOnly),o=ze._updateColorAttribute(n,o);const s=e._hasPlanarExtentsAttributes,r=s||e._hasSphericalExtentsAttribute;e._extruded&&(o=Jc(n,o));const l=e._extruded?"EXTRUDED_GEOMETRY":"";let a=new dt({defines:[l],sources:[o]});const c=new dt({sources:[gc]}),d=e._primitive._attributeLocations,g=new ke(r,s,e.appearance);if(e._spStencil=Hi.replaceCache({context:i,shaderProgram:e._spStencil,vertexShaderSource:a,fragmentShaderSource:c,attributeLocations:d}),e._primitive.allowPicking){let w=dt.createPickVertexShaderSource(o);w=ze._appendShowToShader(n,w),w=ze._updatePickColorAttribute(w);const p=g.createPickFragmentShader(!1),f=g.createPickVertexShader([l],w,!1,t.mapProjection);if(e._spPick=Hi.replaceCache({context:i,shaderProgram:e._spPick,vertexShaderSource:f,fragmentShaderSource:p,attributeLocations:d}),r){let _=i.shaderCache.getDerivedShaderProgram(e._spPick,"2dPick");if(!u(_)){const x=g.createPickFragmentShader(!0),S=g.createPickVertexShader([l],w,!0,t.mapProjection);_=i.shaderCache.createDerivedShaderProgram(e._spPick,"2dPick",{vertexShaderSource:S,fragmentShaderSource:x,attributeLocations:d})}e._spPick2D=_}}else e._spPick=Hi.fromCache({context:i,vertexShaderSource:a,fragmentShaderSource:c,attributeLocations:d});o=ze._appendShowToShader(n,o),a=new dt({defines:[l],sources:[o]}),e._sp=Hi.replaceCache({context:i,shaderProgram:e._sp,vertexShaderSource:a,fragmentShaderSource:c,attributeLocations:d});const m=g.createFragmentShader(!1),y=g.createVertexShader([l],o,!1,t.mapProjection);if(e._spColor=Hi.replaceCache({context:i,shaderProgram:e._spColor,vertexShaderSource:y,fragmentShaderSource:m,attributeLocations:d}),r){let w=i.shaderCache.getDerivedShaderProgram(e._spColor,"2dColor");if(!u(w)){const p=g.createFragmentShader(!0),f=g.createVertexShader([l],o,!0,t.mapProjection);w=i.shaderCache.createDerivedShaderProgram(e._spColor,"2dColor",{vertexShaderSource:f,fragmentShaderSource:p,attributeLocations:d})}e._spColor2D=w}}function ed(e,t){const i=e._primitive;let n=i._va.length*2;t.length=n;let o,s,r,l=0,a=i._batchTable.getUniformMapCallback()(e._uniformMap);const c=e._needs2DShader;for(o=0;o<n;o+=2){const y=i._va[l++];s=t[o],u(s)||(s=t[o]=new Oe({owner:e,primitiveType:i._primitiveType})),s.vertexArray=y,s.renderState=e._rsStencilDepthPass,s.shaderProgram=e._sp,s.uniformMap=a,s.pass=At.TERRAIN_CLASSIFICATION,r=Oe.shallowClone(s,s.derivedCommands.tileset),r.renderState=e._rsStencilDepthPass3DTiles,r.pass=At.CESIUM_3D_TILE_CLASSIFICATION,s.derivedCommands.tileset=r,s=t[o+1],u(s)||(s=t[o+1]=new Oe({owner:e,primitiveType:i._primitiveType})),s.vertexArray=y,s.renderState=e._rsColorPass,s.shaderProgram=e._spColor,s.pass=At.TERRAIN_CLASSIFICATION;const p=e.appearance.material;if(u(p)&&(a=yc(a,p._uniforms)),s.uniformMap=a,r=Oe.shallowClone(s,s.derivedCommands.tileset),r.pass=At.CESIUM_3D_TILE_CLASSIFICATION,s.derivedCommands.tileset=r,c){let f=Oe.shallowClone(s,s.derivedCommands.appearance2D);f.shaderProgram=e._spColor2D,s.derivedCommands.appearance2D=f,f=Oe.shallowClone(r,r.derivedCommands.appearance2D),f.shaderProgram=e._spColor2D,r.derivedCommands.appearance2D=f}}const d=e._commandsIgnoreShow,g=e._spStencil;let m=0;n=d.length=n/2;for(let y=0;y<n;++y){const w=d[y]=Oe.shallowClone(t[m],d[y]);w.shaderProgram=g,w.pass=At.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW,m+=2}}function td(e,t){const i=e._usePickOffsets,n=e._primitive;let o=n._va.length*2,s,r=0,l;i&&(s=n._pickOffsets,o=s.length*2),t.length=o;let a,c,d,g=0;const m=n._batchTable.getUniformMapCallback()(e._uniformMap),y=e._needs2DShader;for(a=0;a<o;a+=2){let w=n._va[g++];if(i&&(l=s[r++],w=n._va[l.index]),c=t[a],u(c)||(c=t[a]=new Oe({owner:e,primitiveType:n._primitiveType,pickOnly:!0})),c.vertexArray=w,c.renderState=e._rsStencilDepthPass,c.shaderProgram=e._sp,c.uniformMap=m,c.pass=At.TERRAIN_CLASSIFICATION,i&&(c.offset=l.offset,c.count=l.count),d=Oe.shallowClone(c,c.derivedCommands.tileset),d.renderState=e._rsStencilDepthPass3DTiles,d.pass=At.CESIUM_3D_TILE_CLASSIFICATION,c.derivedCommands.tileset=d,c=t[a+1],u(c)||(c=t[a+1]=new Oe({owner:e,primitiveType:n._primitiveType,pickOnly:!0})),c.vertexArray=w,c.renderState=e._rsPickPass,c.shaderProgram=e._spPick,c.uniformMap=m,c.pass=At.TERRAIN_CLASSIFICATION,i&&(c.offset=l.offset,c.count=l.count),d=Oe.shallowClone(c,c.derivedCommands.tileset),d.pass=At.CESIUM_3D_TILE_CLASSIFICATION,c.derivedCommands.tileset=d,y){let p=Oe.shallowClone(c,c.derivedCommands.pick2D);p.shaderProgram=e._spPick2D,c.derivedCommands.pick2D=p,p=Oe.shallowClone(d,d.derivedCommands.pick2D),p.shaderProgram=e._spPick2D,d.derivedCommands.pick2D=p}}}function id(e,t,i,n,o,s,r){ed(e,s),td(e,r)}function er(e,t){return Math.floor(e%t/2)}function Do(e,t,i,n,o,s){e.modelMatrix=i,e.boundingVolume=o,e.cull=n,e.debugShowBoundingVolume=s,t.commandList.push(e)}function tr(e,t,i,n,o){e.modelMatrix=i,e.boundingVolume=o,e.cull=n,t.commandList.push(e)}function nd(e,t,i,n,o,s,r,l){const a=e._primitive;ze._updateBoundingVolumes(a,t,o);let c;t.mode===wt.SCENE3D?c=a._boundingSphereWC:t.mode===wt.COLUMBUS_VIEW?c=a._boundingSphereCV:t.mode===wt.SCENE2D&&u(a._boundingSphere2D)?c=a._boundingSphere2D:u(a._boundingSphereMorph)&&(c=a._boundingSphereMorph);const d=e.classificationType,g=d!==Zt.CESIUM_3D_TILE,m=d!==Zt.TERRAIN,y=t.passes;let w,p,f;if(y.render){const _=i.length;for(w=0;w<_;++w)p=c[er(w,_)],g&&(f=i[w],Do(f,t,o,s,p,r)),m&&(f=i[w].derivedCommands.tileset,Do(f,t,o,s,p,r));if(t.invertClassification){const x=e._commandsIgnoreShow,S=x.length;for(w=0;w<S;++w)p=c[w],f=x[w],Do(f,t,o,s,p,r)}}if(y.pick){const _=n.length,x=a._pickOffsets;for(w=0;w<_;++w){const S=x[er(w,_)];p=c[S.index],g&&(f=n[w],tr(f,t,o,s,p)),m&&(f=n[w].derivedCommands.tileset,tr(f,t,o,s,p))}}}_i.prototype.update=function(e){if(!u(this._primitive)&&!u(this.geometryInstances))return;let t=this.appearance;u(t)&&u(t.material)&&t.material.update(e.context);const i=this,n=this._primitiveOptions;if(!u(this._primitive)){const o=Array.isArray(this.geometryInstances)?this.geometryInstances:[this.geometryInstances],s=o.length;let r,l,a,c=!1,d=!0,g,m=!1,y=!1;for(s>0&&(a=o[0].attributes,m=ke.hasAttributesForSphericalExtents(a),y=ke.hasAttributesForTextureCoordinatePlanes(a),g=a.color),r=0;r<s;r++){l=o[r];const p=l.attributes.color;if(u(p))c=!0;else if(c)throw new N("All GeometryInstances must have color attributes to use per-instance color.");d=d&&u(p)&&_c.equals(g,p)}if(!d&&!m&&!y)throw new N("All GeometryInstances must have the same color attribute except via GroundPrimitives");if(c&&!u(t)&&(t=new ri({flat:!0}),this.appearance=t),!c&&t instanceof ri)throw new N("PerInstanceColorAppearance requires color GeometryInstanceAttributes on all GeometryInstances");if(u(t.material)&&!m&&!y)throw new N("Materials on ClassificationPrimitives are not supported except via GroundPrimitives");this._usePickOffsets=!m&&!y,this._hasSphericalExtentsAttribute=m,this._hasPlanarExtentsAttributes=y,this._hasPerColorAttribute=c;const w=new Array(s);for(r=0;r<s;++r)l=o[r],w[r]=new so({geometry:l.geometry,attributes:l.attributes,modelMatrix:l.modelMatrix,id:l.id,pickPrimitive:h(this._pickPrimitive,i)});n.appearance=t,n.geometryInstances=w,u(this._createBoundingVolumeFunction)&&(n._createBoundingVolumeFunction=function(p,f){i._createBoundingVolumeFunction(p,f)}),n._createRenderStatesFunction=function(p,f,_,x){$c(i)},n._createShaderProgramFunction=function(p,f,_){Qc(i,f)},n._createCommandsFunction=function(p,f,_,x,S,I,D){id(i,void 0,void 0,!0,!1,I,D)},u(this._updateAndQueueCommandsFunction)?n._updateAndQueueCommandsFunction=function(p,f,_,x,S,I,D,E){i._updateAndQueueCommandsFunction(p,f,_,x,S,I,D,E)}:n._updateAndQueueCommandsFunction=function(p,f,_,x,S,I,D,E){nd(i,f,_,x,S,I,D)},this._primitive=new ze(n)}if(this.debugShowShadowVolume&&!this._debugShowShadowVolume&&this._ready?(this._debugShowShadowVolume=!0,this._rsStencilDepthPass=mt.fromCache(Gi(!1,!1)),this._rsStencilDepthPass3DTiles=mt.fromCache(Gi(!1,!0)),this._rsColorPass=mt.fromCache(as(!1))):!this.debugShowShadowVolume&&this._debugShowShadowVolume&&(this._debugShowShadowVolume=!1,this._rsStencilDepthPass=mt.fromCache(Gi(!0,!1)),this._rsStencilDepthPass3DTiles=mt.fromCache(Gi(!0,!0)),this._rsColorPass=mt.fromCache(as(!0))),this._primitive.appearance!==t){if(!this._hasSphericalExtentsAttribute&&!this._hasPlanarExtentsAttributes&&u(t.material))throw new N("Materials on ClassificationPrimitives are not supported except via GroundPrimitive");if(!this._hasPerColorAttribute&&t instanceof ri)throw new N("PerInstanceColorAppearance requires color GeometryInstanceAttribute");this._primitive.appearance=t}this._primitive.show=this.show,this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume,this._primitive.update(e),e.afterRender.push(()=>{u(this._primitive)&&this._primitive.ready&&(this._ready=!0,this.releaseGeometryInstances&&(this.geometryInstances=void 0))})};_i.prototype.getGeometryInstanceAttributes=function(e){if(!u(this._primitive))throw new N("must call update before calling getGeometryInstanceAttributes");return this._primitive.getGeometryInstanceAttributes(e)};_i.prototype.isDestroyed=function(){return!1};_i.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),this._sp=this._sp&&this._sp.destroy(),this._spPick=this._spPick&&this._spPick.destroy(),this._spColor=this._spColor&&this._spColor.destroy(),this._spPick2D=void 0,this._spColor2D=void 0,uo(this)};const od={u_globeMinimumAltitude:function(){return 55e3}};function it(e){e=h(e,h.EMPTY_OBJECT);let t=e.appearance;const i=e.geometryInstances;if(!u(t)&&u(i)){const o=Array.isArray(i)?i:[i],s=o.length;for(let r=0;r<s;r++){const l=o[r].attributes;if(u(l)&&u(l.color)){t=new ri({flat:!0});break}}}this.appearance=t,this.geometryInstances=e.geometryInstances,this.show=h(e.show,!0),this.classificationType=h(e.classificationType,Zt.BOTH),this.debugShowBoundingVolume=h(e.debugShowBoundingVolume,!1),this.debugShowShadowVolume=h(e.debugShowShadowVolume,!1),this._boundingVolumes=[],this._boundingVolumes2D=[],this._ready=!1,this._primitive=void 0,this._maxHeight=void 0,this._minHeight=void 0,this._maxTerrainHeight=zt._defaultMaxTerrainHeight,this._minTerrainHeight=zt._defaultMinTerrainHeight,this._boundingSpheresKeys=[],this._boundingSpheres=[],this._useFragmentCulling=!1,this._zIndex=void 0;const n=this;this._classificationPrimitiveOptions={geometryInstances:void 0,appearance:void 0,vertexCacheOptimize:h(e.vertexCacheOptimize,!1),interleave:h(e.interleave,!1),releaseGeometryInstances:h(e.releaseGeometryInstances,!0),allowPicking:h(e.allowPicking,!0),asynchronous:h(e.asynchronous,!0),compressVertices:h(e.compressVertices,!0),_createBoundingVolumeFunction:void 0,_updateAndQueueCommandsFunction:void 0,_pickPrimitive:n,_extruded:!0,_uniformMap:od}}Object.defineProperties(it.prototype,{vertexCacheOptimize:{get:function(){return this._classificationPrimitiveOptions.vertexCacheOptimize}},interleave:{get:function(){return this._classificationPrimitiveOptions.interleave}},releaseGeometryInstances:{get:function(){return this._classificationPrimitiveOptions.releaseGeometryInstances}},allowPicking:{get:function(){return this._classificationPrimitiveOptions.allowPicking}},asynchronous:{get:function(){return this._classificationPrimitiveOptions.asynchronous}},compressVertices:{get:function(){return this._classificationPrimitiveOptions.compressVertices}},ready:{get:function(){return this._ready}}});it.isSupported=_i.isSupported;function ir(e){return function(t,i){const n=i.maximumRadius,o=n/Math.cos(t*.5)-n;return e._maxHeight+o}}function nr(e){return function(t,i){return e._minHeight}}const sd=new b,rd=new b,ad=new b,ld=new ae,cd=new Lt;function eo(e,t){const i=e.mapProjection.ellipsoid;if(!u(t.attributes)||!u(t.attributes.position3DHigh))return u(t.rectangle)?t.rectangle:void 0;const n=t.attributes.position3DHigh.values,o=t.attributes.position3DLow.values,s=n.length;let r=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;for(let g=0;g<s;g+=3){const m=b.unpack(n,g,sd),y=b.unpack(o,g,rd),w=b.add(m,y,ad),p=i.cartesianToCartographic(w,ld),f=p.latitude,_=p.longitude;r=Math.min(r,f),l=Math.min(l,_),a=Math.max(a,f),c=Math.max(c,_)}const d=cd;return d.north=a,d.south=r,d.east=c,d.west=l,d}function dd(e,t,i){const n=zt.getMinimumMaximumHeights(t,i);e._minTerrainHeight=n.minimumTerrainHeight,e._maxTerrainHeight=n.maximumTerrainHeight}function hd(e,t,i){const n=t.mapProjection.ellipsoid,o=eo(t,i),s=wc.fromRectangle(o,e._minHeight,e._maxHeight,n);if(e._boundingVolumes.push(s),!t.scene3DOnly){const r=t.mapProjection,l=Xi.fromRectangleWithHeights2D(o,r,e._maxHeight,e._minHeight);b.fromElements(l.center.z,l.center.x,l.center.y,l.center),e._boundingVolumes2D.push(l)}}function To(e,t){return Math.floor(e%t/2)}function Io(e,t,i,n,o,s,r){const l=e._primitive;i.mode!==wt.SCENE3D&&t.shaderProgram===l._spColor&&l._needs2DShader&&(t=t.derivedCommands.appearance2D),t.owner=e,t.modelMatrix=n,t.boundingVolume=s,t.cull=o,t.debugShowBoundingVolume=r,i.commandList.push(t)}function or(e,t,i,n,o,s){const r=e._primitive;i.mode!==wt.SCENE3D&&t.shaderProgram===r._spPick&&r._needs2DShader&&(t=t.derivedCommands.pick2D),t.owner=e,t.modelMatrix=n,t.boundingVolume=s,t.cull=o,i.commandList.push(t)}function ud(e,t,i,n,o,s,r,l){let a;t.mode===wt.SCENE3D?a=e._boundingVolumes:a=e._boundingVolumes2D;const c=e.classificationType,d=c!==Zt.CESIUM_3D_TILE,g=c!==Zt.TERRAIN,m=t.passes,y=e._primitive;let w,p,f;if(m.render){const _=i.length;for(w=0;w<_;++w)p=a[To(w,_)],d&&(f=i[w],Io(e,f,t,o,s,p,r)),g&&(f=i[w].derivedCommands.tileset,Io(e,f,t,o,s,p,r));if(t.invertClassification){const x=y._commandsIgnoreShow,S=x.length;for(w=0;w<S;++w)p=a[w],f=x[w],Io(e,f,t,o,s,p,r)}}if(m.pick){const _=n.length;let x;for(e._useFragmentCulling||(x=y._primitive._pickOffsets),w=0;w<_;++w){if(p=a[To(w,_)],!e._useFragmentCulling){const S=x[To(w,_)];p=a[S.index]}d&&(f=n[w],or(e,f,t,o,s,p)),g&&(f=n[w].derivedCommands.tileset,or(e,f,t,o,s,p))}}}it.initializeTerrainHeights=function(){return zt.initialize()};it.prototype.update=function(e){if(!u(this._primitive)&&!u(this.geometryInstances))return;if(!zt.initialized){if(!this.asynchronous)throw new N("For synchronous GroundPrimitives, you must call GroundPrimitive.initializeTerrainHeights() and wait for the returned promise to resolve.");it.initializeTerrainHeights();return}const t=this,i=this._classificationPrimitiveOptions;if(!u(this._primitive)){const n=e.mapProjection.ellipsoid;let o,s,r;const l=Array.isArray(this.geometryInstances)?this.geometryInstances:[this.geometryInstances],a=l.length,c=new Array(a);let d,g;for(d=0;d<a;++d){o=l[d],s=o.geometry;const p=eo(e,s);u(g)?u(p)&&Lt.union(g,p,g):g=Lt.clone(p);const f=o.id;if(u(f)&&u(p)){const _=zt.getBoundingSphere(p,n);this._boundingSpheresKeys.push(f),this._boundingSpheres.push(_)}if(r=s.constructor,!u(r)||!u(r.createShadowVolume))throw new N("Not all of the geometry instances have GroundPrimitive support.")}dd(this,g,n);const m=e.verticalExaggeration,y=e.verticalExaggerationRelativeHeight;this._minHeight=Ws.getHeight(this._minTerrainHeight,m,y),this._maxHeight=Ws.getHeight(this._maxTerrainHeight,m,y);const w=it._supportsMaterials(e.context);if(this._useFragmentCulling=w,w){let p,f=!0;for(d=0;d<a;++d)if(o=l[d],s=o.geometry,g=eo(e,s),ke.shouldUseSphericalCoordinates(g)){f=!1;break}for(d=0;d<a;++d){o=l[d],s=o.geometry,r=s.constructor;const _=eo(e,s),x=s.textureCoordinateRotationPoints;f?p=ke.getPlanarTextureCoordinateAttributes(_,x,n,e.mapProjection,this._maxHeight):p=ke.getSphericalExtentGeometryInstanceAttributes(_,x,n,e.mapProjection);const S=o.attributes;for(const I in S)S.hasOwnProperty(I)&&(p[I]=S[I]);c[d]=new so({geometry:r.createShadowVolume(s,nr(this),ir(this)),attributes:p,id:o.id})}}else for(d=0;d<a;++d)o=l[d],s=o.geometry,r=s.constructor,c[d]=new so({geometry:r.createShadowVolume(s,nr(this),ir(this)),attributes:o.attributes,id:o.id});i.geometryInstances=c,i.appearance=this.appearance,i._createBoundingVolumeFunction=function(p,f){hd(t,p,f)},i._updateAndQueueCommandsFunction=function(p,f,_,x,S,I,D,E){ud(t,f,_,x,S,I,D)},this._primitive=new _i(i)}this._primitive.appearance=this.appearance,this._primitive.show=this.show,this._primitive.debugShowShadowVolume=this.debugShowShadowVolume,this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume,this._primitive.update(e),e.afterRender.push(()=>{!this._ready&&u(this._primitive)&&this._primitive.ready&&(this._ready=!0,this.releaseGeometryInstances&&(this.geometryInstances=void 0))})};it.prototype.getBoundingSphere=function(e){const t=this._boundingSpheresKeys.indexOf(e);if(t!==-1)return this._boundingSpheres[t]};it.prototype.getGeometryInstanceAttributes=function(e){if(!u(this._primitive))throw new N("must call update before calling getGeometryInstanceAttributes");return this._primitive.getGeometryInstanceAttributes(e)};it.prototype.isDestroyed=function(){return!1};it.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),uo(this)};it._supportsMaterials=function(e){return e.depthTexture};it.supportsMaterials=function(e){return Q.typeOf.object("scene",e),it._supportsMaterials(e.frameState.context)};const vs=[Sc,bc],fd=vs.length,$a=Math.cos(X.toRadians(30)),sr=Math.cos(X.toRadians(150)),Ja=0,Qa=1e3;function di(e){e=h(e,h.EMPTY_OBJECT);const t=e.positions;if(!u(t)||t.length<2)throw new N("At least two positions are required.");if(u(e.arcType)&&e.arcType!==Gt.GEODESIC&&e.arcType!==Gt.RHUMB)throw new N("Valid options for arcType are ArcType.GEODESIC and ArcType.RHUMB.");this.width=h(e.width,1),this._positions=t,this.granularity=h(e.granularity,9999),this.loop=h(e.loop,!1),this.arcType=h(e.arcType,Gt.GEODESIC),this._ellipsoid=li.default,this._projectionIndex=0,this._workerName="createGroundPolylineGeometry",this._scene3DOnly=!1}Object.defineProperties(di.prototype,{packedLength:{get:function(){return 1+this._positions.length*3+1+1+1+li.packedLength+1+1}}});di.setProjectionAndEllipsoid=function(e,t){let i=0;for(let n=0;n<fd;n++)if(t instanceof vs[n]){i=n;break}e._projectionIndex=i,e._ellipsoid=t.ellipsoid};const pd=new b,rr=new b,ar=new b;function ls(e,t,i,n,o){const s=Be(n,e,0,pd),r=Be(n,e,i,rr),l=Be(n,t,0,ar),a=Kt(r,s,rr),c=Kt(l,s,ar);return b.cross(c,a,o),b.normalize(o,o)}const _d=new ae,md=new b,gd=new b,yd=new b;function vo(e,t,i,n,o,s,r,l,a,c,d){if(o===0)return;let g;s===Gt.GEODESIC?g=new Ec(e,t,r):s===Gt.RHUMB&&(g=new za(e,t,r));const m=g.surfaceDistance;if(m<o)return;const y=ls(e,t,n,r,yd),w=Math.ceil(m/o),p=m/w;let f=p;const _=w-1;let x=l.length;for(let S=0;S<_;S++){const I=g.interpolateUsingSurfaceDistance(f,_d),D=Be(r,I,i,md),E=Be(r,I,n,gd);b.pack(y,l,x),b.pack(D,a,x),b.pack(E,c,x),d.push(I.latitude),d.push(I.longitude),x+=3,f+=p}}const Ao=new ae;function Be(e,t,i,n){return ae.clone(t,Ao),Ao.height=i,ae.toCartesian(Ao,e,n)}di.pack=function(e,t,i){Q.typeOf.object("value",e),Q.defined("array",t);let n=h(i,0);const o=e._positions,s=o.length;t[n++]=s;for(let r=0;r<s;++r){const l=o[r];b.pack(l,t,n),n+=3}return t[n++]=e.granularity,t[n++]=e.loop?1:0,t[n++]=e.arcType,li.pack(e._ellipsoid,t,n),n+=li.packedLength,t[n++]=e._projectionIndex,t[n++]=e._scene3DOnly?1:0,t};di.unpack=function(e,t,i){Q.defined("array",e);let n=h(t,0);const o=e[n++],s=new Array(o);for(let m=0;m<o;m++)s[m]=b.unpack(e,n),n+=3;const r=e[n++],l=e[n++]===1,a=e[n++],c=li.unpack(e,n);n+=li.packedLength;const d=e[n++],g=e[n++]===1;return u(i)||(i=new di({positions:s})),i._positions=s,i.granularity=r,i.loop=l,i.arcType=a,i._ellipsoid=c,i._projectionIndex=d,i._scene3DOnly=g,i};function Kt(e,t,i){return b.subtract(e,t,i),b.normalize(i,i),i}function lr(e,t,i,n){return n=Kt(e,t,n),n=b.cross(n,i,n),n=b.normalize(n,n),n=b.cross(i,n,n),n}const wd=new b,xd=new b,Cd=new b,el=new b,Sd=0,bd=-1;function Oo(e,t,i,n,o){const s=Kt(i,t,el),r=lr(e,t,s,wd),l=lr(n,t,s,xd);if(X.equalsEpsilon(b.dot(r,l),bd,X.EPSILON5))return o=b.cross(s,r,o),o=b.normalize(o,o),o;o=b.add(l,r,o),o=b.normalize(o,o);const a=b.cross(s,o,Cd);return b.dot(l,a)<Sd&&(o=b.negate(o,o)),o}const ro=ns.fromPointNormal(b.ZERO,b.UNIT_Y),Ed=new b,Dd=new b,Td=new b,Id=new b,vd=new b,Vn=new b,Hn=new ae,cr=new ae,dr=new ae;di.createGeometry=function(e){const t=!e._scene3DOnly;let i=e.loop;const n=e._ellipsoid,o=e.granularity,s=e.arcType,r=new vs[e._projectionIndex](n),l=Ja,a=Qa;let c,d;const g=e._positions,m=g.length;m===2&&(i=!1);let y,w,p,f;const _=new za(void 0,void 0,n);let x,S,I;const D=[g[0]];for(d=0;d<m-1;d++)y=g[d],w=g[d+1],x=qs.lineSegmentPlane(y,w,ro,Vn),u(x)&&!b.equalsEpsilon(x,y,X.EPSILON7)&&!b.equalsEpsilon(x,w,X.EPSILON7)&&(e.arcType===Gt.GEODESIC?D.push(b.clone(x)):e.arcType===Gt.RHUMB&&(I=n.cartesianToCartographic(x,Hn).longitude,p=n.cartesianToCartographic(y,Hn),f=n.cartesianToCartographic(w,cr),_.setEndPoints(p,f),S=_.findIntersectionWithLongitude(I,dr),x=n.cartographicToCartesian(S,Vn),u(x)&&!b.equalsEpsilon(x,y,X.EPSILON7)&&!b.equalsEpsilon(x,w,X.EPSILON7)&&D.push(b.clone(x)))),D.push(w);i&&(y=g[m-1],w=g[0],x=qs.lineSegmentPlane(y,w,ro,Vn),u(x)&&!b.equalsEpsilon(x,y,X.EPSILON7)&&!b.equalsEpsilon(x,w,X.EPSILON7)&&(e.arcType===Gt.GEODESIC?D.push(b.clone(x)):e.arcType===Gt.RHUMB&&(I=n.cartesianToCartographic(x,Hn).longitude,p=n.cartesianToCartographic(y,Hn),f=n.cartesianToCartographic(w,cr),_.setEndPoints(p,f),S=_.findIntersectionWithLongitude(I,dr),x=n.cartographicToCartesian(S,Vn),u(x)&&!b.equalsEpsilon(x,y,X.EPSILON7)&&!b.equalsEpsilon(x,w,X.EPSILON7)&&D.push(b.clone(x)))));let E=D.length,T=new Array(E);for(d=0;d<E;d++){const $=ae.fromCartesian(D[d],n);$.height=0,T[d]=$}if(T=xc(T,ae.equalsEpsilon),E=T.length,E<2)return;const v=[],A=[],R=[],P=[];let z=Ed,M=Dd,q=Td,V=Id,U=vd;const H=T[0],Z=T[1],ce=T[E-1];for(z=Be(n,ce,l,z),V=Be(n,Z,l,V),M=Be(n,H,l,M),q=Be(n,H,a,q),i?U=Oo(z,M,q,V,U):U=ls(H,Z,a,n,U),b.pack(U,A,0),b.pack(M,R,0),b.pack(q,P,0),v.push(H.latitude),v.push(H.longitude),vo(H,Z,l,a,o,s,n,A,R,P,v),d=1;d<E-1;++d){z=b.clone(M,z),M=b.clone(V,M);const $=T[d];Be(n,$,a,q),Be(n,T[d+1],l,V),Oo(z,M,q,V,U),c=A.length,b.pack(U,A,c),b.pack(M,R,c),b.pack(q,P,c),v.push($.latitude),v.push($.longitude),vo(T[d],T[d+1],l,a,o,s,n,A,R,P,v)}const G=T[E-1],we=T[E-2];if(M=Be(n,G,l,M),q=Be(n,G,a,q),i){const $=T[0];z=Be(n,we,l,z),V=Be(n,$,l,V),U=Oo(z,M,q,V,U)}else U=ls(we,G,a,n,U);if(c=A.length,b.pack(U,A,c),b.pack(M,R,c),b.pack(q,P,c),v.push(G.latitude),v.push(G.longitude),i){for(vo(G,H,l,a,o,s,n,A,R,P,v),c=A.length,d=0;d<3;++d)A[c+d]=A[d],R[c+d]=R[d],P[c+d]=P[d];v.push(H.latitude),v.push(H.longitude)}return eh(i,r,R,P,A,v,t)};const Ad=new b,Od=new Mt,Pd=new Ts;function hr(e,t,i,n){const o=Kt(i,t,Ad),s=b.dot(o,e);if(s>$a||s<sr){const r=Kt(n,i,el),l=s<sr?X.PI_OVER_TWO:-X.PI_OVER_TWO,a=Ts.fromAxisAngle(r,l,Pd),c=Mt.fromQuaternion(a,Od);return Mt.multiplyByVector(c,e,e),!0}return!1}const ur=new ae,Rd=new b,fr=new b;function dn(e,t,i,n,o){const s=ae.toCartesian(t,e._ellipsoid,Rd);let r=b.add(s,i,fr),l=!1;const a=e._ellipsoid;let c=a.cartesianToCartographic(r,ur);Math.abs(t.longitude-c.longitude)>X.PI_OVER_TWO&&(l=!0,r=b.subtract(s,i,fr),c=a.cartesianToCartographic(r,ur)),c.height=0;const d=e.project(c,o);return o=b.subtract(d,n,o),o.z=0,o=b.normalize(o,o),l&&b.negate(o,o),o}const Ld=new b,pr=new b;function _r(e,t,i,n,o,s){const r=b.subtract(t,e,Ld);b.normalize(r,r);const l=i-Ja;let a=b.multiplyByScalar(r,l,pr);b.add(e,a,o);const c=n-Qa;a=b.multiplyByScalar(r,c,pr),b.add(t,a,s)}const Nd=new b;function Wn(e,t){const i=ns.getPointDistance(ro,e),n=ns.getPointDistance(ro,t);let o=Nd;X.equalsEpsilon(i,0,X.EPSILON2)?(o=Kt(t,e,o),b.multiplyByScalar(o,X.EPSILON2,o),b.add(e,o,e)):X.equalsEpsilon(n,0,X.EPSILON2)&&(o=Kt(e,t,o),b.multiplyByScalar(o,X.EPSILON2,o),b.add(t,o,t))}function Md(e,t){const i=Math.abs(e.longitude),n=Math.abs(t.longitude);if(X.equalsEpsilon(i,X.PI,X.EPSILON11)){const o=X.sign(t.longitude);return e.longitude=o*(i-X.EPSILON11),1}else if(X.equalsEpsilon(n,X.PI,X.EPSILON11)){const o=X.sign(e.longitude);return t.longitude=o*(n-X.EPSILON11),2}return 0}const tl=new ae,il=new ae,mr=new b,Po=new b,gr=new b,yr=new b,kd=new b,wr=new b,Fd=[tl,il],zd=new Lt,Bd=new b,Ud=new b,Vd=new b,Hd=new b,Wd=new b,qd=new b,Ro=new b,Lo=new b,Gd=new b,Yd=new b,jd=new b,xr=new b,Xd=new b,Zd=new b,Kd=new yt,$d=new yt,Cr=new b,Jd=new b,Sr=new b,Qd=[new Xi,new Xi],nl=[0,2,1,0,3,2,0,7,3,0,4,7,0,5,4,0,1,5,5,7,4,5,6,7,5,2,6,5,1,2,3,6,2,3,7,6],br=nl.length;function eh(e,t,i,n,o,s,r){let l,a;const c=t._ellipsoid,d=i.length/3-1,g=d*8,m=g*4,y=d*36,w=g>65535?new Uint32Array(y):new Uint16Array(y),p=new Float64Array(g*3),f=new Float32Array(m),_=new Float32Array(m),x=new Float32Array(m),S=new Float32Array(m),I=new Float32Array(m);let D,E,T,v;r&&(D=new Float32Array(m),E=new Float32Array(m),T=new Float32Array(m),v=new Float32Array(g*2));const A=s.length/2;let R=0;const P=tl;P.height=0;const z=il;z.height=0;let M=mr,q=Po;if(r)for(a=0,l=1;l<A;l++)P.latitude=s[a],P.longitude=s[a+1],z.latitude=s[a+2],z.longitude=s[a+3],M=t.project(P,M),q=t.project(z,q),R+=b.distance(M,q),a+=2;const V=n.length/3;q=b.unpack(n,0,q);let U=0;for(a=3,l=1;l<V;l++)M=b.clone(q,M),q=b.unpack(n,a,q),U+=b.distance(M,q),a+=3;let H;a=3;let Z=0,ce=0,G=0,we=0,$=!1,ie=b.unpack(i,0,yr),be=b.unpack(n,0,Po),de=b.unpack(o,0,wr);if(e){const Ee=b.unpack(i,i.length-6,gr);hr(de,Ee,ie,be)&&(de=b.negate(de,de))}let xe=0,bt=0,ot=0;for(l=0;l<d;l++){const Ee=b.clone(ie,gr),Ge=b.clone(be,mr);let he=b.clone(de,kd);$&&(he=b.negate(he,he)),ie=b.unpack(i,a,yr),be=b.unpack(n,a,Po),de=b.unpack(o,a,wr),$=hr(de,Ee,ie,be),P.latitude=s[Z],P.longitude=s[Z+1],z.latitude=s[Z+2],z.longitude=s[Z+3];let _e,Ye,je,Pe;if(r){const Ce=Md(P,z);_e=t.project(P,Wd),Ye=t.project(z,qd);const zi=Kt(Ye,_e,Cr);zi.y=Math.abs(zi.y),je=Ro,Pe=Lo,Ce===0||b.dot(zi,b.UNIT_Y)>$a?(je=dn(t,P,he,_e,Ro),Pe=dn(t,z,de,Ye,Lo)):Ce===1?(Pe=dn(t,z,de,Ye,Lo),je.x=0,je.y=X.sign(P.longitude-Math.abs(z.longitude)),je.z=0):(je=dn(t,P,he,_e,Ro),Pe.x=0,Pe.y=X.sign(P.longitude-z.longitude),Pe.z=0)}const Vt=b.distance(Ge,be),Re=yt.fromCartesian(Ee,Kd),Ht=b.subtract(ie,Ee,Gd),Ni=b.normalize(Ht,xr);let Et=b.subtract(Ge,Ee,Yd);Et=b.normalize(Et,Et);let Wt=b.cross(Ni,Et,xr);Wt=b.normalize(Wt,Wt);let Mi=b.cross(Et,he,Xd);Mi=b.normalize(Mi,Mi);let rt=b.subtract(be,ie,jd);rt=b.normalize(rt,rt);let Jt=b.cross(de,rt,Zd);Jt=b.normalize(Jt,Jt);const So=Vt/U,zn=xe/U;let en=0,yi,ki,O,F=0,L=0;if(r){en=b.distance(_e,Ye),yi=yt.fromCartesian(_e,$d),ki=b.subtract(Ye,_e,Cr),O=b.normalize(ki,Jd);const Ce=O.x;O.x=O.y,O.y=-Ce,F=en/R,L=bt/R}for(H=0;H<8;H++){const Ce=we+H*4,zi=ce+H*2,tn=Ce+3,Hs=H<4?1:-1,Bn=H===2||H===3||H===6||H===7?1:-1;b.pack(Re.high,f,Ce),f[tn]=Ht.x,b.pack(Re.low,_,Ce),_[tn]=Ht.y,b.pack(Mi,x,Ce),x[tn]=Ht.z,b.pack(Jt,S,Ce),S[tn]=So*Hs,b.pack(Wt,I,Ce);let xi=zn*Bn;xi===0&&Bn<0&&(xi=9),I[tn]=xi,r&&(D[Ce]=yi.high.x,D[Ce+1]=yi.high.y,D[Ce+2]=yi.low.x,D[Ce+3]=yi.low.y,T[Ce]=-je.y,T[Ce+1]=je.x,T[Ce+2]=Pe.y,T[Ce+3]=-Pe.x,E[Ce]=ki.x,E[Ce+1]=ki.y,E[Ce+2]=O.x,E[Ce+3]=O.y,v[zi]=F*Hs,xi=L*Bn,xi===0&&Bn<0&&(xi=9),v[zi+1]=xi)}const k=Vd,W=Hd,K=Bd,ee=Ud,Le=Lt.fromCartographicArray(Fd,zd),Xe=zt.getMinimumMaximumHeights(Le,c),wi=Xe.minimumTerrainHeight,Fi=Xe.maximumTerrainHeight;ot+=Math.abs(wi),ot+=Math.abs(Fi),_r(Ee,Ge,wi,Fi,k,K),_r(ie,be,wi,Fi,W,ee);let pt=b.multiplyByScalar(Wt,X.EPSILON5,Sr);b.add(k,pt,k),b.add(W,pt,W),b.add(K,pt,K),b.add(ee,pt,ee),Wn(k,W),Wn(K,ee),b.pack(k,p,G),b.pack(W,p,G+3),b.pack(ee,p,G+6),b.pack(K,p,G+9),pt=b.multiplyByScalar(Wt,-2*X.EPSILON5,Sr),b.add(k,pt,k),b.add(W,pt,W),b.add(K,pt,K),b.add(ee,pt,ee),Wn(k,W),Wn(K,ee),b.pack(k,p,G+12),b.pack(W,p,G+15),b.pack(ee,p,G+18),b.pack(K,p,G+21),Z+=2,a+=3,ce+=16,G+=24,we+=32,xe+=Vt,bt+=en}a=0;let st=0;for(l=0;l<d;l++){for(H=0;H<br;H++)w[a+H]=nl[H]+st;st+=8,a+=br}const qe=Qd;Xi.fromVertices(i,b.ZERO,3,qe[0]),Xi.fromVertices(n,b.ZERO,3,qe[1]);const ft=Xi.fromBoundingSpheres(qe);ft.radius+=ot/(d*2);const Ae={position:new os({componentDatatype:tt.DOUBLE,componentsPerAttribute:3,normalize:!1,values:p}),startHiAndForwardOffsetX:Qt(f),startLoAndForwardOffsetY:Qt(_),startNormalAndForwardOffsetZ:Qt(x),endNormalAndTextureCoordinateNormalizationX:Qt(S),rightNormalAndTextureCoordinateNormalizationY:Qt(I)};return r&&(Ae.startHiLo2D=Qt(D),Ae.offsetAndRight2D=Qt(E),Ae.startEndNormals2D=Qt(T),Ae.texcoordNormalization2D=new os({componentDatatype:tt.FLOAT,componentsPerAttribute:2,normalize:!1,values:v})),new Cc({attributes:Ae,indices:w,boundingSphere:ft})}function Qt(e){return new os({componentDatatype:tt.FLOAT,componentsPerAttribute:4,normalize:!1,values:e})}di._projectNormal=dn;const th=`in vec4 v_startPlaneNormalEcAndHalfWidth;
in vec4 v_endPlaneNormalEcAndBatchId;
in vec4 v_rightPlaneEC; // Technically can compute distance for this here
in vec4 v_endEcAndStartEcX;
in vec4 v_texcoordNormalizationAndStartEcYZ;

#ifdef PER_INSTANCE_COLOR
in vec4 v_color;
#endif

void main(void)
{
    float logDepthOrDepth = czm_branchFreeTernary(czm_sceneMode == czm_sceneMode2D, gl_FragCoord.z, czm_unpackDepth(texture(czm_globeDepthTexture, gl_FragCoord.xy / czm_viewport.zw)));
    vec3 ecStart = vec3(v_endEcAndStartEcX.w, v_texcoordNormalizationAndStartEcYZ.zw);

    // Discard for sky
    if (logDepthOrDepth == 0.0) {
#ifdef DEBUG_SHOW_VOLUME
        out_FragColor = vec4(1.0, 0.0, 0.0, 0.5);
        return;
#else // DEBUG_SHOW_VOLUME
        discard;
#endif // DEBUG_SHOW_VOLUME
    }

    vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth);
    eyeCoordinate /= eyeCoordinate.w;

    float halfMaxWidth = v_startPlaneNormalEcAndHalfWidth.w * czm_metersPerPixel(eyeCoordinate);
    // Check distance of the eye coordinate against the right-facing plane
    float widthwiseDistance = czm_planeDistance(v_rightPlaneEC, eyeCoordinate.xyz);

    // Check eye coordinate against the mitering planes
    float distanceFromStart = czm_planeDistance(v_startPlaneNormalEcAndHalfWidth.xyz, -dot(ecStart, v_startPlaneNormalEcAndHalfWidth.xyz), eyeCoordinate.xyz);
    float distanceFromEnd = czm_planeDistance(v_endPlaneNormalEcAndBatchId.xyz, -dot(v_endEcAndStartEcX.xyz, v_endPlaneNormalEcAndBatchId.xyz), eyeCoordinate.xyz);

    if (abs(widthwiseDistance) > halfMaxWidth || distanceFromStart < 0.0 || distanceFromEnd < 0.0) {
#ifdef DEBUG_SHOW_VOLUME
        out_FragColor = vec4(1.0, 0.0, 0.0, 0.5);
        return;
#else // DEBUG_SHOW_VOLUME
        discard;
#endif // DEBUG_SHOW_VOLUME
    }

    // Check distance of the eye coordinate against start and end planes with normals in the right plane.
    // For computing unskewed lengthwise texture coordinate.
    // Can also be used for clipping extremely pointy miters, but in practice unnecessary because of miter breaking.

    // aligned plane: cross the right plane normal with miter plane normal, then cross the result with right again to point it more "forward"
    vec3 alignedPlaneNormal;

    // start aligned plane
    alignedPlaneNormal = cross(v_rightPlaneEC.xyz, v_startPlaneNormalEcAndHalfWidth.xyz);
    alignedPlaneNormal = normalize(cross(alignedPlaneNormal, v_rightPlaneEC.xyz));
    distanceFromStart = czm_planeDistance(alignedPlaneNormal, -dot(alignedPlaneNormal, ecStart), eyeCoordinate.xyz);

    // end aligned plane
    alignedPlaneNormal = cross(v_rightPlaneEC.xyz, v_endPlaneNormalEcAndBatchId.xyz);
    alignedPlaneNormal = normalize(cross(alignedPlaneNormal, v_rightPlaneEC.xyz));
    distanceFromEnd = czm_planeDistance(alignedPlaneNormal, -dot(alignedPlaneNormal, v_endEcAndStartEcX.xyz), eyeCoordinate.xyz);

#ifdef PER_INSTANCE_COLOR
    out_FragColor = czm_gammaCorrect(v_color);
#else // PER_INSTANCE_COLOR
    // Clamp - distance to aligned planes may be negative due to mitering,
    // so fragment texture coordinate might be out-of-bounds.
    float s = clamp(distanceFromStart / (distanceFromStart + distanceFromEnd), 0.0, 1.0);
    s = (s * v_texcoordNormalizationAndStartEcYZ.x) + v_texcoordNormalizationAndStartEcYZ.y;
    float t = (widthwiseDistance + halfMaxWidth) / (2.0 * halfMaxWidth);

    czm_materialInput materialInput;

    materialInput.s = s;
    materialInput.st = vec2(s, t);
    materialInput.str = vec3(s, t, 0.0);

    czm_material material = czm_getMaterial(materialInput);
    out_FragColor = vec4(material.diffuse + material.emission, material.alpha);
#endif // PER_INSTANCE_COLOR

    // Premultiply alpha. Required for classification primitives on translucent globe.
    out_FragColor.rgb *= out_FragColor.a;

    czm_writeDepthClamp();
}
`,ih=`in vec3 v_forwardDirectionEC;
in vec3 v_texcoordNormalizationAndHalfWidth;
in float v_batchId;

#ifdef PER_INSTANCE_COLOR
in vec4 v_color;
#else
in vec2 v_alignedPlaneDistances;
in float v_texcoordT;
#endif

float rayPlaneDistanceUnsafe(vec3 origin, vec3 direction, vec3 planeNormal, float planeDistance) {
    // We don't expect the ray to ever be parallel to the plane
    return (-planeDistance - dot(planeNormal, origin)) / dot(planeNormal, direction);
}

void main(void)
{
    vec4 eyeCoordinate = gl_FragCoord;
    eyeCoordinate /= eyeCoordinate.w;

#ifdef PER_INSTANCE_COLOR
    out_FragColor = czm_gammaCorrect(v_color);
#else // PER_INSTANCE_COLOR
    // Use distances for planes aligned with segment to prevent skew in dashing
    float distanceFromStart = rayPlaneDistanceUnsafe(eyeCoordinate.xyz, -v_forwardDirectionEC, v_forwardDirectionEC.xyz, v_alignedPlaneDistances.x);
    float distanceFromEnd = rayPlaneDistanceUnsafe(eyeCoordinate.xyz, v_forwardDirectionEC, -v_forwardDirectionEC.xyz, v_alignedPlaneDistances.y);

    // Clamp - distance to aligned planes may be negative due to mitering
    distanceFromStart = max(0.0, distanceFromStart);
    distanceFromEnd = max(0.0, distanceFromEnd);

    float s = distanceFromStart / (distanceFromStart + distanceFromEnd);
    s = (s * v_texcoordNormalizationAndHalfWidth.x) + v_texcoordNormalizationAndHalfWidth.y;

    czm_materialInput materialInput;

    materialInput.s = s;
    materialInput.st = vec2(s, v_texcoordT);
    materialInput.str = vec3(s, v_texcoordT, 0.0);

    czm_material material = czm_getMaterial(materialInput);
    out_FragColor = vec4(material.diffuse + material.emission, material.alpha);
#endif // PER_INSTANCE_COLOR
}
`,nh=`in vec3 position3DHigh;
in vec3 position3DLow;

in vec4 startHiAndForwardOffsetX;
in vec4 startLoAndForwardOffsetY;
in vec4 startNormalAndForwardOffsetZ;
in vec4 endNormalAndTextureCoordinateNormalizationX;
in vec4 rightNormalAndTextureCoordinateNormalizationY;
in vec4 startHiLo2D;
in vec4 offsetAndRight2D;
in vec4 startEndNormals2D;
in vec2 texcoordNormalization2D;

in float batchId;

out vec3 v_forwardDirectionEC;
out vec3 v_texcoordNormalizationAndHalfWidth;
out float v_batchId;

// For materials
#ifdef WIDTH_VARYING
out float v_width;
#endif
#ifdef ANGLE_VARYING
out float v_polylineAngle;
#endif

#ifdef PER_INSTANCE_COLOR
out vec4 v_color;
#else
out vec2 v_alignedPlaneDistances;
out float v_texcoordT;
#endif

// Morphing planes using SLERP or NLERP doesn't seem to work, so instead draw the material directly on the shadow volume.
// Morph views are from very far away and aren't meant to be used precisely, so this should be sufficient.
void main()
{
    v_batchId = batchId;

    // Start position
    vec4 posRelativeToEye2D = czm_translateRelativeToEye(vec3(0.0, startHiLo2D.xy), vec3(0.0, startHiLo2D.zw));
    vec4 posRelativeToEye3D = czm_translateRelativeToEye(startHiAndForwardOffsetX.xyz, startLoAndForwardOffsetY.xyz);
    vec4 posRelativeToEye = czm_columbusViewMorph(posRelativeToEye2D, posRelativeToEye3D, czm_morphTime);
    vec3 posEc2D = (czm_modelViewRelativeToEye * posRelativeToEye2D).xyz;
    vec3 posEc3D = (czm_modelViewRelativeToEye * posRelativeToEye3D).xyz;
    vec3 startEC = (czm_modelViewRelativeToEye * posRelativeToEye).xyz;

    // Start plane
    vec4 startPlane2D;
    vec4 startPlane3D;
    startPlane2D.xyz = czm_normal * vec3(0.0, startEndNormals2D.xy);
    startPlane3D.xyz = czm_normal * startNormalAndForwardOffsetZ.xyz;
    startPlane2D.w = -dot(startPlane2D.xyz, posEc2D);
    startPlane3D.w = -dot(startPlane3D.xyz, posEc3D);

    // Right plane
    vec4 rightPlane2D;
    vec4 rightPlane3D;
    rightPlane2D.xyz = czm_normal * vec3(0.0, offsetAndRight2D.zw);
    rightPlane3D.xyz = czm_normal * rightNormalAndTextureCoordinateNormalizationY.xyz;
    rightPlane2D.w = -dot(rightPlane2D.xyz, posEc2D);
    rightPlane3D.w = -dot(rightPlane3D.xyz, posEc3D);

    // End position
    posRelativeToEye2D = posRelativeToEye2D + vec4(0.0, offsetAndRight2D.xy, 0.0);
    posRelativeToEye3D = posRelativeToEye3D + vec4(startHiAndForwardOffsetX.w, startLoAndForwardOffsetY.w, startNormalAndForwardOffsetZ.w, 0.0);
    posRelativeToEye = czm_columbusViewMorph(posRelativeToEye2D, posRelativeToEye3D, czm_morphTime);
    posEc2D = (czm_modelViewRelativeToEye * posRelativeToEye2D).xyz;
    posEc3D = (czm_modelViewRelativeToEye * posRelativeToEye3D).xyz;
    vec3 endEC = (czm_modelViewRelativeToEye * posRelativeToEye).xyz;
    vec3 forwardEc3D = czm_normal * normalize(vec3(startHiAndForwardOffsetX.w, startLoAndForwardOffsetY.w, startNormalAndForwardOffsetZ.w));
    vec3 forwardEc2D = czm_normal * normalize(vec3(0.0, offsetAndRight2D.xy));

    // End plane
    vec4 endPlane2D;
    vec4 endPlane3D;
    endPlane2D.xyz = czm_normal * vec3(0.0, startEndNormals2D.zw);
    endPlane3D.xyz = czm_normal * endNormalAndTextureCoordinateNormalizationX.xyz;
    endPlane2D.w = -dot(endPlane2D.xyz, posEc2D);
    endPlane3D.w = -dot(endPlane3D.xyz, posEc3D);

    // Forward direction
    v_forwardDirectionEC = normalize(endEC - startEC);

    vec2 cleanTexcoordNormalization2D;
    cleanTexcoordNormalization2D.x = abs(texcoordNormalization2D.x);
    cleanTexcoordNormalization2D.y = czm_branchFreeTernary(texcoordNormalization2D.y > 1.0, 0.0, abs(texcoordNormalization2D.y));
    vec2 cleanTexcoordNormalization3D;
    cleanTexcoordNormalization3D.x = abs(endNormalAndTextureCoordinateNormalizationX.w);
    cleanTexcoordNormalization3D.y = rightNormalAndTextureCoordinateNormalizationY.w;
    cleanTexcoordNormalization3D.y = czm_branchFreeTernary(cleanTexcoordNormalization3D.y > 1.0, 0.0, abs(cleanTexcoordNormalization3D.y));

    v_texcoordNormalizationAndHalfWidth.xy = mix(cleanTexcoordNormalization2D, cleanTexcoordNormalization3D, czm_morphTime);

#ifdef PER_INSTANCE_COLOR
    v_color = czm_batchTable_color(batchId);
#else // PER_INSTANCE_COLOR
    // For computing texture coordinates

    v_alignedPlaneDistances.x = -dot(v_forwardDirectionEC, startEC);
    v_alignedPlaneDistances.y = -dot(-v_forwardDirectionEC, endEC);
#endif // PER_INSTANCE_COLOR

#ifdef WIDTH_VARYING
    float width = czm_batchTable_width(batchId);
    float halfWidth = width * 0.5;
    v_width = width;
    v_texcoordNormalizationAndHalfWidth.z = halfWidth;
#else
    float halfWidth = 0.5 * czm_batchTable_width(batchId);
    v_texcoordNormalizationAndHalfWidth.z = halfWidth;
#endif

    // Compute a normal along which to "push" the position out, extending the miter depending on view distance.
    // Position has already been "pushed" by unit length along miter normal, and miter normals are encoded in the planes.
    // Decode the normal to use at this specific vertex, push the position back, and then push to where it needs to be.
    // Since this is morphing, compute both 3D and 2D positions and then blend.

    // ****** 3D ******
    // Check distance to the end plane and start plane, pick the plane that is closer
    vec4 positionEc3D = czm_modelViewRelativeToEye * czm_translateRelativeToEye(position3DHigh, position3DLow); // w = 1.0, see czm_computePosition
    float absStartPlaneDistance = abs(czm_planeDistance(startPlane3D, positionEc3D.xyz));
    float absEndPlaneDistance = abs(czm_planeDistance(endPlane3D, positionEc3D.xyz));
    vec3 planeDirection = czm_branchFreeTernary(absStartPlaneDistance < absEndPlaneDistance, startPlane3D.xyz, endPlane3D.xyz);
    vec3 upOrDown = normalize(cross(rightPlane3D.xyz, planeDirection)); // Points "up" for start plane, "down" at end plane.
    vec3 normalEC = normalize(cross(planeDirection, upOrDown));         // In practice, the opposite seems to work too.

    // Nudge the top vertex upwards to prevent flickering
    vec3 geodeticSurfaceNormal = normalize(cross(normalEC, forwardEc3D));
    geodeticSurfaceNormal *= float(0.0 <= rightNormalAndTextureCoordinateNormalizationY.w && rightNormalAndTextureCoordinateNormalizationY.w <= 1.0);
    geodeticSurfaceNormal *= MAX_TERRAIN_HEIGHT;
    positionEc3D.xyz += geodeticSurfaceNormal;

    // Determine if this vertex is on the "left" or "right"
    normalEC *= sign(endNormalAndTextureCoordinateNormalizationX.w);

    // A "perfect" implementation would push along normals according to the angle against forward.
    // In practice, just pushing the normal out by halfWidth is sufficient for morph views.
    positionEc3D.xyz += halfWidth * max(0.0, czm_metersPerPixel(positionEc3D)) * normalEC; // prevent artifacts when czm_metersPerPixel is negative (behind camera)

    // ****** 2D ******
    // Check distance to the end plane and start plane, pick the plane that is closer
    vec4 positionEc2D = czm_modelViewRelativeToEye * czm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy); // w = 1.0, see czm_computePosition
    absStartPlaneDistance = abs(czm_planeDistance(startPlane2D, positionEc2D.xyz));
    absEndPlaneDistance = abs(czm_planeDistance(endPlane2D, positionEc2D.xyz));
    planeDirection = czm_branchFreeTernary(absStartPlaneDistance < absEndPlaneDistance, startPlane2D.xyz, endPlane2D.xyz);
    upOrDown = normalize(cross(rightPlane2D.xyz, planeDirection)); // Points "up" for start plane, "down" at end plane.
    normalEC = normalize(cross(planeDirection, upOrDown));         // In practice, the opposite seems to work too.

    // Nudge the top vertex upwards to prevent flickering
    geodeticSurfaceNormal = normalize(cross(normalEC, forwardEc2D));
    geodeticSurfaceNormal *= float(0.0 <= texcoordNormalization2D.y && texcoordNormalization2D.y <= 1.0);
    geodeticSurfaceNormal *= MAX_TERRAIN_HEIGHT;
    positionEc2D.xyz += geodeticSurfaceNormal;

    // Determine if this vertex is on the "left" or "right"
    normalEC *= sign(texcoordNormalization2D.x);
#ifndef PER_INSTANCE_COLOR
    // Use vertex's sidedness to compute its texture coordinate.
    v_texcoordT = clamp(sign(texcoordNormalization2D.x), 0.0, 1.0);
#endif

    // A "perfect" implementation would push along normals according to the angle against forward.
    // In practice, just pushing the normal out by halfWidth is sufficient for morph views.
    positionEc2D.xyz += halfWidth * max(0.0, czm_metersPerPixel(positionEc2D)) * normalEC; // prevent artifacts when czm_metersPerPixel is negative (behind camera)

    // Blend for actual position
    gl_Position = czm_projection * mix(positionEc2D, positionEc3D, czm_morphTime);

#ifdef ANGLE_VARYING
    // Approximate relative screen space direction of the line.
    vec2 approxLineDirection = normalize(vec2(v_forwardDirectionEC.x, -v_forwardDirectionEC.y));
    approxLineDirection.y = czm_branchFreeTernary(approxLineDirection.x == 0.0 && approxLineDirection.y == 0.0, -1.0, approxLineDirection.y);
    v_polylineAngle = czm_fastApproximateAtan(approxLineDirection.x, approxLineDirection.y);
#endif
}
`,oh=`in vec3 position3DHigh;
in vec3 position3DLow;

// In 2D and in 3D, texture coordinate normalization component signs encodes:
// * X sign - sidedness relative to right plane
// * Y sign - is negative OR magnitude is greater than 1.0 if vertex is on bottom of volume
#ifndef COLUMBUS_VIEW_2D
in vec4 startHiAndForwardOffsetX;
in vec4 startLoAndForwardOffsetY;
in vec4 startNormalAndForwardOffsetZ;
in vec4 endNormalAndTextureCoordinateNormalizationX;
in vec4 rightNormalAndTextureCoordinateNormalizationY;
#else
in vec4 startHiLo2D;
in vec4 offsetAndRight2D;
in vec4 startEndNormals2D;
in vec2 texcoordNormalization2D;
#endif

in float batchId;

out vec4 v_startPlaneNormalEcAndHalfWidth;
out vec4 v_endPlaneNormalEcAndBatchId;
out vec4 v_rightPlaneEC;
out vec4 v_endEcAndStartEcX;
out vec4 v_texcoordNormalizationAndStartEcYZ;

// For materials
#ifdef WIDTH_VARYING
out float v_width;
#endif
#ifdef ANGLE_VARYING
out float v_polylineAngle;
#endif

#ifdef PER_INSTANCE_COLOR
out vec4 v_color;
#endif

void main()
{
#ifdef COLUMBUS_VIEW_2D
    vec3 ecStart = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(vec3(0.0, startHiLo2D.xy), vec3(0.0, startHiLo2D.zw))).xyz;

    vec3 forwardDirectionEC = czm_normal * vec3(0.0, offsetAndRight2D.xy);
    vec3 ecEnd = forwardDirectionEC + ecStart;
    forwardDirectionEC = normalize(forwardDirectionEC);

    // Right plane
    v_rightPlaneEC.xyz = czm_normal * vec3(0.0, offsetAndRight2D.zw);
    v_rightPlaneEC.w = -dot(v_rightPlaneEC.xyz, ecStart);

    // start plane
    vec4 startPlaneEC;
    startPlaneEC.xyz =  czm_normal * vec3(0.0, startEndNormals2D.xy);
    startPlaneEC.w = -dot(startPlaneEC.xyz, ecStart);

    // end plane
    vec4 endPlaneEC;
    endPlaneEC.xyz =  czm_normal * vec3(0.0, startEndNormals2D.zw);
    endPlaneEC.w = -dot(endPlaneEC.xyz, ecEnd);

    v_texcoordNormalizationAndStartEcYZ.x = abs(texcoordNormalization2D.x);
    v_texcoordNormalizationAndStartEcYZ.y = texcoordNormalization2D.y;

#else // COLUMBUS_VIEW_2D
    vec3 ecStart = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(startHiAndForwardOffsetX.xyz, startLoAndForwardOffsetY.xyz)).xyz;
    vec3 offset = czm_normal * vec3(startHiAndForwardOffsetX.w, startLoAndForwardOffsetY.w, startNormalAndForwardOffsetZ.w);
    vec3 ecEnd = ecStart + offset;

    vec3 forwardDirectionEC = normalize(offset);

    // start plane
    vec4 startPlaneEC;
    startPlaneEC.xyz = czm_normal * startNormalAndForwardOffsetZ.xyz;
    startPlaneEC.w = -dot(startPlaneEC.xyz, ecStart);

    // end plane
    vec4 endPlaneEC;
    endPlaneEC.xyz = czm_normal * endNormalAndTextureCoordinateNormalizationX.xyz;
    endPlaneEC.w = -dot(endPlaneEC.xyz, ecEnd);

    // Right plane
    v_rightPlaneEC.xyz = czm_normal * rightNormalAndTextureCoordinateNormalizationY.xyz;
    v_rightPlaneEC.w = -dot(v_rightPlaneEC.xyz, ecStart);

    v_texcoordNormalizationAndStartEcYZ.x = abs(endNormalAndTextureCoordinateNormalizationX.w);
    v_texcoordNormalizationAndStartEcYZ.y = rightNormalAndTextureCoordinateNormalizationY.w;

#endif // COLUMBUS_VIEW_2D

    v_endEcAndStartEcX.xyz = ecEnd;
    v_endEcAndStartEcX.w = ecStart.x;
    v_texcoordNormalizationAndStartEcYZ.zw = ecStart.yz;

#ifdef PER_INSTANCE_COLOR
    v_color = czm_batchTable_color(batchId);
#endif // PER_INSTANCE_COLOR

    // Compute a normal along which to "push" the position out, extending the miter depending on view distance.
    // Position has already been "pushed" by unit length along miter normal, and miter normals are encoded in the planes.
    // Decode the normal to use at this specific vertex, push the position back, and then push to where it needs to be.
    vec4 positionRelativeToEye = czm_computePosition();

    // Check distance to the end plane and start plane, pick the plane that is closer
    vec4 positionEC = czm_modelViewRelativeToEye * positionRelativeToEye; // w = 1.0, see czm_computePosition
    float absStartPlaneDistance = abs(czm_planeDistance(startPlaneEC, positionEC.xyz));
    float absEndPlaneDistance = abs(czm_planeDistance(endPlaneEC, positionEC.xyz));
    vec3 planeDirection = czm_branchFreeTernary(absStartPlaneDistance < absEndPlaneDistance, startPlaneEC.xyz, endPlaneEC.xyz);
    vec3 upOrDown = normalize(cross(v_rightPlaneEC.xyz, planeDirection)); // Points "up" for start plane, "down" at end plane.
    vec3 normalEC = normalize(cross(planeDirection, upOrDown));           // In practice, the opposite seems to work too.

    // Extrude bottom vertices downward for far view distances, like for GroundPrimitives
    upOrDown = cross(forwardDirectionEC, normalEC);
    upOrDown = float(czm_sceneMode == czm_sceneMode3D) * upOrDown;
    upOrDown = float(v_texcoordNormalizationAndStartEcYZ.y > 1.0 || v_texcoordNormalizationAndStartEcYZ.y < 0.0) * upOrDown;
    upOrDown = min(GLOBE_MINIMUM_ALTITUDE, czm_geometricToleranceOverMeter * length(positionRelativeToEye.xyz)) * upOrDown;
    positionEC.xyz += upOrDown;

    v_texcoordNormalizationAndStartEcYZ.y = czm_branchFreeTernary(v_texcoordNormalizationAndStartEcYZ.y > 1.0, 0.0, abs(v_texcoordNormalizationAndStartEcYZ.y));

    // Determine distance along normalEC to push for a volume of appropriate width.
    // Make volumes about double pixel width for a conservative fit - in practice the
    // extra cost here is minimal compared to the loose volume heights.
    //
    // N = normalEC (guaranteed "right-facing")
    // R = rightEC
    // p = angle between N and R
    // w = distance to push along R if R == N
    // d = distance to push along N
    //
    //   N   R
    //  {  p| }      * cos(p) = dot(N, R) = w / d
    //  d  |  |w    * d = w / dot(N, R)
    //    { | }
    //       o---------- polyline segment ---->
    //
    float width = czm_batchTable_width(batchId);
#ifdef WIDTH_VARYING
    v_width = width;
#endif

    v_startPlaneNormalEcAndHalfWidth.xyz = startPlaneEC.xyz;
    v_startPlaneNormalEcAndHalfWidth.w = width * 0.5;

    v_endPlaneNormalEcAndBatchId.xyz = endPlaneEC.xyz;
    v_endPlaneNormalEcAndBatchId.w = batchId;

    width = width * max(0.0, czm_metersPerPixel(positionEC)); // width = distance to push along R
    width = width / dot(normalEC, v_rightPlaneEC.xyz); // width = distance to push along N

    // Determine if this vertex is on the "left" or "right"
#ifdef COLUMBUS_VIEW_2D
        normalEC *= sign(texcoordNormalization2D.x);
#else
        normalEC *= sign(endNormalAndTextureCoordinateNormalizationX.w);
#endif

    positionEC.xyz += width * normalEC;
    gl_Position = czm_depthClamp(czm_projection * positionEC);

#ifdef ANGLE_VARYING
    // Approximate relative screen space direction of the line.
    vec2 approxLineDirection = normalize(vec2(forwardDirectionEC.x, -forwardDirectionEC.y));
    approxLineDirection.y = czm_branchFreeTernary(approxLineDirection.x == 0.0 && approxLineDirection.y == 0.0, -1.0, approxLineDirection.y);
    v_polylineAngle = czm_fastApproximateAtan(approxLineDirection.x, approxLineDirection.y);
#endif
}
`,sh=`in vec3 position3DHigh;
in vec3 position3DLow;
in vec3 prevPosition3DHigh;
in vec3 prevPosition3DLow;
in vec3 nextPosition3DHigh;
in vec3 nextPosition3DLow;
in vec2 expandAndWidth;
in vec4 color;
in float batchId;

out vec4 v_color;

void main()
{
    float expandDir = expandAndWidth.x;
    float width = abs(expandAndWidth.y) + 0.5;
    bool usePrev = expandAndWidth.y < 0.0;

    vec4 p = czm_computePosition();
    vec4 prev = czm_computePrevPosition();
    vec4 next = czm_computeNextPosition();

    float angle;
    vec4 positionWC = getPolylineWindowCoordinates(p, prev, next, expandDir, width, usePrev, angle);
    gl_Position = czm_viewportOrthographic * positionWC;

    v_color = color;
}
`;let cs=`${Ua}
${sh}`;const rh=Dc;fo.isInternetExplorer()||(cs=`#define CLIP_POLYLINE 
${cs}`);function mi(e){e=h(e,h.EMPTY_OBJECT);const t=h(e.translucent,!0),i=!1,n=mi.VERTEX_FORMAT;this.material=void 0,this.translucent=t,this._vertexShaderSource=h(e.vertexShaderSource,cs),this._fragmentShaderSource=h(e.fragmentShaderSource,rh),this._renderState=pi.getDefaultRenderState(t,i,e.renderState),this._closed=i,this._vertexFormat=n}Object.defineProperties(mi.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return this._vertexFormat}}});mi.VERTEX_FORMAT=Ba.POSITION_ONLY;mi.prototype.getFragmentShaderSource=pi.prototype.getFragmentShaderSource;mi.prototype.isTranslucent=pi.prototype.isTranslucent;mi.prototype.getRenderState=pi.prototype.getRenderState;const ah=`in vec3 position3DHigh;
in vec3 position3DLow;
in vec3 prevPosition3DHigh;
in vec3 prevPosition3DLow;
in vec3 nextPosition3DHigh;
in vec3 nextPosition3DLow;
in vec2 expandAndWidth;
in vec2 st;
in float batchId;

out float v_width;
out vec2 v_st;
out float v_polylineAngle;

void main()
{
    float expandDir = expandAndWidth.x;
    float width = abs(expandAndWidth.y) + 0.5;
    bool usePrev = expandAndWidth.y < 0.0;

    vec4 p = czm_computePosition();
    vec4 prev = czm_computePrevPosition();
    vec4 next = czm_computeNextPosition();

    float angle;
    vec4 positionWC = getPolylineWindowCoordinates(p, prev, next, expandDir, width, usePrev, angle);
    gl_Position = czm_viewportOrthographic * positionWC;

    v_width = width;
    v_st.s = st.s;
    v_st.t = czm_writeNonPerspective(st.t, gl_Position.w);
    v_polylineAngle = angle;
}
`;let ds=`${Ua}
${ah}`;const lh=Tc;fo.isInternetExplorer()||(ds=`#define CLIP_POLYLINE 
${ds}`);function Pi(e){e=h(e,h.EMPTY_OBJECT);const t=h(e.translucent,!0),i=!1,n=Pi.VERTEX_FORMAT;this.material=u(e.material)?e.material:Gs.fromType(Gs.ColorType),this.translucent=t,this._vertexShaderSource=h(e.vertexShaderSource,ds),this._fragmentShaderSource=h(e.fragmentShaderSource,lh),this._renderState=pi.getDefaultRenderState(t,i,e.renderState),this._closed=i,this._vertexFormat=n}Object.defineProperties(Pi.prototype,{vertexShaderSource:{get:function(){let e=this._vertexShaderSource;return this.material.shaderSource.search(/in\s+float\s+v_polylineAngle;/g)!==-1&&(e=`#define POLYLINE_DASH
${e}`),e}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return this._vertexFormat}}});Pi.VERTEX_FORMAT=Ba.POSITION_AND_ST;Pi.prototype.getFragmentShaderSource=pi.prototype.getFragmentShaderSource;Pi.prototype.isTranslucent=pi.prototype.isTranslucent;Pi.prototype.getRenderState=pi.prototype.getRenderState;function $t(e){e=h(e,h.EMPTY_OBJECT),this.geometryInstances=e.geometryInstances,this._hasPerInstanceColors=!0;let t=e.appearance;u(t)||(t=new Pi),this.appearance=t,this.show=h(e.show,!0),this.classificationType=h(e.classificationType,Zt.BOTH),this.debugShowBoundingVolume=h(e.debugShowBoundingVolume,!1),this._debugShowShadowVolume=h(e.debugShowShadowVolume,!1),this._primitiveOptions={geometryInstances:void 0,appearance:void 0,vertexCacheOptimize:!1,interleave:h(e.interleave,!1),releaseGeometryInstances:h(e.releaseGeometryInstances,!0),allowPicking:h(e.allowPicking,!0),asynchronous:h(e.asynchronous,!0),compressVertices:!1,_createShaderProgramFunction:void 0,_createCommandsFunction:void 0,_updateAndQueueCommandsFunction:void 0},this._zIndex=void 0,this._ready=!1,this._primitive=void 0,this._sp=void 0,this._sp2D=void 0,this._spMorph=void 0,this._renderState=Er(!1),this._renderState3DTiles=Er(!0),this._renderStateMorph=mt.fromCache({cull:{enabled:!0,face:Ic.FRONT},depthTest:{enabled:!0},blending:Ds.PRE_MULTIPLIED_ALPHA_BLEND,depthMask:!1})}Object.defineProperties($t.prototype,{interleave:{get:function(){return this._primitiveOptions.interleave}},releaseGeometryInstances:{get:function(){return this._primitiveOptions.releaseGeometryInstances}},allowPicking:{get:function(){return this._primitiveOptions.allowPicking}},asynchronous:{get:function(){return this._primitiveOptions.asynchronous}},ready:{get:function(){return this._ready}},debugShowShadowVolume:{get:function(){return this._debugShowShadowVolume}}});$t.initializeTerrainHeights=function(){return zt.initialize()};function ch(e,t,i){const n=t.context,o=e._primitive,s=o._attributeLocations;let r=o._batchTable.getVertexShaderCallback()(oh);r=ze._appendShowToShader(o,r),r=ze._appendDistanceDisplayConditionToShader(o,r),r=ze._modifyShaderPosition(e,r,t.scene3DOnly);let l=o._batchTable.getVertexShaderCallback()(nh);l=ze._appendShowToShader(o,l),l=ze._appendDistanceDisplayConditionToShader(o,l),l=ze._modifyShaderPosition(e,l,t.scene3DOnly);let a=o._batchTable.getVertexShaderCallback()(th);const c=[`GLOBE_MINIMUM_ALTITUDE ${t.mapProjection.ellipsoid.minimumRadius.toFixed(1)}`];let d="",g="";u(i.material)?(g=u(i.material)?i.material.shaderSource:"",g.search(/in\s+float\s+v_polylineAngle;/g)!==-1&&c.push("ANGLE_VARYING"),g.search(/in\s+float\s+v_width;/g)!==-1&&c.push("WIDTH_VARYING")):d="PER_INSTANCE_COLOR",c.push(d);const m=e.debugShowShadowVolume?["DEBUG_SHOW_VOLUME",d]:[d],y=new dt({defines:c,sources:[r]}),w=new dt({defines:m,sources:[g,a]});e._sp=Hi.replaceCache({context:n,shaderProgram:o._sp,vertexShaderSource:y,fragmentShaderSource:w,attributeLocations:s});let p=n.shaderCache.getDerivedShaderProgram(e._sp,"2dColor");if(!u(p)){const _=new dt({defines:c.concat(["COLUMBUS_VIEW_2D"]),sources:[r]});p=n.shaderCache.createDerivedShaderProgram(e._sp,"2dColor",{context:n,shaderProgram:e._sp2D,vertexShaderSource:_,fragmentShaderSource:w,attributeLocations:s})}e._sp2D=p;let f=n.shaderCache.getDerivedShaderProgram(e._sp,"MorphColor");if(!u(f)){const _=new dt({defines:c.concat([`MAX_TERRAIN_HEIGHT ${zt._defaultMaxTerrainHeight.toFixed(1)}`]),sources:[l]});a=o._batchTable.getVertexShaderCallback()(ih);const x=new dt({defines:m,sources:[g,a]});f=n.shaderCache.createDerivedShaderProgram(e._sp,"MorphColor",{context:n,shaderProgram:e._spMorph,vertexShaderSource:_,fragmentShaderSource:x,attributeLocations:s})}e._spMorph=f}function Er(e){return mt.fromCache({cull:{enabled:!0},blending:Ds.PRE_MULTIPLIED_ALPHA_BLEND,depthMask:!1,stencilTest:{enabled:e,frontFunction:ai.EQUAL,frontOperation:{fail:ge.KEEP,zFail:ge.KEEP,zPass:ge.KEEP},backFunction:ai.EQUAL,backOperation:{fail:ge.KEEP,zFail:ge.KEEP,zPass:ge.KEEP},reference:Yt.CESIUM_3D_TILE_MASK,mask:Yt.CESIUM_3D_TILE_MASK}})}function dh(e,t,i,n,o,s){const r=e._primitive,l=r._va.length;o.length=l,s.length=l;const c=t instanceof mi?{}:i._uniforms,d=r._batchTable.getUniformMapCallback()(c);for(let g=0;g<l;g++){const m=r._va[g];let y=o[g];u(y)||(y=o[g]=new Oe({owner:e,primitiveType:r._primitiveType})),y.vertexArray=m,y.renderState=e._renderState,y.shaderProgram=e._sp,y.uniformMap=d,y.pass=At.TERRAIN_CLASSIFICATION,y.pickId="czm_batchTable_pickColor(v_endPlaneNormalEcAndBatchId.w)";const w=Oe.shallowClone(y,y.derivedCommands.tileset);w.renderState=e._renderState3DTiles,w.pass=At.CESIUM_3D_TILE_CLASSIFICATION,y.derivedCommands.tileset=w;const p=Oe.shallowClone(y,y.derivedCommands.color2D);p.shaderProgram=e._sp2D,y.derivedCommands.color2D=p;const f=Oe.shallowClone(w,w.derivedCommands.color2D);f.shaderProgram=e._sp2D,w.derivedCommands.color2D=f;const _=Oe.shallowClone(y,y.derivedCommands.colorMorph);_.renderState=e._renderStateMorph,_.shaderProgram=e._spMorph,_.pickId="czm_batchTable_pickColor(v_batchId)",y.derivedCommands.colorMorph=_}}function Dr(e,t,i,n,o,s,r){i.mode===wt.MORPHING?t=t.derivedCommands.colorMorph:i.mode!==wt.SCENE3D&&(t=t.derivedCommands.color2D),t.modelMatrix=n,t.boundingVolume=s,t.cull=o,t.debugShowBoundingVolume=r,i.commandList.push(t)}function hh(e,t,i,n,o,s,r){const l=e._primitive;ze._updateBoundingVolumes(l,t,o);let a;t.mode===wt.SCENE3D?a=l._boundingSphereWC:t.mode===wt.COLUMBUS_VIEW?a=l._boundingSphereCV:t.mode===wt.SCENE2D&&u(l._boundingSphere2D)?a=l._boundingSphere2D:u(l._boundingSphereMorph)&&(a=l._boundingSphereMorph);const c=t.mode===wt.MORPHING,d=e.classificationType,g=d!==Zt.CESIUM_3D_TILE,m=d!==Zt.TERRAIN&&!c;let y;const w=t.passes;if(w.render||w.pick&&l.allowPicking){const p=i.length;for(let f=0;f<p;++f){const _=a[f];g&&(y=i[f],Dr(e,y,t,o,s,_,r)),m&&(y=i[f].derivedCommands.tileset,Dr(e,y,t,o,s,_,r))}}}$t.prototype.update=function(e){if(!u(this._primitive)&&!u(this.geometryInstances))return;if(!zt.initialized){if(!this.asynchronous)throw new N("For synchronous GroundPolylinePrimitives, you must call GroundPolylinePrimitives.initializeTerrainHeights() and wait for the returned promise to resolve.");$t.initializeTerrainHeights();return}let t;const i=this,n=this._primitiveOptions;if(!u(this._primitive)){const o=Array.isArray(this.geometryInstances)?this.geometryInstances:[this.geometryInstances],s=o.length,r=new Array(s);let l;for(t=0;t<s;++t)if(l=o[t].attributes,!u(l)||!u(l.color)){this._hasPerInstanceColors=!1;break}for(t=0;t<s;++t){const a=o[t];l={};const c=a.attributes;for(const d in c)c.hasOwnProperty(d)&&(l[d]=c[d]);u(l.width)||(l.width=new Ot({componentDatatype:tt.UNSIGNED_BYTE,componentsPerAttribute:1,value:[a.geometry.width]})),a.geometry._scene3DOnly=e.scene3DOnly,di.setProjectionAndEllipsoid(a.geometry,e.mapProjection),r[t]=new so({geometry:a.geometry,attributes:l,id:a.id,pickPrimitive:i})}n.geometryInstances=r,n.appearance=this.appearance,n._createShaderProgramFunction=function(a,c,d){ch(i,c,d)},n._createCommandsFunction=function(a,c,d,g,m,y,w){dh(i,c,d,g,y,w)},n._updateAndQueueCommandsFunction=function(a,c,d,g,m,y,w,p){hh(i,c,d,g,m,y,w)},this._primitive=new ze(n)}if(this.appearance instanceof mi&&!this._hasPerInstanceColors)throw new N("All GeometryInstances must have color attributes to use PolylineColorAppearance with GroundPolylinePrimitive.");this._primitive.appearance=this.appearance,this._primitive.show=this.show,this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume,this._primitive.update(e),e.afterRender.push(()=>{!this._ready&&u(this._primitive)&&this._primitive.ready&&(this._ready=!0,this.releaseGeometryInstances&&(this.geometryInstances=void 0))})};$t.prototype.getGeometryInstanceAttributes=function(e){if(!u(this._primitive))throw new N("must call update before calling getGeometryInstanceAttributes");return this._primitive.getGeometryInstanceAttributes(e)};$t.isSupported=function(e){return e.frameState.context.depthTexture};$t.prototype.isDestroyed=function(){return!1};$t.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),this._sp=this._sp&&this._sp.destroy(),this._sp2D=void 0,this._spMorph=void 0,uo(this)};const uh=new Y(1,1),fh=!1,ph=Nn.WHITE;function $i(e){e=h(e,h.EMPTY_OBJECT),this._definitionChanged=new le,this._image=void 0,this._imageSubscription=void 0,this._repeat=void 0,this._repeatSubscription=void 0,this._color=void 0,this._colorSubscription=void 0,this._transparent=void 0,this._transparentSubscription=void 0,this.image=e.image,this.repeat=e.repeat,this.color=e.color,this.transparent=e.transparent}Object.defineProperties($i.prototype,{isConstant:{get:function(){return te.isConstant(this._image)&&te.isConstant(this._repeat)}},definitionChanged:{get:function(){return this._definitionChanged}},image:C("image"),repeat:C("repeat"),color:C("color"),transparent:C("transparent")});$i.prototype.getType=function(e){return"Image"};$i.prototype.getValue=function(e,t){return u(t)||(t={}),t.image=te.getValueOrUndefined(this._image,e),t.repeat=te.getValueOrClonedDefault(this._repeat,e,uh,t.repeat),t.color=te.getValueOrClonedDefault(this._color,e,ph,t.color),te.getValueOrDefault(this._transparent,e,fh)&&(t.color.alpha=Math.min(.99,t.color.alpha)),t};$i.prototype.equals=function(e){return this===e||e instanceof $i&&te.equals(this._image,e._image)&&te.equals(this._repeat,e._repeat)&&te.equals(this._color,e._color)&&te.equals(this._transparent,e._transparent)};function _h(e){if(e instanceof Nn)return new Ki(e);if(typeof e=="string"||e instanceof ss||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement){const t=new $i;return t.image=e,t}throw new N(`Unable to infer material type: ${e}`)}function ht(e,t){return C(e,t,_h)}function fn(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._dimensions=void 0,this._dimensionsSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(fn.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),dimensions:C("dimensions"),heightReference:C("heightReference"),fill:C("fill"),material:ht("material"),outline:C("outline"),outlineColor:C("outlineColor"),outlineWidth:C("outlineWidth"),shadows:C("shadows"),distanceDisplayCondition:C("distanceDisplayCondition")});fn.prototype.clone=function(e){return u(e)?(e.show=this.show,e.dimensions=this.dimensions,e.heightReference=this.heightReference,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new fn(this)};fn.prototype.merge=function(e){if(!u(e))throw new N("source is required.");this.show=h(this.show,e.show),this.dimensions=h(this.dimensions,e.dimensions),this.heightReference=h(this.heightReference,e.heightReference),this.fill=h(this.fill,e.fill),this.material=h(this.material,e.material),this.outline=h(this.outline,e.outline),this.outlineColor=h(this.outlineColor,e.outlineColor),this.outlineWidth=h(this.outlineWidth,e.outlineWidth),this.shadows=h(this.shadows,e.shadows),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition)};const mh={FIXED:0,INERTIAL:1},xt=Object.freeze(mh);function Ri(){N.throwInstantiationError()}Object.defineProperties(Ri.prototype,{isConstant:{get:N.throwInstantiationError},definitionChanged:{get:N.throwInstantiationError},referenceFrame:{get:N.throwInstantiationError}});Ri.prototype.getValue=N.throwInstantiationError;Ri.prototype.getValueInReferenceFrame=N.throwInstantiationError;Ri.prototype.equals=N.throwInstantiationError;const No=new Mt;Ri.convertToReferenceFrame=function(e,t,i,n,o){if(!u(t))return t;if(u(o)||(o=new b),i===n)return b.clone(t,o);let s=un.computeIcrfToFixedMatrix(e,No);if(u(s)||(s=un.computeTemeToPseudoFixedMatrix(e,No)),i===xt.INERTIAL)return Mt.multiplyByVector(s,t,o);if(i===xt.FIXED)return Mt.multiplyByVector(Mt.transpose(s,No),t,o)};function vi(e,t){this._definitionChanged=new le,this._value=b.clone(e),this._referenceFrame=h(t,xt.FIXED)}Object.defineProperties(vi.prototype,{isConstant:{get:function(){return!u(this._value)||this._referenceFrame===xt.FIXED}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return this._referenceFrame}}});vi.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,xt.FIXED,t)};vi.prototype.setValue=function(e,t){let i=!1;b.equals(this._value,e)||(i=!0,this._value=b.clone(e)),u(t)&&this._referenceFrame!==t&&(i=!0,this._referenceFrame=t),i&&this._definitionChanged.raiseEvent(this)};vi.prototype.getValueInReferenceFrame=function(e,t,i){if(!u(e))throw new N("time is required.");if(!u(t))throw new N("referenceFrame is required.");return Ri.convertToReferenceFrame(e,this._value,this._referenceFrame,t,i)};vi.prototype.equals=function(e){return this===e||e instanceof vi&&b.equals(this._value,e._value)&&this._referenceFrame===e._referenceFrame};function pn(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._positions=void 0,this._positionsSubscription=void 0,this._width=void 0,this._widthSubscription=void 0,this._height=void 0,this._heightSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._extrudedHeight=void 0,this._extrudedHeightSubscription=void 0,this._extrudedHeightReference=void 0,this._extrudedHeightReferenceSubscription=void 0,this._cornerType=void 0,this._cornerTypeSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._classificationType=void 0,this._classificationTypeSubscription=void 0,this._zIndex=void 0,this._zIndexSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(pn.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),positions:C("positions"),width:C("width"),height:C("height"),heightReference:C("heightReference"),extrudedHeight:C("extrudedHeight"),extrudedHeightReference:C("extrudedHeightReference"),cornerType:C("cornerType"),granularity:C("granularity"),fill:C("fill"),material:ht("material"),outline:C("outline"),outlineColor:C("outlineColor"),outlineWidth:C("outlineWidth"),shadows:C("shadows"),distanceDisplayCondition:C("distanceDisplayCondition"),classificationType:C("classificationType"),zIndex:C("zIndex")});pn.prototype.clone=function(e){return u(e)?(e.show=this.show,e.positions=this.positions,e.width=this.width,e.height=this.height,e.heightReference=this.heightReference,e.extrudedHeight=this.extrudedHeight,e.extrudedHeightReference=this.extrudedHeightReference,e.cornerType=this.cornerType,e.granularity=this.granularity,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e.classificationType=this.classificationType,e.zIndex=this.zIndex,e):new pn(this)};pn.prototype.merge=function(e){if(!u(e))throw new N("source is required.");this.show=h(this.show,e.show),this.positions=h(this.positions,e.positions),this.width=h(this.width,e.width),this.height=h(this.height,e.height),this.heightReference=h(this.heightReference,e.heightReference),this.extrudedHeight=h(this.extrudedHeight,e.extrudedHeight),this.extrudedHeightReference=h(this.extrudedHeightReference,e.extrudedHeightReference),this.cornerType=h(this.cornerType,e.cornerType),this.granularity=h(this.granularity,e.granularity),this.fill=h(this.fill,e.fill),this.material=h(this.material,e.material),this.outline=h(this.outline,e.outline),this.outlineColor=h(this.outlineColor,e.outlineColor),this.outlineWidth=h(this.outlineWidth,e.outlineWidth),this.shadows=h(this.shadows,e.shadows),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition),this.classificationType=h(this.classificationType,e.classificationType),this.zIndex=h(this.zIndex,e.zIndex)};function gh(e){return e}function hs(e,t){return C(e,t,gh)}function _n(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._length=void 0,this._lengthSubscription=void 0,this._topRadius=void 0,this._topRadiusSubscription=void 0,this._bottomRadius=void 0,this._bottomRadiusSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._numberOfVerticalLines=void 0,this._numberOfVerticalLinesSubscription=void 0,this._slices=void 0,this._slicesSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(_n.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),length:C("length"),topRadius:C("topRadius"),bottomRadius:C("bottomRadius"),heightReference:C("heightReference"),fill:C("fill"),material:ht("material"),outline:C("outline"),outlineColor:C("outlineColor"),outlineWidth:C("outlineWidth"),numberOfVerticalLines:C("numberOfVerticalLines"),slices:C("slices"),shadows:C("shadows"),distanceDisplayCondition:C("distanceDisplayCondition")});_n.prototype.clone=function(e){return u(e)?(e.show=this.show,e.length=this.length,e.topRadius=this.topRadius,e.bottomRadius=this.bottomRadius,e.heightReference=this.heightReference,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.numberOfVerticalLines=this.numberOfVerticalLines,e.slices=this.slices,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new _n(this)};_n.prototype.merge=function(e){if(!u(e))throw new N("source is required.");this.show=h(this.show,e.show),this.length=h(this.length,e.length),this.topRadius=h(this.topRadius,e.topRadius),this.bottomRadius=h(this.bottomRadius,e.bottomRadius),this.heightReference=h(this.heightReference,e.heightReference),this.fill=h(this.fill,e.fill),this.material=h(this.material,e.material),this.outline=h(this.outline,e.outline),this.outlineColor=h(this.outlineColor,e.outlineColor),this.outlineWidth=h(this.outlineWidth,e.outlineWidth),this.numberOfVerticalLines=h(this.numberOfVerticalLines,e.numberOfVerticalLines),this.slices=h(this.slices,e.slices),this.shadows=h(this.shadows,e.shadows),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition)};function mn(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._semiMajorAxis=void 0,this._semiMajorAxisSubscription=void 0,this._semiMinorAxis=void 0,this._semiMinorAxisSubscription=void 0,this._height=void 0,this._heightSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._extrudedHeight=void 0,this._extrudedHeightSubscription=void 0,this._extrudedHeightReference=void 0,this._extrudedHeightReferenceSubscription=void 0,this._rotation=void 0,this._rotationSubscription=void 0,this._stRotation=void 0,this._stRotationSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._numberOfVerticalLines=void 0,this._numberOfVerticalLinesSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._classificationType=void 0,this._classificationTypeSubscription=void 0,this._zIndex=void 0,this._zIndexSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(mn.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),semiMajorAxis:C("semiMajorAxis"),semiMinorAxis:C("semiMinorAxis"),height:C("height"),heightReference:C("heightReference"),extrudedHeight:C("extrudedHeight"),extrudedHeightReference:C("extrudedHeightReference"),rotation:C("rotation"),stRotation:C("stRotation"),granularity:C("granularity"),fill:C("fill"),material:ht("material"),outline:C("outline"),outlineColor:C("outlineColor"),outlineWidth:C("outlineWidth"),numberOfVerticalLines:C("numberOfVerticalLines"),shadows:C("shadows"),distanceDisplayCondition:C("distanceDisplayCondition"),classificationType:C("classificationType"),zIndex:C("zIndex")});mn.prototype.clone=function(e){return u(e)?(e.show=this.show,e.semiMajorAxis=this.semiMajorAxis,e.semiMinorAxis=this.semiMinorAxis,e.height=this.height,e.heightReference=this.heightReference,e.extrudedHeight=this.extrudedHeight,e.extrudedHeightReference=this.extrudedHeightReference,e.rotation=this.rotation,e.stRotation=this.stRotation,e.granularity=this.granularity,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.numberOfVerticalLines=this.numberOfVerticalLines,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e.classificationType=this.classificationType,e.zIndex=this.zIndex,e):new mn(this)};mn.prototype.merge=function(e){if(!u(e))throw new N("source is required.");this.show=h(this.show,e.show),this.semiMajorAxis=h(this.semiMajorAxis,e.semiMajorAxis),this.semiMinorAxis=h(this.semiMinorAxis,e.semiMinorAxis),this.height=h(this.height,e.height),this.heightReference=h(this.heightReference,e.heightReference),this.extrudedHeight=h(this.extrudedHeight,e.extrudedHeight),this.extrudedHeightReference=h(this.extrudedHeightReference,e.extrudedHeightReference),this.rotation=h(this.rotation,e.rotation),this.stRotation=h(this.stRotation,e.stRotation),this.granularity=h(this.granularity,e.granularity),this.fill=h(this.fill,e.fill),this.material=h(this.material,e.material),this.outline=h(this.outline,e.outline),this.outlineColor=h(this.outlineColor,e.outlineColor),this.outlineWidth=h(this.outlineWidth,e.outlineWidth),this.numberOfVerticalLines=h(this.numberOfVerticalLines,e.numberOfVerticalLines),this.shadows=h(this.shadows,e.shadows),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition),this.classificationType=h(this.classificationType,e.classificationType),this.zIndex=h(this.zIndex,e.zIndex)};function gn(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._radii=void 0,this._radiiSubscription=void 0,this._innerRadii=void 0,this._innerRadiiSubscription=void 0,this._minimumClock=void 0,this._minimumClockSubscription=void 0,this._maximumClock=void 0,this._maximumClockSubscription=void 0,this._minimumCone=void 0,this._minimumConeSubscription=void 0,this._maximumCone=void 0,this._maximumConeSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._stackPartitions=void 0,this._stackPartitionsSubscription=void 0,this._slicePartitions=void 0,this._slicePartitionsSubscription=void 0,this._subdivisions=void 0,this._subdivisionsSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(gn.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),radii:C("radii"),innerRadii:C("innerRadii"),minimumClock:C("minimumClock"),maximumClock:C("maximumClock"),minimumCone:C("minimumCone"),maximumCone:C("maximumCone"),heightReference:C("heightReference"),fill:C("fill"),material:ht("material"),outline:C("outline"),outlineColor:C("outlineColor"),outlineWidth:C("outlineWidth"),stackPartitions:C("stackPartitions"),slicePartitions:C("slicePartitions"),subdivisions:C("subdivisions"),shadows:C("shadows"),distanceDisplayCondition:C("distanceDisplayCondition")});gn.prototype.clone=function(e){return u(e)?(e.show=this.show,e.radii=this.radii,e.innerRadii=this.innerRadii,e.minimumClock=this.minimumClock,e.maximumClock=this.maximumClock,e.minimumCone=this.minimumCone,e.maximumCone=this.maximumCone,e.heightReference=this.heightReference,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.stackPartitions=this.stackPartitions,e.slicePartitions=this.slicePartitions,e.subdivisions=this.subdivisions,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new gn(this)};gn.prototype.merge=function(e){if(!u(e))throw new N("source is required.");this.show=h(this.show,e.show),this.radii=h(this.radii,e.radii),this.innerRadii=h(this.innerRadii,e.innerRadii),this.minimumClock=h(this.minimumClock,e.minimumClock),this.maximumClock=h(this.maximumClock,e.maximumClock),this.minimumCone=h(this.minimumCone,e.minimumCone),this.maximumCone=h(this.maximumCone,e.maximumCone),this.heightReference=h(this.heightReference,e.heightReference),this.fill=h(this.fill,e.fill),this.material=h(this.material,e.material),this.outline=h(this.outline,e.outline),this.outlineColor=h(this.outlineColor,e.outlineColor),this.outlineWidth=h(this.outlineWidth,e.outlineWidth),this.stackPartitions=h(this.stackPartitions,e.stackPartitions),this.slicePartitions=h(this.slicePartitions,e.slicePartitions),this.subdivisions=h(this.subdivisions,e.subdivisions),this.shadows=h(this.shadows,e.shadows),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition)};function yn(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._text=void 0,this._textSubscription=void 0,this._font=void 0,this._fontSubscription=void 0,this._style=void 0,this._styleSubscription=void 0,this._scale=void 0,this._scaleSubscription=void 0,this._showBackground=void 0,this._showBackgroundSubscription=void 0,this._backgroundColor=void 0,this._backgroundColorSubscription=void 0,this._backgroundPadding=void 0,this._backgroundPaddingSubscription=void 0,this._pixelOffset=void 0,this._pixelOffsetSubscription=void 0,this._eyeOffset=void 0,this._eyeOffsetSubscription=void 0,this._horizontalOrigin=void 0,this._horizontalOriginSubscription=void 0,this._verticalOrigin=void 0,this._verticalOriginSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._fillColor=void 0,this._fillColorSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._translucencyByDistance=void 0,this._translucencyByDistanceSubscription=void 0,this._pixelOffsetScaleByDistance=void 0,this._pixelOffsetScaleByDistanceSubscription=void 0,this._scaleByDistance=void 0,this._scaleByDistanceSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._disableDepthTestDistance=void 0,this._disableDepthTestDistanceSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(yn.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),text:C("text"),font:C("font"),style:C("style"),scale:C("scale"),showBackground:C("showBackground"),backgroundColor:C("backgroundColor"),backgroundPadding:C("backgroundPadding"),pixelOffset:C("pixelOffset"),eyeOffset:C("eyeOffset"),horizontalOrigin:C("horizontalOrigin"),verticalOrigin:C("verticalOrigin"),heightReference:C("heightReference"),fillColor:C("fillColor"),outlineColor:C("outlineColor"),outlineWidth:C("outlineWidth"),translucencyByDistance:C("translucencyByDistance"),pixelOffsetScaleByDistance:C("pixelOffsetScaleByDistance"),scaleByDistance:C("scaleByDistance"),distanceDisplayCondition:C("distanceDisplayCondition"),disableDepthTestDistance:C("disableDepthTestDistance")});yn.prototype.clone=function(e){return u(e)?(e.show=this.show,e.text=this.text,e.font=this.font,e.style=this.style,e.scale=this.scale,e.showBackground=this.showBackground,e.backgroundColor=this.backgroundColor,e.backgroundPadding=this.backgroundPadding,e.pixelOffset=this.pixelOffset,e.eyeOffset=this.eyeOffset,e.horizontalOrigin=this.horizontalOrigin,e.verticalOrigin=this.verticalOrigin,e.heightReference=this.heightReference,e.fillColor=this.fillColor,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.translucencyByDistance=this.translucencyByDistance,e.pixelOffsetScaleByDistance=this.pixelOffsetScaleByDistance,e.scaleByDistance=this.scaleByDistance,e.distanceDisplayCondition=this.distanceDisplayCondition,e.disableDepthTestDistance=this.disableDepthTestDistance,e):new yn(this)};yn.prototype.merge=function(e){if(!u(e))throw new N("source is required.");this.show=h(this.show,e.show),this.text=h(this.text,e.text),this.font=h(this.font,e.font),this.style=h(this.style,e.style),this.scale=h(this.scale,e.scale),this.showBackground=h(this.showBackground,e.showBackground),this.backgroundColor=h(this.backgroundColor,e.backgroundColor),this.backgroundPadding=h(this.backgroundPadding,e.backgroundPadding),this.pixelOffset=h(this.pixelOffset,e.pixelOffset),this.eyeOffset=h(this.eyeOffset,e.eyeOffset),this.horizontalOrigin=h(this.horizontalOrigin,e.horizontalOrigin),this.verticalOrigin=h(this.verticalOrigin,e.verticalOrigin),this.heightReference=h(this.heightReference,e.heightReference),this.fillColor=h(this.fillColor,e.fillColor),this.outlineColor=h(this.outlineColor,e.outlineColor),this.outlineWidth=h(this.outlineWidth,e.outlineWidth),this.translucencyByDistance=h(this.translucencyByDistance,e.translucencyByDistance),this.pixelOffsetScaleByDistance=h(this.pixelOffsetScaleByDistance,e.pixelOffsetScaleByDistance),this.scaleByDistance=h(this.scaleByDistance,e.scaleByDistance),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition),this.disableDepthTestDistance=h(this.disableDepthTestDistance,e.disableDepthTestDistance)};const Mo=new Va;function wn(e){e=h(e,h.EMPTY_OBJECT),this._definitionChanged=new le,this._translation=void 0,this._translationSubscription=void 0,this._rotation=void 0,this._rotationSubscription=void 0,this._scale=void 0,this._scaleSubscription=void 0,this.translation=e.translation,this.rotation=e.rotation,this.scale=e.scale}Object.defineProperties(wn.prototype,{isConstant:{get:function(){return te.isConstant(this._translation)&&te.isConstant(this._rotation)&&te.isConstant(this._scale)}},definitionChanged:{get:function(){return this._definitionChanged}},translation:C("translation"),rotation:C("rotation"),scale:C("scale")});wn.prototype.getValue=function(e,t){return u(t)||(t=new Va),t.translation=te.getValueOrClonedDefault(this._translation,e,Mo.translation,t.translation),t.rotation=te.getValueOrClonedDefault(this._rotation,e,Mo.rotation,t.rotation),t.scale=te.getValueOrClonedDefault(this._scale,e,Mo.scale,t.scale),t};wn.prototype.equals=function(e){return this===e||e instanceof wn&&te.equals(this._translation,e._translation)&&te.equals(this._rotation,e._rotation)&&te.equals(this._scale,e._scale)};function ut(e,t){this._propertyNames=[],this._definitionChanged=new le,u(e)&&this.merge(e,t)}Object.defineProperties(ut.prototype,{propertyNames:{get:function(){return this._propertyNames}},isConstant:{get:function(){const e=this._propertyNames;for(let t=0,i=e.length;t<i;t++)if(!te.isConstant(this[e[t]]))return!1;return!0}},definitionChanged:{get:function(){return this._definitionChanged}}});ut.prototype.hasProperty=function(e){return this._propertyNames.indexOf(e)!==-1};function yh(e){return new Bt(e)}ut.prototype.addProperty=function(e,t,i){const n=this._propertyNames;if(!u(e))throw new N("propertyName is required.");if(n.indexOf(e)!==-1)throw new N(`${e} is already a registered property.`);n.push(e),Object.defineProperty(this,e,C(e,!0,h(i,yh))),u(t)&&(this[e]=t),this._definitionChanged.raiseEvent(this)};ut.prototype.removeProperty=function(e){const i=this._propertyNames.indexOf(e);if(!u(e))throw new N("propertyName is required.");if(i===-1)throw new N(`${e} is not a registered property.`);this._propertyNames.splice(i,1),delete this[e],this._definitionChanged.raiseEvent(this)};ut.prototype.getValue=function(e,t){if(!u(e))throw new N("time is required.");u(t)||(t={});const i=this._propertyNames;for(let n=0,o=i.length;n<o;n++){const s=i[n];t[s]=te.getValueOrUndefined(this[s],e,t[s])}return t};ut.prototype.merge=function(e,t){if(!u(e))throw new N("source is required.");const i=this._propertyNames,n=u(e._propertyNames)?e._propertyNames:Object.keys(e);for(let o=0,s=n.length;o<s;o++){const r=n[o],l=this[r],a=e[r];l===void 0&&i.indexOf(r)===-1&&this.addProperty(r,void 0,t),a!==void 0&&(l!==void 0?u(l)&&u(l.merge)&&l.merge(a):u(a)&&u(a.merge)&&u(a.clone)?this[r]=a.clone():this[r]=a)}};function wh(e,t){const i=e._propertyNames,n=t._propertyNames,o=i.length;if(o!==n.length)return!1;for(let s=0;s<o;++s){const r=i[s];if(n.indexOf(r)===-1||!te.equals(e[r],t[r]))return!1}return!0}ut.prototype.equals=function(e){return this===e||e instanceof ut&&wh(this,e)};function ol(e){return new wn(e)}function xh(e){return new ut(e,ol)}function Ch(e){return new ut(e)}function Ji(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._uri=void 0,this._uriSubscription=void 0,this._scale=void 0,this._scaleSubscription=void 0,this._minimumPixelSize=void 0,this._minimumPixelSizeSubscription=void 0,this._maximumScale=void 0,this._maximumScaleSubscription=void 0,this._incrementallyLoadTextures=void 0,this._incrementallyLoadTexturesSubscription=void 0,this._runAnimations=void 0,this._runAnimationsSubscription=void 0,this._clampAnimations=void 0,this._clampAnimationsSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._silhouetteColor=void 0,this._silhouetteColorSubscription=void 0,this._silhouetteSize=void 0,this._silhouetteSizeSubscription=void 0,this._color=void 0,this._colorSubscription=void 0,this._colorBlendMode=void 0,this._colorBlendModeSubscription=void 0,this._colorBlendAmount=void 0,this._colorBlendAmountSubscription=void 0,this._imageBasedLightingFactor=void 0,this._imageBasedLightingFactorSubscription=void 0,this._lightColor=void 0,this._lightColorSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._nodeTransformations=void 0,this._nodeTransformationsSubscription=void 0,this._articulations=void 0,this._articulationsSubscription=void 0,this._clippingPlanes=void 0,this._clippingPlanesSubscription=void 0,this._customShader=void 0,this._customShaderSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(Ji.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),uri:C("uri"),scale:C("scale"),minimumPixelSize:C("minimumPixelSize"),maximumScale:C("maximumScale"),incrementallyLoadTextures:C("incrementallyLoadTextures"),runAnimations:C("runAnimations"),clampAnimations:C("clampAnimations"),shadows:C("shadows"),heightReference:C("heightReference"),silhouetteColor:C("silhouetteColor"),silhouetteSize:C("silhouetteSize"),color:C("color"),colorBlendMode:C("colorBlendMode"),colorBlendAmount:C("colorBlendAmount"),imageBasedLightingFactor:C("imageBasedLightingFactor"),lightColor:C("lightColor"),distanceDisplayCondition:C("distanceDisplayCondition"),nodeTransformations:C("nodeTransformations",void 0,xh),articulations:C("articulations",void 0,Ch),clippingPlanes:C("clippingPlanes"),customShader:C("customShader")});Ji.prototype.clone=function(e){return u(e)?(e.show=this.show,e.uri=this.uri,e.scale=this.scale,e.minimumPixelSize=this.minimumPixelSize,e.maximumScale=this.maximumScale,e.incrementallyLoadTextures=this.incrementallyLoadTextures,e.runAnimations=this.runAnimations,e.clampAnimations=this.clampAnimations,e.heightReference=this._heightReference,e.silhouetteColor=this.silhouetteColor,e.silhouetteSize=this.silhouetteSize,e.color=this.color,e.colorBlendMode=this.colorBlendMode,e.colorBlendAmount=this.colorBlendAmount,e.imageBasedLightingFactor=this.imageBasedLightingFactor,e.lightColor=this.lightColor,e.distanceDisplayCondition=this.distanceDisplayCondition,e.nodeTransformations=this.nodeTransformations,e.articulations=this.articulations,e.clippingPlanes=this.clippingPlanes,e.customShader=this.customShader,e):new Ji(this)};Ji.prototype.merge=function(e){if(!u(e))throw new N("source is required.");this.show=h(this.show,e.show),this.uri=h(this.uri,e.uri),this.scale=h(this.scale,e.scale),this.minimumPixelSize=h(this.minimumPixelSize,e.minimumPixelSize),this.maximumScale=h(this.maximumScale,e.maximumScale),this.incrementallyLoadTextures=h(this.incrementallyLoadTextures,e.incrementallyLoadTextures),this.runAnimations=h(this.runAnimations,e.runAnimations),this.clampAnimations=h(this.clampAnimations,e.clampAnimations),this.shadows=h(this.shadows,e.shadows),this.heightReference=h(this.heightReference,e.heightReference),this.silhouetteColor=h(this.silhouetteColor,e.silhouetteColor),this.silhouetteSize=h(this.silhouetteSize,e.silhouetteSize),this.color=h(this.color,e.color),this.colorBlendMode=h(this.colorBlendMode,e.colorBlendMode),this.colorBlendAmount=h(this.colorBlendAmount,e.colorBlendAmount),this.imageBasedLightingFactor=h(this.imageBasedLightingFactor,e.imageBasedLightingFactor),this.lightColor=h(this.lightColor,e.lightColor),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition),this.clippingPlanes=h(this.clippingPlanes,e.clippingPlanes),this.customShader=h(this.customShader,e.customShader);const t=e.nodeTransformations;if(u(t)){const n=this.nodeTransformations;u(n)?n.merge(t):this.nodeTransformations=new ut(t,ol)}const i=e.articulations;if(u(i)){const n=this.articulations;u(n)?n.merge(i):this.articulations=new ut(i)}};function xn(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._uri=void 0,this._uriSubscription=void 0,this._maximumScreenSpaceError=void 0,this._maximumScreenSpaceErrorSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(xn.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),uri:C("uri"),maximumScreenSpaceError:C("maximumScreenSpaceError")});xn.prototype.clone=function(e){return u(e)?(e.show=this.show,e.uri=this.uri,e.maximumScreenSpaceError=this.maximumScreenSpaceError,e):new xn(this)};xn.prototype.merge=function(e){if(!u(e))throw new N("source is required.");this.show=h(this.show,e.show),this.uri=h(this.uri,e.uri),this.maximumScreenSpaceError=h(this.maximumScreenSpaceError,e.maximumScreenSpaceError)};function Cn(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._leadTime=void 0,this._leadTimeSubscription=void 0,this._trailTime=void 0,this._trailTimeSubscription=void 0,this._width=void 0,this._widthSubscription=void 0,this._resolution=void 0,this._resolutionSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(Cn.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),leadTime:C("leadTime"),trailTime:C("trailTime"),width:C("width"),resolution:C("resolution"),material:ht("material"),distanceDisplayCondition:C("distanceDisplayCondition")});Cn.prototype.clone=function(e){return u(e)?(e.show=this.show,e.leadTime=this.leadTime,e.trailTime=this.trailTime,e.width=this.width,e.resolution=this.resolution,e.material=this.material,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new Cn(this)};Cn.prototype.merge=function(e){if(!u(e))throw new N("source is required.");this.show=h(this.show,e.show),this.leadTime=h(this.leadTime,e.leadTime),this.trailTime=h(this.trailTime,e.trailTime),this.width=h(this.width,e.width),this.resolution=h(this.resolution,e.resolution),this.material=h(this.material,e.material),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition)};function Sn(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._plane=void 0,this._planeSubscription=void 0,this._dimensions=void 0,this._dimensionsSubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(Sn.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),plane:C("plane"),dimensions:C("dimensions"),fill:C("fill"),material:ht("material"),outline:C("outline"),outlineColor:C("outlineColor"),outlineWidth:C("outlineWidth"),shadows:C("shadows"),distanceDisplayCondition:C("distanceDisplayCondition")});Sn.prototype.clone=function(e){return u(e)?(e.show=this.show,e.plane=this.plane,e.dimensions=this.dimensions,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new Sn(this)};Sn.prototype.merge=function(e){if(!u(e))throw new N("source is required.");this.show=h(this.show,e.show),this.plane=h(this.plane,e.plane),this.dimensions=h(this.dimensions,e.dimensions),this.fill=h(this.fill,e.fill),this.material=h(this.material,e.material),this.outline=h(this.outline,e.outline),this.outlineColor=h(this.outlineColor,e.outlineColor),this.outlineWidth=h(this.outlineWidth,e.outlineWidth),this.shadows=h(this.shadows,e.shadows),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition)};function bn(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._pixelSize=void 0,this._pixelSizeSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._color=void 0,this._colorSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._scaleByDistance=void 0,this._scaleByDistanceSubscription=void 0,this._translucencyByDistance=void 0,this._translucencyByDistanceSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._disableDepthTestDistance=void 0,this._disableDepthTestDistanceSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(bn.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),pixelSize:C("pixelSize"),heightReference:C("heightReference"),color:C("color"),outlineColor:C("outlineColor"),outlineWidth:C("outlineWidth"),scaleByDistance:C("scaleByDistance"),translucencyByDistance:C("translucencyByDistance"),distanceDisplayCondition:C("distanceDisplayCondition"),disableDepthTestDistance:C("disableDepthTestDistance")});bn.prototype.clone=function(e){return u(e)?(e.show=this.show,e.pixelSize=this.pixelSize,e.heightReference=this.heightReference,e.color=this.color,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.scaleByDistance=this.scaleByDistance,e.translucencyByDistance=this._translucencyByDistance,e.distanceDisplayCondition=this.distanceDisplayCondition,e.disableDepthTestDistance=this.disableDepthTestDistance,e):new bn(this)};bn.prototype.merge=function(e){if(!u(e))throw new N("source is required.");this.show=h(this.show,e.show),this.pixelSize=h(this.pixelSize,e.pixelSize),this.heightReference=h(this.heightReference,e.heightReference),this.color=h(this.color,e.color),this.outlineColor=h(this.outlineColor,e.outlineColor),this.outlineWidth=h(this.outlineWidth,e.outlineWidth),this.scaleByDistance=h(this.scaleByDistance,e.scaleByDistance),this.translucencyByDistance=h(this._translucencyByDistance,e.translucencyByDistance),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition),this.disableDepthTestDistance=h(this.disableDepthTestDistance,e.disableDepthTestDistance)};function Sh(e){return Array.isArray(e)&&(e=new vc(e)),new Bt(e)}function En(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._hierarchy=void 0,this._hierarchySubscription=void 0,this._height=void 0,this._heightSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._extrudedHeight=void 0,this._extrudedHeightSubscription=void 0,this._extrudedHeightReference=void 0,this._extrudedHeightReferenceSubscription=void 0,this._stRotation=void 0,this._stRotationSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._perPositionHeight=void 0,this._perPositionHeightSubscription=void 0,this._closeTop=void 0,this._closeTopSubscription=void 0,this._closeBottom=void 0,this._closeBottomSubscription=void 0,this._arcType=void 0,this._arcTypeSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._classificationType=void 0,this._classificationTypeSubscription=void 0,this._zIndex=void 0,this._zIndexSubscription=void 0,this._textureCoordinates=void 0,this._textureCoordinatesSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(En.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),hierarchy:C("hierarchy",void 0,Sh),height:C("height"),heightReference:C("heightReference"),extrudedHeight:C("extrudedHeight"),extrudedHeightReference:C("extrudedHeightReference"),stRotation:C("stRotation"),granularity:C("granularity"),fill:C("fill"),material:ht("material"),outline:C("outline"),outlineColor:C("outlineColor"),outlineWidth:C("outlineWidth"),perPositionHeight:C("perPositionHeight"),closeTop:C("closeTop"),closeBottom:C("closeBottom"),arcType:C("arcType"),shadows:C("shadows"),distanceDisplayCondition:C("distanceDisplayCondition"),classificationType:C("classificationType"),zIndex:C("zIndex"),textureCoordinates:C("textureCoordinates")});En.prototype.clone=function(e){return u(e)?(e.show=this.show,e.hierarchy=this.hierarchy,e.height=this.height,e.heightReference=this.heightReference,e.extrudedHeight=this.extrudedHeight,e.extrudedHeightReference=this.extrudedHeightReference,e.stRotation=this.stRotation,e.granularity=this.granularity,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.perPositionHeight=this.perPositionHeight,e.closeTop=this.closeTop,e.closeBottom=this.closeBottom,e.arcType=this.arcType,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e.classificationType=this.classificationType,e.zIndex=this.zIndex,e.textureCoordinates=this.textureCoordinates,e):new En(this)};En.prototype.merge=function(e){if(!u(e))throw new N("source is required.");this.show=h(this.show,e.show),this.hierarchy=h(this.hierarchy,e.hierarchy),this.height=h(this.height,e.height),this.heightReference=h(this.heightReference,e.heightReference),this.extrudedHeight=h(this.extrudedHeight,e.extrudedHeight),this.extrudedHeightReference=h(this.extrudedHeightReference,e.extrudedHeightReference),this.stRotation=h(this.stRotation,e.stRotation),this.granularity=h(this.granularity,e.granularity),this.fill=h(this.fill,e.fill),this.material=h(this.material,e.material),this.outline=h(this.outline,e.outline),this.outlineColor=h(this.outlineColor,e.outlineColor),this.outlineWidth=h(this.outlineWidth,e.outlineWidth),this.perPositionHeight=h(this.perPositionHeight,e.perPositionHeight),this.closeTop=h(this.closeTop,e.closeTop),this.closeBottom=h(this.closeBottom,e.closeBottom),this.arcType=h(this.arcType,e.arcType),this.shadows=h(this.shadows,e.shadows),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition),this.classificationType=h(this.classificationType,e.classificationType),this.zIndex=h(this.zIndex,e.zIndex),this.textureCoordinates=h(this.textureCoordinates,e.textureCoordinates)};function Dn(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._positions=void 0,this._positionsSubscription=void 0,this._width=void 0,this._widthSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._depthFailMaterial=void 0,this._depthFailMaterialSubscription=void 0,this._arcType=void 0,this._arcTypeSubscription=void 0,this._clampToGround=void 0,this._clampToGroundSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._classificationType=void 0,this._classificationTypeSubscription=void 0,this._zIndex=void 0,this._zIndexSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(Dn.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),positions:C("positions"),width:C("width"),granularity:C("granularity"),material:ht("material"),depthFailMaterial:ht("depthFailMaterial"),arcType:C("arcType"),clampToGround:C("clampToGround"),shadows:C("shadows"),distanceDisplayCondition:C("distanceDisplayCondition"),classificationType:C("classificationType"),zIndex:C("zIndex")});Dn.prototype.clone=function(e){return u(e)?(e.show=this.show,e.positions=this.positions,e.width=this.width,e.granularity=this.granularity,e.material=this.material,e.depthFailMaterial=this.depthFailMaterial,e.arcType=this.arcType,e.clampToGround=this.clampToGround,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e.classificationType=this.classificationType,e.zIndex=this.zIndex,e):new Dn(this)};Dn.prototype.merge=function(e){if(!u(e))throw new N("source is required.");this.show=h(this.show,e.show),this.positions=h(this.positions,e.positions),this.width=h(this.width,e.width),this.granularity=h(this.granularity,e.granularity),this.material=h(this.material,e.material),this.depthFailMaterial=h(this.depthFailMaterial,e.depthFailMaterial),this.arcType=h(this.arcType,e.arcType),this.clampToGround=h(this.clampToGround,e.clampToGround),this.shadows=h(this.shadows,e.shadows),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition),this.classificationType=h(this.classificationType,e.classificationType),this.zIndex=h(this.zIndex,e.zIndex)};function Tn(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._positions=void 0,this._positionsSubscription=void 0,this._shape=void 0,this._shapeSubscription=void 0,this._cornerType=void 0,this._cornerTypeSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubsription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(Tn.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),positions:C("positions"),shape:C("shape"),cornerType:C("cornerType"),granularity:C("granularity"),fill:C("fill"),material:ht("material"),outline:C("outline"),outlineColor:C("outlineColor"),outlineWidth:C("outlineWidth"),shadows:C("shadows"),distanceDisplayCondition:C("distanceDisplayCondition")});Tn.prototype.clone=function(e){return u(e)?(e.show=this.show,e.positions=this.positions,e.shape=this.shape,e.cornerType=this.cornerType,e.granularity=this.granularity,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new Tn(this)};Tn.prototype.merge=function(e){if(!u(e))throw new N("source is required.");this.show=h(this.show,e.show),this.positions=h(this.positions,e.positions),this.shape=h(this.shape,e.shape),this.cornerType=h(this.cornerType,e.cornerType),this.granularity=h(this.granularity,e.granularity),this.fill=h(this.fill,e.fill),this.material=h(this.material,e.material),this.outline=h(this.outline,e.outline),this.outlineColor=h(this.outlineColor,e.outlineColor),this.outlineWidth=h(this.outlineWidth,e.outlineWidth),this.shadows=h(this.shadows,e.shadows),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition)};function Qi(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._coordinates=void 0,this._coordinatesSubscription=void 0,this._height=void 0,this._heightSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._extrudedHeight=void 0,this._extrudedHeightSubscription=void 0,this._extrudedHeightReference=void 0,this._extrudedHeightReferenceSubscription=void 0,this._rotation=void 0,this._rotationSubscription=void 0,this._stRotation=void 0,this._stRotationSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distancedisplayConditionSubscription=void 0,this._classificationType=void 0,this._classificationTypeSubscription=void 0,this._zIndex=void 0,this._zIndexSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(Qi.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),coordinates:C("coordinates"),height:C("height"),heightReference:C("heightReference"),extrudedHeight:C("extrudedHeight"),extrudedHeightReference:C("extrudedHeightReference"),rotation:C("rotation"),stRotation:C("stRotation"),granularity:C("granularity"),fill:C("fill"),material:ht("material"),outline:C("outline"),outlineColor:C("outlineColor"),outlineWidth:C("outlineWidth"),shadows:C("shadows"),distanceDisplayCondition:C("distanceDisplayCondition"),classificationType:C("classificationType"),zIndex:C("zIndex")});Qi.prototype.clone=function(e){return u(e)?(e.show=this.show,e.coordinates=this.coordinates,e.height=this.height,e.heightReference=this.heightReference,e.extrudedHeight=this.extrudedHeight,e.extrudedHeightReference=this.extrudedHeightReference,e.rotation=this.rotation,e.stRotation=this.stRotation,e.granularity=this.granularity,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e.classificationType=this.classificationType,e.zIndex=this.zIndex,e):new Qi(this)};Qi.prototype.merge=function(e){if(!u(e))throw new N("source is required.");this.show=h(this.show,e.show),this.coordinates=h(this.coordinates,e.coordinates),this.height=h(this.height,e.height),this.heightReference=h(this.heightReference,e.heightReference),this.extrudedHeight=h(this.extrudedHeight,e.extrudedHeight),this.extrudedHeightReference=h(this.extrudedHeightReference,e.extrudedHeightReference),this.rotation=h(this.rotation,e.rotation),this.stRotation=h(this.stRotation,e.stRotation),this.granularity=h(this.granularity,e.granularity),this.fill=h(this.fill,e.fill),this.material=h(this.material,e.material),this.outline=h(this.outline,e.outline),this.outlineColor=h(this.outlineColor,e.outlineColor),this.outlineWidth=h(this.outlineWidth,e.outlineWidth),this.shadows=h(this.shadows,e.shadows),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition),this.classificationType=h(this.classificationType,e.classificationType),this.zIndex=h(this.zIndex,e.zIndex)};function In(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._positions=void 0,this._positionsSubscription=void 0,this._minimumHeights=void 0,this._minimumHeightsSubscription=void 0,this._maximumHeights=void 0,this._maximumHeightsSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(In.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),positions:C("positions"),minimumHeights:C("minimumHeights"),maximumHeights:C("maximumHeights"),granularity:C("granularity"),fill:C("fill"),material:ht("material"),outline:C("outline"),outlineColor:C("outlineColor"),outlineWidth:C("outlineWidth"),shadows:C("shadows"),distanceDisplayCondition:C("distanceDisplayCondition")});In.prototype.clone=function(e){return u(e)?(e.show=this.show,e.positions=this.positions,e.minimumHeights=this.minimumHeights,e.maximumHeights=this.maximumHeights,e.granularity=this.granularity,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new In(this)};In.prototype.merge=function(e){if(!u(e))throw new N("source is required.");this.show=h(this.show,e.show),this.positions=h(this.positions,e.positions),this.minimumHeights=h(this.minimumHeights,e.minimumHeights),this.maximumHeights=h(this.maximumHeights,e.maximumHeights),this.granularity=h(this.granularity,e.granularity),this.fill=h(this.fill,e.fill),this.material=h(this.material,e.material),this.outline=h(this.outline,e.outline),this.outlineColor=h(this.outlineColor,e.outlineColor),this.outlineWidth=h(this.outlineWidth,e.outlineWidth),this.shadows=h(this.shadows,e.shadows),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition)};const bh=new ae,us=[];function Eh(e){return new vi(e)}function Dh(e){return C(e,void 0,Eh)}function ve(e,t){return C(e,void 0,function(i){return i instanceof t?i:new t(i)})}function nt(e){e=h(e,h.EMPTY_OBJECT);let t=e.id;u(t)||(t=Is()),this._availability=void 0,this._id=t,this._definitionChanged=new le,this._name=e.name,this._show=h(e.show,!0),this._parent=void 0,this._propertyNames=["billboard","box","corridor","cylinder","description","ellipse","ellipsoid","label","model","tileset","orientation","path","plane","point","polygon","polyline","polylineVolume","position","properties","rectangle","viewFrom","wall",...us],this._billboard=void 0,this._billboardSubscription=void 0,this._box=void 0,this._boxSubscription=void 0,this._corridor=void 0,this._corridorSubscription=void 0,this._cylinder=void 0,this._cylinderSubscription=void 0,this._description=void 0,this._descriptionSubscription=void 0,this._ellipse=void 0,this._ellipseSubscription=void 0,this._ellipsoid=void 0,this._ellipsoidSubscription=void 0,this._label=void 0,this._labelSubscription=void 0,this._model=void 0,this._modelSubscription=void 0,this._tileset=void 0,this._tilesetSubscription=void 0,this._orientation=void 0,this._orientationSubscription=void 0,this._path=void 0,this._pathSubscription=void 0,this._plane=void 0,this._planeSubscription=void 0,this._point=void 0,this._pointSubscription=void 0,this._polygon=void 0,this._polygonSubscription=void 0,this._polyline=void 0,this._polylineSubscription=void 0,this._polylineVolume=void 0,this._polylineVolumeSubscription=void 0,this._position=void 0,this._positionSubscription=void 0,this._properties=void 0,this._propertiesSubscription=void 0,this._rectangle=void 0,this._rectangleSubscription=void 0,this._viewFrom=void 0,this._viewFromSubscription=void 0,this._wall=void 0,this._wallSubscription=void 0,this._children=[],this.entityCollection=void 0,this.parent=e.parent,this.merge(e)}function fs(e,t,i){const n=t.length;for(let o=0;o<n;o++){const s=t[o],r=s._show;(!i&&r)!==(i&&r)&&fs(s,s._children,i)}e._definitionChanged.raiseEvent(e,"isShowing",i,!i)}Object.defineProperties(nt.prototype,{availability:hs("availability"),id:{get:function(){return this._id}},definitionChanged:{get:function(){return this._definitionChanged}},name:hs("name"),show:{get:function(){return this._show},set:function(e){if(!u(e))throw new N("value is required.");if(e===this._show)return;const t=this.isShowing;this._show=e;const i=this.isShowing;t!==i&&fs(this,this._children,i),this._definitionChanged.raiseEvent(this,"show",e,!e)}},isShowing:{get:function(){return this._show&&(!u(this.entityCollection)||this.entityCollection.show)&&(!u(this._parent)||this._parent.isShowing)}},parent:{get:function(){return this._parent},set:function(e){const t=this._parent;if(t===e)return;const i=this.isShowing;if(u(t)){const o=t._children.indexOf(this);t._children.splice(o,1)}this._parent=e,u(e)&&e._children.push(this);const n=this.isShowing;i!==n&&fs(this,this._children,n),this._definitionChanged.raiseEvent(this,"parent",e,t)}},propertyNames:{get:function(){return this._propertyNames}},billboard:ve("billboard",Ii),box:ve("box",fn),corridor:ve("corridor",pn),cylinder:ve("cylinder",_n),description:C("description"),ellipse:ve("ellipse",mn),ellipsoid:ve("ellipsoid",gn),label:ve("label",yn),model:ve("model",Ji),tileset:ve("tileset",xn),orientation:C("orientation"),path:ve("path",Cn),plane:ve("plane",Sn),point:ve("point",bn),polygon:ve("polygon",En),polyline:ve("polyline",Dn),polylineVolume:ve("polylineVolume",Tn),properties:ve("properties",ut),position:Dh("position"),rectangle:ve("rectangle",Qi),viewFrom:C("viewFrom"),wall:ve("wall",In)});nt.registerEntityType=function(e,t){Object.defineProperties(nt.prototype,{[e]:ve(e,t)}),us.includes(e)||us.push(e)};nt.prototype.isAvailable=function(e){if(!u(e))throw new N("time is required.");const t=this._availability;return!u(t)||t.contains(e)};nt.prototype.addProperty=function(e){const t=this._propertyNames;if(!u(e))throw new N("propertyName is required.");if(t.indexOf(e)!==-1)throw new N(`${e} is already a registered property.`);if(e in this)throw new N(`${e} is a reserved property name.`);t.push(e),Object.defineProperty(this,e,hs(e,!0))};nt.prototype.removeProperty=function(e){const i=this._propertyNames.indexOf(e);if(!u(e))throw new N("propertyName is required.");if(i===-1)throw new N(`${e} is not a registered property.`);this._propertyNames.splice(i,1),delete this[e]};nt.prototype.merge=function(e){if(!u(e))throw new N("source is required.");this.name=h(this.name,e.name),this.availability=h(this.availability,e.availability);const t=this._propertyNames,i=u(e._propertyNames)?e._propertyNames:Object.keys(e),n=i.length;for(let o=0;o<n;o++){const s=i[o];if(s==="parent"||s==="name"||s==="availability"||s==="children")continue;const r=this[s],l=e[s];!u(r)&&t.indexOf(s)===-1&&this.addProperty(s),u(l)&&(u(r)?u(r.merge)&&r.merge(l):u(l.merge)&&u(l.clone)?this[s]=l.clone():this[s]=l)}};const sl=new Mt,rl=new b,al=new Ts;nt.prototype.computeModelMatrix=function(e,t){Q.typeOf.object("time",e);const i=te.getValueOrUndefined(this._position,e,rl);if(!u(i))return;const n=te.getValueOrUndefined(this._orientation,e,al);return u(n)?t=qt.fromRotationTranslation(Mt.fromQuaternion(n,sl),i,t):t=un.eastNorthUpToFixedFrame(i,void 0,t),t};nt.prototype.computeModelMatrixForHeightReference=function(e,t,i,n,o){Q.typeOf.object("time",e);const s=te.getValueOrDefault(t,e,si.NONE);let r=te.getValueOrUndefined(this._position,e,rl);if(s===si.NONE||!u(r)||b.equalsEpsilon(r,b.ZERO,X.EPSILON8))return this.computeModelMatrix(e,o);const l=n.cartesianToCartographic(r,bh);Ac(s)?l.height=i:l.height+=i,r=n.cartographicToCartesian(l,r);const a=te.getValueOrUndefined(this._orientation,e,al);return u(a)?o=qt.fromRotationTranslation(Mt.fromQuaternion(a,sl),r,o):o=un.eastNorthUpToFixedFrame(r,void 0,o),o};nt.supportsMaterialsforEntitiesOnTerrain=function(e){return it.supportsMaterials(e)};nt.supportsPolylinesOnTerrain=function(e){return $t.isSupported(e)};function vn(e,t){this._callback=void 0,this._isConstant=void 0,this._definitionChanged=new le,this.setCallback(e,t)}Object.defineProperties(vn.prototype,{isConstant:{get:function(){return this._isConstant}},definitionChanged:{get:function(){return this._definitionChanged}}});vn.prototype.getValue=function(e,t){return this._callback(e,t)};vn.prototype.setCallback=function(e,t){if(!u(e))throw new N("callback is required.");if(!u(t))throw new N("isConstant is required.");const i=this._callback!==e||this._isConstant!==t;this._callback=e,this._isConstant=t,i&&this._definitionChanged.raiseEvent(this)};vn.prototype.equals=function(e){return this===e||e instanceof vn&&this._callback===e._callback&&this._isConstant===e._isConstant};const Tr={id:void 0};function Mn(e){if(e._firing){e._refire=!0;return}if(e._suspendCount===0){const t=e._addedEntities,i=e._removedEntities,n=e._changedEntities;if(n.length!==0||t.length!==0||i.length!==0){e._firing=!0;do{e._refire=!1;const o=t.values.slice(0),s=i.values.slice(0),r=n.values.slice(0);t.removeAll(),i.removeAll(),n.removeAll(),e._collectionChanged.raiseEvent(e,o,s,r)}while(e._refire);e._firing=!1}}}function We(e){this._owner=e,this._entities=new qi,this._addedEntities=new qi,this._removedEntities=new qi,this._changedEntities=new qi,this._suspendCount=0,this._collectionChanged=new le,this._id=Is(),this._show=!0,this._firing=!1,this._refire=!1}We.prototype.suspendEvents=function(){this._suspendCount++};We.prototype.resumeEvents=function(){if(this._suspendCount===0)throw new N("resumeEvents can not be called before suspendEvents.");this._suspendCount--,Mn(this)};Object.defineProperties(We.prototype,{collectionChanged:{get:function(){return this._collectionChanged}},id:{get:function(){return this._id}},values:{get:function(){return this._entities.values}},show:{get:function(){return this._show},set:function(e){if(!u(e))throw new N("value is required.");if(e===this._show)return;this.suspendEvents();let t;const i=[],n=this._entities.values,o=n.length;for(t=0;t<o;t++)i.push(n[t].isShowing);for(this._show=e,t=0;t<o;t++){const s=i[t],r=n[t];s!==r.isShowing&&r.definitionChanged.raiseEvent(r,"isShowing",r.isShowing,s)}this.resumeEvents()}},owner:{get:function(){return this._owner}}});We.prototype.computeAvailability=function(){let e=Ue.MAXIMUM_VALUE,t=Ue.MINIMUM_VALUE;const i=this._entities.values;for(let n=0,o=i.length;n<o;n++){const r=i[n].availability;if(u(r)){const l=r.start,a=r.stop;B.lessThan(l,e)&&!l.equals(Ue.MINIMUM_VALUE)&&(e=l),B.greaterThan(a,t)&&!a.equals(Ue.MAXIMUM_VALUE)&&(t=a)}}return Ue.MAXIMUM_VALUE.equals(e)&&(e=Ue.MINIMUM_VALUE),Ue.MINIMUM_VALUE.equals(t)&&(t=Ue.MAXIMUM_VALUE),new J({start:e,stop:t})};We.prototype.add=function(e){if(!u(e))throw new N("entity is required.");e instanceof nt||(e=new nt(e));const t=e.id,i=this._entities;if(i.contains(t))throw new N(`An entity with id ${t} already exists in this collection.`);return e.entityCollection=this,i.set(t,e),this._removedEntities.remove(t)||this._addedEntities.set(t,e),e.definitionChanged.addEventListener(We.prototype._onEntityDefinitionChanged,this),Mn(this),e};We.prototype.remove=function(e){return u(e)?this.removeById(e.id):!1};We.prototype.contains=function(e){if(!u(e))throw new N("entity is required");return this._entities.get(e.id)===e};We.prototype.removeById=function(e){if(!u(e))return!1;const i=this._entities.get(e);return this._entities.remove(e)?(this._addedEntities.remove(e)||(this._removedEntities.set(e,i),this._changedEntities.remove(e)),this._entities.remove(e),i.definitionChanged.removeEventListener(We.prototype._onEntityDefinitionChanged,this),Mn(this),!0):!1};We.prototype.removeAll=function(){const e=this._entities,t=e.length,i=e.values,n=this._addedEntities,o=this._removedEntities;for(let s=0;s<t;s++){const r=i[s],l=r.id,a=n.get(l);u(a)||(r.definitionChanged.removeEventListener(We.prototype._onEntityDefinitionChanged,this),o.set(l,r))}e.removeAll(),n.removeAll(),this._changedEntities.removeAll(),Mn(this)};We.prototype.getById=function(e){if(!u(e))throw new N("id is required.");return this._entities.get(e)};We.prototype.getOrCreateEntity=function(e){if(!u(e))throw new N("id is required.");let t=this._entities.get(e);return u(t)||(Tr.id=e,t=new nt(Tr),this.add(t)),t};We.prototype._onEntityDefinitionChanged=function(e){const t=e.id;this._addedEntities.contains(t)||this._changedEntities.set(t,e),Mn(this)};function As(){this._removalFunctions=[]}As.prototype.add=function(e,t,i){if(!u(e))throw new N("event is required");const n=e.addEventListener(t,i);this._removalFunctions.push(n);const o=this;return function(){n();const s=o._removalFunctions;s.splice(s.indexOf(n),1)}};As.prototype.removeAll=function(){const e=this._removalFunctions;for(let t=0,i=e.length;t<i;++t)e[t]();e.length=0};function Os(e,t){return B.compare(e.start,t.start)}function ye(e){if(this._intervals=[],this._changedEvent=new le,u(e)){const t=e.length;for(let i=0;i<t;i++)this.addInterval(e[i])}}Object.defineProperties(ye.prototype,{changedEvent:{get:function(){return this._changedEvent}},start:{get:function(){const e=this._intervals;return e.length===0?void 0:e[0].start}},isStartIncluded:{get:function(){const e=this._intervals;return e.length===0?!1:e[0].isStartIncluded}},stop:{get:function(){const e=this._intervals,t=e.length;return t===0?void 0:e[t-1].stop}},isStopIncluded:{get:function(){const e=this._intervals,t=e.length;return t===0?!1:e[t-1].isStopIncluded}},length:{get:function(){return this._intervals.length}},isEmpty:{get:function(){return this._intervals.length===0}}});ye.prototype.equals=function(e,t){if(this===e)return!0;if(!(e instanceof ye))return!1;const i=this._intervals,n=e._intervals,o=i.length;if(o!==n.length)return!1;for(let s=0;s<o;s++)if(!J.equals(i[s],n[s],t))return!1;return!0};ye.prototype.get=function(e){if(!u(e))throw new N("index is required.");return this._intervals[e]};ye.prototype.removeAll=function(){this._intervals.length>0&&(this._intervals.length=0,this._changedEvent.raiseEvent(this))};ye.prototype.findIntervalContainingDate=function(e){const t=this.indexOf(e);return t>=0?this._intervals[t]:void 0};ye.prototype.findDataForIntervalContainingDate=function(e){const t=this.indexOf(e);return t>=0?this._intervals[t].data:void 0};ye.prototype.contains=function(e){return this.indexOf(e)>=0};const ko=new J;ye.prototype.indexOf=function(e){if(!u(e))throw new N("date is required");const t=this._intervals;ko.start=e,ko.stop=e;let i=ci(t,ko,Os);return i>=0?t[i].isStartIncluded?i:i>0&&t[i-1].stop.equals(e)&&t[i-1].isStopIncluded?i-1:~i:(i=~i,i>0&&i-1<t.length&&J.contains(t[i-1],e)?i-1:~i)};ye.prototype.findInterval=function(e){e=h(e,h.EMPTY_OBJECT);const t=e.start,i=e.stop,n=e.isStartIncluded,o=e.isStopIncluded,s=this._intervals;for(let r=0,l=s.length;r<l;r++){const a=s[r];if((!u(t)||a.start.equals(t))&&(!u(i)||a.stop.equals(i))&&(!u(n)||a.isStartIncluded===n)&&(!u(o)||a.isStopIncluded===o))return s[r]}};ye.prototype.addInterval=function(e,t){if(!u(e))throw new N("interval is required");if(e.isEmpty)return;const i=this._intervals;if(i.length===0||B.greaterThan(e.start,i[i.length-1].stop)){i.push(e),this._changedEvent.raiseEvent(this);return}let n=ci(i,e,Os);n<0?n=~n:n>0&&e.isStartIncluded&&i[n-1].isStartIncluded&&i[n-1].start.equals(e.start)?--n:n<i.length&&!e.isStartIncluded&&i[n].isStartIncluded&&i[n].start.equals(e.start)&&++n;let o;for(n>0&&(o=B.compare(i[n-1].stop,e.start),(o>0||o===0&&(i[n-1].isStopIncluded||e.isStartIncluded))&&((u(t)?t(i[n-1].data,e.data):i[n-1].data===e.data)?(B.greaterThan(e.stop,i[n-1].stop)?e=new J({start:i[n-1].start,stop:e.stop,isStartIncluded:i[n-1].isStartIncluded,isStopIncluded:e.isStopIncluded,data:e.data}):e=new J({start:i[n-1].start,stop:i[n-1].stop,isStartIncluded:i[n-1].isStartIncluded,isStopIncluded:i[n-1].isStopIncluded||e.stop.equals(i[n-1].stop)&&e.isStopIncluded,data:e.data}),i.splice(n-1,1),--n):(o=B.compare(i[n-1].stop,e.stop),(o>0||o===0&&i[n-1].isStopIncluded&&!e.isStopIncluded)&&i.splice(n,0,new J({start:e.stop,stop:i[n-1].stop,isStartIncluded:!e.isStopIncluded,isStopIncluded:i[n-1].isStopIncluded,data:i[n-1].data})),i[n-1]=new J({start:i[n-1].start,stop:e.start,isStartIncluded:i[n-1].isStartIncluded,isStopIncluded:!e.isStartIncluded,data:i[n-1].data}))));n<i.length&&(o=B.compare(e.stop,i[n].start),o>0||o===0&&(e.isStopIncluded||i[n].isStartIncluded));)if(u(t)?t(i[n].data,e.data):i[n].data===e.data)e=new J({start:e.start,stop:B.greaterThan(i[n].stop,e.stop)?i[n].stop:e.stop,isStartIncluded:e.isStartIncluded,isStopIncluded:B.greaterThan(i[n].stop,e.stop)?i[n].isStopIncluded:e.isStopIncluded,data:e.data}),i.splice(n,1);else if(i[n]=new J({start:e.stop,stop:i[n].stop,isStartIncluded:!e.isStopIncluded,isStopIncluded:i[n].isStopIncluded,data:i[n].data}),i[n].isEmpty)i.splice(n,1);else break;i.splice(n,0,e),this._changedEvent.raiseEvent(this)};ye.prototype.removeInterval=function(e){if(!u(e))throw new N("interval is required");if(e.isEmpty)return!1;const t=this._intervals;let i=ci(t,e,Os);i<0&&(i=~i);let n=!1;for(i>0&&(B.greaterThan(t[i-1].stop,e.start)||t[i-1].stop.equals(e.start)&&t[i-1].isStopIncluded&&e.isStartIncluded)&&(n=!0,(B.greaterThan(t[i-1].stop,e.stop)||t[i-1].isStopIncluded&&!e.isStopIncluded&&t[i-1].stop.equals(e.stop))&&t.splice(i,0,new J({start:e.stop,stop:t[i-1].stop,isStartIncluded:!e.isStopIncluded,isStopIncluded:t[i-1].isStopIncluded,data:t[i-1].data})),t[i-1]=new J({start:t[i-1].start,stop:e.start,isStartIncluded:t[i-1].isStartIncluded,isStopIncluded:!e.isStartIncluded,data:t[i-1].data})),i<t.length&&!e.isStartIncluded&&t[i].isStartIncluded&&e.start.equals(t[i].start)&&(n=!0,t.splice(i,0,new J({start:t[i].start,stop:t[i].start,isStartIncluded:!0,isStopIncluded:!0,data:t[i].data})),++i);i<t.length&&B.greaterThan(e.stop,t[i].stop);)n=!0,t.splice(i,1);return i<t.length&&e.stop.equals(t[i].stop)&&(n=!0,!e.isStopIncluded&&t[i].isStopIncluded?i+1<t.length&&t[i+1].start.equals(e.stop)&&t[i].data===t[i+1].data?(t.splice(i,1),t[i]=new J({start:t[i].start,stop:t[i].stop,isStartIncluded:!0,isStopIncluded:t[i].isStopIncluded,data:t[i].data})):t[i]=new J({start:e.stop,stop:e.stop,isStartIncluded:!0,isStopIncluded:!0,data:t[i].data}):t.splice(i,1)),i<t.length&&(B.greaterThan(e.stop,t[i].start)||e.stop.equals(t[i].start)&&e.isStopIncluded&&t[i].isStartIncluded)&&(n=!0,t[i]=new J({start:e.stop,stop:t[i].stop,isStartIncluded:!e.isStopIncluded,isStopIncluded:t[i].isStopIncluded,data:t[i].data})),n&&this._changedEvent.raiseEvent(this),n};ye.prototype.intersect=function(e,t,i){if(!u(e))throw new N("other is required.");const n=new ye;let o=0,s=0;const r=this._intervals,l=e._intervals;for(;o<r.length&&s<l.length;){const a=r[o],c=l[s];if(B.lessThan(a.stop,c.start))++o;else if(B.lessThan(c.stop,a.start))++s;else{if(u(i)||u(t)&&t(a.data,c.data)||!u(t)&&c.data===a.data){const d=J.intersect(a,c,new J,i);d.isEmpty||n.addInterval(d,t)}B.lessThan(a.stop,c.stop)||a.stop.equals(c.stop)&&!a.isStopIncluded&&c.isStopIncluded?++o:++s}}return n};ye.fromJulianDateArray=function(e,t){if(!u(e))throw new N("options is required.");if(!u(e.julianDates))throw new N("options.iso8601Array is required.");u(t)||(t=new ye);const i=e.julianDates,n=i.length,o=e.dataCallback,s=h(e.isStartIncluded,!0),r=h(e.isStopIncluded,!0),l=h(e.leadingInterval,!1),a=h(e.trailingInterval,!1);let c,d=0;l&&(++d,c=new J({start:Ue.MINIMUM_VALUE,stop:i[0],isStartIncluded:!0,isStopIncluded:!s}),c.data=u(o)?o(c,t.length):t.length,t.addInterval(c));for(let g=0;g<n-1;++g){let m=i[g];const y=i[g+1];c=new J({start:m,stop:y,isStartIncluded:t.length===d?s:!0,isStopIncluded:g===n-2?r:!1}),c.data=u(o)?o(c,t.length):t.length,t.addInterval(c),m=y}return a&&(c=new J({start:i[n-1],stop:Ue.MAXIMUM_VALUE,isStartIncluded:!r,isStopIncluded:!0}),c.data=u(o)?o(c,t.length):t.length,t.addInterval(c)),t};const Fe=new Ha,nn=[0,31,28,31,30,31,30,31,31,30,31,30,31];function ps(e,t,i){u(i)||(i=new B),B.toGregorianDate(e,Fe);let n=Fe.millisecond+t.millisecond,o=Fe.second+t.second,s=Fe.minute+t.minute,r=Fe.hour+t.hour,l=Fe.day+t.day,a=Fe.month+t.month,c=Fe.year+t.year;for(n>=1e3&&(o+=Math.floor(n/1e3),n=n%1e3),o>=60&&(s+=Math.floor(o/60),o=o%60),s>=60&&(r+=Math.floor(s/60),s=s%60),r>=24&&(l+=Math.floor(r/24),r=r%24),nn[2]=Ys(c)?29:28;l>nn[a]||a>=13;)l>nn[a]&&(l-=nn[a],++a),a>=13&&(--a,c+=Math.floor(a/12),a=a%12,++a),nn[2]=Ys(c)?29:28;return Fe.millisecond=n,Fe.second=o,Fe.minute=s,Fe.hour=r,Fe.day=l,Fe.month=a,Fe.year=c,B.fromGregorianDate(Fe,i)}const Th=new B,Ih=/P(?:([\d.,]+)Y)?(?:([\d.,]+)M)?(?:([\d.,]+)W)?(?:([\d.,]+)D)?(?:T(?:([\d.,]+)H)?(?:([\d.,]+)M)?(?:([\d.,]+)S)?)?/;function ll(e,t){if(!u(e)||e.length===0)return!1;if(t.year=0,t.month=0,t.day=0,t.hour=0,t.minute=0,t.second=0,t.millisecond=0,e[0]==="P"){const i=e.match(Ih);if(!u(i))return!1;if(u(i[1])&&(t.year=Number(i[1].replace(",","."))),u(i[2])&&(t.month=Number(i[2].replace(",","."))),u(i[3])&&(t.day=Number(i[3].replace(",","."))*7),u(i[4])&&(t.day+=Number(i[4].replace(",","."))),u(i[5])&&(t.hour=Number(i[5].replace(",","."))),u(i[6])&&(t.minute=Number(i[6].replace(",","."))),u(i[7])){const n=Number(i[7].replace(",","."));t.second=Math.floor(n),t.millisecond=n%1*1e3}}else e[e.length-1]!=="Z"&&(e+="Z"),B.toGregorianDate(B.fromIso8601(e,Th),t);return t.year||t.month||t.day||t.hour||t.minute||t.second||t.millisecond}const hn=new Ha;ye.fromIso8601=function(e,t){if(!u(e))throw new N("options is required.");if(!u(e.iso8601))throw new N("options.iso8601 is required.");const i=e.iso8601.split("/"),n=B.fromIso8601(i[0]),o=B.fromIso8601(i[1]),s=[];if(!ll(i[2],hn))s.push(n,o);else{let r=B.clone(n);for(s.push(r);B.compare(r,o)<0;)r=ps(r,hn),B.compare(o,r)<=0&&B.clone(o,r),s.push(r)}return ye.fromJulianDateArray({julianDates:s,isStartIncluded:e.isStartIncluded,isStopIncluded:e.isStopIncluded,leadingInterval:e.leadingInterval,trailingInterval:e.trailingInterval,dataCallback:e.dataCallback},t)};ye.fromIso8601DateArray=function(e,t){if(!u(e))throw new N("options is required.");if(!u(e.iso8601Dates))throw new N("options.iso8601Dates is required.");return ye.fromJulianDateArray({julianDates:e.iso8601Dates.map(function(i){return B.fromIso8601(i)}),isStartIncluded:e.isStartIncluded,isStopIncluded:e.isStopIncluded,leadingInterval:e.leadingInterval,trailingInterval:e.trailingInterval,dataCallback:e.dataCallback},t)};ye.fromIso8601DurationArray=function(e,t){if(!u(e))throw new N("options is required.");if(!u(e.epoch))throw new N("options.epoch is required.");if(!u(e.iso8601Durations))throw new N("options.iso8601Durations is required.");const i=e.epoch,n=e.iso8601Durations,o=h(e.relativeToPrevious,!1),s=[];let r,l;const a=n.length;for(let c=0;c<a;++c)(ll(n[c],hn)||c===0)&&(o&&u(l)?r=ps(l,hn):r=ps(i,hn),s.push(r),l=r);return ye.fromJulianDateArray({julianDates:s,isStartIncluded:e.isStartIncluded,isStopIncluded:e.isStopIncluded,leadingInterval:e.leadingInterval,trailingInterval:e.trailingInterval,dataCallback:e.dataCallback},t)};function vh(e,t,i,n){function o(){i.raiseEvent(e)}const s=[];t.removeAll();const r=n.length;for(let l=0;l<r;l++){const a=n.get(l);u(a.data)&&s.indexOf(a.data)===-1&&t.add(a.data.definitionChanged,o)}}function Ai(){this._eventHelper=new As,this._definitionChanged=new le,this._intervals=new ye,this._intervals.changedEvent.addEventListener(Ai.prototype._intervalsChanged,this)}Object.defineProperties(Ai.prototype,{isConstant:{get:function(){return this._intervals.isEmpty}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._intervals}}});Ai.prototype.getValue=function(e,t){if(!u(e))throw new N("time is required");const i=this._intervals.findDataForIntervalContainingDate(e);if(u(i))return i.getValue(e,t)};Ai.prototype.equals=function(e){return this===e||e instanceof Ai&&this._intervals.equals(e._intervals,te.equals)};Ai.prototype._intervalsChanged=function(){vh(this,this._eventHelper,this._definitionChanged,this._intervals),this._definitionChanged.raiseEvent(this)};function hi(e){this._referenceFrame=h(e,xt.FIXED),this._definitionChanged=new le,this._composite=new Ai,this._composite.definitionChanged.addEventListener(hi.prototype._raiseDefinitionChanged,this)}Object.defineProperties(hi.prototype,{isConstant:{get:function(){return this._composite.isConstant}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._composite.intervals}},referenceFrame:{get:function(){return this._referenceFrame},set:function(e){this._referenceFrame=e}}});hi.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,xt.FIXED,t)};hi.prototype.getValueInReferenceFrame=function(e,t,i){if(!u(e))throw new N("time is required.");if(!u(t))throw new N("referenceFrame is required.");const n=this._composite._intervals.findDataForIntervalContainingDate(e);if(u(n))return n.getValueInReferenceFrame(e,t,i)};hi.prototype.equals=function(e){return this===e||e instanceof hi&&this._referenceFrame===e._referenceFrame&&this._composite.equals(e._composite,te.equals)};hi.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)};const Ah={NONE:0,HOLD:1,EXTRAPOLATE:2},Yi=Object.freeze(Ah),Ps={type:"Linear"};Ps.getRequiredDataPoints=function(e){return 2};Ps.interpolateOrderZero=function(e,t,i,n,o){if(t.length!==2)throw new N("The xTable provided to the linear interpolator must have exactly two elements.");if(n<=0)throw new N("There must be at least 1 dependent variable for each independent variable.");u(o)||(o=new Array(n));let s,r,l;const a=t[0],c=t[1];if(a===c)throw new N("Divide by zero error: xTable[0] and xTable[1] are equal");for(s=0;s<n;s++)r=i[s],l=i[s+n],o[s]=((l-r)*e+c*r-a*l)/(c-a);return o};const Oh=Ps;let _s;typeof performance<"u"&&typeof performance.now=="function"&&isFinite(performance.now())?_s=function(){return performance.now()}:_s=function(){return Date.now()};const cl=_s,Ir={packedLength:1,pack:function(e,t,i){i=h(i,0),t[i]=e},unpack:function(e,t,i){return t=h(t,0),e[t]}};function vr(e,t,i){let n;const o=e.length,s=i.length,r=o+s;if(e.length=r,o!==t){let l=o-1;for(n=r-1;n>=t;n--)e[n]=e[l--]}for(n=0;n<s;n++)e[t++]=i[n]}function Ar(e,t){return e instanceof B?e:typeof e=="string"?B.fromIso8601(e):B.addSeconds(t,e,new B)}const Fo=[],zo=[];function po(e,t,i,n,o){let s=0,r,l,a,c,d,g;for(;s<n.length;){d=Ar(n[s],e),a=ci(t,d,B.compare);let m=0,y=0;if(a<0){for(a=~a,c=a*o,l=void 0,g=t[a];s<n.length&&(d=Ar(n[s],e),!(u(l)&&B.compare(l,d)>=0||u(g)&&B.compare(d,g)>=0));){for(Fo[m++]=d,s=s+1,r=0;r<o;r++)zo[y++]=n[s],s=s+1;l=d}m>0&&(zo.length=y,vr(i,c,zo),Fo.length=m,vr(t,a,Fo))}else{for(r=0;r<o;r++)s++,i[a*o+r]=n[s];s++}}}function St(e,t){Q.defined("type",e);let i=e;i===Number&&(i=Ir);let n=i.packedLength,o=h(i.packedInterpolationLength,n),s=0,r;if(u(t)){const l=t.length;r=new Array(l);for(let a=0;a<l;a++){let c=t[a];c===Number&&(c=Ir);const d=c.packedLength;n+=d,o+=h(c.packedInterpolationLength,d),r[a]=c}s=l}this._type=e,this._innerType=i,this._interpolationDegree=1,this._interpolationAlgorithm=Oh,this._numberOfPoints=0,this._times=[],this._values=[],this._xTable=[],this._yTable=[],this._packedLength=n,this._packedInterpolationLength=o,this._updateTableLength=!0,this._interpolationResult=new Array(o),this._definitionChanged=new le,this._derivativeTypes=t,this._innerDerivativeTypes=r,this._inputOrder=s,this._forwardExtrapolationType=Yi.NONE,this._forwardExtrapolationDuration=0,this._backwardExtrapolationType=Yi.NONE,this._backwardExtrapolationDuration=0}Object.defineProperties(St.prototype,{isConstant:{get:function(){return this._values.length===0}},definitionChanged:{get:function(){return this._definitionChanged}},type:{get:function(){return this._type}},derivativeTypes:{get:function(){return this._derivativeTypes}},interpolationDegree:{get:function(){return this._interpolationDegree}},interpolationAlgorithm:{get:function(){return this._interpolationAlgorithm}},forwardExtrapolationType:{get:function(){return this._forwardExtrapolationType},set:function(e){this._forwardExtrapolationType!==e&&(this._forwardExtrapolationType=e,this._definitionChanged.raiseEvent(this))}},forwardExtrapolationDuration:{get:function(){return this._forwardExtrapolationDuration},set:function(e){this._forwardExtrapolationDuration!==e&&(this._forwardExtrapolationDuration=e,this._definitionChanged.raiseEvent(this))}},backwardExtrapolationType:{get:function(){return this._backwardExtrapolationType},set:function(e){this._backwardExtrapolationType!==e&&(this._backwardExtrapolationType=e,this._definitionChanged.raiseEvent(this))}},backwardExtrapolationDuration:{get:function(){return this._backwardExtrapolationDuration},set:function(e){this._backwardExtrapolationDuration!==e&&(this._backwardExtrapolationDuration=e,this._definitionChanged.raiseEvent(this))}}});St.prototype.getValue=function(e,t){Q.defined("time",e);const i=this._times,n=i.length;if(n===0)return;let o;const s=this._innerType,r=this._values;let l=ci(i,e,B.compare);if(l<0){if(l=~l,l===0){const I=i[l];if(o=this._backwardExtrapolationDuration,this._backwardExtrapolationType===Yi.NONE||o!==0&&B.secondsDifference(I,e)>o)return;if(this._backwardExtrapolationType===Yi.HOLD)return s.unpack(r,0,t)}if(l>=n){l=n-1;const I=i[l];if(o=this._forwardExtrapolationDuration,this._forwardExtrapolationType===Yi.NONE||o!==0&&B.secondsDifference(e,I)>o)return;if(this._forwardExtrapolationType===Yi.HOLD)return l=n-1,s.unpack(r,l*s.packedLength,t)}const a=this._xTable,c=this._yTable,d=this._interpolationAlgorithm,g=this._packedInterpolationLength,m=this._inputOrder;if(this._updateTableLength){this._updateTableLength=!1;const I=Math.min(d.getRequiredDataPoints(this._interpolationDegree,m),n);I!==this._numberOfPoints&&(this._numberOfPoints=I,a.length=I,c.length=I*g)}const y=this._numberOfPoints-1;if(y<1)return;let w=0,p=n-1;if(p-w+1>=y+1){let I=l-(y/2|0)-1;I<w&&(I=w);let D=I+y;D>p&&(D=p,I=D-y,I<w&&(I=w)),w=I,p=D}const _=p-w+1;for(let I=0;I<_;++I)a[I]=B.secondsDifference(i[w+I],i[p]);if(u(s.convertPackedArrayForInterpolation))s.convertPackedArrayForInterpolation(r,w,p,c);else{let I=0;const D=this._packedLength;let E=w*D;const T=(p+1)*D;for(;E<T;)c[I]=r[E],E++,I++}const x=B.secondsDifference(e,i[p]);let S;if(m===0||!u(d.interpolate))S=d.interpolateOrderZero(x,a,c,g,this._interpolationResult);else{const I=Math.floor(g/(m+1));S=d.interpolate(x,a,c,I,m,m,this._interpolationResult)}return u(s.unpackInterpolationResult)?s.unpackInterpolationResult(S,r,w,p,t):s.unpack(S,0,t)}return s.unpack(r,l*this._packedLength,t)};St.prototype.setInterpolationOptions=function(e){if(!u(e))return;let t=!1;const i=e.interpolationAlgorithm,n=e.interpolationDegree;u(i)&&this._interpolationAlgorithm!==i&&(this._interpolationAlgorithm=i,t=!0),u(n)&&this._interpolationDegree!==n&&(this._interpolationDegree=n,t=!0),t&&(this._updateTableLength=!0,this._definitionChanged.raiseEvent(this))};St.prototype.addSample=function(e,t,i){const n=this._innerDerivativeTypes,o=u(n);Q.defined("time",e),Q.defined("value",t),o&&Q.defined("derivatives",i);const s=this._innerType,r=[];if(r.push(e),s.pack(t,r,r.length),o){const l=n.length;for(let a=0;a<l;a++)n[a].pack(i[a],r,r.length)}po(void 0,this._times,this._values,r,this._packedLength),this._updateTableLength=!0,this._definitionChanged.raiseEvent(this)};St.prototype.addSamples=function(e,t,i){const n=this._innerDerivativeTypes,o=u(n);if(Q.defined("times",e),Q.defined("values",t),e.length!==t.length)throw new N("times and values must be the same length.");if(o&&(!u(i)||i.length!==e.length))throw new N("times and derivativeValues must be the same length.");const s=this._innerType,r=e.length,l=[];for(let a=0;a<r;a++)if(l.push(e[a]),s.pack(t[a],l,l.length),o){const c=i[a],d=n.length;for(let g=0;g<d;g++)n[g].pack(c[g],l,l.length)}po(void 0,this._times,this._values,l,this._packedLength),this._updateTableLength=!0,this._definitionChanged.raiseEvent(this)};St.prototype.addSamplesPackedArray=function(e,t){Q.defined("packedSamples",e),po(t,this._times,this._values,e,this._packedLength),this._updateTableLength=!0,this._definitionChanged.raiseEvent(this)};St.prototype.removeSample=function(e){Q.defined("time",e);const t=ci(this._times,e,B.compare);return t<0?!1:(dl(this,t,1),!0)};function dl(e,t,i){const n=e._packedLength;e._times.splice(t,i),e._values.splice(t*n,i*n),e._updateTableLength=!0,e._definitionChanged.raiseEvent(e)}St.prototype.removeSamples=function(e){Q.defined("timeInterval",e);const t=this._times;let i=ci(t,e.start,B.compare);i<0?i=~i:e.isStartIncluded||++i;let n=ci(t,e.stop,B.compare);n<0?n=~n:e.isStopIncluded&&++n,dl(this,i,n-i)};St.prototype.equals=function(e){if(this===e)return!0;if(!u(e)||this._type!==e._type||this._interpolationDegree!==e._interpolationDegree||this._interpolationAlgorithm!==e._interpolationAlgorithm)return!1;const t=this._derivativeTypes,i=u(t),n=e._derivativeTypes,o=u(n);if(i!==o)return!1;let s,r;if(i){if(r=t.length,r!==n.length)return!1;for(s=0;s<r;s++)if(t[s]!==n[s])return!1}const l=this._times,a=e._times;if(r=l.length,r!==a.length)return!1;for(s=0;s<r;s++)if(!B.equals(l[s],a[s]))return!1;const c=this._values,d=e._values;for(r=c.length,s=0;s<r;s++)if(c[s]!==d[s])return!1;return!0};St._mergeNewSamples=po;function Ct(e,t){t=h(t,0);let i;if(t>0){i=new Array(t);for(let n=0;n<t;n++)i[n]=b}this._numberOfDerivatives=t,this._property=new St(b,i),this._definitionChanged=new le,this._referenceFrame=h(e,xt.FIXED),this._property._definitionChanged.addEventListener(function(){this._definitionChanged.raiseEvent(this)},this)}Object.defineProperties(Ct.prototype,{isConstant:{get:function(){return this._property.isConstant}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return this._referenceFrame}},interpolationDegree:{get:function(){return this._property.interpolationDegree}},interpolationAlgorithm:{get:function(){return this._property.interpolationAlgorithm}},numberOfDerivatives:{get:function(){return this._numberOfDerivatives}},forwardExtrapolationType:{get:function(){return this._property.forwardExtrapolationType},set:function(e){this._property.forwardExtrapolationType=e}},forwardExtrapolationDuration:{get:function(){return this._property.forwardExtrapolationDuration},set:function(e){this._property.forwardExtrapolationDuration=e}},backwardExtrapolationType:{get:function(){return this._property.backwardExtrapolationType},set:function(e){this._property.backwardExtrapolationType=e}},backwardExtrapolationDuration:{get:function(){return this._property.backwardExtrapolationDuration},set:function(e){this._property.backwardExtrapolationDuration=e}}});Ct.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,xt.FIXED,t)};Ct.prototype.getValueInReferenceFrame=function(e,t,i){if(Q.defined("time",e),Q.defined("referenceFrame",t),i=this._property.getValue(e,i),u(i))return Ri.convertToReferenceFrame(e,i,this._referenceFrame,t,i)};Ct.prototype.setInterpolationOptions=function(e){this._property.setInterpolationOptions(e)};Ct.prototype.addSample=function(e,t,i){const n=this._numberOfDerivatives;if(n>0&&(!u(i)||i.length!==n))throw new N("derivatives length must be equal to the number of derivatives.");this._property.addSample(e,t,i)};Ct.prototype.addSamples=function(e,t,i){this._property.addSamples(e,t,i)};Ct.prototype.addSamplesPackedArray=function(e,t){this._property.addSamplesPackedArray(e,t)};Ct.prototype.removeSample=function(e){return this._property.removeSample(e)};Ct.prototype.removeSamples=function(e){this._property.removeSamples(e)};Ct.prototype.equals=function(e){return this===e||e instanceof Ct&&te.equals(this._property,e._property)&&this._referenceFrame===e._referenceFrame};function ui(e){this._definitionChanged=new le,this._value=void 0,this._removeSubscription=void 0,this.setValue(e)}Object.defineProperties(ui.prototype,{isConstant:{get:function(){return te.isConstant(this._value)}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return u(this._value)?this._value.referenceFrame:xt.FIXED}}});ui.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,xt.FIXED,t)};ui.prototype.setValue=function(e){this._value!==e&&(this._value=e,u(this._removeSubscription)&&(this._removeSubscription(),this._removeSubscription=void 0),u(e)&&(this._removeSubscription=e.definitionChanged.addEventListener(this._raiseDefinitionChanged,this)),this._definitionChanged.raiseEvent(this))};ui.prototype.getValueInReferenceFrame=function(e,t,i){if(!u(e))throw new N("time is required.");if(!u(t))throw new N("referenceFrame is required.");if(u(this._value))return i=this._value.getValueInReferenceFrame(e,t,i),u(i)?li.default.scaleToGeodeticSurface(i,i):void 0};ui.prototype.equals=function(e){return this===e||e instanceof ui&&this._value===e._value};ui.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)};const An=15,ms=30,gs=19,Ph=29,ao=256,Rs=ao+1+Ph,Or=2*Rs+1,on=256,Rh=7,Pr=16,Rr=17,Lr=18,Bo=8*2,lo=-1,Lh=1,qn=2,Nh=0,Wi=0,Nr=1,Mh=3,Ze=4,It=0,hl=1,Gn=2,vt=-2,kh=-3,Ui=-5;function _o(e){return mo(e.map(([t,i])=>new Array(t).fill(i,0,t)))}function mo(e){return e.reduce((t,i)=>t.concat(Array.isArray(i)?mo(i):i),[])}const Mr=[0,1,2,3].concat(..._o([[2,4],[2,5],[4,6],[4,7],[8,8],[8,9],[16,10],[16,11],[32,12],[32,13],[64,14],[64,15],[2,0],[1,16],[1,17],[2,18],[2,19],[4,20],[4,21],[8,22],[8,23],[16,24],[16,25],[32,26],[32,27],[64,28],[64,29]]));function fe(){const e=this;function t(o){const s=e.dyn_tree,r=e.stat_desc.static_tree,l=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,c=e.stat_desc.max_length;let d,g,m,y,w,p,f=0;for(y=0;y<=An;y++)o.bl_count[y]=0;for(s[o.heap[o.heap_max]*2+1]=0,d=o.heap_max+1;d<Or;d++)g=o.heap[d],y=s[s[g*2+1]*2+1]+1,y>c&&(y=c,f++),s[g*2+1]=y,!(g>e.max_code)&&(o.bl_count[y]++,w=0,g>=a&&(w=l[g-a]),p=s[g*2],o.opt_len+=p*(y+w),r&&(o.static_len+=p*(r[g*2+1]+w)));if(f!==0){do{for(y=c-1;o.bl_count[y]===0;)y--;o.bl_count[y]--,o.bl_count[y+1]+=2,o.bl_count[c]--,f-=2}while(f>0);for(y=c;y!==0;y--)for(g=o.bl_count[y];g!==0;)m=o.heap[--d],!(m>e.max_code)&&(s[m*2+1]!=y&&(o.opt_len+=(y-s[m*2+1])*s[m*2],s[m*2+1]=y),g--)}}function i(o,s){let r=0;do r|=o&1,o>>>=1,r<<=1;while(--s>0);return r>>>1}function n(o,s,r){const l=[];let a=0,c,d,g;for(c=1;c<=An;c++)l[c]=a=a+r[c-1]<<1;for(d=0;d<=s;d++)g=o[d*2+1],g!==0&&(o[d*2]=i(l[g]++,g))}e.build_tree=function(o){const s=e.dyn_tree,r=e.stat_desc.static_tree,l=e.stat_desc.elems;let a,c,d=-1,g;for(o.heap_len=0,o.heap_max=Or,a=0;a<l;a++)s[a*2]!==0?(o.heap[++o.heap_len]=d=a,o.depth[a]=0):s[a*2+1]=0;for(;o.heap_len<2;)g=o.heap[++o.heap_len]=d<2?++d:0,s[g*2]=1,o.depth[g]=0,o.opt_len--,r&&(o.static_len-=r[g*2+1]);for(e.max_code=d,a=Math.floor(o.heap_len/2);a>=1;a--)o.pqdownheap(s,a);g=l;do a=o.heap[1],o.heap[1]=o.heap[o.heap_len--],o.pqdownheap(s,1),c=o.heap[1],o.heap[--o.heap_max]=a,o.heap[--o.heap_max]=c,s[g*2]=s[a*2]+s[c*2],o.depth[g]=Math.max(o.depth[a],o.depth[c])+1,s[a*2+1]=s[c*2+1]=g,o.heap[1]=g++,o.pqdownheap(s,1);while(o.heap_len>=2);o.heap[--o.heap_max]=o.heap[1],t(o),n(s,e.max_code,o.bl_count)}}fe._length_code=[0,1,2,3,4,5,6,7].concat(..._o([[2,8],[2,9],[2,10],[2,11],[4,12],[4,13],[4,14],[4,15],[8,16],[8,17],[8,18],[8,19],[16,20],[16,21],[16,22],[16,23],[32,24],[32,25],[32,26],[31,27],[1,28]]));fe.base_length=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0];fe.base_dist=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576];fe.d_code=function(e){return e<256?Mr[e]:Mr[256+(e>>>7)]};fe.extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];fe.extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];fe.extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];fe.bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function Ne(e,t,i,n,o){const s=this;s.static_tree=e,s.extra_bits=t,s.extra_base=i,s.elems=n,s.max_length=o}const Fh=[12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,19,275,147,403,83,339,211,467,51,307,179,435,115,371,243,499,11,267,139,395,75,331,203,459,43,299,171,427,107,363,235,491,27,283,155,411,91,347,219,475,59,315,187,443,123,379,251,507,7,263,135,391,71,327,199,455,39,295,167,423,103,359,231,487,23,279,151,407,87,343,215,471,55,311,183,439,119,375,247,503,15,271,143,399,79,335,207,463,47,303,175,431,111,367,239,495,31,287,159,415,95,351,223,479,63,319,191,447,127,383,255,511,0,64,32,96,16,80,48,112,8,72,40,104,24,88,56,120,4,68,36,100,20,84,52,116,3,131,67,195,35,163,99,227],zh=_o([[144,8],[112,9],[24,7],[8,8]]);Ne.static_ltree=mo(Fh.map((e,t)=>[e,zh[t]]));const Bh=[0,16,8,24,4,20,12,28,2,18,10,26,6,22,14,30,1,17,9,25,5,21,13,29,3,19,11,27,7,23],Uh=_o([[30,5]]);Ne.static_dtree=mo(Bh.map((e,t)=>[e,Uh[t]]));Ne.static_l_desc=new Ne(Ne.static_ltree,fe.extra_lbits,ao+1,Rs,An);Ne.static_d_desc=new Ne(Ne.static_dtree,fe.extra_dbits,0,ms,An);Ne.static_bl_desc=new Ne(null,fe.extra_blbits,0,gs,Rh);const Vh=9,Hh=8;function Rt(e,t,i,n,o){const s=this;s.good_length=e,s.max_lazy=t,s.nice_length=i,s.max_chain=n,s.func=o}const ul=0,to=1,Si=2,Dt=[new Rt(0,0,0,0,ul),new Rt(4,4,8,4,to),new Rt(4,5,16,8,to),new Rt(4,6,32,32,to),new Rt(4,4,16,16,Si),new Rt(8,16,32,32,Si),new Rt(8,16,128,128,Si),new Rt(8,32,128,256,Si),new Rt(32,128,258,1024,Si),new Rt(32,258,258,4096,Si)],Yn=["need dictionary","stream end","","","stream error","data error","","buffer error","",""],_t=0,jn=1,sn=2,Xn=3,Wh=32,Uo=42,Zn=113,rn=666,Vo=8,qh=0,Ho=1,Gh=2,me=3,io=258,at=io+me+1;function kr(e,t,i,n){const o=e[t*2],s=e[i*2];return o<s||o==s&&n[t]<=n[i]}function Yh(){const e=this;let t,i,n,o,s,r,l,a,c,d,g,m,y,w,p,f,_,x,S,I,D,E,T,v,A,R,P,z,M,q,V,U,H;const Z=new fe,ce=new fe,G=new fe;e.depth=[];let we,$,ie,be,de,xe;e.bl_count=[],e.heap=[],V=[],U=[],H=[];function bt(){c=2*s,g[y-1]=0;for(let O=0;O<y-1;O++)g[O]=0;R=Dt[P].max_lazy,M=Dt[P].good_length,q=Dt[P].nice_length,A=Dt[P].max_chain,D=0,_=0,T=0,x=v=me-1,I=0,m=0}function ot(){let O;for(O=0;O<Rs;O++)V[O*2]=0;for(O=0;O<ms;O++)U[O*2]=0;for(O=0;O<gs;O++)H[O*2]=0;V[on*2]=1,e.opt_len=e.static_len=0,$=ie=0}function st(){Z.dyn_tree=V,Z.stat_desc=Ne.static_l_desc,ce.dyn_tree=U,ce.stat_desc=Ne.static_d_desc,G.dyn_tree=H,G.stat_desc=Ne.static_bl_desc,de=0,xe=0,be=8,ot()}e.pqdownheap=function(O,F){const L=e.heap,k=L[F];let W=F<<1;for(;W<=e.heap_len&&(W<e.heap_len&&kr(O,L[W+1],L[W],e.depth)&&W++,!kr(O,k,L[W],e.depth));)L[F]=L[W],F=W,W<<=1;L[F]=k};function qe(O,F){let L=-1,k,W=O[0*2+1],K=0,ee=7,Le=4;W===0&&(ee=138,Le=3),O[(F+1)*2+1]=65535;for(let Xe=0;Xe<=F;Xe++)k=W,W=O[(Xe+1)*2+1],!(++K<ee&&k==W)&&(K<Le?H[k*2]+=K:k!==0?(k!=L&&H[k*2]++,H[Pr*2]++):K<=10?H[Rr*2]++:H[Lr*2]++,K=0,L=k,W===0?(ee=138,Le=3):k==W?(ee=6,Le=3):(ee=7,Le=4))}function ft(){let O;for(qe(V,Z.max_code),qe(U,ce.max_code),G.build_tree(e),O=gs-1;O>=3&&H[fe.bl_order[O]*2+1]===0;O--);return e.opt_len+=3*(O+1)+5+5+4,O}function Ae(O){e.pending_buf[e.pending++]=O}function Ee(O){Ae(O&255),Ae(O>>>8&255)}function Ge(O){Ae(O>>8&255),Ae(O&255&255)}function he(O,F){let L;const k=F;xe>Bo-k?(L=O,de|=L<<xe&65535,Ee(de),de=L>>>Bo-xe,xe+=k-Bo):(de|=O<<xe&65535,xe+=k)}function _e(O,F){const L=O*2;he(F[L]&65535,F[L+1]&65535)}function Ye(O,F){let L,k=-1,W,K=O[0*2+1],ee=0,Le=7,Xe=4;for(K===0&&(Le=138,Xe=3),L=0;L<=F;L++)if(W=K,K=O[(L+1)*2+1],!(++ee<Le&&W==K)){if(ee<Xe)do _e(W,H);while(--ee!==0);else W!==0?(W!=k&&(_e(W,H),ee--),_e(Pr,H),he(ee-3,2)):ee<=10?(_e(Rr,H),he(ee-3,3)):(_e(Lr,H),he(ee-11,7));ee=0,k=W,K===0?(Le=138,Xe=3):W==K?(Le=6,Xe=3):(Le=7,Xe=4)}}function je(O,F,L){let k;for(he(O-257,5),he(F-1,5),he(L-4,4),k=0;k<L;k++)he(H[fe.bl_order[k]*2+1],3);Ye(V,O-1),Ye(U,F-1)}function Pe(){xe==16?(Ee(de),de=0,xe=0):xe>=8&&(Ae(de&255),de>>>=8,xe-=8)}function Vt(){he(Ho<<1,3),_e(on,Ne.static_ltree),Pe(),1+be+10-xe<9&&(he(Ho<<1,3),_e(on,Ne.static_ltree),Pe()),be=7}function Re(O,F){let L,k,W;if(e.dist_buf[$]=O,e.lc_buf[$]=F&255,$++,O===0?V[F*2]++:(ie++,O--,V[(fe._length_code[F]+ao+1)*2]++,U[fe.d_code(O)*2]++),!($&8191)&&P>2){for(L=$*8,k=D-_,W=0;W<ms;W++)L+=U[W*2]*(5+fe.extra_dbits[W]);if(L>>>=3,ie<Math.floor($/2)&&L<Math.floor(k/2))return!0}return $==we-1}function Ht(O,F){let L,k,W=0,K,ee;if($!==0)do L=e.dist_buf[W],k=e.lc_buf[W],W++,L===0?_e(k,O):(K=fe._length_code[k],_e(K+ao+1,O),ee=fe.extra_lbits[K],ee!==0&&(k-=fe.base_length[K],he(k,ee)),L--,K=fe.d_code(L),_e(K,F),ee=fe.extra_dbits[K],ee!==0&&(L-=fe.base_dist[K],he(L,ee)));while(W<$);_e(on,O),be=O[on*2+1]}function Ni(){xe>8?Ee(de):xe>0&&Ae(de&255),de=0,xe=0}function Et(O,F,L){Ni(),be=8,L&&(Ee(F),Ee(~F)),e.pending_buf.set(a.subarray(O,O+F),e.pending),e.pending+=F}function Wt(O,F,L){he((qh<<1)+(L?1:0),3),Et(O,F,!0)}function Mi(O,F,L){let k,W,K=0;P>0?(Z.build_tree(e),ce.build_tree(e),K=ft(),k=e.opt_len+3+7>>>3,W=e.static_len+3+7>>>3,W<=k&&(k=W)):k=W=F+5,F+4<=k&&O!=-1?Wt(O,F,L):W==k?(he((Ho<<1)+(L?1:0),3),Ht(Ne.static_ltree,Ne.static_dtree)):(he((Gh<<1)+(L?1:0),3),je(Z.max_code+1,ce.max_code+1,K+1),Ht(V,U)),ot(),L&&Ni()}function rt(O){Mi(_>=0?_:-1,D-_,O),_=D,t.flush_pending()}function Jt(){let O,F,L,k;do{if(k=c-T-D,k===0&&D===0&&T===0)k=s;else if(k==-1)k--;else if(D>=s+s-at){a.set(a.subarray(s,s+s),0),E-=s,D-=s,_-=s,O=y,L=O;do F=g[--L]&65535,g[L]=F>=s?F-s:0;while(--O!==0);O=s,L=O;do F=d[--L]&65535,d[L]=F>=s?F-s:0;while(--O!==0);k+=s}if(t.avail_in===0)return;O=t.read_buf(a,D+T,k),T+=O,T>=me&&(m=a[D]&255,m=(m<<f^a[D+1]&255)&p)}while(T<at&&t.avail_in!==0)}function So(O){let F=65535,L;for(F>n-5&&(F=n-5);;){if(T<=1){if(Jt(),T===0&&O==Wi)return _t;if(T===0)break}if(D+=T,T=0,L=_+F,(D===0||D>=L)&&(T=D-L,D=L,rt(!1),t.avail_out===0)||D-_>=s-at&&(rt(!1),t.avail_out===0))return _t}return rt(O==Ze),t.avail_out===0?O==Ze?sn:_t:O==Ze?Xn:jn}function zn(O){let F=A,L=D,k,W,K=v;const ee=D>s-at?D-(s-at):0;let Le=q;const Xe=l,wi=D+io;let Fi=a[L+K-1],pt=a[L+K];v>=M&&(F>>=2),Le>T&&(Le=T);do if(k=O,!(a[k+K]!=pt||a[k+K-1]!=Fi||a[k]!=a[L]||a[++k]!=a[L+1])){L+=2,k++;do;while(a[++L]==a[++k]&&a[++L]==a[++k]&&a[++L]==a[++k]&&a[++L]==a[++k]&&a[++L]==a[++k]&&a[++L]==a[++k]&&a[++L]==a[++k]&&a[++L]==a[++k]&&L<wi);if(W=io-(wi-L),L=wi-io,W>K){if(E=O,K=W,W>=Le)break;Fi=a[L+K-1],pt=a[L+K]}}while((O=d[O&Xe]&65535)>ee&&--F!==0);return K<=T?K:T}function en(O){let F=0,L;for(;;){if(T<at){if(Jt(),T<at&&O==Wi)return _t;if(T===0)break}if(T>=me&&(m=(m<<f^a[D+(me-1)]&255)&p,F=g[m]&65535,d[D&l]=g[m],g[m]=D),F!==0&&(D-F&65535)<=s-at&&z!=qn&&(x=zn(F)),x>=me)if(L=Re(D-E,x-me),T-=x,x<=R&&T>=me){x--;do D++,m=(m<<f^a[D+(me-1)]&255)&p,F=g[m]&65535,d[D&l]=g[m],g[m]=D;while(--x!==0);D++}else D+=x,x=0,m=a[D]&255,m=(m<<f^a[D+1]&255)&p;else L=Re(0,a[D]&255),T--,D++;if(L&&(rt(!1),t.avail_out===0))return _t}return rt(O==Ze),t.avail_out===0?O==Ze?sn:_t:O==Ze?Xn:jn}function yi(O){let F=0,L,k;for(;;){if(T<at){if(Jt(),T<at&&O==Wi)return _t;if(T===0)break}if(T>=me&&(m=(m<<f^a[D+(me-1)]&255)&p,F=g[m]&65535,d[D&l]=g[m],g[m]=D),v=x,S=E,x=me-1,F!==0&&v<R&&(D-F&65535)<=s-at&&(z!=qn&&(x=zn(F)),x<=5&&(z==Lh||x==me&&D-E>4096)&&(x=me-1)),v>=me&&x<=v){k=D+T-me,L=Re(D-1-S,v-me),T-=v-1,v-=2;do++D<=k&&(m=(m<<f^a[D+(me-1)]&255)&p,F=g[m]&65535,d[D&l]=g[m],g[m]=D);while(--v!==0);if(I=0,x=me-1,D++,L&&(rt(!1),t.avail_out===0))return _t}else if(I!==0){if(L=Re(0,a[D-1]&255),L&&rt(!1),D++,T--,t.avail_out===0)return _t}else I=1,D++,T--}return I!==0&&(L=Re(0,a[D-1]&255),I=0),rt(O==Ze),t.avail_out===0?O==Ze?sn:_t:O==Ze?Xn:jn}function ki(O){return O.total_in=O.total_out=0,O.msg=null,e.pending=0,e.pending_out=0,i=Zn,o=Wi,st(),bt(),It}e.deflateInit=function(O,F,L,k,W,K){return k||(k=Vo),W||(W=Hh),K||(K=Nh),O.msg=null,F==lo&&(F=6),W<1||W>Vh||k!=Vo||L<9||L>15||F<0||F>9||K<0||K>qn?vt:(O.dstate=e,r=L,s=1<<r,l=s-1,w=W+7,y=1<<w,p=y-1,f=Math.floor((w+me-1)/me),a=new Uint8Array(s*2),d=[],g=[],we=1<<W+6,e.pending_buf=new Uint8Array(we*4),n=we*4,e.dist_buf=new Uint16Array(we),e.lc_buf=new Uint8Array(we),P=F,z=K,ki(O))},e.deflateEnd=function(){return i!=Uo&&i!=Zn&&i!=rn?vt:(e.lc_buf=null,e.dist_buf=null,e.pending_buf=null,g=null,d=null,a=null,e.dstate=null,i==Zn?kh:It)},e.deflateParams=function(O,F,L){let k=It;return F==lo&&(F=6),F<0||F>9||L<0||L>qn?vt:(Dt[P].func!=Dt[F].func&&O.total_in!==0&&(k=O.deflate(Nr)),P!=F&&(P=F,R=Dt[P].max_lazy,M=Dt[P].good_length,q=Dt[P].nice_length,A=Dt[P].max_chain),z=L,k)},e.deflateSetDictionary=function(O,F,L){let k=L,W,K=0;if(!F||i!=Uo)return vt;if(k<me)return It;for(k>s-at&&(k=s-at,K=L-k),a.set(F.subarray(K,K+k),0),D=k,_=k,m=a[0]&255,m=(m<<f^a[1]&255)&p,W=0;W<=k-me;W++)m=(m<<f^a[W+(me-1)]&255)&p,d[W&l]=g[m],g[m]=W;return It},e.deflate=function(O,F){let L,k,W,K,ee;if(F>Ze||F<0)return vt;if(!O.next_out||!O.next_in&&O.avail_in!==0||i==rn&&F!=Ze)return O.msg=Yn[Gn-vt],vt;if(O.avail_out===0)return O.msg=Yn[Gn-Ui],Ui;if(t=O,K=o,o=F,i==Uo&&(k=Vo+(r-8<<4)<<8,W=(P-1&255)>>1,W>3&&(W=3),k|=W<<6,D!==0&&(k|=Wh),k+=31-k%31,i=Zn,Ge(k)),e.pending!==0){if(t.flush_pending(),t.avail_out===0)return o=-1,It}else if(t.avail_in===0&&F<=K&&F!=Ze)return t.msg=Yn[Gn-Ui],Ui;if(i==rn&&t.avail_in!==0)return O.msg=Yn[Gn-Ui],Ui;if(t.avail_in!==0||T!==0||F!=Wi&&i!=rn){switch(ee=-1,Dt[P].func){case ul:ee=So(F);break;case to:ee=en(F);break;case Si:ee=yi(F);break}if((ee==sn||ee==Xn)&&(i=rn),ee==_t||ee==sn)return t.avail_out===0&&(o=-1),It;if(ee==jn){if(F==Nr)Vt();else if(Wt(0,0,!1),F==Mh)for(L=0;L<y;L++)g[L]=0;if(t.flush_pending(),t.avail_out===0)return o=-1,It}}return F!=Ze?It:hl}}function fl(){const e=this;e.next_in_index=0,e.next_out_index=0,e.avail_in=0,e.total_in=0,e.avail_out=0,e.total_out=0}fl.prototype={deflateInit(e,t){const i=this;return i.dstate=new Yh,t||(t=An),i.dstate.deflateInit(i,e,t)},deflate(e){const t=this;return t.dstate?t.dstate.deflate(t,e):vt},deflateEnd(){const e=this;if(!e.dstate)return vt;const t=e.dstate.deflateEnd();return e.dstate=null,t},deflateParams(e,t){const i=this;return i.dstate?i.dstate.deflateParams(i,e,t):vt},deflateSetDictionary(e,t){const i=this;return i.dstate?i.dstate.deflateSetDictionary(i,e,t):vt},read_buf(e,t,i){const n=this;let o=n.avail_in;return o>i&&(o=i),o===0?0:(n.avail_in-=o,e.set(n.next_in.subarray(n.next_in_index,n.next_in_index+o),t),n.next_in_index+=o,n.total_in+=o,o)},flush_pending(){const e=this;let t=e.dstate.pending;t>e.avail_out&&(t=e.avail_out),t!==0&&(e.next_out.set(e.dstate.pending_buf.subarray(e.dstate.pending_out,e.dstate.pending_out+t),e.next_out_index),e.next_out_index+=t,e.dstate.pending_out+=t,e.total_out+=t,e.avail_out-=t,e.dstate.pending-=t,e.dstate.pending===0&&(e.dstate.pending_out=0))}};function jh(e){const t=this,i=new fl,n=Xh(e&&e.chunkSize?e.chunkSize:64*1024),o=Wi,s=new Uint8Array(n);let r=e?e.level:lo;typeof r>"u"&&(r=lo),i.deflateInit(r),i.next_out=s,t.append=function(l,a){let c,d,g=0,m=0,y=0;const w=[];if(l.length){i.next_in_index=0,i.next_in=l,i.avail_in=l.length;do{if(i.next_out_index=0,i.avail_out=n,c=i.deflate(o),c!=It)throw new Error("deflating: "+i.msg);i.next_out_index&&(i.next_out_index==n?w.push(new Uint8Array(s)):w.push(s.subarray(0,i.next_out_index))),y+=i.next_out_index,a&&i.next_in_index>0&&i.next_in_index!=g&&(a(i.next_in_index),g=i.next_in_index)}while(i.avail_in>0||i.avail_out===0);return w.length>1?(d=new Uint8Array(y),w.forEach(function(p){d.set(p,m),m+=p.length})):d=w[0]?new Uint8Array(w[0]):new Uint8Array,d}},t.flush=function(){let l,a,c=0,d=0;const g=[];do{if(i.next_out_index=0,i.avail_out=n,l=i.deflate(Ze),l!=hl&&l!=It)throw new Error("deflating: "+i.msg);n-i.avail_out>0&&g.push(s.slice(0,i.next_out_index)),d+=i.next_out_index}while(i.avail_in>0||i.avail_out===0);return i.deflateEnd(),a=new Uint8Array(d),g.forEach(function(m){a.set(m,c),c+=m.length}),a}}function Xh(e){return e+5*(Math.floor(e/16383)+1)}const Zh=15,re=0,jt=1,Kh=2,$e=-2,pe=-3,Fr=-4,Xt=-5,ct=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],pl=1440,$h=0,Jh=4,Qh=9,eu=5,tu=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],iu=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],nu=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],ou=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],su=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],ru=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ei=15;function ys(){const e=this;let t,i,n,o,s,r;function l(c,d,g,m,y,w,p,f,_,x,S){let I,D,E,T,v,A,R,P,z,M,q,V,U,H,Z;M=0,v=g;do n[c[d+M]]++,M++,v--;while(v!==0);if(n[0]==g)return p[0]=-1,f[0]=0,re;for(P=f[0],A=1;A<=ei&&n[A]===0;A++);for(R=A,P<A&&(P=A),v=ei;v!==0&&n[v]===0;v--);for(E=v,P>v&&(P=v),f[0]=P,H=1<<A;A<v;A++,H<<=1)if((H-=n[A])<0)return pe;if((H-=n[v])<0)return pe;for(n[v]+=H,r[1]=A=0,M=1,U=2;--v!==0;)r[U]=A+=n[M],U++,M++;v=0,M=0;do(A=c[d+M])!==0&&(S[r[A]++]=v),M++;while(++v<g);for(g=r[E],r[0]=v=0,M=0,T=-1,V=-P,s[0]=0,q=0,Z=0;R<=E;R++)for(I=n[R];I--!==0;){for(;R>V+P;){if(T++,V+=P,Z=E-V,Z=Z>P?P:Z,(D=1<<(A=R-V))>I+1&&(D-=I+1,U=R,A<Z))for(;++A<Z&&!((D<<=1)<=n[++U]);)D-=n[U];if(Z=1<<A,x[0]+Z>pl)return pe;s[T]=q=x[0],x[0]+=Z,T!==0?(r[T]=v,o[0]=A,o[1]=P,A=v>>>V-P,o[2]=q-s[T-1]-A,_.set(o,(s[T-1]+A)*3)):p[0]=q}for(o[1]=R-V,M>=g?o[0]=192:S[M]<m?(o[0]=S[M]<256?0:96,o[2]=S[M++]):(o[0]=w[S[M]-m]+16+64,o[2]=y[S[M++]-m]),D=1<<R-V,A=v>>>V;A<Z;A+=D)_.set(o,(q+A)*3);for(A=1<<R-1;v&A;A>>>=1)v^=A;for(v^=A,z=(1<<V)-1;(v&z)!=r[T];)T--,V-=P,z=(1<<V)-1}return H!==0&&E!=1?Xt:re}function a(c){let d;for(t||(t=[],i=[],n=new Int32Array(ei+1),o=[],s=new Int32Array(ei),r=new Int32Array(ei+1)),i.length<c&&(i=[]),d=0;d<c;d++)i[d]=0;for(d=0;d<ei+1;d++)n[d]=0;for(d=0;d<3;d++)o[d]=0;s.set(n.subarray(0,ei),0),r.set(n.subarray(0,ei+1),0)}e.inflate_trees_bits=function(c,d,g,m,y){let w;return a(19),t[0]=0,w=l(c,0,19,19,null,null,g,d,m,t,i),w==pe?y.msg="oversubscribed dynamic bit lengths tree":(w==Xt||d[0]===0)&&(y.msg="incomplete dynamic bit lengths tree",w=pe),w},e.inflate_trees_dynamic=function(c,d,g,m,y,w,p,f,_){let x;return a(288),t[0]=0,x=l(g,0,c,257,nu,ou,w,m,f,t,i),x!=re||m[0]===0?(x==pe?_.msg="oversubscribed literal/length tree":x!=Fr&&(_.msg="incomplete literal/length tree",x=pe),x):(a(288),x=l(g,c,d,0,su,ru,p,y,f,t,i),x!=re||y[0]===0&&c>257?(x==pe?_.msg="oversubscribed distance tree":x==Xt?(_.msg="incomplete distance tree",x=pe):x!=Fr&&(_.msg="empty distance tree with lengths",x=pe),x):re)}}ys.inflate_trees_fixed=function(e,t,i,n){return e[0]=Qh,t[0]=eu,i[0]=tu,n[0]=iu,re};const Kn=0,zr=1,Br=2,Ur=3,Vr=4,Hr=5,Wr=6,Wo=7,qr=8,$n=9;function au(){const e=this;let t,i=0,n,o=0,s=0,r=0,l=0,a=0,c=0,d=0,g,m=0,y,w=0;function p(f,_,x,S,I,D,E,T){let v,A,R,P,z,M,q,V,U,H,Z,ce,G,we,$,ie;q=T.next_in_index,V=T.avail_in,z=E.bitb,M=E.bitk,U=E.write,H=U<E.read?E.read-U-1:E.end-U,Z=ct[f],ce=ct[_];do{for(;M<20;)V--,z|=(T.read_byte(q++)&255)<<M,M+=8;if(v=z&Z,A=x,R=S,ie=(R+v)*3,(P=A[ie])===0){z>>=A[ie+1],M-=A[ie+1],E.win[U++]=A[ie+2],H--;continue}do{if(z>>=A[ie+1],M-=A[ie+1],P&16){for(P&=15,G=A[ie+2]+(z&ct[P]),z>>=P,M-=P;M<15;)V--,z|=(T.read_byte(q++)&255)<<M,M+=8;v=z&ce,A=I,R=D,ie=(R+v)*3,P=A[ie];do if(z>>=A[ie+1],M-=A[ie+1],P&16){for(P&=15;M<P;)V--,z|=(T.read_byte(q++)&255)<<M,M+=8;if(we=A[ie+2]+(z&ct[P]),z>>=P,M-=P,H-=G,U>=we)$=U-we,U-$>0&&2>U-$?(E.win[U++]=E.win[$++],E.win[U++]=E.win[$++],G-=2):(E.win.set(E.win.subarray($,$+2),U),U+=2,$+=2,G-=2);else{$=U-we;do $+=E.end;while($<0);if(P=E.end-$,G>P){if(G-=P,U-$>0&&P>U-$)do E.win[U++]=E.win[$++];while(--P!==0);else E.win.set(E.win.subarray($,$+P),U),U+=P,$+=P,P=0;$=0}}if(U-$>0&&G>U-$)do E.win[U++]=E.win[$++];while(--G!==0);else E.win.set(E.win.subarray($,$+G),U),U+=G,$+=G,G=0;break}else if(!(P&64))v+=A[ie+2],v+=z&ct[P],ie=(R+v)*3,P=A[ie];else return T.msg="invalid distance code",G=T.avail_in-V,G=M>>3<G?M>>3:G,V+=G,q-=G,M-=G<<3,E.bitb=z,E.bitk=M,T.avail_in=V,T.total_in+=q-T.next_in_index,T.next_in_index=q,E.write=U,pe;while(!0);break}if(P&64)return P&32?(G=T.avail_in-V,G=M>>3<G?M>>3:G,V+=G,q-=G,M-=G<<3,E.bitb=z,E.bitk=M,T.avail_in=V,T.total_in+=q-T.next_in_index,T.next_in_index=q,E.write=U,jt):(T.msg="invalid literal/length code",G=T.avail_in-V,G=M>>3<G?M>>3:G,V+=G,q-=G,M-=G<<3,E.bitb=z,E.bitk=M,T.avail_in=V,T.total_in+=q-T.next_in_index,T.next_in_index=q,E.write=U,pe);if(v+=A[ie+2],v+=z&ct[P],ie=(R+v)*3,(P=A[ie])===0){z>>=A[ie+1],M-=A[ie+1],E.win[U++]=A[ie+2],H--;break}}while(!0)}while(H>=258&&V>=10);return G=T.avail_in-V,G=M>>3<G?M>>3:G,V+=G,q-=G,M-=G<<3,E.bitb=z,E.bitk=M,T.avail_in=V,T.total_in+=q-T.next_in_index,T.next_in_index=q,E.write=U,re}e.init=function(f,_,x,S,I,D){t=Kn,c=f,d=_,g=x,m=S,y=I,w=D,n=null},e.proc=function(f,_,x){let S,I,D,E=0,T=0,v=0,A,R,P,z;for(v=_.next_in_index,A=_.avail_in,E=f.bitb,T=f.bitk,R=f.write,P=R<f.read?f.read-R-1:f.end-R;;)switch(t){case Kn:if(P>=258&&A>=10&&(f.bitb=E,f.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,f.write=R,x=p(c,d,g,m,y,w,f,_),v=_.next_in_index,A=_.avail_in,E=f.bitb,T=f.bitk,R=f.write,P=R<f.read?f.read-R-1:f.end-R,x!=re)){t=x==jt?Wo:$n;break}s=c,n=g,o=m,t=zr;case zr:for(S=s;T<S;){if(A!==0)x=re;else return f.bitb=E,f.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,f.write=R,f.inflate_flush(_,x);A--,E|=(_.read_byte(v++)&255)<<T,T+=8}if(I=(o+(E&ct[S]))*3,E>>>=n[I+1],T-=n[I+1],D=n[I],D===0){r=n[I+2],t=Wr;break}if(D&16){l=D&15,i=n[I+2],t=Br;break}if(!(D&64)){s=D,o=I/3+n[I+2];break}if(D&32){t=Wo;break}return t=$n,_.msg="invalid literal/length code",x=pe,f.bitb=E,f.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,f.write=R,f.inflate_flush(_,x);case Br:for(S=l;T<S;){if(A!==0)x=re;else return f.bitb=E,f.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,f.write=R,f.inflate_flush(_,x);A--,E|=(_.read_byte(v++)&255)<<T,T+=8}i+=E&ct[S],E>>=S,T-=S,s=d,n=y,o=w,t=Ur;case Ur:for(S=s;T<S;){if(A!==0)x=re;else return f.bitb=E,f.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,f.write=R,f.inflate_flush(_,x);A--,E|=(_.read_byte(v++)&255)<<T,T+=8}if(I=(o+(E&ct[S]))*3,E>>=n[I+1],T-=n[I+1],D=n[I],D&16){l=D&15,a=n[I+2],t=Vr;break}if(!(D&64)){s=D,o=I/3+n[I+2];break}return t=$n,_.msg="invalid distance code",x=pe,f.bitb=E,f.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,f.write=R,f.inflate_flush(_,x);case Vr:for(S=l;T<S;){if(A!==0)x=re;else return f.bitb=E,f.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,f.write=R,f.inflate_flush(_,x);A--,E|=(_.read_byte(v++)&255)<<T,T+=8}a+=E&ct[S],E>>=S,T-=S,t=Hr;case Hr:for(z=R-a;z<0;)z+=f.end;for(;i!==0;){if(P===0&&(R==f.end&&f.read!==0&&(R=0,P=R<f.read?f.read-R-1:f.end-R),P===0&&(f.write=R,x=f.inflate_flush(_,x),R=f.write,P=R<f.read?f.read-R-1:f.end-R,R==f.end&&f.read!==0&&(R=0,P=R<f.read?f.read-R-1:f.end-R),P===0)))return f.bitb=E,f.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,f.write=R,f.inflate_flush(_,x);f.win[R++]=f.win[z++],P--,z==f.end&&(z=0),i--}t=Kn;break;case Wr:if(P===0&&(R==f.end&&f.read!==0&&(R=0,P=R<f.read?f.read-R-1:f.end-R),P===0&&(f.write=R,x=f.inflate_flush(_,x),R=f.write,P=R<f.read?f.read-R-1:f.end-R,R==f.end&&f.read!==0&&(R=0,P=R<f.read?f.read-R-1:f.end-R),P===0)))return f.bitb=E,f.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,f.write=R,f.inflate_flush(_,x);x=re,f.win[R++]=r,P--,t=Kn;break;case Wo:if(T>7&&(T-=8,A++,v--),f.write=R,x=f.inflate_flush(_,x),R=f.write,P=R<f.read?f.read-R-1:f.end-R,f.read!=f.write)return f.bitb=E,f.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,f.write=R,f.inflate_flush(_,x);t=qr;case qr:return x=jt,f.bitb=E,f.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,f.write=R,f.inflate_flush(_,x);case $n:return x=pe,f.bitb=E,f.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,f.write=R,f.inflate_flush(_,x);default:return x=$e,f.bitb=E,f.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,f.write=R,f.inflate_flush(_,x)}},e.free=function(){}}const Gr=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Vi=0,qo=1,Yr=2,jr=3,Xr=4,Zr=5,Jn=6,Qn=7,Kr=8,Ci=9;function lu(e,t){const i=this;let n=Vi,o=0,s=0,r=0,l;const a=[0],c=[0],d=new au;let g=0,m=new Int32Array(pl*3);const y=0,w=new ys;i.bitk=0,i.bitb=0,i.win=new Uint8Array(t),i.end=t,i.read=0,i.write=0,i.reset=function(p,f){f&&(f[0]=y),n==Jn&&d.free(p),n=Vi,i.bitk=0,i.bitb=0,i.read=i.write=0},i.reset(e,null),i.inflate_flush=function(p,f){let _,x,S;return x=p.next_out_index,S=i.read,_=(S<=i.write?i.write:i.end)-S,_>p.avail_out&&(_=p.avail_out),_!==0&&f==Xt&&(f=re),p.avail_out-=_,p.total_out+=_,p.next_out.set(i.win.subarray(S,S+_),x),x+=_,S+=_,S==i.end&&(S=0,i.write==i.end&&(i.write=0),_=i.write-S,_>p.avail_out&&(_=p.avail_out),_!==0&&f==Xt&&(f=re),p.avail_out-=_,p.total_out+=_,p.next_out.set(i.win.subarray(S,S+_),x),x+=_,S+=_),p.next_out_index=x,i.read=S,f},i.proc=function(p,f){let _,x,S,I,D,E,T,v;for(I=p.next_in_index,D=p.avail_in,x=i.bitb,S=i.bitk,E=i.write,T=E<i.read?i.read-E-1:i.end-E;;){let A,R,P,z,M,q,V,U;switch(n){case Vi:for(;S<3;){if(D!==0)f=re;else return i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,f);D--,x|=(p.read_byte(I++)&255)<<S,S+=8}switch(_=x&7,g=_&1,_>>>1){case 0:x>>>=3,S-=3,_=S&7,x>>>=_,S-=_,n=qo;break;case 1:A=[],R=[],P=[[]],z=[[]],ys.inflate_trees_fixed(A,R,P,z),d.init(A[0],R[0],P[0],0,z[0],0),x>>>=3,S-=3,n=Jn;break;case 2:x>>>=3,S-=3,n=jr;break;case 3:return x>>>=3,S-=3,n=Ci,p.msg="invalid block type",f=pe,i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,f)}break;case qo:for(;S<32;){if(D!==0)f=re;else return i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,f);D--,x|=(p.read_byte(I++)&255)<<S,S+=8}if((~x>>>16&65535)!=(x&65535))return n=Ci,p.msg="invalid stored block lengths",f=pe,i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,f);o=x&65535,x=S=0,n=o!==0?Yr:g!==0?Qn:Vi;break;case Yr:if(D===0||T===0&&(E==i.end&&i.read!==0&&(E=0,T=E<i.read?i.read-E-1:i.end-E),T===0&&(i.write=E,f=i.inflate_flush(p,f),E=i.write,T=E<i.read?i.read-E-1:i.end-E,E==i.end&&i.read!==0&&(E=0,T=E<i.read?i.read-E-1:i.end-E),T===0)))return i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,f);if(f=re,_=o,_>D&&(_=D),_>T&&(_=T),i.win.set(p.read_buf(I,_),E),I+=_,D-=_,E+=_,T-=_,(o-=_)!==0)break;n=g!==0?Qn:Vi;break;case jr:for(;S<14;){if(D!==0)f=re;else return i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,f);D--,x|=(p.read_byte(I++)&255)<<S,S+=8}if(s=_=x&16383,(_&31)>29||(_>>5&31)>29)return n=Ci,p.msg="too many length or distance symbols",f=pe,i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,f);if(_=258+(_&31)+(_>>5&31),!l||l.length<_)l=[];else for(v=0;v<_;v++)l[v]=0;x>>>=14,S-=14,r=0,n=Xr;case Xr:for(;r<4+(s>>>10);){for(;S<3;){if(D!==0)f=re;else return i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,f);D--,x|=(p.read_byte(I++)&255)<<S,S+=8}l[Gr[r++]]=x&7,x>>>=3,S-=3}for(;r<19;)l[Gr[r++]]=0;if(a[0]=7,_=w.inflate_trees_bits(l,a,c,m,p),_!=re)return f=_,f==pe&&(l=null,n=Ci),i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,f);r=0,n=Zr;case Zr:for(;_=s,!(r>=258+(_&31)+(_>>5&31));){let H,Z;for(_=a[0];S<_;){if(D!==0)f=re;else return i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,f);D--,x|=(p.read_byte(I++)&255)<<S,S+=8}if(_=m[(c[0]+(x&ct[_]))*3+1],Z=m[(c[0]+(x&ct[_]))*3+2],Z<16)x>>>=_,S-=_,l[r++]=Z;else{for(v=Z==18?7:Z-14,H=Z==18?11:3;S<_+v;){if(D!==0)f=re;else return i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,f);D--,x|=(p.read_byte(I++)&255)<<S,S+=8}if(x>>>=_,S-=_,H+=x&ct[v],x>>>=v,S-=v,v=r,_=s,v+H>258+(_&31)+(_>>5&31)||Z==16&&v<1)return l=null,n=Ci,p.msg="invalid bit length repeat",f=pe,i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,f);Z=Z==16?l[v-1]:0;do l[v++]=Z;while(--H!==0);r=v}}if(c[0]=-1,M=[],q=[],V=[],U=[],M[0]=9,q[0]=6,_=s,_=w.inflate_trees_dynamic(257+(_&31),1+(_>>5&31),l,M,q,V,U,m,p),_!=re)return _==pe&&(l=null,n=Ci),f=_,i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,f);d.init(M[0],q[0],m,V[0],m,U[0]),n=Jn;case Jn:if(i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,(f=d.proc(i,p,f))!=jt)return i.inflate_flush(p,f);if(f=re,d.free(p),I=p.next_in_index,D=p.avail_in,x=i.bitb,S=i.bitk,E=i.write,T=E<i.read?i.read-E-1:i.end-E,g===0){n=Vi;break}n=Qn;case Qn:if(i.write=E,f=i.inflate_flush(p,f),E=i.write,T=E<i.read?i.read-E-1:i.end-E,i.read!=i.write)return i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,f);n=Kr;case Kr:return f=jt,i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,f);case Ci:return f=pe,i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,f);default:return f=$e,i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,f)}}},i.free=function(p){i.reset(p,null),i.win=null,m=null},i.set_dictionary=function(p,f,_){i.win.set(p.subarray(f,f+_),0),i.read=i.write=_},i.sync_point=function(){return n==qo?1:0}}const cu=32,du=8,hu=0,$r=1,Jr=2,Qr=3,ea=4,ta=5,Go=6,an=7,ia=12,ti=13,uu=[0,0,255,255];function fu(){const e=this;e.mode=0,e.method=0,e.was=[0],e.need=0,e.marker=0,e.wbits=0;function t(i){return!i||!i.istate?$e:(i.total_in=i.total_out=0,i.msg=null,i.istate.mode=an,i.istate.blocks.reset(i,null),re)}e.inflateEnd=function(i){return e.blocks&&e.blocks.free(i),e.blocks=null,re},e.inflateInit=function(i,n){return i.msg=null,e.blocks=null,n<8||n>15?(e.inflateEnd(i),$e):(e.wbits=n,i.istate.blocks=new lu(i,1<<n),t(i),re)},e.inflate=function(i,n){let o,s;if(!i||!i.istate||!i.next_in)return $e;const r=i.istate;for(n=n==Jh?Xt:re,o=Xt;;)switch(r.mode){case hu:if(i.avail_in===0)return o;if(o=n,i.avail_in--,i.total_in++,((r.method=i.read_byte(i.next_in_index++))&15)!=du){r.mode=ti,i.msg="unknown compression method",r.marker=5;break}if((r.method>>4)+8>r.wbits){r.mode=ti,i.msg="invalid win size",r.marker=5;break}r.mode=$r;case $r:if(i.avail_in===0)return o;if(o=n,i.avail_in--,i.total_in++,s=i.read_byte(i.next_in_index++)&255,((r.method<<8)+s)%31!==0){r.mode=ti,i.msg="incorrect header check",r.marker=5;break}if(!(s&cu)){r.mode=an;break}r.mode=Jr;case Jr:if(i.avail_in===0)return o;o=n,i.avail_in--,i.total_in++,r.need=(i.read_byte(i.next_in_index++)&255)<<24&4278190080,r.mode=Qr;case Qr:if(i.avail_in===0)return o;o=n,i.avail_in--,i.total_in++,r.need+=(i.read_byte(i.next_in_index++)&255)<<16&16711680,r.mode=ea;case ea:if(i.avail_in===0)return o;o=n,i.avail_in--,i.total_in++,r.need+=(i.read_byte(i.next_in_index++)&255)<<8&65280,r.mode=ta;case ta:return i.avail_in===0?o:(o=n,i.avail_in--,i.total_in++,r.need+=i.read_byte(i.next_in_index++)&255,r.mode=Go,Kh);case Go:return r.mode=ti,i.msg="need dictionary",r.marker=0,$e;case an:if(o=r.blocks.proc(i,o),o==pe){r.mode=ti,r.marker=0;break}if(o==re&&(o=n),o!=jt)return o;o=n,r.blocks.reset(i,r.was),r.mode=ia;case ia:return i.avail_in=0,jt;case ti:return pe;default:return $e}},e.inflateSetDictionary=function(i,n,o){let s=0,r=o;if(!i||!i.istate||i.istate.mode!=Go)return $e;const l=i.istate;return r>=1<<l.wbits&&(r=(1<<l.wbits)-1,s=o-r),l.blocks.set_dictionary(n,s,r),l.mode=an,re},e.inflateSync=function(i){let n,o,s,r,l;if(!i||!i.istate)return $e;const a=i.istate;if(a.mode!=ti&&(a.mode=ti,a.marker=0),(n=i.avail_in)===0)return Xt;for(o=i.next_in_index,s=a.marker;n!==0&&s<4;)i.read_byte(o)==uu[s]?s++:i.read_byte(o)!==0?s=0:s=4-s,o++,n--;return i.total_in+=o-i.next_in_index,i.next_in_index=o,i.avail_in=n,a.marker=s,s!=4?pe:(r=i.total_in,l=i.total_out,t(i),i.total_in=r,i.total_out=l,a.mode=an,re)},e.inflateSyncPoint=function(i){return!i||!i.istate||!i.istate.blocks?$e:i.istate.blocks.sync_point()}}function _l(){}_l.prototype={inflateInit(e){const t=this;return t.istate=new fu,e||(e=Zh),t.istate.inflateInit(t,e)},inflate(e){const t=this;return t.istate?t.istate.inflate(t,e):$e},inflateEnd(){const e=this;if(!e.istate)return $e;const t=e.istate.inflateEnd(e);return e.istate=null,t},inflateSync(){const e=this;return e.istate?e.istate.inflateSync(e):$e},inflateSetDictionary(e,t){const i=this;return i.istate?i.istate.inflateSetDictionary(i,e,t):$e},read_byte(e){return this.next_in[e]},read_buf(e,t){return this.next_in.subarray(e,e+t)}};function pu(e){const t=this,i=new _l,n=e&&e.chunkSize?Math.floor(e.chunkSize*2):128*1024,o=$h,s=new Uint8Array(n);let r=!1;i.inflateInit(),i.next_out=s,t.append=function(l,a){const c=[];let d,g,m=0,y=0,w=0;if(l.length!==0){i.next_in_index=0,i.next_in=l,i.avail_in=l.length;do{if(i.next_out_index=0,i.avail_out=n,i.avail_in===0&&!r&&(i.next_in_index=0,r=!0),d=i.inflate(o),r&&d===Xt){if(i.avail_in!==0)throw new Error("inflating: bad input")}else if(d!==re&&d!==jt)throw new Error("inflating: "+i.msg);if((r||d===jt)&&i.avail_in===l.length)throw new Error("inflating: bad input");i.next_out_index&&(i.next_out_index===n?c.push(new Uint8Array(s)):c.push(s.subarray(0,i.next_out_index))),w+=i.next_out_index,a&&i.next_in_index>0&&i.next_in_index!=m&&(a(i.next_in_index),m=i.next_in_index)}while(i.avail_in>0||i.avail_out===0);return c.length>1?(g=new Uint8Array(w),c.forEach(function(p){g.set(p,y),y+=p.length})):g=c[0]?new Uint8Array(c[0]):new Uint8Array,g}},t.flush=function(){i.inflateEnd()}}const et=4294967295,Je=65535,na=8,_u=0,mu=99,gu=67324752,ml=134695760,yu=ml,wu=33639248,xu=101010256,Cu=101075792,Su=117853008,ws=22,gl=20,yl=56,bu=ws+gl+yl,Eu=1,Du=39169,Tu=10,Iu=1,wl=21589,Ap=28789,Op=25461,vu=6534,Au=1,Pp=6,Ou=8,Pu=2048,Ru=16,Lu=20,oa=45,sa=51,Yo="/",ra=new Date(2107,11,31),aa=new Date(1980,0,1),Se=void 0,fi="undefined",kn="function";class la{constructor(t){return class extends TransformStream{constructor(i,n){const o=new t(n);super({transform(s,r){r.enqueue(o.append(s))},flush(s){const r=o.flush();r&&s.enqueue(r)}})}}}}const Nu=64;let xl=2;try{typeof navigator!=fi&&navigator.hardwareConcurrency&&(xl=navigator.hardwareConcurrency)}catch{}const Mu={chunkSize:512*1024,maxWorkers:xl,terminateWorkerTimeout:5e3,useWebWorkers:!0,useCompressionStream:!0,workerScripts:Se,CompressionStreamNative:typeof CompressionStream!=fi&&CompressionStream,DecompressionStreamNative:typeof DecompressionStream!=fi&&DecompressionStream},oi=Object.assign({},Mu);function ku(){return oi}function Fu(e){return Math.max(e.chunkSize,Nu)}function Cl(e){const{baseURL:t,chunkSize:i,maxWorkers:n,terminateWorkerTimeout:o,useCompressionStream:s,useWebWorkers:r,Deflate:l,Inflate:a,CompressionStream:c,DecompressionStream:d,workerScripts:g}=e;if(ii("baseURL",t),ii("chunkSize",i),ii("maxWorkers",n),ii("terminateWorkerTimeout",o),ii("useCompressionStream",s),ii("useWebWorkers",r),l&&(oi.CompressionStream=new la(l)),a&&(oi.DecompressionStream=new la(a)),ii("CompressionStream",c),ii("DecompressionStream",d),g!==Se){const{deflate:m,inflate:y}=g;if((m||y)&&(oi.workerScripts||(oi.workerScripts={})),m){if(!Array.isArray(m))throw new Error("workerScripts.deflate must be an array");oi.workerScripts.deflate=m}if(y){if(!Array.isArray(y))throw new Error("workerScripts.inflate must be an array");oi.workerScripts.inflate=y}}}function ii(e,t){t!==Se&&(oi[e]=t)}const Sl=[];for(let e=0;e<256;e++){let t=e;for(let i=0;i<8;i++)t&1?t=t>>>1^3988292384:t=t>>>1;Sl[e]=t}class xs{constructor(t){this.crc=t||-1}append(t){let i=this.crc|0;for(let n=0,o=t.length|0;n<o;n++)i=i>>>8^Sl[(i^t[n])&255];this.crc=i}get(){return~this.crc}}class bl extends TransformStream{constructor(){let t;const i=new xs;super({transform(n,o){i.append(n),o.enqueue(n)},flush(){const n=new Uint8Array(4);new DataView(n.buffer).setUint32(0,i.get()),t.value=n}}),t=this}}function no(e){if(typeof TextEncoder==fi){e=unescape(encodeURIComponent(e));const t=new Uint8Array(e.length);for(let i=0;i<t.length;i++)t[i]=e.charCodeAt(i);return t}else return new TextEncoder().encode(e)}const Ve={concat(e,t){if(e.length===0||t.length===0)return e.concat(t);const i=e[e.length-1],n=Ve.getPartial(i);return n===32?e.concat(t):Ve._shiftRight(t,n,i|0,e.slice(0,e.length-1))},bitLength(e){const t=e.length;if(t===0)return 0;const i=e[t-1];return(t-1)*32+Ve.getPartial(i)},clamp(e,t){if(e.length*32<t)return e;e=e.slice(0,Math.ceil(t/32));const i=e.length;return t=t&31,i>0&&t&&(e[i-1]=Ve.partial(t,e[i-1]&2147483648>>t-1,1)),e},partial(e,t,i){return e===32?t:(i?t|0:t<<32-e)+e*1099511627776},getPartial(e){return Math.round(e/1099511627776)||32},_shiftRight(e,t,i,n){for(n===void 0&&(n=[]);t>=32;t-=32)n.push(i),i=0;if(t===0)return n.concat(e);for(let r=0;r<e.length;r++)n.push(i|e[r]>>>t),i=e[r]<<32-t;const o=e.length?e[e.length-1]:0,s=Ve.getPartial(o);return n.push(Ve.partial(t+s&31,t+s>32?i:n.pop(),1)),n}},co={bytes:{fromBits(e){const i=Ve.bitLength(e)/8,n=new Uint8Array(i);let o;for(let s=0;s<i;s++)s&3||(o=e[s/4]),n[s]=o>>>24,o<<=8;return n},toBits(e){const t=[];let i,n=0;for(i=0;i<e.length;i++)n=n<<8|e[i],(i&3)===3&&(t.push(n),n=0);return i&3&&t.push(Ve.partial(8*(i&3),n)),t}}},El={};El.sha1=class{constructor(e){const t=this;t.blockSize=512,t._init=[1732584193,4023233417,2562383102,271733878,3285377520],t._key=[1518500249,1859775393,2400959708,3395469782],e?(t._h=e._h.slice(0),t._buffer=e._buffer.slice(0),t._length=e._length):t.reset()}reset(){const e=this;return e._h=e._init.slice(0),e._buffer=[],e._length=0,e}update(e){const t=this;typeof e=="string"&&(e=co.utf8String.toBits(e));const i=t._buffer=Ve.concat(t._buffer,e),n=t._length,o=t._length=n+Ve.bitLength(e);if(o>9007199254740991)throw new Error("Cannot hash more than 2^53 - 1 bits");const s=new Uint32Array(i);let r=0;for(let l=t.blockSize+n-(t.blockSize+n&t.blockSize-1);l<=o;l+=t.blockSize)t._block(s.subarray(16*r,16*(r+1))),r+=1;return i.splice(0,16*r),t}finalize(){const e=this;let t=e._buffer;const i=e._h;t=Ve.concat(t,[Ve.partial(1,1)]);for(let n=t.length+2;n&15;n++)t.push(0);for(t.push(Math.floor(e._length/4294967296)),t.push(e._length|0);t.length;)e._block(t.splice(0,16));return e.reset(),i}_f(e,t,i,n){if(e<=19)return t&i|~t&n;if(e<=39)return t^i^n;if(e<=59)return t&i|t&n|i&n;if(e<=79)return t^i^n}_S(e,t){return t<<e|t>>>32-e}_block(e){const t=this,i=t._h,n=Array(80);for(let c=0;c<16;c++)n[c]=e[c];let o=i[0],s=i[1],r=i[2],l=i[3],a=i[4];for(let c=0;c<=79;c++){c>=16&&(n[c]=t._S(1,n[c-3]^n[c-8]^n[c-14]^n[c-16]));const d=t._S(5,o)+t._f(c,s,r,l)+a+n[c]+t._key[Math.floor(c/20)]|0;a=l,l=r,r=t._S(30,s),s=o,o=d}i[0]=i[0]+o|0,i[1]=i[1]+s|0,i[2]=i[2]+r|0,i[3]=i[3]+l|0,i[4]=i[4]+a|0}};const Dl={};Dl.aes=class{constructor(e){const t=this;t._tables=[[[],[],[],[],[]],[[],[],[],[],[]]],t._tables[0][0][0]||t._precompute();const i=t._tables[0][4],n=t._tables[1],o=e.length;let s,r,l,a=1;if(o!==4&&o!==6&&o!==8)throw new Error("invalid aes key size");for(t._key=[r=e.slice(0),l=[]],s=o;s<4*o+28;s++){let c=r[s-1];(s%o===0||o===8&&s%o===4)&&(c=i[c>>>24]<<24^i[c>>16&255]<<16^i[c>>8&255]<<8^i[c&255],s%o===0&&(c=c<<8^c>>>24^a<<24,a=a<<1^(a>>7)*283)),r[s]=r[s-o]^c}for(let c=0;s;c++,s--){const d=r[c&3?s:s-4];s<=4||c<4?l[c]=d:l[c]=n[0][i[d>>>24]]^n[1][i[d>>16&255]]^n[2][i[d>>8&255]]^n[3][i[d&255]]}}encrypt(e){return this._crypt(e,0)}decrypt(e){return this._crypt(e,1)}_precompute(){const e=this._tables[0],t=this._tables[1],i=e[4],n=t[4],o=[],s=[];let r,l,a,c;for(let d=0;d<256;d++)s[(o[d]=d<<1^(d>>7)*283)^d]=d;for(let d=r=0;!i[d];d^=l||1,r=s[r]||1){let g=r^r<<1^r<<2^r<<3^r<<4;g=g>>8^g&255^99,i[d]=g,n[g]=d,c=o[a=o[l=o[d]]];let m=c*16843009^a*65537^l*257^d*16843008,y=o[g]*257^g*16843008;for(let w=0;w<4;w++)e[w][d]=y=y<<24^y>>>8,t[w][g]=m=m<<24^m>>>8}for(let d=0;d<5;d++)e[d]=e[d].slice(0),t[d]=t[d].slice(0)}_crypt(e,t){if(e.length!==4)throw new Error("invalid aes block size");const i=this._key[t],n=i.length/4-2,o=[0,0,0,0],s=this._tables[t],r=s[0],l=s[1],a=s[2],c=s[3],d=s[4];let g=e[0]^i[0],m=e[t?3:1]^i[1],y=e[2]^i[2],w=e[t?1:3]^i[3],p=4,f,_,x;for(let S=0;S<n;S++)f=r[g>>>24]^l[m>>16&255]^a[y>>8&255]^c[w&255]^i[p],_=r[m>>>24]^l[y>>16&255]^a[w>>8&255]^c[g&255]^i[p+1],x=r[y>>>24]^l[w>>16&255]^a[g>>8&255]^c[m&255]^i[p+2],w=r[w>>>24]^l[g>>16&255]^a[m>>8&255]^c[y&255]^i[p+3],p+=4,g=f,m=_,y=x;for(let S=0;S<4;S++)o[t?3&-S:S]=d[g>>>24]<<24^d[m>>16&255]<<16^d[y>>8&255]<<8^d[w&255]^i[p++],f=g,g=m,m=y,y=w,w=f;return o}};const zu={getRandomValues(e){const t=new Uint32Array(e.buffer),i=n=>{let o=987654321;const s=4294967295;return function(){return o=36969*(o&65535)+(o>>16)&s,n=18e3*(n&65535)+(n>>16)&s,(((o<<16)+n&s)/4294967296+.5)*(Math.random()>.5?1:-1)}};for(let n=0,o;n<e.length;n+=4){const s=i((o||Math.random())*4294967296);o=s()*987654071,t[n/4]=s()*4294967296|0}return e}},Tl={};Tl.ctrGladman=class{constructor(e,t){this._prf=e,this._initIv=t,this._iv=t}reset(){this._iv=this._initIv}update(e){return this.calculate(this._prf,e,this._iv)}incWord(e){if((e>>24&255)===255){let t=e>>16&255,i=e>>8&255,n=e&255;t===255?(t=0,i===255?(i=0,n===255?n=0:++n):++i):++t,e=0,e+=t<<16,e+=i<<8,e+=n}else e+=1<<24;return e}incCounter(e){(e[0]=this.incWord(e[0]))===0&&(e[1]=this.incWord(e[1]))}calculate(e,t,i){let n;if(!(n=t.length))return[];const o=Ve.bitLength(t);for(let s=0;s<n;s+=4){this.incCounter(i);const r=e.encrypt(i);t[s]^=r[0],t[s+1]^=r[1],t[s+2]^=r[2],t[s+3]^=r[3]}return Ve.clamp(t,o)}};const Oi={importKey(e){return new Oi.hmacSha1(co.bytes.toBits(e))},pbkdf2(e,t,i,n){if(i=i||1e4,n<0||i<0)throw new Error("invalid params to pbkdf2");const o=(n>>5)+1<<2;let s,r,l,a,c;const d=new ArrayBuffer(o),g=new DataView(d);let m=0;const y=Ve;for(t=co.bytes.toBits(t),c=1;m<(o||1);c++){for(s=r=e.encrypt(y.concat(t,[c])),l=1;l<i;l++)for(r=e.encrypt(r),a=0;a<r.length;a++)s[a]^=r[a];for(l=0;m<(o||1)&&l<s.length;l++)g.setInt32(m,s[l]),m+=4}return d.slice(0,n/8)}};Oi.hmacSha1=class{constructor(e){const t=this,i=t._hash=El.sha1,n=[[],[]];t._baseHash=[new i,new i];const o=t._baseHash[0].blockSize/32;e.length>o&&(e=new i().update(e).finalize());for(let s=0;s<o;s++)n[0][s]=e[s]^909522486,n[1][s]=e[s]^1549556828;t._baseHash[0].update(n[0]),t._baseHash[1].update(n[1]),t._resultHash=new i(t._baseHash[0])}reset(){const e=this;e._resultHash=new e._hash(e._baseHash[0]),e._updated=!1}update(e){const t=this;t._updated=!0,t._resultHash.update(e)}digest(){const e=this,t=e._resultHash.finalize(),i=new e._hash(e._baseHash[1]).update(t).finalize();return e.reset(),i}encrypt(e){if(this._updated)throw new Error("encrypt on already updated hmac called!");return this.update(e),this.digest(e)}};const Bu=typeof crypto!=fi&&typeof crypto.getRandomValues==kn,Il="Invalid password",vl="Invalid signature",Al="zipjs-abort-check-password";function Ol(e){return Bu?crypto.getRandomValues(e):zu.getRandomValues(e)}const ji=16,Uu="raw",Pl={name:"PBKDF2"},Vu={name:"HMAC"},Hu="SHA-1",Wu=Object.assign({hash:Vu},Pl),Cs=Object.assign({iterations:1e3,hash:{name:Hu}},Pl),qu=["deriveBits"],On=[8,12,16],ln=[16,24,32],ni=10,Gu=[0,0,0,0],go=typeof crypto!=fi,Fn=go&&crypto.subtle,Rl=go&&typeof Fn!=fi,kt=co.bytes,Yu=Dl.aes,ju=Tl.ctrGladman,Xu=Oi.hmacSha1;let ca=go&&Rl&&typeof Fn.importKey==kn,da=go&&Rl&&typeof Fn.deriveBits==kn;class Zu extends TransformStream{constructor({password:t,rawPassword:i,signed:n,encryptionStrength:o,checkPasswordOnly:s}){super({start(){Object.assign(this,{ready:new Promise(r=>this.resolveReady=r),password:Ml(t,i),signed:n,strength:o-1,pending:new Uint8Array})},async transform(r,l){const a=this,{password:c,strength:d,resolveReady:g,ready:m}=a;c?(await $u(a,d,c,gt(r,0,On[d]+2)),r=gt(r,On[d]+2),s?l.error(new Error(Al)):g()):await m;const y=new Uint8Array(r.length-ni-(r.length-ni)%ji);l.enqueue(Ll(a,r,y,0,ni,!0))},async flush(r){const{signed:l,ctr:a,hmac:c,pending:d,ready:g}=this;if(c&&a){await g;const m=gt(d,0,d.length-ni),y=gt(d,d.length-ni);let w=new Uint8Array;if(m.length){const p=Rn(kt,m);c.update(p);const f=a.update(p);w=Pn(kt,f)}if(l){const p=gt(Pn(kt,c.digest()),0,ni);for(let f=0;f<ni;f++)if(p[f]!=y[f])throw new Error(vl)}r.enqueue(w)}}})}}class Ku extends TransformStream{constructor({password:t,rawPassword:i,encryptionStrength:n}){let o;super({start(){Object.assign(this,{ready:new Promise(s=>this.resolveReady=s),password:Ml(t,i),strength:n-1,pending:new Uint8Array})},async transform(s,r){const l=this,{password:a,strength:c,resolveReady:d,ready:g}=l;let m=new Uint8Array;a?(m=await Ju(l,c,a),d()):await g;const y=new Uint8Array(m.length+s.length-s.length%ji);y.set(m,0),r.enqueue(Ll(l,s,y,m.length,0))},async flush(s){const{ctr:r,hmac:l,pending:a,ready:c}=this;if(l&&r){await c;let d=new Uint8Array;if(a.length){const g=r.update(Rn(kt,a));l.update(g),d=Pn(kt,g)}o.signature=Pn(kt,l.digest()).slice(0,ni),s.enqueue(Ls(d,o.signature))}}}),o=this}}function Ll(e,t,i,n,o,s){const{ctr:r,hmac:l,pending:a}=e,c=t.length-o;a.length&&(t=Ls(a,t),i=tf(i,c-c%ji));let d;for(d=0;d<=c-ji;d+=ji){const g=Rn(kt,gt(t,d,d+ji));s&&l.update(g);const m=r.update(g);s||l.update(m),i.set(Pn(kt,m),d+n)}return e.pending=gt(t,d),i}async function $u(e,t,i,n){const o=await Nl(e,t,i,gt(n,0,On[t])),s=gt(n,On[t]);if(o[0]!=s[0]||o[1]!=s[1])throw new Error(Il)}async function Ju(e,t,i){const n=Ol(new Uint8Array(On[t])),o=await Nl(e,t,i,n);return Ls(n,o)}async function Nl(e,t,i,n){e.password=null;const o=await Qu(Uu,i,Wu,!1,qu),s=await ef(Object.assign({salt:n},Cs),o,8*(ln[t]*2+2)),r=new Uint8Array(s),l=Rn(kt,gt(r,0,ln[t])),a=Rn(kt,gt(r,ln[t],ln[t]*2)),c=gt(r,ln[t]*2);return Object.assign(e,{keys:{key:l,authentication:a,passwordVerification:c},ctr:new ju(new Yu(l),Array.from(Gu)),hmac:new Xu(a)}),c}async function Qu(e,t,i,n,o){if(ca)try{return await Fn.importKey(e,t,i,n,o)}catch{return ca=!1,Oi.importKey(t)}else return Oi.importKey(t)}async function ef(e,t,i){if(da)try{return await Fn.deriveBits(e,t,i)}catch{return da=!1,Oi.pbkdf2(t,e.salt,Cs.iterations,i)}else return Oi.pbkdf2(t,e.salt,Cs.iterations,i)}function Ml(e,t){return t===Se?no(e):t}function Ls(e,t){let i=e;return e.length+t.length&&(i=new Uint8Array(e.length+t.length),i.set(e,0),i.set(t,e.length)),i}function tf(e,t){if(t&&t>e.length){const i=e;e=new Uint8Array(t),e.set(i,0)}return e}function gt(e,t,i){return e.subarray(t,i)}function Pn(e,t){return e.fromBits(t)}function Rn(e,t){return e.toBits(t)}const Zi=12;class nf extends TransformStream{constructor({password:t,passwordVerification:i,checkPasswordOnly:n}){super({start(){Object.assign(this,{password:t,passwordVerification:i}),kl(this,t)},transform(o,s){const r=this;if(r.password){const l=ha(r,o.subarray(0,Zi));if(r.password=null,l[Zi-1]!=r.passwordVerification)throw new Error(Il);o=o.subarray(Zi)}n?s.error(new Error(Al)):s.enqueue(ha(r,o))}})}}class of extends TransformStream{constructor({password:t,passwordVerification:i}){super({start(){Object.assign(this,{password:t,passwordVerification:i}),kl(this,t)},transform(n,o){const s=this;let r,l;if(s.password){s.password=null;const a=Ol(new Uint8Array(Zi));a[Zi-1]=s.passwordVerification,r=new Uint8Array(n.length+a.length),r.set(ua(s,a),0),l=Zi}else r=new Uint8Array(n.length),l=0;r.set(ua(s,n),l),o.enqueue(r)}})}}function ha(e,t){const i=new Uint8Array(t.length);for(let n=0;n<t.length;n++)i[n]=Fl(e)^t[n],Ns(e,i[n]);return i}function ua(e,t){const i=new Uint8Array(t.length);for(let n=0;n<t.length;n++)i[n]=Fl(e)^t[n],Ns(e,t[n]);return i}function kl(e,t){const i=[305419896,591751049,878082192];Object.assign(e,{keys:i,crcKey0:new xs(i[0]),crcKey2:new xs(i[2])});for(let n=0;n<t.length;n++)Ns(e,t.charCodeAt(n))}function Ns(e,t){let[i,n,o]=e.keys;e.crcKey0.append([t]),i=~e.crcKey0.get(),n=fa(Math.imul(fa(n+zl(i)),134775813)+1),e.crcKey2.append([n>>>24]),o=~e.crcKey2.get(),e.keys=[i,n,o]}function Fl(e){const t=e.keys[2]|2;return zl(Math.imul(t,t^1)>>>8)}function zl(e){return e&255}function fa(e){return e&4294967295}const pa="deflate-raw";class sf extends TransformStream{constructor(t,{chunkSize:i,CompressionStream:n,CompressionStreamNative:o}){super({});const{compressed:s,encrypted:r,useCompressionStream:l,zipCrypto:a,signed:c,level:d}=t,g=this;let m,y,w=Bl(super.readable);(!r||a)&&c&&(m=new bl,w=Ft(w,m)),s&&(w=Vl(w,l,{level:d,chunkSize:i},o,n)),r&&(a?w=Ft(w,new of(t)):(y=new Ku(t),w=Ft(w,y))),Ul(g,w,()=>{let p;r&&!a&&(p=y.signature),(!r||a)&&c&&(p=new DataView(m.value.buffer).getUint32(0)),g.signature=p})}}class rf extends TransformStream{constructor(t,{chunkSize:i,DecompressionStream:n,DecompressionStreamNative:o}){super({});const{zipCrypto:s,encrypted:r,signed:l,signature:a,compressed:c,useCompressionStream:d}=t;let g,m,y=Bl(super.readable);r&&(s?y=Ft(y,new nf(t)):(m=new Zu(t),y=Ft(y,m))),c&&(y=Vl(y,d,{chunkSize:i},o,n)),(!r||s)&&l&&(g=new bl,y=Ft(y,g)),Ul(this,y,()=>{if((!r||s)&&l){const w=new DataView(g.value.buffer);if(a!=w.getUint32(0,!1))throw new Error(vl)}})}}function Bl(e){return Ft(e,new TransformStream({transform(t,i){t&&t.length&&i.enqueue(t)}}))}function Ul(e,t,i){t=Ft(t,new TransformStream({flush:i})),Object.defineProperty(e,"readable",{get(){return t}})}function Vl(e,t,i,n,o){try{const s=t&&n?n:o;e=Ft(e,new s(pa,i))}catch{if(t)try{e=Ft(e,new o(pa,i))}catch{return e}else return e}return e}function Ft(e,t){return e.pipeThrough(t)}const af="message",lf="start",cf="pull",_a="data",df="ack",ma="close",Hl="deflate",hf="inflate";class uf extends TransformStream{constructor(t,i){super({});const n=this,{codecType:o}=t;let s;o.startsWith(Hl)?s=sf:o.startsWith(hf)&&(s=rf);let r=0,l=0;const a=new s(t,i),c=super.readable,d=new TransformStream({transform(m,y){m&&m.length&&(l+=m.length,y.enqueue(m))},flush(){Object.assign(n,{inputSize:l})}}),g=new TransformStream({transform(m,y){m&&m.length&&(r+=m.length,y.enqueue(m))},flush(){const{signature:m}=a;Object.assign(n,{signature:m,outputSize:r,inputSize:l})}});Object.defineProperty(n,"readable",{get(){return c.pipeThrough(d).pipeThrough(a).pipeThrough(g)}})}}class ff extends TransformStream{constructor(t){let i;super({transform:n,flush(o){i&&i.length&&o.enqueue(i)}});function n(o,s){if(i){const r=new Uint8Array(i.length+o.length);r.set(i),r.set(o,i.length),o=r,i=null}o.length>t?(s.enqueue(o.slice(0,t)),n(o.slice(t),s)):i=o}}}let Wl=typeof Worker!=fi;class jo{constructor(t,{readable:i,writable:n},{options:o,config:s,streamOptions:r,useWebWorkers:l,transferStreams:a,scripts:c},d){const{signal:g}=r;return Object.assign(t,{busy:!0,readable:i.pipeThrough(new ff(s.chunkSize)).pipeThrough(new pf(i,r),{signal:g}),writable:n,options:Object.assign({},o),scripts:c,transferStreams:a,terminate(){return new Promise(m=>{const{worker:y,busy:w}=t;y?(w?t.resolveTerminated=m:(y.terminate(),m()),t.interface=null):m()})},onTaskFinished(){const{resolveTerminated:m}=t;m&&(t.resolveTerminated=null,t.terminated=!0,t.worker.terminate(),m()),t.busy=!1,d(t)}}),(l&&Wl?_f:ql)(t,s)}}class pf extends TransformStream{constructor(t,{onstart:i,onprogress:n,size:o,onend:s}){let r=0;super({async start(){i&&await Xo(i,o)},async transform(l,a){r+=l.length,n&&await Xo(n,r,o),a.enqueue(l)},async flush(){t.size=r,s&&await Xo(s,r)}})}}async function Xo(e,...t){try{await e(...t)}catch{}}function ql(e,t){return{run:()=>mf(e,t)}}function _f(e,t){const{baseURL:i,chunkSize:n}=t;if(!e.interface){let o;try{o=wf(e.scripts[0],i,e)}catch{return Wl=!1,ql(e,t)}Object.assign(e,{worker:o,interface:{run:()=>gf(e,{chunkSize:n})}})}return e.interface}async function mf({options:e,readable:t,writable:i,onTaskFinished:n},o){try{const s=new uf(e,o);await t.pipeThrough(s).pipeTo(i,{preventClose:!0,preventAbort:!0});const{signature:r,inputSize:l,outputSize:a}=s;return{signature:r,inputSize:l,outputSize:a}}finally{n()}}async function gf(e,t){let i,n;const o=new Promise((m,y)=>{i=m,n=y});Object.assign(e,{reader:null,writer:null,resolveResult:i,rejectResult:n,result:o});const{readable:s,options:r,scripts:l}=e,{writable:a,closed:c}=yf(e.writable),d=oo({type:lf,scripts:l.slice(1),options:r,config:t,readable:s,writable:a},e);d||Object.assign(e,{reader:s.getReader(),writer:a.getWriter()});const g=await o;return d||await a.getWriter().close(),await c,g}function yf(e){let t;const i=new Promise(o=>t=o);return{writable:new WritableStream({async write(o){const s=e.getWriter();await s.ready,await s.write(o),s.releaseLock()},close(){t()},abort(o){return e.getWriter().abort(o)}}),closed:i}}let ga=!0,ya=!0;function wf(e,t,i){const n={type:"module"};let o,s;typeof e==kn&&(e=e());try{o=new URL(e,t)}catch{o=e}if(ga)try{s=new Worker(o)}catch{ga=!1,s=new Worker(o,n)}else s=new Worker(o,n);return s.addEventListener(af,r=>xf(r,i)),s}function oo(e,{worker:t,writer:i,onTaskFinished:n,transferStreams:o}){try{let{value:s,readable:r,writable:l}=e;const a=[];if(s&&(s.byteLength<s.buffer.byteLength?e.value=s.buffer.slice(0,s.byteLength):e.value=s.buffer,a.push(e.value)),o&&ya?(r&&a.push(r),l&&a.push(l)):e.readable=e.writable=null,a.length)try{return t.postMessage(e,a),!0}catch{ya=!1,e.readable=e.writable=null,t.postMessage(e)}else t.postMessage(e)}catch(s){throw i&&i.releaseLock(),n(),s}}async function xf({data:e},t){const{type:i,value:n,messageId:o,result:s,error:r}=e,{reader:l,writer:a,resolveResult:c,rejectResult:d,onTaskFinished:g}=t;try{if(r){const{message:y,stack:w,code:p,name:f}=r,_=new Error(y);Object.assign(_,{stack:w,code:p,name:f}),m(_)}else{if(i==cf){const{value:y,done:w}=await l.read();oo({type:_a,value:y,done:w,messageId:o},t)}i==_a&&(await a.ready,await a.write(new Uint8Array(n)),oo({type:df,messageId:o},t)),i==ma&&m(null,s)}}catch(y){oo({type:ma,messageId:o},t),m(y)}function m(y,w){y?d(y):c(w),a&&a.releaseLock(),g()}}let bi=[];const Zo=[];let wa=0;async function Cf(e,t){const{options:i,config:n}=t,{transferStreams:o,useWebWorkers:s,useCompressionStream:r,codecType:l,compressed:a,signed:c,encrypted:d}=i,{workerScripts:g,maxWorkers:m}=n;t.transferStreams=o||o===Se;const y=!a&&!c&&!d&&!t.transferStreams;return t.useWebWorkers=!y&&(s||s===Se&&n.useWebWorkers),t.scripts=t.useWebWorkers&&g?g[l]:[],i.useCompressionStream=r||r===Se&&n.useCompressionStream,(await w()).run();async function w(){const f=bi.find(_=>!_.busy);if(f)return xa(f),new jo(f,e,t,p);if(bi.length<m){const _={indexWorker:wa};return wa++,bi.push(_),new jo(_,e,t,p)}else return new Promise(_=>Zo.push({resolve:_,stream:e,workerOptions:t}))}function p(f){if(Zo.length){const[{resolve:_,stream:x,workerOptions:S}]=Zo.splice(0,1);_(new jo(f,x,S,p))}else f.worker?(xa(f),Sf(f,t)):bi=bi.filter(_=>_!=f)}}function Sf(e,t){const{config:i}=t,{terminateWorkerTimeout:n}=i;Number.isFinite(n)&&n>=0&&(e.terminated?e.terminated=!1:e.terminateTimeout=setTimeout(async()=>{bi=bi.filter(o=>o!=e);try{await e.terminate()}catch{}},n))}function xa(e){const{terminateTimeout:t}=e;t&&(clearTimeout(t),e.terminateTimeout=null)}const bf="Writer iterator completed too soon",Ef="text/plain",Df="Content-Type",Tf=64*1024,Ms="writable";class yo{constructor(){this.size=0}init(){this.initialized=!0}}class Gl extends yo{get readable(){const t=this,{chunkSize:i=Tf}=t,n=new ReadableStream({start(){this.chunkOffset=0},async pull(o){const{offset:s=0,size:r,diskNumberStart:l}=n,{chunkOffset:a}=this;o.enqueue(await Ss(t,s+a,Math.min(i,r-a),l)),a+i>r?o.close():this.chunkOffset+=i}});return n}}class If extends yo{constructor(){super();const t=this,i=new WritableStream({write(n){return t.writeUint8Array(n)}});Object.defineProperty(t,Ms,{get(){return i}})}writeUint8Array(){}}class Rp extends If{constructor(t){super(),Object.assign(this,{data:"data:"+(t||"")+";base64,",pending:[]})}writeUint8Array(t){const i=this;let n=0,o=i.pending;const s=i.pending.length;for(i.pending="",n=0;n<Math.floor((s+t.length)/3)*3-s;n++)o+=String.fromCharCode(t[n]);for(;n<t.length;n++)i.pending+=String.fromCharCode(t[n]);o.length>2?i.data+=btoa(o):i.pending=o}getData(){return this.data+btoa(this.pending)}}class Yl extends Gl{constructor(t){super(),Object.assign(this,{blob:t,size:t.size})}async readUint8Array(t,i){const n=this,o=t+i;let r=await(t||o<n.size?n.blob.slice(t,o):n.blob).arrayBuffer();return r.byteLength>i&&(r=r.slice(t,o)),new Uint8Array(r)}}class jl extends yo{constructor(t){super();const i=this,n=new TransformStream,o=[];t&&o.push([Df,t]),Object.defineProperty(i,Ms,{get(){return n.writable}}),i.blob=new Response(n.readable,{headers:o}).blob()}getData(){return this.blob}}class vf extends Yl{constructor(t){super(new Blob([t],{type:Ef}))}}class Lp extends jl{constructor(t){super(t),Object.assign(this,{encoding:t,utf8:!t||t.toLowerCase()=="utf-8"})}async getData(){const{encoding:t,utf8:i}=this,n=await super.getData();if(n.text&&i)return n.text();{const o=new FileReader;return new Promise((s,r)=>{Object.assign(o,{onload:({target:l})=>s(l.result),onerror:()=>r(o.error)}),o.readAsText(n,t)})}}}class Af extends Gl{constructor(t){super(),this.readers=t}async init(){const t=this,{readers:i}=t;t.lastDiskNumber=0,t.lastDiskOffset=0,await Promise.all(i.map(async(n,o)=>{await n.init(),o!=i.length-1&&(t.lastDiskOffset+=n.size),t.size+=n.size})),super.init()}async readUint8Array(t,i,n=0){const o=this,{readers:s}=this;let r,l=n;l==-1&&(l=s.length-1);let a=t;for(;a>=s[l].size;)a-=s[l].size,l++;const c=s[l],d=c.size;if(a+i<=d)r=await Ss(c,a,i);else{const g=d-a;r=new Uint8Array(i),r.set(await Ss(c,a,g)),r.set(await o.readUint8Array(t+g,i-g,n),g)}return o.lastDiskNumber=Math.max(l,o.lastDiskNumber),r}}class Ca extends yo{constructor(t,i=4294967295){super();const n=this;Object.assign(n,{diskNumber:0,diskOffset:0,size:0,maxSize:i,availableSize:i});let o,s,r;const l=new WritableStream({async write(d){const{availableSize:g}=n;if(r)d.length>=g?(await a(d.slice(0,g)),await c(),n.diskOffset+=o.size,n.diskNumber++,r=null,await this.write(d.slice(g))):await a(d);else{const{value:m,done:y}=await t.next();if(y&&!m)throw new Error(bf);o=m,o.size=0,o.maxSize&&(n.maxSize=o.maxSize),n.availableSize=n.maxSize,await Ln(o),s=m.writable,r=s.getWriter(),await this.write(d)}},async close(){await r.ready,await c()}});Object.defineProperty(n,Ms,{get(){return l}});async function a(d){const g=d.length;g&&(await r.ready,await r.write(d),o.size+=g,n.size+=g,n.availableSize-=g)}async function c(){s.size=o.size,await r.close()}}}async function Ln(e,t){if(e.init&&!e.initialized)await e.init(t);else return Promise.resolve()}function Of(e){return Array.isArray(e)&&(e=new Af(e)),e instanceof ReadableStream&&(e={readable:e}),e}function Pf(e){e.writable===Se&&typeof e.next==kn&&(e=new Ca(e)),e instanceof WritableStream&&(e={writable:e});const{writable:t}=e;return t.size===Se&&(t.size=0),e instanceof Ca||Object.assign(e,{diskNumber:0,diskOffset:0,availableSize:1/0,maxSize:1/0}),e}function Ss(e,t,i,n){return e.readUint8Array(t,i,n)}const Xl="\0 !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~ ".split(""),Rf=Xl.length==256;function Np(e){if(Rf){let t="";for(let i=0;i<e.length;i++)t+=Xl[e[i]];return t}else return new TextDecoder().decode(e)}const Lf="filename",Nf="rawFilename",Mf="comment",kf="rawComment",Ff="uncompressedSize",zf="compressedSize",Bf="offset",Sa="diskNumberStart",Zl="lastModDate",Uf="rawLastModDate",Kl="lastAccessDate",Mp="rawLastAccessDate",$l="creationDate",kp="rawCreationDate",Jl="internalFileAttribute",Ql="externalFileAttribute",ec="msDosCompatible",tc="zip64",Vf=[Lf,Nf,zf,Ff,Zl,Uf,Mf,kf,Kl,$l,Bf,Sa,Sa,Jl,Ql,ec,tc,"directory","bitFlag","encrypted","signature","filenameUTF8","commentUTF8","compressionMethod","version","versionMadeBy","extraField","rawExtraField","extraFieldZip64","extraFieldUnicodePath","extraFieldUnicodeComment","extraFieldAES","extraFieldNTFS","extraFieldExtendedTimestamp"];class ic{constructor(t){Vf.forEach(i=>this[i]=t[i])}}const Hf="File already exists",Wf="Zip file comment exceeds 64KB",qf="File entry comment exceeds 64KB",Gf="File entry name exceeds 64KB",ba="Version exceeds 65535",Yf="The strength must equal 1, 2, or 3",jf="Extra field type exceeds 65535",Xf="Extra field data exceeds 64KB",ks="Zip64 is not supported (make sure 'keepOrder' is set to 'true')",Ea=new Uint8Array([7,0,2,0,65,69,3,0,0]);let Ko=0;const Da=[];class Zf{constructor(t,i={}){t=Pf(t);const n=t.availableSize!==Se&&t.availableSize>0&&t.availableSize!==1/0&&t.maxSize!==Se&&t.maxSize>0&&t.maxSize!==1/0;Object.assign(this,{writer:t,addSplitZipSignature:n,options:i,config:ku(),files:new Map,filenames:new Set,offset:t.writable.size,pendingEntriesSize:0,pendingAddFileCalls:new Set,bufferedWrites:0})}async add(t="",i,n={}){const o=this,{pendingAddFileCalls:s,config:r}=o;Ko<r.maxWorkers?Ko++:await new Promise(a=>Da.push(a));let l;try{if(t=t.trim(),o.filenames.has(t))throw new Error(Hf);return o.filenames.add(t),l=Kf(o,t,i,n),s.add(l),await l}catch(a){throw o.filenames.delete(t),a}finally{s.delete(l);const a=Da.shift();a?a():Ko--}}async close(t=new Uint8Array,i={}){const n=this,{pendingAddFileCalls:o,writer:s}=this,{writable:r}=s;for(;o.size;)await Promise.allSettled(Array.from(o));return await sp(this,t,i),ue(n,i,"preventClose")||await r.getWriter().close(),s.getData?s.getData():r}}async function Kf(e,t,i,n){t=t.trim(),n.directory&&!t.endsWith(Yo)?t+=Yo:n.directory=t.endsWith(Yo);const o=ue(e,n,"encodeText",no);let s=o(t);if(s===Se&&(s=no(t)),oe(s)>Je)throw new Error(Gf);const r=n.comment||"";let l=o(r);if(l===Se&&(l=no(r)),oe(l)>Je)throw new Error(qf);const a=ue(e,n,"version",Lu);if(a>Je)throw new Error(ba);const c=ue(e,n,"versionMadeBy",20);if(c>Je)throw new Error(ba);const d=ue(e,n,Zl,new Date),g=ue(e,n,Kl),m=ue(e,n,$l),y=ue(e,n,ec,!0),w=ue(e,n,Jl,0),p=ue(e,n,Ql,0),f=ue(e,n,"password"),_=ue(e,n,"rawPassword"),x=ue(e,n,"encryptionStrength",3),S=ue(e,n,"zipCrypto"),I=ue(e,n,"extendedTimestamp",!0),D=ue(e,n,"keepOrder",!0),E=ue(e,n,"level"),T=ue(e,n,"useWebWorkers"),v=ue(e,n,"bufferedWrite"),A=ue(e,n,"dataDescriptorSignature",!1),R=ue(e,n,"signal"),P=ue(e,n,"useCompressionStream");let z=ue(e,n,"dataDescriptor",!0),M=ue(e,n,tc);if(f!==Se&&x!==Se&&(x<1||x>3))throw new Error(Yf);let q=new Uint8Array;const{extraField:V}=n;if(V){let Ae=0,Ee=0;V.forEach(Ge=>Ae+=4+oe(Ge)),q=new Uint8Array(Ae),V.forEach((Ge,he)=>{if(he>Je)throw new Error(jf);if(oe(Ge)>Je)throw new Error(Xf);Te(q,new Uint16Array([he]),Ee),Te(q,new Uint16Array([oe(Ge)]),Ee+2),Te(q,Ge,Ee+4),Ee+=4+oe(Ge)})}let U=0,H=0,Z=0;const ce=M===!0;i&&(i=Of(i),await Ln(i),i.size===Se?(z=!0,(M||M===Se)&&(M=!0,Z=U=et+1)):(Z=i.size,U=rp(Z)));const{diskOffset:G,diskNumber:we,maxSize:$}=e.writer,ie=ce||Z>et,be=ce||U>et,de=ce||e.offset+e.pendingEntriesSize-G>et,bt=ue(e,n,"supportZip64SplitFile",!0)&&ce||we+Math.ceil(e.pendingEntriesSize/$)>Je;if(de||ie||be||bt){if(M===!1||!D)throw new Error(ks);M=!0}M=M||!1,n=Object.assign({},n,{rawFilename:s,rawComment:l,version:a,versionMadeBy:c,lastModDate:d,lastAccessDate:g,creationDate:m,rawExtraField:q,zip64:M,zip64UncompressedSize:ie,zip64CompressedSize:be,zip64Offset:de,zip64DiskNumberStart:bt,password:f,rawPassword:_,level:!P&&e.config.CompressionStream===Se&&e.config.CompressionStreamNative===Se?0:E,useWebWorkers:T,encryptionStrength:x,extendedTimestamp:I,zipCrypto:S,bufferedWrite:v,keepOrder:D,dataDescriptor:z,dataDescriptorSignature:A,signal:R,msDosCompatible:y,internalFileAttribute:w,externalFileAttribute:p,useCompressionStream:P});const ot=Qf(n),st=tp(n),qe=oe(ot.localHeaderArray,st.dataDescriptorArray);H=qe+U,e.options.usdz&&(H+=H+64),e.pendingEntriesSize+=H;let ft;try{ft=await $f(e,t,i,{headerInfo:ot,dataDescriptorInfo:st,metadataSize:qe},n)}finally{e.pendingEntriesSize-=H}return Object.assign(ft,{name:t,comment:r,extraField:V}),new ic(ft)}async function $f(e,t,i,n,o){const{files:s,writer:r}=e,{keepOrder:l,dataDescriptor:a,signal:c}=o,{headerInfo:d}=n,{usdz:g}=e.options,m=Array.from(s.values()).pop();let y={},w,p,f,_,x,S,I;s.set(t,y);try{let v;l&&(v=m&&m.lock,D()),(o.bufferedWrite||e.writerLocked||e.bufferedWrites&&l||!a)&&!g?(S=new TransformStream,I=new Response(S.readable).blob(),S.writable.size=0,w=!0,e.bufferedWrites++,await Ln(r)):(S=r,await E()),await Ln(S);const{writable:A}=r;let{diskOffset:R}=r;if(e.addSplitZipSignature){delete e.addSplitZipSignature;const z=new Uint8Array(4),M=Me(z);ne(M,0,ml),await Nt(A,z),e.offset+=4}g&&ep(n,e.offset-R),w||(await v,await T(A));const{diskNumber:P}=r;if(x=!0,y.diskNumberStart=P,y=await Jf(i,S,y,n,e.config,o),x=!1,s.set(t,y),y.filename=t,w){await S.writable.getWriter().close();let z=await I;await v,await E(),_=!0,a||(z=await np(y,z,A,o)),await T(A),y.diskNumberStart=r.diskNumber,R=r.diskOffset,await z.stream().pipeTo(A,{preventClose:!0,preventAbort:!0,signal:c}),A.size+=z.size,_=!1}if(y.offset=e.offset-R,y.zip64)op(y,o);else if(y.offset>et)throw new Error(ks);return e.offset+=y.size,y}catch(v){if(w&&_||!w&&x){if(e.hasCorruptedEntries=!0,v)try{v.corruptedEntry=!0}catch{}w?e.offset+=S.writable.size:e.offset=S.writable.size}throw s.delete(t),v}finally{w&&e.bufferedWrites--,f&&f(),p&&p()}function D(){y.lock=new Promise(v=>f=v)}async function E(){e.writerLocked=!0;const{lockWriter:v}=e;e.lockWriter=new Promise(A=>p=()=>{e.writerLocked=!1,A()}),await v}async function T(v){oe(d.localHeaderArray)>r.availableSize&&(r.availableSize=0,await Nt(v,new Uint8Array))}}async function Jf(e,t,{diskNumberStart:i,lock:n},o,s,r){const{headerInfo:l,dataDescriptorInfo:a,metadataSize:c}=o,{localHeaderArray:d,headerArray:g,lastModDate:m,rawLastModDate:y,encrypted:w,compressed:p,version:f,compressionMethod:_,rawExtraFieldExtendedTimestamp:x,extraFieldExtendedTimestampFlag:S,rawExtraFieldNTFS:I,rawExtraFieldAES:D}=l,{dataDescriptorArray:E}=a,{rawFilename:T,lastAccessDate:v,creationDate:A,password:R,rawPassword:P,level:z,zip64:M,zip64UncompressedSize:q,zip64CompressedSize:V,zip64Offset:U,zip64DiskNumberStart:H,zipCrypto:Z,dataDescriptor:ce,directory:G,versionMadeBy:we,rawComment:$,rawExtraField:ie,useWebWorkers:be,onstart:de,onprogress:xe,onend:bt,signal:ot,encryptionStrength:st,extendedTimestamp:qe,msDosCompatible:ft,internalFileAttribute:Ae,externalFileAttribute:Ee,useCompressionStream:Ge}=r,he={lock:n,versionMadeBy:we,zip64:M,directory:!!G,filenameUTF8:!0,rawFilename:T,commentUTF8:!0,rawComment:$,rawExtraFieldExtendedTimestamp:x,rawExtraFieldNTFS:I,rawExtraFieldAES:D,rawExtraField:ie,extendedTimestamp:qe,msDosCompatible:ft,internalFileAttribute:Ae,externalFileAttribute:Ee,diskNumberStart:i};let _e=0,Ye=0,je;const{writable:Pe}=t;if(e){e.chunkSize=Fu(s),await Nt(Pe,d);const Re=e.readable,Ht=Re.size=e.size,Ni={options:{codecType:Hl,level:z,rawPassword:P,password:R,encryptionStrength:st,zipCrypto:w&&Z,passwordVerification:w&&Z&&y>>8&255,signed:!0,compressed:p,encrypted:w,useWebWorkers:be,useCompressionStream:Ge,transferStreams:!1},config:s,streamOptions:{signal:ot,size:Ht,onstart:de,onprogress:xe,onend:bt}},Et=await Cf({readable:Re,writable:Pe},Ni);Ye=Et.inputSize,_e=Et.outputSize,je=Et.signature,Pe.size+=Ye}else await Nt(Pe,d);let Vt;if(M){let Re=4;q&&(Re+=8),V&&(Re+=8),U&&(Re+=8),H&&(Re+=4),Vt=new Uint8Array(Re)}else Vt=new Uint8Array;return ip({signature:je,rawExtraFieldZip64:Vt,compressedSize:_e,uncompressedSize:Ye,headerInfo:l,dataDescriptorInfo:a},r),ce&&await Nt(Pe,E),Object.assign(he,{uncompressedSize:Ye,compressedSize:_e,lastModDate:m,rawLastModDate:y,creationDate:A,lastAccessDate:v,encrypted:w,size:c+_e,compressionMethod:_,version:f,headerArray:g,signature:je,rawExtraFieldZip64:Vt,extraFieldExtendedTimestampFlag:S,zip64UncompressedSize:q,zip64CompressedSize:V,zip64Offset:U,zip64DiskNumberStart:H}),he}function Qf(e){const{rawFilename:t,lastModDate:i,lastAccessDate:n,creationDate:o,rawPassword:s,password:r,level:l,zip64:a,zipCrypto:c,dataDescriptor:d,directory:g,rawExtraField:m,encryptionStrength:y,extendedTimestamp:w}=e,p=l!==0&&!g,f=!!(r&&oe(r)||s&&oe(s));let _=e.version,x;if(f&&!c){x=new Uint8Array(oe(Ea)+2);const H=Me(x);se(H,0,Du),Te(x,Ea,2),ho(H,8,y)}else x=new Uint8Array;let S,I,D;if(w){I=new Uint8Array(9+(n?4:0)+(o?4:0));const H=Me(I);se(H,0,wl),se(H,2,oe(I)-4),D=1+(n?2:0)+(o?4:0),ho(H,4,D);let Z=5;ne(H,Z,Math.floor(i.getTime()/1e3)),Z+=4,n&&(ne(H,Z,Math.floor(n.getTime()/1e3)),Z+=4),o&&ne(H,Z,Math.floor(o.getTime()/1e3));try{S=new Uint8Array(36);const ce=Me(S),G=$o(i);se(ce,0,Tu),se(ce,2,32),se(ce,8,Iu),se(ce,10,24),Qe(ce,12,G),Qe(ce,20,$o(n)||G),Qe(ce,28,$o(o)||G)}catch{S=new Uint8Array}}else S=I=new Uint8Array;let E=Pu;d&&(E=E|Ou);let T=_u;p&&(T=na),a&&(_=_>oa?_:oa),f&&(E=E|Au,c||(_=_>sa?_:sa,T=mu,p&&(x[9]=na)));const v=new Uint8Array(26),A=Me(v);se(A,0,_),se(A,2,E),se(A,4,T);const R=new Uint32Array(1),P=Me(R);let z;i<aa?z=aa:i>ra?z=ra:z=i,se(P,0,(z.getHours()<<6|z.getMinutes())<<5|z.getSeconds()/2),se(P,2,(z.getFullYear()-1980<<4|z.getMonth()+1)<<5|z.getDate());const M=R[0];ne(A,6,M),se(A,22,oe(t));const q=oe(x,I,S,m);se(A,24,q);const V=new Uint8Array(30+oe(t)+q),U=Me(V);return ne(U,0,gu),Te(V,v,4),Te(V,t,30),Te(V,x,30+oe(t)),Te(V,I,30+oe(t,x)),Te(V,S,30+oe(t,x,I)),Te(V,m,30+oe(t,x,I,S)),{localHeaderArray:V,headerArray:v,headerView:A,lastModDate:i,rawLastModDate:M,encrypted:f,compressed:p,version:_,compressionMethod:T,extraFieldExtendedTimestampFlag:D,rawExtraFieldExtendedTimestamp:I,rawExtraFieldNTFS:S,rawExtraFieldAES:x,extraFieldLength:q}}function ep(e,t){const{headerInfo:i}=e;let{localHeaderArray:n,extraFieldLength:o}=i,s=Me(n),r=64-(t+oe(n))%64;r<4&&(r+=64);const l=new Uint8Array(r),a=Me(l);se(a,0,vu),se(a,2,r-2);const c=n;i.localHeaderArray=n=new Uint8Array(oe(c)+r),Te(n,c),Te(n,l,oe(c)),s=Me(n),se(s,28,o+r),e.metadataSize+=r}function tp(e){const{zip64:t,dataDescriptor:i,dataDescriptorSignature:n}=e;let o=new Uint8Array,s,r=0;return i&&(o=new Uint8Array(t?n?24:20:n?16:12),s=Me(o),n&&(r=4,ne(s,0,yu))),{dataDescriptorArray:o,dataDescriptorView:s,dataDescriptorOffset:r}}function ip(e,t){const{signature:i,rawExtraFieldZip64:n,compressedSize:o,uncompressedSize:s,headerInfo:r,dataDescriptorInfo:l}=e,{headerView:a,encrypted:c}=r,{dataDescriptorView:d,dataDescriptorOffset:g}=l,{zip64:m,zip64UncompressedSize:y,zip64CompressedSize:w,zipCrypto:p,dataDescriptor:f}=t;if((!c||p)&&i!==Se&&(ne(a,10,i),f&&ne(d,g,i)),m){const _=Me(n);se(_,0,Eu),se(_,2,oe(n)-4);let x=4;y&&(ne(a,18,et),Qe(_,x,BigInt(s)),x+=8),w&&(ne(a,14,et),Qe(_,x,BigInt(o))),f&&(Qe(d,g+4,BigInt(o)),Qe(d,g+12,BigInt(s)))}else ne(a,14,o),ne(a,18,s),f&&(ne(d,g+4,o),ne(d,g+8,s))}async function np(e,t,i,{zipCrypto:n}){let o;o=await t.slice(0,26).arrayBuffer(),o.byteLength!=26&&(o=o.slice(0,26));const s=new DataView(o);return(!e.encrypted||n)&&ne(s,14,e.signature),e.zip64?(ne(s,18,et),ne(s,22,et)):(ne(s,18,e.compressedSize),ne(s,22,e.uncompressedSize)),await Nt(i,new Uint8Array(o)),t.slice(o.byteLength)}function op(e,t){const{rawExtraFieldZip64:i,offset:n,diskNumberStart:o}=e,{zip64UncompressedSize:s,zip64CompressedSize:r,zip64Offset:l,zip64DiskNumberStart:a}=t,c=Me(i);let d=4;s&&(d+=8),r&&(d+=8),l&&(Qe(c,d,BigInt(n)),d+=8),a&&ne(c,d,o)}async function sp(e,t,i){const{files:n,writer:o}=e,{diskOffset:s,writable:r}=o;let{diskNumber:l}=o,a=0,c=0,d=e.offset-s,g=n.size;for(const[,D]of n){const{rawFilename:E,rawExtraFieldZip64:T,rawExtraFieldAES:v,rawComment:A,rawExtraFieldNTFS:R,rawExtraField:P,extendedTimestamp:z,extraFieldExtendedTimestampFlag:M,lastModDate:q}=D;let V;if(z){V=new Uint8Array(9);const U=Me(V);se(U,0,wl),se(U,2,5),ho(U,4,M),ne(U,5,Math.floor(q.getTime()/1e3))}else V=new Uint8Array;D.rawExtraFieldCDExtendedTimestamp=V,c+=46+oe(E,A,T,v,R,V,P)}const m=new Uint8Array(c),y=Me(m);await Ln(o);let w=0;for(const[D,E]of Array.from(n.values()).entries()){const{offset:T,rawFilename:v,rawExtraFieldZip64:A,rawExtraFieldAES:R,rawExtraFieldCDExtendedTimestamp:P,rawExtraFieldNTFS:z,rawExtraField:M,rawComment:q,versionMadeBy:V,headerArray:U,directory:H,zip64:Z,zip64UncompressedSize:ce,zip64CompressedSize:G,zip64DiskNumberStart:we,zip64Offset:$,msDosCompatible:ie,internalFileAttribute:be,externalFileAttribute:de,diskNumberStart:xe,uncompressedSize:bt,compressedSize:ot}=E,st=oe(A,R,P,z,M);ne(y,a,wu),se(y,a+4,V);const qe=Me(U);ce||ne(qe,18,bt),G||ne(qe,14,ot),Te(m,U,a+6),se(y,a+30,st),se(y,a+32,oe(q)),se(y,a+34,Z&&we?Je:xe),se(y,a+36,be),de?ne(y,a+38,de):H&&ie&&ho(y,a+38,Ru),ne(y,a+42,Z&&$?et:T),Te(m,v,a+46),Te(m,A,a+46+oe(v)),Te(m,R,a+46+oe(v,A)),Te(m,P,a+46+oe(v,A,R)),Te(m,z,a+46+oe(v,A,R,P)),Te(m,M,a+46+oe(v,A,R,P,z)),Te(m,q,a+46+oe(v)+st);const ft=46+oe(v,q)+st;if(a-w>o.availableSize&&(o.availableSize=0,await Nt(r,m.slice(w,a)),w=a),a+=ft,i.onprogress)try{await i.onprogress(D+1,n.size,new ic(E))}catch{}}await Nt(r,w?m.slice(w):m);let p=o.diskNumber;const{availableSize:f}=o;f<ws&&p++;let _=ue(e,i,"zip64");if(d>et||c>et||g>Je||p>Je){if(_===!1)throw new Error(ks);_=!0}const x=new Uint8Array(_?bu:ws),S=Me(x);a=0,_&&(ne(S,0,Cu),Qe(S,4,BigInt(44)),se(S,12,45),se(S,14,45),ne(S,16,p),ne(S,20,l),Qe(S,24,BigInt(g)),Qe(S,32,BigInt(g)),Qe(S,40,BigInt(c)),Qe(S,48,BigInt(d)),ne(S,56,Su),Qe(S,64,BigInt(d)+BigInt(c)),ne(S,72,p+1),ue(e,i,"supportZip64SplitFile",!0)&&(p=Je,l=Je),g=Je,d=et,c=et,a+=yl+gl),ne(S,a,xu),se(S,a+4,p),se(S,a+6,l),se(S,a+8,g),se(S,a+10,g),ne(S,a+12,c),ne(S,a+16,d);const I=oe(t);if(I)if(I<=Je)se(S,a+20,I);else throw new Error(Wf);await Nt(r,x),I&&await Nt(r,t)}async function Nt(e,t){const i=e.getWriter();try{await i.ready,e.size+=oe(t),await i.write(t)}finally{i.releaseLock()}}function $o(e){if(e)return(BigInt(e.getTime())+BigInt(116444736e5))*BigInt(1e4)}function ue(e,t,i,n){const o=t[i]===Se?e.options[i]:t[i];return o===Se?n:o}function rp(e){return e+5*(Math.floor(e/16383)+1)}function ho(e,t,i){e.setUint8(t,i)}function se(e,t,i){e.setUint16(t,i,!0)}function ne(e,t,i){e.setUint32(t,i,!0)}function Qe(e,t,i){e.setBigUint64(t,i,!0)}function Te(e,t,i){e.set(t,i)}function Me(e){return new DataView(e.buffer)}function oe(...e){let t=0;return e.forEach(i=>i&&(t+=i.length)),t}Cl({Deflate:jh,Inflate:pu});const bs=32,ap="http://www.opengis.net/kml/2.2",Pt="http://www.google.com/kml/ext/2.2",lp="http://www.w3.org/2000/xmlns/";function wo(e){this._files={},this._promises=[],this._count=0,this._modelCallback=e}const cp=/^data:image\/([^,;]+)/;wo.prototype.texture=function(e){const t=this;let i;if(typeof e=="string"||e instanceof ss){if(e=ss.createIfNeeded(e),!e.isDataUri)return e.url;const n=e.url.match(cp);i=`texture_${++this._count}`,u(n)&&(i+=`.${n[1]}`);const o=e.fetchBlob().then(function(s){t._files[i]=s});return this._promises.push(o),i}if(e instanceof HTMLCanvasElement){i=`texture_${++this._count}.png`;const n=new Promise(o=>{e.toBlob(function(s){t._files[i]=s,o()})});return this._promises.push(n),i}return""};function dp(e,t){return function(i){e._files[t]=i}}wo.prototype.model=function(e,t){const i=this._modelCallback;if(!u(i))throw new Pc("Encountered a model entity while exporting to KML, but no model callback was supplied.");const n={},o=i(e,t,n);for(const s in n)if(n.hasOwnProperty(s)){const r=Promise.resolve(n[s]);this._promises.push(r),r.then(dp(this,s))}return o};Object.defineProperties(wo.prototype,{promise:{get:function(){return Promise.all(this._promises)}},files:{get:function(){return this._files}}});function xo(e){this._time=e}xo.prototype.get=function(e,t,i){let n;return u(e)&&(n=u(e.getValue)?e.getValue(this._time,i):e),h(n,t)};xo.prototype.getColor=function(e,t){const i=this.get(e,t);if(u(i))return Di(i)};xo.prototype.getMaterialType=function(e){if(u(e))return e.getType(this._time)};function Fs(){this._ids={},this._styles={},this._count=0}Fs.prototype.get=function(e){const t=this._ids,i=e.innerHTML;if(u(t[i]))return t[i];let n=`style-${++this._count}`;return e.setAttribute("id",n),n=`#${n}`,t[i]=n,this._styles[i]=e,n};Fs.prototype.save=function(e){const t=this._styles,i=e.childNodes[0];for(const n in t)t.hasOwnProperty(n)&&e.insertBefore(t[n],i)};function nc(){this._ids={}}nc.prototype.get=function(e){if(!u(e))return this.get(Is());const t=this._ids;return u(t[e])?`${e.toString()}-${++t[e]}`:(t[e]=0,e)};function oc(e){e=h(e,h.EMPTY_OBJECT);const t=e.entities,i=h(e.kmz,!1);if(!u(t))throw new N("entities is required.");const n=oc._createState(e),o=t.values.filter(function(c){return!u(c.parent)}),s=n.kmlDoc,r=s.documentElement;r.setAttributeNS(lp,"xmlns:gx",Pt);const l=s.createElement("Document");r.appendChild(l),rc(n,l,o),n.styleCache.save(l);const a=n.externalFileHandler;return a.promise.then(function(){const d=new XMLSerializer().serializeToString(n.kmlDoc);return i?hp(d,a.files):{kml:d,externalFiles:a.files}})}function hp(e,t){const i=Oc("ThirdParty/Workers/z-worker-pako.js");Cl({workerScripts:{deflate:[i,"./pako_deflate.min.js"],inflate:[i,"./pako_inflate.min.js"]}});const n=new jl,o=new Zf(n);return o.add("doc.kml",new vf(e)).then(function(){const s=Object.keys(t);return sc(o,s,t,0)}).then(function(){return o.close()}).then(function(s){return{kmz:s}})}function sc(e,t,i,n){if(t.length===n)return;const o=t[n];return e.add(o,new Yl(i[o])).then(function(){return sc(e,t,i,n+1)})}oc._createState=function(e){const t=e.entities,i=new Fs,n=t.computeAvailability(),o=u(e.time)?e.time:n.start;let s=h(e.defaultAvailability,n);const r=h(e.sampleDuration,60);s.start===Ue.MINIMUM_VALUE?s.stop===Ue.MAXIMUM_VALUE?s=new J:B.addSeconds(s.stop,-10*r,s.start):s.stop===Ue.MAXIMUM_VALUE&&B.addSeconds(s.start,10*r,s.stop);const l=new wo(e.modelCallback);return{kmlDoc:document.implementation.createDocument(ap,"kml"),ellipsoid:h(e.ellipsoid,li.default),idManager:new nc,styleCache:i,externalFileHandler:l,time:o,valueGetter:new xo(o),sampleDuration:r,defaultAvailability:new ye([s])}};function rc(e,t,i){const n=e.kmlDoc,o=e.styleCache,s=e.valueGetter,r=e.idManager,l=i.length;let a,c,d;for(let g=0;g<l;++g){const m=i[g];a=[],c=[],d=[],up(e,m,c,d),fp(e,m.polyline,c,d),Ia(e,m.rectangle,c,d,a),Ia(e,m.polygon,c,d,a),gp(e,m,m.model,c,d);let y;const w=m.availability;u(w)&&(y=n.createElement("TimeSpan"),B.equals(w.start,Ue.MINIMUM_VALUE)||y.appendChild(j(n,"begin",B.toIso8601(w.start))),B.equals(w.stop,Ue.MAXIMUM_VALUE)||y.appendChild(j(n,"end",B.toIso8601(w.stop))));for(let _=0;_<a.length;++_){const x=a[_];x.setAttribute("id",r.get(m.id)),x.appendChild(j(n,"name",m.name)),x.appendChild(j(n,"visibility",m.show)),x.appendChild(j(n,"description",m.description)),u(y)&&x.appendChild(y),t.appendChild(x)}const p=c.length;if(p>0){const _=n.createElement("Placemark");_.setAttribute("id",r.get(m.id));let x=m.name;const S=m.label;if(u(S)){const D=n.createElement("LabelStyle"),E=s.get(S.text);x=u(E)&&E.length>0?E:x;const T=s.getColor(S.fillColor);u(T)&&(D.appendChild(j(n,"color",T)),D.appendChild(j(n,"colorMode","normal")));const v=s.get(S.scale);u(v)&&D.appendChild(j(n,"scale",v)),d.push(D)}_.appendChild(j(n,"name",x)),_.appendChild(j(n,"visibility",m.show)),_.appendChild(j(n,"description",m.description)),u(y)&&_.appendChild(y),t.appendChild(_);const I=d.length;if(I>0){const D=n.createElement("Style");for(let E=0;E<I;++E)D.appendChild(d[E]);_.appendChild(j(n,"styleUrl",o.get(D)))}if(c.length===1)_.appendChild(c[0]);else if(c.length>1){const D=n.createElement("MultiGeometry");for(let E=0;E<p;++E)D.appendChild(c[E]);_.appendChild(D)}}const f=m._children;if(f.length>0){const _=n.createElement("Folder");_.setAttribute("id",r.get(m.id)),_.appendChild(j(n,"name",m.name)),_.appendChild(j(n,"visibility",m.show)),_.appendChild(j(n,"description",m.description)),t.appendChild(_),rc(e,_,f)}}}const Ke=new b,He=new ae,Tt=new B;function up(e,t,i,n){const o=e.kmlDoc,s=e.ellipsoid,r=e.valueGetter,l=h(t.billboard,t.point);if(!u(l)&&!u(t.path))return;const a=t.position;if(!a.isConstant){ac(e,t,l,i,n);return}r.get(a,void 0,Ke);const c=j(o,"coordinates",Ei(Ke,s)),d=o.createElement("Point"),g=o.createElement("altitudeMode");g.appendChild(Ti(e,l.heightReference)),d.appendChild(g),d.appendChild(c),i.push(d);const m=l instanceof Ii?cc(e,l):lc(e,l);n.push(m)}function ac(e,t,i,n,o){const s=e.kmlDoc,r=e.ellipsoid,l=e.valueGetter;let a;const c=t.position;let d=!0;c instanceof hi?(a=c.intervals,d=!1):a=h(t.availability,e.defaultAvailability);const g=i instanceof Ji;let m,y,w;const p=[];for(m=0;m<a.length;++m){const _=a.get(m);let x=d?c:_.data;const S=s.createElement("altitudeMode");x instanceof ui?(x=x._value,S.appendChild(Ti(e,si.CLAMP_TO_GROUND))):u(i)?S.appendChild(Ti(e,i.heightReference)):S.appendChild(Ti(e,si.NONE));const I=[],D=[];if(x.isConstant){l.get(x,void 0,Ke);const T=j(s,"coordinates",Ei(Ke,r));I.push(B.toIso8601(_.start)),D.push(T),I.push(B.toIso8601(_.stop)),D.push(T)}else if(x instanceof Ct)for(w=x._property._times,y=0;y<w.length;++y)I.push(B.toIso8601(w[y])),x.getValueInReferenceFrame(w[y],xt.FIXED,Ke),D.push(Ei(Ke,r));else if(x instanceof St){w=x._times;const T=x._values;for(y=0;y<w.length;++y)I.push(B.toIso8601(w[y])),b.fromArray(T,y*3,Ke),D.push(Ei(Ke,r))}else{const T=e.sampleDuration;_.start.clone(Tt),_.isStartIncluded||B.addSeconds(Tt,T,Tt);const v=_.stop;for(;B.lessThan(Tt,v);)x.getValue(Tt,Ke),I.push(B.toIso8601(Tt)),D.push(Ei(Ke,r)),B.addSeconds(Tt,T,Tt);_.isStopIncluded&&B.equals(Tt,v)&&(x.getValue(Tt,Ke),I.push(B.toIso8601(Tt)),D.push(Ei(Ke,r)))}const E=s.createElementNS(Pt,"Track");E.appendChild(S);for(let T=0;T<I.length;++T){const v=j(s,"when",I[T]),A=j(s,"coord",D[T],Pt);E.appendChild(v),E.appendChild(A)}g&&E.appendChild(dc(e,i)),p.push(E)}if(p.length===1)n.push(p[0]);else if(p.length>1){const _=s.createElementNS(Pt,"MultiTrack");for(m=0;m<p.length;++m)_.appendChild(p[m]);n.push(_)}if(u(i)&&!g){const _=i instanceof Ii?cc(e,i):lc(e,i);o.push(_)}const f=t.path;if(u(f)){const _=l.get(f.width),x=f.material;if(u(x)||u(_)){const S=s.createElement("LineStyle");u(_)&&S.appendChild(j(s,"width",_)),zs(e,x,S),o.push(S)}}}function lc(e,t){const i=e.kmlDoc,n=e.valueGetter,o=i.createElement("IconStyle"),s=n.getColor(t.color);u(s)&&(o.appendChild(j(i,"color",s)),o.appendChild(j(i,"colorMode","normal")));const r=n.get(t.pixelSize);return u(r)&&o.appendChild(j(i,"scale",r/bs)),o}function cc(e,t){const i=e.kmlDoc,n=e.valueGetter,o=e.externalFileHandler,s=i.createElement("IconStyle");let r=n.get(t.image);if(u(r)){r=o.texture(r);const m=i.createElement("Icon");m.appendChild(j(i,"href",r));const y=n.get(t.imageSubRegion);u(y)&&(m.appendChild(j(i,"x",y.x,Pt)),m.appendChild(j(i,"y",y.y,Pt)),m.appendChild(j(i,"w",y.width,Pt)),m.appendChild(j(i,"h",y.height,Pt))),s.appendChild(m)}const l=n.getColor(t.color);u(l)&&(s.appendChild(j(i,"color",l)),s.appendChild(j(i,"colorMode","normal")));let a=n.get(t.scale);u(a)&&s.appendChild(j(i,"scale",a));const c=n.get(t.pixelOffset);if(u(c)){a=h(a,1),Y.divideByScalar(c,a,c);const m=n.get(t.width,bs),y=n.get(t.height,bs),w=n.get(t.horizontalOrigin,bo.CENTER);w===bo.CENTER?c.x-=m*.5:w===bo.RIGHT&&(c.x-=m);const p=n.get(t.verticalOrigin,Eo.CENTER);p===Eo.TOP?c.y+=y:p===Eo.CENTER&&(c.y+=y*.5);const f=i.createElement("hotSpot");f.setAttribute("x",-c.x),f.setAttribute("y",c.y),f.setAttribute("xunits","pixels"),f.setAttribute("yunits","pixels"),s.appendChild(f)}let d=n.get(t.rotation);const g=n.get(t.alignedAxis);return u(d)&&b.equals(b.UNIT_Z,g)&&(d=X.toDegrees(-d),d===0&&(d=360),s.appendChild(j(i,"heading",d))),s}function fp(e,t,i,n){const o=e.kmlDoc,s=e.ellipsoid,r=e.valueGetter;if(!u(t))return;const l=o.createElement("LineString"),a=o.createElement("altitudeMode"),c=r.get(t.clampToGround,!1);let d;c?(l.appendChild(j(o,"tessellate",!0)),d=o.createTextNode("clampToGround")):d=o.createTextNode("absolute"),a.appendChild(d),l.appendChild(a);const g=t.positions,m=r.get(g),y=j(o,"coordinates",Ei(m,s));l.appendChild(y);const w=r.get(t.zIndex);c&&u(w)&&l.appendChild(j(o,"drawOrder",w,Pt)),i.push(l);const p=o.createElement("LineStyle"),f=r.get(t.width);u(f)&&p.appendChild(j(o,"width",f)),zs(e,t.material,p),n.push(p)}function pp(e,t,i){const n=e.kmlDoc,o=e.valueGetter;let s=o.get(t.height,0);i>0&&(s=i);const r=t.coordinates,l=o.get(r),a=[],c=[Lt.northeast,Lt.southeast,Lt.southwest,Lt.northwest];for(let y=0;y<4;++y)c[y](l,He),a.push(`${X.toDegrees(He.longitude)},${X.toDegrees(He.latitude)},${s}`);const d=j(n,"coordinates",a.join(" ")),g=n.createElement("outerBoundaryIs"),m=n.createElement("LinearRing");return m.appendChild(d),g.appendChild(m),[g]}function Ta(e,t,i,n){const o=e.kmlDoc,s=e.ellipsoid,r=[],l=t.length;for(let d=0;d<l;++d)ae.fromCartesian(t[d],s,He),r.push(`${X.toDegrees(He.longitude)},${X.toDegrees(He.latitude)},${n?He.height:i}`);const a=j(o,"coordinates",r.join(" ")),c=o.createElement("LinearRing");return c.appendChild(a),c}function _p(e,t,i){const n=e.kmlDoc,o=e.valueGetter;let s=o.get(t.height,0);const r=o.get(t.perPositionHeight,!1);!r&&i>0&&(s=i);const l=[],a=t.hierarchy,c=o.get(a),d=Array.isArray(c)?c:c.positions,g=n.createElement("outerBoundaryIs");g.appendChild(Ta(e,d,s,r)),l.push(g);const m=c.holes;if(u(m)){const y=m.length;for(let w=0;w<y;++w){const p=n.createElement("innerBoundaryIs");p.appendChild(Ta(e,m[w].positions,s,r)),l.push(p)}}return l}function Ia(e,t,i,n,o){const s=e.kmlDoc,r=e.valueGetter;if(!u(t))return;const l=t instanceof Qi;if(l&&r.getMaterialType(t.material)==="Image"){mp(e,t,o);return}const a=s.createElement("Polygon"),c=r.get(t.extrudedHeight,0);c>0&&a.appendChild(j(s,"extrude",!0));const d=l?pp(e,t,c):_p(e,t,c),g=d.length;for(let f=0;f<g;++f)a.appendChild(d[f]);const m=s.createElement("altitudeMode");m.appendChild(Ti(e,t.heightReference)),a.appendChild(m),i.push(a);const y=s.createElement("PolyStyle"),w=r.get(t.fill,!1);w&&y.appendChild(j(s,"fill",w)),zs(e,t.material,y);const p=r.get(t.outline,!1);if(p){y.appendChild(j(s,"outline",p));const f=s.createElement("LineStyle"),_=r.get(t.outlineWidth,1);f.appendChild(j(s,"width",_));const x=r.getColor(t.outlineColor,Nn.BLACK);f.appendChild(j(s,"color",x)),f.appendChild(j(s,"colorMode","normal")),n.push(f)}n.push(y)}function mp(e,t,i){const n=e.kmlDoc,o=e.valueGetter,s=e.externalFileHandler,r=n.createElement("GroundOverlay"),l=n.createElement("altitudeMode");l.appendChild(Ti(e,t.heightReference)),r.appendChild(l);const a=o.get(t.height);u(a)&&r.appendChild(j(n,"altitude",a));const c=o.get(t.coordinates),d=n.createElement("LatLonBox");d.appendChild(j(n,"north",X.toDegrees(c.north))),d.appendChild(j(n,"south",X.toDegrees(c.south))),d.appendChild(j(n,"east",X.toDegrees(c.east))),d.appendChild(j(n,"west",X.toDegrees(c.west))),r.appendChild(d);const g=o.get(t.material),m=s.texture(g.image),y=n.createElement("Icon");y.appendChild(j(n,"href",m)),r.appendChild(y);const w=g.color;u(w)&&r.appendChild(j(n,"color",Di(g.color))),i.push(r)}function dc(e,t){const i=e.kmlDoc,n=e.valueGetter,o=e.externalFileHandler,s=i.createElement("Model"),r=n.get(t.scale);if(u(r)){const c=i.createElement("scale");c.appendChild(j(i,"x",r)),c.appendChild(j(i,"y",r)),c.appendChild(j(i,"z",r)),s.appendChild(c)}const l=i.createElement("Link"),a=o.model(t,e.time);return l.appendChild(j(i,"href",a)),s.appendChild(l),s}function gp(e,t,i,n,o){const s=e.kmlDoc,r=e.ellipsoid,l=e.valueGetter;if(!u(i))return;const a=t.position;if(!a.isConstant){ac(e,t,i,n,o);return}const c=dc(e,i),d=s.createElement("altitudeMode");d.appendChild(Ti(e,i.heightReference)),c.appendChild(d),l.get(a,void 0,Ke),ae.fromCartesian(Ke,r,He);const g=s.createElement("Location");g.appendChild(j(s,"longitude",X.toDegrees(He.longitude))),g.appendChild(j(s,"latitude",X.toDegrees(He.latitude))),g.appendChild(j(s,"altitude",He.height)),c.appendChild(g),n.push(c)}function zs(e,t,i){const n=e.kmlDoc,o=e.valueGetter;if(!u(t))return;const s=o.get(t);if(!u(s))return;let r;const l=o.getMaterialType(t);let a,c;switch(l){case"Image":r=Di(Nn.WHITE);break;case"Color":case"Grid":case"PolylineGlow":case"PolylineArrow":case"PolylineDash":r=Di(s.color);break;case"PolylineOutline":r=Di(s.color),a=Di(s.outlineColor),c=s.outlineWidth,i.appendChild(j(n,"outerColor",a,Pt)),i.appendChild(j(n,"outerWidth",c,Pt));break;case"Stripe":r=Di(s.oddColor);break}u(r)&&(i.appendChild(j(n,"color",r)),i.appendChild(j(n,"colorMode","normal")))}function Ti(e,t){const i=e.kmlDoc,o=e.valueGetter.get(t,si.NONE);let s;switch(o){case si.NONE:s=i.createTextNode("absolute");break;case si.CLAMP_TO_GROUND:s=i.createTextNode("clampToGround");break;case si.RELATIVE_TO_GROUND:s=i.createTextNode("relativeToGround");break}return s}function Ei(e,t){Array.isArray(e)||(e=[e]);const i=e.length,n=[];for(let o=0;o<i;++o)ae.fromCartesian(e[o],t,He),n.push(`${X.toDegrees(He.longitude)},${X.toDegrees(He.latitude)},${He.height}`);return n.join(" ")}function j(e,t,i,n){i=h(i,""),typeof i=="boolean"&&(i=i?"1":"0");const o=u(n)?e.createElementNS(n,t):e.createElement(t),s=i==="string"&&i.indexOf("<")!==-1?e.createCDATASection(i):e.createTextNode(i);return o.appendChild(s),o}function Di(e){let t="";const i=e.toBytes();for(let n=3;n>=0;--n)t+=i[n]<16?`0${i[n].toString(16)}`:i[n].toString(16);return t}const yp={SHIFT:0,CTRL:1,ALT:2},Jo=Object.freeze(yp),wp={LEFT_DOWN:0,LEFT_UP:1,LEFT_CLICK:2,LEFT_DOUBLE_CLICK:3,RIGHT_DOWN:5,RIGHT_UP:6,RIGHT_CLICK:7,MIDDLE_DOWN:10,MIDDLE_UP:11,MIDDLE_CLICK:12,MOUSE_MOVE:15,WHEEL:16,PINCH_START:17,PINCH_END:18,PINCH_MOVE:19},Ie=Object.freeze(wp);function gi(e,t,i){const n=e._element;if(n===document)return i.x=t.clientX,i.y=t.clientY,i;const o=n.getBoundingClientRect();return i.x=t.clientX-o.left,i.y=t.clientY-o.top,i}function Bs(e,t){let i=e;return u(t)&&(i+=`+${t}`),i}function Li(e){if(e.shiftKey)return Jo.SHIFT;if(e.ctrlKey)return Jo.CTRL;if(e.altKey)return Jo.ALT}const De={LEFT:0,MIDDLE:1,RIGHT:2};function lt(e,t,i,n){function o(s){n(e,s)}fo.isInternetExplorer()?i.addEventListener(t,o,!1):i.addEventListener(t,o,{capture:!1,passive:!1}),e._removalFunctions.push(function(){i.removeEventListener(t,o,!1)})}function xp(e){const t=e._element,i=u(t.disableRootEvents)?t:document;fo.supportsPointerEvents()?(lt(e,"pointerdown",t,Tp),lt(e,"pointerup",t,Fa),lt(e,"pointermove",t,Ip),lt(e,"pointercancel",t,Fa)):(lt(e,"mousedown",t,hc),lt(e,"mouseup",i,uc),lt(e,"mousemove",i,fc),lt(e,"touchstart",t,Ep),lt(e,"touchend",i,Ra),lt(e,"touchmove",i,Dp),lt(e,"touchcancel",i,Ra)),lt(e,"dblclick",t,Sp);let n;"onwheel"in t?n="wheel":document.onmousewheel!==void 0?n="mousewheel":n="DOMMouseScroll",lt(e,n,t,bp)}function Cp(e){const t=e._removalFunctions;for(let i=0;i<t.length;++i)t[i]()}const va={position:new Y};function Us(e){e._lastSeenTouchEvent=cl()}function Vs(e){return cl()-e._lastSeenTouchEvent>Ut.mouseEmulationIgnoreMilliseconds}function Es(e,t,i){const n=e.x-t.x,o=e.y-t.y;return Math.sqrt(n*n+o*o)<i}function hc(e,t){if(!Vs(e))return;const i=t.button;e._buttonDown[i]=!0;let n;if(i===De.LEFT)n=Ie.LEFT_DOWN;else if(i===De.MIDDLE)n=Ie.MIDDLE_DOWN;else if(i===De.RIGHT)n=Ie.RIGHT_DOWN;else return;const o=gi(e,t,e._primaryPosition);Y.clone(o,e._primaryStartPosition),Y.clone(o,e._primaryPreviousPosition);const s=Li(t),r=e.getInputAction(n,s);u(r)&&(Y.clone(o,va.position),r(va),t.preventDefault())}const Aa={position:new Y},Oa={position:new Y};function Qo(e,t,i,n){const o=Li(n),s=e.getInputAction(t,o),r=e.getInputAction(i,o);if(u(s)||u(r)){const l=gi(e,n,e._primaryPosition);if(u(s)&&(Y.clone(l,Aa.position),s(Aa)),u(r)){const a=e._primaryStartPosition;Es(a,l,e._clickPixelTolerance)&&(Y.clone(l,Oa.position),r(Oa))}}}function uc(e,t){if(!Vs(e))return;const i=t.button;i!==De.LEFT&&i!==De.MIDDLE&&i!==De.RIGHT||(e._buttonDown[De.LEFT]&&(Qo(e,Ie.LEFT_UP,Ie.LEFT_CLICK,t),e._buttonDown[De.LEFT]=!1),e._buttonDown[De.MIDDLE]&&(Qo(e,Ie.MIDDLE_UP,Ie.MIDDLE_CLICK,t),e._buttonDown[De.MIDDLE]=!1),e._buttonDown[De.RIGHT]&&(Qo(e,Ie.RIGHT_UP,Ie.RIGHT_CLICK,t),e._buttonDown[De.RIGHT]=!1))}const es={startPosition:new Y,endPosition:new Y};function fc(e,t){if(!Vs(e))return;const i=Li(t),n=gi(e,t,e._primaryPosition),o=e._primaryPreviousPosition,s=e.getInputAction(Ie.MOUSE_MOVE,i);u(s)&&(Y.clone(o,es.startPosition),Y.clone(n,es.endPosition),s(es)),Y.clone(n,o),(e._buttonDown[De.LEFT]||e._buttonDown[De.MIDDLE]||e._buttonDown[De.RIGHT])&&t.preventDefault()}const Pa={position:new Y};function Sp(e,t){const i=t.button;let n;if(i===De.LEFT)n=Ie.LEFT_DOUBLE_CLICK;else return;const o=Li(t),s=e.getInputAction(n,o);u(s)&&(gi(e,t,Pa.position),s(Pa))}function bp(e,t){let i;if(u(t.deltaY)){const s=t.deltaMode;s===t.DOM_DELTA_PIXEL?i=-t.deltaY:s===t.DOM_DELTA_LINE?i=-t.deltaY*40:i=-t.deltaY*120}else t.detail>0?i=t.detail*-120:i=t.wheelDelta;if(!u(i))return;const n=Li(t),o=e.getInputAction(Ie.WHEEL,n);u(o)&&(o(i),t.preventDefault())}function Ep(e,t){Us(e);const i=t.changedTouches;let n;const o=i.length;let s,r;const l=e._positions;for(n=0;n<o;++n)s=i[n],r=s.identifier,l.set(r,gi(e,s,new Y));Co(e,t);const a=e._previousPositions;for(n=0;n<o;++n)s=i[n],r=s.identifier,a.set(r,Y.clone(l.get(r)))}function Ra(e,t){Us(e);const i=t.changedTouches;let n;const o=i.length;let s,r;const l=e._positions;for(n=0;n<o;++n)s=i[n],r=s.identifier,l.remove(r);Co(e,t);const a=e._previousPositions;for(n=0;n<o;++n)s=i[n],r=s.identifier,a.remove(r)}const La={position:new Y},ts={position1:new Y,position2:new Y},Na={position:new Y},Ma={position:new Y},ka={position:new Y};function Co(e,t){const i=Li(t),n=e._positions,o=n.length;let s,r;const l=e._isPinching;if(o!==1&&e._buttonDown[De.LEFT]){if(e._buttonDown[De.LEFT]=!1,u(e._touchHoldTimer)&&(clearTimeout(e._touchHoldTimer),e._touchHoldTimer=void 0),s=e.getInputAction(Ie.LEFT_UP,i),u(s)&&(Y.clone(e._primaryPosition,Na.position),s(Na)),o===0&&!e._isTouchHolding&&(r=e.getInputAction(Ie.LEFT_CLICK,i),u(r))){const a=e._primaryStartPosition,c=e._previousPositions.values[0];Es(a,c,e._clickPixelTolerance)&&(Y.clone(e._primaryPosition,Ma.position),r(Ma))}e._isTouchHolding=!1}if(o===0&&l&&(e._isPinching=!1,s=e.getInputAction(Ie.PINCH_END,i),u(s)&&s()),o===1&&!l){const a=n.values[0];Y.clone(a,e._primaryPosition),Y.clone(a,e._primaryStartPosition),Y.clone(a,e._primaryPreviousPosition),e._buttonDown[De.LEFT]=!0,s=e.getInputAction(Ie.LEFT_DOWN,i),u(s)&&(Y.clone(a,La.position),s(La)),e._touchHoldTimer=setTimeout(function(){if(!e.isDestroyed()&&(e._touchHoldTimer=void 0,e._isTouchHolding=!0,r=e.getInputAction(Ie.RIGHT_CLICK,i),u(r))){const c=e._primaryStartPosition,d=e._previousPositions.values[0];Es(c,d,e._holdPixelTolerance)&&(Y.clone(e._primaryPosition,ka.position),r(ka))}},Ut.touchHoldDelayMilliseconds),t.preventDefault()}o===2&&!l&&(e._isPinching=!0,s=e.getInputAction(Ie.PINCH_START,i),u(s)&&(Y.clone(n.values[0],ts.position1),Y.clone(n.values[1],ts.position2),s(ts),t.preventDefault()))}function Dp(e,t){Us(e);const i=t.changedTouches;let n;const o=i.length;let s,r;const l=e._positions;for(n=0;n<o;++n){s=i[n],r=s.identifier;const c=l.get(r);u(c)&&gi(e,s,c)}pc(e,t);const a=e._previousPositions;for(n=0;n<o;++n)s=i[n],r=s.identifier,Y.clone(l.get(r),a.get(r))}const is={startPosition:new Y,endPosition:new Y},cn={distance:{startPosition:new Y,endPosition:new Y},angleAndHeight:{startPosition:new Y,endPosition:new Y}};function pc(e,t){const i=Li(t),n=e._positions,o=e._previousPositions,s=n.length;let r;if(s===1&&e._buttonDown[De.LEFT]){const l=n.values[0];Y.clone(l,e._primaryPosition);const a=e._primaryPreviousPosition;r=e.getInputAction(Ie.MOUSE_MOVE,i),u(r)&&(Y.clone(a,is.startPosition),Y.clone(l,is.endPosition),r(is)),Y.clone(l,a),t.preventDefault()}else if(s===2&&e._isPinching&&(r=e.getInputAction(Ie.PINCH_MOVE,i),u(r))){const l=n.values[0],a=n.values[1],c=o.values[0],d=o.values[1],g=a.x-l.x,m=a.y-l.y,y=Math.sqrt(g*g+m*m)*.25,w=d.x-c.x,p=d.y-c.y,f=Math.sqrt(w*w+p*p)*.25,_=(a.y+l.y)*.125,x=(d.y+c.y)*.125,S=Math.atan2(m,g),I=Math.atan2(p,w);Y.fromElements(0,f,cn.distance.startPosition),Y.fromElements(0,y,cn.distance.endPosition),Y.fromElements(I,x,cn.angleAndHeight.startPosition),Y.fromElements(S,_,cn.angleAndHeight.endPosition),r(cn)}}function Tp(e,t){if(t.target.setPointerCapture(t.pointerId),t.pointerType==="touch"){const i=e._positions,n=t.pointerId;i.set(n,gi(e,t,new Y)),Co(e,t),e._previousPositions.set(n,Y.clone(i.get(n)))}else hc(e,t)}function Fa(e,t){if(t.pointerType==="touch"){const i=e._positions,n=t.pointerId;i.remove(n),Co(e,t),e._previousPositions.remove(n)}else uc(e,t)}function Ip(e,t){if(t.pointerType==="touch"){const i=e._positions,n=t.pointerId,o=i.get(n);if(!u(o))return;gi(e,t,o),pc(e,t);const s=e._previousPositions;Y.clone(i.get(n),s.get(n))}else fc(e,t)}function Ut(e){this._inputEvents={},this._buttonDown={LEFT:!1,MIDDLE:!1,RIGHT:!1},this._isPinching=!1,this._isTouchHolding=!1,this._lastSeenTouchEvent=-Ut.mouseEmulationIgnoreMilliseconds,this._primaryStartPosition=new Y,this._primaryPosition=new Y,this._primaryPreviousPosition=new Y,this._positions=new qi,this._previousPositions=new qi,this._removalFunctions=[],this._touchHoldTimer=void 0,this._clickPixelTolerance=5,this._holdPixelTolerance=25,this._element=h(e,document),xp(this)}Ut.prototype.setInputAction=function(e,t,i){if(!u(e))throw new N("action is required.");if(!u(t))throw new N("type is required.");const n=Bs(t,i);this._inputEvents[n]=e};Ut.prototype.getInputAction=function(e,t){if(!u(e))throw new N("type is required.");const i=Bs(e,t);return this._inputEvents[i]};Ut.prototype.removeInputAction=function(e,t){if(!u(e))throw new N("type is required.");const i=Bs(e,t);delete this._inputEvents[i]};Ut.prototype.isDestroyed=function(){return!1};Ut.prototype.destroy=function(){return Cp(this),uo(this)};Ut.mouseEmulationIgnoreMilliseconds=800;Ut.touchHoldDelayMilliseconds=1500;export{ku as $,vi as A,Ii as B,vn as C,Ct as D,nt as E,hi as F,it as G,$i as H,Ue as I,Yi as J,Oh as K,yn as L,Ji as M,wn as N,ke as O,te as P,ui as Q,xt as R,Ut as S,ye as T,di as U,mi as V,In as W,Pi as X,$t as Y,Np as Z,Of as _,Ie as a,Ga as a$,Ln as a0,Se as a1,Yl as a2,ws as a3,Fu as a4,xu as a5,Ss as a6,ml as a7,et as a8,Je as a9,Iu as aA,Ff as aB,zf as aC,Bf as aD,Sa as aE,Au as aF,Nf as aG,Lf as aH,kf as aI,Mf as aJ,xs as aK,Zl as aL,Kl as aM,$l as aN,Uf as aO,Mp as aP,kp as aQ,Cl as aR,Lp as aS,Rp as aT,Jo as aU,Sn as aV,ht as aW,th as aX,ih as aY,nh as aZ,oh as a_,gl as aa,Su as ab,yl as ac,Cu as ad,wu as ae,Ru as af,Yo as ag,ic as ah,mu as ai,_u as aj,na as ak,gu as al,Pf as am,hf as an,Cf as ao,Al as ap,Pp as aq,Ou as ar,Pu as as,Eu as at,Ap as au,Op as av,Du as aw,Tu as ax,wl as ay,vu as az,We as b,kc as b0,Ot as b1,_i as b2,sh as b3,ah as b4,Ki as c,Bt as d,oc as e,C as f,Ai as g,cl as h,hs as i,As as j,Ri as k,J as l,ut as m,fn as n,pn as o,_n as p,mn as q,gn as r,Cn as s,bn as t,En as u,Dn as v,Tn as w,Qi as x,xn as y,St as z};
//# sourceMappingURL=ScreenSpaceEventHandler-BV10dpGX.js.map
