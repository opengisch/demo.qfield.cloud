{"version":3,"file":"desktop-5p69HYTv.js","sources":["../../../src/tools/ordering/orderingmanager.ts","../../../src/base/GirafeDraggableElement.ts","../../../src/components/about/images/logo.png","../../../src/components/about/component.ts","../../../src/components/basemap/component.ts","../../../src/components/colorswitcher/component.ts","../../../src/components/coordinate/component.ts","../../../src/components/globe/images/map-2d.svg","../../../src/components/globe/images/map-3d.svg","../../../src/components/globe/images/map-split.svg","../../../src/components/globe/images/globe.svg","../../../src/components/globe/component.ts","../../../src/components/help/images/arrow_black.webp","../../../src/components/help/images/arrow_white.webp","../../../src/components/help/component.ts","../../../src/components/metadatawindow/component.ts","../../../src/components/infobox/component.ts","../../../src/components/language/images/language.svg","../../../src/components/language/component.ts","../../../src/components/lidar/tools/profileconfig.ts","../../../node_modules/ol/interaction/Draw.js","../../../src/components/lidar/tools/drawline.ts","../../../src/components/lidar/tools/domselector.ts","../../../src/components/lidar/tools/utils.ts","../../../src/components/lidar/tools/plot.ts","../../../src/components/lidar/tools/measure.ts","../../../src/components/lidar/tools/manager.ts","../../../src/components/lidar/tools/lidarinterface.ts","../../../src/components/lidar/images/eraser.svg","../../../src/components/lidar/images/rotate.svg","../../../src/components/lidar/panel/component.ts","../../../src/base/GirafeResizableElement.ts","../../../src/components/lidar/images/close.svg?raw","../../../src/components/lidar/profile/component.ts","../../../src/tools/state/stateToggleManager.ts","../../../src/components/lr-panel/component.ts","../../../node_modules/ol/interaction/Modify.js","../../../node_modules/ol/events/SnapEvent.js","../../../node_modules/ol/interaction/Snap.js","../../../src/components/menubutton/component.ts","../../../src/components/navigation/Bookmark.ts","../../../src/components/navigation/navbookmarks/component.ts","../../../src/components/navigation/navhelper/images/add.svg","../../../src/components/navigation/navhelper/images/bookmark.svg","../../../src/components/navigation/navhelper/images/next.svg","../../../src/components/navigation/navhelper/images/previous.svg","../../../src/components/navigation/navhelper/images/trash.svg","../../../src/components/navigation/navhelper/component.ts","../../../src/components/print/tools/printUtils.ts","../../../src/tools/legendhelper.ts","../../../src/components/print/tools/MFPLegendEncoder.ts","../../../src/components/print/tools/MFPEncoder.ts","../../../src/tools/utils/olutils.ts","../../../src/components/print/tools/PrintManager.ts","../../../src/components/print/tools/printMaskLayer.ts","../../../src/components/print/tools/printMaskManager.ts","../../../src/components/print/component.ts","../../../src/components/projection/images/proj.svg","../../../src/components/projection/component.ts","../../../src/components/prototypebanner/component.ts","../../../src/tools/wfs/wfsfilter.ts","../../../src/components/querybuilder/component.ts","../../../src/components/drawing/shapeNamer.ts","../../../src/components/drawing/drawingFeature.ts","../../../src/components/drawing/olDrawing.ts","../../../src/components/drawing/cesiumDrawing.ts","../../../src/components/drawing/assets/trash.svg?raw","../../../src/components/drawing/assets/locate.svg?raw","../../../src/components/drawing/assets/visible.svg?raw","../../../src/components/drawing/assets/notVisible.svg?raw","../../../src/components/drawing/component.ts","../../../src/components/scale/component.ts","../../../src/tools/featuretogriddatabyid.ts","../../../src/components/selectiongrid/images/center.svg","../../../src/components/selectiongrid/tools/formatgridgeomvalue.ts","../../../src/components/selectiongrid/tools/selectiontabulatormanager.ts","../../../src/components/selectiongrid/component.ts","../../../src/components/selectionwindow/images/center.svg","../../../src/tools/resizewindow.ts","../../../src/components/selectionwindow/component.ts","../../../src/components/share/images/twitter.svg","../../../src/components/share/images/facebook.svg","../../../src/components/share/images/linkedin.svg","../../../src/components/share/images/mail.svg","../../../src/components/share/tools/lstumanager.ts","../../../src/components/share/tools/gmfmanager.ts","../../../src/components/share/component.ts","../../../src/components/themes/images/new.svg","../../../src/components/themes/images/custom.svg","../../../src/components/themes/tools/customtheme.ts","../../../src/components/themes/tools/customthemesmanager.ts","../../../src/components/themes/component.ts","../../../src/components/treeview/tools/grouphelper.ts","../../../src/components/treeview/treeviewroot/component.ts","../../../src/components/treeview/tools/draghelper.ts","../../../src/components/treeview/tools/dragmanager.ts","../../../src/components/treeview/tools/treeviewelement.ts","../../../src/components/treeview/treeviewitem/component.ts","../../../src/components/treeview/tools/treeviewgroupelement.ts","../../../src/components/treeview/treeviewgroup/component.ts","../../../src/components/treeview/treeviewtheme/component.ts","../../../src/components/videorecord/images/video.svg","../../../src/components/videorecord/images/stop.svg","../../../src/components/videorecord/images/download.svg","../../../src/components/videorecord/component.ts","../../../src/main.ts"],"sourcesContent":["import GirafeSingleton from '../../base/GirafeSingleton';\nimport BaseLayer from '../../models/layers/baselayer';\nimport GroupLayer from '../../models/layers/grouplayer';\nimport ThemeLayer from '../../models/layers/themelayer';\nimport StateManager from '../state/statemanager';\n\ntype OrderCounter = {\n  index: number;\n};\n\nexport default class OrderingManager extends GirafeSingleton {\n  private stateManager: StateManager;\n\n  private timeoutId?: NodeJS.Timeout;\n\n  private get state() {\n    return this.stateManager.state;\n  }\n\n  constructor(type: string) {\n    super(type);\n    this.stateManager = StateManager.getInstance();\n    this.registerEvents();\n  }\n\n  private registerEvents() {\n    this.stateManager.subscribe('layers.layersList', () => {\n      this.reorderLayers();\n    });\n    this.stateManager.subscribe(/layers\\.layersList\\..*\\.order/, () => this.reorderLayers());\n  }\n\n  /**\n   * This method do a reorder of all layers present in the treeview\n   * in order to keep a order attribut corresponding to what the use wants.\n   * This order will be used by the map component to calculate the list of layers in the right order\n   */\n  private reorderLayers() {\n    // Use a debouncing to prevent multiple execution of this method\n    // If multiple order attributes are modified at the same time.\n    if (this.timeoutId) {\n      clearTimeout(this.timeoutId);\n    }\n\n    this.timeoutId = setTimeout(() => {\n      const orderedLayers = this.getSortedLayers(this.state.layers.layersList);\n      const counter: OrderCounter = { index: 1000 };\n      this.reorderLayersRecursively(orderedLayers, counter);\n    });\n  }\n\n  private reorderLayersRecursively(orderedLayers: BaseLayer[], counter: OrderCounter) {\n    // Traverse the layertree in depth first to renumber all the elements\n    for (const layer of orderedLayers) {\n      console.log(`Setting layer ${layer.name} to order=${counter.index}`);\n      layer.order = counter.index++;\n      if (layer instanceof GroupLayer || layer instanceof ThemeLayer) {\n        const orderedChilds = this.getSortedLayers(layer.children);\n        this.reorderLayersRecursively(orderedChilds, counter);\n      }\n    }\n  }\n\n  private getSortedLayers(layers: BaseLayer[]): BaseLayer[] {\n    const orderedLayers = layers.slice().sort((l1: BaseLayer, l2: BaseLayer) => {\n      return l1.order - l2.order;\n    });\n    return orderedLayers;\n  }\n}\n","import GirafeHTMLElement from './GirafeHTMLElement';\n\n/*\nMinimal template for a draggable object : \nIt must have 2 divs :\n- One for the whole box (id=\"draggable\")\n- One for the header (id=\"header\"). This is the div that will be used for dragging the while box\n\nExample:\n\n<div id=\"draggable\">\n  <div id=\"header\">\n    Click here to move\n    <div id=\"close\">\n      <i class=\"fa-solid\"></i>\n    </div>\n  </div>\n  <!-- PLACE CONTENT HERE -->\n</div>\n\nThen in order to make an component draggable, \nthe base method makeDraggable() must be called after rendering the template.\n\nThat's it, it should work.\n\n*/\n\nclass GirafeDraggableElement extends GirafeHTMLElement {\n  button?: HTMLElement;\n  div?: HTMLElement;\n  header?: HTMLElement;\n  closeButton?: HTMLElement;\n\n  get host(): HTMLElement {\n    return (this.shadow.getRootNode() as ShadowRoot).host as HTMLElement;\n  }\n\n  pos1 = 0;\n  pos2 = 0;\n  pos3 = 0;\n  pos4 = 0;\n\n  constructor(component: string) {\n    super(component);\n  }\n\n  makeDraggable() {\n    this.div = this.shadow.querySelector('#draggable')!;\n    this.header = this.shadow.querySelector('#header')!;\n    this.setDefaultPosition();\n    this.header.onmousedown = (e) => this.dragMouseDown(this, e);\n\n    this.closeButton = this.shadow.getElementById('close')!;\n    if (!this.isNullOrUndefined(this.closeButton)) {\n      this.closeButton.onclick = () => this.closeWindow();\n    }\n  }\n\n  private setDefaultPosition() {\n    const css = getComputedStyle(this.host);\n    this.host.style.top = css.top;\n    this.host.style.left = css.left;\n  }\n\n  closeWindow() {\n    throw new Error('This function must be overriden to close the associated window');\n  }\n\n  dragMouseDown(_this: GirafeDraggableElement, e: MouseEvent) {\n    e.preventDefault();\n    // get the mouse cursor position at startup:\n    _this.pos3 = e.clientX;\n    _this.pos4 = e.clientY;\n    document.onmouseup = () => _this.closeDragElement();\n    // call a function whenever the cursor moves:\n    document.onmousemove = (e) => _this.elementDrag(_this, e);\n  }\n\n  elementDrag(_this: GirafeDraggableElement, e: MouseEvent) {\n    e.preventDefault();\n\n    const hostRect = _this.host.getBoundingClientRect();\n\n    // Position left\n    const pos1 = _this.pos3 - e.clientX;\n    const newLeft = _this.host.offsetLeft - pos1;\n    const newRight = newLeft + hostRect.width;\n    if (newLeft < 0) {\n      _this.host.style.left = '0px';\n    } else if (newRight > this.getBodyWidth()) {\n      _this.host.style.left = this.getBodyWidth() - hostRect.width + 'px';\n    } else {\n      _this.pos1 = pos1;\n      _this.pos3 = e.clientX;\n      _this.host.style.left = newLeft + 'px';\n    }\n\n    // Position top\n    const pos2 = _this.pos4 - e.clientY;\n    const newTop = _this.host.offsetTop - pos2;\n    const newBottom = newTop + hostRect.height;\n    if (newTop < 0) {\n      _this.host.style.top = '0px';\n    } else if (newBottom > this.getBodyHeight()) {\n      _this.host.style.top = this.getBodyHeight() - hostRect.height + 'px';\n    } else {\n      _this.pos2 = pos2;\n      _this.pos4 = e.clientY;\n      _this.host.style.top = newTop + 'px';\n    }\n  }\n\n  getBodyWidth() {\n    return Math.max(\n      document.body.scrollWidth,\n      document.documentElement.scrollWidth,\n      document.body.offsetWidth,\n      document.documentElement.offsetWidth,\n      document.documentElement.clientWidth\n    );\n  }\n\n  getBodyHeight() {\n    return Math.max(\n      document.body.scrollHeight,\n      document.documentElement.scrollHeight,\n      document.body.offsetHeight,\n      document.documentElement.offsetHeight,\n      document.documentElement.clientHeight\n    );\n  }\n\n  closeDragElement() {\n    // stop moving when mouse button is released:\n    document.onmouseup = null;\n    document.onmousemove = null;\n  }\n}\n\nexport default GirafeDraggableElement;\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIQAAAAtCAMAAABYiTOzAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAKsUExURZGRkYKCglFRUTk5OePj4ykpKR0dHampqRMTEwAAABISElpaWl5eXgEBARkZGTIyMnZ2dsPDwyIiIjs7OwkJCQICAqOjo3t7ewMDA0lJSeDg4GJiYgUFBQgICMnJydjY2DU1NSoqKtPT01lZWb+/v5aWlgwMDNra2ufn50xMTAYGBru7u7a2thcXF5WVlX9/f2tra9zc3ERERKqqqh4eHicnJ9bW1tfX13Jycrm5uaSkpBoaGpOTk9LS0kJCQmhoaJubmyQkJCMjI1tbWwoKCgsLC5eXl8vLy5CQkNzb3Hd3d93d3be3t5qamr29vbCwsIODg29vb3Fxcd7e3oqKioSEhNvb29/f3y8vLw4ODrW1tVhYWEdHR2xsbDAwMGdnZ4mJiYyMjG1tbTw8PKysrAQEBFxcXIGBgbOzs0ZGRo6Ojnp6enh4eCUlJeHh4TMzM6urq7Kyss7OzlZWVj8/P3l5ecLCwuLi4hYWFqGhoVNTU+Tk5JycnKKioqWlpby8vDY2NsHBwcrKyrS0tOjo6J6enp2dndnZ2SEhIRAQEBsbG6+vr0BAQBgYGLGxsU1NTenp6cXFxRQUFC0tLTExMVVVVUVFRRwcHD4+PlBQUD09PTQ0NICAgDg4OEFBQcHAwaCgoMzMzMfHx3V1dWFhYa6urs3NzdXV1dTU1FRUVHx8fMjIyK2trRUVFeXl5SgoKLi4uJKSkn5+foaGhkNDQ8bGxmpqanBwcCYmJkhISNDQ0Obm5mVlZWNjY6enpw0NDS4uLk5OToeHh9HR0Tc3N11dXcDAwIuLix8fH3R0dFdXV5mZmSwsLL6+vqioqM/Pzzo6OmRkZBEREY2NjV9fXysrK0pKSpSUlJiYmIiIiAcHB6ampiAgIG5ubsTExLq6uk9PT2BgYEtLSwAAAIP+fpMAAADkdFJOU///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AIqL/3IAAAAJcEhZcwAADsAAAA7AAWrWiQkAAAXaSURBVFhHzZj7W5RFFMdRJDnkgoCrKwIGqShIIhJeCGRBwhQ18wKirigRqZiJgJdEBQzxQmiQipZJhWiKlnfMyAuZmYlR2VWt5h/pnDPnpQ0Be3qefevzw8z3nPfdd787M2feATf1P6BbE249RLiYbk30dBfhYroz0cvjMVEuphsTvT3B63HRrqVrE30sAN4+fSVyKV2Z8PUDAP9+YO0vCVfShYkBNvQwUAUMCgwKlpQL6dTE4CfQAoSQDH1yCKdcSmcmhg4jD15hErqeh00MH0EWIDxCYhN4yMTISPYAT0lsBh1NjLJqD1ESm0IHE6MDtYdoic3h7ybGxGgPT0tsEs4mYqO1BfAaKxmTcDIxLlw8BI6XjFm0m5gQJxYAnpGUaYiJ+AQxgEzUKRPRJhKlKIgEzpiKNmEXA0gkJ8yFTQwRA0QSp82FTSSLAWISp82FTaSIAcIynPOmQiaele8HsOKRLlVfMBMyMVksMJbn9AWXMcV7kr9IAzIxVd6cfknYdDzlp01zS5wu+hHMeH7mC26zSM1O40RnzPGfq9JFG/CayGAP8+IzcTbmc1rwXaA3kH9ywFnoWJS1eEn2i6RzXuJUZ9h9RTjBJnLpi3JeVmopwDJOa5ZbLT5LeuTNX/GKJLomdeWroohVo0U8TD/pnWET+TgCMBvFaoACSmgKIalI5KMYmzFV1CNYs1aEM2xiHXpYT8IdxQwSRITV+zWRBtM3FIeKxDP5xsRNItXmEhFO4GiUbijbgg5XvV6eKcmtFSKUmjYlVz5FJgK24UaZSofr7WiCT/pEBvQWJezgF200PhYZu5OGr7KYgzequDPYZcMR3P2mGlQ9ouYttWfvvtrajJRcHIaabPdJe/YfeBvvmZBUuG7yO/pzZOIgHiHedaf9wRMKADbwBVUKlVoYzLD5HapLWwrZFLy3bVhWfvD7ORZeQ8kd/k4LxIftsn1QLyFRF4dL9nBDWczWI/m4xDJX8m85ymdZNHEIf1HWh3AMo0g4PhBiKI9lBj21MGhsPEHdScAVrGIsH1HwMYQPxm7FEQr+Ym08Nv1O6UBYxhUTa+dAhehpDeB1iiZOA5wpyYGzGMXBptgcG+WVioJzWgiTQT90AJynTXYBB+oCFGI7r5eODOx0PtybrwNhZBO1sfoFWWSs/wu0WLSJ1DIAqt8YuIiv9U/48iX4lHtk8ew1SjXB4pKIsvrmPrSVVME0famQD+afdSjJyxSHXNQBsqWoeeigK6SO6IV5tapec3IjRmzCgo+BkRjZYZZaD9f4vuXQwj3iBXXOZ47PlfIw9q9iqMHWfl1HiAc91YdMOAwT5RkVR/O+iOL/dcTf4NTCgvPjxn05ZcCp3FiM2ESKUjfhK4xuWZXqAV/zfcfBxlsw4gcNSt2A26WtDWHpJ3Zh5gbIxrwR7mC7+rSOEMdxbA6QiYxWTqiZ1bupi/iG2lb9Woiaw53AJlYoVQ80Wi1BWIjQrC+1QbIW+LuxfvcbZUPUwLda5MJ32I75XkfIHZpkH6r3ahw+pCFFT28En11T4zhYdpc7gU0cRLFtGDZ3GpVKt/zAV1QWWH7UykEmfiKvBouMuXLozaRa7lQqm952IThyyqOUE/25pNHEImrP6h1z6880DQZsAidZ9aFFsY/WriftJUQ0WLEQkDNABbUXCnB9akptsI76crjFcaj3L9wrtZN2wQoqDD+qNxzZy9ypRPoWdb2NA3XJoXuGTVCVZVJFJmxG5d9emusBUqoKr+b9CocxOtYGQXfv3Us+cBuDURCed9+3b3gl/WYk1HHlAYum+9hEUqltl9XqfRWbuX1buKjH04ATTX68wfGAsAkefy9ctwuo3s7dpJBJ+20elUNQ9lyK0n/nqI3rv7wSpbW2fWzU7dqKky0r7e506xly8oeeDhV7t60y0r85jA8JRTs5hxQneK6NbNxHEk20JnIVpOG6e0CFd42KtZ2AumCnf9mEBae2n0iKJuzosEcpKpx/AZr4r1HqT8S1EHcsZ6nQAAAAAElFTkSuQmCC\"","import GirafeDraggableElement from '../../base/GirafeDraggableElement';\nimport GirafeLogo from './images/logo.png';\n\nclass AboutComponent extends GirafeDraggableElement {\n  templateUrl = './template.html';\n  styleUrl = './style.css';\n\n  loaded = false;\n  version!: string;\n  build!: string;\n  date!: string;\n  public logo: string = GirafeLogo;\n\n  constructor() {\n    super('about');\n  }\n\n  async loadVersionInfos() {\n    if (!this.loaded) {\n      // Version infos were not loaded yet.\n      const response = await fetch('about.json');\n      const versionInfos = await response.json();\n      this.version = versionInfos.version;\n      this.build = versionInfos.build;\n      this.date = versionInfos.date;\n      this.loaded = true;\n      console.log(this.version);\n      console.log(this.build);\n      console.log(this.date);\n    }\n\n    this.render();\n  }\n\n  registerEvents() {\n    this.stateManager.subscribe('interface.aboutVisible', (_oldValue: boolean, newValue: boolean) =>\n      this.toggleAbout(newValue)\n    );\n  }\n\n  toggleAbout(visible: boolean) {\n    if (visible) {\n      this.loadVersionInfos().then(() => {\n        ((this.shadow.getRootNode() as ShadowRoot).host as HTMLElement).style.display = 'block';\n      });\n    } else {\n      ((this.shadow.getRootNode() as ShadowRoot).host as HTMLElement).style.display = 'none';\n    }\n  }\n\n  closeWindow() {\n    this.state.interface.aboutVisible = false;\n  }\n\n  connectedCallback() {\n    this.loadConfig().then(() => {\n      this.render();\n      this.girafeTranslate();\n      this.makeDraggable();\n      this.registerEvents();\n    });\n  }\n}\n\nexport default AboutComponent;\n","import GirafeHTMLElement from '../../base/GirafeHTMLElement';\nimport Basemap from '../../models/basemap';\nimport ShareManager from '../../tools/share/sharemanager';\n\nclass BasemapComponent extends GirafeHTMLElement {\n  templateUrl = './template.html';\n  styleUrl = './style.css';\n\n  servers = {};\n  basemapJson = {};\n\n  shareManager: ShareManager;\n\n  constructor() {\n    super('basemap');\n\n    this.shareManager = ShareManager.getInstance();\n\n    this.configManager.loadConfig().then(() => {\n      if (!this.configManager.Config.basemaps.show) {\n        this.hide();\n      }\n    });\n  }\n\n  onBasemapsLoaded(basemaps: { [key: number]: Basemap }) {\n    super.render();\n\n    // Configure default basemap (only if there is no sharedstate)\n    if (!this.shareManager.hasSharedState()) {\n      for (const basemap of Object.values(basemaps)) {\n        if (basemap.name === this.configManager.Config.basemaps.defaultBasemap) {\n          this.state.activeBasemap = basemap;\n          break;\n        }\n      }\n    }\n  }\n\n  changeBasemap(basemap: Basemap) {\n    console.log('change basemap', basemap);\n    if (basemap.projection) {\n      this.state.projection = basemap.projection;\n    }\n    this.state.activeBasemap = basemap;\n  }\n\n  registerEvents() {\n    this.stateManager.subscribe(\n      'basemaps',\n      (_oldBasemaps: { [key: number]: Basemap }, newBasemaps: { [key: number]: Basemap }) =>\n        this.onBasemapsLoaded(newBasemaps)\n    );\n  }\n\n  connectedCallback() {\n    this.loadConfig().then(() => {\n      this.render();\n      super.girafeTranslate();\n      this.registerEvents();\n    });\n  }\n}\n\nexport default BasemapComponent;\n","import GirafeHTMLElement from '../../base/GirafeHTMLElement';\n\nclass ColorSwitcherComponent extends GirafeHTMLElement {\n  templateUrl = './template.html';\n  styleUrl = './style.css';\n\n  private currentTheme?: 'light' | 'dark';\n\n  constructor() {\n    super('colorswitcher');\n  }\n\n  registerEvents() {\n    this.stateManager.subscribe('interface.darkFrontendMode', () => this.onChangeDarkFrontendMode());\n    this.stateManager.subscribe('interface.darkMapMode', () => super.render());\n  }\n\n  onChangeDarkFrontendMode() {\n    this.currentTheme = this.state.interface.darkFrontendMode ? 'dark' : 'light';\n    this.activateTheme(this.currentTheme);\n    super.render();\n  }\n\n  darkFrontendModeToggled() {\n    this.state.interface.darkFrontendMode = !this.state.interface.darkFrontendMode;\n    localStorage.setItem('theme', this.currentTheme!);\n  }\n\n  initValue() {\n    this.currentTheme = (localStorage.getItem('theme') as 'dark' | 'light') ?? undefined;\n    if (!this.currentTheme) {\n      const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');\n      this.currentTheme = prefersDarkScheme.matches ? 'dark' : 'light';\n    }\n\n    this.state.interface.darkFrontendMode = this.currentTheme === 'dark';\n  }\n\n  activateTheme(mode: 'dark' | 'light') {\n    const otherMode = mode === 'dark' ? 'light' : 'dark';\n    document.body.classList.remove(`${otherMode}-theme`);\n    document.body.classList.add(`${mode}-theme`);\n  }\n\n  connectedCallback() {\n    this.loadConfig().then(() => {\n      super.render();\n      this.girafeTranslate();\n      this.registerEvents();\n      this.activateTooltips(false, [800, 0], 'top-end');\n      this.initValue();\n    });\n  }\n}\n\nexport default ColorSwitcherComponent;\n","import GirafeHTMLElement from '../../base/GirafeHTMLElement';\nimport { niceCoordinates } from '../../tools/geometrytools';\n\nclass CoordinateComponent extends GirafeHTMLElement {\n  templateUrl = './template.html';\n  styleUrl = './style.css';\n\n  #locale?: string;\n  east: string | null = null;\n  north: string | null = null;\n\n  constructor() {\n    super('coordinate');\n  }\n\n  get locale() {\n    if (!this.#locale) {\n      throw new Error('You called locale before render');\n    }\n    return this.#locale;\n  }\n\n  render() {\n    super.render();\n    this.#locale = this.configManager.Config.general.locale;\n  }\n\n  registerEvents() {\n    this.stateManager.subscribe('mouseCoordinates', (_oldCoordinates: number[], newCoordinates: number[]) =>\n      this.onChangeCoordinates(newCoordinates)\n    );\n  }\n\n  onChangeCoordinates(coord: number[]) {\n    [this.east, this.north] = niceCoordinates(coord, this.locale);\n    this.render();\n  }\n\n  connectedCallback() {\n    this.loadConfig().then(() => {\n      this.render();\n      super.girafeTranslate();\n      this.registerEvents();\n    });\n  }\n}\n\nexport default CoordinateComponent;\n","export default \"__VITE_ASSET__CmsaBKlu__\"","export default \"__VITE_ASSET__Ap25JDnr__\"","export default \"__VITE_ASSET__DNJ$YdtS__\"","export default \"__VITE_ASSET__DJH57LL8__\"","import GirafeHTMLElement from '../../base/GirafeHTMLElement';\nimport Icon2D from './images/map-2d.svg';\nimport Icon3D from './images/map-3d.svg';\nimport IconSplit from './images/map-split.svg';\nimport IconGlobe from './images/globe.svg';\n\nclass GlobeComponent extends GirafeHTMLElement {\n  templateUrl = './template.html';\n\n  public icon2D: string = Icon2D;\n  public icon3D: string = Icon3D;\n  public iconSplit: string = IconSplit;\n  public iconGlobe: string = IconGlobe;\n\n  constructor() {\n    super('globe');\n  }\n\n  render() {\n    super.render();\n  }\n\n  connectedCallback() {\n    this.loadConfig().then(() => {\n      this.render();\n      super.girafeTranslate();\n    });\n  }\n}\n\nexport default GlobeComponent;\n","export default \"data:image/webp;base64,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\"","export default \"__VITE_ASSET__caO13qHW__\"","import GirafeHTMLElement from '../../base/GirafeHTMLElement';\nimport ArrowBlack from './images/arrow_black.webp';\nimport ArrowWhite from './images/arrow_white.webp';\n\nclass HelpComponent extends GirafeHTMLElement {\n  templateUrl = './template.html';\n  styleUrl = './style.css';\n\n  content!: HTMLElement;\n  themes!: HTMLElement;\n  search!: HTMLElement;\n  menu!: HTMLElement;\n  basemap!: HTMLElement;\n\n  darkFrontendMode: boolean = false;\n\n  arrowBlack: string = ArrowBlack;\n  arrowWhite: string = ArrowWhite;\n  currentArrow?: string;\n\n  constructor() {\n    super('help');\n  }\n\n  render() {\n    super.render();\n    this.content = this.shadow.querySelector('#content') as HTMLElement;\n    // setting the images for the arrows with the imported files to use vite to serve them, because uhtml does somehow not render variables in css\n    this.themes = this.shadow.querySelector('#themes') as HTMLElement;\n    this.search = this.shadow.querySelector('#search') as HTMLElement;\n    this.menu = this.shadow.querySelector('#menu') as HTMLElement;\n    this.basemap = this.shadow.querySelector('#basemap') as HTMLElement;\n\n    // hide and show help content depending on state\n    if (!this.configManager.Config.basemaps.show) {\n      (this.shadow.querySelector('#basemap') as HTMLElement).style.display = 'none';\n      (this.shadow.querySelector('#basemap-descr') as HTMLElement).style.display = 'none';\n    }\n  }\n\n  registerEvents() {\n    this.stateManager.subscribe('interface.helpVisible', (_oldValue: boolean, newValue: boolean) =>\n      this.toggleHelp(newValue)\n    );\n    this.stateManager.subscribe('interface.darkFrontendMode', (_oldValue: boolean, newValue: boolean) => {\n      this.darkFrontendMode = newValue;\n    });\n    this.content.addEventListener('click', () => {\n      this.state.interface.helpVisible = false;\n    });\n  }\n\n  changeArrowColor() {\n    // change the arrow color depending on the darkFrontendMode state\n    this.darkFrontendMode = this.stateManager.state.interface.darkFrontendMode;\n    this.currentArrow = this.darkFrontendMode ? this.arrowBlack : this.arrowWhite;\n\n    this.themes.style.backgroundImage = `url(${this.currentArrow})`;\n    this.search.style.backgroundImage = `url(${this.currentArrow})`;\n    this.menu.style.backgroundImage = `url(${this.currentArrow})`;\n    this.basemap.style.backgroundImage = `url(${this.currentArrow})`;\n\n    this.content.style.backgroundColor = this.darkFrontendMode ? 'rgba(255, 255, 255, 0.65)' : 'rgba(0, 0, 0, 0.65)';\n  }\n\n  toggleHelp(visible: boolean) {\n    if (visible) {\n      this.changeArrowColor();\n      this.content.style.display = 'block';\n    } else {\n      this.content.style.display = 'none';\n    }\n  }\n\n  connectedCallback() {\n    this.loadConfig().then(() => {\n      this.render();\n      super.girafeTranslate();\n      this.registerEvents();\n    });\n  }\n}\n\nexport default HelpComponent;\n","import GirafeDraggableElement from '../../base/GirafeDraggableElement';\n\nclass MetadataWindowComponent extends GirafeDraggableElement {\n  templateUrl = './template.html';\n  styleUrl = './style.css';\n\n  private initialized = false;\n\n  constructor() {\n    super('metadatawindow');\n  }\n\n  registerEvents() {\n    this.stateManager.subscribe('interface.metadataVisible', (_oldValue: boolean, newValue: boolean) =>\n      this.toggleMetadata(newValue)\n    );\n\n    this.stateManager.subscribe(/metadata.*/, () => this.render());\n  }\n\n  render() {\n    if (!this.initialized) {\n      const host = (this.shadow.getRootNode() as ShadowRoot).host as HTMLElement;\n      host.style.width = this.configManager.Config.metadata.defaultWindowWidth;\n      host.style.height = this.configManager.Config.metadata.defaultWindowHeight;\n      this.initialized = true;\n    }\n    super.render();\n    this.girafeTranslate();\n    this.makeDraggable();\n  }\n\n  toggleMetadata(visible: boolean) {\n    if (visible) {\n      this.render();\n    } else {\n      this.renderEmpty();\n    }\n  }\n\n  closeWindow() {\n    this.state.interface.metadataVisible = false;\n  }\n\n  connectedCallback() {\n    this.loadConfig().then(() => {\n      this.render();\n      this.girafeTranslate();\n      this.makeDraggable();\n      this.registerEvents();\n    });\n  }\n}\n\nexport default MetadataWindowComponent;\n","import GirafeHTMLElement from '../../base/GirafeHTMLElement';\nimport { InfoBoxContent } from '../../tools/state/state';\n\nclass InfoboxComponent extends GirafeHTMLElement {\n  templateUrl = './template.html';\n  styleUrl = './style.css';\n\n  infos = [] as InfoBoxContent[];\n\n  constructor() {\n    super('infobox');\n  }\n\n  registerEvents() {\n    this.stateManager.subscribe('infobox.elements', () => super.render());\n  }\n\n  closeMessage(info: InfoBoxContent) {\n    this.state.infobox.elements.splice(\n      this.state.infobox.elements.findIndex((el) => el.id === info.id),\n      1\n    );\n  }\n\n  connectedCallback() {\n    this.loadConfig().then(() => {\n      super.render();\n      super.girafeTranslate();\n      this.registerEvents();\n    });\n  }\n}\n\nexport default InfoboxComponent;\n","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20640%20512'%3e%3c!--!Font%20Awesome%20Free%206.5.2%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202024%20Fonticons,%20Inc.--%3e%3cpath%20d='M0%20128C0%2092.7%2028.7%2064%2064%2064H256h48%2016H576c35.3%200%2064%2028.7%2064%2064V384c0%2035.3-28.7%2064-64%2064H320%20304%20256%2064c-35.3%200-64-28.7-64-64V128zm320%200V384H576V128H320zM178.3%20175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1%204.7-18.3%2011.9l-64%20144c-4.5%2010.1%20.1%2021.9%2010.2%2026.4s21.9-.1%2026.4-10.2l8.9-20.1h73.6l8.9%2020.1c4.5%2010.1%2016.3%2014.6%2026.4%2010.2s14.6-16.3%2010.2-26.4l-64-144zM160%20233.2L179%20276H141l19-42.8zM448%20164c11%200%2020%209%2020%2020v4h44%2016c11%200%2020%209%2020%2020s-9%2020-20%2020h-2l-1.6%204.5c-8.9%2024.4-22.4%2046.6-39.6%2065.4c.9%20.6%201.8%201.1%202.7%201.6l18.9%2011.3c9.5%205.7%2012.5%2018%206.9%2027.4s-18%2012.5-27.4%206.9l-18.9-11.3c-4.5-2.7-8.8-5.5-13.1-8.5c-10.6%207.5-21.9%2014-34%2019.4l-3.6%201.6c-10.1%204.5-21.9-.1-26.4-10.2s.1-21.9%2010.2-26.4l3.6-1.6c6.4-2.9%2012.6-6.1%2018.5-9.8l-12.2-12.2c-7.8-7.8-7.8-20.5%200-28.3s20.5-7.8%2028.3%200l14.6%2014.6%20.5%20.5c12.4-13.1%2022.5-28.3%2029.8-45H448%20376c-11%200-20-9-20-20s9-20%2020-20h52v-4c0-11%209-20%2020-20z'/%3e%3c/svg%3e\"","import GirafeHTMLElement from '../../base/GirafeHTMLElement';\nimport LanguageIcon from './images/language.svg';\n\nclass LanguageComponent extends GirafeHTMLElement {\n  templateUrl = './template.html';\n\n  public languageIcon: string = LanguageIcon;\n\n  languages: string[] = [];\n\n  constructor() {\n    super('language');\n  }\n\n  render() {\n    // Get languages list and store it\n    for (const key in this.configManager.Config.languages.translations) {\n      this.languages.push(key);\n    }\n\n    super.render();\n\n    // Hide menu button if only one language\n    if (this.languages.length == 1) {\n      (this.shadow.host as GirafeHTMLElement).hide();\n    }\n  }\n\n  changeLanguage(language: string) {\n    console.log('change language', language);\n    this.state.language = language;\n  }\n\n  connectedCallback() {\n    this.loadConfig().then(() => {\n      this.render();\n      super.girafeTranslate();\n    });\n  }\n}\n\nexport default LanguageComponent;\n","/**\n * The lidar point attribute list width default option\n */\ntype LidarPointAttributeList = {\n  availableOptions?: LidarProfileServerConfigPointAttribute[];\n\n  selectedOption?: LidarProfileServerConfigPointAttribute;\n};\n\n/**\n * The object containing all points in profile\n */\nexport type LidarProfileClientConfig = {\n  autoWidth?: boolean;\n\n  margin: {\n    [x: string]: number;\n  };\n\n  pointAttributes?: LidarPointAttributeList;\n  pointSum?: number;\n  tolerance?: number;\n};\n\nexport type LidarProfileServerConfigClassification = {\n  color?: string;\n  name?: string;\n  value?: string;\n  /** Visible (Value can be 1 or 0) */\n  visible?: number;\n};\n\nexport type LidarProfileServerConfigClassifications = {\n  [x: number]: LidarProfileServerConfigClassification;\n};\n\ntype LidarProfileServerConfigLevel = {\n  max?: number;\n  width?: number;\n};\n\nexport type LidarProfileServerConfigLevels = {\n  [x: number]: LidarProfileServerConfigLevel;\n};\n\nexport type LidarProfileServerConfigPointAttribute = {\n  bytes?: number;\n  elements?: number;\n  name?: string;\n  value?: string;\n  visible?: number;\n};\n\nexport type LidarProfileServerConfigPointAttributes = {\n  [x: string]: LidarProfileServerConfigPointAttribute;\n};\n\ntype LidarProfileServerConfig = {\n  classes_names_normalized?: {\n    [x: number]: string;\n  };\n  classes_names_standard?: {\n    [x: number]: string;\n  };\n  classification_colors?: LidarProfileServerConfigClassifications;\n  debug?: boolean;\n  default_attribute?: string;\n  default_color?: string;\n  default_point_attribute?: string;\n  default_point_cloud?: string;\n  initialLOD?: number;\n  max_levels?: LidarProfileServerConfigLevels;\n  max_point_number?: number;\n  minLOD?: number;\n  point_attributes?: LidarProfileServerConfigPointAttributes;\n  point_size?: number;\n  vertical_pan_tolerance?: number;\n  width?: number;\n};\n\nexport class LidarProfileConfig {\n  pytreeLidarProfileJsonUrl: string;\n\n  /**\n   * The configuration from the LIDAR server.\n   */\n  serverConfig?: LidarProfileServerConfig;\n\n  /**\n   * The client configuration.\n   */\n  clientConfig: LidarProfileClientConfig;\n  /**\n   * Configuration service to configure the lidar profile.\n   * Requires a Pytree service url: https://github.com/sitn/pytree\n   */\n  constructor(pytreeLidarProfileJsonUrl: string) {\n    this.pytreeLidarProfileJsonUrl = pytreeLidarProfileJsonUrl;\n    /**\n     * The client configuration.\n     */\n    this.clientConfig = {\n      autoWidth: true,\n      margin: {\n        left: 40,\n        top: 10,\n        right: 200,\n        bottom: 40\n      },\n      pointAttributes: {},\n      pointSum: 0,\n      tolerance: 5\n    };\n  }\n\n  /**\n   * Initialize the service variables from Pytree route.\n   * @returns Promise<void | Response> The server configuration.\n   */\n  async initProfileConfig(): Promise<void | Response> {\n    const url = `${this.pytreeLidarProfileJsonUrl}/profile/config`;\n\n    return fetch(url)\n      .then((resp) =>\n        resp.json().then((data: LidarProfileServerConfig) => {\n          this.setupConfig(data);\n        })\n      )\n      .catch((error) => {\n        console.error('Can not load lidar config', error);\n      });\n  }\n\n  /**\n   * Initialize the server config object.\n   */\n  protected setupConfig(data: LidarProfileServerConfig) {\n    this.serverConfig = {\n      classification_colors: data.classification_colors,\n      debug: !!data.debug,\n      default_attribute: data.default_attribute ?? '',\n      default_color: data.default_color ?? '',\n      default_point_attribute: data.default_point_attribute ?? '',\n      default_point_cloud: data.default_point_cloud ?? '',\n      initialLOD: data.initialLOD ?? 0,\n      max_levels: data.max_levels,\n      max_point_number: data.max_point_number ?? 50000,\n      minLOD: data.minLOD ?? 0,\n      point_attributes: data.point_attributes ?? {},\n      point_size: data.point_size ?? 0,\n      vertical_pan_tolerance: data.vertical_pan_tolerance ?? 0,\n      width: data.width ?? 0\n    };\n\n    const attr: LidarProfileServerConfigPointAttribute[] = [];\n    for (const key in this.serverConfig.point_attributes) {\n      if (this.serverConfig.point_attributes[key].visible === 1) {\n        attr.push(this.serverConfig.point_attributes[key]);\n      }\n    }\n\n    const selectedMat = this.serverConfig.point_attributes![this.serverConfig.default_point_attribute!];\n\n    this.clientConfig.pointAttributes = {\n      availableOptions: attr,\n      selectedOption: selectedMat\n    };\n  }\n}\n\nexport default LidarProfileConfig;\n","/**\n * @module ol/interaction/Draw\n */\nimport Circle from '../geom/Circle.js';\nimport Event from '../events/Event.js';\nimport EventType from '../events/EventType.js';\nimport Feature from '../Feature.js';\nimport GeometryCollection from '../geom/GeometryCollection.js';\nimport InteractionProperty from './Property.js';\nimport LineString from '../geom/LineString.js';\nimport MapBrowserEvent from '../MapBrowserEvent.js';\nimport MapBrowserEventType from '../MapBrowserEventType.js';\nimport MultiLineString from '../geom/MultiLineString.js';\nimport MultiPoint from '../geom/MultiPoint.js';\nimport MultiPolygon from '../geom/MultiPolygon.js';\nimport Point from '../geom/Point.js';\nimport PointerInteraction from './Pointer.js';\nimport Polygon, {fromCircle, makeRegular} from '../geom/Polygon.js';\nimport VectorLayer from '../layer/Vector.js';\nimport VectorSource from '../source/Vector.js';\nimport {FALSE, TRUE} from '../functions.js';\nimport {\n  always,\n  never,\n  noModifierKeys,\n  shiftKeyOnly,\n} from '../events/condition.js';\nimport {\n  boundingExtent,\n  getBottomLeft,\n  getBottomRight,\n  getTopLeft,\n  getTopRight,\n} from '../extent.js';\nimport {clamp, squaredDistance, toFixed} from '../math.js';\nimport {createEditingStyle} from '../style/Style.js';\nimport {\n  distance,\n  squaredDistance as squaredCoordinateDistance,\n} from '../coordinate.js';\nimport {fromUserCoordinate, getUserProjection} from '../proj.js';\nimport {getStrideForLayout} from '../geom/SimpleGeometry.js';\n\n/**\n * @typedef {Object} Options\n * @property {import(\"../geom/Geometry.js\").Type} type Geometry type of\n * the geometries being drawn with this instance.\n * @property {number} [clickTolerance=6] The maximum distance in pixels between\n * \"down\" and \"up\" for a \"up\" event to be considered a \"click\" event and\n * actually add a point/vertex to the geometry being drawn.  The default of `6`\n * was chosen for the draw interaction to behave correctly on mouse as well as\n * on touch devices.\n * @property {import(\"../Collection.js\").default<Feature>} [features]\n * Destination collection for the drawn features.\n * @property {VectorSource} [source] Destination source for\n * the drawn features.\n * @property {number} [dragVertexDelay=500] Delay in milliseconds after pointerdown\n * before the current vertex can be dragged to its exact position.\n * @property {number} [snapTolerance=12] Pixel distance for snapping to the\n * drawing finish. Must be greater than `0`.\n * @property {boolean} [stopClick=false] Stop click, singleclick, and\n * doubleclick events from firing during drawing.\n * @property {number} [maxPoints] The number of points that can be drawn before\n * a polygon ring or line string is finished. By default there is no\n * restriction.\n * @property {number} [minPoints] The number of points that must be drawn\n * before a polygon ring or line string can be finished. Default is `3` for\n * polygon rings and `2` for line strings.\n * @property {import(\"../events/condition.js\").Condition} [finishCondition] A function\n * that takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether the drawing can be finished. Not used when drawing\n * POINT or MULTI_POINT geometries.\n * @property {import(\"../style/Style.js\").StyleLike|import(\"../style/flat.js\").FlatStyleLike} [style]\n * Style for sketch features. The draw interaction can have up to three sketch features, depending on the mode.\n * It will always contain a feature with a `Point` geometry that corresponds to the current cursor position.\n * If the mode is `LineString` or `Polygon`, and there is at least one drawn point, it will also contain a feature with\n * a `LineString` geometry that corresponds to the line between the already drawn points and the current cursor position.\n * If the mode is `Polygon`, and there is at least one drawn point, it will also contain a feature with a `Polygon`\n * geometry that corresponds to the polygon between the already drawn points and the current cursor position\n * (note that this polygon has only two points if only one point is drawn).\n * If the mode is `Circle`, and there is one point drawn, it will also contain a feature with a `Circle` geometry whose\n * center is the drawn point and the radius is determined by the distance between the drawn point and the cursor.\n * @property {GeometryFunction} [geometryFunction]\n * Function that is called when a geometry's coordinates are updated.\n * @property {string} [geometryName] Geometry name to use for features created\n * by the draw interaction.\n * @property {import(\"../events/condition.js\").Condition} [condition] A function that\n * takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether that event should be handled.\n * By default {@link module:ol/events/condition.noModifierKeys}, i.e. a click,\n * adds a vertex or deactivates freehand drawing.\n * @property {boolean} [freehand=false] Operate in freehand mode for lines,\n * polygons, and circles.  This makes the interaction always operate in freehand\n * mode and takes precedence over any `freehandCondition` option.\n * @property {import(\"../events/condition.js\").Condition} [freehandCondition]\n * Condition that activates freehand drawing for lines and polygons. This\n * function takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and\n * returns a boolean to indicate whether that event should be handled. The\n * default is {@link module:ol/events/condition.shiftKeyOnly}, meaning that the\n * Shift key activates freehand drawing.\n * @property {boolean|import(\"../events/condition.js\").Condition} [trace=false] Trace a portion of another geometry.\n * Ignored when in freehand mode.\n * @property {VectorSource} [traceSource] Source for features to trace.  If tracing is active and a `traceSource` is\n * not provided, the interaction's `source` will be used.  Tracing requires that the interaction is configured with\n * either a `traceSource` or a `source`.\n * @property {boolean} [wrapX=false] Wrap the world horizontally on the sketch\n * overlay.\n * @property {import(\"../geom/Geometry.js\").GeometryLayout} [geometryLayout='XY'] Layout of the\n * feature geometries created by the draw interaction.\n */\n\n/**\n * Coordinate type when drawing points.\n * @typedef {import(\"../coordinate.js\").Coordinate} PointCoordType\n */\n\n/**\n * Coordinate type when drawing lines.\n * @typedef {Array<import(\"../coordinate.js\").Coordinate>} LineCoordType\n */\n\n/**\n * Coordinate type when drawing polygons.\n * @typedef {Array<Array<import(\"../coordinate.js\").Coordinate>>} PolyCoordType\n */\n\n/**\n * Types used for drawing coordinates.\n * @typedef {PointCoordType|LineCoordType|PolyCoordType} SketchCoordType\n */\n\n/**\n * @typedef {Object} TraceState\n * @property {boolean} active Tracing active.\n * @property {import(\"../pixel.js\").Pixel} [startPx] The initially clicked pixel location.\n * @property {Array<TraceTarget>} [targets] Targets available for tracing.\n * @property {number} [targetIndex] The index of the currently traced target.  A value of -1 indicates\n * that no trace target is active.\n */\n\n/**\n * @typedef {Object} TraceTarget\n * @property {Array<import(\"../coordinate.js\").Coordinate>} coordinates Target coordinates.\n * @property {boolean} ring The target coordinates are a linear ring.\n * @property {number} startIndex The index of first traced coordinate.  A fractional index represents an\n * edge intersection.  Index values for rings will wrap (may be negative or larger than coordinates length).\n * @property {number} endIndex The index of last traced coordinate.  Details from startIndex also apply here.\n */\n\n/**\n * Function that takes an array of coordinates and an optional existing geometry\n * and a projection as arguments, and returns a geometry. The optional existing\n * geometry is the geometry that is returned when the function is called without\n * a second argument.\n * @typedef {function(!SketchCoordType, import(\"../geom/SimpleGeometry.js\").default,\n *     import(\"../proj/Projection.js\").default):\n *     import(\"../geom/SimpleGeometry.js\").default} GeometryFunction\n */\n\n/**\n * @typedef {'Point' | 'LineString' | 'Polygon' | 'Circle'} Mode\n * Draw mode.  This collapses multi-part geometry types with their single-part\n * cousins.\n */\n\n/**\n * @enum {string}\n */\nconst DrawEventType = {\n  /**\n   * Triggered upon feature draw start\n   * @event DrawEvent#drawstart\n   * @api\n   */\n  DRAWSTART: 'drawstart',\n  /**\n   * Triggered upon feature draw end\n   * @event DrawEvent#drawend\n   * @api\n   */\n  DRAWEND: 'drawend',\n  /**\n   * Triggered upon feature draw abortion\n   * @event DrawEvent#drawabort\n   * @api\n   */\n  DRAWABORT: 'drawabort',\n};\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/interaction/Draw~Draw} instances are\n * instances of this type.\n */\nexport class DrawEvent extends Event {\n  /**\n   * @param {DrawEventType} type Type.\n   * @param {Feature} feature The feature drawn.\n   */\n  constructor(type, feature) {\n    super(type);\n\n    /**\n     * The feature being drawn.\n     * @type {Feature}\n     * @api\n     */\n    this.feature = feature;\n  }\n}\n\n/**\n * @param {import(\"../coordinate.js\").Coordinate} coordinate The coordinate.\n * @param {Array<Feature>} features The candidate features.\n * @return {Array<TraceTarget>} The trace targets.\n */\nfunction getTraceTargets(coordinate, features) {\n  /**\n   * @type {Array<TraceTarget>}\n   */\n  const targets = [];\n\n  for (let i = 0; i < features.length; ++i) {\n    const feature = features[i];\n    const geometry = feature.getGeometry();\n    appendGeometryTraceTargets(coordinate, geometry, targets);\n  }\n\n  return targets;\n}\n\n/**\n * @param {import(\"../coordinate.js\").Coordinate} a One coordinate.\n * @param {import(\"../coordinate.js\").Coordinate} b Another coordinate.\n * @return {number} The squared distance between the two coordinates.\n */\nfunction getSquaredDistance(a, b) {\n  return squaredDistance(a[0], a[1], b[0], b[1]);\n}\n\n/**\n * @param {LineCoordType} coordinates The ring coordinates.\n * @param {number} index The index.  May be wrapped.\n * @return {import(\"../coordinate.js\").Coordinate} The coordinate.\n */\nfunction getCoordinate(coordinates, index) {\n  const count = coordinates.length;\n  if (index < 0) {\n    return coordinates[index + count];\n  }\n  if (index >= count) {\n    return coordinates[index - count];\n  }\n  return coordinates[index];\n}\n\n/**\n * Get the cumulative squared distance along a ring path.  The end index index may be \"wrapped\" and it may\n * be less than the start index to indicate the direction of travel.  The start and end index may have\n * a fractional part to indicate a point between two coordinates.\n * @param {LineCoordType} coordinates Ring coordinates.\n * @param {number} startIndex The start index.\n * @param {number} endIndex The end index.\n * @return {number} The cumulative squared distance along the ring path.\n */\nfunction getCumulativeSquaredDistance(coordinates, startIndex, endIndex) {\n  let lowIndex, highIndex;\n  if (startIndex < endIndex) {\n    lowIndex = startIndex;\n    highIndex = endIndex;\n  } else {\n    lowIndex = endIndex;\n    highIndex = startIndex;\n  }\n  const lowWholeIndex = Math.ceil(lowIndex);\n  const highWholeIndex = Math.floor(highIndex);\n\n  if (lowWholeIndex > highWholeIndex) {\n    // both start and end are on the same segment\n    const start = interpolateCoordinate(coordinates, lowIndex);\n    const end = interpolateCoordinate(coordinates, highIndex);\n    return getSquaredDistance(start, end);\n  }\n\n  let sd = 0;\n\n  if (lowIndex < lowWholeIndex) {\n    const start = interpolateCoordinate(coordinates, lowIndex);\n    const end = getCoordinate(coordinates, lowWholeIndex);\n    sd += getSquaredDistance(start, end);\n  }\n\n  if (highWholeIndex < highIndex) {\n    const start = getCoordinate(coordinates, highWholeIndex);\n    const end = interpolateCoordinate(coordinates, highIndex);\n    sd += getSquaredDistance(start, end);\n  }\n\n  for (let i = lowWholeIndex; i < highWholeIndex - 1; ++i) {\n    const start = getCoordinate(coordinates, i);\n    const end = getCoordinate(coordinates, i + 1);\n    sd += getSquaredDistance(start, end);\n  }\n\n  return sd;\n}\n\n/**\n * @param {import(\"../coordinate.js\").Coordinate} coordinate The coordinate.\n * @param {import(\"../geom/Geometry.js\").default} geometry The candidate geometry.\n * @param {Array<TraceTarget>} targets The trace targets.\n */\nfunction appendGeometryTraceTargets(coordinate, geometry, targets) {\n  if (geometry instanceof LineString) {\n    appendTraceTarget(coordinate, geometry.getCoordinates(), false, targets);\n    return;\n  }\n  if (geometry instanceof MultiLineString) {\n    const coordinates = geometry.getCoordinates();\n    for (let i = 0, ii = coordinates.length; i < ii; ++i) {\n      appendTraceTarget(coordinate, coordinates[i], false, targets);\n    }\n    return;\n  }\n  if (geometry instanceof Polygon) {\n    const coordinates = geometry.getCoordinates();\n    for (let i = 0, ii = coordinates.length; i < ii; ++i) {\n      appendTraceTarget(coordinate, coordinates[i], true, targets);\n    }\n    return;\n  }\n  if (geometry instanceof MultiPolygon) {\n    const polys = geometry.getCoordinates();\n    for (let i = 0, ii = polys.length; i < ii; ++i) {\n      const coordinates = polys[i];\n      for (let j = 0, jj = coordinates.length; j < jj; ++j) {\n        appendTraceTarget(coordinate, coordinates[j], true, targets);\n      }\n    }\n    return;\n  }\n  if (geometry instanceof GeometryCollection) {\n    const geometries = geometry.getGeometries();\n    for (let i = 0; i < geometries.length; ++i) {\n      appendGeometryTraceTargets(coordinate, geometries[i], targets);\n    }\n    return;\n  }\n  // other types cannot be traced\n}\n\n/**\n * @typedef {Object} TraceTargetUpdateInfo\n * @property {number} index The new target index.\n * @property {number} endIndex The new segment end index.\n */\n\n/**\n * @type {TraceTargetUpdateInfo}\n */\nconst sharedUpdateInfo = {index: -1, endIndex: NaN};\n\n/**\n * @param {import(\"../coordinate.js\").Coordinate} coordinate The coordinate.\n * @param {TraceState} traceState The trace state.\n * @param {import(\"../Map.js\").default} map The map.\n * @param {number} snapTolerance The snap tolerance.\n * @return {TraceTargetUpdateInfo} Information about the new trace target.  The returned\n * object is reused between calls and must not be modified by the caller.\n */\nfunction getTraceTargetUpdate(coordinate, traceState, map, snapTolerance) {\n  const x = coordinate[0];\n  const y = coordinate[1];\n\n  let closestTargetDistance = Infinity;\n\n  let newTargetIndex = -1;\n  let newEndIndex = NaN;\n\n  for (\n    let targetIndex = 0;\n    targetIndex < traceState.targets.length;\n    ++targetIndex\n  ) {\n    const target = traceState.targets[targetIndex];\n    const coordinates = target.coordinates;\n\n    let minSegmentDistance = Infinity;\n    let endIndex;\n    for (\n      let coordinateIndex = 0;\n      coordinateIndex < coordinates.length - 1;\n      ++coordinateIndex\n    ) {\n      const start = coordinates[coordinateIndex];\n      const end = coordinates[coordinateIndex + 1];\n      const rel = getPointSegmentRelationship(x, y, start, end);\n      if (rel.squaredDistance < minSegmentDistance) {\n        minSegmentDistance = rel.squaredDistance;\n        endIndex = coordinateIndex + rel.along;\n      }\n    }\n\n    if (minSegmentDistance < closestTargetDistance) {\n      closestTargetDistance = minSegmentDistance;\n      if (target.ring && traceState.targetIndex === targetIndex) {\n        // same target, maintain the same trace direction\n        if (target.endIndex > target.startIndex) {\n          // forward trace\n          if (endIndex < target.startIndex) {\n            endIndex += coordinates.length;\n          }\n        } else if (target.endIndex < target.startIndex) {\n          // reverse trace\n          if (endIndex > target.startIndex) {\n            endIndex -= coordinates.length;\n          }\n        }\n      }\n      newEndIndex = endIndex;\n      newTargetIndex = targetIndex;\n    }\n  }\n\n  const newTarget = traceState.targets[newTargetIndex];\n  let considerBothDirections = newTarget.ring;\n  if (traceState.targetIndex === newTargetIndex && considerBothDirections) {\n    // only consider switching trace direction if close to the start\n    const newCoordinate = interpolateCoordinate(\n      newTarget.coordinates,\n      newEndIndex,\n    );\n    const pixel = map.getPixelFromCoordinate(newCoordinate);\n    if (distance(pixel, traceState.startPx) > snapTolerance) {\n      considerBothDirections = false;\n    }\n  }\n\n  if (considerBothDirections) {\n    const coordinates = newTarget.coordinates;\n    const count = coordinates.length;\n    const startIndex = newTarget.startIndex;\n    const endIndex = newEndIndex;\n    if (startIndex < endIndex) {\n      const forwardDistance = getCumulativeSquaredDistance(\n        coordinates,\n        startIndex,\n        endIndex,\n      );\n      const reverseDistance = getCumulativeSquaredDistance(\n        coordinates,\n        startIndex,\n        endIndex - count,\n      );\n      if (reverseDistance < forwardDistance) {\n        newEndIndex -= count;\n      }\n    } else {\n      const reverseDistance = getCumulativeSquaredDistance(\n        coordinates,\n        startIndex,\n        endIndex,\n      );\n      const forwardDistance = getCumulativeSquaredDistance(\n        coordinates,\n        startIndex,\n        endIndex + count,\n      );\n      if (forwardDistance < reverseDistance) {\n        newEndIndex += count;\n      }\n    }\n  }\n\n  sharedUpdateInfo.index = newTargetIndex;\n  sharedUpdateInfo.endIndex = newEndIndex;\n  return sharedUpdateInfo;\n}\n\n/**\n * @param {import(\"../coordinate.js\").Coordinate} coordinate The clicked coordinate.\n * @param {Array<import(\"../coordinate.js\").Coordinate>} coordinates The geometry component coordinates.\n * @param {boolean} ring The coordinates represent a linear ring.\n * @param {Array<TraceTarget>} targets The trace targets.\n */\nfunction appendTraceTarget(coordinate, coordinates, ring, targets) {\n  const x = coordinate[0];\n  const y = coordinate[1];\n  for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n    const start = coordinates[i];\n    const end = coordinates[i + 1];\n    const rel = getPointSegmentRelationship(x, y, start, end);\n    if (rel.squaredDistance === 0) {\n      const index = i + rel.along;\n      targets.push({\n        coordinates: coordinates,\n        ring: ring,\n        startIndex: index,\n        endIndex: index,\n      });\n      return;\n    }\n  }\n}\n\n/**\n * @typedef {Object} PointSegmentRelationship\n * @property {number} along The closest point expressed as a fraction along the segment length.\n * @property {number} squaredDistance The squared distance of the point to the segment.\n */\n\n/**\n * @type {PointSegmentRelationship}\n */\nconst sharedRel = {along: 0, squaredDistance: 0};\n\n/**\n * @param {number} x The point x.\n * @param {number} y The point y.\n * @param {import(\"../coordinate.js\").Coordinate} start The segment start.\n * @param {import(\"../coordinate.js\").Coordinate} end The segment end.\n * @return {PointSegmentRelationship} The point segment relationship.  The returned object is\n * shared between calls and must not be modified by the caller.\n */\nfunction getPointSegmentRelationship(x, y, start, end) {\n  const x1 = start[0];\n  const y1 = start[1];\n  const x2 = end[0];\n  const y2 = end[1];\n  const dx = x2 - x1;\n  const dy = y2 - y1;\n  let along = 0;\n  let px = x1;\n  let py = y1;\n  if (dx !== 0 || dy !== 0) {\n    along = clamp(((x - x1) * dx + (y - y1) * dy) / (dx * dx + dy * dy), 0, 1);\n    px += dx * along;\n    py += dy * along;\n  }\n\n  sharedRel.along = along;\n  sharedRel.squaredDistance = toFixed(squaredDistance(x, y, px, py), 10);\n  return sharedRel;\n}\n\n/**\n * @param {LineCoordType} coordinates The coordinates.\n * @param {number} index The index.  May be fractional and may wrap.\n * @return {import(\"../coordinate.js\").Coordinate} The interpolated coordinate.\n */\nfunction interpolateCoordinate(coordinates, index) {\n  const count = coordinates.length;\n\n  let startIndex = Math.floor(index);\n  const along = index - startIndex;\n  if (startIndex >= count) {\n    startIndex -= count;\n  } else if (startIndex < 0) {\n    startIndex += count;\n  }\n\n  let endIndex = startIndex + 1;\n  if (endIndex >= count) {\n    endIndex -= count;\n  }\n\n  const start = coordinates[startIndex];\n  const x0 = start[0];\n  const y0 = start[1];\n  const end = coordinates[endIndex];\n  const dx = end[0] - x0;\n  const dy = end[1] - y0;\n\n  return [x0 + dx * along, y0 + dy * along];\n}\n\n/***\n * @template Return\n * @typedef {import(\"../Observable\").OnSignature<import(\"../Observable\").EventTypes, import(\"../events/Event.js\").default, Return> &\n *   import(\"../Observable\").OnSignature<import(\"../ObjectEventType\").Types|\n *     'change:active', import(\"../Object\").ObjectEvent, Return> &\n *   import(\"../Observable\").OnSignature<'drawabort'|'drawend'|'drawstart', DrawEvent, Return> &\n *   import(\"../Observable\").CombinedOnSignature<import(\"../Observable\").EventTypes|import(\"../ObjectEventType\").Types|\n *     'change:active'|'drawabort'|'drawend'|'drawstart', Return>} DrawOnSignature\n */\n\n/**\n * @classdesc\n * Interaction for drawing feature geometries.\n *\n * @fires DrawEvent\n * @api\n */\nclass Draw extends PointerInteraction {\n  /**\n   * @param {Options} options Options.\n   */\n  constructor(options) {\n    const pointerOptions = /** @type {import(\"./Pointer.js\").Options} */ (\n      options\n    );\n    if (!pointerOptions.stopDown) {\n      pointerOptions.stopDown = FALSE;\n    }\n\n    super(pointerOptions);\n\n    /***\n     * @type {DrawOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.on;\n\n    /***\n     * @type {DrawOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.once;\n\n    /***\n     * @type {DrawOnSignature<void>}\n     */\n    this.un;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.shouldHandle_ = false;\n\n    /**\n     * @type {import(\"../pixel.js\").Pixel}\n     * @private\n     */\n    this.downPx_ = null;\n\n    /**\n     * @type {ReturnType<typeof setTimeout>}\n     * @private\n     */\n    this.downTimeout_;\n\n    /**\n     * @type {number|undefined}\n     * @private\n     */\n    this.lastDragTime_;\n\n    /**\n     * Pointer type of the last pointermove event\n     * @type {string}\n     * @private\n     */\n    this.pointerType_;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.freehand_ = false;\n\n    /**\n     * Target source for drawn features.\n     * @type {VectorSource|null}\n     * @private\n     */\n    this.source_ = options.source ? options.source : null;\n\n    /**\n     * Target collection for drawn features.\n     * @type {import(\"../Collection.js\").default<Feature>|null}\n     * @private\n     */\n    this.features_ = options.features ? options.features : null;\n\n    /**\n     * Pixel distance for snapping.\n     * @type {number}\n     * @private\n     */\n    this.snapTolerance_ = options.snapTolerance ? options.snapTolerance : 12;\n\n    /**\n     * Geometry type.\n     * @type {import(\"../geom/Geometry.js\").Type}\n     * @private\n     */\n    this.type_ = /** @type {import(\"../geom/Geometry.js\").Type} */ (\n      options.type\n    );\n\n    /**\n     * Drawing mode (derived from geometry type.\n     * @type {Mode}\n     * @private\n     */\n    this.mode_ = getMode(this.type_);\n\n    /**\n     * Stop click, singleclick, and doubleclick events from firing during drawing.\n     * Default is `false`.\n     * @type {boolean}\n     * @private\n     */\n    this.stopClick_ = !!options.stopClick;\n\n    /**\n     * The number of points that must be drawn before a polygon ring or line\n     * string can be finished.  The default is 3 for polygon rings and 2 for\n     * line strings.\n     * @type {number}\n     * @private\n     */\n    this.minPoints_ = options.minPoints\n      ? options.minPoints\n      : this.mode_ === 'Polygon'\n        ? 3\n        : 2;\n\n    /**\n     * The number of points that can be drawn before a polygon ring or line string\n     * is finished. The default is no restriction.\n     * @type {number}\n     * @private\n     */\n    this.maxPoints_ =\n      this.mode_ === 'Circle'\n        ? 2\n        : options.maxPoints\n          ? options.maxPoints\n          : Infinity;\n\n    /**\n     * A function to decide if a potential finish coordinate is permissible\n     * @private\n     * @type {import(\"../events/condition.js\").Condition}\n     */\n    this.finishCondition_ = options.finishCondition\n      ? options.finishCondition\n      : TRUE;\n\n    /**\n     * @private\n     * @type {import(\"../geom/Geometry.js\").GeometryLayout}\n     */\n    this.geometryLayout_ = options.geometryLayout\n      ? options.geometryLayout\n      : 'XY';\n\n    let geometryFunction = options.geometryFunction;\n    if (!geometryFunction) {\n      const mode = this.mode_;\n      if (mode === 'Circle') {\n        /**\n         * @param {!LineCoordType} coordinates The coordinates.\n         * @param {import(\"../geom/SimpleGeometry.js\").default|undefined} geometry Optional geometry.\n         * @param {import(\"../proj/Projection.js\").default} projection The view projection.\n         * @return {import(\"../geom/SimpleGeometry.js\").default} A geometry.\n         */\n        geometryFunction = function (coordinates, geometry, projection) {\n          const circle = geometry\n            ? /** @type {Circle} */ (geometry)\n            : new Circle([NaN, NaN]);\n          const center = fromUserCoordinate(coordinates[0], projection);\n          const squaredLength = squaredCoordinateDistance(\n            center,\n            fromUserCoordinate(coordinates[coordinates.length - 1], projection),\n          );\n          circle.setCenterAndRadius(\n            center,\n            Math.sqrt(squaredLength),\n            this.geometryLayout_,\n          );\n          const userProjection = getUserProjection();\n          if (userProjection) {\n            circle.transform(projection, userProjection);\n          }\n          return circle;\n        };\n      } else {\n        let Constructor;\n        if (mode === 'Point') {\n          Constructor = Point;\n        } else if (mode === 'LineString') {\n          Constructor = LineString;\n        } else if (mode === 'Polygon') {\n          Constructor = Polygon;\n        }\n        /**\n         * @param {!LineCoordType} coordinates The coordinates.\n         * @param {import(\"../geom/SimpleGeometry.js\").default|undefined} geometry Optional geometry.\n         * @param {import(\"../proj/Projection.js\").default} projection The view projection.\n         * @return {import(\"../geom/SimpleGeometry.js\").default} A geometry.\n         */\n        geometryFunction = function (coordinates, geometry, projection) {\n          if (geometry) {\n            if (mode === 'Polygon') {\n              if (coordinates[0].length) {\n                // Add a closing coordinate to match the first\n                geometry.setCoordinates(\n                  [coordinates[0].concat([coordinates[0][0]])],\n                  this.geometryLayout_,\n                );\n              } else {\n                geometry.setCoordinates([], this.geometryLayout_);\n              }\n            } else {\n              geometry.setCoordinates(coordinates, this.geometryLayout_);\n            }\n          } else {\n            geometry = new Constructor(coordinates, this.geometryLayout_);\n          }\n          return geometry;\n        };\n      }\n    }\n\n    /**\n     * @type {GeometryFunction}\n     * @private\n     */\n    this.geometryFunction_ = geometryFunction;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.dragVertexDelay_ =\n      options.dragVertexDelay !== undefined ? options.dragVertexDelay : 500;\n\n    /**\n     * Finish coordinate for the feature (first point for polygons, last point for\n     * linestrings).\n     * @type {import(\"../coordinate.js\").Coordinate}\n     * @private\n     */\n    this.finishCoordinate_ = null;\n\n    /**\n     * Sketch feature.\n     * @type {Feature<import('../geom/SimpleGeometry.js').default>}\n     * @private\n     */\n    this.sketchFeature_ = null;\n\n    /**\n     * Sketch point.\n     * @type {Feature<Point>}\n     * @private\n     */\n    this.sketchPoint_ = null;\n\n    /**\n     * Sketch coordinates. Used when drawing a line or polygon.\n     * @type {SketchCoordType}\n     * @private\n     */\n    this.sketchCoords_ = null;\n\n    /**\n     * Sketch line. Used when drawing polygon.\n     * @type {Feature<LineString>}\n     * @private\n     */\n    this.sketchLine_ = null;\n\n    /**\n     * Sketch line coordinates. Used when drawing a polygon or circle.\n     * @type {LineCoordType}\n     * @private\n     */\n    this.sketchLineCoords_ = null;\n\n    /**\n     * Squared tolerance for handling up events.  If the squared distance\n     * between a down and up event is greater than this tolerance, up events\n     * will not be handled.\n     * @type {number}\n     * @private\n     */\n    this.squaredClickTolerance_ = options.clickTolerance\n      ? options.clickTolerance * options.clickTolerance\n      : 36;\n\n    /**\n     * Draw overlay where our sketch features are drawn.\n     * @type {VectorLayer}\n     * @private\n     */\n    this.overlay_ = new VectorLayer({\n      source: new VectorSource({\n        useSpatialIndex: false,\n        wrapX: options.wrapX ? options.wrapX : false,\n      }),\n      style: options.style ? options.style : getDefaultStyleFunction(),\n      updateWhileInteracting: true,\n    });\n\n    /**\n     * Name of the geometry attribute for newly created features.\n     * @type {string|undefined}\n     * @private\n     */\n    this.geometryName_ = options.geometryName;\n\n    /**\n     * @private\n     * @type {import(\"../events/condition.js\").Condition}\n     */\n    this.condition_ = options.condition ? options.condition : noModifierKeys;\n\n    /**\n     * @private\n     * @type {import(\"../events/condition.js\").Condition}\n     */\n    this.freehandCondition_;\n    if (options.freehand) {\n      this.freehandCondition_ = always;\n    } else {\n      this.freehandCondition_ = options.freehandCondition\n        ? options.freehandCondition\n        : shiftKeyOnly;\n    }\n\n    /**\n     * @type {import(\"../events/condition.js\").Condition}\n     * @private\n     */\n    this.traceCondition_;\n    this.setTrace(options.trace || false);\n\n    /**\n     * @type {TraceState}\n     * @private\n     */\n    this.traceState_ = {active: false};\n\n    /**\n     * @type {VectorSource|null}\n     * @private\n     */\n    this.traceSource_ = options.traceSource || options.source || null;\n\n    this.addChangeListener(InteractionProperty.ACTIVE, this.updateState_);\n  }\n\n  /**\n   * Toggle tracing mode or set a tracing condition.\n   *\n   * @param {boolean|import(\"../events/condition.js\").Condition} trace A boolean to toggle tracing mode or an event\n   *     condition that will be checked when a feature is clicked to determine if tracing should be active.\n   */\n  setTrace(trace) {\n    let condition;\n    if (!trace) {\n      condition = never;\n    } else if (trace === true) {\n      condition = always;\n    } else {\n      condition = trace;\n    }\n    this.traceCondition_ = condition;\n  }\n\n  /**\n   * Remove the interaction from its current map and attach it to the new map.\n   * Subclasses may set up event handlers to get notified about changes to\n   * the map here.\n   * @param {import(\"../Map.js\").default} map Map.\n   */\n  setMap(map) {\n    super.setMap(map);\n    this.updateState_();\n  }\n\n  /**\n   * Get the overlay layer that this interaction renders sketch features to.\n   * @return {VectorLayer} Overlay layer.\n   * @api\n   */\n  getOverlay() {\n    return this.overlay_;\n  }\n\n  /**\n   * Handles the {@link module:ol/MapBrowserEvent~MapBrowserEvent map browser event} and may actually draw or finish the drawing.\n   * @param {import(\"../MapBrowserEvent.js\").default} event Map browser event.\n   * @return {boolean} `false` to stop event propagation.\n   * @api\n   */\n  handleEvent(event) {\n    if (event.originalEvent.type === EventType.CONTEXTMENU) {\n      // Avoid context menu for long taps when drawing on mobile\n      event.originalEvent.preventDefault();\n    }\n    this.freehand_ = this.mode_ !== 'Point' && this.freehandCondition_(event);\n    let move = event.type === MapBrowserEventType.POINTERMOVE;\n    let pass = true;\n    if (\n      !this.freehand_ &&\n      this.lastDragTime_ &&\n      event.type === MapBrowserEventType.POINTERDRAG\n    ) {\n      const now = Date.now();\n      if (now - this.lastDragTime_ >= this.dragVertexDelay_) {\n        this.downPx_ = event.pixel;\n        this.shouldHandle_ = !this.freehand_;\n        move = true;\n      } else {\n        this.lastDragTime_ = undefined;\n      }\n      if (this.shouldHandle_ && this.downTimeout_ !== undefined) {\n        clearTimeout(this.downTimeout_);\n        this.downTimeout_ = undefined;\n      }\n    }\n    if (\n      this.freehand_ &&\n      event.type === MapBrowserEventType.POINTERDRAG &&\n      this.sketchFeature_ !== null\n    ) {\n      this.addToDrawing_(event.coordinate);\n      pass = false;\n    } else if (\n      this.freehand_ &&\n      event.type === MapBrowserEventType.POINTERDOWN\n    ) {\n      pass = false;\n    } else if (move && this.getPointerCount() < 2) {\n      pass = event.type === MapBrowserEventType.POINTERMOVE;\n      if (pass && this.freehand_) {\n        this.handlePointerMove_(event);\n        if (this.shouldHandle_) {\n          // Avoid page scrolling when freehand drawing on mobile\n          event.originalEvent.preventDefault();\n        }\n      } else if (\n        event.originalEvent.pointerType === 'mouse' ||\n        (event.type === MapBrowserEventType.POINTERDRAG &&\n          this.downTimeout_ === undefined)\n      ) {\n        this.handlePointerMove_(event);\n      }\n    } else if (event.type === MapBrowserEventType.DBLCLICK) {\n      pass = false;\n    }\n\n    return super.handleEvent(event) && pass;\n  }\n\n  /**\n   * Handle pointer down events.\n   * @param {import(\"../MapBrowserEvent.js\").default} event Event.\n   * @return {boolean} If the event was consumed.\n   */\n  handleDownEvent(event) {\n    this.shouldHandle_ = !this.freehand_;\n\n    if (this.freehand_) {\n      this.downPx_ = event.pixel;\n      if (!this.finishCoordinate_) {\n        this.startDrawing_(event.coordinate);\n      }\n      return true;\n    }\n\n    if (!this.condition_(event)) {\n      this.lastDragTime_ = undefined;\n      return false;\n    }\n\n    this.lastDragTime_ = Date.now();\n    this.downTimeout_ = setTimeout(() => {\n      this.handlePointerMove_(\n        new MapBrowserEvent(\n          MapBrowserEventType.POINTERMOVE,\n          event.map,\n          event.originalEvent,\n          false,\n          event.frameState,\n        ),\n      );\n    }, this.dragVertexDelay_);\n    this.downPx_ = event.pixel;\n    return true;\n  }\n\n  /**\n   * @private\n   */\n  deactivateTrace_() {\n    this.traceState_ = {active: false};\n  }\n\n  /**\n   * Activate or deactivate trace state based on a browser event.\n   * @param {import(\"../MapBrowserEvent.js\").default} event Event.\n   * @private\n   */\n  toggleTraceState_(event) {\n    if (!this.traceSource_ || !this.traceCondition_(event)) {\n      return;\n    }\n\n    if (this.traceState_.active) {\n      this.deactivateTrace_();\n      return;\n    }\n\n    const map = this.getMap();\n    const lowerLeft = map.getCoordinateFromPixel([\n      event.pixel[0] - this.snapTolerance_,\n      event.pixel[1] + this.snapTolerance_,\n    ]);\n    const upperRight = map.getCoordinateFromPixel([\n      event.pixel[0] + this.snapTolerance_,\n      event.pixel[1] - this.snapTolerance_,\n    ]);\n    const extent = boundingExtent([lowerLeft, upperRight]);\n    const features = this.traceSource_.getFeaturesInExtent(extent);\n    if (features.length === 0) {\n      return;\n    }\n\n    const targets = getTraceTargets(event.coordinate, features);\n    if (targets.length) {\n      this.traceState_ = {\n        active: true,\n        startPx: event.pixel.slice(),\n        targets: targets,\n        targetIndex: -1,\n      };\n    }\n  }\n\n  /**\n   * @param {TraceTarget} target The trace target.\n   * @param {number} endIndex The new end index of the trace.\n   * @private\n   */\n  addOrRemoveTracedCoordinates_(target, endIndex) {\n    // three cases to handle:\n    //  1. traced in the same direction and points need adding\n    //  2. traced in the same direction and points need removing\n    //  3. traced in a new direction\n    const previouslyForward = target.startIndex <= target.endIndex;\n    const currentlyForward = target.startIndex <= endIndex;\n    if (previouslyForward === currentlyForward) {\n      // same direction\n      if (\n        (previouslyForward && endIndex > target.endIndex) ||\n        (!previouslyForward && endIndex < target.endIndex)\n      ) {\n        // case 1 - add new points\n        this.addTracedCoordinates_(target, target.endIndex, endIndex);\n      } else if (\n        (previouslyForward && endIndex < target.endIndex) ||\n        (!previouslyForward && endIndex > target.endIndex)\n      ) {\n        // case 2 - remove old points\n        this.removeTracedCoordinates_(endIndex, target.endIndex);\n      }\n    } else {\n      // case 3 - remove old points, add new points\n      this.removeTracedCoordinates_(target.startIndex, target.endIndex);\n      this.addTracedCoordinates_(target, target.startIndex, endIndex);\n    }\n  }\n\n  /**\n   * @param {number} fromIndex The start index.\n   * @param {number} toIndex The end index.\n   * @private\n   */\n  removeTracedCoordinates_(fromIndex, toIndex) {\n    if (fromIndex === toIndex) {\n      return;\n    }\n\n    let remove = 0;\n    if (fromIndex < toIndex) {\n      const start = Math.ceil(fromIndex);\n      let end = Math.floor(toIndex);\n      if (end === toIndex) {\n        end -= 1;\n      }\n      remove = end - start + 1;\n    } else {\n      const start = Math.floor(fromIndex);\n      let end = Math.ceil(toIndex);\n      if (end === toIndex) {\n        end += 1;\n      }\n      remove = start - end + 1;\n    }\n\n    if (remove > 0) {\n      this.removeLastPoints_(remove);\n    }\n  }\n\n  /**\n   * @param {TraceTarget} target The trace target.\n   * @param {number} fromIndex The start index.\n   * @param {number} toIndex The end index.\n   * @private\n   */\n  addTracedCoordinates_(target, fromIndex, toIndex) {\n    if (fromIndex === toIndex) {\n      return;\n    }\n\n    const coordinates = [];\n    if (fromIndex < toIndex) {\n      // forward trace\n      const start = Math.ceil(fromIndex);\n      let end = Math.floor(toIndex);\n      if (end === toIndex) {\n        // if end is snapped to a vertex, it will be added later\n        end -= 1;\n      }\n      for (let i = start; i <= end; ++i) {\n        coordinates.push(getCoordinate(target.coordinates, i));\n      }\n    } else {\n      // reverse trace\n      const start = Math.floor(fromIndex);\n      let end = Math.ceil(toIndex);\n      if (end === toIndex) {\n        end += 1;\n      }\n      for (let i = start; i >= end; --i) {\n        coordinates.push(getCoordinate(target.coordinates, i));\n      }\n    }\n    if (coordinates.length) {\n      this.appendCoordinates(coordinates);\n    }\n  }\n\n  /**\n   * Update the trace.\n   * @param {import(\"../MapBrowserEvent.js\").default} event Event.\n   * @private\n   */\n  updateTrace_(event) {\n    const traceState = this.traceState_;\n    if (!traceState.active) {\n      return;\n    }\n\n    if (traceState.targetIndex === -1) {\n      // check if we are ready to pick a target\n      if (distance(traceState.startPx, event.pixel) < this.snapTolerance_) {\n        return;\n      }\n    }\n\n    const updatedTraceTarget = getTraceTargetUpdate(\n      event.coordinate,\n      traceState,\n      this.getMap(),\n      this.snapTolerance_,\n    );\n\n    if (traceState.targetIndex !== updatedTraceTarget.index) {\n      // target changed\n      if (traceState.targetIndex !== -1) {\n        // remove points added during previous trace\n        const oldTarget = traceState.targets[traceState.targetIndex];\n        this.removeTracedCoordinates_(oldTarget.startIndex, oldTarget.endIndex);\n      }\n      // add points for the new target\n      const newTarget = traceState.targets[updatedTraceTarget.index];\n      this.addTracedCoordinates_(\n        newTarget,\n        newTarget.startIndex,\n        updatedTraceTarget.endIndex,\n      );\n    } else {\n      // target stayed the same\n      const target = traceState.targets[traceState.targetIndex];\n      this.addOrRemoveTracedCoordinates_(target, updatedTraceTarget.endIndex);\n    }\n\n    // modify the state with updated info\n    traceState.targetIndex = updatedTraceTarget.index;\n    const target = traceState.targets[traceState.targetIndex];\n    target.endIndex = updatedTraceTarget.endIndex;\n\n    // update event coordinate and pixel to match end point of final segment\n    const coordinate = interpolateCoordinate(\n      target.coordinates,\n      target.endIndex,\n    );\n    const pixel = this.getMap().getPixelFromCoordinate(coordinate);\n    event.coordinate = coordinate;\n    event.pixel = [Math.round(pixel[0]), Math.round(pixel[1])];\n  }\n\n  /**\n   * Handle pointer up events.\n   * @param {import(\"../MapBrowserEvent.js\").default} event Event.\n   * @return {boolean} If the event was consumed.\n   */\n  handleUpEvent(event) {\n    let pass = true;\n\n    if (this.getPointerCount() === 0) {\n      if (this.downTimeout_) {\n        clearTimeout(this.downTimeout_);\n        this.downTimeout_ = undefined;\n      }\n\n      this.handlePointerMove_(event);\n      const tracing = this.traceState_.active;\n      this.toggleTraceState_(event);\n\n      if (this.shouldHandle_) {\n        const startingToDraw = !this.finishCoordinate_;\n        if (startingToDraw) {\n          this.startDrawing_(event.coordinate);\n        }\n        if (!startingToDraw && this.freehand_) {\n          this.finishDrawing();\n        } else if (\n          !this.freehand_ &&\n          (!startingToDraw || this.mode_ === 'Point')\n        ) {\n          if (this.atFinish_(event.pixel, tracing)) {\n            if (this.finishCondition_(event)) {\n              this.finishDrawing();\n            }\n          } else {\n            this.addToDrawing_(event.coordinate);\n          }\n        }\n        pass = false;\n      } else if (this.freehand_) {\n        this.abortDrawing();\n      }\n    }\n\n    if (!pass && this.stopClick_) {\n      event.preventDefault();\n    }\n    return pass;\n  }\n\n  /**\n   * Handle move events.\n   * @param {import(\"../MapBrowserEvent.js\").default} event A move event.\n   * @private\n   */\n  handlePointerMove_(event) {\n    this.pointerType_ = event.originalEvent.pointerType;\n    if (\n      this.downPx_ &&\n      ((!this.freehand_ && this.shouldHandle_) ||\n        (this.freehand_ && !this.shouldHandle_))\n    ) {\n      const downPx = this.downPx_;\n      const clickPx = event.pixel;\n      const dx = downPx[0] - clickPx[0];\n      const dy = downPx[1] - clickPx[1];\n      const squaredDistance = dx * dx + dy * dy;\n      this.shouldHandle_ = this.freehand_\n        ? squaredDistance > this.squaredClickTolerance_\n        : squaredDistance <= this.squaredClickTolerance_;\n      if (!this.shouldHandle_) {\n        return;\n      }\n    }\n\n    if (!this.finishCoordinate_) {\n      this.createOrUpdateSketchPoint_(event.coordinate.slice());\n      return;\n    }\n\n    this.updateTrace_(event);\n    this.modifyDrawing_(event.coordinate);\n  }\n\n  /**\n   * Determine if an event is within the snapping tolerance of the start coord.\n   * @param {import(\"../pixel.js\").Pixel} pixel Pixel.\n   * @param {boolean} [tracing] Drawing in trace mode (only stop if at the starting point).\n   * @return {boolean} The event is within the snapping tolerance of the start.\n   * @private\n   */\n  atFinish_(pixel, tracing) {\n    let at = false;\n    if (this.sketchFeature_) {\n      let potentiallyDone = false;\n      let potentiallyFinishCoordinates = [this.finishCoordinate_];\n      const mode = this.mode_;\n      if (mode === 'Point') {\n        at = true;\n      } else if (mode === 'Circle') {\n        at = this.sketchCoords_.length === 2;\n      } else if (mode === 'LineString') {\n        potentiallyDone =\n          !tracing && this.sketchCoords_.length > this.minPoints_;\n      } else if (mode === 'Polygon') {\n        const sketchCoords = /** @type {PolyCoordType} */ (this.sketchCoords_);\n        potentiallyDone = sketchCoords[0].length > this.minPoints_;\n        potentiallyFinishCoordinates = [\n          sketchCoords[0][0],\n          sketchCoords[0][sketchCoords[0].length - 2],\n        ];\n        if (tracing) {\n          potentiallyFinishCoordinates = [sketchCoords[0][0]];\n        } else {\n          potentiallyFinishCoordinates = [\n            sketchCoords[0][0],\n            sketchCoords[0][sketchCoords[0].length - 2],\n          ];\n        }\n      }\n      if (potentiallyDone) {\n        const map = this.getMap();\n        for (let i = 0, ii = potentiallyFinishCoordinates.length; i < ii; i++) {\n          const finishCoordinate = potentiallyFinishCoordinates[i];\n          const finishPixel = map.getPixelFromCoordinate(finishCoordinate);\n          const dx = pixel[0] - finishPixel[0];\n          const dy = pixel[1] - finishPixel[1];\n          const snapTolerance = this.freehand_ ? 1 : this.snapTolerance_;\n          at = Math.sqrt(dx * dx + dy * dy) <= snapTolerance;\n          if (at) {\n            this.finishCoordinate_ = finishCoordinate;\n            break;\n          }\n        }\n      }\n    }\n    return at;\n  }\n\n  /**\n   * @param {import(\"../coordinate\").Coordinate} coordinates Coordinate.\n   * @private\n   */\n  createOrUpdateSketchPoint_(coordinates) {\n    if (!this.sketchPoint_) {\n      this.sketchPoint_ = new Feature(new Point(coordinates));\n      this.updateSketchFeatures_();\n    } else {\n      const sketchPointGeom = this.sketchPoint_.getGeometry();\n      sketchPointGeom.setCoordinates(coordinates);\n    }\n  }\n\n  /**\n   * @param {import(\"../geom/Polygon.js\").default} geometry Polygon geometry.\n   * @private\n   */\n  createOrUpdateCustomSketchLine_(geometry) {\n    if (!this.sketchLine_) {\n      this.sketchLine_ = new Feature();\n    }\n    const ring = geometry.getLinearRing(0);\n    let sketchLineGeom = this.sketchLine_.getGeometry();\n    if (!sketchLineGeom) {\n      sketchLineGeom = new LineString(\n        ring.getFlatCoordinates(),\n        ring.getLayout(),\n      );\n      this.sketchLine_.setGeometry(sketchLineGeom);\n    } else {\n      sketchLineGeom.setFlatCoordinates(\n        ring.getLayout(),\n        ring.getFlatCoordinates(),\n      );\n      sketchLineGeom.changed();\n    }\n  }\n\n  /**\n   * Start the drawing.\n   * @param {import(\"../coordinate.js\").Coordinate} start Start coordinate.\n   * @private\n   */\n  startDrawing_(start) {\n    const projection = this.getMap().getView().getProjection();\n    const stride = getStrideForLayout(this.geometryLayout_);\n    while (start.length < stride) {\n      start.push(0);\n    }\n    this.finishCoordinate_ = start;\n    if (this.mode_ === 'Point') {\n      this.sketchCoords_ = start.slice();\n    } else if (this.mode_ === 'Polygon') {\n      this.sketchCoords_ = [[start.slice(), start.slice()]];\n      this.sketchLineCoords_ = this.sketchCoords_[0];\n    } else {\n      this.sketchCoords_ = [start.slice(), start.slice()];\n    }\n    if (this.sketchLineCoords_) {\n      this.sketchLine_ = new Feature(new LineString(this.sketchLineCoords_));\n    }\n    const geometry = this.geometryFunction_(\n      this.sketchCoords_,\n      undefined,\n      projection,\n    );\n    this.sketchFeature_ = new Feature();\n    if (this.geometryName_) {\n      this.sketchFeature_.setGeometryName(this.geometryName_);\n    }\n    this.sketchFeature_.setGeometry(geometry);\n    this.updateSketchFeatures_();\n    this.dispatchEvent(\n      new DrawEvent(DrawEventType.DRAWSTART, this.sketchFeature_),\n    );\n  }\n\n  /**\n   * Modify the drawing.\n   * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @private\n   */\n  modifyDrawing_(coordinate) {\n    const map = this.getMap();\n    const geometry = this.sketchFeature_.getGeometry();\n    const projection = map.getView().getProjection();\n    const stride = getStrideForLayout(this.geometryLayout_);\n    let coordinates, last;\n    while (coordinate.length < stride) {\n      coordinate.push(0);\n    }\n    if (this.mode_ === 'Point') {\n      last = this.sketchCoords_;\n    } else if (this.mode_ === 'Polygon') {\n      coordinates = /** @type {PolyCoordType} */ (this.sketchCoords_)[0];\n      last = coordinates[coordinates.length - 1];\n      if (this.atFinish_(map.getPixelFromCoordinate(coordinate))) {\n        // snap to finish\n        coordinate = this.finishCoordinate_.slice();\n      }\n    } else {\n      coordinates = this.sketchCoords_;\n      last = coordinates[coordinates.length - 1];\n    }\n    last[0] = coordinate[0];\n    last[1] = coordinate[1];\n    this.geometryFunction_(\n      /** @type {!LineCoordType} */ (this.sketchCoords_),\n      geometry,\n      projection,\n    );\n    if (this.sketchPoint_) {\n      const sketchPointGeom = this.sketchPoint_.getGeometry();\n      sketchPointGeom.setCoordinates(coordinate);\n    }\n    if (geometry.getType() === 'Polygon' && this.mode_ !== 'Polygon') {\n      this.createOrUpdateCustomSketchLine_(/** @type {Polygon} */ (geometry));\n    } else if (this.sketchLineCoords_) {\n      const sketchLineGeom = this.sketchLine_.getGeometry();\n      sketchLineGeom.setCoordinates(this.sketchLineCoords_);\n    }\n    this.updateSketchFeatures_();\n  }\n\n  /**\n   * Add a new coordinate to the drawing.\n   * @param {!PointCoordType} coordinate Coordinate\n   * @return {Feature<import(\"../geom/SimpleGeometry.js\").default>} The sketch feature.\n   * @private\n   */\n  addToDrawing_(coordinate) {\n    const geometry = this.sketchFeature_.getGeometry();\n    const projection = this.getMap().getView().getProjection();\n    let done;\n    let coordinates;\n    const mode = this.mode_;\n    if (mode === 'LineString' || mode === 'Circle') {\n      this.finishCoordinate_ = coordinate.slice();\n      coordinates = /** @type {LineCoordType} */ (this.sketchCoords_);\n      if (coordinates.length >= this.maxPoints_) {\n        if (this.freehand_) {\n          coordinates.pop();\n        } else {\n          done = true;\n        }\n      }\n      coordinates.push(coordinate.slice());\n      this.geometryFunction_(coordinates, geometry, projection);\n    } else if (mode === 'Polygon') {\n      coordinates = /** @type {PolyCoordType} */ (this.sketchCoords_)[0];\n      if (coordinates.length >= this.maxPoints_) {\n        if (this.freehand_) {\n          coordinates.pop();\n        } else {\n          done = true;\n        }\n      }\n      coordinates.push(coordinate.slice());\n      if (done) {\n        this.finishCoordinate_ = coordinates[0];\n      }\n      this.geometryFunction_(this.sketchCoords_, geometry, projection);\n    }\n    this.createOrUpdateSketchPoint_(coordinate.slice());\n    this.updateSketchFeatures_();\n    if (done) {\n      return this.finishDrawing();\n    }\n    return this.sketchFeature_;\n  }\n\n  /**\n   * @param {number} n The number of points to remove.\n   */\n  removeLastPoints_(n) {\n    if (!this.sketchFeature_) {\n      return;\n    }\n    const geometry = this.sketchFeature_.getGeometry();\n    const projection = this.getMap().getView().getProjection();\n    const mode = this.mode_;\n    for (let i = 0; i < n; ++i) {\n      let coordinates;\n      if (mode === 'LineString' || mode === 'Circle') {\n        coordinates = /** @type {LineCoordType} */ (this.sketchCoords_);\n        coordinates.splice(-2, 1);\n        if (coordinates.length >= 2) {\n          this.finishCoordinate_ = coordinates[coordinates.length - 2].slice();\n          const finishCoordinate = this.finishCoordinate_.slice();\n          coordinates[coordinates.length - 1] = finishCoordinate;\n          this.createOrUpdateSketchPoint_(finishCoordinate);\n        }\n        this.geometryFunction_(coordinates, geometry, projection);\n        if (geometry.getType() === 'Polygon' && this.sketchLine_) {\n          this.createOrUpdateCustomSketchLine_(\n            /** @type {Polygon} */ (geometry),\n          );\n        }\n      } else if (mode === 'Polygon') {\n        coordinates = /** @type {PolyCoordType} */ (this.sketchCoords_)[0];\n        coordinates.splice(-2, 1);\n        const sketchLineGeom = this.sketchLine_.getGeometry();\n        if (coordinates.length >= 2) {\n          const finishCoordinate = coordinates[coordinates.length - 2].slice();\n          coordinates[coordinates.length - 1] = finishCoordinate;\n          this.createOrUpdateSketchPoint_(finishCoordinate);\n        }\n        sketchLineGeom.setCoordinates(coordinates);\n        this.geometryFunction_(this.sketchCoords_, geometry, projection);\n      }\n\n      if (coordinates.length === 1) {\n        this.abortDrawing();\n        break;\n      }\n    }\n\n    this.updateSketchFeatures_();\n  }\n\n  /**\n   * Remove last point of the feature currently being drawn. Does not do anything when\n   * drawing POINT or MULTI_POINT geometries.\n   * @api\n   */\n  removeLastPoint() {\n    this.removeLastPoints_(1);\n  }\n\n  /**\n   * Stop drawing and add the sketch feature to the target layer.\n   * The {@link module:ol/interaction/Draw~DrawEventType.DRAWEND} event is\n   * dispatched before inserting the feature.\n   * @return {Feature<import(\"../geom/SimpleGeometry.js\").default>|null} The drawn feature.\n   * @api\n   */\n  finishDrawing() {\n    const sketchFeature = this.abortDrawing_();\n    if (!sketchFeature) {\n      return null;\n    }\n    let coordinates = this.sketchCoords_;\n    const geometry = sketchFeature.getGeometry();\n    const projection = this.getMap().getView().getProjection();\n    if (this.mode_ === 'LineString') {\n      // remove the redundant last point\n      coordinates.pop();\n      this.geometryFunction_(coordinates, geometry, projection);\n    } else if (this.mode_ === 'Polygon') {\n      // remove the redundant last point in ring\n      /** @type {PolyCoordType} */ (coordinates)[0].pop();\n      this.geometryFunction_(coordinates, geometry, projection);\n      coordinates = geometry.getCoordinates();\n    }\n\n    // cast multi-part geometries\n    if (this.type_ === 'MultiPoint') {\n      sketchFeature.setGeometry(\n        new MultiPoint([/** @type {PointCoordType} */ (coordinates)]),\n      );\n    } else if (this.type_ === 'MultiLineString') {\n      sketchFeature.setGeometry(\n        new MultiLineString([/** @type {LineCoordType} */ (coordinates)]),\n      );\n    } else if (this.type_ === 'MultiPolygon') {\n      sketchFeature.setGeometry(\n        new MultiPolygon([/** @type {PolyCoordType} */ (coordinates)]),\n      );\n    }\n\n    // First dispatch event to allow full set up of feature\n    this.dispatchEvent(new DrawEvent(DrawEventType.DRAWEND, sketchFeature));\n\n    // Then insert feature\n    if (this.features_) {\n      this.features_.push(sketchFeature);\n    }\n    if (this.source_) {\n      this.source_.addFeature(sketchFeature);\n    }\n    return sketchFeature;\n  }\n\n  /**\n   * Stop drawing without adding the sketch feature to the target layer.\n   * @return {Feature<import(\"../geom/SimpleGeometry.js\").default>|null} The sketch feature (or null if none).\n   * @private\n   */\n  abortDrawing_() {\n    this.finishCoordinate_ = null;\n    const sketchFeature = this.sketchFeature_;\n    this.sketchFeature_ = null;\n    this.sketchPoint_ = null;\n    this.sketchLine_ = null;\n    this.overlay_.getSource().clear(true);\n    this.deactivateTrace_();\n    return sketchFeature;\n  }\n\n  /**\n   * Stop drawing without adding the sketch feature to the target layer.\n   * @api\n   */\n  abortDrawing() {\n    const sketchFeature = this.abortDrawing_();\n    if (sketchFeature) {\n      this.dispatchEvent(new DrawEvent(DrawEventType.DRAWABORT, sketchFeature));\n    }\n  }\n\n  /**\n   * Append coordinates to the end of the geometry that is currently being drawn.\n   * This can be used when drawing LineStrings or Polygons. Coordinates will\n   * either be appended to the current LineString or the outer ring of the current\n   * Polygon. If no geometry is being drawn, a new one will be created.\n   * @param {!LineCoordType} coordinates Linear coordinates to be appended to\n   * the coordinate array.\n   * @api\n   */\n  appendCoordinates(coordinates) {\n    const mode = this.mode_;\n    const newDrawing = !this.sketchFeature_;\n    if (newDrawing) {\n      this.startDrawing_(coordinates[0]);\n    }\n    /** @type {LineCoordType} */\n    let sketchCoords;\n    if (mode === 'LineString' || mode === 'Circle') {\n      sketchCoords = /** @type {LineCoordType} */ (this.sketchCoords_);\n    } else if (mode === 'Polygon') {\n      sketchCoords =\n        this.sketchCoords_ && this.sketchCoords_.length\n          ? /** @type {PolyCoordType} */ (this.sketchCoords_)[0]\n          : [];\n    } else {\n      return;\n    }\n\n    if (newDrawing) {\n      sketchCoords.shift();\n    }\n\n    // Remove last coordinate from sketch drawing (this coordinate follows cursor position)\n    sketchCoords.pop();\n\n    // Append coordinate list\n    for (let i = 0; i < coordinates.length; i++) {\n      this.addToDrawing_(coordinates[i]);\n    }\n\n    const ending = coordinates[coordinates.length - 1];\n    // Duplicate last coordinate for sketch drawing (cursor position)\n    this.sketchFeature_ = this.addToDrawing_(ending);\n    this.modifyDrawing_(ending);\n  }\n\n  /**\n   * Initiate draw mode by starting from an existing geometry which will\n   * receive new additional points. This only works on features with\n   * `LineString` geometries, where the interaction will extend lines by adding\n   * points to the end of the coordinates array.\n   * This will change the original feature, instead of drawing a copy.\n   *\n   * The function will dispatch a `drawstart` event.\n   *\n   * @param {!Feature<LineString>} feature Feature to be extended.\n   * @api\n   */\n  extend(feature) {\n    const geometry = feature.getGeometry();\n    const lineString = geometry;\n    this.sketchFeature_ = feature;\n    this.sketchCoords_ = lineString.getCoordinates();\n    const last = this.sketchCoords_[this.sketchCoords_.length - 1];\n    this.finishCoordinate_ = last.slice();\n    this.sketchCoords_.push(last.slice());\n    this.sketchPoint_ = new Feature(new Point(last));\n    this.updateSketchFeatures_();\n    this.dispatchEvent(\n      new DrawEvent(DrawEventType.DRAWSTART, this.sketchFeature_),\n    );\n  }\n\n  /**\n   * Redraw the sketch features.\n   * @private\n   */\n  updateSketchFeatures_() {\n    const sketchFeatures = [];\n    if (this.sketchFeature_) {\n      sketchFeatures.push(this.sketchFeature_);\n    }\n    if (this.sketchLine_) {\n      sketchFeatures.push(this.sketchLine_);\n    }\n    if (this.sketchPoint_) {\n      sketchFeatures.push(this.sketchPoint_);\n    }\n    const overlaySource = this.overlay_.getSource();\n    overlaySource.clear(true);\n    overlaySource.addFeatures(sketchFeatures);\n  }\n\n  /**\n   * @private\n   */\n  updateState_() {\n    const map = this.getMap();\n    const active = this.getActive();\n    if (!map || !active) {\n      this.abortDrawing();\n    }\n    this.overlay_.setMap(active ? map : null);\n  }\n}\n\n/**\n * @return {import(\"../style/Style.js\").StyleFunction} Styles.\n */\nfunction getDefaultStyleFunction() {\n  const styles = createEditingStyle();\n  return function (feature, resolution) {\n    return styles[feature.getGeometry().getType()];\n  };\n}\n\n/**\n * Create a `geometryFunction` for `type: 'Circle'` that will create a regular\n * polygon with a user specified number of sides and start angle instead of a\n * {@link import(\"../geom/Circle.js\").Circle} geometry.\n * @param {number} [sides] Number of sides of the regular polygon.\n *     Default is 32.\n * @param {number} [angle] Angle of the first point in counter-clockwise\n *     radians. 0 means East.\n *     Default is the angle defined by the heading from the center of the\n *     regular polygon to the current pointer position.\n * @return {GeometryFunction} Function that draws a polygon.\n * @api\n */\nexport function createRegularPolygon(sides, angle) {\n  return function (coordinates, geometry, projection) {\n    const center = fromUserCoordinate(\n      /** @type {LineCoordType} */ (coordinates)[0],\n      projection,\n    );\n    const end = fromUserCoordinate(\n      /** @type {LineCoordType} */ (coordinates)[coordinates.length - 1],\n      projection,\n    );\n    const radius = Math.sqrt(squaredCoordinateDistance(center, end));\n    geometry = geometry || fromCircle(new Circle(center), sides);\n\n    let internalAngle = angle;\n    if (!angle && angle !== 0) {\n      const x = end[0] - center[0];\n      const y = end[1] - center[1];\n      internalAngle = Math.atan2(y, x);\n    }\n    makeRegular(\n      /** @type {Polygon} */ (geometry),\n      center,\n      radius,\n      internalAngle,\n    );\n\n    const userProjection = getUserProjection();\n    if (userProjection) {\n      geometry.transform(projection, userProjection);\n    }\n    return geometry;\n  };\n}\n\n/**\n * Create a `geometryFunction` that will create a box-shaped polygon (aligned\n * with the coordinate system axes).  Use this with the draw interaction and\n * `type: 'Circle'` to return a box instead of a circle geometry.\n * @return {GeometryFunction} Function that draws a box-shaped polygon.\n * @api\n */\nexport function createBox() {\n  return function (coordinates, geometry, projection) {\n    const extent = boundingExtent(\n      /** @type {LineCoordType} */ ([\n        coordinates[0],\n        coordinates[coordinates.length - 1],\n      ]).map(function (coordinate) {\n        return fromUserCoordinate(coordinate, projection);\n      }),\n    );\n    const boxCoordinates = [\n      [\n        getBottomLeft(extent),\n        getBottomRight(extent),\n        getTopRight(extent),\n        getTopLeft(extent),\n        getBottomLeft(extent),\n      ],\n    ];\n    if (geometry) {\n      geometry.setCoordinates(boxCoordinates);\n    } else {\n      geometry = new Polygon(boxCoordinates);\n    }\n    const userProjection = getUserProjection();\n    if (userProjection) {\n      geometry.transform(projection, userProjection);\n    }\n    return geometry;\n  };\n}\n\n/**\n * Get the drawing mode.  The mode for multi-part geometries is the same as for\n * their single-part cousins.\n * @param {import(\"../geom/Geometry.js\").Type} type Geometry type.\n * @return {Mode} Drawing mode.\n */\nfunction getMode(type) {\n  switch (type) {\n    case 'Point':\n    case 'MultiPoint':\n      return 'Point';\n    case 'LineString':\n    case 'MultiLineString':\n      return 'LineString';\n    case 'Polygon':\n    case 'MultiPolygon':\n      return 'Polygon';\n    case 'Circle':\n      return 'Circle';\n    default:\n      throw new Error('Invalid type: ' + type);\n  }\n}\n\nexport default Draw;\n","import State from '../../../tools/state/state';\n\nimport olCollection from 'ol/Collection';\nimport olInteractionDraw from 'ol/interaction/Draw';\nimport olStyleStyle from 'ol/style/Style';\nimport olStyleStroke from 'ol/style/Stroke';\nimport VectorLayer from 'ol/layer/Vector';\nimport VectorSource from 'ol/source/Vector';\n\nimport type OlMap from 'ol/Map';\nimport type OlGeomLineString from 'ol/geom/LineString';\nimport type OlCollection from 'ol/Collection';\nimport type OlFeature from 'ol/Feature';\nimport type OlGeomGeometry from 'ol/geom/Geometry';\nimport type OlInteractionDraw from 'ol/interaction/Draw';\nimport type { DrawEvent } from 'ol/interaction/Draw';\n\ntype StoreLineChangeFn = (line: OlGeomLineString | null) => void;\ntype StoreDrawActiveChangeFn = (active: boolean) => void;\n\n/**\n * Side class that adds and manage a draw line interaction\n * and its vector layer on the map.\n * You have to call the \"setupSave\" method to let this class update your system\n * when a line is drawn or deleted and when the draw line is de/activated.\n */\nexport default class DrawLine {\n  private readonly features: OlCollection<OlFeature<OlGeomGeometry>>;\n  private readonly interaction: OlInteractionDraw;\n  private readonly vectorLayer: VectorLayer<VectorSource>;\n  private storeLineChangeFn: StoreLineChangeFn;\n  private storeDrawActiveFn: StoreDrawActiveChangeFn;\n  private map?: OlMap;\n  private state: State;\n\n  constructor(state: State) {\n    this.state = state;\n    this.features = new olCollection();\n    const source = new VectorSource({\n      useSpatialIndex: false,\n      features: this.features\n    });\n    const style = new olStyleStyle({\n      stroke: new olStyleStroke({\n        color: '#ffcc33',\n        width: 2\n      })\n    });\n    this.vectorLayer = new VectorLayer({\n      source,\n      style\n    });\n\n    this.interaction = new olInteractionDraw({\n      type: 'LineString',\n      features: this.features\n    });\n    this.storeLineChangeFn = (line: OlGeomLineString | null) => (this.state.lidar.line = line);\n    this.storeDrawActiveFn = (active: boolean) => (this.state.lidar.drawActive = active);\n  }\n\n  /**\n   * The line to set. Pass `null` to clear the line.\n   */\n  setLine(line: OlGeomLineString | null) {\n    line ? this.storeLineChangeFn(line) : this.clear();\n  }\n\n  /**\n   * Sets the map and add a vector layer on it (if not existing).\n   */\n  setMap(map: OlMap) {\n    if (map) {\n      this.map = map;\n      const layer = this.map\n        .getLayers()\n        .getArray()\n        .find((layer) => layer === this.vectorLayer);\n      if (!layer) {\n        this.map.addLayer(this.vectorLayer);\n      }\n    }\n  }\n\n  /**\n   * Set the active state of this class and interactions.\n   */\n  setActive(active: boolean) {\n    this.storeDrawActiveFn(active);\n    if (active) {\n      this.map?.addInteraction(this.interaction);\n      this.interaction.setActive(true);\n      this.initInteraction();\n    } else {\n      this.map?.removeInteraction(this.interaction);\n      this.clear();\n    }\n  }\n\n  /**\n   * Init and mange the draw interaction.\n   */\n  initInteraction(): void {\n    // Clear the line as soon as a new drawing is started.\n    this.interaction.on('drawstart', () => {\n      this.features.clear();\n    });\n\n    // Update the profile with the new geometry.\n    this.interaction.on('drawend', (event: DrawEvent) => {\n      this.setLine((event.feature as OlFeature<OlGeomLineString>).getGeometry() ?? null);\n      setTimeout(() => {\n        // using timeout to prevent double click to zoom the map\n        this.interaction.setActive(false);\n        this.storeDrawActiveFn(false);\n      }, 0);\n    });\n  }\n\n  /**\n   * Clear the line.\n   */\n  clear(): void {\n    this.features.clear();\n    this.storeLineChangeFn(null);\n  }\n}\n","// Helper file to select the DOM Html Element.\n\nexport const getLidarProfileContainer = (): HTMLElement | null | undefined => {\n  return document.querySelector('#lidar-footer')?.shadowRoot?.querySelector('#gmf-lidarprofile-container');\n};\nexport const getLidarProfileCanvas = (): HTMLElement | null | undefined => {\n  return getLidarProfileContainer()?.querySelector('.lidar-canvas');\n};\nexport const getLidarProfileSvg = (): HTMLElement | null | undefined => {\n  return getLidarProfileContainer()?.querySelector('svg.lidar-svg');\n};\nexport const getLidarProfileError = (): HTMLElement | null | undefined => {\n  return getLidarProfileContainer()?.querySelector('.lidar-error');\n};\nexport const getLidarProfileLodInfo = (): HTMLElement | null | undefined => {\n  return getLidarProfileContainer()?.querySelector('.lod-info');\n};\nexport const getLidarProfileWidthInfo = (): HTMLElement | null | undefined => {\n  return getLidarProfileContainer()?.querySelector('.width-info');\n};\n","import olFeature from 'ol/Feature';\nimport olGeomLineString from 'ol/geom/LineString';\nimport olGeomPoint from 'ol/geom/Point';\nimport olStyleFill from 'ol/style/Fill';\nimport olStyleRegularShape from 'ol/style/RegularShape';\nimport olStyleStroke from 'ol/style/Stroke';\nimport olStyleStyle from 'ol/style/Style';\nimport { saveAs } from 'file-saver';\nimport { type BaseType, select as d3select } from 'd3';\nimport type { Coordinate as OlCoordinateCoordinate } from 'ol/coordinate';\nimport type {\n  LidarProfileClientConfig,\n  LidarProfileServerConfigClassifications,\n  LidarProfileServerConfigLevels\n} from './profileconfig';\nimport I18nManager from '../../../tools/i18n/i18nmanager';\nimport { getLidarProfileCanvas, getLidarProfileSvg } from './domselector';\nimport { Buffer } from 'buffer';\n\n/**\n * The object containing all points in profile\n */\nexport type LidarProfilePoints = {\n  distance?: number[];\n  altitude?: number[];\n  color_packed?: number[][];\n  intensity?: number[];\n  classification?: number[];\n  coords?: number[][];\n};\n\n/**\n * Profile point after measure or after parsing of the binary array returned by Pytree\n */\nexport type LidarPoint = {\n  cx?: number;\n  cy?: number;\n  distance?: number;\n  altitude?: number;\n  color_packed?: number[];\n  coords?: number[];\n  intensity?: number;\n  classification?: number;\n  set?: boolean;\n};\n\ntype ClippedLine = {\n  bufferGeom: olFeature<olGeomLineString>;\n  bufferStyle: olStyleStyle[];\n  clippedLine: OlCoordinateCoordinate[];\n  distanceOffset: number;\n};\n\ntype NiceLOD = {\n  maxLOD: number;\n  width: number;\n};\n\nexport default class {\n  /**\n   * Clip a linestring with start and end measure given by D3 Chart domain\n   *\n   * @param linestring an OpenLayers Linestring\n   * @param dLeft domain minimum\n   * @param dRight domain maximum\n   * @returns Object with clipped lined coordinates and left domain value\n   */\n  clipLineByMeasure(linestring: olGeomLineString, dLeft: number, dRight: number): ClippedLine {\n    const clippedLine = new olGeomLineString([]);\n    let mileage_start = 0;\n    let mileage_end = 0;\n\n    const totalLength = linestring.getLength();\n    const fractionStart = dLeft / totalLength;\n    const fractionEnd = dRight / totalLength;\n\n    let segNumber = linestring.getCoordinates().length - 1;\n    let counter = 0;\n\n    linestring.forEachSegment((segStart, segEnd) => {\n      counter += 1;\n      const segLine = new olGeomLineString([segStart, segEnd]);\n      mileage_end += segLine.getLength();\n\n      if (dLeft == mileage_start) {\n        clippedLine.appendCoordinate(segStart);\n      } else if (dLeft > mileage_start && dLeft < mileage_end) {\n        clippedLine.appendCoordinate(linestring.getCoordinateAt(fractionStart));\n      }\n\n      if (mileage_start > dLeft && mileage_start < dRight) {\n        clippedLine.appendCoordinate(segStart);\n      }\n\n      if (dRight == mileage_end) {\n        clippedLine.appendCoordinate(segEnd);\n      } else if (dRight > mileage_start && dRight < mileage_end) {\n        clippedLine.appendCoordinate(linestring.getCoordinateAt(fractionEnd));\n      } else if (dRight > mileage_start && dRight > mileage_end && counter === segNumber) {\n        clippedLine.appendCoordinate(linestring.getCoordinateAt(fractionEnd));\n      }\n\n      mileage_start += segLine.getLength();\n    });\n\n    const feat = /** @type {olFeature<olGeomLineString>} */ new olFeature({\n      geometry: clippedLine\n    });\n\n    const lineStyle = new olStyleStyle({\n      stroke: new olStyleStroke({\n        color: 'rgba(255,0,0,1)',\n        width: 2,\n        lineCap: 'square'\n      })\n    });\n\n    let firstSegmentAngle = 0;\n    let lastSegementAngle = 0;\n\n    segNumber = clippedLine.getCoordinates().length - 1;\n    let segCounter = 1;\n\n    clippedLine.forEachSegment((start, end) => {\n      if (segCounter == 1) {\n        const dx = end[0] - start[0];\n        const dy = end[1] - start[1];\n        firstSegmentAngle = Math.atan2(dx, dy);\n      }\n\n      if (segCounter == segNumber) {\n        const dx = end[0] - start[0];\n        const dy = end[1] - start[1];\n\n        lastSegementAngle = Math.atan2(dx, dy);\n      }\n      segCounter += 1;\n    });\n\n    const styles = [lineStyle];\n    const lineEnd = clippedLine.getLastCoordinate();\n    const lineStart = clippedLine.getFirstCoordinate();\n\n    styles.push(\n      new olStyleStyle({\n        geometry: new olGeomPoint(lineStart),\n        image: new olStyleRegularShape({\n          fill: new olStyleFill({\n            color: 'rgba(255, 0, 0, 1)'\n          }),\n          stroke: new olStyleStroke({\n            color: 'rgba(255,0,0,1)',\n            width: 1,\n            lineCap: 'square'\n          }),\n          points: 3,\n          radius: 5,\n          rotation: firstSegmentAngle,\n          angle: Math.PI / 3\n        })\n      }),\n      new olStyleStyle({\n        geometry: new olGeomPoint(lineEnd),\n        image: new olStyleRegularShape({\n          fill: new olStyleFill({\n            color: 'rgba(255, 0, 0, 1)'\n          }),\n          stroke: new olStyleStroke({\n            color: 'rgba(255,0,0,1)',\n            width: 1,\n            lineCap: 'square'\n          }),\n          points: 3,\n          radius: 5,\n          rotation: lastSegementAngle,\n          angle: (4 * Math.PI) / 3\n        })\n      })\n    );\n\n    return {\n      clippedLine: clippedLine.getCoordinates(),\n      distanceOffset: dLeft,\n      bufferGeom: feat,\n      bufferStyle: styles\n    };\n  }\n\n  /**\n   * Get a Level Of Details and with for a given chart span\n   * Configuration is set up in Pytree configuration\n   * @param span domain extent\n   * @param max_levels levels defined by a LIDAR server\n   * @returns Object with optimized Level Of Details and width for this profile span\n   */\n  getNiceLOD(span: number, max_levels: LidarProfileServerConfigLevels): NiceLOD {\n    let maxLOD = 0;\n    let width = 0;\n    for (const key in max_levels) {\n      const level = parseInt(key, 10);\n      const max = max_levels[level].max ?? 0;\n      if (span < level && max > maxLOD) {\n        maxLOD = max;\n        width = max_levels[level].width ?? 0;\n      }\n    }\n    return {\n      maxLOD,\n      width\n    };\n  }\n\n  /**\n   * Create a image file by combining SVG and canvas elements and let the user downloads it.\n   *\n   * @param profileClientConfig The profile client configuration.\n   */\n  downloadProfileAsImageFile(profileClientConfig: LidarProfileClientConfig): void {\n    const profileSVG = d3select(getLidarProfileSvg() as BaseType);\n    const w = parseInt(profileSVG.attr('width'), 10);\n    const h = parseInt(profileSVG.attr('height'), 10);\n    const margin = profileClientConfig.margin;\n\n    // Create a new canvas element to avoid manipulate the one with profile.\n    const canvas = document.createElement('canvas');\n    canvas.style.display = 'none';\n    canvas.width = w;\n    canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    if (!ctx) {\n      throw new Error('Missing ctx');\n    }\n    ctx.fillStyle = 'white';\n    ctx.fillRect(0, 0, w, h);\n\n    // Draw the profile canvas (the points) into the new canvas.\n    const profileCanvas = d3select(getLidarProfileCanvas() as BaseType);\n    const profileCanvasEl = profileCanvas.node();\n    ctx.drawImage(profileCanvasEl as CanvasImageSource, margin?.left ?? 0, margin?.top ?? 0);\n\n    // Add transforms the profile into an image.\n    const exportImage = new Image();\n    const serializer = new XMLSerializer();\n    const profileSVGEl =\n      /**\n       * @type {HTMLElement}\n       */ profileSVG.node();\n    const svgStr = serializer.serializeToString(profileSVGEl as Node);\n\n    // Draw the image of the profile into the context of the new canvas.\n    const img_id = 'lidare_profile_for_export_uid';\n    exportImage.id = img_id;\n    const buffer = Buffer.from(svgStr);\n    exportImage.src = `data:image/svg+xml;base64, ${buffer.toString('base64')}`;\n    exportImage.style.setProperty('display', 'none');\n    const body = document.getElementsByTagName('body')[0];\n    // The image must be loaded to be drawn.\n    exportImage.onload = () => {\n      ctx.drawImage(exportImage, 0, 0, w, h);\n      const elImg = document.getElementById(img_id);\n      if (!elImg) {\n        throw new Error('Missing elImg');\n      }\n      body.removeChild(elImg);\n      // Let the user download the image.\n      canvas.toBlob((blob) => {\n        if (!blob) {\n          window.alert(I18nManager.getInstance().getTranslation('No graph to export in PNG!'));\n          return;\n        }\n        saveAs(blob, 'LIDAR_profile.png');\n      });\n    };\n    body.appendChild(exportImage);\n  }\n\n  /**\n   * Transforms a lidarProfile into multiple single points sorted by distance.\n   *\n   * @param points in the profile\n   * @returns An array of LIDAR Points.\n   */\n  getFlatPointsByDistance(points: LidarProfilePoints): LidarPoint[] {\n    const allPoints = [];\n    const pDistance = points.distance ?? [];\n    const pAltitude = points.altitude ?? [];\n    const pColorPacked = points.color_packed ?? [];\n    const pIntensity = points.intensity ?? [];\n    const pClassification = points.classification ?? [];\n    const pCoords = points.coords ?? [];\n    for (let i = 0; i < pDistance.length; i++) {\n      const p = {\n        distance: pDistance[i],\n        altitude: pAltitude[i],\n        color_packed: pColorPacked[i],\n        intensity: pIntensity[i],\n        classification: pClassification[i],\n        coords: pCoords[i]\n      };\n      allPoints.push(p);\n    }\n    allPoints.sort((a, b) => a.distance - b.distance);\n    return allPoints;\n  }\n\n  /**\n   * Get the data for a CSV export of the profile.\n   *\n   * @param points A list of lidar profile point objects.\n   * @returns Objects for a csv export (column: value).\n   */\n  getCSVData(points: LidarPoint[]): { [key: string]: string | number }[] {\n    return points.map((point: LidarPoint) => {\n      const row: { [key: string]: string | number } = {};\n      Object.keys(point).forEach((key) => {\n        if (key === 'altitude') {\n          const value = point?.altitude;\n          row[key] = value ? value.toFixed(4) : NaN;\n        } else if (key === 'color_packed') {\n          row[key] = (point.color_packed ?? []).join(' ');\n        } else if (key === 'coords') {\n          row[key] = (point.coords ?? []).join(' ');\n        } else {\n          row[key] = (point as Record<string, number | string>)[key];\n        }\n      });\n      return row;\n    });\n  }\n\n  /**\n   * Find the maximum value in an array of numbers\n   *\n   * @param array of number\n   * @returns the maximum of input array\n   */\n  arrayMax(array: number[]): number {\n    return array.reduce((a, b) => Math.max(a, b), 0);\n  }\n\n  /**\n   * Find the minimum value in am array of numbers\n   *\n   * @param array of number\n   * @returns the minimum of input array\n   */\n  arrayMin(array: number[]): number {\n    let minVal = Infinity;\n    for (const element of array) {\n      if (element < minVal) {\n        minVal = element;\n      }\n    }\n    return minVal;\n  }\n\n  /**\n   * Transform OpenLayers linestring into a cPotree compatible definition\n   *\n   * @param line the profile 2D line\n   * @returns linestring in a cPotree/pytree compatible string definition\n   */\n  getPytreeLinestring(line: olGeomLineString): string {\n    const coords = line.getCoordinates();\n    let pytreeLineString = '';\n    for (const coord of coords) {\n      const px = coord[0];\n      const py = coord[1];\n      pytreeLineString += `{${Math.round(100 * px) / 100}, ${Math.round(100 * py) / 100}},`;\n    }\n    return pytreeLineString.substring(0, pytreeLineString.length - 1);\n  }\n\n  /**\n   * Find the profile's closest point in profile data to the chart mouse position\n   *\n   * @param points Object containing points properties as arrays\n   * @param xs mouse x coordinate on canvas element\n   * @param ys mouse y coordinate on canvas element\n   * @param tolerance snap sensibility\n   * @param sx d3.scalelinear x scale\n   * @param sy d3.scalelinear y scale\n   * @param classification_colors\n   *    classification colors\n   * @returns closestPoint the closest point to the clicked coordinates\n   */\n  getClosestPoint(\n    points: LidarProfilePoints,\n    xs: number,\n    ys: number,\n    tolerance: number,\n    sx: d3.ScaleLinear<number, number>,\n    sy: d3.ScaleLinear<number, number>,\n    classification_colors: LidarProfileServerConfigClassifications\n  ): undefined | LidarPoint {\n    const tol = tolerance;\n    const allDistances = [];\n    const hP = [];\n    const pDistance = points.distance ?? [];\n    const pAltitude = points.altitude ?? [];\n    const pColorPacked = points.color_packed ?? [];\n    const pIntensity = points.intensity ?? [];\n    const pClassification = points.classification ?? [];\n    const pCoords = points.coords ?? [];\n\n    for (let i = 0; i < pDistance.length; i++) {\n      if (\n        sx(pDistance[i]) < xs + tol &&\n        sx(pDistance[i]) > xs - tol &&\n        sy(pAltitude[i]) < ys + tol &&\n        sy(pAltitude[i]) > ys - tol\n      ) {\n        const distance = Math.sqrt(Math.pow(sx(pDistance[i]) - xs, 2) + Math.pow(sy(pAltitude[i]) - ys, 2));\n        const classification = classification_colors[pClassification[i]];\n        if (classification && classification.visible == 1) {\n          hP.push({\n            distance: pDistance[i],\n            altitude: pAltitude[i],\n            classification: pClassification[i],\n            color_packed: pColorPacked[i],\n            intensity: pIntensity[i],\n            coords: pCoords[i]\n          });\n          allDistances.push(distance);\n        }\n      }\n    }\n\n    let closestPoint = null;\n\n    if (hP.length > 0) {\n      const minDist = Math.min(...allDistances);\n      const indexMin = allDistances.indexOf(minDist);\n      if (indexMin != -1) {\n        closestPoint = hP[indexMin];\n      } else {\n        closestPoint = hP[0];\n      }\n    }\n    return closestPoint ?? undefined;\n  }\n}\n","import olFeature from 'ol/Feature';\nimport olGeomPoint from 'ol/geom/Point';\nimport olStyleCircle from 'ol/style/Circle';\nimport olStyleFill from 'ol/style/Fill';\nimport olStyleStyle from 'ol/style/Style';\nimport {\n  axisBottom as d3axisBottom,\n  axisLeft as d3axisLeft,\n  scaleLinear as d3scaleLinear,\n  pointer as d3pointer,\n  select as d3select,\n  zoom as d3zoom,\n  type BaseType,\n  type D3ZoomEvent\n} from 'd3';\n\nimport { LidarProfileManager } from './manager';\nimport { LidarProfilePoints, LidarPoint } from './utils';\nimport { LidarProfileServerConfigClassification, LidarProfileServerConfigClassifications } from './profileconfig';\nimport I18nManager from '../../../tools/i18n/i18nmanager';\nimport { getLidarProfileCanvas, getLidarProfileContainer, getLidarProfileSvg } from './domselector';\n\nexport default class {\n  /**\n   * d3.scaleLinear X scale.\n   */\n  scaleX: d3.ScaleLinear<number, number> | null;\n\n  /**\n   * d3.scaleLinear X scale.\n   */\n  updateScaleX: d3.ScaleLinear<number, number>;\n\n  /**\n   * d3.scaleLinear Y scale.\n   */\n  scaleY: d3.ScaleLinear<number, number> | null;\n\n  /**\n   * d3.scaleLinear Y scale.\n   */\n  updateScaleY: d3.ScaleLinear<number, number>;\n\n  /**\n   * The material used for the drawing process. Initialized in the setup\n   */\n  material: string | null;\n\n  previousDomainX: number[];\n\n  private manager: LidarProfileManager;\n  private width: number;\n  private height: number;\n  private moved: boolean;\n  private i18nManager: I18nManager;\n\n  /**\n   * Provides a service to create an SVG element with defined axis and a LIDAR\n   * point drawing mechanism.\n   *\n   * @param LidarProfileManagerInstance\n   *    gmf lidar profile manager instance\n   */\n  constructor(LidarProfileManagerInstance: LidarProfileManager) {\n    this.i18nManager = I18nManager.getInstance();\n    this.manager = LidarProfileManagerInstance;\n\n    /**\n     * d3.scaleLinear X scale.\n     */\n    this.scaleX = null;\n\n    /**\n     * d3.scaleLinear X scale.\n     *\n     * @param x .\n     * @returns x .\n     */\n    // @ts-expect-error TODO SMS: Check this when extending the functionalities of the LIDAR component\n    this.updateScaleX = (x: number) => x;\n\n    /**\n     * d3.scaleLinear Y scale.\n     */\n    this.scaleY = null;\n\n    /**\n     * d3.scaleLinear Y scale.\n     *\n     * @param y .\n     * @returns y .\n     */\n    // @ts-expect-error TODO SMS: Check this when extending the functionalities of the LIDAR component\n    this.updateScaleY = (y) => y;\n\n    /**\n     * The material used for the drawing process. Initialized in the setup\n     */\n    this.material = null;\n    this.width = 0;\n    this.height = 0;\n    this.previousDomainX = [];\n    this.moved = false;\n  }\n\n  /**\n   * Draw the points to the canvas element\n   *\n   * @param points of the profile\n   */\n  drawPoints(points: LidarProfilePoints): void {\n    if (!this.manager.config) {\n      throw new Error('Missing manager.config');\n    }\n    if (!this.manager.config.serverConfig) {\n      throw new Error('Missing manager_.config.serverConfig');\n    }\n    let i = -1;\n    const nPoints = points.distance?.length ?? 0;\n    let cx, cy;\n    const canvas = d3select(getLidarProfileCanvas() as BaseType);\n    const canvasEl = canvas?.node() as HTMLCanvasElement | undefined;\n    const ctx = canvasEl?.getContext('2d');\n    if (!ctx) {\n      throw new Error('Missing ctx');\n    }\n    const profileServerConfig = this.manager.config.serverConfig;\n\n    const pDistance = points.distance ?? [];\n    const pAltitude = points.altitude ?? [];\n    const pColorPacked = points.color_packed ?? [];\n    const pIntensity = points.intensity ?? [];\n    const pClassification = points.classification ?? [];\n\n    while (++i < nPoints) {\n      const distance = pDistance[i];\n      const altitude = pAltitude[i];\n      const rgb = pColorPacked[i];\n      const intensity = pIntensity[i];\n      const classification = pClassification[i];\n      if (profileServerConfig?.classification_colors?.[classification]?.visible) {\n        cx = this.updateScaleX(distance);\n        cy = this.updateScaleY(altitude);\n\n        ctx.beginPath();\n        ctx.moveTo(cx, cy);\n\n        if (this.material == 'COLOR_PACKED') {\n          ctx.fillStyle = `RGB(${rgb[0]}, ${rgb[1]}, ${rgb[2]})`;\n        } else if (this.material == 'INTENSITY') {\n          ctx.fillStyle = `RGB(${intensity}, ${intensity}, ${intensity})`;\n        } else if (this.material == 'CLASSIFICATION') {\n          ctx.fillStyle = `RGB(${profileServerConfig.classification_colors[classification].color})`;\n        } else {\n          ctx.fillStyle = profileServerConfig.default_color ?? '';\n        }\n        ctx.arc(cx, cy, profileServerConfig.point_size ?? 0, 0, 2 * Math.PI, false);\n        ctx.fill();\n      }\n    }\n  }\n\n  /**\n   * Setup the SVG components of the D3 chart\n   *\n   * @param rangeX range of the x scale\n   * @param rangeY range of the y scale\n   */\n  setupPlot(rangeX: number[], rangeY: number[]): void {\n    if (!this.manager.config) {\n      throw new Error('Missing manager.config');\n    }\n    if (!this.manager.config.serverConfig) {\n      throw new Error('Missing manager_.config.serverConfig');\n    }\n    const canvas = d3select(getLidarProfileCanvas() as BaseType);\n    const canvasEl: HTMLCanvasElement | undefined = canvas?.node() as HTMLCanvasElement | undefined;\n    const ctx = canvasEl?.getContext('2d');\n    if (!ctx || !canvasEl) {\n      throw new Error('Missing ctx or canvas element');\n    }\n    ctx.clearRect(0, 0, canvasEl.getBoundingClientRect().width, canvasEl.getBoundingClientRect().height);\n\n    const margin = this.manager.config.clientConfig.margin;\n    const element = getLidarProfileContainer();\n    const container = d3select(element as BaseType);\n    const containerEl = container?.node() as HTMLCanvasElement | undefined;\n    const containerWidth = containerEl?.getBoundingClientRect().width ?? 0;\n    const containerHeight = containerEl?.getBoundingClientRect().height ?? 0;\n    this.width = containerWidth - (margin.left + margin.right);\n    this.height = containerHeight - (margin.top + margin.bottom);\n\n    this.material = this.manager.config.serverConfig.default_attribute ?? '';\n\n    canvas\n      .attr('height', this.height)\n      .attr('width', this.width)\n      .style('background-color', 'black')\n      .style('z-index', 0)\n      .style('position', 'absolute')\n      .style('margin-left', `${margin.left.toString()}px`)\n      .style('margin-top', `${margin.top.toString()}px`);\n\n    const domainProfileWidth = rangeX[1] - rangeX[0];\n    const domainProfileHeight = rangeY[1] - rangeY[0];\n    const domainRatio = domainProfileWidth / domainProfileHeight;\n    const rangeProfileWidth = this.width;\n    const rangeProfileHeight = this.height;\n    const rangeRatio = rangeProfileWidth / rangeProfileHeight;\n\n    let domainScale;\n    if (domainRatio < rangeRatio) {\n      const domainScale = rangeRatio / domainRatio;\n      const domainScaledWidth = domainProfileWidth * domainScale;\n      this.scaleX = d3scaleLinear();\n      this.scaleX.domain([0, domainScaledWidth]);\n      this.scaleX.range([0, this.width]);\n      this.scaleY = d3scaleLinear();\n      this.scaleY.domain(rangeY);\n      this.scaleY.range([this.height, 0]);\n    } else {\n      domainScale = domainRatio / rangeRatio;\n      const domainScaledHeight = domainProfileHeight * domainScale;\n      const domainHeightCentroid = (rangeY[1] + rangeY[0]) / 2;\n      this.scaleX = d3scaleLinear();\n      this.scaleX.domain(rangeX);\n      this.scaleX.range([0, this.width]);\n      this.scaleY = d3scaleLinear();\n      this.scaleY.domain([\n        domainHeightCentroid - domainScaledHeight / 2,\n        domainHeightCentroid + domainScaledHeight / 2\n      ]);\n      this.scaleY.range([this.height, 0]);\n    }\n\n    const zoom = d3zoom()\n      .scaleExtent([-10, 100])\n      .translateExtent([\n        [0, 0],\n        [this.width, this.height]\n      ])\n      .extent([\n        [0, 0],\n        [this.width, this.height]\n      ])\n      .on('zoom', (event) => this.zoomed(event));\n\n    zoom.on('end', (event) => this.zoomEnd(event));\n\n    this.previousDomainX = this.scaleX.domain();\n    this.updateScaleX = this.scaleX;\n    this.updateScaleY = this.scaleY;\n\n    const svg = d3select(getLidarProfileSvg() as BaseType);\n\n    // @ts-expect-error TODO SMS: Check this when extending the functionalities of the LIDAR component\n    svg.call(zoom).on('dblclick.zoom', null);\n\n    svg.selectAll('*').remove();\n\n    // eslint-disable-next-line @typescript-eslint/restrict-plus-operands\n    svg.attr('width', this.width + margin.left).attr('height', this.height + margin.top + margin.bottom);\n\n    svg.on('mousemove', (event: MouseEvent) => {\n      this.pointHighlight(event);\n    });\n\n    const xAxis = d3axisBottom(this.scaleX);\n    const yAxis = d3axisLeft(this.scaleY).tickSize(-this.width);\n\n    svg.select('.y.axis').selectAll('g.tick line').style('stroke', '#b7cff7');\n    svg.append('g').attr('class', 'y axis').call(yAxis);\n    svg.append('g').attr('class', 'x axis').call(xAxis);\n    svg.select('.y.axis').attr('transform', `translate(${margin.left}, ${margin.top})`);\n    svg.select('.x.axis').attr('transform', `translate(${margin.left}, ${this.height + margin.top})`);\n    svg.select('.y.axis').selectAll('g.tick line').style('opacity', '0.5').style('stroke', '#b7cff7');\n  }\n\n  /**\n   * Update the plot data at the end of the zoom process\n   *\n   * @param event Event .\n   */\n  zoomEnd(event: D3ZoomEvent<Element, unknown>): void {\n    if (event.sourceEvent && this.moved === false) {\n      this.manager.updateData();\n      return;\n    }\n    this.moved = false;\n    const element = getLidarProfileCanvas();\n    const canvas = d3select(element as BaseType);\n    const canvasEl = canvas?.node() as HTMLCanvasElement | undefined;\n    const ctx = canvasEl?.getContext('2d');\n    if (!ctx) {\n      throw new Error('Missing ctx');\n    }\n    ctx.clearRect(0, 0, this.width, this.height);\n    this.manager.updateData();\n  }\n\n  /**\n   * Update the plot axis during the zoom process\n   *\n   * @param event Event .\n   */\n  zoomed(event: D3ZoomEvent<Element, unknown>): void {\n    if (!this.manager.measure) {\n      throw new Error('Missing manager.measure');\n    }\n    if (!this.scaleX) {\n      throw new Error('Missing scaleX');\n    }\n    if (!this.scaleY) {\n      throw new Error('Missing scaleY');\n    }\n    if (event.sourceEvent && event.sourceEvent.type === 'mousemove') {\n      this.moved = true;\n      if (event.sourceEvent.movementX == 0 && event.sourceEvent.movementY == 0) {\n        return;\n      }\n    }\n\n    this.manager.measure.clearMeasure();\n\n    const tr = event.transform;\n    const svg = d3select(getLidarProfileSvg() as BaseType);\n    const xAxis = d3axisBottom(this.scaleX);\n    const yAxis = d3axisLeft(this.scaleY).tickSize(-this.width);\n\n    const newScaleX = tr.rescaleX(this.scaleX);\n    const newScaleY = tr.rescaleY(this.scaleY);\n\n    const xSelect = svg.select('.x.axis');\n    const ySelect = svg.select('.y.axis');\n    // @ts-expect-error TODO SMS: Check this when extending the functionalities of the LIDAR component\n    xSelect.call(xAxis.scale(newScaleX));\n    // @ts-expect-error TODO SMS: Check this when extending the functionalities of the LIDAR component\n    ySelect.call(yAxis.scale(newScaleY));\n\n    const canvas = d3select(getLidarProfileCanvas() as BaseType);\n    const canvasEl = canvas?.node() as HTMLCanvasElement | undefined;\n    const ctx = canvasEl?.getContext('2d');\n    if (!ctx) {\n      throw new Error('Missing ctx');\n    }\n    ctx.clearRect(0, 0, this.width, this.height);\n\n    svg.select('.y.axis').selectAll('g.tick line').style('opacity', '0.5').style('stroke', '#b7cff7');\n\n    this.updateScaleX = newScaleX;\n    this.updateScaleY = newScaleY;\n  }\n\n  /**\n   * Update the OpenLayers overlay that displays point position and attributes values\n   *\n   * @param event Event .\n   */\n  pointHighlight(event: MouseEvent): void {\n    if (!this.manager.config) {\n      throw new Error('Missing manager.config');\n    }\n    if (!this.manager.config.serverConfig) {\n      throw new Error('Missing manager_.config.serverConfig');\n    }\n\n    const lidarContainerElement = getLidarProfileContainer();\n    if (!lidarContainerElement) {\n      console.error('No container element.');\n      return;\n    }\n    const svg = d3select(lidarContainerElement.querySelector('svg.lidar-svg'));\n    const lidarInfo = d3select(lidarContainerElement.querySelector('.lidar-info'));\n    const pointSize = this.manager.config.serverConfig.point_size ?? 0;\n    const margin = this.manager.config.clientConfig.margin;\n    const tolerance = this.manager.config.clientConfig.tolerance ?? 0;\n\n    const canvas = d3select(lidarContainerElement.querySelector('.lidar-canvas'));\n    const canvasEl = canvas.node();\n    const canvasCoordinates = d3pointer(event, canvasEl);\n    const classification_colors = this.manager.config.serverConfig.classification_colors ?? [];\n\n    let cx, cy;\n    const p = this.manager.utils.getClosestPoint(\n      this.manager.profilePoints,\n      canvasCoordinates[0],\n      canvasCoordinates[1],\n      tolerance,\n      this.updateScaleX,\n      this.updateScaleY,\n      classification_colors\n    );\n\n    const source = this.manager.lidarPointHighlight.getSource();\n    if (p != undefined) {\n      // eslint-disable-next-line @typescript-eslint/restrict-plus-operands\n      cx = this.updateScaleX(p?.distance ?? 0) + margin.left;\n      // eslint-disable-next-line @typescript-eslint/restrict-plus-operands\n      cy = this.updateScaleY(p?.altitude ?? 0) + margin.top;\n\n      svg.selectAll('#highlightCircle').remove();\n\n      svg\n        .append('circle')\n        .attr('id', 'highlightCircle')\n        .attr('cx', cx)\n        .attr('cy', cy)\n        // eslint-disable-next-line @typescript-eslint/restrict-plus-operands\n        .attr('r', pointSize + 1)\n        .style('fill', 'orange');\n\n      const pClassification = p.classification ?? -1;\n      const pointClassification = classification_colors[pClassification] || {};\n\n      const html = this.getInfoHTML(p, pointClassification, 1);\n\n      lidarInfo.html(html);\n      this.manager.cartoHighlight.setElement(undefined);\n      const el = document.createElement('div');\n      el.className += 'tooltip gmf-tooltip-measure';\n      el.innerHTML = html;\n\n      const coords = p.coords ?? [];\n      this.manager.cartoHighlight.setElement(el);\n      this.manager.cartoHighlight.setPosition([coords[0], coords[1]]);\n      source?.clear();\n      const lidarPointGeom = new olGeomPoint([coords[0], coords[1]]);\n      const lidarPointFeature = new olFeature(lidarPointGeom);\n      if (pointClassification.color !== undefined) {\n        lidarPointFeature.setStyle(\n          new olStyleStyle({\n            image: new olStyleCircle({\n              fill: new olStyleFill({\n                color: `rgba(${pointClassification.color}, 1)`\n              }),\n              radius: 3\n            })\n          })\n        );\n      }\n\n      source?.addFeature(lidarPointFeature);\n    } else {\n      source?.clear();\n      svg.select('#highlightCircle').remove();\n      lidarInfo.html('');\n      this.manager.cartoHighlight.setPosition(undefined);\n    }\n  }\n\n  /**\n   * @param point the concerned point.\n   * @param classification_color\n   *    the classification object concerning this point.\n   * @param distDecimal the number of decimal to keep.\n   * @returns the text for the html info.\n   */\n  getInfoHTML(\n    point: LidarPoint,\n    classification_color: LidarProfileServerConfigClassification,\n    distDecimal: number\n  ): string {\n    const html = [];\n    const distance = point.distance;\n    const altitude = point.altitude;\n    const classification = this.i18nManager.getTranslation(classification_color.name ?? '');\n    const intensity = point.intensity;\n\n    if (distance !== undefined) {\n      const distanceTxt = this.i18nManager.getTranslation('Distance: ');\n      // eslint-disable-next-line @typescript-eslint/restrict-plus-operands\n      html.push(`${distanceTxt + this.formatDecimals(distance, distDecimal)}`);\n    }\n    if (altitude !== undefined) {\n      const altitudeTxt = this.i18nManager.getTranslation('Altitude: ');\n      // eslint-disable-next-line @typescript-eslint/restrict-plus-operands\n      html.push(`${altitudeTxt + this.formatDecimals(altitude, distDecimal)}`);\n    }\n    if (classification.length > 0) {\n      const classificationTxt = this.i18nManager.getTranslation('Classification: ');\n      // eslint-disable-next-line @typescript-eslint/restrict-plus-operands\n      html.push(`${classificationTxt + classification}`);\n    }\n    if (intensity !== undefined) {\n      const intensityTxt = this.i18nManager.getTranslation('Intensity: ');\n      // eslint-disable-next-line @typescript-eslint/restrict-plus-operands\n      html.push(`${intensityTxt + this.formatDecimals(intensity, 0)}`);\n    }\n\n    return html.join('</br>');\n  }\n\n  formatDecimals(num: number, decimals: number): number {\n    return Number((Math.round(num * 100) / 100).toFixed(decimals));\n  }\n\n  /**\n   * Change the profile style according to the material color\n   *\n   * @param material value as defined in Pytree attribute configuration\n   */\n  changeStyle(material: string): void {\n    this.material = material;\n    const canvas = d3select(getLidarProfileCanvas() as BaseType);\n    const canvasEl = canvas?.node() as HTMLCanvasElement | undefined;\n    const ctx = canvasEl?.getContext('2d');\n    if (!ctx || !canvasEl) {\n      throw new Error('Missing ctx or canvas element.');\n    }\n    ctx.clearRect(0, 0, canvasEl.width, canvasEl.height);\n    this.drawPoints(this.manager.profilePoints);\n  }\n\n  /**\n   * Show/Hide classes in the profile\n   *\n   * @param classification\n   *   value as defined in the Pytree classification_colors configuration\n   * @param material  value as defined in Pytree attribute configuration\n   */\n  setClassActive(classification: LidarProfileServerConfigClassifications, material: string): void {\n    if (!this.manager.config) {\n      throw new Error('Missing manager.config');\n    }\n    if (!this.manager.config.serverConfig) {\n      throw new Error('Missing manager_.config.serverConfig');\n    }\n    this.manager.config.serverConfig.classification_colors = classification;\n    this.changeStyle(material);\n  }\n}\n","import { type BaseType, pointer as d3pointer, select as d3select } from 'd3';\n\nimport type { LidarProfileManager } from './manager';\nimport type { LidarPoint } from './utils';\nimport { getLidarProfileCanvas, getLidarProfileSvg } from './domselector';\n\nexport default class {\n  private manager: LidarProfileManager;\n  private pStart: LidarPoint;\n  private pEnd: LidarPoint;\n\n  /**\n   * Measure tool for the d3 chart\n   */\n  constructor(lidarProfileManagerInstance: LidarProfileManager) {\n    this.manager = lidarProfileManagerInstance;\n    this.pStart = {};\n    this.pEnd = {};\n  }\n\n  /**\n   * Clear the current measure\n   */\n  clearMeasure(): void {\n    this.pStart = {};\n    this.pEnd = {};\n\n    const svg = d3select(getLidarProfileSvg() as BaseType);\n    svg.selectAll('#text_m').remove();\n    svg.selectAll('#start_m').remove();\n    svg.selectAll('#end_m').remove();\n    svg.selectAll('#line_m').remove();\n    svg.on('click', null);\n    svg.style('cursor', 'default');\n  }\n\n  /**\n   * Activate the measure tool\n   */\n  setMeasureActive(): void {\n    const svg = d3select(getLidarProfileSvg() as BaseType);\n    svg.style('cursor', 'pointer');\n    svg.on('click', (event) => this.measureHeight(event));\n  }\n\n  /**\n   * Measure and display height after two click on the profile.\n   *\n   * @param event Event .\n   */\n  measureHeight(event: MouseEvent): void {\n    if (!this.manager.config) {\n      throw new Error('Missing manager.config');\n    }\n    if (!this.manager.plot) {\n      throw new Error('Missing manager.plot');\n    }\n    const svg = d3select(getLidarProfileSvg() as BaseType);\n    const svgEl = svg.node();\n    const canvas = d3select(getLidarProfileCanvas() as BaseType);\n    const canvasEl = canvas.node();\n\n    const svgCoordinates = d3pointer(event, svgEl);\n    const canvasCoordinates = d3pointer(event, canvasEl);\n    const margin = this.manager.config.clientConfig.margin;\n    const xs = svgCoordinates[0];\n    const ys = svgCoordinates[1];\n    const tolerance = 2;\n    const sx = this.manager.plot.updateScaleX;\n    const sy = this.manager.plot.updateScaleY;\n    const pointSize = 3;\n    if (!this.manager.config.serverConfig) {\n      throw new Error('Missing manager_.config.serverConfig');\n    }\n    const p = this.manager.utils.getClosestPoint(\n      this.manager.profilePoints,\n      canvasCoordinates[0],\n      canvasCoordinates[1],\n      tolerance,\n      this.manager.plot.updateScaleX,\n      this.manager.plot.updateScaleY,\n      this.manager.config.serverConfig.classification_colors ?? []\n    );\n\n    const invertedSx = sx.invert(xs);\n    const invertedSy = sy.invert(ys);\n\n    if (!this.pStart.set) {\n      if (p) {\n        this.pStart.distance = p.distance;\n        this.pStart.altitude = p.altitude;\n        this.pStart.cx = sx(p.distance ?? 0) + margin.left;\n        this.pStart.cy = sy(p.altitude ?? 0) + margin.top;\n      } else {\n        this.pStart.distance = invertedSx;\n        this.pStart.altitude = invertedSy;\n        this.pStart.cx = xs;\n        this.pStart.cy = ys;\n      }\n\n      this.pStart.set = true;\n      svg\n        .append('circle')\n        .attr('id', 'start_m')\n        .attr('cx', this.pStart.cx)\n        .attr('cy', this.pStart.cy)\n        .attr('r', pointSize)\n        .style('fill', 'red');\n    } else if (!this.pEnd.set) {\n      if (p) {\n        this.pEnd.distance = p.distance;\n        this.pEnd.altitude = p.altitude;\n        // eslint-disable-next-line @typescript-eslint/restrict-plus-operands\n        this.pEnd.cx = sx(p.distance ?? 0) + margin.left;\n        // eslint-disable-next-line @typescript-eslint/restrict-plus-operands\n        this.pEnd.cy = sy(p.altitude ?? 0) + margin.top;\n      } else {\n        this.pEnd.distance = invertedSx;\n        this.pEnd.altitude = invertedSy;\n        this.pEnd.cx = xs;\n        this.pEnd.cy = ys;\n      }\n\n      this.pEnd.set = true;\n      svg\n        .append('circle')\n        .attr('id', 'end_m')\n        .attr('cx', this.pEnd.cx)\n        .attr('cy', this.pEnd.cy)\n        .attr('r', pointSize)\n        .style('fill', 'red');\n\n      svg\n        .append('line')\n        .attr('id', 'line_m')\n        .attr('x1', this.pStart.cx ?? 0)\n        .attr('y1', this.pStart.cy ?? 0)\n        .attr('x2', this.pEnd.cx)\n        .attr('y2', this.pEnd.cy)\n        .attr('stroke-width', 2)\n        .attr('stroke', 'red');\n    }\n\n    if (this.pStart.set && this.pEnd.set) {\n      const dH = (this.pEnd.altitude ?? 0) - (this.pStart.altitude ?? 0);\n      const dD = (this.pEnd.distance ?? 0) - (this.pStart.distance ?? 0);\n\n      const height = Math.round(10 * Math.sqrt(Math.pow(dH, 2) + Math.pow(dD, 2))) / 10;\n\n      if (!isNaN(height)) {\n        svg\n          .append('text')\n          .attr('id', 'text_m')\n          .attr('x', 10 + ((this.pStart.cx ?? 0) + (this.pEnd.cx ?? 0)) / 2)\n          .attr('y', ((this.pStart.cy ?? 0) + (this.pEnd.cy ?? 0)) / 2)\n          .text(`${height} m`)\n          .attr('font-family', 'sans-serif')\n          .attr('font-size', '14px')\n          .style('font-weight', 'bold')\n          .attr('fill', 'red');\n      }\n      this.pEnd.set = false;\n      this.pStart.set = false;\n    }\n  }\n}\n","import type { LidarProfileConfig } from './profileconfig';\nimport type { LidarProfilePoints } from './utils';\nimport LidarProfileUtils from './utils';\nimport LidarProfilePlot from './plot';\nimport LidarProfileMeasure from './measure';\nimport { debounce } from '../../../tools/utils/debounce';\nimport I18nManager from '../../../tools/i18n/i18nmanager';\n\nimport olLayerVector from 'ol/layer/Vector';\nimport olOverlay from 'ol/Overlay';\nimport olSourceVector from 'ol/source/Vector';\nimport olStyleFill from 'ol/style/Fill';\nimport olStyleCircle from 'ol/style/Circle';\nimport olStyleStyle from 'ol/style/Style';\nimport { type BaseType, select as d3select } from 'd3';\n\nimport type OlMap from 'ol/Map';\nimport type OlOverlay from 'ol/Overlay';\nimport type OlLayerVector from 'ol/layer/Vector';\nimport type OlSourceVector from 'ol/source/Vector';\nimport type OlGeomGeometry from 'ol/geom/Geometry';\nimport type OlGeomLineString from 'ol/geom/LineString';\nimport type { Coordinate as OlCoordinateCoordinate } from 'ol/coordinate';\nimport type OlFeature from 'ol/Feature';\nimport {\n  getLidarProfileCanvas,\n  getLidarProfileError,\n  getLidarProfileLodInfo,\n  getLidarProfileWidthInfo\n} from './domselector';\n\nexport class LidarProfileManager {\n  plot: LidarProfilePlot | null;\n  measure: LidarProfileMeasure | null;\n  config: LidarProfileConfig | null;\n\n  /**\n   * The hovered point attributes in D3 profile highlighted on the 2D map\n   */\n  cartoHighlight: OlOverlay;\n\n  /**\n   * The hovered point geometry (point) in D3 profile highlighted on the 2D map\n   */\n  lidarPointHighlight: OlLayerVector<OlSourceVector<OlFeature>>;\n\n  /**\n   * The profile footpring represented as a LineString represented\n   * with real mapunites stroke width\n   */\n  lidarBuffer: OlLayerVector<OlSourceVector<OlFeature>>;\n\n  /**\n   * The variable where all points of the profile are stored\n   */\n  profilePoints: LidarProfilePoints;\n\n  private isPlotSetup: boolean;\n  private line: OlGeomLineString | null;\n  private i18nManager: I18nManager | null = null;\n\n  utils: LidarProfileUtils;\n\n  debouncer = debounce(() => this.updateData_(), 200);\n  /**\n   * Provides a service to manage a D3js component to be used to draw an lidar point cloud profile chart.\n   * Requires access to a Pytree webservice: https://github.com/sitn/pytree\n   */\n  constructor() {\n    this.plot = null;\n    this.measure = null;\n    this.config = null;\n    this.line = null;\n    this.isPlotSetup = false;\n    this.utils = new LidarProfileUtils();\n\n    /**\n     * The hovered point attributes in D3 profile highlighted on the 2D map\n     */\n    this.cartoHighlight = new olOverlay({\n      offset: [0, -15],\n      positioning: 'bottom-center'\n    });\n\n    /**\n     * The hovered point geometry (point) in D3 profile highlighted on the 2D map\n     */\n    this.lidarPointHighlight = new olLayerVector({\n      className: 'canvas2d',\n      source: new olSourceVector({}),\n      style: new olStyleStyle({\n        image: new olStyleCircle({\n          fill: new olStyleFill({\n            color: 'rgba(0, 0, 255, 1)'\n          }),\n          radius: 3\n        })\n      })\n    });\n\n    /**\n     * The profile footpring represented as a LineString represented\n     * with real mapunites stroke width\n     */\n    this.lidarBuffer = new olLayerVector({\n      className: 'canvas2d',\n      source: new olSourceVector({})\n    });\n\n    /**\n     * The variable where all points of the profile are stored\n     */\n    this.profilePoints = this.getEmptyProfilePoints_();\n  }\n\n  /**\n   * @param config Config\n   * @param map The map.\n   */\n  init(config: LidarProfileConfig, map: OlMap): void {\n    this.i18nManager = I18nManager.getInstance();\n    this.config = config;\n    this.plot = new LidarProfilePlot(this);\n    this.measure = new LidarProfileMeasure(this);\n    this.setMap(map);\n  }\n\n  /**\n   * Clears the profile footprint\n   */\n  clearBuffer(): void {\n    if (this.lidarBuffer) {\n      /**\n       * @type {olSourceVector<OlGeomLineString>}\n       */ this.lidarBuffer.getSource()?.clear();\n    }\n  }\n\n  /**\n   * Set the line for the profile\n   *\n   * @param line that defines the profile\n   */\n  setLine(line: null | OlGeomLineString): void {\n    this.line = line;\n  }\n\n  /**\n   * Set the map used by the profile\n   *\n   * @param map The map.\n   */\n  setMap(map: OlMap): void {\n    this.cartoHighlight.setMap(map);\n    this.lidarPointHighlight.setMap(map);\n    this.lidarBuffer.setMap(map);\n  }\n\n  /**\n   * @returns An empty lidarProfile points object.\n   * @private\n   */\n  getEmptyProfilePoints_(): LidarProfilePoints {\n    return {\n      distance: [],\n      altitude: [],\n      color_packed: [],\n      intensity: [],\n      classification: [],\n      coords: []\n    };\n  }\n\n  /**\n   * Load profile data (lidar points) by successive Levels Of Details using asynchronous requests\n   *\n   * @param clippedLine an array of the clipped line coordinates\n   * @param distanceOffset the left side of D3 profile domain at current zoom and pan configuration\n   * @param resetPlot whether to reset D3 plot or not\n   * @param minLOD minimum Level Of Detail\n   */\n  getProfileByLOD(\n    clippedLine: OlCoordinateCoordinate[],\n    distanceOffset: number,\n    resetPlot: boolean,\n    minLOD: number\n  ): void {\n    if (!this.config) {\n      throw new Error('Missing config');\n    }\n    if (!this.plot) {\n      throw new Error('Missing plot');\n    }\n    if (!this.line) {\n      throw new Error('Missing line');\n    }\n    if (!this.config.serverConfig) {\n      throw new Error('Missing config.serverConfig');\n    }\n\n    this.profilePoints = this.getEmptyProfilePoints_();\n\n    if (resetPlot) {\n      this.isPlotSetup = false;\n    }\n\n    d3select(getLidarProfileError() as BaseType).style('visibility', 'hidden');\n    let pytreeLinestring = this.utils.getPytreeLinestring(this.line);\n\n    let maxLODWith;\n    const max_levels = this.config.serverConfig.max_levels ?? [];\n    if (distanceOffset == 0) {\n      maxLODWith = this.utils.getNiceLOD(this.line.getLength(), max_levels);\n    } else {\n      const domain = this.plot.updateScaleX.domain();\n      pytreeLinestring = '';\n\n      for (const clipped of clippedLine) {\n        pytreeLinestring += `{${clipped[0]},${clipped[1]}},`;\n      }\n      pytreeLinestring = pytreeLinestring.substring(0, pytreeLinestring.length - 1);\n      maxLODWith = this.utils.getNiceLOD(domain[1] - domain[0], max_levels);\n    }\n\n    d3select(getLidarProfileLodInfo() as BaseType).html('');\n    this.config.clientConfig.pointSum = 0;\n    const profileWidth = this.config.clientConfig.autoWidth ? maxLODWith.width : this.config.serverConfig.width ?? 0;\n\n    const profileWidthTxt = this.i18nManager?.getTranslation('Profile width: ');\n    d3select(getLidarProfileWidthInfo() as BaseType).html(`${profileWidthTxt} ${profileWidth}m`);\n    const initialLOD = this.config.serverConfig.initialLOD ?? 0;\n\n    for (let i = 0; i < maxLODWith.maxLOD; i++) {\n      if (i == 0) {\n        this.queryPytree(minLOD, initialLOD, i, pytreeLinestring, distanceOffset, profileWidth, resetPlot);\n        i += initialLOD - 1;\n      } else if (i < maxLODWith.maxLOD - 1) {\n        this.queryPytree(minLOD + i, minLOD + i + 1, i, pytreeLinestring, distanceOffset, profileWidth, false);\n      } else {\n        this.queryPytree(minLOD + i, minLOD + i + 1, i, pytreeLinestring, distanceOffset, profileWidth, false);\n      }\n    }\n  }\n\n  /**\n   * Request to Pytree service for a range of Level Of Detail (LOD)\n   *\n   * @param minLOD minimum Level Of Detail of the request\n   * @param maxLOD maximum Level Of Detail of the request\n   * @param iter the iteration in profile requests cycle\n   * @param coordinates linestring in cPotree format\n   * @param distanceOffset the left side of D3 profile domain at current zoom and pan configuration\n   * @param width the width of the profile\n   * @param resetPlot whether to reset D3 plot or not, used for first LOD\n   * @private\n   */\n  private queryPytree(\n    minLOD: number,\n    maxLOD: number,\n    iter: number,\n    coordinates: string,\n    distanceOffset: number,\n    width: number,\n    resetPlot: boolean\n  ): void {\n    if (!this.config) {\n      throw new Error('Missing config');\n    }\n    if (!this.config.serverConfig) {\n      throw new Error('Missing config.serverConfig');\n    }\n\n    const lodInfo = d3select(getLidarProfileLodInfo() as BaseType);\n    if (this.config.serverConfig.debug) {\n      let html = lodInfo.html();\n      const loadingLodTxt = this.i18nManager?.getTranslation('Loading LOD: ');\n      html += `${loadingLodTxt} ${minLOD}-${maxLOD}..<br>`;\n      lodInfo.html(html);\n    }\n\n    const pointCloudName = this.config.serverConfig.default_point_cloud;\n    const hurl = `${this.config.pytreeLidarProfileJsonUrl}/profile/get?minLOD=${minLOD}&maxLOD=${maxLOD}&width=${width}&coordinates=${coordinates}&pointCloud=${pointCloudName}&attributes=`;\n\n    const options = {\n      method: 'GET',\n      headers: { 'Content-Type': 'text/plain; charset=x-user-defined' },\n      responseType: 'arraybuffer'\n    };\n\n    fetch(hurl, options)\n      .then((resp: Response) => resp.arrayBuffer())\n      .then((data: ArrayBuffer) => {\n        if (!this.config) {\n          throw new Error('Missing config');\n        }\n        if (!this.config.serverConfig) {\n          throw new Error('Missing config.serverConfig');\n        }\n        if (this.config.serverConfig.debug) {\n          let html = lodInfo.html();\n          const lodTxt = this.i18nManager?.getTranslation('LOD: ');\n          const loadedTxt = this.i18nManager?.getTranslation('loaded');\n          html += `${lodTxt} ${minLOD}-${maxLOD} ${loadedTxt}<br>`;\n          lodInfo.html(html);\n        }\n        this.processBuffer(data, iter, distanceOffset, resetPlot);\n      })\n      .catch((err: Error) => {\n        throw new Error(`Error on pytree query: ${err.message}`);\n      });\n  }\n\n  /**\n   * Process the binary array return by Pytree (cPotree)\n   *\n   * @param profile binary array returned by cPotree executable called by Pytree\n   * @param iter the iteration in profile requests cycle\n   * @param distanceOffset the left side of D3 profile domain at current zoom and pan configuration\n   * @param resetPlot whether to reset D3 plot or not\n   * @private\n   */\n  private processBuffer(profile: ArrayBuffer, iter: number, distanceOffset: number, resetPlot: boolean): void {\n    if (!this.config) {\n      throw new Error('Missing config');\n    }\n    if (!this.config.serverConfig) {\n      throw new Error('Missing config.serverConfig');\n    }\n    if (!this.plot) {\n      throw new Error('Missing plot');\n    }\n    if (!this.line) {\n      throw new Error('Missing line');\n    }\n\n    const lidarError = d3select(getLidarProfileError() as BaseType);\n\n    const typedArrayInt32 = new Int32Array(profile, 0, 4);\n    const headerSize = typedArrayInt32[0];\n\n    const uInt8header = new Uint8Array(profile, 4, headerSize);\n    let strHeaderLocal = '';\n    for (const header of uInt8header) {\n      strHeaderLocal += String.fromCharCode(header);\n    }\n\n    try {\n      JSON.parse(strHeaderLocal);\n    } catch (e) {\n      if (!this.isPlotSetup) {\n        const canvas = d3select(getLidarProfileCanvas() as BaseType);\n        const canvasEl = canvas.node() as HTMLCanvasElement | undefined;\n        const ctx = canvasEl?.getContext('2d');\n        if (!ctx || !canvasEl) {\n          throw new Error('Missing ctx or canvas element.');\n        }\n        ctx.clearRect(0, 0, canvasEl.getBoundingClientRect().width, canvasEl.getBoundingClientRect().height);\n        canvas.selectAll('*').remove();\n        const errorTxt = this.getHTMLError_();\n        lidarError.style('visibility', 'visible');\n        lidarError.html(errorTxt);\n      }\n      return;\n    }\n\n    lidarError.style('visibility', 'hidden');\n\n    const jHeader = JSON.parse(strHeaderLocal);\n\n    // If number of points return is higher than Pytree configuration max value,\n    // stop sending requests.\n    const pointSum = (this.config.clientConfig.pointSum ?? 0) + jHeader.points;\n    if (pointSum > (this.config.serverConfig.max_point_number ?? 0)) {\n      console.warn('Number of points is higher than Pytree configuration max value !');\n    }\n\n    const attr = jHeader.pointAttributes;\n    const attributes = [];\n    const pointAttributes = this.config.serverConfig.point_attributes ?? {};\n    for (const att of attr) {\n      if (pointAttributes[att] != undefined) {\n        attributes.push(pointAttributes[att]);\n      }\n    }\n    const scale: number = jHeader.scale;\n\n    if (jHeader.points < 3) {\n      return;\n    }\n\n    const points = this.getEmptyProfilePoints_();\n    const bytesPerPoint = jHeader.bytesPerPoint;\n    const buffer = profile.slice(4 + headerSize);\n    const profileDistance = this.profilePoints.distance ?? [];\n    const profileClassification = this.profilePoints.classification ?? [];\n    const profileIntensity = this.profilePoints.intensity ?? [];\n    const profileColorPacked = this.profilePoints.color_packed ?? [];\n    const profileAltitude = this.profilePoints.altitude ?? [];\n    const profileCoords = this.profilePoints.coords ?? [];\n    const pDistance = points.distance ?? [];\n    const pClassification = points.classification ?? [];\n    const pIntensity = points.intensity ?? [];\n    const pColorPacked = points.color_packed ?? [];\n    const pAltitude = points.altitude ?? [];\n    const pCoords = points.coords ?? [];\n    for (let i = 0; i < jHeader.points; i++) {\n      const byteOffset = bytesPerPoint * i;\n      const view = new DataView(buffer, byteOffset, bytesPerPoint);\n      let aoffset = 0;\n      for (const attribute of attributes) {\n        if (attribute.value == 'POSITION_PROJECTED_PROFILE') {\n          const udist = view.getUint32(aoffset, true);\n          const dist = udist * scale;\n          const distance = Math.round(100 * (distanceOffset + dist)) / 100;\n          pDistance.push(distance);\n          profileDistance.push(distance);\n        } else if (attribute.value == 'CLASSIFICATION') {\n          const classif = view.getUint8(aoffset);\n          pClassification.push(classif);\n          profileClassification.push(classif);\n        } else if (attribute.value == 'INTENSITY') {\n          const intensity = view.getUint8(aoffset);\n          pIntensity.push(intensity);\n          profileIntensity.push(intensity);\n        } else if (attribute.value == 'COLOR_PACKED') {\n          const r = view.getUint8(aoffset);\n          const g = view.getUint8(aoffset + 1);\n          const b = view.getUint8(aoffset + 2);\n          pColorPacked.push([r, g, b]);\n          profileColorPacked.push([r, g, b]);\n        } else if (attribute.value == 'POSITION_CARTESIAN') {\n          const lx = jHeader.boundingBox.lx;\n          if (typeof lx != 'number') {\n            throw new Error('Wrong lx type');\n          }\n          const ly = jHeader.boundingBox.ly;\n          if (typeof ly != 'number') {\n            throw new Error('Wrong ly type');\n          }\n          const lz = jHeader.boundingBox.lz;\n          if (typeof lz != 'number') {\n            throw new Error('Wrong lz type');\n          }\n          const x = view.getInt32(aoffset, true) * scale + lx;\n          const y = view.getInt32(aoffset + 4, true) * scale + ly;\n          const z = view.getInt32(aoffset + 8, true) * scale + lz;\n          pCoords.push([x, y]);\n          pAltitude.push(z);\n          profileAltitude.push(z);\n          profileCoords.push([x, y]);\n        }\n        aoffset = aoffset + (attribute.bytes ?? 0);\n      }\n    }\n\n    const rangeX = [0, this.line.getLength()];\n\n    const rangeY = [this.utils.arrayMin(pAltitude), this.utils.arrayMax(pAltitude)];\n\n    if ((iter == 0 && resetPlot) || !this.isPlotSetup) {\n      this.plot.setupPlot(rangeX, rangeY);\n      this.isPlotSetup = true;\n    }\n    this.plot.drawPoints(points);\n  }\n\n  /**\n   * @returns The html for errors.\n   * @private\n   */\n  getHTMLError_(): string {\n    const errorInfoTxt = this.i18nManager?.getTranslation('LiDAR profile service error');\n    const errorOfflineTxt = this.i18nManager?.getTranslation('It might be offline');\n    const errorOutsideTxt = this.i18nManager?.getTranslation(\n      'Or did you attempt to draw a profile outside data extent?'\n    );\n    const errorNoPointError = this.i18nManager?.getTranslation(\n      'Or did you attempt to draw such a small profile that no point was returned?'\n    );\n    return `\n      <div class=\"lidarprofile-error\">\n      <p class=\"bold\">${errorInfoTxt}</p>\n      <p>${errorOfflineTxt}</p>\n      <p>${errorOutsideTxt}</p>\n      <p>${errorNoPointError}</p>\n    `;\n  }\n\n  /**\n   * Update the profile data according to D3 chart zoom and pan level\n   * The update will wait on a 200ms pause on the actions of users before to do the update.\n   */\n  updateData(): void {\n    this.debouncer();\n  }\n\n  /**\n   * Callback method used by the debouncer to update the profile data\n   *\n   * @private\n   */\n  updateData_(): void {\n    if (!this.config) {\n      throw new Error('Missing config');\n    }\n    if (!this.config.serverConfig) {\n      throw new Error('Missing config.serverConfig');\n    }\n    if (!this.plot) {\n      throw new Error('Missing plot');\n    }\n    if (!this.line) {\n      throw new Error('Missing line');\n    }\n    const domainX = this.plot.updateScaleX.domain();\n    const clip = this.utils.clipLineByMeasure(this.line, domainX[0], domainX[1]);\n\n    const source: olSourceVector<OlFeature<OlGeomGeometry>> | null = this.lidarBuffer.getSource();\n    if (!source) {\n      console.error('No source to update data.');\n      return;\n    }\n    source.clear();\n    source.addFeature(clip.bufferGeom);\n    this.lidarBuffer.setStyle(clip.bufferStyle);\n\n    const span = domainX[1] - domainX[0];\n    const maxLODWidth = this.utils.getNiceLOD(span, this.config.serverConfig.max_levels ?? []);\n    const xTolerance = 0.2;\n\n    if (\n      Math.abs(domainX[0] - this.plot.previousDomainX[0]) < xTolerance &&\n      Math.abs(domainX[1] - this.plot.previousDomainX[1]) < xTolerance\n    ) {\n      this.plot.drawPoints(this.profilePoints);\n    } else if (maxLODWidth.maxLOD <= (this.config.serverConfig.initialLOD ?? 0)) {\n      this.plot.drawPoints(this.profilePoints);\n    } else {\n      this.getProfileByLOD(clip.clippedLine, clip.distanceOffset, false, 0);\n    }\n\n    this.plot.previousDomainX = domainX;\n  }\n}\n\nconst lidarProfileManager = new LidarProfileManager();\nexport default lidarProfileManager;\n","import lidarProfileManager, { LidarProfileManager } from './manager';\nimport KML from 'ol/format/KML';\nimport Feature from 'ol/Feature';\nimport { saveAs } from 'file-saver';\nimport StateManager from '../../../tools/state/statemanager';\n\nimport type OlGeomLineString from 'ol/geom/LineString';\nimport type LidarProfileConfig from './profileconfig';\nimport type CsvManager from '../../../tools/export/csvmanager';\nimport type { LidarProfileServerConfigClassification, LidarProfileServerConfigPointAttribute } from './profileconfig';\n\n/**\n * Interface/helper class between the UI panel and the Lidar manager.\n */\nexport class LidarInterface {\n  private readonly profileConfig: LidarProfileConfig | null = null;\n  private readonly profileManager: LidarProfileManager;\n  private readonly csvManager: CsvManager;\n  private line: OlGeomLineString | null = null;\n  constructor(profileConfig: LidarProfileConfig, csvManager: CsvManager) {\n    this.profileConfig = profileConfig;\n    this.csvManager = csvManager;\n    this.profileManager = lidarProfileManager;\n  }\n\n  /**\n   * Set the line to let this class know if a line has been drawn or not.\n   */\n  setLine(line: OlGeomLineString | null) {\n    this.line = line;\n  }\n\n  /**\n   * Clear the LIDAR profile tool.\n   */\n  clearProfile(): void {\n    this.profileManager.setLine(null);\n    this.profileManager.cartoHighlight.setPosition(undefined);\n    if (this.profileManager.measure) {\n      this.clearMeasure();\n    }\n    this.resetPlot();\n  }\n\n  /**\n   * Activate the measure tool\n   */\n  setMeasureActive(): void {\n    if (!this.profileManager.measure) {\n      console.error('Missing profile.measure');\n      return;\n    }\n    this.profileManager.measure.clearMeasure();\n    this.profileManager.measure.setMeasureActive();\n  }\n\n  /**\n   * Clear the current measure\n   */\n  clearMeasure(): void {\n    if (!this.profileManager.measure) {\n      console.error('Missing profile.measure');\n      return;\n    }\n    this.profileManager.measure.clearMeasure();\n  }\n\n  /**\n   * Reload and reset the plot for the current profile (reloads data)\n   */\n  resetPlot(): void {\n    this.profileManager.clearBuffer();\n    if (this.line) {\n      this.profileManager.getProfileByLOD([], 0, true, 0);\n    }\n  }\n\n  /**\n   * Sets the visible classification in the profile\n   * @param classification selected value.\n   * @param key of the classification code.\n   */\n  setClassification(classification: LidarProfileServerConfigClassification, key: number): void {\n    if (!this.profileManager.plot) {\n      console.error('Missing profile.plot');\n      return;\n    }\n    if (!this?.profileConfig?.serverConfig) {\n      console.error('Missing profileConfig.serverConfig');\n      return;\n    }\n    const classificationColors = this.profileConfig.serverConfig.classification_colors ?? [];\n    classificationColors[key].visible = classification.visible;\n    if (this.line) {\n      this.profileManager.plot.setClassActive(\n        classificationColors,\n        this.profileConfig.serverConfig.default_attribute ?? ''\n      );\n    }\n  }\n\n  /**\n   * Set visible the selected point attribute option\n   */\n  selectPointAttribute(pointAttributeName: string): void {\n    const availablePointAttributes = this.profileConfig?.clientConfig?.pointAttributes?.availableOptions ?? [];\n    const pointAttribute = availablePointAttributes.find(\n      (pointAttribute) => pointAttribute.name === pointAttributeName\n    );\n    if (pointAttribute) {\n      this.setSelectedPointAttribute(pointAttribute);\n    }\n  }\n\n  /**\n   * Update the current drawn profile.\n   * The line to compute the profile must be set before to call this method.\n   */\n  updateProfile() {\n    this.profileManager.clearBuffer();\n    if (!this.profileConfig?.serverConfig) {\n      console.error('Missing profileConfig.serverConfig');\n      return;\n    }\n    this.profileManager.setLine(this.line);\n    this.profileManager.getProfileByLOD([], 0, true, this.profileConfig.serverConfig.minLOD ?? 0);\n  }\n\n  /**\n   * Export the profile to a file (csv or png).\n   */\n  exportFile(fileType: string) {\n    switch (fileType) {\n      case 'csv':\n        return this.csvExport();\n      case 'png':\n        return this.pngExport();\n      case 'kml':\n        return this.kmlExport();\n    }\n  }\n\n  private csvExport() {\n    const points = this.profileManager.utils.getFlatPointsByDistance(this.profileManager.profilePoints) || [];\n    const csvData = this.profileManager.utils.getCSVData(points);\n    const headerColumnNames = Object.keys(points[0]);\n    const headerColumns = headerColumnNames.map((columnName) => {\n      return { name: columnName };\n    });\n    this.csvManager.startDownload(csvData, headerColumns, 'LIDAR_profile.csv');\n  }\n\n  private pngExport() {\n    const clientConfig = this.profileConfig?.clientConfig;\n    if (!clientConfig) {\n      return;\n    }\n    this.profileManager.utils.downloadProfileAsImageFile(clientConfig);\n  }\n\n  private kmlExport() {\n    if (this.line) {\n      const kml = new KML().writeFeatures([new Feature({ geometry: this.line })], {\n        dataProjection: 'EPSG:4326',\n        featureProjection: StateManager.getInstance().state.projection\n      });\n      saveAs(new Blob([kml], { type: 'text/plain;charset=utf-8' }), 'profile.kml');\n    } else {\n      console.warn('A line should be drawn before being exporting to KML');\n    }\n  }\n\n  /**\n   * Set the selected point attribute\n   * @param selectedPointAttribute The new selected point attribute.\n   */\n  private setSelectedPointAttribute(selectedPointAttribute: LidarProfileServerConfigPointAttribute): void {\n    if (!this.profileConfig?.clientConfig.pointAttributes) {\n      console.error('Missing pointAttributes');\n      return;\n    }\n    if (!this.profileManager.plot) {\n      console.error('Missing plot');\n      return;\n    }\n    this.profileConfig.clientConfig.pointAttributes.selectedOption = selectedPointAttribute;\n    this.profileManager.plot.changeStyle(selectedPointAttribute.value ?? '');\n  }\n}\n","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20576%20512'%3e%3c!--!Font%20Awesome%20Free%206.5.2%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202024%20Fonticons,%20Inc.--%3e%3cpath%20d='M290.7%2057.4L57.4%20290.7c-25%2025-25%2065.5%200%2090.5l80%2080c12%2012%2028.3%2018.7%2045.3%2018.7H288h9.4H512c17.7%200%2032-14.3%2032-32s-14.3-32-32-32H387.9L518.6%20285.3c25-25%2025-65.5%200-90.5L381.3%2057.4c-25-25-65.5-25-90.5%200zM297.4%20416H288l-105.4%200-80-80L227.3%20211.3%20364.7%20348.7%20297.4%20416z'/%3e%3c/svg%3e\"","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20512%20512'%3e%3c!--!Font%20Awesome%20Free%206.5.2%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202024%20Fonticons,%20Inc.--%3e%3cpath%20d='M142.9%20142.9c62.2-62.2%20162.7-62.5%20225.3-1L327%20183c-6.9%206.9-8.9%2017.2-5.2%2026.2s12.5%2014.8%2022.2%2014.8H463.5c0%200%200%200%200%200H472c13.3%200%2024-10.7%2024-24V72c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2%205.2L413.4%2096.6c-87.6-86.5-228.7-86.2-315.8%201C73.2%20122%2055.6%20150.7%2044.8%20181.4c-5.9%2016.7%202.9%2034.9%2019.5%2040.8s34.9-2.9%2040.8-19.5c7.7-21.8%2020.2-42.3%2037.8-59.8zM16%20312v7.6%20.7V440c0%209.7%205.8%2018.5%2014.8%2022.2s19.3%201.7%2026.2-5.2l41.6-41.6c87.6%2086.5%20228.7%2086.2%20315.8-1c24.4-24.4%2042.1-53.1%2052.9-83.7c5.9-16.7-2.9-34.9-19.5-40.8s-34.9%202.9-40.8%2019.5c-7.7%2021.8-20.2%2042.3-37.8%2059.8c-62.2%2062.2-162.7%2062.5-225.3%201L185%20329c6.9-6.9%208.9-17.2%205.2-26.2s-12.5-14.8-22.2-14.8H48.4h-.7H40c-13.3%200-24%2010.7-24%2024z'/%3e%3c/svg%3e\"","import GirafeHTMLElement from '../../../base/GirafeHTMLElement';\nimport LidarProfileConfig from '../tools/profileconfig';\nimport DrawLine from '../tools/drawline';\nimport MapManager from '../../../tools/state/mapManager';\nimport CsvManager from '../../../tools/export/csvmanager';\nimport lidarProfileManager from '../tools/manager';\nimport { LidarInterface } from '../tools/lidarinterface';\n\nimport type { LidarProfileManager } from '../tools/manager';\nimport type { Callback } from '../../../tools/state/statemanager';\nimport type {\n  LidarProfileServerConfigClassification,\n  LidarProfileServerConfigClassifications,\n  LidarProfileServerConfigPointAttribute\n} from '../tools/profileconfig';\n\nimport eraserSvgUrl from '../images/eraser.svg';\nimport rotateSvgUrl from '../images/rotate.svg';\n\n/**\n * Class representing the Lidar Panel Component.\n * Fetch and inits the Lidar config.\n * Activate and deactivate Lidar tool.\n * Manage draw line for lidar.\n */\nexport default class LidarPanelComponent extends GirafeHTMLElement {\n  templateUrl = './template.html';\n  styleUrl = './style.css';\n\n  eraserSvgUrl = eraserSvgUrl;\n  rotateSvgUrl = rotateSvgUrl;\n\n  private csvManager: CsvManager;\n  private profileConfig: LidarProfileConfig | null = null;\n  private profileManager: LidarProfileManager;\n  private visible = false;\n  private drawLine: DrawLine;\n  private lidarInterface?: LidarInterface;\n  private mapManager: MapManager;\n  private readonly eventsCallbacks: Callback[] = [];\n  private isVisibleComponentSetup = false;\n\n  constructor() {\n    super('lidar-panel');\n    this.csvManager = CsvManager.getInstance();\n    this.mapManager = MapManager.getInstance();\n    this.profileManager = lidarProfileManager;\n    this.drawLine = new DrawLine(this.state);\n  }\n\n  connectedCallback() {\n    this.render();\n    this.registerVisibilityEvents();\n  }\n\n  /**\n   * Render the component regarding its visibility.\n   * At first rendering, fetch and init the lidar config, init side-kick classes\n   * and register to events.\n   */\n  render() {\n    this.visible ? this.renderComponent() : this.renderEmptyComponent();\n  }\n\n  /**\n   * @returns true if the configuration is loaded.\n   */\n  isConfigLoaded(): boolean {\n    return !!this.profileConfig?.serverConfig;\n  }\n\n  /**\n   * @returns true if a lidar-line is drawn.\n   */\n  isLineDrawn(): boolean {\n    return !!this.state.lidar.line;\n  }\n\n  /**\n   * @returns true if the draw line tool is activated.\n   */\n  isDrawActive(): boolean {\n    return this.state.lidar.drawActive;\n  }\n\n  /**\n   * @returns The available point attributes from the LidarProfileServerConfig instance.\n   */\n  getAvailablePointAttributes(): LidarProfileServerConfigPointAttribute[] {\n    return this.profileConfig?.clientConfig?.pointAttributes?.availableOptions || [];\n  }\n\n  /**\n   * @returns The classifications of the LidarProfileServerConfig.\n   */\n  getClassifications(): LidarProfileServerConfigClassifications {\n    return this.profileConfig?.serverConfig?.classification_colors || [];\n  }\n\n  /**\n   * @returns true if the given pointAttributeName is the currently selected one in the config.\n   */\n  isPointAttributeSelected(pointAttributeName: string | undefined): boolean {\n    const selectedPointAttribute = this.profileConfig?.clientConfig.pointAttributes?.selectedOption;\n    return pointAttributeName === selectedPointAttribute?.name;\n  }\n\n  /**\n   * Toggles the drawline active state.\n   * The drawline is rendered after the state has been toggled.\n   */\n  toggleDrawLine(): void {\n    this.drawLine.setActive(!this.isDrawActive());\n    this.render();\n  }\n\n  /**\n   * Exports a file of the specified type.\n   */\n  exportFile(type: string): void {\n    if (!this.isLineDrawn()) {\n      return;\n    }\n    this.lidarInterface?.exportFile(type);\n  }\n\n  /**\n   * Toggle visibility of the selected classification object.\n   * @param classification The classification to change visibility.\n   * @param key The key string of the toggled classification.\n   */\n  toggleClassificationVisibility(classification: LidarProfileServerConfigClassification, key: string): void {\n    classification.visible = classification.visible === 0 ? 1 : 0;\n    this.lidarInterface?.setClassification(classification, parseInt(key));\n  }\n\n  /**\n   * Activate the measure on the Lidar chart.\n   */\n  setMeasureActive() {\n    this.lidarInterface?.setMeasureActive();\n  }\n\n  /**\n   * Clear the measure on the Lidar chart.\n   */\n  clearMeasure() {\n    this.lidarInterface?.clearMeasure();\n  }\n\n  /**\n   * Reset the chart to its default size.\n   */\n  resetPlot() {\n    this.lidarInterface?.resetPlot();\n  }\n\n  /**\n   * Set the selected point attribute to use to draw the Lidar.\n   */\n  selectPointAttribute(evt: Event) {\n    const eventValue = (evt.target as HTMLInputElement)?.value;\n    this.lidarInterface?.selectPointAttribute(eventValue);\n  }\n\n  /**\n   * Renders the component by calling the necessary methods.\n   * @private\n   */\n  private renderComponent() {\n    super.render();\n    super.girafeTranslate();\n    this.activateTooltips(false, [800, 0], 'top-end');\n    this.renderComponentConfigPart();\n  }\n\n  /**\n   * Renders the component config part, like every element linked to the lidar config.\n   * Loads the config and the side-kick classes if not already loaded.\n   * @private\n   */\n  private async renderComponentConfigPart() {\n    if (!this.isConfigLoaded()) {\n      if (!(await this.initComponentConfig())) {\n        return;\n      }\n      // Render again, with config and related elements well set.\n      this.render();\n      return;\n    }\n    if (!this.isVisibleComponentSetup) {\n      this.setupVisibleComponent();\n      this.render();\n    }\n  }\n\n  /**\n   * Set listener and activate draw line on opening the panel.\n   * @private\n   */\n  private setupVisibleComponent() {\n    this.state.selection.enabled = false;\n    this.registerEvents();\n    this.drawLine.setMap(this.mapManager.getMap());\n    this.drawLine.setActive(true);\n    this.isVisibleComponentSetup = true;\n  }\n\n  /**\n   * Hide the panel, and removes listeners and interactions.\n   * @private\n   */\n  private renderEmptyComponent() {\n    this.state.selection.enabled = true;\n    this.isVisibleComponentSetup = false;\n    this.drawLine.setActive(false);\n    this.stateManager.unsubscribe(this.eventsCallbacks);\n    this.eventsCallbacks.length = 0;\n    this.lidarInterface?.clearProfile();\n    this.renderEmpty();\n  }\n\n  /**\n   * Load the application config and then fetch the config and initialize side-kick classes.\n   * @returns true if the config is well fetched and loaded.\n   * @private\n   */\n  private async initComponentConfig(): Promise<boolean | undefined> {\n    const lidarUrl = this.configManager.Config.lidar.url;\n    this.profileConfig = new LidarProfileConfig(lidarUrl);\n    await this.loadConfig();\n    await this.profileConfig.initProfileConfig();\n    this.profileManager.init(this.profileConfig, this.mapManager.getMap());\n    this.lidarInterface = new LidarInterface(this.profileConfig, this.csvManager);\n    return this.isConfigLoaded();\n  }\n\n  private registerVisibilityEvents() {\n    this.stateManager.subscribe('interface.lidarPanelVisible', (_oldValue, newValue) => this.togglePanel(newValue));\n  }\n\n  private async togglePanel(visible: boolean): Promise<void> {\n    this.visible = visible;\n    this.render();\n  }\n\n  /**\n   * Listen lidar line and lidar draw active state to update the rendering with.\n   * @private\n   */\n  private registerEvents() {\n    this.eventsCallbacks.push(\n      this.stateManager.subscribe('lidar.line', (oldVal, newVal) => {\n        if (oldVal === newVal) {\n          return;\n        }\n        this.lidarInterface?.setLine(newVal);\n        this.drawLine.setLine(newVal);\n        newVal ? this.lidarInterface?.updateProfile() : this.lidarInterface?.clearProfile();\n        this.render();\n      })\n    );\n    this.eventsCallbacks.push(\n      this.stateManager.subscribe('lidar.drawActive', (oldVal, newVal) => {\n        if (oldVal === null || oldVal === newVal) {\n          return;\n        }\n        this.render();\n      })\n    );\n  }\n}\n","import GirafeHTMLElement from './GirafeHTMLElement';\n\n/*\nMinimal template for a draggable object :\nIt must have 2 divs :\n- One for the whole panel (id=\"panel\"). Attribute dock is mandatory and can have the values \"left\" or \"right\"\n- One for the gutter (id=\"gutter\"). This is where the panel can be resized.\n\nExample:\n\n<div id=\"panel\" dock=\"left\">\n  <div id=\"gutter\"></div>\n  <div id=\"hide\"></div>\n  <div id=\"close\"></div>\n</div>\n\nThen in order to make an component resizable,\nthe base method makeResizable() must be called after rendering the template.\n\nThat's it.\n\n*/\n\nclass GirafeResizableElement extends GirafeHTMLElement {\n  gutter?: HTMLElement;\n  hideButton?: HTMLElement;\n  closeButton?: HTMLElement;\n  dock: 'left' | 'right' | 'bottom';\n  prevX = 0;\n  prevY = 0;\n\n  toggleSize: number = 0;\n\n  lastWidth = 0;\n  minWidth?: number;\n  maxWidth?: number;\n\n  lastHeight = 0;\n  minHeight?: number;\n  maxHeight?: number;\n\n  constructor(component: string, docking?: 'left' | 'right' | 'bottom') {\n    super(component);\n    const dock = docking ?? this.getAttribute('dock');\n    if (!dock) {\n      this.dock = 'right';\n    } else if (dock === 'left' || dock === 'right' || dock === 'bottom') {\n      this.dock = dock;\n    } else {\n      throw new Error(`Invalid value for the attribute dock: ${dock}. Should be one of [left, right, bottom]`);\n    }\n  }\n\n  public render() {\n    this.restoreLastDimensions();\n    super.render();\n    this.makeResizable();\n  }\n\n  public makeResizable() {\n    this.gutter = this.shadow.querySelector('#gutter')!;\n    this.gutter.onmousedown = (e) => this.mousedown(e);\n    this.gutter.ondblclick = () => this.togglePanelInternal();\n\n    this.hideButton = this.shadow.getElementById('hide') || undefined;\n    if (this.hideButton) {\n      this.hideButton.onclick = () => this.togglePanelInternal();\n    }\n    this.closeButton = this.shadow.getElementById('close') || undefined;\n    if (this.closeButton) {\n      this.closeButton.onclick = () => this.closePanel();\n    }\n\n    this.toggleSize =\n      this.dock === 'bottom' ? this.gutter.getBoundingClientRect().height : this.gutter.getBoundingClientRect().width;\n    this.initSizeLimits();\n  }\n\n  private initSizeLimits() {\n    // If there is a configured minWidth or maxWidth, we have to take care of it\n    const css = getComputedStyle(this);\n    const minWidth = parseFloat(css.minWidth);\n    this.minWidth = isNaN(minWidth) ? undefined : minWidth;\n\n    const maxWidth = parseFloat(css.maxWidth);\n    this.maxWidth = isNaN(maxWidth) ? undefined : maxWidth;\n\n    const minHeight = parseFloat(css.minHeight);\n    this.minHeight = isNaN(minHeight) ? undefined : minHeight;\n\n    const maxHeight = parseFloat(css.maxHeight);\n    this.maxHeight = isNaN(maxHeight) ? undefined : maxHeight;\n  }\n\n  private mousedown(e: MouseEvent) {\n    e.preventDefault();\n    document.onmousemove = (e) => this.mousemove(e);\n    document.onmouseup = () => this.mouseup();\n\n    this.prevX = e.x;\n    this.prevY = e.y;\n\n    this.lastWidth = parseFloat(getComputedStyle(this).width);\n    this.lastHeight = parseFloat(getComputedStyle(this).height);\n  }\n\n  private mousemove(e: MouseEvent) {\n    e.preventDefault();\n    const newX = this.prevX - e.x;\n    const newY = this.prevY - e.y;\n\n    if (this.dock === 'left') {\n      this.resizePanelLeft(newX);\n    } else if (this.dock === 'right') {\n      this.resizePanelRight(newX);\n    } else if (this.dock === 'bottom') {\n      this.resizePanelBottom(newY);\n    }\n  }\n\n  private mouseup() {\n    // stop moving when mouse button is released\n    document.onmouseup = null;\n    document.onmousemove = null;\n  }\n\n  protected closePanel() {\n    throw new Error('This function must be overriden to close and clean the associated panel');\n  }\n\n  protected clean() {\n    this.style.width = '';\n    this.style.height = '';\n  }\n\n  private restoreLastDimensions() {\n    if (this.lastWidth) {\n      this.style.width = this.lastWidth + 'px';\n    }\n    if (this.lastHeight) {\n      this.style.height = this.lastHeight + 'px';\n    }\n  }\n\n  private togglePanelInternal() {\n    if (this.dock === 'left' || this.dock === 'right') {\n      this.togglePanelVertically();\n    } else {\n      this.togglePanelHorizontally();\n    }\n  }\n\n  private togglePanelVertically() {\n    const width = this.getBoundingClientRect().width;\n    if (width <= this.toggleSize) {\n      // Panel is already hidden.\n      // => We reset it to the last width\n      this.style.width = this.lastWidth + 'px';\n      this.style.minWidth = this.minWidth + 'px';\n      if (this.hideButton) {\n        this.hideButton.classList.remove('closed');\n      }\n    } else {\n      // Hide the panel\n      this.lastWidth = width;\n      this.style.width = this.toggleSize + 'px';\n      this.style.minWidth = '0';\n      if (this.hideButton) {\n        this.hideButton.classList.add('closed');\n      }\n    }\n  }\n\n  private togglePanelHorizontally() {\n    const height = this.getBoundingClientRect().height;\n    if (height <= this.toggleSize) {\n      // Panel is already hidden.\n      // => We reset it to the last height\n      this.style.height = this.lastHeight + 'px';\n      this.style.minWidth = this.minHeight + 'px';\n      if (this.hideButton) {\n        this.hideButton.classList.remove('closed');\n      }\n    } else {\n      // Hide the panel\n      this.lastHeight = height;\n      this.style.height = this.toggleSize + 'px';\n      this.style.minHeight = '0';\n      if (this.hideButton) {\n        this.hideButton.classList.add('closed');\n      }\n    }\n  }\n\n  private getLimitedWidth(width: number) {\n    if (this.minWidth && width < this.minWidth) {\n      return this.minWidth;\n    }\n    if (this.maxWidth && width > this.maxWidth) {\n      return this.maxWidth;\n    }\n    return width;\n  }\n\n  private getLimitedHeight(height: number) {\n    if (this.minHeight && height < this.minHeight) {\n      return this.minHeight;\n    }\n    if (this.maxHeight && height > this.maxHeight) {\n      return this.maxHeight;\n    }\n\n    return height;\n  }\n\n  private resizePanelLeft(newX: number) {\n    const newWidth = this.getLimitedWidth(this.lastWidth - newX);\n    this.style.width = newWidth + 'px';\n  }\n\n  private resizePanelRight(newX: number) {\n    const newWidth = this.getLimitedWidth(this.lastWidth + newX);\n    this.style.width = newWidth + 'px';\n  }\n\n  private resizePanelBottom(newY: number) {\n    const newHeight = this.getLimitedHeight(this.lastHeight + newY);\n    this.style.height = newHeight + 'px';\n  }\n}\n\nexport default GirafeResizableElement;\n","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 384 512\\\"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d=\\\"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z\\\"/></svg>\"","import GirafeResizableElement from '../../../base/GirafeResizableElement';\nimport OlGeomLineString from 'ol/geom/LineString';\nimport closeSvg from '../images/close.svg?raw';\n/**\n * Container to draw the Lidar profile.\n */\nexport default class LidarProfileComponent extends GirafeResizableElement {\n  templateUrl = './template.html';\n  styleUrl = './style.css';\n  closeSvg = closeSvg;\n  private visible = false;\n\n  constructor() {\n    super('lidar-profile');\n  }\n\n  connectedCallback() {\n    this.render();\n    this.registerVisibilityEvents();\n  }\n\n  /**\n   * Render the component regarding its visibility.\n   */\n  render() {\n    this.visible ? super.render() : this.renderEmpty();\n  }\n\n  /**\n   * Close the panel by removing the lidar line.\n   */\n  closePanel() {\n    this.state.lidar.line = null;\n  }\n\n  private registerVisibilityEvents() {\n    this.stateManager.subscribe('lidar.line', (_oldValue, newValue) => this.togglePanel(newValue));\n  }\n\n  private async togglePanel(line: OlGeomLineString): Promise<void> {\n    this.visible = !!line;\n    this.render();\n  }\n}\n","import type { Callback } from '../state/statemanager';\nimport State from '../state/state';\nimport StateManager from '../state/statemanager';\n\n/**\n * Manages the toggling of state properties based on specified paths.\n * Every paths leading to boolean value will be initially set to false,\n * then activities one will deactivate the others.\n */\nexport default class StateToggleManager {\n  private readonly eventsCallbacks: Callback[] = [];\n  private togglePaths: string[];\n\n  constructor(\n    togglePaths: string[],\n    private stateManager: StateManager\n  ) {\n    this.togglePaths = StateToggleManager.filterValidTogglePaths(this.stateManager, togglePaths);\n    this.initToggle();\n    this.watchToggle();\n  }\n\n  get state(): State {\n    return this.stateManager.state;\n  }\n\n  /**\n   * To call to destroy properly the component.\n   */\n  destroy() {\n    this.stateManager.unsubscribe(this.eventsCallbacks);\n  }\n\n  /**\n   * Set to false every state leaded by toggle paths except the specified one.\n   * Use the given value on the specified one.\n   */\n  toggle(setPath: string, newValue: boolean) {\n    this.togglePaths\n      .filter((path) => path !== setPath)\n      .forEach((path) => {\n        this.stateManager.setPropertyByPath(this.state, path, false);\n      });\n    this.stateManager.setPropertyByPath(this.state, setPath, newValue);\n  }\n\n  /**\n   * Set to false every state leaded by toggle paths.\n   */\n  deactivateAll() {\n    this.toggle(this.togglePaths[0], false);\n  }\n\n  /**\n   * Initializes the toggle for the given paths.\n   * If any of the paths has a truthy value in the state, sets all other paths to false.\n   * @private\n   */\n  private initToggle() {\n    let oneActive = false;\n    this.togglePaths.forEach((path) => {\n      const result = this.stateManager.getPropertyByPath(this.state, path);\n      if (oneActive) {\n        this.stateManager.setPropertyByPath(this.state, path, false);\n      }\n      if (result.object === true) {\n        oneActive = true;\n      }\n    });\n  }\n\n  /**\n   * Watches for changes in togglePaths and invokes the toggle method when a change is detected.\n   * @private\n   **/\n  private watchToggle() {\n    this.togglePaths.forEach((path) => {\n      this.eventsCallbacks.push(\n        this.stateManager.subscribe(path, (oldValue, newValue) => {\n          if (oldValue == null) {\n            // Don't toggle initial value, needed in tests.\n            return;\n          }\n          if (oldValue !== newValue) {\n            this.toggle(path, newValue);\n          }\n        })\n      );\n    });\n  }\n\n  /**\n   * Filters out invalid toggle paths from the given array of paths.\n   * Invalid path are path not leading to object in the state, or not leading to boolean value.\n   * @static\n   */\n  static filterValidTogglePaths(stateManager: StateManager, paths: string[]): string[] {\n    return paths.filter((path) => {\n      const result = stateManager.getPropertyByPath(stateManager.state, path);\n      if (result.found && (result.object === true || result.object === false)) {\n        return true;\n      }\n      console.warn(`Configured state toggle path \"${path}\" doesn't lead to a boolean property. Skip it.`);\n      return false;\n    });\n  }\n}\n","import GirafeResizableElement from '../../base/GirafeResizableElement';\nimport StateToggleManager from '../../tools/state/stateToggleManager';\n\n/**\n * A panel component that extends GirafeResizableElement.\n * Used as main Left and Right panels on the app.\n * It has a state toggle manager that can activate or deactivate\n * toggle paths based on changes in its state.\n * It also has methods to shows/hide itself based on the state toggle paths and state.\n *\n * To have the toggle on the state working, the component must have this structure, with\n * a slot=\"main\" and children with the data-toggle-path set:\n * <girafe-lr-panel>\n *   <any slot=\"main\" data-toggle-path=\"my.state.path1.to.boolean\"></any>\n *   <any slot=\"main\" data-toggle-path=\"my.state.path2.to.boolean\"></any>\n * </girafe-lr-panel>\n */\nclass LRPanelComponent extends GirafeResizableElement {\n  templateUrl = './template.html';\n  styleUrl = './style.css';\n  private stateToggleManager: StateToggleManager;\n\n  constructor() {\n    super('lr-panel');\n    this.render();\n\n    // Add the dock mode as class on the panel to allow setting differents styles\n    // depending on the docking position\n    const panel = this.shadow.getElementById('panel');\n    panel?.classList.add(this.dock);\n\n    const togglePaths = this.retrieveTogglePaths();\n    this.stateToggleManager = new StateToggleManager(togglePaths, this.stateManager);\n    this.showOnChildChange(togglePaths);\n  }\n\n  /**\n   * Closes the panel by deactivating all state toggles and hiding itself.\n   */\n  closePanel() {\n    this.stateToggleManager.deactivateAll();\n    this.hide();\n  }\n\n  /**\n   * Retrieve the (valid boolean) toggle paths from child elements of the main slot.\n   */\n  private retrieveTogglePaths(): string[] {\n    const elements = this.shadow.querySelectorAll('slot')[0].assignedNodes();\n    const togglePaths: string[] = [];\n    for (const element of elements) {\n      const togglePath = (element as HTMLElement).dataset['togglePath'];\n      if (togglePath) {\n        togglePaths.push(togglePath);\n      }\n    }\n\n    return StateToggleManager.filterValidTogglePaths(this.stateManager, togglePaths);\n  }\n\n  /**\n   * Subscribes to changes in togglePaths and shows or hides the component based on the changes.\n   */\n  private showOnChildChange(togglePaths: string[]) {\n    togglePaths.forEach((path) => {\n      this.stateManager.subscribe(path, (oldValue, newValue) => {\n        if (oldValue !== newValue) {\n          if (newValue) {\n            this.show();\n          } else {\n            this.hide();\n          }\n        }\n      });\n    });\n  }\n}\n\nexport default LRPanelComponent;\n","/**\n * @module ol/interaction/Modify\n */\nimport Collection from '../Collection.js';\nimport CollectionEventType from '../CollectionEventType.js';\nimport Event from '../events/Event.js';\nimport EventType from '../events/EventType.js';\nimport Feature from '../Feature.js';\nimport MapBrowserEventType from '../MapBrowserEventType.js';\nimport Point from '../geom/Point.js';\nimport PointerInteraction from './Pointer.js';\nimport RBush from '../structs/RBush.js';\nimport VectorEventType from '../source/VectorEventType.js';\nimport VectorLayer from '../layer/Vector.js';\nimport VectorSource from '../source/Vector.js';\nimport {\n  altKeyOnly,\n  always,\n  primaryAction,\n  singleClick,\n} from '../events/condition.js';\nimport {\n  boundingExtent,\n  buffer as bufferExtent,\n  createOrUpdateFromCoordinate as createExtent,\n} from '../extent.js';\nimport {\n  closestOnSegment,\n  distance as coordinateDistance,\n  equals as coordinatesEqual,\n  squaredDistance as squaredCoordinateDistance,\n  squaredDistanceToSegment,\n} from '../coordinate.js';\nimport {createEditingStyle} from '../style/Style.js';\nimport {equals} from '../array.js';\nimport {fromCircle} from '../geom/Polygon.js';\nimport {\n  fromUserCoordinate,\n  fromUserExtent,\n  getUserProjection,\n  toUserCoordinate,\n  toUserExtent,\n} from '../proj.js';\nimport {getUid} from '../util.js';\n\n/**\n * The segment index assigned to a circle's center when\n * breaking up a circle into ModifySegmentDataType segments.\n * @type {number}\n */\nconst CIRCLE_CENTER_INDEX = 0;\n\n/**\n * The segment index assigned to a circle's circumference when\n * breaking up a circle into ModifySegmentDataType segments.\n * @type {number}\n */\nconst CIRCLE_CIRCUMFERENCE_INDEX = 1;\n\nconst tempExtent = [0, 0, 0, 0];\nconst tempSegment = [];\n\n/**\n * @enum {string}\n */\nconst ModifyEventType = {\n  /**\n   * Triggered upon feature modification start\n   * @event ModifyEvent#modifystart\n   * @api\n   */\n  MODIFYSTART: 'modifystart',\n  /**\n   * Triggered upon feature modification end\n   * @event ModifyEvent#modifyend\n   * @api\n   */\n  MODIFYEND: 'modifyend',\n};\n\n/**\n * @typedef {Object} SegmentData\n * @property {Array<number>} [depth] Depth.\n * @property {Feature} feature Feature.\n * @property {import(\"../geom/SimpleGeometry.js\").default} geometry Geometry.\n * @property {number} [index] Index.\n * @property {Array<Array<number>>} segment Segment.\n * @property {Array<SegmentData>} [featureSegments] FeatureSegments.\n */\n\n/**\n * @typedef {Object} Options\n * @property {import(\"../events/condition.js\").Condition} [condition] A function that\n * takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether that event will be considered to add or move a\n * vertex to the sketch. Default is\n * {@link module:ol/events/condition.primaryAction}.\n * @property {import(\"../events/condition.js\").Condition} [deleteCondition] A function\n * that takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether that event should be handled. By default,\n * {@link module:ol/events/condition.singleClick} with\n * {@link module:ol/events/condition.altKeyOnly} results in a vertex deletion.\n * @property {import(\"../events/condition.js\").Condition} [insertVertexCondition] A\n * function that takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and\n * returns a boolean to indicate whether a new vertex should be added to the sketch\n * features. Default is {@link module:ol/events/condition.always}.\n * @property {number} [pixelTolerance=10] Pixel tolerance for considering the\n * pointer close enough to a segment or vertex for editing.\n * @property {import(\"../style/Style.js\").StyleLike|import(\"../style/flat.js\").FlatStyleLike} [style]\n * Style used for the modification point or vertex. For linestrings and polygons, this will\n * be the affected vertex, for circles a point along the circle, and for points the actual\n * point. If not configured, the default edit style is used (see {@link module:ol/style/Style~Style}).\n * When using a style function, the point feature passed to the function will have a `features`\n * property - an array whose entries are the features that are being modified, and a `geometries`\n * property - an array whose entries are the geometries that are being modified. Both arrays are\n * in the same order. The `geometries` are only useful when modifying geometry collections, where\n * the geometry will be the particular geometry from the collection that is being modified.\n * @property {VectorSource} [source] The vector source with\n * features to modify.  If a vector source is not provided, a feature collection\n * must be provided with the `features` option.\n * @property {boolean|import(\"../layer/BaseVector\").default} [hitDetection] When configured, point\n * features will be considered for modification based on their visual appearance, instead of being within\n * the `pixelTolerance` from the pointer location. When a {@link module:ol/layer/BaseVector~BaseVectorLayer} is\n * provided, only the rendered representation of the features on that layer will be considered.\n * @property {Collection<Feature>} [features]\n * The features the interaction works on.  If a feature collection is not\n * provided, a vector source must be provided with the `source` option.\n * @property {boolean} [wrapX=false] Wrap the world horizontally on the sketch\n * overlay.\n * @property {boolean} [snapToPointer=!hitDetection] The vertex, point or segment being modified snaps to the\n * pointer coordinate when clicked within the `pixelTolerance`.\n */\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/interaction/Modify~Modify} instances are\n * instances of this type.\n */\nexport class ModifyEvent extends Event {\n  /**\n   * @param {ModifyEventType} type Type.\n   * @param {Collection<Feature>} features\n   * The features modified.\n   * @param {import(\"../MapBrowserEvent.js\").default} mapBrowserEvent\n   * Associated {@link module:ol/MapBrowserEvent~MapBrowserEvent}.\n   */\n  constructor(type, features, mapBrowserEvent) {\n    super(type);\n\n    /**\n     * The features being modified.\n     * @type {Collection<Feature>}\n     * @api\n     */\n    this.features = features;\n\n    /**\n     * Associated {@link module:ol/MapBrowserEvent~MapBrowserEvent}.\n     * @type {import(\"../MapBrowserEvent.js\").default}\n     * @api\n     */\n    this.mapBrowserEvent = mapBrowserEvent;\n  }\n}\n\n/***\n * @template Return\n * @typedef {import(\"../Observable\").OnSignature<import(\"../Observable\").EventTypes, import(\"../events/Event.js\").default, Return> &\n *   import(\"../Observable\").OnSignature<import(\"../ObjectEventType\").Types|\n *     'change:active', import(\"../Object\").ObjectEvent, Return> &\n *   import(\"../Observable\").OnSignature<'modifyend'|'modifystart', ModifyEvent, Return> &\n *   import(\"../Observable\").CombinedOnSignature<import(\"../Observable\").EventTypes|import(\"../ObjectEventType\").Types|\n *     'change:active'|'modifyend'|'modifystart', Return>} ModifyOnSignature\n */\n\n/**\n * @classdesc\n * Interaction for modifying feature geometries.  To modify features that have\n * been added to an existing source, construct the modify interaction with the\n * `source` option.  If you want to modify features in a collection (for example,\n * the collection used by a select interaction), construct the interaction with\n * the `features` option.  The interaction must be constructed with either a\n * `source` or `features` option.\n *\n * Cartesian distance from the pointer is used to determine the features that\n * will be modified. This means that geometries will only be considered for\n * modification when they are within the configured `pixelTolerance`. For point\n * geometries, the `hitDetection` option can be used to match their visual\n * appearance.\n *\n * By default, the interaction will allow deletion of vertices when the `alt`\n * key is pressed.  To configure the interaction with a different condition\n * for deletion, use the `deleteCondition` option.\n * @fires ModifyEvent\n * @api\n */\nclass Modify extends PointerInteraction {\n  /**\n   * @param {Options} options Options.\n   */\n  constructor(options) {\n    super(/** @type {import(\"./Pointer.js\").Options} */ (options));\n\n    /***\n     * @type {ModifyOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.on;\n\n    /***\n     * @type {ModifyOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.once;\n\n    /***\n     * @type {ModifyOnSignature<void>}\n     */\n    this.un;\n\n    /** @private */\n    this.boundHandleFeatureChange_ = this.handleFeatureChange_.bind(this);\n\n    /**\n     * @private\n     * @type {import(\"../events/condition.js\").Condition}\n     */\n    this.condition_ = options.condition ? options.condition : primaryAction;\n\n    /**\n     * @private\n     * @param {import(\"../MapBrowserEvent.js\").default} mapBrowserEvent Browser event.\n     * @return {boolean} Combined condition result.\n     */\n    this.defaultDeleteCondition_ = function (mapBrowserEvent) {\n      return altKeyOnly(mapBrowserEvent) && singleClick(mapBrowserEvent);\n    };\n\n    /**\n     * @type {import(\"../events/condition.js\").Condition}\n     * @private\n     */\n    this.deleteCondition_ = options.deleteCondition\n      ? options.deleteCondition\n      : this.defaultDeleteCondition_;\n\n    /**\n     * @type {import(\"../events/condition.js\").Condition}\n     * @private\n     */\n    this.insertVertexCondition_ = options.insertVertexCondition\n      ? options.insertVertexCondition\n      : always;\n\n    /**\n     * Editing vertex.\n     * @type {Feature<Point>}\n     * @private\n     */\n    this.vertexFeature_ = null;\n\n    /**\n     * Segments intersecting {@link this.vertexFeature_} by segment uid.\n     * @type {Object<string, boolean>}\n     * @private\n     */\n    this.vertexSegments_ = null;\n\n    /**\n     * @type {import(\"../pixel.js\").Pixel}\n     * @private\n     */\n    this.lastPixel_ = [0, 0];\n\n    /**\n     * Tracks if the next `singleclick` event should be ignored to prevent\n     * accidental deletion right after vertex creation.\n     * @type {boolean}\n     * @private\n     */\n    this.ignoreNextSingleClick_ = false;\n\n    /**\n     * @type {Collection<Feature>}\n     * @private\n     */\n    this.featuresBeingModified_ = null;\n\n    /**\n     * Segment RTree for each layer\n     * @type {RBush<SegmentData>}\n     * @private\n     */\n    this.rBush_ = new RBush();\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.pixelTolerance_ =\n      options.pixelTolerance !== undefined ? options.pixelTolerance : 10;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.snappedToVertex_ = false;\n\n    /**\n     * Indicate whether the interaction is currently changing a feature's\n     * coordinates.\n     * @type {boolean}\n     * @private\n     */\n    this.changingFeature_ = false;\n\n    /**\n     * @type {Array}\n     * @private\n     */\n    this.dragSegments_ = [];\n\n    /**\n     * Draw overlay where sketch features are drawn.\n     * @type {VectorLayer}\n     * @private\n     */\n    this.overlay_ = new VectorLayer({\n      source: new VectorSource({\n        useSpatialIndex: false,\n        wrapX: !!options.wrapX,\n      }),\n      style: options.style ? options.style : getDefaultStyleFunction(),\n      updateWhileAnimating: true,\n      updateWhileInteracting: true,\n    });\n\n    /**\n     * @const\n     * @private\n     * @type {!Object<string, function(Feature, import(\"../geom/Geometry.js\").default): void>}\n     */\n    this.SEGMENT_WRITERS_ = {\n      'Point': this.writePointGeometry_.bind(this),\n      'LineString': this.writeLineStringGeometry_.bind(this),\n      'LinearRing': this.writeLineStringGeometry_.bind(this),\n      'Polygon': this.writePolygonGeometry_.bind(this),\n      'MultiPoint': this.writeMultiPointGeometry_.bind(this),\n      'MultiLineString': this.writeMultiLineStringGeometry_.bind(this),\n      'MultiPolygon': this.writeMultiPolygonGeometry_.bind(this),\n      'Circle': this.writeCircleGeometry_.bind(this),\n      'GeometryCollection': this.writeGeometryCollectionGeometry_.bind(this),\n    };\n\n    /**\n     * @type {VectorSource}\n     * @private\n     */\n    this.source_ = null;\n\n    /**\n     * @type {boolean|import(\"../layer/BaseVector\").default}\n     */\n    this.hitDetection_ = null;\n\n    /** @type {Collection<Feature>} */\n    let features;\n    if (options.features) {\n      features = options.features;\n    } else if (options.source) {\n      this.source_ = options.source;\n      features = new Collection(this.source_.getFeatures());\n      this.source_.addEventListener(\n        VectorEventType.ADDFEATURE,\n        this.handleSourceAdd_.bind(this),\n      );\n      this.source_.addEventListener(\n        VectorEventType.REMOVEFEATURE,\n        this.handleSourceRemove_.bind(this),\n      );\n    }\n    if (!features) {\n      throw new Error(\n        'The modify interaction requires features, a source or a layer',\n      );\n    }\n    if (options.hitDetection) {\n      this.hitDetection_ = options.hitDetection;\n    }\n\n    /**\n     * @type {Collection<Feature>}\n     * @private\n     */\n    this.features_ = features;\n\n    this.features_.forEach(this.addFeature_.bind(this));\n    this.features_.addEventListener(\n      CollectionEventType.ADD,\n      this.handleFeatureAdd_.bind(this),\n    );\n    this.features_.addEventListener(\n      CollectionEventType.REMOVE,\n      this.handleFeatureRemove_.bind(this),\n    );\n\n    /**\n     * @type {import(\"../MapBrowserEvent.js\").default}\n     * @private\n     */\n    this.lastPointerEvent_ = null;\n\n    /**\n     * Delta (x, y in map units) between matched rtree vertex and pointer vertex.\n     * @type {Array<number>}\n     */\n    this.delta_ = [0, 0];\n\n    /**\n     * @private\n     */\n    this.snapToPointer_ =\n      options.snapToPointer === undefined\n        ? !this.hitDetection_\n        : options.snapToPointer;\n  }\n\n  /**\n   * @param {Feature} feature Feature.\n   * @private\n   */\n  addFeature_(feature) {\n    const geometry = feature.getGeometry();\n    if (geometry) {\n      const writer = this.SEGMENT_WRITERS_[geometry.getType()];\n      if (writer) {\n        writer(feature, geometry);\n      }\n    }\n    const map = this.getMap();\n    if (map && map.isRendered() && this.getActive()) {\n      this.handlePointerAtPixel_(this.lastPixel_, map);\n    }\n    feature.addEventListener(EventType.CHANGE, this.boundHandleFeatureChange_);\n  }\n\n  /**\n   * @param {import(\"../MapBrowserEvent.js\").default} evt Map browser event.\n   * @param {Array<Array<SegmentData>>} segments The segments subject to modification.\n   * @private\n   */\n  willModifyFeatures_(evt, segments) {\n    if (!this.featuresBeingModified_) {\n      this.featuresBeingModified_ = new Collection();\n      const features = this.featuresBeingModified_.getArray();\n      for (let i = 0, ii = segments.length; i < ii; ++i) {\n        const segment = segments[i];\n        for (let s = 0, ss = segment.length; s < ss; ++s) {\n          const feature = segment[s].feature;\n          if (feature && !features.includes(feature)) {\n            this.featuresBeingModified_.push(feature);\n          }\n        }\n      }\n      if (this.featuresBeingModified_.getLength() === 0) {\n        this.featuresBeingModified_ = null;\n      } else {\n        this.dispatchEvent(\n          new ModifyEvent(\n            ModifyEventType.MODIFYSTART,\n            this.featuresBeingModified_,\n            evt,\n          ),\n        );\n      }\n    }\n  }\n\n  /**\n   * @param {Feature} feature Feature.\n   * @private\n   */\n  removeFeature_(feature) {\n    this.removeFeatureSegmentData_(feature);\n    // Remove the vertex feature if the collection of candidate features is empty.\n    if (this.vertexFeature_ && this.features_.getLength() === 0) {\n      this.overlay_.getSource().removeFeature(this.vertexFeature_);\n      this.vertexFeature_ = null;\n    }\n    feature.removeEventListener(\n      EventType.CHANGE,\n      this.boundHandleFeatureChange_,\n    );\n  }\n\n  /**\n   * @param {Feature} feature Feature.\n   * @private\n   */\n  removeFeatureSegmentData_(feature) {\n    const rBush = this.rBush_;\n    /** @type {Array<SegmentData>} */\n    const nodesToRemove = [];\n    rBush.forEach(\n      /**\n       * @param {SegmentData} node RTree node.\n       */\n      function (node) {\n        if (feature === node.feature) {\n          nodesToRemove.push(node);\n        }\n      },\n    );\n    for (let i = nodesToRemove.length - 1; i >= 0; --i) {\n      const nodeToRemove = nodesToRemove[i];\n      for (let j = this.dragSegments_.length - 1; j >= 0; --j) {\n        if (this.dragSegments_[j][0] === nodeToRemove) {\n          this.dragSegments_.splice(j, 1);\n        }\n      }\n      rBush.remove(nodeToRemove);\n    }\n  }\n\n  /**\n   * Activate or deactivate the interaction.\n   * @param {boolean} active Active.\n   * @observable\n   * @api\n   */\n  setActive(active) {\n    if (this.vertexFeature_ && !active) {\n      this.overlay_.getSource().removeFeature(this.vertexFeature_);\n      this.vertexFeature_ = null;\n    }\n    super.setActive(active);\n  }\n\n  /**\n   * Remove the interaction from its current map and attach it to the new map.\n   * Subclasses may set up event handlers to get notified about changes to\n   * the map here.\n   * @param {import(\"../Map.js\").default} map Map.\n   */\n  setMap(map) {\n    this.overlay_.setMap(map);\n    super.setMap(map);\n  }\n\n  /**\n   * Get the overlay layer that this interaction renders the modification point or vertex to.\n   * @return {VectorLayer} Overlay layer.\n   * @api\n   */\n  getOverlay() {\n    return this.overlay_;\n  }\n\n  /**\n   * @param {import(\"../source/Vector.js\").VectorSourceEvent} event Event.\n   * @private\n   */\n  handleSourceAdd_(event) {\n    if (event.feature) {\n      this.features_.push(event.feature);\n    }\n  }\n\n  /**\n   * @param {import(\"../source/Vector.js\").VectorSourceEvent} event Event.\n   * @private\n   */\n  handleSourceRemove_(event) {\n    if (event.feature) {\n      this.features_.remove(event.feature);\n    }\n  }\n\n  /**\n   * @param {import(\"../Collection.js\").CollectionEvent<Feature>} evt Event.\n   * @private\n   */\n  handleFeatureAdd_(evt) {\n    this.addFeature_(evt.element);\n  }\n\n  /**\n   * @param {import(\"../events/Event.js\").default} evt Event.\n   * @private\n   */\n  handleFeatureChange_(evt) {\n    if (!this.changingFeature_) {\n      const feature = /** @type {Feature} */ (evt.target);\n      this.removeFeature_(feature);\n      this.addFeature_(feature);\n    }\n  }\n\n  /**\n   * @param {import(\"../Collection.js\").CollectionEvent<Feature>} evt Event.\n   * @private\n   */\n  handleFeatureRemove_(evt) {\n    this.removeFeature_(evt.element);\n  }\n\n  /**\n   * @param {Feature} feature Feature\n   * @param {Point} geometry Geometry.\n   * @private\n   */\n  writePointGeometry_(feature, geometry) {\n    const coordinates = geometry.getCoordinates();\n\n    /** @type {SegmentData} */\n    const segmentData = {\n      feature: feature,\n      geometry: geometry,\n      segment: [coordinates, coordinates],\n    };\n\n    this.rBush_.insert(geometry.getExtent(), segmentData);\n  }\n\n  /**\n   * @param {Feature} feature Feature\n   * @param {import(\"../geom/MultiPoint.js\").default} geometry Geometry.\n   * @private\n   */\n  writeMultiPointGeometry_(feature, geometry) {\n    const points = geometry.getCoordinates();\n    for (let i = 0, ii = points.length; i < ii; ++i) {\n      const coordinates = points[i];\n\n      /** @type {SegmentData} */\n      const segmentData = {\n        feature: feature,\n        geometry: geometry,\n        depth: [i],\n        index: i,\n        segment: [coordinates, coordinates],\n      };\n\n      this.rBush_.insert(geometry.getExtent(), segmentData);\n    }\n  }\n\n  /**\n   * @param {Feature} feature Feature\n   * @param {import(\"../geom/LineString.js\").default} geometry Geometry.\n   * @private\n   */\n  writeLineStringGeometry_(feature, geometry) {\n    const coordinates = geometry.getCoordinates();\n    for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n      const segment = coordinates.slice(i, i + 2);\n\n      /** @type {SegmentData} */\n      const segmentData = {\n        feature: feature,\n        geometry: geometry,\n        index: i,\n        segment: segment,\n      };\n\n      this.rBush_.insert(boundingExtent(segment), segmentData);\n    }\n  }\n\n  /**\n   * @param {Feature} feature Feature\n   * @param {import(\"../geom/MultiLineString.js\").default} geometry Geometry.\n   * @private\n   */\n  writeMultiLineStringGeometry_(feature, geometry) {\n    const lines = geometry.getCoordinates();\n    for (let j = 0, jj = lines.length; j < jj; ++j) {\n      const coordinates = lines[j];\n      for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n        const segment = coordinates.slice(i, i + 2);\n\n        /** @type {SegmentData} */\n        const segmentData = {\n          feature: feature,\n          geometry: geometry,\n          depth: [j],\n          index: i,\n          segment: segment,\n        };\n\n        this.rBush_.insert(boundingExtent(segment), segmentData);\n      }\n    }\n  }\n\n  /**\n   * @param {Feature} feature Feature\n   * @param {import(\"../geom/Polygon.js\").default} geometry Geometry.\n   * @private\n   */\n  writePolygonGeometry_(feature, geometry) {\n    const rings = geometry.getCoordinates();\n    for (let j = 0, jj = rings.length; j < jj; ++j) {\n      const coordinates = rings[j];\n      for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n        const segment = coordinates.slice(i, i + 2);\n\n        /** @type {SegmentData} */\n        const segmentData = {\n          feature: feature,\n          geometry: geometry,\n          depth: [j],\n          index: i,\n          segment: segment,\n        };\n\n        this.rBush_.insert(boundingExtent(segment), segmentData);\n      }\n    }\n  }\n\n  /**\n   * @param {Feature} feature Feature\n   * @param {import(\"../geom/MultiPolygon.js\").default} geometry Geometry.\n   * @private\n   */\n  writeMultiPolygonGeometry_(feature, geometry) {\n    const polygons = geometry.getCoordinates();\n    for (let k = 0, kk = polygons.length; k < kk; ++k) {\n      const rings = polygons[k];\n      for (let j = 0, jj = rings.length; j < jj; ++j) {\n        const coordinates = rings[j];\n        for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n          const segment = coordinates.slice(i, i + 2);\n\n          /** @type {SegmentData} */\n          const segmentData = {\n            feature: feature,\n            geometry: geometry,\n            depth: [j, k],\n            index: i,\n            segment: segment,\n          };\n\n          this.rBush_.insert(boundingExtent(segment), segmentData);\n        }\n      }\n    }\n  }\n\n  /**\n   * We convert a circle into two segments.  The segment at index\n   * {@link CIRCLE_CENTER_INDEX} is the\n   * circle's center (a point).  The segment at index\n   * {@link CIRCLE_CIRCUMFERENCE_INDEX} is\n   * the circumference, and is not a line segment.\n   *\n   * @param {Feature} feature Feature.\n   * @param {import(\"../geom/Circle.js\").default} geometry Geometry.\n   * @private\n   */\n  writeCircleGeometry_(feature, geometry) {\n    const coordinates = geometry.getCenter();\n\n    /** @type {SegmentData} */\n    const centerSegmentData = {\n      feature: feature,\n      geometry: geometry,\n      index: CIRCLE_CENTER_INDEX,\n      segment: [coordinates, coordinates],\n    };\n\n    /** @type {SegmentData} */\n    const circumferenceSegmentData = {\n      feature: feature,\n      geometry: geometry,\n      index: CIRCLE_CIRCUMFERENCE_INDEX,\n      segment: [coordinates, coordinates],\n    };\n\n    const featureSegments = [centerSegmentData, circumferenceSegmentData];\n    centerSegmentData.featureSegments = featureSegments;\n    circumferenceSegmentData.featureSegments = featureSegments;\n    this.rBush_.insert(createExtent(coordinates), centerSegmentData);\n    let circleGeometry = /** @type {import(\"../geom/Geometry.js\").default} */ (\n      geometry\n    );\n    const userProjection = getUserProjection();\n    if (userProjection && this.getMap()) {\n      const projection = this.getMap().getView().getProjection();\n      circleGeometry = circleGeometry\n        .clone()\n        .transform(userProjection, projection);\n      circleGeometry = fromCircle(\n        /** @type {import(\"../geom/Circle.js\").default} */ (circleGeometry),\n      ).transform(projection, userProjection);\n    }\n    this.rBush_.insert(circleGeometry.getExtent(), circumferenceSegmentData);\n  }\n\n  /**\n   * @param {Feature} feature Feature\n   * @param {import(\"../geom/GeometryCollection.js\").default} geometry Geometry.\n   * @private\n   */\n  writeGeometryCollectionGeometry_(feature, geometry) {\n    const geometries = geometry.getGeometriesArray();\n    for (let i = 0; i < geometries.length; ++i) {\n      const geometry = geometries[i];\n      const writer = this.SEGMENT_WRITERS_[geometry.getType()];\n      writer(feature, geometry);\n    }\n  }\n\n  /**\n   * @param {import(\"../coordinate.js\").Coordinate} coordinates Coordinates.\n   * @param {Array<Feature>} features The features being modified.\n   * @param {Array<import(\"../geom/SimpleGeometry.js\").default>} geometries The geometries being modified.\n   * @return {Feature} Vertex feature.\n   * @private\n   */\n  createOrUpdateVertexFeature_(coordinates, features, geometries) {\n    let vertexFeature = this.vertexFeature_;\n    if (!vertexFeature) {\n      vertexFeature = new Feature(new Point(coordinates));\n      this.vertexFeature_ = vertexFeature;\n      this.overlay_.getSource().addFeature(vertexFeature);\n    } else {\n      const geometry = vertexFeature.getGeometry();\n      geometry.setCoordinates(coordinates);\n    }\n    vertexFeature.set('features', features);\n    vertexFeature.set('geometries', geometries);\n    return vertexFeature;\n  }\n\n  /**\n   * Handles the {@link module:ol/MapBrowserEvent~MapBrowserEvent map browser event} and may modify the geometry.\n   * @param {import(\"../MapBrowserEvent.js\").default} mapBrowserEvent Map browser event.\n   * @return {boolean} `false` to stop event propagation.\n   */\n  handleEvent(mapBrowserEvent) {\n    if (!mapBrowserEvent.originalEvent) {\n      return true;\n    }\n    this.lastPointerEvent_ = mapBrowserEvent;\n\n    let handled;\n    if (\n      !mapBrowserEvent.map.getView().getInteracting() &&\n      mapBrowserEvent.type == MapBrowserEventType.POINTERMOVE &&\n      !this.handlingDownUpSequence\n    ) {\n      this.handlePointerMove_(mapBrowserEvent);\n    }\n    if (this.vertexFeature_ && this.deleteCondition_(mapBrowserEvent)) {\n      if (\n        mapBrowserEvent.type != MapBrowserEventType.SINGLECLICK ||\n        !this.ignoreNextSingleClick_\n      ) {\n        handled = this.removePoint();\n      } else {\n        handled = true;\n      }\n    }\n\n    if (mapBrowserEvent.type == MapBrowserEventType.SINGLECLICK) {\n      this.ignoreNextSingleClick_ = false;\n    }\n\n    return super.handleEvent(mapBrowserEvent) && !handled;\n  }\n\n  /**\n   * Handle pointer drag events.\n   * @param {import(\"../MapBrowserEvent.js\").default} evt Event.\n   */\n  handleDragEvent(evt) {\n    this.ignoreNextSingleClick_ = false;\n    this.willModifyFeatures_(evt, this.dragSegments_);\n\n    const vertex = [\n      evt.coordinate[0] + this.delta_[0],\n      evt.coordinate[1] + this.delta_[1],\n    ];\n    const features = [];\n    const geometries = [];\n    for (let i = 0, ii = this.dragSegments_.length; i < ii; ++i) {\n      const dragSegment = this.dragSegments_[i];\n      const segmentData = dragSegment[0];\n      const feature = segmentData.feature;\n      if (!features.includes(feature)) {\n        features.push(feature);\n      }\n      const geometry = segmentData.geometry;\n      if (!geometries.includes(geometry)) {\n        geometries.push(geometry);\n      }\n      const depth = segmentData.depth;\n      let coordinates;\n      const segment = segmentData.segment;\n      const index = dragSegment[1];\n\n      while (vertex.length < geometry.getStride()) {\n        vertex.push(segment[index][vertex.length]);\n      }\n\n      switch (geometry.getType()) {\n        case 'Point':\n          coordinates = vertex;\n          segment[0] = vertex;\n          segment[1] = vertex;\n          break;\n        case 'MultiPoint':\n          coordinates = geometry.getCoordinates();\n          coordinates[segmentData.index] = vertex;\n          segment[0] = vertex;\n          segment[1] = vertex;\n          break;\n        case 'LineString':\n          coordinates = geometry.getCoordinates();\n          coordinates[segmentData.index + index] = vertex;\n          segment[index] = vertex;\n          break;\n        case 'MultiLineString':\n          coordinates = geometry.getCoordinates();\n          coordinates[depth[0]][segmentData.index + index] = vertex;\n          segment[index] = vertex;\n          break;\n        case 'Polygon':\n          coordinates = geometry.getCoordinates();\n          coordinates[depth[0]][segmentData.index + index] = vertex;\n          segment[index] = vertex;\n          break;\n        case 'MultiPolygon':\n          coordinates = geometry.getCoordinates();\n          coordinates[depth[1]][depth[0]][segmentData.index + index] = vertex;\n          segment[index] = vertex;\n          break;\n        case 'Circle':\n          segment[0] = vertex;\n          segment[1] = vertex;\n          if (segmentData.index === CIRCLE_CENTER_INDEX) {\n            this.changingFeature_ = true;\n            geometry.setCenter(vertex);\n            this.changingFeature_ = false;\n          } else {\n            // We're dragging the circle's circumference:\n            this.changingFeature_ = true;\n            const projection = evt.map.getView().getProjection();\n            let radius = coordinateDistance(\n              fromUserCoordinate(geometry.getCenter(), projection),\n              fromUserCoordinate(vertex, projection),\n            );\n            const userProjection = getUserProjection();\n            if (userProjection) {\n              const circleGeometry = geometry\n                .clone()\n                .transform(userProjection, projection);\n              circleGeometry.setRadius(radius);\n              radius = circleGeometry\n                .transform(projection, userProjection)\n                .getRadius();\n            }\n            geometry.setRadius(radius);\n            this.changingFeature_ = false;\n          }\n          break;\n        default:\n        // pass\n      }\n\n      if (coordinates) {\n        this.setGeometryCoordinates_(geometry, coordinates);\n      }\n    }\n    this.createOrUpdateVertexFeature_(vertex, features, geometries);\n  }\n\n  /**\n   * Handle pointer down events.\n   * @param {import(\"../MapBrowserEvent.js\").default} evt Event.\n   * @return {boolean} If the event was consumed.\n   */\n  handleDownEvent(evt) {\n    if (!this.condition_(evt)) {\n      return false;\n    }\n    const pixelCoordinate = evt.coordinate;\n    this.handlePointerAtPixel_(evt.pixel, evt.map, pixelCoordinate);\n    this.dragSegments_.length = 0;\n    this.featuresBeingModified_ = null;\n    const vertexFeature = this.vertexFeature_;\n    if (vertexFeature) {\n      const projection = evt.map.getView().getProjection();\n      const insertVertices = [];\n      const vertex = vertexFeature.getGeometry().getCoordinates();\n      const vertexExtent = boundingExtent([vertex]);\n      const segmentDataMatches = this.rBush_.getInExtent(vertexExtent);\n      const componentSegments = {};\n      segmentDataMatches.sort(compareIndexes);\n      for (let i = 0, ii = segmentDataMatches.length; i < ii; ++i) {\n        const segmentDataMatch = segmentDataMatches[i];\n        const segment = segmentDataMatch.segment;\n        let uid = getUid(segmentDataMatch.geometry);\n        const depth = segmentDataMatch.depth;\n        if (depth) {\n          uid += '-' + depth.join('-'); // separate feature components\n        }\n        if (!componentSegments[uid]) {\n          componentSegments[uid] = new Array(2);\n        }\n\n        if (\n          segmentDataMatch.geometry.getType() === 'Circle' &&\n          segmentDataMatch.index === CIRCLE_CIRCUMFERENCE_INDEX\n        ) {\n          const closestVertex = closestOnSegmentData(\n            pixelCoordinate,\n            segmentDataMatch,\n            projection,\n          );\n          if (\n            coordinatesEqual(closestVertex, vertex) &&\n            !componentSegments[uid][0]\n          ) {\n            this.dragSegments_.push([segmentDataMatch, 0]);\n            componentSegments[uid][0] = segmentDataMatch;\n          }\n          continue;\n        }\n\n        if (\n          coordinatesEqual(segment[0], vertex) &&\n          !componentSegments[uid][0]\n        ) {\n          this.dragSegments_.push([segmentDataMatch, 0]);\n          componentSegments[uid][0] = segmentDataMatch;\n          continue;\n        }\n\n        if (\n          coordinatesEqual(segment[1], vertex) &&\n          !componentSegments[uid][1]\n        ) {\n          if (\n            componentSegments[uid][0] &&\n            componentSegments[uid][0].index === 0\n          ) {\n            let coordinates = segmentDataMatch.geometry.getCoordinates();\n            switch (segmentDataMatch.geometry.getType()) {\n              // prevent dragging closed linestrings by the connecting node\n              case 'LineString':\n              case 'MultiLineString':\n                continue;\n              // if dragging the first vertex of a polygon, ensure the other segment\n              // belongs to the closing vertex of the linear ring\n              case 'MultiPolygon':\n                coordinates = coordinates[depth[1]];\n              /* falls through */\n              case 'Polygon':\n                if (\n                  segmentDataMatch.index !==\n                  coordinates[depth[0]].length - 2\n                ) {\n                  continue;\n                }\n                break;\n              default:\n              // pass\n            }\n          }\n\n          this.dragSegments_.push([segmentDataMatch, 1]);\n          componentSegments[uid][1] = segmentDataMatch;\n          continue;\n        }\n\n        if (\n          getUid(segment) in this.vertexSegments_ &&\n          !componentSegments[uid][0] &&\n          !componentSegments[uid][1] &&\n          this.insertVertexCondition_(evt)\n        ) {\n          insertVertices.push(segmentDataMatch);\n        }\n      }\n\n      if (insertVertices.length) {\n        this.willModifyFeatures_(evt, [insertVertices]);\n      }\n\n      for (let j = insertVertices.length - 1; j >= 0; --j) {\n        this.insertVertex_(insertVertices[j], vertex);\n      }\n    }\n    return !!this.vertexFeature_;\n  }\n\n  /**\n   * Handle pointer up events.\n   * @param {import(\"../MapBrowserEvent.js\").default} evt Event.\n   * @return {boolean} If the event was consumed.\n   */\n  handleUpEvent(evt) {\n    for (let i = this.dragSegments_.length - 1; i >= 0; --i) {\n      const segmentData = this.dragSegments_[i][0];\n      const geometry = segmentData.geometry;\n      if (geometry.getType() === 'Circle') {\n        // Update a circle object in the R* bush:\n        const coordinates = geometry.getCenter();\n        const centerSegmentData = segmentData.featureSegments[0];\n        const circumferenceSegmentData = segmentData.featureSegments[1];\n        centerSegmentData.segment[0] = coordinates;\n        centerSegmentData.segment[1] = coordinates;\n        circumferenceSegmentData.segment[0] = coordinates;\n        circumferenceSegmentData.segment[1] = coordinates;\n        this.rBush_.update(createExtent(coordinates), centerSegmentData);\n        let circleGeometry = geometry;\n        const userProjection = getUserProjection();\n        if (userProjection) {\n          const projection = evt.map.getView().getProjection();\n          circleGeometry = circleGeometry\n            .clone()\n            .transform(userProjection, projection);\n          circleGeometry = fromCircle(circleGeometry).transform(\n            projection,\n            userProjection,\n          );\n        }\n        this.rBush_.update(\n          circleGeometry.getExtent(),\n          circumferenceSegmentData,\n        );\n      } else {\n        this.rBush_.update(boundingExtent(segmentData.segment), segmentData);\n      }\n    }\n    if (this.featuresBeingModified_) {\n      this.dispatchEvent(\n        new ModifyEvent(\n          ModifyEventType.MODIFYEND,\n          this.featuresBeingModified_,\n          evt,\n        ),\n      );\n      this.featuresBeingModified_ = null;\n    }\n    return false;\n  }\n\n  /**\n   * @param {import(\"../MapBrowserEvent.js\").default} evt Event.\n   * @private\n   */\n  handlePointerMove_(evt) {\n    this.lastPixel_ = evt.pixel;\n    this.handlePointerAtPixel_(evt.pixel, evt.map, evt.coordinate);\n  }\n\n  /**\n   * @param {import(\"../pixel.js\").Pixel} pixel Pixel\n   * @param {import(\"../Map.js\").default} map Map.\n   * @param {import(\"../coordinate.js\").Coordinate} [coordinate] The pixel Coordinate.\n   * @private\n   */\n  handlePointerAtPixel_(pixel, map, coordinate) {\n    const pixelCoordinate = coordinate || map.getCoordinateFromPixel(pixel);\n    const projection = map.getView().getProjection();\n    const sortByDistance = function (a, b) {\n      return (\n        projectedDistanceToSegmentDataSquared(pixelCoordinate, a, projection) -\n        projectedDistanceToSegmentDataSquared(pixelCoordinate, b, projection)\n      );\n    };\n\n    /** @type {Array<SegmentData>|undefined} */\n    let nodes;\n    /** @type {Point|undefined} */\n    let hitPointGeometry;\n    if (this.hitDetection_) {\n      const layerFilter =\n        typeof this.hitDetection_ === 'object'\n          ? (layer) => layer === this.hitDetection_\n          : undefined;\n      map.forEachFeatureAtPixel(\n        pixel,\n        (feature, layer, geometry) => {\n          if (geometry && geometry.getType() === 'Point') {\n            geometry = new Point(\n              toUserCoordinate(geometry.getCoordinates(), projection),\n            );\n          }\n          const geom = geometry || feature.getGeometry();\n          if (\n            feature instanceof Feature &&\n            this.features_.getArray().includes(feature)\n          ) {\n            hitPointGeometry = /** @type {Point} */ (geom);\n            const coordinate = /** @type {Point} */ (feature.getGeometry())\n              .getFlatCoordinates()\n              .slice(0, 2);\n            nodes = [\n              {\n                feature,\n                geometry: hitPointGeometry,\n                segment: [coordinate, coordinate],\n              },\n            ];\n          }\n          return true;\n        },\n        {layerFilter},\n      );\n    }\n    if (!nodes) {\n      const viewExtent = fromUserExtent(\n        createExtent(pixelCoordinate, tempExtent),\n        projection,\n      );\n      const buffer = map.getView().getResolution() * this.pixelTolerance_;\n      const box = toUserExtent(\n        bufferExtent(viewExtent, buffer, tempExtent),\n        projection,\n      );\n      nodes = this.rBush_.getInExtent(box);\n    }\n\n    if (nodes && nodes.length > 0) {\n      const node = nodes.sort(sortByDistance)[0];\n      const closestSegment = node.segment;\n      let vertex = closestOnSegmentData(pixelCoordinate, node, projection);\n      const vertexPixel = map.getPixelFromCoordinate(vertex);\n      let dist = coordinateDistance(pixel, vertexPixel);\n      if (hitPointGeometry || dist <= this.pixelTolerance_) {\n        /** @type {Object<string, boolean>} */\n        const vertexSegments = {};\n        vertexSegments[getUid(closestSegment)] = true;\n\n        if (!this.snapToPointer_) {\n          this.delta_[0] = vertex[0] - pixelCoordinate[0];\n          this.delta_[1] = vertex[1] - pixelCoordinate[1];\n        }\n        if (\n          node.geometry.getType() === 'Circle' &&\n          node.index === CIRCLE_CIRCUMFERENCE_INDEX\n        ) {\n          this.snappedToVertex_ = true;\n          this.createOrUpdateVertexFeature_(\n            vertex,\n            [node.feature],\n            [node.geometry],\n          );\n        } else {\n          const pixel1 = map.getPixelFromCoordinate(closestSegment[0]);\n          const pixel2 = map.getPixelFromCoordinate(closestSegment[1]);\n          const squaredDist1 = squaredCoordinateDistance(vertexPixel, pixel1);\n          const squaredDist2 = squaredCoordinateDistance(vertexPixel, pixel2);\n          dist = Math.sqrt(Math.min(squaredDist1, squaredDist2));\n          this.snappedToVertex_ = dist <= this.pixelTolerance_;\n          if (this.snappedToVertex_) {\n            vertex =\n              squaredDist1 > squaredDist2\n                ? closestSegment[1]\n                : closestSegment[0];\n          }\n          this.createOrUpdateVertexFeature_(\n            vertex,\n            [node.feature],\n            [node.geometry],\n          );\n          const geometries = {};\n          geometries[getUid(node.geometry)] = true;\n          for (let i = 1, ii = nodes.length; i < ii; ++i) {\n            const segment = nodes[i].segment;\n            if (\n              (coordinatesEqual(closestSegment[0], segment[0]) &&\n                coordinatesEqual(closestSegment[1], segment[1])) ||\n              (coordinatesEqual(closestSegment[0], segment[1]) &&\n                coordinatesEqual(closestSegment[1], segment[0]))\n            ) {\n              const geometryUid = getUid(nodes[i].geometry);\n              if (!(geometryUid in geometries)) {\n                geometries[geometryUid] = true;\n                vertexSegments[getUid(segment)] = true;\n              }\n            } else {\n              break;\n            }\n          }\n        }\n\n        this.vertexSegments_ = vertexSegments;\n        return;\n      }\n    }\n    if (this.vertexFeature_) {\n      this.overlay_.getSource().removeFeature(this.vertexFeature_);\n      this.vertexFeature_ = null;\n    }\n  }\n\n  /**\n   * @param {SegmentData} segmentData Segment data.\n   * @param {import(\"../coordinate.js\").Coordinate} vertex Vertex.\n   * @private\n   */\n  insertVertex_(segmentData, vertex) {\n    const segment = segmentData.segment;\n    const feature = segmentData.feature;\n    const geometry = segmentData.geometry;\n    const depth = segmentData.depth;\n    const index = segmentData.index;\n    let coordinates;\n\n    while (vertex.length < geometry.getStride()) {\n      vertex.push(0);\n    }\n\n    switch (geometry.getType()) {\n      case 'MultiLineString':\n        coordinates = geometry.getCoordinates();\n        coordinates[depth[0]].splice(index + 1, 0, vertex);\n        break;\n      case 'Polygon':\n        coordinates = geometry.getCoordinates();\n        coordinates[depth[0]].splice(index + 1, 0, vertex);\n        break;\n      case 'MultiPolygon':\n        coordinates = geometry.getCoordinates();\n        coordinates[depth[1]][depth[0]].splice(index + 1, 0, vertex);\n        break;\n      case 'LineString':\n        coordinates = geometry.getCoordinates();\n        coordinates.splice(index + 1, 0, vertex);\n        break;\n      default:\n        return;\n    }\n\n    this.setGeometryCoordinates_(geometry, coordinates);\n    const rTree = this.rBush_;\n    rTree.remove(segmentData);\n    this.updateSegmentIndices_(geometry, index, depth, 1);\n\n    /** @type {SegmentData} */\n    const newSegmentData = {\n      segment: [segment[0], vertex],\n      feature: feature,\n      geometry: geometry,\n      depth: depth,\n      index: index,\n    };\n\n    rTree.insert(boundingExtent(newSegmentData.segment), newSegmentData);\n    this.dragSegments_.push([newSegmentData, 1]);\n\n    /** @type {SegmentData} */\n    const newSegmentData2 = {\n      segment: [vertex, segment[1]],\n      feature: feature,\n      geometry: geometry,\n      depth: depth,\n      index: index + 1,\n    };\n\n    rTree.insert(boundingExtent(newSegmentData2.segment), newSegmentData2);\n    this.dragSegments_.push([newSegmentData2, 0]);\n    this.ignoreNextSingleClick_ = true;\n  }\n\n  /**\n   * Removes the vertex currently being pointed.\n   * @return {boolean} True when a vertex was removed.\n   * @api\n   */\n  removePoint() {\n    if (\n      this.lastPointerEvent_ &&\n      this.lastPointerEvent_.type != MapBrowserEventType.POINTERDRAG\n    ) {\n      const evt = this.lastPointerEvent_;\n      this.willModifyFeatures_(evt, this.dragSegments_);\n      const removed = this.removeVertex_();\n      if (this.featuresBeingModified_) {\n        this.dispatchEvent(\n          new ModifyEvent(\n            ModifyEventType.MODIFYEND,\n            this.featuresBeingModified_,\n            evt,\n          ),\n        );\n      }\n\n      this.featuresBeingModified_ = null;\n      return removed;\n    }\n    return false;\n  }\n\n  /**\n   * Removes a vertex from all matching features.\n   * @return {boolean} True when a vertex was removed.\n   * @private\n   */\n  removeVertex_() {\n    const dragSegments = this.dragSegments_;\n    const segmentsByFeature = {};\n    let deleted = false;\n    let component, coordinates, dragSegment, geometry, i, index, left;\n    let newIndex, right, segmentData, uid;\n    for (i = dragSegments.length - 1; i >= 0; --i) {\n      dragSegment = dragSegments[i];\n      segmentData = dragSegment[0];\n      uid = getUid(segmentData.feature);\n      if (segmentData.depth) {\n        // separate feature components\n        uid += '-' + segmentData.depth.join('-');\n      }\n      if (!(uid in segmentsByFeature)) {\n        segmentsByFeature[uid] = {};\n      }\n      if (dragSegment[1] === 0) {\n        segmentsByFeature[uid].right = segmentData;\n        segmentsByFeature[uid].index = segmentData.index;\n      } else if (dragSegment[1] == 1) {\n        segmentsByFeature[uid].left = segmentData;\n        segmentsByFeature[uid].index = segmentData.index + 1;\n      }\n    }\n    for (uid in segmentsByFeature) {\n      right = segmentsByFeature[uid].right;\n      left = segmentsByFeature[uid].left;\n      index = segmentsByFeature[uid].index;\n      newIndex = index - 1;\n      if (left !== undefined) {\n        segmentData = left;\n      } else {\n        segmentData = right;\n      }\n      if (newIndex < 0) {\n        newIndex = 0;\n      }\n      geometry = segmentData.geometry;\n      coordinates = geometry.getCoordinates();\n      component = coordinates;\n      deleted = false;\n      switch (geometry.getType()) {\n        case 'MultiLineString':\n          if (coordinates[segmentData.depth[0]].length > 2) {\n            coordinates[segmentData.depth[0]].splice(index, 1);\n            deleted = true;\n          }\n          break;\n        case 'LineString':\n          if (coordinates.length > 2) {\n            coordinates.splice(index, 1);\n            deleted = true;\n          }\n          break;\n        case 'MultiPolygon':\n          component = component[segmentData.depth[1]];\n        /* falls through */\n        case 'Polygon':\n          component = component[segmentData.depth[0]];\n          if (component.length > 4) {\n            if (index == component.length - 1) {\n              index = 0;\n            }\n            component.splice(index, 1);\n            deleted = true;\n            if (index === 0) {\n              // close the ring again\n              component.pop();\n              component.push(component[0]);\n              newIndex = component.length - 1;\n            }\n          }\n          break;\n        default:\n        // pass\n      }\n\n      if (deleted) {\n        this.setGeometryCoordinates_(geometry, coordinates);\n        const segments = [];\n        if (left !== undefined) {\n          this.rBush_.remove(left);\n          segments.push(left.segment[0]);\n        }\n        if (right !== undefined) {\n          this.rBush_.remove(right);\n          segments.push(right.segment[1]);\n        }\n        if (left !== undefined && right !== undefined) {\n          /** @type {SegmentData} */\n          const newSegmentData = {\n            depth: segmentData.depth,\n            feature: segmentData.feature,\n            geometry: segmentData.geometry,\n            index: newIndex,\n            segment: segments,\n          };\n\n          this.rBush_.insert(\n            boundingExtent(newSegmentData.segment),\n            newSegmentData,\n          );\n        }\n        this.updateSegmentIndices_(geometry, index, segmentData.depth, -1);\n        if (this.vertexFeature_) {\n          this.overlay_.getSource().removeFeature(this.vertexFeature_);\n          this.vertexFeature_ = null;\n        }\n        dragSegments.length = 0;\n      }\n    }\n    return deleted;\n  }\n\n  /**\n   * @param {import(\"../geom/SimpleGeometry.js\").default} geometry Geometry.\n   * @param {Array} coordinates Coordinates.\n   * @private\n   */\n  setGeometryCoordinates_(geometry, coordinates) {\n    this.changingFeature_ = true;\n    geometry.setCoordinates(coordinates);\n    this.changingFeature_ = false;\n  }\n\n  /**\n   * @param {import(\"../geom/SimpleGeometry.js\").default} geometry Geometry.\n   * @param {number} index Index.\n   * @param {Array<number>|undefined} depth Depth.\n   * @param {number} delta Delta (1 or -1).\n   * @private\n   */\n  updateSegmentIndices_(geometry, index, depth, delta) {\n    this.rBush_.forEachInExtent(\n      geometry.getExtent(),\n      function (segmentDataMatch) {\n        if (\n          segmentDataMatch.geometry === geometry &&\n          (depth === undefined ||\n            segmentDataMatch.depth === undefined ||\n            equals(segmentDataMatch.depth, depth)) &&\n          segmentDataMatch.index > index\n        ) {\n          segmentDataMatch.index += delta;\n        }\n      },\n    );\n  }\n}\n\n/**\n * @param {SegmentData} a The first segment data.\n * @param {SegmentData} b The second segment data.\n * @return {number} The difference in indexes.\n */\nfunction compareIndexes(a, b) {\n  return a.index - b.index;\n}\n\n/**\n * Returns the distance from a point to a line segment.\n *\n * @param {import(\"../coordinate.js\").Coordinate} pointCoordinates The coordinates of the point from\n *        which to calculate the distance.\n * @param {SegmentData} segmentData The object describing the line\n *        segment we are calculating the distance to.\n * @param {import(\"../proj/Projection.js\").default} projection The view projection.\n * @return {number} The square of the distance between a point and a line segment.\n */\nfunction projectedDistanceToSegmentDataSquared(\n  pointCoordinates,\n  segmentData,\n  projection,\n) {\n  const geometry = segmentData.geometry;\n\n  if (geometry.getType() === 'Circle') {\n    let circleGeometry = /** @type {import(\"../geom/Circle.js\").default} */ (\n      geometry\n    );\n\n    if (segmentData.index === CIRCLE_CIRCUMFERENCE_INDEX) {\n      const userProjection = getUserProjection();\n      if (userProjection) {\n        circleGeometry = circleGeometry\n          .clone()\n          .transform(userProjection, projection);\n      }\n      const distanceToCenterSquared = squaredCoordinateDistance(\n        circleGeometry.getCenter(),\n        fromUserCoordinate(pointCoordinates, projection),\n      );\n      const distanceToCircumference =\n        Math.sqrt(distanceToCenterSquared) - circleGeometry.getRadius();\n      return distanceToCircumference * distanceToCircumference;\n    }\n  }\n\n  const coordinate = fromUserCoordinate(pointCoordinates, projection);\n  tempSegment[0] = fromUserCoordinate(segmentData.segment[0], projection);\n  tempSegment[1] = fromUserCoordinate(segmentData.segment[1], projection);\n  return squaredDistanceToSegment(coordinate, tempSegment);\n}\n\n/**\n * Returns the point closest to a given line segment.\n *\n * @param {import(\"../coordinate.js\").Coordinate} pointCoordinates The point to which a closest point\n *        should be found.\n * @param {SegmentData} segmentData The object describing the line\n *        segment which should contain the closest point.\n * @param {import(\"../proj/Projection.js\").default} projection The view projection.\n * @return {import(\"../coordinate.js\").Coordinate} The point closest to the specified line segment.\n */\nfunction closestOnSegmentData(pointCoordinates, segmentData, projection) {\n  const geometry = segmentData.geometry;\n\n  if (\n    geometry.getType() === 'Circle' &&\n    segmentData.index === CIRCLE_CIRCUMFERENCE_INDEX\n  ) {\n    let circleGeometry = /** @type {import(\"../geom/Circle.js\").default} */ (\n      geometry\n    );\n    const userProjection = getUserProjection();\n    if (userProjection) {\n      circleGeometry = circleGeometry\n        .clone()\n        .transform(userProjection, projection);\n    }\n    return toUserCoordinate(\n      circleGeometry.getClosestPoint(\n        fromUserCoordinate(pointCoordinates, projection),\n      ),\n      projection,\n    );\n  }\n  const coordinate = fromUserCoordinate(pointCoordinates, projection);\n  tempSegment[0] = fromUserCoordinate(segmentData.segment[0], projection);\n  tempSegment[1] = fromUserCoordinate(segmentData.segment[1], projection);\n  return toUserCoordinate(\n    closestOnSegment(coordinate, tempSegment),\n    projection,\n  );\n}\n\n/**\n * @return {import(\"../style/Style.js\").StyleFunction} Styles.\n */\nfunction getDefaultStyleFunction() {\n  const style = createEditingStyle();\n  return function (feature, resolution) {\n    return style['Point'];\n  };\n}\n\nexport default Modify;\n","/**\n * @module ol/events/SnapEvent\n */\nimport Event from './Event.js';\n\n/**\n * @enum {string}\n */\nexport const SnapEventType = {\n  /**\n   * Triggered upon snapping to vertex or edge\n   * @event SnapEvent#snap\n   * @api\n   */\n  SNAP: 'snap',\n};\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/interaction/Snap~Snap} instances are instances of this\n */\nexport class SnapEvent extends Event {\n  /**\n   * @param {SnapEventType} type Type.\n   * @param {Object} options Options.\n   * @param {import(\"../coordinate.js\").Coordinate} options.vertex The snapped vertex.\n   * @param {import(\"../coordinate.js\").Coordinate} options.vertexPixel The pixel of the snapped vertex.\n   * @param {import(\"../Feature.js\").default} options.feature The feature being snapped.\n   * @param {Array<import(\"../coordinate.js\").Coordinate>|null} options.segment Segment, or `null` if snapped to a vertex.\n   */\n  constructor(type, options) {\n    super(type);\n    /**\n     * The Map coordinate of the snapped point.\n     * @type {import(\"../coordinate.js\").Coordinate}\n     * @api\n     */\n    this.vertex = options.vertex;\n    /**\n     * The Map pixel of the snapped point.\n     * @type {Array<number>&Array<number>}\n     * @api\n     */\n    this.vertexPixel = options.vertexPixel;\n    /**\n     * The feature closest to the snapped point.\n     * @type {import(\"../Feature.js\").default<import(\"../geom/Geometry.js\").default>}\n     * @api\n     */\n    this.feature = options.feature;\n    /**\n     * The segment closest to the snapped point, if snapped to a segment.\n     * @type {Array<import(\"../coordinate.js\").Coordinate>|null}\n     * @api\n     */\n    this.segment = options.segment;\n  }\n}\n","/**\n * @module ol/interaction/Snap\n */\nimport CollectionEventType from '../CollectionEventType.js';\nimport EventType from '../events/EventType.js';\nimport PointerInteraction from './Pointer.js';\nimport RBush from '../structs/RBush.js';\nimport VectorEventType from '../source/VectorEventType.js';\nimport {FALSE, TRUE} from '../functions.js';\nimport {SnapEvent, SnapEventType} from '../events/SnapEvent.js';\nimport {boundingExtent, buffer, createEmpty} from '../extent.js';\nimport {\n  closestOnCircle,\n  closestOnSegment,\n  squaredDistance,\n} from '../coordinate.js';\nimport {fromCircle} from '../geom/Polygon.js';\nimport {\n  fromUserCoordinate,\n  getUserProjection,\n  toUserCoordinate,\n  toUserExtent,\n} from '../proj.js';\nimport {getUid} from '../util.js';\nimport {listen, unlistenByKey} from '../events.js';\n\n/**\n * @typedef {Object} Result\n * @property {import(\"../coordinate.js\").Coordinate|null} vertex Vertex.\n * @property {import(\"../pixel.js\").Pixel|null} vertexPixel VertexPixel.\n * @property {import(\"../Feature.js\").default|null} feature Feature.\n * @property {Array<import(\"../coordinate.js\").Coordinate>|null} segment Segment, or `null` if snapped to a vertex.\n */\n\n/**\n * @typedef {Object} SegmentData\n * @property {import(\"../Feature.js\").default} feature Feature.\n * @property {Array<import(\"../coordinate.js\").Coordinate>} segment Segment.\n */\n\n/**\n * @typedef {Object} Options\n * @property {import(\"../Collection.js\").default<import(\"../Feature.js\").default>} [features] Snap to these features. Either this option or source should be provided.\n * @property {boolean} [edge=true] Snap to edges.\n * @property {boolean} [vertex=true] Snap to vertices.\n * @property {number} [pixelTolerance=10] Pixel tolerance for considering the pointer close enough to a segment or\n * vertex for snapping.\n * @property {import(\"../source/Vector.js\").default} [source] Snap to features from this source. Either this option or features should be provided\n */\n\n/**\n * @param  {import(\"../source/Vector.js\").VectorSourceEvent|import(\"../Collection.js\").CollectionEvent<import(\"../Feature.js\").default>} evt Event.\n * @return {import(\"../Feature.js\").default|null} Feature.\n */\nfunction getFeatureFromEvent(evt) {\n  if (\n    /** @type {import(\"../source/Vector.js\").VectorSourceEvent} */ (evt).feature\n  ) {\n    return /** @type {import(\"../source/Vector.js\").VectorSourceEvent} */ (evt)\n      .feature;\n  }\n  if (\n    /** @type {import(\"../Collection.js\").CollectionEvent<import(\"../Feature.js\").default>} */ (\n      evt\n    ).element\n  ) {\n    return /** @type {import(\"../Collection.js\").CollectionEvent<import(\"../Feature.js\").default>} */ (\n      evt\n    ).element;\n  }\n  return null;\n}\n\nconst tempSegment = [];\n\n/***\n * @template Return\n * @typedef {import(\"../Observable\").OnSignature<import(\"../Observable\").EventTypes, import(\"../events/Event.js\").default, Return> &\n *   import(\"../Observable\").OnSignature<import(\"../ObjectEventType\").Types|\n *     'change:active', import(\"../Object\").ObjectEvent, Return> &\n *   import(\"../Observable\").OnSignature<'snap', SnapEvent, Return> &\n *   import(\"../Observable\").CombinedOnSignature<import(\"../Observable\").EventTypes|import(\"../ObjectEventType\").Types|\n *     'change:active'|'snap', Return>} SnapOnSignature\n */\n\n/**\n * @classdesc\n * Handles snapping of vector features while modifying or drawing them.  The\n * features can come from a {@link module:ol/source/Vector~VectorSource} or {@link module:ol/Collection~Collection}\n * Any interaction object that allows the user to interact\n * with the features using the mouse can benefit from the snapping, as long\n * as it is added before.\n *\n * The snap interaction modifies map browser event `coordinate` and `pixel`\n * properties to force the snap to occur to any interaction that them.\n *\n * Example:\n *\n *     import Snap from 'ol/interaction/Snap.js';\n *\n *     const snap = new Snap({\n *       source: source\n *     });\n *\n *     map.addInteraction(snap);\n *\n * @fires SnapEvent\n * @api\n */\nclass Snap extends PointerInteraction {\n  /**\n   * @param {Options} [options] Options.\n   */\n  constructor(options) {\n    options = options ? options : {};\n\n    const pointerOptions = /** @type {import(\"./Pointer.js\").Options} */ (\n      options\n    );\n\n    if (!pointerOptions.handleDownEvent) {\n      pointerOptions.handleDownEvent = TRUE;\n    }\n\n    if (!pointerOptions.stopDown) {\n      pointerOptions.stopDown = FALSE;\n    }\n\n    super(pointerOptions);\n\n    /***\n     * @type {SnapOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.on;\n\n    /***\n     * @type {SnapOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.once;\n\n    /***\n     * @type {SnapOnSignature<void>}\n     */\n    this.un;\n\n    /**\n     * @type {import(\"../source/Vector.js\").default|null}\n     * @private\n     */\n    this.source_ = options.source ? options.source : null;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.vertex_ = options.vertex !== undefined ? options.vertex : true;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.edge_ = options.edge !== undefined ? options.edge : true;\n\n    /**\n     * @type {import(\"../Collection.js\").default<import(\"../Feature.js\").default>|null}\n     * @private\n     */\n    this.features_ = options.features ? options.features : null;\n\n    /**\n     * @type {Array<import(\"../events.js\").EventsKey>}\n     * @private\n     */\n    this.featuresListenerKeys_ = [];\n\n    /**\n     * @type {Object<string, import(\"../events.js\").EventsKey>}\n     * @private\n     */\n    this.featureChangeListenerKeys_ = {};\n\n    /**\n     * Extents are preserved so indexed segment can be quickly removed\n     * when its feature geometry changes\n     * @type {Object<string, import(\"../extent.js\").Extent>}\n     * @private\n     */\n    this.indexedFeaturesExtents_ = {};\n\n    /**\n     * If a feature geometry changes while a pointer drag|move event occurs, the\n     * feature doesn't get updated right away.  It will be at the next 'pointerup'\n     * event fired.\n     * @type {!Object<string, import(\"../Feature.js\").default>}\n     * @private\n     */\n    this.pendingFeatures_ = {};\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.pixelTolerance_ =\n      options.pixelTolerance !== undefined ? options.pixelTolerance : 10;\n\n    /**\n     * Segment RTree for each layer\n     * @type {import(\"../structs/RBush.js\").default<SegmentData>}\n     * @private\n     */\n    this.rBush_ = new RBush();\n\n    /**\n     * @const\n     * @private\n     * @type {Object<string, function(Array<Array<import('../coordinate.js').Coordinate>>, import(\"../geom/Geometry.js\").default): void>}\n     */\n    this.GEOMETRY_SEGMENTERS_ = {\n      'Point': this.segmentPointGeometry_.bind(this),\n      'LineString': this.segmentLineStringGeometry_.bind(this),\n      'LinearRing': this.segmentLineStringGeometry_.bind(this),\n      'Polygon': this.segmentPolygonGeometry_.bind(this),\n      'MultiPoint': this.segmentMultiPointGeometry_.bind(this),\n      'MultiLineString': this.segmentMultiLineStringGeometry_.bind(this),\n      'MultiPolygon': this.segmentMultiPolygonGeometry_.bind(this),\n      'GeometryCollection': this.segmentGeometryCollectionGeometry_.bind(this),\n      'Circle': this.segmentCircleGeometry_.bind(this),\n    };\n  }\n\n  /**\n   * Add a feature to the collection of features that we may snap to.\n   * @param {import(\"../Feature.js\").default} feature Feature.\n   * @param {boolean} [register] Whether to listen to the feature change or not\n   *     Defaults to `true`.\n   * @api\n   */\n  addFeature(feature, register) {\n    register = register !== undefined ? register : true;\n    const feature_uid = getUid(feature);\n    const geometry = feature.getGeometry();\n    if (geometry) {\n      const segmenter = this.GEOMETRY_SEGMENTERS_[geometry.getType()];\n      if (segmenter) {\n        this.indexedFeaturesExtents_[feature_uid] =\n          geometry.getExtent(createEmpty());\n        const segments =\n          /** @type {Array<Array<import('../coordinate.js').Coordinate>>} */ ([]);\n        segmenter(segments, geometry);\n        if (segments.length === 1) {\n          this.rBush_.insert(boundingExtent(segments[0]), {\n            feature: feature,\n            segment: segments[0],\n          });\n        } else if (segments.length > 1) {\n          const extents = segments.map((s) => boundingExtent(s));\n          const segmentsData = segments.map((segment) => ({\n            feature: feature,\n            segment: segment,\n          }));\n          this.rBush_.load(extents, segmentsData);\n        }\n      }\n    }\n\n    if (register) {\n      this.featureChangeListenerKeys_[feature_uid] = listen(\n        feature,\n        EventType.CHANGE,\n        this.handleFeatureChange_,\n        this,\n      );\n    }\n  }\n\n  /**\n   * @return {import(\"../Collection.js\").default<import(\"../Feature.js\").default>|Array<import(\"../Feature.js\").default>} Features.\n   * @private\n   */\n  getFeatures_() {\n    /** @type {import(\"../Collection.js\").default<import(\"../Feature.js\").default>|Array<import(\"../Feature.js\").default>} */\n    let features;\n    if (this.features_) {\n      features = this.features_;\n    } else if (this.source_) {\n      features = this.source_.getFeatures();\n    }\n    return features;\n  }\n\n  /**\n   * @param {import(\"../MapBrowserEvent.js\").default} evt Map browser event.\n   * @return {boolean} `false` to stop event propagation.\n   * @api\n   */\n  handleEvent(evt) {\n    const result = this.snapTo(evt.pixel, evt.coordinate, evt.map);\n    if (result) {\n      evt.coordinate = result.vertex.slice(0, 2);\n      evt.pixel = result.vertexPixel;\n      this.dispatchEvent(\n        new SnapEvent(SnapEventType.SNAP, {\n          vertex: evt.coordinate,\n          vertexPixel: evt.pixel,\n          feature: result.feature,\n          segment: result.segment,\n        }),\n      );\n    }\n    return super.handleEvent(evt);\n  }\n\n  /**\n   * @param {import(\"../source/Vector.js\").VectorSourceEvent|import(\"../Collection.js\").CollectionEvent<import(\"../Feature.js\").default>} evt Event.\n   * @private\n   */\n  handleFeatureAdd_(evt) {\n    const feature = getFeatureFromEvent(evt);\n    if (feature) {\n      this.addFeature(feature);\n    }\n  }\n\n  /**\n   * @param {import(\"../source/Vector.js\").VectorSourceEvent|import(\"../Collection.js\").CollectionEvent<import(\"../Feature.js\").default>} evt Event.\n   * @private\n   */\n  handleFeatureRemove_(evt) {\n    const feature = getFeatureFromEvent(evt);\n    if (feature) {\n      this.removeFeature(feature);\n    }\n  }\n\n  /**\n   * @param {import(\"../events/Event.js\").default} evt Event.\n   * @private\n   */\n  handleFeatureChange_(evt) {\n    const feature = /** @type {import(\"../Feature.js\").default} */ (evt.target);\n    if (this.handlingDownUpSequence) {\n      const uid = getUid(feature);\n      if (!(uid in this.pendingFeatures_)) {\n        this.pendingFeatures_[uid] = feature;\n      }\n    } else {\n      this.updateFeature_(feature);\n    }\n  }\n\n  /**\n   * Handle pointer up events.\n   * @param {import(\"../MapBrowserEvent.js\").default} evt Event.\n   * @return {boolean} If the event was consumed.\n   */\n  handleUpEvent(evt) {\n    const featuresToUpdate = Object.values(this.pendingFeatures_);\n    if (featuresToUpdate.length) {\n      featuresToUpdate.forEach(this.updateFeature_.bind(this));\n      this.pendingFeatures_ = {};\n    }\n    return false;\n  }\n\n  /**\n   * Remove a feature from the collection of features that we may snap to.\n   * @param {import(\"../Feature.js\").default} feature Feature\n   * @param {boolean} [unlisten] Whether to unlisten to the feature change\n   *     or not. Defaults to `true`.\n   * @api\n   */\n  removeFeature(feature, unlisten) {\n    const unregister = unlisten !== undefined ? unlisten : true;\n    const feature_uid = getUid(feature);\n    const extent = this.indexedFeaturesExtents_[feature_uid];\n    if (extent) {\n      const rBush = this.rBush_;\n      const nodesToRemove = [];\n      rBush.forEachInExtent(extent, function (node) {\n        if (feature === node.feature) {\n          nodesToRemove.push(node);\n        }\n      });\n      for (let i = nodesToRemove.length - 1; i >= 0; --i) {\n        rBush.remove(nodesToRemove[i]);\n      }\n    }\n\n    if (unregister) {\n      unlistenByKey(this.featureChangeListenerKeys_[feature_uid]);\n      delete this.featureChangeListenerKeys_[feature_uid];\n    }\n  }\n\n  /**\n   * Remove the interaction from its current map and attach it to the new map.\n   * Subclasses may set up event handlers to get notified about changes to\n   * the map here.\n   * @param {import(\"../Map.js\").default} map Map.\n   */\n  setMap(map) {\n    const currentMap = this.getMap();\n    const keys = this.featuresListenerKeys_;\n    const features = /** @type {Array<import(\"../Feature.js\").default>} */ (\n      this.getFeatures_()\n    );\n\n    if (currentMap) {\n      keys.forEach(unlistenByKey);\n      keys.length = 0;\n      this.rBush_.clear();\n      Object.values(this.featureChangeListenerKeys_).forEach(unlistenByKey);\n      this.featureChangeListenerKeys_ = {};\n    }\n    super.setMap(map);\n\n    if (map) {\n      if (this.features_) {\n        keys.push(\n          listen(\n            this.features_,\n            CollectionEventType.ADD,\n            this.handleFeatureAdd_,\n            this,\n          ),\n          listen(\n            this.features_,\n            CollectionEventType.REMOVE,\n            this.handleFeatureRemove_,\n            this,\n          ),\n        );\n      } else if (this.source_) {\n        keys.push(\n          listen(\n            this.source_,\n            VectorEventType.ADDFEATURE,\n            this.handleFeatureAdd_,\n            this,\n          ),\n          listen(\n            this.source_,\n            VectorEventType.REMOVEFEATURE,\n            this.handleFeatureRemove_,\n            this,\n          ),\n        );\n      }\n      features.forEach((feature) => this.addFeature(feature));\n    }\n  }\n\n  /**\n   * @param {import(\"../pixel.js\").Pixel} pixel Pixel\n   * @param {import(\"../coordinate.js\").Coordinate} pixelCoordinate Coordinate\n   * @param {import(\"../Map.js\").default} map Map.\n   * @return {Result|null} Snap result\n   */\n  snapTo(pixel, pixelCoordinate, map) {\n    const projection = map.getView().getProjection();\n    const projectedCoordinate = fromUserCoordinate(pixelCoordinate, projection);\n\n    const box = toUserExtent(\n      buffer(\n        boundingExtent([projectedCoordinate]),\n        map.getView().getResolution() * this.pixelTolerance_,\n      ),\n      projection,\n    );\n\n    const segments = this.rBush_.getInExtent(box);\n    const segmentsLength = segments.length;\n    if (segmentsLength === 0) {\n      return null;\n    }\n\n    let closestVertex;\n    let minSquaredDistance = Infinity;\n    let closestFeature;\n    let closestSegment = null;\n\n    const squaredPixelTolerance = this.pixelTolerance_ * this.pixelTolerance_;\n    const getResult = () => {\n      if (closestVertex) {\n        const vertexPixel = map.getPixelFromCoordinate(closestVertex);\n        const squaredPixelDistance = squaredDistance(pixel, vertexPixel);\n        if (squaredPixelDistance <= squaredPixelTolerance) {\n          return {\n            vertex: closestVertex,\n            vertexPixel: [\n              Math.round(vertexPixel[0]),\n              Math.round(vertexPixel[1]),\n            ],\n            feature: closestFeature,\n            segment: closestSegment,\n          };\n        }\n      }\n      return null;\n    };\n\n    if (this.vertex_) {\n      for (let i = 0; i < segmentsLength; ++i) {\n        const segmentData = segments[i];\n        if (segmentData.feature.getGeometry().getType() !== 'Circle') {\n          segmentData.segment.forEach((vertex) => {\n            const tempVertexCoord = fromUserCoordinate(vertex, projection);\n            const delta = squaredDistance(projectedCoordinate, tempVertexCoord);\n            if (delta < minSquaredDistance) {\n              closestVertex = vertex;\n              minSquaredDistance = delta;\n              closestFeature = segmentData.feature;\n            }\n          });\n        }\n      }\n      const result = getResult();\n      if (result) {\n        return result;\n      }\n    }\n\n    if (this.edge_) {\n      for (let i = 0; i < segmentsLength; ++i) {\n        let vertex = null;\n        const segmentData = segments[i];\n        if (segmentData.feature.getGeometry().getType() === 'Circle') {\n          let circleGeometry = segmentData.feature.getGeometry();\n          const userProjection = getUserProjection();\n          if (userProjection) {\n            circleGeometry = circleGeometry\n              .clone()\n              .transform(userProjection, projection);\n          }\n          vertex = closestOnCircle(\n            projectedCoordinate,\n            /** @type {import(\"../geom/Circle.js\").default} */ (circleGeometry),\n          );\n        } else {\n          const [segmentStart, segmentEnd] = segmentData.segment;\n          // points have only one coordinate\n          if (segmentEnd) {\n            tempSegment[0] = fromUserCoordinate(segmentStart, projection);\n            tempSegment[1] = fromUserCoordinate(segmentEnd, projection);\n            vertex = closestOnSegment(projectedCoordinate, tempSegment);\n          }\n        }\n        if (vertex) {\n          const delta = squaredDistance(projectedCoordinate, vertex);\n          if (delta < minSquaredDistance) {\n            closestVertex = toUserCoordinate(vertex, projection);\n            closestSegment =\n              segmentData.feature.getGeometry().getType() === 'Circle'\n                ? null\n                : segmentData.segment;\n            minSquaredDistance = delta;\n          }\n        }\n      }\n\n      const result = getResult();\n      if (result) {\n        return result;\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * @param {import(\"../Feature.js\").default} feature Feature\n   * @private\n   */\n  updateFeature_(feature) {\n    this.removeFeature(feature, false);\n    this.addFeature(feature, false);\n  }\n\n  /**\n   * @param {Array<Array<import('../coordinate.js').Coordinate>>} segments Segments\n   * @param {import(\"../geom/Circle.js\").default} geometry Geometry.\n   * @private\n   */\n  segmentCircleGeometry_(segments, geometry) {\n    const projection = this.getMap().getView().getProjection();\n    let circleGeometry = geometry;\n    const userProjection = getUserProjection();\n    if (userProjection) {\n      circleGeometry = circleGeometry\n        .clone()\n        .transform(userProjection, projection);\n    }\n    const polygon = fromCircle(circleGeometry);\n    if (userProjection) {\n      polygon.transform(projection, userProjection);\n    }\n    const coordinates = polygon.getCoordinates()[0];\n    for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n      segments.push(coordinates.slice(i, i + 2));\n    }\n  }\n\n  /**\n   * @param {Array<Array<import('../coordinate.js').Coordinate>>} segments Segments\n   * @param {import(\"../geom/GeometryCollection.js\").default} geometry Geometry.\n   * @private\n   */\n  segmentGeometryCollectionGeometry_(segments, geometry) {\n    const geometries = geometry.getGeometriesArray();\n    for (let i = 0; i < geometries.length; ++i) {\n      const segmenter = this.GEOMETRY_SEGMENTERS_[geometries[i].getType()];\n      if (segmenter) {\n        segmenter(segments, geometries[i]);\n      }\n    }\n  }\n\n  /**\n   * @param {Array<Array<import('../coordinate.js').Coordinate>>} segments Segments\n   * @param {import(\"../geom/LineString.js\").default} geometry Geometry.\n   * @private\n   */\n  segmentLineStringGeometry_(segments, geometry) {\n    const coordinates = geometry.getCoordinates();\n    for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n      segments.push(coordinates.slice(i, i + 2));\n    }\n  }\n\n  /**\n   * @param {Array<Array<import('../coordinate.js').Coordinate>>} segments Segments\n   * @param {import(\"../geom/MultiLineString.js\").default} geometry Geometry.\n   * @private\n   */\n  segmentMultiLineStringGeometry_(segments, geometry) {\n    const lines = geometry.getCoordinates();\n    for (let j = 0, jj = lines.length; j < jj; ++j) {\n      const coordinates = lines[j];\n      for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n        segments.push(coordinates.slice(i, i + 2));\n      }\n    }\n  }\n\n  /**\n   * @param {Array<Array<import('../coordinate.js').Coordinate>>} segments Segments\n   * @param {import(\"../geom/MultiPoint.js\").default} geometry Geometry.\n   * @private\n   */\n  segmentMultiPointGeometry_(segments, geometry) {\n    geometry.getCoordinates().forEach((point) => {\n      segments.push([point]);\n    });\n  }\n\n  /**\n   * @param {Array<Array<import('../coordinate.js').Coordinate>>} segments Segments\n   * @param {import(\"../geom/MultiPolygon.js\").default} geometry Geometry.\n   * @private\n   */\n  segmentMultiPolygonGeometry_(segments, geometry) {\n    const polygons = geometry.getCoordinates();\n    for (let k = 0, kk = polygons.length; k < kk; ++k) {\n      const rings = polygons[k];\n      for (let j = 0, jj = rings.length; j < jj; ++j) {\n        const coordinates = rings[j];\n        for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n          segments.push(coordinates.slice(i, i + 2));\n        }\n      }\n    }\n  }\n\n  /**\n   * @param {Array<Array<import('../coordinate.js').Coordinate>>} segments Segments\n   * @param {import(\"../geom/Point.js\").default} geometry Geometry.\n   * @private\n   */\n  segmentPointGeometry_(segments, geometry) {\n    segments.push([geometry.getCoordinates()]);\n  }\n\n  /**\n   * @param {Array<Array<import('../coordinate.js').Coordinate>>} segments Segments\n   * @param {import(\"../geom/Polygon.js\").default} geometry Geometry.\n   * @private\n   */\n  segmentPolygonGeometry_(segments, geometry) {\n    const rings = geometry.getCoordinates();\n    for (let j = 0, jj = rings.length; j < jj; ++j) {\n      const coordinates = rings[j];\n      for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n        segments.push(coordinates.slice(i, i + 2));\n      }\n    }\n  }\n}\n\nexport default Snap;\n","import GirafeHTMLElement from '../../base/GirafeHTMLElement';\n\ntype OpenDirection = 'bottom' | 'bottom-left' | 'up' | 'left';\n\nclass MenuButtonComponent extends GirafeHTMLElement {\n  templateUrl = './template.html';\n  styleUrl = './style.css';\n\n  open = false;\n  openDirection: OpenDirection = 'bottom';\n\n  constructor() {\n    super('menubutton');\n  }\n\n  render() {\n    this.openDirection = this.hasAttribute('open') ? (this.getAttribute('open') as OpenDirection) : 'bottom';\n    super.render();\n  }\n\n  listenChildButtons() {\n    const slot = this.shadow.querySelector('slot[name=\"menu-content\"]') as HTMLSlotElement;\n    const assignedNodes = slot.assignedNodes();\n    const buttons = this.findAllAssignedButtons(assignedNodes);\n    for (const button of buttons) {\n      button.removeEventListener('click', this.closeMenuHandler);\n      button.addEventListener('click', this.closeMenuHandler);\n    }\n  }\n\n  getClass() {\n    if (!this.open) {\n      return 'hidden';\n    }\n    return 'menu-content open-' + this.openDirection;\n  }\n\n  public toggleMenu() {\n    if (this.open) {\n      this.closeMenu();\n    } else {\n      this.openMenu();\n    }\n  }\n\n  private openMenu() {\n    this.listenChildButtons();\n    this.open = true;\n    super.render();\n  }\n\n  private closeMenuHandler = () => this.closeMenu(true);\n  private closeMenu(closeParent: boolean = false) {\n    this.open = false;\n    if (closeParent) {\n      // If this menu itself is contained in another menu\n      // We close the parent menu too\n      const parentMenuButton = super.getParentOfType(\n        'GIRAFE-MENU-BUTTON',\n        this.shadow.host.parentNode\n      ) as MenuButtonComponent;\n      if (parentMenuButton !== null) {\n        parentMenuButton.toggleMenu();\n      }\n    }\n    super.render();\n  }\n\n  findAllAssignedButtons(nodes: Node[]): HTMLButtonElement[] {\n    const buttons: HTMLButtonElement[] = [];\n\n    for (const node of nodes) {\n      if (node.nodeName === 'BUTTON') {\n        buttons.push(node as HTMLButtonElement);\n      }\n\n      if (node.hasChildNodes()) {\n        buttons.push(...this.findAllAssignedButtons(Array.from(node.childNodes)));\n      }\n    }\n\n    return buttons;\n  }\n\n  connectedCallback() {\n    super.loadConfig().then(() => {\n      this.render();\n      super.girafeTranslate();\n    });\n  }\n}\n\nexport default MenuButtonComponent;\n","import MapPosition from '../../tools/state/mapposition';\n\nexport class Bookmark {\n  static BOOKMARKNAMEPATTERN = /^[A-Za-z-0-9_ -]+$/;\n  name: string;\n  position: MapPosition;\n\n  constructor(name: string, position: MapPosition) {\n    if (!Bookmark.BOOKMARKNAMEPATTERN.test(name)) {\n      throw new Error(\n        'Bookmark name is not valid: it can only contain alphanumeric characters and the dash (-) underscore (_) and space characters.'\n      );\n    }\n    this.name = name;\n    this.position = position;\n  }\n}\n","import GirafeHTMLElement from '../../../base/GirafeHTMLElement';\nimport { Bookmark } from '../Bookmark';\nimport NavHelperComponent from '../navhelper/component';\n\nclass NavBookmarksComponent extends GirafeHTMLElement {\n  templateUrl = './template.html';\n  styleUrl = './style.css';\n\n  navHelper: NavHelperComponent;\n  nameInput: HTMLInputElement | null = null;\n\n  constructor(parent: NavHelperComponent) {\n    super('navbookmarks');\n    this.navHelper = parent;\n  }\n\n  render() {\n    super.render();\n\n    this.nameInput = this.shadow.getElementById('name') as HTMLInputElement;\n    this.nameInput.focus();\n  }\n\n  saveBookmark() {\n    if (this.nameInput) {\n      try {\n        const bookmark = new Bookmark(this.nameInput.value, this.state.position);\n        this.navHelper.addBookmark(bookmark);\n        // Reset value\n        this.nameInput.value = '';\n      } catch (e) {\n        alert(e);\n      }\n    }\n  }\n\n  connectedCallback() {\n    this.loadConfig().then(() => {\n      this.render();\n      super.girafeTranslate();\n    });\n  }\n}\n\nexport default NavBookmarksComponent;\n","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20448%20512'%3e%3c!--!Font%20Awesome%20Free%206.5.2%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202024%20Fonticons,%20Inc.--%3e%3cpath%20d='M256%2080c0-17.7-14.3-32-32-32s-32%2014.3-32%2032V224H48c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032H192V432c0%2017.7%2014.3%2032%2032%2032s32-14.3%2032-32V288H400c17.7%200%2032-14.3%2032-32s-14.3-32-32-32H256V80z'/%3e%3c/svg%3e\"","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20384%20512'%3e%3c!--!Font%20Awesome%20Free%206.5.2%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202024%20Fonticons,%20Inc.--%3e%3cpath%20d='M0%2048V487.7C0%20501.1%2010.9%20512%2024.3%20512c5%200%209.9-1.5%2014-4.4L192%20400%20345.7%20507.6c4.1%202.9%209%204.4%2014%204.4c13.4%200%2024.3-10.9%2024.3-24.3V48c0-26.5-21.5-48-48-48H48C21.5%200%200%2021.5%200%2048z'/%3e%3c/svg%3e\"","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20448%20512'%3e%3c!--!Font%20Awesome%20Free%206.5.2%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202024%20Fonticons,%20Inc.--%3e%3cpath%20d='M438.6%20278.6c12.5-12.5%2012.5-32.8%200-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3%200s-12.5%2032.8%200%2045.3L338.8%20224%2032%20224c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032l306.7%200L233.4%20393.4c-12.5%2012.5-12.5%2032.8%200%2045.3s32.8%2012.5%2045.3%200l160-160z'/%3e%3c/svg%3e\"","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20448%20512'%3e%3c!--!Font%20Awesome%20Free%206.5.2%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202024%20Fonticons,%20Inc.--%3e%3cpath%20d='M9.4%20233.4c-12.5%2012.5-12.5%2032.8%200%2045.3l160%20160c12.5%2012.5%2032.8%2012.5%2045.3%200s12.5-32.8%200-45.3L109.2%20288%20416%20288c17.7%200%2032-14.3%2032-32s-14.3-32-32-32l-306.7%200L214.6%20118.6c12.5-12.5%2012.5-32.8%200-45.3s-32.8-12.5-45.3%200l-160%20160z'/%3e%3c/svg%3e\"","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20448%20512'%3e%3c!--!Font%20Awesome%20Free%206.5.2%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202024%20Fonticons,%20Inc.--%3e%3cpath%20d='M135.2%2017.7L128%2032H32C14.3%2032%200%2046.3%200%2064S14.3%2096%2032%2096H416c17.7%200%2032-14.3%2032-32s-14.3-32-32-32H320l-7.2-14.3C307.4%206.8%20296.3%200%20284.2%200H163.8c-12.1%200-23.2%206.8-28.6%2017.7zM416%20128H32L53.2%20467c1.6%2025.3%2022.6%2045%2047.9%2045H346.9c25.3%200%2046.3-19.7%2047.9-45L416%20128z'/%3e%3c/svg%3e\"","import tippy from 'tippy.js';\nimport GirafeHTMLElement from '../../../base/GirafeHTMLElement';\nimport MapPosition from '../../../tools/state/mapposition';\nimport NavBookmarksComponent from '../navbookmarks/component';\nimport { Bookmark } from '../Bookmark';\nimport IconAdd from './images/add.svg';\nimport IconBookmark from './images/bookmark.svg';\nimport IconNext from './images/next.svg';\nimport IconPrevious from './images/previous.svg';\nimport IconTrash from './images/trash.svg';\n\ntype TippyType = typeof tippy;\n\nclass NavHelperComponent extends GirafeHTMLElement {\n  templateUrl = './template.html';\n  styleUrls = ['./style.css', '../../../styles/common.css'];\n  iconAdd: string = IconAdd;\n  iconBookmark: string = IconBookmark;\n  iconNext: string = IconNext;\n  iconPrevious: string = IconPrevious;\n  iconTrash: string = IconTrash;\n\n  #tooltip: TippyType;\n  #positionHistory: MapPosition[] = [];\n  #currentPositionIndex: number = -1;\n\n  bookmarks: Bookmark[] = [];\n\n  bookmarkStorage: string = 'localStorage';\n\n  get hasBookmark() {\n    return this.bookmarks.length > 0;\n  }\n\n  #selfNavigation: boolean = false;\n\n  constructor() {\n    super('navhelper');\n  }\n\n  render() {\n    super.render();\n    this.createBookmarkTooltip();\n  }\n\n  createBookmarkTooltip() {\n    const el = this.shadow.getElementById('add-bookmark');\n    this.#tooltip = tippy(el, {\n      trigger: 'click',\n      arrow: true,\n      interactive: true,\n      theme: 'light',\n      placement: 'bottom',\n      appendTo: document.body,\n      content: (_reference: object) => {\n        const bookmarkbox = new NavBookmarksComponent(this);\n        return bookmarkbox;\n      }\n    });\n  }\n\n  addBookmark(bookmark: Bookmark) {\n    this.bookmarks.push(bookmark);\n    this.saveBookmarks();\n    super.render();\n    super.girafeTranslate();\n    this.#tooltip.hide();\n  }\n\n  removeBookmark(bookmark: Bookmark) {\n    const index = this.bookmarks.indexOf(bookmark);\n    if (index >= 0) {\n      this.bookmarks.splice(index, 1);\n    }\n    this.saveBookmarks();\n    super.render();\n    super.girafeTranslate();\n  }\n\n  async saveBookmarks() {\n    if (this.bookmarkStorage === 'localStorage') {\n      localStorage.setItem('bookmarks', JSON.stringify(this.bookmarks));\n    } else if (this.bookmarkStorage === 'server') {\n      // TODO: Define a workflow and finalize it\n      const url = this.configManager.Config.bookmarks!.post;\n      const response = await fetch(url!, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(this.bookmarks)\n      });\n      const data = await response.json();\n      console.log(data);\n    }\n  }\n\n  async loadBookmarks() {\n    this.bookmarks = [];\n    let storedBookmarks: string | null = '';\n\n    if (this.bookmarkStorage === 'localStorage') {\n      storedBookmarks = localStorage.getItem('bookmarks');\n    } else if (this.bookmarkStorage === 'server') {\n      // TODO: Define a workflow and finalize it\n      const url = this.configManager.Config.bookmarks!.get;\n      const response = await fetch(url!);\n      const data = await response.json();\n      storedBookmarks = data;\n    }\n\n    if (storedBookmarks) {\n      const jsonBookmarks = JSON.parse(storedBookmarks);\n\n      for (const bookmark of jsonBookmarks) {\n        const position = new MapPosition();\n        position.center = bookmark.position.center;\n        position.zoom = bookmark.position.zoom;\n        position.resolution = bookmark.position.resolution;\n        position.scale = bookmark.position.scale;\n        this.bookmarks.push(new Bookmark(bookmark.name, position));\n      }\n    }\n  }\n\n  registerEvents() {\n    this.stateManager.subscribe('position', (_oldPosition: MapPosition, newPosition: MapPosition) =>\n      this.onPositionChanged(newPosition)\n    );\n  }\n\n  onPositionChanged(position: MapPosition) {\n    if (!this.#selfNavigation) {\n      // When the application is initializing, the position is perhaps not correct\n      if (!position.isValid) {\n        return;\n      }\n\n      if (this.#currentPositionIndex !== this.#positionHistory.length - 1) {\n        // Remove history from this index to create a new one\n        this.#positionHistory.splice(this.#currentPositionIndex + 1);\n      }\n      this.#positionHistory.push(position);\n      this.#currentPositionIndex = this.#positionHistory.length - 1;\n    }\n  }\n\n  navigateBack() {\n    let position = this.#positionHistory[this.#currentPositionIndex];\n    if (this.#currentPositionIndex > 0) {\n      this.#currentPositionIndex--;\n      position = this.#positionHistory[this.#currentPositionIndex];\n      console.log('Navigating back to:', position);\n    }\n\n    this.navigateToPosition(position);\n  }\n\n  navigateForward() {\n    let position = this.#positionHistory[this.#currentPositionIndex];\n    if (this.#currentPositionIndex < this.#positionHistory.length - 1) {\n      this.#currentPositionIndex++;\n      position = this.#positionHistory[this.#currentPositionIndex];\n      console.log('Navigating forward to:', position);\n    }\n    this.navigateToPosition(position);\n  }\n\n  navigateToPosition(position: MapPosition) {\n    this.#selfNavigation = true;\n    try {\n      this.state.position = position;\n    } finally {\n      this.#selfNavigation = false;\n    }\n  }\n\n  connectedCallback() {\n    this.loadConfig().then(() => {\n      this.bookmarkStorage = this.configManager.Config.bookmarks\n        ? this.configManager.Config.bookmarks.service\n        : 'localStorage';\n      this.loadBookmarks();\n      this.render();\n      super.girafeTranslate();\n      this.registerEvents();\n    });\n  }\n}\n\nexport default NavHelperComponent;\n","import type LayerWms from '../../../models/layers/layerwms';\nimport type LayerWmts from '../../../models/layers/layerwmts';\n\n/**\n * Determines if a layer is visible based on its opacity and print resolution.\n * @returns true if the layer is visible, otherwise false.\n */\nexport const isLayerVisible = (layer: LayerWms | LayerWmts, printResolution?: number): boolean => {\n  if (layer.opacity === 0) {\n    return false;\n  }\n  if (printResolution === undefined) {\n    return true;\n  }\n  return printResolution >= (layer.minResolution ?? -1) && printResolution <= (layer.maxResolution ?? Infinity);\n};\n","import { appendParams } from 'ol/uri';\nimport TileLayer from 'ol/layer/Tile';\nimport WMTS from 'ol/source/WMTS';\n\nclass LegendHelper {\n  /**\n   * Get the WMS legend URL.\n   * @param url The base url of the wms service.\n   * @param layerName The name of a wms layer.\n   * @param options to create the legend url.\n   * @returns The legend URL or undefined.\n   */\n  static readonly getWMSLegendURL = (\n    url: string | undefined,\n    layerName: string,\n    options?: WMSLegendURLOptions\n  ): string | undefined => {\n    if (!url) {\n      return undefined;\n    }\n    const queryString: Record<string, unknown> = {\n      FORMAT: 'image/png',\n      TRANSPARENT: true,\n      SERVICE: 'WMS',\n      VERSION: '1.1.1',\n      REQUEST: 'GetLegendGraphic',\n      LAYER: layerName\n    };\n    const scale = options?.scale;\n    const legendRule = options?.legendRule;\n    const legendWidth = options?.legendWidth;\n    const legendHeight = options?.legendHeight;\n    const serverType = options?.serverType;\n    const dpi = options?.dpi;\n    const bbox = options?.bbox;\n    const srs = options?.srs;\n    const additionalQueryString = options?.additionalQueryString;\n    if (scale !== undefined) {\n      queryString.SCALE = scale;\n    }\n    if (legendRule !== undefined) {\n      queryString.RULE = legendRule;\n      if (legendWidth !== undefined) {\n        queryString.WIDTH = legendWidth;\n      }\n      if (legendHeight !== undefined) {\n        queryString.HEIGHT = legendHeight;\n      }\n    }\n    if (serverType == 'qgis') {\n      if (dpi != undefined) {\n        queryString.DPI = dpi;\n      }\n      if (bbox != undefined && srs != undefined && scale != undefined && dpi != undefined && legendRule == undefined) {\n        queryString.BBOX = bbox.join(',');\n        queryString.SRS = srs;\n        queryString.SRCWIDTH = Math.round(((bbox[2] - bbox[0]) / scale) * 39.37 * dpi);\n        queryString.SRCHEIGHT = Math.round(((bbox[3] - bbox[1]) / scale) * 39.37 * dpi);\n        delete queryString.SCALE; // QGIS calculate it from the BBOX the SRCWIDTH and the SRCHEIGHT.\n      }\n    }\n    if (additionalQueryString) {\n      Object.assign(queryString, additionalQueryString);\n    }\n    return appendParams(url, queryString);\n  };\n\n  /**\n   * Retrieves the legend URL for a given WMTS tile layer.\n   * @param {TileLayer<WMTS>} olayer - The OpenLayers tile layer object.\n   * @returns The legend URL or undefined if not found.\n   */\n  static readonly getWMTSLegendURL = (olayer: TileLayer<WMTS>): string | undefined => {\n    // BGE case of multiple styles ? case of multiple legendUrl ?\n    const styles = olayer.get('capabilitiesStyles');\n    if (!Array.isArray(styles) || styles.length <= 0) {\n      return;\n    }\n    const legendURL = styles[0].LegendURL;\n    if (!Array.isArray(legendURL) || legendURL.length <= 0) {\n      return;\n    }\n    return legendURL[0].href;\n  };\n}\n\n/**\n * Options to get WMS legend URL.\n * @property legendRule parameters to add to the returned URL.\n * @property legendWidth the legend width.\n * @property legendHeight the legend height.\n * @property serverType the OpenLayers server type.\n * @property dpi the DPI.\n * @property bbox the bbox.\n * @property srs The projection code.\n * @property additionalQueryString Additional query string parameters.\n */\nexport interface WMSLegendURLOptions {\n  scale?: number;\n  legendRule?: string;\n  legendWidth?: number;\n  legendHeight?: number;\n  serverType?: string;\n  dpi?: number;\n  bbox?: number[];\n  srs?: string;\n  additionalQueryString?: Record<string, unknown>;\n}\n\nexport default LegendHelper;\n","import type GroupLayer from '../../../models/layers/grouplayer';\nimport type BaseLayer from '../../../models/layers/baselayer';\nimport type MapManager from '../../../tools/state/mapManager';\nimport type I18nManager from '../../../tools/i18n/i18nmanager';\nimport type State from '../../../tools/state/state';\n\nimport LayerWms from '../../../models/layers/layerwms';\nimport LayerWmts from '../../../models/layers/layerwmts';\nimport GeoConsts from '../../../tools/geoconsts';\nimport { isLayerVisible } from './printUtils';\nimport LegendHelper from '../../../tools/legendhelper';\n\n/** Represents the options for encoding a legend. */\nexport interface EncodeLegendOptions {\n  mapManager: MapManager;\n  i18nManager: I18nManager;\n  state: State;\n  scale: number;\n  printResolution: number;\n  dpi: number;\n  pageSize: number[];\n  extent?: number[];\n  useExtent?: boolean;\n  label?: Record<string, boolean | undefined>;\n  params?: Record<string, Record<string, unknown>>;\n  showGroupsTitle?: boolean;\n}\n\n/** Represents a class in the MFP legend. */\nexport interface MFPLegendClass {\n  name?: string;\n  icons?: string[];\n  dpi?: number;\n  classes?: MFPLegendClass[];\n}\n\n/** Represents a LegendURLDPI object. */\nexport interface LegendURLDPI {\n  url: string;\n  dpi: number;\n}\n\n/**\n * Class representing an encoder for creating a legend in the MFP (MapFishPrint) format.\n * Iterates on the layer tree layers to collect layers in the right order and with all metadata.\n */\nexport class MFPLegendEncoder {\n  protected options?: EncodeLegendOptions;\n  protected defaultOptions: Partial<EncodeLegendOptions> = {\n    useExtent: true,\n    label: {},\n    params: {},\n    showGroupsTitle: true\n  };\n\n  /**\n   * Sets the options for encoding legend.\n   */\n  setOptions(options: EncodeLegendOptions) {\n    this.options = { ...this.defaultOptions, ...options };\n  }\n\n  /**\n   * Encodes the legend based on the provided options.\n   * @returns The encoded legend or null if no legend classes were found.\n   */\n  encodeLegend(options: EncodeLegendOptions): MFPLegendClass | null {\n    this.setOptions(options);\n    const layerLegend = this.encodeLayersLegend(options.state.layers.layersList);\n    const legend: MFPLegendClass = { classes: layerLegend };\n    return legend.classes!.length > 0 ? legend : null;\n  }\n\n  /**\n   * Encodes the legends of every given base layers (recursively).\n   * @returns The encoded legends as an array of MFPLegendClass objects.\n   */\n  encodeLayersLegend(layers: BaseLayer[]): MFPLegendClass[] {\n    const groupClasses: MFPLegendClass[] = [];\n    [...layers].forEach((layer) => {\n      const item = this.encodeLayerLegendClasses(layer);\n      if (item) {\n        this.addClassItemToArray(groupClasses, item);\n      }\n    });\n    return groupClasses;\n  }\n\n  /**\n   * Encodes the legend classes for a given layer, based on its type or className.\n   * @returns The encoded legend classes for the layer, or null if the layer is not supported.\n   */\n  encodeLayerLegendClasses(layer: BaseLayer): MFPLegendClass | null {\n    if ((layer as GroupLayer).children) {\n      return this.encodeLayerGroupLegendClasses(layer as GroupLayer);\n    }\n    if (layer.className === LayerWms.name) {\n      return this.encodeLayerWmsLegendClasses(layer as LayerWms);\n    }\n    if (layer.className === LayerWmts.name) {\n      return this.encodeLayerWmtsLegendClasses(layer as LayerWmts);\n    }\n    return null;\n  }\n\n  /**\n   * @returns The encoded legend class for the layer group.\n   */\n  encodeLayerGroupLegendClasses(layerGroup: GroupLayer): MFPLegendClass {\n    const legendGroupItem: MFPLegendClass = {};\n    if (this.options?.showGroupsTitle) {\n      legendGroupItem.name = this.options?.i18nManager.getTranslation(layerGroup.name);\n    }\n    const groupClasses: MFPLegendClass[] = [];\n    legendGroupItem.classes = groupClasses;\n    layerGroup.children.forEach((childLayer) => {\n      const child = this.encodeLayerLegendClasses(childLayer);\n      if (child) {\n        this.addClassItemToArray(groupClasses, child);\n      }\n    });\n    return this.tryToSimplifyLegendGroup(legendGroupItem);\n  }\n\n  /**\n   * @returns The encoded legend classes for a given WMTS\n   * layer, or null if the layer is not visible or inactive.\n   */\n  encodeLayerWmtsLegendClasses(layerWmts: LayerWmts): MFPLegendClass | null {\n    if (!isLayerVisible(layerWmts, this.options?.printResolution) || layerWmts.inactive) {\n      return null;\n    }\n    let icon_dpi = this.getMetadataLegendImage(layerWmts);\n    if (!icon_dpi && layerWmts._olayer) {\n      const url = LegendHelper.getWMTSLegendURL(layerWmts._olayer);\n      if (url) {\n        icon_dpi = {\n          url: url,\n          dpi: GeoConsts.SCREEN_DOTS_PER_INCH\n        };\n      }\n    }\n    if (icon_dpi) {\n      return {\n        name: this.options?.i18nManager.getTranslation(layerWmts.name),\n        icons: [icon_dpi.url]\n      };\n    }\n    return null;\n  }\n\n  /**\n   * @returns The encoded legend classes for a WMS\n   * layer, or null if the layer is not visible or inactive.\n   */\n  encodeLayerWmsLegendClasses(layerWms: LayerWms): MFPLegendClass | null {\n    if (!isLayerVisible(layerWms, this.options?.printResolution) || layerWms.inactive) {\n      return null;\n    }\n\n    const ogcServers = this.options?.state.ogcServers;\n    const ogcServer = ogcServers ? ogcServers[layerWms.ogcServer.name] : undefined;\n    const serverType = ogcServer?.type ?? '';\n    const dpi = this.options?.dpi ?? GeoConsts.SCREEN_DOTS_PER_INCH;\n\n    // Case node as a legend image\n    const icon_dpi = this.getMetadataLegendImage(layerWms);\n    if (icon_dpi) {\n      return this.getLegendClassForWMS(layerWms.name, icon_dpi, serverType);\n    }\n\n    // Case node has no legend image => Get the url for each WMS layer.\n    const legendLayerClasses: MFPLegendClass[] = [];\n    const legendGroupItem: MFPLegendClass = {\n      classes: legendLayerClasses\n    };\n    if (this.options?.showGroupsTitle) {\n      legendGroupItem.name = this.options?.i18nManager.getTranslation(layerWms.name);\n    }\n    const layerNames = layerWms.layers?.split(',') ?? [];\n    layerNames.forEach((name) => {\n      const url = LegendHelper.getWMSLegendURL(layerWms.ogcServer.url, name, {\n        dpi,\n        serverType,\n        scale: this.options?.scale,\n        bbox: this.options?.extent,\n        srs: this.options?.mapManager.getMap().getView().getProjection().getCode(),\n        additionalQueryString: this.options?.params ? this.options?.params[serverType] : undefined\n      });\n      if (!url) {\n        console.error('Missing legend url for wms: ', layerWms.name);\n        return;\n      }\n      const icon_dpi = {\n        url: url,\n        dpi: serverType === 'qgisserver' ? dpi : GeoConsts.SCREEN_DOTS_PER_INCH\n      };\n      legendLayerClasses.push(this.getLegendClassForWMS(name, icon_dpi, serverType));\n    });\n    // Case of wms layer with only one layer, use the node name and remove the useless class level.\n    if (legendLayerClasses.length === 1) {\n      const firstLegendLayer = legendLayerClasses[0];\n      delete firstLegendLayer.classes;\n      firstLegendLayer.name = this.options?.i18nManager.getTranslation(layerWms.name);\n      return firstLegendLayer;\n    }\n    return this.tryToSimplifyLegendGroup(legendGroupItem);\n  }\n\n  /**\n   * @returns a MFPLegendClass object representing the legend class for a WMS layer name.\n   */\n  getLegendClassForWMS(layerName: string, icon_dpi: LegendURLDPI, serverType: string): MFPLegendClass {\n    const legendItem = {\n      name: this.mustHideLabel(serverType) ? '' : this.options?.i18nManager.getTranslation(layerName),\n      icons: [icon_dpi.url]\n    };\n    if (icon_dpi.dpi !== GeoConsts.SCREEN_DOTS_PER_INCH) {\n      Object.assign(legendItem, { dpi: icon_dpi.dpi });\n    }\n    return legendItem;\n  }\n\n  /**\n   * Retrieves the metadata legend image or hiDPILegendImages for the given layer.\n   * @returns The metadata legend image URL and DPI, or null if not found.\n   */\n  getMetadataLegendImage(layer: LayerWms | LayerWmts): LegendURLDPI | null {\n    let dpi = this.options?.dpi ?? -1;\n    if (dpi === -1) {\n      dpi = GeoConsts.SCREEN_DOTS_PER_INCH;\n    }\n\n    let found_dpi = dpi;\n    let legendImage = layer.legendImage;\n    const hiDPILegendImages = layer.hiDPILegendImages;\n    let dist = Number.MAX_VALUE;\n    if (legendImage) {\n      dist = Math.abs(Math.log(GeoConsts.SCREEN_DOTS_PER_INCH / dpi));\n      found_dpi = GeoConsts.SCREEN_DOTS_PER_INCH;\n    }\n    if (hiDPILegendImages) {\n      for (const str_dpi in hiDPILegendImages) {\n        const new_dpi = parseFloat(str_dpi);\n        const new_dist = Math.abs(Math.log(new_dpi / dpi));\n        if (new_dist < dist) {\n          dist = new_dist;\n          found_dpi = new_dpi;\n          legendImage = hiDPILegendImages[str_dpi];\n        }\n      }\n    }\n    if (legendImage) {\n      return {\n        url: legendImage,\n        dpi: found_dpi\n      };\n    }\n    return null;\n  }\n\n  /**\n   * Determines whether the label for a specific server type must be hidden.\n   * @returns True if the label must be hidden, false otherwise.\n   * @protected\n   */\n  protected mustHideLabel(serverType: string): boolean {\n    const label = this.options?.label;\n    return !!label && label[serverType] === false;\n  }\n\n  /**\n   * Add a classItem to a classes array if the classItem to add is not null.\n   * If the classItem have embedded classes, these classes must have classItem. Otherwise, the given\n   * classItem will be not added.\n   * @protected\n   */\n  protected addClassItemToArray(classes: MFPLegendClass[], classItem: MFPLegendClass) {\n    if (classItem && (classItem.classes ? classItem.classes.length > 0 : true)) {\n      classes.push(classItem);\n    }\n  }\n\n  /**\n   * If a Legend item have only one child and the child name is identical to its name, then return\n   * only the children (cut one level). Shrink also if both names are null or undefined.\n   * Otherwise, return the given legend item.\n   * @returns The same legend item or a shrunk one.\n   * @protected\n   */\n  protected tryToSimplifyLegendGroup(legendGroupItem: MFPLegendClass) {\n    if (legendGroupItem.classes?.length === 1 && legendGroupItem.classes[0].name === legendGroupItem.name) {\n      return legendGroupItem.classes[0];\n    }\n    return legendGroupItem;\n  }\n}\n","import type { BaseCustomizer, MFPLayer, MFPImageLayer, MFPMap, MFPWmtsLayer } from '@geoblocks/mapfishprint';\nimport type GroupLayer from '../../../models/layers/grouplayer';\nimport type BaseLayer from '../../../models/layers/baselayer';\nimport MapManager from '../../../tools/state/mapManager';\nimport State from '../../../tools/state/state';\n\nimport { getAbsoluteUrl, getWmtsMatrices, getWmtsUrl, MFPVectorEncoder } from '@geoblocks/mapfishprint';\nimport { toDegrees } from 'ol/math';\nimport LayerWms from '../../../models/layers/layerwms';\nimport LayerWmts from '../../../models/layers/layerwmts';\nimport VectorLayer from 'ol/layer/Vector';\nimport { isLayerVisible } from './printUtils';\n\n/** Options for encoding a map. */\nexport interface EncodeMapOptions {\n  state: State;\n  mapManager: MapManager;\n  scale: number;\n  printResolution: number;\n  dpi: number;\n  customizer: BaseCustomizer;\n}\n\n/**\n * Class representing a Mapfish Print Encoder.\n */\nexport default class MFPEncoder {\n  private printResolution = 100;\n  private options?: EncodeMapOptions;\n\n  /**\n   * Sets the options for encoding the map.\n   */\n  setOptions(options: EncodeMapOptions) {\n    this.options = options;\n  }\n\n  /**\n   * Encodes the map options, notably the map state and the ol map into a top-level MFPMap object.\n   * @returns A Promise that resolves with the encoded map object.\n   */\n  encodeMap(options: EncodeMapOptions): MFPMap {\n    this.setOptions(options);\n    const mapManager = options.mapManager;\n    const view = mapManager.getMap().getView();\n    const center = view.getCenter() ?? [0, 0];\n    const projection = view.getProjection().getCode();\n    const rotation = toDegrees(view.getRotation());\n    this.printResolution = view.getResolution() || 100;\n    const allLayers = this.getAllLayers(options.state);\n    const mfpLayers = this.encodeLayers(allLayers);\n    mfpLayers.unshift(...this.encodeSpecialLayers(mapManager, options.customizer));\n\n    return {\n      center,\n      dpi: options.dpi,\n      projection,\n      rotation,\n      scale: options.scale,\n      layers: mfpLayers\n    };\n  }\n\n  /**\n   * @returns An array of all active layers from the state object.\n   */\n  getAllLayers(state: State) {\n    const treeLayers = this.getFlatLayers(state.layers.layersList).filter((layer) => layer.active);\n    const baseMap = state.activeBasemap?.layersList ?? [];\n    return [...treeLayers, ...baseMap];\n  }\n\n  /**\n   * @returns The flattened array of base layers.\n   */\n  getFlatLayers(baseLayers: BaseLayer[]): BaseLayer[] {\n    return baseLayers.reduce((layers, layer) => {\n      if ((layer as GroupLayer).children) {\n        const resultLayers = this.getFlatLayers((layer as GroupLayer).children);\n        layers.push(...resultLayers);\n      } else {\n        layers.push(layer);\n      }\n      return layers;\n    }, [] as BaseLayer[]);\n  }\n\n  /**\n   * Encode special layers, meaning not-in-the-layer-tree layers.\n   * These layers are from the mapManager.getLayersToPrint method.\n   * @returns An array of encodedlayers.\n   */\n  encodeSpecialLayers(mapManager: MapManager, customizer: BaseCustomizer): MFPLayer[] {\n    const encoded = [...mapManager.getLayersToPrint()]\n      .sort((olayerA, olayerB) => {\n        const indexA = olayerA.getZIndex() ?? 0;\n        const indexB = olayerB.getZIndex() ?? 0;\n        return indexB - indexA;\n      })\n      .map((olayer) => {\n        if (olayer instanceof VectorLayer) {\n          return new MFPVectorEncoder(olayer.getLayerState(), customizer).encodeVectorLayer(this.printResolution);\n        }\n        return null;\n      });\n    return encoded.filter((spec) => spec !== null) as MFPLayer[];\n  }\n\n  /**\n   * Encode layers recursively.\n   * @returns a list of Mapfish print layer specs for the given layers.\n   */\n  encodeLayers(baseLayers: BaseLayer[]): MFPLayer[] {\n    const mfpLayers = [];\n    for (const layer of baseLayers) {\n      const spec = this.encodeLayer(layer);\n      if (spec) {\n        if (Array.isArray(spec)) {\n          mfpLayers.push(...spec);\n        } else {\n          mfpLayers.push(spec);\n        }\n      }\n    }\n    return mfpLayers;\n  }\n\n  /**\n   * Encodes a layer object according to it's className and options.\n   * @returns A promise that resolves to an array of MFP layers, a single MFP layer, or null.\n   */\n  encodeLayer(layer: BaseLayer): MFPLayer[] | MFPLayer | null {\n    if (layer.className === LayerWms.name) {\n      return this.encodeImageLayer(layer as LayerWms);\n    }\n    if (layer.className === LayerWmts.name) {\n      return this.encodeTileWmtsLayer(layer as LayerWmts);\n    }\n    return null;\n  }\n\n  /**\n   * Encodes an image layer from a WMS layer object.\n   * @returns The encoded image layer or null if the layer is not visible.\n   */\n  encodeImageLayer(layerWms: LayerWms): MFPImageLayer | null {\n    if (!isLayerVisible(layerWms, this.options?.printResolution)) {\n      return null;\n    }\n    let url = layerWms.ogcServer.url;\n    if (layerWms.ogcServer.url.startsWith('//')) {\n      url = window.location.protocol + url;\n    }\n    const url_url = new URL(url);\n    const customParams: Record<string, string> = { TRANSPARENT: 'true' };\n    if (url_url.searchParams) {\n      url_url.searchParams.forEach((value, key) => {\n        customParams[key] = value;\n      });\n    }\n\n    const ogcServer = this.options?.state.ogcServers[layerWms.ogcServer.name];\n    let serverType = ogcServer?.type;\n    if (serverType === 'arcgis') {\n      serverType = undefined;\n    }\n\n    const layers = layerWms.layers?.split(',') ?? [''];\n\n    // Add empty styles if needed\n    let styles = layerWms.style?.split(',');\n    if (!styles) {\n      styles = [''];\n    }\n    // Get the same amount of styles than layers to print\n    while (layers.length > styles.length) {\n      styles.push('');\n    }\n\n    const object = {\n      baseURL: getAbsoluteUrl(url_url.origin + url_url.pathname),\n      imageFormat: layerWms.ogcServer.imageType ?? 'image/png',\n      layers: layers,\n      customParams: customParams,\n      serverType: serverType,\n      type: 'wms',\n      opacity: layerWms.opacity,\n      useNativeAngle: layerWms.printNativeAngle,\n      styles: styles\n    };\n    return object as unknown as MFPImageLayer;\n  }\n\n  /**\n   * Encodes a WMTS layer into a MFPWmtsLayer or MFPImageLayer object.\n   * @returns The encoded layer object, or null if the layer is not visible.\n   */\n  encodeTileWmtsLayer(layerWmts: LayerWmts): MFPWmtsLayer | MFPImageLayer | null {\n    if (!isLayerVisible(layerWmts, this.options?.printResolution)) {\n      return null;\n    }\n\n    if (layerWmts.printLayers || layerWmts.wmsLayers) {\n      // Print configured wms layer instead.\n      const spec = this.encodeWmsFromWmtsLayer(layerWmts);\n      if (spec) {\n        return spec;\n      }\n    }\n\n    const oLayer = layerWmts._olayer;\n    const source = oLayer?.getSource();\n\n    if (!oLayer || !source) {\n      console.warn('Can not encode tile layer: ', layerWmts);\n      return null;\n    }\n\n    const dimensionParams = source.getDimensions();\n    const dimensions = Object.keys(dimensionParams);\n\n    return {\n      baseURL: getWmtsUrl(source),\n      dimensions,\n      dimensionParams,\n      imageFormat: source.getFormat(),\n      layer: source.getLayer(),\n      matrices: getWmtsMatrices(source),\n      matrixSet: source.getMatrixSet(),\n      name: layerWmts.name,\n      opacity: layerWmts.opacity,\n      requestEncoding: source.getRequestEncoding(),\n      style: source.getStyle(),\n      type: 'wmts',\n      version: source.getVersion()\n    };\n  }\n\n  /**\n   * Encodes a WMS layer from a WMTS layer.\n   * @returns The encoded WMS layer or null if the ogcServer is missing.\n   */\n  encodeWmsFromWmtsLayer(layerWmts: LayerWmts): MFPImageLayer | null {\n    if (!layerWmts.ogcServer) {\n      console.error('Missing ogcServer');\n      return null;\n    }\n\n    const printLayers = layerWmts.printLayers ?? layerWmts.wmsLayers ?? '';\n    const layerWms = new LayerWms(0, printLayers, 0, layerWmts.ogcServer, { layers: printLayers });\n    layerWms.opacity = layerWmts.opacity;\n    return this.encodeImageLayer(layerWms);\n  }\n}\n","import type { EventsKey } from 'ol/events';\nimport type { Map } from 'ol';\nimport type BaseLayer from 'ol/layer/Base';\nimport type Feature from 'ol/Feature';\nimport { fromCircle } from 'ol/geom/Polygon.js';\n\nimport { unByKey } from 'ol/Observable';\nimport { Circle } from 'ol/geom';\nimport GeoConsts from '../geoconsts';\n\n/**\n * Unsubscribe to all OpenLayer listeners.\n */\nexport const unByKeyAll = (eventKeys: EventsKey[]) => {\n  eventKeys.forEach((eventKey) => unByKey(eventKey));\n};\n\n/**\n * @returns a layer in the map that match the given name (property name).\n */\nexport const getOlayerByName = (map: Map, layerName: string): BaseLayer | undefined => {\n  return map.getAllLayers().find((layer) => layer.get('name') === layerName);\n};\n\n/**\n * Clone the properties of the given feature and delete ol properties to keep only the feature \"app\" properties.\n * Handle map server values served as object and serve them as \"simple\" values.\n */\nexport const removeUnwantedOlParams = (feature: Feature, keepGeom = false): Record<string, unknown> => {\n  const properties = { ...feature.getProperties() };\n  delete properties.boundedBy;\n  if (!keepGeom) {\n    delete properties[feature.getGeometryName()];\n  }\n  // Handle map server values served as object.\n  Object.keys(properties).forEach((key) => {\n    const value = properties[key];\n    if (typeof value === 'object') {\n      if (value['xsi:nil'] === 'true') {\n        properties[key] = undefined;\n      } else if (value['_content_']) {\n        properties[key] = value['_content_'];\n      }\n    }\n  });\n  return properties;\n};\n\n/**\n * @returns A polygon generated from the circle.\n */\nexport const polygonFromCircle = (geometry: Circle) => {\n  return fromCircle(geometry, GeoConsts.CIRCLE_TO_POLYGON_SIDES);\n};\n","import type { MFPSpec, MFPReportResponse, MFPCancelResponse } from '@geoblocks/mapfishprint';\nimport type { MFPAttributes } from '@geoblocks/mapfishprint/src/types';\nimport type Feature from 'ol/Feature';\nimport type Geometry from 'ol/geom/Geometry';\nimport type { EncodeLegendOptions, MFPLegendClass } from './MFPLegendEncoder';\nimport type State from '../../../tools/state/state';\nimport type I18nManager from '../../../tools/i18n/i18nmanager';\nimport type MapManager from '../../../tools/state/mapManager';\nimport type { MFPPrintDatasource } from './MFPTypes';\n\nimport {\n  BaseCustomizer,\n  requestReport as requestReportMFP,\n  getDownloadUrl as getDownloadUrlMFP,\n  cancelPrint as cancelPrintMFP,\n  getPrintExtent as getPrintExtentMFP\n} from '@geoblocks/mapfishprint';\nimport { MFPLegendEncoder } from './MFPLegendEncoder';\nimport MFPEncoder from './MFPEncoder';\nimport { removeUnwantedOlParams } from '../../../tools/utils/olutils';\nimport { intersects } from 'ol/extent';\n\n/**\n * Represents encoding options to print the map.\n */\nexport interface EncodeOptions {\n  mapManager: MapManager;\n  i18nManager: I18nManager;\n  state: State;\n  scale: number;\n  printResolution: number;\n  dpi: number;\n  layout: string;\n  format: string;\n  pageSize: number[];\n  customAttributes: Record<string, unknown>;\n}\n\n/**\n * An interface class that manages printing functionality (including legend).\n */\nexport default class PrintManager {\n  protected legendEncoder: MFPLegendEncoder;\n  protected encoder: MFPEncoder;\n  protected customizer: BaseCustomizer;\n\n  constructor() {\n    this.legendEncoder = new MFPLegendEncoder();\n    this.encoder = new MFPEncoder();\n    this.customizer = new BaseCustomizer();\n  }\n\n  /**\n   * Requests a print report.\n   * @returns A promise that resolves with the response from the report request.\n   */\n  async requestReport(printUrl: string, spec: MFPSpec): Promise<MFPReportResponse> {\n    return requestReportMFP(printUrl, spec);\n  }\n\n  /**\n   * Cancels a report.\n   * @returns A promise that resolves with the cancellation response.\n   */\n  async cancelReport(printUrl: string, ref: string): Promise<MFPCancelResponse> {\n    return cancelPrintMFP(printUrl, ref);\n  }\n\n  /**\n   * Retrieves the download URL for a given request report.\n   * @returns A promise that resolves to the download URL.\n   */\n  async getDownloadUrl(\n    requestReport: string,\n    response: MFPReportResponse,\n    interval = 1000,\n    timeout = 30000\n  ): Promise<string> {\n    return getDownloadUrlMFP(requestReport, response, interval, timeout);\n  }\n\n  /**\n   * Introspect the map and convert each of its layers to MFP v3 format.\n   * @returns a top level MFP spec\n   */\n  encode(options: EncodeOptions): MFPSpec | null {\n    const center = options.mapManager.getMap().getView().getCenter() || [0, 0];\n    this.customizer.setPrintExtent(this.getExtent(options.pageSize, options.scale, center) || [0, 0, 0, 0]);\n    const mapSpec = this.encoder.encodeMap({\n      state: options.state,\n      mapManager: options.mapManager,\n      scale: options.scale,\n      printResolution: options.mapManager.getMap().getView().getResolution() || 100,\n      dpi: options.dpi,\n      customizer: this.customizer\n    });\n\n    const attributes: MFPAttributes = {\n      map: mapSpec\n    };\n    Object.assign(attributes, options.customAttributes);\n\n    return {\n      attributes,\n      format: options.format,\n      layout: options.layout\n    };\n  }\n\n  /**\n   * Encodes a print legend based on the given options.\n   * @returns The encoded legend, or null if encoding is empty or fails.\n   */\n  encodeLegend(options: EncodeLegendOptions): MFPLegendClass | null {\n    const center = options.mapManager.getMap().getView().getCenter() || [0, 0];\n    const extent = this.getExtent(options.pageSize, options.scale, center) || [0, 0, 0, 0];\n    options.extent = options.extent ?? extent;\n    return this.legendEncoder.encodeLegend(options);\n  }\n\n  /**\n   * Calculates the extent of the paper based on the given scale and center coordinates.\n   * @returns The extent of the paper.\n   */\n  getExtent(pageSize: number[], scale: number, center: number[]) {\n    return getPrintExtentMFP(pageSize, center, scale);\n  }\n\n  /**\n   * Formats the data source for printing, based on selected features filtered by the given extent.\n   * @static\n   * */\n  static getPrintDatasourceFromSelectedFeatures(\n    selectedFeatures: Feature<Geometry>[],\n    extent: number[],\n    i18nManager: I18nManager\n  ): MFPPrintDatasource[] {\n    return (\n      selectedFeatures.reduce((datasources, feature) => {\n        const featureExtent = feature.getGeometry()?.getExtent() ?? [];\n        if (!intersects(featureExtent, extent)) {\n          return datasources;\n        }\n        const id = feature.getId();\n        const rawTitle = id === undefined ? 'UNKNOWN' : `${id}`.split('.')[0];\n        const title = i18nManager.getTranslation(rawTitle);\n        const properties = removeUnwantedOlParams(feature);\n        const datasource = datasources.find((datasource) => datasource.title === title);\n        const values = Object.values(properties);\n        if (datasource) {\n          datasource.table.data.push(values);\n          return datasources;\n        }\n        datasources.push({\n          title,\n          table: {\n            data: [values],\n            columns: Object.keys(properties).map((column) => i18nManager.getTranslation(column))\n          }\n        });\n        return datasources;\n      }, [] as MFPPrintDatasource[]) || []\n    );\n  }\n}\n","import type { FrameState } from 'ol/Map';\nimport Layer from 'ol/layer/Layer';\nimport { createCanvasContext2D } from 'ol/dom';\nimport { toRadians } from 'ol/math';\nimport GeoConsts from '../../../tools/geoconsts';\n\nexport type ScaleFn = (frameState: FrameState) => number;\n\n/**\n * A layer to display a mask for a zone to print.\n */\nclass PrintMaskLayer extends Layer {\n  private readonly context: CanvasRenderingContext2D;\n  private size: [number, number] | null = null;\n  private scaleFn?: ScaleFn;\n\n  constructor(options = {}) {\n    super({ className: 'printMask', ...options });\n\n    this.context = createCanvasContext2D();\n    this.context.canvas.style.opacity = '0.5';\n    this.context.canvas.style.position = 'absolute';\n  }\n\n  /**\n   * Updates the size (width, height), in pixel, of the mask.\n   */\n  updateSize(size: [number, number]) {\n    this.size = size;\n  }\n\n  /**\n   * Sets the provided scale function to retrieve the current scale.\n   */\n  setGetScaleFn(scaleFn: ScaleFn) {\n    this.scaleFn = scaleFn;\n  }\n\n  getRotation() {\n    // Not implemented yet\n    return 0;\n  }\n\n  /**\n   * Draw the print canvas mask.\n   */\n  render(frameState: FrameState) {\n    if (this.size === null) {\n      throw Error('Cannot render Mask : size has not been set.');\n    }\n    if (!this.scaleFn) {\n      throw Error('Cannot render Mask : scaleDn has not been set.');\n    }\n\n    const cwidth = frameState.size[0];\n    this.context.canvas.width = cwidth;\n    const cheight = frameState.size[1];\n    this.context.canvas.height = cheight;\n    const center = [cwidth / 2, cheight / 2];\n\n    // background (clockwise)\n    this.context.beginPath();\n    this.context.moveTo(0, 0);\n    this.context.lineTo(cwidth, 0);\n    this.context.lineTo(cwidth, cheight);\n    this.context.lineTo(0, cheight);\n    this.context.lineTo(0, 0);\n    this.context.closePath();\n\n    const height = this.size[1];\n    const width = this.size[0];\n    const resolution = frameState.viewState.resolution;\n\n    const scale = this.scaleFn(frameState);\n    const extentHalfWidth =\n      ((width / GeoConsts.PRINT_DOTS_PER_INCH / GeoConsts.INCHES_PER_METER) * scale) / resolution / 2;\n    const extentHalfHeight =\n      ((height / GeoConsts.PRINT_DOTS_PER_INCH / GeoConsts.INCHES_PER_METER) * scale) / resolution / 2;\n\n    const rotation = this.getRotation !== undefined ? toRadians(this.getRotation()) : 0;\n\n    // diagonal = distance p1 to center.\n    const diagonal = Math.sqrt(Math.pow(extentHalfWidth, 2) + Math.pow(extentHalfHeight, 2));\n    // gamma = angle between horizontal and diagonal (with rotation).\n    const gamma = Math.atan(extentHalfHeight / extentHalfWidth) - rotation;\n    // omega = angle between diagonal and vertical (with rotation).\n    const omega = Math.atan(extentHalfWidth / extentHalfHeight) - rotation;\n    // Calculation of each corner.\n    const x1 = center[0] - Math.cos(gamma) * diagonal;\n    const y1 = center[1] + Math.sin(gamma) * diagonal;\n    const x2 = center[0] + Math.sin(omega) * diagonal;\n    const y2 = center[1] + Math.cos(omega) * diagonal;\n    const x3 = center[0] + Math.cos(gamma) * diagonal;\n    const y3 = center[1] - Math.sin(gamma) * diagonal;\n    const x4 = center[0] - Math.sin(omega) * diagonal;\n    const y4 = center[1] - Math.cos(omega) * diagonal;\n\n    // hole (counter-clockwise)\n    this.context.moveTo(x1, y1);\n    this.context.lineTo(x2, y2);\n    this.context.lineTo(x3, y3);\n    this.context.lineTo(x4, y4);\n    this.context.lineTo(x1, y1);\n    this.context.closePath();\n\n    this.context.fillStyle = '#000';\n    this.context.fill();\n\n    return this.context.canvas;\n  }\n}\n\nexport default PrintMaskLayer;\n","import type { Callback } from '../../../tools/state/statemanager';\n\nimport Map, { FrameState } from 'ol/Map';\nimport PrintMaskLayer from './printMaskLayer';\nimport GeoConsts from '../../../tools/geoconsts';\nimport StateManager from '../../../tools/state/statemanager';\nimport { getOlayerByName } from '../../../tools/utils/olutils';\nimport { Size } from 'ol/size';\n\nconst PRINT_MASK_LAYER_NAME = 'PrintMask';\n\n/**\n * Independent manager to display a mask layer adapted to the print.\n * Listen to print events to auto setup.\n */\nclass PrintMaskManager {\n  private readonly stateManager: StateManager;\n  private readonly printMaskLayer = new PrintMaskLayer({ name: PRINT_MASK_LAYER_NAME });\n  private readonly map: Map;\n  private readonly eventsCallbacks: Callback[] = [];\n  private possibleScales: number[] = [];\n\n  constructor(map: Map) {\n    this.map = map;\n    this.stateManager = StateManager.getInstance();\n    this.printMaskLayer.setGetScaleFn(this.getScaleFn.bind(this));\n    this.registerEvents();\n  }\n\n  get state() {\n    return this.stateManager.state;\n  }\n\n  destroy() {\n    this.stateManager.unsubscribe(this.eventsCallbacks);\n    this.eventsCallbacks.length = 0;\n    this.state.print.maskVisible = false;\n    this.onPrintMaskVisibleChanged();\n  }\n\n  /**\n   * Sets the possible scales to fit the mask/view to.\n   */\n  setPossibleScales(scales: number[]) {\n    this.possibleScales = [...scales].sort((v1, v2) => v2 - v1).reverse();\n  }\n\n  /**\n   * Sets the resolution of the map view to the optimal resolution for a given scale.\n   */\n  zoomToScale(scale: number) {\n    const mapSize = this.map.getSize() ?? [0, 0];\n    const printMapSize = this.state.print.pageSize ?? [0, 0];\n    const resolution = PrintMaskManager.getOptimalResolution(mapSize, printMapSize, scale);\n    this.map.getView().setResolution(resolution);\n  }\n\n  /**\n   * Register the events for printing pageSize and mask visibility changes.\n   */\n  private registerEvents() {\n    this.eventsCallbacks.push(\n      ...[\n        this.stateManager.subscribe('print.pageSize', () => this.onPrintFormatChanged()),\n        this.stateManager.subscribe('print.maskVisible', () => this.onPrintMaskVisibleChanged())\n      ]\n    );\n  }\n\n  /**\n   * Sets the print.scale value.\n   * Calculate the optimal scale for printing based on the map's current frame state and the possible scales.\n   * @returns the optimal scale.\n   * @private\n   */\n  private getScaleFn(frameState: FrameState): number {\n    // BGE debounce this could be great here\n    const mapSize = frameState.size;\n    const viewResolution = frameState.viewState.resolution;\n    console.assert(this.state.print.pageSize, 'Can not get optimal scale without print pageSize');\n    const pageSize = this.state.print.pageSize ?? [0, 0];\n    let optimalScale = PrintMaskManager.getOptimalScale(mapSize, viewResolution, pageSize, this.possibleScales);\n    if (optimalScale < 0) {\n      optimalScale = this.state.print.scale ?? 10000;\n    }\n    this.state.print.scale = optimalScale;\n    return optimalScale;\n  }\n\n  /**\n   * Display the mask or hide it.\n   * @private\n   */\n  private onPrintMaskVisibleChanged() {\n    const isLayerInMap = getOlayerByName(this.map, PRINT_MASK_LAYER_NAME);\n    if (this.state.print.maskVisible && !isLayerInMap) {\n      this.map.addLayer(this.printMaskLayer);\n      return;\n    }\n    if (!this.state.print.maskVisible && isLayerInMap) {\n      this.map.removeLayer(this.printMaskLayer);\n    }\n  }\n\n  /**\n   * Update the size (width, height), in pixels of the mask.\n   * @private\n   */\n  private onPrintFormatChanged() {\n    if (!this.state.print.pageSize) {\n      return;\n    }\n    this.printMaskLayer.updateSize(this.state.print.pageSize);\n    this.renderMask();\n  }\n\n  /**\n   * Render the mask layer again.\n   * @private\n   */\n  private renderMask() {\n    if (this.state.print.maskVisible) {\n      this.printMaskLayer.changed();\n    }\n  }\n\n  /**\n   * Calculates the optimal scale for printing a map based on the map size, resolution, desired print size, and available map scales.\n   * @param mapSize - The size of the map in meters. Expressed as an array [width, height].\n   * @param mapResolution - The resolution of the map in meters per pixel.\n   * @param printMapSize - The desired size of the printed map in inches. Expressed as an array [width, height].\n   * @param mapScales - The available map scales.\n   * @returns The optimal scale for printing the map or -1 if any.\n   */\n  static getOptimalScale(mapSize: Size, mapResolution: number, printMapSize: number[], mapScales: number[]): number {\n    const mapWidth = mapSize[0] * mapResolution;\n    const mapHeight = mapSize[1] * mapResolution;\n\n    const scaleWidth = (mapWidth * GeoConsts.INCHES_PER_METER * GeoConsts.PRINT_DOTS_PER_INCH) / printMapSize[0];\n    const scaleHeight = (mapHeight * GeoConsts.INCHES_PER_METER * GeoConsts.PRINT_DOTS_PER_INCH) / printMapSize[1];\n\n    const scale = Math.min(scaleWidth, scaleHeight);\n\n    return mapScales.reduce((optimal: number, currentScale: number) => {\n      return scale > currentScale ? currentScale : optimal;\n    }, -1);\n  }\n\n  /**\n   * Calculates the optimal resolution for printing a map based on the provided parameters.\n   * @param mapSize - The size of the map in meters.\n   * @param printMapSize - The size of the map to be printed in dots.\n   * @param scale - The scale at which the map should be printed.\n   * @returns The optimal resolution for printing the map.\n   */\n  static getOptimalResolution = (mapSize: Size, printMapSize: number[], scale: number) => {\n    const dotsPerMeter = GeoConsts.PRINT_DOTS_PER_INCH * GeoConsts.INCHES_PER_METER;\n    const resolutionX = (printMapSize[0] * scale) / (dotsPerMeter * mapSize[0]);\n    const resolutionY = (printMapSize[1] * scale) / (dotsPerMeter * mapSize[1]);\n    return Math.max(resolutionX, resolutionY);\n  };\n}\n\nexport default PrintMaskManager;\n","import type { EventsKey } from 'ol/events';\nimport type { MFPReportResponse } from '@geoblocks/mapfishprint';\nimport type {\n  MFPCapabilities,\n  MFPCapabilitiesLayout,\n  MFPCapabilitiesLayoutAttribute,\n  MFPCapabilitiesLayoutAttributeClientInfo,\n  MFPPrintDatasource\n} from './tools/MFPTypes';\nimport type { EncodeLegendOptions, MFPLegendClass } from './tools/MFPLegendEncoder';\nimport type { Callback } from '../../tools/state/statemanager';\n\nimport PrintManager from './tools/PrintManager';\nimport PrintMaskManager from './tools/printMaskManager';\nimport { toDegrees, toRadians } from 'ol/math';\nimport MapManager from '../../tools/state/mapManager';\nimport I18nManager from '../../tools/i18n/i18nmanager';\nimport { unByKeyAll } from '../../tools/utils/olutils';\nimport { padNumber } from 'ol/string';\nimport GirafeHTMLElement from '../../base/GirafeHTMLElement';\n\n/** Represents the status of a printing process. */\nenum PrintStatus {\n  Started,\n  Success,\n  Errored\n}\n\n/** Represents an ongoing or finished print element. */\ninterface PrintElement {\n  id: string;\n  selectedFormat: string;\n  selectedLayoutName: string;\n  status: PrintStatus;\n  time: string;\n  title: string;\n  downloadUrl?: string;\n  elementTitle?: string;\n}\n\n/**\n * Print panel component.\n * Read print capabilities and generate options from it.\n * Be able to print the content on the map, based on the layer tree and the OL map.\n * Have actions on the print mask and on the map (rotation).\n */\nclass PrintComponent extends GirafeHTMLElement {\n  templateUrl = './template.html';\n  styleUrl = './style.css';\n\n  private default_dpi = 96;\n  private default_scale = 10000;\n  private default_resolution = 100;\n  private default_format = 'pdf';\n\n  private readonly i18nManager: I18nManager;\n  private readonly mapManager: MapManager;\n  private readonly eventsCallbacks: Callback[] = [];\n  private readonly eventKeys: EventsKey[] = [];\n  private printManager?: PrintManager;\n  private printList: PrintElement[] = [];\n  private printUrl?: string;\n  private capabilities?: MFPCapabilities;\n  private configAttributeNames: string[] = [];\n  private printMaskManager?: PrintMaskManager;\n  private visible = false;\n  private isWithCapabilitiesComponentSetup = false;\n  private hasErrorFetchingCapabilities = false;\n  attributeNames: string[] = [];\n  printFormats: string[] = [];\n  layouts: MFPCapabilitiesLayout[] = [];\n  selectedLayout?: MFPCapabilitiesLayout;\n  scales: number[] = [];\n  dpis: number[] = [];\n\n  constructor() {\n    super('print');\n    this.mapManager = MapManager.getInstance();\n    this.i18nManager = I18nManager.getInstance();\n  }\n\n  connectedCallback() {\n    this.render();\n    this.registerVisibilityEvents();\n  }\n\n  /**\n   * Render the component regarding its visibility.\n   * Fetch the print capabilities at first rendering, then render the print mask too and register to events.\n   */\n  render() {\n    this.visible ? this.renderComponent() : this.renderEmptyComponent();\n  }\n\n  /**\n   * @returns {string} The render state.\n   * - 'error' if there was an error fetching the capabilities.\n   * - 'setup' if the capabilities have been set up.\n   * - 'loading' if the capabilities are being fetched.\n   */\n  getRenderState(): string {\n    if (this.hasErrorFetchingCapabilities) {\n      return 'error';\n    }\n    if (this.capabilities) {\n      return 'setup';\n    }\n    return 'loading';\n  }\n\n  /**\n   * Update the values relative to the layout (attributes, scales, etc.)\n   * Set scale and print format in the state.\n   * Renders the panel with new info.\n   */\n  onLayoutChanged(event: Event) {\n    const eventValue = (event.target as HTMLInputElement)?.value;\n    this.selectedLayout = this.getCapabilitiesLayout(eventValue);\n    const clientInfo = this.getClientInfo();\n    this.updateScales(clientInfo);\n    this.updateDpis(clientInfo);\n    this.updateAvailableAttributes();\n    this.state.print.pageSize = [clientInfo.width, clientInfo.height];\n    this.render();\n  }\n\n  /**\n   * Set selected scale in the state and update the mask.\n   */\n  onScaleChanged(event: Event) {\n    this.state.print.scale = parseInt((event.target as HTMLInputElement)?.value);\n    this.printMaskManager?.zoomToScale(this.state.print.scale);\n  }\n\n  /**\n   * @Returns the current print scale.\n   */\n  getSelectedScale(): number | null {\n    return this.state.print.scale;\n  }\n\n  /**\n   * @Returns the current print format value.\n   */\n  getSelectedFormat(): string | null {\n    return this.state.print.format;\n  }\n\n  /**\n   * @Returns the current print dpi value.\n   */\n  getSelectedDpi(): number | null {\n    return this.state.print.dpi;\n  }\n\n  /**\n   * Set selected print format.\n   */\n  onFormatChanged(event: Event) {\n    this.state.print.format = (event.target as HTMLInputElement)?.value;\n  }\n\n  /**\n   * Set selected dpi format.\n   */\n  onDpiChanged(event: Event) {\n    const value = (event.target as HTMLInputElement)?.value;\n    this.state.print.dpi = value ? parseInt(value) : this.default_dpi;\n  }\n\n  /**\n   * @returns {number} The rotation angle in degrees, from the map.\n   */\n  getRotation(): number {\n    return toDegrees(this.mapManager.getMap().getView().getRotation());\n  }\n\n  /**\n   * Sync both rotation inputs and update the map rotation value.\n   */\n  onInputRotationChanged(event: Event) {\n    const element = event.target as HTMLInputElement;\n    this.setRotation(element);\n  }\n\n  /**\n   * @returns The matching attribute in the selected \"capabilities\" layout.\n   */\n  getCapabilitiesAttribute(attributeName: string): MFPCapabilitiesLayoutAttribute | undefined {\n    const attributes = this.selectedLayout?.attributes ?? [];\n    return attributes.find((attr) => attr.name === attributeName);\n  }\n\n  /**\n   * Used to know the matching HTML element.\n   * @returns An arbitrary type based on the matching \"capabilities\" attribute.\n   */\n  getAttributeInputType(attributeName: string) {\n    const attribute = this.getCapabilitiesAttribute(attributeName);\n    if (attribute?.name === 'comments') return 'textarea';\n    if (attribute?.type === 'Number') return 'number';\n    if (attribute?.type === 'LegendAttributeValue') return 'checkbox';\n    if (attribute?.type === 'Boolean') return 'checkbox';\n    return 'text';\n  }\n\n  /**\n   * Legacy fix for attrName i18n.\n   */\n  attrNameForI18n(attrName: string): string {\n    if (attrName === 'legend') return 'Legend';\n    return attrName;\n  }\n\n  /**\n   * @returns html classes regarding the print status.\n   */\n  getStatusClasses(status: PrintStatus): string {\n    const baseClasses = 'status fa-solid fa-3x ';\n    if (status === PrintStatus.Errored) {\n      return baseClasses + 'error fa-triangle-exclamation';\n    }\n    if (status === PrintStatus.Success) {\n      return baseClasses + 'success fa-file-arrow-down';\n    }\n    return baseClasses + 'pending fa-circle-notch fa-spin';\n  }\n\n  /**\n   * Prints the current map state regarding every print options.\n   * Can add datasource (based on selection) and a legend.\n   * The status will be tracked until finished.\n   */\n  print() {\n    const customAttributes = this.getCustomAttributes();\n    const spec = this.printManager?.encode({\n      mapManager: this.mapManager,\n      i18nManager: this.i18nManager,\n      state: this.state,\n      scale: this.getSelectedScale() ?? this.default_scale,\n      printResolution: this.mapManager.getMap().getView().getResolution() ?? this.default_resolution,\n      pageSize: this.state.print.pageSize ?? [],\n      dpi: this.getSelectedDpi() ?? this.default_dpi,\n      layout: this.selectedLayout?.name ?? '',\n      format: this.getSelectedFormat() ?? this.default_format,\n      customAttributes\n    });\n    if (!spec) {\n      console.error('Unable to create print spec');\n      return;\n    }\n    this.printManager?.requestReport(this.printUrl ?? '', spec).then((result) => this.trackPrintStatus(result));\n  }\n\n  /**\n   * On print element clicked:\n   *  - Download it on success\n   *  - Do nothing otherwise element.\n   */\n  onPrintElementClicked(itemId: string) {\n    const printItem = this.getPrintElement(itemId);\n    if (printItem?.status !== PrintStatus.Success) {\n      return;\n    }\n    window.open(printItem.downloadUrl, '_blank');\n  }\n\n  /**\n   * Removes the print element with the specified itemId from the printList array.\n   * Cancel the print if is it not finished.\n   */\n  onCancelPrintElementClicked(itemId: string) {\n    const itemIndex = this.printList.findIndex((printItem) => printItem.id === itemId);\n    if (itemIndex < 0) {\n      return;\n    }\n    const printItem = this.printList[itemIndex];\n    if (printItem.status === PrintStatus.Started) {\n      this.printManager?.cancelReport(this.printUrl!, printItem.id);\n    }\n    this.printList.splice(itemIndex, 1);\n    this.render();\n  }\n\n  /**\n   * Renders the component by calling the necessary methods.\n   * @private\n   */\n  private renderComponent() {\n    super.render();\n    super.girafeTranslate();\n    this.activateTooltips(false, [800, 0], 'top-end');\n    this.renderComponentCapabilitiesPart();\n  }\n\n  /**\n   * Renders the component capabilities part, like the mask and the capabilities related elements.\n   * Loads the capabilities and the initial config if not already loaded.\n   * @private\n   */\n  private async renderComponentCapabilitiesPart() {\n    if (this.capabilities) {\n      // We have loaded capabilities, then renders it normally.\n      if (!this.isWithCapabilitiesComponentSetup) {\n        this.setupWithCapabilitiesComponent();\n      }\n      this.printMaskManager?.setPossibleScales(this.scales);\n      return;\n    }\n\n    // If we don't have capabilities and no error (not tried to load them), then load them.\n    if (!this.hasErrorFetchingCapabilities) {\n      await this.initComponentConfig();\n      // Render again with capabilities options or error.\n      this.render();\n    }\n    // Otherwise, does nothing (\"on error\" state).\n  }\n\n  /**\n   * Setup \"visible\" component (with capabilities) related functions.\n   * Do not update things related to the panel itself (that would need another render()).\n   * @private\n   */\n  private setupWithCapabilitiesComponent() {\n    this.state.selection.enabled = false;\n    this.updateInputRotationFromMap();\n    this.state.print.maskVisible = true;\n    this.printMaskManager = new PrintMaskManager(this.mapManager.getMap());\n    this.printMaskManager?.setPossibleScales(this.scales);\n    this.setupPrintManager();\n    this.registerEvents();\n    this.isWithCapabilitiesComponentSetup = true;\n  }\n\n  /**\n   * Renders an empty component when it's not visible.\n   * Destroy not-visibility related events.\n   * @private\n   */\n  private renderEmptyComponent() {\n    this.state.selection.enabled = true;\n    this.hasErrorFetchingCapabilities = false;\n    this.isWithCapabilitiesComponentSetup = false;\n    this.printMaskManager?.destroy();\n    unByKeyAll(this.eventKeys);\n    this.eventKeys.length = 0;\n    this.stateManager.unsubscribe(this.eventsCallbacks);\n    this.eventsCallbacks.length = 0;\n    this.renderEmpty();\n  }\n\n  /**\n   * Sets up the print manager if it doesn't already exist.\n   * @private\n   */\n  private setupPrintManager() {\n    if (!this.printManager) {\n      this.printManager = new PrintManager();\n    }\n  }\n\n  /**\n   * Event about visibility that must be always listened by this component, even hidden.\n   * @private\n   */\n  private registerVisibilityEvents() {\n    this.stateManager.subscribe('interface.printPanelVisible', (_oldValue, newValue) => this.togglePanel(newValue));\n  }\n\n  /**\n   * Listen events that must be listened if the print panel is visible.\n   * @private\n   */\n  private registerEvents() {\n    const view = this.mapManager.getMap().getView();\n    this.eventKeys.push(\n      view.on('change:rotation', () => {\n        this.updateInputRotationFromMap();\n      })\n    );\n    this.eventsCallbacks.push(\n      this.stateManager.subscribe('print.scale', (_oldVal, newVal) => {\n        const scaleElement = this.shadow.querySelector('#scale') as HTMLInputElement;\n        scaleElement.value = newVal;\n      })\n    );\n  }\n\n  /**\n   * Set the visibility of the panel.\n   * @private\n   */\n  private async togglePanel(visible: boolean): Promise<void> {\n    this.visible = visible;\n    this.render();\n  }\n\n  /**\n   * Update the input rotation value from the map rotation value.\n   */\n  private updateInputRotationFromMap() {\n    const rotationInputElement = this.shadow.querySelector('#rotationSlider') as HTMLInputElement;\n    let rotation = Math.round(this.getRotation());\n    if (rotation > 180) {\n      rotation -= 360;\n    }\n    if (rotation < -180) {\n      rotation += 360;\n    }\n    this.setRotation(rotationInputElement, rotation);\n  }\n\n  /**\n   * Sync both rotation inputs and update the map rotation value (except if the value is\n   * provided, meaning the map already has the right rotation).\n   * @private\n   */\n  private setRotation(rotationInputElement: HTMLInputElement, mapRotationValue: number | null = null) {\n    const slider = rotationInputElement.parentElement?.querySelector('#rotationSlider') as HTMLInputElement;\n    const number = rotationInputElement.parentElement?.querySelector('#rotationNumber') as HTMLInputElement;\n    const rotation = mapRotationValue ?? parseInt(rotationInputElement.value);\n    slider.value = `${rotation}`;\n    number.value = `${rotation}`;\n    if (!mapRotationValue) {\n      this.mapManager.getMap().getView().setRotation(toRadians(rotation));\n    }\n  }\n\n  /**\n   * @returns The URL to fetch the print capabilities.\n   * @private\n   */\n  private getCapabilitiesUrl(): string {\n    return this.printUrl + '/capabilities.json';\n  }\n\n  /**\n   * @returns a pending or finished PrintElement by id.\n   * @private\n   */\n  private getPrintElement(itemId: string): PrintElement | undefined {\n    return this.printList.find((element) => element.id === itemId);\n  }\n\n  /**\n   * Load the application config and then fetch the capabilities and initialize the print.\n   * @private\n   */\n  private async initComponentConfig() {\n    await this.loadConfig();\n    await this.fetchCapabilities();\n    this.initFromCapabilities();\n    if (!this.capabilities) {\n      this.hasErrorFetchingCapabilities = true;\n    }\n  }\n\n  /**\n   * @returns the fetched print capabilities or undefined in case of error.\n   * @private\n   /*/\n  private async fetchCapabilities(): Promise<MFPCapabilities | undefined> {\n    this.printUrl = this.configManager.Config.print.url;\n    if (this.printUrl.endsWith('/')) {\n      this.printUrl = this.printUrl.slice(0, -1);\n    }\n    let capabilities: MFPCapabilities | undefined = undefined;\n    try {\n      const response = await fetch(this.getCapabilitiesUrl(), { referrer: '' });\n      capabilities = await response.json();\n    } catch (error) {\n      console.error(error);\n    }\n    this.capabilities = capabilities;\n    return capabilities;\n  }\n\n  /**\n   * Init the print component default values with the print capabilities.\n   * @private\n   */\n  private initFromCapabilities() {\n    if (!this.capabilities) {\n      return;\n    }\n\n    const printLayouts = this.capabilities?.layouts ?? [];\n\n    if (!printLayouts.length) {\n      console.error(\"Can't print without any configured print layouts.\");\n      this.capabilities = undefined;\n      return;\n    }\n\n    const config = this.configManager.Config.print;\n    this.initLayouts();\n    const selectedLayout = this.getCapabilitiesLayout(config.defaultLayout ?? '');\n    this.selectedLayout = selectedLayout ?? printLayouts[0];\n    this.initFormats();\n    const clientInfo = this.getClientInfo();\n    this.updateScales(clientInfo);\n    this.updateDpis(clientInfo);\n    this.state.print.pageSize = [clientInfo.width, clientInfo.height];\n\n    if (config.attributeNames) {\n      this.configAttributeNames = config.attributeNames;\n    }\n    this.updateAvailableAttributes();\n  }\n\n  /**\n   * Initializes the print formats and default selected format based on the configuration.\n   * @private\n   */\n  private initFormats() {\n    const config = this.configManager.Config.print;\n    const printFormats = config.formats;\n    this.printFormats = PrintComponent.filterValidPrintFormats(printFormats, this.capabilities?.formats);\n    const defaultFormat = config.defaultFormat;\n    const validFormat = PrintComponent.getValidDefaultFormat(this.printFormats, defaultFormat);\n    this.state.print.format = validFormat ?? this.default_format;\n  }\n\n  /**\n   * Whitelist the available layouts with the config.print.layouts, or allows every of them.\n   * @private\n   */\n  private initLayouts() {\n    const availableLayouts = this.capabilities?.layouts;\n    const configLayouts = this.configManager.Config.print.layouts;\n    this.layouts = PrintComponent.filterValidLayouts(availableLayouts, configLayouts);\n  }\n\n  /**\n   * @returns The capabilities layout with the specified name, or undefined if not found.\n   */\n  private getCapabilitiesLayout(layoutName: string): MFPCapabilitiesLayout | undefined {\n    return this.layouts.find((layout) => layout.name === layoutName);\n  }\n\n  /**\n   * Set the available print scales for this layout.\n   * The available scales are whitelisted with the config.print.scales (if any).\n   * @private\n   */\n  private updateScales(clientInfo: MFPCapabilitiesLayoutAttributeClientInfo) {\n    this.scales = PrintComponent.filterValidScales(clientInfo.scales, this.configManager.Config.print.scales);\n    this.printMaskManager?.setPossibleScales(this.scales);\n  }\n\n  /**\n   * Updates the available DPIs and current selected dpi value based on the provided client info.\n   * @private\n   */\n  private updateDpis(clientInfo: MFPCapabilitiesLayoutAttributeClientInfo) {\n    this.dpis = clientInfo.dpiSuggestions;\n    const currentDpi = this.getSelectedDpi() ?? 0;\n    if (!this.dpis.includes(currentDpi) || currentDpi > clientInfo.maxDpi) {\n      this.state.print.dpi = this.dpis.length ? this.dpis[0] : this.default_dpi;\n    }\n  }\n\n  /**\n   * Updates the available print/panel attributes based on the selected layout and the wanted attribute names.\n   * @private\n   */\n  private updateAvailableAttributes() {\n    const layoutAttributes = this.selectedLayout?.attributes ?? [];\n    this.attributeNames = this.configAttributeNames.filter((attrName) => {\n      if (layoutAttributes.some((layoutAttr) => layoutAttr.name === attrName)) {\n        return true;\n      }\n      console.warn(`Configured attribute \"${attrName}\" does not exist in layout \"${this.selectedLayout?.name}\"`);\n    });\n  }\n\n  /**\n   * @returns The ClientInfo config object from the current selected layout.\n   * @private\n   */\n  private getClientInfo(): MFPCapabilitiesLayoutAttributeClientInfo {\n    const mapAttribute = this.getCapabilitiesAttribute('map');\n    if (!mapAttribute) {\n      console.error('No map client info in the current layout');\n    }\n    return mapAttribute!.clientInfo!;\n  }\n\n  /**\n   * @returns The capabilities attribute default value or the matching selected value in this print panel.\n   * @private\n   */\n  private getCapabilitiesAttributeValue(attrName: string): string {\n    const attribute = this.getCapabilitiesAttribute(attrName);\n    if (!attribute) {\n      return '';\n    }\n    const type = this.getAttributeInputType(attrName);\n    const input = this.shadow.querySelector(`#${attrName}`) as HTMLInputElement | undefined;\n    if (type === 'checkbox') {\n      const checked = input?.checked ?? attribute.default ?? false;\n      return `${checked}`;\n    }\n    const value = input?.value ?? attribute.default;\n    return value ? `${value}` : '';\n  }\n\n  /**\n   * @returns An object that contains the custom attributes to print the map.\n   */\n  private getCustomAttributes(): Record<string, unknown> {\n    const customAttributes = this.getAttributesAndValue();\n    if (this.getCapabilitiesAttributeValue('legend') === 'true') {\n      const legend = this.encodeLegend();\n      if (legend) {\n        customAttributes['legend'] = legend;\n      }\n    }\n    if (this.getCapabilitiesAttribute('datasource')) {\n      customAttributes['datasource'] = this.selectedFeaturesToDatasource();\n    }\n    return customAttributes;\n  }\n\n  /**\n   * @returns An object containing the configured wanted attributes to print with their corresponding attribute values.\n   * @private\n   */\n  private getAttributesAndValue(): Record<string, unknown> {\n    return this.attributeNames\n      .filter((attrName) => attrName !== 'legend')\n      .reduce(\n        (attributeObj, attrName) => {\n          attributeObj[attrName] = this.getCapabilitiesAttributeValue(attrName);\n          return attributeObj;\n        },\n        {} as Record<string, unknown>\n      );\n  }\n\n  /**\n   * @returns The encoded legend or null if empty or if encoding fails.\n   */\n  private encodeLegend(): MFPLegendClass | null {\n    const options: EncodeLegendOptions = {\n      ...{\n        mapManager: this.mapManager,\n        i18nManager: this.i18nManager,\n        state: this.state,\n        scale: this.getSelectedScale() ?? this.default_scale,\n        printResolution: this.mapManager.getMap().getView().getResolution() ?? this.default_resolution,\n        pageSize: this.state.print.pageSize ?? [],\n        dpi: this.getSelectedDpi() ?? this.default_dpi\n      },\n      ...this.configManager.Config.print.printLegend\n    };\n    return this.printManager?.encodeLegend(options) || null;\n  }\n\n  /**\n   * Set an initial print status element and track the state of the linked print task.\n   * @private\n   */\n  private trackPrintStatus(result: MFPReportResponse) {\n    const id = result.ref;\n    const date = new Date(Date.now());\n    const time = padNumber(date.getHours(), 2) + ':' + padNumber(date.getMinutes(), 2);\n    this.printList.push({\n      id,\n      time,\n      selectedFormat: this.getSelectedFormat() ?? this.default_format,\n      selectedLayoutName: this.selectedLayout?.name ?? '',\n      title: this.getCapabilitiesAttributeValue('title') || id,\n      status: PrintStatus.Started\n    });\n    this.render();\n\n    this.printManager\n      ?.getDownloadUrl(this.printUrl ?? '', result, 2000)\n      .then((downloadUrl) => this.printFinished(id, downloadUrl))\n      .catch((error) => this.printError(id, error));\n  }\n\n  /**\n   * On print finished update the print element with the status and the download url.\n   * @private\n   */\n  private printFinished(itemId: string, downloadUrl: string) {\n    const printItem = this.getPrintElement(itemId);\n    if (!printItem) {\n      return;\n    }\n    printItem.status = PrintStatus.Success;\n    printItem.downloadUrl = downloadUrl;\n    this.render();\n  }\n\n  /**\n   * On print errored update the print element with the status and the error info.\n   * @private\n   */\n  private printError(itemId: string, error: string) {\n    const printItem = this.getPrintElement(itemId);\n    if (!printItem) {\n      return;\n    }\n    printItem.status = PrintStatus.Errored;\n    printItem.elementTitle = error;\n    this.render();\n  }\n\n  /**\n   * @returns An array of MFPPrintDatasource objects representing the selected features.\n   */\n  private selectedFeaturesToDatasource(): MFPPrintDatasource[] {\n    const center = this.mapManager.getMap().getView().getCenter() ?? [0, 0];\n    const scale = this.getSelectedScale() ?? -1;\n    const pageSize = this.state.print.pageSize ?? [];\n    const extent = this.printManager?.getExtent(pageSize, scale, center) || [0, 0, Infinity, Infinity];\n    const selectedFeatures = this.state.selection.selectedFeatures ?? [];\n    return PrintManager.getPrintDatasourceFromSelectedFeatures(selectedFeatures, extent, this.i18nManager);\n  }\n\n  /**\n   * Get the print formats based on the configuration.\n   * Removes formats not proposed in the available formats.\n   * @static\n   */\n  static filterValidPrintFormats(\n    configFormats: string[] | undefined,\n    availableFormats: string[] | undefined\n  ): string[] {\n    configFormats = configFormats ?? [];\n    return configFormats.filter((format) => {\n      if (availableFormats?.includes(format)) {\n        return true;\n      }\n      console.warn(`Format ${format} is not supported.`);\n      return false;\n    });\n  }\n\n  /**\n   * @returns a valid default format from an array of print formats.\n   * @static\n   */\n  static getValidDefaultFormat(printFormats: string[], defaultFormat?: string): string | undefined {\n    if (defaultFormat) {\n      if (printFormats.includes(defaultFormat)) {\n        return defaultFormat;\n      }\n      console.warn('Configured format does not exist: ', defaultFormat);\n    }\n    return printFormats.length ? printFormats[0] : undefined;\n  }\n\n  /**\n   * Whitelist the availableLayouts with the given layouts, or allows every of them.\n   * @static\n   */\n  static filterValidLayouts(availableLayouts?: MFPCapabilitiesLayout[], layouts?: string[]): MFPCapabilitiesLayout[] {\n    if (!layouts || layouts.length <= 0) {\n      return availableLayouts ?? [];\n    }\n    // Alerts user if a configured layout doesn't exist.\n    layouts.forEach((layoutName) => {\n      if (!availableLayouts?.find((layout) => layout.name === layoutName)) {\n        console.warn('Configured layout does not exist: ', layoutName);\n      }\n    });\n    // Filter availableLayouts with the given layouts.\n    return availableLayouts?.filter((layout) => layouts.includes(layout.name)) ?? [];\n  }\n\n  /**\n   * Whitelist the availableScales with the given scales, or allows every of them.\n   * @static\n   */\n  static filterValidScales(availableScales: number[], scales?: number[]): number[] {\n    if (!scales || scales.length <= 0) {\n      return availableScales;\n    }\n    scales.forEach((scale) => {\n      if (availableScales.find((availableScale) => availableScale === scale)) {\n        console.warn('Configured scale does not exist: ', scale);\n      }\n    });\n    // Filter availableScales with the given scales.\n    return availableScales?.filter((scale) => scales.includes(scale));\n  }\n}\n\nexport default PrintComponent;\n","export default \"__VITE_ASSET__Kti3UdNe__\"","import GirafeHTMLElement from '../../base/GirafeHTMLElement';\nimport ProjIcon from './images/proj.svg';\n\nclass ProjectionComponent extends GirafeHTMLElement {\n  templateUrl = './template.html';\n\n  public projIcon: string = ProjIcon;\n\n  projections: Record<string, string> = {};\n\n  constructor() {\n    super('projection');\n  }\n\n  render() {\n    // Get projections list and store it\n    this.projections = this.configManager.Config.projections;\n\n    super.render();\n\n    // Hide menu button if only one projection\n    if (Object.keys(this.projections).length == 1) {\n      (this.shadow.host as GirafeHTMLElement).hide();\n    }\n  }\n\n  changeProjection(projection: string) {\n    console.log('change projection', projection);\n    this.state.projection = projection;\n  }\n\n  connectedCallback() {\n    this.loadConfig().then(() => {\n      this.render();\n      super.girafeTranslate();\n    });\n  }\n}\n\nexport default ProjectionComponent;\n","import GirafeHTMLElement from '../../base/GirafeHTMLElement';\n\nclass PrototypeBannerComponent extends GirafeHTMLElement {\n  templateUrl = './template.html';\n  styleUrl = './style.css';\n\n  constructor() {\n    super('prototype');\n  }\n\n  connectedCallback() {\n    this.render();\n  }\n}\n\nexport default PrototypeBannerComponent;\n","import {\n  equalTo,\n  greaterThan,\n  greaterThanOrEqualTo,\n  isNull,\n  lessThan,\n  lessThanOrEqualTo,\n  like,\n  not,\n  notEqualTo\n} from 'ol/format/filter';\nimport Filter from 'ol/format/filter/Filter';\n\nimport { XmlTypes, isStringNumeric } from '../../models/xmlTypes';\n\nexport const wfsOperatorsStrList = ['eq', 'neq', 'gt', 'gte', 'lt', 'lte', 'like', 'nlike', 'nul', 'nnul'] as const;\nexport type WfsOperator = (typeof wfsOperatorsStrList)[number];\n\nexport class WfsFilter<WfsXmlTypes = XmlTypes> {\n  property: string;\n  propertyType?: WfsXmlTypes;\n  operator: WfsOperator;\n  value: string;\n\n  constructor(property: string, operator: WfsOperator, value: string, propertyType?: WfsXmlTypes) {\n    this.property = property;\n    this.operator = operator;\n    this.value = value;\n    this.propertyType = propertyType;\n  }\n\n  public toOpenLayersFilter(): Filter {\n    if (!this.propertyType) {\n      throw new Error('The type of the property should never be null !');\n    }\n\n    //(this.property, this.value, propertyType)\n    switch (this.operator) {\n      case 'eq':\n        if (this.propertyType === 'string' && isStringNumeric(this.value)) {\n          // See https://mapserver-users.osgeo.narkive.com/P0EVA6Qr/wfs-filter-creates-a-query-using-a-number-instead-of-text\n          return like(this.property, '*' + this.value + '*');\n        } else {\n          return equalTo(this.property, this.value as string | number);\n        }\n      case 'neq':\n        if (this.propertyType === 'string' && isStringNumeric(this.value)) {\n          // See https://mapserver-users.osgeo.narkive.com/P0EVA6Qr/wfs-filter-creates-a-query-using-a-number-instead-of-text\n          return not(like(this.property, '*' + this.value + '*'));\n        } else {\n          return notEqualTo(this.property, this.value as string | number);\n        }\n      case 'gt':\n        return greaterThan(this.property, Number(this.value));\n      case 'gte':\n        return greaterThanOrEqualTo(this.property, Number(this.value));\n      case 'lt':\n        return lessThan(this.property, Number(this.value));\n      case 'lte':\n        return lessThanOrEqualTo(this.property, Number(this.value));\n      case 'like':\n        return like(this.property, '*' + this.value + '*');\n      case 'nlike':\n        return not(like(this.property, '*' + this.value + '*'));\n      case 'nul':\n        return isNull(this.property);\n      case 'nnul':\n        return not(isNull(this.property));\n      default:\n        throw new Error('Unknown filter operator');\n    }\n  }\n\n  /**\n   *\n   * @returns a simple filter string that can be used in a WMS GetMap request, does not provide any XML namespace (xmlns attributes)\n   */\n  toSimpleXmlFilter(): string {\n    if (!this.propertyType) {\n      throw new Error('The type of the property should never be null !');\n    }\n    const wildCard = WfsFilter.simpleLikeFilterGenerateWildCard(this.value);\n\n    switch (this.operator) {\n      case 'eq':\n        if (this.propertyType === 'string' && isStringNumeric(this.value)) {\n          // See https://mapserver-users.osgeo.narkive.com/P0EVA6Qr/wfs-filter-creates-a-query-using-a-number-instead-of-text\n          return WfsFilter.simpleLikeFilter(this.property, this.value);\n        } else {\n          return WfsFilter.simpleEqFilter(this.property, this.value);\n        }\n      case 'neq':\n        if (this.propertyType === 'string' && isStringNumeric(this.value)) {\n          // See https://mapserver-users.osgeo.narkive.com/P0EVA6Qr/wfs-filter-creates-a-query-using-a-number-instead-of-text\n          return WfsFilter.simpleNlikeFilter(this.property, this.value);\n        } else {\n          return WfsFilter.simpleNeqFilter(this.property, this.value);\n        }\n      case 'gt':\n        return WfsFilter.simpleGtFilter(this.property, this.value);\n      case 'gte':\n        return WfsFilter.simpleGteFilter(this.property, this.value);\n      case 'lt':\n        return WfsFilter.simpleLtFilter(this.property, this.value);\n      case 'lte':\n        return WfsFilter.simpleLteFilter(this.property, this.value);\n      case 'like':\n        return WfsFilter.simpleLikeFilter(this.property, wildCard + this.value + wildCard, wildCard);\n      case 'nlike':\n        return WfsFilter.simpleNlikeFilter(this.property, wildCard + this.value + wildCard, wildCard);\n      case 'nul':\n        return WfsFilter.simpleEqFilter(this.property, '');\n      case 'nnul':\n        return WfsFilter.simpleNeqFilter(this.property, '');\n      default:\n        throw new Error('Unknown filter operator');\n    }\n  }\n\n  protected static simpleEqFilter(name: string, value: string) {\n    return `<Filter><PropertyIsEqualTo><PropertyName>${name}</PropertyName><Literal>${value}</Literal></PropertyIsEqualTo></Filter>`;\n  }\n\n  protected static simpleNeqFilter(name: string, value: string) {\n    return `<Filter><Not><PropertyIsEqualTo><PropertyName>${name}</PropertyName><Literal>${value}</Literal></PropertyIsEqualTo></Not></Filter>`;\n  }\n\n  protected static simpleLtFilter(name: string, value: string) {\n    return `<Filter><PropertyIsLessThan><PropertyName>${name}</PropertyName><Literal>${value}</Literal></PropertyIsLessThan></Filter>`;\n  }\n\n  protected static simpleLteFilter(name: string, value: string) {\n    return `<Filter><PropertyIsLessThanOrEqualTo><PropertyName>${name}</PropertyName><Literal>${value}</Literal></PropertyIsLessThanOrEqualTo></Filter>`;\n  }\n\n  protected static simpleGtFilter(name: string, value: string) {\n    return `<Filter><PropertyIsGreaterThan><PropertyName>${name}</PropertyName><Literal>${value}</Literal></PropertyIsGreaterThan></Filter>`;\n  }\n\n  protected static simpleGteFilter(name: string, value: string) {\n    return `<Filter><PropertyIsGreaterThanOrEqualTo><PropertyName>${name}</PropertyName><Literal>${value}</Literal></PropertyIsGreaterThanOrEqualTo></Filter>`;\n  }\n\n  protected static simpleInnerLikeFilter(name: string, value: string, wildCard?: string) {\n    if (!wildCard) {\n      wildCard = WfsFilter.simpleLikeFilterGenerateWildCard(value);\n    }\n    return `<PropertyIsLike wildCard=\"${wildCard}\" singleChar=\".\" escapeChar=\"!\"><PropertyName>${name}</PropertyName><Literal>${value}</Literal></PropertyIsLike>`;\n  }\n\n  protected static simpleLikeFilter(name: string, value: string, wildCard?: string) {\n    return '<Filter>' + this.simpleInnerLikeFilter(name, value, wildCard) + '</Filter>';\n  }\n\n  protected static simpleNlikeFilter(name: string, value: string, wildCard?: string) {\n    return '<Filter><Not>' + this.simpleInnerLikeFilter(name, value, wildCard) + '</Not></Filter>';\n  }\n\n  // TODO: make wildcard/escape/single char configurable in config.json/themes.json?\n  // Here is a quickfix for map.bs.ch not accepting * in url params\n  protected static simpleLikeFilterGenerateWildCard(value: string): string {\n    return 'WABCDEFGIJKLMNOPQRSTUVXYZ'.split('').find((c) => !value.includes(c)) ?? '*';\n  }\n}\n\nexport default WfsFilter;\n","import GirafeHTMLElement from '../../base/GirafeHTMLElement';\nimport LayerWms from '../../models/layers/layerwms';\nimport WfsManager from '../../tools/wfs/wfsmanager';\nimport { LayerAttribute } from '../../models/serverwfs';\nimport { WfsFilter, WfsOperator } from '../../tools/wfs/wfsfilter';\nimport { xmlNumberTypesStrList, xmlStringTypesStrList } from '../../models/xmlTypes';\n\nclass QueryBuilderComponent extends GirafeHTMLElement {\n  templateUrl = './template.html';\n  styleUrl = './style.css';\n\n  loading: boolean = true;\n  deactivated: boolean = false;\n  layer: LayerWms;\n  layerAttributes: LayerAttribute[] = [];\n  currentLayerAttribute?: LayerAttribute = undefined;\n\n  showVal: boolean = false;\n\n  constructor(layer: LayerWms) {\n    super('querybuilder');\n    this.layer = layer;\n  }\n\n  render() {\n    if (!this.layer.ogcServer.urlWfs) {\n      throw new Error('No WFS URL found. Please verify the Layer type.');\n    }\n\n    super.render();\n\n    WfsManager.getInstance()\n      .getServerWfs(this.layer)\n      .then((serverWfs) => {\n        const queryLayers = this.layer.queryLayers!.split(',');\n\n        const stackedLayerAttributes = queryLayers.map((l: string) => serverWfs.layers[l]);\n        const layerAttributesCount: Record<string, number> = {};\n        for (const la of stackedLayerAttributes.flat()) {\n          if (layerAttributesCount[la.name] === undefined) {\n            layerAttributesCount[la.name] = 0;\n          }\n          layerAttributesCount[la.name]++;\n        }\n        const commonAttributesNames = Object.keys(layerAttributesCount).filter(\n          (k) => layerAttributesCount[k] === queryLayers.length\n        );\n        const commonAttributes = stackedLayerAttributes[0]\n          ? stackedLayerAttributes[0].filter((la) => commonAttributesNames.includes(la.name))\n          : [];\n\n        this.deactivated = commonAttributes.length === 0;\n        if (this.deactivated) {\n          console.log(\n            'Filtering for layer group ' +\n              this.layer.name +\n              \" is deactivated because the queryLayers don't have common attributes.\"\n          );\n        }\n        this.layerAttributes = commonAttributes;\n        this.loading = false;\n        super.render();\n        super.girafeTranslate();\n        this.activateTooltips(false, [800, 0], 'top-end');\n      });\n  }\n\n  get isString() {\n    // TODO REG: Manage the type date as a separate type\n    return xmlStringTypesStrList.includes(this.currentLayerAttribute?.type ?? '');\n  }\n\n  get isNumber() {\n    return xmlNumberTypesStrList.includes(this.currentLayerAttribute?.type ?? '');\n  }\n\n  attributeChanged() {\n    const attributeSelect = this.shadow.getElementById('attribute') as HTMLSelectElement;\n    const layerAttribute = this.layerAttributes.find((attr) => attr.name == attributeSelect.value);\n    if (!layerAttribute) {\n      throw new Error('Why is this object null ? This should never happen...');\n    }\n\n    this.currentLayerAttribute = layerAttribute;\n    super.render();\n  }\n\n  operatorChanged() {\n    const operatorSelect = this.shadow.getElementById('operator') as HTMLSelectElement;\n    this.showVal = operatorSelect.value !== 'nul' && operatorSelect.value !== 'nnul';\n    super.render();\n  }\n\n  onValueKeyPress(event: KeyboardEvent) {\n    if (event.key === 'Enter') {\n      this.filter();\n    }\n  }\n\n  getFilterElements() {\n    const attributeSelect = this.shadow.getElementById('attribute') as HTMLSelectElement;\n    const operatorSelect = this.shadow.getElementById('operator') as HTMLSelectElement;\n    const valueInput = this.shadow.getElementById('val') as HTMLInputElement;\n    return [attributeSelect, operatorSelect, valueInput];\n  }\n\n  getFilter() {\n    const [attributeSelect, operatorSelect, val] = this.getFilterElements();\n\n    const property = attributeSelect.value;\n    const operator = operatorSelect.value as WfsOperator;\n    const value = val.value;\n    const filter = new WfsFilter(property, operator, value, this.currentLayerAttribute?.type);\n    return filter;\n  }\n\n  filter() {\n    this.layer.filter = this.getFilter();\n  }\n\n  removeFilter() {\n    const [attributeSelect, operatorSelect, val] = this.getFilterElements();\n\n    this.layer.filter = undefined;\n    attributeSelect.value = '';\n    operatorSelect.value = '';\n    val.value = '';\n    this.currentLayerAttribute = undefined;\n    this.showVal = false;\n    super.render();\n  }\n\n  connectedCallback() {\n    this.loadConfig().then(() => {\n      this.render();\n    });\n  }\n}\n\nexport default QueryBuilderComponent;\n","export default class ShapeNamer {\n  static getRandomName(suffix: string) {\n    return adjectives[Math.floor(Math.random() * adjectives.length)] + ' ' + suffix;\n  }\n}\n\n// prettier-ignore\nconst adjectives = [\n  'aback','abaft','abandoned','abashed','aberrant','abhorrent','abiding','abject','ablaze','able',\n  'abnormal','aboriginal','abortive','abounding','abrasive','abrupt','absent','absorbed','absorbing','abstracted',\n  'absurd','abundant','abusive','acceptable','accessible','accidental','accurate','acid','acidic','acoustic',\n  'acrid','adamant','adaptable','addicted','adhesive','adjoining','adorable','adventurous','afraid','aggressive',\n  'agonizing','agreeable','ahead','ajar','alert','alike','alive','alleged','alluring','aloof',\n  'amazing','ambiguous','ambitious','amuck','amused','amusing','ancient','angry','animated','annoyed',\n  'annoying','anxious','apathetic','aquatic','aromatic','arrogant','ashamed','aspiring','assorted','astonishing',\n  'attractive','auspicious','automatic','available','average','aware','awesome','axiomatic','bad','barbarous',\n  'bashful','bawdy','beautiful','befitting','belligerent','beneficial','bent','berserk','bewildered','big',\n  'billowy','bite-sized','bitter','bizarre','black','black-and-white','bloody','blue','blue-eyed','blushing',\n  'boiling','boorish','bored','boring','bouncy','boundless','brainy','brash','brave','brawny',\n  'breakable','breezy','brief','bright','broad','broken','brown','bumpy','burly','bustling',\n  'busy','cagey','calculating','callous','calm','capable','capricious','careful','careless','caring',\n  'cautious','ceaseless','certain','changeable','charming','cheap','cheerful','chemical','chief','childlike',\n  'chilly','chivalrous','chubby','chunky','clammy','classy','clean','clear','clever','cloistered',\n  'cloudy','closed','clumsy','cluttered','coherent','cold','colorful','colossal','combative','comfortable',\n  'common','complete','complex','concerned','condemned','confused','conscious','cooing','cool','cooperative',\n  'coordinated','courageous','cowardly','crabby','craven','crazy','creepy','crooked','crowded','cruel',\n  'cuddly','cultured','cumbersome','curious','curly','curved','curvy','cut','cute','cynical',\n  'daffy','daily','damaged','damaging','damp','dangerous','dapper','dark','dashing','dazzling',\n  'dead','deadpan','deafening','dear','debonair','decisive','decorous','deep','deeply','defeated',\n  'defective','defiant','delicate','delicious','delightful','demonic','delirious','dependent','depressed','deranged',\n  'descriptive','deserted','detailed','determined','devilish','didactic','different','difficult','diligent','direful',\n  'dirty','disagreeable','disastrous','discreet','disgusted','disgusting','disillusioned','dispensable','distinct','disturbed',\n  'divergent','dizzy','domineering','doubtful','drab','draconian','dramatic','dreary','drunk','dry',\n  'dull','dusty','dynamic','dysfunctional','eager','early','earsplitting','earthy','easy','eatable',\n  'economic','educated','efficacious','efficient','elastic','elated','elderly','electric','elegant','elfin',\n  'elite','embarrassed','eminent','empty','enchanted','enchanting','encouraging','endurable','energetic','enormous',\n  'entertaining','enthusiastic','envious','equable','equal','erect','erratic','ethereal','evanescent','evasive',\n  'even','excellent','excited','exciting','exclusive','exotic','expensive','extra-large','extra-small','exuberant',\n  'exultant','fabulous','faded','faint','fair','faithful','fallacious','false','familiar','famous',\n  'fanatical','fancy','fantastic','far','far-flung','fascinated','fast','fat','faulty','fearful',\n  'fearless','feeble','feigned','female','fertile','festive','few','fierce','filthy','fine',\n  'finicky','first','fixed','flagrant','flaky','flashy','flat','flawless','flimsy','flippant',\n  'flowery','fluffy','fluttering','foamy','foolish','foregoing','forgetful','fortunate','frail','fragile',\n  'frantic','free','freezing','frequent','fresh','fretful','friendly','frightened','frightening','full',\n  'fumbling','functional','funny','furry','furtive','future','futuristic','fuzzy','gabby','gainful',\n  'gamy','gaping','garrulous','gaudy','general','gentle','giant','giddy','gifted','gigantic',\n  'glamorous','gleaming','glib','glistening','glorious','glossy','godly','good','goofy','gorgeous',\n  'graceful','grandiose','grateful','gratis','gray','greasy','great','greedy','green','grey',\n  'grieving','groovy','grotesque','grouchy','grubby','gruesome','grumpy','guarded','guiltless','gullible',\n  'gusty','guttural','habitual','half','hallowed','halting','handsome','handy','hanging','hapless',\n  'happy','hard','hard-to-find','harmonious','harsh','hateful','heady','healthy','heartbreaking','heavenly',\n  'heavy','hellish','helpful','helpless','hesitant','hideous','high','highfalutin','high-pitched','hilarious',\n  'hissing','historical','holistic','hollow','homeless','homely','honorable','horrible','hospitable','hot',\n  'huge','hulking','humdrum','humorous','hungry','hurried','hurt','hushed','husky','hypnotic',\n  'hysterical','icky','icy','idiotic','ignorant','ill','illegal','ill-fated','ill-informed','illustrious',\n  'imaginary','immense','imminent','impartial','imperfect','impolite','important','imported','impossible','incandescent',\n  'incompetent','inconclusive','industrious','incredible','inexpensive','infamous','innate','innocent','inquisitive','insidious',\n  'instinctive','intelligent','interesting','internal','invincible','irate','irritating','itchy','jaded','jagged',\n  'jazzy','jealous','jittery','jobless','jolly','joyous','judicious','juicy','jumbled','jumpy',\n  'juvenile','keen','kind','kindhearted','kindly','knotty','knowing','knowledgeable','known','labored',\n  'lackadaisical','lacking','lame','lamentable','languid','large','last','late','laughable','lavish',\n  'lazy','lean','learned','left','legal','lethal','level','lewd','light','like',\n  'likeable','limping','literate','little','lively','living','lonely','long','longing','long-term',\n  'loose','lopsided','loud','loutish','lovely','loving','low','lowly','lucky','ludicrous',\n  'lumpy','lush','luxuriant','lying','lyrical','macabre','macho','maddening','madly','magenta',\n  'magical','magnificent','majestic','makeshift','male','malicious','mammoth','maniacal','many','marked',\n  'massive','married','marvelous','material','materialistic','mature','mean','measly','meaty','medical',\n  'meek','mellow','melodic','melted','merciful','mere','messy','mighty','military','milky',\n  'mindless','miniature','minor','miscreant','misty','mixed','moaning','modern','moldy','momentous',\n  'motionless','mountainous','muddled','mundane','murky','mushy','mute','mysterious','naive','nappy',\n  'narrow','nasty','natural','naughty','nauseating','near','neat','nebulous','necessary','needless',\n  'needy','neighborly','nervous','new','next','nice','nifty','nimble','nippy','noiseless',\n  'noisy','nonchalant','nondescript','nonstop','normal','nostalgic','nosy','noxious','numberless','numerous',\n  'nutritious','nutty','oafish','obedient','obeisant','obese','obnoxious','obscene','obsequious','observant',\n  'obsolete','obtainable','oceanic','odd','offbeat','old','old-fashioned','omniscient','onerous','open',\n  'opposite','optimal','orange','ordinary','organic','ossified','outgoing','outrageous','outstanding','oval',\n  'overconfident','overjoyed','overrated','overt','overwrought','painful','painstaking','pale','paltry','panicky',\n  'panoramic','parallel','parched','parsimonious','past','pastoral','pathetic','peaceful','penitent','perfect',\n  'periodic','permissible','perpetual','petite','phobic','physical','picayune','pink','piquant','placid',\n  'plain','plant','plastic','plausible','pleasant','plucky','pointless','poised','polite','political',\n  'poor','possessive','possible','powerful','precious','premium','present','pretty','previous','pricey',\n  'prickly','private','probable','productive','profuse','protective','proud','psychedelic','psychotic','public',\n  'puffy','pumped','puny','purple','purring','pushy','puzzled','puzzling','quaint','quarrelsome',\n  'questionable','quick','quiet','quirky','quixotic','quizzical','rabid','racial','ragged','rainy',\n  'rambunctious','rampant','rapid','rare','raspy','ratty','ready','real','rebel','receptive',\n  'recondite','red','redundant','reflective','regular','relieved','remarkable','reminiscent','repulsive','resolute',\n  'resonant','responsible','rhetorical','rich','right','righteous','rightful','rigid','ripe','ritzy',\n  'roasted','robust','romantic','roomy','rotten','rough','round','royal','ruddy','rude',\n  'rural','rustic','ruthless','sable','sad','safe','salty','same','sassy','satisfying',\n  'savory','scandalous','scarce','scared','scary','scattered','scientific','scintillating','scrawny','screeching',\n  'second','second-hand','secret','secretive','sedate','seemly','selective','selfish','separate','serious',\n  'shaggy','shaky','shallow','sharp','shiny','shivering','shocking','short','shrill','shut',\n  'shy','sick','silent','silky','silly','simple','simplistic','sincere','skillful','skinny',\n  'sleepy','slim','slimy','slippery','sloppy','slow','small','smart','smelly','smiling',\n  'smoggy','smooth','sneaky','snobbish','snotty','soft','soggy','solid','somber','sophisticated',\n  'sordid','sore','sour','sparkling','special','spectacular','spicy','spiffy','spiky','spiritual',\n  'spiteful','splendid','spooky','spotless','spotted','spotty','spurious','squalid','square','squealing',\n  'squeamish','staking','stale','standing','statuesque','steadfast','steady','steep','stereotyped','sticky',\n  'stiff','stimulating','stingy','stormy','straight','strange','striped','strong','stupendous','sturdy',\n  'subdued','subsequent','substantial','successful','succinct','sudden','sulky','super','superb','superficial',\n  'supreme','swanky','sweet','sweltering','swift','symptomatic','synonymous','taboo','tacit','tacky',\n  'talented','tall','tame','tan','tangible','tangy','tart','tasteful','tasteless','tasty',\n  'tawdry','tearful','tedious','teeny','teeny-tiny','telling','temporary','ten','tender','tense',\n  'tenuous','terrific','tested','testy','thankful','therapeutic','thick','thin','thinkable','third',\n  'thirsty','thoughtful','thoughtless','threatening','thundering','tidy','tight','tightfisted','tiny','tired',\n  'tiresome','toothsome','torpid','tough','towering','tranquil','trashy','tremendous','tricky','trite',\n  'troubled','truculent','true','truthful','typical','ubiquitous','ultra','unable','unaccountable','unadvised',\n  'unarmed','unbecoming','unbiased','uncovered','understood','undesirable','unequal','unequaled','uneven','unhealthy',\n  'uninterested','unique','unkempt','unknown','unnatural','unruly','unsightly','unsuitable','untidy','unused',\n  'unusual','unwieldy','unwritten','upbeat','uppity','upset','uptight','used','useful','useless',\n  'utopian','vacuous','vagabond','vague','valuable','various','vast','vengeful','venomous','verdant',\n  'versed','victorious','vigorous','violent','violet','vivacious','voiceless','volatile','voracious','vulgar',\n  'wacky','waggish','waiting','wakeful','wandering','wanting','warlike','warm','wary','wasteful',\n  'watery','weak','wealthy','weary','well-groomed','well-made','well-off','well-to-do','wet','whimsical',\n  'whispering','white','whole','wholesale','wicked','wide','wide-eyed','wiggly','wild','willing',\n  'windy','wiry','wise','wistful','witty','woebegone','womanly','wonderful','wooden','woozy',\n  'workable','worried','worthless','wrathful','wretched','wrong','wry','yellow','yielding','young',\n  'youthful','yummy','zany','zealous','zesty','zippy','zonked'\n];\n","import ConfigManager from '../../tools/configuration/configmanager';\nimport StateManager from '../../tools/state/statemanager';\nimport ShapeNamer from './shapeNamer';\nimport { v4 as uuidv4 } from 'uuid';\n\nexport enum DrawingShape {\n  Point,\n  Polyline,\n  Polygon,\n  Square,\n  Rectangle,\n  Disk,\n  FreehandPolyline,\n  FreehandPolygon\n}\n\nexport class DrawingState {\n  activeTool: DrawingShape | null = null;\n  features: DrawingFeature[] = [];\n}\n\nexport type SerializedFeature = {\n  n: string;\n  sc: string;\n  sw: number;\n  fc: string;\n  nfz: number;\n  mfz: number;\n  f: string;\n  g: object;\n  dn: boolean;\n  dm: boolean;\n  nc: string;\n  mc: string;\n  t: DrawingShape;\n};\n\nexport default class DrawingFeature {\n  private _tool: DrawingShape;\n  private _name: string;\n  private _nameColor: string;\n  private _strokeColor: string;\n  private _strokeWidth: number;\n  private _fillColor: string;\n  private _nameFontSize: number;\n  private _measureFontSize: number;\n  private _measureColor: string;\n  private _font: string;\n  private _displayName: boolean = true;\n  private _displayMeasure: boolean = true;\n\n  geojson: object;\n  id: string = uuidv4();\n  onChange: (f: DrawingFeature) => void = () => {};\n\n  constructor(tool: DrawingShape, geojson: object = {}, name: string | null = null) {\n    const defaultConfig = ConfigManager.getInstance().Config.drawing;\n    this._tool = tool;\n    this._name = name == null ? ShapeNamer.getRandomName(DrawingShape[tool]) : name;\n    this._strokeColor = defaultConfig.defaultStrokeColor;\n    this._strokeWidth = defaultConfig.defaultStrokeWidth;\n    this._fillColor = defaultConfig.defaultFillColor;\n    this._nameFontSize = defaultConfig.defaultTextSize;\n    this._measureFontSize = defaultConfig.defaultTextSize;\n    this._font = defaultConfig.defaultFont;\n    this.geojson = geojson;\n    this._nameColor = '#000000';\n    this._measureColor = '#000000';\n  }\n\n  get name() {\n    return this._name;\n  }\n  set name(v) {\n    this._name = v;\n    this.onChange(this);\n  }\n\n  get strokeColor() {\n    return this._strokeColor;\n  }\n  set strokeColor(v) {\n    this._strokeColor = v;\n    this.onChange(this);\n  }\n\n  get strokeWidth() {\n    return this._strokeWidth;\n  }\n  set strokeWidth(v) {\n    this._strokeWidth = v;\n    this.onChange(this);\n  }\n\n  get fillColor() {\n    return this._fillColor;\n  }\n  set fillColor(v) {\n    this._fillColor = v;\n    this.onChange(this);\n  }\n\n  get nameFontSize() {\n    return this._nameFontSize;\n  }\n  set nameFontSize(v) {\n    this._nameFontSize = v;\n    this.onChange(this);\n  }\n\n  get measureFontSize() {\n    return this._measureFontSize;\n  }\n  set measureFontSize(v) {\n    this._measureFontSize = v;\n    this.onChange(this);\n  }\n\n  get font() {\n    return this._font;\n  }\n  set font(v) {\n    this._font = v;\n    this.onChange(this);\n  }\n\n  get displayName() {\n    return this._displayName;\n  }\n  set displayName(v) {\n    this._displayName = v;\n    this.onChange(this);\n  }\n\n  get displayMeasure() {\n    return this._displayMeasure;\n  }\n  set displayMeasure(v) {\n    this._displayMeasure = v;\n    this.onChange(this);\n  }\n\n  get nameColor() {\n    return this._nameColor;\n  }\n  set nameColor(v) {\n    this._nameColor = v;\n    this.onChange(this);\n  }\n\n  get measureColor() {\n    return this._measureColor;\n  }\n  set measureColor(v) {\n    this._measureColor = v;\n    this.onChange(this);\n  }\n\n  get type() {\n    return this._tool;\n  }\n\n  addToState() {\n    (StateManager.getInstance().state.extendedState.drawing as DrawingState).features.push(this);\n  }\n\n  serialize(): SerializedFeature {\n    return {\n      n: this._name,\n      sc: this._strokeColor,\n      sw: this._strokeWidth,\n      fc: this._fillColor,\n      nfz: this._nameFontSize,\n      mfz: this._measureFontSize,\n      f: this._font,\n      g: this.geojson,\n      t: this._tool,\n      dn: this._displayName,\n      dm: this._displayMeasure,\n      nc: this._nameColor,\n      mc: this._measureColor\n    };\n  }\n\n  getLengthText(length: number) {\n    if (this.displayMeasure) {\n      return length > 100 ? (length / 1000).toFixed(2) + ' km' : length.toFixed(2) + ' m';\n    } else {\n      return '';\n    }\n  }\n\n  getAreaText(area: number) {\n    if (this.displayMeasure) {\n      return area > 10000 ? (area / 1000000).toFixed(2) + ' km' : area.toFixed(2) + ' m';\n    } else {\n      return '';\n    }\n  }\n\n  getCoordText(coord: number[]) {\n    if (!this.displayMeasure) {\n      return '';\n    } else if (coord.length > 2) {\n      return 'E ' + coord[0].toFixed(2) + '\\nN ' + coord[1].toFixed(2) + '\\nH ' + coord[2].toFixed(2);\n    } else {\n      return 'E ' + coord[0].toFixed(2) + '\\nN ' + coord[1].toFixed(2);\n    }\n  }\n\n  isPointOrPolyline() {\n    return (\n      this.type == DrawingShape.Point ||\n      this.type == DrawingShape.Polyline ||\n      this.type == DrawingShape.FreehandPolyline\n    );\n  }\n\n  static deserialize(serializedFeature: SerializedFeature) {\n    const newFeature = new DrawingFeature(serializedFeature.t, serializedFeature.g, serializedFeature.n);\n    newFeature.strokeColor = serializedFeature.sc;\n    newFeature.strokeWidth = serializedFeature.sw;\n    newFeature.fillColor = serializedFeature.fc;\n    newFeature.nameFontSize = serializedFeature.nfz;\n    newFeature.measureFontSize = serializedFeature.mfz;\n    newFeature.font = serializedFeature.f;\n    newFeature.geojson = serializedFeature.g;\n    newFeature.displayName = serializedFeature.dn;\n    newFeature.displayMeasure = serializedFeature.dm;\n    newFeature.nameColor = serializedFeature.nc;\n    newFeature.measureColor = serializedFeature.mc;\n    newFeature.addToState();\n    return newFeature;\n  }\n\n  static circleToPolygon(center: number[], radius: number, nbEdges: number = 300) {\n    const positions: number[][] = [];\n    for (let i = 0; i < 2 * Math.PI; i += (2 * Math.PI) / nbEdges) {\n      positions.push([center[0] + radius * Math.cos(i), center[1] + radius * Math.sin(i)]);\n    }\n    return [...positions, positions[0]];\n  }\n}\n","import DrawingFeature, { DrawingShape } from './drawingFeature';\nimport MapComponent from '../map/component';\nimport StateManager from '../../tools/state/statemanager';\nimport State from '../../tools/state/state';\nimport { Collection, Feature } from 'ol';\nimport { Geometry, LineString, Point, Polygon, Circle as CircleGeom, SimpleGeometry } from 'ol/geom';\nimport { createBox, createRegularPolygon, SketchCoordType } from 'ol/interaction/Draw';\nimport { Type } from 'ol/geom/Geometry';\nimport { Style, Stroke, Text, Fill, Circle, RegularShape } from 'ol/style';\nimport { Modify, Snap, Draw } from 'ol/interaction';\nimport VectorSource, { VectorSourceEvent } from 'ol/source/Vector';\nimport VectorLayer from 'ol/layer/Vector';\nimport GeoJSON from 'ol/format/GeoJSON';\nimport { Projection } from 'ol/proj';\nimport { Coordinate } from 'ol/coordinate';\n\nfunction getLength(coordinates: Coordinate[]) {\n  return new LineString(coordinates).getLength();\n}\n\nfunction getArea(polygon: Polygon) {\n  return polygon.getArea();\n}\n\nfunction getHalfPoint(coordinates: Coordinate[]) {\n  return new Point(new LineString(coordinates).getCoordinateAt(0.5));\n}\n\nfunction fixLastLength(length: number, coordinates: SketchCoordType, scale: number = 1) {\n  const coord = coordinates as Coordinate[];\n  if (coord.length > 1 && length > 0) {\n    const lastLine = [coord[coord.length - 2], coord[coord.length - 1]];\n    coord[coord.length - 1] = new LineString(lastLine).getCoordinateAt(length / (getLength(lastLine) * scale));\n  }\n}\n\nexport default class OlDrawing {\n  map: MapComponent;\n  state: State;\n  drawingSource!: VectorSource;\n  draw: Draw | null = null;\n  snap!: Snap;\n  currentShape: DrawingShape | null = null;\n  featuresMap: Map<string, { feature: Feature<Geometry>; shape: DrawingShape }> = new Map();\n  fixedLength: number = 0;\n\n  constructor(map: MapComponent) {\n    this.map = map;\n    this.state = StateManager.getInstance().state;\n    this.drawingSource = new VectorSource({ features: new Collection() });\n    this.drawingSource.on('addfeature', (e) => this.onFeatureAdded(e));\n    this.map.olMap.addLayer(\n      new VectorLayer({\n        source: this.drawingSource,\n        zIndex: 1001,\n        properties: {\n          addToPrintedLayers: true,\n          altitudeMode: 'clampToGround'\n        }\n      })\n    );\n    this.map.stateManager.subscribe('extendedState.drawing.activeTool', (_oldTool, newTool) =>\n      newTool === null ? this.deactivateTool() : this.activateTool(newTool)\n    );\n\n    // OlCesium duplicates drawn shapes when 3D view is open if its eventListener is not removed\n    StateManager.getInstance().subscribe('globe.loaded', () => {\n      if (this.state.globe.loaded) {\n        this.drawingSource\n          .getListeners('addfeature')\n          ?.forEach((l) => this.drawingSource.removeEventListener('addfeature', l));\n        this.drawingSource.on('addfeature', (e) => this.onFeatureAdded(e));\n      }\n    });\n  }\n\n  addFeatures(features: DrawingFeature[]) {\n    features.forEach((feature) => {\n      let olFeature = this.featuresMap.get(feature.id)?.feature;\n      if (olFeature == undefined) {\n        olFeature = this.createOlFeature(feature);\n        this.featuresMap.set(feature.id, { feature: olFeature, shape: feature.type });\n        this.drawingSource.addFeature(olFeature);\n      }\n      feature.onChange = (f: DrawingFeature) => olFeature.setStyle(this.getStyle(f, olFeature));\n      feature.onChange(feature);\n    });\n  }\n\n  deleteFeatures(features: DrawingFeature[]) {\n    features.forEach((f) => {\n      const toRemove = this.featuresMap.get(f.id)?.feature;\n      if (toRemove != undefined) {\n        this.drawingSource.removeFeature(toRemove);\n        this.featuresMap.delete(f.id);\n      }\n    });\n  }\n\n  onFeatureAdded(e: VectorSourceEvent) {\n    if (e.feature && this.currentShape !== null) {\n      // If the shape is not in the state already\n      if (\n        !Array.from(this.featuresMap.values())\n          .map((x) => x.feature)\n          .includes(e.feature)\n      ) {\n        let geoJson = {};\n        // GeoJson does not support disks, so we create our own definition\n        if (this.currentShape == DrawingShape.Disk) {\n          const disk = e.feature.getGeometry()! as CircleGeom;\n          geoJson = {\n            type: 'Feature',\n            geometry: {\n              type: 'Disk',\n              center: disk.getCenter(),\n              radius: disk.getRadius()\n            }\n          };\n        } else {\n          geoJson = JSON.parse(new GeoJSON().writeFeature(e.feature));\n        }\n        const feature = new DrawingFeature(this.currentShape, geoJson);\n        this.featuresMap.set(feature.id, { feature: e.feature, shape: feature.type });\n        feature.addToState();\n      }\n    }\n  }\n\n  createOlFeature(feature: DrawingFeature) {\n    const geometry = (feature.geojson as any).geometry;\n    let olFeature;\n    if (geometry.type == 'Disk') {\n      olFeature = new Feature(new CircleGeom(geometry.center, geometry.radius));\n    } else {\n      olFeature = new Feature(new GeoJSON().readFeatures(feature.geojson)[0].getGeometry());\n    }\n    olFeature.setStyle(this.getStyle(feature, olFeature));\n    return olFeature;\n  }\n\n  setFixedLength(length: number) {\n    this.fixedLength = Number.isNaN(length) ? 0 : length;\n  }\n\n  createLineStringFixedLength(coordinates: SketchCoordType, geom: SimpleGeometry) {\n    fixLastLength(this.fixedLength, coordinates);\n    geom = geom ?? new LineString(coordinates as Coordinate[]);\n    geom.setCoordinates(coordinates);\n    return geom;\n  }\n\n  createSquareFixedLength(coordinates: SketchCoordType, geom: SimpleGeometry, proj: Projection) {\n    fixLastLength(this.fixedLength, coordinates, Math.SQRT2);\n    return createRegularPolygon(4)(coordinates, geom, proj);\n  }\n\n  createPolygonFixedLength(coordinates: SketchCoordType, geom: SimpleGeometry) {\n    const coord = coordinates[0] as Coordinate[];\n    fixLastLength(this.fixedLength, coord);\n    geom = geom ?? new Polygon([coord]);\n    geom.setCoordinates([coord]);\n    return geom;\n  }\n\n  createDiskFixedLength(coordinates: SketchCoordType, geom: SimpleGeometry) {\n    const coord = coordinates as Coordinate[];\n    fixLastLength(this.fixedLength, coord);\n    geom = geom ?? new CircleGeom(coord[0], getLength(coord));\n    (geom as CircleGeom).setCenterAndRadius(coord[0], getLength(coord));\n    return geom;\n  }\n\n  activateTool(tool: DrawingShape) {\n    this.deactivateTool();\n    this.state.selection.enabled = false;\n    this.currentShape = tool;\n    let geomFunction = undefined;\n    let olTool;\n\n    switch (tool) {\n      case DrawingShape.Point:\n        olTool = 'Point';\n        break;\n      case DrawingShape.Polyline:\n        olTool = 'LineString';\n        geomFunction = this.createLineStringFixedLength.bind(this);\n        break;\n      case DrawingShape.Polygon:\n        olTool = 'Polygon';\n        geomFunction = this.createPolygonFixedLength.bind(this);\n        break;\n      case DrawingShape.Disk:\n        olTool = 'Circle';\n        geomFunction = this.createDiskFixedLength.bind(this);\n        break;\n      case DrawingShape.Square:\n        olTool = 'Circle';\n        geomFunction = this.createSquareFixedLength.bind(this);\n        break;\n      case DrawingShape.Rectangle:\n        olTool = 'Circle';\n        geomFunction = createBox();\n        break;\n      case DrawingShape.FreehandPolyline:\n        olTool = 'LineString';\n        break;\n      case DrawingShape.FreehandPolygon:\n        olTool = 'Polygon';\n        break;\n    }\n\n    this.draw = new Draw({\n      source: this.drawingSource,\n      type: olTool as Type,\n      freehand: tool == DrawingShape.FreehandPolyline || tool == DrawingShape.FreehandPolygon,\n      geometryFunction: geomFunction,\n      style: (f) => this.getStyle(new DrawingFeature(tool, {}, ''), f as Feature<Geometry>)\n    });\n    this.map.olMap.on('dblclick', () => {\n      this.draw?.removeLastPoint();\n      this.draw?.finishDrawing();\n    });\n    this.map.olMap.addInteraction(this.draw);\n    this.map.olMap.addInteraction(new Modify({ source: this.drawingSource }));\n    this.snap = new Snap({ source: this.drawingSource });\n    this.map.olMap.addInteraction(this.snap);\n  }\n\n  deactivateTool() {\n    this.state.selection.enabled = true;\n    if (this.draw) {\n      this.map.olMap.removeInteraction(this.draw);\n    }\n    if (this.snap) {\n      this.map.olMap.removeInteraction(this.snap);\n    }\n  }\n\n  centerViewOnFeature(feature: DrawingFeature) {\n    const olFeature = this.featuresMap.get(feature.id)?.feature;\n    if (olFeature != undefined) {\n      this.map.olMap.getView().fit(olFeature.getGeometry()! as SimpleGeometry);\n    }\n  }\n\n  // TODO Move as much parameters as possible into DrawingFeature\n  getStyle(feature: DrawingFeature | null, olFeature: Feature<Geometry>) {\n    if (feature == null) {\n      const shape = Array.from(this.featuresMap.values()).filter((x) => x.feature == olFeature)[0].shape;\n      feature = new DrawingFeature(shape, {}, '');\n    }\n\n    const geometry = olFeature.getGeometry() as Geometry;\n    const measureFont = 'Bold ' + feature.measureFontSize + 'px/1 ' + feature.font;\n    const nameFont = 'Bold ' + feature.nameFontSize + 'px/1 ' + feature.font;\n    const defaultStyle = new Style({\n      stroke: new Stroke({ color: feature.strokeColor, width: feature.strokeWidth }),\n      fill: new Fill({ color: feature.fillColor }),\n      image: new Circle({\n        radius: feature.strokeWidth, // Points are using default stroke parameters\n        fill: new Fill({ color: feature.strokeColor })\n      }),\n      text: new Text({\n        text: feature.displayName ? feature.name : '',\n        font: nameFont,\n        fill: new Fill({ color: feature.nameColor })\n      })\n    });\n\n    const labelStyle = new Style({\n      text: new Text({\n        font: measureFont,\n        padding: [2, 2, 2, 2],\n        textBaseline: 'bottom',\n        offsetY: -12,\n        fill: new Fill({ color: feature.measureColor })\n      }),\n      image: new RegularShape({\n        radius: 6,\n        points: 3,\n        angle: Math.PI,\n        displacement: [0, 8],\n        fill: new Fill({ color: 'rgba(0, 0, 0, 0.4)' })\n      })\n    });\n\n    const styles = [defaultStyle];\n\n    const addLabel = (position: Point, text: string) => {\n      if (text != '') {\n        const style = labelStyle.clone();\n        style.setGeometry(position);\n        style.getText()!.setText(text);\n        styles.push(style);\n      }\n    };\n\n    // If the shape is being constructed (ex. it is a polygon for which only two points are placed yet)\n    if (\n      geometry.getType() == 'LineString' &&\n      feature.type !== DrawingShape.Polyline &&\n      feature.type !== DrawingShape.FreehandPolyline\n    ) {\n      return [];\n    }\n\n    if (feature.type == DrawingShape.Point || geometry.getType() === 'Point') {\n      addLabel(geometry as Point, feature.getCoordText((geometry as Point).getCoordinates()));\n    } else if (feature.type == DrawingShape.Polyline) {\n      (geometry as LineString).forEachSegment((a, b) =>\n        addLabel(getHalfPoint([a, b]), feature.getLengthText(getLength([a, b])))\n      );\n    } else if (feature.type == DrawingShape.Polygon) {\n      const polygon = geometry as Polygon;\n      const segments = this.ensurePolygonIsProperlyClosed(polygon);\n      new LineString(segments).forEachSegment((a, b) =>\n        addLabel(getHalfPoint([a, b]), feature.getLengthText(getLength([a, b])))\n      );\n      addLabel(polygon.getInteriorPoint(), feature.getAreaText(getArea(polygon)));\n    } else if (feature.type == DrawingShape.Disk) {\n      const radius = (geometry as CircleGeom).getRadius();\n      const center = (geometry as CircleGeom).getCenter();\n      const radiusLine = [center, [center[0] + radius, center[1]]];\n      const radiusLineStyle = defaultStyle.clone();\n      radiusLineStyle.getText()!.setText('');\n      radiusLineStyle.setGeometry(new LineString(radiusLine));\n      styles.push(radiusLineStyle);\n      addLabel(getHalfPoint(radiusLine), feature.getLengthText(radius));\n    } else if (feature.type == DrawingShape.FreehandPolygon) {\n      const polygon = geometry as Polygon;\n      this.ensurePolygonIsProperlyClosed(polygon);\n      addLabel(polygon.getInteriorPoint(), feature.getAreaText(getArea(polygon)));\n      addLabel(\n        new Point(polygon.getCoordinates()[0][0]),\n        feature.getLengthText(getLength(polygon.getCoordinates()[0]))\n      );\n    } else if (feature.type == DrawingShape.FreehandPolyline) {\n      const line = geometry as LineString;\n      addLabel(new Point(line.getCoordinates()[0]), feature.getLengthText(getLength(line.getCoordinates())));\n    } else if (feature.type == DrawingShape.Rectangle) {\n      const rect = geometry as Polygon;\n      const segment1 = [rect.getCoordinates()[0][0], rect.getCoordinates()[0][1]];\n      const segment2 = [rect.getCoordinates()[0][1], rect.getCoordinates()[0][2]];\n      addLabel(getHalfPoint(segment1), feature.getLengthText(getLength(segment1)));\n      addLabel(getHalfPoint(segment2), feature.getLengthText(getLength(segment2)));\n      addLabel(rect.getInteriorPoint(), feature.getAreaText(getArea(rect)));\n    } else if (feature.type == DrawingShape.Square) {\n      const square = geometry as Polygon;\n      const segment = [square.getCoordinates()[0][0], square.getCoordinates()[0][1]];\n      addLabel(getHalfPoint(segment), feature.getLengthText(getLength(segment)));\n      addLabel(square.getInteriorPoint(), feature.getAreaText(getArea(square)));\n    }\n    return styles;\n  }\n\n  ensurePolygonIsProperlyClosed(polygon: Polygon) {\n    const coordinates = polygon.getCoordinates()[0];\n    let segments = [...coordinates];\n    if (coordinates.length > 2 && coordinates[0][0] != coordinates[coordinates.length - 1][0]) {\n      segments = [...coordinates, coordinates[0]];\n      polygon.setCoordinates([segments]);\n    }\n    return segments;\n  }\n}\n","import * as Cesium from 'cesium';\nimport {\n  CallbackProperty,\n  Cartesian2,\n  Cartesian3,\n  Cartographic,\n  Color,\n  EllipsoidGeodesic,\n  Entity,\n  ScreenSpaceEventType,\n  PolygonHierarchy\n} from 'cesium';\nimport { KML, GeoJSON } from 'ol/format';\nimport DrawingFeature, { DrawingShape } from './drawingFeature';\nimport MapComponent from '../map/component';\nimport StateManager from '../../tools/state/statemanager';\nimport State from '../../tools/state/state';\nimport proj4 from 'proj4';\n\nconst CLAMP_TO_GROUND = Cesium.HeightReference.CLAMP_TO_GROUND;\n\nfunction getPosition(p: Cartesian3) {\n  const carto = Cartographic.fromCartesian(p);\n  const cartoDegree = [Cesium.Math.toDegrees(carto.longitude), Cesium.Math.toDegrees(carto.latitude), carto.height];\n  return proj4('EPSG:4326', StateManager.getInstance().state.projection, cartoDegree);\n}\n\nfunction getLength(start: Cartesian3, end: Cartesian3) {\n  return new EllipsoidGeodesic(Cartographic.fromCartesian(start), Cartographic.fromCartesian(end)).surfaceDistance;\n}\n\nfunction createLabel(text: string, font: string | null = null, offset = -15, fill: Color | null = null) {\n  if (font == null) {\n    const feature = new DrawingFeature(DrawingShape.Point);\n    font = feature.nameFontSize + 'px' + feature.font;\n  }\n  return {\n    text: text,\n    font: font,\n    pixelOffset: new Cartesian2(0.0, offset),\n    fillColor: fill ?? Color.fromCssColorString('#000000'),\n    heightReference: CLAMP_TO_GROUND\n  };\n}\n\nfunction createPoint(color: Color | null = null) {\n  if (color == null) {\n    color = Color.fromCssColorString(new DrawingFeature(DrawingShape.Point).strokeColor);\n  }\n  return { color: color, pixelSize: 5, heightReference: CLAMP_TO_GROUND };\n}\n\nfunction getPolygonCenter(positions: Cartesian3[]) {\n  return Cartesian3.divideByScalar(\n    positions.reduce((p1, p2) => Cartesian3.add(p1, p2, new Cartesian3()), new Cartesian3()),\n    positions.length,\n    new Cartesian3()\n  );\n}\n\nfunction getPolyLineLabels(feature: DrawingFeature, pos: Cartesian3[], font: string) {\n  return pos.slice(0, -1).map(\n    (_, index) =>\n      new Entity({\n        position: Cartesian3.lerp(pos[index], pos[index + 1], 0.5, new Cartesian3()),\n        label: createLabel(feature.getLengthText(getLength(pos[index], pos[index + 1])), font)\n      })\n  );\n}\n\nfunction getPolygonArea(positions: Cartesian3[]) {\n  let area = 0;\n  for (let i = 0; i < positions.length - 1; i++) {\n    const p1 = getPosition(positions[i]);\n    const p2 = getPosition(positions[i + 1]);\n    area += p1[0] * p2[1] - p2[0] * p1[1];\n  }\n  return Math.abs(area) / 2;\n}\n\nfunction getPolyline(positions: Cartesian3[], feature: DrawingFeature) {\n  return {\n    positions: new CallbackProperty(() => positions, false),\n    clampToGround: true,\n    width: feature.strokeWidth,\n    material: Color.fromCssColorString(feature.strokeColor)\n  };\n}\n\nfunction getPolygonEntity(positions: Cartesian3[], feature: DrawingFeature) {\n  return new Entity({\n    polygon: {\n      hierarchy: new CallbackProperty(() => new PolygonHierarchy(positions), false),\n      material: Color.fromCssColorString(feature.fillColor)\n    },\n    polyline: {\n      positions: new CallbackProperty(() => [...positions, positions[0]], false),\n      clampToGround: true,\n      width: feature.strokeWidth,\n      material: Color.fromCssColorString(feature.strokeColor)\n    }\n  });\n}\n\nexport default class CesiumDrawing {\n  state: State;\n  activeShapePoints: Cartesian3[] = [];\n  activeShapes: Entity[] = [];\n  floatingPoint: Entity | undefined = undefined;\n  scene: Cesium.Scene | undefined = undefined;\n  handler: Cesium.ScreenSpaceEventHandler | undefined = undefined;\n  entities: Cesium.EntityCollection | undefined = undefined;\n  fixedLength: number = 0;\n\n  constructor(map: MapComponent) {\n    this.state = StateManager.getInstance().state;\n    StateManager.getInstance().subscribe('globe.loaded', () => {\n      if (this.state.globe.loaded) {\n        this.scene = map.map3d.getCesiumScene();\n        this.handler = new Cesium.ScreenSpaceEventHandler(this.scene!.canvas);\n        this.entities = map.map3d.getDataSourceDisplay().defaultDataSource.entities;\n        map.stateManager.subscribe('extendedState.drawing.activeTool', (_oldTool, newTool) =>\n          newTool === null ? this.deactivateTool() : this.activateTool(newTool)\n        );\n      }\n    });\n  }\n\n  setFixedLength(length: number) {\n    this.fixedLength = Number.isNaN(length) ? 0 : length;\n  }\n\n  activateTool(tool: DrawingShape) {\n    this.state.selection.enabled = false;\n    this.handler!.setInputAction(this.addPoint(tool), ScreenSpaceEventType.LEFT_CLICK);\n    this.handler!.setInputAction(this.updateShape(tool), ScreenSpaceEventType.MOUSE_MOVE);\n    this.handler!.setInputAction(this.removeLastPointAndTerminateShape(tool), ScreenSpaceEventType.LEFT_DOUBLE_CLICK);\n\n    if (this.floatingPoint) {\n      this.entities!.remove(this.floatingPoint);\n    }\n    this.floatingPoint = new Entity({\n      position: new Cartesian3(),\n      point: createPoint(),\n      label: createLabel('', null, -30)\n    });\n    this.entities!.add(this.floatingPoint);\n  }\n\n  deactivateTool() {\n    this.state.selection.enabled = true;\n    this.handler!.removeInputAction(ScreenSpaceEventType.LEFT_CLICK);\n    this.handler!.removeInputAction(ScreenSpaceEventType.MOUSE_MOVE);\n    this.handler!.removeInputAction(ScreenSpaceEventType.LEFT_DOUBLE_CLICK);\n    if (this.floatingPoint) {\n      this.entities!.remove(this.floatingPoint);\n    }\n    this.floatingPoint = undefined;\n  }\n\n  pickOnGlobe(position: Cartesian2) {\n    const ray = this.scene!.camera.getPickRay(position);\n    return ray == undefined ? undefined : this.scene!.globe.pick(ray, this.scene!);\n  }\n\n  removeLastPointAndTerminateShape(tool: DrawingShape) {\n    return () => {\n      this.activeShapePoints = this.activeShapePoints.slice(0, -1);\n      this.terminateShape(tool);\n    };\n  }\n\n  terminateShape(tool: DrawingShape) {\n    const newCesiumEntityPoints = this.activeShapePoints.slice(0, -1);\n    const newCesiumEntities = this.getShapes(tool, newCesiumEntityPoints, new DrawingFeature(tool));\n    this.activeShapes.forEach((e) => this.entities!.remove(e));\n\n    const newFeature = new DrawingFeature(tool);\n\n    // The following code will be useful when we will remove OLCesium\n    /*newCesiumEntities.forEach((e) => this.entities!.add(e));\n    const updateStyle = (feature:DrawingFeature) => {\n      newCesiumEntities.forEach((e) => this.entities!.remove(e));\n      newCesiumEntities = this.getShapes(tool, newCesiumEntityPoints, feature);\n      newCesiumEntities.forEach((e) => this.entities!.add(e));\n    }\n    newFeature.onChange = updateStyle;\n    updateStyle(newFeature)*/\n\n    if (tool == DrawingShape.Disk) {\n      const center = Cesium.Ellipsoid.WGS84.cartesianToCartographic(\n        newCesiumEntities[0].position!.getValue(Cesium.JulianDate.now())!\n      );\n      const centerCoord = [Cesium.Math.toDegrees(center.longitude), Cesium.Math.toDegrees(center.latitude)];\n      newFeature.geojson = {\n        type: 'Feature',\n        geometry: {\n          type: 'Disk',\n          center: proj4('EPSG:4326', this.state.projection, centerCoord),\n          radius: newCesiumEntities[0].ellipse?.semiMajorAxis?.getValue(Cesium.JulianDate.now())\n        }\n      };\n      newFeature.addToState();\n    } else {\n      const entitiesCollection = new Cesium.EntityCollection();\n      entitiesCollection.add(newCesiumEntities[0]);\n      Cesium.exportKml({ entities: entitiesCollection }).then((res) => {\n        const olFeatures = new KML().readFeatures((res as Cesium.exportKmlResultKml).kml, {\n          dataProjection: 'EPSG:4326',\n          featureProjection: this.state.projection\n        });\n        newFeature.geojson = JSON.parse(new GeoJSON().writeFeature(olFeatures[0]));\n        const geojson = newFeature.geojson as any;\n        if (geojson.geometry.type == 'GeometryCollection') {\n          geojson.geometry = geojson.geometry.geometries[1];\n        }\n        newFeature.addToState();\n      });\n    }\n\n    this.activeShapes = [];\n    this.activeShapePoints = [];\n  }\n\n  fixLastLength(tool: DrawingShape, length: number, coord: Cartesian3[]) {\n    if (this.fixedLength > 0 && tool != DrawingShape.Rectangle) {\n      const factor = tool == DrawingShape.Square ? Math.SQRT2 / 2 : 1;\n      const pointCarto = new EllipsoidGeodesic(\n        Cartographic.fromCartesian(coord[coord.length - 2]),\n        Cartographic.fromCartesian(coord[coord.length - 1])\n      ).interpolateUsingSurfaceDistance(length * factor);\n      coord[coord.length - 1] = Cartographic.toCartesian(pointCarto);\n    }\n  }\n\n  updateShape(tool: DrawingShape) {\n    return (event: Cesium.ScreenSpaceEventHandler.MotionEvent) => {\n      const newPosition = this.pickOnGlobe(event.endPosition);\n      if (newPosition) {\n        if (this.activeShapes.length > 0) {\n          if (tool == DrawingShape.FreehandPolyline || tool == DrawingShape.FreehandPolygon) {\n            this.activeShapePoints.push(newPosition);\n          } else {\n            this.activeShapePoints[this.activeShapePoints.length - 1] = newPosition;\n            this.fixLastLength(tool, this.fixedLength, this.activeShapePoints);\n          }\n          this.activeShapes.forEach((e) => this.entities!.remove(e));\n          this.activeShapes = this.getShapes(tool, this.activeShapePoints, new DrawingFeature(tool));\n          this.activeShapes.forEach((e) => this.entities!.add(e));\n        }\n\n        (this.floatingPoint?.position as Cesium.ConstantPositionProperty).setValue(newPosition);\n        (this.floatingPoint?.label!.text as Cesium.ConstantProperty).setValue(\n          new DrawingFeature(tool).getCoordText(getPosition(newPosition))\n        );\n      }\n    };\n  }\n\n  addPoint(tool: DrawingShape) {\n    return (event: Cesium.ScreenSpaceEventHandler.PositionedEvent) => {\n      const earthPosition = this.pickOnGlobe(event.position);\n      // If the cursor is on the map\n      if (earthPosition) {\n        this.activeShapePoints.push(earthPosition);\n        if (this.activeShapePoints.length === 1) {\n          this.activeShapePoints.push(earthPosition); // Add a point for the one under the cursor\n          this.activeShapes = this.getShapes(tool, this.activeShapePoints, new DrawingFeature(tool));\n          this.activeShapes.forEach((e) => this.entities!.add(e));\n        }\n        // Tools that automatically terminate the shape after a fixed number of points\n        if (\n          (tool === DrawingShape.Point && this.activeShapePoints.length === 2) ||\n          (tool === DrawingShape.Disk && this.activeShapePoints.length === 3) ||\n          (tool === DrawingShape.Square && this.activeShapePoints.length === 3) ||\n          (tool === DrawingShape.Rectangle && this.activeShapePoints.length === 3)\n        ) {\n          this.terminateShape(tool);\n        }\n      }\n    };\n  }\n\n  // Utility functions\n\n  leveledCenterToMouse(pos: Cartesian3[]) {\n    const localZ = Cartesian3.normalize(pos[0], new Cartesian3());\n    const localX = Cartesian3.subtract(pos[1], pos[0], new Cartesian3());\n    const factor = -(localX.x * localZ.x + localX.y * localZ.y + localX.z * localZ.z);\n    return Cartesian3.add(localX, Cartesian3.multiplyByScalar(localZ, factor, new Cartesian3()), localX);\n  }\n\n  makeRectangle(pos: Cartesian3[]) {\n    if (pos.length < 2) {\n      return [pos[0], pos[0], pos[0], pos[0]];\n    }\n    const pos1Carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(pos[0]);\n    const pos2Carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(pos[1]);\n    const pos3Carto = pos1Carto.clone();\n    pos3Carto.latitude = pos2Carto.latitude;\n    const pos4Carto = pos1Carto.clone();\n    pos4Carto.longitude = pos2Carto.longitude;\n    return [pos[0], Cartographic.toCartesian(pos3Carto), pos[1], Cartographic.toCartesian(pos4Carto), pos[0]];\n  }\n\n  makeRegularPolygon(center: Cartesian3, firstPosition: Cartesian3, nbEdges: number) {\n    if (firstPosition.equals(center)) return [center];\n    const centerToMouse = this.leveledCenterToMouse([center, firstPosition]);\n    const localX = Cartesian3.normalize(centerToMouse, new Cartesian3());\n    const localY = Cartesian3.normalize(Cartesian3.cross(center, localX, new Cartesian3()), new Cartesian3());\n    const radius = Cartesian3.magnitude(centerToMouse);\n    const positions: Cartesian3[] = [];\n    for (let i = 0; i < 2 * Math.PI; i += (2 * Math.PI) / nbEdges) {\n      const posX = Cartesian3.multiplyByScalar(localX, radius * Math.cos(i), new Cartesian3());\n      const posY = Cartesian3.multiplyByScalar(localY, radius * Math.sin(i), new Cartesian3());\n      positions.push(Cartesian3.add(center, Cartesian3.add(posX, posY, new Cartesian3()), new Cartesian3()));\n    }\n    return [...positions, positions[0]];\n  }\n\n  getShapes(tool: DrawingShape, pos: Cartesian3[], feature: DrawingFeature) {\n    const strokeColor = Color.fromCssColorString(feature.strokeColor);\n    const font = feature.nameFontSize + 'px' + feature.font;\n    pos = pos.map((x) => x.clone()); // Cesium fonctions have side effects\n    const pointLoop = [...pos, pos[0]];\n\n    switch (tool) {\n      case DrawingShape.Point:\n        return [\n          new Entity({\n            position: pos[0],\n            point: createPoint(strokeColor),\n            label: createLabel(feature.getCoordText(getPosition(pos[0])), font)\n          })\n        ];\n      case DrawingShape.Polyline:\n        return [new Entity({ polyline: getPolyline(pos, feature) }), ...getPolyLineLabels(feature, pos, font)];\n      case DrawingShape.Polygon:\n        return [\n          getPolygonEntity(pos, feature),\n          ...getPolyLineLabels(feature, pointLoop, font),\n          new Entity({\n            position: getPolygonCenter(pos),\n            label: createLabel(pos.length < 4 ? '' : feature.getAreaText(getPolygonArea(pointLoop)), font)\n          })\n        ];\n      case DrawingShape.FreehandPolyline:\n        return [\n          new Entity({ polyline: getPolyline(pos, feature) }),\n          new Entity({\n            position: pos[Math.ceil(pos.length / 2)],\n            label: createLabel(\n              feature.getLengthText(\n                pos\n                  .slice(0, -1)\n                  .map((_, i) => getLength(pos[i], pos[i + 1]))\n                  .reduce((a, b) => a + b, 0)\n              ),\n              font\n            )\n          })\n        ];\n      case DrawingShape.FreehandPolygon:\n        return [\n          getPolygonEntity(pos, feature),\n          new Entity({\n            position: getPolygonCenter(pos),\n            label: createLabel(pos.length < 4 ? '' : feature.getAreaText(getPolygonArea(pointLoop)), font)\n          }),\n          new Entity({\n            position: pos[Math.ceil(pos.length / 2)],\n            label: createLabel(\n              feature.getLengthText(\n                pointLoop\n                  .slice(0, -1)\n                  .map((_, i) => getLength(pointLoop[i], pointLoop[i + 1]))\n                  .reduce((a, b) => a + b, 0)\n              ),\n              font\n            )\n          })\n        ];\n      case DrawingShape.Disk:\n        return [\n          new Entity({\n            position: pos[0],\n            ellipse: {\n              semiMinorAxis: new CallbackProperty(() => Cartesian3.magnitude(this.leveledCenterToMouse(pos)), false),\n              semiMajorAxis: new CallbackProperty(() => Cartesian3.magnitude(this.leveledCenterToMouse(pos)), false),\n              material: Color.fromCssColorString(feature.fillColor)\n            },\n            polyline: getPolyline(this.makeRegularPolygon(pos[0], pos[pos.length - 1], 300), feature),\n            point: createPoint(strokeColor)\n          }),\n          new Entity({ polyline: getPolyline(pointLoop, feature) }),\n          ...getPolyLineLabels(feature, pointLoop, font)\n        ];\n      case DrawingShape.Square: {\n        const vertices = this.makeRegularPolygon(pos[0], pos[pos.length - 1], 4);\n        return [\n          getPolygonEntity(vertices, feature),\n          ...(vertices.length >= 2 ? getPolyLineLabels(feature, [vertices[0], vertices[1]], font) : []),\n          new Entity({\n            position: pos[0],\n            label: createLabel(feature.getAreaText(Math.pow(Math.SQRT2 * getLength(pos[0], pos[1]), 2)), font)\n          })\n        ];\n      }\n      case DrawingShape.Rectangle: {\n        const vertices = this.makeRectangle(pos);\n        return [\n          getPolygonEntity(vertices, feature),\n          ...(vertices.length >= 2 ? getPolyLineLabels(feature, [vertices[0], vertices[1], vertices[2]], font) : []),\n          new Entity({\n            position: getPolygonCenter(pos),\n            label: createLabel(feature.getAreaText(getPolygonArea(this.makeRectangle(pos))), font)\n          })\n        ];\n      }\n      default:\n        throw Error(`Unrecognized tool : ${tool}`);\n    }\n  }\n}\n","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 448 512\\\"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d=\\\"M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z\\\"/></svg>\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 512 512\\\"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d=\\\"M256 0c17.7 0 32 14.3 32 32V66.7C368.4 80.1 431.9 143.6 445.3 224H480c17.7 0 32 14.3 32 32s-14.3 32-32 32H445.3C431.9 368.4 368.4 431.9 288 445.3V480c0 17.7-14.3 32-32 32s-32-14.3-32-32V445.3C143.6 431.9 80.1 368.4 66.7 288H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H66.7C80.1 143.6 143.6 80.1 224 66.7V32c0-17.7 14.3-32 32-32zM128 256a128 128 0 1 0 256 0 128 128 0 1 0 -256 0zm128-80a80 80 0 1 1 0 160 80 80 0 1 1 0-160z\\\"/></svg>\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 576 512\\\"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d=\\\"M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM144 256a144 144 0 1 1 288 0 144 144 0 1 1 -288 0zm144-64c0 35.3-28.7 64-64 64c-7.1 0-13.9-1.2-20.3-3.3c-5.5-1.8-11.9 1.6-11.7 7.4c.3 6.9 1.3 13.8 3.2 20.7c13.7 51.2 66.4 81.6 117.6 67.9s81.6-66.4 67.9-117.6c-11.1-41.5-47.8-69.4-88.6-71.1c-5.8-.2-9.2 6.1-7.4 11.7c2.1 6.4 3.3 13.2 3.3 20.3z\\\"/></svg>\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 640 512\\\"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d=\\\"M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c8.4-19.3 10.6-41.4 4.8-63.3c-11.1-41.5-47.8-69.4-88.6-71.1c-5.8-.2-9.2 6.1-7.4 11.7c2.1 6.4 3.3 13.2 3.3 20.3c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zM373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5L373 389.9z\\\"/></svg>\"","import Picker, { Color } from 'vanilla-picker';\nimport { v4 as uuidv4 } from 'uuid';\nimport DrawingFeature, { DrawingState, SerializedFeature, DrawingShape } from './drawingFeature';\nimport OlDrawing from './olDrawing';\nimport CesiumDrawing from './cesiumDrawing';\n\nimport { KML, GeoJSON, GPX } from 'ol/format';\nimport { Polygon } from 'ol/geom';\nimport Feature from 'ol/Feature';\n\nimport GirafeHTMLElement from '../../base/GirafeHTMLElement';\nimport { download } from '../../tools/export/download';\nimport MapComponent from '../map/component';\n\nimport trashIcon from './assets/trash.svg?raw';\nimport locateIcon from './assets/locate.svg?raw';\nimport visibleIcon from './assets/visible.svg?raw';\nimport notVisibleIcon from './assets/notVisible.svg?raw';\n\nfunction createDiv(id = '', className = '', content = '', onclick = () => {}) {\n  const element = document.createElement('div');\n  element.id = id;\n  element.className = className;\n  element.innerHTML = content;\n  element.onclick = onclick;\n  return element;\n}\n\nexport default class DrawingComponent extends GirafeHTMLElement {\n  templateUrl = './template.html';\n  styleUrl = './style.css';\n\n  visible = false;\n  renderedOnce = false;\n  drawingState: DrawingState;\n  colorPickers: [any, () => string][] = [];\n\n  buttons: { id: string; tool: DrawingShape | null }[] = [\n    { id: 'disable', tool: null },\n    { id: 'point', tool: DrawingShape.Point },\n    { id: 'line', tool: DrawingShape.Polyline },\n    { id: 'square', tool: DrawingShape.Square },\n    { id: 'rectangle', tool: DrawingShape.Rectangle },\n    { id: 'polygon', tool: DrawingShape.Polygon },\n    { id: 'circle', tool: DrawingShape.Disk },\n    { id: 'freeline', tool: DrawingShape.FreehandPolyline },\n    { id: 'freepolygon', tool: DrawingShape.FreehandPolygon }\n  ];\n  toolSelected: Element | null = null;\n  curFeature: DrawingFeature | null = null;\n\n  olDrawing: OlDrawing;\n  cesiumDrawing: CesiumDrawing;\n\n  constructor() {\n    super('drawing');\n    this.state.extendedState.drawing = new DrawingState();\n    this.drawingState = this.state.extendedState.drawing as DrawingState;\n    const map = this.componentManager.getComponents(MapComponent)[0];\n    this.olDrawing = new OlDrawing(map);\n    this.cesiumDrawing = new CesiumDrawing(map);\n    this.stateManager.subscribe('extendedState.drawing.features', (olds, news) => this.onFeaturesChanged(olds, news));\n    this.stateManager.subscribe('projection', (olds, news) => this.onProjectionChanged(olds, news));\n  }\n\n  render() {\n    super.render();\n    super.girafeTranslate();\n    this.activateTooltips(false, [800, 0], 'top-end');\n    this.visible ? this.renderComponent() : this.hide();\n    this.state.selection.enabled = !this.visible;\n    this.setTool();\n  }\n\n  renderComponent() {\n    this.show();\n    if (!this.renderedOnce) {\n      this.renderedOnce = true;\n      this.buttons.forEach((b) => {\n        this.getById(b.id).addEventListener('click', () => this.setTool(b.tool));\n      });\n      this.getById('visibleIconName').innerHTML = visibleIcon;\n      this.getById('visibleIconMeasure').innerHTML = visibleIcon;\n      this.addColorPicker(\n        'nameColorPicker',\n        (c) => (this.curFeature!.nameColor = c.hex),\n        () => this.curFeature!.nameColor\n      );\n      this.addColorPicker(\n        'measureColorPicker',\n        (c) => (this.curFeature!.measureColor = c.hex),\n        () => this.curFeature!.measureColor\n      );\n      this.addColorPicker(\n        'fillPicker',\n        (c) => (this.curFeature!.fillColor = c.hex),\n        () => this.curFeature!.fillColor\n      );\n      this.addColorPicker(\n        'strokePicker',\n        (c) => (this.curFeature!.strokeColor = c.hex),\n        () => this.curFeature!.strokeColor\n      );\n      this.getById('optionsTitle').oninput = (e) => {\n        this.curFeature!.name = (e.target as HTMLInputElement).value;\n        this.getById('name-f-' + this.curFeature!.id).innerHTML = this.curFeature!.name;\n        this.render();\n      };\n      this.getById('fixedLengthValue').oninput = (e) => {\n        const val = parseFloat((e.target as HTMLInputElement).value);\n        this.olDrawing.setFixedLength(val);\n        this.cesiumDrawing.setFixedLength(val);\n      };\n      this.getById('fixedLengthEnabled').onchange = (e) => {\n        const elements = Array.from(this.shadowRoot?.querySelectorAll('.fixedLengthElement')!);\n        if ((e.target as HTMLInputElement).checked) {\n          elements.forEach((e) => e.classList.remove('disabled'));\n          this.getById<HTMLInputElement>('fixedLengthValue').dispatchEvent(new Event('input'));\n        } else {\n          elements.forEach((e) => e.classList.add('disabled'));\n          this.olDrawing.setFixedLength(0);\n          this.cesiumDrawing.setFixedLength(0);\n        }\n      };\n    }\n  }\n\n  addColorPicker(id: string, set: (c: typeof Color) => any, get: () => string) {\n    const picker = new Picker({ parent: this.getById(id), popup: 'top' });\n    const update = (c: typeof Color) => {\n      set(c);\n      this.getById(id).style.backgroundColor = c.hex;\n    };\n    picker.onChange = update;\n    picker.onDone = update;\n    this.colorPickers.push([picker, get]);\n  }\n\n  serialize() {\n    return this.drawingState.features.map((f) => f.serialize());\n  }\n\n  deserialize(serializedFeatures: SerializedFeature[]) {\n    serializedFeatures.forEach((f) => this.drawingState.features.push(DrawingFeature.deserialize(f)));\n  }\n\n  setTool(tool: DrawingShape | null = null) {\n    if (this.toolSelected !== null) {\n      this.toolSelected.className = '';\n    }\n    this.toolSelected = this.getById(this.buttons.find((x) => x.tool == tool)!.id)!;\n    this.toolSelected.className = 'selected';\n    this.drawingState.activeTool = tool;\n  }\n\n  connectedCallback() {\n    this.loadConfig().then(() => {\n      this.render();\n      this.stateManager.subscribe('interface.drawingPanelVisible', (_, newValue) => this.togglePanel(newValue));\n    });\n  }\n\n  togglePanel(visible: boolean) {\n    this.visible = visible;\n    this.render();\n  }\n\n  onFeaturesChanged(oldFeatures: DrawingFeature[], newFeatures: DrawingFeature[]) {\n    oldFeatures = oldFeatures ?? [];\n    const newIds = newFeatures.map((f) => f.id);\n    const oldIds = oldFeatures.map((f) => f.id);\n    const deleted = oldFeatures.filter((f) => !newIds.includes(f.id));\n    const added = newFeatures.filter((f) => !oldIds.includes(f.id));\n    deleted.forEach((f) => this.getById('f-' + f.id).remove());\n    added.forEach((f) => this.addFeatureToList(f));\n    this.olDrawing.deleteFeatures(deleted);\n    this.olDrawing.addFeatures(added);\n    // OlCesium is currently managing features in Cesium\n    //this.cesiumDrawing.addFeatures(added)\n    //this.cesiumDrawing.deleteFeatures(deleted)\n  }\n\n  onProjectionChanged(oldProj: string, newProj: string) {\n    if (oldProj != null && oldProj != newProj) {\n      const geoJson = new GeoJSON();\n      const features: DrawingFeature[] = [...this.drawingState.features];\n      features.forEach((f) => {\n        // TODO Handle the case of disks\n        f.geojson = geoJson.writeFeatureObject(\n          geoJson.readFeature(f.geojson, { dataProjection: oldProj, featureProjection: newProj })\n        );\n      });\n      // Refresh all the listeners\n      this.drawingState.features = [];\n      this.drawingState.features = features;\n    }\n  }\n\n  addFeatureToList(feature: DrawingFeature) {\n    const container = createDiv('f-' + feature.id, 'girafe');\n    container.onclick = () => {\n      if (this.drawingState.features.map((f) => f.id).includes(feature.id)) {\n        Array.from(this.getById('drawingList').children).forEach((e) => e.classList.remove('selected'));\n        container.classList.add('selected');\n        this.curFeature = feature;\n        this.updateOptionPanel();\n      }\n    };\n    container.appendChild(createDiv('', 'icon', locateIcon, () => this.olDrawing.centerViewOnFeature(feature)));\n    const name = document.createElement('span');\n    name.id = 'name-f-' + feature.id;\n    name.innerHTML = feature.name;\n    container.appendChild(name);\n    container.appendChild(createDiv('', 'icon', trashIcon, () => this.deleteFeature(feature)));\n    this.getById('drawingList').appendChild(container);\n  }\n\n  updateOptionPanel() {\n    if (this.curFeature != null) {\n      this.getById('options').classList.remove('disabled');\n      this.colorPickers.forEach((val) => val[0].setColor(val[1]()));\n      this.getById('visibleIconName').innerHTML = this.curFeature.displayName ? visibleIcon : notVisibleIcon;\n      this.getById('visibleIconMeasure').innerHTML = this.curFeature.displayMeasure ? visibleIcon : notVisibleIcon;\n      if (this.curFeature.isPointOrPolyline()) {\n        this.getById('fillPickerSpan').classList.add('disabled');\n        this.getById('fillPicker').classList.add('disabled');\n      } else {\n        this.getById('fillPickerSpan').classList.remove('disabled');\n        this.getById('fillPicker').classList.remove('disabled');\n      }\n      this.render();\n    }\n  }\n\n  deleteFeature(feature: DrawingFeature) {\n    if (confirm(`Do you want to remove \"${feature.name}\" ?`)) {\n      this.drawingState.features = this.drawingState.features.filter((f) => f.id != feature.id);\n      this.curFeature = null;\n      this.getById('options').classList.add('disabled');\n    }\n  }\n\n  onOptionsChange() {\n    if (this.curFeature != null) {\n      this.curFeature.nameFontSize = parseInt(this.getById<HTMLInputElement>('optionsNameFontSize').value);\n      this.curFeature.measureFontSize = parseInt(this.getById<HTMLInputElement>('optionsMeasuresFontSize').value);\n      this.curFeature.strokeWidth = parseInt(this.getById<HTMLInputElement>('optionsStrokeWidth').value);\n    }\n  }\n\n  toggleNameVisibility() {\n    if (this.curFeature != null) {\n      this.curFeature.displayName = !this.curFeature.displayName;\n      this.getById('visibleIconName').innerHTML = this.curFeature.displayName ? visibleIcon : notVisibleIcon;\n    }\n  }\n\n  toggleMeasureVisibility() {\n    if (this.curFeature != null) {\n      this.curFeature.displayMeasure = !this.curFeature.displayMeasure;\n      this.getById('visibleIconMeasure').innerHTML = this.curFeature.displayMeasure ? visibleIcon : notVisibleIcon;\n    }\n  }\n\n  exportFeature(feature: DrawingFeature, format: 'geojson' | 'kml' | 'gpx') {\n    if (feature != null) {\n      let olFeature = this.olDrawing.createOlFeature(feature);\n      if (feature.type == DrawingShape.Disk) {\n        const geojson = feature.geojson as any;\n        const style = olFeature.getStyle();\n        olFeature = new Feature(\n          new Polygon([DrawingFeature.circleToPolygon(geojson.geometry.center, geojson.geometry.radius)])\n        );\n        olFeature.setStyle(style);\n      }\n      switch (format) {\n        case 'geojson':\n          return download(\n            JSON.stringify(new GeoJSON().writeFeatureObject(olFeature, { featureProjection: this.state.projection })),\n            feature.name + '.geojson',\n            '.geojson'\n          );\n        case 'kml':\n          return download(\n            new KML().writeFeatures([olFeature], { featureProjection: this.state.projection }),\n            feature.name + '.kml',\n            '.kml'\n          );\n        case 'gpx':\n          if (!feature.isPointOrPolyline()) {\n            return this.state.infobox.elements.push({\n              id: uuidv4(),\n              text: 'Warning : The GPX format only supports points and polylines',\n              type: 'warning'\n            });\n          }\n          return download(\n            new GPX().writeFeatures([olFeature], { featureProjection: this.state.projection }),\n            feature.name + '.gpx',\n            '.gpx'\n          );\n      }\n    }\n  }\n}\n","import GirafeHTMLElement from '../../base/GirafeHTMLElement';\n\nclass ScaleComponent extends GirafeHTMLElement {\n  templateUrl = './template.html';\n  styleUrl = './style.css';\n\n  constructor() {\n    super('scale');\n  }\n\n  render() {\n    this.configManager.loadConfig().then(() => {\n      super.render();\n    });\n  }\n\n  registerEvents() {\n    this.stateManager.subscribe('position', () => this.onScaleChanged());\n  }\n\n  onScaleChanged() {\n    super.render();\n  }\n\n  getFormatedScale(scale?: number) {\n    const scaleToFormat = scale ?? this.state.position.scale;\n    if (scaleToFormat) {\n      return '1:' + Math.floor(scaleToFormat).toLocaleString(this.configManager.Config.general.locale);\n    }\n\n    return 'No scale';\n  }\n\n  connectedCallback() {\n    this.loadConfig().then(() => {\n      this.render();\n      super.girafeTranslate();\n      this.registerEvents();\n    });\n  }\n}\n\nexport default ScaleComponent;\n","import type OlFeature from 'ol/Feature';\nimport { removeUnwantedOlParams } from './utils/olutils';\n\n/**\n * Represents a grid data organized by unique ids.\n */\nexport type GridDataById = Record<string, GridData>;\n\n/**\n * Represents the data structure for a grid, based on multiple features\n * for a same ID (and with a same structure, geom type and properties).\n *  - Columns are every (not ol) features properties name;\n *  - Data are every (not ol) features properties values;\n *  - Features are every Ol features (backref);\n *  - notOlProperties are every property but without ol specific one.\n */\nexport interface GridData {\n  columns: string[];\n  data: unknown[][];\n  features: OlFeature[];\n  notOlProperties: Record<string, unknown>[];\n}\n\n/**\n * Options for converting feature data to grid data.\n */\nexport interface FeatureToGridDataOptions {\n  /** Determines whether to keep the geometry property as a property value. */\n  keepGeomProperty?: boolean;\n  /** Determines whether to keep (always) empty columns or not in columns and data. */\n  removeEmptyColumns?: boolean;\n}\n\n/**\n * A feature-to-grid data converter, to show feature's properties in grid-like system.\n */\nexport default class FeatureToGridDataById {\n  options: FeatureToGridDataOptions;\n\n  constructor(options: FeatureToGridDataOptions) {\n    this.options = {\n      ...{\n        keepGeomProperty: false,\n        removeEmptyColumns: true\n      },\n      ...options\n    };\n  }\n\n  /**\n   * Takes an array of OpenLayers features and converts them into a grid data object, where each feature\n   * is mapped by its ID as the key.\n   * @returns The grid data objects, by id.\n   */\n  toGridDataById(features: OlFeature[]): GridDataById {\n    const gridDataById: GridDataById = features.reduce(\n      (gridDataById, feature) => this.addFeatureToGridDataById(gridDataById, feature),\n      {} as GridDataById\n    );\n    if (this.options.removeEmptyColumns) {\n      Object.values(gridDataById).forEach((gridData) => FeatureToGridDataById.removeEmptyColumns(gridData));\n    }\n    return gridDataById;\n  }\n\n  /**\n   * @returns a gridDataByID for a single converted OL feature.\n   * @private\n   */\n  private addFeatureToGridDataById(gridDataById: GridDataById, feature: OlFeature): GridDataById {\n    const featureType = FeatureToGridDataById.getUserFeatureType(feature);\n    const notOlProperties = removeUnwantedOlParams(feature, this.options.keepGeomProperty);\n    if (!Object.keys(notOlProperties).length) {\n      // Don't keep feature without properties.\n      return gridDataById;\n    }\n    if (!Object.keys(gridDataById).includes(featureType)) {\n      gridDataById[featureType] = FeatureToGridDataById.createGridDataWithColumns(notOlProperties);\n    }\n    const gridData = gridDataById[featureType];\n\n    // Add feature and not OL properties backref\n    gridData.features.push(feature);\n    gridData.notOlProperties.push(notOlProperties);\n\n    // Add cell content.\n    const data: unknown[] = gridData.columns.map((column) => notOlProperties[column]);\n    gridData.data.push(data);\n    return gridDataById;\n  }\n\n  /**\n   * @returns {GridData} A new empty grid data object with columns from given properties.\n   * @static\n   */\n  static createGridDataWithColumns(properties: Record<string, unknown>): GridData {\n    return {\n      columns: Object.keys(properties),\n      notOlProperties: [],\n      data: [],\n      features: []\n    };\n  }\n\n  /**\n   * Removes empty columns (columns and data) from a given gridData object.\n   * It's expected that all features in the gridData have the same properties.\n   * @static\n   */\n  static removeEmptyColumns(gridData: GridData) {\n    const emptyColumnIndexes = FeatureToGridDataById.findEmptyColumnIndexOf(gridData.data);\n    gridData.columns = gridData.columns.filter((_column, index) => !emptyColumnIndexes.includes(index));\n    gridData.data.forEach((_, index) => {\n      gridData.data[index] = gridData.data[index].filter((_val, index) => !emptyColumnIndexes.includes(index));\n    });\n  }\n\n  /**\n   * This method finds the indexes of empty columns in a given 2D array.\n   * @param data - The 2D array to search for empty columns.\n   * @returns An array of indexes representing the empty columns.\n   * @static\n   */\n  static findEmptyColumnIndexOf(data: unknown[][]): number[] {\n    if (!data[0]) {\n      return [];\n    }\n    const emptyColumnIndexes = Array.from({ length: data[0].length }, (_, index) => index);\n    data.forEach((column) => {\n      const notEmptyColumnIndexes: number[] = [];\n      emptyColumnIndexes.forEach((emptyIndex) => {\n        if (column[emptyIndex]) {\n          notEmptyColumnIndexes.push(emptyIndex);\n        }\n      });\n      notEmptyColumnIndexes.forEach((indexToRemove) => {\n        const idx = emptyColumnIndexes.findIndex((emptyColumnIndex) => emptyColumnIndex === indexToRemove);\n        emptyColumnIndexes.splice(idx, 1);\n      });\n    });\n    return emptyColumnIndexes;\n  }\n\n  /**\n   * @return The ID of the feature or 'UNKNOWN' if undefined.\n   * @static\n   */\n  static getUserFeatureId(feature: OlFeature): string {\n    const id = feature.getId();\n    return id === undefined ? 'UNKNOWN' : `${id}`;\n  }\n  static getUserFeatureType(feature: OlFeature): string {\n    const id = feature.getId();\n    if (!id) {\n      return 'UNKNOWN';\n    }\n    const splitId = `${id}`.split('.');\n    if (splitId.length <= 1) {\n      return `${id}`;\n    }\n    splitId.pop();\n    return splitId.join('.');\n  }\n}\n","export default \"__VITE_ASSET__COgorwBT__\"","import type OlGeomGeometry from 'ol/geom/Geometry';\nimport { Circle, LineString, MultiLineString, MultiPoint, MultiPolygon, Point, Polygon } from 'ol/geom';\nimport { getCenter } from 'ol/extent';\nimport { polygonFromCircle } from '../../../tools/utils/olutils';\nimport { niceCoordinates } from '../../../tools/geometrytools';\nimport IconCenter from '../images/center.svg';\n\n/**\n * Generates HTML string containing icons based on the provided geometry.\n */\nexport default class FormatGridGeomValue {\n  private readonly iconCenter = IconCenter;\n  private locale: string = '';\n\n  /**\n   * @returns The generated HTML string containing the icons, based on the provided geometry.\n   */\n  getGeometryIcons(geometry: OlGeomGeometry, locale: string): string | undefined {\n    this.locale = locale;\n    const info = this.getGeometryIconsInfo(geometry);\n    if (!info[0]) {\n      return;\n    }\n    let icons = info[0];\n    const coords = info[1];\n\n    icons += `<button class=\"girafe-button-tiny tiny-margin\"\n                      tip=\"Pan to geometry\"\n                      tip-placement=\"right\"\n                      onclick=\"document.geogirafe.state.position.center = [${coords[0]},${coords[1]}]\">\n                <img alt=\"recenter-icon\" src=\"${this.iconCenter}\" />\n              </button>`;\n\n    return icons;\n  }\n\n  /**\n   * Supports point, multipoint, line, multilines (as line),\n   * polygon and multipolygons (as polygon) and circle (as polygon).\n   * @return A tuple containing the icon html, based on the given geometry,\n   * and coordinates array. Can returns [null, null] in case of not supported geometry.\n   */\n  private getGeometryIconsInfo(geometry: OlGeomGeometry): [string, number[]] | [null, null] {\n    if (geometry instanceof Point) {\n      return this.getGeometryIconsInfoPoint(geometry);\n    }\n    if (geometry instanceof MultiPoint) {\n      return this.getGeometryIconsInfoMultiPoint(geometry);\n    }\n    if (geometry instanceof LineString || geometry instanceof MultiLineString) {\n      return this.getGeometryIconsInfoLine(geometry);\n    }\n    if (geometry instanceof Polygon || geometry instanceof MultiPolygon) {\n      return this.getGeometryIconsInfoPolygon(geometry);\n    }\n    if (geometry instanceof Circle) {\n      return this.getGeometryIconsInfoPolygon(polygonFromCircle(geometry));\n    }\n    console.error('Unknown geometry type', geometry?.getType());\n    return [null, null];\n  }\n\n  /**\n   * @returns A tuple containing the icons and coordinates for a point geometry.\n   * @private\n   */\n  private getGeometryIconsInfoPoint(geometry: Point): [string, number[]] {\n    let icons = '<i class=\"geo-type fg-point fg-lg\"></i>';\n    const coords = geometry.getFlatCoordinates();\n    const niceCoords = niceCoordinates(coords, this.locale);\n    icons += `<span>E ${niceCoords[0]} / N ${niceCoords[1]}</span>`;\n    return [icons, coords];\n  }\n\n  /**\n   * @returns A tuple containing the icons and coordinates for a multi point geometry.\n   * @private\n   */\n  private getGeometryIconsInfoMultiPoint(geometry: MultiPoint): [string, number[]] {\n    let icons = '<i class=\"geo-type fg-multipoint fg-lg\"></i>';\n    if (geometry.getPoints.length === 1) {\n      const coords = geometry.getPoint(0).getFlatCoordinates();\n      const niceCoords = niceCoordinates(coords, this.locale);\n      icons += `<span>E ${niceCoords[0]} / N ${niceCoords[1]}</span>`;\n      return [icons, coords];\n    }\n    const coords = getCenter(geometry.getExtent());\n    icons += `<span>Multipoint</span>`;\n    return [icons, coords];\n  }\n\n  /**\n   * @returns A tuple containing the icons and coordinates for a line or multiline geometry.\n   * @private\n   */\n  private getGeometryIconsInfoLine(geometry: LineString | MultiLineString): [string, number[]] {\n    let icons = '<i class=\"geo-type fg-polyline-pt fg-lg\"></i>';\n    let geoLength;\n    if (geometry instanceof MultiLineString) {\n      geoLength = geometry.getLineStrings().reduce((length, line) => length + line.getLength(), 0);\n    } else {\n      geoLength = geometry.getLength();\n    }\n    const length = (Math.round(geoLength * 100) / 100).toLocaleString(this.locale, {\n      minimumFractionDigits: 2\n    });\n    icons += `<span>${length}&nbsp;m</span>`;\n    const coords = getCenter(geometry.getExtent());\n    return [icons, coords];\n  }\n\n  /**\n   * @returns A tuple containing the icons and coordinates for a polygon or multipolygon geometry.\n   * @private\n   */\n  private getGeometryIconsInfoPolygon(geometry: Polygon | MultiPolygon): [string, number[]] {\n    let icons = '<i class=\"geo-type fg-polygon-pt fg-lg\"></i>';\n    const area = (Math.round(geometry.getArea() * 100) / 100).toLocaleString(this.locale, {\n      minimumFractionDigits: 2\n    });\n    icons += `<span>${area}&nbsp;m<sup>2</sup></span>`;\n    const coords = getCenter(geometry.getExtent());\n    return [icons, coords];\n  }\n}\n","import type OlFeature from 'ol/Feature';\nimport OlGeomGeometry from 'ol/geom/Geometry';\nimport ConfigManager from '../../../tools/configuration/configmanager';\nimport FeatureToGridDataById, { GridData, GridDataById } from '../../../tools/featuretogriddatabyid';\nimport I18nManager from '../../../tools/i18n/i18nmanager';\nimport FormatGridGeomValue from './formatgridgeomvalue';\nimport { ColumnDefinition, TabulatorFull as Tabulator } from 'tabulator-tables';\n\n/**\n * Represents the header text and state of a tab.\n */\nexport interface TabHeader {\n  id: string;\n  text: string;\n  active: boolean;\n}\n\n/**\n * Represents a column in a data table.\n */\nexport interface Column {\n  id: string;\n  name: string;\n}\n\n/**\n * Represents the content and backrefs of a tab.\n */\nexport interface TabContent {\n  columns: Column[];\n  data: unknown[][];\n  features: OlFeature[];\n}\n\nexport default class SelectionTabulatorManager {\n  private readonly formatGridGeomValue = new FormatGridGeomValue();\n  private configManager: ConfigManager;\n  private readonly featureToGridData = new FeatureToGridDataById({ keepGeomProperty: true });\n  idTab: Record<string, TabContent> = {};\n  tabHeaders: TabHeader[] = [];\n  table: Tabulator | null = null;\n  element: string | HTMLElement = '';\n  data: GridDataById = {};\n\n  constructor() {\n    this.configManager = ConfigManager.getInstance();\n  }\n\n  /**\n   * Set the HTML element to be used by the grid.\n   */\n  setElement(htmlElement: HTMLElement): void {\n    this.element = htmlElement;\n  }\n\n  /**\n   * Replace the data of the current grid with the data of the specified tab.\n   */\n  replaceData(id: string): void {\n    const columns = this.columnsToGridColumns(this.data[id].columns);\n    this.table?.setColumns(columns);\n    this.table?.replaceData(this.data[id].notOlProperties);\n  }\n\n  /**\n   * Activates a tab matching the given id.\n   */\n  activateTab(id: string): void {\n    this.tabHeaders?.forEach((tabHeader) => (tabHeader.active = false));\n    const visibleTabHeader = this.tabHeaders?.find((tabHeader) => tabHeader.id === id);\n    if (!visibleTabHeader) {\n      return;\n    }\n    visibleTabHeader.active = true;\n  }\n\n  /**\n   * Creates (replace) the GridJS grid based on the provided tab id and related data and features.\n   */\n  displayGrid(id: string): void {\n    if (!this.element) {\n      return;\n    }\n\n    this.table = new Tabulator(this.element, {\n      data: this.data[id].notOlProperties,\n      columns: this.columnsToGridColumns(this.data[id].columns),\n      selectableRows: true,\n      layout: 'fitColumns',\n      headerSortElement: function (_, dir) {\n        switch (dir) {\n          case 'asc':\n            return \"<i class='fas fa-sort-up'>\";\n          case 'desc':\n            return \"<i class='fas fa-sort-down'>\";\n          default:\n            return \"<i class='fas fa-sort'>\";\n        }\n      }\n    });\n  }\n\n  /**\n   * Transforms the given features into grid data and sets tab headers.\n   * The grid data are completely replaced.\n   */\n  featuresToGridData(features: OlFeature[]): void {\n    this.idTab = {};\n    const gridDataById = this.featureToGridData.toGridDataById(features);\n\n    // Create tabs and collect data.\n    Object.keys(gridDataById).forEach((id) => this.gridDataToGridTab(id, gridDataById[id]));\n\n    // Create tabs headers\n    this.tabHeaders = Object.keys(this.idTab).map((key) => {\n      return {\n        id: key,\n        text: I18nManager.getInstance().getTranslation(key),\n        active: false\n      };\n    });\n\n    this.data = this.filterEmptyColumnsOnData(gridDataById);\n  }\n\n  /**\n   * Converts grid data to grid tab format and adds it to the idTab object.\n   * @private\n   */\n  private gridDataToGridTab(id: string, gridData: GridData): void {\n    if (id in this.idTab) {\n      // Already in ? Don't add a new one.\n      return;\n    }\n    this.idTab[id] = {\n      columns: gridData.columns.map((column) => this.createGridColumn(column)),\n      data: gridData.data.map((data) => this.createGridData(data)),\n      features: gridData.features\n    };\n  }\n\n  columnsToGridColumns(columns: string[]): ColumnDefinition[] {\n    const columnDefinition: ColumnDefinition[] = [];\n    columns.map((column) =>\n      columnDefinition.push({\n        title: I18nManager.getInstance().getTranslation(column),\n        field: column,\n        formatter: 'html'\n      })\n    );\n\n    columnDefinition.forEach((column) => {\n      if (column.field === 'the_geom' || column.field === 'geom' || column.field === 'geometry') {\n        column.formatter = (cell) => {\n          return this.formatGridGeomValue.getGeometryIcons(cell.getValue(), this.getLocale()) ?? cell.getValue();\n        };\n      }\n    });\n\n    return columnDefinition;\n  }\n\n  filterEmptyColumnsOnData(data: GridDataById): GridDataById {\n    for (const [_, entry] of Object.entries(data)) {\n      const columns = entry.columns;\n      const notOlProperties = entry.notOlProperties;\n      for (const [_, row] of Object.entries(notOlProperties)) {\n        for (const [key, _] of Object.entries(row)) {\n          if (!columns.some((column) => column === key)) {\n            delete row[key];\n          }\n        }\n      }\n    }\n    return data;\n  }\n\n  /**\n   * @returns A newly created grid column object.\n   * @private\n   */\n  private createGridColumn(id: string): Column {\n    return {\n      id,\n      name: I18nManager.getInstance().getTranslation(id)\n    };\n  }\n\n  /**\n   * Creates grid data by mapping values (simple values, or transformed values in case of HTML).\n   * @returns The grid data array.\n   * @private\n   */\n  private createGridData(values: unknown[]): unknown[] {\n    return values.map((value) =>\n      value instanceof OlGeomGeometry ? this.formatGridGeomValue.getGeometryIcons(value, this.getLocale()) : value\n    );\n  }\n\n  /**\n   * @returns The locale specified in the configuration.\n   * @private\n   */\n  private getLocale(): string {\n    return this.configManager.Config.general.locale;\n  }\n}\n","import GirafeResizableElement from '../../base/GirafeResizableElement';\nimport type { Callback } from '../../tools/state/statemanager';\nimport type OlFeature from 'ol/Feature';\nimport { debounce } from '../../tools/utils/debounce';\nimport SelectionTabulatorManager, { type TabHeader } from './tools/selectiontabulatormanager';\n\n/**\n * Represents a selection grid component based on GridJs.\n * Display itself when it should be visible and have selected features.\n * To be visible, it has to be the defined selectionComponent.\n * @extends GirafeResizableElement\n */\nclass SelectionGridComponent extends GirafeResizableElement {\n  templateUrl = './template.html';\n  styleUrl = './style.css';\n\n  private readonly eventsCallbacks: Callback[] = [];\n  private readonly selectionTabulatorManager = new SelectionTabulatorManager();\n  private isVisibleComponentSetup = false;\n  private debounceOnFeaturesSelected = debounce(this.onFeaturesSelected.bind(this), 200);\n  visible = false;\n\n  constructor() {\n    super('selectiongrid');\n  }\n\n  connectedCallback() {\n    this.render();\n    this.registerVisibilityEvents();\n  }\n\n  /**\n   * Render the component regarding its visibility.\n   */\n  render() {\n    this.visible ? this.renderComponent() : this.renderComponentEmpty();\n  }\n\n  /**\n   * @returns The current array of TabHeader objects.\n   */\n  getTabHeaders(): TabHeader[] {\n    return this.selectionTabulatorManager.tabHeaders;\n  }\n\n  /**\n   * Activates the specified tab, renders the grid, and displays the grid for the specified id.\n   */\n  displayGrid(id: string, replaceData: boolean = false) {\n    if (replaceData) {\n      this.selectionTabulatorManager.replaceData(id);\n    }\n\n    this.selectionTabulatorManager.activateTab(id);\n    this.render();\n    this.selectionTabulatorManager.displayGrid(id);\n  }\n\n  /**\n   * Clean the grid, closes the panel and deselect the selected features.\n   */\n  closePanel() {\n    this.state.interface.selectionComponentVisible = false;\n    this.state.selection.selectedFeatures = [];\n    super.clean();\n  }\n\n  /**\n   * Renders the component by calling the necessary methods.\n   * @private\n   */\n  private renderComponent() {\n    super.render();\n    super.girafeTranslate();\n    this.activateTooltips(false, [800, 0], 'top-end');\n    if (!this.isVisibleComponentSetup) {\n      this.setupVisibleComponent();\n    }\n  }\n\n  /**\n   * Sets up the components state and side-kicks.\n   * This must be called once at the first (visible) rendering.\n   * @private\n   */\n  private setupVisibleComponent() {\n    this.isVisibleComponentSetup = true;\n    this.registerEvents();\n  }\n\n  /**\n   * Render a placeholder, not visible component on hide.\n   * Removes event registration.\n   * @private\n   */\n  private renderComponentEmpty() {\n    this.stateManager.unsubscribe(this.eventsCallbacks);\n    this.eventsCallbacks.length = 0;\n    this.isVisibleComponentSetup = false;\n    this.renderEmpty();\n  }\n\n  /**\n   * Event about visibility that must be always listened by this component, even hidden.\n   * @private\n   */\n  private registerVisibilityEvents() {\n    this.stateManager.subscribe('interface.selectionComponentVisible', (_oldValue, newValue) =>\n      this.togglePanel(newValue)\n    );\n  }\n\n  /**\n   * Listen events that must be listened if the component is visible.\n   * @private\n   */\n  private registerEvents() {\n    this.eventsCallbacks.push(\n      this.stateManager.subscribe('selection.selectedFeatures', (_oldFeatures, newFeatures) => {\n        // Use debounce to avoid quickly closing the grid on selection change.\n        this.debounceOnFeaturesSelected(newFeatures);\n      })\n    );\n  }\n\n  /**\n   * Handles the selected features and updates the grid data accordingly or\n   * close the panel if no data is selected.\n   * @private\n   */\n  private onFeaturesSelected(features: OlFeature[] | null) {\n    this.selectionTabulatorManager.tabHeaders = [];\n    // No feature ? Close.\n    if (this.isNullOrUndefined(features) || features!.length <= 0) {\n      this.closePanel();\n      return;\n    }\n\n    this.selectionTabulatorManager.featuresToGridData(features!);\n    const tabIds = Object.keys(this.selectionTabulatorManager.idTab);\n\n    //define table element\n    this.selectionTabulatorManager.setElement(this.shadow.querySelector('#tabulator') as HTMLElement);\n\n    // No tab ? Close the panel.\n    if (!tabIds.length) {\n      this.closePanel();\n    }\n    // Otherwise, activate and display the first tab.\n    this.displayGrid(tabIds[0]);\n  }\n\n  /**\n   * Toggles the panel visibility. If visible, tries to display a grid with selected feature.\n   * Can only be visible if the component is the wanted selection component.\n   * @private\n   */\n  private togglePanel(visible: boolean) {\n    if (this.state.interface.selectionComponent !== 'grid') {\n      if (!this.visible) {\n        return;\n      }\n      visible = false;\n    }\n    this.visible = visible;\n    if (visible) {\n      // Will be rendered after computing selected feature.\n      this.onFeaturesSelected(this.state.selection.selectedFeatures);\n    } else {\n      this.render();\n    }\n  }\n}\n\nexport default SelectionGridComponent;\n","export default \"__VITE_ASSET__QNj4FTVa__\"","import { minMax } from './utils/utils';\n\n/**\n * Enum representing different directions.\n * With \"t\" standing for top, \"l\" for left, \"b\" for bottom and \"r\" for right.\n */\nenum Direction {\n  tl = 'tl',\n  t = 't',\n  tr = 'tr',\n  r = 'r',\n  br = 'br',\n  b = 'b',\n  bl = 'bl',\n  l = 'l'\n}\n\n/**\n * Class adding listener on existing buttons to let the user resizing a window.\n * The window expects to be displayed in an absolute position.\n *\n * With \"t\" standing for top, \"l\" for left, \"b\" for bottom and \"r\" for right.\n * The window can implement one or multiple of these buttons:\n *\n * <button tabindex=\"-1\" class=\"resizer tl corner\"></button>\n * <button tabindex=\"-1\" class=\"resizer t top-bottom\"></button>\n * <button tabindex=\"-1\" class=\"resizer tr corner\"></button>\n * <button tabindex=\"-1\" class=\"resizer r left-right\"></button>\n * <button tabindex=\"-1\" class=\"resizer br corner\"></button>\n * <button tabindex=\"-1\" class=\"resizer b top-bottom\"></button>\n * <button tabindex=\"-1\" class=\"resizer bl corner\"></button>\n * <button tabindex=\"-1\" class=\"resizer l left-right\"></button>\n *\n * Proposed CSS\n *\n * .resizer {\n *   --resize-size: 6px;\n *   --negative-resize-size: -6px;\n * }\n *\n * button.resizer {\n *   position: absolute;\n *   background-color: transparent;\n *   border: none;\n * }\n *\n * .resizer.corner {\n *   width: var(--resize-size);\n *   height: var(--resize-size);\n * }\n *\n * .resizer.top-bottom {\n *   width: calc(100% - (2 * var(--resize-size)));\n *   height: var(--resize-size);\n * }\n *\n * .resizer.left-right {\n *   width: var(--resize-size);\n *   height: calc(100% - (2 * var(--resize-size)));\n * }\n *\n * .resizer.tl:hover,\n * .resizer.br:hover {\n *   cursor: nw-resize;\n * }\n *\n * .resizer.tr:hover,\n * .resizer.bl:hover {\n *   cursor: ne-resize;\n * }\n *\n * .resizer.top-bottom:hover {\n *   cursor: n-resize;\n * }\n *\n * .resizer.left-right:hover {\n *   cursor: e-resize;\n * }\n *\n * .resizer.tl {\n *   top: var(--negative-resize-size);\n *   left: var(--negative-resize-size);\n * }\n *\n * .resizer.t {\n *   top: var(--negative-resize-size);\n *   left: var(--resize-size);\n * }\n *\n * .resizer.tr {\n *   top: var(--negative-resize-size);\n *   right: var(--negative-resize-size);\n * }\n *\n * .resizer.r {\n *   top: var(--resize-size);\n *   right: var(--negative-resize-size);\n * }\n *\n * .resizer.br {\n *   bottom: var(--negative-resize-size);\n *   right: var(--negative-resize-size);\n * }\n *\n * .resizer.b {\n *   bottom: var(--negative-resize-size);\n *   left: var(--resize-size);\n * }\n *\n * .resizer.bl {\n *   bottom: var(--negative-resize-size);\n *   left: var(--negative-resize-size);\n * }\n *\n * .resizer.l {\n *   top: var(--resize-size);\n *   left: var(--negative-resize-size);\n * }\n *\n */\nexport default class ResizeWindow {\n  private readonly directions: Direction[] = [\n    Direction.tl,\n    Direction.t,\n    Direction.tr,\n    Direction.r,\n    Direction.br,\n    Direction.b,\n    Direction.bl,\n    Direction.l\n  ];\n  private readonly shadow: ShadowRoot;\n  private readonly host: HTMLElement;\n  private top = 0;\n  private left = 0;\n  private minHeight = 0;\n  private maxHeight = 0;\n  private minWidth = 0;\n  private maxWidth = 0;\n  private height = 0;\n  private width = 0;\n  private originX = 0;\n  private originY = 0;\n  private elements: (HTMLElement | null)[] = [];\n\n  /**\n   * Create the instance and calls init.\n   */\n  constructor(shadow: ShadowRoot) {\n    this.shadow = shadow;\n    this.host = (this.shadow.getRootNode() as ShadowRoot).host as HTMLElement;\n    this.init();\n  }\n\n  /**\n   * Initializes the class by cleaning and attaching events to new existing elements.\n   */\n  init() {\n    this.destroy();\n    this.elements = this.directions.map((direction) => {\n      return this.attachEvent(direction);\n    });\n  }\n\n  /**\n   * Destroys all elements in the object and removes their onmousedown event listeners.\n   */\n  destroy() {\n    this.elements.filter((element) => element !== null).forEach((element) => (element!.onmousedown = null));\n    this.elements = [];\n  }\n\n  /**\n   * Attaches an event listener to existing element with the specified direction.\n   * @return The element with the attached event listener, or null if no matching element was found.\n   */\n  private attachEvent(direction: Direction): HTMLElement | null {\n    const element: HTMLElement | null = this.shadow.querySelector(`.resizer.${direction}`);\n    if (!element) {\n      return null;\n    }\n    element.onmousedown = (event: MouseEvent) => {\n      this.onResizeStarts(event, direction);\n    };\n    return element;\n  }\n\n  /**\n   * Sets up the resize functionality for an element based on the provided MouseEvent and direction.\n   * Attach onmousemove and onmouseup to document to handle and stop the resize.\n   * @param event - The MouseEvent containing the clientX and clientY coordinates.\n   * @param direction - The direction in which the element should be resized.\n   */\n  private onResizeStarts(event: MouseEvent, direction: Direction) {\n    this.originX = event.clientX;\n    this.originY = event.clientY;\n    const dimension = this.host.getBoundingClientRect();\n    this.width = dimension.width;\n    this.height = dimension.height;\n    const css = getComputedStyle(this.host);\n    this.minHeight = parseInt(css.minHeight) || 0;\n    this.maxHeight = parseInt(css.maxHeight) || Infinity;\n    this.minWidth = parseInt(css.minWidth) || 0;\n    this.maxWidth = parseInt(css.maxWidth) || Infinity;\n    this.top = parseInt(css.top) || 0;\n    this.left = parseInt(css.left) || 0;\n    // Call a function whenever the cursor moves.\n    document.onmousemove = (dragEvent) => this.resize(dragEvent, direction);\n    // Detach events.\n    document.onmouseup = () => this.stopResize();\n  }\n\n  /**\n   * Resizes the element based on the given mouse event and direction.\n   * @param event - The MouseEvent containing the \"ondrag\" clientX and clientY coordinates.\n   * @param direction - The direction in which the element should be resized.\n   */\n  private resize(event: MouseEvent, direction: Direction) {\n    const [newTop, newLeft, newHeight, newWidth] = this.getNewSizeAndPosition(event.clientX, event.clientY, direction);\n    this.host.style.top = `${newTop}px`;\n    this.host.style.left = `${newLeft}px`;\n    this.host.style.width = `${newWidth}px`;\n    this.host.style.height = `${newHeight}px`;\n  }\n\n  /**\n   * Calculates the new size and position based on the current client coordinates and direction.\n   * @returns an array containing the new top, left, height, and width values in that order.\n   * @private\n   */\n  private getNewSizeAndPosition(\n    clientX: number,\n    clientY: number,\n    direction: Direction\n  ): [number, number, number, number] {\n    let newHeight = this.height;\n    let newWidth = this.width;\n    let newTop = this.top;\n    let newLeft = this.left;\n    let deltaX = clientX - this.originX;\n    let deltaY = clientY - this.originY;\n    if (direction.includes('t')) {\n      const rawNewHeight = this.height - deltaY;\n      newHeight = minMax(rawNewHeight, this.minHeight, this.maxHeight);\n      // If the height reach the min-max limit, reverse calculate\n      // the maxed out deltaY to limit the new top and don't move the window.\n      if (newHeight !== rawNewHeight) {\n        deltaY = (newHeight - this.height) * -1;\n      }\n      newTop = this.top + deltaY;\n    } else if (direction.includes('b')) {\n      newHeight = minMax(this.height + deltaY, this.minHeight, this.maxHeight);\n    }\n    if (direction.includes('l')) {\n      const rawNewWidth = this.width - deltaX;\n      newWidth = minMax(rawNewWidth, this.minWidth, this.maxWidth);\n      // If the width reach the min-max limit, reverse calculate\n      // the maxed out deltaX to limit the new top and don't move the window.\n      if (newWidth !== rawNewWidth) {\n        deltaX = (newWidth - this.width) * -1;\n      }\n      newLeft = this.left + deltaX;\n    } else if (direction.includes('r')) {\n      newWidth = minMax(this.width + deltaX, this.minWidth, this.maxWidth);\n    }\n    return [newTop, newLeft, newHeight, newWidth];\n  }\n\n  /**\n   * Stops the resizing functionality by clearing the\n   * event listeners for mousemove and mouseup events.\n   */\n  private stopResize() {\n    document.onmousemove = null;\n    document.onmouseup = null;\n  }\n}\n","import type OlFeature from 'ol/Feature';\nimport { getCenter } from 'ol/extent';\nimport GirafeDraggableElement from '../../base/GirafeDraggableElement';\nimport { debounce } from '../../tools/utils/debounce';\nimport type { Callback } from '../../tools/state/statemanager';\nimport type { GridDataById } from '../../tools/featuretogriddatabyid';\nimport FeatureToGridDataById from '../../tools/featuretogriddatabyid';\nimport { getValidIndex } from '../../tools/utils/utils';\nimport IconCenter from './images/center.svg';\nimport ResizeWindow from '../../tools/resizewindow';\nimport DOMPurify from 'dompurify';\n\n/**\n * Represents a Feature displayed in the SelectionWindowComponent.\n */\ninterface WindowFeature {\n  id: string;\n  feature: OlFeature;\n  notOlProperties: Record<string, unknown>;\n}\n\n/**\n * Represents a draggable and resizable selection window component.\n * Display itself when it should be visible and have selected features.\n * To be visible, it has to be the defined selectionComponent.\n */\nclass SelectionWindowComponent extends GirafeDraggableElement {\n  templateUrl = './template.html';\n  styleUrl = './style.css';\n\n  private readonly eventsCallbacks: Callback[] = [];\n  private isVisibleComponentSetup = false;\n  private debounceOnFeaturesSelected = debounce(this.onFeaturesSelected.bind(this), 200);\n  private resizeWindow: ResizeWindow | null = null;\n  private featureToGridData = new FeatureToGridDataById({ removeEmptyColumns: false });\n  private windowFeatures: WindowFeature[] = [];\n  visible = false;\n  focusedIndex = 0;\n  maxIndex = 0;\n  iconCenter = IconCenter;\n  displayedProperties: [string, unknown][] = [];\n\n  constructor() {\n    super('selectionwindow');\n  }\n\n  connectedCallback() {\n    this.render();\n    this.registerVisibilityEvents();\n  }\n\n  /**\n   * Render the component regarding its visibility.\n   */\n  render() {\n    this.visible ? this.renderComponent() : this.renderComponentEmpty();\n  }\n\n  /**\n   * @returns The WindowFeature at the currently focused index.\n   */\n  getWindowFeature(): WindowFeature {\n    return this.windowFeatures[this.focusedIndex];\n  }\n\n  /**\n   * Recenter the map view based on the current feature.\n   */\n  recenter() {\n    const windowFeature = this.getWindowFeature();\n    const extent = windowFeature?.feature?.getGeometry()?.getExtent();\n    if (!extent) {\n      console.error('Invalid feature to recenter on.');\n      return;\n    }\n    this.state.position.center = getCenter(extent);\n  }\n\n  /**\n   * Closes the window and deselect the selected features.\n   */\n  closeWindow() {\n    this.visible = false;\n    this.state.interface.selectionComponentVisible = false; // Will render it again.\n    this.state.selection.focusedFeatures = null;\n    this.state.selection.selectedFeatures = [];\n  }\n\n  /**\n   * Sets the focus on a specific feature.\n   */\n  onFocusWindowFeature(index: number) {\n    const windowFeature = this.selectedWindowFeature(index);\n    this.state.selection.focusedFeatures = [windowFeature.feature];\n    // Get content.\n    this.displayedProperties = Object.entries(windowFeature.notOlProperties).filter((keyValue) => {\n      return keyValue[1] !== undefined;\n    });\n    this.displayedProperties.forEach((keyValue) => {\n      let config = {};\n      if (this.configManager.Config.query.legacy) {\n        config = {\n          ADD_ATTR: ['onclick'],\n          ADD_URI_SAFE_ATTR: ['onclick']\n        };\n      }\n      keyValue[1] = DOMPurify.sanitize(keyValue[1] as string, config);\n      return keyValue[1];\n    });\n    // Render and translate data.\n    this.render();\n    super.girafeTranslate();\n  }\n\n  /**\n   * Renders the component by calling the necessary methods.\n   * @private\n   */\n  private renderComponent() {\n    super.render();\n    super.girafeTranslate();\n    this.activateTooltips(false, [800, 0], 'top-end');\n    if (!this.isVisibleComponentSetup) {\n      this.setupVisibleComponent();\n    }\n  }\n\n  /**\n   * Sets up the components state and side-kicks.\n   * This must be called once at the first (visible) rendering.\n   * @private\n   */\n  private setupVisibleComponent() {\n    this.isVisibleComponentSetup = true;\n    this.resizeWindow = new ResizeWindow(this.shadow);\n    this.makeDraggable();\n    this.registerEvents();\n  }\n\n  /**\n   * Render a placeholder, not visible component on hide.\n   * Removes event registration.\n   * @private\n   */\n  private renderComponentEmpty() {\n    this.resizeWindow?.destroy();\n    this.resizeWindow = null;\n    this.stateManager.unsubscribe(this.eventsCallbacks);\n    this.eventsCallbacks.length = 0;\n    this.isVisibleComponentSetup = false;\n    this.renderEmpty();\n  }\n\n  /**\n   * Event about visibility that must be always listened by this component, even hidden.\n   * @private\n   */\n  private registerVisibilityEvents() {\n    this.stateManager.subscribe('interface.selectionComponentVisible', (_oldValue, newValue) =>\n      this.togglePanel(newValue)\n    );\n  }\n\n  /**\n   * Listen events that must be listened if the component is visible.\n   * @private\n   */\n  private registerEvents() {\n    this.eventsCallbacks.push(\n      this.stateManager.subscribe('selection.selectedFeatures', (_oldFeatures, newFeatures) => {\n        // Use debounce to avoid quicly closing the grid on selection change.\n        this.debounceOnFeaturesSelected(newFeatures);\n      })\n    );\n  }\n\n  /**\n   * Sets the selected features in the window and updates the window state to display the first feature.\n   * @private\n   */\n  private onFeaturesSelected(features: OlFeature[] | null) {\n    if (!features?.length) {\n      this.closeWindow();\n      return;\n    }\n    this.windowFeatures = SelectionWindowComponent.createWindowFeatures(\n      this.featureToGridData.toGridDataById(features ?? [])\n    );\n    if (!this.windowFeatures.length) {\n      this.closeWindow();\n      return;\n    }\n    this.maxIndex = this.windowFeatures.length - 1;\n    this.onFocusWindowFeature(0);\n  }\n\n  /**\n   * Selects a window feature by its first valid index.\n   * Out of bound index loops back to the first valid index.\n   * @returns The selected window feature.\n   * @private\n   */\n  private selectedWindowFeature(index: number): WindowFeature {\n    this.focusedIndex = getValidIndex(index, this.maxIndex);\n    return this.getWindowFeature();\n  }\n\n  /**\n   * Toggles the panel visibility. If visible, tries to display a grid with selected feature.\n   * Can only be visible if the component is the wanted selection component.\n   * @private\n   */\n  private togglePanel(visible: boolean) {\n    if (this.state.interface.selectionComponent !== 'window') {\n      if (!this.visible) {\n        return;\n      }\n      visible = false;\n    }\n    this.visible = visible;\n    if (visible) {\n      // Will be rendered after computing selected feature.\n      this.onFeaturesSelected(this.state.selection.selectedFeatures);\n    } else {\n      this.render();\n    }\n  }\n\n  /**\n   * Creates an array of WindowFeature objects based on the provided GridDataById object.\n   * Using gridDataById orders by feature id the WindowFeatures.\n   * @returns An array of WindowFeature objects.\n   * @static\n   */\n  static createWindowFeatures(gridDataById: GridDataById): WindowFeature[] {\n    const windowFeatures: WindowFeature[] = [];\n    Object.keys(gridDataById).forEach((id) => {\n      const gridData = gridDataById[id];\n      gridData.features.forEach((feature, index) => {\n        windowFeatures.push({\n          id,\n          feature,\n          notOlProperties: gridData.notOlProperties[index]\n        });\n      });\n    });\n    return windowFeatures;\n  }\n}\n\nexport default SelectionWindowComponent;\n","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20448%20512'%3e%3c!--!Font%20Awesome%20Free%206.5.1%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202024%20Fonticons,%20Inc.--%3e%3cpath%20d='M64%2032C28.7%2032%200%2060.7%200%2096V416c0%2035.3%2028.7%2064%2064%2064H384c35.3%200%2064-28.7%2064-64V96c0-35.3-28.7-64-64-64H64zm297.1%2084L257.3%20234.6%20379.4%20396H283.8L209%20298.1%20123.3%20396H75.8l111-126.9L69.7%20116h98l67.7%2089.5L313.6%20116h47.5zM323.3%20367.6L153.4%20142.9H125.1L296.9%20367.6h26.3z'/%3e%3c/svg%3e\"","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20448%20512'%3e%3c!--!Font%20Awesome%20Free%206.5.1%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202024%20Fonticons,%20Inc.--%3e%3cpath%20d='M64%2032C28.7%2032%200%2060.7%200%2096V416c0%2035.3%2028.7%2064%2064%2064h98.2V334.2H109.4V256h52.8V222.3c0-87.1%2039.4-127.5%20125-127.5c16.2%200%2044.2%203.2%2055.7%206.4V172c-6-.6-16.5-1-29.6-1c-42%200-58.2%2015.9-58.2%2057.2V256h83.6l-14.4%2078.2H255V480H384c35.3%200%2064-28.7%2064-64V96c0-35.3-28.7-64-64-64H64z'/%3e%3c/svg%3e\"","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20448%20512'%3e%3c!--!Font%20Awesome%20Free%206.5.1%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202024%20Fonticons,%20Inc.--%3e%3cpath%20d='M416%2032H31.9C14.3%2032%200%2046.5%200%2064.3v383.4C0%20465.5%2014.3%20480%2031.9%20480H416c17.6%200%2032-14.5%2032-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4%20416H69V202.2h66.5V416zm-33.2-243c-21.3%200-38.5-17.3-38.5-38.5S80.9%2096%20102.2%2096c21.2%200%2038.5%2017.3%2038.5%2038.5%200%2021.3-17.2%2038.5-38.5%2038.5zm282.1%20243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6%200-39.9%2027-39.9%2054.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8%2030.6-34.5%2062.9-34.5%2067.2%200%2079.7%2044.3%2079.7%20101.9V416z'/%3e%3c/svg%3e\"","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20448%20512'%3e%3c!--!Font%20Awesome%20Free%206.5.1%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202024%20Fonticons,%20Inc.--%3e%3cpath%20d='M64%2032C28.7%2032%200%2060.7%200%2096V416c0%2035.3%2028.7%2064%2064%2064H384c35.3%200%2064-28.7%2064-64V96c0-35.3-28.7-64-64-64H64zM218%20271.7L64.2%20172.4C66%20156.4%2079.5%20144%2096%20144H352c16.5%200%2030%2012.4%2031.8%2028.4L230%20271.7c-1.8%201.2-3.9%201.8-6%201.8s-4.2-.6-6-1.8zm29.4%2026.9L384%20210.4V336c0%2017.7-14.3%2032-32%2032H96c-17.7%200-32-14.3-32-32V210.4l136.6%2088.2c7%204.5%2015.1%206.9%2023.4%206.9s16.4-2.4%2023.4-6.9z'/%3e%3c/svg%3e\"","import { IUrlShortener, UrlShortenerResponse } from './iurlshortener';\n\ntype LstuBaseResponse = {\n  success: boolean;\n};\n\ntype LstuResponse = LstuBaseResponse & Record<string, unknown>;\n\ntype LstuSuccessResponse = {\n  short: string;\n  qrcode: string;\n  success: boolean;\n  url: string;\n};\n\nclass LstuManager implements IUrlShortener {\n  serviceUrl: string;\n\n  constructor(serviceUrl: string) {\n    this.serviceUrl = serviceUrl;\n  }\n\n  async shortenUrl(longUrl: string): Promise<UrlShortenerResponse> {\n    const params = new URLSearchParams();\n    params.append('lsturl', longUrl);\n    params.append('format', 'json');\n\n    const errorResponse = {\n      success: false,\n      shorturl: longUrl\n    };\n\n    try {\n      const response = await fetch(this.serviceUrl, {\n        method: 'POST',\n        headers: new Headers({\n          'Content-Type': 'application/x-www-form-urlencoded'\n        }),\n        body: params\n      });\n\n      const response_data = (await response.json()) as LstuResponse;\n      if (response_data.success) {\n        const data = response_data as LstuSuccessResponse;\n        return {\n          success: true,\n          shorturl: data.short,\n          qrcode: `data:image/png;base64, ${data.qrcode}`\n        };\n      }\n      return errorResponse;\n    } catch (error) {\n      return errorResponse;\n    }\n  }\n}\n\nexport default LstuManager;\n","import { IUrlShortener, UrlShortenerResponse } from './iurlshortener';\n\ntype GmfSuccessResponse = {\n  short_url: string;\n};\n\nclass GmfManager implements IUrlShortener {\n  serviceUrl: string;\n\n  constructor(serviceUrl: string) {\n    this.serviceUrl = serviceUrl;\n  }\n\n  async shortenUrl(longUrl: string): Promise<UrlShortenerResponse> {\n    const errorResponse = {\n      success: false,\n      shorturl: longUrl\n    };\n\n    try {\n      const params = new URLSearchParams();\n      params.append('url', longUrl);\n      const response = await fetch(this.serviceUrl, {\n        method: 'POST',\n        headers: new Headers({\n          'Content-Type': 'application/x-www-form-urlencoded'\n        }),\n        body: params\n      });\n\n      const response_data = (await response.json()) as GmfSuccessResponse;\n      if (response_data) {\n        return {\n          success: true,\n          shorturl: response_data.short_url\n        };\n      }\n\n      return errorResponse;\n    } catch (error) {\n      return errorResponse;\n    }\n  }\n}\n\nexport default GmfManager;\n","import GirafeDraggableElement from '../../base/GirafeDraggableElement';\nimport TwitterLogo from './images/twitter.svg';\nimport FacebookLogo from './images/facebook.svg';\nimport LinkedInLogo from './images/linkedin.svg';\nimport MailLogo from './images/mail.svg';\nimport ShareManager from '../../tools/share/sharemanager';\nimport { IUrlShortener } from './tools/iurlshortener';\nimport LstuManager from './tools/lstumanager';\nimport GmfManager from './tools/gmfmanager';\n\nclass ShareComponent extends GirafeDraggableElement {\n  templateUrl = './template.html';\n  styleUrl = './style.css';\n\n  loading = true;\n\n  shareLink?: string;\n  qrCode?: string;\n  success: boolean = true;\n  twitterLogo: string = TwitterLogo;\n  facebookLogo: string = FacebookLogo;\n  linkedInLogo: string = LinkedInLogo;\n  mailLogo: string = MailLogo;\n\n  shareManager: ShareManager;\n  urlShortener?: IUrlShortener;\n\n  constructor() {\n    super('share');\n\n    this.shareManager = ShareManager.getInstance();\n  }\n\n  registerEvents() {\n    this.stateManager.subscribe('interface.shareVisible', (_oldValue: boolean, newValue: boolean) =>\n      this.togglePopup(newValue)\n    );\n  }\n\n  initializeShortenerService() {\n    // Initialize UrlShortener\n    switch (this.configManager.Config.share.service) {\n      case 'gmf':\n        this.urlShortener = new GmfManager(this.configManager.Config.share.createUrl);\n        break;\n      case 'lstu':\n        this.urlShortener = new LstuManager(this.configManager.Config.share.createUrl);\n        break;\n    }\n  }\n\n  render() {\n    super.render();\n    super.makeDraggable();\n  }\n\n  async togglePopup(visible: boolean) {\n    if (this.urlShortener && visible) {\n      this.loading = true;\n      this.render();\n      const base = window.location.href.split('#')[0];\n      const hash = this.shareManager.getStateToShare();\n      const longurl = `${base}#${hash}`;\n\n      const response = await this.urlShortener.shortenUrl(longurl);\n      this.shareLink = response.shorturl;\n      this.success = response.success;\n      this.qrCode = response.qrcode;\n      this.loading = false;\n      this.render();\n    } else {\n      this.renderEmpty();\n    }\n  }\n\n  closeWindow() {\n    this.state.interface.shareVisible = false;\n  }\n\n  shareFacebook() {\n    window.open('https://www.facebook.com/sharer/sharer.php?u=' + this.shareLink, '_blank');\n  }\n\n  shareTwitter() {\n    window.open('https://twitter.com/intent/tweet?url=' + this.shareLink, '_blank');\n  }\n\n  shareLinkedIn() {\n    window.open('https://www.linkedin.com/shareArticle?url=' + this.shareLink, '_blank');\n  }\n\n  shareMail() {\n    const subject = encodeURIComponent('Check out this link');\n    const body = encodeURIComponent('I thought you might be interested in this link: ' + this.shareLink);\n    window.location.href = 'mailto:?subject=' + subject + '&body=' + body;\n  }\n\n  copyToClipboard() {\n    navigator.clipboard.writeText(this.shareLink!);\n  }\n\n  connectedCallback() {\n    this.loadConfig().then(() => {\n      this.render();\n      this.girafeTranslate();\n      this.initializeShortenerService();\n      this.registerEvents();\n    });\n  }\n}\n\nexport default ShareComponent;\n","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20448%20512'%3e%3c!--!Font%20Awesome%20Free%206.5.2%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202024%20Fonticons,%20Inc.--%3e%3cpath%20d='M64%2032C28.7%2032%200%2060.7%200%2096V416c0%2035.3%2028.7%2064%2064%2064H384c35.3%200%2064-28.7%2064-64V96c0-35.3-28.7-64-64-64H64zM200%20344V280H136c-13.3%200-24-10.7-24-24s10.7-24%2024-24h64V168c0-13.3%2010.7-24%2024-24s24%2010.7%2024%2024v64h64c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024H248v64c0%2013.3-10.7%2024-24%2024s-24-10.7-24-24z'/%3e%3c/svg%3e\"","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20512%20512'%3e%3c!--!Font%20Awesome%20Free%206.5.2%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202024%20Fonticons,%20Inc.--%3e%3cpath%20d='M208.5%2062.3l28.1-36.9C248.8%209.4%20267.8%200%20288%200c28.5%200%2053.6%2018.7%2061.8%2046l17.8%2059.4c10.3%2034.4%2036.1%2062%2069.8%2074.6l39.8%2014.9c20.9%207.9%2034.8%2027.9%2034.8%2050.2c0%2016.9-7.9%2032.8-21.5%2042.9l-67.3%2050.5c-24.3%2018.2-37.2%2047.9-33.8%2078.1l2.5%2022.7c4.3%2038.7-26%2072.6-65%2072.6c-14.8%200-29.3-5.1-40.8-14.3l-55.4-44.3c-4.5-3.6-9.3-6.7-14.5-9.2c-15.8-7.9-33.7-10.4-51-7.3L82.4%20451.9C47.8%20458.2%2016%20431.6%2016%20396.5c0-13.2%204.7-26%2013.1-36.2l11.2-13.4c14.6-17.4%2022.6-39.4%2022.6-62.1c0-18.8-5.5-37.2-15.8-53L8.8%20173.5C3.1%20164.7%200%20154.4%200%20143.9c0-33.4%2030.1-58.8%2063-53.2l51.3%208.7c35.9%206.1%2072.2-8.2%2094.2-37.1z'/%3e%3c/svg%3e\"","import BaseLayer from '../../../models/layers/baselayer';\nimport ThemeLayer from '../../../models/layers/themelayer';\nimport { SharedLayer } from '../../../tools/share/sharedstate';\nimport StateSerializer from '../../../tools/share/stateserializer';\nimport CustomIcon from '../images/custom.svg';\nimport { v4 as uuidv4 } from 'uuid';\n\nexport default class CustomTheme {\n  id: string;\n  layers: BaseLayer[];\n  name: string;\n  icon: string;\n\n  get hasThemes() {\n    for (const layer of this.layers) {\n      if (layer instanceof ThemeLayer) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  constructor(name: string) {\n    this.id = uuidv4();\n    this.name = name;\n    this.layers = [];\n    this.icon = CustomIcon;\n  }\n\n  getSerialized(): SharedLayer[] {\n    return new StateSerializer().getSerializedLayerTree(this.layers);\n  }\n\n  getThemeLayer() {\n    const theme = new ThemeLayer(1000000, this.name, 0);\n    theme.children.push(...this.layers);\n    return theme;\n  }\n}\n","import BaseLayer from '../../../models/layers/baselayer';\nimport GroupLayer from '../../../models/layers/grouplayer';\nimport Layer from '../../../models/layers/layer';\nimport ThemeLayer from '../../../models/layers/themelayer';\nimport { SharedLayer } from '../../../tools/share/sharedstate';\nimport StateDeserializer from '../../../tools/share/statedeserializer';\nimport CustomTheme from './customtheme';\n\nclass CustomThemesManager {\n  public customThemes: CustomTheme[] = [];\n\n  public addTheme(themeName: string, layersList: BaseLayer[]) {\n    const theme = new CustomTheme(themeName);\n    for (const layerBase of layersList) {\n      const layer = layerBase.clone();\n      this.manageActiveStateForClonedObject(layer);\n      theme.layers.push(layer);\n    }\n\n    this.customThemes.push(theme);\n    this.saveCustomThemes();\n  }\n\n  manageActiveStateForClonedObject(layer: BaseLayer) {\n    /** Manage the current active state and default active state\n     * 1. We set isDefaultChecked to the active state (because when the layer will be loaded, we want to activate it automatically)\n     * 2. We deactivate the layer, because it was just cloned and is not active yet.\n     * We only do this on layers, not on groups\n     **/\n    if (layer instanceof Layer) {\n      layer.isDefaultChecked = layer.active;\n      layer.activeState = 'off';\n    } else if (layer instanceof GroupLayer || layer instanceof ThemeLayer) {\n      for (const child of layer.children) {\n        this.manageActiveStateForClonedObject(child);\n      }\n    }\n  }\n\n  public deleteTheme(theme: CustomTheme) {\n    const index = this.customThemes.findIndex((item) => item === theme);\n    if (index >= 0) {\n      this.customThemes.splice(index, 1);\n      this.saveCustomThemes();\n    } else {\n      throw new Error('The custom theme to be removed cannot be found in the list of custom themes');\n    }\n  }\n\n  saveCustomThemes() {\n    const serializedobject: Record<string, SharedLayer[]> = {};\n    for (const customTheme of this.customThemes) {\n      serializedobject[customTheme.name] = customTheme.getSerialized();\n    }\n    localStorage.setItem('custom-themes', JSON.stringify(serializedobject));\n  }\n\n  public loadCustomThemes() {\n    try {\n      const localThemes = localStorage.getItem('custom-themes');\n      if (localThemes) {\n        const serializedCustomThemes = JSON.parse(localThemes);\n        for (const customThemeName in serializedCustomThemes) {\n          const customTheme = new CustomTheme(customThemeName);\n          const layerTree = new StateDeserializer().getDeserializedLayerTree(serializedCustomThemes[customThemeName]);\n          customTheme.layers.push(...layerTree);\n          this.customThemes.push(customTheme);\n        }\n      }\n    } catch (error) {\n      console.warn('Cannot deserialize custom themes from local storage');\n      console.warn(error);\n      // Do not throw the error, the themes selector can still be used\n    }\n  }\n}\n\nexport default CustomThemesManager;\n","import GirafeHTMLElement from '../../base/GirafeHTMLElement';\nimport ThemeLayer from '../../models/layers/themelayer';\nimport MapManager from '../../tools/state/mapManager';\nimport NewIcon from './images/new.svg';\nimport CustomTheme from './tools/customtheme';\nimport CustomThemesManager from './tools/customthemesmanager';\n\nclass ThemeComponent extends GirafeHTMLElement {\n  templateUrl = './template.html';\n  styleUrl = './style.css';\n\n  newIcon: string = NewIcon;\n\n  private readonly mapManager: MapManager;\n  private customThemesManager = new CustomThemesManager();\n  public menuOpen: boolean = false;\n\n  public get customThemes() {\n    return this.customThemesManager?.customThemes ?? [];\n  }\n\n  constructor() {\n    super('themes');\n    this.mapManager = MapManager.getInstance();\n  }\n\n  registerEvents() {\n    this.stateManager.subscribe('loading', () => super.render());\n    this.stateManager.subscribe('themes.isLoaded', () => {\n      if (this.state.themes.isLoaded) {\n        this.customThemesManager.loadCustomThemes();\n        super.render();\n        super.girafeTranslate();\n      }\n    });\n  }\n\n  onBlur() {\n    this.menuOpen = false;\n    super.render();\n  }\n\n  toggleThemesList() {\n    this.menuOpen = !this.menuOpen;\n    super.render();\n  }\n\n  onThemeChanged(theme: ThemeLayer) {\n    this.state.themes.lastSelectedTheme = theme;\n    this.onBlur();\n\n    if (theme.location != null || theme.zoom != null) {\n      const view = this.mapManager.getMap().getView();\n      view.animate({\n        center: theme.location ?? view.getCenter(),\n        zoom: theme.zoom ?? view.getZoom(),\n        duration: 1000\n      });\n    }\n  }\n\n  onCustomThemeChanged(customTheme: CustomTheme) {\n    if (customTheme.hasThemes) {\n      for (let i = customTheme.layers.length - 1; i >= 0; --i) {\n        const theme = customTheme.layers[i];\n        if (theme instanceof ThemeLayer) {\n          this.state.themes.lastSelectedTheme = theme;\n        } else {\n          throw new Error('There is an error in the custom');\n        }\n      }\n    } else {\n      this.state.themes.lastSelectedTheme = customTheme.getThemeLayer();\n    }\n  }\n\n  onAddCustomTheme() {\n    const themeName = prompt('Please give a name to you new custom theme:');\n    if (themeName !== null && themeName.trim().length > 0) {\n      this.customThemesManager.addTheme(themeName, this.state.layers.layersList);\n      super.render();\n    }\n  }\n\n  onDeleteCustomTheme(themelayer: CustomTheme, e: Event) {\n    e.stopPropagation();\n    if (confirm('Do you want to delete this theme?')) {\n      this.customThemesManager.deleteTheme(themelayer);\n      super.render();\n    }\n  }\n\n  connectedCallback() {\n    this.loadConfig().then(() => {\n      super.render();\n      this.activateTooltips(false, [800, 0], 'top');\n      this.registerEvents();\n    });\n  }\n}\n\nexport default ThemeComponent;\n","import LayerManager from '../../../tools/layermanager';\nimport GroupLayer from '../../../models/layers/grouplayer';\nimport BaseLayer from '../../../models/layers/baselayer';\nimport ThemeLayer from '../../../models/layers/themelayer';\nimport ConfigManager from '../../../tools/configuration/configmanager';\nimport Layer from '../../../models/layers/layer';\nimport ILayerWithLegend from '../../../models/layers/ilayerwithlegend';\n\nexport default class GroupHelper {\n  private static layerManager: LayerManager = LayerManager.getInstance();\n  private static configManager: ConfigManager = ConfigManager.getInstance();\n\n  public static getSortedLayers(layers: BaseLayer[]) {\n    const orderedLayers = layers.slice().sort((l1: BaseLayer, l2: BaseLayer) => {\n      return l1.order - l2.order;\n    });\n    return orderedLayers ?? [];\n  }\n\n  public static activateDefaultLayers(layers: BaseLayer[]) {\n    for (const layer of layers) {\n      // Activate the layer by default\n      this.layerManager.activateIfDefaultChecked(layer);\n\n      // Manage the legend visibility\n      if (\n        layer instanceof Layer &&\n        !layer.active &&\n        this.configManager.Config.treeview.hideLegendWhenLayerIsDeactivated &&\n        this.layerManager.isLayerWithLegend(layer)\n      ) {\n        // Hide Legend\n        (layer as ILayerWithLegend).isLegendExpanded = false;\n        (layer as ILayerWithLegend).wasLegendExpanded = true;\n      }\n\n      // Continue recursively\n      if (layer instanceof GroupLayer || layer instanceof ThemeLayer) {\n        this.activateDefaultLayers(layer.children);\n      }\n    }\n  }\n}\n","import GirafeHTMLElement from '../../../base/GirafeHTMLElement';\nimport BaseLayer from '../../../models/layers/baselayer';\nimport GroupLayer from '../../../models/layers/grouplayer';\nimport ThemeLayer from '../../../models/layers/themelayer';\nimport LayerManager from '../../../tools/layermanager';\nimport LayerWms from '../../../models/layers/layerwms';\nimport GroupHelper from '../tools/grouphelper';\n\nclass TreeViewRootComponent extends GirafeHTMLElement {\n  templateUrl = './template.html';\n  styleUrls = ['./style.css', '../../../styles/common.css'];\n\n  private layerManager: LayerManager;\n\n  private isAllExpanded: boolean = false;\n  private areAllLegendExpanded: boolean = true;\n\n  constructor() {\n    super('treeviewroot');\n    this.layerManager = LayerManager.getInstance();\n  }\n\n  public sortedLayers() {\n    return GroupHelper.getSortedLayers(this.state.layers.layersList);\n  }\n\n  public render() {\n    super.render();\n    this.activateTooltips(false, [800, 0], 'right');\n  }\n\n  private registerEvents() {\n    this.subscribe('layers.layersList', (oldLayers, newLayers) => this.onLayersListChanged(oldLayers, newLayers));\n    this.subscribe('treeview.advanced', () => this.refreshRender());\n    this.subscribe(/layers\\.layersList\\..*\\.order/, () => this.refreshRender());\n  }\n\n  private onLayersListChanged(oldLayers: BaseLayer[], newLayers: BaseLayer[]) {\n    super.refreshRender();\n    // If we added a new group to the list of layers\n    // Then we activate the layers that should be activated by default\n    let addedLayers = newLayers;\n    if (oldLayers) {\n      addedLayers = newLayers.filter(\n        (newLayer) => !oldLayers.find((oldLayer) => oldLayer.treeItemId === newLayer.treeItemId)\n      );\n    }\n    GroupHelper.activateDefaultLayers(addedLayers);\n  }\n\n  protected connectedCallback() {\n    this.loadConfig().then(() => {\n      this.render();\n      super.girafeTranslate();\n      this.registerEvents();\n    });\n  }\n\n  public expandAll() {\n    this.isAllExpanded = !this.isAllExpanded;\n    this.expandAllRecursive(this.state.layers.layersList);\n    super.refreshRender();\n  }\n\n  private expandAllRecursive(layers: BaseLayer[]) {\n    for (const layer of layers) {\n      if (layer instanceof GroupLayer || layer instanceof ThemeLayer) {\n        layer.isExpanded = this.isAllExpanded;\n        this.expandAllRecursive(layer.children);\n      }\n    }\n  }\n\n  public toggleAllLegends() {\n    this.areAllLegendExpanded = !this.areAllLegendExpanded;\n    this.toggleAllLegendsRecursive(this.state.layers.layersList);\n    super.refreshRender();\n  }\n\n  private toggleAllLegendsRecursive(layers: BaseLayer[]) {\n    for (const layer of layers) {\n      if (layer instanceof LayerWms && layer.legend) {\n        layer.isLegendExpanded = this.areAllLegendExpanded;\n      } else if (layer instanceof GroupLayer || layer instanceof ThemeLayer) {\n        this.toggleAllLegendsRecursive(layer.children);\n      }\n    }\n  }\n\n  public removeAll() {\n    for (const layer of this.stateManager.state.layers.layersList) {\n      this.layerManager.toggle(layer, 'off');\n    }\n    this.state.layers.layersList = [];\n    this.state.themes.lastSelectedTheme = null;\n  }\n}\n\nexport default TreeViewRootComponent;\n","import BaseLayer from '../../../models/layers/baselayer';\nimport StateManager from '../../../tools/state/statemanager';\n\nclass DragHelper {\n  static checkParents(dragged: BaseLayer, dropped: BaseLayer) {\n    if (dragged.parent !== dropped.parent) {\n      throw Error('Layers can only be reordered if the have the same parent');\n    }\n  }\n\n  static reorderLayers(\n    dragged: BaseLayer,\n    dropped: BaseLayer,\n    adjustOrder: (childOrder: number, draggedOrder: number) => boolean,\n    increment: number\n  ) {\n    DragHelper.checkParents(dragged, dropped);\n    dragged.order = dropped.order;\n\n    const layersToReorder = dragged.parent\n      ? dragged.parent.children\n      : StateManager.getInstance().state.layers.layersList;\n\n    for (const child of layersToReorder) {\n      if (child.treeItemId !== dragged.treeItemId && adjustOrder(child.order, dragged.order)) {\n        child.order += increment;\n      }\n    }\n  }\n\n  static moveLayerAfter(dragged: BaseLayer, dropped: BaseLayer) {\n    const minOrder = dragged.order;\n    DragHelper.reorderLayers(\n      dragged,\n      dropped,\n      (childOrder, draggedOrder) => childOrder <= draggedOrder && childOrder >= minOrder,\n      -1\n    );\n  }\n\n  static moveLayerBefore(dragged: BaseLayer, dropped: BaseLayer) {\n    const maxOrder = dragged.order;\n    DragHelper.reorderLayers(\n      dragged,\n      dropped,\n      (childOrder, draggedOrder) => childOrder >= draggedOrder && childOrder <= maxOrder,\n      1\n    );\n  }\n}\n\nexport default DragHelper;\n","import GirafeSingleton from '../../../base/GirafeSingleton';\nimport BaseLayer from '../../../models/layers/baselayer';\nimport DragHelper from './draghelper';\n\nclass DragManager extends GirafeSingleton {\n  private layer?: BaseLayer;\n  private destination?: BaseLayer;\n  public dragAfter: boolean = false;\n  public dragBefore: boolean = false;\n\n  public dragStart(layer: BaseLayer) {\n    this.layer = layer;\n  }\n\n  public dragEnd() {\n    if (this.layer && this.destination && this.layer.parent === this.destination.parent) {\n      if (this.layer.order < this.destination.order) {\n        DragHelper.moveLayerAfter(this.layer, this.destination);\n      } else if (this.layer.order > this.destination.order) {\n        DragHelper.moveLayerBefore(this.layer, this.destination);\n      } else {\n        throw Error('Orders are equal. Not managed yet');\n      }\n      this.layer = undefined;\n      this.destination = undefined;\n    } else {\n      // Just do nothing, this move is not possible.\n      console.debug('Illegal drag&drop');\n    }\n  }\n\n  public dragEnter(target: BaseLayer): boolean {\n    if (this.layer !== target && this.layer?.parent === target.parent) {\n      // Same parent, but different item\n      this.destination = target;\n      if (this.layer!.order > target.order) {\n        this.dragBefore = true;\n      } else {\n        this.dragAfter = true;\n      }\n      return true;\n    }\n    return false;\n  }\n\n  public dragLeave(target: BaseLayer): boolean {\n    if (this.layer?.treeItemId !== target.treeItemId && this.layer?.parent?.treeItemId === target.parent?.treeItemId) {\n      this.dragAfter = false;\n      this.dragBefore = false;\n      return true;\n    }\n    return false;\n  }\n}\n\nexport default DragManager;\n","import GirafeHTMLElement from '../../../base/GirafeHTMLElement';\nimport BaseLayer from '../../../models/layers/baselayer';\nimport LayerManager from '../../../tools/layermanager';\nimport DragManager from './dragmanager';\n\nexport default abstract class TreeViewElement extends GirafeHTMLElement {\n  private dragManager: DragManager;\n  protected layerManager: LayerManager;\n  protected layer: BaseLayer;\n\n  private dragButton!: HTMLButtonElement;\n  private container!: HTMLElement;\n\n  constructor(layer: BaseLayer, name: string) {\n    super(name);\n    this.layer = layer;\n    this.layerManager = LayerManager.getInstance();\n    this.dragManager = DragManager.getInstance();\n  }\n\n  public render() {\n    super.render();\n    this.dragButton = this.shadow.getElementById('drag-button') as HTMLButtonElement;\n    this.container = this.shadow.getElementById('container') as HTMLElement;\n\n    super.girafeTranslate();\n    this.initializeDrag();\n    this.createTooltips();\n  }\n\n  public refreshRender(): void;\n  public refreshRender(layer?: BaseLayer): void;\n  public refreshRender(layer?: BaseLayer): void {\n    if (!layer || layer === this.layer) {\n      // Is called without param, call refresh\n      // Else, call refresh only if the layer in param is the current one\n      super.refreshRender();\n      this.createTooltips();\n    }\n  }\n\n  private createTooltips() {\n    super.activateTooltips(false, [800, 0], 'top');\n  }\n\n  protected showMetadata() {\n    this.state.metadata = {\n      title: this.layer.name,\n      url: this.layer.metadataUrl ?? null\n    };\n    this.state.interface.metadataVisible = true;\n  }\n\n  private initializeDrag() {\n    this.dragButton.draggable = true;\n    this.dragButton.ondragstart = (e: DragEvent) => this.dragStart(e);\n    this.dragButton.ondragend = (e: DragEvent) => this.dragEnd(e);\n    this.ondragenter = (e: DragEvent) => this.dragEnter(e);\n    this.ondragleave = (e: DragEvent) => this.dragLeave(e);\n  }\n\n  private dragStart(event: DragEvent) {\n    this.dragManager.dragStart(this.layer);\n    event.dataTransfer!.setDragImage(this, this.offsetWidth, 0);\n  }\n\n  private dragEnd(_event: DragEvent) {\n    this.dragManager.dragEnd();\n  }\n\n  private dragEnter(_event: DragEvent) {\n    if (this.dragManager.dragEnter(this.layer)) {\n      this.setDragStyle();\n    }\n  }\n\n  private dragLeave(_event: DragEvent) {\n    if (this.dragManager.dragLeave(this.layer)) {\n      this.setDragStyle();\n    }\n  }\n\n  private setDragStyle() {\n    if (this.dragManager.dragAfter) {\n      this.container.classList.remove('dragBefore');\n      this.container.classList.add('dragAfter');\n    } else if (this.dragManager.dragBefore) {\n      this.container.classList.remove('dragAfter');\n      this.container.classList.add('dragBefore');\n    } else {\n      this.container.classList.remove('dragAfter');\n      this.container.classList.remove('dragBefore');\n    }\n  }\n}\n","import ImageWMS from 'ol/source/ImageWMS';\nimport tippy from 'tippy.js';\nimport Layer from '../../../models/layers/layer';\nimport LayerWms from '../../../models/layers/layerwms';\nimport LayerLocalFile from '../../../models/layers/layerlocalfile';\nimport QueryBuilderComponent from '../../querybuilder/component';\nimport MapManager from '../../../tools/state/mapManager';\nimport LayerWmts from '../../../models/layers/layerwmts';\nimport TreeViewElement from '../tools/treeviewelement';\n\nclass TreeViewItemComponent extends TreeViewElement {\n  templateUrl = './template.html';\n  styleUrls = ['../style.css', '../../../styles/common.css'];\n\n  iconUrl: string | null = null;\n  legendUrls: Record<string, string> = {};\n\n  override layer: Layer;\n\n  public get hasLegend() {\n    return this.layerManager.isLayerWithLegend(this.layer) && this.layer.legend;\n  }\n\n  public get isLegendExpanded() {\n    if (this.layerManager.isLayerWithLegend(this.layer)) {\n      return this.layer.isLegendExpanded;\n    }\n    return false;\n  }\n\n  public toggleLegend() {\n    if (this.layerManager.isLayerWithLegend(this.layer)) {\n      this.layer.isLegendExpanded = !this.layer.isLegendExpanded;\n    }\n  }\n\n  constructor(layer: Layer) {\n    super(layer, 'treeviewitem');\n    this.layer = layer;\n  }\n\n  render() {\n    // If we come from a html element, the layer was not defined in the constructor\n    // And we have to set the layer using the id passed to the layerid attribute\n    const layerId = this.getAttribute('layerid');\n    if (layerId) {\n      this.layer = this.layerManager.getTreeItem(layerId) as Layer;\n      if (this.layer instanceof LayerWms) {\n        // Manage Legend icons for WMS\n        this.setWmsLegend();\n      }\n      if (this.layer instanceof LayerWmts) {\n        this.setWmtsLegend();\n      }\n    }\n    super.render();\n    this.createOpacityTooltip();\n    this.createFilterTooltip();\n  }\n\n  setWmsLegend() {\n    if (!(this.layer instanceof LayerWms)) {\n      // nothing to do if it's not a WMS\n      return;\n    }\n\n    // Manage Icon URL\n    if (this.layer.iconUrl) {\n      // A custom legend icon has been defined and can be displayed\n      this.iconUrl = this.layer.iconUrl;\n    } else if (this.layer.legendRule) {\n      // We need to get the legend icon URL from WMS\n      this.iconUrl = Object.values(this.getLegendImageUrlFromWms(true))[0];\n    } else {\n      // All other cases, we do not have any icon for the layer\n      // => A simple selection icon will be rendered\n      this.iconUrl = null;\n    }\n\n    // Manage Legend\n    if (this.layer.legend) {\n      if (this.layer.legendImage) {\n        this.legendUrls[this.layer.layers!] = this.layer.legendImage;\n      } else {\n        this.legendUrls = this.getLegendImageUrlFromWms(false);\n      }\n    }\n  }\n\n  setWmtsLegend() {\n    if (!(this.layer instanceof LayerWmts)) {\n      // nothing to do if it's not a WMS\n      return;\n    }\n\n    if (this.layer.legend) {\n      if (this.layer.legendImage) {\n        this.legendUrls[this.layer.name] = this.layer.legendImage;\n      } else {\n        console.error(`The WMTS Layer ${this.layer.name} has no legendImage.`);\n      }\n    }\n  }\n\n  getLegendImageUrlFromWms(iconOnly: boolean): Record<string, string> {\n    if (!(this.layer instanceof LayerWms)) {\n      throw new Error(`${this.layer.name} is not a WMS layer, this method should not be called.`);\n    }\n\n    const legends: Record<string, string> = {};\n    for (const l of this.layer.layers!.split(',')) {\n      const wmsSource = new ImageWMS({\n        url: this.layer.ogcServer.url,\n        params: { LAYERS: l },\n        ratio: 1\n      });\n\n      let graphicUrl = wmsSource.getLegendUrl(this.state.position.resolution);\n      if (!graphicUrl) {\n        console.error(`The URL for legend of layer ${l} could not be calculated.`);\n        legends[l] = '';\n        continue;\n      }\n\n      if (!graphicUrl.toLowerCase().includes('sld_version')) {\n        // Add SLD_Version (it is mandatory, but openlayers do not seems to set it in the URL)\n        graphicUrl += '&SLD_Version=1.1.0';\n      }\n\n      if (iconOnly) {\n        if (!this.isNullOrUndefined(this.layer.legendRule)) {\n          graphicUrl += '&RULE=' + encodeURIComponent(this.layer.legendRule!);\n        }\n        graphicUrl += '&HEIGHT=' + this.configManager.Config.treeview.defaultIconSize.height;\n        graphicUrl += '&WIDTH=' + this.configManager.Config.treeview.defaultIconSize.width;\n      }\n\n      legends[l] = graphicUrl;\n    }\n\n    return legends;\n  }\n\n  createOpacityTooltip() {\n    const el = this.shadow.getElementById('opacity');\n    tippy(el, {\n      trigger: 'click',\n      arrow: true,\n      interactive: true,\n      theme: 'light',\n      placement: 'bottom-end',\n      content: (_reference: object) => {\n        const slider = document.createElement('input');\n        slider.type = 'range';\n        slider.className = 'slider';\n        slider.min = '0';\n        slider.max = '20';\n        slider.value = (this.layer.opacity * 20).toString();\n        slider.oninput = () => (this.layer.opacity = parseInt(slider.value) / 20);\n        return slider;\n      }\n    });\n  }\n\n  createFilterTooltip() {\n    const el = this.shadow.getElementById('filter');\n    tippy(el, {\n      trigger: 'click',\n      arrow: true,\n      interactive: true,\n      theme: 'light',\n      placement: 'right',\n      appendTo: document.body,\n      content: (_reference: object) => {\n        const filterbox = new QueryBuilderComponent(this.layer as LayerWms);\n        return filterbox;\n      }\n    });\n  }\n\n  registerEvents() {\n    this.subscribe(/layers\\..*\\.isLegendExpanded/, (_oldValue: boolean, _newValue: boolean, layer: Layer) =>\n      this.refreshRender(layer)\n    );\n    this.subscribe(/layers\\.layersList\\..*\\.activeState/, (_oldValue: boolean, _newValue: boolean, layer: Layer) =>\n      this.refreshRender(layer)\n    );\n    this.subscribe(/layers\\.layersList\\..*\\.hasError/, (_oldValue: boolean, _newValue: boolean, layer: Layer) =>\n      this.refreshRender(layer)\n    );\n    this.subscribe(/layers\\.layersList\\..*\\.errorMessage/, (_oldValue: boolean, _newValue: boolean, layer: Layer) =>\n      this.refreshRender(layer)\n    );\n    this.subscribe(/layers\\.layersList\\..*\\.filter/, (_oldValue: boolean, _newValue: boolean, layer: Layer) =>\n      this.refreshRender(layer)\n    );\n    this.subscribe(/layers\\.layersList\\..*\\.opacity/, (_oldValue: boolean, _newValue: boolean, layer: Layer) =>\n      this.refreshRender(layer)\n    );\n    this.subscribe(/layers\\.layersList\\..*\\.swiped/, (_oldValue: boolean, _newValue: boolean, layer: Layer) =>\n      this.refreshRender(layer)\n    );\n    this.subscribe('treeview.advanced', () => this.refreshRender(this.layer));\n    this.subscribe('position.resolution', () => this.refreshLegends());\n  }\n\n  refreshLegends() {\n    if (this.layer instanceof LayerWms) {\n      this.setWmsLegend();\n    }\n    super.refreshRender();\n  }\n\n  toggle(state?: 'on' | 'off') {\n    this.layerManager.toggleLayer(this.layer, state);\n  }\n\n  getButtonClass(button: string) {\n    const buttonClasses = 'gg-button gg-small gg-opacity tool';\n    const activeButtonClasses = buttonClasses + ' active';\n    switch (button) {\n      case 'swipedLeft':\n        if (this.layer.active) {\n          return this.layer.swiped === 'left' ? activeButtonClasses : buttonClasses;\n        }\n        return 'hidden';\n      case 'swipedRight':\n        if (this.layer.active) {\n          return this.layer.swiped === 'right' ? activeButtonClasses : buttonClasses;\n        }\n        return 'hidden';\n      case 'opacity':\n        if (this.layer.active) {\n          return this.layer.opacity < 1 ? activeButtonClasses : buttonClasses;\n        }\n        return 'hidden';\n      case 'filter':\n        if (this.layer.active && this.layer instanceof LayerWms && this.layer.queryable) {\n          return this.layer.hasFilter ? activeButtonClasses : buttonClasses;\n        }\n        return 'hidden';\n      default:\n        throw Error('Unsupported type: ' + button);\n    }\n  }\n\n  zoomToVisibleResolution() {\n    if (!(this.layer instanceof LayerWms)) {\n      throw new Error(`${this.layer.name} is not a WMS layer, this method should not be called here.`);\n    }\n\n    // Because of rounding errors (for example 1.59 becomes 1.589999999999998),\n    // we zoom a bit more than just the max resolution.\n    // For the moment we try with 10% more\n    if (this.layer.maxResolution) {\n      const resolution = this.layer.maxResolution - (10 / 100) * this.layer.maxResolution;\n      this.state.position.resolution = resolution;\n    }\n  }\n\n  zoomToFullExtent() {\n    if (!(this.layer instanceof LayerLocalFile)) {\n      throw new Error(`${this.layer.name} is not a LocalFile layer, this method should not be called here.`);\n    }\n\n    MapManager.getInstance().zoomToExtent(this.layer.extent);\n  }\n\n  deleteLayer() {\n    this.layerManager.toggleLayer(this.layer, 'off');\n    setTimeout(() => {\n      const index = this.layer.parent!.children.findIndex((l) => l === this.layer);\n      this.layer.parent!.children.splice(index, 1);\n    });\n  }\n\n  connectedCallback() {\n    this.loadConfig().then(() => {\n      this.render();\n      this.registerEvents();\n    });\n  }\n}\n\nexport default TreeViewItemComponent;\n","import BaseLayer from '../../../models/layers/baselayer';\nimport GroupLayer from '../../../models/layers/grouplayer';\nimport ThemeLayer from '../../../models/layers/themelayer';\nimport GroupHelper from './grouphelper';\nimport TreeViewElement from './treeviewelement';\n\nexport default abstract class TreeViewGroupElement extends TreeViewElement {\n  override layer: GroupLayer | ThemeLayer;\n\n  constructor(layer: GroupLayer | ThemeLayer, name: string) {\n    super(layer, name);\n    this.layer = layer;\n  }\n\n  public sortedChildren() {\n    return GroupHelper.getSortedLayers(this.layer.children);\n  }\n\n  protected deactivateThemeOrGroup(layer: BaseLayer) {\n    layer.activeState = 'off';\n    if (layer instanceof ThemeLayer || layer instanceof GroupLayer) {\n      for (const child of layer.children) {\n        this.deactivateThemeOrGroup(child);\n      }\n    }\n  }\n\n  protected onChildrenListChanged(oldChildren: BaseLayer[], newChildren: BaseLayer[], theme: GroupLayer | ThemeLayer) {\n    this.refreshRender(theme);\n    // If we added a new group to the list of layers\n    // Then we activate the layers that should be activated by default\n    const addedLayers = newChildren.filter(\n      (newChild) => !oldChildren.find((oldChild) => oldChild.treeItemId === newChild.treeItemId)\n    );\n    GroupHelper.activateDefaultLayers(addedLayers);\n  }\n\n  public toggle(state?: 'on' | 'off' | 'semi') {\n    this.layerManager.toggleGroupOrTheme(this.layer, state);\n  }\n}\n","import BaseLayer from '../../../models/layers/baselayer';\nimport GroupLayer from '../../../models/layers/grouplayer';\nimport ThemeLayer from '../../../models/layers/themelayer';\nimport TreeViewGroupElement from '../tools/treeviewgroupelement';\n\nclass TreeViewGroupComponent extends TreeViewGroupElement {\n  templateUrl = './template.html';\n  styleUrls = ['../style.css', '../../../styles/common.css'];\n\n  override layer: GroupLayer;\n\n  constructor(group: GroupLayer) {\n    super(group, 'treeviewgroup');\n    this.layer = group;\n  }\n\n  render() {\n    // If we come from an  html element, the layer was not defined in the constructor\n    // And we have to set the layer using the id passed to the layerid attribute\n    const groupId = this.getAttribute('groupid');\n    if (groupId) {\n      this.layer = this.layerManager.getTreeItem(groupId) as GroupLayer;\n    }\n    super.render();\n  }\n\n  registerEvents() {\n    this.subscribe(/layers\\.layersList\\..*\\.isExpanded/, (_oldValue: boolean, _newValue: boolean, group: GroupLayer) =>\n      this.refreshRender(group)\n    );\n    this.subscribe(/layers\\.layersList\\..*\\.activeState/, (_oldValue: boolean, _newValue: boolean, group: GroupLayer) =>\n      this.refreshRender(group)\n    );\n    this.subscribe(\n      /layers\\.layersList\\..*\\.children/,\n      (oldChildren: BaseLayer[], newChildren: BaseLayer[], group: GroupLayer) =>\n        this.onChildrenListChanged(oldChildren, newChildren, group)\n    );\n    this.subscribe(/layers\\.layersList\\..*\\.order/, (_oldValue: boolean, _newValue: boolean, layer: ThemeLayer) => {\n      this.refreshRender(layer);\n      this.refreshRender(layer.parent);\n    });\n  }\n\n  connectedCallback() {\n    this.loadConfig().then(() => {\n      this.render();\n      super.girafeTranslate();\n      this.registerEvents();\n    });\n  }\n\n  deleteGroup() {\n    this.deactivateThemeOrGroup(this.layer);\n    setTimeout(() => {\n      if (this.layer.parent) {\n        const index = this.layer.parent.children.findIndex((l) => l === this.layer);\n        this.layer.parent.children.splice(index, 1);\n      }\n    });\n  }\n}\n\nexport default TreeViewGroupComponent;\n","import BaseLayer from '../../../models/layers/baselayer';\nimport ThemeLayer from '../../../models/layers/themelayer';\nimport TreeViewGroupElement from '../tools/treeviewgroupelement';\n// @ts-ignore This import is not used in the typescript file but needed in the HTML Template\n// Cannot use <ts-expect-error> here because after the build-lib, the error disappear\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport GroupLayer from '../../../models/layers/grouplayer';\n\nclass TreeViewThemeComponent extends TreeViewGroupElement {\n  templateUrl = './template.html';\n  styleUrls = ['../style.css', '../../../styles/common.css'];\n\n  override layer: ThemeLayer;\n\n  constructor(theme: ThemeLayer) {\n    super(theme, 'treeviewtheme');\n    this.layer = theme;\n  }\n\n  render() {\n    // If we come from an  html element, the layer was not defined in the constructor\n    // And we have to set the layer using the id passed to the layerid attribute\n    const themeId = this.getAttribute('themeid');\n    if (themeId) {\n      this.layer = this.layerManager.getTreeItem(themeId) as ThemeLayer;\n    }\n    super.render();\n  }\n\n  registerEvents() {\n    this.subscribe(/layers\\.layersList\\..*\\.isExpanded/, (_oldValue: boolean, _newValue: boolean, theme: ThemeLayer) =>\n      this.refreshRender(theme)\n    );\n    this.subscribe(/layers\\.layersList\\..*\\.activeState/, (_oldValue: boolean, _newValue: boolean, theme: ThemeLayer) =>\n      this.refreshRender(theme)\n    );\n    this.subscribe(\n      /layers\\.layersList\\..*\\.children/,\n      (oldChildren: BaseLayer[], newChildren: BaseLayer[], theme: ThemeLayer) =>\n        this.onChildrenListChanged(oldChildren, newChildren, theme)\n    );\n    this.subscribe(/layers\\.layersList\\..*\\.filter/, (_oldValue: boolean, _newValue: boolean, layer: ThemeLayer) =>\n      this.refreshRender(layer)\n    );\n    this.subscribe(/layers\\.layersList\\..*\\.order/, (_oldValue: boolean, _newValue: boolean, layer: ThemeLayer) => {\n      this.refreshRender(layer);\n      this.refreshRender(layer.parent);\n    });\n  }\n\n  connectedCallback() {\n    this.loadConfig().then(() => {\n      this.render();\n      super.girafeTranslate();\n      this.registerEvents();\n    });\n  }\n\n  deleteTheme() {\n    this.deactivateThemeOrGroup(this.layer);\n    setTimeout(() => {\n      const index = this.state.layers.layersList.findIndex((l) => l === this.layer);\n      this.state.layers.layersList.splice(index, 1);\n      this.state.themes.lastSelectedTheme = null;\n    });\n  }\n}\n\nexport default TreeViewThemeComponent;\n","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20576%20512'%3e%3c!--!Font%20Awesome%20Free%206.5.2%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202024%20Fonticons,%20Inc.--%3e%3cpath%20d='M0%20128C0%2092.7%2028.7%2064%2064%2064H320c35.3%200%2064%2028.7%2064%2064V384c0%2035.3-28.7%2064-64%2064H64c-35.3%200-64-28.7-64-64V128zM559.1%2099.8c10.4%205.6%2016.9%2016.4%2016.9%2028.2V384c0%2011.8-6.5%2022.6-16.9%2028.2s-23%205-32.9-1.6l-96-64L416%20337.1V320%20192%20174.9l14.2-9.5%2096-64c9.8-6.5%2022.4-7.2%2032.9-1.6z'/%3e%3c/svg%3e\"","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20384%20512'%3e%3c!--!Font%20Awesome%20Free%206.5.2%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202024%20Fonticons,%20Inc.--%3e%3cpath%20d='M0%20128C0%2092.7%2028.7%2064%2064%2064H320c35.3%200%2064%2028.7%2064%2064V384c0%2035.3-28.7%2064-64%2064H64c-35.3%200-64-28.7-64-64V128z'/%3e%3c/svg%3e\"","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20512%20512'%3e%3c!--!Font%20Awesome%20Free%206.5.2%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202024%20Fonticons,%20Inc.--%3e%3cpath%20d='M256%20464a208%20208%200%201%201%200-416%20208%20208%200%201%201%200%20416zM256%200a256%20256%200%201%200%200%20512A256%20256%200%201%200%20256%200zM376.9%20294.6c4.5-4.2%207.1-10.1%207.1-16.3c0-12.3-10-22.3-22.3-22.3H304V160c0-17.7-14.3-32-32-32l-32%200c-17.7%200-32%2014.3-32%2032v96H150.3C138%20256%20128%20266%20128%20278.3c0%206.2%202.6%2012.1%207.1%2016.3l107.1%2099.9c3.8%203.5%208.7%205.5%2013.8%205.5s10.1-2%2013.8-5.5l107.1-99.9z'/%3e%3c/svg%3e\"","import GirafeHTMLElement from '../../base/GirafeHTMLElement';\nimport { v4 as uuidv4 } from 'uuid';\nimport VideoIcon from './images/video.svg';\nimport StopIcon from './images/stop.svg';\nimport DownloadIcon from './images/download.svg';\n\nclass VideoRecordComponent extends GirafeHTMLElement {\n  templateUrl = './template.html';\n\n  public videoIcon: string = VideoIcon;\n  public stopIcon: string = StopIcon;\n  public downloadIcon: string = DownloadIcon;\n\n  status: 'downloaded' | 'recording' | 'recorded' = 'downloaded';\n  mediaRecorder: MediaRecorder | null = null;\n  chunks: Blob[] = [];\n  stream: MediaStream | null = null;\n\n  constructor() {\n    super('videorecord');\n  }\n\n  connectedCallback() {\n    this.loadConfig().then(() => {\n      super.render();\n      super.girafeTranslate();\n    });\n  }\n\n  async startRecording() {\n    this.status = 'recording';\n    super.render();\n\n    this.chunks = [];\n    if (this.mediaRecorder) {\n      // Try to start the recorder\n      try {\n        this.mediaRecorder.start();\n      } catch {\n        // If an exception is thrown, if probaly means that the screen share was stopped.\n        this.mediaRecorder = null;\n      }\n    }\n\n    if (!this.mediaRecorder) {\n      if (await this.initializeMediaRecorder()) {\n        this.mediaRecorder!.start();\n      }\n    }\n  }\n\n  async initializeMediaRecorder() {\n    try {\n      this.stream = await navigator.mediaDevices.getDisplayMedia({\n        video: {\n          width: { ideal: 1920 },\n          height: { ideal: 1080 },\n          frameRate: { ideal: 30 }\n        }\n      });\n      this.mediaRecorder = new MediaRecorder(this.stream, {\n        mimeType: 'video/webm; codecs:vp9',\n        bitsPerSecond: 5000000 // 5 Mbps\n      });\n      this.mediaRecorder.ondataavailable = (event) => {\n        if (event.data.size > 0) {\n          this.chunks.push(event.data);\n        }\n      };\n\n      return true;\n    } catch (exception) {\n      console.warn('Unable to activate recording : ' + exception);\n      this.status = 'downloaded';\n      super.render();\n    }\n\n    return false;\n  }\n\n  stopRecording() {\n    this.status = 'recorded';\n    super.render();\n    this.mediaRecorder?.stop();\n  }\n\n  downloadRecord() {\n    this.status = 'downloaded';\n    super.render();\n\n    // Create video blob\n    const blob = new Blob(this.chunks, { type: 'video/webm' });\n    const filename: string = uuidv4() + '.webm';\n    const videoURL = URL.createObjectURL(blob);\n\n    // Create download link\n    const downloadLink: HTMLAnchorElement = document.createElement('a');\n    downloadLink.style.display = 'none';\n    downloadLink.href = videoURL;\n    downloadLink.download = filename;\n\n    // Simulate click on download link\n    document.body.appendChild(downloadLink);\n    downloadLink.click();\n\n    // Clear\n    document.body.removeChild(downloadLink);\n    window.URL.revokeObjectURL(videoURL);\n  }\n}\n\nexport default VideoRecordComponent;\n","import proj4 from 'proj4';\nimport { register } from 'ol/proj/proj4';\nimport tippy from 'tippy.js';\nimport State from './tools/state/state';\n\nimport ConfigManager from './tools/configuration/configmanager';\nimport ErrorManager from './tools/error/errormanager';\nimport CsvManager from './tools/export/csvmanager';\nimport I18nManager from './tools/i18n/i18nmanager';\nimport LogManager from './tools/logging/logmanager';\nimport OfflineManager from './tools/offline/offlinemanager';\nimport ShareManager from './tools/share/sharemanager';\nimport StateManager from './tools/state/statemanager';\nimport ThemesManager from './tools/themesmanager';\nimport WfsManager from './tools/wfs/wfsmanager';\nimport OrderingManager from './tools/ordering/orderingmanager';\n\nimport AboutComponent from './components/about/component';\nimport BasemapComponent from './components/basemap/component';\nimport ColorSwitcherComponent from './components/colorswitcher/component';\nimport CoordinateComponent from './components/coordinate/component';\nimport GlobeComponent from './components/globe/component';\nimport HelpComponent from './components/help/component';\nimport MetadataWindowComponent from './components/metadatawindow/component';\nimport InfoboxComponent from './components/infobox/component';\nimport LanguageComponent from './components/language/component';\nimport LidarPanelComponent from './components/lidar/panel/component';\nimport LidarProfileComponent from './components/lidar/profile/component';\nimport LRPanelComponent from './components/lr-panel/component';\nimport MapComponent from './components/map/component';\nimport MenuButtonComponent from './components/menubutton/component';\nimport NavBookmarksComponent from './components/navigation/navbookmarks/component';\nimport NavHelperComponent from './components/navigation/navhelper/component';\nimport PrintComponent from './components/print/component';\nimport ProjectionComponent from './components/projection/component';\nimport PrototypeBannerComponent from './components/prototypebanner/component';\nimport QueryBuilderComponent from './components/querybuilder/component';\nimport DrawingComponent from './components/drawing/component';\nimport ScaleComponent from './components/scale/component';\nimport SearchComponent from './components/search/component';\nimport SelectionGridComponent from './components/selectiongrid/component';\nimport SelectionWindowComponent from './components/selectionwindow/component';\nimport ShareComponent from './components/share/component';\nimport ThemeComponent from './components/themes/component';\nimport TreeViewRootComponent from './components/treeview/treeviewroot/component';\nimport TreeViewItemComponent from './components/treeview/treeviewitem/component';\nimport TreeViewGroupComponent from './components/treeview/treeviewgroup/component';\nimport TreeViewThemeComponent from './components/treeview/treeviewtheme/component';\nimport VideoRecordComponent from './components/videorecord/component';\n\n// Redirect to mobile interface if we are on mobile\nif (navigator.userAgent.includes('iPhone') || navigator.userAgent.includes('Android')) {\n  window.location.href = 'mobile.html';\n}\n\n// Extend default Document and Window interfaces\ndeclare global {\n  interface Document {\n    geogirafe: {\n      state: State;\n      stateManager: StateManager;\n      shareManager: ShareManager;\n      offlineManager: OfflineManager;\n    };\n  }\n  interface Window {\n    CESIUM_BASE_URL: string;\n    Cesium: unknown;\n  }\n}\n\ntry {\n  // Default configuration for Cesium (see https://cesium.com/learn/cesiumjs-learn/cesiumjs-quickstart/)\n  window.CESIUM_BASE_URL = 'lib/cesium/';\n\n  // Register custom EPSG\n  // https://epsg.io/21781\n  proj4.defs(\n    'EPSG:21781',\n    '+proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +k_0=1 +x_0=600000 +y_0=200000 +ellps=bessel +towgs84=660.077,13.551,369.344,2.484,1.783,2.939,5.66 +units=m +no_defs'\n  );\n  // https://epsg.io/2056\n  proj4.defs(\n    'EPSG:2056',\n    '+proj=somerc +lat_0=46.9524055555556 +lon_0=7.43958333333333 +k_0=1 +x_0=2600000 +y_0=1200000 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +units=m +no_defs +type=crs'\n  );\n  register(proj4);\n\n  // Override default tooltip maxWidth:\n  tippy.setDefaultProps({ maxWidth: '' });\n\n  // Initialize the managers\n  ConfigManager.getInstance();\n  LogManager.getInstance()\n    .initLogging()\n    .then(() => {\n      ErrorManager.getInstance();\n      CsvManager.getInstance();\n      I18nManager.getInstance();\n      ThemesManager.getInstance();\n      WfsManager.getInstance();\n      OrderingManager.getInstance();\n\n      // Add the state to document, so that it will be accessible everywhere\n      document.geogirafe = {\n        state: StateManager.getInstance().state,\n        stateManager: StateManager.getInstance(),\n        shareManager: ShareManager.getInstance(),\n        offlineManager: OfflineManager.getInstance()\n      };\n\n      // Define components names\n      customElements.define('girafe-about', AboutComponent);\n      customElements.define('girafe-basemap', BasemapComponent);\n      customElements.define('girafe-colorswitcher', ColorSwitcherComponent);\n      customElements.define('girafe-coordinate', CoordinateComponent);\n      customElements.define('girafe-globe-select', GlobeComponent);\n      customElements.define('girafe-help', HelpComponent);\n      customElements.define('girafe-metadata-window', MetadataWindowComponent);\n      customElements.define('girafe-infobox', InfoboxComponent);\n      customElements.define('girafe-language-select', LanguageComponent);\n      customElements.define('girafe-lidar-panel', LidarPanelComponent);\n      customElements.define('girafe-lidar-profile', LidarProfileComponent);\n      customElements.define('girafe-lr-panel', LRPanelComponent);\n      customElements.define('girafe-map', MapComponent);\n      customElements.define('girafe-menu-button', MenuButtonComponent);\n      customElements.define('girafe-nav-bookmarks', NavBookmarksComponent);\n      customElements.define('girafe-nav-history', NavHelperComponent);\n      customElements.define('girafe-print', PrintComponent);\n      customElements.define('girafe-prototype-banner', PrototypeBannerComponent);\n      customElements.define('girafe-proj-select', ProjectionComponent);\n      customElements.define('girafe-query-builder', QueryBuilderComponent);\n      customElements.define('girafe-drawing', DrawingComponent);\n      customElements.define('girafe-scale', ScaleComponent);\n      customElements.define('girafe-search', SearchComponent);\n      customElements.define('girafe-selection-grid', SelectionGridComponent);\n      customElements.define('girafe-selection-window', SelectionWindowComponent);\n      customElements.define('girafe-share', ShareComponent);\n      customElements.define('girafe-theme-select', ThemeComponent);\n      customElements.define('girafe-tree-view', TreeViewRootComponent);\n      customElements.define('girafe-tree-view-group', TreeViewGroupComponent);\n      customElements.define('girafe-tree-view-item', TreeViewItemComponent);\n      customElements.define('girafe-tree-view-theme', TreeViewThemeComponent);\n      customElements.define('girafe-video-record', VideoRecordComponent);\n    });\n} finally {\n  // To prevent the FOUC effect (flash of unstyled content),\n  // the html element is set to invisible when the application starts.\n  // When all elements have been declared, the html element is made visible\n  document.documentElement.style.opacity = '1';\n}\n"],"names":["OrderingManager","GirafeSingleton","type","__publicField","StateManager","orderedLayers","counter","layer","GroupLayer","ThemeLayer","orderedChilds","layers","l1","l2","GirafeDraggableElement","GirafeHTMLElement","component","css","_this","e","hostRect","pos1","newLeft","newRight","pos2","newTop","newBottom","GirafeLogo","AboutComponent","uHtml","versionInfos","_oldValue","newValue","visible","BasemapComponent","basemap","uHtmlFor","ShareManager","basemaps","_oldBasemaps","newBasemaps","ColorSwitcherComponent","prefersDarkScheme","mode","otherMode","CoordinateComponent","__privateAdd","_locale","__privateGet","__privateSet","_oldCoordinates","newCoordinates","coord","niceCoordinates","Icon2D","Icon3D","IconSplit","IconGlobe","GlobeComponent","ArrowBlack","ArrowWhite","HelpComponent","MetadataWindowComponent","host","InfoboxComponent","info","el","LanguageIcon","LanguageComponent","language","key","LidarProfileConfig","pytreeLidarProfileJsonUrl","url","resp","data","error","attr","selectedMat","DrawEventType","DrawEvent","Event","feature","getTraceTargets","coordinate","features","targets","geometry","appendGeometryTraceTargets","getSquaredDistance","a","b","squaredDistance","getCoordinate","coordinates","index","count","getCumulativeSquaredDistance","startIndex","endIndex","lowIndex","highIndex","lowWholeIndex","highWholeIndex","start","interpolateCoordinate","end","sd","i","LineString","appendTraceTarget","MultiLineString","ii","Polygon","MultiPolygon","polys","j","jj","GeometryCollection","geometries","sharedUpdateInfo","getTraceTargetUpdate","traceState","map","snapTolerance","x","y","closestTargetDistance","newTargetIndex","newEndIndex","targetIndex","target","minSegmentDistance","coordinateIndex","rel","getPointSegmentRelationship","newTarget","considerBothDirections","newCoordinate","pixel","distance","forwardDistance","reverseDistance","ring","sharedRel","x1","y1","x2","y2","dx","dy","along","px","py","clamp","toFixed","x0","y0","Draw","PointerInteraction","options","pointerOptions","FALSE","getMode","TRUE","geometryFunction","projection","circle","Circle","center","fromUserCoordinate","squaredLength","squaredCoordinateDistance","Constructor","Point","VectorLayer","VectorSource","getDefaultStyleFunction","noModifierKeys","always","shiftKeyOnly","InteractionProperty","trace","condition","never","event","EventType","move","MapBrowserEventType","pass","MapBrowserEvent","lowerLeft","upperRight","extent","boundingExtent","previouslyForward","currentlyForward","fromIndex","toIndex","remove","updatedTraceTarget","oldTarget","tracing","startingToDraw","downPx","clickPx","at","potentiallyDone","potentiallyFinishCoordinates","sketchCoords","finishCoordinate","finishPixel","Feature","sketchLineGeom","stride","getStrideForLayout","last","done","n","sketchFeature","MultiPoint","newDrawing","ending","lineString","sketchFeatures","overlaySource","active","styles","createEditingStyle","resolution","createRegularPolygon","sides","angle","radius","fromCircle","internalAngle","makeRegular","createBox","boxCoordinates","getBottomLeft","getBottomRight","getTopRight","getTopLeft","DrawLine","state","olCollection","source","style","olStyleStyle","olStyleStroke","olInteractionDraw","line","_a","_b","getLidarProfileContainer","getLidarProfileCanvas","getLidarProfileSvg","getLidarProfileError","getLidarProfileLodInfo","getLidarProfileWidthInfo","LidarProfileUtils","linestring","dLeft","dRight","clippedLine","olGeomLineString","mileage_start","mileage_end","totalLength","fractionStart","fractionEnd","segNumber","segStart","segEnd","segLine","feat","olFeature","lineStyle","firstSegmentAngle","lastSegementAngle","segCounter","lineEnd","lineStart","olGeomPoint","olStyleRegularShape","olStyleFill","span","max_levels","maxLOD","width","level","max","profileClientConfig","profileSVG","d3select","w","h","margin","canvas","ctx","profileCanvasEl","exportImage","serializer","profileSVGEl","svgStr","img_id","buffer","Buffer","body","elImg","blob","I18nManager","saveAs","points","allPoints","pDistance","pAltitude","pColorPacked","pIntensity","pClassification","pCoords","p","point","row","value","array","minVal","element","coords","pytreeLineString","xs","ys","tolerance","sx","sy","classification_colors","tol","allDistances","hP","classification","closestPoint","minDist","indexMin","LidarProfilePlot","LidarProfileManagerInstance","nPoints","cx","cy","canvasEl","profileServerConfig","altitude","rgb","intensity","_c","rangeX","rangeY","container","containerEl","containerWidth","containerHeight","domainProfileWidth","domainProfileHeight","domainRatio","rangeProfileWidth","rangeProfileHeight","rangeRatio","domainScale","domainScaledWidth","d3scaleLinear","domainScaledHeight","domainHeightCentroid","zoom","d3zoom","svg","xAxis","d3axisBottom","yAxis","d3axisLeft","tr","newScaleX","newScaleY","xSelect","ySelect","lidarContainerElement","lidarInfo","pointSize","canvasCoordinates","d3pointer","pointClassification","html","lidarPointGeom","lidarPointFeature","olStyleCircle","classification_color","distDecimal","distanceTxt","altitudeTxt","classificationTxt","intensityTxt","num","decimals","material","LidarProfileMeasure","lidarProfileManagerInstance","svgEl","svgCoordinates","invertedSx","invertedSy","dH","dD","height","LidarProfileManager","debounce","olOverlay","olLayerVector","olSourceVector","config","distanceOffset","resetPlot","minLOD","pytreeLinestring","maxLODWith","domain","clipped","profileWidth","profileWidthTxt","initialLOD","iter","lodInfo","loadingLodTxt","pointCloudName","hurl","lodTxt","loadedTxt","err","profile","lidarError","headerSize","uInt8header","strHeaderLocal","header","errorTxt","jHeader","attributes","pointAttributes","att","scale","bytesPerPoint","profileDistance","profileClassification","profileIntensity","profileColorPacked","profileAltitude","profileCoords","byteOffset","view","aoffset","attribute","dist","classif","r","g","lx","ly","lz","z","errorInfoTxt","errorOfflineTxt","errorOutsideTxt","errorNoPointError","_d","domainX","clip","maxLODWidth","xTolerance","lidarProfileManager","LidarInterface","profileConfig","csvManager","classificationColors","pointAttributeName","pointAttribute","fileType","csvData","headerColumns","columnName","clientConfig","kml","KML","selectedPointAttribute","eraserSvgUrl","rotateSvgUrl","LidarPanelComponent","evt","CsvManager","MapManager","eventValue","lidarUrl","oldVal","newVal","GirafeResizableElement","docking","dock","minWidth","maxWidth","minHeight","maxHeight","newX","newY","newWidth","newHeight","closeSvg","LidarProfileComponent","StateToggleManager","togglePaths","stateManager","setPath","path","oneActive","result","oldValue","paths","LRPanelComponent","panel","elements","togglePath","CIRCLE_CENTER_INDEX","CIRCLE_CIRCUMFERENCE_INDEX","tempExtent","tempSegment","ModifyEventType","ModifyEvent","mapBrowserEvent","Modify","primaryAction","altKeyOnly","singleClick","RBush","Collection","VectorEventType","CollectionEventType","writer","segments","segment","s","ss","rBush","nodesToRemove","node","nodeToRemove","segmentData","lines","rings","polygons","k","kk","centerSegmentData","circumferenceSegmentData","featureSegments","createExtent","circleGeometry","vertexFeature","handled","vertex","dragSegment","depth","coordinateDistance","pixelCoordinate","insertVertices","vertexExtent","segmentDataMatches","componentSegments","compareIndexes","segmentDataMatch","uid","getUid","closestVertex","closestOnSegmentData","coordinatesEqual","sortByDistance","projectedDistanceToSegmentDataSquared","nodes","hitPointGeometry","layerFilter","toUserCoordinate","geom","viewExtent","fromUserExtent","box","toUserExtent","bufferExtent","closestSegment","vertexPixel","vertexSegments","pixel1","pixel2","squaredDist1","squaredDist2","geometryUid","rTree","newSegmentData","newSegmentData2","removed","dragSegments","segmentsByFeature","deleted","left","newIndex","right","delta","equals","pointCoordinates","distanceToCenterSquared","distanceToCircumference","squaredDistanceToSegment","closestOnSegment","SnapEventType","SnapEvent","getFeatureFromEvent","Snap","register","feature_uid","segmenter","createEmpty","extents","segmentsData","listen","featuresToUpdate","unlisten","unregister","unlistenByKey","currentMap","keys","projectedCoordinate","segmentsLength","minSquaredDistance","closestFeature","squaredPixelTolerance","getResult","tempVertexCoord","closestOnCircle","segmentStart","segmentEnd","MenuButtonComponent","assignedNodes","buttons","button","closeParent","parentMenuButton","_Bookmark","name","position","Bookmark","NavBookmarksComponent","parent","bookmark","IconAdd","IconBookmark","IconNext","IconPrevious","IconTrash","NavHelperComponent","_tooltip","_positionHistory","_currentPositionIndex","_selfNavigation","tippy","_reference","storedBookmarks","jsonBookmarks","MapPosition","_oldPosition","newPosition","__privateWrapper","isLayerVisible","printResolution","LegendHelper","layerName","queryString","legendRule","legendWidth","legendHeight","serverType","dpi","bbox","srs","additionalQueryString","appendParams","olayer","legendURL","MFPLegendEncoder","legend","groupClasses","item","LayerWms","LayerWmts","layerGroup","legendGroupItem","childLayer","child","layerWmts","icon_dpi","GeoConsts","layerWms","ogcServers","ogcServer","legendLayerClasses","_e","_f","firstLegendLayer","_g","legendItem","found_dpi","legendImage","hiDPILegendImages","str_dpi","new_dpi","new_dist","label","classes","classItem","MFPEncoder","mapManager","rotation","toDegrees","allLayers","mfpLayers","treeLayers","baseMap","baseLayers","resultLayers","customizer","olayerA","olayerB","indexA","MFPVectorEncoder","spec","url_url","customParams","getAbsoluteUrl","oLayer","dimensionParams","dimensions","getWmtsUrl","getWmtsMatrices","printLayers","unByKeyAll","eventKeys","eventKey","unByKey","getOlayerByName","removeUnwantedOlParams","keepGeom","properties","polygonFromCircle","PrintManager","BaseCustomizer","printUrl","requestReportMFP","ref","cancelPrintMFP","requestReport","response","interval","timeout","getDownloadUrlMFP","pageSize","getPrintExtentMFP","selectedFeatures","i18nManager","datasources","featureExtent","intersects","id","rawTitle","title","datasource","values","column","PrintMaskLayer","Layer","createCanvasContext2D","size","scaleFn","frameState","cwidth","cheight","extentHalfWidth","extentHalfHeight","toRadians","diagonal","gamma","omega","x3","y3","x4","y4","PRINT_MASK_LAYER_NAME","_PrintMaskManager","scales","v1","v2","mapSize","printMapSize","viewResolution","optimalScale","isLayerInMap","mapResolution","mapScales","mapWidth","mapHeight","scaleWidth","scaleHeight","optimal","currentScale","dotsPerMeter","resolutionX","resolutionY","PrintMaskManager","PrintComponent","layout","format","attrName","printItem","clientInfo","attributeName","status","baseClasses","customAttributes","itemId","itemIndex","_oldVal","scaleElement","rotationInputElement","mapRotationValue","slider","number","capabilities","printLayouts","selectedLayout","printFormats","defaultFormat","validFormat","availableLayouts","configLayouts","layoutName","currentDpi","layoutAttributes","layoutAttr","mapAttribute","input","attributeObj","date","time","padNumber","downloadUrl","configFormats","availableFormats","layouts","availableScales","availableScale","ProjIcon","ProjectionComponent","code","text","PrototypeBannerComponent","WfsFilter","property","operator","propertyType","isStringNumeric","like","equalTo","not","notEqualTo","greaterThan","greaterThanOrEqualTo","lessThan","lessThanOrEqualTo","isNull","wildCard","c","QueryBuilderComponent","WfsManager","serverWfs","queryLayers","stackedLayerAttributes","layerAttributesCount","la","commonAttributesNames","commonAttributes","xmlStringTypesStrList","xmlNumberTypesStrList","attributeSelect","layerAttribute","operatorSelect","valueInput","val","ShapeNamer","suffix","adjectives","DrawingShape","DrawingShape2","DrawingState","DrawingFeature","tool","geojson","uuidv4","defaultConfig","ConfigManager","v","length","area","serializedFeature","newFeature","nbEdges","positions","getLength","getArea","polygon","getHalfPoint","fixLastLength","lastLine","OlDrawing","_oldTool","newTool","l","f","toRemove","geoJson","disk","GeoJSON","CircleGeom","proj","geomFunction","olTool","shape","measureFont","nameFont","defaultStyle","Style","Stroke","Fill","Text","labelStyle","RegularShape","addLabel","radiusLine","radiusLineStyle","rect","segment1","segment2","square","CLAMP_TO_GROUND","Cesium.HeightReference","getPosition","carto","Cartographic","cartoDegree","Cesium.Math","proj4","EllipsoidGeodesic","createLabel","font","offset","fill","Cartesian2","Color","createPoint","color","getPolygonCenter","Cartesian3","p1","p2","getPolyLineLabels","pos","_","Entity","getPolygonArea","getPolyline","CallbackProperty","getPolygonEntity","PolygonHierarchy","CesiumDrawing","Cesium.ScreenSpaceEventHandler","ScreenSpaceEventType","ray","newCesiumEntityPoints","newCesiumEntities","Cesium.Ellipsoid","Cesium.JulianDate","centerCoord","entitiesCollection","Cesium.EntityCollection","Cesium.exportKml","res","olFeatures","factor","pointCarto","earthPosition","localZ","localX","pos1Carto","pos2Carto","pos3Carto","pos4Carto","firstPosition","centerToMouse","localY","posX","posY","strokeColor","pointLoop","vertices","trashIcon","locateIcon","visibleIcon","notVisibleIcon","createDiv","className","content","onclick","DrawingComponent","MapComponent","olds","news","set","get","picker","Picker","update","serializedFeatures","oldFeatures","newFeatures","newIds","oldIds","added","oldProj","newProj","download","GPX","ScaleComponent","scaleToFormat","FeatureToGridDataById","gridDataById","gridData","featureType","notOlProperties","emptyColumnIndexes","_column","_val","notEmptyColumnIndexes","emptyIndex","indexToRemove","idx","emptyColumnIndex","splitId","IconCenter$1","FormatGridGeomValue","IconCenter","locale","icons","niceCoords","getCenter","geoLength","SelectionTabulatorManager","htmlElement","columns","tabHeader","visibleTabHeader","Tabulator","dir","columnDefinition","cell","entry","OlGeomGeometry","SelectionGridComponent","th","replaceData","_oldFeatures","tabIds","ResizeWindow","shadow","direction","dimension","dragEvent","clientX","clientY","deltaX","deltaY","rawNewHeight","minMax","rawNewWidth","SelectionWindowComponent","keyValue","windowFeature","DOMPurify","getValidIndex","windowFeatures","TwitterLogo","FacebookLogo","LinkedInLogo","MailLogo","LstuManager","serviceUrl","longUrl","params","errorResponse","response_data","GmfManager","ShareComponent","base","hash","longurl","subject","NewIcon","CustomIcon","CustomTheme","StateSerializer","theme","CustomThemesManager","themeName","layersList","layerBase","serializedobject","customTheme","localThemes","serializedCustomThemes","customThemeName","layerTree","StateDeserializer","ThemeComponent","themelayer","GroupHelper","LayerManager","TreeViewRootComponent","oldLayers","newLayers","addedLayers","newLayer","oldLayer","DragHelper","dragged","dropped","adjustOrder","increment","layersToReorder","minOrder","childOrder","draggedOrder","maxOrder","DragManager","TreeViewElement","_event","TreeViewItemComponent","LayerLocalFile","layerId","iconOnly","legends","graphicUrl","ImageWMS","_newValue","buttonClasses","activeButtonClasses","TreeViewGroupElement","oldChildren","newChildren","newChild","oldChild","TreeViewGroupComponent","group","groupId","TreeViewThemeComponent","themeId","VideoIcon","StopIcon","DownloadIcon","VideoRecordComponent","exception","filename","videoURL","downloadLink","LogManager","ErrorManager","ThemesManager","OfflineManager","SearchComponent"],"mappings":"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","x_google_ignoreList":[20,36,37,38]}