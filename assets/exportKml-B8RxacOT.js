import{ag as f,ao as N,aj as h,j as Z,bb as Gt,E as ai,af as Q,e as b,cP as is,dZ as Ba,cm as Ws,l as ae,aY as wc,bs as yt,ai as Xi,ah as Mt,bW as Ut,aK as ns,an as et,aL as xc,av as Cc,aq as Sc,k as Ec,aT as bs,aU as Ft,J as B,n as Y,bI as qi,bi as ho,cC as uo,ax as le,aw as li,d_ as Ua,eu as qs,m as Nn,bM as ri,br as ht,ap as fo,ak as qt,bP as Zt,cE as ci,cF as xe,cG as Yt,bR as bc,aW as oo,bN as Ue,bq as mt,cv as Dc,bZ as Ds,dN as Tc,bp as Hi,bt as wt,bm as Pe,b_ as At,b9 as Ic,am as Gs,ar as vc,bL as pi,aI as Va,dI as Ha,gq as Ac,bK as Ys,dJ as Oc,cB as Pc,ay as os,eh as Wa,P as Rc,bu as Ts,H as si,bV as Nc,b5 as Lc,bE as Eo,bF as bo,aG as Mc}from"./initialize-6doIkexO.js";let ss;typeof performance<"u"&&typeof performance.now=="function"&&isFinite(performance.now())?ss=function(){return performance.now()}:ss=function(){return Date.now()};const qa=ss;function Is(){this._removalFunctions=[]}Is.prototype.add=function(e,t,i){if(!f(e))throw new N("event is required");const n=e.addEventListener(t,i);this._removalFunctions.push(n);const o=this;return function(){n();const s=o._removalFunctions;s.splice(s.indexOf(n),1)}};Is.prototype.removeAll=function(){const e=this._removalFunctions;for(let t=0,i=e.length;t<i;++t)e[t]();e.length=0};const kc={NONE:0,HOLD:1,EXTRAPOLATE:2},Gi=Object.freeze(kc);function Ot(e){if(e=h(e,h.EMPTY_OBJECT),!f(e.componentDatatype))throw new N("options.componentDatatype is required.");if(!f(e.componentsPerAttribute))throw new N("options.componentsPerAttribute is required.");if(e.componentsPerAttribute<1||e.componentsPerAttribute>4)throw new N("options.componentsPerAttribute must be between 1 and 4.");if(!f(e.value))throw new N("options.value is required.");this.componentDatatype=e.componentDatatype,this.componentsPerAttribute=e.componentsPerAttribute,this.normalize=h(e.normalize,!1),this.value=e.value}const vs=[Cc,Sc],Fc=vs.length,Ga=Math.cos(Z.toRadians(30)),js=Math.cos(Z.toRadians(150)),Ya=0,ja=1e3;function di(e){e=h(e,h.EMPTY_OBJECT);const t=e.positions;if(!f(t)||t.length<2)throw new N("At least two positions are required.");if(f(e.arcType)&&e.arcType!==Gt.GEODESIC&&e.arcType!==Gt.RHUMB)throw new N("Valid options for arcType are ArcType.GEODESIC and ArcType.RHUMB.");this.width=h(e.width,1),this._positions=t,this.granularity=h(e.granularity,9999),this.loop=h(e.loop,!1),this.arcType=h(e.arcType,Gt.GEODESIC),this._ellipsoid=ai.default,this._projectionIndex=0,this._workerName="createGroundPolylineGeometry",this._scene3DOnly=!1}Object.defineProperties(di.prototype,{packedLength:{get:function(){return 1+this._positions.length*3+1+1+1+ai.packedLength+1+1}}});di.setProjectionAndEllipsoid=function(e,t){let i=0;for(let n=0;n<Fc;n++)if(t instanceof vs[n]){i=n;break}e._projectionIndex=i,e._ellipsoid=t.ellipsoid};const zc=new b,Xs=new b,Zs=new b;function rs(e,t,i,n,o){const s=Ve(n,e,0,zc),r=Ve(n,e,i,Xs),l=Ve(n,t,0,Zs),a=Kt(r,s,Xs),c=Kt(l,s,Zs);return b.cross(c,a,o),b.normalize(o,o)}const Bc=new ae,Uc=new b,Vc=new b,Hc=new b;function Do(e,t,i,n,o,s,r,l,a,c,d){if(o===0)return;let m;s===Gt.GEODESIC?m=new Ec(e,t,r):s===Gt.RHUMB&&(m=new Ba(e,t,r));const g=m.surfaceDistance;if(g<o)return;const y=rs(e,t,n,r,Hc),w=Math.ceil(g/o),p=g/w;let u=p;const _=w-1;let x=l.length;for(let S=0;S<_;S++){const I=m.interpolateUsingSurfaceDistance(u,Bc),D=Ve(r,I,i,Uc),E=Ve(r,I,n,Vc);b.pack(y,l,x),b.pack(D,a,x),b.pack(E,c,x),d.push(I.latitude),d.push(I.longitude),x+=3,u+=p}}const To=new ae;function Ve(e,t,i,n){return ae.clone(t,To),To.height=i,ae.toCartesian(To,e,n)}di.pack=function(e,t,i){Q.typeOf.object("value",e),Q.defined("array",t);let n=h(i,0);const o=e._positions,s=o.length;t[n++]=s;for(let r=0;r<s;++r){const l=o[r];b.pack(l,t,n),n+=3}return t[n++]=e.granularity,t[n++]=e.loop?1:0,t[n++]=e.arcType,ai.pack(e._ellipsoid,t,n),n+=ai.packedLength,t[n++]=e._projectionIndex,t[n++]=e._scene3DOnly?1:0,t};di.unpack=function(e,t,i){Q.defined("array",e);let n=h(t,0);const o=e[n++],s=new Array(o);for(let g=0;g<o;g++)s[g]=b.unpack(e,n),n+=3;const r=e[n++],l=e[n++]===1,a=e[n++],c=ai.unpack(e,n);n+=ai.packedLength;const d=e[n++],m=e[n++]===1;return f(i)||(i=new di({positions:s})),i._positions=s,i.granularity=r,i.loop=l,i.arcType=a,i._ellipsoid=c,i._projectionIndex=d,i._scene3DOnly=m,i};function Kt(e,t,i){return b.subtract(e,t,i),b.normalize(i,i),i}function Ks(e,t,i,n){return n=Kt(e,t,n),n=b.cross(n,i,n),n=b.normalize(n,n),n=b.cross(i,n,n),n}const Wc=new b,qc=new b,Gc=new b,Xa=new b,Yc=0,jc=-1;function Io(e,t,i,n,o){const s=Kt(i,t,Xa),r=Ks(e,t,s,Wc),l=Ks(n,t,s,qc);if(Z.equalsEpsilon(b.dot(r,l),jc,Z.EPSILON5))return o=b.cross(s,r,o),o=b.normalize(o,o),o;o=b.add(l,r,o),o=b.normalize(o,o);const a=b.cross(s,o,Gc);return b.dot(l,a)<Yc&&(o=b.negate(o,o)),o}const so=is.fromPointNormal(b.ZERO,b.UNIT_Y),Xc=new b,Zc=new b,Kc=new b,$c=new b,Jc=new b,Bn=new b,Un=new ae,$s=new ae,Js=new ae;di.createGeometry=function(e){const t=!e._scene3DOnly;let i=e.loop;const n=e._ellipsoid,o=e.granularity,s=e.arcType,r=new vs[e._projectionIndex](n),l=Ya,a=ja;let c,d;const m=e._positions,g=m.length;g===2&&(i=!1);let y,w,p,u;const _=new Ba(void 0,void 0,n);let x,S,I;const D=[m[0]];for(d=0;d<g-1;d++)y=m[d],w=m[d+1],x=Ws.lineSegmentPlane(y,w,so,Bn),f(x)&&!b.equalsEpsilon(x,y,Z.EPSILON7)&&!b.equalsEpsilon(x,w,Z.EPSILON7)&&(e.arcType===Gt.GEODESIC?D.push(b.clone(x)):e.arcType===Gt.RHUMB&&(I=n.cartesianToCartographic(x,Un).longitude,p=n.cartesianToCartographic(y,Un),u=n.cartesianToCartographic(w,$s),_.setEndPoints(p,u),S=_.findIntersectionWithLongitude(I,Js),x=n.cartographicToCartesian(S,Bn),f(x)&&!b.equalsEpsilon(x,y,Z.EPSILON7)&&!b.equalsEpsilon(x,w,Z.EPSILON7)&&D.push(b.clone(x)))),D.push(w);i&&(y=m[g-1],w=m[0],x=Ws.lineSegmentPlane(y,w,so,Bn),f(x)&&!b.equalsEpsilon(x,y,Z.EPSILON7)&&!b.equalsEpsilon(x,w,Z.EPSILON7)&&(e.arcType===Gt.GEODESIC?D.push(b.clone(x)):e.arcType===Gt.RHUMB&&(I=n.cartesianToCartographic(x,Un).longitude,p=n.cartesianToCartographic(y,Un),u=n.cartesianToCartographic(w,$s),_.setEndPoints(p,u),S=_.findIntersectionWithLongitude(I,Js),x=n.cartographicToCartesian(S,Bn),f(x)&&!b.equalsEpsilon(x,y,Z.EPSILON7)&&!b.equalsEpsilon(x,w,Z.EPSILON7)&&D.push(b.clone(x)))));let E=D.length,T=new Array(E);for(d=0;d<E;d++){const $=ae.fromCartesian(D[d],n);$.height=0,T[d]=$}if(T=wc(T,ae.equalsEpsilon),E=T.length,E<2)return;const v=[],A=[],R=[],O=[];let U=Xc,F=Zc,W=Kc,q=$c,k=Jc;const V=T[0],j=T[1],fe=T[E-1];for(U=Ve(n,fe,l,U),q=Ve(n,j,l,q),F=Ve(n,V,l,F),W=Ve(n,V,a,W),i?k=Io(U,F,W,q,k):k=rs(V,j,a,n,k),b.pack(k,A,0),b.pack(F,R,0),b.pack(W,O,0),v.push(V.latitude),v.push(V.longitude),Do(V,j,l,a,o,s,n,A,R,O,v),d=1;d<E-1;++d){U=b.clone(F,U),F=b.clone(q,F);const $=T[d];Ve(n,$,a,W),Ve(n,T[d+1],l,q),Io(U,F,W,q,k),c=A.length,b.pack(k,A,c),b.pack(F,R,c),b.pack(W,O,c),v.push($.latitude),v.push($.longitude),Do(T[d],T[d+1],l,a,o,s,n,A,R,O,v)}const G=T[E-1],ue=T[E-2];if(F=Ve(n,G,l,F),W=Ve(n,G,a,W),i){const $=T[0];U=Ve(n,ue,l,U),q=Ve(n,$,l,q),k=Io(U,F,W,q,k)}else k=rs(ue,G,a,n,k);if(c=A.length,b.pack(k,A,c),b.pack(F,R,c),b.pack(W,O,c),v.push(G.latitude),v.push(G.longitude),i){for(Do(G,V,l,a,o,s,n,A,R,O,v),c=A.length,d=0;d<3;++d)A[c+d]=A[d],R[c+d]=R[d],O[c+d]=O[d];v.push(V.latitude),v.push(V.longitude)}return bd(i,r,R,O,A,v,t)};const Qc=new b,ed=new Ft,td=new bs;function Qs(e,t,i,n){const o=Kt(i,t,Qc),s=b.dot(o,e);if(s>Ga||s<js){const r=Kt(n,i,Xa),l=s<js?Z.PI_OVER_TWO:-Z.PI_OVER_TWO,a=bs.fromAxisAngle(r,l,td),c=Ft.fromQuaternion(a,ed);return Ft.multiplyByVector(c,e,e),!0}return!1}const er=new ae,id=new b,tr=new b;function dn(e,t,i,n,o){const s=ae.toCartesian(t,e._ellipsoid,id);let r=b.add(s,i,tr),l=!1;const a=e._ellipsoid;let c=a.cartesianToCartographic(r,er);Math.abs(t.longitude-c.longitude)>Z.PI_OVER_TWO&&(l=!0,r=b.subtract(s,i,tr),c=a.cartesianToCartographic(r,er)),c.height=0;const d=e.project(c,o);return o=b.subtract(d,n,o),o.z=0,o=b.normalize(o,o),l&&b.negate(o,o),o}const nd=new b,ir=new b;function nr(e,t,i,n,o,s){const r=b.subtract(t,e,nd);b.normalize(r,r);const l=i-Ya;let a=b.multiplyByScalar(r,l,ir);b.add(e,a,o);const c=n-ja;a=b.multiplyByScalar(r,c,ir),b.add(t,a,s)}const od=new b;function Vn(e,t){const i=is.getPointDistance(so,e),n=is.getPointDistance(so,t);let o=od;Z.equalsEpsilon(i,0,Z.EPSILON2)?(o=Kt(t,e,o),b.multiplyByScalar(o,Z.EPSILON2,o),b.add(e,o,e)):Z.equalsEpsilon(n,0,Z.EPSILON2)&&(o=Kt(e,t,o),b.multiplyByScalar(o,Z.EPSILON2,o),b.add(t,o,t))}function sd(e,t){const i=Math.abs(e.longitude),n=Math.abs(t.longitude);if(Z.equalsEpsilon(i,Z.PI,Z.EPSILON11)){const o=Z.sign(t.longitude);return e.longitude=o*(i-Z.EPSILON11),1}else if(Z.equalsEpsilon(n,Z.PI,Z.EPSILON11)){const o=Z.sign(e.longitude);return t.longitude=o*(n-Z.EPSILON11),2}return 0}const Za=new ae,Ka=new ae,or=new b,vo=new b,sr=new b,rr=new b,rd=new b,ar=new b,ad=[Za,Ka],ld=new Mt,cd=new b,dd=new b,hd=new b,ud=new b,fd=new b,pd=new b,Ao=new b,Oo=new b,_d=new b,md=new b,gd=new b,lr=new b,yd=new b,wd=new b,xd=new yt,Cd=new yt,cr=new b,Sd=new b,dr=new b,Ed=[new Xi,new Xi],$a=[0,2,1,0,3,2,0,7,3,0,4,7,0,5,4,0,1,5,5,7,4,5,6,7,5,2,6,5,1,2,3,6,2,3,7,6],hr=$a.length;function bd(e,t,i,n,o,s,r){let l,a;const c=t._ellipsoid,d=i.length/3-1,m=d*8,g=m*4,y=d*36,w=m>65535?new Uint32Array(y):new Uint16Array(y),p=new Float64Array(m*3),u=new Float32Array(g),_=new Float32Array(g),x=new Float32Array(g),S=new Float32Array(g),I=new Float32Array(g);let D,E,T,v;r&&(D=new Float32Array(g),E=new Float32Array(g),T=new Float32Array(g),v=new Float32Array(m*2));const A=s.length/2;let R=0;const O=Za;O.height=0;const U=Ka;U.height=0;let F=or,W=vo;if(r)for(a=0,l=1;l<A;l++)O.latitude=s[a],O.longitude=s[a+1],U.latitude=s[a+2],U.longitude=s[a+3],F=t.project(O,F),W=t.project(U,W),R+=b.distance(F,W),a+=2;const q=n.length/3;W=b.unpack(n,0,W);let k=0;for(a=3,l=1;l<q;l++)F=b.clone(W,F),W=b.unpack(n,a,W),k+=b.distance(F,W),a+=3;let V;a=3;let j=0,fe=0,G=0,ue=0,$=!1,ie=b.unpack(i,0,rr),ve=b.unpack(n,0,vo),he=b.unpack(o,0,ar);if(e){const Oe=b.unpack(i,i.length-6,sr);Qs(he,Oe,ie,ve)&&(he=b.negate(he,he))}let _e=0,Et=0,nt=0;for(l=0;l<d;l++){const Oe=b.clone(ie,sr),Nt=b.clone(ve,or);let ce=b.clone(he,rd);$&&(ce=b.negate(ce,ce)),ie=b.unpack(i,a,rr),ve=b.unpack(n,a,vo),he=b.unpack(o,a,ar),$=Qs(he,Oe,ie,ve),O.latitude=s[j],O.longitude=s[j+1],U.latitude=s[j+2],U.longitude=s[j+3];let pe,Fe,be,Se;if(r){const Ee=sd(O,U);pe=t.project(O,fd),Fe=t.project(U,pd);const zi=Kt(Fe,pe,cr);zi.y=Math.abs(zi.y),be=Ao,Se=Oo,Ee===0||b.dot(zi,b.UNIT_Y)>Ga?(be=dn(t,O,ce,pe,Ao),Se=dn(t,U,he,Fe,Oo)):Ee===1?(Se=dn(t,U,he,Fe,Oo),be.x=0,be.y=Z.sign(O.longitude-Math.abs(U.longitude)),be.z=0):(be=dn(t,O,ce,pe,Ao),Se.x=0,Se.y=Z.sign(O.longitude-U.longitude),Se.z=0)}const ot=b.distance(Nt,ve),st=yt.fromCartesian(Oe,xd),ze=b.subtract(ie,Oe,_d),Li=b.normalize(ze,lr);let Wt=b.subtract(Nt,Oe,md);Wt=b.normalize(Wt,Wt);let rt=b.cross(Li,Wt,lr);rt=b.normalize(rt,rt);let Mi=b.cross(Wt,ce,yd);Mi=b.normalize(Mi,Mi);let at=b.subtract(ve,ie,gd);at=b.normalize(at,at);let Jt=b.cross(he,at,wd);Jt=b.normalize(Jt,Jt);const So=ot/k,Fn=_e/k;let en=0,yi,ki,P,z=0,L=0;if(r){en=b.distance(pe,Fe),yi=yt.fromCartesian(pe,Cd),ki=b.subtract(Fe,pe,cr),P=b.normalize(ki,Sd);const Ee=P.x;P.x=P.y,P.y=-Ee,z=en/R,L=Et/R}for(V=0;V<8;V++){const Ee=ue+V*4,zi=fe+V*2,tn=Ee+3,Hs=V<4?1:-1,zn=V===2||V===3||V===6||V===7?1:-1;b.pack(st.high,u,Ee),u[tn]=ze.x,b.pack(st.low,_,Ee),_[tn]=ze.y,b.pack(Mi,x,Ee),x[tn]=ze.z,b.pack(Jt,S,Ee),S[tn]=So*Hs,b.pack(rt,I,Ee);let xi=Fn*zn;xi===0&&zn<0&&(xi=9),I[tn]=xi,r&&(D[Ee]=yi.high.x,D[Ee+1]=yi.high.y,D[Ee+2]=yi.low.x,D[Ee+3]=yi.low.y,T[Ee]=-be.y,T[Ee+1]=be.x,T[Ee+2]=Se.y,T[Ee+3]=-Se.x,E[Ee]=ki.x,E[Ee+1]=ki.y,E[Ee+2]=P.x,E[Ee+3]=P.y,v[zi]=z*Hs,xi=L*zn,xi===0&&zn<0&&(xi=9),v[zi+1]=xi)}const M=hd,H=ud,K=cd,ee=dd,Ne=Mt.fromCartographicArray(ad,ld),je=Ut.getMinimumMaximumHeights(Ne,c),wi=je.minimumTerrainHeight,Fi=je.maximumTerrainHeight;nt+=Math.abs(wi),nt+=Math.abs(Fi),nr(Oe,Nt,wi,Fi,M,K),nr(ie,ve,wi,Fi,H,ee);let pt=b.multiplyByScalar(rt,Z.EPSILON5,dr);b.add(M,pt,M),b.add(H,pt,H),b.add(K,pt,K),b.add(ee,pt,ee),Vn(M,H),Vn(K,ee),b.pack(M,p,G),b.pack(H,p,G+3),b.pack(ee,p,G+6),b.pack(K,p,G+9),pt=b.multiplyByScalar(rt,-2*Z.EPSILON5,dr),b.add(M,pt,M),b.add(H,pt,H),b.add(K,pt,K),b.add(ee,pt,ee),Vn(M,H),Vn(K,ee),b.pack(M,p,G+12),b.pack(H,p,G+15),b.pack(ee,p,G+18),b.pack(K,p,G+21),j+=2,a+=3,fe+=16,G+=24,ue+=32,_e+=ot,Et+=en}a=0;let bt=0;for(l=0;l<d;l++){for(V=0;V<hr;V++)w[a+V]=$a[V]+bt;bt+=8,a+=hr}const Ye=Ed;Xi.fromVertices(i,b.ZERO,3,Ye[0]),Xi.fromVertices(n,b.ZERO,3,Ye[1]);const Rt=Xi.fromBoundingSpheres(Ye);Rt.radius+=nt/(d*2);const Re={position:new ns({componentDatatype:et.DOUBLE,componentsPerAttribute:3,normalize:!1,values:p}),startHiAndForwardOffsetX:Qt(u),startLoAndForwardOffsetY:Qt(_),startNormalAndForwardOffsetZ:Qt(x),endNormalAndTextureCoordinateNormalizationX:Qt(S),rightNormalAndTextureCoordinateNormalizationY:Qt(I)};return r&&(Re.startHiLo2D=Qt(D),Re.offsetAndRight2D=Qt(E),Re.startEndNormals2D=Qt(T),Re.texcoordNormalization2D=new ns({componentDatatype:et.FLOAT,componentsPerAttribute:2,normalize:!1,values:v})),new xc({attributes:Re,indices:w,boundingSphere:Rt})}function Qt(e){return new ns({componentDatatype:et.FLOAT,componentsPerAttribute:4,normalize:!1,values:e})}di._projectNormal=dn;function J(e){e=h(e,h.EMPTY_OBJECT),this.start=f(e.start)?B.clone(e.start):new B,this.stop=f(e.stop)?B.clone(e.stop):new B,this.data=e.data,this.isStartIncluded=h(e.isStartIncluded,!0),this.isStopIncluded=h(e.isStopIncluded,!0)}Object.defineProperties(J.prototype,{isEmpty:{get:function(){const e=B.compare(this.stop,this.start);return e<0||e===0&&(!this.isStartIncluded||!this.isStopIncluded)}}});const Bi={start:void 0,stop:void 0,isStartIncluded:void 0,isStopIncluded:void 0,data:void 0};J.fromIso8601=function(e,t){Q.typeOf.object("options",e),Q.typeOf.string("options.iso8601",e.iso8601);const i=e.iso8601.split("/");if(i.length!==2)throw new N("options.iso8601 is an invalid ISO 8601 interval.");const n=B.fromIso8601(i[0]),o=B.fromIso8601(i[1]),s=h(e.isStartIncluded,!0),r=h(e.isStopIncluded,!0),l=e.data;return f(t)?(t.start=n,t.stop=o,t.isStartIncluded=s,t.isStopIncluded=r,t.data=l,t):(Bi.start=n,Bi.stop=o,Bi.isStartIncluded=s,Bi.isStopIncluded=r,Bi.data=l,new J(Bi))};J.toIso8601=function(e,t){return Q.typeOf.object("timeInterval",e),`${B.toIso8601(e.start,t)}/${B.toIso8601(e.stop,t)}`};J.clone=function(e,t){if(f(e))return f(t)?(t.start=e.start,t.stop=e.stop,t.isStartIncluded=e.isStartIncluded,t.isStopIncluded=e.isStopIncluded,t.data=e.data,t):new J(e)};J.equals=function(e,t,i){return e===t||f(e)&&f(t)&&(e.isEmpty&&t.isEmpty||e.isStartIncluded===t.isStartIncluded&&e.isStopIncluded===t.isStopIncluded&&B.equals(e.start,t.start)&&B.equals(e.stop,t.stop)&&(e.data===t.data||f(i)&&i(e.data,t.data)))};J.equalsEpsilon=function(e,t,i,n){return i=h(i,0),e===t||f(e)&&f(t)&&(e.isEmpty&&t.isEmpty||e.isStartIncluded===t.isStartIncluded&&e.isStopIncluded===t.isStopIncluded&&B.equalsEpsilon(e.start,t.start,i)&&B.equalsEpsilon(e.stop,t.stop,i)&&(e.data===t.data||f(n)&&n(e.data,t.data)))};J.intersect=function(e,t,i,n){if(Q.typeOf.object("left",e),!f(t))return J.clone(J.EMPTY,i);const o=e.start,s=e.stop,r=t.start,l=t.stop,a=B.greaterThanOrEquals(r,o)&&B.greaterThanOrEquals(s,r),c=!a&&B.lessThanOrEquals(r,o)&&B.lessThanOrEquals(o,l);if(!a&&!c)return J.clone(J.EMPTY,i);const d=e.isStartIncluded,m=e.isStopIncluded,g=t.isStartIncluded,y=t.isStopIncluded,w=B.lessThan(s,l);return f(i)||(i=new J),i.start=a?r:o,i.isStartIncluded=d&&g||!B.equals(r,o)&&(a&&g||c&&d),i.stop=w?s:l,i.isStopIncluded=w?m:m&&y||!B.equals(l,s)&&y,i.data=f(n)?n(e.data,t.data):e.data,i};J.contains=function(e,t){if(Q.typeOf.object("timeInterval",e),Q.typeOf.object("julianDate",t),e.isEmpty)return!1;const i=B.compare(e.start,t);if(i===0)return e.isStartIncluded;const n=B.compare(t,e.stop);return n===0?e.isStopIncluded:i<0&&n<0};J.prototype.clone=function(e){return J.clone(this,e)};J.prototype.equals=function(e,t){return J.equals(this,e,t)};J.prototype.equalsEpsilon=function(e,t,i){return J.equalsEpsilon(this,e,t,i)};J.prototype.toString=function(){return J.toIso8601(this)};J.EMPTY=Object.freeze(new J({start:new B,stop:new B,isStartIncluded:!1,isStopIncluded:!1}));const Ja=Object.freeze(B.fromIso8601("0000-01-01T00:00:00Z")),Qa=Object.freeze(B.fromIso8601("9999-12-31T24:00:00Z")),Dd=Object.freeze(new J({start:Ja,stop:Qa})),He={MINIMUM_VALUE:Ja,MAXIMUM_VALUE:Qa,MAXIMUM_INTERVAL:Dd},Td={SHIFT:0,CTRL:1,ALT:2},Po=Object.freeze(Td),As={type:"Linear"};As.getRequiredDataPoints=function(e){return 2};As.interpolateOrderZero=function(e,t,i,n,o){if(t.length!==2)throw new N("The xTable provided to the linear interpolator must have exactly two elements.");if(n<=0)throw new N("There must be at least 1 dependent variable for each independent variable.");f(o)||(o=new Array(n));let s,r,l;const a=t[0],c=t[1];if(a===c)throw new N("Divide by zero error: xTable[0] and xTable[1] are equal");for(s=0;s<n;s++)r=i[s],l=i[s+n],o[s]=((l-r)*e+c*r-a*l)/(c-a);return o};const Id={FIXED:0,INERTIAL:1},xt=Object.freeze(Id),vd={LEFT_DOWN:0,LEFT_UP:1,LEFT_CLICK:2,LEFT_DOUBLE_CLICK:3,RIGHT_DOWN:5,RIGHT_UP:6,RIGHT_CLICK:7,MIDDLE_DOWN:10,MIDDLE_UP:11,MIDDLE_CLICK:12,MOUSE_MOVE:15,WHEEL:16,PINCH_START:17,PINCH_END:18,PINCH_MOVE:19},Ie=Object.freeze(vd);function _i(e,t,i){const n=e._element;if(n===document)return i.x=t.clientX,i.y=t.clientY,i;const o=n.getBoundingClientRect();return i.x=t.clientX-o.left,i.y=t.clientY-o.top,i}function Os(e,t){let i=e;return f(t)&&(i+=`+${t}`),i}function Pi(e){if(e.shiftKey)return Po.SHIFT;if(e.ctrlKey)return Po.CTRL;if(e.altKey)return Po.ALT}const De={LEFT:0,MIDDLE:1,RIGHT:2};function lt(e,t,i,n){function o(s){n(e,s)}uo.isInternetExplorer()?i.addEventListener(t,o,!1):i.addEventListener(t,o,{capture:!1,passive:!1}),e._removalFunctions.push(function(){i.removeEventListener(t,o,!1)})}function Ad(e){const t=e._element,i=f(t.disableRootEvents)?t:document;uo.supportsPointerEvents()?(lt(e,"pointerdown",t,Md),lt(e,"pointerup",t,Cr),lt(e,"pointermove",t,kd),lt(e,"pointercancel",t,Cr)):(lt(e,"mousedown",t,el),lt(e,"mouseup",i,tl),lt(e,"mousemove",i,il),lt(e,"touchstart",t,Nd),lt(e,"touchend",i,mr),lt(e,"touchmove",i,Ld),lt(e,"touchcancel",i,mr)),lt(e,"dblclick",t,Pd);let n;"onwheel"in t?n="wheel":document.onmousewheel!==void 0?n="mousewheel":n="DOMMouseScroll",lt(e,n,t,Rd)}function Od(e){const t=e._removalFunctions;for(let i=0;i<t.length;++i)t[i]()}const ur={position:new Y};function Ps(e){e._lastSeenTouchEvent=qa()}function Rs(e){return qa()-e._lastSeenTouchEvent>Ht.mouseEmulationIgnoreMilliseconds}function as(e,t,i){const n=e.x-t.x,o=e.y-t.y;return Math.sqrt(n*n+o*o)<i}function el(e,t){if(!Rs(e))return;const i=t.button;e._buttonDown[i]=!0;let n;if(i===De.LEFT)n=Ie.LEFT_DOWN;else if(i===De.MIDDLE)n=Ie.MIDDLE_DOWN;else if(i===De.RIGHT)n=Ie.RIGHT_DOWN;else return;const o=_i(e,t,e._primaryPosition);Y.clone(o,e._primaryStartPosition),Y.clone(o,e._primaryPreviousPosition);const s=Pi(t),r=e.getInputAction(n,s);f(r)&&(Y.clone(o,ur.position),r(ur),t.preventDefault())}const fr={position:new Y},pr={position:new Y};function Ro(e,t,i,n){const o=Pi(n),s=e.getInputAction(t,o),r=e.getInputAction(i,o);if(f(s)||f(r)){const l=_i(e,n,e._primaryPosition);if(f(s)&&(Y.clone(l,fr.position),s(fr)),f(r)){const a=e._primaryStartPosition;as(a,l,e._clickPixelTolerance)&&(Y.clone(l,pr.position),r(pr))}}}function tl(e,t){if(!Rs(e))return;const i=t.button;i!==De.LEFT&&i!==De.MIDDLE&&i!==De.RIGHT||(e._buttonDown[De.LEFT]&&(Ro(e,Ie.LEFT_UP,Ie.LEFT_CLICK,t),e._buttonDown[De.LEFT]=!1),e._buttonDown[De.MIDDLE]&&(Ro(e,Ie.MIDDLE_UP,Ie.MIDDLE_CLICK,t),e._buttonDown[De.MIDDLE]=!1),e._buttonDown[De.RIGHT]&&(Ro(e,Ie.RIGHT_UP,Ie.RIGHT_CLICK,t),e._buttonDown[De.RIGHT]=!1))}const No={startPosition:new Y,endPosition:new Y};function il(e,t){if(!Rs(e))return;const i=Pi(t),n=_i(e,t,e._primaryPosition),o=e._primaryPreviousPosition,s=e.getInputAction(Ie.MOUSE_MOVE,i);f(s)&&(Y.clone(o,No.startPosition),Y.clone(n,No.endPosition),s(No)),Y.clone(n,o),(e._buttonDown[De.LEFT]||e._buttonDown[De.MIDDLE]||e._buttonDown[De.RIGHT])&&t.preventDefault()}const _r={position:new Y};function Pd(e,t){const i=t.button;let n;if(i===De.LEFT)n=Ie.LEFT_DOUBLE_CLICK;else return;const o=Pi(t),s=e.getInputAction(n,o);f(s)&&(_i(e,t,_r.position),s(_r))}function Rd(e,t){let i;if(f(t.deltaY)){const s=t.deltaMode;s===t.DOM_DELTA_PIXEL?i=-t.deltaY:s===t.DOM_DELTA_LINE?i=-t.deltaY*40:i=-t.deltaY*120}else t.detail>0?i=t.detail*-120:i=t.wheelDelta;if(!f(i))return;const n=Pi(t),o=e.getInputAction(Ie.WHEEL,n);f(o)&&(o(i),t.preventDefault())}function Nd(e,t){Ps(e);const i=t.changedTouches;let n;const o=i.length;let s,r;const l=e._positions;for(n=0;n<o;++n)s=i[n],r=s.identifier,l.set(r,_i(e,s,new Y));po(e,t);const a=e._previousPositions;for(n=0;n<o;++n)s=i[n],r=s.identifier,a.set(r,Y.clone(l.get(r)))}function mr(e,t){Ps(e);const i=t.changedTouches;let n;const o=i.length;let s,r;const l=e._positions;for(n=0;n<o;++n)s=i[n],r=s.identifier,l.remove(r);po(e,t);const a=e._previousPositions;for(n=0;n<o;++n)s=i[n],r=s.identifier,a.remove(r)}const gr={position:new Y},Lo={position1:new Y,position2:new Y},yr={position:new Y},wr={position:new Y},xr={position:new Y};function po(e,t){const i=Pi(t),n=e._positions,o=n.length;let s,r;const l=e._isPinching;if(o!==1&&e._buttonDown[De.LEFT]){if(e._buttonDown[De.LEFT]=!1,f(e._touchHoldTimer)&&(clearTimeout(e._touchHoldTimer),e._touchHoldTimer=void 0),s=e.getInputAction(Ie.LEFT_UP,i),f(s)&&(Y.clone(e._primaryPosition,yr.position),s(yr)),o===0&&!e._isTouchHolding&&(r=e.getInputAction(Ie.LEFT_CLICK,i),f(r))){const a=e._primaryStartPosition,c=e._previousPositions.values[0];as(a,c,e._clickPixelTolerance)&&(Y.clone(e._primaryPosition,wr.position),r(wr))}e._isTouchHolding=!1}if(o===0&&l&&(e._isPinching=!1,s=e.getInputAction(Ie.PINCH_END,i),f(s)&&s()),o===1&&!l){const a=n.values[0];Y.clone(a,e._primaryPosition),Y.clone(a,e._primaryStartPosition),Y.clone(a,e._primaryPreviousPosition),e._buttonDown[De.LEFT]=!0,s=e.getInputAction(Ie.LEFT_DOWN,i),f(s)&&(Y.clone(a,gr.position),s(gr)),e._touchHoldTimer=setTimeout(function(){if(!e.isDestroyed()&&(e._touchHoldTimer=void 0,e._isTouchHolding=!0,r=e.getInputAction(Ie.RIGHT_CLICK,i),f(r))){const c=e._primaryStartPosition,d=e._previousPositions.values[0];as(c,d,e._holdPixelTolerance)&&(Y.clone(e._primaryPosition,xr.position),r(xr))}},Ht.touchHoldDelayMilliseconds),t.preventDefault()}o===2&&!l&&(e._isPinching=!0,s=e.getInputAction(Ie.PINCH_START,i),f(s)&&(Y.clone(n.values[0],Lo.position1),Y.clone(n.values[1],Lo.position2),s(Lo),t.preventDefault()))}function Ld(e,t){Ps(e);const i=t.changedTouches;let n;const o=i.length;let s,r;const l=e._positions;for(n=0;n<o;++n){s=i[n],r=s.identifier;const c=l.get(r);f(c)&&_i(e,s,c)}nl(e,t);const a=e._previousPositions;for(n=0;n<o;++n)s=i[n],r=s.identifier,Y.clone(l.get(r),a.get(r))}const Mo={startPosition:new Y,endPosition:new Y},nn={distance:{startPosition:new Y,endPosition:new Y},angleAndHeight:{startPosition:new Y,endPosition:new Y}};function nl(e,t){const i=Pi(t),n=e._positions,o=e._previousPositions,s=n.length;let r;if(s===1&&e._buttonDown[De.LEFT]){const l=n.values[0];Y.clone(l,e._primaryPosition);const a=e._primaryPreviousPosition;r=e.getInputAction(Ie.MOUSE_MOVE,i),f(r)&&(Y.clone(a,Mo.startPosition),Y.clone(l,Mo.endPosition),r(Mo)),Y.clone(l,a),t.preventDefault()}else if(s===2&&e._isPinching&&(r=e.getInputAction(Ie.PINCH_MOVE,i),f(r))){const l=n.values[0],a=n.values[1],c=o.values[0],d=o.values[1],m=a.x-l.x,g=a.y-l.y,y=Math.sqrt(m*m+g*g)*.25,w=d.x-c.x,p=d.y-c.y,u=Math.sqrt(w*w+p*p)*.25,_=(a.y+l.y)*.125,x=(d.y+c.y)*.125,S=Math.atan2(g,m),I=Math.atan2(p,w);Y.fromElements(0,u,nn.distance.startPosition),Y.fromElements(0,y,nn.distance.endPosition),Y.fromElements(I,x,nn.angleAndHeight.startPosition),Y.fromElements(S,_,nn.angleAndHeight.endPosition),r(nn)}}function Md(e,t){if(t.target.setPointerCapture(t.pointerId),t.pointerType==="touch"){const i=e._positions,n=t.pointerId;i.set(n,_i(e,t,new Y)),po(e,t),e._previousPositions.set(n,Y.clone(i.get(n)))}else el(e,t)}function Cr(e,t){if(t.pointerType==="touch"){const i=e._positions,n=t.pointerId;i.remove(n),po(e,t),e._previousPositions.remove(n)}else tl(e,t)}function kd(e,t){if(t.pointerType==="touch"){const i=e._positions,n=t.pointerId,o=i.get(n);if(!f(o))return;_i(e,t,o),nl(e,t);const s=e._previousPositions;Y.clone(i.get(n),s.get(n))}else il(e,t)}function Ht(e){this._inputEvents={},this._buttonDown={LEFT:!1,MIDDLE:!1,RIGHT:!1},this._isPinching=!1,this._isTouchHolding=!1,this._lastSeenTouchEvent=-Ht.mouseEmulationIgnoreMilliseconds,this._primaryStartPosition=new Y,this._primaryPosition=new Y,this._primaryPreviousPosition=new Y,this._positions=new qi,this._previousPositions=new qi,this._removalFunctions=[],this._touchHoldTimer=void 0,this._clickPixelTolerance=5,this._holdPixelTolerance=25,this._element=h(e,document),Ad(this)}Ht.prototype.setInputAction=function(e,t,i){if(!f(e))throw new N("action is required.");if(!f(t))throw new N("type is required.");const n=Os(t,i);this._inputEvents[n]=e};Ht.prototype.getInputAction=function(e,t){if(!f(e))throw new N("type is required.");const i=Os(e,t);return this._inputEvents[i]};Ht.prototype.removeInputAction=function(e,t){if(!f(e))throw new N("type is required.");const i=Os(e,t);delete this._inputEvents[i]};Ht.prototype.isDestroyed=function(){return!1};Ht.prototype.destroy=function(){return Od(this),ho(this)};Ht.mouseEmulationIgnoreMilliseconds=800;Ht.touchHoldDelayMilliseconds=1500;function Ns(e,t){return B.compare(e.start,t.start)}function Ce(e){if(this._intervals=[],this._changedEvent=new le,f(e)){const t=e.length;for(let i=0;i<t;i++)this.addInterval(e[i])}}Object.defineProperties(Ce.prototype,{changedEvent:{get:function(){return this._changedEvent}},start:{get:function(){const e=this._intervals;return e.length===0?void 0:e[0].start}},isStartIncluded:{get:function(){const e=this._intervals;return e.length===0?!1:e[0].isStartIncluded}},stop:{get:function(){const e=this._intervals,t=e.length;return t===0?void 0:e[t-1].stop}},isStopIncluded:{get:function(){const e=this._intervals,t=e.length;return t===0?!1:e[t-1].isStopIncluded}},length:{get:function(){return this._intervals.length}},isEmpty:{get:function(){return this._intervals.length===0}}});Ce.prototype.equals=function(e,t){if(this===e)return!0;if(!(e instanceof Ce))return!1;const i=this._intervals,n=e._intervals,o=i.length;if(o!==n.length)return!1;for(let s=0;s<o;s++)if(!J.equals(i[s],n[s],t))return!1;return!0};Ce.prototype.get=function(e){if(!f(e))throw new N("index is required.");return this._intervals[e]};Ce.prototype.removeAll=function(){this._intervals.length>0&&(this._intervals.length=0,this._changedEvent.raiseEvent(this))};Ce.prototype.findIntervalContainingDate=function(e){const t=this.indexOf(e);return t>=0?this._intervals[t]:void 0};Ce.prototype.findDataForIntervalContainingDate=function(e){const t=this.indexOf(e);return t>=0?this._intervals[t].data:void 0};Ce.prototype.contains=function(e){return this.indexOf(e)>=0};const ko=new J;Ce.prototype.indexOf=function(e){if(!f(e))throw new N("date is required");const t=this._intervals;ko.start=e,ko.stop=e;let i=li(t,ko,Ns);return i>=0?t[i].isStartIncluded?i:i>0&&t[i-1].stop.equals(e)&&t[i-1].isStopIncluded?i-1:~i:(i=~i,i>0&&i-1<t.length&&J.contains(t[i-1],e)?i-1:~i)};Ce.prototype.findInterval=function(e){e=h(e,h.EMPTY_OBJECT);const t=e.start,i=e.stop,n=e.isStartIncluded,o=e.isStopIncluded,s=this._intervals;for(let r=0,l=s.length;r<l;r++){const a=s[r];if((!f(t)||a.start.equals(t))&&(!f(i)||a.stop.equals(i))&&(!f(n)||a.isStartIncluded===n)&&(!f(o)||a.isStopIncluded===o))return s[r]}};Ce.prototype.addInterval=function(e,t){if(!f(e))throw new N("interval is required");if(e.isEmpty)return;const i=this._intervals;if(i.length===0||B.greaterThan(e.start,i[i.length-1].stop)){i.push(e),this._changedEvent.raiseEvent(this);return}let n=li(i,e,Ns);n<0?n=~n:n>0&&e.isStartIncluded&&i[n-1].isStartIncluded&&i[n-1].start.equals(e.start)?--n:n<i.length&&!e.isStartIncluded&&i[n].isStartIncluded&&i[n].start.equals(e.start)&&++n;let o;for(n>0&&(o=B.compare(i[n-1].stop,e.start),(o>0||o===0&&(i[n-1].isStopIncluded||e.isStartIncluded))&&((f(t)?t(i[n-1].data,e.data):i[n-1].data===e.data)?(B.greaterThan(e.stop,i[n-1].stop)?e=new J({start:i[n-1].start,stop:e.stop,isStartIncluded:i[n-1].isStartIncluded,isStopIncluded:e.isStopIncluded,data:e.data}):e=new J({start:i[n-1].start,stop:i[n-1].stop,isStartIncluded:i[n-1].isStartIncluded,isStopIncluded:i[n-1].isStopIncluded||e.stop.equals(i[n-1].stop)&&e.isStopIncluded,data:e.data}),i.splice(n-1,1),--n):(o=B.compare(i[n-1].stop,e.stop),(o>0||o===0&&i[n-1].isStopIncluded&&!e.isStopIncluded)&&i.splice(n,0,new J({start:e.stop,stop:i[n-1].stop,isStartIncluded:!e.isStopIncluded,isStopIncluded:i[n-1].isStopIncluded,data:i[n-1].data})),i[n-1]=new J({start:i[n-1].start,stop:e.start,isStartIncluded:i[n-1].isStartIncluded,isStopIncluded:!e.isStartIncluded,data:i[n-1].data}))));n<i.length&&(o=B.compare(e.stop,i[n].start),o>0||o===0&&(e.isStopIncluded||i[n].isStartIncluded));)if(f(t)?t(i[n].data,e.data):i[n].data===e.data)e=new J({start:e.start,stop:B.greaterThan(i[n].stop,e.stop)?i[n].stop:e.stop,isStartIncluded:e.isStartIncluded,isStopIncluded:B.greaterThan(i[n].stop,e.stop)?i[n].isStopIncluded:e.isStopIncluded,data:e.data}),i.splice(n,1);else if(i[n]=new J({start:e.stop,stop:i[n].stop,isStartIncluded:!e.isStopIncluded,isStopIncluded:i[n].isStopIncluded,data:i[n].data}),i[n].isEmpty)i.splice(n,1);else break;i.splice(n,0,e),this._changedEvent.raiseEvent(this)};Ce.prototype.removeInterval=function(e){if(!f(e))throw new N("interval is required");if(e.isEmpty)return!1;const t=this._intervals;let i=li(t,e,Ns);i<0&&(i=~i);let n=!1;for(i>0&&(B.greaterThan(t[i-1].stop,e.start)||t[i-1].stop.equals(e.start)&&t[i-1].isStopIncluded&&e.isStartIncluded)&&(n=!0,(B.greaterThan(t[i-1].stop,e.stop)||t[i-1].isStopIncluded&&!e.isStopIncluded&&t[i-1].stop.equals(e.stop))&&t.splice(i,0,new J({start:e.stop,stop:t[i-1].stop,isStartIncluded:!e.isStopIncluded,isStopIncluded:t[i-1].isStopIncluded,data:t[i-1].data})),t[i-1]=new J({start:t[i-1].start,stop:e.start,isStartIncluded:t[i-1].isStartIncluded,isStopIncluded:!e.isStartIncluded,data:t[i-1].data})),i<t.length&&!e.isStartIncluded&&t[i].isStartIncluded&&e.start.equals(t[i].start)&&(n=!0,t.splice(i,0,new J({start:t[i].start,stop:t[i].start,isStartIncluded:!0,isStopIncluded:!0,data:t[i].data})),++i);i<t.length&&B.greaterThan(e.stop,t[i].stop);)n=!0,t.splice(i,1);return i<t.length&&e.stop.equals(t[i].stop)&&(n=!0,!e.isStopIncluded&&t[i].isStopIncluded?i+1<t.length&&t[i+1].start.equals(e.stop)&&t[i].data===t[i+1].data?(t.splice(i,1),t[i]=new J({start:t[i].start,stop:t[i].stop,isStartIncluded:!0,isStopIncluded:t[i].isStopIncluded,data:t[i].data})):t[i]=new J({start:e.stop,stop:e.stop,isStartIncluded:!0,isStopIncluded:!0,data:t[i].data}):t.splice(i,1)),i<t.length&&(B.greaterThan(e.stop,t[i].start)||e.stop.equals(t[i].start)&&e.isStopIncluded&&t[i].isStartIncluded)&&(n=!0,t[i]=new J({start:e.stop,stop:t[i].stop,isStartIncluded:!e.isStopIncluded,isStopIncluded:t[i].isStopIncluded,data:t[i].data})),n&&this._changedEvent.raiseEvent(this),n};Ce.prototype.intersect=function(e,t,i){if(!f(e))throw new N("other is required.");const n=new Ce;let o=0,s=0;const r=this._intervals,l=e._intervals;for(;o<r.length&&s<l.length;){const a=r[o],c=l[s];if(B.lessThan(a.stop,c.start))++o;else if(B.lessThan(c.stop,a.start))++s;else{if(f(i)||f(t)&&t(a.data,c.data)||!f(t)&&c.data===a.data){const d=J.intersect(a,c,new J,i);d.isEmpty||n.addInterval(d,t)}B.lessThan(a.stop,c.stop)||a.stop.equals(c.stop)&&!a.isStopIncluded&&c.isStopIncluded?++o:++s}}return n};Ce.fromJulianDateArray=function(e,t){if(!f(e))throw new N("options is required.");if(!f(e.julianDates))throw new N("options.iso8601Array is required.");f(t)||(t=new Ce);const i=e.julianDates,n=i.length,o=e.dataCallback,s=h(e.isStartIncluded,!0),r=h(e.isStopIncluded,!0),l=h(e.leadingInterval,!1),a=h(e.trailingInterval,!1);let c,d=0;l&&(++d,c=new J({start:He.MINIMUM_VALUE,stop:i[0],isStartIncluded:!0,isStopIncluded:!s}),c.data=f(o)?o(c,t.length):t.length,t.addInterval(c));for(let m=0;m<n-1;++m){let g=i[m];const y=i[m+1];c=new J({start:g,stop:y,isStartIncluded:t.length===d?s:!0,isStopIncluded:m===n-2?r:!1}),c.data=f(o)?o(c,t.length):t.length,t.addInterval(c),g=y}return a&&(c=new J({start:i[n-1],stop:He.MAXIMUM_VALUE,isStartIncluded:!r,isStopIncluded:!0}),c.data=f(o)?o(c,t.length):t.length,t.addInterval(c)),t};const Be=new Ua,on=[0,31,28,31,30,31,30,31,31,30,31,30,31];function ls(e,t,i){f(i)||(i=new B),B.toGregorianDate(e,Be);let n=Be.millisecond+t.millisecond,o=Be.second+t.second,s=Be.minute+t.minute,r=Be.hour+t.hour,l=Be.day+t.day,a=Be.month+t.month,c=Be.year+t.year;for(n>=1e3&&(o+=Math.floor(n/1e3),n=n%1e3),o>=60&&(s+=Math.floor(o/60),o=o%60),s>=60&&(r+=Math.floor(s/60),s=s%60),r>=24&&(l+=Math.floor(r/24),r=r%24),on[2]=qs(c)?29:28;l>on[a]||a>=13;)l>on[a]&&(l-=on[a],++a),a>=13&&(--a,c+=Math.floor(a/12),a=a%12,++a),on[2]=qs(c)?29:28;return Be.millisecond=n,Be.second=o,Be.minute=s,Be.hour=r,Be.day=l,Be.month=a,Be.year=c,B.fromGregorianDate(Be,i)}const Fd=new B,zd=/P(?:([\d.,]+)Y)?(?:([\d.,]+)M)?(?:([\d.,]+)W)?(?:([\d.,]+)D)?(?:T(?:([\d.,]+)H)?(?:([\d.,]+)M)?(?:([\d.,]+)S)?)?/;function ol(e,t){if(!f(e)||e.length===0)return!1;if(t.year=0,t.month=0,t.day=0,t.hour=0,t.minute=0,t.second=0,t.millisecond=0,e[0]==="P"){const i=e.match(zd);if(!f(i))return!1;if(f(i[1])&&(t.year=Number(i[1].replace(",","."))),f(i[2])&&(t.month=Number(i[2].replace(",","."))),f(i[3])&&(t.day=Number(i[3].replace(",","."))*7),f(i[4])&&(t.day+=Number(i[4].replace(",","."))),f(i[5])&&(t.hour=Number(i[5].replace(",","."))),f(i[6])&&(t.minute=Number(i[6].replace(",","."))),f(i[7])){const n=Number(i[7].replace(",","."));t.second=Math.floor(n),t.millisecond=n%1*1e3}}else e[e.length-1]!=="Z"&&(e+="Z"),B.toGregorianDate(B.fromIso8601(e,Fd),t);return t.year||t.month||t.day||t.hour||t.minute||t.second||t.millisecond}const hn=new Ua;Ce.fromIso8601=function(e,t){if(!f(e))throw new N("options is required.");if(!f(e.iso8601))throw new N("options.iso8601 is required.");const i=e.iso8601.split("/"),n=B.fromIso8601(i[0]),o=B.fromIso8601(i[1]),s=[];if(!ol(i[2],hn))s.push(n,o);else{let r=B.clone(n);for(s.push(r);B.compare(r,o)<0;)r=ls(r,hn),B.compare(o,r)<=0&&B.clone(o,r),s.push(r)}return Ce.fromJulianDateArray({julianDates:s,isStartIncluded:e.isStartIncluded,isStopIncluded:e.isStopIncluded,leadingInterval:e.leadingInterval,trailingInterval:e.trailingInterval,dataCallback:e.dataCallback},t)};Ce.fromIso8601DateArray=function(e,t){if(!f(e))throw new N("options is required.");if(!f(e.iso8601Dates))throw new N("options.iso8601Dates is required.");return Ce.fromJulianDateArray({julianDates:e.iso8601Dates.map(function(i){return B.fromIso8601(i)}),isStartIncluded:e.isStartIncluded,isStopIncluded:e.isStopIncluded,leadingInterval:e.leadingInterval,trailingInterval:e.trailingInterval,dataCallback:e.dataCallback},t)};Ce.fromIso8601DurationArray=function(e,t){if(!f(e))throw new N("options is required.");if(!f(e.epoch))throw new N("options.epoch is required.");if(!f(e.iso8601Durations))throw new N("options.iso8601Durations is required.");const i=e.epoch,n=e.iso8601Durations,o=h(e.relativeToPrevious,!1),s=[];let r,l;const a=n.length;for(let c=0;c<a;++c)(ol(n[c],hn)||c===0)&&(o&&f(l)?r=ls(l,hn):r=ls(i,hn),s.push(r),l=r);return Ce.fromJulianDateArray({julianDates:s,isStartIncluded:e.isStartIncluded,isStopIncluded:e.isStopIncluded,leadingInterval:e.leadingInterval,trailingInterval:e.trailingInterval,dataCallback:e.dataCallback},t)};function Vt(e){this._value=void 0,this._hasClone=!1,this._hasEquals=!1,this._definitionChanged=new le,this.setValue(e)}Object.defineProperties(Vt.prototype,{isConstant:{value:!0},definitionChanged:{get:function(){return this._definitionChanged}}});Vt.prototype.getValue=function(e,t){return this._hasClone?this._value.clone(t):this._value};Vt.prototype.setValue=function(e){const t=this._value;if(t!==e){const i=f(e),n=i&&typeof e.clone=="function",o=i&&typeof e.equals=="function";(!o||!e.equals(t))&&(this._hasClone=n,this._hasEquals=o,this._value=n?e.clone(this._value):e,this._definitionChanged.raiseEvent(this))}};Vt.prototype.equals=function(e){return this===e||e instanceof Vt&&(!this._hasEquals&&this._value===e._value||this._hasEquals&&this._value.equals(e._value))};Vt.prototype.valueOf=function(){return this._value};Vt.prototype.toString=function(){return String(this._value)};function Bd(e,t,i,n,o){return{configurable:n,get:function(){return this[t]},set:function(s){const r=this[t],l=this[i];f(l)&&(l(),this[i]=void 0),s!==void 0&&(!f(s)||!f(s.getValue))&&f(o)&&(s=o(s)),r!==s&&(this[t]=s,this._definitionChanged.raiseEvent(this,e,s,r)),f(s)&&f(s.definitionChanged)&&(this[i]=s.definitionChanged.addEventListener(function(){this._definitionChanged.raiseEvent(this,e,s,s)},this))}}}function Ud(e){return new Vt(e)}function C(e,t,i){return Bd(e,`_${e.toString()}`,`_${e.toString()}Subscription`,h(t,!1),h(i,Ud))}function Ii(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._image=void 0,this._imageSubscription=void 0,this._scale=void 0,this._scaleSubscription=void 0,this._pixelOffset=void 0,this._pixelOffsetSubscription=void 0,this._eyeOffset=void 0,this._eyeOffsetSubscription=void 0,this._horizontalOrigin=void 0,this._horizontalOriginSubscription=void 0,this._verticalOrigin=void 0,this._verticalOriginSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._color=void 0,this._colorSubscription=void 0,this._rotation=void 0,this._rotationSubscription=void 0,this._alignedAxis=void 0,this._alignedAxisSubscription=void 0,this._sizeInMeters=void 0,this._sizeInMetersSubscription=void 0,this._width=void 0,this._widthSubscription=void 0,this._height=void 0,this._heightSubscription=void 0,this._scaleByDistance=void 0,this._scaleByDistanceSubscription=void 0,this._translucencyByDistance=void 0,this._translucencyByDistanceSubscription=void 0,this._pixelOffsetScaleByDistance=void 0,this._pixelOffsetScaleByDistanceSubscription=void 0,this._imageSubRegion=void 0,this._imageSubRegionSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._disableDepthTestDistance=void 0,this._disableDepthTestDistanceSubscription=void 0,this._splitDirection=void 0,this._splitDirectionSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(Ii.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),image:C("image"),scale:C("scale"),pixelOffset:C("pixelOffset"),eyeOffset:C("eyeOffset"),horizontalOrigin:C("horizontalOrigin"),verticalOrigin:C("verticalOrigin"),heightReference:C("heightReference"),color:C("color"),rotation:C("rotation"),alignedAxis:C("alignedAxis"),sizeInMeters:C("sizeInMeters"),width:C("width"),height:C("height"),scaleByDistance:C("scaleByDistance"),translucencyByDistance:C("translucencyByDistance"),pixelOffsetScaleByDistance:C("pixelOffsetScaleByDistance"),imageSubRegion:C("imageSubRegion"),distanceDisplayCondition:C("distanceDisplayCondition"),disableDepthTestDistance:C("disableDepthTestDistance"),splitDirection:C("splitDirection")});Ii.prototype.clone=function(e){return f(e)?(e.show=this._show,e.image=this._image,e.scale=this._scale,e.pixelOffset=this._pixelOffset,e.eyeOffset=this._eyeOffset,e.horizontalOrigin=this._horizontalOrigin,e.verticalOrigin=this._verticalOrigin,e.heightReference=this._heightReference,e.color=this._color,e.rotation=this._rotation,e.alignedAxis=this._alignedAxis,e.sizeInMeters=this._sizeInMeters,e.width=this._width,e.height=this._height,e.scaleByDistance=this._scaleByDistance,e.translucencyByDistance=this._translucencyByDistance,e.pixelOffsetScaleByDistance=this._pixelOffsetScaleByDistance,e.imageSubRegion=this._imageSubRegion,e.distanceDisplayCondition=this._distanceDisplayCondition,e.disableDepthTestDistance=this._disableDepthTestDistance,e.splitDirection=this._splitDirection,e):new Ii(this)};Ii.prototype.merge=function(e){if(!f(e))throw new N("source is required.");this.show=h(this._show,e.show),this.image=h(this._image,e.image),this.scale=h(this._scale,e.scale),this.pixelOffset=h(this._pixelOffset,e.pixelOffset),this.eyeOffset=h(this._eyeOffset,e.eyeOffset),this.horizontalOrigin=h(this._horizontalOrigin,e.horizontalOrigin),this.verticalOrigin=h(this._verticalOrigin,e.verticalOrigin),this.heightReference=h(this._heightReference,e.heightReference),this.color=h(this._color,e.color),this.rotation=h(this._rotation,e.rotation),this.alignedAxis=h(this._alignedAxis,e.alignedAxis),this.sizeInMeters=h(this._sizeInMeters,e.sizeInMeters),this.width=h(this._width,e.width),this.height=h(this._height,e.height),this.scaleByDistance=h(this._scaleByDistance,e.scaleByDistance),this.translucencyByDistance=h(this._translucencyByDistance,e.translucencyByDistance),this.pixelOffsetScaleByDistance=h(this._pixelOffsetScaleByDistance,e.pixelOffsetScaleByDistance),this.imageSubRegion=h(this._imageSubRegion,e.imageSubRegion),this.distanceDisplayCondition=h(this._distanceDisplayCondition,e.distanceDisplayCondition),this.disableDepthTestDistance=h(this._disableDepthTestDistance,e.disableDepthTestDistance),this.splitDirection=h(this.splitDirection,e.splitDirection)};function te(){N.throwInstantiationError()}Object.defineProperties(te.prototype,{isConstant:{get:N.throwInstantiationError},definitionChanged:{get:N.throwInstantiationError}});te.prototype.getValue=N.throwInstantiationError;te.prototype.equals=N.throwInstantiationError;te.equals=function(e,t){return e===t||f(e)&&e.equals(t)};te.arrayEquals=function(e,t){if(e===t)return!0;if(!f(e)||!f(t)||e.length!==t.length)return!1;const i=e.length;for(let n=0;n<i;n++)if(!te.equals(e[n],t[n]))return!1;return!0};te.isConstant=function(e){return!f(e)||e.isConstant};te.getValueOrUndefined=function(e,t,i){return f(e)?e.getValue(t,i):void 0};te.getValueOrDefault=function(e,t,i,n){return f(e)?h(e.getValue(t,n),i):i};te.getValueOrClonedDefault=function(e,t,i,n){let o;return f(e)&&(o=e.getValue(t,n)),f(o)||(o=i.clone(o)),o};function Ki(e){this._definitionChanged=new le,this._color=void 0,this._colorSubscription=void 0,this.color=e}Object.defineProperties(Ki.prototype,{isConstant:{get:function(){return te.isConstant(this._color)}},definitionChanged:{get:function(){return this._definitionChanged}},color:C("color")});Ki.prototype.getType=function(e){return"Color"};Ki.prototype.getValue=function(e,t){return f(t)||(t={}),t.color=te.getValueOrClonedDefault(this._color,e,Nn.WHITE,t.color),t};Ki.prototype.equals=function(e){return this===e||e instanceof Ki&&te.equals(this._color,e._color)};const Vd=`in vec3 position3DHigh;
in vec3 position3DLow;
in float batchId;

#ifdef EXTRUDED_GEOMETRY
in vec3 extrudeDirection;

uniform float u_globeMinimumAltitude;
#endif // EXTRUDED_GEOMETRY

#ifdef PER_INSTANCE_COLOR
out vec4 v_color;
#endif // PER_INSTANCE_COLOR

#ifdef TEXTURE_COORDINATES
#ifdef SPHERICAL
out vec4 v_sphericalExtents;
#else // SPHERICAL
out vec2 v_inversePlaneExtents;
out vec4 v_westPlane;
out vec4 v_southPlane;
#endif // SPHERICAL
out vec3 v_uvMinAndSphericalLongitudeRotation;
out vec3 v_uMaxAndInverseDistance;
out vec3 v_vMaxAndInverseDistance;
#endif // TEXTURE_COORDINATES

void main()
{
    vec4 position = czm_computePosition();

#ifdef EXTRUDED_GEOMETRY
    float delta = min(u_globeMinimumAltitude, czm_geometricToleranceOverMeter * length(position.xyz));
    delta *= czm_sceneMode == czm_sceneMode3D ? 1.0 : 0.0;

    //extrudeDirection is zero for the top layer
    position = position + vec4(extrudeDirection * delta, 0.0);
#endif

#ifdef TEXTURE_COORDINATES
#ifdef SPHERICAL
    v_sphericalExtents = czm_batchTable_sphericalExtents(batchId);
    v_uvMinAndSphericalLongitudeRotation.z = czm_batchTable_longitudeRotation(batchId);
#else // SPHERICAL
#ifdef COLUMBUS_VIEW_2D
    vec4 planes2D_high = czm_batchTable_planes2D_HIGH(batchId);
    vec4 planes2D_low = czm_batchTable_planes2D_LOW(batchId);

    // If the primitive is split across the IDL (planes2D_high.x > planes2D_high.w):
    // - If this vertex is on the east side of the IDL (position3DLow.y > 0.0, comparison with position3DHigh may produce artifacts)
    // - existing "east" is on the wrong side of the world, far away (planes2D_high/low.w)
    // - so set "east" as beyond the eastmost extent of the projection (idlSplitNewPlaneHiLow)
    vec2 idlSplitNewPlaneHiLow = vec2(EAST_MOST_X_HIGH - (WEST_MOST_X_HIGH - planes2D_high.w), EAST_MOST_X_LOW - (WEST_MOST_X_LOW - planes2D_low.w));
    bool idlSplit = planes2D_high.x > planes2D_high.w && position3DLow.y > 0.0;
    planes2D_high.w = czm_branchFreeTernary(idlSplit, idlSplitNewPlaneHiLow.x, planes2D_high.w);
    planes2D_low.w = czm_branchFreeTernary(idlSplit, idlSplitNewPlaneHiLow.y, planes2D_low.w);

    // - else, if this vertex is on the west side of the IDL (position3DLow.y < 0.0)
    // - existing "west" is on the wrong side of the world, far away (planes2D_high/low.x)
    // - so set "west" as beyond the westmost extent of the projection (idlSplitNewPlaneHiLow)
    idlSplit = planes2D_high.x > planes2D_high.w && position3DLow.y < 0.0;
    idlSplitNewPlaneHiLow = vec2(WEST_MOST_X_HIGH - (EAST_MOST_X_HIGH - planes2D_high.x), WEST_MOST_X_LOW - (EAST_MOST_X_LOW - planes2D_low.x));
    planes2D_high.x = czm_branchFreeTernary(idlSplit, idlSplitNewPlaneHiLow.x, planes2D_high.x);
    planes2D_low.x = czm_branchFreeTernary(idlSplit, idlSplitNewPlaneHiLow.y, planes2D_low.x);

    vec3 southWestCorner = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(vec3(0.0, planes2D_high.xy), vec3(0.0, planes2D_low.xy))).xyz;
    vec3 northWestCorner = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(vec3(0.0, planes2D_high.x, planes2D_high.z), vec3(0.0, planes2D_low.x, planes2D_low.z))).xyz;
    vec3 southEastCorner = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(vec3(0.0, planes2D_high.w, planes2D_high.y), vec3(0.0, planes2D_low.w, planes2D_low.y))).xyz;
#else // COLUMBUS_VIEW_2D
    // 3D case has smaller "plane extents," so planes encoded as a 64 bit position and 2 vec3s for distances/direction
    vec3 southWestCorner = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(czm_batchTable_southWest_HIGH(batchId), czm_batchTable_southWest_LOW(batchId))).xyz;
    vec3 northWestCorner = czm_normal * czm_batchTable_northward(batchId) + southWestCorner;
    vec3 southEastCorner = czm_normal * czm_batchTable_eastward(batchId) + southWestCorner;
#endif // COLUMBUS_VIEW_2D

    vec3 eastWard = southEastCorner - southWestCorner;
    float eastExtent = length(eastWard);
    eastWard /= eastExtent;

    vec3 northWard = northWestCorner - southWestCorner;
    float northExtent = length(northWard);
    northWard /= northExtent;

    v_westPlane = vec4(eastWard, -dot(eastWard, southWestCorner));
    v_southPlane = vec4(northWard, -dot(northWard, southWestCorner));
    v_inversePlaneExtents = vec2(1.0 / eastExtent, 1.0 / northExtent);
#endif // SPHERICAL
    vec4 uvMinAndExtents = czm_batchTable_uvMinAndExtents(batchId);
    vec4 uMaxVmax = czm_batchTable_uMaxVmax(batchId);

    v_uMaxAndInverseDistance = vec3(uMaxVmax.xy, uvMinAndExtents.z);
    v_vMaxAndInverseDistance = vec3(uMaxVmax.zw, uvMinAndExtents.w);
    v_uvMinAndSphericalLongitudeRotation.xy = uvMinAndExtents.xy;
#endif // TEXTURE_COORDINATES

#ifdef PER_INSTANCE_COLOR
    v_color = czm_batchTable_color(batchId);
#endif

    gl_Position = czm_depthClamp(czm_modelViewProjectionRelativeToEye * position);
}
`,sl=`#ifdef TEXTURE_COORDINATES
#ifdef SPHERICAL
in vec4 v_sphericalExtents;
#else // SPHERICAL
in vec2 v_inversePlaneExtents;
in vec4 v_westPlane;
in vec4 v_southPlane;
#endif // SPHERICAL
in vec3 v_uvMinAndSphericalLongitudeRotation;
in vec3 v_uMaxAndInverseDistance;
in vec3 v_vMaxAndInverseDistance;
#endif // TEXTURE_COORDINATES

#ifdef PER_INSTANCE_COLOR
in vec4 v_color;
#endif

#ifdef NORMAL_EC
vec3 getEyeCoordinate3FromWindowCoordinate(vec2 fragCoord, float logDepthOrDepth) {
    vec4 eyeCoordinate = czm_windowToEyeCoordinates(fragCoord, logDepthOrDepth);
    return eyeCoordinate.xyz / eyeCoordinate.w;
}

vec3 vectorFromOffset(vec4 eyeCoordinate, vec2 positiveOffset) {
    vec2 glFragCoordXY = gl_FragCoord.xy;
    // Sample depths at both offset and negative offset
    float upOrRightLogDepth = czm_unpackDepth(texture(czm_globeDepthTexture, (glFragCoordXY + positiveOffset) / czm_viewport.zw));
    float downOrLeftLogDepth = czm_unpackDepth(texture(czm_globeDepthTexture, (glFragCoordXY - positiveOffset) / czm_viewport.zw));
    // Explicitly evaluate both paths
    // Necessary for multifrustum and for edges of the screen
    bvec2 upOrRightInBounds = lessThan(glFragCoordXY + positiveOffset, czm_viewport.zw);
    float useUpOrRight = float(upOrRightLogDepth > 0.0 && upOrRightInBounds.x && upOrRightInBounds.y);
    float useDownOrLeft = float(useUpOrRight == 0.0);
    vec3 upOrRightEC = getEyeCoordinate3FromWindowCoordinate(glFragCoordXY + positiveOffset, upOrRightLogDepth);
    vec3 downOrLeftEC = getEyeCoordinate3FromWindowCoordinate(glFragCoordXY - positiveOffset, downOrLeftLogDepth);
    return (upOrRightEC - (eyeCoordinate.xyz / eyeCoordinate.w)) * useUpOrRight + ((eyeCoordinate.xyz / eyeCoordinate.w) - downOrLeftEC) * useDownOrLeft;
}
#endif // NORMAL_EC

void main(void)
{
#ifdef REQUIRES_EC
    float logDepthOrDepth = czm_unpackDepth(texture(czm_globeDepthTexture, gl_FragCoord.xy / czm_viewport.zw));
    vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth);
#endif

#ifdef REQUIRES_WC
    vec4 worldCoordinate4 = czm_inverseView * eyeCoordinate;
    vec3 worldCoordinate = worldCoordinate4.xyz / worldCoordinate4.w;
#endif

#ifdef TEXTURE_COORDINATES
    vec2 uv;
#ifdef SPHERICAL
    // Treat world coords as a sphere normal for spherical coordinates
    vec2 sphericalLatLong = czm_approximateSphericalCoordinates(worldCoordinate);
    sphericalLatLong.y += v_uvMinAndSphericalLongitudeRotation.z;
    sphericalLatLong.y = czm_branchFreeTernary(sphericalLatLong.y < czm_pi, sphericalLatLong.y, sphericalLatLong.y - czm_twoPi);
    uv.x = (sphericalLatLong.y - v_sphericalExtents.y) * v_sphericalExtents.w;
    uv.y = (sphericalLatLong.x - v_sphericalExtents.x) * v_sphericalExtents.z;
#else // SPHERICAL
    // Unpack planes and transform to eye space
    uv.x = czm_planeDistance(v_westPlane, eyeCoordinate.xyz / eyeCoordinate.w) * v_inversePlaneExtents.x;
    uv.y = czm_planeDistance(v_southPlane, eyeCoordinate.xyz / eyeCoordinate.w) * v_inversePlaneExtents.y;
#endif // SPHERICAL
#endif // TEXTURE_COORDINATES

#ifdef PICK
#ifdef CULL_FRAGMENTS
    // When classifying translucent geometry, logDepthOrDepth == 0.0
    // indicates a region that should not be classified, possibly due to there
    // being opaque pixels there in another buffer.
    // Check for logDepthOrDepth != 0.0 to make sure this should be classified.
    if (0.0 <= uv.x && uv.x <= 1.0 && 0.0 <= uv.y && uv.y <= 1.0 || logDepthOrDepth != 0.0) {
        out_FragColor.a = 1.0; // 0.0 alpha leads to discard from ShaderSource.createPickFragmentShaderSource
        czm_writeDepthClamp();
    }
#else // CULL_FRAGMENTS
        out_FragColor.a = 1.0;
#endif // CULL_FRAGMENTS
#else // PICK

#ifdef CULL_FRAGMENTS
    // When classifying translucent geometry, logDepthOrDepth == 0.0
    // indicates a region that should not be classified, possibly due to there
    // being opaque pixels there in another buffer.
    if (uv.x <= 0.0 || 1.0 <= uv.x || uv.y <= 0.0 || 1.0 <= uv.y || logDepthOrDepth == 0.0) {
        discard;
    }
#endif

#ifdef NORMAL_EC
    // Compute normal by sampling adjacent pixels in 2x2 block in screen space
    vec3 downUp = vectorFromOffset(eyeCoordinate, vec2(0.0, 1.0));
    vec3 leftRight = vectorFromOffset(eyeCoordinate, vec2(1.0, 0.0));
    vec3 normalEC = normalize(cross(leftRight, downUp));
#endif


#ifdef PER_INSTANCE_COLOR

    vec4 color = czm_gammaCorrect(v_color);
#ifdef FLAT
    out_FragColor = color;
#else // FLAT
    czm_materialInput materialInput;
    materialInput.normalEC = normalEC;
    materialInput.positionToEyeEC = -eyeCoordinate.xyz;
    czm_material material = czm_getDefaultMaterial(materialInput);
    material.diffuse = color.rgb;
    material.alpha = color.a;

    out_FragColor = czm_phong(normalize(-eyeCoordinate.xyz), material, czm_lightDirectionEC);
#endif // FLAT

    // Premultiply alpha. Required for classification primitives on translucent globe.
    out_FragColor.rgb *= out_FragColor.a;

#else // PER_INSTANCE_COLOR

    // Material support.
    // USES_ is distinct from REQUIRES_, because some things are dependencies of each other or
    // dependencies for culling but might not actually be used by the material.

    czm_materialInput materialInput;

#ifdef USES_NORMAL_EC
    materialInput.normalEC = normalEC;
#endif

#ifdef USES_POSITION_TO_EYE_EC
    materialInput.positionToEyeEC = -eyeCoordinate.xyz;
#endif

#ifdef USES_TANGENT_TO_EYE
    materialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(worldCoordinate, normalEC);
#endif

#ifdef USES_ST
    // Remap texture coordinates from computed (approximately aligned with cartographic space) to the desired
    // texture coordinate system, which typically forms a tight oriented bounding box around the geometry.
    // Shader is provided a set of reference points for remapping.
    materialInput.st.x = czm_lineDistance(v_uvMinAndSphericalLongitudeRotation.xy, v_uMaxAndInverseDistance.xy, uv) * v_uMaxAndInverseDistance.z;
    materialInput.st.y = czm_lineDistance(v_uvMinAndSphericalLongitudeRotation.xy, v_vMaxAndInverseDistance.xy, uv) * v_vMaxAndInverseDistance.z;
#endif

    czm_material material = czm_getMaterial(materialInput);

#ifdef FLAT
    out_FragColor = vec4(material.diffuse + material.emission, material.alpha);
#else // FLAT
    out_FragColor = czm_phong(normalize(-eyeCoordinate.xyz), material, czm_lightDirectionEC);
#endif // FLAT

    // Premultiply alpha. Required for classification primitives on translucent globe.
    out_FragColor.rgb *= out_FragColor.a;

#endif // PER_INSTANCE_COLOR
    czm_writeDepthClamp();
#endif // PICK
}
`;function ke(e,t,i){Q.typeOf.bool("extentsCulling",e),Q.typeOf.bool("planarExtents",t),Q.typeOf.object("appearance",i),this._projectionExtentDefines={eastMostYhighDefine:"",eastMostYlowDefine:"",westMostYhighDefine:"",westMostYlowDefine:""};const n=new cs;n.requiresTextureCoordinates=e,n.requiresEC=!i.flat;const o=new cs;if(o.requiresTextureCoordinates=e,i instanceof ri)n.requiresNormalEC=!i.flat;else{const s=`${i.material.shaderSource}
${i.fragmentShaderSource}`;n.normalEC=s.indexOf("materialInput.normalEC")!==-1||s.indexOf("czm_getDefaultMaterial")!==-1,n.positionToEyeEC=s.indexOf("materialInput.positionToEyeEC")!==-1,n.tangentToEyeMatrix=s.indexOf("materialInput.tangentToEyeMatrix")!==-1,n.st=s.indexOf("materialInput.st")!==-1}this._colorShaderDependencies=n,this._pickShaderDependencies=o,this._appearance=i,this._extentsCulling=e,this._planarExtents=t}ke.prototype.createFragmentShader=function(e){Q.typeOf.bool("columbusView2D",e);const t=this._appearance,i=this._colorShaderDependencies,n=[];!e&&!this._planarExtents&&n.push("SPHERICAL"),i.requiresEC&&n.push("REQUIRES_EC"),i.requiresWC&&n.push("REQUIRES_WC"),i.requiresTextureCoordinates&&n.push("TEXTURE_COORDINATES"),this._extentsCulling&&n.push("CULL_FRAGMENTS"),i.requiresNormalEC&&n.push("NORMAL_EC"),t instanceof ri&&n.push("PER_INSTANCE_COLOR"),i.normalEC&&n.push("USES_NORMAL_EC"),i.positionToEyeEC&&n.push("USES_POSITION_TO_EYE_EC"),i.tangentToEyeMatrix&&n.push("USES_TANGENT_TO_EYE"),i.st&&n.push("USES_ST"),t.flat&&n.push("FLAT");let o="";return t instanceof ri||(o=t.material.shaderSource),new ht({defines:n,sources:[o,sl]})};ke.prototype.createPickFragmentShader=function(e){Q.typeOf.bool("columbusView2D",e);const t=this._pickShaderDependencies,i=["PICK"];return!e&&!this._planarExtents&&i.push("SPHERICAL"),t.requiresEC&&i.push("REQUIRES_EC"),t.requiresWC&&i.push("REQUIRES_WC"),t.requiresTextureCoordinates&&i.push("TEXTURE_COORDINATES"),this._extentsCulling&&i.push("CULL_FRAGMENTS"),new ht({defines:i,sources:[sl],pickColorQualifier:"in"})};ke.prototype.createVertexShader=function(e,t,i,n){return Q.defined("defines",e),Q.typeOf.string("vertexShaderSource",t),Q.typeOf.bool("columbusView2D",i),Q.defined("mapProjection",n),rl(this._colorShaderDependencies,this._planarExtents,i,e,t,this._appearance,n,this._projectionExtentDefines)};ke.prototype.createPickVertexShader=function(e,t,i,n){return Q.defined("defines",e),Q.typeOf.string("vertexShaderSource",t),Q.typeOf.bool("columbusView2D",i),Q.defined("mapProjection",n),rl(this._pickShaderDependencies,this._planarExtents,i,e,t,void 0,n,this._projectionExtentDefines)};const Sr=new b,Er=new ae,br={high:0,low:0};function rl(e,t,i,n,o,s,r,l){const a=n.slice();if(l.eastMostYhighDefine===""){const c=Er;c.longitude=Z.PI,c.latitude=0,c.height=0;const d=r.project(c,Sr);let m=yt.encode(d.x,br);l.eastMostYhighDefine=`EAST_MOST_X_HIGH ${m.high.toFixed(`${m.high}`.length+1)}`,l.eastMostYlowDefine=`EAST_MOST_X_LOW ${m.low.toFixed(`${m.low}`.length+1)}`;const g=Er;g.longitude=-Z.PI,g.latitude=0,g.height=0;const y=r.project(g,Sr);m=yt.encode(y.x,br),l.westMostYhighDefine=`WEST_MOST_X_HIGH ${m.high.toFixed(`${m.high}`.length+1)}`,l.westMostYlowDefine=`WEST_MOST_X_LOW ${m.low.toFixed(`${m.low}`.length+1)}`}return i&&(a.push(l.eastMostYhighDefine),a.push(l.eastMostYlowDefine),a.push(l.westMostYhighDefine),a.push(l.westMostYlowDefine)),f(s)&&s instanceof ri&&a.push("PER_INSTANCE_COLOR"),e.requiresTextureCoordinates&&(a.push("TEXTURE_COORDINATES"),t||i||a.push("SPHERICAL"),i&&a.push("COLUMBUS_VIEW_2D")),new ht({defines:a,sources:[o]})}function cs(){this._requiresEC=!1,this._requiresWC=!1,this._requiresNormalEC=!1,this._requiresTextureCoordinates=!1,this._usesNormalEC=!1,this._usesPositionToEyeEC=!1,this._usesTangentToEyeMat=!1,this._usesSt=!1}Object.defineProperties(cs.prototype,{requiresEC:{get:function(){return this._requiresEC},set:function(e){this._requiresEC=e||this._requiresEC}},requiresWC:{get:function(){return this._requiresWC},set:function(e){this._requiresWC=e||this._requiresWC,this.requiresEC=this._requiresWC}},requiresNormalEC:{get:function(){return this._requiresNormalEC},set:function(e){this._requiresNormalEC=e||this._requiresNormalEC,this.requiresEC=this._requiresNormalEC}},requiresTextureCoordinates:{get:function(){return this._requiresTextureCoordinates},set:function(e){this._requiresTextureCoordinates=e||this._requiresTextureCoordinates,this.requiresWC=this._requiresTextureCoordinates}},normalEC:{set:function(e){this.requiresNormalEC=e,this._usesNormalEC=e},get:function(){return this._usesNormalEC}},tangentToEyeMatrix:{set:function(e){this.requiresWC=e,this.requiresNormalEC=e,this._usesTangentToEyeMat=e},get:function(){return this._usesTangentToEyeMat}},positionToEyeEC:{set:function(e){this.requiresEC=e,this._usesPositionToEyeEC=e},get:function(){return this._usesPositionToEyeEC}},st:{set:function(e){this.requiresTextureCoordinates=e,this._usesSt=e},get:function(){return this._usesSt}}});function Dr(e,t,i){return Math.abs((t.y-e.y)*i.x-(t.x-e.x)*i.y+t.x*e.y-t.y*e.x)/Y.distance(t,e)}const Hd=[new Y,new Y,new Y,new Y];function al(e,t){const i=Hd,n=Y.unpack(t,0,i[0]),o=Y.unpack(t,2,i[1]),s=Y.unpack(t,4,i[2]);e.uMaxVmax=new Ot({componentDatatype:et.FLOAT,componentsPerAttribute:4,normalize:!1,value:[o.x,o.y,s.x,s.y]});const r=1/Dr(n,o,s),l=1/Dr(n,s,o);e.uvMinAndExtents=new Ot({componentDatatype:et.FLOAT,componentsPerAttribute:4,normalize:!1,value:[n.x,n.y,r,l]})}const ll=new ae,cl=new b,Wd=new b,qd=new b,Hn={high:0,low:0};function dl(e,t,i){const n=ll;n.height=0,n.longitude=e.west,n.latitude=e.south;const o=t.project(n,cl);n.latitude=e.north;const s=t.project(n,Wd);n.longitude=e.east,n.latitude=e.south;const r=t.project(n,qd),l=[0,0,0,0],a=[0,0,0,0];let c=yt.encode(o.x,Hn);l[0]=c.high,a[0]=c.low,c=yt.encode(o.y,Hn),l[1]=c.high,a[1]=c.low,c=yt.encode(s.y,Hn),l[2]=c.high,a[2]=c.low,c=yt.encode(r.x,Hn),l[3]=c.high,a[3]=c.low,i.planes2D_HIGH=new Ot({componentDatatype:et.FLOAT,componentsPerAttribute:4,normalize:!1,value:l}),i.planes2D_LOW=new Ot({componentDatatype:et.FLOAT,componentsPerAttribute:4,normalize:!1,value:a})}const Gd=new qt,Yd=new qt,Tr=new b,jd=new ae,Xd=[new ae,new ae,new ae,new ae,new ae,new ae,new ae,new ae];function Zd(e,t,i,n,o,s){const r=Mt.center(e,jd);r.height=i;const l=ae.toCartesian(r,t,Tr),a=fo.eastNorthUpToFixedFrame(l,t,Gd),c=qt.inverse(a,Yd),d=e.west,m=e.east,g=e.north,y=e.south,w=Xd;w[0].latitude=y,w[0].longitude=d,w[1].latitude=g,w[1].longitude=d,w[2].latitude=g,w[2].longitude=m,w[3].latitude=y,w[3].longitude=m;const p=(d+m)*.5,u=(g+y)*.5;w[4].latitude=y,w[4].longitude=p,w[5].latitude=g,w[5].longitude=p,w[6].latitude=u,w[6].longitude=d,w[7].latitude=u,w[7].longitude=m;let _=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,S=Number.POSITIVE_INFINITY,I=Number.NEGATIVE_INFINITY;for(let v=0;v<8;v++){w[v].height=i;const A=ae.toCartesian(w[v],t,Tr);qt.multiplyByPoint(c,A,A),A.z=0,_=Math.min(_,A.x),x=Math.max(x,A.x),S=Math.min(S,A.y),I=Math.max(I,A.y)}const D=n;D.x=_,D.y=S,D.z=0,qt.multiplyByPoint(a,D,D);const E=o;E.x=x,E.y=S,E.z=0,qt.multiplyByPoint(a,E,E),b.subtract(E,D,o);const T=s;T.x=_,T.y=I,T.z=0,qt.multiplyByPoint(a,T,T),b.subtract(T,D,s)}const Kd=new b,$d=new b,Jd=new yt;ke.getPlanarTextureCoordinateAttributes=function(e,t,i,n,o){Q.typeOf.object("boundingRectangle",e),Q.defined("textureCoordinateRotationPoints",t),Q.typeOf.object("ellipsoid",i),Q.typeOf.object("projection",n);const s=cl,r=Kd,l=$d;Zd(e,i,h(o,0),s,r,l);const a={};al(a,t);const c=yt.fromCartesian(s,Jd);return a.southWest_HIGH=new Ot({componentDatatype:et.FLOAT,componentsPerAttribute:3,normalize:!1,value:b.pack(c.high,[0,0,0])}),a.southWest_LOW=new Ot({componentDatatype:et.FLOAT,componentsPerAttribute:3,normalize:!1,value:b.pack(c.low,[0,0,0])}),a.eastward=new Ot({componentDatatype:et.FLOAT,componentsPerAttribute:3,normalize:!1,value:b.pack(r,[0,0,0])}),a.northward=new Ot({componentDatatype:et.FLOAT,componentsPerAttribute:3,normalize:!1,value:b.pack(l,[0,0,0])}),dl(e,n,a),a};const Qd=new b;function Ir(e,t,i,n){const o=ll;o.latitude=e,o.longitude=t,o.height=0;const s=ae.toCartesian(o,i,Qd),r=Math.sqrt(s.x*s.x+s.y*s.y),l=Z.fastApproximateAtan2(r,s.z),a=Z.fastApproximateAtan2(s.x,s.y);return n.x=l,n.y=a,n}const vr=new Y;ke.getSphericalExtentGeometryInstanceAttributes=function(e,t,i,n){Q.typeOf.object("boundingRectangle",e),Q.defined("textureCoordinateRotationPoints",t),Q.typeOf.object("ellipsoid",i),Q.typeOf.object("projection",n);const o=Ir(e.south,e.west,i,vr);let s=o.x,r=o.y;const l=Ir(e.north,e.east,i,vr);let a=l.x,c=l.y,d=0;r>c&&(d=Z.PI-r,r=-Z.PI,c+=d),s-=Z.EPSILON5,r-=Z.EPSILON5,a+=Z.EPSILON5,c+=Z.EPSILON5;const m=1/(c-r),g=1/(a-s),y={sphericalExtents:new Ot({componentDatatype:et.FLOAT,componentsPerAttribute:4,normalize:!1,value:[s,r,g,m]}),longitudeRotation:new Ot({componentDatatype:et.FLOAT,componentsPerAttribute:1,normalize:!1,value:[d]})};return al(y,t),dl(e,n,y),y};ke.hasAttributesForTextureCoordinatePlanes=function(e){return f(e.southWest_HIGH)&&f(e.southWest_LOW)&&f(e.northward)&&f(e.eastward)&&f(e.planes2D_HIGH)&&f(e.planes2D_LOW)&&f(e.uMaxVmax)&&f(e.uvMinAndExtents)};ke.hasAttributesForSphericalExtents=function(e){return f(e.sphericalExtents)&&f(e.longitudeRotation)&&f(e.planes2D_HIGH)&&f(e.planes2D_LOW)&&f(e.uMaxVmax)&&f(e.uvMinAndExtents)};function eh(e){return Math.max(e.width,e.height)>ke.MAX_WIDTH_FOR_PLANAR_EXTENTS}ke.shouldUseSphericalCoordinates=function(e){return Q.typeOf.object("rectangle",e),eh(e)};ke.MAX_WIDTH_FOR_PLANAR_EXTENTS=Z.toRadians(1);function mi(e){e=h(e,h.EMPTY_OBJECT);const t=e.geometryInstances;this.geometryInstances=t,this.show=h(e.show,!0),this.classificationType=h(e.classificationType,Zt.BOTH),this.debugShowBoundingVolume=h(e.debugShowBoundingVolume,!1),this.debugShowShadowVolume=h(e.debugShowShadowVolume,!1),this._debugShowShadowVolume=!1,this._extruded=h(e._extruded,!1),this._uniformMap=e._uniformMap,this._sp=void 0,this._spStencil=void 0,this._spPick=void 0,this._spColor=void 0,this._spPick2D=void 0,this._spColor2D=void 0,this._rsStencilDepthPass=void 0,this._rsStencilDepthPass3DTiles=void 0,this._rsColorPass=void 0,this._rsPickPass=void 0,this._commandsIgnoreShow=[],this._ready=!1,this._primitive=void 0,this._pickPrimitive=e._pickPrimitive,this._hasSphericalExtentsAttribute=!1,this._hasPlanarExtentsAttributes=!1,this._hasPerColorAttribute=!1,this.appearance=e.appearance,this._createBoundingVolumeFunction=e._createBoundingVolumeFunction,this._updateAndQueueCommandsFunction=e._updateAndQueueCommandsFunction,this._usePickOffsets=!1,this._primitiveOptions={geometryInstances:void 0,appearance:void 0,vertexCacheOptimize:h(e.vertexCacheOptimize,!1),interleave:h(e.interleave,!1),releaseGeometryInstances:h(e.releaseGeometryInstances,!0),allowPicking:h(e.allowPicking,!0),asynchronous:h(e.asynchronous,!0),compressVertices:h(e.compressVertices,!0),_createBoundingVolumeFunction:void 0,_createRenderStatesFunction:void 0,_createShaderProgramFunction:void 0,_createCommandsFunction:void 0,_updateAndQueueCommandsFunction:void 0,_createPickOffsets:!0}}Object.defineProperties(mi.prototype,{vertexCacheOptimize:{get:function(){return this._primitiveOptions.vertexCacheOptimize}},interleave:{get:function(){return this._primitiveOptions.interleave}},releaseGeometryInstances:{get:function(){return this._primitiveOptions.releaseGeometryInstances}},allowPicking:{get:function(){return this._primitiveOptions.allowPicking}},asynchronous:{get:function(){return this._primitiveOptions.asynchronous}},compressVertices:{get:function(){return this._primitiveOptions.compressVertices}},ready:{get:function(){return this._ready}},_needs2DShader:{get:function(){return this._hasPlanarExtentsAttributes||this._hasSphericalExtentsAttribute}}});mi.isSupported=function(e){return e.context.stencilBuffer};function Yi(e,t){const i=t?ci.EQUAL:ci.ALWAYS;return{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},stencilTest:{enabled:e,frontFunction:i,frontOperation:{fail:xe.KEEP,zFail:xe.DECREMENT_WRAP,zPass:xe.KEEP},backFunction:i,backOperation:{fail:xe.KEEP,zFail:xe.INCREMENT_WRAP,zPass:xe.KEEP},reference:Yt.CESIUM_3D_TILE_MASK,mask:Yt.CESIUM_3D_TILE_MASK},stencilMask:Yt.CLASSIFICATION_MASK,depthTest:{enabled:!0,func:Dc.LESS_OR_EQUAL},depthMask:!1}}function ds(e){return{stencilTest:{enabled:e,frontFunction:ci.NOT_EQUAL,frontOperation:{fail:xe.ZERO,zFail:xe.ZERO,zPass:xe.ZERO},backFunction:ci.NOT_EQUAL,backOperation:{fail:xe.ZERO,zFail:xe.ZERO,zPass:xe.ZERO},reference:0,mask:Yt.CLASSIFICATION_MASK},stencilMask:Yt.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1,blending:Ds.PRE_MULTIPLIED_ALPHA_BLEND}}const th={stencilTest:{enabled:!0,frontFunction:ci.NOT_EQUAL,frontOperation:{fail:xe.ZERO,zFail:xe.ZERO,zPass:xe.ZERO},backFunction:ci.NOT_EQUAL,backOperation:{fail:xe.ZERO,zFail:xe.ZERO,zPass:xe.ZERO},reference:0,mask:Yt.CLASSIFICATION_MASK},stencilMask:Yt.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1};function ih(e,t,i,n){if(f(e._rsStencilDepthPass))return;const o=!e.debugShowShadowVolume;e._rsStencilDepthPass=mt.fromCache(Yi(o,!1)),e._rsStencilDepthPass3DTiles=mt.fromCache(Yi(o,!0)),e._rsColorPass=mt.fromCache(ds(o)),e._rsPickPass=mt.fromCache(th)}function nh(e,t){if(!e.compressVertices)return t;if(t.search(/in\s+vec3\s+extrudeDirection;/g)!==-1){const i="compressedAttributes",n=`in vec2 ${i};`,o=`vec3 extrudeDirection;
`,s=`    extrudeDirection = czm_octDecode(${i}, 65535.0);
`;let r=t;r=r.replace(/in\s+vec3\s+extrudeDirection;/g,""),r=ht.replaceMain(r,"czm_non_compressed_main");const l=`void main() 
{ 
${s}    czm_non_compressed_main(); 
}`;return[n,o,r,l].join(`
`)}}function oh(e,t){const i=t.context,n=e._primitive;let o=Vd;o=e._primitive._batchTable.getVertexShaderCallback()(o),o=Ue._appendDistanceDisplayConditionToShader(n,o),o=Ue._modifyShaderPosition(e,o,t.scene3DOnly),o=Ue._updateColorAttribute(n,o);const s=e._hasPlanarExtentsAttributes,r=s||e._hasSphericalExtentsAttribute;e._extruded&&(o=nh(n,o));const l=e._extruded?"EXTRUDED_GEOMETRY":"";let a=new ht({defines:[l],sources:[o]});const c=new ht({sources:[Tc]}),d=e._primitive._attributeLocations,m=new ke(r,s,e.appearance);if(e._spStencil=Hi.replaceCache({context:i,shaderProgram:e._spStencil,vertexShaderSource:a,fragmentShaderSource:c,attributeLocations:d}),e._primitive.allowPicking){let w=ht.createPickVertexShaderSource(o);w=Ue._appendShowToShader(n,w),w=Ue._updatePickColorAttribute(w);const p=m.createPickFragmentShader(!1),u=m.createPickVertexShader([l],w,!1,t.mapProjection);if(e._spPick=Hi.replaceCache({context:i,shaderProgram:e._spPick,vertexShaderSource:u,fragmentShaderSource:p,attributeLocations:d}),r){let _=i.shaderCache.getDerivedShaderProgram(e._spPick,"2dPick");if(!f(_)){const x=m.createPickFragmentShader(!0),S=m.createPickVertexShader([l],w,!0,t.mapProjection);_=i.shaderCache.createDerivedShaderProgram(e._spPick,"2dPick",{vertexShaderSource:S,fragmentShaderSource:x,attributeLocations:d})}e._spPick2D=_}}else e._spPick=Hi.fromCache({context:i,vertexShaderSource:a,fragmentShaderSource:c,attributeLocations:d});o=Ue._appendShowToShader(n,o),a=new ht({defines:[l],sources:[o]}),e._sp=Hi.replaceCache({context:i,shaderProgram:e._sp,vertexShaderSource:a,fragmentShaderSource:c,attributeLocations:d});const g=m.createFragmentShader(!1),y=m.createVertexShader([l],o,!1,t.mapProjection);if(e._spColor=Hi.replaceCache({context:i,shaderProgram:e._spColor,vertexShaderSource:y,fragmentShaderSource:g,attributeLocations:d}),r){let w=i.shaderCache.getDerivedShaderProgram(e._spColor,"2dColor");if(!f(w)){const p=m.createFragmentShader(!0),u=m.createVertexShader([l],o,!0,t.mapProjection);w=i.shaderCache.createDerivedShaderProgram(e._spColor,"2dColor",{vertexShaderSource:u,fragmentShaderSource:p,attributeLocations:d})}e._spColor2D=w}}function sh(e,t){const i=e._primitive;let n=i._va.length*2;t.length=n;let o,s,r,l=0,a=i._batchTable.getUniformMapCallback()(e._uniformMap);const c=e._needs2DShader;for(o=0;o<n;o+=2){const y=i._va[l++];s=t[o],f(s)||(s=t[o]=new Pe({owner:e,primitiveType:i._primitiveType})),s.vertexArray=y,s.renderState=e._rsStencilDepthPass,s.shaderProgram=e._sp,s.uniformMap=a,s.pass=At.TERRAIN_CLASSIFICATION,r=Pe.shallowClone(s,s.derivedCommands.tileset),r.renderState=e._rsStencilDepthPass3DTiles,r.pass=At.CESIUM_3D_TILE_CLASSIFICATION,s.derivedCommands.tileset=r,s=t[o+1],f(s)||(s=t[o+1]=new Pe({owner:e,primitiveType:i._primitiveType})),s.vertexArray=y,s.renderState=e._rsColorPass,s.shaderProgram=e._spColor,s.pass=At.TERRAIN_CLASSIFICATION;const p=e.appearance.material;if(f(p)&&(a=Ic(a,p._uniforms)),s.uniformMap=a,r=Pe.shallowClone(s,s.derivedCommands.tileset),r.pass=At.CESIUM_3D_TILE_CLASSIFICATION,s.derivedCommands.tileset=r,c){let u=Pe.shallowClone(s,s.derivedCommands.appearance2D);u.shaderProgram=e._spColor2D,s.derivedCommands.appearance2D=u,u=Pe.shallowClone(r,r.derivedCommands.appearance2D),u.shaderProgram=e._spColor2D,r.derivedCommands.appearance2D=u}}const d=e._commandsIgnoreShow,m=e._spStencil;let g=0;n=d.length=n/2;for(let y=0;y<n;++y){const w=d[y]=Pe.shallowClone(t[g],d[y]);w.shaderProgram=m,w.pass=At.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW,g+=2}}function rh(e,t){const i=e._usePickOffsets,n=e._primitive;let o=n._va.length*2,s,r=0,l;i&&(s=n._pickOffsets,o=s.length*2),t.length=o;let a,c,d,m=0;const g=n._batchTable.getUniformMapCallback()(e._uniformMap),y=e._needs2DShader;for(a=0;a<o;a+=2){let w=n._va[m++];if(i&&(l=s[r++],w=n._va[l.index]),c=t[a],f(c)||(c=t[a]=new Pe({owner:e,primitiveType:n._primitiveType,pickOnly:!0})),c.vertexArray=w,c.renderState=e._rsStencilDepthPass,c.shaderProgram=e._sp,c.uniformMap=g,c.pass=At.TERRAIN_CLASSIFICATION,i&&(c.offset=l.offset,c.count=l.count),d=Pe.shallowClone(c,c.derivedCommands.tileset),d.renderState=e._rsStencilDepthPass3DTiles,d.pass=At.CESIUM_3D_TILE_CLASSIFICATION,c.derivedCommands.tileset=d,c=t[a+1],f(c)||(c=t[a+1]=new Pe({owner:e,primitiveType:n._primitiveType,pickOnly:!0})),c.vertexArray=w,c.renderState=e._rsPickPass,c.shaderProgram=e._spPick,c.uniformMap=g,c.pass=At.TERRAIN_CLASSIFICATION,i&&(c.offset=l.offset,c.count=l.count),d=Pe.shallowClone(c,c.derivedCommands.tileset),d.pass=At.CESIUM_3D_TILE_CLASSIFICATION,c.derivedCommands.tileset=d,y){let p=Pe.shallowClone(c,c.derivedCommands.pick2D);p.shaderProgram=e._spPick2D,c.derivedCommands.pick2D=p,p=Pe.shallowClone(d,d.derivedCommands.pick2D),p.shaderProgram=e._spPick2D,d.derivedCommands.pick2D=p}}}function ah(e,t,i,n,o,s,r){sh(e,s),rh(e,r)}function Ar(e,t){return Math.floor(e%t/2)}function Fo(e,t,i,n,o,s){e.modelMatrix=i,e.boundingVolume=o,e.cull=n,e.debugShowBoundingVolume=s,t.commandList.push(e)}function Or(e,t,i,n,o){e.modelMatrix=i,e.boundingVolume=o,e.cull=n,t.commandList.push(e)}function lh(e,t,i,n,o,s,r,l){const a=e._primitive;Ue._updateBoundingVolumes(a,t,o);let c;t.mode===wt.SCENE3D?c=a._boundingSphereWC:t.mode===wt.COLUMBUS_VIEW?c=a._boundingSphereCV:t.mode===wt.SCENE2D&&f(a._boundingSphere2D)?c=a._boundingSphere2D:f(a._boundingSphereMorph)&&(c=a._boundingSphereMorph);const d=e.classificationType,m=d!==Zt.CESIUM_3D_TILE,g=d!==Zt.TERRAIN,y=t.passes;let w,p,u;if(y.render){const _=i.length;for(w=0;w<_;++w)p=c[Ar(w,_)],m&&(u=i[w],Fo(u,t,o,s,p,r)),g&&(u=i[w].derivedCommands.tileset,Fo(u,t,o,s,p,r));if(t.invertClassification){const x=e._commandsIgnoreShow,S=x.length;for(w=0;w<S;++w)p=c[w],u=x[w],Fo(u,t,o,s,p,r)}}if(y.pick){const _=n.length,x=a._pickOffsets;for(w=0;w<_;++w){const S=x[Ar(w,_)];p=c[S.index],m&&(u=n[w],Or(u,t,o,s,p)),g&&(u=n[w].derivedCommands.tileset,Or(u,t,o,s,p))}}}mi.prototype.update=function(e){if(!f(this._primitive)&&!f(this.geometryInstances))return;let t=this.appearance;f(t)&&f(t.material)&&t.material.update(e.context);const i=this,n=this._primitiveOptions;if(!f(this._primitive)){const o=Array.isArray(this.geometryInstances)?this.geometryInstances:[this.geometryInstances],s=o.length;let r,l,a,c=!1,d=!0,m,g=!1,y=!1;for(s>0&&(a=o[0].attributes,g=ke.hasAttributesForSphericalExtents(a),y=ke.hasAttributesForTextureCoordinatePlanes(a),m=a.color),r=0;r<s;r++){l=o[r];const p=l.attributes.color;if(f(p))c=!0;else if(c)throw new N("All GeometryInstances must have color attributes to use per-instance color.");d=d&&f(p)&&bc.equals(m,p)}if(!d&&!g&&!y)throw new N("All GeometryInstances must have the same color attribute except via GroundPrimitives");if(c&&!f(t)&&(t=new ri({flat:!0}),this.appearance=t),!c&&t instanceof ri)throw new N("PerInstanceColorAppearance requires color GeometryInstanceAttributes on all GeometryInstances");if(f(t.material)&&!g&&!y)throw new N("Materials on ClassificationPrimitives are not supported except via GroundPrimitives");this._usePickOffsets=!g&&!y,this._hasSphericalExtentsAttribute=g,this._hasPlanarExtentsAttributes=y,this._hasPerColorAttribute=c;const w=new Array(s);for(r=0;r<s;++r)l=o[r],w[r]=new oo({geometry:l.geometry,attributes:l.attributes,modelMatrix:l.modelMatrix,id:l.id,pickPrimitive:h(this._pickPrimitive,i)});n.appearance=t,n.geometryInstances=w,f(this._createBoundingVolumeFunction)&&(n._createBoundingVolumeFunction=function(p,u){i._createBoundingVolumeFunction(p,u)}),n._createRenderStatesFunction=function(p,u,_,x){ih(i)},n._createShaderProgramFunction=function(p,u,_){oh(i,u)},n._createCommandsFunction=function(p,u,_,x,S,I,D){ah(i,void 0,void 0,!0,!1,I,D)},f(this._updateAndQueueCommandsFunction)?n._updateAndQueueCommandsFunction=function(p,u,_,x,S,I,D,E){i._updateAndQueueCommandsFunction(p,u,_,x,S,I,D,E)}:n._updateAndQueueCommandsFunction=function(p,u,_,x,S,I,D,E){lh(i,u,_,x,S,I,D)},this._primitive=new Ue(n)}if(this.debugShowShadowVolume&&!this._debugShowShadowVolume&&this._ready?(this._debugShowShadowVolume=!0,this._rsStencilDepthPass=mt.fromCache(Yi(!1,!1)),this._rsStencilDepthPass3DTiles=mt.fromCache(Yi(!1,!0)),this._rsColorPass=mt.fromCache(ds(!1))):!this.debugShowShadowVolume&&this._debugShowShadowVolume&&(this._debugShowShadowVolume=!1,this._rsStencilDepthPass=mt.fromCache(Yi(!0,!1)),this._rsStencilDepthPass3DTiles=mt.fromCache(Yi(!0,!0)),this._rsColorPass=mt.fromCache(ds(!0))),this._primitive.appearance!==t){if(!this._hasSphericalExtentsAttribute&&!this._hasPlanarExtentsAttributes&&f(t.material))throw new N("Materials on ClassificationPrimitives are not supported except via GroundPrimitive");if(!this._hasPerColorAttribute&&t instanceof ri)throw new N("PerInstanceColorAppearance requires color GeometryInstanceAttribute");this._primitive.appearance=t}this._primitive.show=this.show,this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume,this._primitive.update(e),e.afterRender.push(()=>{f(this._primitive)&&this._primitive.ready&&(this._ready=!0,this.releaseGeometryInstances&&(this.geometryInstances=void 0))})};mi.prototype.getGeometryInstanceAttributes=function(e){if(!f(this._primitive))throw new N("must call update before calling getGeometryInstanceAttributes");return this._primitive.getGeometryInstanceAttributes(e)};mi.prototype.isDestroyed=function(){return!1};mi.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),this._sp=this._sp&&this._sp.destroy(),this._spPick=this._spPick&&this._spPick.destroy(),this._spColor=this._spColor&&this._spColor.destroy(),this._spPick2D=void 0,this._spColor2D=void 0,ho(this)};const ch={u_globeMinimumAltitude:function(){return 55e3}};function tt(e){e=h(e,h.EMPTY_OBJECT);let t=e.appearance;const i=e.geometryInstances;if(!f(t)&&f(i)){const o=Array.isArray(i)?i:[i],s=o.length;for(let r=0;r<s;r++){const l=o[r].attributes;if(f(l)&&f(l.color)){t=new ri({flat:!0});break}}}this.appearance=t,this.geometryInstances=e.geometryInstances,this.show=h(e.show,!0),this.classificationType=h(e.classificationType,Zt.BOTH),this.debugShowBoundingVolume=h(e.debugShowBoundingVolume,!1),this.debugShowShadowVolume=h(e.debugShowShadowVolume,!1),this._boundingVolumes=[],this._boundingVolumes2D=[],this._ready=!1,this._primitive=void 0,this._maxHeight=void 0,this._minHeight=void 0,this._maxTerrainHeight=Ut._defaultMaxTerrainHeight,this._minTerrainHeight=Ut._defaultMinTerrainHeight,this._boundingSpheresKeys=[],this._boundingSpheres=[],this._useFragmentCulling=!1,this._zIndex=void 0;const n=this;this._classificationPrimitiveOptions={geometryInstances:void 0,appearance:void 0,vertexCacheOptimize:h(e.vertexCacheOptimize,!1),interleave:h(e.interleave,!1),releaseGeometryInstances:h(e.releaseGeometryInstances,!0),allowPicking:h(e.allowPicking,!0),asynchronous:h(e.asynchronous,!0),compressVertices:h(e.compressVertices,!0),_createBoundingVolumeFunction:void 0,_updateAndQueueCommandsFunction:void 0,_pickPrimitive:n,_extruded:!0,_uniformMap:ch}}Object.defineProperties(tt.prototype,{vertexCacheOptimize:{get:function(){return this._classificationPrimitiveOptions.vertexCacheOptimize}},interleave:{get:function(){return this._classificationPrimitiveOptions.interleave}},releaseGeometryInstances:{get:function(){return this._classificationPrimitiveOptions.releaseGeometryInstances}},allowPicking:{get:function(){return this._classificationPrimitiveOptions.allowPicking}},asynchronous:{get:function(){return this._classificationPrimitiveOptions.asynchronous}},compressVertices:{get:function(){return this._classificationPrimitiveOptions.compressVertices}},ready:{get:function(){return this._ready}}});tt.isSupported=mi.isSupported;function Pr(e){return function(t,i){const n=i.maximumRadius,o=n/Math.cos(t*.5)-n;return e._maxHeight+o}}function Rr(e){return function(t,i){return e._minHeight}}const dh=new b,hh=new b,uh=new b,fh=new ae,ph=new Mt;function Qn(e,t){const i=e.mapProjection.ellipsoid;if(!f(t.attributes)||!f(t.attributes.position3DHigh))return f(t.rectangle)?t.rectangle:void 0;const n=t.attributes.position3DHigh.values,o=t.attributes.position3DLow.values,s=n.length;let r=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;for(let m=0;m<s;m+=3){const g=b.unpack(n,m,dh),y=b.unpack(o,m,hh),w=b.add(g,y,uh),p=i.cartesianToCartographic(w,fh),u=p.latitude,_=p.longitude;r=Math.min(r,u),l=Math.min(l,_),a=Math.max(a,u),c=Math.max(c,_)}const d=ph;return d.north=a,d.south=r,d.east=c,d.west=l,d}function _h(e,t,i){const n=Ut.getMinimumMaximumHeights(t,i);e._minTerrainHeight=n.minimumTerrainHeight,e._maxTerrainHeight=n.maximumTerrainHeight}function mh(e,t,i){const n=t.mapProjection.ellipsoid,o=Qn(t,i),s=vc.fromRectangle(o,e._minHeight,e._maxHeight,n);if(e._boundingVolumes.push(s),!t.scene3DOnly){const r=t.mapProjection,l=Xi.fromRectangleWithHeights2D(o,r,e._maxHeight,e._minHeight);b.fromElements(l.center.z,l.center.x,l.center.y,l.center),e._boundingVolumes2D.push(l)}}function zo(e,t){return Math.floor(e%t/2)}function Bo(e,t,i,n,o,s,r){const l=e._primitive;i.mode!==wt.SCENE3D&&t.shaderProgram===l._spColor&&l._needs2DShader&&(t=t.derivedCommands.appearance2D),t.owner=e,t.modelMatrix=n,t.boundingVolume=s,t.cull=o,t.debugShowBoundingVolume=r,i.commandList.push(t)}function Nr(e,t,i,n,o,s){const r=e._primitive;i.mode!==wt.SCENE3D&&t.shaderProgram===r._spPick&&r._needs2DShader&&(t=t.derivedCommands.pick2D),t.owner=e,t.modelMatrix=n,t.boundingVolume=s,t.cull=o,i.commandList.push(t)}function gh(e,t,i,n,o,s,r,l){let a;t.mode===wt.SCENE3D?a=e._boundingVolumes:a=e._boundingVolumes2D;const c=e.classificationType,d=c!==Zt.CESIUM_3D_TILE,m=c!==Zt.TERRAIN,g=t.passes,y=e._primitive;let w,p,u;if(g.render){const _=i.length;for(w=0;w<_;++w)p=a[zo(w,_)],d&&(u=i[w],Bo(e,u,t,o,s,p,r)),m&&(u=i[w].derivedCommands.tileset,Bo(e,u,t,o,s,p,r));if(t.invertClassification){const x=y._commandsIgnoreShow,S=x.length;for(w=0;w<S;++w)p=a[w],u=x[w],Bo(e,u,t,o,s,p,r)}}if(g.pick){const _=n.length;let x;for(e._useFragmentCulling||(x=y._primitive._pickOffsets),w=0;w<_;++w){if(p=a[zo(w,_)],!e._useFragmentCulling){const S=x[zo(w,_)];p=a[S.index]}d&&(u=n[w],Nr(e,u,t,o,s,p)),m&&(u=n[w].derivedCommands.tileset,Nr(e,u,t,o,s,p))}}}tt.initializeTerrainHeights=function(){return Ut.initialize()};tt.prototype.update=function(e){if(!f(this._primitive)&&!f(this.geometryInstances))return;if(!Ut.initialized){if(!this.asynchronous)throw new N("For synchronous GroundPrimitives, you must call GroundPrimitive.initializeTerrainHeights() and wait for the returned promise to resolve.");tt.initializeTerrainHeights();return}const t=this,i=this._classificationPrimitiveOptions;if(!f(this._primitive)){const n=e.mapProjection.ellipsoid;let o,s,r;const l=Array.isArray(this.geometryInstances)?this.geometryInstances:[this.geometryInstances],a=l.length,c=new Array(a);let d,m;for(d=0;d<a;++d){o=l[d],s=o.geometry;const p=Qn(e,s);f(m)?f(p)&&Mt.union(m,p,m):m=Mt.clone(p);const u=o.id;if(f(u)&&f(p)){const _=Ut.getBoundingSphere(p,n);this._boundingSpheresKeys.push(u),this._boundingSpheres.push(_)}if(r=s.constructor,!f(r)||!f(r.createShadowVolume))throw new N("Not all of the geometry instances have GroundPrimitive support.")}_h(this,m,n);const g=e.verticalExaggeration,y=e.verticalExaggerationRelativeHeight;this._minHeight=Gs.getHeight(this._minTerrainHeight,g,y),this._maxHeight=Gs.getHeight(this._maxTerrainHeight,g,y);const w=tt._supportsMaterials(e.context);if(this._useFragmentCulling=w,w){let p,u=!0;for(d=0;d<a;++d)if(o=l[d],s=o.geometry,m=Qn(e,s),ke.shouldUseSphericalCoordinates(m)){u=!1;break}for(d=0;d<a;++d){o=l[d],s=o.geometry,r=s.constructor;const _=Qn(e,s),x=s.textureCoordinateRotationPoints;u?p=ke.getPlanarTextureCoordinateAttributes(_,x,n,e.mapProjection,this._maxHeight):p=ke.getSphericalExtentGeometryInstanceAttributes(_,x,n,e.mapProjection);const S=o.attributes;for(const I in S)S.hasOwnProperty(I)&&(p[I]=S[I]);c[d]=new oo({geometry:r.createShadowVolume(s,Rr(this),Pr(this)),attributes:p,id:o.id})}}else for(d=0;d<a;++d)o=l[d],s=o.geometry,r=s.constructor,c[d]=new oo({geometry:r.createShadowVolume(s,Rr(this),Pr(this)),attributes:o.attributes,id:o.id});i.geometryInstances=c,i.appearance=this.appearance,i._createBoundingVolumeFunction=function(p,u){mh(t,p,u)},i._updateAndQueueCommandsFunction=function(p,u,_,x,S,I,D,E){gh(t,u,_,x,S,I,D)},this._primitive=new mi(i)}this._primitive.appearance=this.appearance,this._primitive.show=this.show,this._primitive.debugShowShadowVolume=this.debugShowShadowVolume,this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume,this._primitive.update(e),e.afterRender.push(()=>{!this._ready&&f(this._primitive)&&this._primitive.ready&&(this._ready=!0,this.releaseGeometryInstances&&(this.geometryInstances=void 0))})};tt.prototype.getBoundingSphere=function(e){const t=this._boundingSpheresKeys.indexOf(e);if(t!==-1)return this._boundingSpheres[t]};tt.prototype.getGeometryInstanceAttributes=function(e){if(!f(this._primitive))throw new N("must call update before calling getGeometryInstanceAttributes");return this._primitive.getGeometryInstanceAttributes(e)};tt.prototype.isDestroyed=function(){return!1};tt.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),ho(this)};tt._supportsMaterials=function(e){return e.depthTexture};tt.supportsMaterials=function(e){return Q.typeOf.object("scene",e),tt._supportsMaterials(e.frameState.context)};const yh=`in vec4 v_startPlaneNormalEcAndHalfWidth;
in vec4 v_endPlaneNormalEcAndBatchId;
in vec4 v_rightPlaneEC; // Technically can compute distance for this here
in vec4 v_endEcAndStartEcX;
in vec4 v_texcoordNormalizationAndStartEcYZ;

#ifdef PER_INSTANCE_COLOR
in vec4 v_color;
#endif

void main(void)
{
    float logDepthOrDepth = czm_branchFreeTernary(czm_sceneMode == czm_sceneMode2D, gl_FragCoord.z, czm_unpackDepth(texture(czm_globeDepthTexture, gl_FragCoord.xy / czm_viewport.zw)));
    vec3 ecStart = vec3(v_endEcAndStartEcX.w, v_texcoordNormalizationAndStartEcYZ.zw);

    // Discard for sky
    if (logDepthOrDepth == 0.0) {
#ifdef DEBUG_SHOW_VOLUME
        out_FragColor = vec4(1.0, 0.0, 0.0, 0.5);
        return;
#else // DEBUG_SHOW_VOLUME
        discard;
#endif // DEBUG_SHOW_VOLUME
    }

    vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth);
    eyeCoordinate /= eyeCoordinate.w;

    float halfMaxWidth = v_startPlaneNormalEcAndHalfWidth.w * czm_metersPerPixel(eyeCoordinate);
    // Check distance of the eye coordinate against the right-facing plane
    float widthwiseDistance = czm_planeDistance(v_rightPlaneEC, eyeCoordinate.xyz);

    // Check eye coordinate against the mitering planes
    float distanceFromStart = czm_planeDistance(v_startPlaneNormalEcAndHalfWidth.xyz, -dot(ecStart, v_startPlaneNormalEcAndHalfWidth.xyz), eyeCoordinate.xyz);
    float distanceFromEnd = czm_planeDistance(v_endPlaneNormalEcAndBatchId.xyz, -dot(v_endEcAndStartEcX.xyz, v_endPlaneNormalEcAndBatchId.xyz), eyeCoordinate.xyz);

    if (abs(widthwiseDistance) > halfMaxWidth || distanceFromStart < 0.0 || distanceFromEnd < 0.0) {
#ifdef DEBUG_SHOW_VOLUME
        out_FragColor = vec4(1.0, 0.0, 0.0, 0.5);
        return;
#else // DEBUG_SHOW_VOLUME
        discard;
#endif // DEBUG_SHOW_VOLUME
    }

    // Check distance of the eye coordinate against start and end planes with normals in the right plane.
    // For computing unskewed lengthwise texture coordinate.
    // Can also be used for clipping extremely pointy miters, but in practice unnecessary because of miter breaking.

    // aligned plane: cross the right plane normal with miter plane normal, then cross the result with right again to point it more "forward"
    vec3 alignedPlaneNormal;

    // start aligned plane
    alignedPlaneNormal = cross(v_rightPlaneEC.xyz, v_startPlaneNormalEcAndHalfWidth.xyz);
    alignedPlaneNormal = normalize(cross(alignedPlaneNormal, v_rightPlaneEC.xyz));
    distanceFromStart = czm_planeDistance(alignedPlaneNormal, -dot(alignedPlaneNormal, ecStart), eyeCoordinate.xyz);

    // end aligned plane
    alignedPlaneNormal = cross(v_rightPlaneEC.xyz, v_endPlaneNormalEcAndBatchId.xyz);
    alignedPlaneNormal = normalize(cross(alignedPlaneNormal, v_rightPlaneEC.xyz));
    distanceFromEnd = czm_planeDistance(alignedPlaneNormal, -dot(alignedPlaneNormal, v_endEcAndStartEcX.xyz), eyeCoordinate.xyz);

#ifdef PER_INSTANCE_COLOR
    out_FragColor = czm_gammaCorrect(v_color);
#else // PER_INSTANCE_COLOR
    // Clamp - distance to aligned planes may be negative due to mitering,
    // so fragment texture coordinate might be out-of-bounds.
    float s = clamp(distanceFromStart / (distanceFromStart + distanceFromEnd), 0.0, 1.0);
    s = (s * v_texcoordNormalizationAndStartEcYZ.x) + v_texcoordNormalizationAndStartEcYZ.y;
    float t = (widthwiseDistance + halfMaxWidth) / (2.0 * halfMaxWidth);

    czm_materialInput materialInput;

    materialInput.s = s;
    materialInput.st = vec2(s, t);
    materialInput.str = vec3(s, t, 0.0);

    czm_material material = czm_getMaterial(materialInput);
    out_FragColor = vec4(material.diffuse + material.emission, material.alpha);
#endif // PER_INSTANCE_COLOR

    // Premultiply alpha. Required for classification primitives on translucent globe.
    out_FragColor.rgb *= out_FragColor.a;

    czm_writeDepthClamp();
}
`,wh=`in vec3 v_forwardDirectionEC;
in vec3 v_texcoordNormalizationAndHalfWidth;
in float v_batchId;

#ifdef PER_INSTANCE_COLOR
in vec4 v_color;
#else
in vec2 v_alignedPlaneDistances;
in float v_texcoordT;
#endif

float rayPlaneDistanceUnsafe(vec3 origin, vec3 direction, vec3 planeNormal, float planeDistance) {
    // We don't expect the ray to ever be parallel to the plane
    return (-planeDistance - dot(planeNormal, origin)) / dot(planeNormal, direction);
}

void main(void)
{
    vec4 eyeCoordinate = gl_FragCoord;
    eyeCoordinate /= eyeCoordinate.w;

#ifdef PER_INSTANCE_COLOR
    out_FragColor = czm_gammaCorrect(v_color);
#else // PER_INSTANCE_COLOR
    // Use distances for planes aligned with segment to prevent skew in dashing
    float distanceFromStart = rayPlaneDistanceUnsafe(eyeCoordinate.xyz, -v_forwardDirectionEC, v_forwardDirectionEC.xyz, v_alignedPlaneDistances.x);
    float distanceFromEnd = rayPlaneDistanceUnsafe(eyeCoordinate.xyz, v_forwardDirectionEC, -v_forwardDirectionEC.xyz, v_alignedPlaneDistances.y);

    // Clamp - distance to aligned planes may be negative due to mitering
    distanceFromStart = max(0.0, distanceFromStart);
    distanceFromEnd = max(0.0, distanceFromEnd);

    float s = distanceFromStart / (distanceFromStart + distanceFromEnd);
    s = (s * v_texcoordNormalizationAndHalfWidth.x) + v_texcoordNormalizationAndHalfWidth.y;

    czm_materialInput materialInput;

    materialInput.s = s;
    materialInput.st = vec2(s, v_texcoordT);
    materialInput.str = vec3(s, v_texcoordT, 0.0);

    czm_material material = czm_getMaterial(materialInput);
    out_FragColor = vec4(material.diffuse + material.emission, material.alpha);
#endif // PER_INSTANCE_COLOR
}
`,xh=`in vec3 position3DHigh;
in vec3 position3DLow;

in vec4 startHiAndForwardOffsetX;
in vec4 startLoAndForwardOffsetY;
in vec4 startNormalAndForwardOffsetZ;
in vec4 endNormalAndTextureCoordinateNormalizationX;
in vec4 rightNormalAndTextureCoordinateNormalizationY;
in vec4 startHiLo2D;
in vec4 offsetAndRight2D;
in vec4 startEndNormals2D;
in vec2 texcoordNormalization2D;

in float batchId;

out vec3 v_forwardDirectionEC;
out vec3 v_texcoordNormalizationAndHalfWidth;
out float v_batchId;

// For materials
#ifdef WIDTH_VARYING
out float v_width;
#endif
#ifdef ANGLE_VARYING
out float v_polylineAngle;
#endif

#ifdef PER_INSTANCE_COLOR
out vec4 v_color;
#else
out vec2 v_alignedPlaneDistances;
out float v_texcoordT;
#endif

// Morphing planes using SLERP or NLERP doesn't seem to work, so instead draw the material directly on the shadow volume.
// Morph views are from very far away and aren't meant to be used precisely, so this should be sufficient.
void main()
{
    v_batchId = batchId;

    // Start position
    vec4 posRelativeToEye2D = czm_translateRelativeToEye(vec3(0.0, startHiLo2D.xy), vec3(0.0, startHiLo2D.zw));
    vec4 posRelativeToEye3D = czm_translateRelativeToEye(startHiAndForwardOffsetX.xyz, startLoAndForwardOffsetY.xyz);
    vec4 posRelativeToEye = czm_columbusViewMorph(posRelativeToEye2D, posRelativeToEye3D, czm_morphTime);
    vec3 posEc2D = (czm_modelViewRelativeToEye * posRelativeToEye2D).xyz;
    vec3 posEc3D = (czm_modelViewRelativeToEye * posRelativeToEye3D).xyz;
    vec3 startEC = (czm_modelViewRelativeToEye * posRelativeToEye).xyz;

    // Start plane
    vec4 startPlane2D;
    vec4 startPlane3D;
    startPlane2D.xyz = czm_normal * vec3(0.0, startEndNormals2D.xy);
    startPlane3D.xyz = czm_normal * startNormalAndForwardOffsetZ.xyz;
    startPlane2D.w = -dot(startPlane2D.xyz, posEc2D);
    startPlane3D.w = -dot(startPlane3D.xyz, posEc3D);

    // Right plane
    vec4 rightPlane2D;
    vec4 rightPlane3D;
    rightPlane2D.xyz = czm_normal * vec3(0.0, offsetAndRight2D.zw);
    rightPlane3D.xyz = czm_normal * rightNormalAndTextureCoordinateNormalizationY.xyz;
    rightPlane2D.w = -dot(rightPlane2D.xyz, posEc2D);
    rightPlane3D.w = -dot(rightPlane3D.xyz, posEc3D);

    // End position
    posRelativeToEye2D = posRelativeToEye2D + vec4(0.0, offsetAndRight2D.xy, 0.0);
    posRelativeToEye3D = posRelativeToEye3D + vec4(startHiAndForwardOffsetX.w, startLoAndForwardOffsetY.w, startNormalAndForwardOffsetZ.w, 0.0);
    posRelativeToEye = czm_columbusViewMorph(posRelativeToEye2D, posRelativeToEye3D, czm_morphTime);
    posEc2D = (czm_modelViewRelativeToEye * posRelativeToEye2D).xyz;
    posEc3D = (czm_modelViewRelativeToEye * posRelativeToEye3D).xyz;
    vec3 endEC = (czm_modelViewRelativeToEye * posRelativeToEye).xyz;
    vec3 forwardEc3D = czm_normal * normalize(vec3(startHiAndForwardOffsetX.w, startLoAndForwardOffsetY.w, startNormalAndForwardOffsetZ.w));
    vec3 forwardEc2D = czm_normal * normalize(vec3(0.0, offsetAndRight2D.xy));

    // End plane
    vec4 endPlane2D;
    vec4 endPlane3D;
    endPlane2D.xyz = czm_normal * vec3(0.0, startEndNormals2D.zw);
    endPlane3D.xyz = czm_normal * endNormalAndTextureCoordinateNormalizationX.xyz;
    endPlane2D.w = -dot(endPlane2D.xyz, posEc2D);
    endPlane3D.w = -dot(endPlane3D.xyz, posEc3D);

    // Forward direction
    v_forwardDirectionEC = normalize(endEC - startEC);

    vec2 cleanTexcoordNormalization2D;
    cleanTexcoordNormalization2D.x = abs(texcoordNormalization2D.x);
    cleanTexcoordNormalization2D.y = czm_branchFreeTernary(texcoordNormalization2D.y > 1.0, 0.0, abs(texcoordNormalization2D.y));
    vec2 cleanTexcoordNormalization3D;
    cleanTexcoordNormalization3D.x = abs(endNormalAndTextureCoordinateNormalizationX.w);
    cleanTexcoordNormalization3D.y = rightNormalAndTextureCoordinateNormalizationY.w;
    cleanTexcoordNormalization3D.y = czm_branchFreeTernary(cleanTexcoordNormalization3D.y > 1.0, 0.0, abs(cleanTexcoordNormalization3D.y));

    v_texcoordNormalizationAndHalfWidth.xy = mix(cleanTexcoordNormalization2D, cleanTexcoordNormalization3D, czm_morphTime);

#ifdef PER_INSTANCE_COLOR
    v_color = czm_batchTable_color(batchId);
#else // PER_INSTANCE_COLOR
    // For computing texture coordinates

    v_alignedPlaneDistances.x = -dot(v_forwardDirectionEC, startEC);
    v_alignedPlaneDistances.y = -dot(-v_forwardDirectionEC, endEC);
#endif // PER_INSTANCE_COLOR

#ifdef WIDTH_VARYING
    float width = czm_batchTable_width(batchId);
    float halfWidth = width * 0.5;
    v_width = width;
    v_texcoordNormalizationAndHalfWidth.z = halfWidth;
#else
    float halfWidth = 0.5 * czm_batchTable_width(batchId);
    v_texcoordNormalizationAndHalfWidth.z = halfWidth;
#endif

    // Compute a normal along which to "push" the position out, extending the miter depending on view distance.
    // Position has already been "pushed" by unit length along miter normal, and miter normals are encoded in the planes.
    // Decode the normal to use at this specific vertex, push the position back, and then push to where it needs to be.
    // Since this is morphing, compute both 3D and 2D positions and then blend.

    // ****** 3D ******
    // Check distance to the end plane and start plane, pick the plane that is closer
    vec4 positionEc3D = czm_modelViewRelativeToEye * czm_translateRelativeToEye(position3DHigh, position3DLow); // w = 1.0, see czm_computePosition
    float absStartPlaneDistance = abs(czm_planeDistance(startPlane3D, positionEc3D.xyz));
    float absEndPlaneDistance = abs(czm_planeDistance(endPlane3D, positionEc3D.xyz));
    vec3 planeDirection = czm_branchFreeTernary(absStartPlaneDistance < absEndPlaneDistance, startPlane3D.xyz, endPlane3D.xyz);
    vec3 upOrDown = normalize(cross(rightPlane3D.xyz, planeDirection)); // Points "up" for start plane, "down" at end plane.
    vec3 normalEC = normalize(cross(planeDirection, upOrDown));         // In practice, the opposite seems to work too.

    // Nudge the top vertex upwards to prevent flickering
    vec3 geodeticSurfaceNormal = normalize(cross(normalEC, forwardEc3D));
    geodeticSurfaceNormal *= float(0.0 <= rightNormalAndTextureCoordinateNormalizationY.w && rightNormalAndTextureCoordinateNormalizationY.w <= 1.0);
    geodeticSurfaceNormal *= MAX_TERRAIN_HEIGHT;
    positionEc3D.xyz += geodeticSurfaceNormal;

    // Determine if this vertex is on the "left" or "right"
    normalEC *= sign(endNormalAndTextureCoordinateNormalizationX.w);

    // A "perfect" implementation would push along normals according to the angle against forward.
    // In practice, just pushing the normal out by halfWidth is sufficient for morph views.
    positionEc3D.xyz += halfWidth * max(0.0, czm_metersPerPixel(positionEc3D)) * normalEC; // prevent artifacts when czm_metersPerPixel is negative (behind camera)

    // ****** 2D ******
    // Check distance to the end plane and start plane, pick the plane that is closer
    vec4 positionEc2D = czm_modelViewRelativeToEye * czm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy); // w = 1.0, see czm_computePosition
    absStartPlaneDistance = abs(czm_planeDistance(startPlane2D, positionEc2D.xyz));
    absEndPlaneDistance = abs(czm_planeDistance(endPlane2D, positionEc2D.xyz));
    planeDirection = czm_branchFreeTernary(absStartPlaneDistance < absEndPlaneDistance, startPlane2D.xyz, endPlane2D.xyz);
    upOrDown = normalize(cross(rightPlane2D.xyz, planeDirection)); // Points "up" for start plane, "down" at end plane.
    normalEC = normalize(cross(planeDirection, upOrDown));         // In practice, the opposite seems to work too.

    // Nudge the top vertex upwards to prevent flickering
    geodeticSurfaceNormal = normalize(cross(normalEC, forwardEc2D));
    geodeticSurfaceNormal *= float(0.0 <= texcoordNormalization2D.y && texcoordNormalization2D.y <= 1.0);
    geodeticSurfaceNormal *= MAX_TERRAIN_HEIGHT;
    positionEc2D.xyz += geodeticSurfaceNormal;

    // Determine if this vertex is on the "left" or "right"
    normalEC *= sign(texcoordNormalization2D.x);
#ifndef PER_INSTANCE_COLOR
    // Use vertex's sidedness to compute its texture coordinate.
    v_texcoordT = clamp(sign(texcoordNormalization2D.x), 0.0, 1.0);
#endif

    // A "perfect" implementation would push along normals according to the angle against forward.
    // In practice, just pushing the normal out by halfWidth is sufficient for morph views.
    positionEc2D.xyz += halfWidth * max(0.0, czm_metersPerPixel(positionEc2D)) * normalEC; // prevent artifacts when czm_metersPerPixel is negative (behind camera)

    // Blend for actual position
    gl_Position = czm_projection * mix(positionEc2D, positionEc3D, czm_morphTime);

#ifdef ANGLE_VARYING
    // Approximate relative screen space direction of the line.
    vec2 approxLineDirection = normalize(vec2(v_forwardDirectionEC.x, -v_forwardDirectionEC.y));
    approxLineDirection.y = czm_branchFreeTernary(approxLineDirection.x == 0.0 && approxLineDirection.y == 0.0, -1.0, approxLineDirection.y);
    v_polylineAngle = czm_fastApproximateAtan(approxLineDirection.x, approxLineDirection.y);
#endif
}
`,Ch=`in vec3 position3DHigh;
in vec3 position3DLow;

// In 2D and in 3D, texture coordinate normalization component signs encodes:
// * X sign - sidedness relative to right plane
// * Y sign - is negative OR magnitude is greater than 1.0 if vertex is on bottom of volume
#ifndef COLUMBUS_VIEW_2D
in vec4 startHiAndForwardOffsetX;
in vec4 startLoAndForwardOffsetY;
in vec4 startNormalAndForwardOffsetZ;
in vec4 endNormalAndTextureCoordinateNormalizationX;
in vec4 rightNormalAndTextureCoordinateNormalizationY;
#else
in vec4 startHiLo2D;
in vec4 offsetAndRight2D;
in vec4 startEndNormals2D;
in vec2 texcoordNormalization2D;
#endif

in float batchId;

out vec4 v_startPlaneNormalEcAndHalfWidth;
out vec4 v_endPlaneNormalEcAndBatchId;
out vec4 v_rightPlaneEC;
out vec4 v_endEcAndStartEcX;
out vec4 v_texcoordNormalizationAndStartEcYZ;

// For materials
#ifdef WIDTH_VARYING
out float v_width;
#endif
#ifdef ANGLE_VARYING
out float v_polylineAngle;
#endif

#ifdef PER_INSTANCE_COLOR
out vec4 v_color;
#endif

void main()
{
#ifdef COLUMBUS_VIEW_2D
    vec3 ecStart = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(vec3(0.0, startHiLo2D.xy), vec3(0.0, startHiLo2D.zw))).xyz;

    vec3 forwardDirectionEC = czm_normal * vec3(0.0, offsetAndRight2D.xy);
    vec3 ecEnd = forwardDirectionEC + ecStart;
    forwardDirectionEC = normalize(forwardDirectionEC);

    // Right plane
    v_rightPlaneEC.xyz = czm_normal * vec3(0.0, offsetAndRight2D.zw);
    v_rightPlaneEC.w = -dot(v_rightPlaneEC.xyz, ecStart);

    // start plane
    vec4 startPlaneEC;
    startPlaneEC.xyz =  czm_normal * vec3(0.0, startEndNormals2D.xy);
    startPlaneEC.w = -dot(startPlaneEC.xyz, ecStart);

    // end plane
    vec4 endPlaneEC;
    endPlaneEC.xyz =  czm_normal * vec3(0.0, startEndNormals2D.zw);
    endPlaneEC.w = -dot(endPlaneEC.xyz, ecEnd);

    v_texcoordNormalizationAndStartEcYZ.x = abs(texcoordNormalization2D.x);
    v_texcoordNormalizationAndStartEcYZ.y = texcoordNormalization2D.y;

#else // COLUMBUS_VIEW_2D
    vec3 ecStart = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(startHiAndForwardOffsetX.xyz, startLoAndForwardOffsetY.xyz)).xyz;
    vec3 offset = czm_normal * vec3(startHiAndForwardOffsetX.w, startLoAndForwardOffsetY.w, startNormalAndForwardOffsetZ.w);
    vec3 ecEnd = ecStart + offset;

    vec3 forwardDirectionEC = normalize(offset);

    // start plane
    vec4 startPlaneEC;
    startPlaneEC.xyz = czm_normal * startNormalAndForwardOffsetZ.xyz;
    startPlaneEC.w = -dot(startPlaneEC.xyz, ecStart);

    // end plane
    vec4 endPlaneEC;
    endPlaneEC.xyz = czm_normal * endNormalAndTextureCoordinateNormalizationX.xyz;
    endPlaneEC.w = -dot(endPlaneEC.xyz, ecEnd);

    // Right plane
    v_rightPlaneEC.xyz = czm_normal * rightNormalAndTextureCoordinateNormalizationY.xyz;
    v_rightPlaneEC.w = -dot(v_rightPlaneEC.xyz, ecStart);

    v_texcoordNormalizationAndStartEcYZ.x = abs(endNormalAndTextureCoordinateNormalizationX.w);
    v_texcoordNormalizationAndStartEcYZ.y = rightNormalAndTextureCoordinateNormalizationY.w;

#endif // COLUMBUS_VIEW_2D

    v_endEcAndStartEcX.xyz = ecEnd;
    v_endEcAndStartEcX.w = ecStart.x;
    v_texcoordNormalizationAndStartEcYZ.zw = ecStart.yz;

#ifdef PER_INSTANCE_COLOR
    v_color = czm_batchTable_color(batchId);
#endif // PER_INSTANCE_COLOR

    // Compute a normal along which to "push" the position out, extending the miter depending on view distance.
    // Position has already been "pushed" by unit length along miter normal, and miter normals are encoded in the planes.
    // Decode the normal to use at this specific vertex, push the position back, and then push to where it needs to be.
    vec4 positionRelativeToEye = czm_computePosition();

    // Check distance to the end plane and start plane, pick the plane that is closer
    vec4 positionEC = czm_modelViewRelativeToEye * positionRelativeToEye; // w = 1.0, see czm_computePosition
    float absStartPlaneDistance = abs(czm_planeDistance(startPlaneEC, positionEC.xyz));
    float absEndPlaneDistance = abs(czm_planeDistance(endPlaneEC, positionEC.xyz));
    vec3 planeDirection = czm_branchFreeTernary(absStartPlaneDistance < absEndPlaneDistance, startPlaneEC.xyz, endPlaneEC.xyz);
    vec3 upOrDown = normalize(cross(v_rightPlaneEC.xyz, planeDirection)); // Points "up" for start plane, "down" at end plane.
    vec3 normalEC = normalize(cross(planeDirection, upOrDown));           // In practice, the opposite seems to work too.

    // Extrude bottom vertices downward for far view distances, like for GroundPrimitives
    upOrDown = cross(forwardDirectionEC, normalEC);
    upOrDown = float(czm_sceneMode == czm_sceneMode3D) * upOrDown;
    upOrDown = float(v_texcoordNormalizationAndStartEcYZ.y > 1.0 || v_texcoordNormalizationAndStartEcYZ.y < 0.0) * upOrDown;
    upOrDown = min(GLOBE_MINIMUM_ALTITUDE, czm_geometricToleranceOverMeter * length(positionRelativeToEye.xyz)) * upOrDown;
    positionEC.xyz += upOrDown;

    v_texcoordNormalizationAndStartEcYZ.y = czm_branchFreeTernary(v_texcoordNormalizationAndStartEcYZ.y > 1.0, 0.0, abs(v_texcoordNormalizationAndStartEcYZ.y));

    // Determine distance along normalEC to push for a volume of appropriate width.
    // Make volumes about double pixel width for a conservative fit - in practice the
    // extra cost here is minimal compared to the loose volume heights.
    //
    // N = normalEC (guaranteed "right-facing")
    // R = rightEC
    // p = angle between N and R
    // w = distance to push along R if R == N
    // d = distance to push along N
    //
    //   N   R
    //  {  p| }      * cos(p) = dot(N, R) = w / d
    //  d  |  |w    * d = w / dot(N, R)
    //    { | }
    //       o---------- polyline segment ---->
    //
    float width = czm_batchTable_width(batchId);
#ifdef WIDTH_VARYING
    v_width = width;
#endif

    v_startPlaneNormalEcAndHalfWidth.xyz = startPlaneEC.xyz;
    v_startPlaneNormalEcAndHalfWidth.w = width * 0.5;

    v_endPlaneNormalEcAndBatchId.xyz = endPlaneEC.xyz;
    v_endPlaneNormalEcAndBatchId.w = batchId;

    width = width * max(0.0, czm_metersPerPixel(positionEC)); // width = distance to push along R
    width = width / dot(normalEC, v_rightPlaneEC.xyz); // width = distance to push along N

    // Determine if this vertex is on the "left" or "right"
#ifdef COLUMBUS_VIEW_2D
        normalEC *= sign(texcoordNormalization2D.x);
#else
        normalEC *= sign(endNormalAndTextureCoordinateNormalizationX.w);
#endif

    positionEC.xyz += width * normalEC;
    gl_Position = czm_depthClamp(czm_projection * positionEC);

#ifdef ANGLE_VARYING
    // Approximate relative screen space direction of the line.
    vec2 approxLineDirection = normalize(vec2(forwardDirectionEC.x, -forwardDirectionEC.y));
    approxLineDirection.y = czm_branchFreeTernary(approxLineDirection.x == 0.0 && approxLineDirection.y == 0.0, -1.0, approxLineDirection.y);
    v_polylineAngle = czm_fastApproximateAtan(approxLineDirection.x, approxLineDirection.y);
#endif
}
`,Sh=`in vec3 position3DHigh;
in vec3 position3DLow;
in vec3 prevPosition3DHigh;
in vec3 prevPosition3DLow;
in vec3 nextPosition3DHigh;
in vec3 nextPosition3DLow;
in vec2 expandAndWidth;
in vec4 color;
in float batchId;

out vec4 v_color;

void main()
{
    float expandDir = expandAndWidth.x;
    float width = abs(expandAndWidth.y) + 0.5;
    bool usePrev = expandAndWidth.y < 0.0;

    vec4 p = czm_computePosition();
    vec4 prev = czm_computePrevPosition();
    vec4 next = czm_computeNextPosition();

    float angle;
    vec4 positionWC = getPolylineWindowCoordinates(p, prev, next, expandDir, width, usePrev, angle);
    gl_Position = czm_viewportOrthographic * positionWC;

    v_color = color;
}
`;let hs=`${Ha}
${Sh}`;const Eh=Ac;uo.isInternetExplorer()||(hs=`#define CLIP_POLYLINE 
${hs}`);function gi(e){e=h(e,h.EMPTY_OBJECT);const t=h(e.translucent,!0),i=!1,n=gi.VERTEX_FORMAT;this.material=void 0,this.translucent=t,this._vertexShaderSource=h(e.vertexShaderSource,hs),this._fragmentShaderSource=h(e.fragmentShaderSource,Eh),this._renderState=pi.getDefaultRenderState(t,i,e.renderState),this._closed=i,this._vertexFormat=n}Object.defineProperties(gi.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return this._vertexFormat}}});gi.VERTEX_FORMAT=Va.POSITION_ONLY;gi.prototype.getFragmentShaderSource=pi.prototype.getFragmentShaderSource;gi.prototype.isTranslucent=pi.prototype.isTranslucent;gi.prototype.getRenderState=pi.prototype.getRenderState;const bh=`in vec3 position3DHigh;
in vec3 position3DLow;
in vec3 prevPosition3DHigh;
in vec3 prevPosition3DLow;
in vec3 nextPosition3DHigh;
in vec3 nextPosition3DLow;
in vec2 expandAndWidth;
in vec2 st;
in float batchId;

out float v_width;
out vec2 v_st;
out float v_polylineAngle;

void main()
{
    float expandDir = expandAndWidth.x;
    float width = abs(expandAndWidth.y) + 0.5;
    bool usePrev = expandAndWidth.y < 0.0;

    vec4 p = czm_computePosition();
    vec4 prev = czm_computePrevPosition();
    vec4 next = czm_computeNextPosition();

    float angle;
    vec4 positionWC = getPolylineWindowCoordinates(p, prev, next, expandDir, width, usePrev, angle);
    gl_Position = czm_viewportOrthographic * positionWC;

    v_width = width;
    v_st.s = st.s;
    v_st.t = czm_writeNonPerspective(st.t, gl_Position.w);
    v_polylineAngle = angle;
}
`;let us=`${Ha}
${bh}`;const Dh=Oc;uo.isInternetExplorer()||(us=`#define CLIP_POLYLINE 
${us}`);function Ri(e){e=h(e,h.EMPTY_OBJECT);const t=h(e.translucent,!0),i=!1,n=Ri.VERTEX_FORMAT;this.material=f(e.material)?e.material:Ys.fromType(Ys.ColorType),this.translucent=t,this._vertexShaderSource=h(e.vertexShaderSource,us),this._fragmentShaderSource=h(e.fragmentShaderSource,Dh),this._renderState=pi.getDefaultRenderState(t,i,e.renderState),this._closed=i,this._vertexFormat=n}Object.defineProperties(Ri.prototype,{vertexShaderSource:{get:function(){let e=this._vertexShaderSource;return this.material.shaderSource.search(/in\s+float\s+v_polylineAngle;/g)!==-1&&(e=`#define POLYLINE_DASH
${e}`),e}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return this._vertexFormat}}});Ri.VERTEX_FORMAT=Va.POSITION_AND_ST;Ri.prototype.getFragmentShaderSource=pi.prototype.getFragmentShaderSource;Ri.prototype.isTranslucent=pi.prototype.isTranslucent;Ri.prototype.getRenderState=pi.prototype.getRenderState;function $t(e){e=h(e,h.EMPTY_OBJECT),this.geometryInstances=e.geometryInstances,this._hasPerInstanceColors=!0;let t=e.appearance;f(t)||(t=new Ri),this.appearance=t,this.show=h(e.show,!0),this.classificationType=h(e.classificationType,Zt.BOTH),this.debugShowBoundingVolume=h(e.debugShowBoundingVolume,!1),this._debugShowShadowVolume=h(e.debugShowShadowVolume,!1),this._primitiveOptions={geometryInstances:void 0,appearance:void 0,vertexCacheOptimize:!1,interleave:h(e.interleave,!1),releaseGeometryInstances:h(e.releaseGeometryInstances,!0),allowPicking:h(e.allowPicking,!0),asynchronous:h(e.asynchronous,!0),compressVertices:!1,_createShaderProgramFunction:void 0,_createCommandsFunction:void 0,_updateAndQueueCommandsFunction:void 0},this._zIndex=void 0,this._ready=!1,this._primitive=void 0,this._sp=void 0,this._sp2D=void 0,this._spMorph=void 0,this._renderState=Lr(!1),this._renderState3DTiles=Lr(!0),this._renderStateMorph=mt.fromCache({cull:{enabled:!0,face:Pc.FRONT},depthTest:{enabled:!0},blending:Ds.PRE_MULTIPLIED_ALPHA_BLEND,depthMask:!1})}Object.defineProperties($t.prototype,{interleave:{get:function(){return this._primitiveOptions.interleave}},releaseGeometryInstances:{get:function(){return this._primitiveOptions.releaseGeometryInstances}},allowPicking:{get:function(){return this._primitiveOptions.allowPicking}},asynchronous:{get:function(){return this._primitiveOptions.asynchronous}},ready:{get:function(){return this._ready}},debugShowShadowVolume:{get:function(){return this._debugShowShadowVolume}}});$t.initializeTerrainHeights=function(){return Ut.initialize()};function Th(e,t,i){const n=t.context,o=e._primitive,s=o._attributeLocations;let r=o._batchTable.getVertexShaderCallback()(Ch);r=Ue._appendShowToShader(o,r),r=Ue._appendDistanceDisplayConditionToShader(o,r),r=Ue._modifyShaderPosition(e,r,t.scene3DOnly);let l=o._batchTable.getVertexShaderCallback()(xh);l=Ue._appendShowToShader(o,l),l=Ue._appendDistanceDisplayConditionToShader(o,l),l=Ue._modifyShaderPosition(e,l,t.scene3DOnly);let a=o._batchTable.getVertexShaderCallback()(yh);const c=[`GLOBE_MINIMUM_ALTITUDE ${t.mapProjection.ellipsoid.minimumRadius.toFixed(1)}`];let d="",m="";f(i.material)?(m=f(i.material)?i.material.shaderSource:"",m.search(/in\s+float\s+v_polylineAngle;/g)!==-1&&c.push("ANGLE_VARYING"),m.search(/in\s+float\s+v_width;/g)!==-1&&c.push("WIDTH_VARYING")):d="PER_INSTANCE_COLOR",c.push(d);const g=e.debugShowShadowVolume?["DEBUG_SHOW_VOLUME",d]:[d],y=new ht({defines:c,sources:[r]}),w=new ht({defines:g,sources:[m,a]});e._sp=Hi.replaceCache({context:n,shaderProgram:o._sp,vertexShaderSource:y,fragmentShaderSource:w,attributeLocations:s});let p=n.shaderCache.getDerivedShaderProgram(e._sp,"2dColor");if(!f(p)){const _=new ht({defines:c.concat(["COLUMBUS_VIEW_2D"]),sources:[r]});p=n.shaderCache.createDerivedShaderProgram(e._sp,"2dColor",{context:n,shaderProgram:e._sp2D,vertexShaderSource:_,fragmentShaderSource:w,attributeLocations:s})}e._sp2D=p;let u=n.shaderCache.getDerivedShaderProgram(e._sp,"MorphColor");if(!f(u)){const _=new ht({defines:c.concat([`MAX_TERRAIN_HEIGHT ${Ut._defaultMaxTerrainHeight.toFixed(1)}`]),sources:[l]});a=o._batchTable.getVertexShaderCallback()(wh);const x=new ht({defines:g,sources:[m,a]});u=n.shaderCache.createDerivedShaderProgram(e._sp,"MorphColor",{context:n,shaderProgram:e._spMorph,vertexShaderSource:_,fragmentShaderSource:x,attributeLocations:s})}e._spMorph=u}function Lr(e){return mt.fromCache({cull:{enabled:!0},blending:Ds.PRE_MULTIPLIED_ALPHA_BLEND,depthMask:!1,stencilTest:{enabled:e,frontFunction:ci.EQUAL,frontOperation:{fail:xe.KEEP,zFail:xe.KEEP,zPass:xe.KEEP},backFunction:ci.EQUAL,backOperation:{fail:xe.KEEP,zFail:xe.KEEP,zPass:xe.KEEP},reference:Yt.CESIUM_3D_TILE_MASK,mask:Yt.CESIUM_3D_TILE_MASK}})}function Ih(e,t,i,n,o,s){const r=e._primitive,l=r._va.length;o.length=l,s.length=l;const c=t instanceof gi?{}:i._uniforms,d=r._batchTable.getUniformMapCallback()(c);for(let m=0;m<l;m++){const g=r._va[m];let y=o[m];f(y)||(y=o[m]=new Pe({owner:e,primitiveType:r._primitiveType})),y.vertexArray=g,y.renderState=e._renderState,y.shaderProgram=e._sp,y.uniformMap=d,y.pass=At.TERRAIN_CLASSIFICATION,y.pickId="czm_batchTable_pickColor(v_endPlaneNormalEcAndBatchId.w)";const w=Pe.shallowClone(y,y.derivedCommands.tileset);w.renderState=e._renderState3DTiles,w.pass=At.CESIUM_3D_TILE_CLASSIFICATION,y.derivedCommands.tileset=w;const p=Pe.shallowClone(y,y.derivedCommands.color2D);p.shaderProgram=e._sp2D,y.derivedCommands.color2D=p;const u=Pe.shallowClone(w,w.derivedCommands.color2D);u.shaderProgram=e._sp2D,w.derivedCommands.color2D=u;const _=Pe.shallowClone(y,y.derivedCommands.colorMorph);_.renderState=e._renderStateMorph,_.shaderProgram=e._spMorph,_.pickId="czm_batchTable_pickColor(v_batchId)",y.derivedCommands.colorMorph=_}}function Mr(e,t,i,n,o,s,r){i.mode===wt.MORPHING?t=t.derivedCommands.colorMorph:i.mode!==wt.SCENE3D&&(t=t.derivedCommands.color2D),t.modelMatrix=n,t.boundingVolume=s,t.cull=o,t.debugShowBoundingVolume=r,i.commandList.push(t)}function vh(e,t,i,n,o,s,r){const l=e._primitive;Ue._updateBoundingVolumes(l,t,o);let a;t.mode===wt.SCENE3D?a=l._boundingSphereWC:t.mode===wt.COLUMBUS_VIEW?a=l._boundingSphereCV:t.mode===wt.SCENE2D&&f(l._boundingSphere2D)?a=l._boundingSphere2D:f(l._boundingSphereMorph)&&(a=l._boundingSphereMorph);const c=t.mode===wt.MORPHING,d=e.classificationType,m=d!==Zt.CESIUM_3D_TILE,g=d!==Zt.TERRAIN&&!c;let y;const w=t.passes;if(w.render||w.pick&&l.allowPicking){const p=i.length;for(let u=0;u<p;++u){const _=a[u];m&&(y=i[u],Mr(e,y,t,o,s,_,r)),g&&(y=i[u].derivedCommands.tileset,Mr(e,y,t,o,s,_,r))}}}$t.prototype.update=function(e){if(!f(this._primitive)&&!f(this.geometryInstances))return;if(!Ut.initialized){if(!this.asynchronous)throw new N("For synchronous GroundPolylinePrimitives, you must call GroundPolylinePrimitives.initializeTerrainHeights() and wait for the returned promise to resolve.");$t.initializeTerrainHeights();return}let t;const i=this,n=this._primitiveOptions;if(!f(this._primitive)){const o=Array.isArray(this.geometryInstances)?this.geometryInstances:[this.geometryInstances],s=o.length,r=new Array(s);let l;for(t=0;t<s;++t)if(l=o[t].attributes,!f(l)||!f(l.color)){this._hasPerInstanceColors=!1;break}for(t=0;t<s;++t){const a=o[t];l={};const c=a.attributes;for(const d in c)c.hasOwnProperty(d)&&(l[d]=c[d]);f(l.width)||(l.width=new Ot({componentDatatype:et.UNSIGNED_BYTE,componentsPerAttribute:1,value:[a.geometry.width]})),a.geometry._scene3DOnly=e.scene3DOnly,di.setProjectionAndEllipsoid(a.geometry,e.mapProjection),r[t]=new oo({geometry:a.geometry,attributes:l,id:a.id,pickPrimitive:i})}n.geometryInstances=r,n.appearance=this.appearance,n._createShaderProgramFunction=function(a,c,d){Th(i,c,d)},n._createCommandsFunction=function(a,c,d,m,g,y,w){Ih(i,c,d,m,y,w)},n._updateAndQueueCommandsFunction=function(a,c,d,m,g,y,w,p){vh(i,c,d,m,g,y,w)},this._primitive=new Ue(n)}if(this.appearance instanceof gi&&!this._hasPerInstanceColors)throw new N("All GeometryInstances must have color attributes to use PolylineColorAppearance with GroundPolylinePrimitive.");this._primitive.appearance=this.appearance,this._primitive.show=this.show,this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume,this._primitive.update(e),e.afterRender.push(()=>{!this._ready&&f(this._primitive)&&this._primitive.ready&&(this._ready=!0,this.releaseGeometryInstances&&(this.geometryInstances=void 0))})};$t.prototype.getGeometryInstanceAttributes=function(e){if(!f(this._primitive))throw new N("must call update before calling getGeometryInstanceAttributes");return this._primitive.getGeometryInstanceAttributes(e)};$t.isSupported=function(e){return e.frameState.context.depthTexture};$t.prototype.isDestroyed=function(){return!1};$t.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),this._sp=this._sp&&this._sp.destroy(),this._sp2D=void 0,this._spMorph=void 0,ho(this)};const Ah=new Y(1,1),Oh=!1,Ph=Nn.WHITE;function $i(e){e=h(e,h.EMPTY_OBJECT),this._definitionChanged=new le,this._image=void 0,this._imageSubscription=void 0,this._repeat=void 0,this._repeatSubscription=void 0,this._color=void 0,this._colorSubscription=void 0,this._transparent=void 0,this._transparentSubscription=void 0,this.image=e.image,this.repeat=e.repeat,this.color=e.color,this.transparent=e.transparent}Object.defineProperties($i.prototype,{isConstant:{get:function(){return te.isConstant(this._image)&&te.isConstant(this._repeat)}},definitionChanged:{get:function(){return this._definitionChanged}},image:C("image"),repeat:C("repeat"),color:C("color"),transparent:C("transparent")});$i.prototype.getType=function(e){return"Image"};$i.prototype.getValue=function(e,t){return f(t)||(t={}),t.image=te.getValueOrUndefined(this._image,e),t.repeat=te.getValueOrClonedDefault(this._repeat,e,Ah,t.repeat),t.color=te.getValueOrClonedDefault(this._color,e,Ph,t.color),te.getValueOrDefault(this._transparent,e,Oh)&&(t.color.alpha=Math.min(.99,t.color.alpha)),t};$i.prototype.equals=function(e){return this===e||e instanceof $i&&te.equals(this._image,e._image)&&te.equals(this._repeat,e._repeat)&&te.equals(this._color,e._color)&&te.equals(this._transparent,e._transparent)};function Rh(e){if(e instanceof Nn)return new Ki(e);if(typeof e=="string"||e instanceof os||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement){const t=new $i;return t.image=e,t}throw new N(`Unable to infer material type: ${e}`)}function ut(e,t){return C(e,t,Rh)}function un(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._dimensions=void 0,this._dimensionsSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(un.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),dimensions:C("dimensions"),heightReference:C("heightReference"),fill:C("fill"),material:ut("material"),outline:C("outline"),outlineColor:C("outlineColor"),outlineWidth:C("outlineWidth"),shadows:C("shadows"),distanceDisplayCondition:C("distanceDisplayCondition")});un.prototype.clone=function(e){return f(e)?(e.show=this.show,e.dimensions=this.dimensions,e.heightReference=this.heightReference,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new un(this)};un.prototype.merge=function(e){if(!f(e))throw new N("source is required.");this.show=h(this.show,e.show),this.dimensions=h(this.dimensions,e.dimensions),this.heightReference=h(this.heightReference,e.heightReference),this.fill=h(this.fill,e.fill),this.material=h(this.material,e.material),this.outline=h(this.outline,e.outline),this.outlineColor=h(this.outlineColor,e.outlineColor),this.outlineWidth=h(this.outlineWidth,e.outlineWidth),this.shadows=h(this.shadows,e.shadows),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition)};function Ni(){N.throwInstantiationError()}Object.defineProperties(Ni.prototype,{isConstant:{get:N.throwInstantiationError},definitionChanged:{get:N.throwInstantiationError},referenceFrame:{get:N.throwInstantiationError}});Ni.prototype.getValue=N.throwInstantiationError;Ni.prototype.getValueInReferenceFrame=N.throwInstantiationError;Ni.prototype.equals=N.throwInstantiationError;const kr=new Ft;Ni.convertToReferenceFrame=function(e,t,i,n,o){if(!f(t))return t;if(f(o)||(o=new b),i===n)return b.clone(t,o);const s=fo.computeIcrfToCentralBodyFixedMatrix(e,kr);if(i===xt.INERTIAL)return Ft.multiplyByVector(s,t,o);if(i===xt.FIXED)return Ft.multiplyByVector(Ft.transpose(s,kr),t,o)};function vi(e,t){this._definitionChanged=new le,this._value=b.clone(e),this._referenceFrame=h(t,xt.FIXED)}Object.defineProperties(vi.prototype,{isConstant:{get:function(){return!f(this._value)||this._referenceFrame===xt.FIXED}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return this._referenceFrame}}});vi.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,xt.FIXED,t)};vi.prototype.setValue=function(e,t){let i=!1;b.equals(this._value,e)||(i=!0,this._value=b.clone(e)),f(t)&&this._referenceFrame!==t&&(i=!0,this._referenceFrame=t),i&&this._definitionChanged.raiseEvent(this)};vi.prototype.getValueInReferenceFrame=function(e,t,i){if(!f(e))throw new N("time is required.");if(!f(t))throw new N("referenceFrame is required.");return Ni.convertToReferenceFrame(e,this._value,this._referenceFrame,t,i)};vi.prototype.equals=function(e){return this===e||e instanceof vi&&b.equals(this._value,e._value)&&this._referenceFrame===e._referenceFrame};function fn(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._positions=void 0,this._positionsSubscription=void 0,this._width=void 0,this._widthSubscription=void 0,this._height=void 0,this._heightSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._extrudedHeight=void 0,this._extrudedHeightSubscription=void 0,this._extrudedHeightReference=void 0,this._extrudedHeightReferenceSubscription=void 0,this._cornerType=void 0,this._cornerTypeSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._classificationType=void 0,this._classificationTypeSubscription=void 0,this._zIndex=void 0,this._zIndexSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(fn.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),positions:C("positions"),width:C("width"),height:C("height"),heightReference:C("heightReference"),extrudedHeight:C("extrudedHeight"),extrudedHeightReference:C("extrudedHeightReference"),cornerType:C("cornerType"),granularity:C("granularity"),fill:C("fill"),material:ut("material"),outline:C("outline"),outlineColor:C("outlineColor"),outlineWidth:C("outlineWidth"),shadows:C("shadows"),distanceDisplayCondition:C("distanceDisplayCondition"),classificationType:C("classificationType"),zIndex:C("zIndex")});fn.prototype.clone=function(e){return f(e)?(e.show=this.show,e.positions=this.positions,e.width=this.width,e.height=this.height,e.heightReference=this.heightReference,e.extrudedHeight=this.extrudedHeight,e.extrudedHeightReference=this.extrudedHeightReference,e.cornerType=this.cornerType,e.granularity=this.granularity,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e.classificationType=this.classificationType,e.zIndex=this.zIndex,e):new fn(this)};fn.prototype.merge=function(e){if(!f(e))throw new N("source is required.");this.show=h(this.show,e.show),this.positions=h(this.positions,e.positions),this.width=h(this.width,e.width),this.height=h(this.height,e.height),this.heightReference=h(this.heightReference,e.heightReference),this.extrudedHeight=h(this.extrudedHeight,e.extrudedHeight),this.extrudedHeightReference=h(this.extrudedHeightReference,e.extrudedHeightReference),this.cornerType=h(this.cornerType,e.cornerType),this.granularity=h(this.granularity,e.granularity),this.fill=h(this.fill,e.fill),this.material=h(this.material,e.material),this.outline=h(this.outline,e.outline),this.outlineColor=h(this.outlineColor,e.outlineColor),this.outlineWidth=h(this.outlineWidth,e.outlineWidth),this.shadows=h(this.shadows,e.shadows),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition),this.classificationType=h(this.classificationType,e.classificationType),this.zIndex=h(this.zIndex,e.zIndex)};function Nh(e){return e}function fs(e,t){return C(e,t,Nh)}function pn(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._length=void 0,this._lengthSubscription=void 0,this._topRadius=void 0,this._topRadiusSubscription=void 0,this._bottomRadius=void 0,this._bottomRadiusSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._numberOfVerticalLines=void 0,this._numberOfVerticalLinesSubscription=void 0,this._slices=void 0,this._slicesSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(pn.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),length:C("length"),topRadius:C("topRadius"),bottomRadius:C("bottomRadius"),heightReference:C("heightReference"),fill:C("fill"),material:ut("material"),outline:C("outline"),outlineColor:C("outlineColor"),outlineWidth:C("outlineWidth"),numberOfVerticalLines:C("numberOfVerticalLines"),slices:C("slices"),shadows:C("shadows"),distanceDisplayCondition:C("distanceDisplayCondition")});pn.prototype.clone=function(e){return f(e)?(e.show=this.show,e.length=this.length,e.topRadius=this.topRadius,e.bottomRadius=this.bottomRadius,e.heightReference=this.heightReference,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.numberOfVerticalLines=this.numberOfVerticalLines,e.slices=this.slices,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new pn(this)};pn.prototype.merge=function(e){if(!f(e))throw new N("source is required.");this.show=h(this.show,e.show),this.length=h(this.length,e.length),this.topRadius=h(this.topRadius,e.topRadius),this.bottomRadius=h(this.bottomRadius,e.bottomRadius),this.heightReference=h(this.heightReference,e.heightReference),this.fill=h(this.fill,e.fill),this.material=h(this.material,e.material),this.outline=h(this.outline,e.outline),this.outlineColor=h(this.outlineColor,e.outlineColor),this.outlineWidth=h(this.outlineWidth,e.outlineWidth),this.numberOfVerticalLines=h(this.numberOfVerticalLines,e.numberOfVerticalLines),this.slices=h(this.slices,e.slices),this.shadows=h(this.shadows,e.shadows),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition)};function _n(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._semiMajorAxis=void 0,this._semiMajorAxisSubscription=void 0,this._semiMinorAxis=void 0,this._semiMinorAxisSubscription=void 0,this._height=void 0,this._heightSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._extrudedHeight=void 0,this._extrudedHeightSubscription=void 0,this._extrudedHeightReference=void 0,this._extrudedHeightReferenceSubscription=void 0,this._rotation=void 0,this._rotationSubscription=void 0,this._stRotation=void 0,this._stRotationSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._numberOfVerticalLines=void 0,this._numberOfVerticalLinesSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._classificationType=void 0,this._classificationTypeSubscription=void 0,this._zIndex=void 0,this._zIndexSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(_n.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),semiMajorAxis:C("semiMajorAxis"),semiMinorAxis:C("semiMinorAxis"),height:C("height"),heightReference:C("heightReference"),extrudedHeight:C("extrudedHeight"),extrudedHeightReference:C("extrudedHeightReference"),rotation:C("rotation"),stRotation:C("stRotation"),granularity:C("granularity"),fill:C("fill"),material:ut("material"),outline:C("outline"),outlineColor:C("outlineColor"),outlineWidth:C("outlineWidth"),numberOfVerticalLines:C("numberOfVerticalLines"),shadows:C("shadows"),distanceDisplayCondition:C("distanceDisplayCondition"),classificationType:C("classificationType"),zIndex:C("zIndex")});_n.prototype.clone=function(e){return f(e)?(e.show=this.show,e.semiMajorAxis=this.semiMajorAxis,e.semiMinorAxis=this.semiMinorAxis,e.height=this.height,e.heightReference=this.heightReference,e.extrudedHeight=this.extrudedHeight,e.extrudedHeightReference=this.extrudedHeightReference,e.rotation=this.rotation,e.stRotation=this.stRotation,e.granularity=this.granularity,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.numberOfVerticalLines=this.numberOfVerticalLines,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e.classificationType=this.classificationType,e.zIndex=this.zIndex,e):new _n(this)};_n.prototype.merge=function(e){if(!f(e))throw new N("source is required.");this.show=h(this.show,e.show),this.semiMajorAxis=h(this.semiMajorAxis,e.semiMajorAxis),this.semiMinorAxis=h(this.semiMinorAxis,e.semiMinorAxis),this.height=h(this.height,e.height),this.heightReference=h(this.heightReference,e.heightReference),this.extrudedHeight=h(this.extrudedHeight,e.extrudedHeight),this.extrudedHeightReference=h(this.extrudedHeightReference,e.extrudedHeightReference),this.rotation=h(this.rotation,e.rotation),this.stRotation=h(this.stRotation,e.stRotation),this.granularity=h(this.granularity,e.granularity),this.fill=h(this.fill,e.fill),this.material=h(this.material,e.material),this.outline=h(this.outline,e.outline),this.outlineColor=h(this.outlineColor,e.outlineColor),this.outlineWidth=h(this.outlineWidth,e.outlineWidth),this.numberOfVerticalLines=h(this.numberOfVerticalLines,e.numberOfVerticalLines),this.shadows=h(this.shadows,e.shadows),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition),this.classificationType=h(this.classificationType,e.classificationType),this.zIndex=h(this.zIndex,e.zIndex)};function mn(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._radii=void 0,this._radiiSubscription=void 0,this._innerRadii=void 0,this._innerRadiiSubscription=void 0,this._minimumClock=void 0,this._minimumClockSubscription=void 0,this._maximumClock=void 0,this._maximumClockSubscription=void 0,this._minimumCone=void 0,this._minimumConeSubscription=void 0,this._maximumCone=void 0,this._maximumConeSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._stackPartitions=void 0,this._stackPartitionsSubscription=void 0,this._slicePartitions=void 0,this._slicePartitionsSubscription=void 0,this._subdivisions=void 0,this._subdivisionsSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(mn.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),radii:C("radii"),innerRadii:C("innerRadii"),minimumClock:C("minimumClock"),maximumClock:C("maximumClock"),minimumCone:C("minimumCone"),maximumCone:C("maximumCone"),heightReference:C("heightReference"),fill:C("fill"),material:ut("material"),outline:C("outline"),outlineColor:C("outlineColor"),outlineWidth:C("outlineWidth"),stackPartitions:C("stackPartitions"),slicePartitions:C("slicePartitions"),subdivisions:C("subdivisions"),shadows:C("shadows"),distanceDisplayCondition:C("distanceDisplayCondition")});mn.prototype.clone=function(e){return f(e)?(e.show=this.show,e.radii=this.radii,e.innerRadii=this.innerRadii,e.minimumClock=this.minimumClock,e.maximumClock=this.maximumClock,e.minimumCone=this.minimumCone,e.maximumCone=this.maximumCone,e.heightReference=this.heightReference,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.stackPartitions=this.stackPartitions,e.slicePartitions=this.slicePartitions,e.subdivisions=this.subdivisions,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new mn(this)};mn.prototype.merge=function(e){if(!f(e))throw new N("source is required.");this.show=h(this.show,e.show),this.radii=h(this.radii,e.radii),this.innerRadii=h(this.innerRadii,e.innerRadii),this.minimumClock=h(this.minimumClock,e.minimumClock),this.maximumClock=h(this.maximumClock,e.maximumClock),this.minimumCone=h(this.minimumCone,e.minimumCone),this.maximumCone=h(this.maximumCone,e.maximumCone),this.heightReference=h(this.heightReference,e.heightReference),this.fill=h(this.fill,e.fill),this.material=h(this.material,e.material),this.outline=h(this.outline,e.outline),this.outlineColor=h(this.outlineColor,e.outlineColor),this.outlineWidth=h(this.outlineWidth,e.outlineWidth),this.stackPartitions=h(this.stackPartitions,e.stackPartitions),this.slicePartitions=h(this.slicePartitions,e.slicePartitions),this.subdivisions=h(this.subdivisions,e.subdivisions),this.shadows=h(this.shadows,e.shadows),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition)};function gn(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._text=void 0,this._textSubscription=void 0,this._font=void 0,this._fontSubscription=void 0,this._style=void 0,this._styleSubscription=void 0,this._scale=void 0,this._scaleSubscription=void 0,this._showBackground=void 0,this._showBackgroundSubscription=void 0,this._backgroundColor=void 0,this._backgroundColorSubscription=void 0,this._backgroundPadding=void 0,this._backgroundPaddingSubscription=void 0,this._pixelOffset=void 0,this._pixelOffsetSubscription=void 0,this._eyeOffset=void 0,this._eyeOffsetSubscription=void 0,this._horizontalOrigin=void 0,this._horizontalOriginSubscription=void 0,this._verticalOrigin=void 0,this._verticalOriginSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._fillColor=void 0,this._fillColorSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._translucencyByDistance=void 0,this._translucencyByDistanceSubscription=void 0,this._pixelOffsetScaleByDistance=void 0,this._pixelOffsetScaleByDistanceSubscription=void 0,this._scaleByDistance=void 0,this._scaleByDistanceSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._disableDepthTestDistance=void 0,this._disableDepthTestDistanceSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(gn.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),text:C("text"),font:C("font"),style:C("style"),scale:C("scale"),showBackground:C("showBackground"),backgroundColor:C("backgroundColor"),backgroundPadding:C("backgroundPadding"),pixelOffset:C("pixelOffset"),eyeOffset:C("eyeOffset"),horizontalOrigin:C("horizontalOrigin"),verticalOrigin:C("verticalOrigin"),heightReference:C("heightReference"),fillColor:C("fillColor"),outlineColor:C("outlineColor"),outlineWidth:C("outlineWidth"),translucencyByDistance:C("translucencyByDistance"),pixelOffsetScaleByDistance:C("pixelOffsetScaleByDistance"),scaleByDistance:C("scaleByDistance"),distanceDisplayCondition:C("distanceDisplayCondition"),disableDepthTestDistance:C("disableDepthTestDistance")});gn.prototype.clone=function(e){return f(e)?(e.show=this.show,e.text=this.text,e.font=this.font,e.style=this.style,e.scale=this.scale,e.showBackground=this.showBackground,e.backgroundColor=this.backgroundColor,e.backgroundPadding=this.backgroundPadding,e.pixelOffset=this.pixelOffset,e.eyeOffset=this.eyeOffset,e.horizontalOrigin=this.horizontalOrigin,e.verticalOrigin=this.verticalOrigin,e.heightReference=this.heightReference,e.fillColor=this.fillColor,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.translucencyByDistance=this.translucencyByDistance,e.pixelOffsetScaleByDistance=this.pixelOffsetScaleByDistance,e.scaleByDistance=this.scaleByDistance,e.distanceDisplayCondition=this.distanceDisplayCondition,e.disableDepthTestDistance=this.disableDepthTestDistance,e):new gn(this)};gn.prototype.merge=function(e){if(!f(e))throw new N("source is required.");this.show=h(this.show,e.show),this.text=h(this.text,e.text),this.font=h(this.font,e.font),this.style=h(this.style,e.style),this.scale=h(this.scale,e.scale),this.showBackground=h(this.showBackground,e.showBackground),this.backgroundColor=h(this.backgroundColor,e.backgroundColor),this.backgroundPadding=h(this.backgroundPadding,e.backgroundPadding),this.pixelOffset=h(this.pixelOffset,e.pixelOffset),this.eyeOffset=h(this.eyeOffset,e.eyeOffset),this.horizontalOrigin=h(this.horizontalOrigin,e.horizontalOrigin),this.verticalOrigin=h(this.verticalOrigin,e.verticalOrigin),this.heightReference=h(this.heightReference,e.heightReference),this.fillColor=h(this.fillColor,e.fillColor),this.outlineColor=h(this.outlineColor,e.outlineColor),this.outlineWidth=h(this.outlineWidth,e.outlineWidth),this.translucencyByDistance=h(this.translucencyByDistance,e.translucencyByDistance),this.pixelOffsetScaleByDistance=h(this.pixelOffsetScaleByDistance,e.pixelOffsetScaleByDistance),this.scaleByDistance=h(this.scaleByDistance,e.scaleByDistance),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition),this.disableDepthTestDistance=h(this.disableDepthTestDistance,e.disableDepthTestDistance)};const Uo=new Wa;function yn(e){e=h(e,h.EMPTY_OBJECT),this._definitionChanged=new le,this._translation=void 0,this._translationSubscription=void 0,this._rotation=void 0,this._rotationSubscription=void 0,this._scale=void 0,this._scaleSubscription=void 0,this.translation=e.translation,this.rotation=e.rotation,this.scale=e.scale}Object.defineProperties(yn.prototype,{isConstant:{get:function(){return te.isConstant(this._translation)&&te.isConstant(this._rotation)&&te.isConstant(this._scale)}},definitionChanged:{get:function(){return this._definitionChanged}},translation:C("translation"),rotation:C("rotation"),scale:C("scale")});yn.prototype.getValue=function(e,t){return f(t)||(t=new Wa),t.translation=te.getValueOrClonedDefault(this._translation,e,Uo.translation,t.translation),t.rotation=te.getValueOrClonedDefault(this._rotation,e,Uo.rotation,t.rotation),t.scale=te.getValueOrClonedDefault(this._scale,e,Uo.scale,t.scale),t};yn.prototype.equals=function(e){return this===e||e instanceof yn&&te.equals(this._translation,e._translation)&&te.equals(this._rotation,e._rotation)&&te.equals(this._scale,e._scale)};function ft(e,t){this._propertyNames=[],this._definitionChanged=new le,f(e)&&this.merge(e,t)}Object.defineProperties(ft.prototype,{propertyNames:{get:function(){return this._propertyNames}},isConstant:{get:function(){const e=this._propertyNames;for(let t=0,i=e.length;t<i;t++)if(!te.isConstant(this[e[t]]))return!1;return!0}},definitionChanged:{get:function(){return this._definitionChanged}}});ft.prototype.hasProperty=function(e){return this._propertyNames.indexOf(e)!==-1};function Lh(e){return new Vt(e)}ft.prototype.addProperty=function(e,t,i){const n=this._propertyNames;if(!f(e))throw new N("propertyName is required.");if(n.indexOf(e)!==-1)throw new N(`${e} is already a registered property.`);n.push(e),Object.defineProperty(this,e,C(e,!0,h(i,Lh))),f(t)&&(this[e]=t),this._definitionChanged.raiseEvent(this)};ft.prototype.removeProperty=function(e){const i=this._propertyNames.indexOf(e);if(!f(e))throw new N("propertyName is required.");if(i===-1)throw new N(`${e} is not a registered property.`);this._propertyNames.splice(i,1),delete this[e],this._definitionChanged.raiseEvent(this)};ft.prototype.getValue=function(e,t){if(!f(e))throw new N("time is required.");f(t)||(t={});const i=this._propertyNames;for(let n=0,o=i.length;n<o;n++){const s=i[n];t[s]=te.getValueOrUndefined(this[s],e,t[s])}return t};ft.prototype.merge=function(e,t){if(!f(e))throw new N("source is required.");const i=this._propertyNames,n=f(e._propertyNames)?e._propertyNames:Object.keys(e);for(let o=0,s=n.length;o<s;o++){const r=n[o],l=this[r],a=e[r];l===void 0&&i.indexOf(r)===-1&&this.addProperty(r,void 0,t),a!==void 0&&(l!==void 0?f(l)&&f(l.merge)&&l.merge(a):f(a)&&f(a.merge)&&f(a.clone)?this[r]=a.clone():this[r]=a)}};function Mh(e,t){const i=e._propertyNames,n=t._propertyNames,o=i.length;if(o!==n.length)return!1;for(let s=0;s<o;++s){const r=i[s];if(n.indexOf(r)===-1||!te.equals(e[r],t[r]))return!1}return!0}ft.prototype.equals=function(e){return this===e||e instanceof ft&&Mh(this,e)};function hl(e){return new yn(e)}function kh(e){return new ft(e,hl)}function Fh(e){return new ft(e)}function Ji(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._uri=void 0,this._uriSubscription=void 0,this._scale=void 0,this._scaleSubscription=void 0,this._minimumPixelSize=void 0,this._minimumPixelSizeSubscription=void 0,this._maximumScale=void 0,this._maximumScaleSubscription=void 0,this._incrementallyLoadTextures=void 0,this._incrementallyLoadTexturesSubscription=void 0,this._runAnimations=void 0,this._runAnimationsSubscription=void 0,this._clampAnimations=void 0,this._clampAnimationsSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._silhouetteColor=void 0,this._silhouetteColorSubscription=void 0,this._silhouetteSize=void 0,this._silhouetteSizeSubscription=void 0,this._color=void 0,this._colorSubscription=void 0,this._colorBlendMode=void 0,this._colorBlendModeSubscription=void 0,this._colorBlendAmount=void 0,this._colorBlendAmountSubscription=void 0,this._imageBasedLightingFactor=void 0,this._imageBasedLightingFactorSubscription=void 0,this._lightColor=void 0,this._lightColorSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._nodeTransformations=void 0,this._nodeTransformationsSubscription=void 0,this._articulations=void 0,this._articulationsSubscription=void 0,this._clippingPlanes=void 0,this._clippingPlanesSubscription=void 0,this._customShader=void 0,this._customShaderSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(Ji.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),uri:C("uri"),scale:C("scale"),minimumPixelSize:C("minimumPixelSize"),maximumScale:C("maximumScale"),incrementallyLoadTextures:C("incrementallyLoadTextures"),runAnimations:C("runAnimations"),clampAnimations:C("clampAnimations"),shadows:C("shadows"),heightReference:C("heightReference"),silhouetteColor:C("silhouetteColor"),silhouetteSize:C("silhouetteSize"),color:C("color"),colorBlendMode:C("colorBlendMode"),colorBlendAmount:C("colorBlendAmount"),imageBasedLightingFactor:C("imageBasedLightingFactor"),lightColor:C("lightColor"),distanceDisplayCondition:C("distanceDisplayCondition"),nodeTransformations:C("nodeTransformations",void 0,kh),articulations:C("articulations",void 0,Fh),clippingPlanes:C("clippingPlanes"),customShader:C("customShader")});Ji.prototype.clone=function(e){return f(e)?(e.show=this.show,e.uri=this.uri,e.scale=this.scale,e.minimumPixelSize=this.minimumPixelSize,e.maximumScale=this.maximumScale,e.incrementallyLoadTextures=this.incrementallyLoadTextures,e.runAnimations=this.runAnimations,e.clampAnimations=this.clampAnimations,e.heightReference=this._heightReference,e.silhouetteColor=this.silhouetteColor,e.silhouetteSize=this.silhouetteSize,e.color=this.color,e.colorBlendMode=this.colorBlendMode,e.colorBlendAmount=this.colorBlendAmount,e.imageBasedLightingFactor=this.imageBasedLightingFactor,e.lightColor=this.lightColor,e.distanceDisplayCondition=this.distanceDisplayCondition,e.nodeTransformations=this.nodeTransformations,e.articulations=this.articulations,e.clippingPlanes=this.clippingPlanes,e.customShader=this.customShader,e):new Ji(this)};Ji.prototype.merge=function(e){if(!f(e))throw new N("source is required.");this.show=h(this.show,e.show),this.uri=h(this.uri,e.uri),this.scale=h(this.scale,e.scale),this.minimumPixelSize=h(this.minimumPixelSize,e.minimumPixelSize),this.maximumScale=h(this.maximumScale,e.maximumScale),this.incrementallyLoadTextures=h(this.incrementallyLoadTextures,e.incrementallyLoadTextures),this.runAnimations=h(this.runAnimations,e.runAnimations),this.clampAnimations=h(this.clampAnimations,e.clampAnimations),this.shadows=h(this.shadows,e.shadows),this.heightReference=h(this.heightReference,e.heightReference),this.silhouetteColor=h(this.silhouetteColor,e.silhouetteColor),this.silhouetteSize=h(this.silhouetteSize,e.silhouetteSize),this.color=h(this.color,e.color),this.colorBlendMode=h(this.colorBlendMode,e.colorBlendMode),this.colorBlendAmount=h(this.colorBlendAmount,e.colorBlendAmount),this.imageBasedLightingFactor=h(this.imageBasedLightingFactor,e.imageBasedLightingFactor),this.lightColor=h(this.lightColor,e.lightColor),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition),this.clippingPlanes=h(this.clippingPlanes,e.clippingPlanes),this.customShader=h(this.customShader,e.customShader);const t=e.nodeTransformations;if(f(t)){const n=this.nodeTransformations;f(n)?n.merge(t):this.nodeTransformations=new ft(t,hl)}const i=e.articulations;if(f(i)){const n=this.articulations;f(n)?n.merge(i):this.articulations=new ft(i)}};function wn(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._uri=void 0,this._uriSubscription=void 0,this._maximumScreenSpaceError=void 0,this._maximumScreenSpaceErrorSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(wn.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),uri:C("uri"),maximumScreenSpaceError:C("maximumScreenSpaceError")});wn.prototype.clone=function(e){return f(e)?(e.show=this.show,e.uri=this.uri,e.maximumScreenSpaceError=this.maximumScreenSpaceError,e):new wn(this)};wn.prototype.merge=function(e){if(!f(e))throw new N("source is required.");this.show=h(this.show,e.show),this.uri=h(this.uri,e.uri),this.maximumScreenSpaceError=h(this.maximumScreenSpaceError,e.maximumScreenSpaceError)};function xn(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._leadTime=void 0,this._leadTimeSubscription=void 0,this._trailTime=void 0,this._trailTimeSubscription=void 0,this._width=void 0,this._widthSubscription=void 0,this._resolution=void 0,this._resolutionSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(xn.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),leadTime:C("leadTime"),trailTime:C("trailTime"),width:C("width"),resolution:C("resolution"),material:ut("material"),distanceDisplayCondition:C("distanceDisplayCondition")});xn.prototype.clone=function(e){return f(e)?(e.show=this.show,e.leadTime=this.leadTime,e.trailTime=this.trailTime,e.width=this.width,e.resolution=this.resolution,e.material=this.material,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new xn(this)};xn.prototype.merge=function(e){if(!f(e))throw new N("source is required.");this.show=h(this.show,e.show),this.leadTime=h(this.leadTime,e.leadTime),this.trailTime=h(this.trailTime,e.trailTime),this.width=h(this.width,e.width),this.resolution=h(this.resolution,e.resolution),this.material=h(this.material,e.material),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition)};function Cn(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._plane=void 0,this._planeSubscription=void 0,this._dimensions=void 0,this._dimensionsSubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(Cn.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),plane:C("plane"),dimensions:C("dimensions"),fill:C("fill"),material:ut("material"),outline:C("outline"),outlineColor:C("outlineColor"),outlineWidth:C("outlineWidth"),shadows:C("shadows"),distanceDisplayCondition:C("distanceDisplayCondition")});Cn.prototype.clone=function(e){return f(e)?(e.show=this.show,e.plane=this.plane,e.dimensions=this.dimensions,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new Cn(this)};Cn.prototype.merge=function(e){if(!f(e))throw new N("source is required.");this.show=h(this.show,e.show),this.plane=h(this.plane,e.plane),this.dimensions=h(this.dimensions,e.dimensions),this.fill=h(this.fill,e.fill),this.material=h(this.material,e.material),this.outline=h(this.outline,e.outline),this.outlineColor=h(this.outlineColor,e.outlineColor),this.outlineWidth=h(this.outlineWidth,e.outlineWidth),this.shadows=h(this.shadows,e.shadows),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition)};function Sn(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._pixelSize=void 0,this._pixelSizeSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._color=void 0,this._colorSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._scaleByDistance=void 0,this._scaleByDistanceSubscription=void 0,this._translucencyByDistance=void 0,this._translucencyByDistanceSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._disableDepthTestDistance=void 0,this._disableDepthTestDistanceSubscription=void 0,this._splitDirection=void 0,this._splitDirectionSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(Sn.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),pixelSize:C("pixelSize"),heightReference:C("heightReference"),color:C("color"),outlineColor:C("outlineColor"),outlineWidth:C("outlineWidth"),scaleByDistance:C("scaleByDistance"),translucencyByDistance:C("translucencyByDistance"),distanceDisplayCondition:C("distanceDisplayCondition"),disableDepthTestDistance:C("disableDepthTestDistance"),splitDirection:C("splitDirection")});Sn.prototype.clone=function(e){return f(e)?(e.show=this.show,e.pixelSize=this.pixelSize,e.heightReference=this.heightReference,e.color=this.color,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.scaleByDistance=this.scaleByDistance,e.translucencyByDistance=this._translucencyByDistance,e.distanceDisplayCondition=this.distanceDisplayCondition,e.disableDepthTestDistance=this.disableDepthTestDistance,e.splitDirection=this.splitDirection,e):new Sn(this)};Sn.prototype.merge=function(e){if(!f(e))throw new N("source is required.");this.show=h(this.show,e.show),this.pixelSize=h(this.pixelSize,e.pixelSize),this.heightReference=h(this.heightReference,e.heightReference),this.color=h(this.color,e.color),this.outlineColor=h(this.outlineColor,e.outlineColor),this.outlineWidth=h(this.outlineWidth,e.outlineWidth),this.scaleByDistance=h(this.scaleByDistance,e.scaleByDistance),this.translucencyByDistance=h(this._translucencyByDistance,e.translucencyByDistance),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition),this.disableDepthTestDistance=h(this.disableDepthTestDistance,e.disableDepthTestDistance),this.splitDirection=h(this.splitDirection,e.splitDirection)};function zh(e){return Array.isArray(e)&&(e=new Rc(e)),new Vt(e)}function En(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._hierarchy=void 0,this._hierarchySubscription=void 0,this._height=void 0,this._heightSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._extrudedHeight=void 0,this._extrudedHeightSubscription=void 0,this._extrudedHeightReference=void 0,this._extrudedHeightReferenceSubscription=void 0,this._stRotation=void 0,this._stRotationSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._perPositionHeight=void 0,this._perPositionHeightSubscription=void 0,this._closeTop=void 0,this._closeTopSubscription=void 0,this._closeBottom=void 0,this._closeBottomSubscription=void 0,this._arcType=void 0,this._arcTypeSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._classificationType=void 0,this._classificationTypeSubscription=void 0,this._zIndex=void 0,this._zIndexSubscription=void 0,this._textureCoordinates=void 0,this._textureCoordinatesSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(En.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),hierarchy:C("hierarchy",void 0,zh),height:C("height"),heightReference:C("heightReference"),extrudedHeight:C("extrudedHeight"),extrudedHeightReference:C("extrudedHeightReference"),stRotation:C("stRotation"),granularity:C("granularity"),fill:C("fill"),material:ut("material"),outline:C("outline"),outlineColor:C("outlineColor"),outlineWidth:C("outlineWidth"),perPositionHeight:C("perPositionHeight"),closeTop:C("closeTop"),closeBottom:C("closeBottom"),arcType:C("arcType"),shadows:C("shadows"),distanceDisplayCondition:C("distanceDisplayCondition"),classificationType:C("classificationType"),zIndex:C("zIndex"),textureCoordinates:C("textureCoordinates")});En.prototype.clone=function(e){return f(e)?(e.show=this.show,e.hierarchy=this.hierarchy,e.height=this.height,e.heightReference=this.heightReference,e.extrudedHeight=this.extrudedHeight,e.extrudedHeightReference=this.extrudedHeightReference,e.stRotation=this.stRotation,e.granularity=this.granularity,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.perPositionHeight=this.perPositionHeight,e.closeTop=this.closeTop,e.closeBottom=this.closeBottom,e.arcType=this.arcType,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e.classificationType=this.classificationType,e.zIndex=this.zIndex,e.textureCoordinates=this.textureCoordinates,e):new En(this)};En.prototype.merge=function(e){if(!f(e))throw new N("source is required.");this.show=h(this.show,e.show),this.hierarchy=h(this.hierarchy,e.hierarchy),this.height=h(this.height,e.height),this.heightReference=h(this.heightReference,e.heightReference),this.extrudedHeight=h(this.extrudedHeight,e.extrudedHeight),this.extrudedHeightReference=h(this.extrudedHeightReference,e.extrudedHeightReference),this.stRotation=h(this.stRotation,e.stRotation),this.granularity=h(this.granularity,e.granularity),this.fill=h(this.fill,e.fill),this.material=h(this.material,e.material),this.outline=h(this.outline,e.outline),this.outlineColor=h(this.outlineColor,e.outlineColor),this.outlineWidth=h(this.outlineWidth,e.outlineWidth),this.perPositionHeight=h(this.perPositionHeight,e.perPositionHeight),this.closeTop=h(this.closeTop,e.closeTop),this.closeBottom=h(this.closeBottom,e.closeBottom),this.arcType=h(this.arcType,e.arcType),this.shadows=h(this.shadows,e.shadows),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition),this.classificationType=h(this.classificationType,e.classificationType),this.zIndex=h(this.zIndex,e.zIndex),this.textureCoordinates=h(this.textureCoordinates,e.textureCoordinates)};function bn(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._positions=void 0,this._positionsSubscription=void 0,this._width=void 0,this._widthSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._depthFailMaterial=void 0,this._depthFailMaterialSubscription=void 0,this._arcType=void 0,this._arcTypeSubscription=void 0,this._clampToGround=void 0,this._clampToGroundSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._classificationType=void 0,this._classificationTypeSubscription=void 0,this._zIndex=void 0,this._zIndexSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(bn.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),positions:C("positions"),width:C("width"),granularity:C("granularity"),material:ut("material"),depthFailMaterial:ut("depthFailMaterial"),arcType:C("arcType"),clampToGround:C("clampToGround"),shadows:C("shadows"),distanceDisplayCondition:C("distanceDisplayCondition"),classificationType:C("classificationType"),zIndex:C("zIndex")});bn.prototype.clone=function(e){return f(e)?(e.show=this.show,e.positions=this.positions,e.width=this.width,e.granularity=this.granularity,e.material=this.material,e.depthFailMaterial=this.depthFailMaterial,e.arcType=this.arcType,e.clampToGround=this.clampToGround,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e.classificationType=this.classificationType,e.zIndex=this.zIndex,e):new bn(this)};bn.prototype.merge=function(e){if(!f(e))throw new N("source is required.");this.show=h(this.show,e.show),this.positions=h(this.positions,e.positions),this.width=h(this.width,e.width),this.granularity=h(this.granularity,e.granularity),this.material=h(this.material,e.material),this.depthFailMaterial=h(this.depthFailMaterial,e.depthFailMaterial),this.arcType=h(this.arcType,e.arcType),this.clampToGround=h(this.clampToGround,e.clampToGround),this.shadows=h(this.shadows,e.shadows),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition),this.classificationType=h(this.classificationType,e.classificationType),this.zIndex=h(this.zIndex,e.zIndex)};function Dn(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._positions=void 0,this._positionsSubscription=void 0,this._shape=void 0,this._shapeSubscription=void 0,this._cornerType=void 0,this._cornerTypeSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubsription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(Dn.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),positions:C("positions"),shape:C("shape"),cornerType:C("cornerType"),granularity:C("granularity"),fill:C("fill"),material:ut("material"),outline:C("outline"),outlineColor:C("outlineColor"),outlineWidth:C("outlineWidth"),shadows:C("shadows"),distanceDisplayCondition:C("distanceDisplayCondition")});Dn.prototype.clone=function(e){return f(e)?(e.show=this.show,e.positions=this.positions,e.shape=this.shape,e.cornerType=this.cornerType,e.granularity=this.granularity,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new Dn(this)};Dn.prototype.merge=function(e){if(!f(e))throw new N("source is required.");this.show=h(this.show,e.show),this.positions=h(this.positions,e.positions),this.shape=h(this.shape,e.shape),this.cornerType=h(this.cornerType,e.cornerType),this.granularity=h(this.granularity,e.granularity),this.fill=h(this.fill,e.fill),this.material=h(this.material,e.material),this.outline=h(this.outline,e.outline),this.outlineColor=h(this.outlineColor,e.outlineColor),this.outlineWidth=h(this.outlineWidth,e.outlineWidth),this.shadows=h(this.shadows,e.shadows),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition)};function Qi(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._coordinates=void 0,this._coordinatesSubscription=void 0,this._height=void 0,this._heightSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._extrudedHeight=void 0,this._extrudedHeightSubscription=void 0,this._extrudedHeightReference=void 0,this._extrudedHeightReferenceSubscription=void 0,this._rotation=void 0,this._rotationSubscription=void 0,this._stRotation=void 0,this._stRotationSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distancedisplayConditionSubscription=void 0,this._classificationType=void 0,this._classificationTypeSubscription=void 0,this._zIndex=void 0,this._zIndexSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(Qi.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),coordinates:C("coordinates"),height:C("height"),heightReference:C("heightReference"),extrudedHeight:C("extrudedHeight"),extrudedHeightReference:C("extrudedHeightReference"),rotation:C("rotation"),stRotation:C("stRotation"),granularity:C("granularity"),fill:C("fill"),material:ut("material"),outline:C("outline"),outlineColor:C("outlineColor"),outlineWidth:C("outlineWidth"),shadows:C("shadows"),distanceDisplayCondition:C("distanceDisplayCondition"),classificationType:C("classificationType"),zIndex:C("zIndex")});Qi.prototype.clone=function(e){return f(e)?(e.show=this.show,e.coordinates=this.coordinates,e.height=this.height,e.heightReference=this.heightReference,e.extrudedHeight=this.extrudedHeight,e.extrudedHeightReference=this.extrudedHeightReference,e.rotation=this.rotation,e.stRotation=this.stRotation,e.granularity=this.granularity,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e.classificationType=this.classificationType,e.zIndex=this.zIndex,e):new Qi(this)};Qi.prototype.merge=function(e){if(!f(e))throw new N("source is required.");this.show=h(this.show,e.show),this.coordinates=h(this.coordinates,e.coordinates),this.height=h(this.height,e.height),this.heightReference=h(this.heightReference,e.heightReference),this.extrudedHeight=h(this.extrudedHeight,e.extrudedHeight),this.extrudedHeightReference=h(this.extrudedHeightReference,e.extrudedHeightReference),this.rotation=h(this.rotation,e.rotation),this.stRotation=h(this.stRotation,e.stRotation),this.granularity=h(this.granularity,e.granularity),this.fill=h(this.fill,e.fill),this.material=h(this.material,e.material),this.outline=h(this.outline,e.outline),this.outlineColor=h(this.outlineColor,e.outlineColor),this.outlineWidth=h(this.outlineWidth,e.outlineWidth),this.shadows=h(this.shadows,e.shadows),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition),this.classificationType=h(this.classificationType,e.classificationType),this.zIndex=h(this.zIndex,e.zIndex)};function Tn(e){this._definitionChanged=new le,this._show=void 0,this._showSubscription=void 0,this._positions=void 0,this._positionsSubscription=void 0,this._minimumHeights=void 0,this._minimumHeightsSubscription=void 0,this._maximumHeights=void 0,this._maximumHeightsSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this.merge(h(e,h.EMPTY_OBJECT))}Object.defineProperties(Tn.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:C("show"),positions:C("positions"),minimumHeights:C("minimumHeights"),maximumHeights:C("maximumHeights"),granularity:C("granularity"),fill:C("fill"),material:ut("material"),outline:C("outline"),outlineColor:C("outlineColor"),outlineWidth:C("outlineWidth"),shadows:C("shadows"),distanceDisplayCondition:C("distanceDisplayCondition")});Tn.prototype.clone=function(e){return f(e)?(e.show=this.show,e.positions=this.positions,e.minimumHeights=this.minimumHeights,e.maximumHeights=this.maximumHeights,e.granularity=this.granularity,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new Tn(this)};Tn.prototype.merge=function(e){if(!f(e))throw new N("source is required.");this.show=h(this.show,e.show),this.positions=h(this.positions,e.positions),this.minimumHeights=h(this.minimumHeights,e.minimumHeights),this.maximumHeights=h(this.maximumHeights,e.maximumHeights),this.granularity=h(this.granularity,e.granularity),this.fill=h(this.fill,e.fill),this.material=h(this.material,e.material),this.outline=h(this.outline,e.outline),this.outlineColor=h(this.outlineColor,e.outlineColor),this.outlineWidth=h(this.outlineWidth,e.outlineWidth),this.shadows=h(this.shadows,e.shadows),this.distanceDisplayCondition=h(this.distanceDisplayCondition,e.distanceDisplayCondition)};const Bh=new ae,ps=[];function Uh(e){return new vi(e)}function Vh(e){return C(e,void 0,Uh)}function Ae(e,t){return C(e,void 0,function(i){return i instanceof t?i:new t(i)})}function it(e){e=h(e,h.EMPTY_OBJECT);let t=e.id;f(t)||(t=Ts()),this._availability=void 0,this._id=t,this._definitionChanged=new le,this._name=e.name,this._show=h(e.show,!0),this._parent=void 0,this._propertyNames=["billboard","box","corridor","cylinder","description","ellipse","ellipsoid","label","model","tileset","orientation","path","plane","point","polygon","polyline","polylineVolume","position","properties","rectangle","viewFrom","wall",...ps],this._billboard=void 0,this._billboardSubscription=void 0,this._box=void 0,this._boxSubscription=void 0,this._corridor=void 0,this._corridorSubscription=void 0,this._cylinder=void 0,this._cylinderSubscription=void 0,this._description=void 0,this._descriptionSubscription=void 0,this._ellipse=void 0,this._ellipseSubscription=void 0,this._ellipsoid=void 0,this._ellipsoidSubscription=void 0,this._label=void 0,this._labelSubscription=void 0,this._model=void 0,this._modelSubscription=void 0,this._tileset=void 0,this._tilesetSubscription=void 0,this._orientation=void 0,this._orientationSubscription=void 0,this._path=void 0,this._pathSubscription=void 0,this._plane=void 0,this._planeSubscription=void 0,this._point=void 0,this._pointSubscription=void 0,this._polygon=void 0,this._polygonSubscription=void 0,this._polyline=void 0,this._polylineSubscription=void 0,this._polylineVolume=void 0,this._polylineVolumeSubscription=void 0,this._position=void 0,this._positionSubscription=void 0,this._properties=void 0,this._propertiesSubscription=void 0,this._rectangle=void 0,this._rectangleSubscription=void 0,this._viewFrom=void 0,this._viewFromSubscription=void 0,this._wall=void 0,this._wallSubscription=void 0,this._children=[],this.entityCollection=void 0,this.parent=e.parent,this.merge(e)}function _s(e,t,i){const n=t.length;for(let o=0;o<n;o++){const s=t[o],r=s._show;(!i&&r)!==(i&&r)&&_s(s,s._children,i)}e._definitionChanged.raiseEvent(e,"isShowing",i,!i)}Object.defineProperties(it.prototype,{availability:fs("availability"),id:{get:function(){return this._id}},definitionChanged:{get:function(){return this._definitionChanged}},name:fs("name"),show:{get:function(){return this._show},set:function(e){if(!f(e))throw new N("value is required.");if(e===this._show)return;const t=this.isShowing;this._show=e;const i=this.isShowing;t!==i&&_s(this,this._children,i),this._definitionChanged.raiseEvent(this,"show",e,!e)}},isShowing:{get:function(){return this._show&&(!f(this.entityCollection)||this.entityCollection.show)&&(!f(this._parent)||this._parent.isShowing)}},parent:{get:function(){return this._parent},set:function(e){const t=this._parent;if(t===e)return;const i=this.isShowing;if(f(t)){const o=t._children.indexOf(this);t._children.splice(o,1)}this._parent=e,f(e)&&e._children.push(this);const n=this.isShowing;i!==n&&_s(this,this._children,n),this._definitionChanged.raiseEvent(this,"parent",e,t)}},propertyNames:{get:function(){return this._propertyNames}},billboard:Ae("billboard",Ii),box:Ae("box",un),corridor:Ae("corridor",fn),cylinder:Ae("cylinder",pn),description:C("description"),ellipse:Ae("ellipse",_n),ellipsoid:Ae("ellipsoid",mn),label:Ae("label",gn),model:Ae("model",Ji),tileset:Ae("tileset",wn),orientation:C("orientation"),path:Ae("path",xn),plane:Ae("plane",Cn),point:Ae("point",Sn),polygon:Ae("polygon",En),polyline:Ae("polyline",bn),polylineVolume:Ae("polylineVolume",Dn),properties:Ae("properties",ft),position:Vh("position"),rectangle:Ae("rectangle",Qi),viewFrom:C("viewFrom"),wall:Ae("wall",Tn)});it.registerEntityType=function(e,t){Object.defineProperties(it.prototype,{[e]:Ae(e,t)}),ps.includes(e)||ps.push(e)};it.prototype.isAvailable=function(e){if(!f(e))throw new N("time is required.");const t=this._availability;return!f(t)||t.contains(e)};it.prototype.addProperty=function(e){const t=this._propertyNames;if(!f(e))throw new N("propertyName is required.");if(t.indexOf(e)!==-1)throw new N(`${e} is already a registered property.`);if(e in this)throw new N(`${e} is a reserved property name.`);t.push(e),Object.defineProperty(this,e,fs(e,!0))};it.prototype.removeProperty=function(e){const i=this._propertyNames.indexOf(e);if(!f(e))throw new N("propertyName is required.");if(i===-1)throw new N(`${e} is not a registered property.`);this._propertyNames.splice(i,1),delete this[e]};it.prototype.merge=function(e){if(!f(e))throw new N("source is required.");this.name=h(this.name,e.name),this.availability=h(this.availability,e.availability);const t=this._propertyNames,i=f(e._propertyNames)?e._propertyNames:Object.keys(e),n=i.length;for(let o=0;o<n;o++){const s=i[o];if(s==="parent"||s==="name"||s==="availability"||s==="children")continue;const r=this[s],l=e[s];!f(r)&&t.indexOf(s)===-1&&this.addProperty(s),f(l)&&(f(r)?f(r.merge)&&r.merge(l):f(l.merge)&&f(l.clone)?this[s]=l.clone():this[s]=l)}};const ul=new Ft,fl=new b,pl=new bs;it.prototype.computeModelMatrix=function(e,t){Q.typeOf.object("time",e);const i=te.getValueOrUndefined(this._position,e,fl);if(!f(i))return;const n=te.getValueOrUndefined(this._orientation,e,pl);return f(n)?t=qt.fromRotationTranslation(Ft.fromQuaternion(n,ul),i,t):t=fo.eastNorthUpToFixedFrame(i,void 0,t),t};it.prototype.computeModelMatrixForHeightReference=function(e,t,i,n,o){Q.typeOf.object("time",e);const s=te.getValueOrDefault(t,e,si.NONE);let r=te.getValueOrUndefined(this._position,e,fl);if(s===si.NONE||!f(r)||b.equalsEpsilon(r,b.ZERO,Z.EPSILON8))return this.computeModelMatrix(e,o);const l=n.cartesianToCartographic(r,Bh);Nc(s)?l.height=i:l.height+=i,r=n.cartographicToCartesian(l,r);const a=te.getValueOrUndefined(this._orientation,e,pl);return f(a)?o=qt.fromRotationTranslation(Ft.fromQuaternion(a,ul),r,o):o=fo.eastNorthUpToFixedFrame(r,void 0,o),o};it.supportsMaterialsforEntitiesOnTerrain=function(e){return tt.supportsMaterials(e)};it.supportsPolylinesOnTerrain=function(e){return $t.isSupported(e)};function In(e,t){this._callback=void 0,this._isConstant=void 0,this._definitionChanged=new le,this.setCallback(e,t)}Object.defineProperties(In.prototype,{isConstant:{get:function(){return this._isConstant}},definitionChanged:{get:function(){return this._definitionChanged}}});In.prototype.getValue=function(e,t){return this._callback(e,t)};In.prototype.setCallback=function(e,t){if(!f(e))throw new N("callback is required.");if(!f(t))throw new N("isConstant is required.");const i=this._callback!==e||this._isConstant!==t;this._callback=e,this._isConstant=t,i&&this._definitionChanged.raiseEvent(this)};In.prototype.equals=function(e){return this===e||e instanceof In&&this._callback===e._callback&&this._isConstant===e._isConstant};const Fr={id:void 0};function Ln(e){if(e._firing){e._refire=!0;return}if(e._suspendCount===0){const t=e._addedEntities,i=e._removedEntities,n=e._changedEntities;if(n.length!==0||t.length!==0||i.length!==0){e._firing=!0;do{e._refire=!1;const o=t.values.slice(0),s=i.values.slice(0),r=n.values.slice(0);t.removeAll(),i.removeAll(),n.removeAll(),e._collectionChanged.raiseEvent(e,o,s,r)}while(e._refire);e._firing=!1}}}function Ge(e){this._owner=e,this._entities=new qi,this._addedEntities=new qi,this._removedEntities=new qi,this._changedEntities=new qi,this._suspendCount=0,this._collectionChanged=new le,this._id=Ts(),this._show=!0,this._firing=!1,this._refire=!1}Ge.prototype.suspendEvents=function(){this._suspendCount++};Ge.prototype.resumeEvents=function(){if(this._suspendCount===0)throw new N("resumeEvents can not be called before suspendEvents.");this._suspendCount--,Ln(this)};Object.defineProperties(Ge.prototype,{collectionChanged:{get:function(){return this._collectionChanged}},id:{get:function(){return this._id}},values:{get:function(){return this._entities.values}},show:{get:function(){return this._show},set:function(e){if(!f(e))throw new N("value is required.");if(e===this._show)return;this.suspendEvents();let t;const i=[],n=this._entities.values,o=n.length;for(t=0;t<o;t++)i.push(n[t].isShowing);for(this._show=e,t=0;t<o;t++){const s=i[t],r=n[t];s!==r.isShowing&&r.definitionChanged.raiseEvent(r,"isShowing",r.isShowing,s)}this.resumeEvents()}},owner:{get:function(){return this._owner}}});Ge.prototype.computeAvailability=function(){let e=He.MAXIMUM_VALUE,t=He.MINIMUM_VALUE;const i=this._entities.values;for(let n=0,o=i.length;n<o;n++){const r=i[n].availability;if(f(r)){const l=r.start,a=r.stop;B.lessThan(l,e)&&!l.equals(He.MINIMUM_VALUE)&&(e=l),B.greaterThan(a,t)&&!a.equals(He.MAXIMUM_VALUE)&&(t=a)}}return He.MAXIMUM_VALUE.equals(e)&&(e=He.MINIMUM_VALUE),He.MINIMUM_VALUE.equals(t)&&(t=He.MAXIMUM_VALUE),new J({start:e,stop:t})};Ge.prototype.add=function(e){if(!f(e))throw new N("entity is required.");e instanceof it||(e=new it(e));const t=e.id,i=this._entities;if(i.contains(t))throw new N(`An entity with id ${t} already exists in this collection.`);return e.entityCollection=this,i.set(t,e),this._removedEntities.remove(t)||this._addedEntities.set(t,e),e.definitionChanged.addEventListener(Ge.prototype._onEntityDefinitionChanged,this),Ln(this),e};Ge.prototype.remove=function(e){return f(e)?this.removeById(e.id):!1};Ge.prototype.contains=function(e){if(!f(e))throw new N("entity is required");return this._entities.get(e.id)===e};Ge.prototype.removeById=function(e){if(!f(e))return!1;const i=this._entities.get(e);return this._entities.remove(e)?(this._addedEntities.remove(e)||(this._removedEntities.set(e,i),this._changedEntities.remove(e)),this._entities.remove(e),i.definitionChanged.removeEventListener(Ge.prototype._onEntityDefinitionChanged,this),Ln(this),!0):!1};Ge.prototype.removeAll=function(){const e=this._entities,t=e.length,i=e.values,n=this._addedEntities,o=this._removedEntities;for(let s=0;s<t;s++){const r=i[s],l=r.id,a=n.get(l);f(a)||(r.definitionChanged.removeEventListener(Ge.prototype._onEntityDefinitionChanged,this),o.set(l,r))}e.removeAll(),n.removeAll(),this._changedEntities.removeAll(),Ln(this)};Ge.prototype.getById=function(e){if(!f(e))throw new N("id is required.");return this._entities.get(e)};Ge.prototype.getOrCreateEntity=function(e){if(!f(e))throw new N("id is required.");let t=this._entities.get(e);return f(t)||(Fr.id=e,t=new it(Fr),this.add(t)),t};Ge.prototype._onEntityDefinitionChanged=function(e){const t=e.id;this._addedEntities.contains(t)||this._changedEntities.set(t,e),Ln(this)};function Hh(e,t,i,n){function o(){i.raiseEvent(e)}const s=[];t.removeAll();const r=n.length;for(let l=0;l<r;l++){const a=n.get(l);f(a.data)&&s.indexOf(a.data)===-1&&t.add(a.data.definitionChanged,o)}}function Ai(){this._eventHelper=new Is,this._definitionChanged=new le,this._intervals=new Ce,this._intervals.changedEvent.addEventListener(Ai.prototype._intervalsChanged,this)}Object.defineProperties(Ai.prototype,{isConstant:{get:function(){return this._intervals.isEmpty}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._intervals}}});Ai.prototype.getValue=function(e,t){if(!f(e))throw new N("time is required");const i=this._intervals.findDataForIntervalContainingDate(e);if(f(i))return i.getValue(e,t)};Ai.prototype.equals=function(e){return this===e||e instanceof Ai&&this._intervals.equals(e._intervals,te.equals)};Ai.prototype._intervalsChanged=function(){Hh(this,this._eventHelper,this._definitionChanged,this._intervals),this._definitionChanged.raiseEvent(this)};function hi(e){this._referenceFrame=h(e,xt.FIXED),this._definitionChanged=new le,this._composite=new Ai,this._composite.definitionChanged.addEventListener(hi.prototype._raiseDefinitionChanged,this)}Object.defineProperties(hi.prototype,{isConstant:{get:function(){return this._composite.isConstant}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._composite.intervals}},referenceFrame:{get:function(){return this._referenceFrame},set:function(e){this._referenceFrame=e}}});hi.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,xt.FIXED,t)};hi.prototype.getValueInReferenceFrame=function(e,t,i){if(!f(e))throw new N("time is required.");if(!f(t))throw new N("referenceFrame is required.");const n=this._composite._intervals.findDataForIntervalContainingDate(e);if(f(n))return n.getValueInReferenceFrame(e,t,i)};hi.prototype.equals=function(e){return this===e||e instanceof hi&&this._referenceFrame===e._referenceFrame&&this._composite.equals(e._composite,te.equals)};hi.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)};const zr={packedLength:1,pack:function(e,t,i){i=h(i,0),t[i]=e},unpack:function(e,t,i){return t=h(t,0),e[t]}};function Br(e,t,i){let n;const o=e.length,s=i.length,r=o+s;if(e.length=r,o!==t){let l=o-1;for(n=r-1;n>=t;n--)e[n]=e[l--]}for(n=0;n<s;n++)e[t++]=i[n]}function Ur(e,t){return e instanceof B?e:typeof e=="string"?B.fromIso8601(e):B.addSeconds(t,e,new B)}const Vo=[],Ho=[];function _o(e,t,i,n,o){let s=0,r,l,a,c,d,m;for(;s<n.length;){d=Ur(n[s],e),a=li(t,d,B.compare);let g=0,y=0;if(a<0){for(a=~a,c=a*o,l=void 0,m=t[a];s<n.length&&(d=Ur(n[s],e),!(f(l)&&B.compare(l,d)>=0||f(m)&&B.compare(d,m)>=0));){for(Vo[g++]=d,s=s+1,r=0;r<o;r++)Ho[y++]=n[s],s=s+1;l=d}g>0&&(Ho.length=y,Br(i,c,Ho),Vo.length=g,Br(t,a,Vo))}else{for(r=0;r<o;r++)s++,i[a*o+r]=n[s];s++}}}function St(e,t){Q.defined("type",e);let i=e;i===Number&&(i=zr);let n=i.packedLength,o=h(i.packedInterpolationLength,n),s=0,r;if(f(t)){const l=t.length;r=new Array(l);for(let a=0;a<l;a++){let c=t[a];c===Number&&(c=zr);const d=c.packedLength;n+=d,o+=h(c.packedInterpolationLength,d),r[a]=c}s=l}this._type=e,this._innerType=i,this._interpolationDegree=1,this._interpolationAlgorithm=As,this._numberOfPoints=0,this._times=[],this._values=[],this._xTable=[],this._yTable=[],this._packedLength=n,this._packedInterpolationLength=o,this._updateTableLength=!0,this._interpolationResult=new Array(o),this._definitionChanged=new le,this._derivativeTypes=t,this._innerDerivativeTypes=r,this._inputOrder=s,this._forwardExtrapolationType=Gi.NONE,this._forwardExtrapolationDuration=0,this._backwardExtrapolationType=Gi.NONE,this._backwardExtrapolationDuration=0}Object.defineProperties(St.prototype,{isConstant:{get:function(){return this._values.length===0}},definitionChanged:{get:function(){return this._definitionChanged}},type:{get:function(){return this._type}},derivativeTypes:{get:function(){return this._derivativeTypes}},interpolationDegree:{get:function(){return this._interpolationDegree}},interpolationAlgorithm:{get:function(){return this._interpolationAlgorithm}},forwardExtrapolationType:{get:function(){return this._forwardExtrapolationType},set:function(e){this._forwardExtrapolationType!==e&&(this._forwardExtrapolationType=e,this._definitionChanged.raiseEvent(this))}},forwardExtrapolationDuration:{get:function(){return this._forwardExtrapolationDuration},set:function(e){this._forwardExtrapolationDuration!==e&&(this._forwardExtrapolationDuration=e,this._definitionChanged.raiseEvent(this))}},backwardExtrapolationType:{get:function(){return this._backwardExtrapolationType},set:function(e){this._backwardExtrapolationType!==e&&(this._backwardExtrapolationType=e,this._definitionChanged.raiseEvent(this))}},backwardExtrapolationDuration:{get:function(){return this._backwardExtrapolationDuration},set:function(e){this._backwardExtrapolationDuration!==e&&(this._backwardExtrapolationDuration=e,this._definitionChanged.raiseEvent(this))}}});St.prototype.getValue=function(e,t){Q.defined("time",e);const i=this._times,n=i.length;if(n===0)return;let o;const s=this._innerType,r=this._values;let l=li(i,e,B.compare);if(l<0){if(l=~l,l===0){const I=i[l];if(o=this._backwardExtrapolationDuration,this._backwardExtrapolationType===Gi.NONE||o!==0&&B.secondsDifference(I,e)>o)return;if(this._backwardExtrapolationType===Gi.HOLD)return s.unpack(r,0,t)}if(l>=n){l=n-1;const I=i[l];if(o=this._forwardExtrapolationDuration,this._forwardExtrapolationType===Gi.NONE||o!==0&&B.secondsDifference(e,I)>o)return;if(this._forwardExtrapolationType===Gi.HOLD)return l=n-1,s.unpack(r,l*s.packedLength,t)}const a=this._xTable,c=this._yTable,d=this._interpolationAlgorithm,m=this._packedInterpolationLength,g=this._inputOrder;if(this._updateTableLength){this._updateTableLength=!1;const I=Math.min(d.getRequiredDataPoints(this._interpolationDegree,g),n);I!==this._numberOfPoints&&(this._numberOfPoints=I,a.length=I,c.length=I*m)}const y=this._numberOfPoints-1;if(y<1)return;let w=0,p=n-1;if(p-w+1>=y+1){let I=l-(y/2|0)-1;I<w&&(I=w);let D=I+y;D>p&&(D=p,I=D-y,I<w&&(I=w)),w=I,p=D}const _=p-w+1;for(let I=0;I<_;++I)a[I]=B.secondsDifference(i[w+I],i[p]);if(f(s.convertPackedArrayForInterpolation))s.convertPackedArrayForInterpolation(r,w,p,c);else{let I=0;const D=this._packedLength;let E=w*D;const T=(p+1)*D;for(;E<T;)c[I]=r[E],E++,I++}const x=B.secondsDifference(e,i[p]);let S;if(g===0||!f(d.interpolate))S=d.interpolateOrderZero(x,a,c,m,this._interpolationResult);else{const I=Math.floor(m/(g+1));S=d.interpolate(x,a,c,I,g,g,this._interpolationResult)}return f(s.unpackInterpolationResult)?s.unpackInterpolationResult(S,r,w,p,t):s.unpack(S,0,t)}return s.unpack(r,l*this._packedLength,t)};St.prototype.setInterpolationOptions=function(e){if(!f(e))return;let t=!1;const i=e.interpolationAlgorithm,n=e.interpolationDegree;f(i)&&this._interpolationAlgorithm!==i&&(this._interpolationAlgorithm=i,t=!0),f(n)&&this._interpolationDegree!==n&&(this._interpolationDegree=n,t=!0),t&&(this._updateTableLength=!0,this._definitionChanged.raiseEvent(this))};St.prototype.addSample=function(e,t,i){const n=this._innerDerivativeTypes,o=f(n);Q.defined("time",e),Q.defined("value",t),o&&Q.defined("derivatives",i);const s=this._innerType,r=[];if(r.push(e),s.pack(t,r,r.length),o){const l=n.length;for(let a=0;a<l;a++)n[a].pack(i[a],r,r.length)}_o(void 0,this._times,this._values,r,this._packedLength),this._updateTableLength=!0,this._definitionChanged.raiseEvent(this)};St.prototype.addSamples=function(e,t,i){const n=this._innerDerivativeTypes,o=f(n);if(Q.defined("times",e),Q.defined("values",t),e.length!==t.length)throw new N("times and values must be the same length.");if(o&&(!f(i)||i.length!==e.length))throw new N("times and derivativeValues must be the same length.");const s=this._innerType,r=e.length,l=[];for(let a=0;a<r;a++)if(l.push(e[a]),s.pack(t[a],l,l.length),o){const c=i[a],d=n.length;for(let m=0;m<d;m++)n[m].pack(c[m],l,l.length)}_o(void 0,this._times,this._values,l,this._packedLength),this._updateTableLength=!0,this._definitionChanged.raiseEvent(this)};St.prototype.addSamplesPackedArray=function(e,t){Q.defined("packedSamples",e),_o(t,this._times,this._values,e,this._packedLength),this._updateTableLength=!0,this._definitionChanged.raiseEvent(this)};St.prototype.removeSample=function(e){Q.defined("time",e);const t=li(this._times,e,B.compare);return t<0?!1:(_l(this,t,1),!0)};function _l(e,t,i){const n=e._packedLength;e._times.splice(t,i),e._values.splice(t*n,i*n),e._updateTableLength=!0,e._definitionChanged.raiseEvent(e)}St.prototype.removeSamples=function(e){Q.defined("timeInterval",e);const t=this._times;let i=li(t,e.start,B.compare);i<0?i=~i:e.isStartIncluded||++i;let n=li(t,e.stop,B.compare);n<0?n=~n:e.isStopIncluded&&++n,_l(this,i,n-i)};St.prototype.equals=function(e){if(this===e)return!0;if(!f(e)||this._type!==e._type||this._interpolationDegree!==e._interpolationDegree||this._interpolationAlgorithm!==e._interpolationAlgorithm)return!1;const t=this._derivativeTypes,i=f(t),n=e._derivativeTypes,o=f(n);if(i!==o)return!1;let s,r;if(i){if(r=t.length,r!==n.length)return!1;for(s=0;s<r;s++)if(t[s]!==n[s])return!1}const l=this._times,a=e._times;if(r=l.length,r!==a.length)return!1;for(s=0;s<r;s++)if(!B.equals(l[s],a[s]))return!1;const c=this._values,d=e._values;for(r=c.length,s=0;s<r;s++)if(c[s]!==d[s])return!1;return!0};St._mergeNewSamples=_o;function Ct(e,t){t=h(t,0);let i;if(t>0){i=new Array(t);for(let n=0;n<t;n++)i[n]=b}this._numberOfDerivatives=t,this._property=new St(b,i),this._definitionChanged=new le,this._referenceFrame=h(e,xt.FIXED),this._property._definitionChanged.addEventListener(function(){this._definitionChanged.raiseEvent(this)},this)}Object.defineProperties(Ct.prototype,{isConstant:{get:function(){return this._property.isConstant}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return this._referenceFrame}},interpolationDegree:{get:function(){return this._property.interpolationDegree}},interpolationAlgorithm:{get:function(){return this._property.interpolationAlgorithm}},numberOfDerivatives:{get:function(){return this._numberOfDerivatives}},forwardExtrapolationType:{get:function(){return this._property.forwardExtrapolationType},set:function(e){this._property.forwardExtrapolationType=e}},forwardExtrapolationDuration:{get:function(){return this._property.forwardExtrapolationDuration},set:function(e){this._property.forwardExtrapolationDuration=e}},backwardExtrapolationType:{get:function(){return this._property.backwardExtrapolationType},set:function(e){this._property.backwardExtrapolationType=e}},backwardExtrapolationDuration:{get:function(){return this._property.backwardExtrapolationDuration},set:function(e){this._property.backwardExtrapolationDuration=e}}});Ct.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,xt.FIXED,t)};Ct.prototype.getValueInReferenceFrame=function(e,t,i){if(Q.defined("time",e),Q.defined("referenceFrame",t),i=this._property.getValue(e,i),f(i))return Ni.convertToReferenceFrame(e,i,this._referenceFrame,t,i)};Ct.prototype.setInterpolationOptions=function(e){this._property.setInterpolationOptions(e)};Ct.prototype.addSample=function(e,t,i){const n=this._numberOfDerivatives;if(n>0&&(!f(i)||i.length!==n))throw new N("derivatives length must be equal to the number of derivatives.");this._property.addSample(e,t,i)};Ct.prototype.addSamples=function(e,t,i){this._property.addSamples(e,t,i)};Ct.prototype.addSamplesPackedArray=function(e,t){this._property.addSamplesPackedArray(e,t)};Ct.prototype.removeSample=function(e){return this._property.removeSample(e)};Ct.prototype.removeSamples=function(e){this._property.removeSamples(e)};Ct.prototype.equals=function(e){return this===e||e instanceof Ct&&te.equals(this._property,e._property)&&this._referenceFrame===e._referenceFrame};function ui(e){this._definitionChanged=new le,this._value=void 0,this._removeSubscription=void 0,this.setValue(e)}Object.defineProperties(ui.prototype,{isConstant:{get:function(){return te.isConstant(this._value)}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return f(this._value)?this._value.referenceFrame:xt.FIXED}}});ui.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,xt.FIXED,t)};ui.prototype.setValue=function(e){this._value!==e&&(this._value=e,f(this._removeSubscription)&&(this._removeSubscription(),this._removeSubscription=void 0),f(e)&&(this._removeSubscription=e.definitionChanged.addEventListener(this._raiseDefinitionChanged,this)),this._definitionChanged.raiseEvent(this))};ui.prototype.getValueInReferenceFrame=function(e,t,i){if(!f(e))throw new N("time is required.");if(!f(t))throw new N("referenceFrame is required.");if(f(this._value))return i=this._value.getValueInReferenceFrame(e,t,i),f(i)?ai.default.scaleToGeodeticSurface(i,i):void 0};ui.prototype.equals=function(e){return this===e||e instanceof ui&&this._value===e._value};ui.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)};const vn=15,ms=30,gs=19,Wh=29,ro=256,Ls=ro+1+Wh,Vr=2*Ls+1,sn=256,qh=7,Hr=16,Wr=17,qr=18,Wo=8*2,ao=-1,Gh=1,Wn=2,Yh=0,Wi=0,Gr=1,jh=3,Xe=4,It=0,ml=1,qn=2,vt=-2,Xh=-3,Ui=-5;function mo(e){return go(e.map(([t,i])=>new Array(t).fill(i,0,t)))}function go(e){return e.reduce((t,i)=>t.concat(Array.isArray(i)?go(i):i),[])}const Yr=[0,1,2,3].concat(...mo([[2,4],[2,5],[4,6],[4,7],[8,8],[8,9],[16,10],[16,11],[32,12],[32,13],[64,14],[64,15],[2,0],[1,16],[1,17],[2,18],[2,19],[4,20],[4,21],[8,22],[8,23],[16,24],[16,25],[32,26],[32,27],[64,28],[64,29]]));function me(){const e=this;function t(o){const s=e.dyn_tree,r=e.stat_desc.static_tree,l=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,c=e.stat_desc.max_length;let d,m,g,y,w,p,u=0;for(y=0;y<=vn;y++)o.bl_count[y]=0;for(s[o.heap[o.heap_max]*2+1]=0,d=o.heap_max+1;d<Vr;d++)m=o.heap[d],y=s[s[m*2+1]*2+1]+1,y>c&&(y=c,u++),s[m*2+1]=y,!(m>e.max_code)&&(o.bl_count[y]++,w=0,m>=a&&(w=l[m-a]),p=s[m*2],o.opt_len+=p*(y+w),r&&(o.static_len+=p*(r[m*2+1]+w)));if(u!==0){do{for(y=c-1;o.bl_count[y]===0;)y--;o.bl_count[y]--,o.bl_count[y+1]+=2,o.bl_count[c]--,u-=2}while(u>0);for(y=c;y!==0;y--)for(m=o.bl_count[y];m!==0;)g=o.heap[--d],!(g>e.max_code)&&(s[g*2+1]!=y&&(o.opt_len+=(y-s[g*2+1])*s[g*2],s[g*2+1]=y),m--)}}function i(o,s){let r=0;do r|=o&1,o>>>=1,r<<=1;while(--s>0);return r>>>1}function n(o,s,r){const l=[];let a=0,c,d,m;for(c=1;c<=vn;c++)l[c]=a=a+r[c-1]<<1;for(d=0;d<=s;d++)m=o[d*2+1],m!==0&&(o[d*2]=i(l[m]++,m))}e.build_tree=function(o){const s=e.dyn_tree,r=e.stat_desc.static_tree,l=e.stat_desc.elems;let a,c,d=-1,m;for(o.heap_len=0,o.heap_max=Vr,a=0;a<l;a++)s[a*2]!==0?(o.heap[++o.heap_len]=d=a,o.depth[a]=0):s[a*2+1]=0;for(;o.heap_len<2;)m=o.heap[++o.heap_len]=d<2?++d:0,s[m*2]=1,o.depth[m]=0,o.opt_len--,r&&(o.static_len-=r[m*2+1]);for(e.max_code=d,a=Math.floor(o.heap_len/2);a>=1;a--)o.pqdownheap(s,a);m=l;do a=o.heap[1],o.heap[1]=o.heap[o.heap_len--],o.pqdownheap(s,1),c=o.heap[1],o.heap[--o.heap_max]=a,o.heap[--o.heap_max]=c,s[m*2]=s[a*2]+s[c*2],o.depth[m]=Math.max(o.depth[a],o.depth[c])+1,s[a*2+1]=s[c*2+1]=m,o.heap[1]=m++,o.pqdownheap(s,1);while(o.heap_len>=2);o.heap[--o.heap_max]=o.heap[1],t(o),n(s,e.max_code,o.bl_count)}}me._length_code=[0,1,2,3,4,5,6,7].concat(...mo([[2,8],[2,9],[2,10],[2,11],[4,12],[4,13],[4,14],[4,15],[8,16],[8,17],[8,18],[8,19],[16,20],[16,21],[16,22],[16,23],[32,24],[32,25],[32,26],[31,27],[1,28]]));me.base_length=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0];me.base_dist=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576];me.d_code=function(e){return e<256?Yr[e]:Yr[256+(e>>>7)]};me.extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];me.extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];me.extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];me.bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function Le(e,t,i,n,o){const s=this;s.static_tree=e,s.extra_bits=t,s.extra_base=i,s.elems=n,s.max_length=o}const Zh=[12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,19,275,147,403,83,339,211,467,51,307,179,435,115,371,243,499,11,267,139,395,75,331,203,459,43,299,171,427,107,363,235,491,27,283,155,411,91,347,219,475,59,315,187,443,123,379,251,507,7,263,135,391,71,327,199,455,39,295,167,423,103,359,231,487,23,279,151,407,87,343,215,471,55,311,183,439,119,375,247,503,15,271,143,399,79,335,207,463,47,303,175,431,111,367,239,495,31,287,159,415,95,351,223,479,63,319,191,447,127,383,255,511,0,64,32,96,16,80,48,112,8,72,40,104,24,88,56,120,4,68,36,100,20,84,52,116,3,131,67,195,35,163,99,227],Kh=mo([[144,8],[112,9],[24,7],[8,8]]);Le.static_ltree=go(Zh.map((e,t)=>[e,Kh[t]]));const $h=[0,16,8,24,4,20,12,28,2,18,10,26,6,22,14,30,1,17,9,25,5,21,13,29,3,19,11,27,7,23],Jh=mo([[30,5]]);Le.static_dtree=go($h.map((e,t)=>[e,Jh[t]]));Le.static_l_desc=new Le(Le.static_ltree,me.extra_lbits,ro+1,Ls,vn);Le.static_d_desc=new Le(Le.static_dtree,me.extra_dbits,0,ms,vn);Le.static_bl_desc=new Le(null,me.extra_blbits,0,gs,qh);const Qh=9,eu=8;function Lt(e,t,i,n,o){const s=this;s.good_length=e,s.max_lazy=t,s.nice_length=i,s.max_chain=n,s.func=o}const gl=0,eo=1,Si=2,Dt=[new Lt(0,0,0,0,gl),new Lt(4,4,8,4,eo),new Lt(4,5,16,8,eo),new Lt(4,6,32,32,eo),new Lt(4,4,16,16,Si),new Lt(8,16,32,32,Si),new Lt(8,16,128,128,Si),new Lt(8,32,128,256,Si),new Lt(32,128,258,1024,Si),new Lt(32,258,258,4096,Si)],Gn=["need dictionary","stream end","","","stream error","data error","","buffer error","",""],_t=0,Yn=1,rn=2,jn=3,tu=32,qo=42,Xn=113,an=666,Go=8,iu=0,Yo=1,nu=2,we=3,to=258,ct=to+we+1;function jr(e,t,i,n){const o=e[t*2],s=e[i*2];return o<s||o==s&&n[t]<=n[i]}function ou(){const e=this;let t,i,n,o,s,r,l,a,c,d,m,g,y,w,p,u,_,x,S,I,D,E,T,v,A,R,O,U,F,W,q,k,V;const j=new me,fe=new me,G=new me;e.depth=[];let ue,$,ie,ve,he,_e;e.bl_count=[],e.heap=[],q=[],k=[],V=[];function Et(){c=2*s,m[y-1]=0;for(let P=0;P<y-1;P++)m[P]=0;R=Dt[O].max_lazy,F=Dt[O].good_length,W=Dt[O].nice_length,A=Dt[O].max_chain,D=0,_=0,T=0,x=v=we-1,I=0,g=0}function nt(){let P;for(P=0;P<Ls;P++)q[P*2]=0;for(P=0;P<ms;P++)k[P*2]=0;for(P=0;P<gs;P++)V[P*2]=0;q[sn*2]=1,e.opt_len=e.static_len=0,$=ie=0}function bt(){j.dyn_tree=q,j.stat_desc=Le.static_l_desc,fe.dyn_tree=k,fe.stat_desc=Le.static_d_desc,G.dyn_tree=V,G.stat_desc=Le.static_bl_desc,he=0,_e=0,ve=8,nt()}e.pqdownheap=function(P,z){const L=e.heap,M=L[z];let H=z<<1;for(;H<=e.heap_len&&(H<e.heap_len&&jr(P,L[H+1],L[H],e.depth)&&H++,!jr(P,M,L[H],e.depth));)L[z]=L[H],z=H,H<<=1;L[z]=M};function Ye(P,z){let L=-1,M,H=P[0*2+1],K=0,ee=7,Ne=4;H===0&&(ee=138,Ne=3),P[(z+1)*2+1]=65535;for(let je=0;je<=z;je++)M=H,H=P[(je+1)*2+1],!(++K<ee&&M==H)&&(K<Ne?V[M*2]+=K:M!==0?(M!=L&&V[M*2]++,V[Hr*2]++):K<=10?V[Wr*2]++:V[qr*2]++,K=0,L=M,H===0?(ee=138,Ne=3):M==H?(ee=6,Ne=3):(ee=7,Ne=4))}function Rt(){let P;for(Ye(q,j.max_code),Ye(k,fe.max_code),G.build_tree(e),P=gs-1;P>=3&&V[me.bl_order[P]*2+1]===0;P--);return e.opt_len+=3*(P+1)+5+5+4,P}function Re(P){e.pending_buf[e.pending++]=P}function Oe(P){Re(P&255),Re(P>>>8&255)}function Nt(P){Re(P>>8&255),Re(P&255&255)}function ce(P,z){let L;const M=z;_e>Wo-M?(L=P,he|=L<<_e&65535,Oe(he),he=L>>>Wo-_e,_e+=M-Wo):(he|=P<<_e&65535,_e+=M)}function pe(P,z){const L=P*2;ce(z[L]&65535,z[L+1]&65535)}function Fe(P,z){let L,M=-1,H,K=P[0*2+1],ee=0,Ne=7,je=4;for(K===0&&(Ne=138,je=3),L=0;L<=z;L++)if(H=K,K=P[(L+1)*2+1],!(++ee<Ne&&H==K)){if(ee<je)do pe(H,V);while(--ee!==0);else H!==0?(H!=M&&(pe(H,V),ee--),pe(Hr,V),ce(ee-3,2)):ee<=10?(pe(Wr,V),ce(ee-3,3)):(pe(qr,V),ce(ee-11,7));ee=0,M=H,K===0?(Ne=138,je=3):H==K?(Ne=6,je=3):(Ne=7,je=4)}}function be(P,z,L){let M;for(ce(P-257,5),ce(z-1,5),ce(L-4,4),M=0;M<L;M++)ce(V[me.bl_order[M]*2+1],3);Fe(q,P-1),Fe(k,z-1)}function Se(){_e==16?(Oe(he),he=0,_e=0):_e>=8&&(Re(he&255),he>>>=8,_e-=8)}function ot(){ce(Yo<<1,3),pe(sn,Le.static_ltree),Se(),1+ve+10-_e<9&&(ce(Yo<<1,3),pe(sn,Le.static_ltree),Se()),ve=7}function st(P,z){let L,M,H;if(e.dist_buf[$]=P,e.lc_buf[$]=z&255,$++,P===0?q[z*2]++:(ie++,P--,q[(me._length_code[z]+ro+1)*2]++,k[me.d_code(P)*2]++),!($&8191)&&O>2){for(L=$*8,M=D-_,H=0;H<ms;H++)L+=k[H*2]*(5+me.extra_dbits[H]);if(L>>>=3,ie<Math.floor($/2)&&L<Math.floor(M/2))return!0}return $==ue-1}function ze(P,z){let L,M,H=0,K,ee;if($!==0)do L=e.dist_buf[H],M=e.lc_buf[H],H++,L===0?pe(M,P):(K=me._length_code[M],pe(K+ro+1,P),ee=me.extra_lbits[K],ee!==0&&(M-=me.base_length[K],ce(M,ee)),L--,K=me.d_code(L),pe(K,z),ee=me.extra_dbits[K],ee!==0&&(L-=me.base_dist[K],ce(L,ee)));while(H<$);pe(sn,P),ve=P[sn*2+1]}function Li(){_e>8?Oe(he):_e>0&&Re(he&255),he=0,_e=0}function Wt(P,z,L){Li(),ve=8,Oe(z),Oe(~z),e.pending_buf.set(a.subarray(P,P+z),e.pending),e.pending+=z}function rt(P,z,L){ce((iu<<1)+(L?1:0),3),Wt(P,z)}function Mi(P,z,L){let M,H,K=0;O>0?(j.build_tree(e),fe.build_tree(e),K=Rt(),M=e.opt_len+3+7>>>3,H=e.static_len+3+7>>>3,H<=M&&(M=H)):M=H=z+5,z+4<=M&&P!=-1?rt(P,z,L):H==M?(ce((Yo<<1)+(L?1:0),3),ze(Le.static_ltree,Le.static_dtree)):(ce((nu<<1)+(L?1:0),3),be(j.max_code+1,fe.max_code+1,K+1),ze(q,k)),nt(),L&&Li()}function at(P){Mi(_>=0?_:-1,D-_,P),_=D,t.flush_pending()}function Jt(){let P,z,L,M;do{if(M=c-T-D,M===0&&D===0&&T===0)M=s;else if(M==-1)M--;else if(D>=s+s-ct){a.set(a.subarray(s,s+s),0),E-=s,D-=s,_-=s,P=y,L=P;do z=m[--L]&65535,m[L]=z>=s?z-s:0;while(--P!==0);P=s,L=P;do z=d[--L]&65535,d[L]=z>=s?z-s:0;while(--P!==0);M+=s}if(t.avail_in===0)return;P=t.read_buf(a,D+T,M),T+=P,T>=we&&(g=a[D]&255,g=(g<<u^a[D+1]&255)&p)}while(T<ct&&t.avail_in!==0)}function So(P){let z=65535,L;for(z>n-5&&(z=n-5);;){if(T<=1){if(Jt(),T===0&&P==Wi)return _t;if(T===0)break}if(D+=T,T=0,L=_+z,(D===0||D>=L)&&(T=D-L,D=L,at(!1),t.avail_out===0)||D-_>=s-ct&&(at(!1),t.avail_out===0))return _t}return at(P==Xe),t.avail_out===0?P==Xe?rn:_t:P==Xe?jn:Yn}function Fn(P){let z=A,L=D,M,H,K=v;const ee=D>s-ct?D-(s-ct):0;let Ne=W;const je=l,wi=D+to;let Fi=a[L+K-1],pt=a[L+K];v>=F&&(z>>=2),Ne>T&&(Ne=T);do if(M=P,!(a[M+K]!=pt||a[M+K-1]!=Fi||a[M]!=a[L]||a[++M]!=a[L+1])){L+=2,M++;do;while(a[++L]==a[++M]&&a[++L]==a[++M]&&a[++L]==a[++M]&&a[++L]==a[++M]&&a[++L]==a[++M]&&a[++L]==a[++M]&&a[++L]==a[++M]&&a[++L]==a[++M]&&L<wi);if(H=to-(wi-L),L=wi-to,H>K){if(E=P,K=H,H>=Ne)break;Fi=a[L+K-1],pt=a[L+K]}}while((P=d[P&je]&65535)>ee&&--z!==0);return K<=T?K:T}function en(P){let z=0,L;for(;;){if(T<ct){if(Jt(),T<ct&&P==Wi)return _t;if(T===0)break}if(T>=we&&(g=(g<<u^a[D+(we-1)]&255)&p,z=m[g]&65535,d[D&l]=m[g],m[g]=D),z!==0&&(D-z&65535)<=s-ct&&U!=Wn&&(x=Fn(z)),x>=we)if(L=st(D-E,x-we),T-=x,x<=R&&T>=we){x--;do D++,g=(g<<u^a[D+(we-1)]&255)&p,z=m[g]&65535,d[D&l]=m[g],m[g]=D;while(--x!==0);D++}else D+=x,x=0,g=a[D]&255,g=(g<<u^a[D+1]&255)&p;else L=st(0,a[D]&255),T--,D++;if(L&&(at(!1),t.avail_out===0))return _t}return at(P==Xe),t.avail_out===0?P==Xe?rn:_t:P==Xe?jn:Yn}function yi(P){let z=0,L,M;for(;;){if(T<ct){if(Jt(),T<ct&&P==Wi)return _t;if(T===0)break}if(T>=we&&(g=(g<<u^a[D+(we-1)]&255)&p,z=m[g]&65535,d[D&l]=m[g],m[g]=D),v=x,S=E,x=we-1,z!==0&&v<R&&(D-z&65535)<=s-ct&&(U!=Wn&&(x=Fn(z)),x<=5&&(U==Gh||x==we&&D-E>4096)&&(x=we-1)),v>=we&&x<=v){M=D+T-we,L=st(D-1-S,v-we),T-=v-1,v-=2;do++D<=M&&(g=(g<<u^a[D+(we-1)]&255)&p,z=m[g]&65535,d[D&l]=m[g],m[g]=D);while(--v!==0);if(I=0,x=we-1,D++,L&&(at(!1),t.avail_out===0))return _t}else if(I!==0){if(L=st(0,a[D-1]&255),L&&at(!1),D++,T--,t.avail_out===0)return _t}else I=1,D++,T--}return I!==0&&(L=st(0,a[D-1]&255),I=0),at(P==Xe),t.avail_out===0?P==Xe?rn:_t:P==Xe?jn:Yn}function ki(P){return P.total_in=P.total_out=0,P.msg=null,e.pending=0,e.pending_out=0,i=Xn,o=Wi,bt(),Et(),It}e.deflateInit=function(P,z,L,M,H,K){return M||(M=Go),H||(H=eu),K||(K=Yh),P.msg=null,z==ao&&(z=6),H<1||H>Qh||M!=Go||L<9||L>15||z<0||z>9||K<0||K>Wn?vt:(P.dstate=e,r=L,s=1<<r,l=s-1,w=H+7,y=1<<w,p=y-1,u=Math.floor((w+we-1)/we),a=new Uint8Array(s*2),d=[],m=[],ue=1<<H+6,e.pending_buf=new Uint8Array(ue*4),n=ue*4,e.dist_buf=new Uint16Array(ue),e.lc_buf=new Uint8Array(ue),O=z,U=K,ki(P))},e.deflateEnd=function(){return i!=qo&&i!=Xn&&i!=an?vt:(e.lc_buf=null,e.dist_buf=null,e.pending_buf=null,m=null,d=null,a=null,e.dstate=null,i==Xn?Xh:It)},e.deflateParams=function(P,z,L){let M=It;return z==ao&&(z=6),z<0||z>9||L<0||L>Wn?vt:(Dt[O].func!=Dt[z].func&&P.total_in!==0&&(M=P.deflate(Gr)),O!=z&&(O=z,R=Dt[O].max_lazy,F=Dt[O].good_length,W=Dt[O].nice_length,A=Dt[O].max_chain),U=L,M)},e.deflateSetDictionary=function(P,z,L){let M=L,H,K=0;if(!z||i!=qo)return vt;if(M<we)return It;for(M>s-ct&&(M=s-ct,K=L-M),a.set(z.subarray(K,K+M),0),D=M,_=M,g=a[0]&255,g=(g<<u^a[1]&255)&p,H=0;H<=M-we;H++)g=(g<<u^a[H+(we-1)]&255)&p,d[H&l]=m[g],m[g]=H;return It},e.deflate=function(P,z){let L,M,H,K,ee;if(z>Xe||z<0)return vt;if(!P.next_out||!P.next_in&&P.avail_in!==0||i==an&&z!=Xe)return P.msg=Gn[qn-vt],vt;if(P.avail_out===0)return P.msg=Gn[qn-Ui],Ui;if(t=P,K=o,o=z,i==qo&&(M=Go+(r-8<<4)<<8,H=(O-1&255)>>1,H>3&&(H=3),M|=H<<6,D!==0&&(M|=tu),M+=31-M%31,i=Xn,Nt(M)),e.pending!==0){if(t.flush_pending(),t.avail_out===0)return o=-1,It}else if(t.avail_in===0&&z<=K&&z!=Xe)return t.msg=Gn[qn-Ui],Ui;if(i==an&&t.avail_in!==0)return P.msg=Gn[qn-Ui],Ui;if(t.avail_in!==0||T!==0||z!=Wi&&i!=an){switch(ee=-1,Dt[O].func){case gl:ee=So(z);break;case eo:ee=en(z);break;case Si:ee=yi(z);break}if((ee==rn||ee==jn)&&(i=an),ee==_t||ee==rn)return t.avail_out===0&&(o=-1),It;if(ee==Yn){if(z==Gr)ot();else if(rt(0,0,!1),z==jh)for(L=0;L<y;L++)m[L]=0;if(t.flush_pending(),t.avail_out===0)return o=-1,It}}return z!=Xe?It:ml}}function yl(){const e=this;e.next_in_index=0,e.next_out_index=0,e.avail_in=0,e.total_in=0,e.avail_out=0,e.total_out=0}yl.prototype={deflateInit(e,t){const i=this;return i.dstate=new ou,t||(t=vn),i.dstate.deflateInit(i,e,t)},deflate(e){const t=this;return t.dstate?t.dstate.deflate(t,e):vt},deflateEnd(){const e=this;if(!e.dstate)return vt;const t=e.dstate.deflateEnd();return e.dstate=null,t},deflateParams(e,t){const i=this;return i.dstate?i.dstate.deflateParams(i,e,t):vt},deflateSetDictionary(e,t){const i=this;return i.dstate?i.dstate.deflateSetDictionary(i,e,t):vt},read_buf(e,t,i){const n=this;let o=n.avail_in;return o>i&&(o=i),o===0?0:(n.avail_in-=o,e.set(n.next_in.subarray(n.next_in_index,n.next_in_index+o),t),n.next_in_index+=o,n.total_in+=o,o)},flush_pending(){const e=this;let t=e.dstate.pending;t>e.avail_out&&(t=e.avail_out),t!==0&&(e.next_out.set(e.dstate.pending_buf.subarray(e.dstate.pending_out,e.dstate.pending_out+t),e.next_out_index),e.next_out_index+=t,e.dstate.pending_out+=t,e.total_out+=t,e.avail_out-=t,e.dstate.pending-=t,e.dstate.pending===0&&(e.dstate.pending_out=0))}};function su(e){const t=this,i=new yl,n=ru(e&&e.chunkSize?e.chunkSize:64*1024),o=Wi,s=new Uint8Array(n);let r=e?e.level:ao;typeof r>"u"&&(r=ao),i.deflateInit(r),i.next_out=s,t.append=function(l,a){let c,d,m=0,g=0,y=0;const w=[];if(l.length){i.next_in_index=0,i.next_in=l,i.avail_in=l.length;do{if(i.next_out_index=0,i.avail_out=n,c=i.deflate(o),c!=It)throw new Error("deflating: "+i.msg);i.next_out_index&&(i.next_out_index==n?w.push(new Uint8Array(s)):w.push(s.subarray(0,i.next_out_index))),y+=i.next_out_index,a&&i.next_in_index>0&&i.next_in_index!=m&&(a(i.next_in_index),m=i.next_in_index)}while(i.avail_in>0||i.avail_out===0);return w.length>1?(d=new Uint8Array(y),w.forEach(function(p){d.set(p,g),g+=p.length})):d=w[0]?new Uint8Array(w[0]):new Uint8Array,d}},t.flush=function(){let l,a,c=0,d=0;const m=[];do{if(i.next_out_index=0,i.avail_out=n,l=i.deflate(Xe),l!=ml&&l!=It)throw new Error("deflating: "+i.msg);n-i.avail_out>0&&m.push(s.slice(0,i.next_out_index)),d+=i.next_out_index}while(i.avail_in>0||i.avail_out===0);return i.deflateEnd(),a=new Uint8Array(d),m.forEach(function(g){a.set(g,c),c+=g.length}),a}}function ru(e){return e+5*(Math.floor(e/16383)+1)}const au=15,re=0,jt=1,lu=2,Ke=-2,ge=-3,Xr=-4,Xt=-5,dt=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],wl=1440,cu=0,du=4,hu=9,uu=5,fu=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],pu=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],_u=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],mu=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],gu=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],yu=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ei=15;function ys(){const e=this;let t,i,n,o,s,r;function l(c,d,m,g,y,w,p,u,_,x,S){let I,D,E,T,v,A,R,O,U,F,W,q,k,V,j;F=0,v=m;do n[c[d+F]]++,F++,v--;while(v!==0);if(n[0]==m)return p[0]=-1,u[0]=0,re;for(O=u[0],A=1;A<=ei&&n[A]===0;A++);for(R=A,O<A&&(O=A),v=ei;v!==0&&n[v]===0;v--);for(E=v,O>v&&(O=v),u[0]=O,V=1<<A;A<v;A++,V<<=1)if((V-=n[A])<0)return ge;if((V-=n[v])<0)return ge;for(n[v]+=V,r[1]=A=0,F=1,k=2;--v!==0;)r[k]=A+=n[F],k++,F++;v=0,F=0;do(A=c[d+F])!==0&&(S[r[A]++]=v),F++;while(++v<m);for(m=r[E],r[0]=v=0,F=0,T=-1,q=-O,s[0]=0,W=0,j=0;R<=E;R++)for(I=n[R];I--!==0;){for(;R>q+O;){if(T++,q+=O,j=E-q,j=j>O?O:j,(D=1<<(A=R-q))>I+1&&(D-=I+1,k=R,A<j))for(;++A<j&&!((D<<=1)<=n[++k]);)D-=n[k];if(j=1<<A,x[0]+j>wl)return ge;s[T]=W=x[0],x[0]+=j,T!==0?(r[T]=v,o[0]=A,o[1]=O,A=v>>>q-O,o[2]=W-s[T-1]-A,_.set(o,(s[T-1]+A)*3)):p[0]=W}for(o[1]=R-q,F>=m?o[0]=192:S[F]<g?(o[0]=S[F]<256?0:96,o[2]=S[F++]):(o[0]=w[S[F]-g]+16+64,o[2]=y[S[F++]-g]),D=1<<R-q,A=v>>>q;A<j;A+=D)_.set(o,(W+A)*3);for(A=1<<R-1;v&A;A>>>=1)v^=A;for(v^=A,U=(1<<q)-1;(v&U)!=r[T];)T--,q-=O,U=(1<<q)-1}return V!==0&&E!=1?Xt:re}function a(c){let d;for(t||(t=[],i=[],n=new Int32Array(ei+1),o=[],s=new Int32Array(ei),r=new Int32Array(ei+1)),i.length<c&&(i=[]),d=0;d<c;d++)i[d]=0;for(d=0;d<ei+1;d++)n[d]=0;for(d=0;d<3;d++)o[d]=0;s.set(n.subarray(0,ei),0),r.set(n.subarray(0,ei+1),0)}e.inflate_trees_bits=function(c,d,m,g,y){let w;return a(19),t[0]=0,w=l(c,0,19,19,null,null,m,d,g,t,i),w==ge?y.msg="oversubscribed dynamic bit lengths tree":(w==Xt||d[0]===0)&&(y.msg="incomplete dynamic bit lengths tree",w=ge),w},e.inflate_trees_dynamic=function(c,d,m,g,y,w,p,u,_){let x;return a(288),t[0]=0,x=l(m,0,c,257,_u,mu,w,g,u,t,i),x!=re||g[0]===0?(x==ge?_.msg="oversubscribed literal/length tree":x!=Xr&&(_.msg="incomplete literal/length tree",x=ge),x):(a(288),x=l(m,c,d,0,gu,yu,p,y,u,t,i),x!=re||y[0]===0&&c>257?(x==ge?_.msg="oversubscribed distance tree":x==Xt?(_.msg="incomplete distance tree",x=ge):x!=Xr&&(_.msg="empty distance tree with lengths",x=ge),x):re)}}ys.inflate_trees_fixed=function(e,t,i,n){return e[0]=hu,t[0]=uu,i[0]=fu,n[0]=pu,re};const Zn=0,Zr=1,Kr=2,$r=3,Jr=4,Qr=5,ea=6,jo=7,ta=8,Kn=9;function wu(){const e=this;let t,i=0,n,o=0,s=0,r=0,l=0,a=0,c=0,d=0,m,g=0,y,w=0;function p(u,_,x,S,I,D,E,T){let v,A,R,O,U,F,W,q,k,V,j,fe,G,ue,$,ie;W=T.next_in_index,q=T.avail_in,U=E.bitb,F=E.bitk,k=E.write,V=k<E.read?E.read-k-1:E.end-k,j=dt[u],fe=dt[_];do{for(;F<20;)q--,U|=(T.read_byte(W++)&255)<<F,F+=8;if(v=U&j,A=x,R=S,ie=(R+v)*3,(O=A[ie])===0){U>>=A[ie+1],F-=A[ie+1],E.win[k++]=A[ie+2],V--;continue}do{if(U>>=A[ie+1],F-=A[ie+1],O&16){for(O&=15,G=A[ie+2]+(U&dt[O]),U>>=O,F-=O;F<15;)q--,U|=(T.read_byte(W++)&255)<<F,F+=8;v=U&fe,A=I,R=D,ie=(R+v)*3,O=A[ie];do if(U>>=A[ie+1],F-=A[ie+1],O&16){for(O&=15;F<O;)q--,U|=(T.read_byte(W++)&255)<<F,F+=8;if(ue=A[ie+2]+(U&dt[O]),U>>=O,F-=O,V-=G,k>=ue)$=k-ue,k-$>0&&2>k-$?(E.win[k++]=E.win[$++],E.win[k++]=E.win[$++],G-=2):(E.win.set(E.win.subarray($,$+2),k),k+=2,$+=2,G-=2);else{$=k-ue;do $+=E.end;while($<0);if(O=E.end-$,G>O){if(G-=O,k-$>0&&O>k-$)do E.win[k++]=E.win[$++];while(--O!==0);else E.win.set(E.win.subarray($,$+O),k),k+=O,$+=O,O=0;$=0}}if(k-$>0&&G>k-$)do E.win[k++]=E.win[$++];while(--G!==0);else E.win.set(E.win.subarray($,$+G),k),k+=G,$+=G,G=0;break}else if(!(O&64))v+=A[ie+2],v+=U&dt[O],ie=(R+v)*3,O=A[ie];else return T.msg="invalid distance code",G=T.avail_in-q,G=F>>3<G?F>>3:G,q+=G,W-=G,F-=G<<3,E.bitb=U,E.bitk=F,T.avail_in=q,T.total_in+=W-T.next_in_index,T.next_in_index=W,E.write=k,ge;while(!0);break}if(O&64)return O&32?(G=T.avail_in-q,G=F>>3<G?F>>3:G,q+=G,W-=G,F-=G<<3,E.bitb=U,E.bitk=F,T.avail_in=q,T.total_in+=W-T.next_in_index,T.next_in_index=W,E.write=k,jt):(T.msg="invalid literal/length code",G=T.avail_in-q,G=F>>3<G?F>>3:G,q+=G,W-=G,F-=G<<3,E.bitb=U,E.bitk=F,T.avail_in=q,T.total_in+=W-T.next_in_index,T.next_in_index=W,E.write=k,ge);if(v+=A[ie+2],v+=U&dt[O],ie=(R+v)*3,(O=A[ie])===0){U>>=A[ie+1],F-=A[ie+1],E.win[k++]=A[ie+2],V--;break}}while(!0)}while(V>=258&&q>=10);return G=T.avail_in-q,G=F>>3<G?F>>3:G,q+=G,W-=G,F-=G<<3,E.bitb=U,E.bitk=F,T.avail_in=q,T.total_in+=W-T.next_in_index,T.next_in_index=W,E.write=k,re}e.init=function(u,_,x,S,I,D){t=Zn,c=u,d=_,m=x,g=S,y=I,w=D,n=null},e.proc=function(u,_,x){let S,I,D,E=0,T=0,v=0,A,R,O,U;for(v=_.next_in_index,A=_.avail_in,E=u.bitb,T=u.bitk,R=u.write,O=R<u.read?u.read-R-1:u.end-R;;)switch(t){case Zn:if(O>=258&&A>=10&&(u.bitb=E,u.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,u.write=R,x=p(c,d,m,g,y,w,u,_),v=_.next_in_index,A=_.avail_in,E=u.bitb,T=u.bitk,R=u.write,O=R<u.read?u.read-R-1:u.end-R,x!=re)){t=x==jt?jo:Kn;break}s=c,n=m,o=g,t=Zr;case Zr:for(S=s;T<S;){if(A!==0)x=re;else return u.bitb=E,u.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,u.write=R,u.inflate_flush(_,x);A--,E|=(_.read_byte(v++)&255)<<T,T+=8}if(I=(o+(E&dt[S]))*3,E>>>=n[I+1],T-=n[I+1],D=n[I],D===0){r=n[I+2],t=ea;break}if(D&16){l=D&15,i=n[I+2],t=Kr;break}if(!(D&64)){s=D,o=I/3+n[I+2];break}if(D&32){t=jo;break}return t=Kn,_.msg="invalid literal/length code",x=ge,u.bitb=E,u.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,u.write=R,u.inflate_flush(_,x);case Kr:for(S=l;T<S;){if(A!==0)x=re;else return u.bitb=E,u.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,u.write=R,u.inflate_flush(_,x);A--,E|=(_.read_byte(v++)&255)<<T,T+=8}i+=E&dt[S],E>>=S,T-=S,s=d,n=y,o=w,t=$r;case $r:for(S=s;T<S;){if(A!==0)x=re;else return u.bitb=E,u.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,u.write=R,u.inflate_flush(_,x);A--,E|=(_.read_byte(v++)&255)<<T,T+=8}if(I=(o+(E&dt[S]))*3,E>>=n[I+1],T-=n[I+1],D=n[I],D&16){l=D&15,a=n[I+2],t=Jr;break}if(!(D&64)){s=D,o=I/3+n[I+2];break}return t=Kn,_.msg="invalid distance code",x=ge,u.bitb=E,u.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,u.write=R,u.inflate_flush(_,x);case Jr:for(S=l;T<S;){if(A!==0)x=re;else return u.bitb=E,u.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,u.write=R,u.inflate_flush(_,x);A--,E|=(_.read_byte(v++)&255)<<T,T+=8}a+=E&dt[S],E>>=S,T-=S,t=Qr;case Qr:for(U=R-a;U<0;)U+=u.end;for(;i!==0;){if(O===0&&(R==u.end&&u.read!==0&&(R=0,O=R<u.read?u.read-R-1:u.end-R),O===0&&(u.write=R,x=u.inflate_flush(_,x),R=u.write,O=R<u.read?u.read-R-1:u.end-R,R==u.end&&u.read!==0&&(R=0,O=R<u.read?u.read-R-1:u.end-R),O===0)))return u.bitb=E,u.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,u.write=R,u.inflate_flush(_,x);u.win[R++]=u.win[U++],O--,U==u.end&&(U=0),i--}t=Zn;break;case ea:if(O===0&&(R==u.end&&u.read!==0&&(R=0,O=R<u.read?u.read-R-1:u.end-R),O===0&&(u.write=R,x=u.inflate_flush(_,x),R=u.write,O=R<u.read?u.read-R-1:u.end-R,R==u.end&&u.read!==0&&(R=0,O=R<u.read?u.read-R-1:u.end-R),O===0)))return u.bitb=E,u.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,u.write=R,u.inflate_flush(_,x);x=re,u.win[R++]=r,O--,t=Zn;break;case jo:if(T>7&&(T-=8,A++,v--),u.write=R,x=u.inflate_flush(_,x),R=u.write,O=R<u.read?u.read-R-1:u.end-R,u.read!=u.write)return u.bitb=E,u.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,u.write=R,u.inflate_flush(_,x);t=ta;case ta:return x=jt,u.bitb=E,u.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,u.write=R,u.inflate_flush(_,x);case Kn:return x=ge,u.bitb=E,u.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,u.write=R,u.inflate_flush(_,x);default:return x=Ke,u.bitb=E,u.bitk=T,_.avail_in=A,_.total_in+=v-_.next_in_index,_.next_in_index=v,u.write=R,u.inflate_flush(_,x)}},e.free=function(){}}const ia=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Vi=0,Xo=1,na=2,oa=3,sa=4,ra=5,$n=6,Jn=7,aa=8,Ci=9;function xu(e,t){const i=this;let n=Vi,o=0,s=0,r=0,l;const a=[0],c=[0],d=new wu;let m=0,g=new Int32Array(wl*3);const y=0,w=new ys;i.bitk=0,i.bitb=0,i.win=new Uint8Array(t),i.end=t,i.read=0,i.write=0,i.reset=function(p,u){u&&(u[0]=y),n==$n&&d.free(p),n=Vi,i.bitk=0,i.bitb=0,i.read=i.write=0},i.reset(e,null),i.inflate_flush=function(p,u){let _,x,S;return x=p.next_out_index,S=i.read,_=(S<=i.write?i.write:i.end)-S,_>p.avail_out&&(_=p.avail_out),_!==0&&u==Xt&&(u=re),p.avail_out-=_,p.total_out+=_,p.next_out.set(i.win.subarray(S,S+_),x),x+=_,S+=_,S==i.end&&(S=0,i.write==i.end&&(i.write=0),_=i.write-S,_>p.avail_out&&(_=p.avail_out),_!==0&&u==Xt&&(u=re),p.avail_out-=_,p.total_out+=_,p.next_out.set(i.win.subarray(S,S+_),x),x+=_,S+=_),p.next_out_index=x,i.read=S,u},i.proc=function(p,u){let _,x,S,I,D,E,T,v;for(I=p.next_in_index,D=p.avail_in,x=i.bitb,S=i.bitk,E=i.write,T=E<i.read?i.read-E-1:i.end-E;;){let A,R,O,U,F,W,q,k;switch(n){case Vi:for(;S<3;){if(D!==0)u=re;else return i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,u);D--,x|=(p.read_byte(I++)&255)<<S,S+=8}switch(_=x&7,m=_&1,_>>>1){case 0:x>>>=3,S-=3,_=S&7,x>>>=_,S-=_,n=Xo;break;case 1:A=[],R=[],O=[[]],U=[[]],ys.inflate_trees_fixed(A,R,O,U),d.init(A[0],R[0],O[0],0,U[0],0),x>>>=3,S-=3,n=$n;break;case 2:x>>>=3,S-=3,n=oa;break;case 3:return x>>>=3,S-=3,n=Ci,p.msg="invalid block type",u=ge,i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,u)}break;case Xo:for(;S<32;){if(D!==0)u=re;else return i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,u);D--,x|=(p.read_byte(I++)&255)<<S,S+=8}if((~x>>>16&65535)!=(x&65535))return n=Ci,p.msg="invalid stored block lengths",u=ge,i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,u);o=x&65535,x=S=0,n=o!==0?na:m!==0?Jn:Vi;break;case na:if(D===0||T===0&&(E==i.end&&i.read!==0&&(E=0,T=E<i.read?i.read-E-1:i.end-E),T===0&&(i.write=E,u=i.inflate_flush(p,u),E=i.write,T=E<i.read?i.read-E-1:i.end-E,E==i.end&&i.read!==0&&(E=0,T=E<i.read?i.read-E-1:i.end-E),T===0)))return i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,u);if(u=re,_=o,_>D&&(_=D),_>T&&(_=T),i.win.set(p.read_buf(I,_),E),I+=_,D-=_,E+=_,T-=_,(o-=_)!==0)break;n=m!==0?Jn:Vi;break;case oa:for(;S<14;){if(D!==0)u=re;else return i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,u);D--,x|=(p.read_byte(I++)&255)<<S,S+=8}if(s=_=x&16383,(_&31)>29||(_>>5&31)>29)return n=Ci,p.msg="too many length or distance symbols",u=ge,i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,u);if(_=258+(_&31)+(_>>5&31),!l||l.length<_)l=[];else for(v=0;v<_;v++)l[v]=0;x>>>=14,S-=14,r=0,n=sa;case sa:for(;r<4+(s>>>10);){for(;S<3;){if(D!==0)u=re;else return i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,u);D--,x|=(p.read_byte(I++)&255)<<S,S+=8}l[ia[r++]]=x&7,x>>>=3,S-=3}for(;r<19;)l[ia[r++]]=0;if(a[0]=7,_=w.inflate_trees_bits(l,a,c,g,p),_!=re)return u=_,u==ge&&(l=null,n=Ci),i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,u);r=0,n=ra;case ra:for(;_=s,!(r>=258+(_&31)+(_>>5&31));){let V,j;for(_=a[0];S<_;){if(D!==0)u=re;else return i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,u);D--,x|=(p.read_byte(I++)&255)<<S,S+=8}if(_=g[(c[0]+(x&dt[_]))*3+1],j=g[(c[0]+(x&dt[_]))*3+2],j<16)x>>>=_,S-=_,l[r++]=j;else{for(v=j==18?7:j-14,V=j==18?11:3;S<_+v;){if(D!==0)u=re;else return i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,u);D--,x|=(p.read_byte(I++)&255)<<S,S+=8}if(x>>>=_,S-=_,V+=x&dt[v],x>>>=v,S-=v,v=r,_=s,v+V>258+(_&31)+(_>>5&31)||j==16&&v<1)return l=null,n=Ci,p.msg="invalid bit length repeat",u=ge,i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,u);j=j==16?l[v-1]:0;do l[v++]=j;while(--V!==0);r=v}}if(c[0]=-1,F=[],W=[],q=[],k=[],F[0]=9,W[0]=6,_=s,_=w.inflate_trees_dynamic(257+(_&31),1+(_>>5&31),l,F,W,q,k,g,p),_!=re)return _==ge&&(l=null,n=Ci),u=_,i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,u);d.init(F[0],W[0],g,q[0],g,k[0]),n=$n;case $n:if(i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,(u=d.proc(i,p,u))!=jt)return i.inflate_flush(p,u);if(u=re,d.free(p),I=p.next_in_index,D=p.avail_in,x=i.bitb,S=i.bitk,E=i.write,T=E<i.read?i.read-E-1:i.end-E,m===0){n=Vi;break}n=Jn;case Jn:if(i.write=E,u=i.inflate_flush(p,u),E=i.write,T=E<i.read?i.read-E-1:i.end-E,i.read!=i.write)return i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,u);n=aa;case aa:return u=jt,i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,u);case Ci:return u=ge,i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,u);default:return u=Ke,i.bitb=x,i.bitk=S,p.avail_in=D,p.total_in+=I-p.next_in_index,p.next_in_index=I,i.write=E,i.inflate_flush(p,u)}}},i.free=function(p){i.reset(p,null),i.win=null,g=null},i.set_dictionary=function(p,u,_){i.win.set(p.subarray(u,u+_),0),i.read=i.write=_},i.sync_point=function(){return n==Xo?1:0}}const Cu=32,Su=8,Eu=0,la=1,ca=2,da=3,ha=4,ua=5,Zo=6,ln=7,fa=12,ti=13,bu=[0,0,255,255];function Du(){const e=this;e.mode=0,e.method=0,e.was=[0],e.need=0,e.marker=0,e.wbits=0;function t(i){return!i||!i.istate?Ke:(i.total_in=i.total_out=0,i.msg=null,i.istate.mode=ln,i.istate.blocks.reset(i,null),re)}e.inflateEnd=function(i){return e.blocks&&e.blocks.free(i),e.blocks=null,re},e.inflateInit=function(i,n){return i.msg=null,e.blocks=null,n<8||n>15?(e.inflateEnd(i),Ke):(e.wbits=n,i.istate.blocks=new xu(i,1<<n),t(i),re)},e.inflate=function(i,n){let o,s;if(!i||!i.istate||!i.next_in)return Ke;const r=i.istate;for(n=n==du?Xt:re,o=Xt;;)switch(r.mode){case Eu:if(i.avail_in===0)return o;if(o=n,i.avail_in--,i.total_in++,((r.method=i.read_byte(i.next_in_index++))&15)!=Su){r.mode=ti,i.msg="unknown compression method",r.marker=5;break}if((r.method>>4)+8>r.wbits){r.mode=ti,i.msg="invalid win size",r.marker=5;break}r.mode=la;case la:if(i.avail_in===0)return o;if(o=n,i.avail_in--,i.total_in++,s=i.read_byte(i.next_in_index++)&255,((r.method<<8)+s)%31!==0){r.mode=ti,i.msg="incorrect header check",r.marker=5;break}if(!(s&Cu)){r.mode=ln;break}r.mode=ca;case ca:if(i.avail_in===0)return o;o=n,i.avail_in--,i.total_in++,r.need=(i.read_byte(i.next_in_index++)&255)<<24&4278190080,r.mode=da;case da:if(i.avail_in===0)return o;o=n,i.avail_in--,i.total_in++,r.need+=(i.read_byte(i.next_in_index++)&255)<<16&16711680,r.mode=ha;case ha:if(i.avail_in===0)return o;o=n,i.avail_in--,i.total_in++,r.need+=(i.read_byte(i.next_in_index++)&255)<<8&65280,r.mode=ua;case ua:return i.avail_in===0?o:(o=n,i.avail_in--,i.total_in++,r.need+=i.read_byte(i.next_in_index++)&255,r.mode=Zo,lu);case Zo:return r.mode=ti,i.msg="need dictionary",r.marker=0,Ke;case ln:if(o=r.blocks.proc(i,o),o==ge){r.mode=ti,r.marker=0;break}if(o==re&&(o=n),o!=jt)return o;o=n,r.blocks.reset(i,r.was),r.mode=fa;case fa:return i.avail_in=0,jt;case ti:return ge;default:return Ke}},e.inflateSetDictionary=function(i,n,o){let s=0,r=o;if(!i||!i.istate||i.istate.mode!=Zo)return Ke;const l=i.istate;return r>=1<<l.wbits&&(r=(1<<l.wbits)-1,s=o-r),l.blocks.set_dictionary(n,s,r),l.mode=ln,re},e.inflateSync=function(i){let n,o,s,r,l;if(!i||!i.istate)return Ke;const a=i.istate;if(a.mode!=ti&&(a.mode=ti,a.marker=0),(n=i.avail_in)===0)return Xt;for(o=i.next_in_index,s=a.marker;n!==0&&s<4;)i.read_byte(o)==bu[s]?s++:i.read_byte(o)!==0?s=0:s=4-s,o++,n--;return i.total_in+=o-i.next_in_index,i.next_in_index=o,i.avail_in=n,a.marker=s,s!=4?ge:(r=i.total_in,l=i.total_out,t(i),i.total_in=r,i.total_out=l,a.mode=ln,re)},e.inflateSyncPoint=function(i){return!i||!i.istate||!i.istate.blocks?Ke:i.istate.blocks.sync_point()}}function xl(){}xl.prototype={inflateInit(e){const t=this;return t.istate=new Du,e||(e=au),t.istate.inflateInit(t,e)},inflate(e){const t=this;return t.istate?t.istate.inflate(t,e):Ke},inflateEnd(){const e=this;if(!e.istate)return Ke;const t=e.istate.inflateEnd(e);return e.istate=null,t},inflateSync(){const e=this;return e.istate?e.istate.inflateSync(e):Ke},inflateSetDictionary(e,t){const i=this;return i.istate?i.istate.inflateSetDictionary(i,e,t):Ke},read_byte(e){return this.next_in[e]},read_buf(e,t){return this.next_in.subarray(e,e+t)}};function Tu(e){const t=this,i=new xl,n=e&&e.chunkSize?Math.floor(e.chunkSize*2):128*1024,o=cu,s=new Uint8Array(n);let r=!1;i.inflateInit(),i.next_out=s,t.append=function(l,a){const c=[];let d,m,g=0,y=0,w=0;if(l.length!==0){i.next_in_index=0,i.next_in=l,i.avail_in=l.length;do{if(i.next_out_index=0,i.avail_out=n,i.avail_in===0&&!r&&(i.next_in_index=0,r=!0),d=i.inflate(o),r&&d===Xt){if(i.avail_in!==0)throw new Error("inflating: bad input")}else if(d!==re&&d!==jt)throw new Error("inflating: "+i.msg);if((r||d===jt)&&i.avail_in===l.length)throw new Error("inflating: bad input");i.next_out_index&&(i.next_out_index===n?c.push(new Uint8Array(s)):c.push(s.subarray(0,i.next_out_index))),w+=i.next_out_index,a&&i.next_in_index>0&&i.next_in_index!=g&&(a(i.next_in_index),g=i.next_in_index)}while(i.avail_in>0||i.avail_out===0);return c.length>1?(m=new Uint8Array(w),c.forEach(function(p){m.set(p,y),y+=p.length})):m=c[0]?new Uint8Array(c[0]):new Uint8Array,m}},t.flush=function(){i.inflateEnd()}}const Qe=4294967295,$e=65535,Iu=8,vu=0,Au=99,Ou=67324752,Cl=134695760,Pu=Cl,Ru=33639248,Nu=101010256,Lu=101075792,Mu=117853008,ws=22,Sl=20,El=56,ku=ws+Sl+El,Fu=1,zu=39169,Bu=10,Uu=1,bl=21589,Rp=28789,Np=25461,Vu=6534,Hu=1,Lp=6,Wu=8,qu=2048,Gu=16,Yu=20,pa=45,_a=51,Ko="/",ma=new Date(2107,11,31),ga=new Date(1980,0,1),ye=void 0,fi="undefined",Mn="function";class ya{constructor(t){return class extends TransformStream{constructor(i,n){const o=new t(n);super({transform(s,r){r.enqueue(o.append(s))},flush(s){const r=o.flush();r&&s.enqueue(r)}})}}}}const ju=64;let Dl=2;try{typeof navigator!=fi&&navigator.hardwareConcurrency&&(Dl=navigator.hardwareConcurrency)}catch{}const Xu={chunkSize:512*1024,maxWorkers:Dl,terminateWorkerTimeout:5e3,useWebWorkers:!0,useCompressionStream:!0,workerScripts:ye,CompressionStreamNative:typeof CompressionStream!=fi&&CompressionStream,DecompressionStreamNative:typeof DecompressionStream!=fi&&DecompressionStream},oi=Object.assign({},Xu);function Zu(){return oi}function Ku(e){return Math.max(e.chunkSize,ju)}function Tl(e){const{baseURL:t,chunkSize:i,maxWorkers:n,terminateWorkerTimeout:o,useCompressionStream:s,useWebWorkers:r,Deflate:l,Inflate:a,CompressionStream:c,DecompressionStream:d,workerScripts:m}=e;if(ii("baseURL",t),ii("chunkSize",i),ii("maxWorkers",n),ii("terminateWorkerTimeout",o),ii("useCompressionStream",s),ii("useWebWorkers",r),l&&(oi.CompressionStream=new ya(l)),a&&(oi.DecompressionStream=new ya(a)),ii("CompressionStream",c),ii("DecompressionStream",d),m!==ye){const{deflate:g,inflate:y}=m;if((g||y)&&(oi.workerScripts||(oi.workerScripts={})),g){if(!Array.isArray(g))throw new Error("workerScripts.deflate must be an array");oi.workerScripts.deflate=g}if(y){if(!Array.isArray(y))throw new Error("workerScripts.inflate must be an array");oi.workerScripts.inflate=y}}}function ii(e,t){t!==ye&&(oi[e]=t)}const Il=[];for(let e=0;e<256;e++){let t=e;for(let i=0;i<8;i++)t&1?t=t>>>1^3988292384:t=t>>>1;Il[e]=t}class xs{constructor(t){this.crc=t||-1}append(t){let i=this.crc|0;for(let n=0,o=t.length|0;n<o;n++)i=i>>>8^Il[(i^t[n])&255];this.crc=i}get(){return~this.crc}}class vl extends TransformStream{constructor(){let t;const i=new xs;super({transform(n,o){i.append(n),o.enqueue(n)},flush(){const n=new Uint8Array(4);new DataView(n.buffer).setUint32(0,i.get()),t.value=n}}),t=this}}function io(e){if(typeof TextEncoder==fi){e=unescape(encodeURIComponent(e));const t=new Uint8Array(e.length);for(let i=0;i<t.length;i++)t[i]=e.charCodeAt(i);return t}else return new TextEncoder().encode(e)}const We={concat(e,t){if(e.length===0||t.length===0)return e.concat(t);const i=e[e.length-1],n=We.getPartial(i);return n===32?e.concat(t):We._shiftRight(t,n,i|0,e.slice(0,e.length-1))},bitLength(e){const t=e.length;if(t===0)return 0;const i=e[t-1];return(t-1)*32+We.getPartial(i)},clamp(e,t){if(e.length*32<t)return e;e=e.slice(0,Math.ceil(t/32));const i=e.length;return t=t&31,i>0&&t&&(e[i-1]=We.partial(t,e[i-1]&2147483648>>t-1,1)),e},partial(e,t,i){return e===32?t:(i?t|0:t<<32-e)+e*1099511627776},getPartial(e){return Math.round(e/1099511627776)||32},_shiftRight(e,t,i,n){for(n===void 0&&(n=[]);t>=32;t-=32)n.push(i),i=0;if(t===0)return n.concat(e);for(let r=0;r<e.length;r++)n.push(i|e[r]>>>t),i=e[r]<<32-t;const o=e.length?e[e.length-1]:0,s=We.getPartial(o);return n.push(We.partial(t+s&31,t+s>32?i:n.pop(),1)),n}},lo={bytes:{fromBits(e){const i=We.bitLength(e)/8,n=new Uint8Array(i);let o;for(let s=0;s<i;s++)s&3||(o=e[s/4]),n[s]=o>>>24,o<<=8;return n},toBits(e){const t=[];let i,n=0;for(i=0;i<e.length;i++)n=n<<8|e[i],(i&3)===3&&(t.push(n),n=0);return i&3&&t.push(We.partial(8*(i&3),n)),t}}},Al={};Al.sha1=class{constructor(e){const t=this;t.blockSize=512,t._init=[1732584193,4023233417,2562383102,271733878,3285377520],t._key=[1518500249,1859775393,2400959708,3395469782],e?(t._h=e._h.slice(0),t._buffer=e._buffer.slice(0),t._length=e._length):t.reset()}reset(){const e=this;return e._h=e._init.slice(0),e._buffer=[],e._length=0,e}update(e){const t=this;typeof e=="string"&&(e=lo.utf8String.toBits(e));const i=t._buffer=We.concat(t._buffer,e),n=t._length,o=t._length=n+We.bitLength(e);if(o>9007199254740991)throw new Error("Cannot hash more than 2^53 - 1 bits");const s=new Uint32Array(i);let r=0;for(let l=t.blockSize+n-(t.blockSize+n&t.blockSize-1);l<=o;l+=t.blockSize)t._block(s.subarray(16*r,16*(r+1))),r+=1;return i.splice(0,16*r),t}finalize(){const e=this;let t=e._buffer;const i=e._h;t=We.concat(t,[We.partial(1,1)]);for(let n=t.length+2;n&15;n++)t.push(0);for(t.push(Math.floor(e._length/4294967296)),t.push(e._length|0);t.length;)e._block(t.splice(0,16));return e.reset(),i}_f(e,t,i,n){if(e<=19)return t&i|~t&n;if(e<=39)return t^i^n;if(e<=59)return t&i|t&n|i&n;if(e<=79)return t^i^n}_S(e,t){return t<<e|t>>>32-e}_block(e){const t=this,i=t._h,n=Array(80);for(let c=0;c<16;c++)n[c]=e[c];let o=i[0],s=i[1],r=i[2],l=i[3],a=i[4];for(let c=0;c<=79;c++){c>=16&&(n[c]=t._S(1,n[c-3]^n[c-8]^n[c-14]^n[c-16]));const d=t._S(5,o)+t._f(c,s,r,l)+a+n[c]+t._key[Math.floor(c/20)]|0;a=l,l=r,r=t._S(30,s),s=o,o=d}i[0]=i[0]+o|0,i[1]=i[1]+s|0,i[2]=i[2]+r|0,i[3]=i[3]+l|0,i[4]=i[4]+a|0}};const Ol={};Ol.aes=class{constructor(e){const t=this;t._tables=[[[],[],[],[],[]],[[],[],[],[],[]]],t._tables[0][0][0]||t._precompute();const i=t._tables[0][4],n=t._tables[1],o=e.length;let s,r,l,a=1;if(o!==4&&o!==6&&o!==8)throw new Error("invalid aes key size");for(t._key=[r=e.slice(0),l=[]],s=o;s<4*o+28;s++){let c=r[s-1];(s%o===0||o===8&&s%o===4)&&(c=i[c>>>24]<<24^i[c>>16&255]<<16^i[c>>8&255]<<8^i[c&255],s%o===0&&(c=c<<8^c>>>24^a<<24,a=a<<1^(a>>7)*283)),r[s]=r[s-o]^c}for(let c=0;s;c++,s--){const d=r[c&3?s:s-4];s<=4||c<4?l[c]=d:l[c]=n[0][i[d>>>24]]^n[1][i[d>>16&255]]^n[2][i[d>>8&255]]^n[3][i[d&255]]}}encrypt(e){return this._crypt(e,0)}decrypt(e){return this._crypt(e,1)}_precompute(){const e=this._tables[0],t=this._tables[1],i=e[4],n=t[4],o=[],s=[];let r,l,a,c;for(let d=0;d<256;d++)s[(o[d]=d<<1^(d>>7)*283)^d]=d;for(let d=r=0;!i[d];d^=l||1,r=s[r]||1){let m=r^r<<1^r<<2^r<<3^r<<4;m=m>>8^m&255^99,i[d]=m,n[m]=d,c=o[a=o[l=o[d]]];let g=c*16843009^a*65537^l*257^d*16843008,y=o[m]*257^m*16843008;for(let w=0;w<4;w++)e[w][d]=y=y<<24^y>>>8,t[w][m]=g=g<<24^g>>>8}for(let d=0;d<5;d++)e[d]=e[d].slice(0),t[d]=t[d].slice(0)}_crypt(e,t){if(e.length!==4)throw new Error("invalid aes block size");const i=this._key[t],n=i.length/4-2,o=[0,0,0,0],s=this._tables[t],r=s[0],l=s[1],a=s[2],c=s[3],d=s[4];let m=e[0]^i[0],g=e[t?3:1]^i[1],y=e[2]^i[2],w=e[t?1:3]^i[3],p=4,u,_,x;for(let S=0;S<n;S++)u=r[m>>>24]^l[g>>16&255]^a[y>>8&255]^c[w&255]^i[p],_=r[g>>>24]^l[y>>16&255]^a[w>>8&255]^c[m&255]^i[p+1],x=r[y>>>24]^l[w>>16&255]^a[m>>8&255]^c[g&255]^i[p+2],w=r[w>>>24]^l[m>>16&255]^a[g>>8&255]^c[y&255]^i[p+3],p+=4,m=u,g=_,y=x;for(let S=0;S<4;S++)o[t?3&-S:S]=d[m>>>24]<<24^d[g>>16&255]<<16^d[y>>8&255]<<8^d[w&255]^i[p++],u=m,m=g,g=y,y=w,w=u;return o}};const $u={getRandomValues(e){const t=new Uint32Array(e.buffer),i=n=>{let o=987654321;const s=4294967295;return function(){return o=36969*(o&65535)+(o>>16)&s,n=18e3*(n&65535)+(n>>16)&s,(((o<<16)+n&s)/4294967296+.5)*(Math.random()>.5?1:-1)}};for(let n=0,o;n<e.length;n+=4){const s=i((o||Math.random())*4294967296);o=s()*987654071,t[n/4]=s()*4294967296|0}return e}},Pl={};Pl.ctrGladman=class{constructor(e,t){this._prf=e,this._initIv=t,this._iv=t}reset(){this._iv=this._initIv}update(e){return this.calculate(this._prf,e,this._iv)}incWord(e){if((e>>24&255)===255){let t=e>>16&255,i=e>>8&255,n=e&255;t===255?(t=0,i===255?(i=0,n===255?n=0:++n):++i):++t,e=0,e+=t<<16,e+=i<<8,e+=n}else e+=1<<24;return e}incCounter(e){(e[0]=this.incWord(e[0]))===0&&(e[1]=this.incWord(e[1]))}calculate(e,t,i){let n;if(!(n=t.length))return[];const o=We.bitLength(t);for(let s=0;s<n;s+=4){this.incCounter(i);const r=e.encrypt(i);t[s]^=r[0],t[s+1]^=r[1],t[s+2]^=r[2],t[s+3]^=r[3]}return We.clamp(t,o)}};const Oi={importKey(e){return new Oi.hmacSha1(lo.bytes.toBits(e))},pbkdf2(e,t,i,n){if(i=i||1e4,n<0||i<0)throw new Error("invalid params to pbkdf2");const o=(n>>5)+1<<2;let s,r,l,a,c;const d=new ArrayBuffer(o),m=new DataView(d);let g=0;const y=We;for(t=lo.bytes.toBits(t),c=1;g<(o||1);c++){for(s=r=e.encrypt(y.concat(t,[c])),l=1;l<i;l++)for(r=e.encrypt(r),a=0;a<r.length;a++)s[a]^=r[a];for(l=0;g<(o||1)&&l<s.length;l++)m.setInt32(g,s[l]),g+=4}return d.slice(0,n/8)}};Oi.hmacSha1=class{constructor(e){const t=this,i=t._hash=Al.sha1,n=[[],[]];t._baseHash=[new i,new i];const o=t._baseHash[0].blockSize/32;e.length>o&&(e=new i().update(e).finalize());for(let s=0;s<o;s++)n[0][s]=e[s]^909522486,n[1][s]=e[s]^1549556828;t._baseHash[0].update(n[0]),t._baseHash[1].update(n[1]),t._resultHash=new i(t._baseHash[0])}reset(){const e=this;e._resultHash=new e._hash(e._baseHash[0]),e._updated=!1}update(e){const t=this;t._updated=!0,t._resultHash.update(e)}digest(){const e=this,t=e._resultHash.finalize(),i=new e._hash(e._baseHash[1]).update(t).finalize();return e.reset(),i}encrypt(e){if(this._updated)throw new Error("encrypt on already updated hmac called!");return this.update(e),this.digest(e)}};const Ju=typeof crypto!=fi&&typeof crypto.getRandomValues==Mn,Rl="Invalid password",Nl="Invalid signature",Ll="zipjs-abort-check-password";function Ml(e){return Ju?crypto.getRandomValues(e):$u.getRandomValues(e)}const ji=16,Qu="raw",kl={name:"PBKDF2"},ef={name:"HMAC"},tf="SHA-1",nf=Object.assign({hash:ef},kl),Cs=Object.assign({iterations:1e3,hash:{name:tf}},kl),of=["deriveBits"],An=[8,12,16],cn=[16,24,32],ni=10,sf=[0,0,0,0],yo=typeof crypto!=fi,kn=yo&&crypto.subtle,Fl=yo&&typeof kn!=fi,zt=lo.bytes,rf=Ol.aes,af=Pl.ctrGladman,lf=Oi.hmacSha1;let wa=yo&&Fl&&typeof kn.importKey==Mn,xa=yo&&Fl&&typeof kn.deriveBits==Mn;class cf extends TransformStream{constructor({password:t,rawPassword:i,signed:n,encryptionStrength:o,checkPasswordOnly:s}){super({start(){Object.assign(this,{ready:new Promise(r=>this.resolveReady=r),password:Ul(t,i),signed:n,strength:o-1,pending:new Uint8Array})},async transform(r,l){const a=this,{password:c,strength:d,resolveReady:m,ready:g}=a;c?(await hf(a,d,c,gt(r,0,An[d]+2)),r=gt(r,An[d]+2),s?l.error(new Error(Ll)):m()):await g;const y=new Uint8Array(r.length-ni-(r.length-ni)%ji);l.enqueue(zl(a,r,y,0,ni,!0))},async flush(r){const{signed:l,ctr:a,hmac:c,pending:d,ready:m}=this;if(c&&a){await m;const g=gt(d,0,d.length-ni),y=gt(d,d.length-ni);let w=new Uint8Array;if(g.length){const p=Pn(zt,g);c.update(p);const u=a.update(p);w=On(zt,u)}if(l){const p=gt(On(zt,c.digest()),0,ni);for(let u=0;u<ni;u++)if(p[u]!=y[u])throw new Error(Nl)}r.enqueue(w)}}})}}class df extends TransformStream{constructor({password:t,rawPassword:i,encryptionStrength:n}){let o;super({start(){Object.assign(this,{ready:new Promise(s=>this.resolveReady=s),password:Ul(t,i),strength:n-1,pending:new Uint8Array})},async transform(s,r){const l=this,{password:a,strength:c,resolveReady:d,ready:m}=l;let g=new Uint8Array;a?(g=await uf(l,c,a),d()):await m;const y=new Uint8Array(g.length+s.length-s.length%ji);y.set(g,0),r.enqueue(zl(l,s,y,g.length,0))},async flush(s){const{ctr:r,hmac:l,pending:a,ready:c}=this;if(l&&r){await c;let d=new Uint8Array;if(a.length){const m=r.update(Pn(zt,a));l.update(m),d=On(zt,m)}o.signature=On(zt,l.digest()).slice(0,ni),s.enqueue(Ms(d,o.signature))}}}),o=this}}function zl(e,t,i,n,o,s){const{ctr:r,hmac:l,pending:a}=e,c=t.length-o;a.length&&(t=Ms(a,t),i=_f(i,c-c%ji));let d;for(d=0;d<=c-ji;d+=ji){const m=Pn(zt,gt(t,d,d+ji));s&&l.update(m);const g=r.update(m);s||l.update(g),i.set(On(zt,g),d+n)}return e.pending=gt(t,d),i}async function hf(e,t,i,n){const o=await Bl(e,t,i,gt(n,0,An[t])),s=gt(n,An[t]);if(o[0]!=s[0]||o[1]!=s[1])throw new Error(Rl)}async function uf(e,t,i){const n=Ml(new Uint8Array(An[t])),o=await Bl(e,t,i,n);return Ms(n,o)}async function Bl(e,t,i,n){e.password=null;const o=await ff(Qu,i,nf,!1,of),s=await pf(Object.assign({salt:n},Cs),o,8*(cn[t]*2+2)),r=new Uint8Array(s),l=Pn(zt,gt(r,0,cn[t])),a=Pn(zt,gt(r,cn[t],cn[t]*2)),c=gt(r,cn[t]*2);return Object.assign(e,{keys:{key:l,authentication:a,passwordVerification:c},ctr:new af(new rf(l),Array.from(sf)),hmac:new lf(a)}),c}async function ff(e,t,i,n,o){if(wa)try{return await kn.importKey(e,t,i,n,o)}catch{return wa=!1,Oi.importKey(t)}else return Oi.importKey(t)}async function pf(e,t,i){if(xa)try{return await kn.deriveBits(e,t,i)}catch{return xa=!1,Oi.pbkdf2(t,e.salt,Cs.iterations,i)}else return Oi.pbkdf2(t,e.salt,Cs.iterations,i)}function Ul(e,t){return t===ye?io(e):t}function Ms(e,t){let i=e;return e.length+t.length&&(i=new Uint8Array(e.length+t.length),i.set(e,0),i.set(t,e.length)),i}function _f(e,t){if(t&&t>e.length){const i=e;e=new Uint8Array(t),e.set(i,0)}return e}function gt(e,t,i){return e.subarray(t,i)}function On(e,t){return e.fromBits(t)}function Pn(e,t){return e.toBits(t)}const Zi=12;class mf extends TransformStream{constructor({password:t,passwordVerification:i,checkPasswordOnly:n}){super({start(){Object.assign(this,{password:t,passwordVerification:i}),Vl(this,t)},transform(o,s){const r=this;if(r.password){const l=Ca(r,o.subarray(0,Zi));if(r.password=null,l[Zi-1]!=r.passwordVerification)throw new Error(Rl);o=o.subarray(Zi)}n?s.error(new Error(Ll)):s.enqueue(Ca(r,o))}})}}class gf extends TransformStream{constructor({password:t,passwordVerification:i}){super({start(){Object.assign(this,{password:t,passwordVerification:i}),Vl(this,t)},transform(n,o){const s=this;let r,l;if(s.password){s.password=null;const a=Ml(new Uint8Array(Zi));a[Zi-1]=s.passwordVerification,r=new Uint8Array(n.length+a.length),r.set(Sa(s,a),0),l=Zi}else r=new Uint8Array(n.length),l=0;r.set(Sa(s,n),l),o.enqueue(r)}})}}function Ca(e,t){const i=new Uint8Array(t.length);for(let n=0;n<t.length;n++)i[n]=Hl(e)^t[n],ks(e,i[n]);return i}function Sa(e,t){const i=new Uint8Array(t.length);for(let n=0;n<t.length;n++)i[n]=Hl(e)^t[n],ks(e,t[n]);return i}function Vl(e,t){const i=[305419896,591751049,878082192];Object.assign(e,{keys:i,crcKey0:new xs(i[0]),crcKey2:new xs(i[2])});for(let n=0;n<t.length;n++)ks(e,t.charCodeAt(n))}function ks(e,t){let[i,n,o]=e.keys;e.crcKey0.append([t]),i=~e.crcKey0.get(),n=Ea(Math.imul(Ea(n+Wl(i)),134775813)+1),e.crcKey2.append([n>>>24]),o=~e.crcKey2.get(),e.keys=[i,n,o]}function Hl(e){const t=e.keys[2]|2;return Wl(Math.imul(t,t^1)>>>8)}function Wl(e){return e&255}function Ea(e){return e&4294967295}const ba="deflate-raw";class yf extends TransformStream{constructor(t,{chunkSize:i,CompressionStream:n,CompressionStreamNative:o}){super({});const{compressed:s,encrypted:r,useCompressionStream:l,zipCrypto:a,signed:c,level:d}=t,m=this;let g,y,w=ql(super.readable);(!r||a)&&c&&(g=new vl,w=Bt(w,g)),s&&(w=Yl(w,l,{level:d,chunkSize:i},o,n)),r&&(a?w=Bt(w,new gf(t)):(y=new df(t),w=Bt(w,y))),Gl(m,w,()=>{let p;r&&!a&&(p=y.signature),(!r||a)&&c&&(p=new DataView(g.value.buffer).getUint32(0)),m.signature=p})}}class wf extends TransformStream{constructor(t,{chunkSize:i,DecompressionStream:n,DecompressionStreamNative:o}){super({});const{zipCrypto:s,encrypted:r,signed:l,signature:a,compressed:c,useCompressionStream:d}=t;let m,g,y=ql(super.readable);r&&(s?y=Bt(y,new mf(t)):(g=new cf(t),y=Bt(y,g))),c&&(y=Yl(y,d,{chunkSize:i},o,n)),(!r||s)&&l&&(m=new vl,y=Bt(y,m)),Gl(this,y,()=>{if((!r||s)&&l){const w=new DataView(m.value.buffer);if(a!=w.getUint32(0,!1))throw new Error(Nl)}})}}function ql(e){return Bt(e,new TransformStream({transform(t,i){t&&t.length&&i.enqueue(t)}}))}function Gl(e,t,i){t=Bt(t,new TransformStream({flush:i})),Object.defineProperty(e,"readable",{get(){return t}})}function Yl(e,t,i,n,o){try{const s=t&&n?n:o;e=Bt(e,new s(ba,i))}catch{if(t)try{e=Bt(e,new o(ba,i))}catch{return e}else return e}return e}function Bt(e,t){return e.pipeThrough(t)}const xf="message",Cf="start",Sf="pull",Da="data",Ef="ack",Ta="close",jl="deflate",bf="inflate";class Df extends TransformStream{constructor(t,i){super({});const n=this,{codecType:o}=t;let s;o.startsWith(jl)?s=yf:o.startsWith(bf)&&(s=wf);let r=0,l=0;const a=new s(t,i),c=super.readable,d=new TransformStream({transform(g,y){g&&g.length&&(l+=g.length,y.enqueue(g))},flush(){Object.assign(n,{inputSize:l})}}),m=new TransformStream({transform(g,y){g&&g.length&&(r+=g.length,y.enqueue(g))},flush(){const{signature:g}=a;Object.assign(n,{signature:g,outputSize:r,inputSize:l})}});Object.defineProperty(n,"readable",{get(){return c.pipeThrough(d).pipeThrough(a).pipeThrough(m)}})}}class Tf extends TransformStream{constructor(t){let i;super({transform:n,flush(o){i&&i.length&&o.enqueue(i)}});function n(o,s){if(i){const r=new Uint8Array(i.length+o.length);r.set(i),r.set(o,i.length),o=r,i=null}o.length>t?(s.enqueue(o.slice(0,t)),n(o.slice(t),s)):i=o}}}let Xl=typeof Worker!=fi;class $o{constructor(t,{readable:i,writable:n},{options:o,config:s,streamOptions:r,useWebWorkers:l,transferStreams:a,scripts:c},d){const{signal:m}=r;return Object.assign(t,{busy:!0,readable:i.pipeThrough(new Tf(s.chunkSize)).pipeThrough(new If(i,r),{signal:m}),writable:n,options:Object.assign({},o),scripts:c,transferStreams:a,terminate(){return new Promise(g=>{const{worker:y,busy:w}=t;y?(w?t.resolveTerminated=g:(y.terminate(),g()),t.interface=null):g()})},onTaskFinished(){const{resolveTerminated:g}=t;g&&(t.resolveTerminated=null,t.terminated=!0,t.worker.terminate(),g()),t.busy=!1,d(t)}}),(l&&Xl?vf:Zl)(t,s)}}class If extends TransformStream{constructor(t,{onstart:i,onprogress:n,size:o,onend:s}){let r=0;super({async start(){i&&await Jo(i,o)},async transform(l,a){r+=l.length,n&&await Jo(n,r,o),a.enqueue(l)},async flush(){t.size=r,s&&await Jo(s,r)}})}}async function Jo(e,...t){try{await e(...t)}catch{}}function Zl(e,t){return{run:()=>Af(e,t)}}function vf(e,t){const{baseURL:i,chunkSize:n}=t;if(!e.interface){let o;try{o=Rf(e.scripts[0],i,e)}catch{return Xl=!1,Zl(e,t)}Object.assign(e,{worker:o,interface:{run:()=>Of(e,{chunkSize:n})}})}return e.interface}async function Af({options:e,readable:t,writable:i,onTaskFinished:n},o){try{const s=new Df(e,o);await t.pipeThrough(s).pipeTo(i,{preventClose:!0,preventAbort:!0});const{signature:r,inputSize:l,outputSize:a}=s;return{signature:r,inputSize:l,outputSize:a}}finally{n()}}async function Of(e,t){let i,n;const o=new Promise((g,y)=>{i=g,n=y});Object.assign(e,{reader:null,writer:null,resolveResult:i,rejectResult:n,result:o});const{readable:s,options:r,scripts:l}=e,{writable:a,closed:c}=Pf(e.writable),d=no({type:Cf,scripts:l.slice(1),options:r,config:t,readable:s,writable:a},e);d||Object.assign(e,{reader:s.getReader(),writer:a.getWriter()});const m=await o;return d||await a.getWriter().close(),await c,m}function Pf(e){let t;const i=new Promise(o=>t=o);return{writable:new WritableStream({async write(o){const s=e.getWriter();await s.ready,await s.write(o),s.releaseLock()},close(){t()},abort(o){return e.getWriter().abort(o)}}),closed:i}}let Ia=!0,va=!0;function Rf(e,t,i){const n={type:"module"};let o,s;typeof e==Mn&&(e=e());try{o=new URL(e,t)}catch{o=e}if(Ia)try{s=new Worker(o)}catch{Ia=!1,s=new Worker(o,n)}else s=new Worker(o,n);return s.addEventListener(xf,r=>Nf(r,i)),s}function no(e,{worker:t,writer:i,onTaskFinished:n,transferStreams:o}){try{let{value:s,readable:r,writable:l}=e;const a=[];if(s&&(s.byteLength<s.buffer.byteLength?e.value=s.buffer.slice(0,s.byteLength):e.value=s.buffer,a.push(e.value)),o&&va?(r&&a.push(r),l&&a.push(l)):e.readable=e.writable=null,a.length)try{return t.postMessage(e,a),!0}catch{va=!1,e.readable=e.writable=null,t.postMessage(e)}else t.postMessage(e)}catch(s){throw i&&i.releaseLock(),n(),s}}async function Nf({data:e},t){const{type:i,value:n,messageId:o,result:s,error:r}=e,{reader:l,writer:a,resolveResult:c,rejectResult:d,onTaskFinished:m}=t;try{if(r){const{message:y,stack:w,code:p,name:u}=r,_=new Error(y);Object.assign(_,{stack:w,code:p,name:u}),g(_)}else{if(i==Sf){const{value:y,done:w}=await l.read();no({type:Da,value:y,done:w,messageId:o},t)}i==Da&&(await a.ready,await a.write(new Uint8Array(n)),no({type:Ef,messageId:o},t)),i==Ta&&g(null,s)}}catch(y){no({type:Ta,messageId:o},t),g(y)}function g(y,w){y?d(y):c(w),a&&a.releaseLock(),m()}}let Ei=[];const Qo=[];let Aa=0;async function Lf(e,t){const{options:i,config:n}=t,{transferStreams:o,useWebWorkers:s,useCompressionStream:r,codecType:l,compressed:a,signed:c,encrypted:d}=i,{workerScripts:m,maxWorkers:g}=n;t.transferStreams=o||o===ye;const y=!a&&!c&&!d&&!t.transferStreams;return t.useWebWorkers=!y&&(s||s===ye&&n.useWebWorkers),t.scripts=t.useWebWorkers&&m?m[l]:[],i.useCompressionStream=r||r===ye&&n.useCompressionStream,(await w()).run();async function w(){const u=Ei.find(_=>!_.busy);if(u)return Oa(u),new $o(u,e,t,p);if(Ei.length<g){const _={indexWorker:Aa};return Aa++,Ei.push(_),new $o(_,e,t,p)}else return new Promise(_=>Qo.push({resolve:_,stream:e,workerOptions:t}))}function p(u){if(Qo.length){const[{resolve:_,stream:x,workerOptions:S}]=Qo.splice(0,1);_(new $o(u,x,S,p))}else u.worker?(Oa(u),Mf(u,t)):Ei=Ei.filter(_=>_!=u)}}function Mf(e,t){const{config:i}=t,{terminateWorkerTimeout:n}=i;Number.isFinite(n)&&n>=0&&(e.terminated?e.terminated=!1:e.terminateTimeout=setTimeout(async()=>{Ei=Ei.filter(o=>o!=e);try{await e.terminate()}catch{}},n))}function Oa(e){const{terminateTimeout:t}=e;t&&(clearTimeout(t),e.terminateTimeout=null)}const kf="Writer iterator completed too soon",Ff="text/plain",zf="Content-Type",Bf=64*1024,Fs="writable";class wo{constructor(){this.size=0}init(){this.initialized=!0}}class Kl extends wo{get readable(){const t=this,{chunkSize:i=Bf}=t,n=new ReadableStream({start(){this.chunkOffset=0},async pull(o){const{offset:s=0,size:r,diskNumberStart:l}=n,{chunkOffset:a}=this;o.enqueue(await Ss(t,s+a,Math.min(i,r-a),l)),a+i>r?o.close():this.chunkOffset+=i}});return n}}class Uf extends wo{constructor(){super();const t=this,i=new WritableStream({write(n){return t.writeUint8Array(n)}});Object.defineProperty(t,Fs,{get(){return i}})}writeUint8Array(){}}class Mp extends Uf{constructor(t){super(),Object.assign(this,{data:"data:"+(t||"")+";base64,",pending:[]})}writeUint8Array(t){const i=this;let n=0,o=i.pending;const s=i.pending.length;for(i.pending="",n=0;n<Math.floor((s+t.length)/3)*3-s;n++)o+=String.fromCharCode(t[n]);for(;n<t.length;n++)i.pending+=String.fromCharCode(t[n]);o.length>2?i.data+=btoa(o):i.pending=o}getData(){return this.data+btoa(this.pending)}}class $l extends Kl{constructor(t){super(),Object.assign(this,{blob:t,size:t.size})}async readUint8Array(t,i){const n=this,o=t+i;let r=await(t||o<n.size?n.blob.slice(t,o):n.blob).arrayBuffer();return r.byteLength>i&&(r=r.slice(t,o)),new Uint8Array(r)}}class Jl extends wo{constructor(t){super();const i=this,n=new TransformStream,o=[];t&&o.push([zf,t]),Object.defineProperty(i,Fs,{get(){return n.writable}}),i.blob=new Response(n.readable,{headers:o}).blob()}getData(){return this.blob}}class Vf extends $l{constructor(t){super(new Blob([t],{type:Ff}))}}class kp extends Jl{constructor(t){super(t),Object.assign(this,{encoding:t,utf8:!t||t.toLowerCase()=="utf-8"})}async getData(){const{encoding:t,utf8:i}=this,n=await super.getData();if(n.text&&i)return n.text();{const o=new FileReader;return new Promise((s,r)=>{Object.assign(o,{onload:({target:l})=>s(l.result),onerror:()=>r(o.error)}),o.readAsText(n,t)})}}}class Hf extends Kl{constructor(t){super(),this.readers=t}async init(){const t=this,{readers:i}=t;t.lastDiskNumber=0,t.lastDiskOffset=0,await Promise.all(i.map(async(n,o)=>{await n.init(),o!=i.length-1&&(t.lastDiskOffset+=n.size),t.size+=n.size})),super.init()}async readUint8Array(t,i,n=0){const o=this,{readers:s}=this;let r,l=n;l==-1&&(l=s.length-1);let a=t;for(;a>=s[l].size;)a-=s[l].size,l++;const c=s[l],d=c.size;if(a+i<=d)r=await Ss(c,a,i);else{const m=d-a;r=new Uint8Array(i),r.set(await Ss(c,a,m)),r.set(await o.readUint8Array(t+m,i-m,n),m)}return o.lastDiskNumber=Math.max(l,o.lastDiskNumber),r}}class Pa extends wo{constructor(t,i=4294967295){super();const n=this;Object.assign(n,{diskNumber:0,diskOffset:0,size:0,maxSize:i,availableSize:i});let o,s,r;const l=new WritableStream({async write(d){const{availableSize:m}=n;if(r)d.length>=m?(await a(d.slice(0,m)),await c(),n.diskOffset+=o.size,n.diskNumber++,r=null,await this.write(d.slice(m))):await a(d);else{const{value:g,done:y}=await t.next();if(y&&!g)throw new Error(kf);o=g,o.size=0,o.maxSize&&(n.maxSize=o.maxSize),n.availableSize=n.maxSize,await Rn(o),s=g.writable,r=s.getWriter(),await this.write(d)}},async close(){await r.ready,await c()}});Object.defineProperty(n,Fs,{get(){return l}});async function a(d){const m=d.length;m&&(await r.ready,await r.write(d),o.size+=m,n.size+=m,n.availableSize-=m)}async function c(){s.size=o.size,await r.close()}}}async function Rn(e,t){if(e.init&&!e.initialized)await e.init(t);else return Promise.resolve()}function Wf(e){return Array.isArray(e)&&(e=new Hf(e)),e instanceof ReadableStream&&(e={readable:e}),e}function qf(e){e.writable===ye&&typeof e.next==Mn&&(e=new Pa(e)),e instanceof WritableStream&&(e={writable:e});const{writable:t}=e;return t.size===ye&&(t.size=0),e instanceof Pa||Object.assign(e,{diskNumber:0,diskOffset:0,availableSize:1/0,maxSize:1/0}),e}function Ss(e,t,i,n){return e.readUint8Array(t,i,n)}const Ql="\0 !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~ ".split(""),Gf=Ql.length==256;function Fp(e){if(Gf){let t="";for(let i=0;i<e.length;i++)t+=Ql[e[i]];return t}else return new TextDecoder().decode(e)}const Yf="filename",jf="rawFilename",Xf="comment",Zf="rawComment",Kf="uncompressedSize",$f="compressedSize",Jf="offset",Ra="diskNumberStart",ec="lastModDate",Qf="rawLastModDate",tc="lastAccessDate",zp="rawLastAccessDate",ic="creationDate",Bp="rawCreationDate",nc="internalFileAttribute",oc="externalFileAttribute",sc="msDosCompatible",zs="zip64",rc="encrypted",ac="version",lc="versionMadeBy",cc="zipCrypto",ep=[Yf,jf,$f,Kf,ec,Qf,Xf,Zf,tc,ic,Jf,Ra,Ra,nc,oc,sc,zs,rc,ac,lc,cc,"directory","bitFlag","signature","filenameUTF8","commentUTF8","compressionMethod","extraField","rawExtraField","extraFieldZip64","extraFieldUnicodePath","extraFieldUnicodeComment","extraFieldAES","extraFieldNTFS","extraFieldExtendedTimestamp"];class dc{constructor(t){ep.forEach(i=>this[i]=t[i])}}const tp="File already exists",ip="Zip file comment exceeds 64KB",np="File entry comment exceeds 64KB",op="File entry name exceeds 64KB",Na="Version exceeds 65535",sp="The strength must equal 1, 2, or 3",rp="Extra field type exceeds 65535",ap="Extra field data exceeds 64KB",Bs="Zip64 is not supported (make sure 'keepOrder' is set to 'true')",lp="Undefined uncompressed size",La=new Uint8Array([7,0,2,0,65,69,3,0,0]);let es=0;const Ma=[];class cp{constructor(t,i={}){t=qf(t);const n=t.availableSize!==ye&&t.availableSize>0&&t.availableSize!==1/0&&t.maxSize!==ye&&t.maxSize>0&&t.maxSize!==1/0;Object.assign(this,{writer:t,addSplitZipSignature:n,options:i,config:Zu(),files:new Map,filenames:new Set,offset:i.offset===ye?t.writable.size:i.offset,pendingEntriesSize:0,pendingAddFileCalls:new Set,bufferedWrites:0})}async add(t="",i,n={}){const o=this,{pendingAddFileCalls:s,config:r}=o;es<r.maxWorkers?es++:await new Promise(a=>Ma.push(a));let l;try{if(t=t.trim(),o.filenames.has(t))throw new Error(tp);return o.filenames.add(t),l=dp(o,t,i,n),s.add(l),await l}catch(a){throw o.filenames.delete(t),a}finally{s.delete(l);const a=Ma.shift();a?a():es--}}async close(t=new Uint8Array,i={}){const n=this,{pendingAddFileCalls:o,writer:s}=this,{writable:r}=s;for(;o.size;)await Promise.allSettled(Array.from(o));return await wp(this,t,i),de(n,i,"preventClose")||await r.getWriter().close(),s.getData?s.getData():r}}async function dp(e,t,i,n){t=t.trim(),n.directory&&!t.endsWith(Ko)?t+=Ko:n.directory=t.endsWith(Ko);const o=de(e,n,"encodeText",io);let s=o(t);if(s===ye&&(s=io(t)),oe(s)>$e)throw new Error(op);const r=n.comment||"";let l=o(r);if(l===ye&&(l=io(r)),oe(l)>$e)throw new Error(np);const a=de(e,n,ac,Yu);if(a>$e)throw new Error(Na);const c=de(e,n,lc,20);if(c>$e)throw new Error(Na);const d=de(e,n,ec,new Date),m=de(e,n,tc),g=de(e,n,ic),y=de(e,n,sc,!0),w=de(e,n,nc,0),p=de(e,n,oc,0),u=de(e,n,"passThrough");let _,x;u||(_=de(e,n,"password"),x=de(e,n,"rawPassword"));const S=de(e,n,"encryptionStrength",3),I=de(e,n,cc),D=de(e,n,"extendedTimestamp",!0),E=de(e,n,"keepOrder",!0),T=de(e,n,"level"),v=de(e,n,"useWebWorkers"),A=de(e,n,"bufferedWrite"),R=de(e,n,"dataDescriptorSignature",!1),O=de(e,n,"signal"),U=de(e,n,"useUnicodeFileNames",!0),F=de(e,n,"useCompressionStream"),W=de(e,n,"compressionMethod");let q=de(e,n,"dataDescriptor",!0),k=de(e,n,zs);if(!I&&(_!==ye||x!==ye)&&!(S>=1&&S<=3))throw new Error(sp);let V=new Uint8Array;const{extraField:j}=n;if(j){let Fe=0,be=0;j.forEach(Se=>Fe+=4+oe(Se)),V=new Uint8Array(Fe),j.forEach((Se,ot)=>{if(ot>$e)throw new Error(rp);if(oe(Se)>$e)throw new Error(ap);Te(V,new Uint16Array([ot]),be),Te(V,new Uint16Array([oe(Se)]),be+2),Te(V,Se,be+4),be+=4+oe(Se)})}let fe=0,G=0,ue=0;if(u&&({uncompressedSize:ue}=n,ue===ye))throw new Error(lp);const $=k===!0;i&&(i=Wf(i),await Rn(i),u?fe=ka(ue):i.size===ye?(q=!0,(k||k===ye)&&(k=!0,ue=fe=Qe+1)):(ue=i.size,fe=ka(ue)));const{diskOffset:ie,diskNumber:ve,maxSize:he}=e.writer,_e=$||ue>Qe,Et=$||fe>Qe,nt=$||e.offset+e.pendingEntriesSize-ie>Qe,Ye=de(e,n,"supportZip64SplitFile",!0)&&$||ve+Math.ceil(e.pendingEntriesSize/he)>$e;if(nt||_e||Et||Ye){if(k===!1||!E)throw new Error(Bs);k=!0}k=k||!1;const Rt=de(e,n,rc),{signature:Re}=n;n=Object.assign({},n,{rawFilename:s,rawComment:l,version:a,versionMadeBy:c,lastModDate:d,lastAccessDate:m,creationDate:g,rawExtraField:V,zip64:k,zip64UncompressedSize:_e,zip64CompressedSize:Et,zip64Offset:nt,zip64DiskNumberStart:Ye,password:_,rawPassword:x,level:!F&&e.config.CompressionStream===ye&&e.config.CompressionStreamNative===ye?0:T,useWebWorkers:v,encryptionStrength:S,extendedTimestamp:D,zipCrypto:I,bufferedWrite:A,keepOrder:E,useUnicodeFileNames:U,dataDescriptor:q,dataDescriptorSignature:R,signal:O,msDosCompatible:y,internalFileAttribute:w,externalFileAttribute:p,useCompressionStream:F,passThrough:u,encrypted:!!(_&&oe(_)||x&&oe(x))||u&&Rt,signature:Re,compressionMethod:W});const Oe=fp(n),Nt=_p(n),ce=oe(Oe.localHeaderArray,Nt.dataDescriptorArray);G=ce+fe,e.options.usdz&&(G+=G+64),e.pendingEntriesSize+=G;let pe;try{pe=await hp(e,t,i,{headerInfo:Oe,dataDescriptorInfo:Nt,metadataSize:ce},n)}finally{e.pendingEntriesSize-=G}return Object.assign(pe,{name:t,comment:r,extraField:j}),new dc(pe)}async function hp(e,t,i,n,o){const{files:s,writer:r}=e,{keepOrder:l,dataDescriptor:a,signal:c}=o,{headerInfo:d}=n,{usdz:m}=e.options,g=Array.from(s.values()).pop();let y={},w,p,u,_,x,S,I;s.set(t,y);try{let v;l&&(v=g&&g.lock,D()),(o.bufferedWrite||e.writerLocked||e.bufferedWrites&&l||!a)&&!m?(S=new TransformStream,I=new Response(S.readable).blob(),S.writable.size=0,w=!0,e.bufferedWrites++,await Rn(r)):(S=r,await E()),await Rn(S);const{writable:A}=r;let{diskOffset:R}=r;if(e.addSplitZipSignature){delete e.addSplitZipSignature;const U=new Uint8Array(4),F=Me(U);ne(F,0,Cl),await kt(A,U),e.offset+=4}m&&pp(n,e.offset-R),w||(await v,await T(A));const{diskNumber:O}=r;if(x=!0,y.diskNumberStart=O,y=await up(i,S,y,n,e.config,o),x=!1,s.set(t,y),y.filename=t,w){await S.writable.getWriter().close();let U=await I;await v,await E(),_=!0,a||(U=await gp(y,U,A,o)),await T(A),y.diskNumberStart=r.diskNumber,R=r.diskOffset,await U.stream().pipeTo(A,{preventClose:!0,preventAbort:!0,signal:c}),A.size+=U.size,_=!1}if(y.offset=e.offset-R,y.zip64)yp(y,o);else if(y.offset>Qe)throw new Error(Bs);return e.offset+=y.size,y}catch(v){if(w&&_||!w&&x){if(e.hasCorruptedEntries=!0,v)try{v.corruptedEntry=!0}catch{}w?e.offset+=S.writable.size:e.offset=S.writable.size}throw s.delete(t),v}finally{w&&e.bufferedWrites--,u&&u(),p&&p()}function D(){y.lock=new Promise(v=>u=v)}async function E(){e.writerLocked=!0;const{lockWriter:v}=e;e.lockWriter=new Promise(A=>p=()=>{e.writerLocked=!1,A()}),await v}async function T(v){oe(d.localHeaderArray)>r.availableSize&&(r.availableSize=0,await kt(v,new Uint8Array))}}async function up(e,t,{diskNumberStart:i,lock:n},o,s,r){const{headerInfo:l,dataDescriptorInfo:a,metadataSize:c}=o,{localHeaderArray:d,headerArray:m,lastModDate:g,rawLastModDate:y,encrypted:w,compressed:p,version:u,compressionMethod:_,rawExtraFieldExtendedTimestamp:x,extraFieldExtendedTimestampFlag:S,rawExtraFieldNTFS:I,rawExtraFieldAES:D}=l,{dataDescriptorArray:E}=a,{rawFilename:T,lastAccessDate:v,creationDate:A,password:R,rawPassword:O,level:U,zip64:F,zip64UncompressedSize:W,zip64CompressedSize:q,zip64Offset:k,zip64DiskNumberStart:V,zipCrypto:j,dataDescriptor:fe,directory:G,versionMadeBy:ue,rawComment:$,rawExtraField:ie,useWebWorkers:ve,onstart:he,onprogress:_e,onend:Et,signal:nt,encryptionStrength:bt,extendedTimestamp:Ye,msDosCompatible:Rt,internalFileAttribute:Re,externalFileAttribute:Oe,useCompressionStream:Nt,passThrough:ce}=r,pe={lock:n,versionMadeBy:ue,zip64:F,directory:!!G,filenameUTF8:!0,rawFilename:T,commentUTF8:!0,rawComment:$,rawExtraFieldExtendedTimestamp:x,rawExtraFieldNTFS:I,rawExtraFieldAES:D,rawExtraField:ie,extendedTimestamp:Ye,msDosCompatible:Rt,internalFileAttribute:Re,externalFileAttribute:Oe,diskNumberStart:i};let{signature:Fe,uncompressedSize:be}=r,Se=0;ce||(be=0);const{writable:ot}=t;if(e){e.chunkSize=Ku(s),await kt(ot,d);const ze=e.readable,Li=ze.size=e.size,Wt={options:{codecType:jl,level:U,rawPassword:O,password:R,encryptionStrength:bt,zipCrypto:w&&j,passwordVerification:w&&j&&y>>8&255,signed:!ce,compressed:p&&!ce,encrypted:w&&!ce,useWebWorkers:ve,useCompressionStream:Nt,transferStreams:!1},config:s,streamOptions:{signal:nt,size:Li,onstart:he,onprogress:_e,onend:Et}},rt=await Lf({readable:ze,writable:ot},Wt);Se=rt.outputSize,ce||(be=rt.inputSize,Fe=rt.signature),ot.size+=be}else await kt(ot,d);let st;if(F){let ze=4;W&&(ze+=8),q&&(ze+=8),k&&(ze+=8),V&&(ze+=4),st=new Uint8Array(ze)}else st=new Uint8Array;return mp({signature:Fe,rawExtraFieldZip64:st,compressedSize:Se,uncompressedSize:be,headerInfo:l,dataDescriptorInfo:a},r),fe&&await kt(ot,E),Object.assign(pe,{uncompressedSize:be,compressedSize:Se,lastModDate:g,rawLastModDate:y,creationDate:A,lastAccessDate:v,encrypted:w,zipCrypto:j,size:c+Se,compressionMethod:_,version:u,headerArray:m,signature:Fe,rawExtraFieldZip64:st,extraFieldExtendedTimestampFlag:S,zip64UncompressedSize:W,zip64CompressedSize:q,zip64Offset:k,zip64DiskNumberStart:V}),pe}function fp(e){const{rawFilename:t,lastModDate:i,lastAccessDate:n,creationDate:o,level:s,zip64:r,zipCrypto:l,useUnicodeFileNames:a,dataDescriptor:c,directory:d,rawExtraField:m,encryptionStrength:g,extendedTimestamp:y,encrypted:w}=e,p=s!==0&&!d;let{version:u,compressionMethod:_}=e,x;if(w&&!l){x=new Uint8Array(oe(La)+2);const k=Me(x);se(k,0,zu),Te(x,La,2),co(k,8,g)}else x=new Uint8Array;let S,I,D;if(y){I=new Uint8Array(9+(n?4:0)+(o?4:0));const k=Me(I);se(k,0,bl),se(k,2,oe(I)-4),D=1+(n?2:0)+(o?4:0),co(k,4,D);let V=5;ne(k,V,Math.floor(i.getTime()/1e3)),V+=4,n&&(ne(k,V,Math.floor(n.getTime()/1e3)),V+=4),o&&ne(k,V,Math.floor(o.getTime()/1e3));try{S=new Uint8Array(36);const j=Me(S),fe=ts(i);se(j,0,Bu),se(j,2,32),se(j,8,Uu),se(j,10,24),Je(j,12,fe),Je(j,20,ts(n)||fe),Je(j,28,ts(o)||fe)}catch{S=new Uint8Array}}else S=I=new Uint8Array;let E=0;a&&(E=E|qu),c&&(E=E|Wu),_===ye&&(_=p?Iu:vu),p&&(s>=1&&s<3&&(E=E|6),s>=3&&s<5&&(E=E|1),s===9&&(E=E|2)),r&&(u=u>pa?u:pa),w&&(E=E|Hu,l||(u=u>_a?u:_a,x[9]=_,_=Au));const T=new Uint8Array(26),v=Me(T);se(v,0,u),se(v,2,E),se(v,4,_);const A=new Uint32Array(1),R=Me(A);let O;i<ga?O=ga:i>ma?O=ma:O=i,se(R,0,(O.getHours()<<6|O.getMinutes())<<5|O.getSeconds()/2),se(R,2,(O.getFullYear()-1980<<4|O.getMonth()+1)<<5|O.getDate());const U=A[0];ne(v,6,U),se(v,22,oe(t));const F=oe(x,I,S,m);se(v,24,F);const W=new Uint8Array(30+oe(t)+F),q=Me(W);return ne(q,0,Ou),Te(W,T,4),Te(W,t,30),Te(W,x,30+oe(t)),Te(W,I,30+oe(t,x)),Te(W,S,30+oe(t,x,I)),Te(W,m,30+oe(t,x,I,S)),{localHeaderArray:W,headerArray:T,headerView:v,lastModDate:i,rawLastModDate:U,encrypted:w,compressed:p,version:u,compressionMethod:_,extraFieldExtendedTimestampFlag:D,rawExtraFieldExtendedTimestamp:I,rawExtraFieldNTFS:S,rawExtraFieldAES:x,extraFieldLength:F}}function pp(e,t){const{headerInfo:i}=e;let{localHeaderArray:n,extraFieldLength:o}=i,s=Me(n),r=64-(t+oe(n))%64;r<4&&(r+=64);const l=new Uint8Array(r),a=Me(l);se(a,0,Vu),se(a,2,r-2);const c=n;i.localHeaderArray=n=new Uint8Array(oe(c)+r),Te(n,c),Te(n,l,oe(c)),s=Me(n),se(s,28,o+r),e.metadataSize+=r}function _p(e){const{zip64:t,dataDescriptor:i,dataDescriptorSignature:n}=e;let o=new Uint8Array,s,r=0;return i&&(o=new Uint8Array(t?n?24:20:n?16:12),s=Me(o),n&&(r=4,ne(s,0,Pu))),{dataDescriptorArray:o,dataDescriptorView:s,dataDescriptorOffset:r}}function mp(e,t){const{signature:i,rawExtraFieldZip64:n,compressedSize:o,uncompressedSize:s,headerInfo:r,dataDescriptorInfo:l}=e,{headerView:a,encrypted:c}=r,{dataDescriptorView:d,dataDescriptorOffset:m}=l,{zip64:g,zip64UncompressedSize:y,zip64CompressedSize:w,zipCrypto:p,dataDescriptor:u}=t;if((!c||p)&&i!==ye&&(ne(a,10,i),u&&ne(d,m,i)),g){const _=Me(n);se(_,0,Fu),se(_,2,oe(n)-4);let x=4;y&&(ne(a,18,Qe),Je(_,x,BigInt(s)),x+=8),w&&(ne(a,14,Qe),Je(_,x,BigInt(o))),u&&(Je(d,m+4,BigInt(o)),Je(d,m+12,BigInt(s)))}else ne(a,14,o),ne(a,18,s),u&&(ne(d,m+4,o),ne(d,m+8,s))}async function gp(e,t,i,{zipCrypto:n}){let o;o=await t.slice(0,26).arrayBuffer(),o.byteLength!=26&&(o=o.slice(0,26));const s=new DataView(o);return(!e.encrypted||n)&&ne(s,14,e.signature),e.zip64?(ne(s,18,Qe),ne(s,22,Qe)):(ne(s,18,e.compressedSize),ne(s,22,e.uncompressedSize)),await kt(i,new Uint8Array(o)),t.slice(o.byteLength)}function yp(e,t){const{rawExtraFieldZip64:i,offset:n,diskNumberStart:o}=e,{zip64UncompressedSize:s,zip64CompressedSize:r,zip64Offset:l,zip64DiskNumberStart:a}=t,c=Me(i);let d=4;s&&(d+=8),r&&(d+=8),l&&(Je(c,d,BigInt(n)),d+=8),a&&ne(c,d,o)}async function wp(e,t,i){const{files:n,writer:o}=e,{diskOffset:s,writable:r}=o;let{diskNumber:l}=o,a=0,c=0,d=e.offset-s,m=n.size;for(const[,D]of n){const{rawFilename:E,rawExtraFieldZip64:T,rawExtraFieldAES:v,rawComment:A,rawExtraFieldNTFS:R,rawExtraField:O,extendedTimestamp:U,extraFieldExtendedTimestampFlag:F,lastModDate:W}=D;let q;if(U){q=new Uint8Array(9);const k=Me(q);se(k,0,bl),se(k,2,5),co(k,4,F),ne(k,5,Math.floor(W.getTime()/1e3))}else q=new Uint8Array;D.rawExtraFieldCDExtendedTimestamp=q,c+=46+oe(E,A,T,v,R,q,O)}const g=new Uint8Array(c),y=Me(g);await Rn(o);let w=0;for(const[D,E]of Array.from(n.values()).entries()){const{offset:T,rawFilename:v,rawExtraFieldZip64:A,rawExtraFieldAES:R,rawExtraFieldCDExtendedTimestamp:O,rawExtraFieldNTFS:U,rawExtraField:F,rawComment:W,versionMadeBy:q,headerArray:k,directory:V,zip64:j,zip64UncompressedSize:fe,zip64CompressedSize:G,zip64DiskNumberStart:ue,zip64Offset:$,msDosCompatible:ie,internalFileAttribute:ve,externalFileAttribute:he,diskNumberStart:_e,uncompressedSize:Et,compressedSize:nt}=E,bt=oe(A,R,O,U,F);ne(y,a,Ru),se(y,a+4,q);const Ye=Me(k);fe||ne(Ye,18,Et),G||ne(Ye,14,nt),Te(g,k,a+6),se(y,a+30,bt),se(y,a+32,oe(W)),se(y,a+34,j&&ue?$e:_e),se(y,a+36,ve),he?ne(y,a+38,he):V&&ie&&co(y,a+38,Gu),ne(y,a+42,j&&$?Qe:T),Te(g,v,a+46),Te(g,A,a+46+oe(v)),Te(g,R,a+46+oe(v,A)),Te(g,O,a+46+oe(v,A,R)),Te(g,U,a+46+oe(v,A,R,O)),Te(g,F,a+46+oe(v,A,R,O,U)),Te(g,W,a+46+oe(v)+bt);const Rt=46+oe(v,W)+bt;if(a-w>o.availableSize&&(o.availableSize=0,await kt(r,g.slice(w,a)),w=a),a+=Rt,i.onprogress)try{await i.onprogress(D+1,n.size,new dc(E))}catch{}}await kt(r,w?g.slice(w):g);let p=o.diskNumber;const{availableSize:u}=o;u<ws&&p++;let _=de(e,i,zs);if(d>Qe||c>Qe||m>$e||p>$e){if(_===!1)throw new Error(Bs);_=!0}const x=new Uint8Array(_?ku:ws),S=Me(x);a=0,_&&(ne(S,0,Lu),Je(S,4,BigInt(44)),se(S,12,45),se(S,14,45),ne(S,16,p),ne(S,20,l),Je(S,24,BigInt(m)),Je(S,32,BigInt(m)),Je(S,40,BigInt(c)),Je(S,48,BigInt(d)),ne(S,56,Mu),Je(S,64,BigInt(d)+BigInt(c)),ne(S,72,p+1),de(e,i,"supportZip64SplitFile",!0)&&(p=$e,l=$e),m=$e,d=Qe,c=Qe,a+=El+Sl),ne(S,a,Nu),se(S,a+4,p),se(S,a+6,l),se(S,a+8,m),se(S,a+10,m),ne(S,a+12,c),ne(S,a+16,d);const I=oe(t);if(I)if(I<=$e)se(S,a+20,I);else throw new Error(ip);await kt(r,x),I&&await kt(r,t)}async function kt(e,t){const i=e.getWriter();try{await i.ready,e.size+=oe(t),await i.write(t)}finally{i.releaseLock()}}function ts(e){if(e)return(BigInt(e.getTime())+BigInt(116444736e5))*BigInt(1e4)}function de(e,t,i,n){const o=t[i]===ye?e.options[i]:t[i];return o===ye?n:o}function ka(e){return e+5*(Math.floor(e/16383)+1)}function co(e,t,i){e.setUint8(t,i)}function se(e,t,i){e.setUint16(t,i,!0)}function ne(e,t,i){e.setUint32(t,i,!0)}function Je(e,t,i){e.setBigUint64(t,i,!0)}function Te(e,t,i){e.set(t,i)}function Me(e){return new DataView(e.buffer)}function oe(...e){let t=0;return e.forEach(i=>i&&(t+=i.length)),t}Tl({Deflate:su,Inflate:Tu});const Es=32,xp="http://www.opengis.net/kml/2.2",Pt="http://www.google.com/kml/ext/2.2",Cp="http://www.w3.org/2000/xmlns/";function xo(e){this._files={},this._promises=[],this._count=0,this._modelCallback=e}const Sp=/^data:image\/([^,;]+)/;xo.prototype.texture=function(e){const t=this;let i;if(typeof e=="string"||e instanceof os){if(e=os.createIfNeeded(e),!e.isDataUri)return e.url;const n=e.url.match(Sp);i=`texture_${++this._count}`,f(n)&&(i+=`.${n[1]}`);const o=e.fetchBlob().then(function(s){t._files[i]=s});return this._promises.push(o),i}if(e instanceof HTMLCanvasElement){i=`texture_${++this._count}.png`;const n=new Promise(o=>{e.toBlob(function(s){t._files[i]=s,o()})});return this._promises.push(n),i}return""};function Ep(e,t){return function(i){e._files[t]=i}}xo.prototype.model=function(e,t){const i=this._modelCallback;if(!f(i))throw new Mc("Encountered a model entity while exporting to KML, but no model callback was supplied.");const n={},o=i(e,t,n);for(const s in n)if(n.hasOwnProperty(s)){const r=Promise.resolve(n[s]);this._promises.push(r),r.then(Ep(this,s))}return o};Object.defineProperties(xo.prototype,{promise:{get:function(){return Promise.all(this._promises)}},files:{get:function(){return this._files}}});function Co(e){this._time=e}Co.prototype.get=function(e,t,i){let n;return f(e)&&(n=f(e.getValue)?e.getValue(this._time,i):e),h(n,t)};Co.prototype.getColor=function(e,t){const i=this.get(e,t);if(f(i))return Di(i)};Co.prototype.getMaterialType=function(e){if(f(e))return e.getType(this._time)};function Us(){this._ids={},this._styles={},this._count=0}Us.prototype.get=function(e){const t=this._ids,i=e.innerHTML;if(f(t[i]))return t[i];let n=`style-${++this._count}`;return e.setAttribute("id",n),n=`#${n}`,t[i]=n,this._styles[i]=e,n};Us.prototype.save=function(e){const t=this._styles,i=e.childNodes[0];for(const n in t)t.hasOwnProperty(n)&&e.insertBefore(t[n],i)};function hc(){this._ids={}}hc.prototype.get=function(e){if(!f(e))return this.get(Ts());const t=this._ids;return f(t[e])?`${e.toString()}-${++t[e]}`:(t[e]=0,e)};function uc(e){e=h(e,h.EMPTY_OBJECT);const t=e.entities,i=h(e.kmz,!1);if(!f(t))throw new N("entities is required.");const n=uc._createState(e),o=t.values.filter(function(c){return!f(c.parent)}),s=n.kmlDoc,r=s.documentElement;r.setAttributeNS(Cp,"xmlns:gx",Pt);const l=s.createElement("Document");r.appendChild(l),pc(n,l,o),n.styleCache.save(l);const a=n.externalFileHandler;return a.promise.then(function(){const d=new XMLSerializer().serializeToString(n.kmlDoc);return i?bp(d,a.files):{kml:d,externalFiles:a.files}})}function bp(e,t){const i=Lc("ThirdParty/Workers/z-worker-pako.js");Tl({workerScripts:{deflate:[i,"./pako_deflate.min.js"],inflate:[i,"./pako_inflate.min.js"]}});const n=new Jl,o=new cp(n);return o.add("doc.kml",new Vf(e)).then(function(){const s=Object.keys(t);return fc(o,s,t,0)}).then(function(){return o.close()}).then(function(s){return{kmz:s}})}function fc(e,t,i,n){if(t.length===n)return;const o=t[n];return e.add(o,new $l(i[o])).then(function(){return fc(e,t,i,n+1)})}uc._createState=function(e){const t=e.entities,i=new Us,n=t.computeAvailability(),o=f(e.time)?e.time:n.start;let s=h(e.defaultAvailability,n);const r=h(e.sampleDuration,60);s.start===He.MINIMUM_VALUE?s.stop===He.MAXIMUM_VALUE?s=new J:B.addSeconds(s.stop,-10*r,s.start):s.stop===He.MAXIMUM_VALUE&&B.addSeconds(s.start,10*r,s.stop);const l=new xo(e.modelCallback);return{kmlDoc:document.implementation.createDocument(xp,"kml"),ellipsoid:h(e.ellipsoid,ai.default),idManager:new hc,styleCache:i,externalFileHandler:l,time:o,valueGetter:new Co(o),sampleDuration:r,defaultAvailability:new Ce([s])}};function pc(e,t,i){const n=e.kmlDoc,o=e.styleCache,s=e.valueGetter,r=e.idManager,l=i.length;let a,c,d;for(let m=0;m<l;++m){const g=i[m];a=[],c=[],d=[],Dp(e,g,c,d),Tp(e,g.polyline,c,d),za(e,g.rectangle,c,d,a),za(e,g.polygon,c,d,a),Op(e,g,g.model,c,d);let y;const w=g.availability;f(w)&&(y=n.createElement("TimeSpan"),B.equals(w.start,He.MINIMUM_VALUE)||y.appendChild(X(n,"begin",B.toIso8601(w.start))),B.equals(w.stop,He.MAXIMUM_VALUE)||y.appendChild(X(n,"end",B.toIso8601(w.stop))));for(let _=0;_<a.length;++_){const x=a[_];x.setAttribute("id",r.get(g.id)),x.appendChild(X(n,"name",g.name)),x.appendChild(X(n,"visibility",g.show)),x.appendChild(X(n,"description",g.description)),f(y)&&x.appendChild(y),t.appendChild(x)}const p=c.length;if(p>0){const _=n.createElement("Placemark");_.setAttribute("id",r.get(g.id));let x=g.name;const S=g.label;if(f(S)){const D=n.createElement("LabelStyle"),E=s.get(S.text);x=f(E)&&E.length>0?E:x;const T=s.getColor(S.fillColor);f(T)&&(D.appendChild(X(n,"color",T)),D.appendChild(X(n,"colorMode","normal")));const v=s.get(S.scale);f(v)&&D.appendChild(X(n,"scale",v)),d.push(D)}_.appendChild(X(n,"name",x)),_.appendChild(X(n,"visibility",g.show)),_.appendChild(X(n,"description",g.description)),f(y)&&_.appendChild(y),t.appendChild(_);const I=d.length;if(I>0){const D=n.createElement("Style");for(let E=0;E<I;++E)D.appendChild(d[E]);_.appendChild(X(n,"styleUrl",o.get(D)))}if(c.length===1)_.appendChild(c[0]);else if(c.length>1){const D=n.createElement("MultiGeometry");for(let E=0;E<p;++E)D.appendChild(c[E]);_.appendChild(D)}}const u=g._children;if(u.length>0){const _=n.createElement("Folder");_.setAttribute("id",r.get(g.id)),_.appendChild(X(n,"name",g.name)),_.appendChild(X(n,"visibility",g.show)),_.appendChild(X(n,"description",g.description)),t.appendChild(_),pc(e,_,u)}}}const Ze=new b,qe=new ae,Tt=new B;function Dp(e,t,i,n){const o=e.kmlDoc,s=e.ellipsoid,r=e.valueGetter,l=h(t.billboard,t.point);if(!f(l)&&!f(t.path))return;const a=t.position;if(!a.isConstant){_c(e,t,l,i,n);return}r.get(a,void 0,Ze);const c=X(o,"coordinates",bi(Ze,s)),d=o.createElement("Point"),m=o.createElement("altitudeMode");m.appendChild(Ti(e,l.heightReference)),d.appendChild(m),d.appendChild(c),i.push(d);const g=l instanceof Ii?gc(e,l):mc(e,l);n.push(g)}function _c(e,t,i,n,o){const s=e.kmlDoc,r=e.ellipsoid,l=e.valueGetter;let a;const c=t.position;let d=!0;c instanceof hi?(a=c.intervals,d=!1):a=h(t.availability,e.defaultAvailability);const m=i instanceof Ji;let g,y,w;const p=[];for(g=0;g<a.length;++g){const _=a.get(g);let x=d?c:_.data;const S=s.createElement("altitudeMode");x instanceof ui?(x=x._value,S.appendChild(Ti(e,si.CLAMP_TO_GROUND))):f(i)?S.appendChild(Ti(e,i.heightReference)):S.appendChild(Ti(e,si.NONE));const I=[],D=[];if(x.isConstant){l.get(x,void 0,Ze);const T=X(s,"coordinates",bi(Ze,r));I.push(B.toIso8601(_.start)),D.push(T),I.push(B.toIso8601(_.stop)),D.push(T)}else if(x instanceof Ct)for(w=x._property._times,y=0;y<w.length;++y)I.push(B.toIso8601(w[y])),x.getValueInReferenceFrame(w[y],xt.FIXED,Ze),D.push(bi(Ze,r));else if(x instanceof St){w=x._times;const T=x._values;for(y=0;y<w.length;++y)I.push(B.toIso8601(w[y])),b.fromArray(T,y*3,Ze),D.push(bi(Ze,r))}else{const T=e.sampleDuration;_.start.clone(Tt),_.isStartIncluded||B.addSeconds(Tt,T,Tt);const v=_.stop;for(;B.lessThan(Tt,v);)x.getValue(Tt,Ze),I.push(B.toIso8601(Tt)),D.push(bi(Ze,r)),B.addSeconds(Tt,T,Tt);_.isStopIncluded&&B.equals(Tt,v)&&(x.getValue(Tt,Ze),I.push(B.toIso8601(Tt)),D.push(bi(Ze,r)))}const E=s.createElementNS(Pt,"Track");E.appendChild(S);for(let T=0;T<I.length;++T){const v=X(s,"when",I[T]),A=X(s,"coord",D[T],Pt);E.appendChild(v),E.appendChild(A)}m&&E.appendChild(yc(e,i)),p.push(E)}if(p.length===1)n.push(p[0]);else if(p.length>1){const _=s.createElementNS(Pt,"MultiTrack");for(g=0;g<p.length;++g)_.appendChild(p[g]);n.push(_)}if(f(i)&&!m){const _=i instanceof Ii?gc(e,i):mc(e,i);o.push(_)}const u=t.path;if(f(u)){const _=l.get(u.width),x=u.material;if(f(x)||f(_)){const S=s.createElement("LineStyle");f(_)&&S.appendChild(X(s,"width",_)),Vs(e,x,S),o.push(S)}}}function mc(e,t){const i=e.kmlDoc,n=e.valueGetter,o=i.createElement("IconStyle"),s=n.getColor(t.color);f(s)&&(o.appendChild(X(i,"color",s)),o.appendChild(X(i,"colorMode","normal")));const r=n.get(t.pixelSize);return f(r)&&o.appendChild(X(i,"scale",r/Es)),o}function gc(e,t){const i=e.kmlDoc,n=e.valueGetter,o=e.externalFileHandler,s=i.createElement("IconStyle");let r=n.get(t.image);if(f(r)){r=o.texture(r);const g=i.createElement("Icon");g.appendChild(X(i,"href",r));const y=n.get(t.imageSubRegion);f(y)&&(g.appendChild(X(i,"x",y.x,Pt)),g.appendChild(X(i,"y",y.y,Pt)),g.appendChild(X(i,"w",y.width,Pt)),g.appendChild(X(i,"h",y.height,Pt))),s.appendChild(g)}const l=n.getColor(t.color);f(l)&&(s.appendChild(X(i,"color",l)),s.appendChild(X(i,"colorMode","normal")));let a=n.get(t.scale);f(a)&&s.appendChild(X(i,"scale",a));const c=n.get(t.pixelOffset);if(f(c)){a=h(a,1),Y.divideByScalar(c,a,c);const g=n.get(t.width,Es),y=n.get(t.height,Es),w=n.get(t.horizontalOrigin,Eo.CENTER);w===Eo.CENTER?c.x-=g*.5:w===Eo.RIGHT&&(c.x-=g);const p=n.get(t.verticalOrigin,bo.CENTER);p===bo.TOP?c.y+=y:p===bo.CENTER&&(c.y+=y*.5);const u=i.createElement("hotSpot");u.setAttribute("x",-c.x),u.setAttribute("y",c.y),u.setAttribute("xunits","pixels"),u.setAttribute("yunits","pixels"),s.appendChild(u)}let d=n.get(t.rotation);const m=n.get(t.alignedAxis);return f(d)&&b.equals(b.UNIT_Z,m)&&(d=Z.toDegrees(-d),d===0&&(d=360),s.appendChild(X(i,"heading",d))),s}function Tp(e,t,i,n){const o=e.kmlDoc,s=e.ellipsoid,r=e.valueGetter;if(!f(t))return;const l=o.createElement("LineString"),a=o.createElement("altitudeMode"),c=r.get(t.clampToGround,!1);let d;c?(l.appendChild(X(o,"tessellate",!0)),d=o.createTextNode("clampToGround")):d=o.createTextNode("absolute"),a.appendChild(d),l.appendChild(a);const m=t.positions,g=r.get(m),y=X(o,"coordinates",bi(g,s));l.appendChild(y);const w=r.get(t.zIndex);c&&f(w)&&l.appendChild(X(o,"drawOrder",w,Pt)),i.push(l);const p=o.createElement("LineStyle"),u=r.get(t.width);f(u)&&p.appendChild(X(o,"width",u)),Vs(e,t.material,p),n.push(p)}function Ip(e,t,i){const n=e.kmlDoc,o=e.valueGetter;let s=o.get(t.height,0);i>0&&(s=i);const r=t.coordinates,l=o.get(r),a=[],c=[Mt.northeast,Mt.southeast,Mt.southwest,Mt.northwest];for(let y=0;y<4;++y)c[y](l,qe),a.push(`${Z.toDegrees(qe.longitude)},${Z.toDegrees(qe.latitude)},${s}`);const d=X(n,"coordinates",a.join(" ")),m=n.createElement("outerBoundaryIs"),g=n.createElement("LinearRing");return g.appendChild(d),m.appendChild(g),[m]}function Fa(e,t,i,n){const o=e.kmlDoc,s=e.ellipsoid,r=[],l=t.length;for(let d=0;d<l;++d)ae.fromCartesian(t[d],s,qe),r.push(`${Z.toDegrees(qe.longitude)},${Z.toDegrees(qe.latitude)},${n?qe.height:i}`);const a=X(o,"coordinates",r.join(" ")),c=o.createElement("LinearRing");return c.appendChild(a),c}function vp(e,t,i){const n=e.kmlDoc,o=e.valueGetter;let s=o.get(t.height,0);const r=o.get(t.perPositionHeight,!1);!r&&i>0&&(s=i);const l=[],a=t.hierarchy,c=o.get(a),d=Array.isArray(c)?c:c.positions,m=n.createElement("outerBoundaryIs");m.appendChild(Fa(e,d,s,r)),l.push(m);const g=c.holes;if(f(g)){const y=g.length;for(let w=0;w<y;++w){const p=n.createElement("innerBoundaryIs");p.appendChild(Fa(e,g[w].positions,s,r)),l.push(p)}}return l}function za(e,t,i,n,o){const s=e.kmlDoc,r=e.valueGetter;if(!f(t))return;const l=t instanceof Qi;if(l&&r.getMaterialType(t.material)==="Image"){Ap(e,t,o);return}const a=s.createElement("Polygon"),c=r.get(t.extrudedHeight,0);c>0&&a.appendChild(X(s,"extrude",!0));const d=l?Ip(e,t,c):vp(e,t,c),m=d.length;for(let u=0;u<m;++u)a.appendChild(d[u]);const g=s.createElement("altitudeMode");g.appendChild(Ti(e,t.heightReference)),a.appendChild(g),i.push(a);const y=s.createElement("PolyStyle"),w=r.get(t.fill,!1);w&&y.appendChild(X(s,"fill",w)),Vs(e,t.material,y);const p=r.get(t.outline,!1);if(p){y.appendChild(X(s,"outline",p));const u=s.createElement("LineStyle"),_=r.get(t.outlineWidth,1);u.appendChild(X(s,"width",_));const x=r.getColor(t.outlineColor,Nn.BLACK);u.appendChild(X(s,"color",x)),u.appendChild(X(s,"colorMode","normal")),n.push(u)}n.push(y)}function Ap(e,t,i){const n=e.kmlDoc,o=e.valueGetter,s=e.externalFileHandler,r=n.createElement("GroundOverlay"),l=n.createElement("altitudeMode");l.appendChild(Ti(e,t.heightReference)),r.appendChild(l);const a=o.get(t.height);f(a)&&r.appendChild(X(n,"altitude",a));const c=o.get(t.coordinates),d=n.createElement("LatLonBox");d.appendChild(X(n,"north",Z.toDegrees(c.north))),d.appendChild(X(n,"south",Z.toDegrees(c.south))),d.appendChild(X(n,"east",Z.toDegrees(c.east))),d.appendChild(X(n,"west",Z.toDegrees(c.west))),r.appendChild(d);const m=o.get(t.material),g=s.texture(m.image),y=n.createElement("Icon");y.appendChild(X(n,"href",g)),r.appendChild(y);const w=m.color;f(w)&&r.appendChild(X(n,"color",Di(m.color))),i.push(r)}function yc(e,t){const i=e.kmlDoc,n=e.valueGetter,o=e.externalFileHandler,s=i.createElement("Model"),r=n.get(t.scale);if(f(r)){const c=i.createElement("scale");c.appendChild(X(i,"x",r)),c.appendChild(X(i,"y",r)),c.appendChild(X(i,"z",r)),s.appendChild(c)}const l=i.createElement("Link"),a=o.model(t,e.time);return l.appendChild(X(i,"href",a)),s.appendChild(l),s}function Op(e,t,i,n,o){const s=e.kmlDoc,r=e.ellipsoid,l=e.valueGetter;if(!f(i))return;const a=t.position;if(!a.isConstant){_c(e,t,i,n,o);return}const c=yc(e,i),d=s.createElement("altitudeMode");d.appendChild(Ti(e,i.heightReference)),c.appendChild(d),l.get(a,void 0,Ze),ae.fromCartesian(Ze,r,qe);const m=s.createElement("Location");m.appendChild(X(s,"longitude",Z.toDegrees(qe.longitude))),m.appendChild(X(s,"latitude",Z.toDegrees(qe.latitude))),m.appendChild(X(s,"altitude",qe.height)),c.appendChild(m),n.push(c)}function Vs(e,t,i){const n=e.kmlDoc,o=e.valueGetter;if(!f(t))return;const s=o.get(t);if(!f(s))return;let r;const l=o.getMaterialType(t);let a,c;switch(l){case"Image":r=Di(Nn.WHITE);break;case"Color":case"Grid":case"PolylineGlow":case"PolylineArrow":case"PolylineDash":r=Di(s.color);break;case"PolylineOutline":r=Di(s.color),a=Di(s.outlineColor),c=s.outlineWidth,i.appendChild(X(n,"outerColor",a,Pt)),i.appendChild(X(n,"outerWidth",c,Pt));break;case"Stripe":r=Di(s.oddColor);break}f(r)&&(i.appendChild(X(n,"color",r)),i.appendChild(X(n,"colorMode","normal")))}function Ti(e,t){const i=e.kmlDoc,o=e.valueGetter.get(t,si.NONE);let s;switch(o){case si.NONE:s=i.createTextNode("absolute");break;case si.CLAMP_TO_GROUND:s=i.createTextNode("clampToGround");break;case si.RELATIVE_TO_GROUND:s=i.createTextNode("relativeToGround");break}return s}function bi(e,t){Array.isArray(e)||(e=[e]);const i=e.length,n=[];for(let o=0;o<i;++o)ae.fromCartesian(e[o],t,qe),n.push(`${Z.toDegrees(qe.longitude)},${Z.toDegrees(qe.latitude)},${qe.height}`);return n.join(" ")}function X(e,t,i,n){i=h(i,""),typeof i=="boolean"&&(i=i?"1":"0");const o=f(n)?e.createElementNS(n,t):e.createElement(t),s=i==="string"&&i.indexOf("<")!==-1?e.createCDATASection(i):e.createTextNode(i);return o.appendChild(s),o}function Di(e){let t="";const i=e.toBytes();for(let n=3;n>=0;--n)t+=i[n]<16?`0${i[n].toString(16)}`:i[n].toString(16);return t}export{Zu as $,vi as A,Ii as B,In as C,Ct as D,it as E,hi as F,tt as G,$i as H,He as I,Gi as J,As as K,gn as L,Ji as M,yn as N,ke as O,te as P,ui as Q,xt as R,Ht as S,Ce as T,di as U,gi as V,Tn as W,Ri as X,$t as Y,Fp as Z,Wf as _,Ie as a,sl as a$,Rn as a0,ye as a1,$l as a2,ws as a3,Ku as a4,Nu as a5,Ss as a6,Cl as a7,Qe as a8,$e as a9,Uu as aA,Kf as aB,$f as aC,Jf as aD,Ra as aE,Hu as aF,jf as aG,Yf as aH,Zf as aI,Xf as aJ,xs as aK,ec as aL,tc as aM,ic as aN,Qf as aO,zp as aP,Bp as aQ,Tl as aR,kp as aS,Mp as aT,Po as aU,Cn as aV,ut as aW,yh as aX,wh as aY,xh as aZ,Ch as a_,Sl as aa,Mu as ab,El as ac,Lu as ad,Ru as ae,Gu as af,Ko as ag,dc as ah,Au as ai,vu as aj,Iu as ak,Ou as al,qf as am,bf as an,Lf as ao,Ll as ap,Lp as aq,Wu as ar,qu as as,Fu as at,Rp as au,Np as av,zu as aw,Bu as ax,bl as ay,Vu as az,Ge as b,Vd as b0,Ot as b1,mi as b2,Sh as b3,bh as b4,Ki as c,Vt as d,uc as e,C as f,qa as g,Ai as h,fs as i,Is as j,Ni as k,J as l,ft as m,un as n,fn as o,pn as p,_n as q,mn as r,xn as s,Sn as t,En as u,bn as v,Dn as w,Qi as x,wn as y,St as z};
//# sourceMappingURL=exportKml-B8RxacOT.js.map
